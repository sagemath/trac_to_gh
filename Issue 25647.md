# Issue 25647: Out of memory problem in matrix_mod2_dense.pyx tests on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/25884

Original creator: embray

Original creation time: 2018-07-19 13:08:43

This is a problem I started getting just since upgrading to 8.3.rc1.  Which doesn't make any sense because there were very few changes from 8.3.rc0 where I did not see the issue, and the changes do not seem relevant.

So it's possible the problem was introduced earlier, though I'm still not clear why I never noticed it; I did not have any test failures before.

I need to go back a few versions and see if there is still a problem, then maybe bisect to narrow in on it if the problem goes away on an earlier version.  Very strange though.


---

Comment by embray created at 2018-07-19 13:15:55

Tried the problematic example in a known-good install of Sage 8.2 with no problems.


---

Comment by embray created at 2018-07-23 11:27:26

In fact, it's probably not that example that's the problem, but an earlier one, and the above example is just where I happen to finally run out of memory.  There must be a memory leak elsewhere.  The test passes on a machine with more memory (e.g. my work machine), but it takes a very long time due to the memory leak.  That's possibly why I haven't noticed before.


---

Comment by embray created at 2018-07-23 12:38:24

Yes, the problem is the memory overflow tests that have come up before, e.g. in #24190.  And the problem is that even if the test passes, as it did in this case, there can be a memory leak which can in turn lead to other test failures.

Safest would be not to run these tests at all, though it would be safer if they were at least run in an isolated process.   Though we should also have better facilities built into the test runner for dealing with large memory tests.


---

Comment by embray created at 2018-07-23 12:39:22

~~It seems like there might also be a bug in the doctest parser.  It is not handling the `if/else` in 


```
            sage: import resource
            sage: if resource.RLIMIT_AS == getattr(resource, 'RLIMIT_RSS', None):
            ....:     # Skip this test if RLIMIT_AS is not properly
            ....:     # supported like on OS X, see Trac #24190
            ....:     raise RuntimeError("matrix allocation failed")
            ....: else:  # Real test
            ....:     MatrixSpace(GF(2), 2^30)(1)
            Traceback (most recent call last):
            ...
            RuntimeError: matrix allocation failed
```


correctly.  That's the main reason for the problem...~~

Nevermind, it's just that the behavior here is different on Cygwin than on OSX.  On Cygwin the comparison is True, but the `setrlimit` is still failed.


---

Comment by embray created at 2018-07-24 08:52:22

This would be fixed by #25907.


---

Comment by embray created at 2018-10-08 14:39:56

Resolution: fixed
