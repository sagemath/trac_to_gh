# Issue 25647: Out of memory problem in matrix_mod2_dense.pyx tests on Cygwin

archive/issues_025647.json:
```json
{
    "body": "This is a problem I started getting just since upgrading to 8.3.rc1.  Which doesn't make any sense because there were very few changes from 8.3.rc0 where I did not see the issue, and the changes do not seem relevant.\n\nSo it's possible the problem was introduced earlier, though I'm still not clear why I never noticed it; I did not have any test failures before.\n\nI need to go back a few versions and see if there is still a problem, then maybe bisect to narrow in on it if the problem goes away on an earlier version.  Very strange though.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25884\n\n",
    "created_at": "2018-07-19T13:08:43Z",
    "labels": [
        "component: porting: cygwin",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Out of memory problem in matrix_mod2_dense.pyx tests on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25647",
    "user": "https://github.com/embray"
}
```
This is a problem I started getting just since upgrading to 8.3.rc1.  Which doesn't make any sense because there were very few changes from 8.3.rc0 where I did not see the issue, and the changes do not seem relevant.

So it's possible the problem was introduced earlier, though I'm still not clear why I never noticed it; I did not have any test failures before.

I need to go back a few versions and see if there is still a problem, then maybe bisect to narrow in on it if the problem goes away on an earlier version.  Very strange though.

Issue created by migration from https://trac.sagemath.org/ticket/25884





---

archive/issue_comments_361313.json:
```json
{
    "body": "Tried the problematic example in a known-good install of Sage 8.2 with no problems.",
    "created_at": "2018-07-19T13:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361313",
    "user": "https://github.com/embray"
}
```

Tried the problematic example in a known-good install of Sage 8.2 with no problems.



---

archive/issue_comments_361314.json:
```json
{
    "body": "In fact, it's probably not that example that's the problem, but an earlier one, and the above example is just where I happen to finally run out of memory.  There must be a memory leak elsewhere.  The test passes on a machine with more memory (e.g. my work machine), but it takes a very long time due to the memory leak.  That's possibly why I haven't noticed before.",
    "created_at": "2018-07-23T11:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361314",
    "user": "https://github.com/embray"
}
```

In fact, it's probably not that example that's the problem, but an earlier one, and the above example is just where I happen to finally run out of memory.  There must be a memory leak elsewhere.  The test passes on a machine with more memory (e.g. my work machine), but it takes a very long time due to the memory leak.  That's possibly why I haven't noticed before.



---

archive/issue_comments_361315.json:
```json
{
    "body": "Yes, the problem is the memory overflow tests that have come up before, e.g. in #24190.  And the problem is that even if the test passes, as it did in this case, there can be a memory leak which can in turn lead to other test failures.\n\nSafest would be not to run these tests at all, though it would be safer if they were at least run in an isolated process.   Though we should also have better facilities built into the test runner for dealing with large memory tests.",
    "created_at": "2018-07-23T12:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361315",
    "user": "https://github.com/embray"
}
```

Yes, the problem is the memory overflow tests that have come up before, e.g. in #24190.  And the problem is that even if the test passes, as it did in this case, there can be a memory leak which can in turn lead to other test failures.

Safest would be not to run these tests at all, though it would be safer if they were at least run in an isolated process.   Though we should also have better facilities built into the test runner for dealing with large memory tests.



---

archive/issue_comments_361316.json:
```json
{
    "body": "~~It seems like there might also be a bug in the doctest parser.  It is not handling the `if/else` in \n\n\n```\n            sage: import resource\n            sage: if resource.RLIMIT_AS == getattr(resource, 'RLIMIT_RSS', None):\n            ....:     # Skip this test if RLIMIT_AS is not properly\n            ....:     # supported like on OS X, see Trac #24190\n            ....:     raise RuntimeError(\"matrix allocation failed\")\n            ....: else:  # Real test\n            ....:     MatrixSpace(GF(2), 2^30)(1)\n            Traceback (most recent call last):\n            ...\n            RuntimeError: matrix allocation failed\n```\n\n\ncorrectly.  That's the main reason for the problem...~~\n\nNevermind, it's just that the behavior here is different on Cygwin than on OSX.  On Cygwin the comparison is True, but the `setrlimit` is still failed.",
    "created_at": "2018-07-23T12:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361316",
    "user": "https://github.com/embray"
}
```

~~It seems like there might also be a bug in the doctest parser.  It is not handling the `if/else` in 


```
            sage: import resource
            sage: if resource.RLIMIT_AS == getattr(resource, 'RLIMIT_RSS', None):
            ....:     # Skip this test if RLIMIT_AS is not properly
            ....:     # supported like on OS X, see Trac #24190
            ....:     raise RuntimeError("matrix allocation failed")
            ....: else:  # Real test
            ....:     MatrixSpace(GF(2), 2^30)(1)
            Traceback (most recent call last):
            ...
            RuntimeError: matrix allocation failed
```


correctly.  That's the main reason for the problem...~~

Nevermind, it's just that the behavior here is different on Cygwin than on OSX.  On Cygwin the comparison is True, but the `setrlimit` is still failed.



---

archive/issue_comments_361317.json:
```json
{
    "body": "This would be fixed by #25907.",
    "created_at": "2018-07-24T08:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361317",
    "user": "https://github.com/embray"
}
```

This would be fixed by #25907.



---

archive/issue_comments_361318.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-08T14:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25647#issuecomment-361318",
    "user": "https://github.com/embray"
}
```

Resolution: fixed



---

archive/issue_events_064732.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-08T14:39:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25647#event-64732"
}
```



---

archive/issue_events_064733.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-08T14:39:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25647",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25647#event-64733"
}
```
