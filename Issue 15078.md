# Issue 15078: aspect ratio ignored in matrix and density plots

archive/issues_015078.json:
```json
{
    "body": "CC:  @ppurka @jasongrout\n\nKeywords: matplotlib imshow density plot\n\nThis is due to improper use of `imshow`, I think.  This was reported at [this ask.sagemath question](http://ask.sagemath.org/question/3115/density-plot-aspect-ratio).  See [these](http://stackoverflow.com/questions/13384653/imshow-extent-and-aspect) [stackoverflow](http://stackoverflow.com/questions/10540929/figure-of-imshow-is-too-small) [questions](http://stackoverflow.com/questions/7965743/python-matplotlib-setting-aspect-ratio/7969475#7969475) for various approaches to setting this.  Essentially, we may need to have some custom way to pass on fig size and aspect ratio to matrix and density plots (which use imshow).\n\nIssue created by migration from https://trac.sagemath.org/ticket/15315\n\n",
    "created_at": "2013-10-22T01:35:45Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "aspect ratio ignored in matrix and density plots",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15078",
    "user": "https://github.com/kcrisman"
}
```
CC:  @ppurka @jasongrout

Keywords: matplotlib imshow density plot

This is due to improper use of `imshow`, I think.  This was reported at [this ask.sagemath question](http://ask.sagemath.org/question/3115/density-plot-aspect-ratio).  See [these](http://stackoverflow.com/questions/13384653/imshow-extent-and-aspect) [stackoverflow](http://stackoverflow.com/questions/10540929/figure-of-imshow-is-too-small) [questions](http://stackoverflow.com/questions/7965743/python-matplotlib-setting-aspect-ratio/7969475#7969475) for various approaches to setting this.  Essentially, we may need to have some custom way to pass on fig size and aspect ratio to matrix and density plots (which use imshow).

Issue created by migration from https://trac.sagemath.org/ticket/15315





---

archive/issue_comments_192933.json:
```json
{
    "body": "Do you have an examlpe for matrix plot that ignores aspect ratio? I already have the fix to density plot, which should work for all cases - involves change in `graphics.py`.",
    "created_at": "2013-10-22T02:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192933",
    "user": "https://github.com/ppurka"
}
```

Do you have an examlpe for matrix plot that ignores aspect ratio? I already have the fix to density plot, which should work for all cases - involves change in `graphics.py`.



---

archive/issue_comments_192934.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-22T02:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192934",
    "user": "https://github.com/ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_192935.json:
```json
{
    "body": "I am surprised the fix is this easy, but in retrospect it makes sense - some subplots might not obey the aspect ratio.  Certainly fixes the problem in question. Obviously, needs doctests, and testing that all previous aspect ratio plots (including automatic ones) really still look correct!  Good find, ppurka.",
    "created_at": "2013-10-22T02:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192935",
    "user": "https://github.com/kcrisman"
}
```

I am surprised the fix is this easy, but in retrospect it makes sense - some subplots might not obey the aspect ratio.  Certainly fixes the problem in question. Obviously, needs doctests, and testing that all previous aspect ratio plots (including automatic ones) really still look correct!  Good find, ppurka.



---

archive/issue_comments_192936.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-22T02:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192936",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_192937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-22T05:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192937",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_192938.json:
```json
{
    "body": "Well, I added a simple doctest for density plot. I have checked some of the other figures - just browse the documentation locally and evaluate the plots. It seems fine to me. :)",
    "created_at": "2013-10-22T05:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192938",
    "user": "https://github.com/ppurka"
}
```

Well, I added a simple doctest for density plot. I have checked some of the other figures - just browse the documentation locally and evaluate the plots. It seems fine to me. :)



---

archive/issue_comments_192939.json:
```json
{
    "body": "This looks great in general, except it does change density and matrix plots to having the default aspect ratio be \"automatic\".  As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.\n\nAs to aspect ratio, we just need to decide what we want.  Note that #12222 changed most geometric figures to be \"1\" but other things to be auto, and then #12581 switched contour and region plots to \"1\".  Now we are suggesting changing density and matrix plots to be auto, not 1.  And what about slope/vector fields?  Historically we have kept such things at \"1\" because we figured the typical user would have them be squares.  But maybe that was wrong.  The canonical example is\n\n```\n        sage: x,y = var('x,y')\n        sage: contour_plot(x^2+y^2-2,(x,-1,1), (y,-1,1))\n```\n\nand we went with that being circles, not ellipses :)\n\nJason, do you have any comments on this?  I would hate to change our defaults again and again; the most important thing here is allowing user control of the aspect ratio, so we could put in a decorator to keep these at aspect ratio 1 (though then ppurka would have to change the text of his test).",
    "created_at": "2013-10-22T18:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192939",
    "user": "https://github.com/kcrisman"
}
```

This looks great in general, except it does change density and matrix plots to having the default aspect ratio be "automatic".  As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.

As to aspect ratio, we just need to decide what we want.  Note that #12222 changed most geometric figures to be "1" but other things to be auto, and then #12581 switched contour and region plots to "1".  Now we are suggesting changing density and matrix plots to be auto, not 1.  And what about slope/vector fields?  Historically we have kept such things at "1" because we figured the typical user would have them be squares.  But maybe that was wrong.  The canonical example is

```
        sage: x,y = var('x,y')
        sage: contour_plot(x^2+y^2-2,(x,-1,1), (y,-1,1))
```

and we went with that being circles, not ellipses :)

Jason, do you have any comments on this?  I would hate to change our defaults again and again; the most important thing here is allowing user control of the aspect ratio, so we could put in a decorator to keep these at aspect ratio 1 (though then ppurka would have to change the text of his test).



---

archive/issue_comments_192940.json:
```json
{
    "body": "Attachment [trac_15315-density_and_matrix_plot_aspect_ratio.patch](tarball://root/attachments/some-uuid/ticket15315/trac_15315-density_and_matrix_plot_aspect_ratio.patch) by @ppurka created at 2013-10-23 13:26:07\n\nReplying to [comment:5 kcrisman]:\n> This looks great in general, except it does change density and matrix plots to having the default aspect ratio be \"automatic\". \n\nThis is the same as it was earlier! The aspect ratio is set to `self.aspect_ratio()` if it is `None` (c.f. the patch). And the latter returns `\"automatic\"` by default. So, if matrix and density plots have not been setting the aspect ratio to one explicitly, then they *are* running with `\"automatic\"` aspect ratio.\n\nSo, IMHO, for the plots where the aspect ratio is explicitly set to 1 by ``@`options`, it remains 1. And for the plots where it is not automatically set, `\"automatic\"` was already the default, so we are not changing anything here.\n\n> As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.\n\nDone.",
    "created_at": "2013-10-23T13:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192940",
    "user": "https://github.com/ppurka"
}
```

Attachment [trac_15315-density_and_matrix_plot_aspect_ratio.patch](tarball://root/attachments/some-uuid/ticket15315/trac_15315-density_and_matrix_plot_aspect_ratio.patch) by @ppurka created at 2013-10-23 13:26:07

Replying to [comment:5 kcrisman]:
> This looks great in general, except it does change density and matrix plots to having the default aspect ratio be "automatic". 

This is the same as it was earlier! The aspect ratio is set to `self.aspect_ratio()` if it is `None` (c.f. the patch). And the latter returns `"automatic"` by default. So, if matrix and density plots have not been setting the aspect ratio to one explicitly, then they *are* running with `"automatic"` aspect ratio.

So, IMHO, for the plots where the aspect ratio is explicitly set to 1 by ``@`options`, it remains 1. And for the plots where it is not automatically set, `"automatic"` was already the default, so we are not changing anything here.

> As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.

Done.



---

archive/issue_comments_192941.json:
```json
{
    "body": "Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.",
    "created_at": "2013-10-23T17:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192941",
    "user": "https://github.com/kcrisman"
}
```

Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.



---

archive/issue_comments_192942.json:
```json
{
    "body": "Replying to [comment:7 kcrisman]:\n> Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.\n\nI realize that the problem showed up in the weird plots. My interpretation of it is this - if we set the aspect ratio to automatic before the plot, then matplotlib has no idea of the kind of data it is about to get. I don't know what it does internally. But if we set it after the plot then matplotlib has the data and now it can set the plot parameters appropriately.\n\nIdeally, matplotlib should \"keep in mind\" that the aspect ratio is automatic and needs to be readjusted after the plot.",
    "created_at": "2013-10-23T17:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192942",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:7 kcrisman]:
> Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.

I realize that the problem showed up in the weird plots. My interpretation of it is this - if we set the aspect ratio to automatic before the plot, then matplotlib has no idea of the kind of data it is about to get. I don't know what it does internally. But if we set it after the plot then matplotlib has the data and now it can set the plot parameters appropriately.

Ideally, matplotlib should "keep in mind" that the aspect ratio is automatic and needs to be readjusted after the plot.



---

archive/issue_comments_192943.json:
```json
{
    "body": "I have opened a bug [upstream](https://github.com/matplotlib/matplotlib/issues/2540).",
    "created_at": "2013-10-23T18:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192943",
    "user": "https://github.com/ppurka"
}
```

I have opened a bug [upstream](https://github.com/matplotlib/matplotlib/issues/2540).



---

archive/issue_comments_192944.json:
```json
{
    "body": "Wow, great tracking down!\n\nThat doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.",
    "created_at": "2013-10-24T02:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192944",
    "user": "https://github.com/kcrisman"
}
```

Wow, great tracking down!

That doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.



---

archive/issue_comments_192945.json:
```json
{
    "body": "Replying to [comment:10 kcrisman]:\n> That doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.\n\nAbout density plots: I think mpl is doing \"the right thing\" when aspect is set to auto. This is not a geometrical object, so I think there we should not have aspect 1 in all cases.\n\nAbout matrix plots: In this case, I think we should interpret an unset aspect ratio as `\"equal\"` aspect ratio. This is already set explicitly in the code currently but this should be handled better. The current patch affects the matrix plots and the images are no longer square.\n\nOther functions where aspect ratio is not set:\n\n* `arrow` - `FancyArrowPatch` from mpl has no aspect option\n* `bezier_path` - `Path` from mpl has no aspect option\n* `complex_plot` - the aspect ratio is not set in our code, and I think it is best left as automatic\n* `plot_field` - I don't see an aspect option in quiver of mpl\n* `step` - IMHO, there is no need for aspect ratio here\n* `text.py` - I think there is no need for aspect ratio here, and `text` in mpl has no such option either.\n\nSo, the only thing this patch affects are the matrix plots, and I think there the code should explicitly set the aspect ratio, i.e., we should introduce either ``@`options(aspect_ratio=1)` or ``@`options(aspect_ratio=\"equal\")` in the definition of `matrix_plot`.",
    "created_at": "2013-10-27T12:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192945",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:10 kcrisman]:
> That doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.

About density plots: I think mpl is doing "the right thing" when aspect is set to auto. This is not a geometrical object, so I think there we should not have aspect 1 in all cases.

About matrix plots: In this case, I think we should interpret an unset aspect ratio as `"equal"` aspect ratio. This is already set explicitly in the code currently but this should be handled better. The current patch affects the matrix plots and the images are no longer square.

Other functions where aspect ratio is not set:

* `arrow` - `FancyArrowPatch` from mpl has no aspect option
* `bezier_path` - `Path` from mpl has no aspect option
* `complex_plot` - the aspect ratio is not set in our code, and I think it is best left as automatic
* `plot_field` - I don't see an aspect option in quiver of mpl
* `step` - IMHO, there is no need for aspect ratio here
* `text.py` - I think there is no need for aspect ratio here, and `text` in mpl has no such option either.

So, the only thing this patch affects are the matrix plots, and I think there the code should explicitly set the aspect ratio, i.e., we should introduce either ``@`options(aspect_ratio=1)` or ``@`options(aspect_ratio="equal")` in the definition of `matrix_plot`.



---

archive/issue_comments_192946.json:
```json
{
    "body": "I added the option `aspect_ratio=1` to `matrix_plot` since that is the\ndesired default anyway.",
    "created_at": "2014-01-19T13:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192946",
    "user": "https://github.com/ppurka"
}
```

I added the option `aspect_ratio=1` to `matrix_plot` since that is the
desired default anyway.



---

archive/issue_comments_192947.json:
```json
{
    "body": "Note also [that the mpl ticket has been closed](https://github.com/matplotlib/matplotlib/issues/2540) as a wontfix.\n----\nNew commits:",
    "created_at": "2014-01-24T13:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192947",
    "user": "https://github.com/kcrisman"
}
```

Note also [that the mpl ticket has been closed](https://github.com/matplotlib/matplotlib/issues/2540) as a wontfix.
----
New commits:



---

archive/issue_comments_192948.json:
```json
{
    "body": "Okay, why did my comment all of a sudden put \"new commits\" below it?  I am confused.",
    "created_at": "2014-01-24T13:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192948",
    "user": "https://github.com/kcrisman"
}
```

Okay, why did my comment all of a sudden put "new commits" below it?  I am confused.



---

archive/issue_comments_192949.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> Okay, why did my comment all of a sudden put \"new commits\" below it?  I am confused.\nThose were the commits I added in comment:13. But due to some bug in trac it didn't appear immediately. It then appears in the next comment. For some reason it didn't appear in my comment. :)\n\nI am not surprised that the mpl ticket has been closed. It requires a massive overhaul to fix it. And they are in the planning stages of that.",
    "created_at": "2014-01-24T16:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192949",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:16 kcrisman]:
> Okay, why did my comment all of a sudden put "new commits" below it?  I am confused.
Those were the commits I added in comment:13. But due to some bug in trac it didn't appear immediately. It then appears in the next comment. For some reason it didn't appear in my comment. :)

I am not surprised that the mpl ticket has been closed. It requires a massive overhaul to fix it. And they are in the planning stages of that.



---

archive/issue_comments_192950.json:
```json
{
    "body": "Sorry for taking so very long to get to this...  Just one dumb thing that is easy to fix:\n\n```\n+    Test that matrix plots have aspect ratio one (see :trac:`15315`)\n```\n\n  needs extra double colon.",
    "created_at": "2014-08-15T06:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192950",
    "user": "https://github.com/kcrisman"
}
```

Sorry for taking so very long to get to this...  Just one dumb thing that is easy to fix:

```
+    Test that matrix plots have aspect ratio one (see :trac:`15315`)
```

  needs extra double colon.



---

archive/issue_comments_192951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-15T07:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192952.json:
```json
{
    "body": "Thanks. I had forgotten about these tickets.",
    "created_at": "2014-08-15T07:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192952",
    "user": "https://github.com/ppurka"
}
```

Thanks. I had forgotten about these tickets.



---

archive/issue_comments_192953.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-15T07:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192953",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_192954.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-16T09:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15078#issuecomment-192954",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_014761.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-08-16T09:32:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15078",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15078#event-14761"
}
```
