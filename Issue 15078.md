# Issue 15078: aspect ratio ignored in matrix and density plots

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2013-10-22 01:35:45

CC:  ppurka jason

Keywords: matplotlib imshow density plot

This is due to improper use of `imshow`, I think.  This was reported at [this ask.sagemath question](http://ask.sagemath.org/question/3115/density-plot-aspect-ratio).  See [these](http://stackoverflow.com/questions/13384653/imshow-extent-and-aspect) [stackoverflow](http://stackoverflow.com/questions/10540929/figure-of-imshow-is-too-small) [questions](http://stackoverflow.com/questions/7965743/python-matplotlib-setting-aspect-ratio/7969475#7969475) for various approaches to setting this.  Essentially, we may need to have some custom way to pass on fig size and aspect ratio to matrix and density plots (which use imshow).


---

Comment by ppurka created at 2013-10-22 02:00:53

Do you have an examlpe for matrix plot that ignores aspect ratio? I already have the fix to density plot, which should work for all cases - involves change in `graphics.py`.


---

Comment by ppurka created at 2013-10-22 02:08:30

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-10-22 02:20:58

I am surprised the fix is this easy, but in retrospect it makes sense - some subplots might not obey the aspect ratio.  Certainly fixes the problem in question. Obviously, needs doctests, and testing that all previous aspect ratio plots (including automatic ones) really still look correct!  Good find, ppurka.


---

Comment by kcrisman created at 2013-10-22 02:20:58

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2013-10-22 05:15:38

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2013-10-22 05:15:38

Well, I added a simple doctest for density plot. I have checked some of the other figures - just browse the documentation locally and evaluate the plots. It seems fine to me. :)


---

Comment by kcrisman created at 2013-10-22 18:47:09

This looks great in general, except it does change density and matrix plots to having the default aspect ratio be "automatic".  As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.

As to aspect ratio, we just need to decide what we want.  Note that #12222 changed most geometric figures to be "1" but other things to be auto, and then #12581 switched contour and region plots to "1".  Now we are suggesting changing density and matrix plots to be auto, not 1.  And what about slope/vector fields?  Historically we have kept such things at "1" because we figured the typical user would have them be squares.  But maybe that was wrong.  The canonical example is

```
        sage: x,y = var('x,y')
        sage: contour_plot(x^2+y^2-2,(x,-1,1), (y,-1,1))
```

and we went with that being circles, not ellipses :)

Jason, do you have any comments on this?  I would hate to change our defaults again and again; the most important thing here is allowing user control of the aspect ratio, so we could put in a decorator to keep these at aspect ratio 1 (though then ppurka would have to change the text of his test).


---

Attachment

Replying to [comment:5 kcrisman]:
> This looks great in general, except it does change density and matrix plots to having the default aspect ratio be "automatic". 

This is the same as it was earlier! The aspect ratio is set to `self.aspect_ratio()` if it is `None` (c.f. the patch). And the latter returns `"automatic"` by default. So, if matrix and density plots have not been setting the aspect ratio to one explicitly, then they _are_ running with `"automatic"` aspect ratio.

So, IMHO, for the plots where the aspect ratio is explicitly set to 1 by ``@`options`, it remains 1. And for the plots where it is not automatically set, `"automatic"` was already the default, so we are not changing anything here.

> As a very gentle review request, could you remove the extra back tick from [here](http://hg.sagemath.org/sage-main/src/f0ee3538887fe739601babb54e177ec5e1133b7a/sage/plot/density_plot.py?at=default#cl-45)?  Same file.  You didn't introduce it but it would be nice not to open a separate ticket for that.

Done.


---

Comment by kcrisman created at 2013-10-23 17:12:55

Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.


---

Comment by ppurka created at 2013-10-23 17:48:37

Replying to [comment:7 kcrisman]:
> Try a weird density plot without the patch and then with it.  I at least think they look different - which is why the original poster had trouble in the first place.

I realize that the problem showed up in the weird plots. My interpretation of it is this - if we set the aspect ratio to automatic before the plot, then matplotlib has no idea of the kind of data it is about to get. I don't know what it does internally. But if we set it after the plot then matplotlib has the data and now it can set the plot parameters appropriately.

Ideally, matplotlib should "keep in mind" that the aspect ratio is automatic and needs to be readjusted after the plot.


---

Comment by ppurka created at 2013-10-23 18:23:29

I have opened a bug [upstream](https://github.com/matplotlib/matplotlib/issues/2540).


---

Comment by kcrisman created at 2013-10-24 02:00:45

Wow, great tracking down!

That doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.


---

Comment by ppurka created at 2013-10-27 12:31:21

Replying to [comment:10 kcrisman]:
> That doesn't change that we should have the discussion about whether density plots should have automatic or 1 aspect ratio.  I don't exactly have a horse in the race, but I think that needless API changes are also annoying.

About density plots: I think mpl is doing "the right thing" when aspect is set to auto. This is not a geometrical object, so I think there we should not have aspect 1 in all cases.

About matrix plots: In this case, I think we should interpret an unset aspect ratio as `"equal"` aspect ratio. This is already set explicitly in the code currently but this should be handled better. The current patch affects the matrix plots and the images are no longer square.

Other functions where aspect ratio is not set:

* `arrow` - `FancyArrowPatch` from mpl has no aspect option
* `bezier_path` - `Path` from mpl has no aspect option
* `complex_plot` - the aspect ratio is not set in our code, and I think it is best left as automatic
* `plot_field` - I don't see an aspect option in quiver of mpl
* `step` - IMHO, there is no need for aspect ratio here
* `text.py` - I think there is no need for aspect ratio here, and `text` in mpl has no such option either.

So, the only thing this patch affects are the matrix plots, and I think there the code should explicitly set the aspect ratio, i.e., we should introduce either ``@`options(aspect_ratio=1)` or ``@`options(aspect_ratio="equal")` in the definition of `matrix_plot`.


---

Comment by ppurka created at 2014-01-19 13:45:33

I added the option `aspect_ratio=1` to `matrix_plot` since that is the
desired default anyway.


---

Comment by kcrisman created at 2014-01-24 13:37:29

Note also [that the mpl ticket has been closed](https://github.com/matplotlib/matplotlib/issues/2540) as a wontfix.
----
New commits:


---

Comment by kcrisman created at 2014-01-24 13:43:46

Okay, why did my comment all of a sudden put "new commits" below it?  I am confused.


---

Comment by ppurka created at 2014-01-24 16:15:50

Replying to [comment:16 kcrisman]:
> Okay, why did my comment all of a sudden put "new commits" below it?  I am confused.
Those were the commits I added in comment:13. But due to some bug in trac it didn't appear immediately. It then appears in the next comment. For some reason it didn't appear in my comment. :)

I am not surprised that the mpl ticket has been closed. It requires a massive overhaul to fix it. And they are in the planning stages of that.


---

Comment by kcrisman created at 2014-08-15 06:04:01

Sorry for taking so very long to get to this...  Just one dumb thing that is easy to fix:

```
+    Test that matrix plots have aspect ratio one (see :trac:`15315`)
```

  needs extra double colon.


---

Comment by git created at 2014-08-15 07:43:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ppurka created at 2014-08-15 07:44:49

Thanks. I had forgotten about these tickets.


---

Comment by kcrisman created at 2014-08-15 07:45:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-16 09:32:31

Resolution: fixed
