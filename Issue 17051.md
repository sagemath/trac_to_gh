# Issue 17051: MathJax for both (offline) notebooks

archive/issues_017051.json:
```json
{
    "body": "CC:  @egourgoulhon\n\nKeywords: mathjax notebook\n\nCurrenlty, `MathJax` is bundled with sagenb. But ipython notebook also requires `MathJax` for offline displaying mathematical formulas.\n\nThe aim of this ticket is to:\n- have a independent `MathJax` (default) spkg, not related to sagenb\n- have ipython notebook work with that local install\n- remove `MathJax` from sagenb bundle and use the independent one to avoid duplication\n\nThe latest `MathJax` tarball can be downloaded at https://github.com/mathjax/MathJax/archive/v2.4-latest.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/17288\n\n",
    "created_at": "2014-11-04T14:44:05Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "MathJax for both (offline) notebooks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17051",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
CC:  @egourgoulhon

Keywords: mathjax notebook

Currenlty, `MathJax` is bundled with sagenb. But ipython notebook also requires `MathJax` for offline displaying mathematical formulas.

The aim of this ticket is to:
- have a independent `MathJax` (default) spkg, not related to sagenb
- have ipython notebook work with that local install
- remove `MathJax` from sagenb bundle and use the independent one to avoid duplication

The latest `MathJax` tarball can be downloaded at https://github.com/mathjax/MathJax/archive/v2.4-latest.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/17288





---

archive/issue_comments_226457.json:
```json
{
    "body": "The previous commit settles the first item. I know how to manage the second one, but i do not know enough about sagenb development to achieve the third one.\n\n---\nNew commits:",
    "created_at": "2014-11-04T14:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226457",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

The previous commit settles the first item. I know how to manage the second one, but i do not know enough about sagenb development to achieve the third one.

---
New commits:



---

archive/issue_comments_226458.json:
```json
{
    "body": "The current `MathJax` wheights 175M once installed, which is quite a lot. Shall we strip it (e.g. removing png files) ? See https://github.com/mathjax/MathJax-docs/wiki/Guide%3A-reducing-size-of-a-mathjax-installation",
    "created_at": "2014-11-04T15:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226458",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

The current `MathJax` wheights 175M once installed, which is quite a lot. Shall we strip it (e.g. removing png files) ? See https://github.com/mathjax/MathJax-docs/wiki/Guide%3A-reducing-size-of-a-mathjax-installation



---

archive/issue_comments_226459.json:
```json
{
    "body": "First, I agree that we should remove the png files. I think that is what's done in sagenb. Second, given the current status (= slow) of sagenb development, I think that removing `MathJax` from sagenb should go on another ticket. The stripped version shouldn't take too much space, so having two copies for a while (until sagenb gets modified) is not that bad.",
    "created_at": "2014-11-05T18:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226459",
    "user": "https://github.com/jhpalmieri"
}
```

First, I agree that we should remove the png files. I think that is what's done in sagenb. Second, given the current status (= slow) of sagenb development, I think that removing `MathJax` from sagenb should go on another ticket. The stripped version shouldn't take too much space, so having two copies for a while (until sagenb gets modified) is not that bad.



---

archive/issue_comments_226460.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-06T12:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226461.json:
```json
{
    "body": "Actually, with the help of the before mentioned mathjax reducing guide, it was possible to remove much more than only png files. It should be possible to remove even more according to our needs, but i think 9.2M is a good size for now, and the current strip is simple to read (hence debug) and barely modifies a config file.",
    "created_at": "2014-11-06T12:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226461",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Actually, with the help of the before mentioned mathjax reducing guide, it was possible to remove much more than only png files. It should be possible to remove even more according to our needs, but i think 9.2M is a good size for now, and the current strip is simple to read (hence debug) and barely modifies a config file.



---

archive/issue_comments_226462.json:
```json
{
    "body": "Yeah, I think that although there has been a spurt in the notebook recently, we (I) really need to just focus on making sure that the upgrade to javascript 3d is successful; disentangling the MathJax stuff there to have it back in sage could be challenging.  And there are always a few people who still want to keep sagenb totally separate so it could be a separate project for some reason.  \n\nSorry.  This is certainly a good goal!  But I think John is right.",
    "created_at": "2014-11-06T14:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226462",
    "user": "https://github.com/kcrisman"
}
```

Yeah, I think that although there has been a spurt in the notebook recently, we (I) really need to just focus on making sure that the upgrade to javascript 3d is successful; disentangling the MathJax stuff there to have it back in sage could be challenging.  And there are always a few people who still want to keep sagenb totally separate so it could be a separate project for some reason.  

Sorry.  This is certainly a good goal!  But I think John is right.



---

archive/issue_comments_226463.json:
```json
{
    "body": "I am not involved in the development of sagenb, so it's really up to you.\n\nI just gave a try, simply removing the mathjax directory in `local/lib/python2.7/site-packages/sagenb-*.egg/sagenb/data` and replacing it with a symlink  to `../../../../../../share/mathjax` seems to work well.\n\nSo, if you still want to ship mathjax within sagenb source code, a possibility is to add the previous \"remove+symlink\" at the end of the `build/pkgs/sagenb/spkg-install` script, so the only problem will be about downloading mathjax twice. Another possibility is to officially ship two sagenb tarballs, one with mathjax, one without.",
    "created_at": "2014-11-06T16:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226463",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I am not involved in the development of sagenb, so it's really up to you.

I just gave a try, simply removing the mathjax directory in `local/lib/python2.7/site-packages/sagenb-*.egg/sagenb/data` and replacing it with a symlink  to `../../../../../../share/mathjax` seems to work well.

So, if you still want to ship mathjax within sagenb source code, a possibility is to add the previous "remove+symlink" at the end of the `build/pkgs/sagenb/spkg-install` script, so the only problem will be about downloading mathjax twice. Another possibility is to officially ship two sagenb tarballs, one with mathjax, one without.



---

archive/issue_comments_226464.json:
```json
{
    "body": "> I just gave a try, simply removing the mathjax directory in `local/lib/python2.7/site-packages/sagenb-*.egg/sagenb/data` and replacing it with a symlink  to `../../../../../../share/mathjax` seems to work well.\n\n\nGood, I'll keep that in mind.\n> So, if you still want to ship mathjax within sagenb source code, a possibility is to add the previous \"remove+symlink\" at the end of the `build/pkgs/sagenb/spkg-install` script, so the only problem will be about downloading mathjax twice. Another possibility is to officially ship two sagenb tarballs, one with mathjax, one without.\n\n\nI don't think there is really any need to ship it if it is in Sage, I was just commenting on what some people liked.  Anyway, I'll make an upstream ticket - https://github.com/sagemath/sagenb/issues/258 - but don't worry about it for now.\n\n(I'm kind of surprised IPython notebook doesn't ship MathJax.)",
    "created_at": "2014-11-06T16:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226464",
    "user": "https://github.com/kcrisman"
}
```

> I just gave a try, simply removing the mathjax directory in `local/lib/python2.7/site-packages/sagenb-*.egg/sagenb/data` and replacing it with a symlink  to `../../../../../../share/mathjax` seems to work well.


Good, I'll keep that in mind.
> So, if you still want to ship mathjax within sagenb source code, a possibility is to add the previous "remove+symlink" at the end of the `build/pkgs/sagenb/spkg-install` script, so the only problem will be about downloading mathjax twice. Another possibility is to officially ship two sagenb tarballs, one with mathjax, one without.


I don't think there is really any need to ship it if it is in Sage, I was just commenting on what some people liked.  Anyway, I'll make an upstream ticket - https://github.com/sagemath/sagenb/issues/258 - but don't worry about it for now.

(I'm kind of surprised IPython notebook doesn't ship MathJax.)



---

archive/issue_comments_226465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-07T15:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-07T16:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226467.json:
```json
{
    "body": "In the last commit i showed how could sagenb work with mathjax spkg. It should work both with or without modifiction of sagenb spkg. Since each commit does a specific thing, we can decide whether  sagenb should use mathjax spkg or not.\n\n- commit \u200be8ef55d : basic independent mathjax spkg\n- commit \u200b8f18d36 : strip mathjax down from 175M to <10M.\n- commit \u200b0443d99 : make mathjax a standard spkg and a dependency of (and work with) ipython\n- commit \u200b8ec7d5c : make mathjax a dependency of (and work with) sagenb",
    "created_at": "2014-11-07T16:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226467",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

In the last commit i showed how could sagenb work with mathjax spkg. It should work both with or without modifiction of sagenb spkg. Since each commit does a specific thing, we can decide whether  sagenb should use mathjax spkg or not.

- commit ​e8ef55d : basic independent mathjax spkg
- commit ​8f18d36 : strip mathjax down from 175M to <10M.
- commit ​0443d99 : make mathjax a standard spkg and a dependency of (and work with) ipython
- commit ​8ec7d5c : make mathjax a dependency of (and work with) sagenb



---

archive/issue_comments_226468.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-07T16:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226468",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226469.json:
```json
{
    "body": "Here is what I recommend on the sagenb piece (I have no technical opinion on the rest, though it seems like a great idea).  Do everything that you want to with the first three commits, but please save the sagenb one for a different ticket - one that is post-Sage-6.4.\n\nThe reason is that sagenb will *also* need changes - namely, to get rid of the mathjax from itself.  That shouldn't be too hard, possibly trivial, but I just don't have the bandwidth right now to shepherd that through given that it would nonetheless need some reasonably intensive testing.  Given the small size of this package, this really shouldn't be an issue.  I already reported upstream, and have pointed out the commit in question, so everything that needs to be done can be done.",
    "created_at": "2014-11-07T16:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226469",
    "user": "https://github.com/kcrisman"
}
```

Here is what I recommend on the sagenb piece (I have no technical opinion on the rest, though it seems like a great idea).  Do everything that you want to with the first three commits, but please save the sagenb one for a different ticket - one that is post-Sage-6.4.

The reason is that sagenb will *also* need changes - namely, to get rid of the mathjax from itself.  That shouldn't be too hard, possibly trivial, but I just don't have the bandwidth right now to shepherd that through given that it would nonetheless need some reasonably intensive testing.  Given the small size of this package, this really shouldn't be an issue.  I already reported upstream, and have pointed out the commit in question, so everything that needs to be done can be done.



---

archive/issue_comments_226470.json:
```json
{
    "body": "Okay, i will put the commit related to sagenb in the ticket #17306. That said, the current ticket can wait after 6.4 too :)",
    "created_at": "2014-11-07T20:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226470",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Okay, i will put the commit related to sagenb in the ticket #17306. That said, the current ticket can wait after 6.4 too :)



---

archive/issue_comments_226471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-07T20:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226472.json:
```json
{
    "body": "See also #17446, though I don't recommend replacing this with a possibly-unstable alpha.",
    "created_at": "2014-12-05T02:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226472",
    "user": "https://github.com/kcrisman"
}
```

See also #17446, though I don't recommend replacing this with a possibly-unstable alpha.



---

archive/issue_comments_226473.json:
```json
{
    "body": "Note that\n\n```\nif [ -d mathjax ] ; then\n    rm -rf mathjax\nfi\n```\nis entirely equivalent (assuming `mathjax` is never an ordinary file) to\n\n```\nrm -rf mathjax\n```\n\nSo either simplify or fix that.",
    "created_at": "2014-12-05T06:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226473",
    "user": "https://github.com/jdemeyer"
}
```

Note that

```
if [ -d mathjax ] ; then
    rm -rf mathjax
fi
```
is entirely equivalent (assuming `mathjax` is never an ordinary file) to

```
rm -rf mathjax
```

So either simplify or fix that.



---

archive/issue_comments_226474.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-05T06:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226474",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226475.json:
```json
{
    "body": "Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?",
    "created_at": "2014-12-05T06:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226475",
    "user": "https://github.com/jdemeyer"
}
```

Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?



---

archive/issue_comments_226476.json:
```json
{
    "body": "> Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?\n\nYeah, see http://www.sagemath.org/doc/developer/packaging.html  Does the fact that that is needed to be run something that goes in SPKG.txt?",
    "created_at": "2014-12-05T13:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226476",
    "user": "https://github.com/kcrisman"
}
```

> Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?

Yeah, see http://www.sagemath.org/doc/developer/packaging.html  Does the fact that that is needed to be run something that goes in SPKG.txt?



---

archive/issue_comments_226477.json:
```json
{
    "body": "Once this is ready, there are some other sagenb things that could be packaged up so we could try to coordinate with #17306 (the 'big' release now being out of the way).\n\nBy the way, why does http://git.sagemath.org/sage.git/diff/?id=8314779f9e64eaeb0d00444a41336529286a9708 have build/deps mysteriously vanishing?  (None of the individual commits do this, of course.)",
    "created_at": "2014-12-07T03:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226477",
    "user": "https://github.com/kcrisman"
}
```

Once this is ready, there are some other sagenb things that could be packaged up so we could try to coordinate with #17306 (the 'big' release now being out of the way).

By the way, why does http://git.sagemath.org/sage.git/diff/?id=8314779f9e64eaeb0d00444a41336529286a9708 have build/deps mysteriously vanishing?  (None of the individual commits do this, of course.)



---

archive/issue_comments_226478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-08T10:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226479.json:
```json
{
    "body": "Replying to [comment:23 kcrisman]:\n> By the way, why does http://git.sagemath.org/sage.git/diff/?id=8314779f9e64eaeb0d00444a41336529286a9708 have build/deps mysteriously vanishing?  (None of the individual commits do this, of course.)\n\n\nI do not know, i repushed somethning and it seems the problem disapeared.",
    "created_at": "2014-12-08T10:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226479",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:23 kcrisman]:
> By the way, why does http://git.sagemath.org/sage.git/diff/?id=8314779f9e64eaeb0d00444a41336529286a9708 have build/deps mysteriously vanishing?  (None of the individual commits do this, of course.)


I do not know, i repushed somethning and it seems the problem disapeared.



---

archive/issue_comments_226480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-08T10:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226481.json:
```json
{
    "body": "Replying to [comment:21 jdemeyer]:\n> Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?\n\n\nWell, i think this is a more global issue about Sage packaging. I would avocate to ship unmodified upstream tarballs so that any user can check its integrity (hashsums). The problem of spkg-src scripts is that they is not reproducible (i can not run it myself to check if it was correctly applied) because tarballs contain some noise (e.g. timestamps). I agree that in some extreme cases (e.g. boost), the difference of size before and after is so huge that we could be tempted to repackage the upstream tarball. However, it may be a better idea to discuss with upstream about shipping trimmed versions as well (i am pretty sure many webmaster will be happy to benefit from such a standard trimmed version of mathjax). By the way, the current documentation somehow agrees with that point of view  (\"Ideally it is not modified [...] if you **really** must modify the upstream tarball\" (bold is mine)): http://www.sagemath.org/doc/developer/packaging.html#modified-tarballs",
    "created_at": "2014-12-08T10:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226481",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:21 jdemeyer]:
> Shouldn't the trimming happen at packaging time (in `spkg-src`) rather than at installation time?


Well, i think this is a more global issue about Sage packaging. I would avocate to ship unmodified upstream tarballs so that any user can check its integrity (hashsums). The problem of spkg-src scripts is that they is not reproducible (i can not run it myself to check if it was correctly applied) because tarballs contain some noise (e.g. timestamps). I agree that in some extreme cases (e.g. boost), the difference of size before and after is so huge that we could be tempted to repackage the upstream tarball. However, it may be a better idea to discuss with upstream about shipping trimmed versions as well (i am pretty sure many webmaster will be happy to benefit from such a standard trimmed version of mathjax). By the way, the current documentation somehow agrees with that point of view  ("Ideally it is not modified [...] if you **really** must modify the upstream tarball" (bold is mine)): http://www.sagemath.org/doc/developer/packaging.html#modified-tarballs



---

archive/issue_comments_226482.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Note that\n> \n> ```\n> if [ -d mathjax ] ; then\n>     rm -rf mathjax\n> fi\n> ```\n> is entirely equivalent (assuming `mathjax` is never an ordinary file) to\n> \n> ```\n> rm -rf mathjax\n> ```\n> \n> So either simplify or fix that.\n\n\nI did it in my last commit. The reason why i did that before was in case the user symlinked to her own mathjax install (in order to mutualize with another existing mathjax install on the computer to save space (for example on a live system)).",
    "created_at": "2014-12-08T11:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226482",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:20 jdemeyer]:
> Note that
> 
> ```
> if [ -d mathjax ] ; then
>     rm -rf mathjax
> fi
> ```
> is entirely equivalent (assuming `mathjax` is never an ordinary file) to
> 
> ```
> rm -rf mathjax
> ```
> 
> So either simplify or fix that.


I did it in my last commit. The reason why i did that before was in case the user symlinked to her own mathjax install (in order to mutualize with another existing mathjax install on the computer to save space (for example on a live system)).



---

archive/issue_comments_226483.json:
```json
{
    "body": "> > Shouldn't the trimming happen at packaging time (in spkg-src) rather than at installation time?\n\n> Well, i think this is a more global issue about Sage packaging. I would avocate to ship unmodified upstream tarballs so that any user can check its integrity (hashsums). \nBut it sort of misses the point of trimming at all, since now we have to ship the entire thing anyway in a source dist, and download the whole thing for an upgrade.  Maybe it helps binaries some.",
    "created_at": "2014-12-08T13:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226483",
    "user": "https://github.com/kcrisman"
}
```

> > Shouldn't the trimming happen at packaging time (in spkg-src) rather than at installation time?

> Well, i think this is a more global issue about Sage packaging. I would avocate to ship unmodified upstream tarballs so that any user can check its integrity (hashsums). 
But it sort of misses the point of trimming at all, since now we have to ship the entire thing anyway in a source dist, and download the whole thing for an upgrade.  Maybe it helps binaries some.



---

archive/issue_comments_226484.json:
```json
{
    "body": "Replying to [comment:29 kcrisman]:\n> But it sort of misses the point of trimming at all, since now we have to ship the entire thing anyway in a source dist, and download the whole thing for an upgrade.  Maybe it helps binaries some.\n\n\nIndeed, most non-developpers i met use binary tarballs, live USB or PPA (actually those who build Sage from source do this because there is no binary for their distro/version/architecture).\n\nAlso, note that the mathjax tarball weights 22M while the uncompressed/untared directory weights 175M (of course a tarball obtained from the 10M trimmed directory would be very small).\n\nAs for mathjax package, i will see if upstream can ship \"generic\" trimmed versions.",
    "created_at": "2014-12-08T18:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226484",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:29 kcrisman]:
> But it sort of misses the point of trimming at all, since now we have to ship the entire thing anyway in a source dist, and download the whole thing for an upgrade.  Maybe it helps binaries some.


Indeed, most non-developpers i met use binary tarballs, live USB or PPA (actually those who build Sage from source do this because there is no binary for their distro/version/architecture).

Also, note that the mathjax tarball weights 22M while the uncompressed/untared directory weights 175M (of course a tarball obtained from the 10M trimmed directory would be very small).

As for mathjax package, i will see if upstream can ship "generic" trimmed versions.



---

archive/issue_comments_226485.json:
```json
{
    "body": "What's status here?  I don't use ipynb so I won't be reviewing this, but interested because of #17306, which I should have time to review once this is in.",
    "created_at": "2015-02-03T01:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226485",
    "user": "https://github.com/kcrisman"
}
```

What's status here?  I don't use ipynb so I won't be reviewing this, but interested because of #17306, which I should have time to review once this is in.



---

archive/issue_comments_226486.json:
```json
{
    "body": "Replying to [comment:28 tmonteil]:\n> Replying to [comment:20 jdemeyer]:\n> > Note that\n> > \n> > ```\n> > if [ -d mathjax ] ; then\n> >     rm -rf mathjax\n> > fi\n> > ```\n> > is entirely equivalent (assuming `mathjax` is never an ordinary file) to\n> > \n> > ```\n> > rm -rf mathjax\n> > ```\n> > \n> > So either simplify or fix that.\n\n> \n> The reason why i did that before was in case the user symlinked to her own mathjax install\n\n\nSide comment: even in that case, the commands\n\n```\nif [ -d mathjax ] ; then\n    rm -rf mathjax\nfi\n```\nand\n\n```\nrm -rf mathjax\n```\nare equivalent: both delete just the symlink.",
    "created_at": "2015-02-04T07:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226486",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 tmonteil]:
> Replying to [comment:20 jdemeyer]:
> > Note that
> > 
> > ```
> > if [ -d mathjax ] ; then
> >     rm -rf mathjax
> > fi
> > ```
> > is entirely equivalent (assuming `mathjax` is never an ordinary file) to
> > 
> > ```
> > rm -rf mathjax
> > ```
> > 
> > So either simplify or fix that.

> 
> The reason why i did that before was in case the user symlinked to her own mathjax install


Side comment: even in that case, the commands

```
if [ -d mathjax ] ; then
    rm -rf mathjax
fi
```
and

```
rm -rf mathjax
```
are equivalent: both delete just the symlink.



---

archive/issue_comments_226487.json:
```json
{
    "body": "Does `IPYTHON` really depend on `MATHJAX` at *installation-time*? Or is it a run-time dependency only? In the latter case, it shouldn't be added to `build/deps`.",
    "created_at": "2015-02-04T07:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226487",
    "user": "https://github.com/jdemeyer"
}
```

Does `IPYTHON` really depend on `MATHJAX` at *installation-time*? Or is it a run-time dependency only? In the latter case, it shouldn't be added to `build/deps`.



---

archive/issue_comments_226488.json:
```json
{
    "body": "I don't know about the portability of\n\n```\nln -s ../../../../../../share/mathjax/\n```\n\nI would prefer\n\n```\nln -s ../../../../../../share/mathjax/ mathjax\n```",
    "created_at": "2015-02-04T07:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226488",
    "user": "https://github.com/jdemeyer"
}
```

I don't know about the portability of

```
ln -s ../../../../../../share/mathjax/
```

I would prefer

```
ln -s ../../../../../../share/mathjax/ mathjax
```



---

archive/issue_comments_226489.json:
```json
{
    "body": "By the way - [MathJax 2.5 is out](http://www.mathjax.org/mathjax-v2-5-now-available/) claiming to have some superfast preview mode until everything is rendered nicely. Perhaps it can be used instead of 2.4?",
    "created_at": "2015-02-07T00:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226489",
    "user": "https://github.com/novoselt"
}
```

By the way - [MathJax 2.5 is out](http://www.mathjax.org/mathjax-v2-5-now-available/) claiming to have some superfast preview mode until everything is rendered nicely. Perhaps it can be used instead of 2.4?



---

archive/issue_comments_226490.json:
```json
{
    "body": "Fixed. I also prefer to re-pack the tarball as we save quite a bit here.\n  \n---\nNew commits:",
    "created_at": "2015-02-21T14:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226490",
    "user": "https://github.com/vbraun"
}
```

Fixed. I also prefer to re-pack the tarball as we save quite a bit here.
  
---
New commits:



---

archive/issue_comments_226491.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-21T14:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226491",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226492.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-01T01:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226492",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226493.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2015-03-01T01:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226493",
    "user": "https://github.com/kiwifb"
}
```

Looks good to me.



---

archive/issue_comments_226494.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-03T00:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226494",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049974.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-03T00:25:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17051#event-49974"
}
```



---

archive/issue_events_049975.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-03-03T02:12:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17051#event-49975"
}
```



---

archive/issue_comments_226495.json:
```json
{
    "body": "So SVG fonts are removed??? They were a great alternative when there were any issues with HTML! Plus, there is still an option to use SVG as a renderer in the menu and after picking it and refreshing the page all formulas are gone and it is not clear how to go back!\n\nIf tarball is 22MB what's the necessity to strip anything but development files at all? PNG fonts are there for a reason too - some users/browsers have issues with others. For the moment one of the \"other browsers\" seems to be Firefox 38 on our campus computers - things are ugly in SageNB and in SageMathCell I only see math processing error message.\n\nMathJax is an essential component of Sage, so if contributes to 5% of its tarball and unpacked size I don't see it as a problem at all...",
    "created_at": "2015-06-02T22:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226495",
    "user": "https://github.com/novoselt"
}
```

So SVG fonts are removed??? They were a great alternative when there were any issues with HTML! Plus, there is still an option to use SVG as a renderer in the menu and after picking it and refreshing the page all formulas are gone and it is not clear how to go back!

If tarball is 22MB what's the necessity to strip anything but development files at all? PNG fonts are there for a reason too - some users/browsers have issues with others. For the moment one of the "other browsers" seems to be Firefox 38 on our campus computers - things are ugly in SageNB and in SageMathCell I only see math processing error message.

MathJax is an essential component of Sage, so if contributes to 5% of its tarball and unpacked size I don't see it as a problem at all...



---

archive/issue_comments_226496.json:
```json
{
    "body": "Replying to [comment:42 novoselt]:\n> So SVG fonts are removed??? They were a great alternative when there were any issues with HTML! Plus, there is still an option to use SVG as a renderer in the menu and after picking it and refreshing the page all formulas are gone and it is not clear how to go back!\n> \n> If tarball is 22MB what's the necessity to strip anything but development files at all? PNG fonts are there for a reason too - some users/browsers have issues with others. For the moment one of the \"other browsers\" seems to be Firefox 38 on our campus computers - things are ugly in SageNB and in SageMathCell I only see math processing error message.\n> \n> MathJax is an essential component of Sage, so if contributes to 5% of its tarball and unpacked size I don't see it as a problem at all...\n\n\ntarball size is not the only problem. sage also has one patch to avoid extra problem from this. \n\nBut as a starting point to conversation you have to know that by default if left alone these `.png` fonts will be copied in each subfolder of the html sage documentation. One data point I have from https://github.com/cschwan/sage-on-gentoo/issues/344 is that for two languages (english and french) the size of the html doc comes to 1.7GB in sage-on-gentoo before I did something about the duplications of fonts everywhere. After that it comes to 274MB. Check your vanilla sage install and you will find out that with all the language enabled you are under that figure. I think the basic figure for all languages is over 5GB, if you don't do anything about these `.png` fonts.",
    "created_at": "2015-06-02T22:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226496",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:42 novoselt]:
> So SVG fonts are removed??? They were a great alternative when there were any issues with HTML! Plus, there is still an option to use SVG as a renderer in the menu and after picking it and refreshing the page all formulas are gone and it is not clear how to go back!
> 
> If tarball is 22MB what's the necessity to strip anything but development files at all? PNG fonts are there for a reason too - some users/browsers have issues with others. For the moment one of the "other browsers" seems to be Firefox 38 on our campus computers - things are ugly in SageNB and in SageMathCell I only see math processing error message.
> 
> MathJax is an essential component of Sage, so if contributes to 5% of its tarball and unpacked size I don't see it as a problem at all...


tarball size is not the only problem. sage also has one patch to avoid extra problem from this. 

But as a starting point to conversation you have to know that by default if left alone these `.png` fonts will be copied in each subfolder of the html sage documentation. One data point I have from https://github.com/cschwan/sage-on-gentoo/issues/344 is that for two languages (english and french) the size of the html doc comes to 1.7GB in sage-on-gentoo before I did something about the duplications of fonts everywhere. After that it comes to 274MB. Check your vanilla sage install and you will find out that with all the language enabled you are under that figure. I think the basic figure for all languages is over 5GB, if you don't do anything about these `.png` fonts.



---

archive/issue_comments_226497.json:
```json
{
    "body": "ff38 should work fine with the fonts, sounds like a serious bug. Is it really fixed/worked around by installing png fonts?",
    "created_at": "2015-06-02T22:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226497",
    "user": "https://github.com/vbraun"
}
```

ff38 should work fine with the fonts, sounds like a serious bug. Is it really fixed/worked around by installing png fonts?



---

archive/issue_comments_226498.json:
```json
{
    "body": "I don't know if it will be fixed, but the error messages that flash are that it cannot load webfonts. This may be something special for our computer setup (= whatever campus IT guys are doing, things are fine on my desktop), but at least in the past SVG worked quite well and presumably does not have issues of PNG fonts.\n\nRelated to multiple copies - surely that is not MathJax's fault! If there is a need to have fonts in each folder, couldn't it be achieved via symlinks?",
    "created_at": "2015-06-02T22:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226498",
    "user": "https://github.com/novoselt"
}
```

I don't know if it will be fixed, but the error messages that flash are that it cannot load webfonts. This may be something special for our computer setup (= whatever campus IT guys are doing, things are fine on my desktop), but at least in the past SVG worked quite well and presumably does not have issues of PNG fonts.

Related to multiple copies - surely that is not MathJax's fault! If there is a need to have fonts in each folder, couldn't it be achieved via symlinks?



---

archive/issue_comments_226499.json:
```json
{
    "body": "I am fairly sure there is a configuration option in `mathjax` to avoid copying the fonts, but I am not sure it is currently working/enabled properly. Removing duplicates which is what I currently do in sage-on-gentoo requires extra massaging that would easily be put in the install script. If the bits to avoid the copying could be fixed or enabled properly that would be better. I think we have enough information that a new ticket should be opened rather than beating on this closed one.",
    "created_at": "2015-06-02T22:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226499",
    "user": "https://github.com/kiwifb"
}
```

I am fairly sure there is a configuration option in `mathjax` to avoid copying the fonts, but I am not sure it is currently working/enabled properly. Removing duplicates which is what I currently do in sage-on-gentoo requires extra massaging that would easily be put in the install script. If the bits to avoid the copying could be fixed or enabled properly that would be better. I think we have enough information that a new ticket should be opened rather than beating on this closed one.



---

archive/issue_comments_226500.json:
```json
{
    "body": "#18596",
    "created_at": "2015-06-02T23:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17051#issuecomment-226500",
    "user": "https://github.com/novoselt"
}
```

#18596
