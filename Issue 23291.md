# Issue 23291: table fails with unicode strings

archive/issues_023291.json:
```json
{
    "body": "CC:  @embray @jdemeyer @kiwifb @fchapoton\n\nKeywords: unicode\n\nUnicode that coerces to str is OK in terminal mode:\n\n\n```\nsage: table([ [u'test'] ])\n  test\n```\n\n\nUnicode that coerces to str looks bad in html and latex mode{\n\n\n```\nsage: html(table([ [u'test'] ]))\n\n<div class=\"notruncate\">\n<table  class=\"table_form\">\n<tbody>\n<tr class =\"row-a\">\n<td><script type=\"math/tex\">\\text{\\texttt{test}}</script></td>\n</tr>\n</tbody>\n</table>\n</div>\n```\n\n\nUnicode that doesn't coerce to str booms:\n\n\n```\nsage: html(table([ [u't\u00e6st'] ]))\n---------------------------------------------------------------------------\nUnicodeEncodeError                        Traceback (most recent call last)\n...\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xe6' in position 1: ordinal not in range(128)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23528\n\n",
    "created_at": "2017-07-23T12:36:55Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "table fails with unicode strings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23291",
    "user": "https://github.com/johanrosenkilde"
}
```
CC:  @embray @jdemeyer @kiwifb @fchapoton

Keywords: unicode

Unicode that coerces to str is OK in terminal mode:


```
sage: table([ [u'test'] ])
  test
```


Unicode that coerces to str looks bad in html and latex mode{


```
sage: html(table([ [u'test'] ]))

<div class="notruncate">
<table  class="table_form">
<tbody>
<tr class ="row-a">
<td><script type="math/tex">\text{\texttt{test}}</script></td>
</tr>
</tbody>
</table>
</div>
```


Unicode that doesn't coerce to str booms:


```
sage: html(table([ [u'tæst'] ]))
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
...
UnicodeEncodeError: 'ascii' codec can't encode character u'\xe6' in position 1: ordinal not in range(128)
```


Issue created by migration from https://trac.sagemath.org/ticket/23528





---

archive/issue_comments_325542.json:
```json
{
    "body": "see also\n\n```\nsage: table([ [u't\u00e9'] ])\n<repr(<sage.misc.table.table at 0x7f11f5632110>) failed: UnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 1: ordinal not in range(128)>\nsage: latex(u'b\u00e9b\u00e9')\n---------------------------------------------------------------------------\nUnicodeEncodeError                        Traceback (most recent call last)\n<ipython-input-13-3625503295c8> in <module>()\n----> 1 latex(u'b\u00e9b\u00e9')\n\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)\n    928             return LatexExpr(f(x))\n    929         except KeyError:\n--> 930             return LatexExpr(str_function(str(x)))\n    931 \n    932 \n\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 1: ordinal not in range(128)\n```\n",
    "created_at": "2018-05-05T07:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325542",
    "user": "https://github.com/fchapoton"
}
```

see also

```
sage: table([ [u'té'] ])
<repr(<sage.misc.table.table at 0x7f11f5632110>) failed: UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 1: ordinal not in range(128)>
sage: latex(u'bébé')
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
<ipython-input-13-3625503295c8> in <module>()
----> 1 latex(u'bébé')

/home/chapoton/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)
    928             return LatexExpr(f(x))
    929         except KeyError:
--> 930             return LatexExpr(str_function(str(x)))
    931 
    932 

UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 1: ordinal not in range(128)
```




---

archive/issue_comments_325543.json:
```json
{
    "body": "Yes, I see the problem.  There are a few explicit `str()` calls in the `sage.misc.table` code, at least one of which is definitely wrong for treating unicode properly.  Incidentally this works fine on Python 3 since `str` is `unicode` :)",
    "created_at": "2018-05-07T09:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325543",
    "user": "https://github.com/embray"
}
```

Yes, I see the problem.  There are a few explicit `str()` calls in the `sage.misc.table` code, at least one of which is definitely wrong for treating unicode properly.  Incidentally this works fine on Python 3 since `str` is `unicode` :)



---

archive/issue_events_060310.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-07T09:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60310"
}
```



---

archive/issue_comments_325544.json:
```json
{
    "body": "The problem with `LatexExpr` is slightly different, since the class itself inherits from `str`, so if we want it to support unicode properly on Python 2 we really need to make it a subclass of `unicode`.  I think I'll open a separate ticket for that.",
    "created_at": "2018-05-07T09:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325544",
    "user": "https://github.com/embray"
}
```

The problem with `LatexExpr` is slightly different, since the class itself inherits from `str`, so if we want it to support unicode properly on Python 2 we really need to make it a subclass of `unicode`.  I think I'll open a separate ticket for that.



---

archive/issue_comments_325545.json:
```json
{
    "body": "On second thought, maybe I will fix that in this ticket too, since fixing `LatexExpr` is (apparently) necessary for fixing `table`.",
    "created_at": "2018-05-07T09:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325545",
    "user": "https://github.com/embray"
}
```

On second thought, maybe I will fix that in this ticket too, since fixing `LatexExpr` is (apparently) necessary for fixing `table`.



---

archive/issue_comments_325546.json:
```json
{
    "body": "On third thought, the latex module needs some other work in general, including on Python 3, so maybe I will do that separately and make this a dependency of a new ticket.",
    "created_at": "2018-05-07T11:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325546",
    "user": "https://github.com/embray"
}
```

On third thought, the latex module needs some other work in general, including on Python 3, so maybe I will do that separately and make this a dependency of a new ticket.



---

archive/issue_comments_325547.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-07T11:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325547",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_325548.json:
```json
{
    "body": "The *brand new* pyflakes plugin says\n\n```\n+src/sage/misc/table.py:594: 'types' imported but unused\n+src/sage/misc/table.py:726: 'types' imported but unused\n+found 2 pyflakes errors in the modified files\n```\n",
    "created_at": "2018-05-07T14:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325548",
    "user": "https://github.com/fchapoton"
}
```

The *brand new* pyflakes plugin says

```
+src/sage/misc/table.py:594: 'types' imported but unused
+src/sage/misc/table.py:726: 'types' imported but unused
+found 2 pyflakes errors in the modified files
```




---

archive/issue_comments_325549.json:
```json
{
    "body": "I have fixed the pyflakes warning. Is this ready for review ?\n----\nNew commits:",
    "created_at": "2018-05-07T15:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325549",
    "user": "https://github.com/fchapoton"
}
```

I have fixed the pyflakes warning. Is this ready for review ?
----
New commits:



---

archive/issue_comments_325550.json:
```json
{
    "body": "I don't know--this alone does not fix the problem.  I already started in another branch fixing other things in `sage.misc.latex`.  But I guess that could be done separately.",
    "created_at": "2018-05-09T15:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325550",
    "user": "https://github.com/embray"
}
```

I don't know--this alone does not fix the problem.  I already started in another branch fixing other things in `sage.misc.latex`.  But I guess that could be done separately.



---

archive/issue_events_060311.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60311"
}
```



---

archive/issue_events_060312.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60312"
}
```



---

archive/issue_comments_325551.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325551",
    "user": "https://github.com/videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_events_060313.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-17T02:27:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60313"
}
```



---

archive/issue_events_060314.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-17T02:27:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60314"
}
```



---

archive/issue_comments_325552.json:
```json
{
    "body": "Outdated, should be closed.",
    "created_at": "2020-08-17T02:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325552",
    "user": "https://github.com/mkoeppe"
}
```

Outdated, should be closed.



---

archive/issue_comments_325553.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-17T02:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325553",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_060315.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-08-19T14:41:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23291#event-60315"
}
```



---

archive/issue_comments_325554.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2020-08-19T14:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325554",
    "user": "https://github.com/embray"
}
```

Resolution: worksforme



---

archive/issue_comments_325555.json:
```json
{
    "body": "Yes, I imagine this must be fixed by now.",
    "created_at": "2020-08-19T14:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23291#issuecomment-325555",
    "user": "https://github.com/embray"
}
```

Yes, I imagine this must be fixed by now.
