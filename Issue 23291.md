# Issue 23291: table fails with unicode strings

Issue created by migration from https://trac.sagemath.org/ticket/23528

Original creator: jsrn

Original creation time: 2017-07-23 12:36:55

CC:  embray jdemeyer fbissey chapoton

Keywords: unicode

Unicode that coerces to str is OK in terminal mode:


```
sage: table([ [u'test'] ])
  test
```


Unicode that coerces to str looks bad in html and latex mode{


```
sage: html(table([ [u'test'] ]))

<div class="notruncate">
<table  class="table_form">
<tbody>
<tr class ="row-a">
<td><script type="math/tex">\text{\texttt{test}}</script></td>
</tr>
</tbody>
</table>
</div>
```


Unicode that doesn't coerce to str booms:


```
sage: html(table([ [u'tæst'] ]))
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
...
UnicodeEncodeError: 'ascii' codec can't encode character u'\xe6' in position 1: ordinal not in range(128)
```



---

Comment by chapoton created at 2018-05-05 07:33:08

see also

```
sage: table([ [u'té'] ])
<repr(<sage.misc.table.table at 0x7f11f5632110>) failed: UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 1: ordinal not in range(128)>
sage: latex(u'bébé')
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
<ipython-input-13-3625503295c8> in <module>()
----> 1 latex(u'bébé')

/home/chapoton/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)
    928             return LatexExpr(f(x))
    929         except KeyError:
--> 930             return LatexExpr(str_function(str(x)))
    931 
    932 

UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 1: ordinal not in range(128)
```



---

Comment by embray created at 2018-05-07 09:04:25

Yes, I see the problem.  There are a few explicit `str()` calls in the `sage.misc.table` code, at least one of which is definitely wrong for treating unicode properly.  Incidentally this works fine on Python 3 since `str` is `unicode` :)


---

Comment by embray created at 2018-05-07 09:12:49

The problem with `LatexExpr` is slightly different, since the class itself inherits from `str`, so if we want it to support unicode properly on Python 2 we really need to make it a subclass of `unicode`.  I think I'll open a separate ticket for that.


---

Comment by embray created at 2018-05-07 09:33:34

On second thought, maybe I will fix that in this ticket too, since fixing `LatexExpr` is (apparently) necessary for fixing `table`.


---

Comment by embray created at 2018-05-07 11:37:43

On third thought, the latex module needs some other work in general, including on Python 3, so maybe I will do that separately and make this a dependency of a new ticket.


---

Comment by embray created at 2018-05-07 11:38:13

New commits:


---

Comment by chapoton created at 2018-05-07 14:53:31

The _brand new_ pyflakes plugin says

```
+src/sage/misc/table.py:594: 'types' imported but unused
+src/sage/misc/table.py:726: 'types' imported but unused
+found 2 pyflakes errors in the modified files
```



---

Comment by chapoton created at 2018-05-07 15:43:14

I have fixed the pyflakes warning. Is this ready for review ?
----
New commits:


---

Comment by embray created at 2018-05-09 15:28:57

I don't know--this alone does not fix the problem.  I already started in another branch fixing other things in `sage.misc.latex`.  But I guess that could be done separately.


---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4


---

Comment by mkoeppe created at 2020-08-17 02:27:14

Outdated, should be closed.


---

Comment by mkoeppe created at 2020-08-17 02:27:14

Changing status from new to needs_review.


---

Comment by embray created at 2020-08-19 14:41:52

Resolution: worksforme


---

Comment by embray created at 2020-08-19 14:41:52

Yes, I imagine this must be fixed by now.
