# Issue 11427: Wrap fan moriphism in toric morphism

archive/issues_011427.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nCC:  davideklund fschulze mmarco\n\nSince we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11599\n\n",
    "created_at": "2011-07-14T17:25:02Z",
    "labels": [
        "algebraic geometry",
        "major",
        "enhancement"
    ],
    "title": "Wrap fan moriphism in toric morphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11427",
    "user": "vbraun"
}
```
Assignee: AlexGhitza

CC:  davideklund fschulze mmarco

Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.

Issue created by migration from https://trac.sagemath.org/ticket/11599





---

archive/issue_comments_127363.json:
```json
{
    "body": "We should. I have been using the following code so far:\n\n```\ndef toric_morphism_list(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    result = [1] * Y.fan().nrays()\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[i] *= x_rho^d\n    return result\n\ndef toric_morphism_dictionary(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    y = [SR.var(y_i, domain=\"positive\") for y_i in Y.coordinate_ring().variable_names()]\n    result = dict((y_i, 1) for y_i in y)\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[y[i]] *= x_rho^d\n    return result\n```\n\nUsing the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for \"correct and general\" implementation:\nhttp://arxiv.org/abs/1004.4924",
    "created_at": "2011-07-16T03:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127363",
    "user": "novoselt"
}
```

We should. I have been using the following code so far:

```
def toric_morphism_list(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    result = [1] * Y.fan().nrays()
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[i] *= x_rho^d
    return result

def toric_morphism_dictionary(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    y = [SR.var(y_i, domain="positive") for y_i in Y.coordinate_ring().variable_names()]
    result = dict((y_i, 1) for y_i in y)
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[y[i]] *= x_rho^d
    return result
```

Using the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for "correct and general" implementation:
http://arxiv.org/abs/1004.4924



---

archive/issue_comments_127364.json:
```json
{
    "body": "P.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.",
    "created_at": "2011-07-16T03:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127364",
    "user": "novoselt"
}
```

P.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.



---

archive/issue_comments_127365.json:
```json
{
    "body": "Thanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).\n\nMy plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.\n\nEventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own \"Homogeneous coordinate ring\" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)",
    "created_at": "2011-07-16T10:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127365",
    "user": "vbraun"
}
```

Thanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).

My plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.

Eventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own "Homogeneous coordinate ring" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)



---

archive/issue_comments_127366.json:
```json
{
    "body": "They don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.",
    "created_at": "2011-07-16T16:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127366",
    "user": "novoselt"
}
```

They don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.



---

archive/issue_comments_127367.json:
```json
{
    "body": "I know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.",
    "created_at": "2011-07-16T16:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127367",
    "user": "vbraun"
}
```

I know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.



---

archive/issue_comments_127368.json:
```json
{
    "body": "Ok so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)",
    "created_at": "2011-07-19T18:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127368",
    "user": "vbraun"
}
```

Ok so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)



---

archive/issue_comments_127369.json:
```json
{
    "body": "Pickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.",
    "created_at": "2011-07-19T18:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127369",
    "user": "vbraun"
}
```

Pickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.



---

archive/issue_comments_127370.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-08-11T21:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127370",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_127371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-11T21:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127371",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127372.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-08-11T21:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127372",
    "user": "vbraun"
}
```

Attachment



---

archive/issue_comments_127373.json:
```json
{
    "body": "The first patch has wrong extension!",
    "created_at": "2011-08-12T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127373",
    "user": "novoselt"
}
```

The first patch has wrong extension!



---

archive/issue_comments_127374.json:
```json
{
    "body": "Oops, I clearly never read past the first letter of the extension ;-)",
    "created_at": "2011-08-12T16:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127374",
    "user": "vbraun"
}
```

Oops, I clearly never read past the first letter of the extension ;-)



---

archive/issue_comments_127375.json:
```json
{
    "body": "I've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.",
    "created_at": "2011-08-13T19:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127375",
    "user": "vbraun"
}
```

I've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.



---

archive/issue_comments_127376.json:
```json
{
    "body": "Yes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions \"virtual rays\" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.",
    "created_at": "2011-08-13T20:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127376",
    "user": "novoselt"
}
```

Yes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions "virtual rays" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.



---

archive/issue_comments_127377.json:
```json
{
    "body": "I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nDoes this mean that you want me to review #11400 now? ;-)",
    "created_at": "2011-08-13T20:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127377",
    "user": "vbraun"
}
```

I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

Does this mean that you want me to review #11400 now? ;-)



---

archive/issue_comments_127378.json:
```json
{
    "body": "I just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...",
    "created_at": "2011-08-13T22:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127378",
    "user": "vbraun"
}
```

I just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...



---

archive/issue_comments_127379.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nThat's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be \"honest\" and I am not quite sure how to search for such places. But maybe I just worry too much.\n\n> Does this mean that you want me to review #11400 now? ;-)\n\nI certainly would not mind ;-) And thanks for reviewing #10793!",
    "created_at": "2011-08-14T03:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127379",
    "user": "novoselt"
}
```

Replying to [comment:13 vbraun]:
> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

That's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be "honest" and I am not quite sure how to search for such places. But maybe I just worry too much.

> Does this mean that you want me to review #11400 now? ;-)

I certainly would not mind ;-) And thanks for reviewing #10793!



---

archive/issue_comments_127380.json:
```json
{
    "body": "For the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!",
    "created_at": "2011-08-17T04:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127380",
    "user": "novoselt"
}
```

For the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!



---

archive/issue_comments_127381.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2011-12-16T10:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127381",
    "user": "vbraun"
}
```

Rebased patch



---

archive/issue_comments_127382.json:
```json
{
    "body": "Attachment\n\nRebased patch",
    "created_at": "2011-12-16T10:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127382",
    "user": "vbraun"
}
```

Attachment

Rebased patch



---

archive/issue_comments_127383.json:
```json
{
    "body": "Attachment\n\nRebased patch",
    "created_at": "2011-12-16T10:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127383",
    "user": "vbraun"
}
```

Attachment

Rebased patch



---

archive/issue_comments_127384.json:
```json
{
    "body": "Apply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch \n\nRediffed because it conflicted with #11526",
    "created_at": "2011-12-16T10:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127384",
    "user": "vbraun"
}
```

Apply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch 

Rediffed because it conflicted with #11526



---

archive/issue_comments_127385.json:
```json
{
    "body": "Looking good.\n\nThere is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".",
    "created_at": "2011-12-16T12:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127385",
    "user": "davideklund"
}
```

Looking good.

There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".



---

archive/issue_comments_127386.json:
```json
{
    "body": "Thanks, fixed.",
    "created_at": "2011-12-16T13:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127386",
    "user": "vbraun"
}
```

Thanks, fixed.



---

archive/issue_comments_127387.json:
```json
{
    "body": "Replying to [comment:19 davideklund]:\n> Looking good.\n> \n> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n\n\"Looking good\" as in positive review to the second patch with the fixed typo?-)",
    "created_at": "2011-12-29T17:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127387",
    "user": "novoselt"
}
```

Replying to [comment:19 davideklund]:
> Looking good.
> 
> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".

"Looking good" as in positive review to the second patch with the fixed typo?-)



---

archive/issue_comments_127388.json:
```json
{
    "body": "Volker: regarding pickling issues and doctests marked \"optional - pickling\", is there already an open ticket for this? If not, should there be one?",
    "created_at": "2011-12-29T17:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127388",
    "user": "novoselt"
}
```

Volker: regarding pickling issues and doctests marked "optional - pickling", is there already an open ticket for this? If not, should there be one?



---

archive/issue_comments_127389.json:
```json
{
    "body": "Next questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?",
    "created_at": "2011-12-29T17:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127389",
    "user": "novoselt"
}
```

Next questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?



---

archive/issue_comments_127390.json:
```json
{
    "body": "Replying to [comment:21 novoselt]:\n> Replying to [comment:19 davideklund]:\n> > Looking good.\n> > \n> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n> \n> \"Looking good\" as in positive review to the second patch with the fixed typo?-)\n\nSorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).",
    "created_at": "2011-12-29T17:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127390",
    "user": "davideklund"
}
```

Replying to [comment:21 novoselt]:
> Replying to [comment:19 davideklund]:
> > Looking good.
> > 
> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".
> 
> "Looking good" as in positive review to the second patch with the fixed typo?-)

Sorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).



---

archive/issue_comments_127391.json:
```json
{
    "body": "Thanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.",
    "created_at": "2011-12-29T17:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127391",
    "user": "novoselt"
}
```

Thanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.



---

archive/issue_comments_127392.json:
```json
{
    "body": "`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.\n\nI haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...",
    "created_at": "2011-12-29T17:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127392",
    "user": "vbraun"
}
```

`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.

I haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...



---

archive/issue_comments_127393.json:
```json
{
    "body": "Attachment\n\nUpdated patch",
    "created_at": "2011-12-29T17:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127393",
    "user": "vbraun"
}
```

Attachment

Updated patch



---

archive/issue_comments_127394.json:
```json
{
    "body": "My concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...\n\nThanks for inheritance clarification!\n\nIn `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)",
    "created_at": "2011-12-29T18:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127394",
    "user": "novoselt"
}
```

My concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...

Thanks for inheritance clarification!

In `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)



---

archive/issue_comments_127395.json:
```json
{
    "body": "With current patches:\n\n```\nSCORE sage/schemes/generic/homset.py: 85% (18 of 21)\n\nMissing documentation:\n\t * base_extend(self, R):\n\n\nMissing doctests:\n\t * is_SchemeHomset(H):\n\t * _element_constructor_(self, *args, **kwds):\n\n\nPossibly wrong (function name doesn't occur in doctests):\n\t * _element_constructor_(self, x, check=True):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n```\n\nWould be nice to get to 100%.",
    "created_at": "2011-12-29T18:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127395",
    "user": "novoselt"
}
```

With current patches:

```
SCORE sage/schemes/generic/homset.py: 85% (18 of 21)

Missing documentation:
	 * base_extend(self, R):


Missing doctests:
	 * is_SchemeHomset(H):
	 * _element_constructor_(self, *args, **kwds):


Possibly wrong (function name doesn't occur in doctests):
	 * _element_constructor_(self, x, check=True):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
```

Would be nice to get to 100%.



---

archive/issue_comments_127396.json:
```json
{
    "body": "Attachment\n\nUpdated patch",
    "created_at": "2011-12-29T19:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127396",
    "user": "vbraun"
}
```

Attachment

Updated patch



---

archive/issue_comments_127397.json:
```json
{
    "body": "Added some more doctests to bring the whole directory to 95.4% doctest coverage ;-)",
    "created_at": "2011-12-29T19:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127397",
    "user": "vbraun"
}
```

Added some more doctests to bring the whole directory to 95.4% doctest coverage ;-)



---

archive/issue_comments_127398.json:
```json
{
    "body": "I am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?\n\nI have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.",
    "created_at": "2012-01-12T18:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127398",
    "user": "novoselt"
}
```

I am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?

I have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.



---

archive/issue_comments_127399.json:
```json
{
    "body": "What's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?",
    "created_at": "2012-01-21T01:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127399",
    "user": "novoselt"
}
```

What's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?



---

archive/issue_comments_127400.json:
```json
{
    "body": "Presumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.",
    "created_at": "2012-01-21T01:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127400",
    "user": "vbraun"
}
```

Presumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.



---

archive/issue_comments_127401.json:
```json
{
    "body": "Done with the huge patch, all looks fine, little tweaks are in the reviewer patch.\n\nMoving on to the remaining ones...",
    "created_at": "2012-01-24T22:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127401",
    "user": "novoselt"
}
```

Done with the huge patch, all looks fine, little tweaks are in the reviewer patch.

Moving on to the remaining ones...



---

archive/issue_comments_127402.json:
```json
{
    "body": "The renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.\n\nThere is also no consistency in \"a word for homset\": I think I saw \"homset\", \"hom set\", \"hom-set\", \"Hom-set\" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer \"Hom-set\" with close second \"homset\". Or, perhaps, they should be referred to as \"sets of morphisms\".\n\nOtherwise I am fine with the third patch, so only the fun part is left!",
    "created_at": "2012-01-31T05:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127402",
    "user": "novoselt"
}
```

The renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.

There is also no consistency in "a word for homset": I think I saw "homset", "hom set", "hom-set", "Hom-set" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer "Hom-set" with close second "homset". Or, perhaps, they should be referred to as "sets of morphisms".

Otherwise I am fine with the third patch, so only the fun part is left!



---

archive/issue_comments_127403.json:
```json
{
    "body": "For the last patch:\n\n1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?\n2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.\n3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.\n4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)\n5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?\n6. In `_repr_defn` of toric morphism lines like \"Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N.\" are constructed. \"the\" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)\n7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in http://trac.sagemath.org/sage_trac/ticket/11599#comment:30.\n\nThese are all the comments that I have, will upload new reviewer patch shortly.",
    "created_at": "2012-02-09T04:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127403",
    "user": "novoselt"
}
```

For the last patch:

1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?
2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.
3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.
4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)
5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?
6. In `_repr_defn` of toric morphism lines like "Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N." are constructed. "the" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)
7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in http://trac.sagemath.org/sage_trac/ticket/11599#comment:30.

These are all the comments that I have, will upload new reviewer patch shortly.



---

archive/issue_comments_127404.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-09T04:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127404",
    "user": "novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127405.json:
```json
{
    "body": "Attachment\n\nInitial patch",
    "created_at": "2012-02-19T22:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127405",
    "user": "vbraun"
}
```

Attachment

Initial patch



---

archive/issue_comments_127406.json:
```json
{
    "body": "Attachment\n\nInitial patch",
    "created_at": "2012-02-19T22:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127406",
    "user": "vbraun"
}
```

Attachment

Initial patch



---

archive/issue_comments_127407.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-19T22:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127407",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127408.json:
```json
{
    "body": "I renamed the method names to remove the `_class` suffix, this is the first new patch.\n\nThe final patch should deal with all of your remaining suggestions.",
    "created_at": "2012-02-19T22:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127408",
    "user": "vbraun"
}
```

I renamed the method names to remove the `_class` suffix, this is the first new patch.

The final patch should deal with all of your remaining suggestions.



---

archive/issue_comments_127409.json:
```json
{
    "body": "Thank you!\n\nWhat is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.",
    "created_at": "2012-02-19T23:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127409",
    "user": "novoselt"
}
```

Thank you!

What is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.



---

archive/issue_comments_127410.json:
```json
{
    "body": "If you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.",
    "created_at": "2012-02-19T23:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127410",
    "user": "vbraun"
}
```

If you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.



---

archive/issue_comments_127411.json:
```json
{
    "body": "Well, looks good, hopefully it will make its way into Sage-5.0!",
    "created_at": "2012-02-20T00:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127411",
    "user": "novoselt"
}
```

Well, looks good, hopefully it will make its way into Sage-5.0!



---

archive/issue_comments_127412.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-20T00:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127412",
    "user": "novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127413.json:
```json
{
    "body": "There is numerical noise on various systems (including ia64 and OSX 10.4 PPC):\n\n```\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py\", line 1292:\n    sage: P(2+I, 3-I, 4+5*I)\nExpected:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)\nGot:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)\n**********************************************************************\n```\n",
    "created_at": "2012-02-26T22:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127413",
    "user": "jdemeyer"
}
```

There is numerical noise on various systems (including ia64 and OSX 10.4 PPC):

```
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py", line 1292:
    sage: P(2+I, 3-I, 4+5*I)
Expected:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)
Got:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)
**********************************************************************
```




---

archive/issue_comments_127414.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-02-26T22:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127414",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_127415.json:
```json
{
    "body": "So - what would be the correct way to deal with such noise?..",
    "created_at": "2012-03-06T17:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127415",
    "user": "novoselt"
}
```

So - what would be the correct way to deal with such noise?..



---

archive/issue_comments_127416.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-03-06T18:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127416",
    "user": "vbraun"
}
```

Initial patch



---

archive/issue_comments_127417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-06T18:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127417",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127418.json:
```json
{
    "body": "Attachment\n\nI propose to just set the homogeneous variable to 1 instead of dividing by itself...",
    "created_at": "2012-03-06T18:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127418",
    "user": "vbraun"
}
```

Attachment

I propose to just set the homogeneous variable to 1 instead of dividing by itself...



---

archive/issue_comments_127419.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-06T19:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127419",
    "user": "novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127420.json:
```json
{
    "body": "Seems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).",
    "created_at": "2012-03-06T19:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127420",
    "user": "novoselt"
}
```

Seems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).



---

archive/issue_comments_127421.json:
```json
{
    "body": "For your information:\nthis patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).",
    "created_at": "2012-03-10T09:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127421",
    "user": "jdemeyer"
}
```

For your information:
this patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).



---

archive/issue_comments_127422.json:
```json
{
    "body": "Apply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch\n\n(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)",
    "created_at": "2012-03-12T10:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127422",
    "user": "davidloeffler"
}
```

Apply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch

(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)



---

archive/issue_comments_127423.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127423",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_127424.json:
```json
{
    "body": "Hi there,\n\nIt's cool to see thinks moving forward and the doc getting better. However\ncommunication between developers could be better too. In this ticket, there is\na big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,\nimproving `classcall` and `UniqueRepresentation`, I also discovered\nthat `sage/structure/factory.pyx` wasn't in the doc and that its doc was\nbroken. I didn't find any ticket that seems to fix it so I decided to go ahead\nand spend on hour improving it... For nothing except creating a conflict.\n\nNext time, please make such unrelated doctest improvements in a separate\nticket, and advertise them on trac!\n\nThanks,\n\nGrumpy Florent",
    "created_at": "2012-04-10T10:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127424",
    "user": "hivert"
}
```

Hi there,

It's cool to see thinks moving forward and the doc getting better. However
communication between developers could be better too. In this ticket, there is
a big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,
improving `classcall` and `UniqueRepresentation`, I also discovered
that `sage/structure/factory.pyx` wasn't in the doc and that its doc was
broken. I didn't find any ticket that seems to fix it so I decided to go ahead
and spend on hour improving it... For nothing except creating a conflict.

Next time, please make such unrelated doctest improvements in a separate
ticket, and advertise them on trac!

Thanks,

Grumpy Florent



---

archive/issue_comments_127425.json:
```json
{
    "body": "The patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.",
    "created_at": "2012-04-18T12:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127425",
    "user": "jdemeyer"
}
```

The patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.



---

archive/issue_comments_127426.json:
```json
{
    "body": "More precisely, the patch [attachment:trac_11599_homset_new_coercion_model.patch] causes the slow-down.",
    "created_at": "2012-04-18T12:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127426",
    "user": "jdemeyer"
}
```

More precisely, the patch [attachment:trac_11599_homset_new_coercion_model.patch] causes the slow-down.



---

archive/issue_comments_127427.json:
```json
{
    "body": "In trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads\n\n```\n        sage: phi == loads(dumps(phi))   # optional - pickling http://trac.sagemath.org/sage_trac/ticket/11599\n```\n\nand now fails if testing is done with the --optional flag.  Should \"optional\" be changed to \"not tested\" here until it is fixed?",
    "created_at": "2012-09-14T11:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127427",
    "user": "cremona"
}
```

In trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads

```
        sage: phi == loads(dumps(phi))   # optional - pickling http://trac.sagemath.org/sage_trac/ticket/11599
```

and now fails if testing is done with the --optional flag.  Should "optional" be changed to "not tested" here until it is fixed?



---

archive/issue_comments_127428.json:
```json
{
    "body": "PS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.",
    "created_at": "2012-09-14T11:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127428",
    "user": "cremona"
}
```

PS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.



---

archive/issue_comments_127429.json:
```json
{
    "body": "Replying to [comment:51 cremona]:\n> Should \"optional\" be changed to \"not tested\" here until it is fixed?\nEven better: \"known bug\", see #14362.",
    "created_at": "2013-03-27T00:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11427#issuecomment-127429",
    "user": "jdemeyer"
}
```

Replying to [comment:51 cremona]:
> Should "optional" be changed to "not tested" here until it is fixed?
Even better: "known bug", see #14362.
