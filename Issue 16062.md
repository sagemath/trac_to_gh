# Issue 16062: upgrade numpy/scipy to 1.8.1 and 0.14

archive/issues_016062.json:
```json
{
    "body": "Upgrade numpy/scipy to latest versions. scipy 0.14 has finally ditched oldnumeric which means it won't generate warnings all over the place. A few doctests will have to be updated.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16299\n\n",
    "created_at": "2014-05-07T01:42:37Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "upgrade numpy/scipy to 1.8.1 and 0.14",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16062",
    "user": "https://github.com/kiwifb"
}
```
Upgrade numpy/scipy to latest versions. scipy 0.14 has finally ditched oldnumeric which means it won't generate warnings all over the place. A few doctests will have to be updated.

Issue created by migration from https://trac.sagemath.org/ticket/16299





---

archive/issue_comments_208849.json:
```json
{
    "body": "OK so it",
    "created_at": "2014-05-09T10:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208849",
    "user": "https://github.com/kiwifb"
}
```

OK so it



---

archive/issue_comments_208850.json:
```json
{
    "body": "Woopsie. Anyway I have updated the checksums and SPKG.txt for numpy and scipy. No changes where necessary to the packages themselves as far as I could tell. I fixed three doctests:\n   * src/sage/functions/exp_integral.py: the last digit of a test changed, I put \"...\" since it is probably a little unstable.\n   * src/sage/numerical/optimize.py: also a numerical precision thing. In this case we ask for a value within 0.0001 tolerance but tests the answer to 16 decimal places. No surprise when we have changes behind the 5th place.\n   * src/sage/modules/vector_double_dense.pyx: a doctest warning has changed code.",
    "created_at": "2014-05-09T11:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208850",
    "user": "https://github.com/kiwifb"
}
```

Woopsie. Anyway I have updated the checksums and SPKG.txt for numpy and scipy. No changes where necessary to the packages themselves as far as I could tell. I fixed three doctests:
   * src/sage/functions/exp_integral.py: the last digit of a test changed, I put "..." since it is probably a little unstable.
   * src/sage/numerical/optimize.py: also a numerical precision thing. In this case we ask for a value within 0.0001 tolerance but tests the answer to 16 decimal places. No surprise when we have changes behind the 5th place.
   * src/sage/modules/vector_double_dense.pyx: a doctest warning has changed code.



---

archive/issue_comments_208851.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-09T11:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208851",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_208852.json:
```json
{
    "body": "I tried out this branch and the new packages with Sage 6.2 on two systems: OX Mavericks and RHEL 6.3 (gcc 4.4).  Both numpy and scipy installed cleanly and the three modified doctests passed on both systems.  Other changes in the patch look fine, so setting status to \"positive review\".",
    "created_at": "2014-05-16T15:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208852",
    "user": "https://github.com/NathanDunfield"
}
```

I tried out this branch and the new packages with Sage 6.2 on two systems: OX Mavericks and RHEL 6.3 (gcc 4.4).  Both numpy and scipy installed cleanly and the three modified doctests passed on both systems.  Other changes in the patch look fine, so setting status to "positive review".



---

archive/issue_comments_208853.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-16T15:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208853",
    "user": "https://github.com/NathanDunfield"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208854.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-21T10:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208854",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_208855.json:
```json
{
    "body": "Breaks doctests on OSX (10.6 and 10.9):\n\n```\nsage -t --long src/sage/tests/french_book/calculus_doctest.py\n**********************************************************************\nFile \"src/sage/tests/french_book/calculus_doctest.py\", line 216, in sage.tests.french_book.calculus_doctest\nFailed example:\n    find_root(expr, 0.1, pi)\nExpected:\n    2.0943951023931957\nGot:\n    2.0943951023931953\n```\n",
    "created_at": "2014-05-21T10:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208855",
    "user": "https://github.com/vbraun"
}
```

Breaks doctests on OSX (10.6 and 10.9):

```
sage -t --long src/sage/tests/french_book/calculus_doctest.py
**********************************************************************
File "src/sage/tests/french_book/calculus_doctest.py", line 216, in sage.tests.french_book.calculus_doctest
Failed example:
    find_root(expr, 0.1, pi)
Expected:
    2.0943951023931957
Got:
    2.0943951023931953
```




---

archive/issue_comments_208856.json:
```json
{
    "body": "OK, will amend that. Any other failures I missed?",
    "created_at": "2014-05-21T10:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208856",
    "user": "https://github.com/kiwifb"
}
```

OK, will amend that. Any other failures I missed?



---

archive/issue_comments_208857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-21T22:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_208858.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-21T22:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208858",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_208859.json:
```json
{
    "body": "OK fixed the doctest and pushed. Ready for another round of review.",
    "created_at": "2014-05-21T22:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208859",
    "user": "https://github.com/kiwifb"
}
```

OK fixed the doctest and pushed. Ready for another round of review.



---

archive/issue_comments_208860.json:
```json
{
    "body": "I don't see any reason why this should give a different result on OSX. Do you?",
    "created_at": "2014-05-21T23:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208860",
    "user": "https://github.com/vbraun"
}
```

I don't see any reason why this should give a different result on OSX. Do you?



---

archive/issue_comments_208861.json:
```json
{
    "body": "Not sure. We are talking about a difference in the 4E-16 which is in the relative tolerance of the function and well within its own tolerance.\n\n```\ndef find_root(f, a, b, xtol=10e-13, rtol=4.5e-16, maxiter=100, full_output=False):\n```\n\nBut I would have been more ready to accept a difference based on CPU arch rather than OS on similar CPU. \n\nLooking at scipy the underlying c code hasn't changed since 2008 but higher up tolerance checking has been enforced in 0.14rc2 (scipy/optimize/zeros.py) that's the only thing I can see having an impact.",
    "created_at": "2014-05-22T00:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208861",
    "user": "https://github.com/kiwifb"
}
```

Not sure. We are talking about a difference in the 4E-16 which is in the relative tolerance of the function and well within its own tolerance.

```
def find_root(f, a, b, xtol=10e-13, rtol=4.5e-16, maxiter=100, full_output=False):
```

But I would have been more ready to accept a difference based on CPU arch rather than OS on similar CPU. 

Looking at scipy the underlying c code hasn't changed since 2008 but higher up tolerance checking has been enforced in 0.14rc2 (scipy/optimize/zeros.py) that's the only thing I can see having an impact.



---

archive/issue_comments_208862.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-22T01:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208862",
    "user": "https://github.com/NathanDunfield"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_208863.json:
```json
{
    "body": "I did a little testing, and definitely the issue is a result of the scipy upgrade and not the numpy one.  It also shows up on OS X version 10.8 as well.  \n\nMy experience is that the last digit in numerics like this can be remarkably sensitive to the OS/CPU/compiler version/phase of the moon.  I once had two Ubuntu 12.04 virtual machines running on the same physical hardware where the last digit differed like this; one had a 32bit kernel and the other a 64bit one, which you wouldn't think would make a difference...\n\nI think this sort of thing is to be expected, and it certainly seems harmless enough in this instance.   So I've changed the status back to \"positive review\".",
    "created_at": "2014-05-22T01:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208863",
    "user": "https://github.com/NathanDunfield"
}
```

I did a little testing, and definitely the issue is a result of the scipy upgrade and not the numpy one.  It also shows up on OS X version 10.8 as well.  

My experience is that the last digit in numerics like this can be remarkably sensitive to the OS/CPU/compiler version/phase of the moon.  I once had two Ubuntu 12.04 virtual machines running on the same physical hardware where the last digit differed like this; one had a 32bit kernel and the other a 64bit one, which you wouldn't think would make a difference...

I think this sort of thing is to be expected, and it certainly seems harmless enough in this instance.   So I've changed the status back to "positive review".



---

archive/issue_comments_208864.json:
```json
{
    "body": "Replying to [comment:15 dunfield]:\n> I did a little testing, and definitely the issue is a result of the scipy upgrade and not the numpy one.  It also shows up on OS X version 10.8 as well.  \n> \n> My experience is that the last digit in numerics like this can be remarkably sensitive to the OS/CPU/compiler version/phase of the moon.  I once had two Ubuntu 12.04 virtual machines running on the same physical hardware where the last digit differed like this; one had a 32bit kernel and the other a 64bit one, which you wouldn't think would make a difference...\n> \n\nOh, yes I would. But then I have seen tickets where that happens in the last 6 years.\n\n> I think this sort of thing is to be expected, and it certainly seems harmless enough in this instance.   So I've changed the status back to \"positive review\".  \n\nIt is technically harmless it is however a curiosity because the change is sudden. If I had time I would check other versions of scipy to narrow down when the change happened and try to understand why.",
    "created_at": "2014-05-22T01:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208864",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:15 dunfield]:
> I did a little testing, and definitely the issue is a result of the scipy upgrade and not the numpy one.  It also shows up on OS X version 10.8 as well.  
> 
> My experience is that the last digit in numerics like this can be remarkably sensitive to the OS/CPU/compiler version/phase of the moon.  I once had two Ubuntu 12.04 virtual machines running on the same physical hardware where the last digit differed like this; one had a 32bit kernel and the other a 64bit one, which you wouldn't think would make a difference...
> 

Oh, yes I would. But then I have seen tickets where that happens in the last 6 years.

> I think this sort of thing is to be expected, and it certainly seems harmless enough in this instance.   So I've changed the status back to "positive review".  

It is technically harmless it is however a curiosity because the change is sudden. If I had time I would check other versions of scipy to narrow down when the change happened and try to understand why.



---

archive/issue_comments_208865.json:
```json
{
    "body": "In the end I spent the time checking [https://github.com/scipy/scipy/commit/8edf03864b7c3e43e652ac154f98e96ee4913687](https://github.com/scipy/scipy/commit/8edf03864b7c3e43e652ac154f98e96ee4913687) and [https://github.com/scipy/scipy/commit/0ee24117ad63399b7a3353269de4e916fe409ad7](https://github.com/scipy/scipy/commit/0ee24117ad63399b7a3353269de4e916fe409ad7) are responsible. I didn't try to pin it on one or the other. So it looks like we approch the root slightly differently between OS X and linux. My guess is that without the enforcement of tolerance OS X would go through one (or) more iteration(s) and end up with the same value as Linux.",
    "created_at": "2014-05-22T02:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208865",
    "user": "https://github.com/kiwifb"
}
```

In the end I spent the time checking [https://github.com/scipy/scipy/commit/8edf03864b7c3e43e652ac154f98e96ee4913687](https://github.com/scipy/scipy/commit/8edf03864b7c3e43e652ac154f98e96ee4913687) and [https://github.com/scipy/scipy/commit/0ee24117ad63399b7a3353269de4e916fe409ad7](https://github.com/scipy/scipy/commit/0ee24117ad63399b7a3353269de4e916fe409ad7) are responsible. I didn't try to pin it on one or the other. So it looks like we approch the root slightly differently between OS X and linux. My guess is that without the enforcement of tolerance OS X would go through one (or) more iteration(s) and end up with the same value as Linux.



---

archive/issue_comments_208866.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-23T11:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16062#issuecomment-208866",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015629.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-23T11:30:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16062",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16062#event-15629"
}
```
