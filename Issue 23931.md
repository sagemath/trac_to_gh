# Issue 23931: Upgrade to Jupyter 5.*

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2017-11-06 21:04:54

CC:  jdemeyer saraedum

Jupyter 5.2.1 is available:

```
sage -pip install notebook==asdfasdf 
Collecting notebook==asdfasdf
  Could not find a version that satisfies the requirement notebook==asdfasdf (from versions: 4.0.0, 4.0.1, 4.0.2, 4.0.4, 4.0.5, 4.0.6, 4.1.0, 4.2.0b1, 4.2.0, 4.2.1, 4.2.2, 4.2.3, 4.3.0, 4.3.1, 4.3.2, 4.4.0, 4.4.1, 5.0.0b1, 5.0.0b2, 5.0.0rc1, 5.0.0rc2, 5.0.0, 5.1.0rc1, 5.1.0rc2, 5.1.0rc3, 5.1.0, 5.2.0rc1, 5.2.0, 5.2.1rc1, 5.2.1)
```

But we are still running 4.3.0:

```
(sage-sh) nthiery`@`mistral:~$ jupyter --version
4.3.0
```



---

Comment by nthiery created at 2017-11-06 21:08:28

Beside manpower, is there any technical issue holding us from upgrading our package?

A small piece of motivation: binder (http://mybinder.org) requires jupyter 5.*; so if we upgrade, our docker image will be directly binder ready; currently in https://github.com/sagemath/sage-binder-env/blob/master/Dockerfile, I force a Jupyter upgrade.


---

Comment by nthiery created at 2017-11-06 21:09:11

Reference: #22432


---

Comment by vbraun created at 2017-11-06 21:15:58

Go for it..


---

Comment by fbissey created at 2017-11-06 21:49:24

I think there is some confusion here. `jupyter --version` returns the version of `jupyter_core` which has a 4.4.0 release in the last 6 days.[https://github.com/jupyter/jupyter_core/releases](https://github.com/jupyter/jupyter_core/releases)

Then there is the notebook, which is what you looked at with the pip command, the last release of that is indeed 5.2.1 [https://github.com/jupyter/notebook/releases](https://github.com/jupyter/notebook/releases) from 3 days ago. sage is at 4.4.1 (sage-on-gentoo is at 5.0.0) so yes we could upgrade that.

Of course jupyter doesn't make it easy for you to figure the version of it components and what goes with what.


---

Comment by jdemeyer created at 2017-11-07 08:50:58

Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.


---

Comment by fbissey created at 2017-11-07 09:12:16

Replying to [comment:5 jdemeyer]:
> Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.

ipython-6 is python3 only. However it looks like looks ipython-5 still gets regular releases for python 2.7.


---

Comment by nthiery created at 2017-11-07 10:27:49

Thanks Fran√ßois for the clarification.

I am on it. I'll use the latest version suggested by pip; pip now knows not to suggest versions that are not compatible with Python's version.

Hopefuly no other dependency than jupyter_core needs to be updated!


---

Comment by nthiery created at 2017-11-07 10:32:59

Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...


```
[I 11:31:18.215 NotebookApp] Creating new notebook in 
[E 11:31:19.356 NotebookApp] Failed to run command:
    [u'/usr/bin/sage', u'--python', u'-m', u'sage.repl.ipython_kernel', u'-f', u'/run/user/1000/jupyter/kernel-bf16b426-18eb-4f1b-80ff-4579ddecf42d.json']
        PATH='/opt/sage-git/build/bin:/opt/sage-git/src/bin:/opt/sage-git/local/bin:/opt/miniconda3/bin:.:/home/nthiery/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/bin/X11:/usr/etc'
        with kwargs:
    {'cwd': u'/home/nthiery/tmp', 'stdin': -1, 'preexec_fn': <function <lambda> at 0x7f9eef435c80>, 'stderr': None, 'stdout': None}
 }}}


---

Comment by nthiery created at 2017-11-07 10:35:10

New commits:


---

Comment by nthiery created at 2017-11-07 10:50:10

****Replying to [comment:8 nthiery]:
> Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...

That was unrelated: I had an old kernelspec from Sage's debian package
which was taking precedence and getting confused because in the mean
time I had uninstalled this package.

Thus I guess it's a needs review.

I am not sure though what's the right way to test this?


---

Comment by nthiery created at 2017-11-07 10:50:26

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-11-07 22:32:48

Replying to [comment:11 nthiery]:
> I am not sure though what's the right way to test this?

Pretty much the only thing to do at this stage is to run ptestlong and then if that pass, wait for people complaining about change of behavior <sup>_</sup>


---

Comment by jdemeyer created at 2017-11-08 12:59:36

Replying to [comment:11 nthiery]:
> ****Replying to [comment:8 nthiery]:
> > Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...
> 
> That was unrelated: I had an old kernelspec from Sage's debian package
> which was taking precedence and getting confused because in the mean
> time I had uninstalled this package.
> 
> Thus I guess it's a needs review.
> 
> I am not sure though what's the right way to test this?

I'll test that it builds properly (I screwed up no less than 2 tickets this way in the latest beta). For that, I'm rebasing on #24088.
----
New commits:


---

Comment by jdemeyer created at 2017-11-10 15:21:30

Builds fine and passes `make ptestlong`. So all that remains is to check that it actually works interactively.


---

Comment by git created at 2017-11-13 13:19:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-11-13 13:19:52

New commits:


---

Comment by jdemeyer created at 2017-11-13 14:13:14

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2017-11-16 10:03:53

Any chance to get this into 8.1 or is it too late?
That would ease deployment of mybinder thingies.


---

Comment by jdemeyer created at 2017-11-16 10:14:09

Replying to [comment:21 jpflori]:
> Any chance to get this into 8.1

-1

Having a working Jupyter is too important to push this now.


---

Comment by vbraun created at 2017-12-11 01:02:57

Resolution: fixed


---

Comment by egourgoulhon created at 2018-01-07 16:06:49

See #24484 for a follow-up (nbconvert broken).
