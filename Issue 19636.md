# Issue 19636: update giac spkg

Issue created by migration from https://trac.sagemath.org/ticket/19873

Original creator: frederichan

Original creation time: 2016-01-12 15:17:12

update the giac spkg to the current upstream stable version: 1.2.2-17

The tarball built from spkg-src to put in upstream/ can be downloaded at

http://webusers2.imj-prg.fr/~frederic.han/xcas/sage/giac-1.2.2.17.tar.gz


---

Comment by frederichan created at 2016-01-12 15:18:15

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by git created at 2016-01-27 10:36:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-01 13:27:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-02-03 09:39:38

Changing status from new to needs_review.


---

Comment by frederichan created at 2016-02-04 11:53:23

Changing status from needs_review to needs_work.


---

Comment by frederichan created at 2016-02-04 11:53:23

I have found that eliminate is slower with this version of giac
http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=3&t=1694
so I put this in needwork state to wait if this can be easily fixed.


---

Comment by git created at 2016-02-07 13:28:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-15 09:32:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-25 09:36:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-25 13:12:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-25 13:18:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-25 13:28:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-27 08:15:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-03-27 10:46:15

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-03-29 20:37:25

I just tried to install the package and ran into

```
$ sage -p giacpy
Found local metadata for giacpy-0.5.3
Using cached file /opt/sage/upstream/giacpy-0.5.3.tar.gz
giacpy-0.5.3
====================================================
Setting up build directory for giacpy-0.5.3
mv: cannot stat 'giacpy-0.5.3*': No such file or directory
Finished set up
****************************************************
```



---

Comment by frederichan created at 2016-03-29 21:57:02

and the built doesn't start after this message?
with 7.1.beta6 I have also this message but the built start. Is it a problem that the tarball giacpy-0.5.3.tar.gz looks like this:

```
tar -tzf giacpy-0.5.3.tar.gz 
src/
src/exemple.sage
src/giacpy.pyx
src/misc.h
src/sage-release.txt
src/README.txt
src/INSTALL.txt
src/setup.py
src/giacpy.pxd
src/keywords.pxi
```



---

Comment by frederichan created at 2016-03-30 05:25:05

with 7.2.beta1 I have doctest failure due to

```
    doctest:858: DeprecationWarning: when constructing a matrix, the ring must be the first argument
    See http://trac.sagemath.org/20015 for details.

```



---

Comment by frederichan created at 2016-03-30 05:25:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-03-31 17:37:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-31 18:30:51

Replying to [comment:23 frederichan]:
> and the built doesn't start after this message?
> with 7.1.beta6 I have also this message but the built start. Is it a problem that the tarball giacpy-0.5.3.tar.gz looks like this:
> {{{
> tar -tzf giacpy-0.5.3.tar.gz 
> src/
> src/exemple.sage
> src/giacpy.pyx
> src/misc.h
> src/sage-release.txt
> src/README.txt
> src/INSTALL.txt
> src/setup.py
> src/giacpy.pxd
> src/keywords.pxi
> }}}

It does. The thing is that the sage install script is starting with the command `tar xf PKG` and then `mv PKG_DIR/ src/`. It would be better if the archive name would take the same name as the directory. It would be less error-prone.


---

Comment by vdelecroix created at 2016-03-31 19:36:08

Following the "Short usage" example on your webpage I got two warnings (sage-7.2.beta1):

```
sage: import giacpy
...: DeprecationWarning: import "cysignals/signals.pxi" instead
of "sage/ext/interrupt.pxi"
See http://trac.sagemath.org/20002 for details.
```

and

```
sage: f.diff()
...: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default
is deprecated: use @default decorator instead.
15*(x+y+z+1)^14
```



---

Comment by frederichan created at 2016-04-01 06:14:48

Replying to [comment:28 vdelecroix]:
> Following the "Short usage" example on your webpage I got two warnings (sage-7.2.beta1):
...
> {{{
> sage: f.diff()
> ...: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default
> is deprecated: use `@`default decorator instead.
> 15*(x+y+z+1)^14
> }}}
I have no idea to fix this warning. It looks similar to #20206. NB it looks to appear only once. (ie doing another f.diff() is OK)


---

Comment by git created at 2016-04-01 08:18:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-04-01 08:19:57

New commits:


---

Comment by frederichan created at 2016-04-01 12:56:15

NB: the current 1.2.2.37 giac tar ball that I have made with spkg-src also expand as src. So I am waiting for 1.2.2.39 release (parisse said next week) to fix this.


---

Comment by vdelecroix created at 2016-04-01 13:46:31

The examples from your webpage in the section " Syntaxes with reserved or unknown Python symbols" do not work. There is no `assume`, `cos`, `sin`, `solve` or `fMax` imported from giacpy

```
sage: from giacpy import *
// Giac share root-directory:/opt/sage/local/share/giac/
// Giac share root-directory:/opt/sage/local/share/giac/
Help file /opt/sage/local/share/giac/doc/fr/aide_cas not found
Added 0 synonyms
sage: solve.__module__
'sage.symbolic.relation'
sage: sin.__module__
'sage.functions.trig'
sage: cos.__module__
'sage.functions.trig'
sage: assume.__module__
'sage.symbolic.assumptions'
```



---

Comment by frederichan created at 2016-04-01 16:42:50

I think that you are looking at the doc of the Python version of giacpy. It differs from the sage version (gmp, avoid conflics with SR...)
Similar doc is available with

```
libgiac?
```



---

Comment by vdelecroix created at 2016-04-01 17:33:29

Changing status from needs_work to positive_review.


---

Comment by vdelecroix created at 2016-04-01 17:33:29

All right. I was able to run the doctests after decompressing the archive

```
$ sage -t --long --force-lib exemple.sage giacpy.pyx
Doctesting 2 files.
sage -t --long exemple.sage
    [0 tests, 0.00 s]
sage -t --long giacpy.pyx
    [221 tests, 23.89 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 24.0 seconds
    cpu time: 24.0 seconds
    cumulative wall time: 23.9 seconds
```

This is good enough for this version...


Though

1. you should think about fitting Sage conventions for doctests:

   - `a = b` instead of `a=b` for affectation

   - no semicolon at the end of the statement

2. The way the two packages are organized do not follow the Sage conventions, see [Packaging from the developer manual](http://doc.sagemath.org/html/en/developer/packaging.html). In particular, it would be good to have a test suite for giac. And to explicit the dependencies of the packages.


---

Comment by frederichan created at 2016-04-02 07:33:47

Replying to [comment:36 vdelecroix]:
> All right. I was able to run the doctests after decompressing the archive
> {{{
> $ sage -t --long --force-lib exemple.sage giacpy.pyx
> Doctesting 2 files.
> sage -t --long exemple.sage
>     [0 tests, 0.00 s]
> sage -t --long giacpy.pyx
>     [221 tests, 23.89 s]
> ----------------------------------------------------------------------
> All tests passed!
> ----------------------------------------------------------------------
> Total time for all tests: 24.0 seconds
>     cpu time: 24.0 seconds
>     cumulative wall time: 23.9 seconds
> }}}
> This is good enough for this version...

Thank you 
> 
> 
> Though
> 
...
> 2. The way the two packages are organized do not follow the Sage conventions, see [Packaging from the developer manual](http://doc.sagemath.org/html/en/developer/packaging.html). In particular, it would be good to have a test suite for giac. And to explicit the dependencies of the packages.
I don't understand,

```
env SAGE_CHECK=yes make giac
```

has a long test suite, and build/pkgs/giac and giacpy have both a dependencies file.

http://git.sagemath.org/sage.git/tree/build/pkgs/giac?id=98506d3754ddb14ca4548d644b2ed6b7a2d2a5d7 

http://git.sagemath.org/sage.git/tree/build/pkgs/giacpy?id=98506d3754ddb14ca4548d644b2ed6b7a2d2a5d7

NB: running the giacpy testsuite is not enough for a review because some sage doctests have the # optional - giac or giacpy flag.

```
src/sage/interfaces/giac.py
src/sage/matrix/matrix1.pyx 
src/sage/modules/free_module_element.pyx 
src/sage/symbolic/expression.pyx 
src/sage/calculus/calculus.py
src/sage/libs/giac.py
src/sage/rings/polynomial/multi_polynomial_ideal.py
```



---

Comment by vbraun created at 2016-04-02 09:59:41

Resolution: fixed
