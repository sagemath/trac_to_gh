# Issue 26959: make sagelib work and doctest even if SAGE_ROOT is None

archive/issues_026959.json:
```json
{
    "body": "This is a push to be able to use and doctest sage without SAGE_ROOT being defined. This is mainly useful for distro or if you import sage from python directly without running sage-env first.\n\n* `sage/misc/persist.pyx` is dealt with in #27192\n* in `sage/misc/citation.pyx` `SAGE_ROOT` is replaced with `\"\"` but for all cases I have seen `SAGE_LIB` would be correct. I have only gone for `SAGE_LOCAL` in case something in `SAGE_LOCAL/bin` needs to be picked up.\n* in `bin/sage-notebook` and `sage/misc/package.py`, `SAGE_ROOT` is imported but not used. So I removed it while I was at it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27196\n\n",
    "created_at": "2019-02-01T01:45:26Z",
    "labels": [
        "distribution",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "make sagelib work and doctest even if SAGE_ROOT is None",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26959",
    "user": "fbissey"
}
```
This is a push to be able to use and doctest sage without SAGE_ROOT being defined. This is mainly useful for distro or if you import sage from python directly without running sage-env first.

* `sage/misc/persist.pyx` is dealt with in #27192
* in `sage/misc/citation.pyx` `SAGE_ROOT` is replaced with `""` but for all cases I have seen `SAGE_LIB` would be correct. I have only gone for `SAGE_LOCAL` in case something in `SAGE_LOCAL/bin` needs to be picked up.
* in `bin/sage-notebook` and `sage/misc/package.py`, `SAGE_ROOT` is imported but not used. So I removed it while I was at it.

Issue created by migration from https://trac.sagemath.org/ticket/27196





---

archive/issue_comments_379329.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-01T01:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379329",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_379330.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-02-01T01:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379330",
    "user": "fbissey"
}
```

New commits:



---

archive/issue_comments_379331.json:
```json
{
    "body": "I don't think that this actually depends on #27192.",
    "created_at": "2019-02-01T16:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379331",
    "user": "jdemeyer"
}
```

I don't think that this actually depends on #27192.



---

archive/issue_comments_379332.json:
```json
{
    "body": "1. For `DOT_GIT`, I would prefer to see that added to `sage/env.py` (maybe rename it to `SAGE_ROOT_GIT`). Note that you'll need to rebase the branch to #27040 then or wait for the next beta. I'm also not convinced that we can rely on the fact that `os.path.isdir(\"\")` returns `False`, I would prefer an explicit check for `None` there.\n\n2. In `src/sage/misc/misc.py`, you can use `sys.executable` instead.",
    "created_at": "2019-02-01T16:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379332",
    "user": "jdemeyer"
}
```

1. For `DOT_GIT`, I would prefer to see that added to `sage/env.py` (maybe rename it to `SAGE_ROOT_GIT`). Note that you'll need to rebase the branch to #27040 then or wait for the next beta. I'm also not convinced that we can rely on the fact that `os.path.isdir("")` returns `False`, I would prefer an explicit check for `None` there.

2. In `src/sage/misc/misc.py`, you can use `sys.executable` instead.



---

archive/issue_comments_379333.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-01T16:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379333",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_379334.json:
```json
{
    "body": "I came to think I wasn't very pythonic as well. I should have used `try:...expect:` blocks instead of conditionals. Before #27040 there was a `SAGE_ROOT_GIT` I guess that would mean restoring it. Should we do that when it is only used in a single file as far as I can tell?",
    "created_at": "2019-02-01T18:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379334",
    "user": "fbissey"
}
```

I came to think I wasn't very pythonic as well. I should have used `try:...expect:` blocks instead of conditionals. Before #27040 there was a `SAGE_ROOT_GIT` I guess that would mean restoring it. Should we do that when it is only used in a single file as far as I can tell?



---

archive/issue_comments_379335.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> Before #27040 there was a `SAGE_ROOT_GIT` I guess that would mean restoring it.\n\nSure. I just removed it because I wasn't used. :-)\n\n> Should we do that when it is only used in a single file as far as I can tell?\n\nSure, why not? It's cleaner that way.",
    "created_at": "2019-02-01T19:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379335",
    "user": "jdemeyer"
}
```

Replying to [comment:5 fbissey]:
> Before #27040 there was a `SAGE_ROOT_GIT` I guess that would mean restoring it.

Sure. I just removed it because I wasn't used. :-)

> Should we do that when it is only used in a single file as far as I can tell?

Sure, why not? It's cleaner that way.



---

archive/issue_comments_379336.json:
```json
{
    "body": "OK, that's a plan. Do you have any comments about `citation.pyx`?",
    "created_at": "2019-02-01T20:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379336",
    "user": "fbissey"
}
```

OK, that's a plan. Do you have any comments about `citation.pyx`?



---

archive/issue_comments_379337.json:
```json
{
    "body": "Replying to [comment:7 fbissey]:\n> Do you have any comments about `citation.pyx`?\n\nNo. I think your changes are OK.",
    "created_at": "2019-02-03T13:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379337",
    "user": "jdemeyer"
}
```

Replying to [comment:7 fbissey]:
> Do you have any comments about `citation.pyx`?

No. I think your changes are OK.



---

archive/issue_comments_379338.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-03T21:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379338",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379339.json:
```json
{
    "body": "OK rebased on new beta and better documented.\n----\nNew commits:",
    "created_at": "2019-02-03T21:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379339",
    "user": "fbissey"
}
```

OK rebased on new beta and better documented.
----
New commits:



---

archive/issue_comments_379340.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-03T21:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379340",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_379341.json:
```json
{
    "body": "This is an odd way to test for `None`:\n\n```\n        try:\n            have_git = os.path.exists(SAGE_ROOT_GIT)\n        except TypeError:\n            have_git\n```\n\nWhat's wrong with\n\n```\n        if SAGE_ROOT_GIT is not None:\n            have_git = os.path.isdir(SAGE_ROOT_GIT)\n        else:\n            have_git = False\n```\n\nor even\n\n```\n        have_git = (SAGE_ROOT_GIT is not None) and os.path.isdir(SAGE_ROOT_GIT)\n```\n",
    "created_at": "2019-02-04T06:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379341",
    "user": "jdemeyer"
}
```

This is an odd way to test for `None`:

```
        try:
            have_git = os.path.exists(SAGE_ROOT_GIT)
        except TypeError:
            have_git
```

What's wrong with

```
        if SAGE_ROOT_GIT is not None:
            have_git = os.path.isdir(SAGE_ROOT_GIT)
        else:
            have_git = False
```

or even

```
        have_git = (SAGE_ROOT_GIT is not None) and os.path.isdir(SAGE_ROOT_GIT)
```




---

archive/issue_comments_379342.json:
```json
{
    "body": "Also little reason to use an extra variable here:\n\n```\n        sage: python_executable = sys.executable\n        sage: sage_makedirs(python_executable)\n```\n\nWhy not\n\n```\n        sage: sage_makedirs(sys.executable)\n```\n",
    "created_at": "2019-02-04T06:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379342",
    "user": "jdemeyer"
}
```

Also little reason to use an extra variable here:

```
        sage: python_executable = sys.executable
        sage: sage_makedirs(python_executable)
```

Why not

```
        sage: sage_makedirs(sys.executable)
```




---

archive/issue_comments_379343.json:
```json
{
    "body": "You may also want to squash your commits for a cleaner history.",
    "created_at": "2019-02-04T06:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379343",
    "user": "jdemeyer"
}
```

You may also want to squash your commits for a cleaner history.



---

archive/issue_comments_379344.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-04T06:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379344",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_379345.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> This is an odd way to test for `None`:\n> {{{\n>         try:\n>             have_git = os.path.exists(SAGE_ROOT_GIT)\n>         except TypeError:\n>             have_git\n> }}}\n> What's wrong with\n> {{{\n>         if SAGE_ROOT_GIT is not None:\n>             have_git = os.path.isdir(SAGE_ROOT_GIT)\n>         else:\n>             have_git = False\n> }}}\n> or even\n> {{{\n>         have_git = (SAGE_ROOT_GIT is not None) and os.path.isdir(SAGE_ROOT_GIT)\n> }}}\n\nWell it seemed to me the pythonic way is `try:... except:` but I won't be religious on that and arguably it is not testing for `None` so yes, I could go back to the way I originally did it.\n\nAs for `python_executable` I'll admit I thought of removing it and ended up going with minimal changes.",
    "created_at": "2019-02-04T06:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379345",
    "user": "fbissey"
}
```

Replying to [comment:12 jdemeyer]:
> This is an odd way to test for `None`:
> {{{
>         try:
>             have_git = os.path.exists(SAGE_ROOT_GIT)
>         except TypeError:
>             have_git
> }}}
> What's wrong with
> {{{
>         if SAGE_ROOT_GIT is not None:
>             have_git = os.path.isdir(SAGE_ROOT_GIT)
>         else:
>             have_git = False
> }}}
> or even
> {{{
>         have_git = (SAGE_ROOT_GIT is not None) and os.path.isdir(SAGE_ROOT_GIT)
> }}}

Well it seemed to me the pythonic way is `try:... except:` but I won't be religious on that and arguably it is not testing for `None` so yes, I could go back to the way I originally did it.

As for `python_executable` I'll admit I thought of removing it and ended up going with minimal changes.



---

archive/issue_comments_379346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-04T08:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379346",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_379347.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-04T08:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379347",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379348.json:
```json
{
    "body": "There, and all squashed.",
    "created_at": "2019-02-04T08:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379348",
    "user": "fbissey"
}
```

There, and all squashed.



---

archive/issue_comments_379349.json:
```json
{
    "body": "Replying to [comment:15 fbissey]:\n> Well it seemed to me the pythonic way is `try:... except:`\n\nI think that mainly applies when the condition is either expensive to check or when the condition might change independently (e.g. checking for existence of a file).",
    "created_at": "2019-02-04T08:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379349",
    "user": "jdemeyer"
}
```

Replying to [comment:15 fbissey]:
> Well it seemed to me the pythonic way is `try:... except:`

I think that mainly applies when the condition is either expensive to check or when the condition might change independently (e.g. checking for existence of a file).



---

archive/issue_comments_379350.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-04T08:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379350",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_379351.json:
```json
{
    "body": "Replying to [comment:17 fbissey]:\n> There, and all squashed.\n\nNo, but it doesn't matter.",
    "created_at": "2019-02-04T08:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379351",
    "user": "jdemeyer"
}
```

Replying to [comment:17 fbissey]:
> There, and all squashed.

No, but it doesn't matter.



---

archive/issue_comments_379352.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Replying to [comment:17 fbissey]:\n> > There, and all squashed.\n> \n> No, but it doesn't matter.\n\nAll right. Give me a pointer to how to squash for next time then.",
    "created_at": "2019-02-04T08:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379352",
    "user": "fbissey"
}
```

Replying to [comment:20 jdemeyer]:
> Replying to [comment:17 fbissey]:
> > There, and all squashed.
> 
> No, but it doesn't matter.

All right. Give me a pointer to how to squash for next time then.



---

archive/issue_comments_379353.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-04T19:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379353",
    "user": "fbissey"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_379354.json:
```json
{
    "body": "#27206 which is  in the process of being merged by Volker interferes with this in `citation.pyx`.",
    "created_at": "2019-02-04T19:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379354",
    "user": "fbissey"
}
```

#27206 which is  in the process of being merged by Volker interferes with this in `citation.pyx`.



---

archive/issue_comments_379355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-06T10:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379355",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379356.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-06T10:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379356",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379357.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-06T10:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379357",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379358.json:
```json
{
    "body": "Merged with #27206 and squashed. I added one tiny additional commit, please review.",
    "created_at": "2019-02-06T10:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379358",
    "user": "jdemeyer"
}
```

Merged with #27206 and squashed. I added one tiny additional commit, please review.



---

archive/issue_comments_379359.json:
```json
{
    "body": "Cool, that means I won't have to do it tomorrow :) your comment is more comprehensive. I guess `isdir` is a more precise test as well. Someone could have fun creating a file `SAGE_ROOT/.git` and see what breaks.",
    "created_at": "2019-02-06T10:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379359",
    "user": "fbissey"
}
```

Cool, that means I won't have to do it tomorrow :) your comment is more comprehensive. I guess `isdir` is a more precise test as well. Someone could have fun creating a file `SAGE_ROOT/.git` and see what breaks.



---

archive/issue_comments_379360.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-06T10:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379360",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_379361.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-07T18:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379361",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_379362.json:
```json
{
    "body": "There is a syntax error in env.py, obviousy none of you never tried it...",
    "created_at": "2019-02-07T18:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379362",
    "user": "vbraun"
}
```

There is a syntax error in env.py, obviousy none of you never tried it...



---

archive/issue_comments_379363.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> There is a syntax error in env.py, obviousy none of you never tried it...\n\nGot it. Well, not in that form.",
    "created_at": "2019-02-07T18:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379363",
    "user": "fbissey"
}
```

Replying to [comment:28 vbraun]:
> There is a syntax error in env.py, obviousy none of you never tried it...

Got it. Well, not in that form.



---

archive/issue_comments_379364.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> There is a syntax error in env.py, obviousy none of you never tried it...\n\nGood point, this has never actually worked.",
    "created_at": "2019-02-07T21:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379364",
    "user": "jdemeyer"
}
```

Replying to [comment:28 vbraun]:
> There is a syntax error in env.py, obviousy none of you never tried it...

Good point, this has never actually worked.



---

archive/issue_comments_379365.json:
```json
{
    "body": "This version has been properly doctested.\n----\nNew commits:",
    "created_at": "2019-02-09T22:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379365",
    "user": "fbissey"
}
```

This version has been properly doctested.
----
New commits:



---

archive/issue_comments_379366.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-09T22:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379366",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379367.json:
```json
{
    "body": "I get a doctest failure in `src/sage/misc/inline_fortran.py`:\n\n```\nFailed example:\n    os.getcwd() == DOT_SAGE\nExpected:\n    True\nGot:\n    False\n```\n\nThe issue is that there is a trailing slash in `DOT_SAGE` but not in `os.getcwd()`. Does this come from `src/bin/sage-env`?\n\n```\n    # In theory, DOT_SAGE is not required to have a trailing slash.\n    # But since there are some issues (#11924, maybe #12221),\n    # we add a slash for safety.\n    DOT_SAGE=\"${DOT_SAGE}/\"\n    export DOT_SAGE\n```\n",
    "created_at": "2019-02-10T01:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379367",
    "user": "jhpalmieri"
}
```

I get a doctest failure in `src/sage/misc/inline_fortran.py`:

```
Failed example:
    os.getcwd() == DOT_SAGE
Expected:
    True
Got:
    False
```

The issue is that there is a trailing slash in `DOT_SAGE` but not in `os.getcwd()`. Does this come from `src/bin/sage-env`?

```
    # In theory, DOT_SAGE is not required to have a trailing slash.
    # But since there are some issues (#11924, maybe #12221),
    # we add a slash for safety.
    DOT_SAGE="${DOT_SAGE}/"
    export DOT_SAGE
```




---

archive/issue_comments_379368.json:
```json
{
    "body": "Replying to [comment:32 jhpalmieri]:\n> I get a doctest failure in `src/sage/misc/inline_fortran.py`:\n> {{{\n> Failed example:\n>     os.getcwd() == DOT_SAGE\n> Expected:\n>     True\n> Got:\n>     False\n> }}}\n> The issue is that there is a trailing slash in `DOT_SAGE` but not in `os.getcwd()`. Does this come from `src/bin/sage-env`?\n\nMust be. `env.py`'s default doesn't have one and my own sage-on-gentoo `sage-env` defines `DOT_SAGE` without a trailing slash.\n\n> {{{\n>     # In theory, DOT_SAGE is not required to have a trailing slash.\n>     # But since there are some issues (#11924, maybe #12221),\n>     # we add a slash for safety.\n>     DOT_SAGE=\"${DOT_SAGE}/\"\n>     export DOT_SAGE\n> }}}\n\nI think both issues are totally irrelevant now because of other changes. Although I will study #12221 because I have a issue with pari's testsuite in Gentoo's portage that may be totally related.\n\nIn this particular case I guess we need to make sure to \"normalize\" the path tested so it doesn't end up with a slash. Is there a python function for that?",
    "created_at": "2019-02-10T01:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379368",
    "user": "fbissey"
}
```

Replying to [comment:32 jhpalmieri]:
> I get a doctest failure in `src/sage/misc/inline_fortran.py`:
> {{{
> Failed example:
>     os.getcwd() == DOT_SAGE
> Expected:
>     True
> Got:
>     False
> }}}
> The issue is that there is a trailing slash in `DOT_SAGE` but not in `os.getcwd()`. Does this come from `src/bin/sage-env`?

Must be. `env.py`'s default doesn't have one and my own sage-on-gentoo `sage-env` defines `DOT_SAGE` without a trailing slash.

> {{{
>     # In theory, DOT_SAGE is not required to have a trailing slash.
>     # But since there are some issues (#11924, maybe #12221),
>     # we add a slash for safety.
>     DOT_SAGE="${DOT_SAGE}/"
>     export DOT_SAGE
> }}}

I think both issues are totally irrelevant now because of other changes. Although I will study #12221 because I have a issue with pari's testsuite in Gentoo's portage that may be totally related.

In this particular case I guess we need to make sure to "normalize" the path tested so it doesn't end up with a slash. Is there a python function for that?



---

archive/issue_comments_379369.json:
```json
{
    "body": "Would using `os.getcwd() ==  os.path.normpath(DOT_SAGE)` (provided the right imports before hand) instead work?",
    "created_at": "2019-02-10T02:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379369",
    "user": "fbissey"
}
```

Would using `os.getcwd() ==  os.path.normpath(DOT_SAGE)` (provided the right imports before hand) instead work?



---

archive/issue_comments_379370.json:
```json
{
    "body": "OK `normpath` works. `samefile` would be nice but is not available on windows apparently, so that could cause trouble on cygwin. \n\nExtra question: what should we do about that difference between `sage-env` and `env.py`? Should we have trailing `/` at all?",
    "created_at": "2019-02-10T05:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379370",
    "user": "fbissey"
}
```

OK `normpath` works. `samefile` would be nice but is not available on windows apparently, so that could cause trouble on cygwin. 

Extra question: what should we do about that difference between `sage-env` and `env.py`? Should we have trailing `/` at all?



---

archive/issue_comments_379371.json:
```json
{
    "body": "I don't understand the comment in `sage-env` about #11924, since that ticket was explicitly trying to set things up so a trailing backslash would not be necessary. For this ticket I would just use `os.path.normpath`, but we should also (probably on a different ticket) try removing the trailing slash. I don't know the relationship between `src/sage/env.py` and `src/bin/sage-env`: do we need to deal with `DOT_SAGE` in `sage-env` if we set it in `env.py`?",
    "created_at": "2019-02-10T05:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379371",
    "user": "jhpalmieri"
}
```

I don't understand the comment in `sage-env` about #11924, since that ticket was explicitly trying to set things up so a trailing backslash would not be necessary. For this ticket I would just use `os.path.normpath`, but we should also (probably on a different ticket) try removing the trailing slash. I don't know the relationship between `src/sage/env.py` and `src/bin/sage-env`: do we need to deal with `DOT_SAGE` in `sage-env` if we set it in `env.py`?



---

archive/issue_comments_379372.json:
```json
{
    "body": "All right, a very good question. \n\n* `sage-env` contains many things and does overlaps with `env.py`\n* `env.py` has default values for most variables but those default will be overridden if the variable is already defined in the running environment - by `sage-env` for example.\n* `sage-env` is loaded by the `sage` start up script. Depending on the arguments it may actually start other scripts rather than sage itself. Those scripts may need environment variables to be set (look at `sage-cython`, `sage-ipynb2rst` ...).\n* `env.py` has default that means sage will start if you load it directly from python. With this ticket and a few others, it will just work even if no environment variables are loaded from `sage-env` before hand. Except for `sage/misc/copying.py` (which isn't doctested).\n\nNow, a lot of the stuff in `sage-env` is about the building of sage. Some other stuff is about the self containment of sage. For example, sage change the default ipython folder to `.sage/ipython` so there is no interference with a system package. This is of course moot for sage-on-distro. Finally there is stuff that is really for running sage and that is mostly redundant with `env.py`.\n\nFinally I should plug myself [https://groups.google.com/forum/#!topic/sage-packaging/X-cMW8fFfso](https://groups.google.com/forum/#!topic/sage-packaging/X-cMW8fFfso). Note that I still have `DOT_SAGE` in `sage-env` because of some scripts called from the sage starting shell script (`sage-cleaner` and `sage-runtests` being the most concerning).",
    "created_at": "2019-02-10T06:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379372",
    "user": "fbissey"
}
```

All right, a very good question. 

* `sage-env` contains many things and does overlaps with `env.py`
* `env.py` has default values for most variables but those default will be overridden if the variable is already defined in the running environment - by `sage-env` for example.
* `sage-env` is loaded by the `sage` start up script. Depending on the arguments it may actually start other scripts rather than sage itself. Those scripts may need environment variables to be set (look at `sage-cython`, `sage-ipynb2rst` ...).
* `env.py` has default that means sage will start if you load it directly from python. With this ticket and a few others, it will just work even if no environment variables are loaded from `sage-env` before hand. Except for `sage/misc/copying.py` (which isn't doctested).

Now, a lot of the stuff in `sage-env` is about the building of sage. Some other stuff is about the self containment of sage. For example, sage change the default ipython folder to `.sage/ipython` so there is no interference with a system package. This is of course moot for sage-on-distro. Finally there is stuff that is really for running sage and that is mostly redundant with `env.py`.

Finally I should plug myself [https://groups.google.com/forum/#!topic/sage-packaging/X-cMW8fFfso](https://groups.google.com/forum/#!topic/sage-packaging/X-cMW8fFfso). Note that I still have `DOT_SAGE` in `sage-env` because of some scripts called from the sage starting shell script (`sage-cleaner` and `sage-runtests` being the most concerning).



---

archive/issue_comments_379373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-10T20:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379373",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_379374.json:
```json
{
    "body": "OK fixed that doctest.",
    "created_at": "2019-02-10T20:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379374",
    "user": "fbissey"
}
```

OK fixed that doctest.



---

archive/issue_comments_379375.json:
```json
{
    "body": "I agree with that last change.",
    "created_at": "2019-02-10T20:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379375",
    "user": "jdemeyer"
}
```

I agree with that last change.



---

archive/issue_comments_379376.json:
```json
{
    "body": "Let's wait for the patchbot before setting to positive review :-)",
    "created_at": "2019-02-10T20:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379376",
    "user": "jdemeyer"
}
```

Let's wait for the patchbot before setting to positive review :-)



---

archive/issue_comments_379377.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-11T22:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379377",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_379378.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-13T20:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26959#issuecomment-379378",
    "user": "vbraun"
}
```

Resolution: fixed
