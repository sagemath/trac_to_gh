# Issue 24466: SIGABRT on i686 involving polybori and strings

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-02-10 11:32:21

CC:  fbissey embray




---

Attachment


---

Comment by fbissey created at 2018-02-12 10:03:12

Yup, pretty much anything that use C++ has to be rebuilt when you move to gcc-5. gcc dev have made some commitments to ABI stability for the time being. But then you also have the change of ABI for gfortran at gcc-7. The only thing that's rock solid for almost ever is C.


---

Comment by git created at 2018-02-14 11:30:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-02-14 11:32:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-02-14 12:44:57

Changing status from new to needs_review.


---

Comment by fbissey created at 2018-02-18 21:15:38

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2018-02-18 21:15:38

Not sure why the patchbot is failing but the stuff looks good me, and we should include it ASAP.


---

Comment by embray created at 2018-02-19 16:40:33

Replying to [comment:13 fbissey]:
> Not sure why the patchbot is failing but the stuff looks good me, and we should include it ASAP.

I need to upgrade that patchbot.  It's running an old version of the patchbot package that has a bug when testing "unsafe" tickets.


---

Comment by embray created at 2018-02-19 16:43:01

Okay, I don't really care since I'm not in the habit of building gcc anyways, but I would appreciate if someone sign off on #21524 so I don't have to keep upgrading it to incorporate changes like this.


---

Comment by vbraun created at 2018-02-20 23:08:27

Resolution: fixed


---

Comment by vbraun created at 2018-02-28 07:50:10

Changing status from closed to new.


---

Comment by vbraun created at 2018-02-28 07:50:10

Resolution changed from fixed to 


---

Comment by vbraun created at 2018-02-28 07:50:10

Breaks full build on Debian 7 (both 32 and 64 bit)

PPL: 

```
configure: error: Cannot find GMP version 4.1.3 or higher.
GMP is the GNU Multi-Precision library:
see http://www.swox.com/gmp/ for more information.
When compiling the GMP library, do not forget to enable the C++ interface:
add --enable-cxx to the configuration options.
Error configuring the Parma Polyhedra Library.
```


Givaro:

```
checking for GMP library... yes
checking gmpxx.h usability... no
checking gmpxx.h presence... no
checking for gmpxx.h... no
your GMP does not have c++ support. Compile GMP with --enable-cxx
********************************************************************************
Error configuring givaro-4.0.4
********************************************************************************
```



---

Comment by jdemeyer created at 2018-02-28 08:38:27

Do you happen to have the `install.log` file?


---

Comment by jdemeyer created at 2018-02-28 13:28:15

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-02-28 13:28:15

Reverted this:

```diff
--- a/build/pkgs/gcc/spkg-install
+++ b/build/pkgs/gcc/spkg-install
`@``@` -124,7 +124,7 `@``@` $MAKE install
 
 # Mark gfortran as not installed in case gfortran was installed earlier
 cd "$SAGE_SPKG_INST"
-rm -f gmp-* mpir-* mpfr-* mpc-* gfortran-*
+rm -f gfortran-*
 
 # Force re-configuration: the next time that "make" is run, we need to
 # rebuild all packages (#24703) but we should not rebuild gcc (#19324)
```

----
New commits:


---

Comment by jdemeyer created at 2018-02-28 13:28:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-28 22:53:09

Resolution: fixed


---

Comment by vbraun created at 2018-03-01 23:10:36

Resolution changed from fixed to 


---

Comment by vbraun created at 2018-03-01 23:10:36

Changing status from closed to new.


---

Comment by vbraun created at 2018-03-01 23:10:36

http://build.sagemath.org/#/builders/30/builds/6/steps/6/logs/matplotlib

Building matplotlib still fails on Debian 7 64-bit with 

```
    gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib__image_ARRAY_API -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -D__STDC_FORMAT_MACROS=1 -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/home/buildbot/slave/sage_git/build/local/include -I. -Iextern/agg24-svn/include -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -c src/py_converters.cpp -o build/temp.linux-x86_64-2.7/src/py_converters.o
    In file included from /home/buildbot/slave/sage_git/build/local/include/python2.7/Python.h:19:0,
                     from src/py_converters.h:16,
                     from src/py_converters.cpp:3:
    /usr/include/limits.h:125:26: error: no include path in which to search for limits.h
     # include_next <limits.h>
                              ^
    In file included from src/py_converters.h:16:0,
                     from src/py_converters.cpp:3:
    /home/buildbot/slave/sage_git/build/local/include/python2.7/Python.h:22:2: error: #error "Something's broken.  UCHAR_MAX should be defined in limits.h."
     #error "Something's broken.  UCHAR_MAX should be defined in limits.h."
```



---

Comment by jdemeyer created at 2018-03-02 09:01:01

I don't see how that error is related to this ticket.


---

Comment by vbraun created at 2018-03-02 10:49:32

Apparently the build was interleaved with gcc, which shouldn't happen. This also happens after backing out the ticket so its either a preexisting issue or the makefile isn't regenerated. This is the second build of gcc, it builds in parallel with everything else.


---

Comment by jdemeyer created at 2018-03-02 12:36:51

Replying to [comment:26 vbraun]:
> This also happens after backing out the ticket

I think it's a bug in the _previous_ version of this ticket then.

> This is the second build of gcc

There shouldn't be a second build of gcc.

It would be very useful to see the auto-generated `build/make/Makefile` from the failed build to understand what is happening.


---

Comment by jdemeyer created at 2018-03-02 12:36:51

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-03-02 12:36:56

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by vbraun created at 2018-03-02 13:56:04

I attached the makefile...


---

Comment by vbraun created at 2018-03-02 14:42:00

I checked out just this ticket and ran `make distclean && make` and gcc builds twice

```
buildbot`@`sagebd07_64s02:~/slave/sage_git/build$ grep 'Found local metadata for gcc' logs/install.log 
[gcc-7.2.0] Found local metadata for gcc-7.2.0
[gcc-7.2.0] Found local metadata for gcc-7.2.0
```

and the second time is in parallel with lots of other stuff...


---

Comment by jdemeyer created at 2018-03-02 19:35:36

OK, I think I know what happened: there is indeed a serious bug that GCC is installed twice.

But that bug is not because of this ticket, it is most likely happening since #24599. I think you are just unlucky to hit this bug now and not before.


---

Comment by jdemeyer created at 2018-03-02 19:37:14

I would rather prefer to merge this ticket anyway and then deal with further fixes to the GCC build process in a future ticket.


---

Comment by vbraun created at 2018-03-02 22:04:21

Sure, did you open a followup ticket?


---

Comment by vbraun created at 2018-03-02 22:05:56

New commits:


---

Comment by vbraun created at 2018-03-02 22:06:53

New commits:


---

Comment by vbraun created at 2018-03-02 22:07:32

Resolution: fixed


---

Comment by jhpalmieri created at 2018-03-12 23:42:07

A question related to #24961: should we be checking that `x$SAGE_INSTALL_GCC = xexists` or that `x$SAGE_INSTALL_GCC = xyes`? On an OS X machine, I have Sage's gcc installed (from a few betas ago), but now Sage uses clang instead of gcc, so Sage's gcc will not be rebuilt as I upgraded Sage.


---

Comment by fbissey created at 2018-03-13 00:02:02

Replying to [comment:37 jhpalmieri]:
> A question related to #24961: should we be checking that `x$SAGE_INSTALL_GCC = xexists` or that `x$SAGE_INSTALL_GCC = xyes`? On an OS X machine, I have Sage's gcc installed (from a few betas ago), but now Sage uses clang instead of gcc, so Sage's gcc will not be rebuilt as I upgraded Sage.

Really, you need to check both, with the caveat that if you installed with clang and want to switch to gcc you will break your install. So, unfortunately, a not so stupid user could break things.


---

Comment by jhpalmieri created at 2018-03-13 02:24:43

In my case, I switched from gcc (the default) to clang (the new default), and upgrading to the most recent beta broke things, because this test ended up adding bad stuff to `build/make/Makefile`, as reported in sage-release and #21524, and now being fixed in #24961.


---

Comment by jdemeyer created at 2018-03-13 09:02:07

Replying to [comment:39 jhpalmieri]:
> In my case, I switched from gcc (the default) to clang (the new default)

Are you sure? If the GCC spkg is installed, it should be used by Sage. If this is not the case, I consider that a bug.


---

Comment by jdemeyer created at 2018-03-13 09:04:41

Replying to [comment:38 fbissey]:
> Replying to [comment:37 jhpalmieri]:
> > A question related to #24961: should we be checking that `x$SAGE_INSTALL_GCC = xexists` or that `x$SAGE_INSTALL_GCC = xyes`? On an OS X machine, I have Sage's gcc installed (from a few betas ago), but now Sage uses clang instead of gcc, so Sage's gcc will not be rebuilt as I upgraded Sage.
> 
> Really, you need to check both

I don't see why, but maybe I'm missing something?


---

Comment by jhpalmieri created at 2018-03-13 14:45:26

Replying to [comment:40 jdemeyer]:
> Replying to [comment:39 jhpalmieri]:
> > In my case, I switched from gcc (the default) to clang (the new default)
> 
> Are you sure? If the GCC spkg is installed, it should be used by Sage. If this is not the case, I consider that a bug.

I guess you're right, gcc is used, but `configure` tells me that `gcc` will not be installed.


---

Comment by jdemeyer created at 2018-03-13 14:51:36

Replying to [comment:42 jhpalmieri]:
> `configure` tells me that `gcc` will not be installed.

It won't be installed if it's already installed. Consider that a feature.


---

Comment by jhpalmieri created at 2018-03-13 15:02:21

I also consider it a feature if it's not installed because clang is going to be used instead. `configure` does not give a reason for it not being installed, leaving me to guess as to what's going on.


---

Comment by jdemeyer created at 2018-03-13 15:05:08

Replying to [comment:44 jhpalmieri]:
> I also consider it a feature if it's not installed because clang is going to be used instead.

Of course. But that should work now, right?
