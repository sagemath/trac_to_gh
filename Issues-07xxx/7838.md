# Issue 7838: Remove script using ctypes from ATLAS

archive/issues_007838.json:
```json
{
    "body": "#1497 added a few lines of code \n\n```/usr/bin/env\nimport ctypes\nprint str(8*ctypes.sizeof(ctypes.c_long))\n```\ninto the ATLAS build process, which reports the number of bits Sage was compiled as. It makes use of the module 'ctypes' in Python, but \n\nhttp://docs.activestate.com/activepython/2.5/whatsincluded.html\n\nshows that ctypes is seriosuly broken on many platforms, including\n\n* Older linux-x86 build failures\n* aix-powerpc build failures\n* linux-ia64 build failures\n* solaris-sparc build failures\n* solaris-x86 build failures\n* hpux-parisc libffi not ported to PA-RISC arch\n* hpux-ia64 build failures\n* win64\n\nHence the code needs replacing with something less broken\n\nDave \n\nAssignee: GeorgSWeber\n\nCC:  @jaapspies vengoroso@gmail.com\n\nKeywords: ctypes atlas\n\nReviewer: Jaap Spies\n\nAuthor: David Kirkby\n\nMerged: sage-4.3.1.rc0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/7838\n\n",
    "closed_at": "2010-01-14T02:35:54Z",
    "created_at": "2010-01-04T03:07:50Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.1",
    "title": "Remove script using ctypes from ATLAS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7838",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
#1497 added a few lines of code 

```/usr/bin/env
import ctypes
print str(8*ctypes.sizeof(ctypes.c_long))
```
into the ATLAS build process, which reports the number of bits Sage was compiled as. It makes use of the module 'ctypes' in Python, but 

http://docs.activestate.com/activepython/2.5/whatsincluded.html

shows that ctypes is seriosuly broken on many platforms, including

* Older linux-x86 build failures
* aix-powerpc build failures
* linux-ia64 build failures
* solaris-sparc build failures
* solaris-x86 build failures
* hpux-parisc libffi not ported to PA-RISC arch
* hpux-ia64 build failures
* win64

Hence the code needs replacing with something less broken

Dave 

Assignee: GeorgSWeber

CC:  @jaapspies vengoroso@gmail.com

Keywords: ctypes atlas

Reviewer: Jaap Spies

Author: David Kirkby

Merged: sage-4.3.1.rc0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/7838





---

archive/issue_comments_070170.json:
```json
{
    "body": "Changing keywords from \"\" to \"ctypes atlas\".",
    "created_at": "2010-01-04T03:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70170",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing keywords from "" to "ctypes atlas".



---

archive/issue_comments_070171.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n \n http://docs.activestate.com/activepython/2.5/whatsincluded.html\n \n-shows that ctypes is seriouly on many platforms, including\n+shows that ctypes is seriosuly broken on many platforms, including\n \n * Older linux-x86 - build failures\n * aix-powerpc\tbuild failures\n@@ -21,7 +21,7 @@\n \n Hence the code needs replacing with something less broken\n \n-Dave\n+Dave \n \n Comment: 1\n \n```\n",
    "created_at": "2010-01-04T03:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70171",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Description changed:
```diff
--- 
+++ 
@@ -8,7 +8,7 @@
 
 http://docs.activestate.com/activepython/2.5/whatsincluded.html
 
-shows that ctypes is seriouly on many platforms, including
+shows that ctypes is seriosuly broken on many platforms, including
 
 * Older linux-x86 - build failures
 * aix-powerpc	build failures
@@ -21,7 +21,7 @@
 
 Hence the code needs replacing with something less broken
 
-Dave
+Dave 
 
 Comment: 1
 
```




---

archive/issue_comments_070172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-05T00:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70172",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_070173.json:
```json
{
    "body": "<a id='comment:3'></a>See: \n\nhttp://boxen.math.washington.edu/home/kirkby/portability/atlas-3.8.3.p10/\n\nfor an updated version of ATLAS which fixes this issue. bitwidth.py has been changed. \n\nThe 4/5 lines of code I used were posted on sage-devel by  vengoroso`@`gmail.com but I don't know his fully name, so can't give full credit. Please let us know your full name! \n\nNote however, for me at least, ATLAS does not build fully, but at least it gets further than it did on Open Solaris. \n\nDave",
    "created_at": "2010-01-05T00:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70173",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:3'></a>See: 

http://boxen.math.washington.edu/home/kirkby/portability/atlas-3.8.3.p10/

for an updated version of ATLAS which fixes this issue. bitwidth.py has been changed. 

The 4/5 lines of code I used were posted on sage-devel by  vengoroso`@`gmail.com but I don't know his fully name, so can't give full credit. Please let us know your full name! 

Note however, for me at least, ATLAS does not build fully, but at least it gets further than it did on Open Solaris. 

Dave



---

archive/issue_comments_070174.json:
```json
{
    "body": "<a id='comment:4'></a>The fix looks good.\n\nMy setup is clearly not ok. The build failed at the end:\n\n```\nATLAS install complete.  Examine \nATLAS/bin/<arch>/INSTALL_LOG/SUMMARY.LOG for details.\nmake[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'\nmake clean\nmake[1]: Entering directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'\nrm -f *.o x* config?.out *core*\nmake[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'\nFinished building ATLAS core\nThe Makefile generated in ATLAS for building shared libraries\nassumes the linker is the GNU linker, which it not true in\nyour setup. (It is generally considered better to use the\nSun linker in /usr/ccs/bin rather than the GNU linker from binutils)\nThe linker flags in /export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib/Makefile will be changed. \n'-shared' will be changed to '-G'\n'-soname' will be changed to '-h'\n'--whole-archive' will be changed to '-zallextract'\n'--no-whole-archive' will be changed to '-zdefaultextract'\nA copy of the original Makefile will be copied to Makefile.orig\nrm -f libatlas.so liblapack.so\nmake libatlas.so liblapack.so libf77blas.so libcblas.so liblapack.so\nmake[1]: Entering directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib'\nld -melf_x86_64 -G -h libatlas.so -o libatlas.so \\\n        -z allextract libatlas.a -z defaultextract -lc -lm\nld: warning: file libatlas.a(ATL_flushcache.o): wrong ELF class: ELFCLASS64\nld: fatal: entry point symbol `lf_x86_64' is undefined\nmake[1]: *** [libatlas.so] Error 1\nmake[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib'\nmake: *** [shared] Error 2\nBuilding shared ATLAS libraries failed\nFailed to build ATLAS.\n\nreal\t155m22.653s\nuser\t147m22.502s\nsys\t6m4.162s\nsage: An error occurred while installing atlas-3.8.3.p10\n\n```\n\nMaybe I should use gcc gcc-4.4.2 with the gnu loader?\n\nJaap",
    "created_at": "2010-01-05T14:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70174",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:4'></a>The fix looks good.

My setup is clearly not ok. The build failed at the end:

```
ATLAS install complete.  Examine 
ATLAS/bin/<arch>/INSTALL_LOG/SUMMARY.LOG for details.
make[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'
make clean
make[1]: Entering directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'
rm -f *.o x* config?.out *core*
make[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build'
Finished building ATLAS core
The Makefile generated in ATLAS for building shared libraries
assumes the linker is the GNU linker, which it not true in
your setup. (It is generally considered better to use the
Sun linker in /usr/ccs/bin rather than the GNU linker from binutils)
The linker flags in /export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib/Makefile will be changed. 
'-shared' will be changed to '-G'
'-soname' will be changed to '-h'
'--whole-archive' will be changed to '-zallextract'
'--no-whole-archive' will be changed to '-zdefaultextract'
A copy of the original Makefile will be copied to Makefile.orig
rm -f libatlas.so liblapack.so
make libatlas.so liblapack.so libf77blas.so libcblas.so liblapack.so
make[1]: Entering directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib'
ld -melf_x86_64 -G -h libatlas.so -o libatlas.so \
        -z allextract libatlas.a -z defaultextract -lc -lm
ld: warning: file libatlas.a(ATL_flushcache.o): wrong ELF class: ELFCLASS64
ld: fatal: entry point symbol `lf_x86_64' is undefined
make[1]: *** [libatlas.so] Error 1
make[1]: Leaving directory `/export/home/jaap/Downloads/sage-4.3.1.alpha0/spkg/build/atlas-3.8.3.p10/ATLAS-build/lib'
make: *** [shared] Error 2
Building shared ATLAS libraries failed
Failed to build ATLAS.

real	155m22.653s
user	147m22.502s
sys	6m4.162s
sage: An error occurred while installing atlas-3.8.3.p10

```

Maybe I should use gcc gcc-4.4.2 with the gnu loader?

Jaap



---

archive/issue_comments_070175.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\nJavier Lopez\n to wstein\n\t\nshow details 4:39 AM (1 hour ago)\n\t\nHi William,\n\nreply here since I've got no trac account. My full name is Javier\nL\u00f3pez Pe\u00f1a, but no credit is needed for such a small contribution.\n\nCheers\nJ\n```",
    "created_at": "2010-01-05T14:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70175",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
```
Javier Lopez
 to wstein
	
show details 4:39 AM (1 hour ago)
	
Hi William,

reply here since I've got no trac account. My full name is Javier
López Peña, but no credit is needed for such a small contribution.

Cheers
J
```



---

archive/issue_comments_070176.json:
```json
{
    "body": "<a id='comment:6'></a>The patch works ok. Positive review.\n\nRemoved cwitty from the cc list.\n\nAnd Javier from the authors list (see comment above).\n\nJaap",
    "created_at": "2010-01-12T14:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70176",
    "user": "https://github.com/jaapspies"
}
```

<a id='comment:6'></a>The patch works ok. Positive review.

Removed cwitty from the cc list.

And Javier from the authors list (see comment above).

Jaap



---

archive/issue_comments_070177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-12T14:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70177",
    "user": "https://github.com/jaapspies"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_018748.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-14T02:35:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7838#event-18748"
}
```



---

archive/issue_comments_070178.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-14T02:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70178",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_comments_070179.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+#1497 added a few lines of code \n \n+```/usr/bin/env\n+import ctypes\n+print str(8*ctypes.sizeof(ctypes.c_long))\n+```\n+into the ATLAS build process, which reports the number of bits Sage was compiled as. It makes use of the module 'ctypes' in Python, but \n+\n+http://docs.activestate.com/activepython/2.5/whatsincluded.html\n+\n+shows that ctypes is seriosuly broken on many platforms, including\n+\n+* Older linux-x86 build failures\n+* aix-powerpc build failures\n+* linux-ia64 build failures\n+* solaris-sparc build failures\n+* solaris-x86 build failures\n+* hpux-parisc libffi not ported to PA-RISC arch\n+* hpux-ia64 build failures\n+* win64\n+\n+Hence the code needs replacing with something less broken\n+\n+Dave \n \n Comment: 1\n \n```\n",
    "created_at": "2015-09-06T16:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7838",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7838#issuecomment-70179",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,27 @@
+#1497 added a few lines of code 
 
+```/usr/bin/env
+import ctypes
+print str(8*ctypes.sizeof(ctypes.c_long))
+```
+into the ATLAS build process, which reports the number of bits Sage was compiled as. It makes use of the module 'ctypes' in Python, but 
+
+http://docs.activestate.com/activepython/2.5/whatsincluded.html
+
+shows that ctypes is seriosuly broken on many platforms, including
+
+* Older linux-x86 build failures
+* aix-powerpc build failures
+* linux-ia64 build failures
+* solaris-sparc build failures
+* solaris-x86 build failures
+* hpux-parisc libffi not ported to PA-RISC arch
+* hpux-ia64 build failures
+* win64
+
+Hence the code needs replacing with something less broken
+
+Dave 
 
 Comment: 1
 
```

