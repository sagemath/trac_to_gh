# Issue 7130: libpng 1.2.35 always builds 32-bit libraries on Solaris.

archive/issues_007130.json:
```json
{
    "assignees": [],
    "body": "Using\n* A Sun Blade 2000 running Solaris 10 update 7\n* Sage 4.1.2.rc0\n* gcc 4.4.1\n* SAGE64 exported to \"yes\"\n\nWe can see that libpng is building 32-bit libraries, despite other packages are building 64-bit libraries. \n\n```\nlibpng12.so:    ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped\nlibpng12.so.0:  ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped\nlibpng12.so.0.35.0:     ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped\nlibreadline.a:  current ar archive, not a dynamic executable or shared object\nlibreadline.so: ELF 64-bit MSB dynamic lib SPARCV9 Version 1, dynamically linked, not stripped\nlibreadline.so.6:       ELF 64-bit MSB dynamic lib SPARCV9 Version 1, dynamically linked, not stripped\n```\n\nOther packages building 32-bit libraries, even when SAGE64 is set to  yes include, but are probably not limited to. \n* zlib #7128\n* libgpg_error #7129\n\nI will sort this package out after creating a new sage-env, which exports all the variables properly, including the flag for building 64-bit code, which is not always -m64.\n\nAlthough there is no support for AIX or HP-UX in Sage yet, we could potentially add it - I personally own machines running AIX and HP-UX.\n\nIBM's compiler on AIX uses -q64, and HP's on HP-UX uses +DD64.\n\nThe sensible way to resolve this is to add the correct flag on every platform. \n\nCC:  @jaapspies\n\nAuthor: **David Kirkby**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7130_\n\n",
    "closed_at": "2010-06-19T13:17:43Z",
    "created_at": "2009-10-05T23:21:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20solaris",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.4.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "libpng 1.2.35 always builds 32-bit libraries on Solaris.",
    "type": "issue",
    "updated_at": "2010-06-19T13:17:43Z",
    "url": "https://github.com/sagemath/sage/issues/7130",
    "user": "https://github.com/sagetrac-drkirkby"
}
```
Using
* A Sun Blade 2000 running Solaris 10 update 7
* Sage 4.1.2.rc0
* gcc 4.4.1
* SAGE64 exported to "yes"

We can see that libpng is building 32-bit libraries, despite other packages are building 64-bit libraries. 

```
libpng12.so:    ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped
libpng12.so.0:  ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped
libpng12.so.0.35.0:     ELF 32-bit MSB dynamic lib SPARC32PLUS Version 1, V8+ Required, dynamically linked, not stripped
libreadline.a:  current ar archive, not a dynamic executable or shared object
libreadline.so: ELF 64-bit MSB dynamic lib SPARCV9 Version 1, dynamically linked, not stripped
libreadline.so.6:       ELF 64-bit MSB dynamic lib SPARCV9 Version 1, dynamically linked, not stripped
```

Other packages building 32-bit libraries, even when SAGE64 is set to  yes include, but are probably not limited to. 
* zlib #7128
* libgpg_error #7129

I will sort this package out after creating a new sage-env, which exports all the variables properly, including the flag for building 64-bit code, which is not always -m64.

Although there is no support for AIX or HP-UX in Sage yet, we could potentially add it - I personally own machines running AIX and HP-UX.

IBM's compiler on AIX uses -q64, and HP's on HP-UX uses +DD64.

The sensible way to resolve this is to add the correct flag on every platform. 

CC:  @jaapspies

Author: **David Kirkby**

_Issue created by migration from https://trac.sagemath.org/ticket/7130_





---

archive/issue_events_078730.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:21:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "milestone_number": null,
    "milestone_title": "sage-4.4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78730"
}
```



---

archive/issue_events_078731.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:21:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78731"
}
```



---

archive/issue_events_078732.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:21:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78732"
}
```



---

archive/issue_events_078733.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:21:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78733"
}
```



---

archive/issue_events_078734.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:28:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78734"
}
```



---

archive/issue_events_078735.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2009-10-05T23:28:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20solaris",
    "label_color": "000080",
    "label_name": "component: porting: solaris",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78735"
}
```



---

archive/issue_events_078736.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-01-02T21:38:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78736"
}
```



---

archive/issue_comments_052914.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis is a quick hack, to get this to build only with only gcc and perhaps Sun Studio, as they both take -m64. A more portable solution, which will work for any compiler will be implemented later. \n\nhttp://boxen.math.washington.edu/home/kirkby/portability/libpng-1.2.35.p0/\n\ndave",
    "created_at": "2010-01-02T21:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7130#issuecomment-52914",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:2'>Comment 2:</a>
This is a quick hack, to get this to build only with only gcc and perhaps Sun Studio, as they both take -m64. A more portable solution, which will work for any compiler will be implemented later. 

http://boxen.math.washington.edu/home/kirkby/portability/libpng-1.2.35.p0/

dave



---

archive/issue_comments_052915.json:
```json
{
    "body": "Author: **David Kirkby**",
    "created_at": "2010-01-02T21:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7130#issuecomment-52915",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Author: **David Kirkby**



---

archive/issue_comments_052916.json:
```json
{
    "body": "Attachment: **[libpng.patch.gz](https://github.com/sagemath/sage/files/ticket7130/libpng.patch.gz)**",
    "created_at": "2010-01-28T15:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7130#issuecomment-52916",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

Attachment: **[libpng.patch.gz](https://github.com/sagemath/sage/files/ticket7130/libpng.patch.gz)**



---

archive/issue_events_078737.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-06-19T13:17:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78737"
}
```



---

archive/issue_events_078738.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-06-19T13:17:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7130#event-78738"
}
```



---

archive/issue_comments_052917.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThis can be closed. The latest version of libpng (libpng-1.2.35.p2) in Sage builds fine without problems. I don't know what ticket number fixed it, but these two log entries \n\n\n```\nchangeset:   13:ae01944f408c\nuser:        Jaap Spies <jaapspies@gmail.com>\ndate:        Thu Feb 04 19:32:51 2010 +0100\nsummary:     Corrected stupid typo I thought I had corrected earlier.\n\nchangeset:   12:329a8eb6dd2e\nuser:        Jaap Spies <jaapspies@gmail.com>\ndate:        Wed Feb 03 19:09:41 2010 +0100\nsummary:     Let SAGE64=yes work not only on OSX, but also on Open Solaris and possibly on other platform\n```\n\nAs such, this can be closed as \"fixed\"",
    "created_at": "2010-06-19T13:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7130#issuecomment-52917",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:3'>Comment 3:</a>
This can be closed. The latest version of libpng (libpng-1.2.35.p2) in Sage builds fine without problems. I don't know what ticket number fixed it, but these two log entries 


```
changeset:   13:ae01944f408c
user:        Jaap Spies <jaapspies@gmail.com>
date:        Thu Feb 04 19:32:51 2010 +0100
summary:     Corrected stupid typo I thought I had corrected earlier.

changeset:   12:329a8eb6dd2e
user:        Jaap Spies <jaapspies@gmail.com>
date:        Wed Feb 03 19:09:41 2010 +0100
summary:     Let SAGE64=yes work not only on OSX, but also on Open Solaris and possibly on other platform
```

As such, this can be closed as "fixed"
