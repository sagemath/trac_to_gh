# Issue 7719: Improvements to complex AGM

archive/issues_007719.json:
```json
{
    "assignees": [],
    "body": "This is related to #6021 but also of independent interest.\n\nAs of 4.3 we use pari to compute the complex agm (i.e. a.agm(b) where a, b are complex).  Now the complex agm is multi-valued, and for the application to periods of elliptic curves it does matter which value is used (see upcoming paper by John Cremona and Thotsaphon Thongjunthug).  The pari-computed value is not this \"optimal\" value.  So I have implemented a native Sage version, replacing the existing code in sage/rings/complex_number.pyx.\n\nMuch to my surprise, the new code is in some cases 50 times faster than calling the pari library -- despite the fact that I have not yet cython-optimised the code!\n\n```\nsage: CC = ComplexField(200)\nsage: a = CC(-0.95,-0.65)                \nsage: b = CC(0.683,0.747)                \nsage: %timeit t = a.agm(b, algorithm=\"pari\")\n100 loops, best of 3: 7.04 ms per loop\nsage:  %timeit t = a.agm(b, algorithm=\"principal\")\n10000 loops, best of 3: 136 mus per loop\nsage:  %timeit t = a.agm(b, algorithm=\"optimal\")  \n10000 loops, best of 3: 146 mus per loop\n```\nHere \"mus\" means microseconds (this was run on a computer for which displaying greek \"mu\" causes an error).  \"pari\" is the old way calling the pari library function;  \"principal\" is a native implementation of essentially the same; \"optimal\" is the native implementation returning the so-called optimal value.\n\nSome details:  AGM(a,b) is the common limit of two sequences `a_n,b_n` under the iteration `(a,b) -> ((a+b)/2, sqrt(a*b))` and the issue is which square root to take.  The complete story is a wonderful but quite long one (which started with Gauss).  Essentially, the \"principal\" algorithm always takes the principal branch of the square root (with positive real part);  pari does the same after an initial step where AGM(a,b) is replaced by a*AGM(1/b/a);  the optimal sequence (which gives the largest limit) is the one for which the sign is always chosen so that sqrt(a*b) is closest to (a+b)/2.  Note that the optimal sequence is preserved under scaling, so gives AGM(z*a,z*b)=z*AGM(a,b), but this is not true of the principal sequence.\n\nI have a patch, but before posting it I'll ask for some help optimising it cythonically.\n\n**Assignee:** @aghitza\n\n**CC:**  @robertwb\n\n**Keywords:** complex agm\n\n**Author:** John Cremona, Robert Bradshaw\n\n**Reviewer:** Robert Bradshaw, John Cremona\n\n**Merged:** sage-4.3.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/7719\n\n",
    "closed_at": "2010-01-22T20:15:55Z",
    "created_at": "2009-12-17T10:29:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improvements to complex AGM",
    "type": "issue",
    "updated_at": "2010-01-22T20:15:55Z",
    "url": "https://github.com/sagemath/sage/issues/7719",
    "user": "https://github.com/JohnCremona"
}
```
This is related to #6021 but also of independent interest.

As of 4.3 we use pari to compute the complex agm (i.e. a.agm(b) where a, b are complex).  Now the complex agm is multi-valued, and for the application to periods of elliptic curves it does matter which value is used (see upcoming paper by John Cremona and Thotsaphon Thongjunthug).  The pari-computed value is not this "optimal" value.  So I have implemented a native Sage version, replacing the existing code in sage/rings/complex_number.pyx.

Much to my surprise, the new code is in some cases 50 times faster than calling the pari library -- despite the fact that I have not yet cython-optimised the code!

```
sage: CC = ComplexField(200)
sage: a = CC(-0.95,-0.65)                
sage: b = CC(0.683,0.747)                
sage: %timeit t = a.agm(b, algorithm="pari")
100 loops, best of 3: 7.04 ms per loop
sage:  %timeit t = a.agm(b, algorithm="principal")
10000 loops, best of 3: 136 mus per loop
sage:  %timeit t = a.agm(b, algorithm="optimal")  
10000 loops, best of 3: 146 mus per loop
```
Here "mus" means microseconds (this was run on a computer for which displaying greek "mu" causes an error).  "pari" is the old way calling the pari library function;  "principal" is a native implementation of essentially the same; "optimal" is the native implementation returning the so-called optimal value.

Some details:  AGM(a,b) is the common limit of two sequences `a_n,b_n` under the iteration `(a,b) -> ((a+b)/2, sqrt(a*b))` and the issue is which square root to take.  The complete story is a wonderful but quite long one (which started with Gauss).  Essentially, the "principal" algorithm always takes the principal branch of the square root (with positive real part);  pari does the same after an initial step where AGM(a,b) is replaced by a*AGM(1/b/a);  the optimal sequence (which gives the largest limit) is the one for which the sign is always chosen so that sqrt(a*b) is closest to (a+b)/2.  Note that the optimal sequence is preserved under scaling, so gives AGM(z*a,z*b)=z*AGM(a,b), but this is not true of the principal sequence.

I have a patch, but before posting it I'll ask for some help optimising it cythonically.

**Assignee:** @aghitza

**CC:**  @robertwb

**Keywords:** complex agm

**Author:** John Cremona, Robert Bradshaw

**Reviewer:** Robert Bradshaw, John Cremona

**Merged:** sage-4.3.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/7719





---

archive/issue_events_079699.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-17T10:29:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79699"
}
```



---

archive/issue_events_079700.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-17T10:29:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
    "label_color": "08517b",
    "label_name": "component: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79700"
}
```



---

archive/issue_events_079701.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-17T10:29:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79701"
}
```



---

archive/issue_comments_059557.json:
```json
{
    "body": "**Attachment:** [trac_7719-agm.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-agm.patch.gz)\n\nApplies to 4.3.rc0.  Preliminary version",
    "created_at": "2009-12-17T11:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59557",
    "user": "https://github.com/JohnCremona"
}
```

**Attachment:** [trac_7719-agm.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-agm.patch.gz)

Applies to 4.3.rc0.  Preliminary version



---

archive/issue_comments_059558.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe first patch is not yet ready for review (there are some doctest failures in from elliptic curve period computations which will be fixed later).  I have put it here so that I can ask for help making the code more efficient as it's in a cython file, if possible.",
    "created_at": "2009-12-17T11:53:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59558",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
The first patch is not yet ready for review (there are some doctest failures in from elliptic curve period computations which will be fixed later).  I have put it here so that I can ask for help making the code more efficient as it's in a cython file, if possible.



---

archive/issue_comments_059559.json:
```json
{
    "body": "<a id='comment:2'></a>\nWatch out.  The following is a much more accurate reflection of how fast PARI is at this computation (and even then there is still a tiny bit of overhead):\n\n```\nsage: timeit('pari(\"agm(-0.95-0.65*I,0.683+0.747*I)\")')\n625 loops, best of 3: 33.2 \u00b5s per loop\n```\nversus\n\n```\nsage: CC = ComplexField(200)\nsage: a = CC(-0.95,-0.65)                \nsage: b = CC(0.683,0.747) \nsage: z = pari(a)\nsage: timeit('z.agm(b)')\n625 loops, best of 3: 309 \u00b5s per loop\n```\n\nTo avoid overhead from caching:\n\n```\nsage: time z = pari(\"for(i=1,10^5,agm(-0.95-I*0.65,0.683+I*0.747))\")\nCPU times: user 2.49 s, sys: 0.00 s, total: 2.49 s\nWall time: 2.49 s\n```\nwhich is about 25 microseconds. \n\nConclusions:\n\n  (1) How did you come up with an algorithm=\"pari\" that takes 7ms?  That's really long.\n\n  (2) What we do in Sage should hopefully take at most 25 microseconds in just order to be competitive to PARI. \n\nHere's some more to worry about.  Magma evidently does not even have a *complex* AGM.  However, it has a real AGM, and it is an order of magnitude faster than PARI's:\n\n```\nage: time z = pari(\"for(i=1,10^5,agm(-0.95,0.683))\")\nCPU times: user 2.07 s, sys: 0.00 s, total: 2.07 s\nWall time: 2.07 s\nsage: magma.eval(\"time for n in [1..10^5] do z := AGM(0.95,0.683); end for;\")\n'Time: 0.170'\nsage: 2.07/0.170\n12.1764705882353\n```",
    "created_at": "2009-12-18T05:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59559",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
Watch out.  The following is a much more accurate reflection of how fast PARI is at this computation (and even then there is still a tiny bit of overhead):

```
sage: timeit('pari("agm(-0.95-0.65*I,0.683+0.747*I)")')
625 loops, best of 3: 33.2 µs per loop
```
versus

```
sage: CC = ComplexField(200)
sage: a = CC(-0.95,-0.65)                
sage: b = CC(0.683,0.747) 
sage: z = pari(a)
sage: timeit('z.agm(b)')
625 loops, best of 3: 309 µs per loop
```

To avoid overhead from caching:

```
sage: time z = pari("for(i=1,10^5,agm(-0.95-I*0.65,0.683+I*0.747))")
CPU times: user 2.49 s, sys: 0.00 s, total: 2.49 s
Wall time: 2.49 s
```
which is about 25 microseconds. 

Conclusions:

  (1) How did you come up with an algorithm="pari" that takes 7ms?  That's really long.

  (2) What we do in Sage should hopefully take at most 25 microseconds in just order to be competitive to PARI. 

Here's some more to worry about.  Magma evidently does not even have a *complex* AGM.  However, it has a real AGM, and it is an order of magnitude faster than PARI's:

```
age: time z = pari("for(i=1,10^5,agm(-0.95,0.683))")
CPU times: user 2.07 s, sys: 0.00 s, total: 2.07 s
Wall time: 2.07 s
sage: magma.eval("time for n in [1..10^5] do z := AGM(0.95,0.683); end for;")
'Time: 0.170'
sage: 2.07/0.170
12.1764705882353
```



---

archive/issue_comments_059560.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@williamstein](#comment%3A2):\n> Watch out.  The following is a much more accurate reflection of how fast PARI is at this computation (and even then there is still a tiny bit of overhead):\n> \n> ```\n> sage: timeit('pari(\"agm(-0.95-0.65*I,0.683+0.747*I)\")')\n> 625 loops, best of 3: 33.2 \u00b5s per loop\n> ```\n> versus\n> \n> ```\n> sage: CC = ComplexField(200)\n> sage: a = CC(-0.95,-0.65)                \n> sage: b = CC(0.683,0.747) \n> sage: z = pari(a)\n> sage: timeit('z.agm(b)')\n> 625 loops, best of 3: 309 \u00b5s per loop\n> ```\n\nIf you instead do timeit('a.agm(b)') you'll see a vast slow-down.   So the difference in speed is mainly coming from conversion to pari.  That is still worth avoiding if we can write a fast native version.\n\n> \n> To avoid overhead from caching:\n> \n> ```\n> sage: time z = pari(\"for(i=1,10^5,agm(-0.95-I*0.65,0.683+I*0.747))\")\n> CPU times: user 2.49 s, sys: 0.00 s, total: 2.49 s\n> Wall time: 2.49 s\n> ```\n> which is about 25 microseconds. \n> \n> Conclusions:\n> \n>   (1) How did you come up with an algorithm=\"pari\" that takes 7ms?  That's really long.\n\nI didn't come up with anything!  That code just calls the version of agm we have in Sage already which is two lines, calling pari after conversion.\n\n> \n>   (2) What we do in Sage should hopefully take at most 25 microseconds in just order to be competitive to PARI. \n\nAgreed.  But as I said on sage-devel, what's very important for me is to get the correct (\"optimal\") value of the function.  I hope that will not mean having two versions of the function, one very fast but producing a value which is useless for me (as with the existing pari function) and a slower one I actually use.\n\nBy the way, this is not likely to be a function which is called many times over and over.\n\n> \n> Here's some more to worry about.  Magma evidently does not even have a *complex* AGM.  However, it has a real AGM, and it is an order of magnitude faster than PARI's:\n> \n> ```\n> age: time z = pari(\"for(i=1,10^5,agm(-0.95,0.683))\")\n> CPU times: user 2.07 s, sys: 0.00 s, total: 2.07 s\n> Wall time: 2.07 s\n> sage: magma.eval(\"time for n in [1..10^5] do z := AGM(0.95,0.683); end for;\")\n> 'Time: 0.170'\n> sage: 2.07/0.170\n> 12.1764705882353\n> ```\n> \n\nGood point -- that's what we have to try to beat/match!",
    "created_at": "2009-12-18T09:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59560",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Replying to [@williamstein](#comment%3A2):
> Watch out.  The following is a much more accurate reflection of how fast PARI is at this computation (and even then there is still a tiny bit of overhead):
> 
> ```
> sage: timeit('pari("agm(-0.95-0.65*I,0.683+0.747*I)")')
> 625 loops, best of 3: 33.2 µs per loop
> ```
> versus
> 
> ```
> sage: CC = ComplexField(200)
> sage: a = CC(-0.95,-0.65)                
> sage: b = CC(0.683,0.747) 
> sage: z = pari(a)
> sage: timeit('z.agm(b)')
> 625 loops, best of 3: 309 µs per loop
> ```

If you instead do timeit('a.agm(b)') you'll see a vast slow-down.   So the difference in speed is mainly coming from conversion to pari.  That is still worth avoiding if we can write a fast native version.

> 
> To avoid overhead from caching:
> 
> ```
> sage: time z = pari("for(i=1,10^5,agm(-0.95-I*0.65,0.683+I*0.747))")
> CPU times: user 2.49 s, sys: 0.00 s, total: 2.49 s
> Wall time: 2.49 s
> ```
> which is about 25 microseconds. 
> 
> Conclusions:
> 
>   (1) How did you come up with an algorithm="pari" that takes 7ms?  That's really long.

I didn't come up with anything!  That code just calls the version of agm we have in Sage already which is two lines, calling pari after conversion.

> 
>   (2) What we do in Sage should hopefully take at most 25 microseconds in just order to be competitive to PARI. 

Agreed.  But as I said on sage-devel, what's very important for me is to get the correct ("optimal") value of the function.  I hope that will not mean having two versions of the function, one very fast but producing a value which is useless for me (as with the existing pari function) and a slower one I actually use.

By the way, this is not likely to be a function which is called many times over and over.

> 
> Here's some more to worry about.  Magma evidently does not even have a *complex* AGM.  However, it has a real AGM, and it is an order of magnitude faster than PARI's:
> 
> ```
> age: time z = pari("for(i=1,10^5,agm(-0.95,0.683))")
> CPU times: user 2.07 s, sys: 0.00 s, total: 2.07 s
> Wall time: 2.07 s
> sage: magma.eval("time for n in [1..10^5] do z := AGM(0.95,0.683); end for;")
> 'Time: 0.170'
> sage: 2.07/0.170
> 12.1764705882353
> ```
> 

Good point -- that's what we have to try to beat/match!



---

archive/issue_comments_059561.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'm not so sure switching the default from principle to optimal is the best thing to do, at least not without further investigation/justification.",
    "created_at": "2009-12-18T21:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59561",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'></a>
I'm not so sure switching the default from principle to optimal is the best thing to do, at least not without further investigation/justification.



---

archive/issue_comments_059562.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@robertwb](#comment%3A4):\n\nI don't mind, as long as I can use the optimal one.  There's nowhere in Sage where the other version is used (except places in alliptic_curves/period_lattice.py where the optimal version `_should_` be used).",
    "created_at": "2009-12-18T21:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59562",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Replying to [@robertwb](#comment%3A4):

I don't mind, as long as I can use the optimal one.  There's nowhere in Sage where the other version is used (except places in alliptic_curves/period_lattice.py where the optimal version `_should_` be used).



---

archive/issue_comments_059563.json:
```json
{
    "body": "<a id='comment:7'></a>\nThat justification to switch is fine for me (I just wanted to raise the issue). \n\nOn another note, see #7739",
    "created_at": "2009-12-19T00:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59563",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
That justification to switch is fine for me (I just wanted to raise the issue). 

On another note, see #7739



---

archive/issue_comments_059564.json:
```json
{
    "body": "**Attachment:** [7719-agm-optimize.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-agm-optimize.patch.gz)",
    "created_at": "2009-12-19T09:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59564",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [7719-agm-optimize.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-agm-optimize.patch.gz)



---

archive/issue_comments_059565.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe speed disparity between AGM over CC and over CDF was bugging me, so I decided to code the arbitrary-precision case directly against mpfr tonight. Made me wish we had mpc ;), or even better if sage/cython could unroll CC arithmetic like this already (though there are several other optimizations)\n\nIn any case, now we have\n\n```\nsage: a = CC(-0.95,-0.65)\nsage: b = CC(0.683,0.747)\nsage: %timeit a.agm(b, algorithm=\"optimal\")\n10000 loops, best of 3: 37.9 \u00b5s per loop\nsage: %timeit aa.agm(bb)\n10000 loops, best of 3: 35.2 \u00b5s per loop\n```\n\nThe difference may be due to pari's stack-based rather than heap-based memory management. Note, we're getting closer to optimal with this algorithm as good chunk of the time is due to just taking the square roots:\n\n```\nsage: %timeit [a.sqrt() for k in range(6)]\n10000 loops, best of 3: 25.9 \u00b5s per loop\n```",
    "created_at": "2009-12-19T09:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59565",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>
The speed disparity between AGM over CC and over CDF was bugging me, so I decided to code the arbitrary-precision case directly against mpfr tonight. Made me wish we had mpc ;), or even better if sage/cython could unroll CC arithmetic like this already (though there are several other optimizations)

In any case, now we have

```
sage: a = CC(-0.95,-0.65)
sage: b = CC(0.683,0.747)
sage: %timeit a.agm(b, algorithm="optimal")
10000 loops, best of 3: 37.9 µs per loop
sage: %timeit aa.agm(bb)
10000 loops, best of 3: 35.2 µs per loop
```

The difference may be due to pari's stack-based rather than heap-based memory management. Note, we're getting closer to optimal with this algorithm as good chunk of the time is due to just taking the square roots:

```
sage: %timeit [a.sqrt() for k in range(6)]
10000 loops, best of 3: 25.9 µs per loop
```



---

archive/issue_comments_059566.json:
```json
{
    "body": "<a id='comment:9'></a>\nFantastic piece of work!  I am so pleased that I asked for help doing this -- the results are even better than I hoped.   Later today I'll do a proper review.  Thanks, Robert.",
    "created_at": "2009-12-19T09:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59566",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
Fantastic piece of work!  I am so pleased that I asked for help doing this -- the results are even better than I hoped.   Later today I'll do a proper review.  Thanks, Robert.



---

archive/issue_events_079702.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-19T12:52:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79702"
}
```



---

archive/issue_comments_059567.json:
```json
{
    "body": "**Author:** John Cremona, Robert Bradshaw",
    "created_at": "2009-12-19T12:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59567",
    "user": "https://github.com/JohnCremona"
}
```

**Author:** John Cremona, Robert Bradshaw



---

archive/issue_comments_059568.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw, John Cremona",
    "created_at": "2009-12-19T12:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59568",
    "user": "https://github.com/JohnCremona"
}
```

**Reviewer:** Robert Bradshaw, John Cremona



---

archive/issue_comments_059569.json:
```json
{
    "body": "<a id='comment:10'></a>\nRobert: in line 1508 you set required_prec to self.prec -2.  In my code I used the precision-2 when testing relative error based on nothing more than trial and error (this way it converged while with the same precision it did not), since I am hopeless at working this kind of thing out properly.\n\nBefore merging this, I'll need to fix some doctests in the elliptic curve code -- but before that there's some more work to be done, since the new cmp_abs() does not work on my 32-bit machine (and my 64-bit machine has crashed...):\n\n```\nsage -t  \"devel/sage-cagm/sage/rings/complex_number.pyx\"    \n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2190:\n    sage: cmp_abs(CC(5), CC(1))\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2192:\n    sage: cmp_abs(CC(5), CC(4))\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2194:\n    sage: cmp_abs(CC(5), CC(5))\nExpected:\n    0\nGot:\n    -1\n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2200:\n    sage: cmp_abs(CC(-100), CC(1))\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2202:\n    sage: cmp_abs(CC(-100), CC(100))\nExpected:\n    0\nGot:\n    -1\n**********************************************************************\nFile \"/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx\", line 2206:\n    sage: cmp_abs(CC(1,1), CC(1))\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\n1 items had failures:\n   6 of  19 in __main__.example_79\n***Test Failed*** 6 failures.\n```",
    "created_at": "2009-12-19T12:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59569",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
Robert: in line 1508 you set required_prec to self.prec -2.  In my code I used the precision-2 when testing relative error based on nothing more than trial and error (this way it converged while with the same precision it did not), since I am hopeless at working this kind of thing out properly.

Before merging this, I'll need to fix some doctests in the elliptic curve code -- but before that there's some more work to be done, since the new cmp_abs() does not work on my 32-bit machine (and my 64-bit machine has crashed...):

```
sage -t  "devel/sage-cagm/sage/rings/complex_number.pyx"    
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2190:
    sage: cmp_abs(CC(5), CC(1))
Expected:
    1
Got:
    -1
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2192:
    sage: cmp_abs(CC(5), CC(4))
Expected:
    1
Got:
    -1
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2194:
    sage: cmp_abs(CC(5), CC(5))
Expected:
    0
Got:
    -1
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2200:
    sage: cmp_abs(CC(-100), CC(1))
Expected:
    1
Got:
    -1
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2202:
    sage: cmp_abs(CC(-100), CC(100))
Expected:
    0
Got:
    -1
**********************************************************************
File "/home/john/sage-4.3.rc0/devel/sage-cagm/sage/rings/complex_number.pyx", line 2206:
    sage: cmp_abs(CC(1,1), CC(1))
Expected:
    1
Got:
    -1
**********************************************************************
1 items had failures:
   6 of  19 in __main__.example_79
***Test Failed*** 6 failures.
```



---

archive/issue_comments_059570.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe failures comes from line 2225 where b.__im is used instead of b.__re .\n\nThere is also a problem line 1513 where we should test for [ComplexNumber](../wiki/ComplexNumber) instead of real.",
    "created_at": "2009-12-19T14:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59570",
    "user": "https://github.com/sagetrac-ylchapuy"
}
```

<a id='comment:11'></a>
The failures comes from line 2225 where b.__im is used instead of b.__re .

There is also a problem line 1513 where we should test for [ComplexNumber](../wiki/ComplexNumber) instead of real.



---

archive/issue_comments_059571.json:
```json
{
    "body": "<a id='comment:12'></a>\nWell spotted -- I will fix those two things in a 3rd patch, and at the same time fix the related doctest issues.  Later today.\n\nSounds like ylchapuy will be needed for a final review of this one -- thanks.",
    "created_at": "2009-12-19T14:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59571",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:12'></a>
Well spotted -- I will fix those two things in a 3rd patch, and at the same time fix the related doctest issues.  Later today.

Sounds like ylchapuy will be needed for a final review of this one -- thanks.



---

archive/issue_comments_059572.json:
```json
{
    "body": "**Attachment:** [trac_7719-bugfix.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-bugfix.patch.gz)\n\nReplaces previous patch",
    "created_at": "2009-12-19T18:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59572",
    "user": "https://github.com/JohnCremona"
}
```

**Attachment:** [trac_7719-bugfix.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-bugfix.patch.gz)

Replaces previous patch



---

archive/issue_events_079703.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-19T18:56:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79703"
}
```



---

archive/issue_events_079704.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-12-19T18:56:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79704"
}
```



---

archive/issue_comments_059573.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis was harder than expected.  After applying the two changes suggested by ylchapuy I found that the code looped on some inputs (e.g. the new test, which arose from testing period_lattice.py).  This led to finding some other bugs in that cmp_abs function (in cases where a or b is zero only), and after fixing that I found that the max_exp function returns something like -2^31 when z=0 which then causes overflow (and the infinite loop) when the difference d is exactly 0 in the agm code (which does happen).  Hence the extra test for that condition (which seemed simpler than changing max_exp).\n\nSome minor doctest fixes in the elliptic_curve directory  were needed (all numerical fuzz).\n\nThe bugfix patch also contains Robert's original changes (sorry) and then my actual bugfixes, so only the first and third should be applied.\n\nAnyone else like to review this?  Otherwise I'll OK Robert's code (as adjusted here), but someone needs to check (I did check on 64-bit as well as 32-bit).",
    "created_at": "2009-12-19T18:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59573",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
This was harder than expected.  After applying the two changes suggested by ylchapuy I found that the code looped on some inputs (e.g. the new test, which arose from testing period_lattice.py).  This led to finding some other bugs in that cmp_abs function (in cases where a or b is zero only), and after fixing that I found that the max_exp function returns something like -2^31 when z=0 which then causes overflow (and the infinite loop) when the difference d is exactly 0 in the agm code (which does happen).  Hence the extra test for that condition (which seemed simpler than changing max_exp).

Some minor doctest fixes in the elliptic_curve directory  were needed (all numerical fuzz).

The bugfix patch also contains Robert's original changes (sorry) and then my actual bugfixes, so only the first and third should be applied.

Anyone else like to review this?  Otherwise I'll OK Robert's code (as adjusted here), but someone needs to check (I did check on 64-bit as well as 32-bit).



---

archive/issue_comments_059574.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks. Sorry my code had so many issues--I wrote it pretty quickly and should have tested it more, but wanted to get what I had up. I'll take a look again.",
    "created_at": "2009-12-19T19:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59574",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:14'></a>
Thanks. Sorry my code had so many issues--I wrote it pretty quickly and should have tested it more, but wanted to get what I had up. I'll take a look again.



---

archive/issue_comments_059575.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@robertwb](#comment%3A14):\n> Thanks. Sorry my code had so many issues--I wrote it pretty quickly and should have tested it more, but wanted to get what I had up. I'll take a look again. \n\nNo apology needed.  This way I read it a lot more carefully than I might have done if everything had worked!",
    "created_at": "2009-12-19T21:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59575",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>
Replying to [@robertwb](#comment%3A14):
> Thanks. Sorry my code had so many issues--I wrote it pretty quickly and should have tested it more, but wanted to get what I had up. I'll take a look again. 

No apology needed.  This way I read it a lot more carefully than I might have done if everything had worked!



---

archive/issue_comments_059576.json:
```json
{
    "body": "<a id='comment:16'></a>\nI found another case where it enters into an infinite loop. It's just messy when the required precision is so close to the rounding error, and we're doing many real operations here. Other than that, positive review to the changes you made. \n\nThe solution, it seems, is to require at least half the desired precision on the penultimate iteration. Patch coming up.",
    "created_at": "2009-12-19T21:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59576",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:16'></a>
I found another case where it enters into an infinite loop. It's just messy when the required precision is so close to the rounding error, and we're doing many real operations here. Other than that, positive review to the changes you made. 

The solution, it seems, is to require at least half the desired precision on the penultimate iteration. Patch coming up.



---

archive/issue_comments_059577.json:
```json
{
    "body": "apply first and this only",
    "created_at": "2009-12-19T22:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59577",
    "user": "https://github.com/robertwb"
}
```

apply first and this only



---

archive/issue_comments_059578.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Attachment:** [7719-bugfix2.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-bugfix2.patch.gz)\n\nAfter I coded up the previous suggestion, I felt the best way was to simply run the whole thing with a bit of extra precision. This way the last couple bits in the final iteration will actually be correct for that step, not just as correct as they could be due to rounding limitations. I also fixed a bug with a.agm(-a) and added some more tests. \n\nI folded it into the above patch, so apply trac_7719-agm.patch and 7719-bugfix2.patch. I'm positively reviewing cremona's changes--he needs to look at mine.",
    "created_at": "2009-12-19T22:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59578",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:17'></a>
**Attachment:** [7719-bugfix2.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-bugfix2.patch.gz)

After I coded up the previous suggestion, I felt the best way was to simply run the whole thing with a bit of extra precision. This way the last couple bits in the final iteration will actually be correct for that step, not just as correct as they could be due to rounding limitations. I also fixed a bug with a.agm(-a) and added some more tests. 

I folded it into the above patch, so apply trac_7719-agm.patch and 7719-bugfix2.patch. I'm positively reviewing cremona's changes--he needs to look at mine.



---

archive/issue_comments_059579.json:
```json
{
    "body": "<a id='comment:18'></a>\nI'll look at it tomorrow as its too late now in th UK.\n\nAbout a.agm(-a):  it should be put into the specification that a.agm(b) requires a and b nonzero and also a not equal to plus or minus b.  We could either throw an error if any of those hold, or return zero.  (In applications these conditions will not hold anyway).\n\nIf you could add that to your next patch that would be helpful!  thanks",
    "created_at": "2009-12-19T23:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59579",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>
I'll look at it tomorrow as its too late now in th UK.

About a.agm(-a):  it should be put into the specification that a.agm(b) requires a and b nonzero and also a not equal to plus or minus b.  We could either throw an error if any of those hold, or return zero.  (In applications these conditions will not hold anyway).

If you could add that to your next patch that would be helpful!  thanks



---

archive/issue_comments_059580.json:
```json
{
    "body": "apply first and this only",
    "created_at": "2009-12-20T10:03:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59580",
    "user": "https://github.com/robertwb"
}
```

apply first and this only



---

archive/issue_comments_059581.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Attachment:** [7719-bugfix3.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-bugfix3.patch.gz)\n\nI think returning zero is the right thing to do for these degenerate cases--after all the AGM as a limit of the arithmetic and geometric means does exist. I've updated the patch.",
    "created_at": "2009-12-20T10:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59581",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:19'></a>
**Attachment:** [7719-bugfix3.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-bugfix3.patch.gz)

I think returning zero is the right thing to do for these degenerate cases--after all the AGM as a limit of the arithmetic and geometric means does exist. I've updated the patch.



---

archive/issue_comments_059582.json:
```json
{
    "body": "**Attachment:** [7719-avoid_an_add.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-avoid_an_add.patch.gz)\n\napply on top of bugfix3",
    "created_at": "2009-12-20T11:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59582",
    "user": "https://github.com/sagetrac-ylchapuy"
}
```

**Attachment:** [7719-avoid_an_add.patch.gz](https://github.com/sagemath/sage/files/ticket7719/7719-avoid_an_add.patch.gz)

apply on top of bugfix3



---

archive/issue_comments_059583.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis seems good to me and I can't think of other degenerate cases.\n\nI added a last patch with a slight improvement, it avoids an add in the loop.\nIt really isn't critical but why not do it?",
    "created_at": "2009-12-20T11:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59583",
    "user": "https://github.com/sagetrac-ylchapuy"
}
```

<a id='comment:20'></a>
This seems good to me and I can't think of other degenerate cases.

I added a last patch with a slight improvement, it avoids an add in the loop.
It really isn't critical but why not do it?



---

archive/issue_comments_059584.json:
```json
{
    "body": "<a id='comment:21'></a>\nThanks -- ingeneous.\n\nAbout Robert's latest:  luckily he did what I intended which was to deal with the special cases (a,-a), (a,0) and (0,b) while leaving alone the case (a,a) where the limit is (of course) a.  I described that last case as degenerate above since in my application it would be, but as far as the AGM itself is concerned it is clear that the correct value when a=b is a!  (Note, though, that the 'principal' version will not return a when a=b and Re(a)<0.)\n\nSecondly, the better precision handling now means that I can revert the doctest changes for ell_rational_field and period_lattice.  Which probably means that I should not have changed them in the first place...\n\nI'll merge all our patches into a single one for the final review.",
    "created_at": "2009-12-20T12:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59584",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:21'></a>
Thanks -- ingeneous.

About Robert's latest:  luckily he did what I intended which was to deal with the special cases (a,-a), (a,0) and (0,b) while leaving alone the case (a,a) where the limit is (of course) a.  I described that last case as degenerate above since in my application it would be, but as far as the AGM itself is concerned it is clear that the correct value when a=b is a!  (Note, though, that the 'principal' version will not return a when a=b and Re(a)<0.)

Secondly, the better precision handling now means that I can revert the doctest changes for ell_rational_field and period_lattice.  Which probably means that I should not have changed them in the first place...

I'll merge all our patches into a single one for the final review.



---

archive/issue_comments_059585.json:
```json
{
    "body": "**Attachment:** [trac_7719-cagm.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-cagm.patch.gz)\n\nReplaces all previous",
    "created_at": "2009-12-20T12:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59585",
    "user": "https://github.com/JohnCremona"
}
```

**Attachment:** [trac_7719-cagm.patch.gz](https://github.com/sagemath/sage/files/ticket7719/trac_7719-cagm.patch.gz)

Replaces all previous



---

archive/issue_comments_059586.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe new patch trac_7719-cagm.patch replaces all previous, for ease of application -- and also makes clear that just one file is touched (rings/complex_number.pyx) though testers should also test schemes/elliptic_curves/{period_lattice,ell_number_field,ell_rational_field}.py since these all use the code.\n\nI made this using the \"fold\" system in mercurial queues, which worked fine, though the end result is that I'm the only user listed in the patch.  If anyone knows how to get back in the credit for Robert Miller, and also ylchapuy, please do since the last thing I want to do is take credit for Robert's fantastic work on this.",
    "created_at": "2009-12-20T12:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59586",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'></a>
The new patch trac_7719-cagm.patch replaces all previous, for ease of application -- and also makes clear that just one file is touched (rings/complex_number.pyx) though testers should also test schemes/elliptic_curves/{period_lattice,ell_number_field,ell_rational_field}.py since these all use the code.

I made this using the "fold" system in mercurial queues, which worked fine, though the end result is that I'm the only user listed in the patch.  If anyone knows how to get back in the credit for Robert Miller, and also ylchapuy, please do since the last thing I want to do is take credit for Robert's fantastic work on this.



---

archive/issue_comments_059587.json:
```json
{
    "body": "<a id='comment:23'></a>\nThat's why I avoid the fold command for tickets with multiple authors... (BTW, I'm Bradshaw, not Miller.)",
    "created_at": "2010-01-07T10:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59587",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:23'></a>
That's why I avoid the fold command for tickets with multiple authors... (BTW, I'm Bradshaw, not Miller.)



---

archive/issue_comments_059588.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@robertwb](#comment%3A23):\n> That's why I avoid the fold command for tickets with multiple authors... (BTW, I'm Bradshaw, not Miller.)\n\nVery sorry -- I seem to have made things worse with my first apology!  I do know which of you is which, honest.",
    "created_at": "2010-01-07T10:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59588",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>
Replying to [@robertwb](#comment%3A23):
> That's why I avoid the fold command for tickets with multiple authors... (BTW, I'm Bradshaw, not Miller.)

Very sorry -- I seem to have made things worse with my first apology!  I do know which of you is which, honest.



---

archive/issue_comments_059589.json:
```json
{
    "body": "<a id='comment:25'></a>\nDon't worry, it's not a big deal (I know you know us both).",
    "created_at": "2010-01-07T10:48:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59589",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:25'></a>
Don't worry, it's not a big deal (I know you know us both).



---

archive/issue_comments_059590.json:
```json
{
    "body": "<a id='comment:26'></a>\nI only just noticed that this was not merged into 4.3.1!  A pity since the similar patch for RDF/CDF is in (#7739).\n\nCan a non-author please test again and (hopefully) give a positive review?",
    "created_at": "2010-01-21T16:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59590",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:26'></a>
I only just noticed that this was not merged into 4.3.1!  A pity since the similar patch for RDF/CDF is in (#7739).

Can a non-author please test again and (hopefully) give a positive review?



---

archive/issue_comments_059591.json:
```json
{
    "body": "<a id='comment:27'></a>\nWorks good. The algorithm is exactly the definition so it was easy to follow the code. And I found out (for my knowlege) that swapping is faster than mpfr_set if you do not care about the other value.",
    "created_at": "2010-01-21T19:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59591",
    "user": "https://github.com/rishikesha"
}
```

<a id='comment:27'></a>
Works good. The algorithm is exactly the definition so it was easy to follow the code. And I found out (for my knowlege) that swapping is faster than mpfr_set if you do not care about the other value.



---

archive/issue_events_079705.json:
```json
{
    "actor": "https://github.com/rishikesha",
    "created_at": "2010-01-21T19:02:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79705"
}
```



---

archive/issue_events_079706.json:
```json
{
    "actor": "https://github.com/rishikesha",
    "created_at": "2010-01-21T19:02:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79706"
}
```



---

archive/issue_events_079707.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-22T20:15:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79707"
}
```



---

archive/issue_events_079708.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-22T20:15:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7719#event-79708"
}
```



---

archive/issue_comments_059592.json:
```json
{
    "body": "**Merged:** sage-4.3.2.alpha0",
    "created_at": "2010-01-22T20:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7719#issuecomment-59592",
    "user": "https://github.com/sagetrac-mvngu"
}
```

**Merged:** sage-4.3.2.alpha0
