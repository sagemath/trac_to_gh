# Issue 7831: numpy-1.5.0 fixes for FreeBSD

archive/issues_007831.json:
```json
{
    "body": "* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.\n\n* A patch to spkg-install is required to ensure that the <math.h> in $SAGE_LOCAL/include is used in place of the system <math.h>, otherwise the additional maths functions provided by cephes are not prototyped, leading to lots of \"implicit declaration\" warnings whilst compiling (eg) numpy/core/src/npymath/npy_math_complex.c.src\n\nAssignee: @peterjeremy\n\nUpstream: None of the above - read trac for reasoning.\n\nReviewer: Stephen Montgomery-Smith\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/7831\n\n",
    "closed_at": "2012-07-04T07:11:32Z",
    "created_at": "2010-01-03T09:14:11Z",
    "labels": [
        "component: porting: bsd",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "numpy-1.5.0 fixes for FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7831",
    "user": "https://github.com/peterjeremy"
}
```
* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.

* A patch to spkg-install is required to ensure that the <math.h> in $SAGE_LOCAL/include is used in place of the system <math.h>, otherwise the additional maths functions provided by cephes are not prototyped, leading to lots of "implicit declaration" warnings whilst compiling (eg) numpy/core/src/npymath/npy_math_complex.c.src

Assignee: @peterjeremy

Upstream: None of the above - read trac for reasoning.

Reviewer: Stephen Montgomery-Smith

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/7831





---

archive/issue_comments_070089.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-03T09:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70089",
    "user": "https://github.com/peterjeremy"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_070090.json:
```json
{
    "body": "<a id='comment:2'></a>These changes look good to me.  Could you look over the ones at #7321?  I'll handle making an spkg with all of these rolled together.\n\nThanks!",
    "created_at": "2010-01-03T16:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70090",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>These changes look good to me.  Could you look over the ones at #7321?  I'll handle making an spkg with all of these rolled together.

Thanks!



---

archive/issue_comments_070091.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-03T16:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70091",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_070092.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-02-13T07:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70092",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_070093.json:
```json
{
    "body": "<a id='comment:3'></a>Updated spkg at\n\nhttp://sage.math.washington.edu/home/mvngu/spkg/standard/numpy/numpy-1.3.0.p3.spkg\n\nwhich incorporates the patch [7831.numpy.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/7831/7831.numpy.patch). This spkg needs review by anyone other than me.",
    "created_at": "2010-02-13T07:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70093",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:3'></a>Updated spkg at

http://sage.math.washington.edu/home/mvngu/spkg/standard/numpy/numpy-1.3.0.p3.spkg

which incorporates the patch [7831.numpy.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/7831/7831.numpy.patch). This spkg needs review by anyone other than me.



---

archive/issue_comments_070094.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-02-13T07:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70094",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_070095.json:
```json
{
    "body": "<a id='comment:5'></a>Looks fine.  The the changes based on the newest spkg are at \n\nhttp://sage.math.washington.edu/home/mhansen/numpy-1.3.0.p4.spkg",
    "created_at": "2010-06-22T23:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70095",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>Looks fine.  The the changes based on the newest spkg are at 

http://sage.math.washington.edu/home/mhansen/numpy-1.3.0.p4.spkg



---

archive/issue_comments_070096.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-06-22T23:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70096",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_070097.json:
```json
{
    "body": "<a id='comment:6'></a>There is another ticket updating numpy as well: #8010. These two conflicting spkg's need to be resolved.",
    "created_at": "2010-06-25T05:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70097",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:6'></a>There is another ticket updating numpy as well: #8010. These two conflicting spkg's need to be resolved.



---

archive/issue_comments_070098.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-06-28T17:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70098",
    "user": "https://github.com/rlmill"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_070099.json:
```json
{
    "body": "<a id='comment:8'></a>Since #8010 has been closed, it would be helpful to know whether the changes here are still needed (which I can't test, unfortunately).",
    "created_at": "2010-11-03T12:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70099",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>Since #8010 has been closed, it would be helpful to know whether the changes here are still needed (which I can't test, unfortunately).



---

archive/issue_comments_070100.json:
```json
{
    "body": "<a id='comment:9'></a>Can someone verify whether this is fixed by other changes to the numpy package in 4.6.1alpha0?",
    "created_at": "2010-11-05T06:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70100",
    "user": "https://trac.sagemath.org/admin/accounts/users/flawrence"
}
```

<a id='comment:9'></a>Can someone verify whether this is fixed by other changes to the numpy package in 4.6.1alpha0?



---

archive/issue_comments_070101.json:
```json
{
    "body": "<a id='comment:10'></a>The __init__.py changes don't appear to be needed any longer but the remaining fixes are still required.",
    "created_at": "2010-11-18T19:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70101",
    "user": "https://github.com/peterjeremy"
}
```

<a id='comment:10'></a>The __init__.py changes don't appear to be needed any longer but the remaining fixes are still required.



---

archive/issue_comments_070102.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,47 +1,6 @@\n-* !__init!__.py needs a sage-specific patch to prefer sage_fortran on FreeBSD.  Without this, numpy reports:\n+* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.\n \n-```\n-Running from numpy source directory.\n-F2PY Version 2\n-blas_opt_info:\n-blas_mkl_info:\n-  libraries mkl,vml,guide not found in /home/peter/sage/sage-4.3/local/lib\n-  NOT AVAILABLE\n-\n-atlas_blas_threads_info:\n-Setting PTATLAS=ATLAS\n-  libraries ptf77blas,ptcblas,atlas_r not found in /home/peter/sage/sage-4.3/local/lib\n-  NOT AVAILABLE\n-\n-atlas_blas_info:\n-  libraries f77blas,cblas,atlas_r not found in /home/peter/sage/sage-4.3/local/lib\n-  NOT AVAILABLE\n-\n-/home/peter/sage/sage-4.3/spkg/build/numpy-1.3.0.p2/src/numpy/distutils/system_info.py:1383: UserWarning: \n-    Atlas (http://math-atlas.sourceforge.net/) libraries not found.\n-    Directories to search for the libraries can be specified in the\n-    numpy/distutils/site.cfg file (section [atlas]) or by setting\n-    the ATLAS environment variable.\n-  warnings.warn(AtlasNotFoundError.__doc__)\n-blas_info:\n-  FOUND:\n-    libraries = ['blas']\n-    library_dirs = ['/home/peter/sage/sage-4.3/local/lib']\n-    language = f77\n-\n-  FOUND:\n-```\n-\n-This also causes matplotlib to die with\n-\n-```\n-REQUIRED DEPENDENCIES\n-                 numpy: no\n-                        * You must install numpy 1.1 or later to build\n-                        * matplotlib.\n-```\n-\n-* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.\n+* A patch to spkg-install is required to ensure that the <math.h> in $SAGE_LOCAL/include is used in place of the system <math.h>, otherwise the additional maths functions provided by cephes are not prototyped, leading to lots of \"implicit declaration\" warnings whilst compiling (eg) numpy/core/src/npymath/npy_math_complex.c.src\n \n Upstream: None of the above - read trac for reasoning.\n \n```\n",
    "created_at": "2010-11-18T19:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70102",
    "user": "https://github.com/peterjeremy"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,47 +1,6 @@
-* !__init!__.py needs a sage-specific patch to prefer sage_fortran on FreeBSD.  Without this, numpy reports:
+* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.
 
-```
-Running from numpy source directory.
-F2PY Version 2
-blas_opt_info:
-blas_mkl_info:
-  libraries mkl,vml,guide not found in /home/peter/sage/sage-4.3/local/lib
-  NOT AVAILABLE
-
-atlas_blas_threads_info:
-Setting PTATLAS=ATLAS
-  libraries ptf77blas,ptcblas,atlas_r not found in /home/peter/sage/sage-4.3/local/lib
-  NOT AVAILABLE
-
-atlas_blas_info:
-  libraries f77blas,cblas,atlas_r not found in /home/peter/sage/sage-4.3/local/lib
-  NOT AVAILABLE
-
-/home/peter/sage/sage-4.3/spkg/build/numpy-1.3.0.p2/src/numpy/distutils/system_info.py:1383: UserWarning: 
-    Atlas (http://math-atlas.sourceforge.net/) libraries not found.
-    Directories to search for the libraries can be specified in the
-    numpy/distutils/site.cfg file (section [atlas]) or by setting
-    the ATLAS environment variable.
-  warnings.warn(AtlasNotFoundError.__doc__)
-blas_info:
-  FOUND:
-    libraries = ['blas']
-    library_dirs = ['/home/peter/sage/sage-4.3/local/lib']
-    language = f77
-
-  FOUND:
-```
-
-This also causes matplotlib to die with
-
-```
-REQUIRED DEPENDENCIES
-                 numpy: no
-                        * You must install numpy 1.1 or later to build
-                        * matplotlib.
-```
-
-* By default, numpy references threaded atlas libraries, as well as a custom variant on the lapack library, on FreeBSD. The reasoning behind this is unclear - there is nothing in the numpy documentation to indicate whether a threaded or non-threaded atlas is needed and the publicly available SVN logs do not mention this code. A query to the numpy mailing list elicited a response that either threaded or non-threaded atlas can be used and suggesting that the special-casing for FreeBSD may be obsolete. By default, atlas is built non-threaded and r-2.6.1.p23 assumes a non-threaded atlas and fails when only the threaded libraries are installed. Based on this, the special casing for FreeBSD was removed from numpy - it now uses the same libraries irrespective of the host OS.  This part of the patch could potentially be integrated upstream but this has not been done yet.
+* A patch to spkg-install is required to ensure that the <math.h> in $SAGE_LOCAL/include is used in place of the system <math.h>, otherwise the additional maths functions provided by cephes are not prototyped, leading to lots of "implicit declaration" warnings whilst compiling (eg) numpy/core/src/npymath/npy_math_complex.c.src
 
 Upstream: None of the above - read trac for reasoning.
 
```




---

archive/issue_comments_070103.json:
```json
{
    "body": "<a id='comment:11'></a>Attachment [7831.numpy.patch](tarball://root/attachments/some-uuid/ticket7831/7831.numpy.patch) by @kcrisman created at 2011-03-12 04:11:32\n\nNote that numpy 1.5.1 is on the way to Sage - #10792.   It would be great to get this incorporated with that.",
    "created_at": "2011-03-12T04:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70103",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>Attachment [7831.numpy.patch](tarball://root/attachments/some-uuid/ticket7831/7831.numpy.patch) by @kcrisman created at 2011-03-12 04:11:32

Note that numpy 1.5.1 is on the way to Sage - #10792.   It would be great to get this incorporated with that.



---

archive/issue_comments_070104.json:
```json
{
    "body": "<a id='comment:12'></a>Apparently [Stephen Montgomery-Smith](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/857a00a9aa271f17) has had some success with this recently as a \"port\".",
    "created_at": "2012-01-31T02:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70104",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>Apparently [Stephen Montgomery-Smith](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/857a00a9aa271f17) has had some success with this recently as a "port".



---

archive/issue_comments_070105.json:
```json
{
    "body": "<a id='comment:13'></a>More success at [this thread](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/yPGIKHRSANs).  Checking whether it was with a system version or Sage version.",
    "created_at": "2012-06-20T15:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70105",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>More success at [this thread](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/yPGIKHRSANs).  Checking whether it was with a system version or Sage version.



---

archive/issue_comments_070106.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-06-20T15:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70106",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_events_018730.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-06-20T18:24:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7831#event-18730"
}
```



---

archive/issue_comments_070107.json:
```json
{
    "body": "<a id='comment:14'></a>Just noting here that although this was the Sage version, Numpy upstream still has the special FreeBSD code, [here as of June 2012](https://github.com/numpy/numpy/blob/master/numpy/distutils/system_info.py#L972), so the patch definitely hasn't been applied.  My sense is that probably the R upgrades over the years is what made this obsolete.\n\nSo I'm putting this to positive review as it builds (and so does R) and passes the overwhelming majority of tests on FreeBSD 8 and 9, but leaving this info here in case in certain unusual cases this ends up being a problem after all.",
    "created_at": "2012-06-20T18:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70107",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>Just noting here that although this was the Sage version, Numpy upstream still has the special FreeBSD code, [here as of June 2012](https://github.com/numpy/numpy/blob/master/numpy/distutils/system_info.py#L972), so the patch definitely hasn't been applied.  My sense is that probably the R upgrades over the years is what made this obsolete.

So I'm putting this to positive review as it builds (and so does R) and passes the overwhelming majority of tests on FreeBSD 8 and 9, but leaving this info here in case in certain unusual cases this ends up being a problem after all.



---

archive/issue_comments_070108.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-06-20T18:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70108",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_070109.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-20T18:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70109",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_018731.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-04T07:11:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7831#event-18731"
}
```



---

archive/issue_comments_070110.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-07-04T07:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7831#issuecomment-70110",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
