# Issue 7496: symbolic variable names should be valid identifiers, or ridiculousness follows

archive/issues_007496.json:
```json
{
    "assignees": [],
    "body": "WTF?\n\n```\nsage: var('1')\n1\nsage: var('1')+1\n1 + 1\nsage: expand((var('2')+var('2'))^2)\n4*2^2\n```\n\nWhen this ticket is closed, #9724 can also be closed.\n\n---\nApply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.2.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz).\n\nAssignee: **@burcin**\n\nKeywords: **sd31**\n\nAuthor: **Volker Braun, Karl-Dieter Crisman**\n\nReviewer: **Karl-Dieter Crisman, Volker Braun**\n\nMerged: **sage-4.7.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7496_\n\n",
    "closed_at": "2011-07-22T12:48:27Z",
    "created_at": "2009-11-20T02:16:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "symbolic variable names should be valid identifiers, or ridiculousness follows",
    "type": "issue",
    "updated_at": "2011-07-22T12:48:27Z",
    "url": "https://github.com/sagemath/sage/issues/7496",
    "user": "https://github.com/williamstein"
}
```
WTF?

```
sage: var('1')
1
sage: var('1')+1
1 + 1
sage: expand((var('2')+var('2'))^2)
4*2^2
```

When this ticket is closed, #9724 can also be closed.

---
Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.2.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz).

Assignee: **@burcin**

Keywords: **sd31**

Author: **Volker Braun, Karl-Dieter Crisman**

Reviewer: **Karl-Dieter Crisman, Volker Braun**

Merged: **sage-4.7.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/7496_





---

archive/issue_events_083482.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-11-20T02:16:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83482"
}
```



---

archive/issue_events_083483.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-11-20T02:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83483"
}
```



---

archive/issue_events_083484.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-11-20T02:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83484"
}
```



---

archive/issue_events_083485.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-11-20T02:16:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83485"
}
```



---

archive/issue_comments_056785.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThis would be really easy to implement once we have python 3. Apparently, valid identifiers got extended:\n\nhttp://www.python.org/dev/peps/pep-3131/\n\nString literals also got an `isidentifier()` method.\n\nI don't know how to do this efficiently, while still allowing people to just use \u03b1 (alpha) as a variable name.",
    "created_at": "2010-01-17T08:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56785",
    "user": "https://github.com/burcin"
}
```

<div id="comment:1" align="right">Comment 1</div>

This would be really easy to implement once we have python 3. Apparently, valid identifiers got extended:

http://www.python.org/dev/peps/pep-3131/

String literals also got an `isidentifier()` method.

I don't know how to do this efficiently, while still allowing people to just use α (alpha) as a variable name.



---

archive/issue_comments_056786.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAs long as we don't have Python 3, I would try to find a regular expression that does what we need. It is of course easy to write a regular expression that works for ascii strings. But as soon as '\u00e4' or other language-specific letters are supposed to be considered a variable name, things will become difficult.\n\nI tried\n\n```\nsage: import re\nsage: _identifiers = re.compile(\"(?!\\d)\\w*\\Z\", re.LOCALE|re.UNICODE)\n```\n\nIt works for simple cases:\n\n```\nsage: _identifiers.match('k_1')\n<_sre.SRE_Match object at 0x50d1030>\nsage: _identifiers.match('1k')\nsage: _identifiers.match('_1k')\n<_sre.SRE_Match object at 0x50d1238>\n```\n\nBut it ignores other letters:\n\n```\nsage: print _identifiers.match('\u00e4')\nNone\n```\n\nPerhaps I have misunderstood the effect of `re.LOCALE`? What value should `re.LOCALE` have in order to work with accented letters?",
    "created_at": "2011-03-03T10:31:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56786",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">Comment 2</div>

As long as we don't have Python 3, I would try to find a regular expression that does what we need. It is of course easy to write a regular expression that works for ascii strings. But as soon as 'ä' or other language-specific letters are supposed to be considered a variable name, things will become difficult.

I tried

```
sage: import re
sage: _identifiers = re.compile("(?!\d)\w*\Z", re.LOCALE|re.UNICODE)
```

It works for simple cases:

```
sage: _identifiers.match('k_1')
<_sre.SRE_Match object at 0x50d1030>
sage: _identifiers.match('1k')
sage: _identifiers.match('_1k')
<_sre.SRE_Match object at 0x50d1238>
```

But it ignores other letters:

```
sage: print _identifiers.match('ä')
None
```

Perhaps I have misunderstood the effect of `re.LOCALE`? What value should `re.LOCALE` have in order to work with accented letters?



---

archive/issue_comments_056787.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nWhatever we do, let's be sure to avoid locality dependance on what a valid symbol is. Let's look into back-porting whatever Python3 does, and then falling back to that once we make the transition.",
    "created_at": "2011-03-03T21:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56787",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:3" align="right">Comment 3</div>

Whatever we do, let's be sure to avoid locality dependance on what a valid symbol is. Let's look into back-porting whatever Python3 does, and then falling back to that once we make the transition.



---

archive/issue_events_083486.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-18T04:45:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83486"
}
```



---

archive/issue_comments_056788.json:
```json
{
    "body": "Changed keywords from **** to **sd31**",
    "created_at": "2011-06-18T04:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56788",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from **** to **sd31**



---

archive/issue_comments_056789.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2011-06-18T04:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56789",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_056790.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n sage: expand((var('2')+var('2'))^2)\n 4*2^2\n ```\n+\n+When this ticket is closed, #9724 can also be closed.\n``````\n",
    "created_at": "2011-06-23T19:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56790",
    "user": "https://github.com/sagetrac-mariah"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 sage: expand((var('2')+var('2'))^2)
 4*2^2
 ```
+
+When this ticket is closed, #9724 can also be closed.
``````




---

archive/issue_comments_056791.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2011-06-24T01:29:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56791",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_056792.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThis code should be correct - nice to learn something about the parser and bytecode.  Is this how it's implemented in Python 3 (presumably that's written in C, though)?  I couldn't find it, anyway.\n\nThis needs doctests just to document that `var('3')` and `var(' ')` (see #9724) fail, though of course the tests already here document this indirectly.  I'll post a reviewer patch momentarily, assuming I didn't miss something and the patch doesn't actually work.",
    "created_at": "2011-06-24T01:29:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56792",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">Comment 6</div>

This code should be correct - nice to learn something about the parser and bytecode.  Is this how it's implemented in Python 3 (presumably that's written in C, though)?  I couldn't find it, anyway.

This needs doctests just to document that `var('3')` and `var(' ')` (see #9724) fail, though of course the tests already here document this indirectly.  I'll post a reviewer patch momentarily, assuming I didn't miss something and the patch doesn't actually work.



---

archive/issue_comments_056793.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nOk, I think this is still ok, though I am a little concerned about both of the following being bad:\n\n```\nsage: var(' x')\n(, x)\n```\nnot good because an empty string is a variable\n\n```\nsage: var(' x')\n---------------------------------------------------------------------------\nValueError: The name \"\" is not a valid Python identifier.\n```\nnot good because the intent is clear to make precisely x the variable.  \n\nSo is this breaking incorrect but usable behavior? \n\n```\nsage: var(\"x y  z\")\n(x, y, , z)\nsage: \n```\nis similar.\n\nAnyway, I withhold judgment on this.  Reviewer patch attached, but 'needs info' on this.  At the least it seems reasonable to open a new ticket to allow the above behavior - one could easily remove empty strings from the list `names_list` and then complain if there are none left, for instance.",
    "created_at": "2011-06-24T03:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56793",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">Comment 7</div>

Ok, I think this is still ok, though I am a little concerned about both of the following being bad:

```
sage: var(' x')
(, x)
```
not good because an empty string is a variable

```
sage: var(' x')
---------------------------------------------------------------------------
ValueError: The name "" is not a valid Python identifier.
```
not good because the intent is clear to make precisely x the variable.  

So is this breaking incorrect but usable behavior? 

```
sage: var("x y  z")
(x, y, , z)
sage: 
```
is similar.

Anyway, I withhold judgment on this.  Reviewer patch attached, but 'needs info' on this.  At the least it seems reasonable to open a new ticket to allow the above behavior - one could easily remove empty strings from the list `names_list` and then complain if there are none left, for instance.



---

archive/issue_events_083487.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T03:08:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83487"
}
```



---

archive/issue_events_083488.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T03:08:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83488"
}
```



---

archive/issue_comments_056794.json:
```json
{
    "body": "Attachment: **[trac_7496-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz)**\n\nApply after initial patch",
    "created_at": "2011-06-24T03:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56794",
    "user": "https://github.com/kcrisman"
}
```

Attachment: **[trac_7496-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz)**

Apply after initial patch



---

archive/issue_comments_056795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,6 @@\n ```\n \n When this ticket is closed, #9724 can also be closed.\n+\n+---\n+Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).\n``````\n",
    "created_at": "2011-06-24T03:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56795",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,6 @@
 ```
 
 When this ticket is closed, #9724 can also be closed.
+
+---
+Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).
``````




---

archive/issue_comments_056796.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nApply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).",
    "created_at": "2011-06-24T03:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56796",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:8" align="right">Comment 8</div>

Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).



---

archive/issue_events_083489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T05:10:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83489"
}
```



---

archive/issue_events_083490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T05:10:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83490"
}
```



---

archive/issue_comments_056797.json:
```json
{
    "body": "Changed author from **Volker Braun** to **Volker Braun, Karl-Dieter Crisman**",
    "created_at": "2011-06-24T05:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56797",
    "user": "https://github.com/vbraun"
}
```

Changed author from **Volker Braun** to **Volker Braun, Karl-Dieter Crisman**



---

archive/issue_comments_056798.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nUpdated patch splits with any white space and not only on single space:\n\n```\n    sage: var(' x y  z    ')\n    (x, y, z)\n    sage: var(' x  ,  y ,  z    ') \n    (x, y, z)\n```\nI'm giving the reviewer patch a positive review.",
    "created_at": "2011-06-24T05:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56798",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">Comment 9</div>

Updated patch splits with any white space and not only on single space:

```
    sage: var(' x y  z    ')
    (x, y, z)
    sage: var(' x  ,  y ,  z    ') 
    (x, y, z)
```
I'm giving the reviewer patch a positive review.



---

archive/issue_comments_056799.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Volker Braun**",
    "created_at": "2011-06-24T05:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56799",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Volker Braun**



---

archive/issue_events_083491.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T11:24:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83491"
}
```



---

archive/issue_events_083492.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T11:24:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83492"
}
```



---

archive/issue_comments_056800.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThanks.  So far it looks good.\n\nBut with the original version of the patch (and almost certainly the new one) we get the following doctest error (was letting them run overnight, my apologies):\n\n```\nsage -t -long \"devel/sage/sage/calculus/desolvers.py\"       \n**********************************************************************\nFile \"/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py\", line 1430:\n    sage: sol=desolve_odeint(f,[0.5,2],srange(0,10,0.1),[x,y])\nException raised:\n        sol=desolve_odeint(f,[RealNumber('0.5'),Integer(2)],srange(Integer(0),Integer(10),RealNumber('0.1')),[x,y])###line 1430:\n    sage: sol=desolve_odeint(f,[0.5,2],srange(0,10,0.1),[x,y])\n      File \"/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py\", line 1501, in desolve_odeint\n        ivar = var(safe_name)\n      File \"ring.pyx\", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)\n      File \"ring.pyx\", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)\n      File \"ring.pyx\", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)\n    ValueError: The name \"t_[x\" is not a valid Python identifier.\n**********************************************************************\n<snip two failures that result from sol not being defined>\n**********************************************************************\nFile \"/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py\", line 1446:\n    sage: sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=1e-13,atol=1e-14)\nException raised:\n      File \"<doctest __main__.example_12[15]>\", line 1, in <module>\n        sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=RealNumber('1e-13'),atol=RealNumber('1e-14'))###line 1446:\n    sage: sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=1e-13,atol=1e-14)\n      File \"/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py\", line 1501, in desolve_odeint\n        ivar = var(safe_name)\n      File \"ring.pyx\", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)\n      File \"ring.pyx\", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)\n      File \"ring.pyx\", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)\n    ValueError: The name \"t_[x\" is not a valid Python identifier.\n**********************************************************************\nFile \"/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py\", line 1470:\n    sage: sol=desolve_odeint(f,ci,t,v,rtol=1e-3,atol=1e-4,h0=0.1,hmax=1,hmin=1e-4,mxstep=1000,mxords=17)\nException raised:\n      File \"<doctest __main__.example_12[32]>\", line 1, in <module>\n        sol=desolve_odeint(f,ci,t,v,rtol=RealNumber('1e-3'),atol=RealNumber('1e-4'),h0=RealNumber('0.1'),hmax=Integer(1),hmin=RealNumber('1e-4'),mxstep=Integer(1000),mxords=Integer(17))###line 1470:\n    sage: sol=desolve_odeint(f,ci,t,v,rtol=1e-3,atol=1e-4,h0=0.1,hmax=1,hmin=1e-4,mxstep=1000,mxords=17)\n      File \"/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py\", line 1501, in desolve_odeint\n        ivar = var(safe_name)\n      File \"ring.pyx\", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)\n      File \"ring.pyx\", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)\n      File \"ring.pyx\", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)\n    ValueError: The name \"t_[y1\" is not a valid Python identifier.\n**********************************************************************\n```",
    "created_at": "2011-06-24T11:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56800",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">Comment 10</div>

Thanks.  So far it looks good.

But with the original version of the patch (and almost certainly the new one) we get the following doctest error (was letting them run overnight, my apologies):

```
sage -t -long "devel/sage/sage/calculus/desolvers.py"       
**********************************************************************
File "/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py", line 1430:
    sage: sol=desolve_odeint(f,[0.5,2],srange(0,10,0.1),[x,y])
Exception raised:
        sol=desolve_odeint(f,[RealNumber('0.5'),Integer(2)],srange(Integer(0),Integer(10),RealNumber('0.1')),[x,y])###line 1430:
    sage: sol=desolve_odeint(f,[0.5,2],srange(0,10,0.1),[x,y])
      File "/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py", line 1501, in desolve_odeint
        ivar = var(safe_name)
      File "ring.pyx", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)
      File "ring.pyx", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)
      File "ring.pyx", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)
    ValueError: The name "t_[x" is not a valid Python identifier.
**********************************************************************
<snip two failures that result from sol not being defined>
**********************************************************************
File "/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py", line 1446:
    sage: sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=1e-13,atol=1e-14)
Exception raised:
      File "<doctest __main__.example_12[15]>", line 1, in <module>
        sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=RealNumber('1e-13'),atol=RealNumber('1e-14'))###line 1446:
    sage: sol=desolve_odeint(lorenz,ics,times,[x,y,z],rtol=1e-13,atol=1e-14)
      File "/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py", line 1501, in desolve_odeint
        ivar = var(safe_name)
      File "ring.pyx", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)
      File "ring.pyx", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)
      File "ring.pyx", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)
    ValueError: The name "t_[x" is not a valid Python identifier.
**********************************************************************
File "/Users/.../sage-4.7.1.alpha2/devel/sage/sage/calculus/desolvers.py", line 1470:
    sage: sol=desolve_odeint(f,ci,t,v,rtol=1e-3,atol=1e-4,h0=0.1,hmax=1,hmin=1e-4,mxstep=1000,mxords=17)
Exception raised:
      File "<doctest __main__.example_12[32]>", line 1, in <module>
        sol=desolve_odeint(f,ci,t,v,rtol=RealNumber('1e-3'),atol=RealNumber('1e-4'),h0=RealNumber('0.1'),hmax=Integer(1),hmin=RealNumber('1e-4'),mxstep=Integer(1000),mxords=Integer(17))###line 1470:
    sage: sol=desolve_odeint(f,ci,t,v,rtol=1e-3,atol=1e-4,h0=0.1,hmax=1,hmin=1e-4,mxstep=1000,mxords=17)
      File "/Users/.../sage-4.7.1.alpha2/local/lib/python/site-packages/sage/calculus/desolvers.py", line 1501, in desolve_odeint
        ivar = var(safe_name)
      File "ring.pyx", line 798, in sage.symbolic.ring.var (sage/symbolic/ring.cpp:7745)
      File "ring.pyx", line 506, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6272)
      File "ring.pyx", line 534, in sage.symbolic.ring.SymbolicRing.var (sage/symbolic/ring.cpp:6044)
    ValueError: The name "t_[y1" is not a valid Python identifier.
**********************************************************************
```



---

archive/issue_events_083493.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T12:14:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83493"
}
```



---

archive/issue_events_083494.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T12:14:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83494"
}
```



---

archive/issue_comments_056801.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nSomehow I'm not surprised that somebody used invalid identifiers as variable names ;-)\n\nUpdated patch follows.",
    "created_at": "2011-06-24T12:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56801",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">Comment 11</div>

Somehow I'm not surprised that somebody used invalid identifiers as variable names ;-)

Updated patch follows.



---

archive/issue_events_083495.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T13:43:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83495"
}
```



---

archive/issue_events_083496.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T13:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83496"
}
```



---

archive/issue_comments_056802.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@vbraun](#comment%3A11):\n> Somehow I'm not surprised that somebody used invalid identifiers as variable names ;-)\n\nSo this actually found a bug of sorts - nice.  Though I have to say that trying to go between the Maxima way of all variables automatic and the Sage way of (nearly) none gave the folks who put that file together quite a challenge, so I don't blame them too much.  But the code is not so elegant, in retrospect.\n\nWhat's particularly bizarre about this is that in the old and the new cases, `fast_float` is being passed something with three arguments, so it still behaves properly - even though the third thing is an iterable in both cases!  Probably the \"right\" fix is to just do `'t_'+str(dvar)` for the first dvar only; fast_float just needs something different from the dependent variables.  But I think that would be another ticket, as this doesn't break anything (and the plots still look the same).\n\nAnyway, it fixes the test, doesn't seem to introduce any new bugs.\n\nHowever, the update to allowing whitespace probably still needs work. Maybe we need to special-case the situation where there is only whitespace in the string passed to `var`:\n\n```\nsage: var(' ')\n \nsage: a = var(' ')\nsage: a\n \nsage: type(a)\n<type 'sage.symbolic.expression.Expression'>\n```\n\nSorry :(",
    "created_at": "2011-06-24T13:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56802",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@vbraun](#comment%3A11):
> Somehow I'm not surprised that somebody used invalid identifiers as variable names ;-)

So this actually found a bug of sorts - nice.  Though I have to say that trying to go between the Maxima way of all variables automatic and the Sage way of (nearly) none gave the folks who put that file together quite a challenge, so I don't blame them too much.  But the code is not so elegant, in retrospect.

What's particularly bizarre about this is that in the old and the new cases, `fast_float` is being passed something with three arguments, so it still behaves properly - even though the third thing is an iterable in both cases!  Probably the "right" fix is to just do `'t_'+str(dvar)` for the first dvar only; fast_float just needs something different from the dependent variables.  But I think that would be another ticket, as this doesn't break anything (and the plots still look the same).

Anyway, it fixes the test, doesn't seem to introduce any new bugs.

However, the update to allowing whitespace probably still needs work. Maybe we need to special-case the situation where there is only whitespace in the string passed to `var`:

```
sage: var(' ')
 
sage: a = var(' ')
sage: a
 
sage: type(a)
<type 'sage.symbolic.expression.Expression'>
```

Sorry :(



---

archive/issue_comments_056803.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nOh yes good catch, the elements of the empty set (no variable after stripping whitespace) satisfy every property!\n\nFixed in the updated patch.",
    "created_at": "2011-06-24T14:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56803",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">Comment 13</div>

Oh yes good catch, the elements of the empty set (no variable after stripping whitespace) satisfy every property!

Fixed in the updated patch.



---

archive/issue_events_083497.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T14:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83497"
}
```



---

archive/issue_events_083498.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-06-24T14:34:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83498"
}
```



---

archive/issue_comments_056804.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-06-24T14:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56804",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_056805.json:
```json
{
    "body": "Attachment: **[trac_7496_check_symbolic_variable_names.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz)**\n\nAttachment: **[trac_7496-reviewer.2.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz)**\n\nUpdated patch",
    "created_at": "2011-06-24T15:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56805",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_7496_check_symbolic_variable_names.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz)**

Attachment: **[trac_7496-reviewer.2.patch.gz](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz)**

Updated patch



---

archive/issue_comments_056806.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThe error message for the \"empty variable\" case changed in my patch, I just updated the reviewer patch to take that into account.",
    "created_at": "2011-06-24T15:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56806",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">Comment 14</div>

The error message for the "empty variable" case changed in my patch, I just updated the reviewer patch to take that into account.



---

archive/issue_comments_056807.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n When this ticket is closed, #9724 can also be closed.\n \n ---\n-Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).\n+Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.2.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz).\n``````\n",
    "created_at": "2011-06-24T15:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56807",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 When this ticket is closed, #9724 can also be closed.
 
 ---
-Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.patch.gz).
+Apply [attachment: trac_7496_check_symbolic_variable_names.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496_check_symbolic_variable_names.patch.gz) and [attachment: trac_7496-reviewer.2.patch](https://github.com/sagemath/sage/files/ticket7496/trac_7496-reviewer.2.patch.gz).
``````




---

archive/issue_events_083499.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T19:08:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83499"
}
```



---

archive/issue_events_083500.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-06-24T19:08:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83500"
}
```



---

archive/issue_comments_056808.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nOkay, I think that this is finally in shape.  Thanks for the back and forth on this.",
    "created_at": "2011-06-24T19:08:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56808",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">Comment 15</div>

Okay, I think that this is finally in shape.  Thanks for the back and forth on this.



---

archive/issue_events_083501.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-26T15:05:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83501"
}
```



---

archive/issue_events_083502.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-26T15:05:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83502"
}
```



---

archive/issue_events_083503.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:48:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83503"
}
```



---

archive/issue_events_083504.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-22T12:48:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7496#event-83504"
}
```



---

archive/issue_comments_056809.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha0**",
    "created_at": "2011-07-22T12:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7496#issuecomment-56809",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.2.alpha0**
