# Issue 7629: Make it possible to restrict the domains of email addresses

archive/issues_007629.json:
```json
{
    "body": "I'm setting up a campus server, and it would extremely useful if I could require valid email addresses and restrict email addresses to campus addresses.  This would allow anyone with a valid campus email address to create an account.\n\nNote that for this to work, we also need to make it required to confirm email addresses before accounts are activated.\n\n**Assignee:** @williamstein\n\n**CC:**  @dandrake @fchapoton\n\n**Upstream:** Reported upstream. Developers acknowledge bug.\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Mitesh Patel\n\nIssue created by migration from https://trac.sagemath.org/ticket/7629\n\n",
    "closed_at": "2020-08-31T08:12:43Z",
    "created_at": "2009-12-08T19:58:17Z",
    "labels": [
        "component: notebook",
        "enhancement",
        "invalid"
    ],
    "title": "Make it possible to restrict the domains of email addresses",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7629",
    "user": "https://github.com/jasongrout"
}
```
I'm setting up a campus server, and it would extremely useful if I could require valid email addresses and restrict email addresses to campus addresses.  This would allow anyone with a valid campus email address to create an account.

Note that for this to work, we also need to make it required to confirm email addresses before accounts are activated.

**Assignee:** @williamstein

**CC:**  @dandrake @fchapoton

**Upstream:** Reported upstream. Developers acknowledge bug.

**Reviewer:** Dima Pasechnik

**Author:** Mitesh Patel

Issue created by migration from https://trac.sagemath.org/ticket/7629





---

archive/issue_comments_060073.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee #7630",
    "created_at": "2009-12-08T20:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60073",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
See #7630



---

archive/issue_events_053385.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-19T09:07:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53385"
}
```



---

archive/issue_events_053386.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-19T09:07:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53386"
}
```



---

archive/issue_comments_060074.json:
```json
{
    "body": "Validate with extra regexp from notebook settings.  Depends on #8038.  sagenb repo.",
    "created_at": "2010-01-28T06:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60074",
    "user": "https://github.com/qed777"
}
```

Validate with extra regexp from notebook settings.  Depends on #8038.  sagenb repo.



---

archive/issue_events_053387.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-28T06:28:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53387"
}
```



---

archive/issue_comments_060075.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2010-01-28T06:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60075",
    "user": "https://github.com/qed777"
}
```

**Author:** Mitesh Patel



---

archive/attachments_009274.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7629-validate_email_custom.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7629/trac_7629-validate_email_custom.patch",
    "created_at": "2010-01-28T06:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_060076.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe patch is from #8038's V3.",
    "created_at": "2010-01-28T06:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60076",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>
The patch is from #8038's V3.



---

archive/issue_events_053388.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-02-08T13:10:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53388"
}
```



---

archive/issue_events_053389.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-02-08T13:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53389"
}
```



---

archive/issue_comments_060077.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis needs a bit of work. \n\nFirst, is it possible to doctest this? Ultimately, the function is just doing a regex match, so we should be able to doctest it...but I don't exactly know how.\n\nSecond, I think `re.search` would be better than `re.match`; search finds the regex anywhere in the string, but match by default only looks at the beginning of the string (http://docs.python.org/library/re.html). We can use `re.search` and anyone who needs the regex to match at the beginning of the string can use `^`. I thought the patch was broken until I looked this up in the Python documentation, so others will definitely run into this.\n\nFinally, it would be nice to distinguish between invalid email addresses and disallowed addresses. Invalid is something like \"two..dots@foo.com\"; disallowed is something that the server admin doesn't allow. I say this because I'm anticipating emails from people outside of campus saying \"the server says my email isn't valid, but it is, really!\" and then I'd have to explain. Ideally, I'd like something like \"The server administrator has restricted the email addresses that can be used here, and yours is not allowed.\"\n\nWith doctests and `re.search`, I'll give this a positive review.",
    "created_at": "2010-02-08T13:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60077",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>
This needs a bit of work. 

First, is it possible to doctest this? Ultimately, the function is just doing a regex match, so we should be able to doctest it...but I don't exactly know how.

Second, I think `re.search` would be better than `re.match`; search finds the regex anywhere in the string, but match by default only looks at the beginning of the string (http://docs.python.org/library/re.html). We can use `re.search` and anyone who needs the regex to match at the beginning of the string can use `^`. I thought the patch was broken until I looked this up in the Python documentation, so others will definitely run into this.

Finally, it would be nice to distinguish between invalid email addresses and disallowed addresses. Invalid is something like "two..dots@foo.com"; disallowed is something that the server admin doesn't allow. I say this because I'm anticipating emails from people outside of campus saying "the server says my email isn't valid, but it is, really!" and then I'd have to explain. Ideally, I'd like something like "The server administrator has restricted the email addresses that can be used here, and yours is not allowed."

With doctests and `re.search`, I'll give this a positive review.



---

archive/issue_events_053390.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53390"
}
```



---

archive/issue_events_053391.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53391"
}
```



---

archive/issue_events_053392.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53392"
}
```



---

archive/issue_events_053393.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53393"
}
```



---

archive/issue_events_053394.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53394"
}
```



---

archive/issue_events_053395.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53395"
}
```



---

archive/issue_events_053396.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53396"
}
```



---

archive/issue_events_053397.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53397"
}
```



---

archive/issue_comments_060078.json:
```json
{
    "body": "<a id='comment:9'></a>\nhttps://github.com/sagemath/sagenb/issues/298",
    "created_at": "2014-12-10T20:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60078",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
https://github.com/sagemath/sagenb/issues/298



---

archive/issue_comments_060079.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2014-12-10T20:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60079",
    "user": "https://github.com/kcrisman"
}
```

**Changing upstream** from "N/A" to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_events_053398.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53398"
}
```



---

archive/issue_events_053399.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53399"
}
```



---

archive/issue_comments_060080.json:
```json
{
    "body": "<a id='comment:10'></a>\nProposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.",
    "created_at": "2020-08-18T00:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60080",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Proposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.



---

archive/issue_events_053400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53400"
}
```



---

archive/issue_events_053401.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53401"
}
```



---

archive/issue_events_053402.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:26:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53402"
}
```



---

archive/issue_events_053403.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-08-25T09:26:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53403"
}
```



---

archive/issue_comments_060081.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-08-25T09:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-60081",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_053404.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-31T08:12:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53404"
}
```



---

archive/issue_events_053405.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-31T08:12:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-53405"
}
```
