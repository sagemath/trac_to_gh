# Issue 7629: Make it possible to restrict the domains of email addresses

archive/issues_007629.json:
```json
{
    "body": "I'm setting up a campus server, and it would extremely useful if I could require valid email addresses and restrict email addresses to campus addresses.  This would allow anyone with a valid campus email address to create an account.\n\nNote that for this to work, we also need to make it required to confirm email addresses before accounts are activated.\n\nAssignee: @williamstein\n\nCC:  @dandrake @fchapoton\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: Dima Pasechnik\n\nAuthor: Mitesh Patel\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/7629\n\n",
    "closed_at": "2020-08-31T08:12:43Z",
    "created_at": "2009-12-08T19:58:17Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make it possible to restrict the domains of email addresses",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7629",
    "user": "https://github.com/jasongrout"
}
```
I'm setting up a campus server, and it would extremely useful if I could require valid email addresses and restrict email addresses to campus addresses.  This would allow anyone with a valid campus email address to create an account.

Note that for this to work, we also need to make it required to confirm email addresses before accounts are activated.

Assignee: @williamstein

CC:  @dandrake @fchapoton

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Dima Pasechnik

Author: Mitesh Patel

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/7629





---

archive/issue_comments_065063.json:
```json
{
    "body": "<a id='comment:1'></a>See #7630",
    "created_at": "2009-12-08T20:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65063",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>See #7630



---

archive/issue_comments_065064.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2010-01-19T09:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65064",
    "user": "https://github.com/TimDumol"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_065065.json:
```json
{
    "body": "Validate with extra regexp from notebook settings.  Depends on #8038.  sagenb repo.",
    "created_at": "2010-01-28T06:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65065",
    "user": "https://github.com/qed777"
}
```

Validate with extra regexp from notebook settings.  Depends on #8038.  sagenb repo.



---

archive/issue_comments_065066.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-28T06:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65066",
    "user": "https://github.com/qed777"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_065067.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_7629-validate_email_custom.patch](tarball://root/attachments/some-uuid/ticket7629/trac_7629-validate_email_custom.patch) by @qed777 created at 2010-01-28 06:28:57\n\nThe patch is from #8038's V3.",
    "created_at": "2010-01-28T06:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65067",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>Attachment [trac_7629-validate_email_custom.patch](tarball://root/attachments/some-uuid/ticket7629/trac_7629-validate_email_custom.patch) by @qed777 created at 2010-01-28 06:28:57

The patch is from #8038's V3.



---

archive/issue_comments_065068.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-02-08T13:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65068",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_065069.json:
```json
{
    "body": "<a id='comment:4'></a>This needs a bit of work. \n\nFirst, is it possible to doctest this? Ultimately, the function is just doing a regex match, so we should be able to doctest it...but I don't exactly know how.\n\nSecond, I think `re.search` would be better than `re.match`; search finds the regex anywhere in the string, but match by default only looks at the beginning of the string (http://docs.python.org/library/re.html). We can use `re.search` and anyone who needs the regex to match at the beginning of the string can use `^`. I thought the patch was broken until I looked this up in the Python documentation, so others will definitely run into this.\n\nFinally, it would be nice to distinguish between invalid email addresses and disallowed addresses. Invalid is something like \"two..dots`@`foo.com\"; disallowed is something that the server admin doesn't allow. I say this because I'm anticipating emails from people outside of campus saying \"the server says my email isn't valid, but it is, really!\" and then I'd have to explain. Ideally, I'd like something like \"The server administrator has restricted the email addresses that can be used here, and yours is not allowed.\"\n\nWith doctests and `re.search`, I'll give this a positive review.",
    "created_at": "2010-02-08T13:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65069",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>This needs a bit of work. 

First, is it possible to doctest this? Ultimately, the function is just doing a regex match, so we should be able to doctest it...but I don't exactly know how.

Second, I think `re.search` would be better than `re.match`; search finds the regex anywhere in the string, but match by default only looks at the beginning of the string (http://docs.python.org/library/re.html). We can use `re.search` and anyone who needs the regex to match at the beginning of the string can use `^`. I thought the patch was broken until I looked this up in the Python documentation, so others will definitely run into this.

Finally, it would be nice to distinguish between invalid email addresses and disallowed addresses. Invalid is something like "two..dots`@`foo.com"; disallowed is something that the server admin doesn't allow. I say this because I'm anticipating emails from people outside of campus saying "the server says my email isn't valid, but it is, really!" and then I'd have to explain. Ideally, I'd like something like "The server administrator has restricted the email addresses that can be used here, and yours is not allowed."

With doctests and `re.search`, I'll give this a positive review.



---

archive/issue_events_018132.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18132"
}
```



---

archive/issue_events_018133.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18133"
}
```



---

archive/issue_events_018134.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18134"
}
```



---

archive/issue_events_018135.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18135"
}
```



---

archive/issue_events_018136.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18136"
}
```



---

archive/issue_events_018137.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18137"
}
```



---

archive/issue_events_018138.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18138"
}
```



---

archive/issue_comments_065070.json:
```json
{
    "body": "<a id='comment:9'></a>https://github.com/sagemath/sagenb/issues/298",
    "created_at": "2014-12-10T20:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65070",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>https://github.com/sagemath/sagenb/issues/298



---

archive/issue_events_018139.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18139"
}
```



---

archive/issue_events_018140.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-18T00:36:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18140"
}
```



---

archive/issue_comments_065071.json:
```json
{
    "body": "<a id='comment:10'></a>Proposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.",
    "created_at": "2020-08-18T00:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65071",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Proposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.



---

archive/issue_comments_065072.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-18T00:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65072",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_065073.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-25T09:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65073",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_018141.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-31T08:12:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7629#event-18141"
}
```



---

archive/issue_comments_065074.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-08-31T08:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7629#issuecomment-65074",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid
