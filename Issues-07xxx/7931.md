# Issue 7931: Improved nth root for finite fields and integer_mods

archive/issues_007931.json:
```json
{
    "body": "Implements an algorithm described in \n\n```\nJohnston, Anna M. A generalized qth root algorithm. \nProceedings of the tenth annual ACM-SIAM symposium on Discrete algorithms. \nBaltimore, 1999: pp 929-930.\n```\n\nThis means we can take nth roots with large n, since we no longer need to create the polynomial x<sup>n</sup> - a.\n\n**Assignee:** @roed314\n\n**CC:**  @robertwb\n\n**Keywords:** finite fields, nth root\n\n**Author:** David Roe\n\n**Reviewer:** Paul Zimmermann, David Loeffler, Bill Hart\n\n**Merged:** sage-4.6.2.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/7931\n\n",
    "closed_at": "2011-02-07T08:14:22Z",
    "created_at": "2010-01-14T15:27:30Z",
    "labels": [
        "component: algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Improved nth root for finite fields and integer_mods",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7931",
    "user": "https://github.com/roed314"
}
```
Implements an algorithm described in 

```
Johnston, Anna M. A generalized qth root algorithm. 
Proceedings of the tenth annual ACM-SIAM symposium on Discrete algorithms. 
Baltimore, 1999: pp 929-930.
```

This means we can take nth roots with large n, since we no longer need to create the polynomial x<sup>n</sup> - a.

**Assignee:** @roed314

**CC:**  @robertwb

**Keywords:** finite fields, nth root

**Author:** David Roe

**Reviewer:** Paul Zimmermann, David Loeffler, Bill Hart

**Merged:** sage-4.6.2.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/7931





---

archive/attachments_009719.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931.patch",
    "created_at": "2010-01-14T15:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062152.json:
```json
{
    "body": "",
    "created_at": "2010-01-14T15:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62152",
    "user": "https://github.com/roed314"
}
```





---

archive/issue_comments_062153.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,9 @@\n Implements an algorithm described in \n-{{\n+\n+```\n Johnston, Anna M. A generalized qth root algorithm. \n Proceedings of the tenth annual ACM-SIAM symposium on Discrete algorithms. \n Baltimore, 1999: pp 929-930.\n-}}}\n+```\n \n-This means we can take nth roots with large n, since we no longer need to create the polynomial x^n-a.\n+This means we can take nth roots with large n, since we no longer need to create the polynomial x<sup>n</sup> - a.\n``````\n",
    "created_at": "2010-01-14T15:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62153",
    "user": "https://github.com/roed314"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,9 @@
 Implements an algorithm described in 
-{{
+
+```
 Johnston, Anna M. A generalized qth root algorithm. 
 Proceedings of the tenth annual ACM-SIAM symposium on Discrete algorithms. 
 Baltimore, 1999: pp 929-930.
-}}}
+```
 
-This means we can take nth roots with large n, since we no longer need to create the polynomial x^n-a.
+This means we can take nth roots with large n, since we no longer need to create the polynomial x<sup>n</sup> - a.
``````




---

archive/issue_events_055024.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-01-14T15:30:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55024"
}
```



---

archive/issue_comments_062154.json:
```json
{
    "body": "<a id='comment:2'></a>\nIs there something I am missing?\n\n```\nsage: K = GF(31)\nsage: b=K(22)^200\nsage: b.nth_root(200)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/virtual/scratch/rishi/sage-4.3.1.alpha2-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()\n\n/virtual/scratch/rishi/sage-4.3.1.alpha2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/rings/integer_mod.so in sage.rings.integer_mod.IntegerMod_abstract.nth_root (sage/rings/integer_mod.c:11446)()\n\nValueError: no nth root\nsage:\n\n```",
    "created_at": "2010-01-21T17:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62154",
    "user": "https://github.com/rishikesha"
}
```

<a id='comment:2'></a>
Is there something I am missing?

```
sage: K = GF(31)
sage: b=K(22)^200
sage: b.nth_root(200)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/virtual/scratch/rishi/sage-4.3.1.alpha2-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()

/virtual/scratch/rishi/sage-4.3.1.alpha2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/rings/integer_mod.so in sage.rings.integer_mod.IntegerMod_abstract.nth_root (sage/rings/integer_mod.c:11446)()

ValueError: no nth root
sage:

```



---

archive/issue_comments_062155.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt looks to me as if the original code (now deleted) worked with finite field elements, while thie new code works with integer-mods.  That must surely mean that for non-prime finite fields there was something which worked, but now there isn't?  If I am right, it would be a good idea to allow the original code as a fall-back.",
    "created_at": "2010-01-24T18:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62155",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
It looks to me as if the original code (now deleted) worked with finite field elements, while thie new code works with integer-mods.  That must surely mean that for non-prime finite fields there was something which worked, but now there isn't?  If I am right, it would be a good idea to allow the original code as a fall-back.



---

archive/issue_events_055025.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-24T18:54:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55025"
}
```



---

archive/issue_events_055026.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-24T18:54:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55026"
}
```



---

archive/issue_comments_062156.json:
```json
{
    "body": "<a id='comment:4'></a>\nPatch applies fine to 4.3.1 and tests pass, but I reproduced the example from rishi, so -- \"needs work\".",
    "created_at": "2010-01-24T18:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62156",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Patch applies fine to 4.3.1 and tests pass, but I reproduced the example from rishi, so -- "needs work".



---

archive/attachments_009720.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_nth_root.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_nth_root.patch",
    "created_at": "2010-02-23T15:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062157.json:
```json
{
    "body": "Should fix the problem observed earlier",
    "created_at": "2010-02-23T15:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62157",
    "user": "https://github.com/roed314"
}
```

Should fix the problem observed earlier



---

archive/issue_events_055027.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:30:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55027"
}
```



---

archive/issue_events_055028.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-23T15:30:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55028"
}
```



---

archive/issue_comments_062158.json:
```json
{
    "body": "<a id='comment:6'></a>\nDavid, should the 2nd patch be applied after the 1st one or alone?",
    "created_at": "2010-02-25T22:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62158",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:6'></a>
David, should the 2nd patch be applied after the 1st one or alone?



---

archive/issue_events_055029.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-02-25T22:29:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55029"
}
```



---

archive/issue_events_055030.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-02-25T22:29:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55030"
}
```



---

archive/issue_comments_062159.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlone.  Sorry about that.",
    "created_at": "2010-02-25T23:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62159",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
Alone.  Sorry about that.



---

archive/issue_events_055031.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-25T23:46:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55031"
}
```



---

archive/issue_events_055032.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-02-25T23:46:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55032"
}
```



---

archive/issue_comments_062160.json:
```json
{
    "body": "**Changing assignee** from @aghitza to @roed314.",
    "created_at": "2010-02-25T23:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62160",
    "user": "https://github.com/roed314"
}
```

**Changing assignee** from @aghitza to @roed314.



---

archive/issue_comments_062161.json:
```json
{
    "body": "<a id='comment:8'></a>\nOops.  I made it depend on a bunch of other changes\n\n```\n8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> this patch\n```\n\nThe actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.",
    "created_at": "2010-02-25T23:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62161",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>
Oops.  I made it depend on a bunch of other changes

```
8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> this patch
```

The actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.



---

archive/issue_comments_062162.json:
```json
{
    "body": "<a id='comment:9'></a>\n> The actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.\n\n\nthat would be nice. Otherwise we can wait for the other patches to be reviewed.\nPaul",
    "created_at": "2010-02-26T08:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62162",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:9'></a>
> The actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.


that would be nice. Otherwise we can wait for the other patches to be reviewed.
Paul



---

archive/issue_comments_062163.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [roed](#comment%3A8):\n> Oops.  I made it depend on a bunch of other changes\n> \n> ```\n> 8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> this patch\n> ```\n> \n> The actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.\n\n\nJust so we have trac's help to see which of the dependencies have already been merged: this depends on #8218, #8332, #7880, #7883, #8333, #8334.",
    "created_at": "2010-06-05T00:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62163",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:10'></a>
Replying to [roed](#comment%3A8):
> Oops.  I made it depend on a bunch of other changes
> 
> ```
> 8218 -> 8332 -> 7880 -> 7883 -> 8333 -> 8334 -> this patch
> ```
> 
> The actual change is fairly small; I'll try to extract it out and get something based only on 4.3.3, but I won't be able to do that tonight.


Just so we have trac's help to see which of the dependencies have already been merged: this depends on #8218, #8332, #7880, #7883, #8333, #8334.



---

archive/issue_comments_062164.json:
```json
{
    "body": "<a id='comment:11'></a>\nPatch `7931_nth_root.patch` applies and builds fine and all doctests in `finite_rings` pass (with the dependencies installed); but I'm not terribly happy about the amount of code duplication that's going on -- the code added to `element_base` and `integer_mod` has about 30 lines that are virtually identical. Could it not be refactored to avoid this?",
    "created_at": "2010-09-27T10:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62164",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:11'></a>
Patch `7931_nth_root.patch` applies and builds fine and all doctests in `finite_rings` pass (with the dependencies installed); but I'm not terribly happy about the amount of code duplication that's going on -- the code added to `element_base` and `integer_mod` has about 30 lines that are virtually identical. Could it not be refactored to avoid this?



---

archive/issue_comments_062165.json:
```json
{
    "body": "<a id='comment:12'></a>\nI completely agree.  In the long run I want to change `FiniteFieldElement` to `FiniteRingElement` and make `IntegerMod_abstract` inherit from that.  The `nth_root` function on `FiniteRingElement` can then be modified to handle both cases.  An additional benefit of having such a common parent is that the finite field elements can then no longer require `p` prime (or `modulus` irreducible for that matter), which will be useful for p-adic extensions.  In fact, I want to modify the finite field element classes to use templates (a la `sage.rings.polynomial.polynomial_template`): then we can share common code between polynomials, finite fields and rings, and p-adic extension fields.  Coercions between them will be much easier and faster and it will make implementing extensions of extensions easier (which are necessary for p-adic extensions that are neither unramified nor totally ramified).\n\nThe first step though, of making `IntegerMod_abstract` inherit from `FiniteRingElement` caused compile-time bugs that I couldn't figure out and I gave up for the moment.\n\nSo currently their closest common superclass is `CommutativeRingElement`.  It didn't seem like a good idea to put the common `nth_root` code there, and there wasn't another obvious way to do it.  Any suggestions?",
    "created_at": "2010-09-27T17:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62165",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'></a>
I completely agree.  In the long run I want to change `FiniteFieldElement` to `FiniteRingElement` and make `IntegerMod_abstract` inherit from that.  The `nth_root` function on `FiniteRingElement` can then be modified to handle both cases.  An additional benefit of having such a common parent is that the finite field elements can then no longer require `p` prime (or `modulus` irreducible for that matter), which will be useful for p-adic extensions.  In fact, I want to modify the finite field element classes to use templates (a la `sage.rings.polynomial.polynomial_template`): then we can share common code between polynomials, finite fields and rings, and p-adic extension fields.  Coercions between them will be much easier and faster and it will make implementing extensions of extensions easier (which are necessary for p-adic extensions that are neither unramified nor totally ramified).

The first step though, of making `IntegerMod_abstract` inherit from `FiniteRingElement` caused compile-time bugs that I couldn't figure out and I gave up for the moment.

So currently their closest common superclass is `CommutativeRingElement`.  It didn't seem like a good idea to put the common `nth_root` code there, and there wasn't another obvious way to do it.  Any suggestions?



---

archive/issue_comments_062166.json:
```json
{
    "body": "<a id='comment:13'></a>\nAnother problem with the current patch is that for large `n`, finding the factorization of the size of the unit group becomes a bottleneck.  There's a change in #8335 that  helps with this problem for finite fields of small characteristic by caching the factorization of p<sup>n</sup>-1 and using the Cunningham package at #7240 to speed up the computation in the first place.  Thematically it would make sense to backport it to this patch (which I've done already locally), but it makes this patch depend on #7240 (otherwise there are warnings printed when `_factor_cunningham` is used).  What do you think?",
    "created_at": "2010-09-27T17:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62166",
    "user": "https://github.com/roed314"
}
```

<a id='comment:13'></a>
Another problem with the current patch is that for large `n`, finding the factorization of the size of the unit group becomes a bottleneck.  There's a change in #8335 that  helps with this problem for finite fields of small characteristic by caching the factorization of p<sup>n</sup>-1 and using the Cunningham package at #7240 to speed up the computation in the first place.  Thematically it would make sense to backport it to this patch (which I've done already locally), but it makes this patch depend on #7240 (otherwise there are warnings printed when `_factor_cunningham` is used).  What do you think?



---

archive/issue_comments_062167.json:
```json
{
    "body": "<a id='comment:14'></a>\nCould one perhaps have an auxilliary helper function (not a class method) that both of the nth root methods call? This is not terribly elegant, but it solves the duplication issue.\n\nI'd argue for not making this patch depend on #7240, since that patch seems to be stalled at the moment.",
    "created_at": "2010-09-27T17:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62167",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:14'></a>
Could one perhaps have an auxilliary helper function (not a class method) that both of the nth root methods call? This is not terribly elegant, but it solves the duplication issue.

I'd argue for not making this patch depend on #7240, since that patch seems to be stalled at the moment.



---

archive/attachments_009721.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_nth_root.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_nth_root.2.patch",
    "created_at": "2010-09-28T08:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062168.json:
```json
{
    "body": "Apply just this patch",
    "created_at": "2010-09-28T08:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62168",
    "user": "https://github.com/roed314"
}
```

Apply just this patch



---

archive/issue_comments_062169.json:
```json
{
    "body": "<a id='comment:15'></a>\nI factored out most of the common code, and backported a few changes from #8335.  It still doesn't depend on #7240.",
    "created_at": "2010-09-28T08:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62169",
    "user": "https://github.com/roed314"
}
```

<a id='comment:15'></a>
I factored out most of the common code, and backported a few changes from #8335.  It still doesn't depend on #7240.



---

archive/issue_comments_062170.json:
```json
{
    "body": "Apply on top of 7931_nth_root.2.patch; moves _nth_root_common to FiniteRingElement, a new superclass of IntegerMod_abstract and the finite field elements",
    "created_at": "2010-09-29T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62170",
    "user": "https://github.com/roed314"
}
```

Apply on top of 7931_nth_root.2.patch; moves _nth_root_common to FiniteRingElement, a new superclass of IntegerMod_abstract and the finite field elements



---

archive/issue_events_055033.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-29T08:57:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55033"
}
```



---

archive/issue_events_055034.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-29T08:57:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55034"
}
```



---

archive/attachments_009722.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_common_superclass.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_common_superclass.patch",
    "created_at": "2010-09-29T08:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/zimmermann6"
}
```



---

archive/issue_comments_062171.json:
```json
{
    "body": "<a id='comment:16'></a>\nI tried applying both patches in sage-4.6.alpha1, but got a failure when running sage -br:\n\n```\npython `which cython` --embed-positions --directive cdivision=True -I/tmp/sage-4.6.alpha1/devel/sage-7931 -o sage/rings/finite_rings/element_ntl_gf2e.cpp sage/rings/finite_rings/element_ntl_gf2e.pyx\n\nError converting Pyrex file to C:\n------------------------------------------------------------\n...\n        if PY_TYPE_CHECK(e, int) \\\n               or PY_TYPE_CHECK(e, long) or PY_TYPE_CHECK(e, Integer):\n            GF2E_conv_long(res.x,int(e))\n            return res\n\n        if PY_TYPE_CHECK(e, FiniteFieldElement) or \\\n                                             ^\n------------------------------------------------------------\n\n/tmp/sage-4.6.alpha1/devel/sage-7931/sage/rings/finite_rings/element_ntl_gf2e.pyx:515:46: undeclared name not builtin: FiniteFieldElement\nError running command, failed with status 256.\nsage: There was an error installing modified sage library code.\n```\nWhich version was used to produce the patches?\n\nPaul",
    "created_at": "2010-09-29T08:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62171",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:16'></a>
I tried applying both patches in sage-4.6.alpha1, but got a failure when running sage -br:

```
python `which cython` --embed-positions --directive cdivision=True -I/tmp/sage-4.6.alpha1/devel/sage-7931 -o sage/rings/finite_rings/element_ntl_gf2e.cpp sage/rings/finite_rings/element_ntl_gf2e.pyx

Error converting Pyrex file to C:
------------------------------------------------------------
...
        if PY_TYPE_CHECK(e, int) \
               or PY_TYPE_CHECK(e, long) or PY_TYPE_CHECK(e, Integer):
            GF2E_conv_long(res.x,int(e))
            return res

        if PY_TYPE_CHECK(e, FiniteFieldElement) or \
                                             ^
------------------------------------------------------------

/tmp/sage-4.6.alpha1/devel/sage-7931/sage/rings/finite_rings/element_ntl_gf2e.pyx:515:46: undeclared name not builtin: FiniteFieldElement
Error running command, failed with status 256.
sage: There was an error installing modified sage library code.
```
Which version was used to produce the patches?

Paul



---

archive/issue_comments_062172.json:
```json
{
    "body": "**Reviewer:** Paul Zimmermann",
    "created_at": "2010-09-29T08:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62172",
    "user": "https://github.com/zimmermann6"
}
```

**Reviewer:** Paul Zimmermann



---

archive/issue_comments_062173.json:
```json
{
    "body": "<a id='comment:17'></a>\nI realized that I should also apply the patches #7883 and #8334, which were included in\nsage-4.6.alpha2, but were not yet in sage-4.6.alpha1. However after importing #7883\nsuccessfully in sage-4.6.alpha1, importing #8334 gives:\n\n```\nsage: hg_sage.import_patch(\"/tmp/8333_8334_ALL-better_commit_string.patch\")\ncd \"/tmp/sage-4.6.alpha1/devel/sage\" && hg status\ncd \"/tmp/sage-4.6.alpha1/devel/sage\" && hg status\ncd \"/tmp/sage-4.6.alpha1/devel/sage\" && hg import   \"/tmp/8333_8334_ALL-better_commit_string.patch\"\napplying /tmp/8333_8334_ALL-better_commit_string.patch\npatching file sage/rings/ideal_monoid.py\nHunk #1 succeeded at 90 with fuzz 2 (offset 0 lines).\npatching file sage/rings/residue_field.pyx\nHunk #3 succeeded at 74 with fuzz 2 (offset 0 lines).\nHunk #15 FAILED at 624\n1 out of 36 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej\nabort: patch failed to apply\n```\nand I'm stuck there. Maybe I should wait that sage-4.6.alpha2 is out.\n\nPaul",
    "created_at": "2010-09-29T09:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62173",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:17'></a>
I realized that I should also apply the patches #7883 and #8334, which were included in
sage-4.6.alpha2, but were not yet in sage-4.6.alpha1. However after importing #7883
successfully in sage-4.6.alpha1, importing #8334 gives:

```
sage: hg_sage.import_patch("/tmp/8333_8334_ALL-better_commit_string.patch")
cd "/tmp/sage-4.6.alpha1/devel/sage" && hg status
cd "/tmp/sage-4.6.alpha1/devel/sage" && hg status
cd "/tmp/sage-4.6.alpha1/devel/sage" && hg import   "/tmp/8333_8334_ALL-better_commit_string.patch"
applying /tmp/8333_8334_ALL-better_commit_string.patch
patching file sage/rings/ideal_monoid.py
Hunk #1 succeeded at 90 with fuzz 2 (offset 0 lines).
patching file sage/rings/residue_field.pyx
Hunk #3 succeeded at 74 with fuzz 2 (offset 0 lines).
Hunk #15 FAILED at 624
1 out of 36 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej
abort: patch failed to apply
```
and I'm stuck there. Maybe I should wait that sage-4.6.alpha2 is out.

Paul



---

archive/issue_comments_062174.json:
```json
{
    "body": "<a id='comment:18'></a>\nTicket #8334 has some other dependencies -- they are listed on that ticket (Jeroen's comment 24). With those installed the patch applies fine, and all doctests in sage/rings pass (I'm running a full ptestlong cycle now), so I'm putting this back to \"needs_review\".\n\nBy the way, Mitesh has a lovely script [merger-4.6.alpha2](http://sage.math.washington.edu/home/release/sage-4.6.alpha2/merger-4.6.alpha2), which you can run on a clean 4.6.alpha1 build and it will download and apply all of the patches and spkgs so far merged.",
    "created_at": "2010-09-29T10:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62174",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:18'></a>
Ticket #8334 has some other dependencies -- they are listed on that ticket (Jeroen's comment 24). With those installed the patch applies fine, and all doctests in sage/rings pass (I'm running a full ptestlong cycle now), so I'm putting this back to "needs_review".

By the way, Mitesh has a lovely script [merger-4.6.alpha2](http://sage.math.washington.edu/home/release/sage-4.6.alpha2/merger-4.6.alpha2), which you can run on a clean 4.6.alpha1 build and it will download and apply all of the patches and spkgs so far merged.



---

archive/issue_events_055035.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-29T10:10:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55035"
}
```



---

archive/issue_events_055036.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-09-29T10:10:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55036"
}
```



---

archive/issue_comments_062175.json:
```json
{
    "body": "<a id='comment:19'></a>\nI tried Mitesh's script on my sage-4.6.alpha1 build (after sage -b main), then I applied the two\npatches from that ticket, but I still get the same error as in comment 16.\n\nPaul",
    "created_at": "2010-09-29T11:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62175",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:19'></a>
I tried Mitesh's script on my sage-4.6.alpha1 build (after sage -b main), then I applied the two
patches from that ticket, but I still get the same error as in comment 16.

Paul



---

archive/issue_comments_062176.json:
```json
{
    "body": "<a id='comment:20'></a>\nThat's bizarre, because the patches apply and build fine for me.",
    "created_at": "2010-09-29T11:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62176",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:20'></a>
That's bizarre, because the patches apply and build fine for me.



---

archive/issue_comments_062177.json:
```json
{
    "body": "<a id='comment:21'></a>\nActually I hadn't myself tried Mitesh's script when I posted above; I just did, and I couldn't get it to work either. But it should work if you install:\n\n```\n9898_pari_decl.patch\n9753.patch\n9764_ideal_repr_new.patch\ntrac_7883-ideals-folded.patch\n8333_8334_ALL-rebased_for_9764.patch\n7931_nth_root.2.patch\n7931_common_superclass.patch\n```",
    "created_at": "2010-09-29T12:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62177",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:21'></a>
Actually I hadn't myself tried Mitesh's script when I posted above; I just did, and I couldn't get it to work either. But it should work if you install:

```
9898_pari_decl.patch
9753.patch
9764_ideal_repr_new.patch
trac_7883-ideals-folded.patch
8333_8334_ALL-rebased_for_9764.patch
7931_nth_root.2.patch
7931_common_superclass.patch
```



---

archive/issue_events_055037.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-29T14:06:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55037"
}
```



---

archive/issue_events_055038.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-29T14:06:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55038"
}
```



---

archive/issue_comments_062178.json:
```json
{
    "body": "<a id='comment:22'></a>\nI managed to apply the patches following comment 21, however the following seems incorrect to me:\n\n```\nsage: b=Integers(3)(2)\nsage: b.nth_root(2)\n1\n```\nwhereas in say Sage 4.4.4 we got `ValueError: no nth root`.\n\nPS: I used the following reviewer program. Feel free to add it to the doctests.\n\n```\nfor n in range(2,100):\n   K=Integers(n)\n   for e in range(1,100):\n      for a in range(1,n):\n         b = K(a)\n         r = b.nth_root(e)\n         if r^e <> b:\n            print n, e, a\n            raise ValueError\n```",
    "created_at": "2010-09-29T14:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62178",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:22'></a>
I managed to apply the patches following comment 21, however the following seems incorrect to me:

```
sage: b=Integers(3)(2)
sage: b.nth_root(2)
1
```
whereas in say Sage 4.4.4 we got `ValueError: no nth root`.

PS: I used the following reviewer program. Feel free to add it to the doctests.

```
for n in range(2,100):
   K=Integers(n)
   for e in range(1,100):
      for a in range(1,n):
         b = K(a)
         r = b.nth_root(e)
         if r^e <> b:
            print n, e, a
            raise ValueError
```



---

archive/issue_events_055039.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-30T00:57:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55039"
}
```



---

archive/issue_events_055040.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-30T00:57:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55040"
}
```



---

archive/issue_comments_062179.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks for catching that.  I've fixed the problem and added a `_nth_root_naive` and check that the output of `b.nth_root(e, all=True)` matches `b._nth_root_naive(e)` for all `b` in `Zmod(n)` for `2 <= n < 100` and `1 <= e < 100`.  A shortened version of this test is left in as a doctest for `_nth_root_naive`.",
    "created_at": "2010-09-30T00:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62179",
    "user": "https://github.com/roed314"
}
```

<a id='comment:23'></a>
Thanks for catching that.  I've fixed the problem and added a `_nth_root_naive` and check that the output of `b.nth_root(e, all=True)` matches `b._nth_root_naive(e)` for all `b` in `Zmod(n)` for `2 <= n < 100` and `1 <= e < 100`.  A shortened version of this test is left in as a doctest for `_nth_root_naive`.



---

archive/issue_comments_062180.json:
```json
{
    "body": "Apply on top of 7931_nth_root.2.patch and 7931_common_superclass.patch",
    "created_at": "2010-09-30T03:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62180",
    "user": "https://github.com/roed314"
}
```

Apply on top of 7931_nth_root.2.patch and 7931_common_superclass.patch



---

archive/issue_events_055041.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-30T08:19:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55041"
}
```



---

archive/issue_events_055042.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-30T08:19:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55042"
}
```



---

archive/attachments_009723.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_fixes.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_fixes.patch",
    "created_at": "2010-09-30T08:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/zimmermann6"
}
```



---

archive/issue_comments_062181.json:
```json
{
    "body": "<a id='comment:24'></a>\nwith the new patch, I still get unexpected results:\n\n```\nsage: K=Integers(6)\nsage: b=K(3)\nsage: b.nth_root(0,all=True)\n[3]\n```\nPaul",
    "created_at": "2010-09-30T08:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62181",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:24'></a>
with the new patch, I still get unexpected results:

```
sage: K=Integers(6)
sage: b=K(3)
sage: b.nth_root(0,all=True)
[3]
```
Paul



---

archive/attachments_009724.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_fix2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_fix2.patch",
    "created_at": "2010-09-30T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062182.json:
```json
{
    "body": "Apply on top of previous patches",
    "created_at": "2010-09-30T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62182",
    "user": "https://github.com/roed314"
}
```

Apply on top of previous patches



---

archive/issue_comments_062183.json:
```json
{
    "body": "<a id='comment:25'></a>\nUnexpected indeed.  Thanks for checking all these corner cases that I neglected (though some of the earlier ones were bugs I should have found if I'd tested sufficiently).\n\nIn this case I'm not quite sure what the right output is: an empty list or a ZeroDivisionError?  I've gone for the empty list, on the theory that `b.nth_root(e)` should return a list of all elements `a` with a<sup>e</sup>=b, and this makes sense even if `e=0`.",
    "created_at": "2010-09-30T09:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62183",
    "user": "https://github.com/roed314"
}
```

<a id='comment:25'></a>
Unexpected indeed.  Thanks for checking all these corner cases that I neglected (though some of the earlier ones were bugs I should have found if I'd tested sufficiently).

In this case I'm not quite sure what the right output is: an empty list or a ZeroDivisionError?  I've gone for the empty list, on the theory that `b.nth_root(e)` should return a list of all elements `a` with a<sup>e</sup>=b, and this makes sense even if `e=0`.



---

archive/issue_events_055043.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-30T09:22:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55043"
}
```



---

archive/issue_events_055044.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-09-30T09:22:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55044"
}
```



---

archive/issue_comments_062184.json:
```json
{
    "body": "<a id='comment:26'></a>\ne=0 is a hard case since there are too many solutions -- do we want to return all a in the ring? or all invertible a?\n\nSimilarly, do we allow negative e, where b must be invertible and b.nth_root(e) == (1/b).nth_root(-e), with an error if b is not invertible?\n\nOr do we want to specify in the documentation that e must be positive, and raise an error if not?",
    "created_at": "2010-09-30T10:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62184",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:26'></a>
e=0 is a hard case since there are too many solutions -- do we want to return all a in the ring? or all invertible a?

Similarly, do we allow negative e, where b must be invertible and b.nth_root(e) == (1/b).nth_root(-e), with an error if b is not invertible?

Or do we want to specify in the documentation that e must be positive, and raise an error if not?



---

archive/issue_comments_062185.json:
```json
{
    "body": "<a id='comment:27'></a>\nMy 2 cents:\n\n* for e=0 and b<>1, b.nth_root(e) should return the empty list\n\n* for e=0 and b=1, b.nth_root(e) should return only one solution, for example 1\n  (with all=True, return all a in the ring)\n\nPaul",
    "created_at": "2010-09-30T11:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62185",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:27'></a>
My 2 cents:

* for e=0 and b<>1, b.nth_root(e) should return the empty list

* for e=0 and b=1, b.nth_root(e) should return only one solution, for example 1
  (with all=True, return all a in the ring)

Paul



---

archive/issue_events_055045.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-30T12:11:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55045"
}
```



---

archive/issue_events_055046.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-09-30T12:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55046"
}
```



---

archive/issue_comments_062186.json:
```json
{
    "body": "<a id='comment:28'></a>\nsorry, another problem:\n\n```\nsage: n=13777831336991389951\nsage: b=3798677550250515336\nsage: e=10608321776141318019\nsage: K = Integers(n)\nsage: b=K(b)\nsage: b.nth_root(e)\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n```\nThe documentation does not say when `ZeroDivisionError` can be obtained.\nThis was found with the following program:\n\n```\nwhile True:\n   n = randint(0,2^64)\n   K = Integers(n)\n   b = K.random_element()\n   e = randint(0,2^64)\n   print n, b, e, a\n   sys.stdout.flush()\n   try:\n      a = b.nth_root(e)\n      if a^e <> b:\n         print n, b, e, a\n         raise NotImplementedError\n   except ValueError:\n      n = 0\n```",
    "created_at": "2010-09-30T12:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62186",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:28'></a>
sorry, another problem:

```
sage: n=13777831336991389951
sage: b=3798677550250515336
sage: e=10608321776141318019
sage: K = Integers(n)
sage: b=K(b)
sage: b.nth_root(e)
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
```
The documentation does not say when `ZeroDivisionError` can be obtained.
This was found with the following program:

```
while True:
   n = randint(0,2^64)
   K = Integers(n)
   b = K.random_element()
   e = randint(0,2^64)
   print n, b, e, a
   sys.stdout.flush()
   try:
      a = b.nth_root(e)
      if a^e <> b:
         print n, b, e, a
         raise NotImplementedError
   except ValueError:
      n = 0
```



---

archive/issue_comments_062187.json:
```json
{
    "body": "<a id='comment:29'></a>\nYou've found a bug in crt: it claims to work as long as the moduli are relatively prime, but in fact would often fail if one of them was 1.  I fixed that and clarified the behavior of `nth_root` when `n<=0` (it either returns the empty list or raises a `ValueError`, depending on the value of `all`; `mod(1,n).nth_root(0)` returns the list of all nonzero elements modulo n).",
    "created_at": "2010-10-01T06:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62187",
    "user": "https://github.com/roed314"
}
```

<a id='comment:29'></a>
You've found a bug in crt: it claims to work as long as the moduli are relatively prime, but in fact would often fail if one of them was 1.  I fixed that and clarified the behavior of `nth_root` when `n<=0` (it either returns the empty list or raises a `ValueError`, depending on the value of `all`; `mod(1,n).nth_root(0)` returns the list of all nonzero elements modulo n).



---

archive/issue_events_055047.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T06:14:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55047"
}
```



---

archive/issue_events_055048.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T06:14:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55048"
}
```



---

archive/issue_events_055049.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-10-01T12:05:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55049"
}
```



---

archive/issue_events_055050.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-10-01T12:05:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55050"
}
```



---

archive/issue_comments_062188.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [roed](#comment%3A29):\n> You've found a bug in crt: it claims to work as long as the moduli are relatively prime, but in fact would often fail if one of them was 1.  I fixed that and clarified the behavior of `nth_root` when `n<=0` (it either returns the empty list or raises a `ValueError`, depending on the value of `all`; `mod(1,n).nth_root(0)` returns the list of all nonzero elements modulo n).\n\n\nHi David,\n\nI'm not very happy with that answer. If a bug in crt was found, I would expect you to show a\nconcrete example, to report it as a new ticket, and to mention in your 3rd patch that it depends\non the new ticket, and can be removed once the new ticket is fixed.\n\nPaul",
    "created_at": "2010-10-01T12:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62188",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:30'></a>
Replying to [roed](#comment%3A29):
> You've found a bug in crt: it claims to work as long as the moduli are relatively prime, but in fact would often fail if one of them was 1.  I fixed that and clarified the behavior of `nth_root` when `n<=0` (it either returns the empty list or raises a `ValueError`, depending on the value of `all`; `mod(1,n).nth_root(0)` returns the list of all nonzero elements modulo n).


Hi David,

I'm not very happy with that answer. If a bug in crt was found, I would expect you to show a
concrete example, to report it as a new ticket, and to mention in your 3rd patch that it depends
on the new ticket, and can be removed once the new ticket is fixed.

Paul



---

archive/attachments_009725.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_fix3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_fix3.patch",
    "created_at": "2010-10-01T14:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062189.json:
```json
{
    "body": "Apply on top of previous patches",
    "created_at": "2010-10-01T14:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62189",
    "user": "https://github.com/roed314"
}
```

Apply on top of previous patches



---

archive/issue_events_055051.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T14:33:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55051"
}
```



---

archive/issue_events_055052.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T14:33:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55052"
}
```



---

archive/issue_comments_062190.json:
```json
{
    "body": "<a id='comment:31'></a>\nYou're right that it needs doctests; I've added some.  I also changed `7931_fix3.patch` by updating the `nth_root` function in `element_base` to match the behavior of the one in `integer_mod` for non-positive inputs.\n\nPersonally, I don't think that the crt bug is a major enough problem to need it's own ticket.  It only applies if one of the arguments is mod(0,1).  But I've separated the fix into its own patch; if you think it needs it's own ticket would you be willing to make the ticket and move the patch over there?",
    "created_at": "2010-10-01T14:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62190",
    "user": "https://github.com/roed314"
}
```

<a id='comment:31'></a>
You're right that it needs doctests; I've added some.  I also changed `7931_fix3.patch` by updating the `nth_root` function in `element_base` to match the behavior of the one in `integer_mod` for non-positive inputs.

Personally, I don't think that the crt bug is a major enough problem to need it's own ticket.  It only applies if one of the arguments is mod(0,1).  But I've separated the fix into its own patch; if you think it needs it's own ticket would you be willing to make the ticket and move the patch over there?



---

archive/issue_comments_062191.json:
```json
{
    "body": "<a id='comment:32'></a>\nI don't understand the crt patch: the examples given already worked in 4.6.alpha1 (and\nsimilarly in 4.4.4):\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.6.alpha1, Release Date: 2010-09-18                  |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: mod(0,1).crt(mod(4,17)) \n4\nsage: mod(0,1).crt(mod(0,1)) \n0\nsage: mod(21,22).crt(mod(0,1))\n21\n```\nWhat is exactly the crt bug (if any)?\n\nPaul",
    "created_at": "2010-10-01T15:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62191",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:32'></a>
I don't understand the crt patch: the examples given already worked in 4.6.alpha1 (and
similarly in 4.4.4):

```
----------------------------------------------------------------------
| Sage Version 4.6.alpha1, Release Date: 2010-09-18                  |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: mod(0,1).crt(mod(4,17)) 
4
sage: mod(0,1).crt(mod(0,1)) 
0
sage: mod(21,22).crt(mod(0,1))
21
```
What is exactly the crt bug (if any)?

Paul



---

archive/issue_events_055053.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-10-01T15:18:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55053"
}
```



---

archive/issue_events_055054.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2010-10-01T15:18:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55054"
}
```



---

archive/issue_events_055055.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T15:49:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55055"
}
```



---

archive/issue_events_055056.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2010-10-01T15:49:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55056"
}
```



---

archive/issue_comments_062192.json:
```json
{
    "body": "<a id='comment:33'></a>\nAh.  Now I understand why this problem only appeared with your latest test program that used large moduli.  The issue only occurs for `mod(0,1).crt(a)` when `a` has type `IntegerMod_gmp`.  So we didn't see it for smaller moduli.\n\nI've updated `7931_crt.patch`, and the doctest there does fail on my unpatched `4.6.alpha1`.",
    "created_at": "2010-10-01T15:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62192",
    "user": "https://github.com/roed314"
}
```

<a id='comment:33'></a>
Ah.  Now I understand why this problem only appeared with your latest test program that used large moduli.  The issue only occurs for `mod(0,1).crt(a)` when `a` has type `IntegerMod_gmp`.  So we didn't see it for smaller moduli.

I've updated `7931_crt.patch`, and the doctest there does fail on my unpatched `4.6.alpha1`.



---

archive/issue_comments_062193.json:
```json
{
    "body": "<a id='comment:34'></a>\nI understand now, this is really a bug, and I think it should be considered in a separate ticket:\n\n```\nsage: mod(0,1).crt(mod(4,2^31-2)) \n4\nsage: mod(0,1).crt(mod(4,2^31-1)) \n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n```",
    "created_at": "2010-10-01T15:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62193",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:34'></a>
I understand now, this is really a bug, and I think it should be considered in a separate ticket:

```
sage: mod(0,1).crt(mod(4,2^31-2)) 
4
sage: mod(0,1).crt(mod(4,2^31-1)) 
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
```



---

archive/issue_comments_062194.json:
```json
{
    "body": "<a id='comment:35'></a>\nThis is now #10047.",
    "created_at": "2010-10-01T16:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62194",
    "user": "https://github.com/roed314"
}
```

<a id='comment:35'></a>
This is now #10047.



---

archive/attachments_009726.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_crt.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_crt.patch",
    "created_at": "2010-10-01T16:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/roed314"
}
```



---

archive/issue_comments_062195.json:
```json
{
    "body": "This is now #10047.",
    "created_at": "2010-10-01T16:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62195",
    "user": "https://github.com/roed314"
}
```

This is now #10047.



---

archive/attachments_009727.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_nth_root-folded.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_nth_root-folded.patch",
    "created_at": "2011-01-19T16:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/loefflerd"
}
```



---

archive/issue_comments_062196.json:
```json
{
    "body": "Qfolded patch. Apply only this patch.",
    "created_at": "2011-01-19T16:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62196",
    "user": "https://github.com/loefflerd"
}
```

Qfolded patch. Apply only this patch.



---

archive/issue_comments_062197.json:
```json
{
    "body": "<a id='comment:36'></a>\nIt took me some while to understand what patches to apply in what order, so having done so I thought it might be helpful to qfold everything into one patch. (I'm pleasantly surprised that patchbot understood immediately.)\n\nNow I'll have a look at the code.",
    "created_at": "2011-01-19T16:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62197",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:36'></a>
It took me some while to understand what patches to apply in what order, so having done so I thought it might be helpful to qfold everything into one patch. (I'm pleasantly surprised that patchbot understood immediately.)

Now I'll have a look at the code.



---

archive/issue_comments_062198.json:
```json
{
    "body": "<a id='comment:37'></a>\nThe code looks plausible, and I'm pleased to report that we aren't going to have the same problem as #9304 -- old pickled objects seem to unpickle just fine. I'm not qualified to comment on the details of the algorithm though. Paul?",
    "created_at": "2011-01-19T17:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62198",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:37'></a>
The code looks plausible, and I'm pleased to report that we aren't going to have the same problem as #9304 -- old pickled objects seem to unpickle just fine. I'm not qualified to comment on the details of the algorithm though. Paul?



---

archive/issue_comments_062199.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [davidloeffler](#comment%3A37):\n> The code looks plausible, and I'm pleased to report that we aren't going to have the same problem as #9304 -- old pickled objects seem to unpickle just fine. I'm not qualified to comment on the details of the algorithm though. Paul?\n\n\nI won't have much time in the near future to look closely at the algorithm. Unless someone else\nhas time before me (John?) I'll look at this later. Don't hesitate to ping me.\n\nPaul",
    "created_at": "2011-01-20T07:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62199",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:38'></a>
Replying to [davidloeffler](#comment%3A37):
> The code looks plausible, and I'm pleased to report that we aren't going to have the same problem as #9304 -- old pickled objects seem to unpickle just fine. I'm not qualified to comment on the details of the algorithm though. Paul?


I won't have much time in the near future to look closely at the algorithm. Unless someone else
has time before me (John?) I'll look at this later. Don't hesitate to ping me.

Paul



---

archive/issue_comments_062200.json:
```json
{
    "body": "Fixed ReST formatting",
    "created_at": "2011-01-25T13:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62200",
    "user": "https://github.com/loefflerd"
}
```

Fixed ReST formatting



---

archive/issue_comments_062201.json:
```json
{
    "body": "**Changing reviewer** from \"Paul Zimmermann\" to \"Paul Zimmermann, David Loeffler, Bill Hart\".",
    "created_at": "2011-01-25T14:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62201",
    "user": "https://github.com/loefflerd"
}
```

**Changing reviewer** from "Paul Zimmermann" to "Paul Zimmermann, David Loeffler, Bill Hart".



---

archive/issue_events_055057.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-01-25T14:04:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55057"
}
```



---

archive/issue_events_055058.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-01-25T14:04:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55058"
}
```



---

archive/attachments_009728.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7931_nth_root-folded.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7931/7931_nth_root-folded.2.patch",
    "created_at": "2011-01-25T14:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/loefflerd"
}
```



---

archive/issue_comments_062202.json:
```json
{
    "body": "<a id='comment:39'></a>\nI checked this one with Bill Hart, who knows much more about these things than I, and he reckons that the implementation looks correct; I've run the tests and it seems to be fine. My only contribution has been to qfold everything and adjust some of the reference manual formatting, so I guess that doesn't need a separate review. \n\nApply only the last patch.",
    "created_at": "2011-01-25T14:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62202",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:39'></a>
I checked this one with Bill Hart, who knows much more about these things than I, and he reckons that the implementation looks correct; I've run the tests and it seems to be fine. My only contribution has been to qfold everything and adjust some of the reference manual formatting, so I guess that doesn't need a separate review. 

Apply only the last patch.



---

archive/issue_comments_062203.json:
```json
{
    "body": "<a id='comment:40'></a>\nGreat!  Thanks to all of the reviewers for looking at this.",
    "created_at": "2011-01-25T17:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62203",
    "user": "https://github.com/roed314"
}
```

<a id='comment:40'></a>
Great!  Thanks to all of the reviewers for looking at this.



---

archive/issue_events_055059.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T08:14:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55059"
}
```



---

archive/issue_events_055060.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-07T08:14:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7931#event-55060"
}
```



---

archive/issue_comments_062204.json:
```json
{
    "body": "**Merged:** sage-4.6.2.alpha4",
    "created_at": "2011-02-07T08:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7931#issuecomment-62204",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.6.2.alpha4
