# Issue 7890: Improve conversion of GAP objects into sage objects.

archive/issues_007890.json:
```json
{
    "body": "As of now, certain kinds of sage objects can be converted into GAP objects, but the resulting GAP objects cannot be converted back to sage objects.\n\nExamples of this are matrices over finite fields:\n\n```\nsage: g = matrix(GF(5),2,[1,2, -1, 1])\nsage: gg = g._gap_()\nsage: gg.sage()\n---------------------------------------------------------------------------\nNotImplementedError\n```\n\n```\nsage: a = gap('E(9)')\nsage: a\n-E(9)^4-E(9)^7\nsage: a.sage()\n---------------------------------------------------------------------------\nNotImplementedError  \n```\n\nBeing able to translate gap field elements into sage ones would help accesing GAP character tables, and a good conversion of matrices would allow many methods to be available for matrix groups.\n\nSee this thread at sage devel for more details:\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/a04006e5da578bd\n\n**Assignee:** @williamstein\n\n**Author:** Javier L\u00f3pez Pe\u00f1a\n\n**Status:** needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/7890\n\n",
    "created_at": "2010-01-10T10:45:46Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "title": "Improve conversion of GAP objects into sage objects.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7890",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```
As of now, certain kinds of sage objects can be converted into GAP objects, but the resulting GAP objects cannot be converted back to sage objects.

Examples of this are matrices over finite fields:

```
sage: g = matrix(GF(5),2,[1,2, -1, 1])
sage: gg = g._gap_()
sage: gg.sage()
---------------------------------------------------------------------------
NotImplementedError
```

```
sage: a = gap('E(9)')
sage: a
-E(9)^4-E(9)^7
sage: a.sage()
---------------------------------------------------------------------------
NotImplementedError  
```

Being able to translate gap field elements into sage ones would help accesing GAP character tables, and a good conversion of matrices would allow many methods to be available for matrix groups.

See this thread at sage devel for more details:
http://groups.google.com/group/sage-devel/browse_thread/thread/a04006e5da578bd

**Assignee:** @williamstein

**Author:** Javier L칩pez Pe침a

**Status:** needs_work

Issue created by migration from https://trac.sagemath.org/ticket/7890





---

archive/issue_comments_078630.json:
```json
{
    "body": "Added a _sage_ method in GapElement class (gap.py) that tries to convert matrices into sage matrices. This only work if the coefficient ring can be converted into a sage ring. Also, modified _matrix_ in the same class so that it tries to find a ring if none is given.",
    "created_at": "2010-01-10T15:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78630",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Added a _sage_ method in GapElement class (gap.py) that tries to convert matrices into sage matrices. This only work if the coefficient ring can be converted into a sage ring. Also, modified _matrix_ in the same class so that it tries to find a ring if none is given.



---

archive/issue_events_023825.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "rename": {
        "from": "[new] Improve conversion of GAP objects into sage objects.",
        "to": "Improve conversion of GAP objects into sage objects."
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7890#event-23825"
}
```



---

archive/issue_comments_078631.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2010-01-10T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78631",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_078632.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2010-01-10T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78632",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

**Changing status** from new to needs_work.



---

archive/attachments_009658.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13590.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7890/13590.patch",
    "created_at": "2010-01-10T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```



---

archive/issue_comments_078633.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2010-01-10T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78633",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:1'></a>




---

archive/issue_comments_078634.json:
```json
{
    "body": "**Author:** Javier L\u00f3pez Pe\u00f1a",
    "created_at": "2010-01-10T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78634",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

**Author:** Javier L칩pez Pe침a



---

archive/issue_comments_078635.json:
```json
{
    "body": "Conversion for finite and cyclotomic fields and their elements.",
    "created_at": "2010-01-12T00:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78635",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Conversion for finite and cyclotomic fields and their elements.



---

archive/issue_comments_078636.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-01-12T00:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78636",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

**Changing status** from needs_work to needs_review.



---

archive/attachments_009659.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13591.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7890/13591.patch",
    "created_at": "2010-01-12T00:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```



---

archive/issue_comments_078637.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe patches should be applied in order.\nThis provides conversion of finite fields, cyclotomic fields and their elements, as well as gap matrices.",
    "created_at": "2010-01-12T00:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78637",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:2'></a>
The patches should be applied in order.
This provides conversion of finite fields, cyclotomic fields and their elements, as well as gap matrices.



---

archive/issue_comments_078638.json:
```json
{
    "body": "Simplification of one of the previous functions",
    "created_at": "2010-01-12T00:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78638",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Simplification of one of the previous functions



---

archive/attachments_009660.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "13592.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7890/13592.patch",
    "created_at": "2010-01-12T00:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```



---

archive/issue_comments_078639.json:
```json
{
    "body": "Further simplifications and merging. Apply only this patch.",
    "created_at": "2010-01-12T00:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78639",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

Further simplifications and merging. Apply only this patch.



---

archive/issue_comments_078640.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-01-12T03:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78640",
    "user": "https://github.com/wdjoyner"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_009661.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "gap_to_sage.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7890/gap_to_sage.patch",
    "created_at": "2010-01-12T03:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/wdjoyner"
}
```



---

archive/issue_comments_078641.json:
```json
{
    "body": "<a id='comment:3'></a>\nLast patch applied fine to sage-4.3.a0 on a 64bit ubuntu machine, but the following tests failed:\n\n```\nThe following tests failed:\n\n\n        sage -t  \"devel/sage/sage/groups/perm_gps/permgroup.py\"\n        sage -t  \"devel/sage/sage/structure/parent.pyx\"\n        sage -t  \"devel/sage/sage/structure/parent_old.pyx\"\n        sage -t  \"devel/sage/sage/misc/sagedoc.py\"\n        sage -t  \"devel/sage/sage/misc/sage_eval.py\"\n\n```",
    "created_at": "2010-01-12T03:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78641",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:3'></a>
Last patch applied fine to sage-4.3.a0 on a 64bit ubuntu machine, but the following tests failed:

```
The following tests failed:


        sage -t  "devel/sage/sage/groups/perm_gps/permgroup.py"
        sage -t  "devel/sage/sage/structure/parent.pyx"
        sage -t  "devel/sage/sage/structure/parent_old.pyx"
        sage -t  "devel/sage/sage/misc/sagedoc.py"
        sage -t  "devel/sage/sage/misc/sage_eval.py"

```



---

archive/issue_comments_078642.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Javier,\n\nWhat are your intentions regarding http://trac.sagemath.org/sage_trac/ticket/7890\nIt seems to have got dropped over two years ago.  Now none of the patches apply to recent\nversions of Sage.  I wonder if you're planning to clean this up and finish it?\n\n -- William",
    "created_at": "2012-03-19T20:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78642",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>
Hi Javier,

What are your intentions regarding http://trac.sagemath.org/sage_trac/ticket/7890
It seems to have got dropped over two years ago.  Now none of the patches apply to recent
versions of Sage.  I wonder if you're planning to clean this up and finish it?

 -- William



---

archive/issue_comments_078643.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi William,\n\nyeah, sorry about that. I changed jobs in 2010 and my whole work plan went south.\nI would like to get this thing working eventually, but I don't believe the approach I was trying is a good one. The lack of types in GAP creates some ambiguity in gap elements that can have different parents and where a choice needs to be made.\n\nProbably a better approach would be to provide an optional argument `sage_parent` to the `_sage_` function in GapElement, and then put the heavy lift into the sage parent where an ad-hoc gap-to-sage function can be defined, something like this:\n\n```\ndef _sage_(self, sage_parent = None):\n    if sage_parent is not None:\n        return sage_parent._call_from_gap(self)\n    else:\n        .... # The function as it used to work\n\n```\n\nIn this way, anyone creating a sage structure could implement their own \"take an element from gap here\" function rather than mess up with the interface. How does that sound?\n\nIn any case it might make sense to wait a little bit and get GAP 4.5 working first, as it seems [the representation of some objects has changed](http://www.gap-system.org/Manuals/doc/changes/chap2.html).",
    "created_at": "2012-06-15T07:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78643",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlopez"
}
```

<a id='comment:5'></a>
Hi William,

yeah, sorry about that. I changed jobs in 2010 and my whole work plan went south.
I would like to get this thing working eventually, but I don't believe the approach I was trying is a good one. The lack of types in GAP creates some ambiguity in gap elements that can have different parents and where a choice needs to be made.

Probably a better approach would be to provide an optional argument `sage_parent` to the `_sage_` function in GapElement, and then put the heavy lift into the sage parent where an ad-hoc gap-to-sage function can be defined, something like this:

```
def _sage_(self, sage_parent = None):
    if sage_parent is not None:
        return sage_parent._call_from_gap(self)
    else:
        .... # The function as it used to work

```

In this way, anyone creating a sage structure could implement their own "take an element from gap here" function rather than mess up with the interface. How does that sound?

In any case it might make sense to wait a little bit and get GAP 4.5 working first, as it seems [the representation of some objects has changed](http://www.gap-system.org/Manuals/doc/changes/chap2.html).



---

archive/issue_comments_078644.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello,\n\nWith #18152, it works fine for cyclotomic elements (because I introduced a function `E` in the global namespace)\n\n```\nsage: a = gap('E(9)')\nsage: a.sage()\n-E(9)^4 - E(9)^7\n```\n\nVincent",
    "created_at": "2015-04-09T22:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78644",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Hello,

With #18152, it works fine for cyclotomic elements (because I introduced a function `E` in the global namespace)

```
sage: a = gap('E(9)')
sage: a.sage()
-E(9)^4 - E(9)^7
```

Vincent



---

archive/issue_comments_078645.json:
```json
{
    "body": "<a id='comment:7'></a>\nNote that with the new `libgap` the conversion works almost fine for matrices (it is converted into a list of lists instead of a matrix)\n\n```\nsage: m = matrix(GF(5), 2, [1,2,-1,1])\nsage: a = m._libgap_().sage()\nsage: a\n[[1, 2], [4, 1]]\nsage: matrix(a) == m\nTrue\n```",
    "created_at": "2015-04-11T22:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7890#issuecomment-78645",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
Note that with the new `libgap` the conversion works almost fine for matrices (it is converted into a list of lists instead of a matrix)

```
sage: m = matrix(GF(5), 2, [1,2,-1,1])
sage: a = m._libgap_().sage()
sage: a
[[1, 2], [4, 1]]
sage: matrix(a) == m
True
```
