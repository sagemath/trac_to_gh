# Issue 7823: libgcrypt-1.4.4.p1 references incorrect shared library on FreeBSD

archive/issues_007823.json:
```json
{
    "assignees": [],
    "body": "Chase shared library name difference on FreeBSD.  Otherwise the gnutls build fails similar to:\n\n```\n(cd /home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/libextra; /bin/sh ../libtool  --tag=CC --mode=relink gcc -std=gnu99 -g -O2 -D_REENTRANT -D_THREAD_SAFE -pipe -I/home/peter/sage/sage-4.3/local/include -g -O2 -D_REENTRANT -D_THREAD_SAFE -Wno-pointer-sign -no-undefined -L../lib/.libs -L/home/peter/sage/sage-4.3/local/lib -lopencdk -L/usr/local/lib -L/usr/local/lib -lgcrypt -L/usr/local/lib -lgpg-error -L/usr/local/lib -lintl -L/usr/local/lib -liconv -L/home/peter/sage/sage-4.3/local/lib -lz -R/home/peter/sage/sage-4.3/local/lib -R/usr/local/lib -version-info 27:2:1 -o libgnutls-extra.la -rpath /home/peter/sage/sage-4.3/local/lib gnutls_extra.lo gnutls_openpgp.lo gnutls_ia.lo openpgp/libgnutls_openpgp.la ../lgl/liblgnu.la ../lib/libgnutls.la minilzo/libminilzo.la )  \ngcc -std=gnu99 -shared  .libs/gnutls_extra.o .libs/gnutls_openpgp.o .libs/gnutls_ia.o -Wl,--whole-archive openpgp/.libs/libgnutls_openpgp.a ../lgl/.libs/liblgnu.a minilzo/.libs/libminilzo.a -Wl,--no-whole-archive  -Wl,--rpath -Wl,/home/peter/sage/sage-4.3/local/lib -Wl,--rpath -Wl,/usr/local/lib -L/home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/lib/.libs -L/home/peter/sage/sage-4.3/local/lib -lopencdk -L/usr/local/lib -lz -lgcrypt -lintl -liconv -lgpg-error -lgnutls  -Wl,-soname -Wl,libgnutls-extra.so.27 -o .libs/libgnutls-extra.so.27\n/usr/bin/ld: /home/peter/sage/sage-4.3/local/lib/libgcrypt.a(libgcrypt_la-visibility.o): relocation R_X86_64_32 can not be used when making a shared object; recompile with -fPIC\n/home/peter/sage/sage-4.3/local/lib/libgcrypt.a: could not read symbols: Bad value\nlibtool: install: error: relink `libgnutls-extra.la' with the above command before installing it\n*** Error code 1\n\nStop in /home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/libextra.\n*** Error code 1\n```\n\n\nAssignee: **@peterjeremy**\n\nCC:  drkirkby @williamstein\n\nReviewer: **David Kirkby**\n\nAuthor: **Peter Jeremy**\n\nMerged: **sage-4.3.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7823_\n\n",
    "closed_at": "2010-01-24T14:18:47Z",
    "created_at": "2010-01-03T01:53:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20bsd",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "libgcrypt-1.4.4.p1 references incorrect shared library on FreeBSD",
    "type": "issue",
    "updated_at": "2023-01-08T09:03:58Z",
    "url": "https://github.com/sagemath/sage/issues/7823",
    "user": "https://github.com/peterjeremy"
}
```
Chase shared library name difference on FreeBSD.  Otherwise the gnutls build fails similar to:

```
(cd /home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/libextra; /bin/sh ../libtool  --tag=CC --mode=relink gcc -std=gnu99 -g -O2 -D_REENTRANT -D_THREAD_SAFE -pipe -I/home/peter/sage/sage-4.3/local/include -g -O2 -D_REENTRANT -D_THREAD_SAFE -Wno-pointer-sign -no-undefined -L../lib/.libs -L/home/peter/sage/sage-4.3/local/lib -lopencdk -L/usr/local/lib -L/usr/local/lib -lgcrypt -L/usr/local/lib -lgpg-error -L/usr/local/lib -lintl -L/usr/local/lib -liconv -L/home/peter/sage/sage-4.3/local/lib -lz -R/home/peter/sage/sage-4.3/local/lib -R/usr/local/lib -version-info 27:2:1 -o libgnutls-extra.la -rpath /home/peter/sage/sage-4.3/local/lib gnutls_extra.lo gnutls_openpgp.lo gnutls_ia.lo openpgp/libgnutls_openpgp.la ../lgl/liblgnu.la ../lib/libgnutls.la minilzo/libminilzo.la )  
gcc -std=gnu99 -shared  .libs/gnutls_extra.o .libs/gnutls_openpgp.o .libs/gnutls_ia.o -Wl,--whole-archive openpgp/.libs/libgnutls_openpgp.a ../lgl/.libs/liblgnu.a minilzo/.libs/libminilzo.a -Wl,--no-whole-archive  -Wl,--rpath -Wl,/home/peter/sage/sage-4.3/local/lib -Wl,--rpath -Wl,/usr/local/lib -L/home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/lib/.libs -L/home/peter/sage/sage-4.3/local/lib -lopencdk -L/usr/local/lib -lz -lgcrypt -lintl -liconv -lgpg-error -lgnutls  -Wl,-soname -Wl,libgnutls-extra.so.27 -o .libs/libgnutls-extra.so.27
/usr/bin/ld: /home/peter/sage/sage-4.3/local/lib/libgcrypt.a(libgcrypt_la-visibility.o): relocation R_X86_64_32 can not be used when making a shared object; recompile with -fPIC
/home/peter/sage/sage-4.3/local/lib/libgcrypt.a: could not read symbols: Bad value
libtool: install: error: relink `libgnutls-extra.la' with the above command before installing it
*** Error code 1

Stop in /home/peter/sage/sage-4.3/spkg/build/gnutls-2.2.1.p4/src/libextra.
*** Error code 1
```


Assignee: **@peterjeremy**

CC:  drkirkby @williamstein

Reviewer: **David Kirkby**

Author: **Peter Jeremy**

Merged: **sage-4.3.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/7823_





---

archive/issue_events_085460.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-01-03T01:53:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85460"
}
```



---

archive/issue_events_085461.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-01-03T01:53:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20bsd",
    "label_color": "000080",
    "label_name": "component: porting: bsd",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85461"
}
```



---

archive/issue_events_085462.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-01-03T01:53:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85462"
}
```



---

archive/issue_events_085463.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-01-03T01:53:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85463"
}
```



---

archive/issue_comments_060940.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nAttachment: **[7823.libgcrypt.patch.gz](https://github.com/sagemath/sage/files/ticket7823/7823.libgcrypt.patch.gz)**",
    "created_at": "2010-01-03T01:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60940",
    "user": "https://github.com/peterjeremy"
}
```

<a id='comment:1'>Comment 1:</a>
Attachment: **[7823.libgcrypt.patch.gz](https://github.com/sagemath/sage/files/ticket7823/7823.libgcrypt.patch.gz)**



---

archive/issue_events_085464.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-01-03T01:56:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85464"
}
```



---

archive/issue_comments_060941.json:
```json
{
    "body": "Author: **Peter Jeremy**",
    "created_at": "2010-01-03T03:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60941",
    "user": "https://github.com/peterjeremy"
}
```

Author: **Peter Jeremy**



---

archive/issue_comments_060942.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI'll trust you it worked on FreeBSD. Clearly it can have no impact on any other system, so its a positive from me. \n\nDave",
    "created_at": "2010-01-05T18:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60942",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<a id='comment:3'>Comment 3:</a>
I'll trust you it worked on FreeBSD. Clearly it can have no impact on any other system, so its a positive from me. 

Dave



---

archive/issue_events_085465.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-01-05T18:49:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85465"
}
```



---

archive/issue_events_085466.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-01-05T18:49:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85466"
}
```



---

archive/issue_comments_060943.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nHere is an updated spkg with pjeremy's patch: \n\nhttp://sage.math.washington.edu/home/mvngu/spkg/standard/libgcrypt/libgcrypt-1.4.4.p2.spkg\n\nI took libgcrypt-1.4.4.p1.spkg and first checked in all outstanding changes by drkirby in his name. Then I applied pjeremy's patch and checked in changes in pjeremy's name.",
    "created_at": "2010-01-24T14:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60943",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<a id='comment:5'>Comment 5:</a>
Here is an updated spkg with pjeremy's patch: 

http://sage.math.washington.edu/home/mvngu/spkg/standard/libgcrypt/libgcrypt-1.4.4.p2.spkg

I took libgcrypt-1.4.4.p1.spkg and first checked in all outstanding changes by drkirby in his name. Then I applied pjeremy's patch and checked in changes in pjeremy's name.



---

archive/issue_events_085467.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-24T14:18:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85467"
}
```



---

archive/issue_events_085468.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-24T14:18:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7823#event-85468"
}
```



---

archive/issue_comments_060944.json:
```json
{
    "body": "Reviewer: **David Kirkby**",
    "created_at": "2010-01-24T14:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60944",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Reviewer: **David Kirkby**



---

archive/issue_comments_060945.json:
```json
{
    "body": "Merged: **sage-4.3.2.alpha0**",
    "created_at": "2010-01-24T14:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7823#issuecomment-60945",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.2.alpha0**
