# Issue 7946: Fix TestSuite failures for schemes

archive/issues_007946.json:
```json
{
    "body": "Consider the following situation:\n\n```\nsage: S = Spec(ZZ)\nsage: x = S.an_element()\n```\nRunning `TestSuite(S)` and `TestSuite(x)` yields several failures.  A related problem is\n\n```\nsage: S\nSpectrum of Integer Ring\nsage: parent(x)\nSet of rational points of Spectrum of Integer Ring\n```\nwhereas we expect `parent(x) is S`.\n\nHere is the complete `TestSuite` report:\n\n```\nsage: TestSuite(S).run()\nFailure in _test_an_element:\nTraceback (most recent call last):\n...\nNotImplementedError\n------------------------------------------------------------\n  Failure in _test_category:\n  Traceback (most recent call last):\n  ...\n  AssertionError: False is not true\n  ------------------------------------------------------------\n  Failure in _test_pickling:\n  Traceback (most recent call last):\n  ...\n  AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring\n  ------------------------------------------------------------\n  The following tests failed: _test_category, _test_pickling\nFailure in _test_elements\nFailure in _test_some_elements:\nTraceback (most recent call last):\n...\nNotImplementedError\n------------------------------------------------------------\nThe following tests failed: _test_an_element, _test_elements, _test_some_elements\n```\n\n```\nsage: TestSuite(x).run()\nFailure in _test_category:\nTraceback (most recent call last):\n...\nAssertionError: False is not true\n------------------------------------------------------------\nFailure in _test_pickling:\nTraceback (most recent call last):\n...\nAssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring\n------------------------------------------------------------\nThe following tests failed: _test_category, _test_pickling\n```\n\n(Note: the `NotImplementedError` that one gets after applying #16158 is a different one than before.)\n\n\nDepends on #16158\n\n**Assignee:** @aghitza\n\n**CC:**  @vbraun\n\n**Branch/Commit:** [5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Peter Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/7946\n\n",
    "closed_at": "2014-11-14T21:01:45Z",
    "created_at": "2010-01-16T12:37:52Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "title": "Fix TestSuite failures for schemes",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7946",
    "user": "https://github.com/nthiery"
}
```
Consider the following situation:

```
sage: S = Spec(ZZ)
sage: x = S.an_element()
```
Running `TestSuite(S)` and `TestSuite(x)` yields several failures.  A related problem is

```
sage: S
Spectrum of Integer Ring
sage: parent(x)
Set of rational points of Spectrum of Integer Ring
```
whereas we expect `parent(x) is S`.

Here is the complete `TestSuite` report:

```
sage: TestSuite(S).run()
Failure in _test_an_element:
Traceback (most recent call last):
...
NotImplementedError
------------------------------------------------------------
  Failure in _test_category:
  Traceback (most recent call last):
  ...
  AssertionError: False is not true
  ------------------------------------------------------------
  Failure in _test_pickling:
  Traceback (most recent call last):
  ...
  AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring
  ------------------------------------------------------------
  The following tests failed: _test_category, _test_pickling
Failure in _test_elements
Failure in _test_some_elements:
Traceback (most recent call last):
...
NotImplementedError
------------------------------------------------------------
The following tests failed: _test_an_element, _test_elements, _test_some_elements
```

```
sage: TestSuite(x).run()
Failure in _test_category:
Traceback (most recent call last):
...
AssertionError: False is not true
------------------------------------------------------------
Failure in _test_pickling:
Traceback (most recent call last):
...
AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring
------------------------------------------------------------
The following tests failed: _test_category, _test_pickling
```

(Note: the `NotImplementedError` that one gets after applying #16158 is a different one than before.)


Depends on #16158

**Assignee:** @aghitza

**CC:**  @vbraun

**Branch/Commit:** [5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)

**Reviewer:** Travis Scrimshaw

**Author:** Peter Bruin

Issue created by migration from https://trac.sagemath.org/ticket/7946





---

archive/issue_comments_062411.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+Spec(...) does not specify its category:\n \n ```\n sage: C = Spec(ZZ)\n@@ -8,3 +9,42 @@\n ```\n \n Caught with #7921; please write patch on top of it to avoid conflicts.\n+\n+Here is the complete TestSuite report, which also complains about\n+an_element, ...::\n+\n+```\n+sage: TestSuite(Spec(ZZ)).run()\n+running ._test_an_element() . . . fail\n+Traceback (most recent call last):\n+...\n+AssertionError: self.an_element() is not in self\n+------------------------------------------------------------\n+running ._test_category() . . . fail\n+Traceback (most recent call last):\n+...\n+AssertionError: category of self improperly initialized\n+------------------------------------------------------------\n+running ._test_elements() . . . \n+  Failure in _test_category:\n+  Traceback (most recent call last):\n+  ...\n+  AssertionError\n+  ------------------------------------------------------------\n+  running ._test_not_implemented_methods() . . . pass\n+  running ._test_pickling() . . . fail\n+  Traceback (most recent call last):\n+  ...\n+  RuntimeError: ...BUG in map, returned None Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring <type 'sage.categories.morphism.CallMorphism'> Call morphism:\n+  ------------------------------------------------------------\n+  The following tests failed: _test_category, _test_pickling\n+running ._test_not_implemented_methods() . . . pass\n+running ._test_pickling() . . . pass\n+running ._test_some_elements() . . . fail\n+Traceback (most recent call last):\n+...\n+AssertionError: the object Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring in self.some_elements() is not in self\n+------------------------------------------------------------\n+The following tests failed: _test_an_element, _test_category, _test_elements, _test_some_elements\n+```\n+\n``````\n",
    "created_at": "2010-01-17T20:46:37Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62411",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+Spec(...) does not specify its category:
 
 ```
 sage: C = Spec(ZZ)
@@ -8,3 +9,42 @@
 ```
 
 Caught with #7921; please write patch on top of it to avoid conflicts.
+
+Here is the complete TestSuite report, which also complains about
+an_element, ...::
+
+```
+sage: TestSuite(Spec(ZZ)).run()
+running ._test_an_element() . . . fail
+Traceback (most recent call last):
+...
+AssertionError: self.an_element() is not in self
+------------------------------------------------------------
+running ._test_category() . . . fail
+Traceback (most recent call last):
+...
+AssertionError: category of self improperly initialized
+------------------------------------------------------------
+running ._test_elements() . . . 
+  Failure in _test_category:
+  Traceback (most recent call last):
+  ...
+  AssertionError
+  ------------------------------------------------------------
+  running ._test_not_implemented_methods() . . . pass
+  running ._test_pickling() . . . fail
+  Traceback (most recent call last):
+  ...
+  RuntimeError: ...BUG in map, returned None Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring <type 'sage.categories.morphism.CallMorphism'> Call morphism:
+  ------------------------------------------------------------
+  The following tests failed: _test_category, _test_pickling
+running ._test_not_implemented_methods() . . . pass
+running ._test_pickling() . . . pass
+running ._test_some_elements() . . . fail
+Traceback (most recent call last):
+...
+AssertionError: the object Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring in self.some_elements() is not in self
+------------------------------------------------------------
+The following tests failed: _test_an_element, _test_category, _test_elements, _test_some_elements
+```
+
``````




---

archive/issue_events_055176.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-01-17T22:21:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55176"
}
```



---

archive/issue_comments_062412.json:
```json
{
    "body": "<a id='comment:3'></a>\n#11599 claims to fix this, but I am not entirely sure what would it take to fix this ticket - the reported category is now schemes and only 3 of the `TestSuite` tests fail.",
    "created_at": "2012-02-20T00:36:39Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62412",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>
#11599 claims to fix this, but I am not entirely sure what would it take to fix this ticket - the reported category is now schemes and only 3 of the `TestSuite` tests fail.



---

archive/issue_events_055177.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55177"
}
```



---

archive/issue_events_055178.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55178"
}
```



---

archive/issue_events_055179.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55179"
}
```



---

archive/issue_events_055180.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55180"
}
```



---

archive/issue_comments_062413.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhat is `Spec` intended to mean in the first place?  The definition currently starts with\n\n```\nclass Spec(AffineScheme):\n    ....\n```\nThis suggests that `Spec` is a special kind of affine scheme.  But aren't \"the spectrum of a ring\" and \"an affine scheme\" exactly the same thing?\n\nThis code probably predates the category framework.  A more modern design would perhaps be something like the following:\n- define the category `AffineSchemes` (or `Schemes().Affine()`) of affine schemes;\n- designate `AffineScheme` as the \"canonical\" type for objects in this category, and move functionality from `Spec` to `AffineScheme` as appropriate;\n- convert `Spec` into a functor from `CommutativeRings` to `AffineSchemes`.\n(Mathematically speaking, Spec [as a functor from commutative rings to schemes, or even locally ringed spaces] can be defined as the adjoint functor of the global sections functor *X* -> *O<sub>X</sub>*(*X*) from schemes to commutative rings, and this gives an anti-equivalence of categories from commutative rings to affine schemes; I wonder if this could somehow be formalised in Sage's category framework, but that's another story...)\n\n[Edit: the above idea is now essentially #16158, although there is no category of affine schemes yet.]",
    "created_at": "2014-04-12T14:23:30Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62413",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'></a>
What is `Spec` intended to mean in the first place?  The definition currently starts with

```
class Spec(AffineScheme):
    ....
```
This suggests that `Spec` is a special kind of affine scheme.  But aren't "the spectrum of a ring" and "an affine scheme" exactly the same thing?

This code probably predates the category framework.  A more modern design would perhaps be something like the following:
- define the category `AffineSchemes` (or `Schemes().Affine()`) of affine schemes;
- designate `AffineScheme` as the "canonical" type for objects in this category, and move functionality from `Spec` to `AffineScheme` as appropriate;
- convert `Spec` into a functor from `CommutativeRings` to `AffineSchemes`.
(Mathematically speaking, Spec [as a functor from commutative rings to schemes, or even locally ringed spaces] can be defined as the adjoint functor of the global sections functor *X* -> *O<sub>X</sub>*(*X*) from schemes to commutative rings, and this gives an anti-equivalence of categories from commutative rings to affine schemes; I wonder if this could somehow be formalised in Sage's category framework, but that's another story...)

[Edit: the above idea is now essentially #16158, although there is no category of affine schemes yet.]



---

archive/issue_events_055181.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-03T15:34:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "rename": {
        "from": "Spec(...) does not specify its category",
        "to": "Fix TestSuite failures for schemes"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55181"
}
```



---

archive/issue_comments_062414.json:
```json
{
    "body": "**Dependencies:** #16158",
    "created_at": "2014-05-03T15:34:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62414",
    "user": "https://github.com/pjbruin"
}
```

**Dependencies:** #16158



---

archive/issue_comments_062415.json:
```json
{
    "body": "<a id='comment:7'></a>\nTo show that the first part of the original ticket is fixed:\n\n```\nsage: S = Spec(ZZ)\nsage: S.category()\nCategory of Schemes\nsage: isinstance(S, S.category().parent_class) \nTrue\n```",
    "created_at": "2014-05-03T15:34:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62415",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
To show that the first part of the original ticket is fixed:

```
sage: S = Spec(ZZ)
sage: S.category()
Category of Schemes
sage: isinstance(S, S.category().parent_class) 
True
```



---

archive/issue_comments_062416.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,50 +1,51 @@\n-Spec(...) does not specify its category:\n+Here is the complete `TestSuite` report:\n \n ```\n-sage: C = Spec(ZZ)\n-sage: C.category()\n-Category of sets\n-sage: isinstance(C, C.category().element_class)\n-False\n+sage: S=Spec(ZZ)\n+sage: x=S.an_element()\n ```\n \n-Caught with #7921; please write patch on top of it to avoid conflicts.\n-\n-Here is the complete TestSuite report, which also complains about\n-an_element, ...::\n-\n ```\n-sage: TestSuite(Spec(ZZ)).run()\n-running ._test_an_element() . . . fail\n+sage: TestSuite(S).run()\n+Failure in _test_an_element:\n Traceback (most recent call last):\n ...\n-AssertionError: self.an_element() is not in self\n+NotImplementedError\n ------------------------------------------------------------\n-running ._test_category() . . . fail\n-Traceback (most recent call last):\n-...\n-AssertionError: category of self improperly initialized\n-------------------------------------------------------------\n-running ._test_elements() . . . \n   Failure in _test_category:\n   Traceback (most recent call last):\n   ...\n-  AssertionError\n+  AssertionError: False is not true\n   ------------------------------------------------------------\n-  running ._test_not_implemented_methods() . . . pass\n-  running ._test_pickling() . . . fail\n+  Failure in _test_pickling:\n   Traceback (most recent call last):\n   ...\n-  RuntimeError: ...BUG in map, returned None Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring <type 'sage.categories.morphism.CallMorphism'> Call morphism:\n+  AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring\n   ------------------------------------------------------------\n   The following tests failed: _test_category, _test_pickling\n-running ._test_not_implemented_methods() . . . pass\n-running ._test_pickling() . . . pass\n-running ._test_some_elements() . . . fail\n+Failure in _test_elements\n+Failure in _test_some_elements:\n Traceback (most recent call last):\n ...\n-AssertionError: the object Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring in self.some_elements() is not in self\n+NotImplementedError\n ------------------------------------------------------------\n-The following tests failed: _test_an_element, _test_category, _test_elements, _test_some_elements\n+The following tests failed: _test_an_element, _test_elements, _test_some_elements\n ```\n \n+```\n+sage: TestSuite(x).run()\n+Failure in _test_category:\n+Traceback (most recent call last):\n+...\n+AssertionError: False is not true\n+------------------------------------------------------------\n+Failure in _test_pickling:\n+Traceback (most recent call last):\n+...\n+AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring\n+------------------------------------------------------------\n+The following tests failed: _test_category, _test_pickling\n+```\n+\n+(Note: the `NotImplementedError` that one gets after applying #16158 is a different one than before.)\n+\n``````\n",
    "created_at": "2014-05-03T15:34:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62416",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,50 +1,51 @@
-Spec(...) does not specify its category:
+Here is the complete `TestSuite` report:
 
 ```
-sage: C = Spec(ZZ)
-sage: C.category()
-Category of sets
-sage: isinstance(C, C.category().element_class)
-False
+sage: S=Spec(ZZ)
+sage: x=S.an_element()
 ```
 
-Caught with #7921; please write patch on top of it to avoid conflicts.
-
-Here is the complete TestSuite report, which also complains about
-an_element, ...::
-
 ```
-sage: TestSuite(Spec(ZZ)).run()
-running ._test_an_element() . . . fail
+sage: TestSuite(S).run()
+Failure in _test_an_element:
 Traceback (most recent call last):
 ...
-AssertionError: self.an_element() is not in self
+NotImplementedError
 ------------------------------------------------------------
-running ._test_category() . . . fail
-Traceback (most recent call last):
-...
-AssertionError: category of self improperly initialized
-------------------------------------------------------------
-running ._test_elements() . . . 
   Failure in _test_category:
   Traceback (most recent call last):
   ...
-  AssertionError
+  AssertionError: False is not true
   ------------------------------------------------------------
-  running ._test_not_implemented_methods() . . . pass
-  running ._test_pickling() . . . fail
+  Failure in _test_pickling:
   Traceback (most recent call last):
   ...
-  RuntimeError: ...BUG in map, returned None Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring <type 'sage.categories.morphism.CallMorphism'> Call morphism:
+  AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring
   ------------------------------------------------------------
   The following tests failed: _test_category, _test_pickling
-running ._test_not_implemented_methods() . . . pass
-running ._test_pickling() . . . pass
-running ._test_some_elements() . . . fail
+Failure in _test_elements
+Failure in _test_some_elements:
 Traceback (most recent call last):
 ...
-AssertionError: the object Point on Spectrum of Integer Ring defined by the Principal ideal (2) of Integer Ring in self.some_elements() is not in self
+NotImplementedError
 ------------------------------------------------------------
-The following tests failed: _test_an_element, _test_category, _test_elements, _test_some_elements
+The following tests failed: _test_an_element, _test_elements, _test_some_elements
 ```
 
+```
+sage: TestSuite(x).run()
+Failure in _test_category:
+Traceback (most recent call last):
+...
+AssertionError: False is not true
+------------------------------------------------------------
+Failure in _test_pickling:
+Traceback (most recent call last):
+...
+AssertionError: Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring != Point on Spectrum of Integer Ring defined by the Principal ideal (991) of Integer Ring
+------------------------------------------------------------
+The following tests failed: _test_category, _test_pickling
+```
+
+(Note: the `NotImplementedError` that one gets after applying #16158 is a different one than before.)
+
``````




---

archive/issue_events_055182.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-03T21:30:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55182"
}
```



---

archive/issue_comments_062417.json:
```json
{
    "body": "**Branch:** [u/pbruin/7946-scheme_point_improvements](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/7946-scheme_point_improvements)",
    "created_at": "2014-05-03T21:30:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62417",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/7946-scheme_point_improvements](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/7946-scheme_point_improvements)



---

archive/issue_comments_062418.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.",
    "created_at": "2014-05-03T21:30:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62418",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>
The attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.



---

archive/issue_comments_062419.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,20 @@\n-Here is the complete `TestSuite` report:\n+Consider the following situation:\n \n ```\n-sage: S=Spec(ZZ)\n-sage: x=S.an_element()\n+sage: S = Spec(ZZ)\n+sage: x = S.an_element()\n ```\n+Running `TestSuite(S)` and `TestSuite(x)` yields several failures.  A related problem is\n+\n+```\n+sage: S\n+Spectrum of Integer Ring\n+sage: parent(x)\n+Set of rational points of Spectrum of Integer Ring\n+```\n+whereas we expect `parent(x) is S`.\n+\n+Here is the complete `TestSuite` report:\n \n ```\n sage: TestSuite(S).run()\n``````\n",
    "created_at": "2014-05-03T21:30:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62419",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,20 @@
-Here is the complete `TestSuite` report:
+Consider the following situation:
 
 ```
-sage: S=Spec(ZZ)
-sage: x=S.an_element()
+sage: S = Spec(ZZ)
+sage: x = S.an_element()
 ```
+Running `TestSuite(S)` and `TestSuite(x)` yields several failures.  A related problem is
+
+```
+sage: S
+Spectrum of Integer Ring
+sage: parent(x)
+Set of rational points of Spectrum of Integer Ring
+```
+whereas we expect `parent(x) is S`.
+
+Here is the complete `TestSuite` report:
 
 ```
 sage: TestSuite(S).run()
``````




---

archive/issue_comments_062420.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2014-05-03T21:30:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62420",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_comments_062421.json:
```json
{
    "body": "**Commit:** [5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)",
    "created_at": "2014-05-03T21:30:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62421",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)



---

archive/issue_events_055183.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55183"
}
```



---

archive/issue_events_055184.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55184"
}
```



---

archive/issue_events_055185.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55185"
}
```



---

archive/issue_events_055186.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55186"
}
```



---

archive/issue_comments_062422.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2014-11-03T07:56:42Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62422",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_062423.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [pbruin](#comment%3A8):\n> The attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.\n\n\nIs there some way you can get rid of that custom `__call__` method in `AffineScheme`, or at least passes things up through the `Parent.__call__` when trying to construct an element? If not, then I think we're okay setting this to positive review as it fixes the issues as stated in the ticket description (you can do this on my behalf).\n\nAlso, I think that [comment:6](#comment%3A6) (from the *very* limited understanding I have of the math) is the correct way to do things. However that would be a major overhaul to be done on a separate ticket, and perhaps the above change to `__call__` would fit into that.",
    "created_at": "2014-11-03T07:56:42Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62423",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Replying to [pbruin](#comment%3A8):
> The attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.


Is there some way you can get rid of that custom `__call__` method in `AffineScheme`, or at least passes things up through the `Parent.__call__` when trying to construct an element? If not, then I think we're okay setting this to positive review as it fixes the issues as stated in the ticket description (you can do this on my behalf).

Also, I think that [comment:6](#comment%3A6) (from the *very* limited understanding I have of the math) is the correct way to do things. However that would be a major overhaul to be done on a separate ticket, and perhaps the above change to `__call__` would fit into that.



---

archive/issue_comments_062424.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [tscrim](#comment%3A11):\n> Replying to [pbruin](#comment%3A8):\n> > The attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.\n\n> \n> Is there some way you can get rid of that custom `__call__` method in `AffineScheme`, or at least passes things up through the `Parent.__call__` when trying to construct an element? If not, then I think we're okay setting this to positive review as it fixes the issues as stated in the ticket description (you can do this on my behalf).\n\nThe reason this is done via the `__call__()` method is that an affine scheme *S* accepts two kinds of input; only one of them (input is a prime ideal) constructs an element with *S* as its parent.  In the other case (input is a list of coordinates) the `__call__()` syntax constructs an element of a suitable scheme homset.  I don't see an easy way to avoid a custom `__call__()` method; it may be possible (and would be nice) to get rid of it, but it is better to do this on separate ticket.  (Note also that the `__call__()` method was already present, I just improved it as necessary.)\n> Also, I think that [comment:6](#comment%3A6) (from the *very* limited understanding I have of the math) is the correct way to do things. However that would be a major overhaul to be done on a separate ticket, and perhaps the above change to `__call__` would fit into that.\n\nWhat I was talking about in that comment was mostly done on #16158 (closed a couple of months ago).  I think the remaining issue of making a category `AffineSchemes` would probably be disjoint from getting rid of the `__call__()` method.\n\nI'm setting this to positive review since you gave the green light.",
    "created_at": "2014-11-03T14:34:53Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62424",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:12'></a>
Replying to [tscrim](#comment%3A11):
> Replying to [pbruin](#comment%3A8):
> > The attached branch makes affine schemes, and points on them, cooperate better with the category and coercion code.  The `TestSuite` now runs without failures.

> 
> Is there some way you can get rid of that custom `__call__` method in `AffineScheme`, or at least passes things up through the `Parent.__call__` when trying to construct an element? If not, then I think we're okay setting this to positive review as it fixes the issues as stated in the ticket description (you can do this on my behalf).

The reason this is done via the `__call__()` method is that an affine scheme *S* accepts two kinds of input; only one of them (input is a prime ideal) constructs an element with *S* as its parent.  In the other case (input is a list of coordinates) the `__call__()` syntax constructs an element of a suitable scheme homset.  I don't see an easy way to avoid a custom `__call__()` method; it may be possible (and would be nice) to get rid of it, but it is better to do this on separate ticket.  (Note also that the `__call__()` method was already present, I just improved it as necessary.)
> Also, I think that [comment:6](#comment%3A6) (from the *very* limited understanding I have of the math) is the correct way to do things. However that would be a major overhaul to be done on a separate ticket, and perhaps the above change to `__call__` would fit into that.

What I was talking about in that comment was mostly done on #16158 (closed a couple of months ago).  I think the remaining issue of making a category `AffineSchemes` would probably be disjoint from getting rid of the `__call__()` method.

I'm setting this to positive review since you gave the green light.



---

archive/issue_events_055187.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-11-03T14:34:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55187"
}
```



---

archive/issue_events_055188.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-11-03T14:34:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55188"
}
```



---

archive/issue_comments_062425.json:
```json
{
    "body": "<a id='comment:13'></a>\n> The reason this is done via the `__call__()` method is that an affine scheme *S* accepts two kinds of input; only one of them (input is a prime ideal) constructs an element with *S* as its parent.  In the other case (input is a list of coordinates) the `__call__()` syntax constructs an element of a suitable scheme homset.  I don't see an easy way to avoid a custom `__call__()` method; it may be possible (and would be nice) to get rid of it, but it is better to do this on separate ticket.  (Note also that the `__call__()` method was already present, I just improved it as necessary.)\n\n\nThat's what I was thinking from a quick look through. Anyways, for later.\n\n> What I was talking about in that comment was mostly done on #16158 (closed a couple of months ago).  I think the remaining issue of making a category `AffineSchemes` would probably be disjoint from getting rid of the `__call__()` method.\n\n\nI knew the last one was done, but forgot that it moved the functionality. Unfortunately I think you're right, but we can at least do a followup to create the category of `AffineSchemes`.\n\n> I'm setting this to positive review since you gave the green light.\n\n\nThanks.",
    "created_at": "2014-11-03T15:44:43Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62425",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
> The reason this is done via the `__call__()` method is that an affine scheme *S* accepts two kinds of input; only one of them (input is a prime ideal) constructs an element with *S* as its parent.  In the other case (input is a list of coordinates) the `__call__()` syntax constructs an element of a suitable scheme homset.  I don't see an easy way to avoid a custom `__call__()` method; it may be possible (and would be nice) to get rid of it, but it is better to do this on separate ticket.  (Note also that the `__call__()` method was already present, I just improved it as necessary.)


That's what I was thinking from a quick look through. Anyways, for later.

> What I was talking about in that comment was mostly done on #16158 (closed a couple of months ago).  I think the remaining issue of making a category `AffineSchemes` would probably be disjoint from getting rid of the `__call__()` method.


I knew the last one was done, but forgot that it moved the functionality. Unfortunately I think you're right, but we can at least do a followup to create the category of `AffineSchemes`.

> I'm setting this to positive review since you gave the green light.


Thanks.



---

archive/issue_events_055189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-14T21:01:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55189"
}
```



---

archive/issue_events_055190.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f8b75914ff8cf5aebbe3bbc794024f4861c1a6cf",
    "created_at": "2014-11-14T21:01:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7946#event-55190"
}
```



---

archive/issue_comments_062426.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/7946-scheme_point_improvements](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/7946-scheme_point_improvements)\" to \"[5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)\".",
    "created_at": "2014-11-14T21:01:45Z",
    "issue": "https://github.com/sagemath/sage/issues/7946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7946#issuecomment-62426",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/7946-scheme_point_improvements](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/7946-scheme_point_improvements)" to "[5fd92eed3024163fa068bea8e3644d677f151adc](https://github.com/sagemath/sagetrac-mirror/commit/5fd92eed3024163fa068bea8e3644d677f151adc)".
