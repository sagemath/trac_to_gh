# Issue 7041: GAP purposely unsets CC which screws up Sun Studio build.

archive/issues_007041.json:
```json
{
    "body": "`spkg-install` for `gap-4.4.10.p12`:\n\n```\necho \"*WARNING*: Unsetting CC since that tends to break GAP building\"\nunset CC\necho \"*WARNING*: Unsetting CXX since that tends to break GAP building\"\nunset CXX\n```\n\nThis appears to be done by Michael Abshoff as `SPKG.txt` shows:\n\n```\n### gap-4.4.10.p8 (Michael Abshoff, June 16th, 2008)\n * unset CC in spkg-install (work around for #2575)\n```\n\nLooking at #2575 I can't help feel there must be a better solution.\n\n---\n\n**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg)\n\n**md5sum:** `3461058e66fd53d6d53f07acccc8d0c7  gap-4.4.12.p7.spkg`\n\n\n### gap-4.4.12.p7 (Leif Leonhardy, March 22nd 2012)\n* #7041: Only unset `CC` and `CXX` if really necessary (i.e., if they\n  contain spaces, which is what currently would break the build).\n* Clean up `spkg-install`.  Some things seem still weird, see comments.\n* Added \"Special Update/Build Instructions\" section above.\n\n\n\nAssignee: @nexttime\n\nCC:  @dimpase @ohanar\n\nKeywords: gap solaris cc CXX compiler hardcoded hard-coded sd40.5\n\nReviewer: R. Andrew Ohana\n\nAuthor: Leif Leonhardy\n\nMerged: sage-5.1.beta3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/7041\n\n",
    "closed_at": "2012-06-06T19:10:05Z",
    "created_at": "2009-09-27T16:30:04Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "GAP purposely unsets CC which screws up Sun Studio build.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7041",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
`spkg-install` for `gap-4.4.10.p12`:

```
echo "*WARNING*: Unsetting CC since that tends to break GAP building"
unset CC
echo "*WARNING*: Unsetting CXX since that tends to break GAP building"
unset CXX
```

This appears to be done by Michael Abshoff as `SPKG.txt` shows:

```
### gap-4.4.10.p8 (Michael Abshoff, June 16th, 2008)
 * unset CC in spkg-install (work around for #2575)
```

Looking at #2575 I can't help feel there must be a better solution.

---

**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg)

**md5sum:** `3461058e66fd53d6d53f07acccc8d0c7  gap-4.4.12.p7.spkg`


### gap-4.4.12.p7 (Leif Leonhardy, March 22nd 2012)
* #7041: Only unset `CC` and `CXX` if really necessary (i.e., if they
  contain spaces, which is what currently would break the build).
* Clean up `spkg-install`.  Some things seem still weird, see comments.
* Added "Special Update/Build Instructions" section above.



Assignee: @nexttime

CC:  @dimpase @ohanar

Keywords: gap solaris cc CXX compiler hardcoded hard-coded sd40.5

Reviewer: R. Andrew Ohana

Author: Leif Leonhardy

Merged: sage-5.1.beta3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/7041





---

archive/issue_comments_073510.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2011-05-24T19:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73510",
    "user": "https://trac.sagemath.org/admin/accounts/users/ltw"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_comments_073511.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,16 +1,17 @@\n-The spkg-install for gap-4.4.10.p12\n+`spkg-install` for `gap-4.4.10.p12`:\n \n+```\n echo \"*WARNING*: Unsetting CC since that tends to break GAP building\"\n unset CC\n echo \"*WARNING*: Unsetting CXX since that tends to break GAP building\"\n unset CXX\n+```\n \n-This appears to be done by Michael Abshoff as SPKG.txt shows:\n+This appears to be done by Michael Abshoff as `SPKG.txt` shows:\n \n+```\n ### gap-4.4.10.p8 (Michael Abshoff, June 16th, 2008)\n-* unset CC in spkg-install (work around for #2575)\n+ * unset CC in spkg-install (work around for #2575)\n+```\n \n-\n-Looking at http://sagetrac.org/sage_trac/ticket/2575 I can't help feel there must be a better solution. \n-\n-\n+Looking at #2575 I can't help feel there must be a better solution.\n``````\n",
    "created_at": "2011-05-24T19:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73511",
    "user": "https://trac.sagemath.org/admin/accounts/users/ltw"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,16 +1,17 @@
-The spkg-install for gap-4.4.10.p12
+`spkg-install` for `gap-4.4.10.p12`:
 
+```
 echo "*WARNING*: Unsetting CC since that tends to break GAP building"
 unset CC
 echo "*WARNING*: Unsetting CXX since that tends to break GAP building"
 unset CXX
+```
 
-This appears to be done by Michael Abshoff as SPKG.txt shows:
+This appears to be done by Michael Abshoff as `SPKG.txt` shows:
 
+```
 ### gap-4.4.10.p8 (Michael Abshoff, June 16th, 2008)
-* unset CC in spkg-install (work around for #2575)
+ * unset CC in spkg-install (work around for #2575)
+```
 
-
-Looking at http://sagetrac.org/sage_trac/ticket/2575 I can't help feel there must be a better solution. 
-
-
+Looking at #2575 I can't help feel there must be a better solution.
``````




---

archive/issue_comments_073512.json:
```json
{
    "body": "<a id='comment:2'></a>\nwell, ignore that patch, wrong ticket (sometimes tab browsing hates you)",
    "created_at": "2012-02-06T23:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73512",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:2'></a>
well, ignore that patch, wrong ticket (sometimes tab browsing hates you)



---

archive/issue_comments_073513.json:
```json
{
    "body": "<a id='comment:3'></a>\nFor the record, the GAP 4.4.12.p6 spkg still unsets these variables, for whatever reason (#2575 and #4161 might shed some light on that).\n\nHopefully someone will soon upgrade to GAP 4.5, which **might** solve potential issues with not unsetting them; haven't tested that (or looked at it) at all.",
    "created_at": "2012-03-22T14:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73513",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
For the record, the GAP 4.4.12.p6 spkg still unsets these variables, for whatever reason (#2575 and #4161 might shed some light on that).

Hopefully someone will soon upgrade to GAP 4.5, which **might** solve potential issues with not unsetting them; haven't tested that (or looked at it) at all.



---

archive/issue_comments_073514.json:
```json
{
    "body": "Changing keywords from \"gap solaris cc\" to \"gap solaris cc CXX compiler hardcoded hard-coded\".",
    "created_at": "2012-03-22T14:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73514",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "gap solaris cc" to "gap solaris cc CXX compiler hardcoded hard-coded".



---

archive/issue_comments_073515.json:
```json
{
    "body": "<a id='comment:4'></a>\nI'm currently preparing a GAP 4.4.12.p7 spkg fixing this issue (i.e., only unsetting `CC` and `CXX` if absolutely necessary), and cleaning up `SPKG.txt` and `spkg-install`.\n\nThere are still some open questions though; see e.g. my comments [comment:ticket:10825:14 here] (on #10825).",
    "created_at": "2012-03-22T17:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73515",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
I'm currently preparing a GAP 4.4.12.p7 spkg fixing this issue (i.e., only unsetting `CC` and `CXX` if absolutely necessary), and cleaning up `SPKG.txt` and `spkg-install`.

There are still some open questions though; see e.g. my comments [comment:ticket:10825:14 here] (on #10825).



---

archive/issue_comments_073516.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [leif](#comment%3A4):\n\n> There are still some open questions though; see e.g. my comments [comment:ticket:10825:14 here] (on #10825).\n\n\nI think what you did on #10825 is good.",
    "created_at": "2012-03-25T06:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73516",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Replying to [leif](#comment%3A4):

> There are still some open questions though; see e.g. my comments [comment:ticket:10825:14 here] (on #10825).


I think what you did on #10825 is good.



---

archive/issue_comments_073517.json:
```json
{
    "body": "Changing author from \"\" to \"Leif Leonhardy\"",
    "created_at": "2012-04-09T12:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73517",
    "user": "https://github.com/nexttime"
}
```

Changing author from "" to "Leif Leonhardy"



---

archive/issue_comments_073518.json:
```json
{
    "body": "<a id='comment:6'></a>\nExcerpt from (the modified) `SPKG.txt`:\n\n## Dependencies\n\n* readline (according to spkg/standard/deps)\n* Sage (? also according to deps, \"so that gap_reset_workspace works\")\n\n## Special !Update/Build Instructions\n\n* TODO:\n  - Use `patch` instead of copying patched files.\n    (Then also add `patch` to the dependencies above.)\n  - \"Flatten\" (i.e. remove) the `build()` function.\n  - Perhaps check whether we can fix GAP's configure / build scripts\n    w.r.t. brokenness of multiple words in `CC` (and `CXX`?) and its\n    ignorance concerning `CFLAGS`, `CPPFLAGS` and `LDFLAGS`.\n    (Then also support `SAGE_DEBUG` in `spkg-install`, and probably\n    set up reasonable default `CFLAGS`.)\n\n* Do we really want to copy everything from the build directory???\n  (Cf. comment in `spkg-install`.)\n\n ...\n\n\nI'll perhaps address some of the TODOs (I added myself) later, in a p8, but I'd really like to get this spkg in soon.\n\nThe stated (probably obsolete?) dependency on Sage and the last point should be answered by some of **you**... ;-)",
    "created_at": "2012-04-09T12:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73518",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Excerpt from (the modified) `SPKG.txt`:

## Dependencies

* readline (according to spkg/standard/deps)
* Sage (? also according to deps, "so that gap_reset_workspace works")

## Special !Update/Build Instructions

* TODO:
  - Use `patch` instead of copying patched files.
    (Then also add `patch` to the dependencies above.)
  - "Flatten" (i.e. remove) the `build()` function.
  - Perhaps check whether we can fix GAP's configure / build scripts
    w.r.t. brokenness of multiple words in `CC` (and `CXX`?) and its
    ignorance concerning `CFLAGS`, `CPPFLAGS` and `LDFLAGS`.
    (Then also support `SAGE_DEBUG` in `spkg-install`, and probably
    set up reasonable default `CFLAGS`.)

* Do we really want to copy everything from the build directory???
  (Cf. comment in `spkg-install`.)

 ...


I'll perhaps address some of the TODOs (I added myself) later, in a p8, but I'd really like to get this spkg in soon.

The stated (probably obsolete?) dependency on Sage and the last point should be answered by some of **you**... ;-)



---

archive/issue_comments_073519.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,18 @@\n ```\n \n Looking at #2575 I can't help feel there must be a better solution.\n+\n+---\n+\n+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg)\n+\n+**md5sum:** `3461058e66fd53d6d53f07acccc8d0c7  gap-4.4.12.p7.spkg`\n+\n+\n+### gap-4.4.12.p7 (Leif Leonhardy, March 22nd 2012)\n+* #7041: Only unset `CC` and `CXX` if really necessary (i.e., if they\n+  contain spaces, which is what currently would break the build).\n+* Clean up `spkg-install`.  Some things seem still weird, see comments.\n+* Added \"Special Update/Build Instructions\" section above.\n+\n+\n``````\n",
    "created_at": "2012-04-09T12:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73519",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,18 @@
 ```
 
 Looking at #2575 I can't help feel there must be a better solution.
+
+---
+
+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/gap-4.4.12.p7.spkg)
+
+**md5sum:** `3461058e66fd53d6d53f07acccc8d0c7  gap-4.4.12.p7.spkg`
+
+
+### gap-4.4.12.p7 (Leif Leonhardy, March 22nd 2012)
+* #7041: Only unset `CC` and `CXX` if really necessary (i.e., if they
+  contain spaces, which is what currently would break the build).
+* Clean up `spkg-install`.  Some things seem still weird, see comments.
+* Added "Special Update/Build Instructions" section above.
+
+
``````




---

archive/issue_comments_073520.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-09T12:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73520",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_073521.json:
```json
{
    "body": "Attachment [gap-4.4.12.p6-p7.diff](tarball://root/attachments/some-uuid/ticket7041/gap-4.4.12.p6-p7.diff) by @nexttime created at 2012-04-09 12:18:19\n\nDiff between the previous spkg in Sage and my new p7 spkg.  For reference / review only.",
    "created_at": "2012-04-09T12:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73521",
    "user": "https://github.com/nexttime"
}
```

Attachment [gap-4.4.12.p6-p7.diff](tarball://root/attachments/some-uuid/ticket7041/gap-4.4.12.p6-p7.diff) by @nexttime created at 2012-04-09 12:18:19

Diff between the previous spkg in Sage and my new p7 spkg.  For reference / review only.



---

archive/issue_comments_073522.json:
```json
{
    "body": "<a id='comment:7'></a>\nAs usual, I've attached a diff of the spkg for easier reviewing.",
    "created_at": "2012-04-09T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73522",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
As usual, I've attached a diff of the spkg for easier reviewing.



---

archive/issue_comments_073523.json:
```json
{
    "body": "Changing assignee from tbd to @nexttime.",
    "created_at": "2012-04-09T12:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73523",
    "user": "https://github.com/nexttime"
}
```

Changing assignee from tbd to @nexttime.



---

archive/issue_comments_073524.json:
```json
{
    "body": "Changing reviewer from \"\" to \"R. Andrew Ohana\"",
    "created_at": "2012-05-28T11:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73524",
    "user": "https://github.com/ohanar"
}
```

Changing reviewer from "" to "R. Andrew Ohana"



---

archive/issue_comments_073525.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T11:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73525",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_073526.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooks good and works well.",
    "created_at": "2012-05-28T11:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73526",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:8'></a>
Looks good and works well.



---

archive/issue_comments_073527.json:
```json
{
    "body": "Changing keywords from \"gap solaris cc CXX compiler hardcoded hard-coded\" to \"gap solaris cc CXX compiler hardcoded hard-coded sd40.5\".",
    "created_at": "2012-05-29T06:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73527",
    "user": "https://github.com/ohanar"
}
```

Changing keywords from "gap solaris cc CXX compiler hardcoded hard-coded" to "gap solaris cc CXX compiler hardcoded hard-coded sd40.5".



---

archive/issue_comments_073528.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.1.beta3\"",
    "created_at": "2012-06-06T19:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73528",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.1.beta3"



---

archive/issue_events_021180.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-06T19:10:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7041#event-21180"
}
```



---

archive/issue_comments_073529.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-06T19:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7041#issuecomment-73529",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
