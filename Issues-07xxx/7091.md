# Issue 7091: sqlachemy test suite fails when building with SAGE_CHECK

archive/issues_007091.json:
```json
{
    "body": "Building 4.1.2.rc0 under 64-bit SuSE Linux with SAGE_CHECK set to \"yes\", I got the following errors in the sqlalchemy test suite:\n\n```\n\n======================================================================\nERROR: testbasic (sql.testtypes.UnicodeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/sql/testtypes.py\", line 327, in testbasic\n    plain_varchar=rawdata)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py\", line 1087, in execute\n    return e.execute_clauseelement(self, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 1219, in execute_clauseelement\n    return connection.execute_clauseelement(elem, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 895, in execute_clauseelement\n    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 907, in _execute_compiled\n    self.__execute_raw(context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 916, in __execute_raw\n    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 960, in _cursor_execute\n    self._handle_dbapi_exception(e, statement, parameters, cursor)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 942, in _handle_dbapi_exception\n    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)\nProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_table (unicode_varchar, unicode_text, plain_varchar) VALUES (?, ?, ?)' ['Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n']\n\n======================================================================\nERROR: testengineparam (sql.testtypes.UnicodeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/sql/testtypes.py\", line 385, in testengineparam\n    plain_varchar=rawdata)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py\", line 1087, in execute\n    return e.execute_clauseelement(self, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 1219, in execute_clauseelement\n    return connection.execute_clauseelement(elem, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 895, in execute_clauseelement\n    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 907, in _execute_compiled\n    self.__execute_raw(context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 916, in __execute_raw\n    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 960, in _cursor_execute\n    self._handle_dbapi_exception(e, statement, parameters, cursor)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 942, in _handle_dbapi_exception\n    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)\nProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_table (unicode_varchar, unicode_text, plain_varchar) VALUES (?, ?, ?)' ['Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\\xc3\\xb4le de petit voix m\\xe2\\x80\\x99a r\\xc3\\xa9veill\\xc3\\xa9. Elle disait: \\xc2\\xab S\\xe2\\x80\\x99il vous pla\\xc3\\xaet\\xe2\\x80\\xa6 dessine-moi un mouton! \\xc2\\xbb\\n']\n\n======================================================================\nERROR: test_unicode (orm.query.GetTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/testlib/testing.py\", line 174, in maybe\n    return fn(*args, **kw)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/query.py\", line 155, in test_unicode\n    table.insert().execute(id=ustring, data=ustring)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py\", line 1087, in execute\n    return e.execute_clauseelement(self, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 1219, in execute_clauseelement\n    return connection.execute_clauseelement(elem, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 895, in execute_clauseelement\n    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 907, in _execute_compiled\n    self.__execute_raw(context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 916, in __execute_raw\n    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 960, in _cursor_execute\n    self._handle_dbapi_exception(e, statement, parameters, cursor)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 942, in _handle_dbapi_exception\n    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)\nProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_data (id, data) VALUES (?, ?)' ['petit voix m\\xe2\\x80\\x99a', 'petit voix m\\xe2\\x80\\x99a']\n\n======================================================================\nERROR: test_basic (orm.unitofwork.UnicodeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/unitofwork.py\", line 168, in test_basic\n    Session.commit()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/scoping.py\", line 98, in do\n    return getattr(self.registry(), name)(*args, **kwargs)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 554, in commit\n    self.transaction.commit()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 259, in commit\n    self._prepare_impl()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 243, in _prepare_impl\n    self.session.flush()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 786, in flush\n    self.uow.flush(self, objects)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 233, in flush\n    flush_context.execute()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 445, in execute\n    UOWExecutor().execute(self, tasks)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 930, in execute\n    self.execute_save_steps(trans, task)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 945, in execute_save_steps\n    self.save_objects(trans, task)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 936, in save_objects\n    task.mapper._save_obj(task.polymorphic_tosave_objects, trans)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/mapper.py\", line 1161, in _save_obj\n    c = connection.execute(statement.values(value_params), params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 844, in execute\n    return Connection.executors[c](self, object, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 895, in execute_clauseelement\n    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 907, in _execute_compiled\n    self.__execute_raw(context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 916, in __execute_raw\n    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 960, in _cursor_execute\n    self._handle_dbapi_exception(e, statement, parameters, cursor)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 942, in _handle_dbapi_exception\n    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)\nProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO uni_test (id, txt) VALUES (?, ?)' [1, '\\xc5\\xa0\\xc4\\x90\\xc4\\x86\\xc4\\x8c\\xc5\\xbd']\n\n======================================================================\nERROR: test_relation (orm.unitofwork.UnicodeTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/unitofwork.py\", line 186, in test_relation\n    Session.commit()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/scoping.py\", line 98, in do\n    return getattr(self.registry(), name)(*args, **kwargs)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 554, in commit\n    self.transaction.commit()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 259, in commit\n    self._prepare_impl()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 243, in _prepare_impl\n    self.session.flush()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py\", line 786, in flush\n    self.uow.flush(self, objects)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 233, in flush\n    flush_context.execute()\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 445, in execute\n    UOWExecutor().execute(self, tasks)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 930, in execute\n    self.execute_save_steps(trans, task)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 945, in execute_save_steps\n    self.save_objects(trans, task)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py\", line 936, in save_objects\n    task.mapper._save_obj(task.polymorphic_tosave_objects, trans)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/mapper.py\", line 1161, in _save_obj\n    c = connection.execute(statement.values(value_params), params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 844, in execute\n    return Connection.executors[c](self, object, multiparams, params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 895, in execute_clauseelement\n    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 907, in _execute_compiled\n    self.__execute_raw(context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 916, in __execute_raw\n    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 960, in _cursor_execute\n    self._handle_dbapi_exception(e, statement, parameters, cursor)\n  File \"/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py\", line 942, in _handle_dbapi_exception\n    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)\nProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO uni_test (txt) VALUES (?)' ['\\xc5\\xa0\\xc4\\x90\\xc4\\x86\\xc4\\x8c\\xc5\\xbd']\n\n----------------------------------------------------------------------\nRan 1369 tests in 59.812s\n\nFAILED (errors=5)\nThere was a problem during the SQLAlchemy unit tests\n*************************************\nError testing package ** sqlalchemy-0.4.6.p1 **\n*************************************\n```\n\n**CC:**  drkirkby @jaapspies\n\n**Keywords:** sqlalchemy\n\n**Resolution:** fixed\n\n**Author:** Mitesh Patel\n\n**Reviewer:** William Stein\n\n**Merged:** sage-4.3.4.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/7091\n\n",
    "closed_at": "2010-03-08T20:50:25Z",
    "created_at": "2009-10-01T16:01:30Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.4",
    "title": "sqlachemy test suite fails when building with SAGE_CHECK",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7091",
    "user": "https://github.com/loefflerd"
}
```
Building 4.1.2.rc0 under 64-bit SuSE Linux with SAGE_CHECK set to "yes", I got the following errors in the sqlalchemy test suite:

```

======================================================================
ERROR: testbasic (sql.testtypes.UnicodeTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/sql/testtypes.py", line 327, in testbasic
    plain_varchar=rawdata)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py", line 1087, in execute
    return e.execute_clauseelement(self, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 1219, in execute_clauseelement
    return connection.execute_clauseelement(elem, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 895, in execute_clauseelement
    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 907, in _execute_compiled
    self.__execute_raw(context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 916, in __execute_raw
    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 960, in _cursor_execute
    self._handle_dbapi_exception(e, statement, parameters, cursor)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 942, in _handle_dbapi_exception
    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)
ProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_table (unicode_varchar, unicode_text, plain_varchar) VALUES (?, ?, ?)' ['Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n']

======================================================================
ERROR: testengineparam (sql.testtypes.UnicodeTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/sql/testtypes.py", line 385, in testengineparam
    plain_varchar=rawdata)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py", line 1087, in execute
    return e.execute_clauseelement(self, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 1219, in execute_clauseelement
    return connection.execute_clauseelement(elem, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 895, in execute_clauseelement
    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 907, in _execute_compiled
    self.__execute_raw(context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 916, in __execute_raw
    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 960, in _cursor_execute
    self._handle_dbapi_exception(e, statement, parameters, cursor)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 942, in _handle_dbapi_exception
    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)
ProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_table (unicode_varchar, unicode_text, plain_varchar) VALUES (?, ?, ?)' ['Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n', 'Alors vous imaginez ma surprise, au lever du jour, quand une dr\xc3\xb4le de petit voix m\xe2\x80\x99a r\xc3\xa9veill\xc3\xa9. Elle disait: \xc2\xab S\xe2\x80\x99il vous pla\xc3\xaet\xe2\x80\xa6 dessine-moi un mouton! \xc2\xbb\n']

======================================================================
ERROR: test_unicode (orm.query.GetTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/testlib/testing.py", line 174, in maybe
    return fn(*args, **kw)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/query.py", line 155, in test_unicode
    table.insert().execute(id=ustring, data=ustring)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/sql/expression.py", line 1087, in execute
    return e.execute_clauseelement(self, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 1219, in execute_clauseelement
    return connection.execute_clauseelement(elem, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 895, in execute_clauseelement
    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 907, in _execute_compiled
    self.__execute_raw(context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 916, in __execute_raw
    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 960, in _cursor_execute
    self._handle_dbapi_exception(e, statement, parameters, cursor)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 942, in _handle_dbapi_exception
    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)
ProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO unicode_data (id, data) VALUES (?, ?)' ['petit voix m\xe2\x80\x99a', 'petit voix m\xe2\x80\x99a']

======================================================================
ERROR: test_basic (orm.unitofwork.UnicodeTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/unitofwork.py", line 168, in test_basic
    Session.commit()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/scoping.py", line 98, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 554, in commit
    self.transaction.commit()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 259, in commit
    self._prepare_impl()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 243, in _prepare_impl
    self.session.flush()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 786, in flush
    self.uow.flush(self, objects)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 233, in flush
    flush_context.execute()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 445, in execute
    UOWExecutor().execute(self, tasks)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 930, in execute
    self.execute_save_steps(trans, task)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 945, in execute_save_steps
    self.save_objects(trans, task)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 936, in save_objects
    task.mapper._save_obj(task.polymorphic_tosave_objects, trans)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/mapper.py", line 1161, in _save_obj
    c = connection.execute(statement.values(value_params), params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 844, in execute
    return Connection.executors[c](self, object, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 895, in execute_clauseelement
    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 907, in _execute_compiled
    self.__execute_raw(context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 916, in __execute_raw
    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 960, in _cursor_execute
    self._handle_dbapi_exception(e, statement, parameters, cursor)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 942, in _handle_dbapi_exception
    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)
ProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO uni_test (id, txt) VALUES (?, ?)' [1, '\xc5\xa0\xc4\x90\xc4\x86\xc4\x8c\xc5\xbd']

======================================================================
ERROR: test_relation (orm.unitofwork.UnicodeTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/test/orm/unitofwork.py", line 186, in test_relation
    Session.commit()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/scoping.py", line 98, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 554, in commit
    self.transaction.commit()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 259, in commit
    self._prepare_impl()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 243, in _prepare_impl
    self.session.flush()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/session.py", line 786, in flush
    self.uow.flush(self, objects)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 233, in flush
    flush_context.execute()
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 445, in execute
    UOWExecutor().execute(self, tasks)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 930, in execute
    self.execute_save_steps(trans, task)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 945, in execute_save_steps
    self.save_objects(trans, task)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/unitofwork.py", line 936, in save_objects
    task.mapper._save_obj(task.polymorphic_tosave_objects, trans)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/orm/mapper.py", line 1161, in _save_obj
    c = connection.execute(statement.values(value_params), params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 844, in execute
    return Connection.executors[c](self, object, multiparams, params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 895, in execute_clauseelement
    return self._execute_compiled(elem.compile(dialect=self.dialect, column_keys=keys, inline=len(params) > 1), distilled_params=params)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 907, in _execute_compiled
    self.__execute_raw(context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 916, in __execute_raw
    self._cursor_execute(context.cursor, context.statement, context.parameters[0], context=context)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 960, in _cursor_execute
    self._handle_dbapi_exception(e, statement, parameters, cursor)
  File "/home/david/sage-4.1.2.rc0/spkg/build/sqlalchemy-0.4.6.p1/src/lib/sqlalchemy/engine/base.py", line 942, in _handle_dbapi_exception
    raise exceptions.DBAPIError.instance(statement, parameters, e, connection_invalidated=is_disconnect)
ProgrammingError: (ProgrammingError) You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings. u'INSERT INTO uni_test (txt) VALUES (?)' ['\xc5\xa0\xc4\x90\xc4\x86\xc4\x8c\xc5\xbd']

----------------------------------------------------------------------
Ran 1369 tests in 59.812s

FAILED (errors=5)
There was a problem during the SQLAlchemy unit tests
*************************************
Error testing package ** sqlalchemy-0.4.6.p1 **
*************************************
```

**CC:**  drkirkby @jaapspies

**Keywords:** sqlalchemy

**Resolution:** fixed

**Author:** Mitesh Patel

**Reviewer:** William Stein

**Merged:** sage-4.3.4.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/7091





---

archive/issue_comments_073953.json:
```json
{
    "body": "<a id='comment:1'></a>\nI've make a new package with [SQLAlchemy](http://www.sqlalchemy.org/) 0.5.8:\n\n* http://sage.math.washington.edu/home/mpatel/trac/7091/sqlalchemy-0.5.8.p0.spkg\n\nThere's no change in Sage 4.3.4.alpha0's long doctest results on sage.math.\n\nBut it seems that 0.5.8 now requires [nose](http://somethingaboutorange.com/mrl/projects/nose/0.11.2/) to run its tests.  I've commented them out in `spkg-check`, but I haven't yet \"qfinished\" the applied patch, in case I'm wrong or we should just delete `spkg-check`.\n\nThoughts?",
    "created_at": "2010-03-05T02:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73953",
    "user": "https://github.com/qed777"
}
```

<a id='comment:1'></a>
I've make a new package with [SQLAlchemy](http://www.sqlalchemy.org/) 0.5.8:

* http://sage.math.washington.edu/home/mpatel/trac/7091/sqlalchemy-0.5.8.p0.spkg

There's no change in Sage 4.3.4.alpha0's long doctest results on sage.math.

But it seems that 0.5.8 now requires [nose](http://somethingaboutorange.com/mrl/projects/nose/0.11.2/) to run its tests.  I've commented them out in `spkg-check`, but I haven't yet "qfinished" the applied patch, in case I'm wrong or we should just delete `spkg-check`.

Thoughts?



---

archive/issue_comments_073954.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2010-03-05T02:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73954",
    "user": "https://github.com/qed777"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_073955.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2010-03-05T02:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73955",
    "user": "https://github.com/qed777"
}
```

**Upstream:** N/A



---

archive/issue_comments_073956.json:
```json
{
    "body": "**Author:** Mitesh Patel",
    "created_at": "2010-03-05T02:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73956",
    "user": "https://github.com/qed777"
}
```

**Author:** Mitesh Patel



---

archive/issue_comments_073957.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis looks good.  \n\nCan you change the spkg maintainer from:\n\n```\n## SPKG Maintainers\n\n * Yi Qiang\n```\n\nto you?  \n\nRegarding nose, it's a bummer that they switched so that we can't run their test suite.  Oh well.  I can't think of any better solution though... until nose were to say get added to sage.  \n\nSo I say \"positive review\" (subject to you qfinishing this).   And it's *really* good that we're upgrading to the latest version, since the version of sqlalchemy in sage now is very out of date. \n\nWilliam",
    "created_at": "2010-03-06T23:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73957",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
This looks good.  

Can you change the spkg maintainer from:

```
## SPKG Maintainers

 * Yi Qiang
```

to you?  

Regarding nose, it's a bummer that they switched so that we can't run their test suite.  Oh well.  I can't think of any better solution though... until nose were to say get added to sage.  

So I say "positive review" (subject to you qfinishing this).   And it's *really* good that we're upgrading to the latest version, since the version of sqlalchemy in sage now is very out of date. 

William



---

archive/issue_comments_073958.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-03-06T23:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73958",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_073959.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-03-06T23:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73959",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_073960.json:
```json
{
    "body": "<a id='comment:4'></a>\nI've made an spkg with the changes William mentioned at http://sage.math.washington.edu/home/mhansen/sqlalchemy-0.5.8.spkg",
    "created_at": "2010-03-06T23:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73960",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:4'></a>
I've made an spkg with the changes William mentioned at http://sage.math.washington.edu/home/mhansen/sqlalchemy-0.5.8.spkg



---

archive/issue_comments_073961.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2010-03-06T23:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73961",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** William Stein



---

archive/issue_comments_073962.json:
```json
{
    "body": "**Merged:** sage-4.3.4.alpha1",
    "created_at": "2010-03-08T20:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73962",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** sage-4.3.4.alpha1



---

archive/issue_events_021392.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-03-08T20:50:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7091#event-21392"
}
```



---

archive/issue_comments_073963.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-03-08T20:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7091#issuecomment-73963",
    "user": "https://github.com/mwhansen"
}
```

**Resolution:** fixed
