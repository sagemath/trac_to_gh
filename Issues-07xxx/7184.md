# Issue 7184: Implement counting of spanning trees for graphs and digraphs

archive/issues_007184.json:
```json
{
    "body": "This patch allows us to count the number of spanning trees in a simple graph, as well as the spanning out-trees from a user-defined root node in a digraph.\n\nMethod used: Kirchhoff's matrix tree theorem [1] and the Laplacian matrix for the simple graphs, and a variation of the same [2] in the directed case.\n\n\n[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem \n\n[2] corollary 4.4 in http://books.google.se/books?id=vbxdqhDKOSYC&printsec=frontcover&hl=en&source=gbs_navlinks_s\n\n**Assignee:** @rlmill\n\n**CC:**  boothby\n\n**Author:** Anders Jonsson, Nathann Cohen\n\n**Reviewer:** Mike Hansen\n\n**Merged:** sage-4.3.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/7184\n\n",
    "closed_at": "2009-12-07T08:47:33Z",
    "created_at": "2009-10-10T17:59:38Z",
    "labels": [
        "component: graph theory",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3",
    "title": "Implement counting of spanning trees for graphs and digraphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7184",
    "user": "https://github.com/haaninjo"
}
```
This patch allows us to count the number of spanning trees in a simple graph, as well as the spanning out-trees from a user-defined root node in a digraph.

Method used: Kirchhoff's matrix tree theorem [1] and the Laplacian matrix for the simple graphs, and a variation of the same [2] in the directed case.


[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem 

[2] corollary 4.4 in http://books.google.se/books?id=vbxdqhDKOSYC&printsec=frontcover&hl=en&source=gbs_navlinks_s

**Assignee:** @rlmill

**CC:**  boothby

**Author:** Anders Jonsson, Nathann Cohen

**Reviewer:** Mike Hansen

**Merged:** sage-4.3.rc0

Issue created by migration from https://trac.sagemath.org/ticket/7184





---

archive/issue_comments_053203.json:
```json
{
    "body": "count spanning trees of graphs",
    "created_at": "2009-10-10T18:00:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53203",
    "user": "https://github.com/haaninjo"
}
```

count spanning trees of graphs



---

archive/attachments_008885.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7184.patch",
    "asset_url": "tarball://root/attachments/ticket7184/trac_7184.patch",
    "created_at": "2009-10-10T18:03:00Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7184/trac_7184.patch",
    "user": "https://github.com/haaninjo"
}
```



---

archive/issue_comments_053204.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [trac_7184.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184.patch)",
    "created_at": "2009-10-10T18:03:00Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53204",
    "user": "https://github.com/haaninjo"
}
```

<a id='comment:1'></a>
**Attachment:** [trac_7184.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184.patch)



---

archive/issue_comments_053205.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,5 +3,6 @@\n Method used: Kirchhoff's matrix tree theorem [1] and the Laplacian matrix for the simple graphs, and a variation of the same [2] in the directed case.\n \n \n-[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem\n+[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem \n+\n [2] corollary 4.4 in http://books.google.se/books?id=vbxdqhDKOSYC&printsec=frontcover&hl=en&source=gbs_navlinks_s\n``````\n",
    "created_at": "2009-10-10T18:03:00Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53205",
    "user": "https://github.com/haaninjo"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,5 +3,6 @@
 Method used: Kirchhoff's matrix tree theorem [1] and the Laplacian matrix for the simple graphs, and a variation of the same [2] in the directed case.
 
 
-[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem
+[1] http://en.wikipedia.org/wiki/Kirchhoff%27s_theorem 
+
 [2] corollary 4.4 in http://books.google.se/books?id=vbxdqhDKOSYC&printsec=frontcover&hl=en&source=gbs_navlinks_s
``````




---

archive/issue_events_048100.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-10T18:05:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48100"
}
```



---

archive/issue_events_048101.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-10-18T12:16:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "rename": {
        "from": "Implement counting of spanning trees for graphs and digraphs",
        "to": "Implement counting of spanning trees for graphs and digraphs + some fixing in kirchhoff_matrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48101"
}
```



---

archive/issue_comments_053206.json:
```json
{
    "body": "<a id='comment:3'></a>\nHere is a new patch based on yours, plus some modifications :\n* I was not able at first to apply your patch, as it was based on an old version of Sage. This new version is now based on 4.1.2.rc0.\n* I fixed some docstrings :\n      * you set \"math\" mode with this sign : ` \n        ( exemple : `x^2` )\n      * you set \"sage\" mode with this sign : `` \n        ( exemple : ``graph.am()`` )\n* I renamed the function from spanning_trees to spanning_tree_count as the first seemed to imply an iterator over spanning_trees\n* Some details concerning the root_vertex too. Many graphs have vertices not among integers but among strings, or tuples, etc. Besides, it is not necessary to enumerate all the vertices to get the first one :\n\n      ```\n      v=G.vertices()[0]\n  ```\n  You can also do :\n\n      ```\n      v=G.vertex_iterator().next()\n  ```\n* You had to modify the adjacency matrix to fit the definition used in your references. This was perfectly fine, but also meant there was an error in the definition of ``kirchhoff_matrix`` for directed graph. This patch fixes this, plus some docstrings error in the kirchhoff_matrix function.\n\nShort of these details, you algorithm works fine, thank you for having sent this patch !!\n\nIf you agree with this nex patch I am sending, you can set this ticket to positive_review\n\nThanks !\n\nNathann\n\nAlgorithm is OK, both for Graphs and Digraphs. You had to re-define",
    "created_at": "2009-10-18T12:16:29Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53206",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
Here is a new patch based on yours, plus some modifications :
* I was not able at first to apply your patch, as it was based on an old version of Sage. This new version is now based on 4.1.2.rc0.
* I fixed some docstrings :
      * you set "math" mode with this sign : ` 
        ( exemple : `x^2` )
      * you set "sage" mode with this sign : `` 
        ( exemple : ``graph.am()`` )
* I renamed the function from spanning_trees to spanning_tree_count as the first seemed to imply an iterator over spanning_trees
* Some details concerning the root_vertex too. Many graphs have vertices not among integers but among strings, or tuples, etc. Besides, it is not necessary to enumerate all the vertices to get the first one :

      ```
      v=G.vertices()[0]
  ```
  You can also do :

      ```
      v=G.vertex_iterator().next()
  ```
* You had to modify the adjacency matrix to fit the definition used in your references. This was perfectly fine, but also meant there was an error in the definition of ``kirchhoff_matrix`` for directed graph. This patch fixes this, plus some docstrings error in the kirchhoff_matrix function.

Short of these details, you algorithm works fine, thank you for having sent this patch !!

If you agree with this nex patch I am sending, you can set this ticket to positive_review

Thanks !

Nathann

Algorithm is OK, both for Graphs and Digraphs. You had to re-define



---

archive/issue_comments_053207.json:
```json
{
    "body": "<a id='comment:4'></a>\nOoops, sorry for the last line, which was not meant to be included in my message. Besides, I meant that you had to redefine the kirchhoff matrix, not the adjacency matrix.. Sorry :-)",
    "created_at": "2009-10-18T12:18:29Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53207",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Ooops, sorry for the last line, which was not meant to be included in my message. Besides, I meant that you had to redefine the kirchhoff matrix, not the adjacency matrix.. Sorry :-)



---

archive/issue_events_048102.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-18T17:10:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48102"
}
```



---

archive/issue_events_048103.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-18T17:10:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48103"
}
```



---

archive/issue_comments_053208.json:
```json
{
    "body": "<a id='comment:5'></a>\nNcohen, you've broken kirchhoff_matrix.  According to the definition, row-sums of the Kirchhoff matrix should be zero.  Here's the doctest before you changed it:\n\n```\nsage: G = DiGraph({1:{1:2,2:3}, 2:{1:4}}, weighted=True,sparse=True) \nsage: G.laplacian_matrix() \n[ 3 -3] \n[-4  4] \n```\nhere, the row-sums are zero.\n\nBut you actually had to change the doctest to make the code pass,\n\n```\nsage: G = DiGraph({1:{1:2,2:3}, 2:{1:4}}, weighted=True,sparse=True) \nsage: G.laplacian_matrix() \n[ 4 -3] \n[-4  3] \n```\nbut the row-sums aren't zero!  Don't break math to make code work!",
    "created_at": "2009-10-18T17:10:02Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53208",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:5'></a>
Ncohen, you've broken kirchhoff_matrix.  According to the definition, row-sums of the Kirchhoff matrix should be zero.  Here's the doctest before you changed it:

```
sage: G = DiGraph({1:{1:2,2:3}, 2:{1:4}}, weighted=True,sparse=True) 
sage: G.laplacian_matrix() 
[ 3 -3] 
[-4  4] 
```
here, the row-sums are zero.

But you actually had to change the doctest to make the code pass,

```
sage: G = DiGraph({1:{1:2,2:3}, 2:{1:4}}, weighted=True,sparse=True) 
sage: G.laplacian_matrix() 
[ 4 -3] 
[-4  3] 
```
but the row-sums aren't zero!  Don't break math to make code work!



---

archive/issue_comments_053209.json:
```json
{
    "body": "<a id='comment:7'></a>\nHello !!\n\nYes, I indeed changed the docstring because I thought this was a bug in kirchoff_matrix. As it is written in the patch I sent, the definition of kirchhoff matrix perfectly matches the definition from http://en.wikipedia.org/wiki/Laplacian_matrix\nTwo differences : the kirchhoff matrix can be defined when the graph is a DiGraph. \n* In this case, as defined ( for example ) in the book AJonsson is mentionning, the diagonal values should be set to the indegree of each vertex ( and not their out-degree as it is currenty the case ). He has, in his own code, to change manually the values from the returned kirchhoff_matrix, which I felt was not right if the kirchhoff_matrix function was \"correctly\" defined ( \"correctly\" here means : according to this book ).\n* In this docstring, you test your code against a special graph, as it has loops. As you see, the definition from wikipedia does not include the case where the graph includes loops. The definition from the book AJonsson mentions in his docstring ( I have it as a pdf file and can send it to you if you like ) produces the output of the functions kirchoff_matrix when my patch is applied.\n\nI honestly thought this was just a bug happening in special cases ( DiGraph + loops ), and checked several times the definition. Could you tell me which one you used ? \n\nSorry for the trouble. In added you in Cc uniquely to avoid unnoticed changes like this. Oh, and btw, I ran sage -testall to be sure this modifications broke no part of Sage. \n\nNathann",
    "created_at": "2009-10-18T17:42:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53209",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
Hello !!

Yes, I indeed changed the docstring because I thought this was a bug in kirchoff_matrix. As it is written in the patch I sent, the definition of kirchhoff matrix perfectly matches the definition from http://en.wikipedia.org/wiki/Laplacian_matrix
Two differences : the kirchhoff matrix can be defined when the graph is a DiGraph. 
* In this case, as defined ( for example ) in the book AJonsson is mentionning, the diagonal values should be set to the indegree of each vertex ( and not their out-degree as it is currenty the case ). He has, in his own code, to change manually the values from the returned kirchhoff_matrix, which I felt was not right if the kirchhoff_matrix function was "correctly" defined ( "correctly" here means : according to this book ).
* In this docstring, you test your code against a special graph, as it has loops. As you see, the definition from wikipedia does not include the case where the graph includes loops. The definition from the book AJonsson mentions in his docstring ( I have it as a pdf file and can send it to you if you like ) produces the output of the functions kirchoff_matrix when my patch is applied.

I honestly thought this was just a bug happening in special cases ( DiGraph + loops ), and checked several times the definition. Could you tell me which one you used ? 

Sorry for the trouble. In added you in Cc uniquely to avoid unnoticed changes like this. Oh, and btw, I ran sage -testall to be sure this modifications broke no part of Sage. 

Nathann



---

archive/issue_comments_053210.json:
```json
{
    "body": "<a id='comment:8'></a>\nHello Nathann,\nthanks for your review. I agree with your changes and have made an updated patch against sage 4.1.2. I did some more testing and noticed that the code for digraphs could easily be crashed by adding string-labeled vertices, so added a type check for that.\n\n\nAs for the Laplacian matrix, I left the current function alone since I saw the following on wikipedia: \"In the case of directed graphs, either the indegree or the outdegree might be used [for the diagonal values], depending on the application.\" At the present only the out-degree is used in sage, but it would of course be possible to make it a user option at creation of the Laplacian matrix if in- or out-degrees are to be used.",
    "created_at": "2009-10-19T19:48:00Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53210",
    "user": "https://github.com/haaninjo"
}
```

<a id='comment:8'></a>
Hello Nathann,
thanks for your review. I agree with your changes and have made an updated patch against sage 4.1.2. I did some more testing and noticed that the code for digraphs could easily be crashed by adding string-labeled vertices, so added a type check for that.


As for the Laplacian matrix, I left the current function alone since I saw the following on wikipedia: "In the case of directed graphs, either the indegree or the outdegree might be used [for the diagonal values], depending on the application." At the present only the out-degree is used in sage, but it would of course be possible to make it a user option at creation of the Laplacian matrix if in- or out-degrees are to be used.



---

archive/issue_events_048104.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-19T19:48:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48104"
}
```



---

archive/issue_events_048105.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-19T19:48:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48105"
}
```



---

archive/issue_comments_053211.json:
```json
{
    "body": "built against sage 4.1.2, extra typecheck",
    "created_at": "2009-10-19T19:49:27Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53211",
    "user": "https://github.com/haaninjo"
}
```

built against sage 4.1.2, extra typecheck



---

archive/attachments_008886.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7184-try2.patch",
    "asset_url": "tarball://root/attachments/ticket7184/trac_7184-try2.patch",
    "created_at": "2009-10-19T20:19:48Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7184/trac_7184-try2.patch",
    "user": "https://github.com/nathanncohen"
}
```



---

archive/issue_comments_053212.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Attachment:** [trac_7184-try2.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184-try2.patch)\n\nConsidering the view Tom Boothby had of my little modification of kirchhoff_matrix, it may be better not to touch it for the moment in this patch. If as you say, the two different ways are used, the best option would be to modify kirchhoff_matrix as you say, to let the user choose its own definition. ( the problem with the loops still remains, though, but we do not really care about it in this special application ).\n\nI am still worried about what you said considering Strings, though. If as you say, your code can be broken if vertices are strings, then you did not really solve your problem by taking this into account, as vertices can actually be of any immutable type. See for example patch #7246 where vertices are defined as Words ( which is a totally independent Sage object ). This does not fit in the integer case, nor in the String case.\n\nIf I make no mistake remembering what is written in the book you mentioned, they also talk of a different way to compute the number of out-trees : you do not add this special vertex, but just consider the kirchhoff matrix of the first graph, then add 1 to the vertex you want to take as root. It is ( I think ) an easier way to define your matrix in this case, without having to consider these types.. You just have to deal with the matrix ! ( I'm sorry I can not write this patch myself now, I do not have the correct tools on the computer I use and have some urgent work to get done until tomorrow... :-) )\n\nNathann",
    "created_at": "2009-10-19T20:19:48Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53212",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>
**Attachment:** [trac_7184-try2.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184-try2.patch)

Considering the view Tom Boothby had of my little modification of kirchhoff_matrix, it may be better not to touch it for the moment in this patch. If as you say, the two different ways are used, the best option would be to modify kirchhoff_matrix as you say, to let the user choose its own definition. ( the problem with the loops still remains, though, but we do not really care about it in this special application ).

I am still worried about what you said considering Strings, though. If as you say, your code can be broken if vertices are strings, then you did not really solve your problem by taking this into account, as vertices can actually be of any immutable type. See for example patch #7246 where vertices are defined as Words ( which is a totally independent Sage object ). This does not fit in the integer case, nor in the String case.

If I make no mistake remembering what is written in the book you mentioned, they also talk of a different way to compute the number of out-trees : you do not add this special vertex, but just consider the kirchhoff matrix of the first graph, then add 1 to the vertex you want to take as root. It is ( I think ) an easier way to define your matrix in this case, without having to consider these types.. You just have to deal with the matrix ! ( I'm sorry I can not write this patch myself now, I do not have the correct tools on the computer I use and have some urgent work to get done until tomorrow... :-) )

Nathann



---

archive/issue_events_048106.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-10-19T20:19:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48106"
}
```



---

archive/issue_events_048107.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-10-19T20:19:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48107"
}
```



---

archive/issue_events_048108.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-20T17:02:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "rename": {
        "from": "Implement counting of spanning trees for graphs and digraphs + some fixing in kirchhoff_matrix",
        "to": "Implement counting of spanning trees for graphs and digraphs"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48108"
}
```



---

archive/issue_events_048109.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-20T17:02:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48109"
}
```



---

archive/issue_events_048110.json:
```json
{
    "actor": "https://github.com/haaninjo",
    "created_at": "2009-10-20T17:02:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48110"
}
```



---

archive/issue_comments_053213.json:
```json
{
    "body": "<a id='comment:10'></a>\nHello Nathann, thanks for pointing me in the right way, I have made a new patch that just increases the diagonal value of the root vertex by 1, which indeed is a simpler solution. As a bonus there is no longer any need to copy the graph, since we no longer do any changes to the original graph in our computations.\n\nAnders",
    "created_at": "2009-10-20T17:02:54Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53213",
    "user": "https://github.com/haaninjo"
}
```

<a id='comment:10'></a>
Hello Nathann, thanks for pointing me in the right way, I have made a new patch that just increases the diagonal value of the root vertex by 1, which indeed is a simpler solution. As a bonus there is no longer any need to copy the graph, since we no longer do any changes to the original graph in our computations.

Anders



---

archive/issue_comments_053214.json:
```json
{
    "body": "<a id='comment:11'></a>\nNathann, I was wrong!  I've ONLY dealt with Kirchhoff matrices in the context of electrical networks, in which loops are utterly insignificant.  For me, the definition of the Kirchhoff matrix is that the diagonal is the row-sum of the weighted adjacency matrix.  But, the definition you are using appears to be standard, and as noted here, more useful.",
    "created_at": "2009-10-21T01:13:37Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53214",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:11'></a>
Nathann, I was wrong!  I've ONLY dealt with Kirchhoff matrices in the context of electrical networks, in which loops are utterly insignificant.  For me, the definition of the Kirchhoff matrix is that the diagonal is the row-sum of the weighted adjacency matrix.  But, the definition you are using appears to be standard, and as noted here, more useful.



---

archive/issue_comments_053215.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis patch should satisfy all of us, I hope. It includes the last version of AJonsson's code, and it adds an argument to kirchhoff_matrix so that the user may chose if D is the matrix of indegree or outdegrees.\n\nI added the corresponding documentation to the kirchhoff_matrix function.\n\nI have to mention that the way kirchhoff_matrix is written contains a lot of repetitions because of the possibility of different values for the indegree variable. I thought of other ways to write it to preserve the code, but these ways could have at some point impaired the performances, as checks for the values of the variable indegree could have happened much more often. I write it this way as the function is still very short and this should not be a problem for its maintenance.\n\nOh, and the patch is based on 4.1.2.rc0\n\nNathann",
    "created_at": "2009-10-21T10:07:16Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53215",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>
This patch should satisfy all of us, I hope. It includes the last version of AJonsson's code, and it adds an argument to kirchhoff_matrix so that the user may chose if D is the matrix of indegree or outdegrees.

I added the corresponding documentation to the kirchhoff_matrix function.

I have to mention that the way kirchhoff_matrix is written contains a lot of repetitions because of the possibility of different values for the indegree variable. I thought of other ways to write it to preserve the code, but these ways could have at some point impaired the performances, as checks for the values of the variable indegree could have happened much more often. I write it this way as the function is still very short and this should not be a problem for its maintenance.

Oh, and the patch is based on 4.1.2.rc0

Nathann



---

archive/issue_comments_053216.json:
```json
{
    "body": "<a id='comment:13'></a>\nLooks fine to me. With your patch applied there is another line in count_spanning_trees that no longer is needed. Apply this patch on top of trac_7184-reviewer.patch to remove that line.",
    "created_at": "2009-10-21T12:07:08Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53216",
    "user": "https://github.com/haaninjo"
}
```

<a id='comment:13'></a>
Looks fine to me. With your patch applied there is another line in count_spanning_trees that no longer is needed. Apply this patch on top of trac_7184-reviewer.patch to remove that line.



---

archive/issue_comments_053217.json:
```json
{
    "body": "remove unneeded reassignment of all diagonal entries of Kirchhoff matrix",
    "created_at": "2009-10-21T12:08:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53217",
    "user": "https://github.com/haaninjo"
}
```

remove unneeded reassignment of all diagonal entries of Kirchhoff matrix



---

archive/attachments_008887.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac7184-simplified.patch",
    "asset_url": "tarball://root/attachments/ticket7184/trac7184-simplified.patch",
    "created_at": "2009-10-21T12:55:17Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7184/trac7184-simplified.patch",
    "user": "https://github.com/nathanncohen"
}
```



---

archive/issue_comments_053218.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Attachment:** [trac7184-simplified.patch](https://github.com/sagemath/sage/files/ticket7184/trac7184-simplified.patch)\n\nSorryyyyyyy !! I had forgotten to edit your function after I edited kirchhoff_matrix !\n\nHere is a new patch removing this line which is now integrated into kirchhoff_matrix. Besides, I wanted to do something about \n\n```\n\t            for i in self.vertices():  \n\t                        M[j,j]=self.in_degree(i)  \n\t                        if (self.vertices()[j]== root_vertex):  \n\t                            M[j,j]= M[j,j] + 1  \n\t                        j= j + 1  \n```\nWith these lines, you are evaluating all the vertices at each look, just to return its jth element. As the vertices do not change, you could have stored the list of vertices in a variable, each time trying to find the jth element of this list ( without listing allt he vertices again ). But with this new patch, you are just getting the index of the vertex you are interested in, and updating the matrix... And with some luck, this patch is the last one :-)",
    "created_at": "2009-10-21T12:55:17Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53218",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>
**Attachment:** [trac7184-simplified.patch](https://github.com/sagemath/sage/files/ticket7184/trac7184-simplified.patch)

Sorryyyyyyy !! I had forgotten to edit your function after I edited kirchhoff_matrix !

Here is a new patch removing this line which is now integrated into kirchhoff_matrix. Besides, I wanted to do something about 

```
	            for i in self.vertices():  
	                        M[j,j]=self.in_degree(i)  
	                        if (self.vertices()[j]== root_vertex):  
	                            M[j,j]= M[j,j] + 1  
	                        j= j + 1  
```
With these lines, you are evaluating all the vertices at each look, just to return its jth element. As the vertices do not change, you could have stored the list of vertices in a variable, each time trying to find the jth element of this list ( without listing allt he vertices again ). But with this new patch, you are just getting the index of the vertex you are interested in, and updating the matrix... And with some luck, this patch is the last one :-)



---

archive/attachments_008888.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7184-reviewer.patch",
    "asset_url": "tarball://root/attachments/ticket7184/trac_7184-reviewer.patch",
    "created_at": "2009-10-21T14:37:28Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7184/trac_7184-reviewer.patch",
    "user": "https://github.com/haaninjo"
}
```



---

archive/issue_comments_053219.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Attachment:** [trac_7184-reviewer.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184-reviewer.patch)\n\nLooks really nice. I'm fully satisfied with the patch.\n\nAnders",
    "created_at": "2009-10-21T14:37:28Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53219",
    "user": "https://github.com/haaninjo"
}
```

<a id='comment:15'></a>
**Attachment:** [trac_7184-reviewer.patch](https://github.com/sagemath/sage/files/ticket7184/trac_7184-reviewer.patch)

Looks really nice. I'm fully satisfied with the patch.

Anders



---

archive/issue_comments_053220.json:
```json
{
    "body": "<a id='comment:16'></a>\nDo we both agree on a positive review, then ? ;-)",
    "created_at": "2009-10-22T08:04:50Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53220",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>
Do we both agree on a positive review, then ? ;-)



---

archive/issue_comments_053221.json:
```json
{
    "body": "<a id='comment:17'></a>\nWell, I'll take your \"Looks really nice. I'm fully satisfied with the patch\" as as an answer :-)",
    "created_at": "2009-10-26T07:03:05Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53221",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>
Well, I'll take your "Looks really nice. I'm fully satisfied with the patch" as as an answer :-)



---

archive/issue_events_048111.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-10-26T07:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48111"
}
```



---

archive/issue_events_048112.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-10-26T07:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48112"
}
```



---

archive/issue_events_048113.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-26T23:01:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48113"
}
```



---

archive/issue_events_048114.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-26T23:01:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48114"
}
```



---

archive/issue_comments_053222.json:
```json
{
    "body": "<a id='comment:18'></a>\nSorry guys, reviewers need to not touch the code.  Rather... authors can't give the final +1.",
    "created_at": "2009-10-26T23:01:30Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53222",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:18'></a>
Sorry guys, reviewers need to not touch the code.  Rather... authors can't give the final +1.



---

archive/issue_events_048115.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-26T23:01:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "rename": {
        "from": "Implement counting of spanning trees for graphs and digraphs",
        "to": "Implement counting of spanning trees for graphs and digraphs [with patch, needs review]"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48115"
}
```



---

archive/issue_events_048116.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-26T23:01:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48116"
}
```



---

archive/issue_events_048117.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boothby",
    "created_at": "2009-10-26T23:01:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48117"
}
```



---

archive/issue_comments_053223.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2009-12-07T08:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53223",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_comments_053224.json:
```json
{
    "body": "**Merged:** sage-4.3.rc0",
    "created_at": "2009-12-07T08:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53224",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** sage-4.3.rc0



---

archive/issue_events_048118.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-07T08:47:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48118"
}
```



---

archive/issue_events_048119.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-07T08:47:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48119"
}
```



---

archive/issue_comments_053225.json:
```json
{
    "body": "**Author:** Anders Jonsson, Nathann Cohen",
    "created_at": "2009-12-07T08:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53225",
    "user": "https://github.com/mwhansen"
}
```

**Author:** Anders Jonsson, Nathann Cohen



---

archive/issue_comments_053226.json:
```json
{
    "body": "<a id='comment:20'></a>\nLooks good to me.",
    "created_at": "2009-12-07T08:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7184#issuecomment-53226",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:20'></a>
Looks good to me.



---

archive/issue_events_048120.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2009-12-26T19:12:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7184",
    "rename": {
        "from": "Implement counting of spanning trees for graphs and digraphs [with patch, needs review]",
        "to": "Implement counting of spanning trees for graphs and digraphs"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7184#event-48120"
}
```
