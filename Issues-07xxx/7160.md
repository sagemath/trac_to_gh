# Issue 7160: comparison with quadratic number field elements

archive/issues_007160.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: I^2\n-1\nsage: bool(I^2 < 0)\nTrue\nsage: bool(I^2 > 0)\nTrue\n```\n\nApply:\n\n- [attachment: trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)\n\nDepends on #13213\n\nAssignee: **@loefflerd**\n\nCC:  @videlec\n\nKeywords: **sd35**\n\nReviewer: **Burcin Erocal**\n\nAuthor: **Vincent Delecroix**\n\nMerged: **sage-5.11.beta0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7160_\n\n",
    "closed_at": "2013-06-06T12:31:18Z",
    "created_at": "2009-10-08T18:38:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "comparison with quadratic number field elements",
    "type": "issue",
    "updated_at": "2013-06-06T12:31:18Z",
    "url": "https://github.com/sagemath/sage/issues/7160",
    "user": "https://github.com/mwhansen"
}
```

```
sage: I^2
-1
sage: bool(I^2 < 0)
True
sage: bool(I^2 > 0)
True
```

Apply:

- [attachment: trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)

Depends on #13213

Assignee: **@loefflerd**

CC:  @videlec

Keywords: **sd35**

Reviewer: **Burcin Erocal**

Author: **Vincent Delecroix**

Merged: **sage-5.11.beta0**

_Issue created by migration from https://trac.sagemath.org/ticket/7160_





---

archive/issue_events_076785.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-08T18:38:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76785"
}
```



---

archive/issue_events_076786.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-08T18:38:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76786"
}
```



---

archive/issue_events_076787.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-08T18:38:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76787"
}
```



---

archive/issue_events_076788.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-08T18:38:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76788"
}
```



---

archive/issue_events_076789.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-08T18:41:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76789"
}
```



---

archive/issue_comments_053083.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis is basically the same as #6132.",
    "created_at": "2009-10-08T19:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53083",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'>Comment 2:</a>
This is basically the same as #6132.



---

archive/issue_comments_053084.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI think this is confusing:  you have an ordering of elements of a real or imaginary quadratic field which is based on some kind of lexicographic ordering on the representation of the elements rather than anything mathematical.  Presumably this is so lists, etc, can be sorted in a pythonic way.  But I find this bizarre:\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: i>0\nTrue\n```\nand this raises a strange error:\n\n```\nsage: K.<a> = NumberField(x^2+x-10)\nsage: a < -a\n---------------------------------------------------------------------------\nSystemError                               Traceback (most recent call last)\n\n/home/john/.sage/temp/ubuntu/790/_home_john__sage_init_sage_0.py in <module>()\n\nSystemError: error return without exception set\nsage: Type(K)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n\n/home/john/.sage/temp/ubuntu/790/_home_john__sage_init_sage_0.py in <module>()\n\nNameError: name 'Type' is not defined\nsage: type(K)\n<class 'sage.rings.number_field.number_field.NumberField_quadratic'>\n```",
    "created_at": "2009-10-29T21:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53084",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'>Comment 3:</a>
I think this is confusing:  you have an ordering of elements of a real or imaginary quadratic field which is based on some kind of lexicographic ordering on the representation of the elements rather than anything mathematical.  Presumably this is so lists, etc, can be sorted in a pythonic way.  But I find this bizarre:

```
sage: K.<i> = QuadraticField(-1)
sage: i>0
True
```
and this raises a strange error:

```
sage: K.<a> = NumberField(x^2+x-10)
sage: a < -a
---------------------------------------------------------------------------
SystemError                               Traceback (most recent call last)

/home/john/.sage/temp/ubuntu/790/_home_john__sage_init_sage_0.py in <module>()

SystemError: error return without exception set
sage: Type(K)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)

/home/john/.sage/temp/ubuntu/790/_home_john__sage_init_sage_0.py in <module>()

NameError: name 'Type' is not defined
sage: type(K)
<class 'sage.rings.number_field.number_field.NumberField_quadratic'>
```



---

archive/issue_events_076790.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-10-29T21:30:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76790"
}
```



---

archive/issue_events_076791.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-10-29T21:30:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76791"
}
```



---

archive/issue_comments_053085.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nApparently related to #6132 and #10064, see [this sage-devel discussion](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/01168722573ff736).",
    "created_at": "2011-02-07T15:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53085",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'>Comment 4:</a>
Apparently related to #6132 and #10064, see [this sage-devel discussion](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/01168722573ff736).



---

archive/issue_events_076792.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-19T10:32:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76792"
}
```



---

archive/issue_events_076793.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-19T10:32:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76793"
}
```



---

archive/issue_comments_053086.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI've put up a new patch which is minimally invasive and fixes the issue.",
    "created_at": "2011-12-19T10:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53086",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'>Comment 5:</a>
I've put up a new patch which is minimally invasive and fixes the issue.



---

archive/issue_comments_053087.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nDoes this result in any interesting speed regressions when doing things with I?",
    "created_at": "2011-12-19T15:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53087",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'>Comment 6:</a>
Does this result in any interesting speed regressions when doing things with I?



---

archive/issue_comments_053088.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\n1. Typo: \" comparision\" in sage/rings/number_field/number_field_element_quadratic.pyx. \n\n2. This code raises a big red flag for me:\n\n```\n        1704\t                from sage.rings.all import RR \n \t1705\t                r = RR(right) \n \t1706\t                l = RR(embedding(left)) \n \t1707\t                return cmp(l, r) \n```\nMy concern is that you're comparing to double (=53 bits) precision, which is totally arbitrary.  What if there is an embedding and cmp(left, right) requires 54 bits of precision to sort out?  I could probably with some work construct a nasty example of this, where the above code just gives totally the wrong answer.   I guess we need to (1) compute to precision of the embedding, and (2) if cmp(l,r)==0, then check something more?\n\n3. Where is \"self._element_class\" actually used?  I guess by the coercion model, but it's hard to see how from this patch, exactly. \n\n4. I feel like this is too much code that gets around a fundamental problem or bug in number field elements in the case of the reported problem, but leaves the underlying bug unfixed.  Note that *before* applying your patch:\n\n```\nsage: bool(I^2 < 0)\nTrue\nsage: (I^2).pyobject() < 0\nFalse\n```\n\nIt seems to me that the output of both lines above should be the same, right, but I bet pynac is evaluating the first comparison and not even going to the pyobject level. Similarly:\n\n```\nsage: bool(I^2 < SR(0))\nTrue\nsage: (I^2).pyobject() < SR(0).pyobject()\nFalse\n```\n\nThis is because in Sage we currently have:\n\n```\nsage: K.<I> = QuadraticField(-1)\nsage: I^2 < 0\nFalse\nsage: I^2\n-1\n```\nThis is, as Cremona pointed out, due to the arbitrary lexicographic ordering rather than using the one we get on the intersection of K and R inside embedding(K). \n\nSo... it seems to me that the real problem is that the arbitrary ordering is lame.   What you've done is implemented a natural fix in one very, very special case.  Maybe that's the intention, and maybe you had something more general before?  I don't know, since you changed the patch. \n\nI'm guessing your more general patch changed comparison for all elements to:\n  (1) check if there is an embedding of the parent(s), and (2) if so, use that to induce an embedding on *the* real subfield of the field(s).   That would be natural. \n\nSo all of the above, is just me understanding why you are doing what you're doing.  It might make sense to add something like this to the documentation.",
    "created_at": "2011-12-20T06:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53088",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:7'>Comment 7:</a>
1. Typo: " comparision" in sage/rings/number_field/number_field_element_quadratic.pyx. 

2. This code raises a big red flag for me:

```
        1704	                from sage.rings.all import RR 
 	1705	                r = RR(right) 
 	1706	                l = RR(embedding(left)) 
 	1707	                return cmp(l, r) 
```
My concern is that you're comparing to double (=53 bits) precision, which is totally arbitrary.  What if there is an embedding and cmp(left, right) requires 54 bits of precision to sort out?  I could probably with some work construct a nasty example of this, where the above code just gives totally the wrong answer.   I guess we need to (1) compute to precision of the embedding, and (2) if cmp(l,r)==0, then check something more?

3. Where is "self._element_class" actually used?  I guess by the coercion model, but it's hard to see how from this patch, exactly. 

4. I feel like this is too much code that gets around a fundamental problem or bug in number field elements in the case of the reported problem, but leaves the underlying bug unfixed.  Note that *before* applying your patch:

```
sage: bool(I^2 < 0)
True
sage: (I^2).pyobject() < 0
False
```

It seems to me that the output of both lines above should be the same, right, but I bet pynac is evaluating the first comparison and not even going to the pyobject level. Similarly:

```
sage: bool(I^2 < SR(0))
True
sage: (I^2).pyobject() < SR(0).pyobject()
False
```

This is because in Sage we currently have:

```
sage: K.<I> = QuadraticField(-1)
sage: I^2 < 0
False
sage: I^2
-1
```
This is, as Cremona pointed out, due to the arbitrary lexicographic ordering rather than using the one we get on the intersection of K and R inside embedding(K). 

So... it seems to me that the real problem is that the arbitrary ordering is lame.   What you've done is implemented a natural fix in one very, very special case.  Maybe that's the intention, and maybe you had something more general before?  I don't know, since you changed the patch. 

I'm guessing your more general patch changed comparison for all elements to:
  (1) check if there is an embedding of the parent(s), and (2) if so, use that to induce an embedding on *the* real subfield of the field(s).   That would be natural. 

So all of the above, is just me understanding why you are doing what you're doing.  It might make sense to add something like this to the documentation.



---

archive/issue_comments_053089.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nNote: With sage-4.8.alpha5 and this patch, all tests in devel/sage/sage pass.",
    "created_at": "2011-12-20T07:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53089",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'>Comment 8:</a>
Note: With sage-4.8.alpha5 and this patch, all tests in devel/sage/sage pass.



---

archive/issue_comments_053090.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@williamstein](#comment%3A7):\n> 2. This code raises a big red flag for me:\n\n\n```\n\t1704\t                from sage.rings.all import RR \n\t1705\t                r = RR(right) \n\t1706\t                l = RR(embedding(left)) \n\t1707\t                return cmp(l, r) \n```\n> My concern is that you're comparing to double (=53 bits) precision, which is totally arbitrary. What if there is an embedding and cmp(left, right) requires 54 bits of precision to sort out?  I could probably with some work construct a nasty example of this, where the above code just gives totally the wrong answer.   I guess we need to (1) compute to precision of the embedding, and (2) if cmp(l,r)==0, then check something more?\n\nIsn't this what we have the QQbar class for?",
    "created_at": "2011-12-20T09:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53090",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@williamstein](#comment%3A7):
> 2. This code raises a big red flag for me:


```
	1704	                from sage.rings.all import RR 
	1705	                r = RR(right) 
	1706	                l = RR(embedding(left)) 
	1707	                return cmp(l, r) 
```
> My concern is that you're comparing to double (=53 bits) precision, which is totally arbitrary. What if there is an embedding and cmp(left, right) requires 54 bits of precision to sort out?  I could probably with some work construct a nasty example of this, where the above code just gives totally the wrong answer.   I guess we need to (1) compute to precision of the embedding, and (2) if cmp(l,r)==0, then check something more?

Isn't this what we have the QQbar class for?



---

archive/issue_comments_053091.json:
```json
{
    "body": "Attachment: **[trac_7160.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160.patch.gz)**",
    "created_at": "2011-12-20T10:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53091",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[trac_7160.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160.patch.gz)**



---

archive/issue_comments_053092.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI've added a new patch which should be better.  It turns out just using the embedding directly should be fine.",
    "created_at": "2011-12-20T10:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53092",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'>Comment 10:</a>
I've added a new patch which should be better.  It turns out just using the embedding directly should be fine.



---

archive/issue_comments_053093.json:
```json
{
    "body": "Changed keywords from **** to **sd35**",
    "created_at": "2011-12-20T12:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53093",
    "user": "https://github.com/mwhansen"
}
```

Changed keywords from **** to **sd35**



---

archive/issue_events_076794.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-01-10T05:41:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76794"
}
```



---

archive/issue_events_076795.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-01-10T05:41:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76795"
}
```



---

archive/issue_comments_053094.json:
```json
{
    "body": "Changed author from **Mike Hansen** to **Mike Hansen, Burcin Erocal**",
    "created_at": "2012-01-10T05:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53094",
    "user": "https://github.com/burcin"
}
```

Changed author from **Mike Hansen** to **Mike Hansen, Burcin Erocal**



---

archive/issue_comments_053095.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nAttachment: **[trac_7160-Q_to_quadratic_field_element.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-Q_to_quadratic_field_element.patch.gz)**\n\nReplying to [@williamstein](#comment%3A7):\n> 4. I feel like this is too much code that gets around a fundamental problem or bug in number field elements in the case of the reported problem, but leaves the underlying bug unfixed.  Note that *before* applying your patch:\n\n\n ```\n sage: bool(I^2 < 0)\n True\n sage: (I^2).pyobject() < 0\n False\n   ```\n> \n> It seems to me that the output of both lines above should be the same, right, but I bet pynac is evaluating the first comparison and not even going to the pyobject level.\n\nThe first comparison is done in the `test_relation()` method of `sage.symbolic.expression.Expression`. This converts both sides of the relation to `CIF` and performs the comparison there.\n\n> Similarly:\n> \n> ```\n> sage: bool(I^2 < SR(0))\n> True\n> sage: (I^2).pyobject() < SR(0).pyobject()\n> False\n> ```\n> \n> This is because in Sage we currently have:\n> \n> ```\n> sage: K.<I> = QuadraticField(-1)\n> sage: I^2 < 0\n> False\n> sage: I^2\n> -1\n> ```\n> This is, as Cremona pointed out, due to the arbitrary lexicographic ordering rather than using the one we get on the intersection of K and R inside embedding(K). \n> \n> So... it seems to me that the real problem is that the arbitrary ordering is lame.   What you've done is implemented a natural fix in one very, very special case.  Maybe that's the intention, and maybe you had something more general before?  I don't know, since you changed the patch. \n\nNote that this lame ordering is causing problems all over symbolics since `is_positive()` checks fail. See #10849, #10062, #10064 for examples.\n\n> I'm guessing your more general patch changed comparison for all elements to:\n>   (1) check if there is an embedding of the parent(s), and (2) if so, use that to induce an embedding on *the* real subfield of the field(s).   That would be natural. \n\nI attached a new patch at [attachment: trac_7160-quadratic_number_field_element_comparison.patch,.gz](https://github.com/sagemath/sage/files/ticket7160/174eeeeec85b84123c2dbe6dfb609f77.gz) based on Mike's last patch [attachment: trac_7160.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160.patch.gz)This changes the comparison function of quadratic number field elements to always use the embedding into `CC`.\n\nTimings with the patch:\n\n```\nsage: K.<sqrt2> = QuadraticField(2)\nsage: t = K.random_element(); t\n-2*sqrt2 - 35\nsage: u = K.random_element(); u\n-1\nsage: %timeit res = cmp(t,u)\n625 loops, best of 3: 659 \u00b5s per loop\nsage: u = K.random_element(); u\n-2*sqrt2 - 1\nsage: %timeit res = cmp(t,u)\n625 loops, best of 3: 807 \u00b5s per loop\n```\n\nWithout the patch:\n\n```\nsage: K.<sqrt2> = QuadraticField(2)\nsage: t = -2*sqrt2 - 35\nsage: u = K(-1)\nsage: %timeit res = cmp(t,u)\n625 loops, best of 3: 419 ns per loop\nsage: u = -2*sqrt2 - 1\nsage: %timeit res = cmp(t,u)\n625 loops, best of 3: 419 ns per loop\n```\n\nSo there is a significant slow down.\n\nThere are two failing doctests I need help with:\n\n```\nsage -t  devel/sage/sage/schemes/elliptic_curves/ell_curve_isogeny.py\n**********************************************************************\nFile \"/home/burcin/sage/sage-5.0.prealpha0/devel/sage-main/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 4361:\n    sage: _[0].rational_maps()\nExpected:\n    (((-4/25*i - 3/25)*x^5 + (-4/5*i + 2/5)*x^3 + x)/(x^4 + (-4/5*i + 2/5)*x^2 + (-4/25*i - 3/25)),\n    ((2/125*i - 11/125)*x^6*y + (64/125*i + 23/125)*x^4*y + (162/125*i - 141/125)*x^2*y + (-4/25*i - 3/25)*y)/(x^6 + (-6/5*i + 3/5)*x^4 + (-12/25*i - 9/25)*x^2 + (2/125*i - 11/125)))\nGot:\n    (((4/25*i + 3/25)*x^5 + (4/5*i - 2/5)*x^3 - x)/(x^4 + (-4/5*i + 2/5)*x^2 + (-4/25*i - 3/25)), ((11/125*i + 2/125)*x^6*y + (-23/125*i + 64/125)*x^4*y + (141/125*i + 162/125)*x^2*y + (3/25*i - 4/25)*y)/(x^6 + (-6/5*i + 3/5)*x^4 + (-12/25*i - 9/25)*x^2 + (2/125*i - 11/125)))\n**********************************************************************\nFile \"/home/burcin/sage/sage-5.0.prealpha0/devel/sage-main/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 4622:\n    sage: isogenies_13_0(E)[0].rational_maps()\nExpected:\n    (((-4/169*r - 11/169)*x^13 + (-128/13*r - 456/13)*x^10 + (-1224/13*r - 2664/13)*x^7 + (-2208/13*r + 5472/13)*x^4 + (1152/13*r - 8064/13)*x)/(x^12 + (4*r - 36)*x^9 + (-1080/13*r + 3816/13)*x^6 + (2112/13*r + 5184/13)*x^3 + (17280/169*r - 1152/169)), ((18/2197*r - 35/2197)*x^18*y + (-23142/2197*r + 35478/2197)*x^15*y + (-1127520/2197*r + 1559664/2197)*x^12*y + (87744/2197*r + 5992704/2197)*x^9*y + (-6625152/2197*r + 9085824/2197)*x^6*y + (28919808/2197*r - 2239488/2197)*x^3*y + (-1990656/2197*r + 3870720/2197)*y)/(x^18 + (6*r - 54)*x^15 + (-3024/13*r + 11808/13)*x^12 + (31296/13*r - 51840/13)*x^9 + (-487296/169*r - 2070144/169)*x^6 + (-940032/169*r - 248832/169)*x^3 + (-1990656/2197*r + 3870720/2197)))\nGot:\n    (((7/338*r + 23/338)*x^13 + (-164/13*r - 420/13)*x^10 + (720/13*r + 3168/13)*x^7 + (3840/13*r - 576/13)*x^4 + (4608/13*r + 2304/13)*x)/(x^12 + (4*r + 36)*x^9 + (1080/13*r + 3816/13)*x^6 + (2112/13*r - 5184/13)*x^3 + (-17280/169*r - 1152/169)), ((18/2197*r + 35/2197)*x^18*y + (23142/2197*r + 35478/2197)*x^15*y + (-1127520/2197*r - 1559664/2197)*x^12*y + (-87744/2197*r + 5992704/2197)*x^9*y + (-6625152/2197*r - 9085824/2197)*x^6*y + (-28919808/2197*r - 2239488/2197)*x^3*y + (-1990656/2197*r - 3870720/2197)*y)/(x^18 + (6*r + 54)*x^15 + (3024/13*r + 11808/13)*x^12 + (31296/13*r + 51840/13)*x^9 + (487296/169*r - 2070144/169)*x^6 + (-940032/169*r + 248832/169)*x^3 + (1990656/2197*r + 3870720/2197)))\n```",
    "created_at": "2012-01-10T05:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53095",
    "user": "https://github.com/burcin"
}
```

<a id='comment:12'>Comment 12:</a>
Attachment: **[trac_7160-Q_to_quadratic_field_element.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-Q_to_quadratic_field_element.patch.gz)**

Replying to [@williamstein](#comment%3A7):
> 4. I feel like this is too much code that gets around a fundamental problem or bug in number field elements in the case of the reported problem, but leaves the underlying bug unfixed.  Note that *before* applying your patch:


 ```
 sage: bool(I^2 < 0)
 True
 sage: (I^2).pyobject() < 0
 False
   ```
> 
> It seems to me that the output of both lines above should be the same, right, but I bet pynac is evaluating the first comparison and not even going to the pyobject level.

The first comparison is done in the `test_relation()` method of `sage.symbolic.expression.Expression`. This converts both sides of the relation to `CIF` and performs the comparison there.

> Similarly:
> 
> ```
> sage: bool(I^2 < SR(0))
> True
> sage: (I^2).pyobject() < SR(0).pyobject()
> False
> ```
> 
> This is because in Sage we currently have:
> 
> ```
> sage: K.<I> = QuadraticField(-1)
> sage: I^2 < 0
> False
> sage: I^2
> -1
> ```
> This is, as Cremona pointed out, due to the arbitrary lexicographic ordering rather than using the one we get on the intersection of K and R inside embedding(K). 
> 
> So... it seems to me that the real problem is that the arbitrary ordering is lame.   What you've done is implemented a natural fix in one very, very special case.  Maybe that's the intention, and maybe you had something more general before?  I don't know, since you changed the patch. 

Note that this lame ordering is causing problems all over symbolics since `is_positive()` checks fail. See #10849, #10062, #10064 for examples.

> I'm guessing your more general patch changed comparison for all elements to:
>   (1) check if there is an embedding of the parent(s), and (2) if so, use that to induce an embedding on *the* real subfield of the field(s).   That would be natural. 

I attached a new patch at [attachment: trac_7160-quadratic_number_field_element_comparison.patch,.gz](https://github.com/sagemath/sage/files/ticket7160/174eeeeec85b84123c2dbe6dfb609f77.gz) based on Mike's last patch [attachment: trac_7160.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160.patch.gz)This changes the comparison function of quadratic number field elements to always use the embedding into `CC`.

Timings with the patch:

```
sage: K.<sqrt2> = QuadraticField(2)
sage: t = K.random_element(); t
-2*sqrt2 - 35
sage: u = K.random_element(); u
-1
sage: %timeit res = cmp(t,u)
625 loops, best of 3: 659 µs per loop
sage: u = K.random_element(); u
-2*sqrt2 - 1
sage: %timeit res = cmp(t,u)
625 loops, best of 3: 807 µs per loop
```

Without the patch:

```
sage: K.<sqrt2> = QuadraticField(2)
sage: t = -2*sqrt2 - 35
sage: u = K(-1)
sage: %timeit res = cmp(t,u)
625 loops, best of 3: 419 ns per loop
sage: u = -2*sqrt2 - 1
sage: %timeit res = cmp(t,u)
625 loops, best of 3: 419 ns per loop
```

So there is a significant slow down.

There are two failing doctests I need help with:

```
sage -t  devel/sage/sage/schemes/elliptic_curves/ell_curve_isogeny.py
**********************************************************************
File "/home/burcin/sage/sage-5.0.prealpha0/devel/sage-main/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 4361:
    sage: _[0].rational_maps()
Expected:
    (((-4/25*i - 3/25)*x^5 + (-4/5*i + 2/5)*x^3 + x)/(x^4 + (-4/5*i + 2/5)*x^2 + (-4/25*i - 3/25)),
    ((2/125*i - 11/125)*x^6*y + (64/125*i + 23/125)*x^4*y + (162/125*i - 141/125)*x^2*y + (-4/25*i - 3/25)*y)/(x^6 + (-6/5*i + 3/5)*x^4 + (-12/25*i - 9/25)*x^2 + (2/125*i - 11/125)))
Got:
    (((4/25*i + 3/25)*x^5 + (4/5*i - 2/5)*x^3 - x)/(x^4 + (-4/5*i + 2/5)*x^2 + (-4/25*i - 3/25)), ((11/125*i + 2/125)*x^6*y + (-23/125*i + 64/125)*x^4*y + (141/125*i + 162/125)*x^2*y + (3/25*i - 4/25)*y)/(x^6 + (-6/5*i + 3/5)*x^4 + (-12/25*i - 9/25)*x^2 + (2/125*i - 11/125)))
**********************************************************************
File "/home/burcin/sage/sage-5.0.prealpha0/devel/sage-main/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 4622:
    sage: isogenies_13_0(E)[0].rational_maps()
Expected:
    (((-4/169*r - 11/169)*x^13 + (-128/13*r - 456/13)*x^10 + (-1224/13*r - 2664/13)*x^7 + (-2208/13*r + 5472/13)*x^4 + (1152/13*r - 8064/13)*x)/(x^12 + (4*r - 36)*x^9 + (-1080/13*r + 3816/13)*x^6 + (2112/13*r + 5184/13)*x^3 + (17280/169*r - 1152/169)), ((18/2197*r - 35/2197)*x^18*y + (-23142/2197*r + 35478/2197)*x^15*y + (-1127520/2197*r + 1559664/2197)*x^12*y + (87744/2197*r + 5992704/2197)*x^9*y + (-6625152/2197*r + 9085824/2197)*x^6*y + (28919808/2197*r - 2239488/2197)*x^3*y + (-1990656/2197*r + 3870720/2197)*y)/(x^18 + (6*r - 54)*x^15 + (-3024/13*r + 11808/13)*x^12 + (31296/13*r - 51840/13)*x^9 + (-487296/169*r - 2070144/169)*x^6 + (-940032/169*r - 248832/169)*x^3 + (-1990656/2197*r + 3870720/2197)))
Got:
    (((7/338*r + 23/338)*x^13 + (-164/13*r - 420/13)*x^10 + (720/13*r + 3168/13)*x^7 + (3840/13*r - 576/13)*x^4 + (4608/13*r + 2304/13)*x)/(x^12 + (4*r + 36)*x^9 + (1080/13*r + 3816/13)*x^6 + (2112/13*r - 5184/13)*x^3 + (-17280/169*r - 1152/169)), ((18/2197*r + 35/2197)*x^18*y + (23142/2197*r + 35478/2197)*x^15*y + (-1127520/2197*r - 1559664/2197)*x^12*y + (-87744/2197*r + 5992704/2197)*x^9*y + (-6625152/2197*r - 9085824/2197)*x^6*y + (-28919808/2197*r - 2239488/2197)*x^3*y + (-1990656/2197*r - 3870720/2197)*y)/(x^18 + (6*r + 54)*x^15 + (3024/13*r + 11808/13)*x^12 + (31296/13*r + 51840/13)*x^9 + (487296/169*r - 2070144/169)*x^6 + (-940032/169*r + 248832/169)*x^3 + (1990656/2197*r + 3870720/2197)))
```



---

archive/issue_comments_053096.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThis patch doesn't apply to 5.0.beta11 -- see patchbot logs.",
    "created_at": "2012-03-29T17:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53096",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:13'>Comment 13:</a>
This patch doesn't apply to 5.0.beta11 -- see patchbot logs.



---

archive/issue_comments_053097.json:
```json
{
    "body": "Work Issues: **needs rebase**",
    "created_at": "2012-03-29T17:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53097",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **needs rebase**



---

archive/issue_events_076796.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-29T17:21:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76796"
}
```



---

archive/issue_events_076797.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-29T17:21:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76797"
}
```



---

archive/issue_comments_053098.json:
```json
{
    "body": "Attachment: **[trac_7160-quadratic_number_field_element_comparison.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-quadratic_number_field_element_comparison.patch.gz)**\n\napply only this patch",
    "created_at": "2012-03-29T20:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53098",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[trac_7160-quadratic_number_field_element_comparison.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-quadratic_number_field_element_comparison.patch.gz)**

apply only this patch



---

archive/issue_comments_053099.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nI rebased the patch to beta11.",
    "created_at": "2012-03-29T20:23:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53099",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:14'>Comment 14:</a>
I rebased the patch to beta11.



---

archive/issue_events_076798.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-04-15T02:34:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76798"
}
```



---

archive/issue_events_076799.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-04-15T02:34:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76799"
}
```



---

archive/issue_comments_053100.json:
```json
{
    "body": "Changed work issues from **needs rebase** to none",
    "created_at": "2012-04-15T02:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53100",
    "user": "https://github.com/orlitzky"
}
```

Changed work issues from **needs rebase** to none



---

archive/issue_comments_053101.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThis applies cleanly on beta13, I believe it needs review again?",
    "created_at": "2012-04-15T02:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53101",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'>Comment 15:</a>
This applies cleanly on beta13, I believe it needs review again?



---

archive/issue_comments_053102.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThis ticket applies against cleanly against 5.1.beta0 but still has the two doctest failures.  This patch would get rid of several other problems -- #10064 and #10849 -- so it'd be nice to get in.",
    "created_at": "2012-05-25T04:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53102",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:16'>Comment 16:</a>
This ticket applies against cleanly against 5.1.beta0 but still has the two doctest failures.  This patch would get rid of several other problems -- #10064 and #10849 -- so it'd be nice to get in.



---

archive/issue_events_076800.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-05-29T19:32:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76800"
}
```



---

archive/issue_events_076801.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-05-29T19:32:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76801"
}
```



---

archive/issue_comments_053103.json:
```json
{
    "body": "Work Issues: **doctest failures**",
    "created_at": "2012-05-29T19:32:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53103",
    "user": "https://github.com/orlitzky"
}
```

Work Issues: **doctest failures**



---

archive/issue_comments_053104.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nHi,\n\nI made a sort of duplicate with #13213. My aim was to use the natural order of RR in the case of real embedding. For quadratic field it is quite easy and fast. In the same patch, I aim to implement other functions related to the real embedding (is_positive, floor, ceil, abs, ...).\n\nOn the other hand, the difference of timings with my patch have an order of magnitude of x10 and not of x1000.\n\nShould I close my ticket ? What to do with my patch ?",
    "created_at": "2012-07-09T07:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53104",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'>Comment 18:</a>
Hi,

I made a sort of duplicate with #13213. My aim was to use the natural order of RR in the case of real embedding. For quadratic field it is quite easy and fast. In the same patch, I aim to implement other functions related to the real embedding (is_positive, floor, ceil, abs, ...).

On the other hand, the difference of timings with my patch have an order of magnitude of x10 and not of x1000.

Should I close my ticket ? What to do with my patch ?



---

archive/issue_comments_053105.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nHi Vincent,\n\nthanks a lot for taking a look at this long standing problem.\n\nReplying to [@videlec](#comment%3A18):\n> I made a sort of duplicate with #13213. My aim was to use the natural order of RR in the case of real embedding. For quadratic field it is quite easy and fast. In the same patch, I aim to implement other functions related to the real embedding (is_positive, floor, ceil, abs, ...).\n\nFixing the comparison of quadratic number fields elements and implementing `floor`, `ceil`, etc. should be in separate patches.\n\n> On the other hand, the difference of timings with my patch have an order of magnitude of x10 and not of x1000.\n> \n> Should I close my ticket ? What to do with my patch ?\n\nSince your patch performs much better, we can move ahead using that. I will try to review your patch on #13213.\n\nOnce the patches in this ticket are rebased on your patch, we can close this as a duplicate.",
    "created_at": "2012-07-10T15:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53105",
    "user": "https://github.com/burcin"
}
```

<a id='comment:20'>Comment 20:</a>
Hi Vincent,

thanks a lot for taking a look at this long standing problem.

Replying to [@videlec](#comment%3A18):
> I made a sort of duplicate with #13213. My aim was to use the natural order of RR in the case of real embedding. For quadratic field it is quite easy and fast. In the same patch, I aim to implement other functions related to the real embedding (is_positive, floor, ceil, abs, ...).

Fixing the comparison of quadratic number fields elements and implementing `floor`, `ceil`, etc. should be in separate patches.

> On the other hand, the difference of timings with my patch have an order of magnitude of x10 and not of x1000.
> 
> Should I close my ticket ? What to do with my patch ?

Since your patch performs much better, we can move ahead using that. I will try to review your patch on #13213.

Once the patches in this ticket are rebased on your patch, we can close this as a duplicate.



---

archive/issue_comments_053106.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nNow #13213 is in positive review (and performances much better than what I expected at the begining)! Should we add a doctest related to the example in the description of the ticket or do we simply close it as a duplicate ?",
    "created_at": "2013-05-15T17:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53106",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>Comment 21:</a>
Now #13213 is in positive review (and performances much better than what I expected at the begining)! Should we add a doctest related to the example in the description of the ticket or do we simply close it as a duplicate ?



---

archive/issue_comments_053107.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n> Now #13213 is in positive review (and performances much better than what I expected at the begining)! Should we add a doctest related to the example in the description of the ticket or do we simply close it as a duplicate ?\n\nIf there are nearly identical examples to these in #13213, then I think that's okay; if there is nothing like this there, we should add a trivial patch. to check it's improved.   I'm not going to look through that whole patch to find ones like this but presumably you know whether there is one like that, as the author :)",
    "created_at": "2013-05-15T18:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53107",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'>Comment 22:</a>
> Now #13213 is in positive review (and performances much better than what I expected at the begining)! Should we add a doctest related to the example in the description of the ticket or do we simply close it as a duplicate ?

If there are nearly identical examples to these in #13213, then I think that's okay; if there is nothing like this there, we should add a trivial patch. to check it's improved.   I'm not going to look through that whole patch to find ones like this but presumably you know whether there is one like that, as the author :)



---

archive/issue_comments_053108.json:
```json
{
    "body": "Attachment: **[trac_7160-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.patch.gz)**",
    "created_at": "2013-05-15T20:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53108",
    "user": "https://github.com/videlec"
}
```

Attachment: **[trac_7160-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.patch.gz)**



---

archive/issue_comments_053109.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThere are no example which deals with the symbolic ring... that's why I suggested to add some doctest here. See the proposition in the patch. Nevertheless, I found stupid the following behavior (or at least confusing)\n\n```\nsage: I**2 == -1\n-1 == -1\nsage: (I+4)**4 > 0\n-4 > 0\n```\n\napply trac_7160-doctest.patch",
    "created_at": "2013-05-15T20:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53109",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'>Comment 23:</a>
There are no example which deals with the symbolic ring... that's why I suggested to add some doctest here. See the proposition in the patch. Nevertheless, I found stupid the following behavior (or at least confusing)

```
sage: I**2 == -1
-1 == -1
sage: (I+4)**4 > 0
-4 > 0
```

apply trac_7160-doctest.patch



---

archive/issue_events_076802.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2013-05-15T20:36:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76802"
}
```



---

archive/issue_events_076803.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2013-05-15T20:36:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76803"
}
```



---

archive/issue_comments_053110.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,7 @@\n sage: bool(I^2 > 0)\n True\n ```\n+\n+Apply:\n+\n+- trac_7160-doctest.patch\n``````\n",
    "created_at": "2013-05-15T20:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53110",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,7 @@
 sage: bool(I^2 > 0)
 True
 ```
+
+Apply:
+
+- trac_7160-doctest.patch
``````




---

archive/issue_comments_053111.json:
```json
{
    "body": "Dependencies: **#13213**",
    "created_at": "2013-05-15T20:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53111",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#13213**



---

archive/issue_events_076804.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2013-05-31T22:15:44Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "title_is": "comparison with quadratic number field elements",
    "title_was": "comparison with quadratic number field elements needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76804"
}
```



---

archive/issue_comments_053112.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nNow #13213 is positive review. I guess we may close that ticket ?",
    "created_at": "2013-05-31T22:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53112",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'>Comment 25:</a>
Now #13213 is positive review. I guess we may close that ticket ?



---

archive/issue_comments_053113.json:
```json
{
    "body": "Attachment: **[trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)**\n\nfix commit message, and sphinx trac link",
    "created_at": "2013-06-03T13:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53113",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)**

fix commit message, and sphinx trac link



---

archive/issue_events_076805.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-03T13:56:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76805"
}
```



---

archive/issue_events_076806.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-03T13:56:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76806"
}
```



---

archive/issue_comments_053114.json:
```json
{
    "body": "Reviewer: **Burcin Erocal**",
    "created_at": "2013-06-03T13:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53114",
    "user": "https://github.com/burcin"
}
```

Reviewer: **Burcin Erocal**



---

archive/issue_comments_053115.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nI attached a new patch which fixes the commit message and missing `:` before the trac link in the documentation. This is good to go.\n\nThanks!",
    "created_at": "2013-06-03T13:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53115",
    "user": "https://github.com/burcin"
}
```

<a id='comment:26'>Comment 26:</a>
I attached a new patch which fixes the commit message and missing `:` before the trac link in the documentation. This is good to go.

Thanks!



---

archive/issue_comments_053116.json:
```json
{
    "body": "Changed author from **Mike Hansen, Burcin Erocal** to **Vincent Delecroix**",
    "created_at": "2013-06-03T13:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53116",
    "user": "https://github.com/burcin"
}
```

Changed author from **Mike Hansen, Burcin Erocal** to **Vincent Delecroix**



---

archive/issue_comments_053117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n Apply:\n \n-- trac_7160-doctest.patch\n+- [attachment: trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)\n``````\n",
    "created_at": "2013-06-03T13:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53117",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 Apply:
 
-- trac_7160-doctest.patch
+- [attachment: trac_7160-doctest.take2.patch.gz](https://github.com/sagemath/sage/files/ticket7160/trac_7160-doctest.take2.patch.gz)
``````




---

archive/issue_events_076807.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-03T15:40:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76807"
}
```



---

archive/issue_events_076808.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-03T15:40:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76808"
}
```



---

archive/issue_comments_053118.json:
```json
{
    "body": "Changed work issues from **doctest failures** to none",
    "created_at": "2013-06-03T15:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53118",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **doctest failures** to none



---

archive/issue_comments_053119.json:
```json
{
    "body": "Merged: **sage-5.11.beta0**",
    "created_at": "2013-06-06T12:31:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7160#issuecomment-53119",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.11.beta0**



---

archive/issue_events_076809.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:31:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76809"
}
```



---

archive/issue_events_076810.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:31:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7160#event-76810"
}
```
