# Issue 7676: shortest_path_all pairs in Cython through Floyd Warshall

archive/issues_007676.json:
```json
{
    "body": "Everything is explained there :\n\nhttp://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm\n\nAssignee: @rlmill\n\nBranch/Commit: 12d4018639ea9df2cb2b0d44ea7707cc429be1d5\n\nReviewer: Dima Pasechnik\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/7676\n\n",
    "closed_at": "2021-12-12T15:09:08Z",
    "created_at": "2009-12-13T16:33:51Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "shortest_path_all pairs in Cython through Floyd Warshall",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7676",
    "user": "https://github.com/nathanncohen"
}
```
Everything is explained there :

http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm

Assignee: @rlmill

Branch/Commit: 12d4018639ea9df2cb2b0d44ea7707cc429be1d5

Reviewer: Dima Pasechnik

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/7676





---

archive/issue_comments_075119.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-06-06T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75119",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_work.



---

archive/issue_events_030565.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30565"
}
```



---

archive/issue_events_030566.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30566"
}
```



---

archive/issue_events_030567.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30567"
}
```



---

archive/issue_events_030568.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30568"
}
```



---

archive/issue_events_030569.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30569"
}
```



---

archive/issue_events_030570.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30570"
}
```



---

archive/issue_events_030571.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30571"
}
```



---

archive/issue_comments_075120.json:
```json
{
    "body": "<a id='comment:6'></a>\nAccording to https://ask.sagemath.org/question/44823/sage-floyd-algorithm-in-cython/ SciPy already includes an implementation of this that is quite fast, and should probably be used over any implementation in Sage.",
    "created_at": "2019-01-07T13:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75120",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
According to https://ask.sagemath.org/question/44823/sage-floyd-algorithm-in-cython/ SciPy already includes an implementation of this that is quite fast, and should probably be used over any implementation in Sage.



---

archive/issue_events_030572.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-07T13:11:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30572"
}
```



---

archive/issue_events_030573.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-07T13:11:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30573"
}
```



---

archive/issue_comments_075121.json:
```json
{
    "body": "<a id='comment:7'></a>\nIf nobody else is currently working on this can I go ahead and implement shortest_path_all pair using Floyd warshall algorithm ?",
    "created_at": "2020-02-06T18:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75121",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:7'></a>
If nobody else is currently working on this can I go ahead and implement shortest_path_all pair using Floyd warshall algorithm ?



---

archive/issue_comments_075122.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe first step is to survey the many algorithms we already have with data structures and specific conditions (e.g., weighted, multi edges, loops, etc.).",
    "created_at": "2020-02-07T07:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75122",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
The first step is to survey the many algorithms we already have with data structures and specific conditions (e.g., weighted, multi edges, loops, etc.).



---

archive/issue_comments_075123.json:
```json
{
    "body": "<a id='comment:9'></a>\nI have surveyed all the algorithm and data structure sage has. All pair shortest path works only for an unweighted graph. Although we can use boost interface for this purpose. But I think sage should have its own implementation of Floyd Warshall algorithm[https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm](https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm) for a weighted graph with positive or negative edge weights(but with no negative cycles).",
    "created_at": "2020-02-08T08:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75123",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:9'></a>
I have surveyed all the algorithm and data structure sage has. All pair shortest path works only for an unweighted graph. Although we can use boost interface for this purpose. But I think sage should have its own implementation of Floyd Warshall algorithm[https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm](https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm) for a weighted graph with positive or negative edge weights(but with no negative cycles).



---

archive/issue_comments_075124.json:
```json
{
    "body": "<a id='comment:10'></a>\nI don't think sage should have it's own implementation if the one of Boost is fast enough. \nYou can give it a try, but I'm not sure you can produce something faster than `'Floyd-Warshall_Boost'`.\n\nNote that we already have a (slow) Python implementation `'Floyd-Warshall-Python'` for weighted graphs, and a Cython implementation `'Floyd-Warshall-Cython'` but for unweighted graphs only.",
    "created_at": "2020-02-08T11:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75124",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
I don't think sage should have it's own implementation if the one of Boost is fast enough. 
You can give it a try, but I'm not sure you can produce something faster than `'Floyd-Warshall_Boost'`.

Note that we already have a (slow) Python implementation `'Floyd-Warshall-Python'` for weighted graphs, and a Cython implementation `'Floyd-Warshall-Cython'` but for unweighted graphs only.



---

archive/issue_comments_075125.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks for your helpful suggestion. I will look into it.",
    "created_at": "2020-02-08T13:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75125",
    "user": "https://github.com/vipul79321"
}
```

<a id='comment:11'></a>
Thanks for your helpful suggestion. I will look into it.



---

archive/issue_comments_075126.json:
```json
{
    "body": "<a id='comment:12'></a>\nI added the `Floyd-Warshall` implementation of `SciPy`. It's working well but it's not as fast as expected. In fact, most of the time is wasted in turning the graph to a Numpy array and then turning the results to required dict of dicts.\n\n```\nsage: D = digraphs.RandomDirectedGNP(30, .33)\nsage: for u, v in D.edges(labels=False):\n....:     D.set_edge_label(u, v, randrange(100))\nsage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_Boost')\nCPU times: user 6.44 ms, sys: 517 \u00b5s, total: 6.96 ms\nWall time: 6.56 ms\nsage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_SciPy')\nCPU times: user 30.2 ms, sys: 1.85 ms, total: 32 ms\nWall time: 30.6 ms\n```\n\n```\nsage: D = digraphs.RandomDirectedGNP(300, .33)\nsage: for u, v in D.edges(labels=False):\n....:     D.set_edge_label(u, v, randrange(100))\nsage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_Boost')\nCPU times: user 2.73 s, sys: 18.6 ms, total: 2.75 s\nWall time: 2.76 s\nsage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_SciPy')\nCPU times: user 1.95 s, sys: 61.6 ms, total: 2.01 s\nWall time: 2.13 s\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[12d4018](https://github.com/sagemath/sagetrac-mirror/commit/12d4018639ea9df2cb2b0d44ea7707cc429be1d5)|`trac #7676: Floyd-Warshall with SciPy`|",
    "created_at": "2021-10-16T16:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75126",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>
I added the `Floyd-Warshall` implementation of `SciPy`. It's working well but it's not as fast as expected. In fact, most of the time is wasted in turning the graph to a Numpy array and then turning the results to required dict of dicts.

```
sage: D = digraphs.RandomDirectedGNP(30, .33)
sage: for u, v in D.edges(labels=False):
....:     D.set_edge_label(u, v, randrange(100))
sage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_Boost')
CPU times: user 6.44 ms, sys: 517 µs, total: 6.96 ms
Wall time: 6.56 ms
sage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_SciPy')
CPU times: user 30.2 ms, sys: 1.85 ms, total: 32 ms
Wall time: 30.6 ms
```

```
sage: D = digraphs.RandomDirectedGNP(300, .33)
sage: for u, v in D.edges(labels=False):
....:     D.set_edge_label(u, v, randrange(100))
sage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_Boost')
CPU times: user 2.73 s, sys: 18.6 ms, total: 2.75 s
Wall time: 2.76 s
sage: %time _ = D.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall_SciPy')
CPU times: user 1.95 s, sys: 61.6 ms, total: 2.01 s
Wall time: 2.13 s
```

---
New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[12d4018](https://github.com/sagemath/sagetrac-mirror/commit/12d4018639ea9df2cb2b0d44ea7707cc429be1d5)|`trac #7676: Floyd-Warshall with SciPy`|



---

archive/issue_comments_075127.json:
```json
{
    "body": "Changing branch from \"\" to \"public/graphs/7676_floyd_scipy\"",
    "created_at": "2021-10-16T16:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75127",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/graphs/7676_floyd_scipy"



---

archive/issue_comments_075128.json:
```json
{
    "body": "Changing author from \"\" to \"David Coudert\"",
    "created_at": "2021-10-16T16:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75128",
    "user": "https://github.com/dcoudert"
}
```

Changing author from "" to "David Coudert"



---

archive/issue_events_030574.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-10-16T16:15:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30574"
}
```



---

archive/issue_events_030575.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-10-16T16:15:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30575"
}
```



---

archive/issue_comments_075129.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-16T16:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75129",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_075130.json:
```json
{
    "body": "Changing commit from \"\" to \"12d4018639ea9df2cb2b0d44ea7707cc429be1d5\"",
    "created_at": "2021-10-16T16:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75130",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "12d4018639ea9df2cb2b0d44ea7707cc429be1d5"



---

archive/issue_comments_075131.json:
```json
{
    "body": "<a id='comment:13'></a>\nSo scipy thinks of graphs as matrices, there no special format/backend?",
    "created_at": "2021-12-04T12:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75131",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
So scipy thinks of graphs as matrices, there no special format/backend?



---

archive/issue_comments_075132.json:
```json
{
    "body": "<a id='comment:14'></a>\nWhen you look at the code of scipy (for instance, https://github.com/scipy/scipy/blob/master/scipy/sparse/csgraph/_shortest_path.pyx), the input parameter is always\n\n```\n    csgraph : array, matrix, or sparse matrix, 2 dimensions\n        The N x N array of distances representing the input graph.\n```\nYou can also check method `validate_graph` in https://github.com/scipy/scipy/blob/master/scipy/sparse/csgraph/_validation.py. It may convert from one matrix format to another.",
    "created_at": "2021-12-04T12:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75132",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>
When you look at the code of scipy (for instance, https://github.com/scipy/scipy/blob/master/scipy/sparse/csgraph/_shortest_path.pyx), the input parameter is always

```
    csgraph : array, matrix, or sparse matrix, 2 dimensions
        The N x N array of distances representing the input graph.
```
You can also check method `validate_graph` in https://github.com/scipy/scipy/blob/master/scipy/sparse/csgraph/_validation.py. It may convert from one matrix format to another.



---

archive/issue_comments_075133.json:
```json
{
    "body": "<a id='comment:15'></a>\nSo now the question is whether we finalize this ticket or move it to wontfix. Both options are OK for me.",
    "created_at": "2021-12-04T14:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75133",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
So now the question is whether we finalize this ticket or move it to wontfix. Both options are OK for me.



---

archive/issue_comments_075134.json:
```json
{
    "body": "<a id='comment:16'></a>\nlet us merge it",
    "created_at": "2021-12-04T14:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75134",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
let us merge it



---

archive/issue_comments_075135.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-04T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75135",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_075136.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-12-04T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75136",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_075137.json:
```json
{
    "body": "<a id='comment:18'></a>\nThanks.",
    "created_at": "2021-12-04T15:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75137",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>
Thanks.



---

archive/issue_events_030576.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7676#event-30576"
}
```



---

archive/issue_comments_075138.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75138",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_075139.json:
```json
{
    "body": "Changing branch from \"public/graphs/7676_floyd_scipy\" to \"12d4018639ea9df2cb2b0d44ea7707cc429be1d5\"",
    "created_at": "2021-12-12T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7676#issuecomment-75139",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/graphs/7676_floyd_scipy" to "12d4018639ea9df2cb2b0d44ea7707cc429be1d5"
