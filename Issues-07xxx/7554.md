# Issue 7554: bug in multivariate polynomial factorization

archive/issues_007554.json:
```json
{
    "body": "This is suspicious:\n\n```\nsage: # define the coefficient field K and R=K[x,y]\nsage: K.<a>=PolynomialRing(QQ,1)\nsage: K=FractionField(K)\nsage: R.<x,y>=PolynomialRing(K,2)\nsage: factor(x^2-y^2)\n(x - y) * (x + y)\nsage: factor(x)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n\n/Users/wstein/<ipython console> in <module>()\n\n/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/arith.pyc in factor(n, proof, int_, algorithm, verbose, **kwds)\n   2100         # this happens for example if n = x**2 + y**2 + 2*x*y\n   2101         try:\n-> 2102             return n.factor(proof=proof, **kwds)\n   2103         except AttributeError:\n   2104             raise TypeError, \"unable to factor n\"\n\n/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/polynomial/multi_polynomial_element.pyc in factor(self, proof)\n   1422         # try to use univariate factoring first\n   1423         try:\n-> 1424             F = self.univariate_polynomial().factor()\n   1425             return Factorization([(R(f),m) for f,m in F], unit=F.unit())\n   1426         except TypeError:\n\n/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.factor (sage/rings/polynomial/polynomial_element.c:22319)()\n\nNotImplementedError: \n```\n\nSee emails from Stefan Boettner in sage-support on Nov 28, 2009\n\n**Assignee:** @malb\n\n**Keywords:** sd59\n\n**Branch/Commit:** [17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)\n\n**Reviewer:** Martin Albrecht\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/7554\n\n",
    "closed_at": "2014-06-27T01:43:20Z",
    "created_at": "2009-11-29T08:49:16Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "title": "bug in multivariate polynomial factorization",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7554",
    "user": "https://github.com/williamstein"
}
```
This is suspicious:

```
sage: # define the coefficient field K and R=K[x,y]
sage: K.<a>=PolynomialRing(QQ,1)
sage: K=FractionField(K)
sage: R.<x,y>=PolynomialRing(K,2)
sage: factor(x^2-y^2)
(x - y) * (x + y)
sage: factor(x)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)

/Users/wstein/<ipython console> in <module>()

/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/arith.pyc in factor(n, proof, int_, algorithm, verbose, **kwds)
   2100         # this happens for example if n = x**2 + y**2 + 2*x*y
   2101         try:
-> 2102             return n.factor(proof=proof, **kwds)
   2103         except AttributeError:
   2104             raise TypeError, "unable to factor n"

/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/polynomial/multi_polynomial_element.pyc in factor(self, proof)
   1422         # try to use univariate factoring first
   1423         try:
-> 1424             F = self.univariate_polynomial().factor()
   1425             return Factorization([(R(f),m) for f,m in F], unit=F.unit())
   1426         except TypeError:

/Users/wstein/s/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.factor (sage/rings/polynomial/polynomial_element.c:22319)()

NotImplementedError: 
```

See emails from Stefan Boettner in sage-support on Nov 28, 2009

**Assignee:** @malb

**Keywords:** sd59

**Branch/Commit:** [17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)

**Reviewer:** Martin Albrecht

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/7554





---

archive/issue_comments_057600.json:
```json
{
    "body": "<a id='comment:1'></a>\nWould it make sense to except not only `TypeError`, but also `AttributeError` (for the case when `univariate_polynomial` is not a method of `self`) and `NotImplementedError` (for exactly the reason that's happening here)?",
    "created_at": "2013-06-22T12:51:27Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57600",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:1'></a>
Would it make sense to except not only `TypeError`, but also `AttributeError` (for the case when `univariate_polynomial` is not a method of `self`) and `NotImplementedError` (for exactly the reason that's happening here)?



---

archive/issue_events_051412.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51412"
}
```



---

archive/issue_events_051413.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51413"
}
```



---

archive/issue_events_051414.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51414"
}
```



---

archive/issue_events_051415.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51415"
}
```



---

archive/issue_events_051416.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51416"
}
```



---

archive/issue_events_051417.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51417"
}
```



---

archive/issue_comments_057601.json:
```json
{
    "body": "**Commit:** [17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)",
    "created_at": "2014-06-23T01:18:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57601",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)



---

archive/issue_comments_057602.json:
```json
{
    "body": "**Author:** Travis Scrimshaw",
    "created_at": "2014-06-23T01:18:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57602",
    "user": "https://github.com/tscrim"
}
```

**Author:** Travis Scrimshaw



---

archive/issue_comments_057603.json:
```json
{
    "body": "**Branch:** [public/comm_alg/factor_generic_univariate_polynomials-7554](https://github.com/sagemath/sagetrac-mirror/tree/public/comm_alg/factor_generic_univariate_polynomials-7554)",
    "created_at": "2014-06-23T01:18:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57603",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/comm_alg/factor_generic_univariate_polynomials-7554](https://github.com/sagemath/sagetrac-mirror/tree/public/comm_alg/factor_generic_univariate_polynomials-7554)



---

archive/issue_comments_057604.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've implemented a fallback using singular for generic univariate polynomials (which is what the multivariate case did). I'm not 100% sure it is the best solution (in fact the factorization can be somewhat strange IMO), but it works:\n\n```\nsage: L.<q> = LaurentPolynomialRing(QQ)\nsage: F = L.fraction_field()\nsage: R.<x> = PolynomialRing(F)\nsage: factor(x)\nx\nsage: factor(x^2 - q^2)\n(-1) * (-x + q) * (x + q)\nsage: factor(x^2 - q^-2)\n(1/q^2) * (q*x - 1) * (q*x + 1)\n\nsage: P.<a,b,c> = PolynomialRing(ZZ)\nsage: R.<x> = PolynomialRing(FractionField(P))\nsage: p = (x - a)*(b*x + c)*(a*b*x + a*c) / (a + 2)\nsage: factor(p)\n(a/(a + 2)) * (x - a) * (b*x + c)^2\n```\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07ab433665c12167d61c688be615c95a6adfcf74\">07ab433</a></td><td><code>Implemented fallback univariate factor using singular.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24\">17dd134</a></td><td><code>Added doctest to multivariate factor on original issue.</code></td></tr></table>\n",
    "created_at": "2014-06-23T01:18:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57604",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I've implemented a fallback using singular for generic univariate polynomials (which is what the multivariate case did). I'm not 100% sure it is the best solution (in fact the factorization can be somewhat strange IMO), but it works:

```
sage: L.<q> = LaurentPolynomialRing(QQ)
sage: F = L.fraction_field()
sage: R.<x> = PolynomialRing(F)
sage: factor(x)
x
sage: factor(x^2 - q^2)
(-1) * (-x + q) * (x + q)
sage: factor(x^2 - q^-2)
(1/q^2) * (q*x - 1) * (q*x + 1)

sage: P.<a,b,c> = PolynomialRing(ZZ)
sage: R.<x> = PolynomialRing(FractionField(P))
sage: p = (x - a)*(b*x + c)*(a*b*x + a*c) / (a + 2)
sage: factor(p)
(a/(a + 2)) * (x - a) * (b*x + c)^2
```

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07ab433665c12167d61c688be615c95a6adfcf74">07ab433</a></td><td><code>Implemented fallback univariate factor using singular.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24">17dd134</a></td><td><code>Added doctest to multivariate factor on original issue.</code></td></tr></table>




---

archive/issue_events_051418.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-06-23T01:18:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51418"
}
```



---

archive/issue_comments_057605.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd59\".",
    "created_at": "2014-06-23T01:18:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57605",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "" to "sd59".



---

archive/issue_comments_057606.json:
```json
{
    "body": "<a id='comment:6'></a>\nLooks okay.",
    "created_at": "2014-06-26T17:36:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57606",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>
Looks okay.



---

archive/issue_comments_057607.json:
```json
{
    "body": "**Reviewer:** Martin Albrecht",
    "created_at": "2014-06-26T17:36:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57607",
    "user": "https://github.com/malb"
}
```

**Reviewer:** Martin Albrecht



---

archive/issue_events_051419.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2014-06-26T17:36:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51419"
}
```



---

archive/issue_events_051420.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2014-06-26T17:36:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51420"
}
```



---

archive/issue_events_051421.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-27T01:43:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51421"
}
```



---

archive/issue_events_051422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "45ae0342203332d8072af882302accff6bc3653f",
    "created_at": "2014-06-27T01:43:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7554#event-51422"
}
```



---

archive/issue_comments_057608.json:
```json
{
    "body": "**Changing branch** from \"[public/comm_alg/factor_generic_univariate_polynomials-7554](https://github.com/sagemath/sagetrac-mirror/tree/public/comm_alg/factor_generic_univariate_polynomials-7554)\" to \"[17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)\".",
    "created_at": "2014-06-27T01:43:20Z",
    "issue": "https://github.com/sagemath/sage/issues/7554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7554#issuecomment-57608",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/comm_alg/factor_generic_univariate_polynomials-7554](https://github.com/sagemath/sagetrac-mirror/tree/public/comm_alg/factor_generic_univariate_polynomials-7554)" to "[17dd13462c4191748f76a2ce91bb671556f0ff24](https://github.com/sagemath/sagetrac-mirror/commit/17dd13462c4191748f76a2ce91bb671556f0ff24)".
