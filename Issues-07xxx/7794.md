# Issue 7794: PolynomialRing_integral_domain ignores Ctrl-C and segfaults

archive/issues_007794.json:
```json
{
    "body": "The following was reported by Alex P on [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/d92efb12f35e758a):\n\n```\nsage: F.<a> = FiniteField(3)\nsage: P.<T> = PolynomialRing(F)\nsage: PP.<z> = PolynomialRing(P)\nsage: PP\nUnivariate Polynomial Ring in z over Univariate Polynomial Ring in T over Finite Field of size 3\nsage: type(PP)\n<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_integral_domain'>\nsage: (z^3 + T*z)^(81*3)\n^CException KeyboardInterrupt: KeyboardInterrupt() in 'sage.rings.polynomial.polynomial_zmod_flint.get_cparent' ignored\n^C^C\n\n------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occured in SAGE.\nThis probably occured because a *compiled* component\nof SAGE has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run SAGE under gdb with 'sage -gdb' to debug this.\nSAGE will now terminate (sorry).\n------------------------------------------------------------\n```\n\nSo: First, Ctrl-C is ignored, which is bad IMO. Then, hitting Ctrl-C again (actually twice) results in a segfault, which is a desaster.\n\n\n\n**Assignee:** @aghitza\n\n**Keywords:** Polynomial Ring KeyboardInterrupt\n\n**Author:** Jeroen Demeyer\n\n**Reviewer:** Simon King\n\n**Merged:** sage-4.7.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/7794\n\n",
    "closed_at": "2011-05-30T14:52:02Z",
    "created_at": "2009-12-30T10:52:47Z",
    "labels": [
        "component: algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "title": "PolynomialRing_integral_domain ignores Ctrl-C and segfaults",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7794",
    "user": "https://github.com/simon-king-jena"
}
```
The following was reported by Alex P on [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/d92efb12f35e758a):

```
sage: F.<a> = FiniteField(3)
sage: P.<T> = PolynomialRing(F)
sage: PP.<z> = PolynomialRing(P)
sage: PP
Univariate Polynomial Ring in z over Univariate Polynomial Ring in T over Finite Field of size 3
sage: type(PP)
<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_integral_domain'>
sage: (z^3 + T*z)^(81*3)
^CException KeyboardInterrupt: KeyboardInterrupt() in 'sage.rings.polynomial.polynomial_zmod_flint.get_cparent' ignored
^C^C

------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occured in SAGE.
This probably occured because a *compiled* component
of SAGE has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run SAGE under gdb with 'sage -gdb' to debug this.
SAGE will now terminate (sorry).
------------------------------------------------------------
```

So: First, Ctrl-C is ignored, which is bad IMO. Then, hitting Ctrl-C again (actually twice) results in a segfault, which is a desaster.



**Assignee:** @aghitza

**Keywords:** Polynomial Ring KeyboardInterrupt

**Author:** Jeroen Demeyer

**Reviewer:** Simon King

**Merged:** sage-4.7.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/7794





---

archive/issue_events_053782.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-19T18:08:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53782"
}
```



---

archive/issue_comments_060467.json:
```json
{
    "body": "<a id='comment:1'></a>\nI just verified that the problem seems to be fixed in sage-4.6.2.\n\nFirstly, the original example now works sufficiently quickly, so that there is no need to interrupt the computation:\n\n```\nsage: F.<a> = FiniteField(3)\nsage: P.<T> = PolynomialRing(F)\nsage: PP.<z> = PolynomialRing(P)\nsage: PP\nUnivariate Polynomial Ring in z over Univariate Polynomial Ring in T over Finite Field of size 3\nsage: type(PP)\n<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_integral_domain'>\nsage: (z^3 + T*z)^(81*3)\nz^729 + T^243*z^243\n```\n\nSecondly, if one tries the same thing with a higher exponent, hitting Ctrl-c works (or at least it does after several attempts):\n\n```\nsage: (z^3 + T*z)^(81^3)\n^C^C^C---------------------------------------------------------------------------\nKeyboardInterrupt                         Traceback (most recent call last)\n\n/home/king/<ipython console> in <module>()\n\n/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.__pow__ (sage/rings/polynomial/polynomial_element.c:12738)()\n\n/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.generic_power (sage/structure/element.c:20326)()\n...\n<LONG TRACEBACK>\n...\n/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/interfaces/get_sigs.pyc in my_sigint(x, n)\n      7\n      8 def my_sigint(x, n):\n----> 9     raise KeyboardInterrupt\n     10\n     11 def my_sigfpe(x, n):\n\nKeyboardInterrupt:\n```\n\nSo, I believe this ticket can be closed! If I am not mistaken, I first need to put it as \"needs review\"...",
    "created_at": "2011-05-19T18:08:26Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60467",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>
I just verified that the problem seems to be fixed in sage-4.6.2.

Firstly, the original example now works sufficiently quickly, so that there is no need to interrupt the computation:

```
sage: F.<a> = FiniteField(3)
sage: P.<T> = PolynomialRing(F)
sage: PP.<z> = PolynomialRing(P)
sage: PP
Univariate Polynomial Ring in z over Univariate Polynomial Ring in T over Finite Field of size 3
sage: type(PP)
<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_integral_domain'>
sage: (z^3 + T*z)^(81*3)
z^729 + T^243*z^243
```

Secondly, if one tries the same thing with a higher exponent, hitting Ctrl-c works (or at least it does after several attempts):

```
sage: (z^3 + T*z)^(81^3)
^C^C^C---------------------------------------------------------------------------
KeyboardInterrupt                         Traceback (most recent call last)

/home/king/<ipython console> in <module>()

/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.__pow__ (sage/rings/polynomial/polynomial_element.c:12738)()

/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.generic_power (sage/structure/element.c:20326)()
...
<LONG TRACEBACK>
...
/mnt/local/king/SAGE/broken/local/lib/python2.6/site-packages/sage/interfaces/get_sigs.pyc in my_sigint(x, n)
      7
      8 def my_sigint(x, n):
----> 9     raise KeyboardInterrupt
     10
     11 def my_sigfpe(x, n):

KeyboardInterrupt:
```

So, I believe this ticket can be closed! If I am not mistaken, I first need to put it as "needs review"...



---

archive/issue_events_053783.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-19T18:10:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53783"
}
```



---

archive/issue_events_053784.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-19T18:10:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53784"
}
```



---

archive/issue_comments_060468.json:
```json
{
    "body": "**Reviewer:** Simon King",
    "created_at": "2011-05-19T18:10:34Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60468",
    "user": "https://github.com/simon-king-jena"
}
```

**Reviewer:** Simon King



---

archive/issue_comments_060469.json:
```json
{
    "body": "<a id='comment:2'></a>\nI miss the possibility to change the ticket into the state \"worksforme\", but that's my review, in one word...",
    "created_at": "2011-05-19T18:10:34Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60469",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
I miss the possibility to change the ticket into the state "worksforme", but that's my review, in one word...



---

archive/issue_events_053785.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-19T18:10:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53785"
}
```



---

archive/issue_events_053786.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-19T18:10:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53786"
}
```



---

archive/issue_events_053787.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-19T20:00:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53787"
}
```



---

archive/issue_comments_060470.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm still able to reproduce the problem on sage-4.7.rc2 (note that interrupt handling was completely rewritten in #9678, merged in sage-4.7.alpha1, so testing this with sage-4.6.2 is pointless).\n\n```\nsage: F.<a> = FiniteField(3)\nsage: P.<T> = PolynomialRing(F)\nsage: PP.<z> = PolynomialRing(P)\nsage: (z^3 + T*z)^(81*3)\n^C^CException KeyboardInterrupt in 'sage.rings.polynomial.polynomial_zmod_flint.get_cparent' ignored\nz^729 + T^243*z^243\nsage: (z^3 + T*z)^(81*3)\n^C/usr/local/src/sage-4.7/local/lib/libcsage.so(print_backtrace+0x31)[0x7f3398533e02]\n/usr/local/src/sage-4.7/local/lib/libcsage.so(sigdie+0x14)[0x7f3398533e34]\n/usr/local/src/sage-4.7/local/lib/libcsage.so(sage_signal_handler+0x1e6)[0x7f3398533a5c]\n/lib/libpthread.so.0(+0xf400)[0x7f339d78c400]\n/usr/local/src/sage-4.7/local/lib/libgmp.so.3(__gmp_exception+0x1e)[0x7f33982c357e]\n/usr/local/src/sage-4.7/local/lib/libgmp.so.3(+0xb5ae)[0x7f33982c35ae]\n/usr/local/src/sage-4.7/local/lib/libgmp.so.3(__gmpz_fdiv_ui+0x0)[0x7f33982cfed0]\n/usr/local/src/sage-4.7/local/lib/libflint.so(zn_mod_init+0x5c)[0x7f33902e109c]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so(+0x19ce6)[0x7f336d5ddce6]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x9b85c)[0x7f339da3485c]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f339da76617]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x61747)[0x7f339d9fa747]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so(+0xad24)[0x7f336d5ced24]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0xa1098)[0x7f339da3a098]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x3a79)[0x7f339da7a689]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x879)[0x7f339da7d819]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x70b26)[0x7f339da09b26]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x5793f)[0x7f339d9f093f]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x12ec1)[0x7f3388decec1]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x12beb)[0x7f3388decbeb]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/categories/map.so(+0x6be5)[0x7f3394501be5]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/coerce.so(+0x1fb4d)[0x7f339473eb4d]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/coerce.so(+0x179e0)[0x7f33947369e0]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so(+0x108d9)[0x7f339496b8d9]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so(+0x3a681)[0x7f3394995681]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x4621c)[0x7f339d9df21c]\n/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyNumber_Add+0x20)[0x7f339d9e1640]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x41f03)[0x7f3388e1bf03]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ff62)[0x7f3388e49f62]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ed99)[0x7f3388e48d99]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ef0c)[0x7f3388e48f0c]\n/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6edcf)[0x7f3388e48dcf]\n\n------------------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off(). You might\nwant to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate.\n------------------------------------------------------------------------\n```",
    "created_at": "2011-05-19T20:00:10Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60470",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
I'm still able to reproduce the problem on sage-4.7.rc2 (note that interrupt handling was completely rewritten in #9678, merged in sage-4.7.alpha1, so testing this with sage-4.6.2 is pointless).

```
sage: F.<a> = FiniteField(3)
sage: P.<T> = PolynomialRing(F)
sage: PP.<z> = PolynomialRing(P)
sage: (z^3 + T*z)^(81*3)
^C^CException KeyboardInterrupt in 'sage.rings.polynomial.polynomial_zmod_flint.get_cparent' ignored
z^729 + T^243*z^243
sage: (z^3 + T*z)^(81*3)
^C/usr/local/src/sage-4.7/local/lib/libcsage.so(print_backtrace+0x31)[0x7f3398533e02]
/usr/local/src/sage-4.7/local/lib/libcsage.so(sigdie+0x14)[0x7f3398533e34]
/usr/local/src/sage-4.7/local/lib/libcsage.so(sage_signal_handler+0x1e6)[0x7f3398533a5c]
/lib/libpthread.so.0(+0xf400)[0x7f339d78c400]
/usr/local/src/sage-4.7/local/lib/libgmp.so.3(__gmp_exception+0x1e)[0x7f33982c357e]
/usr/local/src/sage-4.7/local/lib/libgmp.so.3(+0xb5ae)[0x7f33982c35ae]
/usr/local/src/sage-4.7/local/lib/libgmp.so.3(__gmpz_fdiv_ui+0x0)[0x7f33982cfed0]
/usr/local/src/sage-4.7/local/lib/libflint.so(zn_mod_init+0x5c)[0x7f33902e109c]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so(+0x19ce6)[0x7f336d5ddce6]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x9b85c)[0x7f339da3485c]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f339da76617]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x61747)[0x7f339d9fa747]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so(+0xad24)[0x7f336d5ced24]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0xa1098)[0x7f339da3a098]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x3a79)[0x7f339da7a689]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x879)[0x7f339da7d819]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x70b26)[0x7f339da09b26]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x5793f)[0x7f339d9f093f]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyObject_Call+0x53)[0x7f339d9e3cf3]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x12ec1)[0x7f3388decec1]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x12beb)[0x7f3388decbeb]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/categories/map.so(+0x6be5)[0x7f3394501be5]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/coerce.so(+0x1fb4d)[0x7f339473eb4d]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/coerce.so(+0x179e0)[0x7f33947369e0]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so(+0x108d9)[0x7f339496b8d9]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/structure/element.so(+0x3a681)[0x7f3394995681]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(+0x4621c)[0x7f339d9df21c]
/usr/local/src/sage-4.7/local/lib/libpython2.6.so.1.0(PyNumber_Add+0x20)[0x7f339d9e1640]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x41f03)[0x7f3388e1bf03]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ff62)[0x7f3388e49f62]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ed99)[0x7f3388e48d99]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6ef0c)[0x7f3388e48f0c]
/usr/local/src/sage-4.7/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_element.so(+0x6edcf)[0x7f3388e48dcf]

------------------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off(). You might
want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate.
------------------------------------------------------------------------
```



---

archive/issue_events_053788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-19T20:00:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53788"
}
```



---

archive/issue_events_053789.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-19T20:00:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53789"
}
```



---

archive/issue_comments_060471.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [@jdemeyer](#comment%3A3):\n> I'm still able to reproduce the problem on sage-4.7.rc2 (note that interrupt handling was completely rewritten in #9678, merged in sage-4.7.alpha1, so testing this with sage-4.6.2 is pointless).\n\nWhat a pity!",
    "created_at": "2011-05-20T05:36:04Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60471",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
Replying to [@jdemeyer](#comment%3A3):
> I'm still able to reproduce the problem on sage-4.7.rc2 (note that interrupt handling was completely rewritten in #9678, merged in sage-4.7.alpha1, so testing this with sage-4.6.2 is pointless).

What a pity!



---

archive/issue_comments_060472.json:
```json
{
    "body": "<a id='comment:5'></a>\nSince the problem seems to be related with get_cparent, I was first looking into that. There was a bare \"except:\", where it should be catching an attribute error. But that was not the problem.\n\nNext, I looked into polynomial_template.pxi, where get_cparent is frequently used. Too frequently, actually. In many methods it is called several times. So, it would be better to assign its output to a cdef'd variable -- that would actually boost the speed a lot!\n\nNamely, working on other tickets, I know that the \"harmless\" method `modulus()` takes the most time when doing arithmetic with polynomials over finite fields. `modulus()` is called in get_cparent (actually, it is called twice!), and get_cparent is called several times in both `_pow_` and `_mul_` (as in polynomial_template.pxi).\n\nSo, one approach would be to remove the redundant calls - which makes sense anyway. If that does not help with the segfault, one could still try to wrap it into sig_on()/sig_off().",
    "created_at": "2011-05-20T06:25:39Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60472",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Since the problem seems to be related with get_cparent, I was first looking into that. There was a bare "except:", where it should be catching an attribute error. But that was not the problem.

Next, I looked into polynomial_template.pxi, where get_cparent is frequently used. Too frequently, actually. In many methods it is called several times. So, it would be better to assign its output to a cdef'd variable -- that would actually boost the speed a lot!

Namely, working on other tickets, I know that the "harmless" method `modulus()` takes the most time when doing arithmetic with polynomials over finite fields. `modulus()` is called in get_cparent (actually, it is called twice!), and get_cparent is called several times in both `_pow_` and `_mul_` (as in polynomial_template.pxi).

So, one approach would be to remove the redundant calls - which makes sense anyway. If that does not help with the segfault, one could still try to wrap it into sig_on()/sig_off().



---

archive/issue_comments_060473.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt is really surprising how many redundant calls can be found in polynomial_template.pxi. I guess that's why get_cparent is defined as an inline cpdef function -- but that won't help if it internally calls pure Python functions!",
    "created_at": "2011-05-20T06:39:22Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60473",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
It is really surprising how many redundant calls can be found in polynomial_template.pxi. I guess that's why get_cparent is defined as an inline cpdef function -- but that won't help if it internally calls pure Python functions!



---

archive/issue_comments_060474.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe attached patch seems to fix the problem, but I haven't checked carefully whether it might break other stuff.  I'm putting it to needs_review, but I haven't really thought about it much.",
    "created_at": "2011-05-20T08:41:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60474",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
The attached patch seems to fix the problem, but I haven't checked carefully whether it might break other stuff.  I'm putting it to needs_review, but I haven't really thought about it much.



---

archive/issue_events_053790.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-20T08:41:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53790"
}
```



---

archive/issue_events_053791.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-20T08:41:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53791"
}
```



---

archive/issue_comments_060475.json:
```json
{
    "body": "<a id='comment:8'></a>\nHi Jeroen,\n\nCan you give me a pointer to the documentation of the `except? 0` syntax? Sounds useful.\n\nI'll try your patch. I have prepared another patch, with the purpose of reducing the number of calls to get_cparent() (and thus to modulus()). But this will concern performance and should thus be on another ticket.",
    "created_at": "2011-05-20T12:13:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60475",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Hi Jeroen,

Can you give me a pointer to the documentation of the `except? 0` syntax? Sounds useful.

I'll try your patch. I have prepared another patch, with the purpose of reducing the number of calls to get_cparent() (and thus to modulus()). But this will concern performance and should thus be on another ticket.



---

archive/issue_comments_060476.json:
```json
{
    "body": "<a id='comment:9'></a>\nI think a found a [reference](http://docs.cython.org/src/userguide/language_basics.html#error-return-values) to handling Cython errors.",
    "created_at": "2011-05-20T12:18:01Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60476",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>
I think a found a [reference](http://docs.cython.org/src/userguide/language_basics.html#error-return-values) to handling Cython errors.



---

archive/issue_comments_060477.json:
```json
{
    "body": "<a id='comment:10'></a>\nAfter reading the documentation, it seems to me that your approach makes very much sense. The original problem seems to be solved.\n\nSo, if the long doctests pass then I'll give it a positive review.",
    "created_at": "2011-05-20T12:22:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60477",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>
After reading the documentation, it seems to me that your approach makes very much sense. The original problem seems to be solved.

So, if the long doctests pass then I'll give it a positive review.



---

archive/issue_comments_060478.json:
```json
{
    "body": "<a id='comment:11'></a>\nMeanwhile I wonder:\n\nIn the original version of get_cparent, an attribute error was caught internally, and then zero was returned. Now, you return zero on error, and you do not catch the error internally. Couldn't that result in confusion, if the argument `parent` has no `modulus()` method?\n\nPerhaps it is safer to keep modify the internal try-except clause (namely replace the bare `except:` by `except AttributeError:`) and declare the Cython funtion as `cdef inline cparent get_cparent(parent) except -1:`.\n\nNamely, -1 can not result as a regular return value (the return value is the modulus of a ring, and thus a positive number), and so it would be safe to reserve -1 for errors (then you can also remove the question mark from `except?`).\n\nWill you do this change (if you agree with my arguing), or shall I make the change in a separate patch?",
    "created_at": "2011-05-20T12:33:12Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60478",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>
Meanwhile I wonder:

In the original version of get_cparent, an attribute error was caught internally, and then zero was returned. Now, you return zero on error, and you do not catch the error internally. Couldn't that result in confusion, if the argument `parent` has no `modulus()` method?

Perhaps it is safer to keep modify the internal try-except clause (namely replace the bare `except:` by `except AttributeError:`) and declare the Cython funtion as `cdef inline cparent get_cparent(parent) except -1:`.

Namely, -1 can not result as a regular return value (the return value is the modulus of a ring, and thus a positive number), and so it would be safe to reserve -1 for errors (then you can also remove the question mark from `except?`).

Will you do this change (if you agree with my arguing), or shall I make the change in a separate patch?



---

archive/issue_comments_060479.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@simon-king-jena](#comment%3A11):\n> Perhaps it is safer to keep modify the internal try-except clause (namely replace the bare `except:` by `except AttributeError:`) and declare the Cython funtion as `cdef inline cparent get_cparent(parent) except -1:`.\n\nOn the other hand:\n\n* In polynomial_zmod_flint, get_cparent is supposed to return unsigned int. So, -1 does not make sense.\n\n* The modulus is positive. So, actually 0 should be a clear sign that something went wrong. I wonder if the function is ever called with `parent=None` (because this is the only situation in which zero is returned).\n\nI will test whether `parent is None` ever occurs. If not, then we could keep 0 as return value on error, but could remove the question mark (which should result in a faster code).",
    "created_at": "2011-05-20T12:49:47Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60479",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>
Replying to [@simon-king-jena](#comment%3A11):
> Perhaps it is safer to keep modify the internal try-except clause (namely replace the bare `except:` by `except AttributeError:`) and declare the Cython funtion as `cdef inline cparent get_cparent(parent) except -1:`.

On the other hand:

* In polynomial_zmod_flint, get_cparent is supposed to return unsigned int. So, -1 does not make sense.

* The modulus is positive. So, actually 0 should be a clear sign that something went wrong. I wonder if the function is ever called with `parent=None` (because this is the only situation in which zero is returned).

I will test whether `parent is None` ever occurs. If not, then we could keep 0 as return value on error, but could remove the question mark (which should result in a faster code).



---

archive/issue_comments_060480.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@simon-king-jena](#comment%3A12):\n> I will test whether `parent is None` ever occurs. If not, then we could keep 0 as return value on error, but could remove the question mark (which should result in a faster code).\n\nYes, it *is* called with `parent=None`, namely when unpickling.",
    "created_at": "2011-05-20T12:52:30Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60480",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>
Replying to [@simon-king-jena](#comment%3A12):
> I will test whether `parent is None` ever occurs. If not, then we could keep 0 as return value on error, but could remove the question mark (which should result in a faster code).

Yes, it *is* called with `parent=None`, namely when unpickling.



---

archive/issue_comments_060481.json:
```json
{
    "body": "<a id='comment:14'></a>\nI considered the following version of get_cparent in polynomial_zmod_flint.pyx:\n\n```\ncdef inline cparent get_cparent(parent) except 1:\n    if parent is None:\n        return 0\n    try:\n        return <unsigned long>(parent.modulus())\n    except AttributeError:\n        return 0\n```\n\nRationale:\n\nThe original code was catching an error that should probably be an attribute error - so, we do the same, and return the same value that was returned by the original version.\n\nBut the return value 1 can never occur (which I verified by the doctests of sage/rings/). So, it is safe to reserve 1 as the exceptional value, without question mark after `except`.\n\nHowever, our two patch versions performed equally when I tried some timings. Hence, unless you say that I convinced you to use 1 as exceptional return value (without question mark), I will give your patch a positive review, provided the doc tests pass.",
    "created_at": "2011-05-20T13:11:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60481",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
I considered the following version of get_cparent in polynomial_zmod_flint.pyx:

```
cdef inline cparent get_cparent(parent) except 1:
    if parent is None:
        return 0
    try:
        return <unsigned long>(parent.modulus())
    except AttributeError:
        return 0
```

Rationale:

The original code was catching an error that should probably be an attribute error - so, we do the same, and return the same value that was returned by the original version.

But the return value 1 can never occur (which I verified by the doctests of sage/rings/). So, it is safe to reserve 1 as the exceptional value, without question mark after `except`.

However, our two patch versions performed equally when I tried some timings. Hence, unless you say that I convinced you to use 1 as exceptional return value (without question mark), I will give your patch a positive review, provided the doc tests pass.



---

archive/issue_events_053792.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-20T13:49:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53792"
}
```



---

archive/issue_events_053793.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-20T13:49:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53793"
}
```



---

archive/issue_comments_060482.json:
```json
{
    "body": "<a id='comment:15'></a>\nTests pass. So, let it be a positive review to your patch!",
    "created_at": "2011-05-20T13:49:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60482",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'></a>
Tests pass. So, let it be a positive review to your patch!



---

archive/issue_comments_060483.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2011-05-20T13:49:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60483",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_060484.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@simon-king-jena](#comment%3A14):\n> But the return value 1 can never occur (which I verified by the doctests of sage/rings/). So, it is safe to reserve 1 as the exceptional value, without question mark after `except`.\n\nAre you **very sure** that 1 cannot occur?  You might be right, but I would not count on it.",
    "created_at": "2011-05-20T18:00:37Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60484",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [@simon-king-jena](#comment%3A14):
> But the return value 1 can never occur (which I verified by the doctests of sage/rings/). So, it is safe to reserve 1 as the exceptional value, without question mark after `except`.

Are you **very sure** that 1 cannot occur?  You might be right, but I would not count on it.



---

archive/issue_comments_060485.json:
```json
{
    "body": "<a id='comment:17'></a>\nyou are probably right about `except AttributeError`. How about\n\n```\ncdef inline cparent get_cparent(parent) except? 0:\n    try:\n        return <unsigned long>(parent.modulus())\n    except AttributeError:\n        return 0\n```\nThis will also catch the case `parent == None`.",
    "created_at": "2011-05-20T18:05:12Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60485",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
you are probably right about `except AttributeError`. How about

```
cdef inline cparent get_cparent(parent) except? 0:
    try:
        return <unsigned long>(parent.modulus())
    except AttributeError:
        return 0
```
This will also catch the case `parent == None`.



---

archive/issue_events_053794.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-21T06:17:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53794"
}
```



---

archive/issue_events_053795.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-05-21T06:17:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53795"
}
```



---

archive/issue_comments_060486.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@jdemeyer](#comment%3A17):\n> you are probably right about `except AttributeError`. How about\n> \n> ```\n> cdef inline cparent get_cparent(parent) except? 0:\n>     try:\n>         return <unsigned long>(parent.modulus())\n>     except AttributeError:\n>         return 0\n> ```\n> This will also catch the case `parent == None`.\n\nYes, that looks a bit better. \n\nConcerning modulus 1:\n\nIt is possible to explicitly construct an instance of `sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint` whose parent has modulus 1:\n\n```\nsage: from sage.rings.polynomial.polynomial_ring import PolynomialRing_dense_mod_n\nsage: P = PolynomialRing_dense_mod_n(Zmod(1),'x')\nsage: type(P.0)\n<type 'sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint'>\n```\n\nSo, in order to be on the safe side, one should not have `get_cparent(parent) except 1:`.\n\nOne may argue, however, that it can not occur if one constructs a ring as one is supposed to, namely by calling the polynomial ring constructor:\n\n```\nsage: P.<x> = Zmod(1)[]\nsage: type(x)\n<type 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense'>\n```\n\nBut better safe than sorry, in particular since your safe solution (`... except? 0:`) should have no serious time penalty.\n\nNamely, as much as I understand, `cdef get_cparent(parent) except? 0:` will slow things down only if the return value is 0, because then it will be tested whether an error has actually occured.\n\nBut, to the best of my knowledge, it is *impossible* to have a parent with modulus zero, even if one works around the polynomial ring constructor:\n\n```\nsage: P = PolynomialRing_dense_mod_n(ZZ,'x')\nTraceback (most recent call last):\n...\nValueError: invalid integer: +Infinity\n```\n\nSo, if one has return value zero then something exceptional must be happening: Either it is a real error, or it is during pickling, when `parent` is None. So, we can certainly afford to test for an error in that situation.\n\nCan you update your patch, so that the attribute error is caught? Then I'll run the tests again, and will hoppefully be able to renew my positive review.",
    "created_at": "2011-05-21T06:17:15Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60486",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'></a>
Replying to [@jdemeyer](#comment%3A17):
> you are probably right about `except AttributeError`. How about
> 
> ```
> cdef inline cparent get_cparent(parent) except? 0:
>     try:
>         return <unsigned long>(parent.modulus())
>     except AttributeError:
>         return 0
> ```
> This will also catch the case `parent == None`.

Yes, that looks a bit better. 

Concerning modulus 1:

It is possible to explicitly construct an instance of `sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint` whose parent has modulus 1:

```
sage: from sage.rings.polynomial.polynomial_ring import PolynomialRing_dense_mod_n
sage: P = PolynomialRing_dense_mod_n(Zmod(1),'x')
sage: type(P.0)
<type 'sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint'>
```

So, in order to be on the safe side, one should not have `get_cparent(parent) except 1:`.

One may argue, however, that it can not occur if one constructs a ring as one is supposed to, namely by calling the polynomial ring constructor:

```
sage: P.<x> = Zmod(1)[]
sage: type(x)
<type 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense'>
```

But better safe than sorry, in particular since your safe solution (`... except? 0:`) should have no serious time penalty.

Namely, as much as I understand, `cdef get_cparent(parent) except? 0:` will slow things down only if the return value is 0, because then it will be tested whether an error has actually occured.

But, to the best of my knowledge, it is *impossible* to have a parent with modulus zero, even if one works around the polynomial ring constructor:

```
sage: P = PolynomialRing_dense_mod_n(ZZ,'x')
Traceback (most recent call last):
...
ValueError: invalid integer: +Infinity
```

So, if one has return value zero then something exceptional must be happening: Either it is a real error, or it is during pickling, when `parent` is None. So, we can certainly afford to test for an error in that situation.

Can you update your patch, so that the attribute error is caught? Then I'll run the tests again, and will hoppefully be able to renew my positive review.



---

archive/issue_comments_060487.json:
```json
{
    "body": "**Work Issues:** catch attribute error",
    "created_at": "2011-05-21T06:17:15Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60487",
    "user": "https://github.com/simon-king-jena"
}
```

**Work Issues:** catch attribute error



---

archive/attachments_009867.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "7794_get_cparent.patch",
    "asset_url": "tarball://root/attachments/ticket7794/7794_get_cparent.patch",
    "created_at": "2011-05-21T06:23:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7794/7794_get_cparent.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_060488.json:
```json
{
    "body": "**Attachment:** [7794_get_cparent.patch](https://github.com/sagemath/sage/files/ticket7794/7794_get_cparent.patch)",
    "created_at": "2011-05-21T06:23:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60488",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [7794_get_cparent.patch](https://github.com/sagemath/sage/files/ticket7794/7794_get_cparent.patch)



---

archive/issue_events_053796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-21T06:24:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53796"
}
```



---

archive/issue_events_053797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-21T06:24:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53797"
}
```



---

archive/issue_comments_060489.json:
```json
{
    "body": "**Changing work issues** from \"catch attribute error\" to \"\".",
    "created_at": "2011-05-21T06:24:57Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60489",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work issues** from "catch attribute error" to "".



---

archive/issue_comments_060490.json:
```json
{
    "body": "<a id='comment:21'></a>\nAll long tests passed with your new patch.\n\nI tried to add a doc test, as follows:\n\n```\n    sage: def test():\n    ...    P = GF(3)['T']\n    ...    PP = P['z']\n    ...    T = P.gen()\n    ...    z = PP.gen()\n    ...    alarm(1)\n    ...    try:\n    ...       while(1):\n    ...           x = (z**3+T*z)**243\n    ...    except KeyboardInterrupt:\n    ...       print \"First interrupt caught\"\n    ...    alarm(1)\n    ...    try:\n    ...        while(1):\n    ...            x = (z**3+T*z)**243\n    ...    except KeyboardInterrupt:\n    ...        print \"Second interrupt caught\"\n    sage: test()\n    First interrupt caught\n    Second interrupt caught\n```\n\nHowever, it did not work, since there seem to be other places in which errors are not properly caught. Namely, I occasionally got:\n\n```\nsage: test()\nFirst interrupt caught\nException KeyboardInterrupt: KeyboardInterrupt('computation timed out because alarm was set for 1 seconds',) in T^79 + 2*T^78 + 2*T^77 + T^74 ignored\n^CSecond interrupt caught\n```\nSo, the first alarm worked, but the second didn't, and only when I pressed <ctrl>-c then the computation was interrupted.\n\nWhat shall we do now? Clearly, your patch is a progress. So, I tend to give it a positive review (because all tests pass), and deal with the remaining problem on a different ticket.\n\nWhat do you think?",
    "created_at": "2011-05-21T09:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60490",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>
All long tests passed with your new patch.

I tried to add a doc test, as follows:

```
    sage: def test():
    ...    P = GF(3)['T']
    ...    PP = P['z']
    ...    T = P.gen()
    ...    z = PP.gen()
    ...    alarm(1)
    ...    try:
    ...       while(1):
    ...           x = (z**3+T*z)**243
    ...    except KeyboardInterrupt:
    ...       print "First interrupt caught"
    ...    alarm(1)
    ...    try:
    ...        while(1):
    ...            x = (z**3+T*z)**243
    ...    except KeyboardInterrupt:
    ...        print "Second interrupt caught"
    sage: test()
    First interrupt caught
    Second interrupt caught
```

However, it did not work, since there seem to be other places in which errors are not properly caught. Namely, I occasionally got:

```
sage: test()
First interrupt caught
Exception KeyboardInterrupt: KeyboardInterrupt('computation timed out because alarm was set for 1 seconds',) in T^79 + 2*T^78 + 2*T^77 + T^74 ignored
^CSecond interrupt caught
```
So, the first alarm worked, but the second didn't, and only when I pressed <ctrl>-c then the computation was interrupted.

What shall we do now? Clearly, your patch is a progress. So, I tend to give it a positive review (because all tests pass), and deal with the remaining problem on a different ticket.

What do you think?



---

archive/issue_comments_060491.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@simon-king-jena](#comment%3A21):\n> What do you think?\n\nI'll see if I can identify the problem.",
    "created_at": "2011-05-23T10:38:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60491",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [@simon-king-jena](#comment%3A21):
> What do you think?

I'll see if I can identify the problem.



---

archive/issue_events_053798.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-23T15:09:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53798"
}
```



---

archive/issue_events_053799.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-23T15:09:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53799"
}
```



---

archive/issue_comments_060492.json:
```json
{
    "body": "<a id='comment:23'></a>\nI cannot easily identify the problem, so let's put it to positive_review (even though I agree the isuue is not 100% solved).",
    "created_at": "2011-05-23T15:09:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
I cannot easily identify the problem, so let's put it to positive_review (even though I agree the isuue is not 100% solved).



---

archive/issue_comments_060493.json:
```json
{
    "body": "<a id='comment:24'></a>\nI have tracked the `Exception KeyboardInterrupt... ignored` problem\ndown to the following Cython-generated code in `sage/rings/polynomial/polynomial_zmod_flint.c`:\n\n```\nstatic void __pyx_tp_dealloc_4sage_5rings_10polynomial_21polynomial_zmod_flint_Polynomial_template(PyObject *o) {\n  {\n    PyObject *etype, *eval, *etb;\n    PyErr_Fetch(&etype, &eval, &etb);\n    ++Py_REFCNT(o);\n    __pyx_pf_4sage_5rings_10polynomial_21polynomial_zmod_flint_19Polynomial_template_3__dealloc__(o);\n    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);\n    --Py_REFCNT(o);\n    PyErr_Restore(etype, eval, etb);\n  }\n  __pyx_ptype_4sage_5rings_10polynomial_18polynomial_element_Polynomial->tp_dealloc(o);\n}\n```\n\nThe problem is the line\n\n```\nif (PyErr_Occurred()) PyErr_WriteUnraisable(o);\n```\nSince this code is generated by Cython, perhaps it is not possible to solve this problem without patching Cython.",
    "created_at": "2011-05-24T07:52:00Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60493",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
I have tracked the `Exception KeyboardInterrupt... ignored` problem
down to the following Cython-generated code in `sage/rings/polynomial/polynomial_zmod_flint.c`:

```
static void __pyx_tp_dealloc_4sage_5rings_10polynomial_21polynomial_zmod_flint_Polynomial_template(PyObject *o) {
  {
    PyObject *etype, *eval, *etb;
    PyErr_Fetch(&etype, &eval, &etb);
    ++Py_REFCNT(o);
    __pyx_pf_4sage_5rings_10polynomial_21polynomial_zmod_flint_19Polynomial_template_3__dealloc__(o);
    if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
    --Py_REFCNT(o);
    PyErr_Restore(etype, eval, etb);
  }
  __pyx_ptype_4sage_5rings_10polynomial_18polynomial_element_Polynomial->tp_dealloc(o);
}
```

The problem is the line

```
if (PyErr_Occurred()) PyErr_WriteUnraisable(o);
```
Since this code is generated by Cython, perhaps it is not possible to solve this problem without patching Cython.



---

archive/issue_comments_060494.json:
```json
{
    "body": "<a id='comment:25'></a>\nI believe the \"Exception ignored\" to be harmless, in the sense that it's not going to break anything or cause segmentation faults.  If the exception is ignored, the computation simply continues and the user can press ctrl-C a second time and that should do it.",
    "created_at": "2011-05-24T09:06:58Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60494",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
I believe the "Exception ignored" to be harmless, in the sense that it's not going to break anything or cause segmentation faults.  If the exception is ignored, the computation simply continues and the user can press ctrl-C a second time and that should do it.



---

archive/issue_comments_060495.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@jdemeyer](#comment%3A25):\n> I believe the \"Exception ignored\" to be harmless, in the sense that it's not going to break anything or cause segmentation faults.  If the exception is ignored, the computation simply continues and the user can press ctrl-C a second time and that should do it.\n\nYes, but it made it impossible for me to create a doctest for your fix!",
    "created_at": "2011-05-24T09:23:16Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60495",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:26'></a>
Replying to [@jdemeyer](#comment%3A25):
> I believe the "Exception ignored" to be harmless, in the sense that it's not going to break anything or cause segmentation faults.  If the exception is ignored, the computation simply continues and the user can press ctrl-C a second time and that should do it.

Yes, but it made it impossible for me to create a doctest for your fix!



---

archive/issue_events_053800.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-30T14:52:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53800"
}
```



---

archive/issue_events_053801.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-30T14:52:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7794#event-53801"
}
```



---

archive/issue_comments_060496.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha2",
    "created_at": "2011-05-30T14:52:02Z",
    "issue": "https://github.com/sagemath/sage/issues/7794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7794#issuecomment-60496",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha2
