# Issue 7857: Arithmetic operations in fraction fields

archive/issues_007857.json:
```json
{
    "body": "To implement Henrici's algorithms (or the Henrici--Brown algorithms) for arithmetic operations in fraction fields.\n\nSee:\n    http://groups.google.com/group/sage-devel/browse_thread/thread/65064ad496db9c75\n\n\n**Assignee:** spancratz\n\n**CC:**  @robertwb\n\n**Keywords:** fraction field\n\n**Author:** Sebastian Pancratz\n\n**Reviewer:** John Cremona\n\n**Merged:** sage-4.3.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/7857\n\n",
    "closed_at": "2010-01-13T08:10:46Z",
    "created_at": "2010-01-06T16:12:12Z",
    "labels": [
        "component: algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.1",
    "title": "Arithmetic operations in fraction fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7857",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```
To implement Henrici's algorithms (or the Henrici--Brown algorithms) for arithmetic operations in fraction fields.

See:
    http://groups.google.com/group/sage-devel/browse_thread/thread/65064ad496db9c75


**Assignee:** spancratz

**CC:**  @robertwb

**Keywords:** fraction field

**Author:** Sebastian Pancratz

**Reviewer:** John Cremona

**Merged:** sage-4.3.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/7857





---

archive/issue_events_054325.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/spancratz",
    "created_at": "2010-01-06T16:13:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54325"
}
```



---

archive/attachments_009944.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "ff20100106.patch",
    "asset_url": "tarball://root/attachments/ticket7857/ff20100106.patch",
    "created_at": "2010-01-06T16:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7857/ff20100106.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```



---

archive/issue_comments_061278.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [ff20100106.patch](https://github.com/sagemath/sage/files/ticket7857/ff20100106.patch)",
    "created_at": "2010-01-06T16:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61278",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:1'></a>
**Attachment:** [ff20100106.patch](https://github.com/sagemath/sage/files/ticket7857/ff20100106.patch)



---

archive/issue_comments_061279.json:
```json
{
    "body": "<a id='comment:2'></a>\nI've made a three more changes to the previous patch:\n\n- In two places I wrongfully used ``/`` instead of ``//``.\n- In another place I had ``base_ring`` instead of ``ring``.\n\nThis should be working now.  I've successfully run the doctests in the folder ``sage/rings``, and am currently running a complete test, too.\n\nSebastian",
    "created_at": "2010-01-06T17:38:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61279",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:2'></a>
I've made a three more changes to the previous patch:

- In two places I wrongfully used ``/`` instead of ``//``.
- In another place I had ``base_ring`` instead of ``ring``.

This should be working now.  I've successfully run the doctests in the folder ``sage/rings``, and am currently running a complete test, too.

Sebastian



---

archive/issue_events_054326.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/spancratz",
    "created_at": "2010-01-06T17:38:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54326"
}
```



---

archive/issue_events_054327.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/spancratz",
    "created_at": "2010-01-06T17:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54327"
}
```



---

archive/issue_comments_061280.json:
```json
{
    "body": "Second patch",
    "created_at": "2010-01-06T17:39:29Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61280",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Second patch



---

archive/attachments_009945.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac7857_20090106.patch",
    "asset_url": "tarball://root/attachments/ticket7857/trac7857_20090106.patch",
    "created_at": "2010-01-06T18:22:17Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7857/trac7857_20090106.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_061281.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Attachment:** [trac7857_20090106.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20090106.patch)\n\nFirst comment:  Note that the \"second patch\" replaces the first one!\n\nI noticed a bare \"except:\"  which is bad style -- it should list the errors expected explicitly.\n\nQuestion:  the code for sub is (of course) almost identical to that for add.  Would it not be better to implement sub by adding the inverse?  I would have thought that the overhead would be trivial, and itmakes the code easier to maintain.\n\nThe (second) patch applies fine to 4.3 and all tests in sage/rings and sage/schemes/elliptic_curves pass.  (I tested the latter since I seemed to remember some fraction field arithmetic somewhere in there).  I also checked the docs still build ok.\n\nI'll tag this as \"needs work\" but it's very minor to fix the exception trapping and (perhaps) replace the subtraction code.",
    "created_at": "2010-01-06T18:22:17Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61281",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
**Attachment:** [trac7857_20090106.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20090106.patch)

First comment:  Note that the "second patch" replaces the first one!

I noticed a bare "except:"  which is bad style -- it should list the errors expected explicitly.

Question:  the code for sub is (of course) almost identical to that for add.  Would it not be better to implement sub by adding the inverse?  I would have thought that the overhead would be trivial, and itmakes the code easier to maintain.

The (second) patch applies fine to 4.3 and all tests in sage/rings and sage/schemes/elliptic_curves pass.  (I tested the latter since I seemed to remember some fraction field arithmetic somewhere in there).  I also checked the docs still build ok.

I'll tag this as "needs work" but it's very minor to fix the exception trapping and (perhaps) replace the subtraction code.



---

archive/issue_comments_061282.json:
```json
{
    "body": "**Reviewer:** John Cremona",
    "created_at": "2010-01-06T18:22:17Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61282",
    "user": "https://github.com/JohnCremona"
}
```

**Reviewer:** John Cremona



---

archive/issue_events_054328.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-06T18:22:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54328"
}
```



---

archive/issue_events_054329.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-06T18:22:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54329"
}
```



---

archive/issue_events_054330.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-06T18:22:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "milestone": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54330"
}
```



---

archive/issue_comments_061283.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis is only a brief message, in case someone is considering reviewing this tonight.  I've now tested the entire library (although without the \"long\" option), and this has flagged some type errors, so there isn't much point in reviewing this just yet.  I think this has to do with the fact that in the previous patch I only considered ``AttributeError``s and ``NotImplementedError``s, but forgot about ``TypeError``s.  (There are the only three types that are currently considered in the method ``reduce``.)  I'll fix this tonight and then run the tests again, so a hopefully correct version of the patch will be up tomorrow.\n\nSebastian",
    "created_at": "2010-01-06T19:30:08Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61283",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:4'></a>
This is only a brief message, in case someone is considering reviewing this tonight.  I've now tested the entire library (although without the "long" option), and this has flagged some type errors, so there isn't much point in reviewing this just yet.  I think this has to do with the fact that in the previous patch I only considered ``AttributeError``s and ``NotImplementedError``s, but forgot about ``TypeError``s.  (There are the only three types that are currently considered in the method ``reduce``.)  I'll fix this tonight and then run the tests again, so a hopefully correct version of the patch will be up tomorrow.

Sebastian



---

archive/issue_comments_061284.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK -- sounds like you will be dealing with the first point I made anyway.  It should be quick to do a second review though.",
    "created_at": "2010-01-06T19:57:28Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61284",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
OK -- sounds like you will be dealing with the first point I made anyway.  It should be quick to do a second review though.



---

archive/issue_comments_061285.json:
```json
{
    "body": "<a id='comment:6'></a>\nDear John,\n\nThank you for looking at the patch this quickly.\n\nAbout your first point, I agree.  I followed the previous code of the method \"reduce\" in this part, which is why I am not completely sure I'll be able to find out exactly which exceptions might be raised.  But I will look into this.\n\nI think you are also right with your second point.  Of course, when I wrote the code I simply copied the method and replaced the appropriate signs to avoid the unnecessary overhead, but in this context this is probably a bad habit, since the maintainability of the code should take priority over a simple sign swap plus an extra function call.  By the way, the same applies to multiplication and division, too.\n\nI'll aim to complete this tonight or tomorrow.\n\nKind regards,\n\nSebastian\n\nReplying to [@JohnCremona](#comment%3A3):\n> First comment:  Note that the \"second patch\" replaces the first one!\n> \n> I noticed a bare \"except:\"  which is bad style -- it should list the errors expected explicitly.\n> \n> Question:  the code for sub is (of course) almost identical to that for add.  Would it not be better to implement sub by adding the inverse?  I would have thought that the overhead would be trivial, and itmakes the code easier to maintain.\n> \n> The (second) patch applies fine to 4.3 and all tests in sage/rings and sage/schemes/elliptic_curves pass.  (I tested the latter since I seemed to remember some fraction field arithmetic somewhere in there).  I also checked the docs still build ok.\n> \n> I'll tag this as \"needs work\" but it's very minor to fix the exception trapping and (perhaps) replace the subtraction code.",
    "created_at": "2010-01-06T21:51:45Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61285",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:6'></a>
Dear John,

Thank you for looking at the patch this quickly.

About your first point, I agree.  I followed the previous code of the method "reduce" in this part, which is why I am not completely sure I'll be able to find out exactly which exceptions might be raised.  But I will look into this.

I think you are also right with your second point.  Of course, when I wrote the code I simply copied the method and replaced the appropriate signs to avoid the unnecessary overhead, but in this context this is probably a bad habit, since the maintainability of the code should take priority over a simple sign swap plus an extra function call.  By the way, the same applies to multiplication and division, too.

I'll aim to complete this tonight or tomorrow.

Kind regards,

Sebastian

Replying to [@JohnCremona](#comment%3A3):
> First comment:  Note that the "second patch" replaces the first one!
> 
> I noticed a bare "except:"  which is bad style -- it should list the errors expected explicitly.
> 
> Question:  the code for sub is (of course) almost identical to that for add.  Would it not be better to implement sub by adding the inverse?  I would have thought that the overhead would be trivial, and itmakes the code easier to maintain.
> 
> The (second) patch applies fine to 4.3 and all tests in sage/rings and sage/schemes/elliptic_curves pass.  (I tested the latter since I seemed to remember some fraction field arithmetic somewhere in there).  I also checked the docs still build ok.
> 
> I'll tag this as "needs work" but it's very minor to fix the exception trapping and (perhaps) replace the subtraction code.



---

archive/attachments_009946.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac7857_20090107.patch",
    "asset_url": "tarball://root/attachments/ticket7857/trac7857_20090107.patch",
    "created_at": "2010-01-06T23:37:31Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7857/trac7857_20090107.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```



---

archive/issue_comments_061286.json:
```json
{
    "body": "**Attachment:** [trac7857_20090107.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20090107.patch)\n\nThird patch (replacing all previous ones)",
    "created_at": "2010-01-06T23:37:31Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61286",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

**Attachment:** [trac7857_20090107.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20090107.patch)

Third patch (replacing all previous ones)



---

archive/issue_comments_061287.json:
```json
{
    "body": "<a id='comment:7'></a>\nAt the moment, the following tests still fail:\n\n```\nsage -t  devel/sage-ff/sage/combinat/sf/hall_littlewood.py\nsage -t  devel/sage-ff/sage/combinat/sf/macdonald.py\nsage -t  devel/sage-ff/sage/combinat/sf/sf.py\nsage -t  devel/sage-ff/sage/combinat/sf/jack.py\nsage -t  devel/sage-ff/sage/coding/linear_code.py\nsage -t  devel/sage-ff/sage/algebras/quatalg/quaternion_algebra_element.pyx\nsage -t  devel/sage-ff/sage/matrix/matrix2.pyx\n```\n\nAfter taking a first look, it seems that some of these are just positive docstring changes (e.g. a previous ``(-1)/(-1)`` which is now correctly displayed as a ``1``), others are negative changes (e.g. a previous ``1`` now displayed as ``(1/3)/(1/3)``).  However, some ``AttributeError``s are raised for fraction field elements, suggesting that sometimes the numerator or denominator isn't in the ring (of the fraction field).  However, *assuming* that the numerators and denominators of the input to the arithmetic methods belong to the correct ring, I think the code should preserve this and so I should be right to always pass ``coerce=False``.  I could pass ``coerce=True`` to fix these, but assuming I am right (which might not be the case), this would just hide mistakes elsewhere.  In any case, I'll look at these points tomorrow.\n\nSebastian",
    "created_at": "2010-01-07T01:46:03Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61287",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:7'></a>
At the moment, the following tests still fail:

```
sage -t  devel/sage-ff/sage/combinat/sf/hall_littlewood.py
sage -t  devel/sage-ff/sage/combinat/sf/macdonald.py
sage -t  devel/sage-ff/sage/combinat/sf/sf.py
sage -t  devel/sage-ff/sage/combinat/sf/jack.py
sage -t  devel/sage-ff/sage/coding/linear_code.py
sage -t  devel/sage-ff/sage/algebras/quatalg/quaternion_algebra_element.pyx
sage -t  devel/sage-ff/sage/matrix/matrix2.pyx
```

After taking a first look, it seems that some of these are just positive docstring changes (e.g. a previous ``(-1)/(-1)`` which is now correctly displayed as a ``1``), others are negative changes (e.g. a previous ``1`` now displayed as ``(1/3)/(1/3)``).  However, some ``AttributeError``s are raised for fraction field elements, suggesting that sometimes the numerator or denominator isn't in the ring (of the fraction field).  However, *assuming* that the numerators and denominators of the input to the arithmetic methods belong to the correct ring, I think the code should preserve this and so I should be right to always pass ``coerce=False``.  I could pass ``coerce=True`` to fix these, but assuming I am right (which might not be the case), this would just hide mistakes elsewhere.  In any case, I'll look at these points tomorrow.

Sebastian



---

archive/issue_comments_061288.json:
```json
{
    "body": "Fourth patch (replacing all previous ones)",
    "created_at": "2010-01-07T02:36:57Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61288",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Fourth patch (replacing all previous ones)



---

archive/attachments_009947.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac7857_20100107.patch",
    "asset_url": "tarball://root/attachments/ticket7857/trac7857_20100107.patch",
    "created_at": "2010-01-07T03:02:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7857/trac7857_20100107.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```



---

archive/issue_comments_061289.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Attachment:** [trac7857_20100107.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20100107.patch)\n\nThis patch should now fix the previously remaining doctest failures.  But I am currently testing everything again tonight and will report back tomorrow.\n\nSebastian",
    "created_at": "2010-01-07T03:02:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61289",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:8'></a>
**Attachment:** [trac7857_20100107.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20100107.patch)

This patch should now fix the previously remaining doctest failures.  But I am currently testing everything again tonight and will report back tomorrow.

Sebastian



---

archive/issue_comments_061290.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou seem to be catching and silencing a huge number of errors, without explanation (though the code before wasn't too good at that either). Also, what if inverse_of_unit raises a NotImplementedError, shouldn't it still be as reduced as possible?",
    "created_at": "2010-01-07T06:25:41Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61290",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:10'></a>
You seem to be catching and silencing a huge number of errors, without explanation (though the code before wasn't too good at that either). Also, what if inverse_of_unit raises a NotImplementedError, shouldn't it still be as reduced as possible?



---

archive/issue_comments_061291.json:
```json
{
    "body": "<a id='comment:11'></a>\nFirstly, I wanted to say that the most recent patch file now passes all doctests on my machine.\n\nIt is definitely true that a lot of errors are silenced.  But this is done in essentially the same way as before, where, whenever ``reduce`` was called from ``__init__``, the three kinds of errors (``AttributeError``, ``NotImplementedError``, and ``TypeError``) were converted to an ``ArithmeticError``, which was then silenced in ``__init__``.  That is, the user would only actually see the errors if he called ``reduce`` directly.\n\nOf course, I am not entirely sure about this, but I think the behaviour might have been intended.  For example, I don't think someone using fraction fields of non-Euclidean PIDs or Euclidean domains without a GCD implementation should have to wrap all his basic arithmetic calls in ``try ... except``.  On the other hand, if someone explicitly calls ``reduce``, the exceptions should be raised and the caller ought to deal with them.  What do you think, Robert?\n\nAbout the second point, I had the impression that for rings the method ``inverse_of_unit`` was either implemented or not, rather than it being implemented only to return a ``NotImplementedError``, which is why I am only catching ``AttributeError``s.  However, if this is not the case, then I agree with you, ``NotImplementedError``s should be handled in exactly the same way as ``AttributeError``s in this place.  Could you please comment on this?\n\nThanks,\n\nSebastian\n\nReplying to [@robertwb](#comment%3A10):\n> You seem to be catching and silencing a huge number of errors, without explanation (though the code before wasn't too good at that either). Also, what if inverse_of_unit raises a NotImplementedError, shouldn't it still be as reduced as possible?",
    "created_at": "2010-01-07T11:26:16Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61291",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:11'></a>
Firstly, I wanted to say that the most recent patch file now passes all doctests on my machine.

It is definitely true that a lot of errors are silenced.  But this is done in essentially the same way as before, where, whenever ``reduce`` was called from ``__init__``, the three kinds of errors (``AttributeError``, ``NotImplementedError``, and ``TypeError``) were converted to an ``ArithmeticError``, which was then silenced in ``__init__``.  That is, the user would only actually see the errors if he called ``reduce`` directly.

Of course, I am not entirely sure about this, but I think the behaviour might have been intended.  For example, I don't think someone using fraction fields of non-Euclidean PIDs or Euclidean domains without a GCD implementation should have to wrap all his basic arithmetic calls in ``try ... except``.  On the other hand, if someone explicitly calls ``reduce``, the exceptions should be raised and the caller ought to deal with them.  What do you think, Robert?

About the second point, I had the impression that for rings the method ``inverse_of_unit`` was either implemented or not, rather than it being implemented only to return a ``NotImplementedError``, which is why I am only catching ``AttributeError``s.  However, if this is not the case, then I agree with you, ``NotImplementedError``s should be handled in exactly the same way as ``AttributeError``s in this place.  Could you please comment on this?

Thanks,

Sebastian

Replying to [@robertwb](#comment%3A10):
> You seem to be catching and silencing a huge number of errors, without explanation (though the code before wasn't too good at that either). Also, what if inverse_of_unit raises a NotImplementedError, shouldn't it still be as reduced as possible?



---

archive/issue_events_054331.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/spancratz",
    "created_at": "2010-01-07T11:26:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54331"
}
```



---

archive/issue_events_054332.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/spancratz",
    "created_at": "2010-01-07T11:26:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54332"
}
```



---

archive/issue_comments_061292.json:
```json
{
    "body": "Fifth patch (replacing all previous ones)",
    "created_at": "2010-01-09T02:37:58Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61292",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Fifth patch (replacing all previous ones)



---

archive/attachments_009948.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac7857_20100109.patch",
    "asset_url": "tarball://root/attachments/ticket7857/trac7857_20100109.patch",
    "created_at": "2010-01-09T02:47:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7857/trac7857_20100109.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```



---

archive/issue_comments_061293.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Attachment:** [trac7857_20100109.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20100109.patch)\n\nI've made three further improvements:\n\n- I've now incorporated Robert's suggestion to catch ``NotImplementedError``s, too.  \n- I've improved the method for computing the derivative further, noting that the second GCD computation was unnecessary since at that point in the computation the result was in lowest terms already.\n- I've added some test cases to the method ``_derivative``.\n\nSebastian",
    "created_at": "2010-01-09T02:47:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61293",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:12'></a>
**Attachment:** [trac7857_20100109.patch](https://github.com/sagemath/sage/files/ticket7857/trac7857_20100109.patch)

I've made three further improvements:

- I've now incorporated Robert's suggestion to catch ``NotImplementedError``s, too.  
- I've improved the method for computing the derivative further, noting that the second GCD computation was unnecessary since at that point in the computation the result was in lowest terms already.
- I've added some test cases to the method ``_derivative``.

Sebastian



---

archive/issue_comments_061294.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis looks pretty good, and I am checking it now (as it touches so many places I am doing a full test on both 32 and 64 bit machines).\n\nTwo small points:\n1. If you have several \"except\" clauses each with the same action, you can combine them thus:\n\n```\n    except (AttributeError, NotImplementedError, TypeError):\n```\n2. It's a bit perverse to call the num and den of \"self\" rnum and rden whle calling those of \"right\" snum and sden.   However, swapping the over without introducing any bugs would not be trivial!\n\nI will report back when the full tests have finished.",
    "created_at": "2010-01-10T14:20:26Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61294",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
This looks pretty good, and I am checking it now (as it touches so many places I am doing a full test on both 32 and 64 bit machines).

Two small points:
1. If you have several "except" clauses each with the same action, you can combine them thus:

```
    except (AttributeError, NotImplementedError, TypeError):
```
2. It's a bit perverse to call the num and den of "self" rnum and rden whle calling those of "right" snum and sden.   However, swapping the over without introducing any bugs would not be trivial!

I will report back when the full tests have finished.



---

archive/issue_comments_061295.json:
```json
{
    "body": "<a id='comment:14'></a>\nOK, all tests pass on both 32 and 64 bit.  Hence positive review, as the points I made above are purely cosmetic.",
    "created_at": "2010-01-10T15:48:41Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61295",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
OK, all tests pass on both 32 and 64 bit.  Hence positive review, as the points I made above are purely cosmetic.



---

archive/issue_events_054333.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-10T15:48:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54333"
}
```



---

archive/issue_events_054334.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-01-10T15:48:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54334"
}
```



---

archive/issue_comments_061296.json:
```json
{
    "body": "**Changing author** from \"spancratz\" to \"Sebastian Pancratz\".",
    "created_at": "2010-01-13T08:10:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61296",
    "user": "https://github.com/rlmill"
}
```

**Changing author** from "spancratz" to "Sebastian Pancratz".



---

archive/issue_comments_061297.json:
```json
{
    "body": "**Merged:** 4.3.1.alpha2",
    "created_at": "2010-01-13T08:10:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61297",
    "user": "https://github.com/rlmill"
}
```

**Merged:** 4.3.1.alpha2



---

archive/issue_events_054335.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T08:10:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54335"
}
```



---

archive/issue_events_054336.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T08:10:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7857#event-54336"
}
```



---

archive/issue_comments_061298.json:
```json
{
    "body": "**Changing merged** from \"4.3.1.alpha2\" to \"sage-4.3.1.alpha2\".",
    "created_at": "2010-01-13T19:57:08Z",
    "issue": "https://github.com/sagemath/sage/issues/7857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7857#issuecomment-61298",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Changing merged** from "4.3.1.alpha2" to "sage-4.3.1.alpha2".
