# Issue 7711: integral() does not reduce coefficients in finite field

archive/issues_007711.json:
```json
{
    "assignees": [
        "https://github.com/malb"
    ],
    "body": "Consider the following example:\n\n```\nsage: P.<x,z> = PolynomialRing(GF(2147483647))\nsage: Q.<y> = PolynomialRing(P)\nsage: p=x+y+z   \nsage: p.integral()\n1/2*y^2 + (x + z)*y\n```\nNote the leading coefficient 1/2 is not reduced mod 2147483647.\n\nFor smaller p this seems to work:\n\n```\nsage: P.<x,z> = PolynomialRing(GF(2147483629))\nsage: Q.<y> = PolynomialRing(P)\nsage: p=x+y+z\nsage: p.integral()\n-1073741814*y^2 + (x + z)*y\n```\nIt works also when the smaller ring P has only one variable:\n\n```\nsage: P.<x> = PolynomialRing(GF(2147483647))\nsage: Q.<y> = PolynomialRing(P)\nsage: p=x+y\nsage: p.integral()\n1073741824*y^2 + x*y\n```\n\nReviewer: **Paul Zimmermann**\n\nAuthor: **Alex Ghitza**\n\nMerged: **sage-5.0.beta12**\n\nComponent: **commutative algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7711_\n\n",
    "closed_at": "2012-04-02T15:23:49Z",
    "created_at": "2009-12-16T12:21:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "integral() does not reduce coefficients in finite field",
    "type": "issue",
    "updated_at": "2012-04-02T15:23:49Z",
    "url": "https://github.com/sagemath/sage/issues/7711",
    "user": "https://github.com/zimmermann6"
}
```
Consider the following example:

```
sage: P.<x,z> = PolynomialRing(GF(2147483647))
sage: Q.<y> = PolynomialRing(P)
sage: p=x+y+z   
sage: p.integral()
1/2*y^2 + (x + z)*y
```
Note the leading coefficient 1/2 is not reduced mod 2147483647.

For smaller p this seems to work:

```
sage: P.<x,z> = PolynomialRing(GF(2147483629))
sage: Q.<y> = PolynomialRing(P)
sage: p=x+y+z
sage: p.integral()
-1073741814*y^2 + (x + z)*y
```
It works also when the smaller ring P has only one variable:

```
sage: P.<x> = PolynomialRing(GF(2147483647))
sage: Q.<y> = PolynomialRing(P)
sage: p=x+y
sage: p.integral()
1073741824*y^2 + x*y
```

Reviewer: **Paul Zimmermann**

Author: **Alex Ghitza**

Merged: **sage-5.0.beta12**

Component: **commutative algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/7711_





---

archive/issue_events_095222.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2009-12-16T12:21:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "milestone_number": null,
    "milestone_title": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95222"
}
```



---

archive/issue_events_095223.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2009-12-16T12:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95223"
}
```



---

archive/issue_events_095224.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2009-12-16T12:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95224"
}
```



---

archive/issue_events_095225.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2009-12-16T12:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95225"
}
```



---

archive/issue_events_095226.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2009-12-16T12:21:31Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "subject": "https://github.com/zimmermann6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95226"
}
```



---

archive/issue_comments_057846.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI'm declaring a total feature freeze on sage-4.3.",
    "created_at": "2009-12-24T07:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57846",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

I'm declaring a total feature freeze on sage-4.3.



---

archive/issue_events_095227.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-24T07:07:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "milestone_number": null,
    "milestone_title": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95227"
}
```



---

archive/issue_events_095228.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-24T07:07:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "milestone_number": null,
    "milestone_title": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95228"
}
```



---

archive/issue_comments_057847.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNote also that in Paul's first example we have:\n\n```\nsage: p.integral().parent()\nUnivariate Polynomial Ring in y over Fraction Field of Multivariate Polynomial Ring in x, z over Finite Field of size 2147483647\n```\n\nwhereas in the second:\n\n```\nsage: p.integral().parent()\nUnivariate Polynomial Ring in y over Multivariate Polynomial Ring in x, z over Finite Field of size 2147483629\n```\n\nThis is probably where the issue is.",
    "created_at": "2010-01-02T11:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57847",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:2" align="right">comment:2</div>

Note also that in Paul's first example we have:

```
sage: p.integral().parent()
Univariate Polynomial Ring in y over Fraction Field of Multivariate Polynomial Ring in x, z over Finite Field of size 2147483647
```

whereas in the second:

```
sage: p.integral().parent()
Univariate Polynomial Ring in y over Multivariate Polynomial Ring in x, z over Finite Field of size 2147483629
```

This is probably where the issue is.



---

archive/issue_comments_057848.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe bug is still there in 4.3.1.",
    "created_at": "2010-02-05T20:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57848",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:3" align="right">comment:3</div>

The bug is still there in 4.3.1.



---

archive/issue_events_095229.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95229"
}
```



---

archive/issue_comments_057849.json:
```json
{
    "body": "Changed keywords from none to **rd2**",
    "created_at": "2012-03-19T18:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57849",
    "user": "https://github.com/jbalakrishnan"
}
```

Changed keywords from none to **rd2**



---

archive/issue_events_095230.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95230"
}
```



---

archive/issue_events_095231.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95231"
}
```



---

archive/issue_events_095232.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95232"
}
```



---

archive/issue_comments_057850.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is no longer an issue:\n\n```\nsage: P.<x,z> = PolynomialRing(GF(2147483647))\nsage: Q.<y> = PolynomialRing(P)\nsage: p=x+y+z   \nsage: p.integral()\n-1073741823*y^2 + (x + z)*y\nsage: P(-1073741823*2)\n1\n```",
    "created_at": "2012-03-19T18:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57850",
    "user": "https://github.com/jbalakrishnan"
}
```

<div id="comment:4" align="right">comment:4</div>

This is no longer an issue:

```
sage: P.<x,z> = PolynomialRing(GF(2147483647))
sage: Q.<y> = PolynomialRing(P)
sage: p=x+y+z   
sage: p.integral()
-1073741823*y^2 + (x + z)*y
sage: P(-1073741823*2)
1
```



---

archive/issue_events_095233.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95233"
}
```



---

archive/issue_events_095234.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:28:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95234"
}
```



---

archive/issue_comments_057851.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't agree that this has been fixed.  In 5.0.beta8, I only have to go up to the next prime:\n\n\n```\n\nsage: def f(N):\n....:     P.<x,z> = PolynomialRing(GF(N))\n....:     Q.<y> = PolynomialRing(P)\n....:     p=x+y+z   \n....:     return p.integral()\n....: \nsage: N = 2147483647\nsage: f(N)\n-1073741823*y^2 + (x + z)*y\nsage: N = next_prime(N)\nsage: N\n2147483659\nsage: f(N)\n1/2*y^2 + (x + z)*y\n\n```",
    "created_at": "2012-03-19T18:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57851",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't agree that this has been fixed.  In 5.0.beta8, I only have to go up to the next prime:


```

sage: def f(N):
....:     P.<x,z> = PolynomialRing(GF(N))
....:     Q.<y> = PolynomialRing(P)
....:     p=x+y+z   
....:     return p.integral()
....: 
sage: N = 2147483647
sage: f(N)
-1073741823*y^2 + (x + z)*y
sage: N = next_prime(N)
sage: N
2147483659
sage: f(N)
1/2*y^2 + (x + z)*y

```



---

archive/issue_comments_057852.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nGood catch. I'll change it back to \"needs work.\"",
    "created_at": "2012-03-19T18:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57852",
    "user": "https://github.com/jbalakrishnan"
}
```

<div id="comment:7" align="right">comment:7</div>

Good catch. I'll change it back to "needs work."



---

archive/issue_comments_057853.json:
```json
{
    "body": "Changed keywords from **rd2** to none",
    "created_at": "2012-03-19T18:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57853",
    "user": "https://github.com/jbalakrishnan"
}
```

Changed keywords from **rd2** to none



---

archive/issue_events_095235.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:50:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95235"
}
```



---

archive/issue_events_095236.json:
```json
{
    "actor": "https://github.com/jbalakrishnan",
    "created_at": "2012-03-19T18:50:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95236"
}
```



---

archive/issue_events_095237.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T03:20:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95237"
}
```



---

archive/issue_comments_057854.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor large primes, Sage uses polydicts for representing multivariate polynomials, instead of using Singular.  The trouble here is that dividing a polydict by another polydict automatically creates the fraction field, even when the denominator is actually an element of the coefficient ring.\n\nThe attached patch tries to detect this (relatively common) special case and perform the division in the coefficient ring instead of going to the fraction field of the ring of polynomials.  This fixes the problems with `integral()` reported here.",
    "created_at": "2012-03-24T05:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57854",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:9" align="right">comment:9</div>

For large primes, Sage uses polydicts for representing multivariate polynomials, instead of using Singular.  The trouble here is that dividing a polydict by another polydict automatically creates the fraction field, even when the denominator is actually an element of the coefficient ring.

The attached patch tries to detect this (relatively common) special case and perform the division in the coefficient ring instead of going to the fraction field of the ring of polynomials.  This fixes the problems with `integral()` reported here.



---

archive/issue_events_095238.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T05:25:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95238"
}
```



---

archive/issue_events_095239.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T05:25:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95239"
}
```



---

archive/issue_comments_057855.json:
```json
{
    "body": "Author: **Alex Ghitza**",
    "created_at": "2012-03-24T05:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57855",
    "user": "https://github.com/aghitza"
}
```

Author: **Alex Ghitza**



---

archive/issue_comments_057856.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAlex,\n\nthere is something I don't understand with your patch. You check that `right` is in the base\nring, but not `1/right`, thus what happens the base ring is not a field? Compare for example:\n\n```\nsage: P.<x,z> = PolynomialRing(ZZ)\nsage: Q.<y> = PolynomialRing(P)\nsage: p=x+y+z\nsage: t=p/2\nsage: t.parent()\nUnivariate Polynomial Ring in y over Multivariate Polynomial Ring in x, z over Rational Field\nsage: u=p.integral()\nsage: u.parent()\nUnivariate Polynomial Ring in y over Fraction Field of Multivariate Polynomial Ring in x, z over Integer Ring\n```\nWhy do t and u have different parents?\n\nPaul",
    "created_at": "2012-03-24T08:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57856",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:11" align="right">comment:11</div>

Alex,

there is something I don't understand with your patch. You check that `right` is in the base
ring, but not `1/right`, thus what happens the base ring is not a field? Compare for example:

```
sage: P.<x,z> = PolynomialRing(ZZ)
sage: Q.<y> = PolynomialRing(P)
sage: p=x+y+z
sage: t=p/2
sage: t.parent()
Univariate Polynomial Ring in y over Multivariate Polynomial Ring in x, z over Rational Field
sage: u=p.integral()
sage: u.parent()
Univariate Polynomial Ring in y over Fraction Field of Multivariate Polynomial Ring in x, z over Integer Ring
```
Why do t and u have different parents?

Paul



---

archive/issue_events_095240.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-24T09:00:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95240"
}
```



---

archive/issue_events_095241.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-24T09:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95241"
}
```



---

archive/issue_comments_057857.json:
```json
{
    "body": "Reviewer: **Paul Zimmermann**",
    "created_at": "2012-03-24T09:01:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57857",
    "user": "https://github.com/zimmermann6"
}
```

Reviewer: **Paul Zimmermann**



---

archive/issue_comments_057858.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI guess I always found the following strange:\n\n```\nsage: type(3)\n<type 'sage.rings.integer.Integer'>\nsage: type(3/1)\n<type 'sage.rings.rational.Rational'>\n```\n\nand that influenced me in writing this patch.  I don't however have a strong opinion about this, and I'm happy to change it to make things more consistent by working in the fraction field of base_ring.  I'll replace the patch with one having this behavior soon.",
    "created_at": "2012-03-24T09:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57858",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:14" align="right">comment:14</div>

I guess I always found the following strange:

```
sage: type(3)
<type 'sage.rings.integer.Integer'>
sage: type(3/1)
<type 'sage.rings.rational.Rational'>
```

and that influenced me in writing this patch.  I don't however have a strong opinion about this, and I'm happy to change it to make things more consistent by working in the fraction field of base_ring.  I'll replace the patch with one having this behavior soon.



---

archive/issue_comments_057859.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nBy the way, the issue you point out with ZZ coefficients is apparently orthogonal to this patch.  Multivariate polynomials over ZZ are handled by Singular, and the patch does not touch them.  It only modifies the behavior for multivariate polynomials that are implemented as polydict's, such as the ones over finite fields of huge characteristic that this ticket started with.\n\nYour ZZ example behaves the same with or without this patch.  If you find it really bothersome, maybe it can be on a new ticket.",
    "created_at": "2012-03-24T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57859",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:15" align="right">comment:15</div>

By the way, the issue you point out with ZZ coefficients is apparently orthogonal to this patch.  Multivariate polynomials over ZZ are handled by Singular, and the patch does not touch them.  It only modifies the behavior for multivariate polynomials that are implemented as polydict's, such as the ones over finite fields of huge characteristic that this ticket started with.

Your ZZ example behaves the same with or without this patch.  If you find it really bothersome, maybe it can be on a new ticket.



---

archive/issue_events_095242.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T09:39:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95242"
}
```



---

archive/issue_events_095243.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T09:39:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95243"
}
```



---

archive/issue_comments_057860.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAlex, can you add an example where your patch is called with coefficients in a ring?\n\nAbout `3/1` giving a rational, this is ok for me. Indeed, you don't want the type of the result\nto differ when the division is exact or not: `3/2` and `3/1` should give both rationals.\n\nPaul",
    "created_at": "2012-03-24T09:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57860",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:17" align="right">comment:17</div>

Alex, can you add an example where your patch is called with coefficients in a ring?

About `3/1` giving a rational, this is ok for me. Indeed, you don't want the type of the result
to differ when the division is exact or not: `3/2` and `3/1` should give both rationals.

Paul



---

archive/issue_events_095244.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T10:42:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95244"
}
```



---

archive/issue_events_095245.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T10:42:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95245"
}
```



---

archive/issue_comments_057861.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAlright, I'm starting to see what you are objecting to, and I agree with you.  Just to make sure I get this right: even the documented examples from the docstring of integral are inconsistent in this way\n\n```\n        EXAMPLES::\n        \n            sage: R.<x> = ZZ[]\n            sage: R(0).integral()\n            0\n            sage: f = R(2).integral(); f\n            2*x\n        \n        Note that since the integral is defined over the same base ring the\n        integral is actually in the base ring.\n        \n        ::\n        \n            sage: f.parent()\n            Univariate Polynomial Ring in x over Integer Ring\n        \n        If the integral isn't defined over the same base ring, then the\n        base ring is extended::\n        \n            sage: f = x^3 + x - 2\n            sage: g = f.integral(); g\n            1/4*x^4 + 1/2*x^2 - 2*x\n            sage: g.parent()\n            Univariate Polynomial Ring in x over Rational Field\n```\n\nWe want Sage to be less clever and more consistent, so the integral of 2 should be 2x in QQ[x] rather than in ZZ[x].\n\nOf course, this is fun to implement, because you might have something like:\n\n```\nsage: A.<a, b> = PolynomialRing(ZZ)\nsage: C.<c> = PolynomialRing(A)\nsage: D.<d> = PowerSeriesRing(C)\nsage: R.<x> = PolynomialRing(D)\nsage: f = a*x^2 + c*x\nsage: f.parent()\nUnivariate Polynomial Ring in x over Power Series Ring in d over \nUnivariate Polynomial Ring in c over Multivariate Polynomial Ring \nin a, b over Integer Ring\n```\n\nWhat I would like to do is have f.integral() live in\n\n```\nUnivariate Polynomial Ring in x over Power Series Ring in d over \nUnivariate Polynomial Ring in c over Multivariate Polynomial Ring \nin a, b over Rational Field\n```\n\nSo I want to change to the fraction field at the very bottom of the chain of extensions.  This means starting with R and going down to ZZ step by step, then changing ZZ to QQ and walking back up, changing all the intermediate rings along the way.  It can get expensive, but I guess that's the price to pay for working with such monstrosities.\n\nIf my outline agrees with what you had in mind, I'll produce a new patch based on it.",
    "created_at": "2012-03-24T10:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57861",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:18" align="right">comment:18</div>

Alright, I'm starting to see what you are objecting to, and I agree with you.  Just to make sure I get this right: even the documented examples from the docstring of integral are inconsistent in this way

```
        EXAMPLES::
        
            sage: R.<x> = ZZ[]
            sage: R(0).integral()
            0
            sage: f = R(2).integral(); f
            2*x
        
        Note that since the integral is defined over the same base ring the
        integral is actually in the base ring.
        
        ::
        
            sage: f.parent()
            Univariate Polynomial Ring in x over Integer Ring
        
        If the integral isn't defined over the same base ring, then the
        base ring is extended::
        
            sage: f = x^3 + x - 2
            sage: g = f.integral(); g
            1/4*x^4 + 1/2*x^2 - 2*x
            sage: g.parent()
            Univariate Polynomial Ring in x over Rational Field
```

We want Sage to be less clever and more consistent, so the integral of 2 should be 2x in QQ[x] rather than in ZZ[x].

Of course, this is fun to implement, because you might have something like:

```
sage: A.<a, b> = PolynomialRing(ZZ)
sage: C.<c> = PolynomialRing(A)
sage: D.<d> = PowerSeriesRing(C)
sage: R.<x> = PolynomialRing(D)
sage: f = a*x^2 + c*x
sage: f.parent()
Univariate Polynomial Ring in x over Power Series Ring in d over 
Univariate Polynomial Ring in c over Multivariate Polynomial Ring 
in a, b over Integer Ring
```

What I would like to do is have f.integral() live in

```
Univariate Polynomial Ring in x over Power Series Ring in d over 
Univariate Polynomial Ring in c over Multivariate Polynomial Ring 
in a, b over Rational Field
```

So I want to change to the fraction field at the very bottom of the chain of extensions.  This means starting with R and going down to ZZ step by step, then changing ZZ to QQ and walking back up, changing all the intermediate rings along the way.  It can get expensive, but I guess that's the price to pay for working with such monstrosities.

If my outline agrees with what you had in mind, I'll produce a new patch based on it.



---

archive/issue_comments_057862.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAlex,\n\nin fact I guess your initial patch did what we want. Indeed with your latest example:\n\n```\nsage: g=f/2\nsage: g.parent()\nUnivariate Polynomial Ring in x over Power Series Ring in d over Univariate Polynomial Ring in c over Multivariate Polynomial Ring in a, b over Rational Field\n```\nthus the fact of dividing f by an element of the base ring automatically extends it to the corresponding\nfraction field if necessary.\n\nThus I suggest you revert to your first patch (sorry) and add the above example as test.\n\nPaul",
    "created_at": "2012-03-24T11:03:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57862",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:19" align="right">comment:19</div>

Alex,

in fact I guess your initial patch did what we want. Indeed with your latest example:

```
sage: g=f/2
sage: g.parent()
Univariate Polynomial Ring in x over Power Series Ring in d over Univariate Polynomial Ring in c over Multivariate Polynomial Ring in a, b over Rational Field
```
thus the fact of dividing f by an element of the base ring automatically extends it to the corresponding
fraction field if necessary.

Thus I suggest you revert to your first patch (sorry) and add the above example as test.

Paul



---

archive/issue_comments_057863.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDoes this patch break a major fundamental design decision in both Sage and Magma, namely that / is a constructor for elements of the fraction field.   E.g.,  3/1 has parent QQ.",
    "created_at": "2012-03-24T11:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57863",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:20" align="right">comment:20</div>

Does this patch break a major fundamental design decision in both Sage and Magma, namely that / is a constructor for elements of the fraction field.   E.g.,  3/1 has parent QQ.



---

archive/issue_comments_057864.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWilliam, I don't think this patch (still not ready) will break anything, since I believe it will just\nreturn f/c where f is a polynomial and c an element of the base ring.\n\nAnyway your advice how to best solve this problem is welcome.\n\nPaul",
    "created_at": "2012-03-24T14:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57864",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:21" align="right">comment:21</div>

William, I don't think this patch (still not ready) will break anything, since I believe it will just
return f/c where f is a polynomial and c an element of the base ring.

Anyway your advice how to best solve this problem is welcome.

Paul



---

archive/issue_comments_057865.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@williamstein](#comment:20):\n> Does this patch break a major fundamental design decision in both Sage and Magma, namely that / is a constructor for elements of the fraction field.   E.g.,  3/1 has parent QQ.\n\nHi William, can you have a look at the docstring for p.integral() as it stands now and tell me whether you think it complies with this design decision?  Here is an example:\n\n```\nsage: S.<x> = ZZ[]\nsage: p = 2*x\nsage: p.integral()\nx^2\nsage: p.integral().parent()\nUnivariate Polynomial Ring in x over Integer Ring\n```\n\nBehind the scenes Sage performed 2/2 and decided that the answer was 1 in ZZ rather than 1 in QQ, so this seems to break the convention.  Also, the answer has a different parent than (3*x).integral(), which is the type of inconsistency that Paul was pointing out before.  So should this stay the way it is, or should this be changed to be more consistent?\n\nBut it gets a tiny bit more complicated than this.  Suppose your coefficients are not ZZ, but rather ZZ[y], where y is a vector of 200 variables.  The integral of 2*x is still `x^2`, but where do we want this `x^2` to live?  Possible answers are (a) ZZ[y][x], (b) Frac(ZZ[y])[x], (c) QQ[y][x].\nThe current behavior is (a) for 2*x and (b) for 3*x, and I am currently leaning toward changing both to (c).  Here's why: you have p in R[x], where R is some coefficient ring.  When you do p.integral(), you are not really dividing p by integers n, but rather the coefficients of p by integers n.  So maybe we should look at what division by n in the coefficient ring R does:\n\n```\nsage: R.<y0,y1,y2,y3> = ZZ[]\nsage: S.<x> = R[]\nsage: p = 2*y0\nsage: p.parent()\nMultivariate Polynomial Ring in y0, y1, y2, y3 over Integer Ring\nsage: (p/2).parent()\nMultivariate Polynomial Ring in y0, y1, y2, y3 over Rational Field\nsage: p = 3*y0\nsage: (p/2).parent()\nMultivariate Polynomial Ring in y0, y1, y2, y3 over Rational Field\n```\n\nSo p/2 is not in the fraction field of R.  This is what I would like integral() to do as well.\n\nThoughts?",
    "created_at": "2012-03-24T21:17:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57865",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@williamstein](#comment:20):
> Does this patch break a major fundamental design decision in both Sage and Magma, namely that / is a constructor for elements of the fraction field.   E.g.,  3/1 has parent QQ.

Hi William, can you have a look at the docstring for p.integral() as it stands now and tell me whether you think it complies with this design decision?  Here is an example:

```
sage: S.<x> = ZZ[]
sage: p = 2*x
sage: p.integral()
x^2
sage: p.integral().parent()
Univariate Polynomial Ring in x over Integer Ring
```

Behind the scenes Sage performed 2/2 and decided that the answer was 1 in ZZ rather than 1 in QQ, so this seems to break the convention.  Also, the answer has a different parent than (3*x).integral(), which is the type of inconsistency that Paul was pointing out before.  So should this stay the way it is, or should this be changed to be more consistent?

But it gets a tiny bit more complicated than this.  Suppose your coefficients are not ZZ, but rather ZZ[y], where y is a vector of 200 variables.  The integral of 2*x is still `x^2`, but where do we want this `x^2` to live?  Possible answers are (a) ZZ[y][x], (b) Frac(ZZ[y])[x], (c) QQ[y][x].
The current behavior is (a) for 2*x and (b) for 3*x, and I am currently leaning toward changing both to (c).  Here's why: you have p in R[x], where R is some coefficient ring.  When you do p.integral(), you are not really dividing p by integers n, but rather the coefficients of p by integers n.  So maybe we should look at what division by n in the coefficient ring R does:

```
sage: R.<y0,y1,y2,y3> = ZZ[]
sage: S.<x> = R[]
sage: p = 2*y0
sage: p.parent()
Multivariate Polynomial Ring in y0, y1, y2, y3 over Integer Ring
sage: (p/2).parent()
Multivariate Polynomial Ring in y0, y1, y2, y3 over Rational Field
sage: p = 3*y0
sage: (p/2).parent()
Multivariate Polynomial Ring in y0, y1, y2, y3 over Rational Field
```

So p/2 is not in the fraction field of R.  This is what I would like integral() to do as well.

Thoughts?



---

archive/issue_comments_057866.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, I have changed the patch to a new one that achieves objective (c) in the previous comment.  It is also simpler and cleaner than the previous patches.  `integral` now relies on the coefficient rings to do the right thing.  They mostly do, except for polydict, whose behavior is fixed by the patch as well.",
    "created_at": "2012-03-24T23:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57866",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, I have changed the patch to a new one that achieves objective (c) in the previous comment.  It is also simpler and cleaner than the previous patches.  `integral` now relies on the coefficient rings to do the right thing.  They mostly do, except for polydict, whose behavior is fixed by the patch as well.



---

archive/issue_events_095246.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T23:23:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95246"
}
```



---

archive/issue_events_095247.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-24T23:23:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95247"
}
```



---

archive/issue_comments_057867.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAlex, I tried to apply your patch to sage-5.0.beta9 but it failed:\n\n```\n\nsage: hg_sage.import_patch(\"trac7711.patch\")\ncd \"/localdisk/tmp/sage-5.0.beta9/devel/sage\" && sage --hg import   \"/localdisk/tmp/sage-5.0.beta9/trac7711.patch\"\napplying /localdisk/tmp/sage-5.0.beta9/trac7711.patch\npatching file sage/rings/polynomial/polynomial_element.pyx\nHunk #1 FAILED at 2369\n1 out of 1 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_element.pyx.rej\nabort: patch failed to apply\n```\nFor which version is this patch?\n\nPaul",
    "created_at": "2012-03-26T07:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57867",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:25" align="right">comment:25</div>

Alex, I tried to apply your patch to sage-5.0.beta9 but it failed:

```

sage: hg_sage.import_patch("trac7711.patch")
cd "/localdisk/tmp/sage-5.0.beta9/devel/sage" && sage --hg import   "/localdisk/tmp/sage-5.0.beta9/trac7711.patch"
applying /localdisk/tmp/sage-5.0.beta9/trac7711.patch
patching file sage/rings/polynomial/polynomial_element.pyx
Hunk #1 FAILED at 2369
1 out of 1 hunks FAILED -- saving rejects to file sage/rings/polynomial/polynomial_element.pyx.rej
abort: patch failed to apply
```
For which version is this patch?

Paul



---

archive/issue_comments_057868.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n> For which version is this patch?\n\nIt's based on sage-4.8.  I have a sage-5.0.beta10 somewhere, I'll rebase it on that soon.",
    "created_at": "2012-03-26T07:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57868",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:26" align="right">comment:26</div>

> For which version is this patch?

It's based on sage-4.8.  I have a sage-5.0.beta10 somewhere, I'll rebase it on that soon.



---

archive/issue_comments_057869.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nit seems my sage-5.0.beta9 was corrupted. I'll compile sage-5.0.beta10 from source and try\nagain.\n\nPaul",
    "created_at": "2012-03-26T07:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57869",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:27" align="right">comment:27</div>

it seems my sage-5.0.beta9 was corrupted. I'll compile sage-5.0.beta10 from source and try
again.

Paul



---

archive/issue_comments_057870.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI tried on a clean sage-5.0.beta10 and the previous version of the patch did not apply correctly.  I have rebased it now and it should work.",
    "created_at": "2012-03-26T08:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57870",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:28" align="right">comment:28</div>

I tried on a clean sage-5.0.beta10 and the previous version of the patch did not apply correctly.  I have rebased it now and it should work.



---

archive/issue_comments_057871.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nreplying to comment [comment:22]: I guess we should just return `p/2` and let the coercion\nmechanism decide the corresponding parent. In such a way it will ensure that `p.integral()` and `p/2` have the same type.\n\nPaul",
    "created_at": "2012-03-26T15:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57871",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:29" align="right">comment:29</div>

replying to comment [comment:22]: I guess we should just return `p/2` and let the coercion
mechanism decide the corresponding parent. In such a way it will ensure that `p.integral()` and `p/2` have the same type.

Paul



---

archive/issue_comments_057872.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI confirm the rebased patch applies cleanly to sage-5.0.beta10.\n\nHowever there is still an issue:\n\n```\nsage: R.<x> = ZZ[]\nsage: R(0).integral().parent()\nUnivariate Polynomial Ring in x over Integer Ring\nsage: R(3).integral().parent()\nUnivariate Polynomial Ring in x over Rational Field\n```\nWhy do we get a different parent for zero?\n\nPaul",
    "created_at": "2012-03-26T16:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57872",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:30" align="right">comment:30</div>

I confirm the rebased patch applies cleanly to sage-5.0.beta10.

However there is still an issue:

```
sage: R.<x> = ZZ[]
sage: R(0).integral().parent()
Univariate Polynomial Ring in x over Integer Ring
sage: R(3).integral().parent()
Univariate Polynomial Ring in x over Rational Field
```
Why do we get a different parent for zero?

Paul



---

archive/issue_events_095248.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-26T16:00:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95248"
}
```



---

archive/issue_events_095249.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-26T16:00:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95249"
}
```



---

archive/issue_comments_057873.json:
```json
{
    "body": "Attachment: **[trac7711.patch.gz](https://github.com/sagemath/sage/files/ticket7711/trac7711.patch.gz)**",
    "created_at": "2012-03-26T21:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57873",
    "user": "https://github.com/aghitza"
}
```

Attachment: **[trac7711.patch.gz](https://github.com/sagemath/sage/files/ticket7711/trac7711.patch.gz)**



---

archive/issue_comments_057874.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAh, that's because the degree of R(0) is negative.  Sorry.  It's fixed in the new patch, and I've added `R(0).integral().parent()` to the doctests.",
    "created_at": "2012-03-26T21:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57874",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:31" align="right">comment:31</div>

Ah, that's because the degree of R(0) is negative.  Sorry.  It's fixed in the new patch, and I've added `R(0).integral().parent()` to the doctests.



---

archive/issue_events_095250.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-26T21:46:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95250"
}
```



---

archive/issue_events_095251.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-03-26T21:46:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95251"
}
```



---

archive/issue_comments_057875.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI get only one doctest failure, but it also fails with vanilla sage-5.0.beta10 and seems\nunrelated:\n\n```\nsage -t  \"devel/sage-7711/sage/misc/sagedoc.py\"             \n\n**********************************************************************\nFile \"/localdisk/tmp/sage-5.0.beta10/devel/sage-7711/sage/misc/sagedoc.py\", line 566:\n    sage: 'abvar/homology' in _search_src_or_doc('doc', 'homology', 'variety', interact=False)\nExpected:\n    True\nGot:\n    Warning, the following Sage documentation hasn't been built,\n    so documentation search results may be incomplete:\n    <BLANKLINE>\n    /localdisk/tmp/sage-5.0.beta10/devel/sage/doc/output/html/de/tutorial\n...\n```\n\nThis patch not only fixes the original issue, but improves the coherence of Sage results.\nGood job Alex!\n\nPaul",
    "created_at": "2012-03-27T11:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57875",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:32" align="right">comment:32</div>

I get only one doctest failure, but it also fails with vanilla sage-5.0.beta10 and seems
unrelated:

```
sage -t  "devel/sage-7711/sage/misc/sagedoc.py"             

**********************************************************************
File "/localdisk/tmp/sage-5.0.beta10/devel/sage-7711/sage/misc/sagedoc.py", line 566:
    sage: 'abvar/homology' in _search_src_or_doc('doc', 'homology', 'variety', interact=False)
Expected:
    True
Got:
    Warning, the following Sage documentation hasn't been built,
    so documentation search results may be incomplete:
    <BLANKLINE>
    /localdisk/tmp/sage-5.0.beta10/devel/sage/doc/output/html/de/tutorial
...
```

This patch not only fixes the original issue, but improves the coherence of Sage results.
Good job Alex!

Paul



---

archive/issue_events_095252.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-27T11:41:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95252"
}
```



---

archive/issue_events_095253.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-03-27T11:41:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95253"
}
```



---

archive/issue_events_095254.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T15:23:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95254"
}
```



---

archive/issue_events_095255.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T15:23:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7711#event-95255"
}
```



---

archive/issue_comments_057876.json:
```json
{
    "body": "Merged: **sage-5.0.beta12**",
    "created_at": "2012-04-02T15:23:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7711#issuecomment-57876",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta12**
