# Issue 7921: Categories for extension types via __getattr___

archive/issues_007921.json:
```json
{
    "assignees": [],
    "body": "With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular\ngeneric tests (see TestSuite(...).run()):\n\n```\nsage: ZZ.category()\nCategory of commutative rings\nsage: TestSuite(ZZ).run(verbose = True)\nrunning ._test_additive_associativity() . . . pass\nrunning ._test_an_element() . . . pass\nrunning ._test_associativity() . . . pass\nrunning ._test_element_pickling() . . . pass\nrunning ._test_not_implemented_methods() . . . pass\nrunning ._test_one() . . . pass\nrunning ._test_pickling() . . . pass\nrunning ._test_prod() . . . pass\nrunning ._test_some_elements() . . . pass\nrunning ._test_zero() . . . pass\n```\n\nIt is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946\n\nSee patch description for details.\n\nPatch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n\nAssignee: **@nthiery**\n\nCC:  @sagetrac-sage-combinat @mwhansen @robertwb @roed314\n\nReviewer: **Robert Bradshaw**\n\nAuthor: **Nicolas M. Thi\u00e9ry**\n\nMerged: **sage-4.3.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7921_\n\n",
    "closed_at": "2010-01-22T22:57:33Z",
    "created_at": "2010-01-13T16:05:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20categories",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Categories for extension types via __getattr___",
    "type": "issue",
    "updated_at": "2014-05-10T23:07:26Z",
    "url": "https://github.com/sagemath/sage/issues/7921",
    "user": "https://github.com/nthiery"
}
```
With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular
generic tests (see TestSuite(...).run()):

```
sage: ZZ.category()
Category of commutative rings
sage: TestSuite(ZZ).run(verbose = True)
running ._test_additive_associativity() . . . pass
running ._test_an_element() . . . pass
running ._test_associativity() . . . pass
running ._test_element_pickling() . . . pass
running ._test_not_implemented_methods() . . . pass
running ._test_one() . . . pass
running ._test_pickling() . . . pass
running ._test_prod() . . . pass
running ._test_some_elements() . . . pass
running ._test_zero() . . . pass
```

It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946

See patch description for details.

Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch

Assignee: **@nthiery**

CC:  @sagetrac-sage-combinat @mwhansen @robertwb @roed314

Reviewer: **Robert Bradshaw**

Author: **Nicolas M. Thi√©ry**

Merged: **sage-4.3.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/7921_





---

archive/issue_events_089443.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-13T16:05:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20categories",
    "label_color": "0000ff",
    "label_name": "component: categories",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89443"
}
```



---

archive/issue_events_089444.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-13T16:05:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89444"
}
```



---

archive/issue_events_089445.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-13T16:05:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89445"
}
```



---

archive/issue_comments_062035.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,23 @@\n-With this patch, all parents and elements can inherit code from categories. This is implemented via __getattr__.\n+With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular\n+generic tests (see TestSuite(...).run()):\n+\n+```\n+sage: ZZ.category()\n+Category of commutative rings\n+sage: TestSuite(ZZ).run(verbose = True)\n+running ._test_additive_associativity() . . . pass\n+running ._test_an_element() . . . pass\n+running ._test_associativity() . . . pass\n+running ._test_element_pickling() . . . pass\n+running ._test_not_implemented_methods() . . . pass\n+running ._test_one() . . . pass\n+running ._test_pickling() . . . pass\n+running ._test_prod() . . . pass\n+running ._test_some_elements() . . . pass\n+running ._test_zero() . . . pass\n+```\n+\n+It is to be expected that this will catch bugs in many places in the library.\n+\n+The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n+\n``````\n",
    "created_at": "2010-01-13T16:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62035",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,23 @@
-With this patch, all parents and elements can inherit code from categories. This is implemented via __getattr__.
+With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular
+generic tests (see TestSuite(...).run()):
+
+```
+sage: ZZ.category()
+Category of commutative rings
+sage: TestSuite(ZZ).run(verbose = True)
+running ._test_additive_associativity() . . . pass
+running ._test_an_element() . . . pass
+running ._test_associativity() . . . pass
+running ._test_element_pickling() . . . pass
+running ._test_not_implemented_methods() . . . pass
+running ._test_one() . . . pass
+running ._test_pickling() . . . pass
+running ._test_prod() . . . pass
+running ._test_some_elements() . . . pass
+running ._test_zero() . . . pass
+```
+
+It is to be expected that this will catch bugs in many places in the library.
+
+The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
+
``````




---

archive/issue_comments_062036.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAll tests seem to pass with it on 4.3; I still need to double check a couple things. It does change things in many places; so the best would be to integrate it in the early phase of 4.3.2 before it rots away.\n\nEarly feedback welcome!",
    "created_at": "2010-01-13T23:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62036",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:2" align="right">Comment 2</div>

All tests seem to pass with it on 4.3; I still need to double check a couple things. It does change things in many places; so the best would be to integrate it in the early phase of 4.3.2 before it rots away.

Early feedback welcome!



---

archive/issue_comments_062037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,3 +21,5 @@\n \n The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n \n+Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n+\n``````\n",
    "created_at": "2010-01-13T23:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62037",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,3 +21,5 @@
 
 The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
 
+Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
+
``````




---

archive/issue_events_089446.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-13T23:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89446"
}
```



---

archive/issue_events_089447.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-14T23:09:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89447"
}
```



---

archive/issue_events_089448.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-14T23:09:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89448"
}
```



---

archive/issue_comments_062038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n \n It is to be expected that this will catch bugs in many places in the library.\n \n-The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n+See patch description for details\n \n-Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n+Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n \n``````\n",
    "created_at": "2010-01-14T23:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62038",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 
 It is to be expected that this will catch bugs in many places in the library.
 
-The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
+See patch description for details
 
-Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
+Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
 
``````




---

archive/issue_comments_062039.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,9 +17,8 @@\n running ._test_zero() . . . pass\n ```\n \n-It is to be expected that this will catch bugs in many places in the library.\n+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.\n \n-See patch description for details\n+See patch description for details.\n \n-Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n-\n+Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n``````\n",
    "created_at": "2010-01-14T23:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62039",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,9 +17,8 @@
 running ._test_zero() . . . pass
 ```
 
-It is to be expected that this will catch bugs in many places in the library.
+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.
 
-See patch description for details
+See patch description for details.
 
-Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
-
+Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
``````




---

archive/issue_comments_062040.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThe patch passes all tests with sage 4.3 + sage-combinat patches merged in 4.3.1 on my machine. I'll run sage -t -long tonight and report.",
    "created_at": "2010-01-14T23:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62040",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:4" align="right">Comment 4</div>

The patch passes all tests with sage 4.3 + sage-combinat patches merged in 4.3.1 on my machine. I'll run sage -t -long tonight and report.



---

archive/issue_comments_062041.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nHi Robert; I improved a bit TestSuite to catch more. Should I add a second patch to this one,\nor make it a separate ticket?",
    "created_at": "2010-01-16T12:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62041",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:5" align="right">Comment 5</div>

Hi Robert; I improved a bit TestSuite to catch more. Should I add a second patch to this one,
or make it a separate ticket?



---

archive/issue_comments_062042.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n running ._test_zero() . . . pass\n ```\n \n-It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.\n+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946\n \n See patch description for details.\n \n``````\n",
    "created_at": "2010-01-16T12:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62042",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 running ._test_zero() . . . pass
 ```
 
-It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.
+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946
 
 See patch description for details.
 
``````




---

archive/issue_comments_062043.json:
```json
{
    "body": "Reviewer: **Robert Bradshaw**",
    "created_at": "2010-01-16T12:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62043",
    "user": "https://github.com/nthiery"
}
```

Reviewer: **Robert Bradshaw**



---

archive/issue_comments_062044.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nRobert: please let me know if I should open a separate ticket for the second patch. Florent can probably review it if this can save you some time.",
    "created_at": "2010-01-17T20:52:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62044",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:6" align="right">Comment 6</div>

Robert: please let me know if I should open a separate ticket for the second patch. Florent can probably review it if this can save you some time.



---

archive/issue_comments_062045.json:
```json
{
    "body": "Attachment: **[categories_testsuite-nt.patch.gz](https://github.com/sagemath/sage/files/ticket7921/categories_testsuite-nt.patch.gz)**\n\nPatch 2: stronger category tests",
    "created_at": "2010-01-17T20:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62045",
    "user": "https://github.com/nthiery"
}
```

Attachment: **[categories_testsuite-nt.patch.gz](https://github.com/sagemath/sage/files/ticket7921/categories_testsuite-nt.patch.gz)**

Patch 2: stronger category tests



---

archive/issue_comments_062046.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nThe attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\nsage/groups/group.pyx\n\n```\n    def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n```\n\nGroups are not yet converted over to the new coercion model, and are a mess in general. \n\nIn sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. \n\nsage/modules/free_module.py - It'd be good to test the category of non-vector space.\n\nCould you explain the changes to sage/structure/sage_object.pyx?",
    "created_at": "2010-01-19T14:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62046",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:7" align="right">Comment 7</div>

The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

sage/groups/group.pyx

```
    def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
```

Groups are not yet converted over to the new coercion model, and are a mess in general. 

In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. 

sage/modules/free_module.py - It'd be good to test the category of non-vector space.

Could you explain the changes to sage/structure/sage_object.pyx?



---

archive/issue_events_089449.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T14:42:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89449"
}
```



---

archive/issue_events_089450.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T14:42:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89450"
}
```



---

archive/issue_comments_062047.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI didn't look much at the second patch, but this should almost certainly be a second ticket.",
    "created_at": "2010-01-19T14:49:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62047",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:8" align="right">Comment 8</div>

I didn't look much at the second patch, but this should almost certainly be a second ticket.



---

archive/issue_comments_062048.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@robertwb](#comment%3A8):\n> I didn't look much at the second patch, but this should almost certainly be a second ticket. \n\nOk, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.",
    "created_at": "2010-01-19T18:11:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62048",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@robertwb](#comment%3A8):
> I didn't look much at the second patch, but this should almost certainly be a second ticket. 

Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.



---

archive/issue_events_089451.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:11:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89451"
}
```



---

archive/issue_events_089452.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:11:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89452"
}
```



---

archive/issue_comments_062049.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@robertwb](#comment%3A7):\n> The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\nWell, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.\n\n> sage/groups/group.pyx\n> \n> ```\n>     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n> ```\n> \n> Groups are not yet converted over to the new coercion model, and are a mess in general.\n\nOk. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.\n\n> In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. \n\nOops, fixed.\n\n> sage/modules/free_module.py - It'd be good to test the category of non-vector space.\n\nDone.\n\n> Could you explain the changes to sage/structure/sage_object.pyx?\n\nI improved the description on top of the patch, including a comment about this.",
    "created_at": "2010-01-19T18:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62049",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@robertwb](#comment%3A7):
> The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.

> sage/groups/group.pyx
> 
> ```
>     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
> ```
> 
> Groups are not yet converted over to the new coercion model, and are a mess in general.

Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.

> In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. 

Oops, fixed.

> sage/modules/free_module.py - It'd be good to test the category of non-vector space.

Done.

> Could you explain the changes to sage/structure/sage_object.pyx?

I improved the description on top of the patch, including a comment about this.



---

archive/issue_events_089453.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:17:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89453"
}
```



---

archive/issue_comments_062050.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@nthiery](#comment%3A9):\n> Replying to [@robertwb](#comment%3A8):\n> > I didn't look much at the second patch, but this should almost certainly be a second ticket. \n\n> \n> Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.\n\nThis is now #8001 (darn, missed, that was sooo close from #8000!)",
    "created_at": "2010-01-19T18:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62050",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@nthiery](#comment%3A9):
> Replying to [@robertwb](#comment%3A8):
> > I didn't look much at the second patch, but this should almost certainly be a second ticket. 

> 
> Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.

This is now #8001 (darn, missed, that was sooo close from #8000!)



---

archive/issue_events_089454.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T20:33:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89454"
}
```



---

archive/issue_events_089455.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T20:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89455"
}
```



---

archive/issue_comments_062051.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@nthiery](#comment%3A10):\n> Replying to [@robertwb](#comment%3A7):\n> > The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\n> \n> Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.\n\nOK. \n\n> > sage/groups/group.pyx\n> > \n> > ```\n> >     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n> > ```\n> > \n> > Groups are not yet converted over to the new coercion model, and are a mess in general.\n\n> \n> Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? \n\nEventually, for sure. \n\n> Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.\n\nNo, comments like this are good. I was just somewhat answering your question. \n\n> > Could you explain the changes to sage/structure/sage_object.pyx?\n\n> \n> I improved the description on top of the patch, including a comment about this.\n\nThanks. Look forward to being able to do stuff like this. On a somewhat related note, you might be interested in the binop decorator at #383.",
    "created_at": "2010-01-19T20:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62051",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@nthiery](#comment%3A10):
> Replying to [@robertwb](#comment%3A7):
> > The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

> 
> Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.

OK. 

> > sage/groups/group.pyx
> > 
> > ```
> >     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
> > ```
> > 
> > Groups are not yet converted over to the new coercion model, and are a mess in general.

> 
> Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? 

Eventually, for sure. 

> Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.

No, comments like this are good. I was just somewhat answering your question. 

> > Could you explain the changes to sage/structure/sage_object.pyx?

> 
> I improved the description on top of the patch, including a comment about this.

Thanks. Look forward to being able to do stuff like this. On a somewhat related note, you might be interested in the binop decorator at #383.



---

archive/issue_comments_062052.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThanks Robert for the quick review! I am looking forward feedback from practical uses :-)\n\nThanks also for the pointer to #383",
    "created_at": "2010-01-19T23:02:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62052",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:13" align="right">Comment 13</div>

Thanks Robert for the quick review! I am looking forward feedback from practical uses :-)

Thanks also for the pointer to #383



---

archive/issue_comments_062053.json:
```json
{
    "body": "Rebased and updated one doctest for 4.3.1 + micro fix in the primer. Apply only this one.",
    "created_at": "2010-01-22T21:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62053",
    "user": "https://github.com/nthiery"
}
```

Rebased and updated one doctest for 4.3.1 + micro fix in the primer. Apply only this one.



---

archive/issue_events_089456.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-22T22:57:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89456"
}
```



---

archive/issue_events_089457.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-22T22:57:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-89457"
}
```



---

archive/issue_comments_062054.json:
```json
{
    "body": "Merged: **sage-4.3.2.alpha0**",
    "created_at": "2010-01-22T22:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62054",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.2.alpha0**



---

archive/issue_comments_062055.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nAttachment: **[trac_7921-categories_for_extension_types-nt.patch.gz](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch.gz)**\n\nMerged [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch.gz).",
    "created_at": "2010-01-22T22:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62055",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:14" align="right">Comment 14</div>

Attachment: **[trac_7921-categories_for_extension_types-nt.patch.gz](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch.gz)**

Merged [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch.gz).



---

archive/issue_comments_062056.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI have a question regarding this old ticket. The following fails:\n\n```\nsage: a = ModularForms(11,4).an_element()\nsage: a._test_category()\n```\nThe reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance\n\n```\nclass HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):\n```\nI get a\n\n```\nmetaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base\n```\n\nAnyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes). The methods from the element_class are available anyway (just like for extension classes). So is it safe to remove this check from `_test_category`? I.e. should we change\n\n```\nif not is_extension_type(self.__class__):\n    # For usual Python classes, that should be done with\n    # standard inheritance\n    tester.assert_(isinstance(self, self.parent().category().element_class))\nelse:\n    # For extension types we just check that inheritance\n    # occurs on a dummy attribute of Sets().ElementMethods\n    tester.assert_(hasattr(self, \"_dummy_attribute\"))\n```\ninto\n\n```\n    tester.assert_(hasattr(self, \"_dummy_attribute\"))\n```",
    "created_at": "2014-05-10T19:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62056",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:15" align="right">Comment 15</div>

I have a question regarding this old ticket. The following fails:

```
sage: a = ModularForms(11,4).an_element()
sage: a._test_category()
```
The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance

```
class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):
```
I get a

```
metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base
```

Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes). The methods from the element_class are available anyway (just like for extension classes). So is it safe to remove this check from `_test_category`? I.e. should we change

```
if not is_extension_type(self.__class__):
    # For usual Python classes, that should be done with
    # standard inheritance
    tester.assert_(isinstance(self, self.parent().category().element_class))
else:
    # For extension types we just check that inheritance
    # occurs on a dummy attribute of Sets().ElementMethods
    tester.assert_(hasattr(self, "_dummy_attribute"))
```
into

```
    tester.assert_(hasattr(self, "_dummy_attribute"))
```



---

archive/issue_comments_062057.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@saraedum](#comment%3A15):\n> I have a question regarding this old ticket. The following fails:\n> \n> ```\n> sage: a = ModularForms(11,4).an_element()\n> sage: a._test_category()\n> ```\n> The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance\n> \n> ```\n> class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):\n> ```\n> I get a\n> \n> ```\n> metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base\n> ```\n\nIf it's not an extension type, it really should inherit `a.parent().category().element_class`.\nExcept in complicated cases (e.g. parents whose elements can belong to\nseveral classes), this is taken care of automatically if a category is specified to\n`Parent.__init__`; otherwise one needs to use manually\n`_make_element_class`. See sage.categories.primer (better with #10963 applied) and the\ndocumentation of Category for details.\n\nMost likely the issue here is that the category is not specified\nproperly.\n\n> Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes).\n\nMost of my bread and butter element classes are *not* extension\nclasses :-) Just for one example:\n\n```\nsage: x = CombinatorialFreeModule(QQ, [1,2,3]).an_element()\nsage: x.__class__\n<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>\nsage: x.__class__.__bases__\n(sage.combinat.free_module.CombinatorialFreeModuleElement,\n sage.categories.vector_spaces.VectorSpaces.WithBasis.element_class)\n```\n\n> So is it safe to remove this check from `_test_category`?\n\nPlease don't: so far failures here have always pointed to actual bugs.\n\nCheers,\n                            Nicolas",
    "created_at": "2014-05-10T22:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62057",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@saraedum](#comment%3A15):
> I have a question regarding this old ticket. The following fails:
> 
> ```
> sage: a = ModularForms(11,4).an_element()
> sage: a._test_category()
> ```
> The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance
> 
> ```
> class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):
> ```
> I get a
> 
> ```
> metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base
> ```

If it's not an extension type, it really should inherit `a.parent().category().element_class`.
Except in complicated cases (e.g. parents whose elements can belong to
several classes), this is taken care of automatically if a category is specified to
`Parent.__init__`; otherwise one needs to use manually
`_make_element_class`. See sage.categories.primer (better with #10963 applied) and the
documentation of Category for details.

Most likely the issue here is that the category is not specified
properly.

> Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes).

Most of my bread and butter element classes are *not* extension
classes :-) Just for one example:

```
sage: x = CombinatorialFreeModule(QQ, [1,2,3]).an_element()
sage: x.__class__
<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>
sage: x.__class__.__bases__
(sage.combinat.free_module.CombinatorialFreeModuleElement,
 sage.categories.vector_spaces.VectorSpaces.WithBasis.element_class)
```

> So is it safe to remove this check from `_test_category`?

Please don't: so far failures here have always pointed to actual bugs.

Cheers,
                            Nicolas



---

archive/issue_comments_062058.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThanks for your explanation.",
    "created_at": "2014-05-10T23:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62058",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:17" align="right">Comment 17</div>

Thanks for your explanation.
