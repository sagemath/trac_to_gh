# Issue 7921: Categories for extension types via __getattr___

archive/issues_007921.json:
```json
{
    "body": "With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular\ngeneric tests (see TestSuite(...).run()):\n\n```\nsage: ZZ.category()\nCategory of commutative rings\nsage: TestSuite(ZZ).run(verbose = True)\nrunning ._test_additive_associativity() . . . pass\nrunning ._test_an_element() . . . pass\nrunning ._test_associativity() . . . pass\nrunning ._test_element_pickling() . . . pass\nrunning ._test_not_implemented_methods() . . . pass\nrunning ._test_one() . . . pass\nrunning ._test_pickling() . . . pass\nrunning ._test_prod() . . . pass\nrunning ._test_some_elements() . . . pass\nrunning ._test_zero() . . . pass\n```\n\nIt is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946\n\nSee patch description for details.\n\nPatch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n\n**Assignee:** @nthiery\n\n**CC:**  sage-combinat @mwhansen @robertwb @roed314\n\n**Reviewer:** Robert Bradshaw\n\n**Author:** Nicolas M. Thi\u00e9ry\n\n**Merged:** sage-4.3.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/7921\n\n",
    "closed_at": "2010-01-22T22:57:33Z",
    "created_at": "2010-01-13T16:05:49Z",
    "labels": [
        "component: categories",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "title": "Categories for extension types via __getattr___",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7921",
    "user": "https://github.com/nthiery"
}
```
With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular
generic tests (see TestSuite(...).run()):

```
sage: ZZ.category()
Category of commutative rings
sage: TestSuite(ZZ).run(verbose = True)
running ._test_additive_associativity() . . . pass
running ._test_an_element() . . . pass
running ._test_associativity() . . . pass
running ._test_element_pickling() . . . pass
running ._test_not_implemented_methods() . . . pass
running ._test_one() . . . pass
running ._test_pickling() . . . pass
running ._test_prod() . . . pass
running ._test_some_elements() . . . pass
running ._test_zero() . . . pass
```

It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946

See patch description for details.

Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch

**Assignee:** @nthiery

**CC:**  sage-combinat @mwhansen @robertwb @roed314

**Reviewer:** Robert Bradshaw

**Author:** Nicolas M. Thi√©ry

**Merged:** sage-4.3.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/7921





---

archive/issue_comments_062023.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,23 @@\n-With this patch, all parents and elements can inherit code from categories. This is implemented via __getattr__.\n+With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular\n+generic tests (see TestSuite(...).run()):\n+\n+```\n+sage: ZZ.category()\n+Category of commutative rings\n+sage: TestSuite(ZZ).run(verbose = True)\n+running ._test_additive_associativity() . . . pass\n+running ._test_an_element() . . . pass\n+running ._test_associativity() . . . pass\n+running ._test_element_pickling() . . . pass\n+running ._test_not_implemented_methods() . . . pass\n+running ._test_one() . . . pass\n+running ._test_pickling() . . . pass\n+running ._test_prod() . . . pass\n+running ._test_some_elements() . . . pass\n+running ._test_zero() . . . pass\n+```\n+\n+It is to be expected that this will catch bugs in many places in the library.\n+\n+The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n+\n``````\n",
    "created_at": "2010-01-13T16:11:29Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62023",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,23 @@
-With this patch, all parents and elements can inherit code from categories. This is implemented via __getattr__.
+With this patch, all parents and elements can inherit code from categories, even extension types. This includes in particular
+generic tests (see TestSuite(...).run()):
+
+```
+sage: ZZ.category()
+Category of commutative rings
+sage: TestSuite(ZZ).run(verbose = True)
+running ._test_additive_associativity() . . . pass
+running ._test_an_element() . . . pass
+running ._test_associativity() . . . pass
+running ._test_element_pickling() . . . pass
+running ._test_not_implemented_methods() . . . pass
+running ._test_one() . . . pass
+running ._test_pickling() . . . pass
+running ._test_prod() . . . pass
+running ._test_some_elements() . . . pass
+running ._test_zero() . . . pass
+```
+
+It is to be expected that this will catch bugs in many places in the library.
+
+The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
+
``````




---

archive/issue_comments_062024.json:
```json
{
    "body": "<a id='comment:2'></a>\nAll tests seem to pass with it on 4.3; I still need to double check a couple things. It does change things in many places; so the best would be to integrate it in the early phase of 4.3.2 before it rots away.\n\nEarly feedback welcome!",
    "created_at": "2010-01-13T23:12:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62024",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>
All tests seem to pass with it on 4.3; I still need to double check a couple things. It does change things in many places; so the best would be to integrate it in the early phase of 4.3.2 before it rots away.

Early feedback welcome!



---

archive/issue_comments_062025.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -21,3 +21,5 @@\n \n The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n \n+Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n+\n``````\n",
    "created_at": "2010-01-13T23:12:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62025",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -21,3 +21,5 @@
 
 The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
 
+Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
+
``````




---

archive/issue_events_054949.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-13T23:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54949"
}
```



---

archive/issue_events_054950.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-14T23:09:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54950"
}
```



---

archive/issue_events_054951.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-14T23:09:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54951"
}
```



---

archive/issue_comments_062026.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n \n It is to be expected that this will catch bugs in many places in the library.\n \n-The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.\n+See patch description for details\n \n-Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n+Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n \n``````\n",
    "created_at": "2010-01-14T23:09:02Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62026",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
 
 It is to be expected that this will catch bugs in many places in the library.
 
-The implementation uses `__getattr__` and has some limitations (e.g. handling of lazy attributes), though.
+See patch description for details
 
-Patch on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
+Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
 
``````




---

archive/issue_comments_062027.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,9 +17,8 @@\n running ._test_zero() . . . pass\n ```\n \n-It is to be expected that this will catch bugs in many places in the library.\n+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.\n \n-See patch description for details\n+See patch description for details.\n \n-Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n-\n+Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch\n``````\n",
    "created_at": "2010-01-14T23:11:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62027",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,9 +17,8 @@
 running ._test_zero() . . . pass
 ```
 
-It is to be expected that this will catch bugs in many places in the library.
+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.
 
-See patch description for details
+See patch description for details.
 
-Patch also available on: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
-
+Patch also available on the sage-combinat server, with a +category guard: http://combinat.sagemath.org/hgwebdir.cgi/patches/file/tip/trac_7921-categories_for_extension_types-nt.patch
``````




---

archive/issue_comments_062028.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe patch passes all tests with sage 4.3 + sage-combinat patches merged in 4.3.1 on my machine. I'll run sage -t -long tonight and report.",
    "created_at": "2010-01-14T23:11:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62028",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
The patch passes all tests with sage 4.3 + sage-combinat patches merged in 4.3.1 on my machine. I'll run sage -t -long tonight and report.



---

archive/issue_comments_062029.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Robert; I improved a bit TestSuite to catch more. Should I add a second patch to this one,\nor make it a separate ticket?",
    "created_at": "2010-01-16T12:40:43Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62029",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>
Hi Robert; I improved a bit TestSuite to catch more. Should I add a second patch to this one,
or make it a separate ticket?



---

archive/issue_comments_062030.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n running ._test_zero() . . . pass\n ```\n \n-It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.\n+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946\n \n See patch description for details.\n \n``````\n",
    "created_at": "2010-01-16T12:40:43Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62030",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 running ._test_zero() . . . pass
 ```
 
-It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929.
+It is to be expected that this will catch bugs in many places in the library. To start with, see #7922, #7929, #7945, #7946
 
 See patch description for details.
 
``````




---

archive/issue_comments_062031.json:
```json
{
    "body": "**Reviewer:** Robert Bradshaw",
    "created_at": "2010-01-16T12:40:43Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62031",
    "user": "https://github.com/nthiery"
}
```

**Reviewer:** Robert Bradshaw



---

archive/issue_comments_062032.json:
```json
{
    "body": "<a id='comment:6'></a>\nRobert: please let me know if I should open a separate ticket for the second patch. Florent can probably review it if this can save you some time.",
    "created_at": "2010-01-17T20:52:35Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62032",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>
Robert: please let me know if I should open a separate ticket for the second patch. Florent can probably review it if this can save you some time.



---

archive/attachments_010067.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "categories_testsuite-nt.patch",
    "asset_url": "tarball://root/attachments/ticket7921/categories_testsuite-nt.patch",
    "created_at": "2010-01-17T20:59:52Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7921/categories_testsuite-nt.patch",
    "user": "https://github.com/nthiery"
}
```



---

archive/issue_comments_062033.json:
```json
{
    "body": "**Attachment:** [categories_testsuite-nt.patch](https://github.com/sagemath/sage/files/ticket7921/categories_testsuite-nt.patch)\n\nPatch 2: stronger category tests",
    "created_at": "2010-01-17T20:59:52Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62033",
    "user": "https://github.com/nthiery"
}
```

**Attachment:** [categories_testsuite-nt.patch](https://github.com/sagemath/sage/files/ticket7921/categories_testsuite-nt.patch)

Patch 2: stronger category tests



---

archive/issue_comments_062034.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\nsage/groups/group.pyx\n\n```\n    def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n```\n\nGroups are not yet converted over to the new coercion model, and are a mess in general. \n\nIn sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. \n\nsage/modules/free_module.py - It'd be good to test the category of non-vector space.\n\nCould you explain the changes to sage/structure/sage_object.pyx?",
    "created_at": "2010-01-19T14:42:52Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62034",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

sage/groups/group.pyx

```
    def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
```

Groups are not yet converted over to the new coercion model, and are a mess in general. 

In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. 

sage/modules/free_module.py - It'd be good to test the category of non-vector space.

Could you explain the changes to sage/structure/sage_object.pyx?



---

archive/issue_events_054952.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T14:42:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54952"
}
```



---

archive/issue_events_054953.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T14:42:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54953"
}
```



---

archive/issue_comments_062035.json:
```json
{
    "body": "<a id='comment:8'></a>\nI didn't look much at the second patch, but this should almost certainly be a second ticket.",
    "created_at": "2010-01-19T14:49:43Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62035",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:8'></a>
I didn't look much at the second patch, but this should almost certainly be a second ticket.



---

archive/issue_comments_062036.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [robertwb](#comment%3A8):\n> I didn't look much at the second patch, but this should almost certainly be a second ticket. \n\nOk, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.",
    "created_at": "2010-01-19T18:11:23Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62036",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>
Replying to [robertwb](#comment%3A8):
> I didn't look much at the second patch, but this should almost certainly be a second ticket. 

Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.



---

archive/issue_events_054954.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:11:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54954"
}
```



---

archive/issue_events_054955.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:11:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54955"
}
```



---

archive/issue_comments_062037.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [robertwb](#comment%3A7):\n> The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\nWell, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.\n\n> sage/groups/group.pyx\n> \n> ```\n>     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n> ```\n> \n> Groups are not yet converted over to the new coercion model, and are a mess in general.\n\nOk. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.\n\n> In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. \n\nOops, fixed.\n\n> sage/modules/free_module.py - It'd be good to test the category of non-vector space.\n\nDone.\n\n> Could you explain the changes to sage/structure/sage_object.pyx?\n\nI improved the description on top of the patch, including a comment about this.",
    "created_at": "2010-01-19T18:17:30Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62037",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>
Replying to [robertwb](#comment%3A7):
> The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.

> sage/groups/group.pyx
> 
> ```
>     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
> ```
> 
> Groups are not yet converted over to the new coercion model, and are a mess in general.

Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.

> In sage/modular/abvar/abvar.py, you removed the method but kept the docstring floating there. Those tests should be kept, but probably not put there. 

Oops, fixed.

> sage/modules/free_module.py - It'd be good to test the category of non-vector space.

Done.

> Could you explain the changes to sage/structure/sage_object.pyx?

I improved the description on top of the patch, including a comment about this.



---

archive/issue_events_054956.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2010-01-19T18:17:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "milestone": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54956"
}
```



---

archive/issue_comments_062038.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [nthiery](#comment%3A9):\n> Replying to [robertwb](#comment%3A8):\n> > I didn't look much at the second patch, but this should almost certainly be a second ticket. \n\n> \n> Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.\n\nThis is now #8001 (darn, missed, that was sooo close from #8000!)",
    "created_at": "2010-01-19T18:30:51Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62038",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'></a>
Replying to [nthiery](#comment%3A9):
> Replying to [robertwb](#comment%3A8):
> > I didn't look much at the second patch, but this should almost certainly be a second ticket. 

> 
> Ok, will do. Florent volunteered to review it, since it's mostly about testsuites and categories.

This is now #8001 (darn, missed, that was sooo close from #8000!)



---

archive/issue_events_054957.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T20:33:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54957"
}
```



---

archive/issue_events_054958.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2010-01-19T20:33:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54958"
}
```



---

archive/issue_comments_062039.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [nthiery](#comment%3A10):\n> Replying to [robertwb](#comment%3A7):\n> > The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. \n\n> \n> Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.\n\nOK. \n\n> > sage/groups/group.pyx\n> > \n> > ```\n> >     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? \n> > ```\n> > \n> > Groups are not yet converted over to the new coercion model, and are a mess in general.\n\n> \n> Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? \n\nEventually, for sure. \n\n> Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.\n\nNo, comments like this are good. I was just somewhat answering your question. \n\n> > Could you explain the changes to sage/structure/sage_object.pyx?\n\n> \n> I improved the description on top of the patch, including a comment about this.\n\nThanks. Look forward to being able to do stuff like this. On a somewhat related note, you might be interested in the binop decorator at #383.",
    "created_at": "2010-01-19T20:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62039",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:12'></a>
Replying to [nthiery](#comment%3A10):
> Replying to [robertwb](#comment%3A7):
> > The attribute lookup code looks good. Most of the other changes are minor, though changing loads/dumps to running tests is an independent change is seems. 

> 
> Well, I actually only added 2/3 of them, mostly as an attempt to catch possible introduced issues. The others were already there, and needed to be updated due to all the new (often failing) tests coming from categories.

OK. 

> > sage/groups/group.pyx
> > 
> > ```
> >     def __call__(self, x): # NT: doesn't this get in the way of the coercion mechanism? 
> > ```
> > 
> > Groups are not yet converted over to the new coercion model, and are a mess in general.

> 
> Ok. Shouldn't this def be removed, so as not to prevent groups inheriting from Group to progressively get converted to the coercion model? 

Eventually, for sure. 

> Sure, that should be a separate patch. As for the comment above: I just can't prevent myself from adding comments in the code when I stumble on strange stuff. I can remove it if you prefer.

No, comments like this are good. I was just somewhat answering your question. 

> > Could you explain the changes to sage/structure/sage_object.pyx?

> 
> I improved the description on top of the patch, including a comment about this.

Thanks. Look forward to being able to do stuff like this. On a somewhat related note, you might be interested in the binop decorator at #383.



---

archive/issue_comments_062040.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks Robert for the quick review! I am looking forward feedback from practical uses :-)\n\nThanks also for the pointer to #383",
    "created_at": "2010-01-19T23:02:07Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62040",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>
Thanks Robert for the quick review! I am looking forward feedback from practical uses :-)

Thanks also for the pointer to #383



---

archive/issue_comments_062041.json:
```json
{
    "body": "Rebased and updated one doctest for 4.3.1 + micro fix in the primer. Apply only this one.",
    "created_at": "2010-01-22T21:53:54Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62041",
    "user": "https://github.com/nthiery"
}
```

Rebased and updated one doctest for 4.3.1 + micro fix in the primer. Apply only this one.



---

archive/issue_events_054959.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-01-22T22:57:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54959"
}
```



---

archive/issue_events_054960.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-01-22T22:57:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7921#event-54960"
}
```



---

archive/issue_comments_062042.json:
```json
{
    "body": "**Merged:** sage-4.3.2.alpha0",
    "created_at": "2010-01-22T22:57:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62042",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

**Merged:** sage-4.3.2.alpha0



---

archive/attachments_010068.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7921-categories_for_extension_types-nt.patch",
    "asset_url": "tarball://root/attachments/ticket7921/trac_7921-categories_for_extension_types-nt.patch",
    "created_at": "2010-01-22T22:57:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```



---

archive/issue_comments_062043.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Attachment:** [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch)\n\nMerged [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch).",
    "created_at": "2010-01-22T22:57:33Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62043",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:14'></a>
**Attachment:** [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch)

Merged [trac_7921-categories_for_extension_types-nt.patch](https://github.com/sagemath/sage/files/ticket7921/trac_7921-categories_for_extension_types-nt.patch).



---

archive/issue_comments_062044.json:
```json
{
    "body": "<a id='comment:15'></a>\nI have a question regarding this old ticket. The following fails:\n\n```\nsage: a = ModularForms(11,4).an_element()\nsage: a._test_category()\n```\nThe reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance\n\n```\nclass HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):\n```\nI get a\n\n```\nmetaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base\n```\n\nAnyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes). The methods from the element_class are available anyway (just like for extension classes). So is it safe to remove this check from `_test_category`? I.e. should we change\n\n```\nif not is_extension_type(self.__class__):\n    # For usual Python classes, that should be done with\n    # standard inheritance\n    tester.assert_(isinstance(self, self.parent().category().element_class))\nelse:\n    # For extension types we just check that inheritance\n    # occurs on a dummy attribute of Sets().ElementMethods\n    tester.assert_(hasattr(self, \"_dummy_attribute\"))\n```\ninto\n\n```\n    tester.assert_(hasattr(self, \"_dummy_attribute\"))\n```",
    "created_at": "2014-05-10T19:15:06Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62044",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>
I have a question regarding this old ticket. The following fails:

```
sage: a = ModularForms(11,4).an_element()
sage: a._test_category()
```
The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance

```
class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):
```
I get a

```
metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base
```

Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes). The methods from the element_class are available anyway (just like for extension classes). So is it safe to remove this check from `_test_category`? I.e. should we change

```
if not is_extension_type(self.__class__):
    # For usual Python classes, that should be done with
    # standard inheritance
    tester.assert_(isinstance(self, self.parent().category().element_class))
else:
    # For extension types we just check that inheritance
    # occurs on a dummy attribute of Sets().ElementMethods
    tester.assert_(hasattr(self, "_dummy_attribute"))
```
into

```
    tester.assert_(hasattr(self, "_dummy_attribute"))
```



---

archive/issue_comments_062045.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [saraedum](#comment%3A15):\n> I have a question regarding this old ticket. The following fails:\n> \n> ```\n> sage: a = ModularForms(11,4).an_element()\n> sage: a._test_category()\n> ```\n> The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance\n> \n> ```\n> class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):\n> ```\n> I get a\n> \n> ```\n> metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base\n> ```\n\nIf it's not an extension type, it really should inherit `a.parent().category().element_class`.\nExcept in complicated cases (e.g. parents whose elements can belong to\nseveral classes), this is taken care of automatically if a category is specified to\n`Parent.__init__`; otherwise one needs to use manually\n`_make_element_class`. See sage.categories.primer (better with #10963 applied) and the\ndocumentation of Category for details.\n\nMost likely the issue here is that the category is not specified\nproperly.\n\n> Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes).\n\nMost of my bread and butter element classes are *not* extension\nclasses :-) Just for one example:\n\n```\nsage: x = CombinatorialFreeModule(QQ, [1,2,3]).an_element()\nsage: x.__class__\n<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>\nsage: x.__class__.__bases__\n(sage.combinat.free_module.CombinatorialFreeModuleElement,\n sage.categories.vector_spaces.VectorSpaces.WithBasis.element_class)\n```\n\n> So is it safe to remove this check from `_test_category`?\n\nPlease don't: so far failures here have always pointed to actual bugs.\n\nCheers,\n                            Nicolas",
    "created_at": "2014-05-10T22:05:55Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62045",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:16'></a>
Replying to [saraedum](#comment%3A15):
> I have a question regarding this old ticket. The following fails:
> 
> ```
> sage: a = ModularForms(11,4).an_element()
> sage: a._test_category()
> ```
> The reason for this is that `a` is not an extension class so `_test_category` expects that the type of `a` inherits from `a.parent().category().element_class`. Now if I try to do such inheritance
> 
> ```
> class HeckeModuleElement(sage.modules.module_element.ModuleElement, HeckeModules.element_class):
> ```
> I get a
> 
> ```
> metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its base
> ```

If it's not an extension type, it really should inherit `a.parent().category().element_class`.
Except in complicated cases (e.g. parents whose elements can belong to
several classes), this is taken care of automatically if a category is specified to
`Parent.__init__`; otherwise one needs to use manually
`_make_element_class`. See sage.categories.primer (better with #10963 applied) and the
documentation of Category for details.

Most likely the issue here is that the category is not specified
properly.

> Anyway, I'm getting the feeling that such inheritance does not happen anywhere (partly because most element classes are extension classes).

Most of my bread and butter element classes are *not* extension
classes :-) Just for one example:

```
sage: x = CombinatorialFreeModule(QQ, [1,2,3]).an_element()
sage: x.__class__
<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>
sage: x.__class__.__bases__
(sage.combinat.free_module.CombinatorialFreeModuleElement,
 sage.categories.vector_spaces.VectorSpaces.WithBasis.element_class)
```

> So is it safe to remove this check from `_test_category`?

Please don't: so far failures here have always pointed to actual bugs.

Cheers,
                            Nicolas



---

archive/issue_comments_062046.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks for your explanation.",
    "created_at": "2014-05-10T23:07:26Z",
    "issue": "https://github.com/sagemath/sage/issues/7921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7921#issuecomment-62046",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:17'></a>
Thanks for your explanation.
