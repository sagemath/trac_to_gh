# Issue 7821: readline-6.0.p1 fails on FreeBSD

archive/issues_007821.json:
```json
{
    "body": "readline-6.0.p1/spkg-install contains a typo in some FreeBSD-specific code, leading to the following error:\n\n```\n...\n/bin/sh ../support/shlib-install -O freebsd8.0 -d /home/peter/sage/sage-4.3/local/lib -b /home/peter/sage/sage-4.3/local/bin -i \"/usr/bin/install -c -m 644\" libreadline.so.6.0\ninstall: you may need to run ldconfig\nmake[1]: Leaving directory `/home/peter/sage/sage-4.3/spkg/build/readline-6.0.p1/src/shlib'\nln: SAGE_LOCAL/lib/libreadline.so: No such file or directory\n```\n\nThe affected code is no longer required with readline-6.0 so delete it.\n\nFreeBSD 3.x and later default to ELF, rather then a.out. A utility objformat(1) was temporarily introduced to enable third-party applications to determine te object format. This has now been deleted and code should assume ELF format if it does not exist. Explicitly linking libreadline against libtermcap is necessary to ensure that dependencies are picked up.\n\nAssignee: @peterjeremy\n\nResolution: fixed\n\nAuthor: Peter Jeremy\n\nReviewer: Mike Hansen\n\nMerged: sage-4.5.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/7821\n\n",
    "closed_at": "2010-06-25T15:43:43Z",
    "created_at": "2010-01-03T00:53:06Z",
    "labels": [
        "component: porting: bsd",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5",
    "title": "readline-6.0.p1 fails on FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7821",
    "user": "https://github.com/peterjeremy"
}
```
readline-6.0.p1/spkg-install contains a typo in some FreeBSD-specific code, leading to the following error:

```
...
/bin/sh ../support/shlib-install -O freebsd8.0 -d /home/peter/sage/sage-4.3/local/lib -b /home/peter/sage/sage-4.3/local/bin -i "/usr/bin/install -c -m 644" libreadline.so.6.0
install: you may need to run ldconfig
make[1]: Leaving directory `/home/peter/sage/sage-4.3/spkg/build/readline-6.0.p1/src/shlib'
ln: SAGE_LOCAL/lib/libreadline.so: No such file or directory
```

The affected code is no longer required with readline-6.0 so delete it.

FreeBSD 3.x and later default to ELF, rather then a.out. A utility objformat(1) was temporarily introduced to enable third-party applications to determine te object format. This has now been deleted and code should assume ELF format if it does not exist. Explicitly linking libreadline against libtermcap is necessary to ensure that dependencies are picked up.

Assignee: @peterjeremy

Resolution: fixed

Author: Peter Jeremy

Reviewer: Mike Hansen

Merged: sage-4.5.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/7821





---

archive/issue_comments_078969.json:
```json
{
    "body": "Attachment [7821-readline.patch](tarball://root/attachments/some-uuid/ticket7821/7821-readline.patch) by @peterjeremy created at 2010-01-03 00:55:37",
    "created_at": "2010-01-03T00:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78969",
    "user": "https://github.com/peterjeremy"
}
```

Attachment [7821-readline.patch](tarball://root/attachments/some-uuid/ticket7821/7821-readline.patch) by @peterjeremy created at 2010-01-03 00:55:37



---

archive/issue_comments_078970.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-03T01:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78970",
    "user": "https://github.com/peterjeremy"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_078971.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Jeremy\"",
    "created_at": "2010-01-03T03:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78971",
    "user": "https://github.com/peterjeremy"
}
```

Changing author from "" to "Peter Jeremy"



---

archive/issue_comments_078972.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Mike Hansen\"",
    "created_at": "2010-06-22T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78972",
    "user": "https://github.com/mwhansen"
}
```

Changing reviewer from "" to "Mike Hansen"



---

archive/issue_comments_078973.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis looks good to me.  I've made an spkg out of the changes at http://sage.math.washington.edu/home/mhansen/readline-6.0.p2.spkg",
    "created_at": "2010-06-22T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78973",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
This looks good to me.  I've made an spkg out of the changes at http://sage.math.washington.edu/home/mhansen/readline-6.0.p2.spkg



---

archive/issue_comments_078974.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-06-22T22:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78974",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_078975.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-06-25T15:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78975",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_comments_078976.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.5.alpha0\"",
    "created_at": "2010-06-25T15:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78976",
    "user": "https://github.com/rlmill"
}
```

Changing merged from "" to "sage-4.5.alpha0"



---

archive/issue_events_018717.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-06-25T15:43:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7821#event-18717"
}
```



---

archive/issue_comments_078977.json:
```json
{
    "body": "<a id='comment:5'></a>\nFor the record:\n\nThe proper fix (btw. also for a couple of other systems, like Arch Linux, OpenSuSE and meanwhile also Ubuntu 11.10 I think) is to add `$(TERMCAP_LIB)` to the link command of `libreadline.so` in `src/shlib/Makefile.in`, rather than setting `SHLIB_LIBS='-ltermcap'`.  This is more generic, since readline's `configure` determines what the proper `libtermcap` (or its replacement) is.  No need to special-case on the platform (operating system / distro).",
    "created_at": "2011-10-28T11:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7821#issuecomment-78977",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>
For the record:

The proper fix (btw. also for a couple of other systems, like Arch Linux, OpenSuSE and meanwhile also Ubuntu 11.10 I think) is to add `$(TERMCAP_LIB)` to the link command of `libreadline.so` in `src/shlib/Makefile.in`, rather than setting `SHLIB_LIBS='-ltermcap'`.  This is more generic, since readline's `configure` determines what the proper `libtermcap` (or its replacement) is.  No need to special-case on the platform (operating system / distro).
