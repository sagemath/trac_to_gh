# Issue 7640: shortest_path should not use NetworkX if the underlying graph is a c_graph

archive/issues_007640.json:
```json
{
    "body": "\n```\nsage: G = graphs.CubeGraph(5)\nsage: C = G.copy(implementation='c_graph')\nsage: timeit(\"G.shortest_path('01001', '10100')\")\n625 loops, best of 3: 49.3 \u00b5s per loop\nsage: timeit(\"C.shortest_path('01001', '10100')\")\n625 loops, best of 3: 992 \u00b5s per loop\n```\n\n**Assignee:** @rlmill\n\n**CC:**  @nathanncohen @rlmill @jasongrout mvngu\n\n**Author:** Nathann Cohen\n\n**Reviewer:** Robert Miller\n\n**Merged:** sage-4.3.rc1\n\nIssue created by migration from https://trac.sagemath.org/ticket/7640\n\n",
    "closed_at": "2009-12-14T16:41:40Z",
    "created_at": "2009-12-09T17:00:58Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3",
    "title": "shortest_path should not use NetworkX if the underlying graph is a c_graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7640",
    "user": "https://github.com/rlmill"
}
```

```
sage: G = graphs.CubeGraph(5)
sage: C = G.copy(implementation='c_graph')
sage: timeit("G.shortest_path('01001', '10100')")
625 loops, best of 3: 49.3 µs per loop
sage: timeit("C.shortest_path('01001', '10100')")
625 loops, best of 3: 992 µs per loop
```

**Assignee:** @rlmill

**CC:**  @nathanncohen @rlmill @jasongrout mvngu

**Author:** Nathann Cohen

**Reviewer:** Robert Miller

**Merged:** sage-4.3.rc1

Issue created by migration from https://trac.sagemath.org/ticket/7640





---

archive/issue_comments_058565.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is one of those functions that should probably be written in Cython, on as low a level as possible...",
    "created_at": "2009-12-09T17:03:16Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58565",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:1'></a>
This is one of those functions that should probably be written in Cython, on as low a level as possible...



---

archive/issue_comments_058566.json:
```json
{
    "body": "<a id='comment:2'></a>\nTo be honest, I intended to write it as soon as your partch to make them the default format is merged :-)",
    "created_at": "2009-12-09T17:36:38Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58566",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:2'></a>
To be honest, I intended to write it as soon as your partch to make them the default format is merged :-)



---

archive/issue_comments_058567.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt should be the other order: this ticket needs to be dealt with before we switch over. There are probably other issues like this one lurking...",
    "created_at": "2009-12-09T17:37:59Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58567",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:3'></a>
It should be the other order: this ticket needs to be dealt with before we switch over. There are probably other issues like this one lurking...



---

archive/issue_comments_058568.json:
```json
{
    "body": "<a id='comment:4'></a>\nOne problem IMHO with `c_graph` is that as is (correct me if I'm wrong)\nwe won't be able to have a fast `in_neighbors`.\n\nAt least the current implementation is to test all vertices in the graph.",
    "created_at": "2009-12-09T19:31:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58568",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:4'></a>
One problem IMHO with `c_graph` is that as is (correct me if I'm wrong)
we won't be able to have a fast `in_neighbors`.

At least the current implementation is to test all vertices in the graph.



---

archive/issue_comments_058569.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [ylchapuy](#comment%3A4):\n> One problem IMHO with `c_graph` is that as is (correct me if I'm wrong)\n> we won't be able to have a fast `in_neighbors`.\n> \n> At least the current implementation is to test all vertices in the graph.\n\n\nThis belongs here: http://groups.google.com/group/sage-devel/browse_thread/thread/8edd29e9bddc67e5\n\nSee my comments there.",
    "created_at": "2009-12-09T19:44:12Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58569",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:5'></a>
Replying to [ylchapuy](#comment%3A4):
> One problem IMHO with `c_graph` is that as is (correct me if I'm wrong)
> we won't be able to have a fast `in_neighbors`.
> 
> At least the current implementation is to test all vertices in the graph.


This belongs here: http://groups.google.com/group/sage-devel/browse_thread/thread/8edd29e9bddc67e5

See my comments there.



---

archive/issue_comments_058570.json:
```json
{
    "body": "<a id='comment:7'></a>\nOne less between Sage and c_graphs :-)\n\nHere is the result of the test given in the description of this ticket :\n\n```\nsage: sage: G = graphs.CubeGraph(5)\nsage: sage: C = G.copy(implementation='c_graph')\nsage: sage: timeit(\"G.shortest_path('01001', '10100')\")\n625 loops, best of 3: 51.6 \u00b5s per loop\nsage: sage: timeit(\"C.shortest_path('01001', '10100')\")\n625 loops, best of 3: 30.4 \u00b5s per loop\n```\n\nNathann",
    "created_at": "2009-12-12T17:46:11Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58570",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
One less between Sage and c_graphs :-)

Here is the result of the test given in the description of this ticket :

```
sage: sage: G = graphs.CubeGraph(5)
sage: sage: C = G.copy(implementation='c_graph')
sage: sage: timeit("G.shortest_path('01001', '10100')")
625 loops, best of 3: 51.6 µs per loop
sage: sage: timeit("C.shortest_path('01001', '10100')")
625 loops, best of 3: 30.4 µs per loop
```

Nathann



---

archive/issue_events_052289.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-12-12T17:46:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52289"
}
```



---

archive/issue_comments_058571.json:
```json
{
    "body": "<a id='comment:8'></a>\nGreat work!\n\nA few comments:\n\n1. You can use `if self._backend.hasattr('_cg')` to test whether self is a `c_graph` or a `networkx` graph. This seems cleaner than a try-except block.\n\n2. It should be easy to implement something in the case `bidirectional=False`, and we should do this since the point is to replace NetworkX with our own functionality.\n\n3. We also need to handle the case `by_weight=True`: this is only relevant for `SparseGraph`s, since `DenseGraph`s don't support edge labeling.",
    "created_at": "2009-12-12T18:20:36Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58571",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:8'></a>
Great work!

A few comments:

1. You can use `if self._backend.hasattr('_cg')` to test whether self is a `c_graph` or a `networkx` graph. This seems cleaner than a try-except block.

2. It should be easy to implement something in the case `bidirectional=False`, and we should do this since the point is to replace NetworkX with our own functionality.

3. We also need to handle the case `by_weight=True`: this is only relevant for `SparseGraph`s, since `DenseGraph`s don't support edge labeling.



---

archive/issue_events_052290.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-12-12T18:20:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52290"
}
```



---

archive/issue_events_052291.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-12-12T18:20:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52291"
}
```



---

archive/issue_comments_058572.json:
```json
{
    "body": "<a id='comment:9'></a>\nSeveral answers, then :-)\n\n1. That's why I wanted to use at first but Martin Albrecht told me in #7637 that this version should be more efficient\n\n2. The version ``bidirectional = False`` is indeed very easy to write ( one only needs to remove variables ), but I wondered if this was useful... ``bidirectional=True`` is the default option, used in all the others call to it, and this second version is meant to be faster... :-)\n\n3. I started by trying to write the Dijkstra algorithm, and ended up wondering whether there was a Heap structure already written in Cython. I needed to maintain a sorted list, and found no reference about it ... If you know how to do it, I'll begin immediately ! :-)\n\nThis version of shortest_path seems to be the most used ( bidirectional=True, weights=False ), so I thought the most urgent was to make your c_graphs the default ones.. I just created two tickets in the graph section about functions that should be moved from networkx to c_graphs, we could just add these two ! Anyway I intend to take care of them :-)\n\nNathann",
    "created_at": "2009-12-12T18:28:32Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58572",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>
Several answers, then :-)

1. That's why I wanted to use at first but Martin Albrecht told me in #7637 that this version should be more efficient

2. The version ``bidirectional = False`` is indeed very easy to write ( one only needs to remove variables ), but I wondered if this was useful... ``bidirectional=True`` is the default option, used in all the others call to it, and this second version is meant to be faster... :-)

3. I started by trying to write the Dijkstra algorithm, and ended up wondering whether there was a Heap structure already written in Cython. I needed to maintain a sorted list, and found no reference about it ... If you know how to do it, I'll begin immediately ! :-)

This version of shortest_path seems to be the most used ( bidirectional=True, weights=False ), so I thought the most urgent was to make your c_graphs the default ones.. I just created two tickets in the graph section about functions that should be moved from networkx to c_graphs, we could just add these two ! Anyway I intend to take care of them :-)

Nathann



---

archive/issue_comments_058573.json:
```json
{
    "body": "<a id='comment:10'></a>\nI applied the patch here, together with the patch at #7634, (to `4.3.rc0`) in order to fully test the new functionality, and here are the results of `-t -long sage/graphs` (files not listed passed):\n\n```\nsage -t -long \"devel/sage-main/sage/graphs/graph.py\"        \n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 5838:\n    sage: H.is_isomorphic(graphs.CompleteGraph(n))\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 7329:\n    sage: g.transitive_reduction().size()\nExpected:\n    5\nGot:\n    6\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 2206:\n    sage: o.in_degree()\nExpected:\n    [2, 2, 2, 2, 1, 2, 1, 1, 1, 1]\nGot:\n    [2, 2, 2, 2, 2, 1, 1, 1, 1, 1]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 2208:\n    sage: o.out_degree()\nExpected:\n    [1, 1, 1, 1, 2, 1, 2, 2, 2, 2]\nGot:\n    [1, 1, 1, 1, 1, 2, 2, 2, 2, 2]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 4736:\n    sage: g.degree_sequence()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_96[3]>\", line 1, in <module>\n        g.degree_sequence()###line 4736:\n    sage: g.degree_sequence()\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4754, in degree_sequence\n        return sorted(self.degree_iterator(), reverse=True)\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4725, in degree_iterator\n        yield filter(v, self)\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4723, in <lambda>\n        filter = lambda v, self: self._backend.degree(v, self._directed)\n      File \"c_graph.pyx\", line 751, in sage.graphs.base.c_graph.CGraphBackend.degree (sage/graphs/base/c_graph.c:7480)\n      File \"c_graph.pyx\", line 594, in sage.graphs.base.c_graph.CGraph._out_degree (sage/graphs/base/c_graph.c:6472)\n    RuntimeError: Vertex (5) is not a vertex of the graph.\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py\", line 4742:\n    sage: g.degree_sequence()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_96[5]>\", line 1, in <module>\n        g.degree_sequence()###line 4742:\n    sage: g.degree_sequence()\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4754, in degree_sequence\n        return sorted(self.degree_iterator(), reverse=True)\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4725, in degree_iterator\n        yield filter(v, self)\n      File \"/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py\", line 4723, in <lambda>\n        filter = lambda v, self: self._backend.degree(v, self._directed)\n      File \"c_graph.pyx\", line 749, in sage.graphs.base.c_graph.CGraphBackend.degree (sage/graphs/base/c_graph.c:7433)\n      File \"c_graph.pyx\", line 580, in sage.graphs.base.c_graph.CGraph._in_degree (sage/graphs/base/c_graph.c:6372)\n    RuntimeError: Vertex (6) is not a vertex of the graph.\n**********************************************************************\n```\n\n```\nsage -t -long \"devel/sage-main/sage/graphs/linearextensions.py\"\n**********************************************************************\nFile \"/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/linearextensions.py\", line 360:\n    sage: l.incomparable(1,2)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```",
    "created_at": "2009-12-12T18:31:05Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58573",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:10'></a>
I applied the patch here, together with the patch at #7634, (to `4.3.rc0`) in order to fully test the new functionality, and here are the results of `-t -long sage/graphs` (files not listed passed):

```
sage -t -long "devel/sage-main/sage/graphs/graph.py"        
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 5838:
    sage: H.is_isomorphic(graphs.CompleteGraph(n))
Expected:
    True
Got:
    False
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 7329:
    sage: g.transitive_reduction().size()
Expected:
    5
Got:
    6
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 2206:
    sage: o.in_degree()
Expected:
    [2, 2, 2, 2, 1, 2, 1, 1, 1, 1]
Got:
    [2, 2, 2, 2, 2, 1, 1, 1, 1, 1]
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 2208:
    sage: o.out_degree()
Expected:
    [1, 1, 1, 1, 2, 1, 2, 2, 2, 2]
Got:
    [1, 1, 1, 1, 1, 2, 2, 2, 2, 2]
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 4736:
    sage: g.degree_sequence()
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.3.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_96[3]>", line 1, in <module>
        g.degree_sequence()###line 4736:
    sage: g.degree_sequence()
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4754, in degree_sequence
        return sorted(self.degree_iterator(), reverse=True)
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4725, in degree_iterator
        yield filter(v, self)
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4723, in <lambda>
        filter = lambda v, self: self._backend.degree(v, self._directed)
      File "c_graph.pyx", line 751, in sage.graphs.base.c_graph.CGraphBackend.degree (sage/graphs/base/c_graph.c:7480)
      File "c_graph.pyx", line 594, in sage.graphs.base.c_graph.CGraph._out_degree (sage/graphs/base/c_graph.c:6472)
    RuntimeError: Vertex (5) is not a vertex of the graph.
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/graph.py", line 4742:
    sage: g.degree_sequence()
Exception raised:
    Traceback (most recent call last):
      File "/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.3.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/rlmill/sage-4.3.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_96[5]>", line 1, in <module>
        g.degree_sequence()###line 4742:
    sage: g.degree_sequence()
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4754, in degree_sequence
        return sorted(self.degree_iterator(), reverse=True)
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4725, in degree_iterator
        yield filter(v, self)
      File "/Users/rlmill/sage-4.3.rc0/local/lib/python/site-packages/sage/graphs/graph.py", line 4723, in <lambda>
        filter = lambda v, self: self._backend.degree(v, self._directed)
      File "c_graph.pyx", line 749, in sage.graphs.base.c_graph.CGraphBackend.degree (sage/graphs/base/c_graph.c:7433)
      File "c_graph.pyx", line 580, in sage.graphs.base.c_graph.CGraph._in_degree (sage/graphs/base/c_graph.c:6372)
    RuntimeError: Vertex (6) is not a vertex of the graph.
**********************************************************************
```

```
sage -t -long "devel/sage-main/sage/graphs/linearextensions.py"
**********************************************************************
File "/Users/rlmill/sage-4.3.rc0/devel/sage-main/sage/graphs/linearextensions.py", line 360:
    sage: l.incomparable(1,2)
Expected:
    True
Got:
    False
**********************************************************************
```



---

archive/issue_comments_058574.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [ncohen](#comment%3A9):\n> Several answers, then :-)\n> \n> 1. That's why I wanted to use at first but Martin Albrecht told me in #7637 that this version should be more efficient\n\n\nGreat!\n\n> 2. The version ``bidirectional = False`` is indeed very easy to write ( one only needs to remove variables ), but I wondered if this was useful... ``bidirectional=True`` is the default option, used in all the others call to it, and this second version is meant to be faster... :-)\n\n\nThis is indeed a good point. I wonder if anyone ever in the history of Sage has used bidirectional=False.\n\n> 3. I started by trying to write the Dijkstra algorithm, and ended up wondering whether there was a Heap structure already written in Cython. I needed to maintain a sorted list, and found no reference about it ... If you know how to do it, I'll begin immediately ! :-)\n\n\nI'm not sure...\n\n> This version of shortest_path seems to be the most used ( bidirectional=True, weights=False ), so I thought the most urgent was to make your c_graphs the default ones.. I just created two tickets in the graph section about functions that should be moved from networkx to c_graphs, we could just add these two ! Anyway I intend to take care of them :-)\n\n\nI don't think `bidirectional=False` is a showstopper at all (in fact we should ping sage-devel about removing this option, since it seems silly). However, `by_weights=True` is going to be necessary to make the switch. I also just noticed that the function `shortest_paths` needs to be implemented for `c_graph`s too.",
    "created_at": "2009-12-12T18:35:32Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58574",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:11'></a>
Replying to [ncohen](#comment%3A9):
> Several answers, then :-)
> 
> 1. That's why I wanted to use at first but Martin Albrecht told me in #7637 that this version should be more efficient


Great!

> 2. The version ``bidirectional = False`` is indeed very easy to write ( one only needs to remove variables ), but I wondered if this was useful... ``bidirectional=True`` is the default option, used in all the others call to it, and this second version is meant to be faster... :-)


This is indeed a good point. I wonder if anyone ever in the history of Sage has used bidirectional=False.

> 3. I started by trying to write the Dijkstra algorithm, and ended up wondering whether there was a Heap structure already written in Cython. I needed to maintain a sorted list, and found no reference about it ... If you know how to do it, I'll begin immediately ! :-)


I'm not sure...

> This version of shortest_path seems to be the most used ( bidirectional=True, weights=False ), so I thought the most urgent was to make your c_graphs the default ones.. I just created two tickets in the graph section about functions that should be moved from networkx to c_graphs, we could just add these two ! Anyway I intend to take care of them :-)


I don't think `bidirectional=False` is a showstopper at all (in fact we should ping sage-devel about removing this option, since it seems silly). However, `by_weights=True` is going to be necessary to make the switch. I also just noticed that the function `shortest_paths` needs to be implemented for `c_graph`s too.



---

archive/issue_comments_058575.json:
```json
{
    "body": "<a id='comment:12'></a>\nI'll take a look at those errors immediately. \n\nshortest_paths is but a slight modification of this function, but as it needs to be very fast I wondered about copying most of the code and adding the necessary details.. What's you advice ?\n\nNathann",
    "created_at": "2009-12-12T18:37:31Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58575",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>
I'll take a look at those errors immediately. 

shortest_paths is but a slight modification of this function, but as it needs to be very fast I wondered about copying most of the code and adding the necessary details.. What's you advice ?

Nathann



---

archive/issue_comments_058576.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [ncohen](#comment%3A12):\n> I'll take a look at those errors immediately. \n> \n> shortest_paths is but a slight modification of this function, but as it needs to be very fast I wondered about copying most of the code and adding the necessary details.. What's you advice ?\n> \n> Nathann\n\n\nI would think about using the same code. Or factoring it out so that the redundant parts get written only once. (I don't know how familiar you are with Cython, but you can use `inline` in situations like these!)",
    "created_at": "2009-12-12T18:39:41Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58576",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:13'></a>
Replying to [ncohen](#comment%3A12):
> I'll take a look at those errors immediately. 
> 
> shortest_paths is but a slight modification of this function, but as it needs to be very fast I wondered about copying most of the code and adding the necessary details.. What's you advice ?
> 
> Nathann


I would think about using the same code. Or factoring it out so that the redundant parts get written only once. (I don't know how familiar you are with Cython, but you can use `inline` in situations like these!)



---

archive/issue_comments_058577.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [ncohen](#comment%3A12):\n> I'll take a look at those errors immediately. \n\n \nNot remembering whether I tested #7634 with `-long` by itself, I'm checking to see how #7634 does on its own (on top of alpha0 of course, since rc0 has distance_graphs, which time out...)",
    "created_at": "2009-12-12T18:42:22Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58577",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:14'></a>
Replying to [ncohen](#comment%3A12):
> I'll take a look at those errors immediately. 

 
Not remembering whether I tested #7634 with `-long` by itself, I'm checking to see how #7634 does on its own (on top of alpha0 of course, since rc0 has distance_graphs, which time out...)



---

archive/issue_comments_058578.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [rlm](#comment%3A14):\n> Replying to [ncohen](#comment%3A12):\n> > I'll take a look at those errors immediately. \n\n>  \n> Not remembering whether I tested #7634 with `-long` by itself, I'm checking to see how #7634 does on its own (on top of alpha0 of course, since rc0 has distance_graphs, which time out...)\n\n\nAll tests pass here, so it looks like all the issues above are relevant.",
    "created_at": "2009-12-12T19:01:10Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58578",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:15'></a>
Replying to [rlm](#comment%3A14):
> Replying to [ncohen](#comment%3A12):
> > I'll take a look at those errors immediately. 

>  
> Not remembering whether I tested #7634 with `-long` by itself, I'm checking to see how #7634 does on its own (on top of alpha0 of course, since rc0 has distance_graphs, which time out...)


All tests pass here, so it looks like all the issues above are relevant.



---

archive/issue_comments_058579.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe first (test of isomorphism) error was a mistake in the algorithm and is fixed already. I am dealing with the second one (transitive_reduction) which is related to the fact that we are dealing with a digraph... I am not worried by the RuntimeErrors that follow... I will update this patch as soon as possible :-)",
    "created_at": "2009-12-12T19:03:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58579",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>
The first (test of isomorphism) error was a mistake in the algorithm and is fixed already. I am dealing with the second one (transitive_reduction) which is related to the fact that we are dealing with a digraph... I am not worried by the RuntimeErrors that follow... I will update this patch as soon as possible :-)



---

archive/issue_events_052292.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-12-12T19:33:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52292"
}
```



---

archive/issue_events_052293.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2009-12-12T19:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52293"
}
```



---

archive/issue_comments_058580.json:
```json
{
    "body": "<a id='comment:17'></a>\nWell, in the end I corrected the first two errors, which were directly errors in the algorithm ( I ignored the direction of arcs, which is now fixed ).\n\nThe following ones are created by the enumeration of degree ( for example the error in eulerian_orientation is not really one. The result given is correct, but there is one inversion due to the fact that the order in the listing of neighbors is not the same when you patch is applied :-)\n\nThis reminded me that your patch for c_graphs had not actually been tested against the new Sage because of the slowness in the distance function.. As eulerian_orientation does not care about distances ( I wrote this one :-) ), I do not think shortest_path is responsible for this one... Could you take a look at the last bugs to see if it could come from the switching process ( it it for sure in the case of eulerian_orientation ) ?\n\nActually, as it is not possible to test your switching patch without the shortest)path functiom, perhaps we should merge the two in just one patch....\n\nWe're almost there !!!!!!!!!! :-)\n\nNathann",
    "created_at": "2009-12-12T19:33:26Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58580",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'></a>
Well, in the end I corrected the first two errors, which were directly errors in the algorithm ( I ignored the direction of arcs, which is now fixed ).

The following ones are created by the enumeration of degree ( for example the error in eulerian_orientation is not really one. The result given is correct, but there is one inversion due to the fact that the order in the listing of neighbors is not the same when you patch is applied :-)

This reminded me that your patch for c_graphs had not actually been tested against the new Sage because of the slowness in the distance function.. As eulerian_orientation does not care about distances ( I wrote this one :-) ), I do not think shortest_path is responsible for this one... Could you take a look at the last bugs to see if it could come from the switching process ( it it for sure in the case of eulerian_orientation ) ?

Actually, as it is not possible to test your switching patch without the shortest)path functiom, perhaps we should merge the two in just one patch....

We're almost there !!!!!!!!!! :-)

Nathann



---

archive/attachments_009290.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7640.patch",
    "asset_url": "tarball://root/attachments/ticket7640/trac_7640.patch",
    "created_at": "2009-12-12T19:33:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7640/trac_7640.patch",
    "user": "https://github.com/nathanncohen"
}
```



---

archive/issue_comments_058581.json:
```json
{
    "body": "Attachment [trac_7640.patch](https://github.com/sagemath/sage/files/ticket7640/trac_7640.patch) by @nathanncohen created at 2009-12-12 19:33:46",
    "created_at": "2009-12-12T19:33:46Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58581",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_7640.patch](https://github.com/sagemath/sage/files/ticket7640/trac_7640.patch) by @nathanncohen created at 2009-12-12 19:33:46



---

archive/issue_comments_058582.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [ncohen](#comment%3A17):\n> Actually, as it is not possible to test your switching patch without the shortest)path functiom, perhaps we should merge the two in just one patch....\n\n\nAbsolutely not! There is *much* work that needs to be done before #7634 gets merged (this is just one piece). Once this patch is finalized, we can say #7634 depends on this, and then the testing issue will be moot.\n\nReview of the current patch coming shortly...",
    "created_at": "2009-12-12T19:39:51Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58582",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:18'></a>
Replying to [ncohen](#comment%3A17):
> Actually, as it is not possible to test your switching patch without the shortest)path functiom, perhaps we should merge the two in just one patch....


Absolutely not! There is *much* work that needs to be done before #7634 gets merged (this is just one piece). Once this patch is finalized, we can say #7634 depends on this, and then the testing issue will be moot.

Review of the current patch coming shortly...



---

archive/issue_comments_058583.json:
```json
{
    "body": "<a id='comment:19'></a>\nI've created #7673 to deal with the `by_weight=True` case. I like this patch as it is, since it makes it possible to test #7634. Also, by itself it passes long tests in sage/graphs. Nice work!",
    "created_at": "2009-12-12T20:02:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58583",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:19'></a>
I've created #7673 to deal with the `by_weight=True` case. I like this patch as it is, since it makes it possible to test #7634. Also, by itself it passes long tests in sage/graphs. Nice work!



---

archive/issue_comments_058584.json:
```json
{
    "body": "**Reviewer:** Robert Miller",
    "created_at": "2009-12-12T20:02:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58584",
    "user": "https://github.com/rlmill"
}
```

**Reviewer:** Robert Miller



---

archive/issue_comments_058585.json:
```json
{
    "body": "**Author:** Nathann Cohen",
    "created_at": "2009-12-12T20:02:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58585",
    "user": "https://github.com/rlmill"
}
```

**Author:** Nathann Cohen



---

archive/issue_events_052294.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-12-12T20:02:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52294"
}
```



---

archive/issue_events_052295.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-12-12T20:02:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52295"
}
```



---

archive/issue_events_052296.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-14T16:41:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "milestone": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52296"
}
```



---

archive/issue_events_052297.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-14T16:41:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "milestone": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52297"
}
```



---

archive/issue_comments_058586.json:
```json
{
    "body": "**Merged:** sage-4.3.rc1",
    "created_at": "2009-12-14T16:41:40Z",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7640#issuecomment-58586",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** sage-4.3.rc1



---

archive/issue_events_052298.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-14T16:41:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52298"
}
```



---

archive/issue_events_052299.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-14T16:41:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7640#event-52299"
}
```
