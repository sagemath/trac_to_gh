# Issue 7522: Implement orthogonal complement in vector spaces

archive/issues_007522.json:
```json
{
    "assignees": [],
    "body": "It should be easy to get the orthogonal complement of a subspace W of a vector space V.   From Jason Grout: \n\n```\nsage: def orthogonal_complement(space):\n....:     if space.dimension()==0:\n....:         return space.ambient_vector_space()\n....:     else:\n....:         return space.basis_matrix().right_kernel()\n```\nOne would also want to add an option to specify the larger space in which you were dealing, with it defaulting to the ambient vector space.  Probably 'perp()' should be an alias.\n\n---\n\nApply: [attachment: trac_7522-perp-ts.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz) and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)\n\nAssignee: **@williamstein**\n\nCC:  @jasongrout @rbeezer\n\nKeywords: **sd48**\n\nReviewer: **Karl-Dieter Crisman, Nils Bruin, Jason Grout, Gregory Bard**\n\nAuthor: **Jason Grout, Travis Scrimshaw**\n\nMerged: **sage-5.11.beta3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7522_\n\n",
    "closed_at": "2013-06-20T21:33:49Z",
    "created_at": "2009-11-24T01:27:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement orthogonal complement in vector spaces",
    "type": "issue",
    "updated_at": "2013-06-20T21:33:49Z",
    "url": "https://github.com/sagemath/sage/issues/7522",
    "user": "https://github.com/kcrisman"
}
```
It should be easy to get the orthogonal complement of a subspace W of a vector space V.   From Jason Grout: 

```
sage: def orthogonal_complement(space):
....:     if space.dimension()==0:
....:         return space.ambient_vector_space()
....:     else:
....:         return space.basis_matrix().right_kernel()
```
One would also want to add an option to specify the larger space in which you were dealing, with it defaulting to the ambient vector space.  Probably 'perp()' should be an alias.

---

Apply: [attachment: trac_7522-perp-ts.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz) and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)

Assignee: **@williamstein**

CC:  @jasongrout @rbeezer

Keywords: **sd48**

Reviewer: **Karl-Dieter Crisman, Nils Bruin, Jason Grout, Gregory Bard**

Author: **Jason Grout, Travis Scrimshaw**

Merged: **sage-5.11.beta3**

_Issue created by migration from https://trac.sagemath.org/ticket/7522_





---

archive/issue_events_083862.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-11-24T01:27:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83862"
}
```



---

archive/issue_events_083863.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-11-24T01:27:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83863"
}
```



---

archive/issue_events_083864.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-11-24T01:27:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83864"
}
```



---

archive/issue_events_083865.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-11-24T01:27:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83865"
}
```



---

archive/issue_comments_057151.json:
```json
{
    "body": "Attachment: **[7522-perp.patch.gz](https://github.com/sagemath/sage/files/ticket7522/7522-perp.patch.gz)**",
    "created_at": "2010-09-22T03:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57151",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[7522-perp.patch.gz](https://github.com/sagemath/sage/files/ticket7522/7522-perp.patch.gz)**



---

archive/issue_comments_057152.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThis adds the basic orthogonal complement command.  Specifying a larger space can go on another ticket, if someone wants it.",
    "created_at": "2010-09-22T03:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57152",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:1" align="right">Comment 1</div>

This adds the basic orthogonal complement command.  Specifying a larger space can go on another ticket, if someone wants it.



---

archive/issue_events_083866.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-22T03:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83866"
}
```



---

archive/issue_comments_057153.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nReplying to [@jasongrout](#comment%3A1):\n> This adds the basic orthogonal complement command.  Specifying a larger space can go on another ticket, if someone wants it.\n\nThanks for doing this - I never got to it, since I haven't used this lately.   Agreed on the enhancement.\n\nThe documentation should make it clear what the ambient space is by default, perhaps by adding an example where things fail?  Or at least commenting that the first example just shows itself as the ambient space.  What would happen if one took a double subspace - what would it consider to be the ambient subspace?",
    "created_at": "2010-09-23T00:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57153",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">Comment 2</div>

Replying to [@jasongrout](#comment%3A1):
> This adds the basic orthogonal complement command.  Specifying a larger space can go on another ticket, if someone wants it.

Thanks for doing this - I never got to it, since I haven't used this lately.   Agreed on the enhancement.

The documentation should make it clear what the ambient space is by default, perhaps by adding an example where things fail?  Or at least commenting that the first example just shows itself as the ambient space.  What would happen if one took a double subspace - what would it consider to be the ambient subspace?



---

archive/issue_comments_057154.json:
```json
{
    "body": "apply on top of previous patches",
    "created_at": "2010-09-23T23:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57154",
    "user": "https://github.com/jasongrout"
}
```

apply on top of previous patches



---

archive/issue_comments_057155.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nAttachment: **[7522-review.patch.gz](https://github.com/sagemath/sage/files/ticket7522/7522-review.patch.gz)**\n\nReplying to [@kcrisman](#comment%3A2):\n\n\n> The documentation should make it clear what the ambient space is by default, perhaps by adding an example where things fail?  Or at least commenting that the first example just shows itself as the ambient space.  What would happen if one took a double subspace - what would it consider to be the ambient subspace?  \n\nReview patch attached.  Better now?",
    "created_at": "2010-09-23T23:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57155",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">Comment 3</div>

Attachment: **[7522-review.patch.gz](https://github.com/sagemath/sage/files/ticket7522/7522-review.patch.gz)**

Replying to [@kcrisman](#comment%3A2):


> The documentation should make it clear what the ambient space is by default, perhaps by adding an example where things fail?  Or at least commenting that the first example just shows itself as the ambient space.  What would happen if one took a double subspace - what would it consider to be the ambient subspace?  

Review patch attached.  Better now?



---

archive/issue_events_083867.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-27T12:54:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83867"
}
```



---

archive/issue_events_083868.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2010-09-27T12:54:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83868"
}
```



---

archive/issue_comments_057156.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI got a chance to look at this over the weekend.  Unsurprisingly, in general it's great.  But...\n\nSince this is in the free module module (!), there should be a better error for \n\n```\nsage: c = FreeModule(Integers(8), 2)\nsage: c.perp()\n---------------------------------------------------------------------------\n<snip>\nNotImplementedError: Don't know how to compute kernels over Ring of integers modulo 8\n```\nI also noticed the following behavior, which is probably desirable, but which should then definitely be explicitly mentioned in the documentation for this function, since it does return a different type of object for the perp object:\n\n```\nsage: c = FreeModule(ZZ, 2)\nsage: c\nAmbient free module of rank 2 over the principal ideal domain Integer Ring\nsage: c.perp()\nVector space of degree 2 and dimension 0 over Rational Field\nBasis matrix:\n[]\n```",
    "created_at": "2010-09-27T12:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57156",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">Comment 4</div>

I got a chance to look at this over the weekend.  Unsurprisingly, in general it's great.  But...

Since this is in the free module module (!), there should be a better error for 

```
sage: c = FreeModule(Integers(8), 2)
sage: c.perp()
---------------------------------------------------------------------------
<snip>
NotImplementedError: Don't know how to compute kernels over Ring of integers modulo 8
```
I also noticed the following behavior, which is probably desirable, but which should then definitely be explicitly mentioned in the documentation for this function, since it does return a different type of object for the perp object:

```
sage: c = FreeModule(ZZ, 2)
sage: c
Ambient free module of rank 2 over the principal ideal domain Integer Ring
sage: c.perp()
Vector space of degree 2 and dimension 0 over Rational Field
Basis matrix:
[]
```



---

archive/issue_comments_057157.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBy the way, why didn't `TestSuite` catch this?\n\n```\n    sage: M = ZZ^3\n    sage: TestSuite(M).run()\n    sage: W = M.span_of_basis([[1,2,3],[4,5,19]])\n    sage: TestSuite(W).run()\n```",
    "created_at": "2010-09-27T20:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57157",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">Comment 5</div>

By the way, why didn't `TestSuite` catch this?

```
    sage: M = ZZ^3
    sage: TestSuite(M).run()
    sage: W = M.span_of_basis([[1,2,3],[4,5,19]])
    sage: TestSuite(W).run()
```



---

archive/issue_comments_057158.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2010-09-27T20:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57158",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_057159.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI've uploaded a new version of the patch which moves the `perp()` method to the free module with the PID as a base ring (so you shouldn't get the `NotImplementedError`) and made sure the submodules have the correct base rings.",
    "created_at": "2013-04-04T22:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57159",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">Comment 7</div>

I've uploaded a new version of the patch which moves the `perp()` method to the free module with the PID as a base ring (so you shouldn't get the `NotImplementedError`) and made sure the submodules have the correct base rings.



---

archive/issue_comments_057160.json:
```json
{
    "body": "Changed author from **Jason Grout** to **Jason Grout, Travis Scrimshaw**",
    "created_at": "2013-04-04T22:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57160",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Jason Grout** to **Jason Grout, Travis Scrimshaw**



---

archive/issue_events_083869.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T22:58:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83869"
}
```



---

archive/issue_events_083870.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T22:58:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83870"
}
```



---

archive/issue_comments_057161.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nFor patchbot:\n\nApply: trac_7522-perp-ts.patch",
    "created_at": "2013-04-04T22:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57161",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">Comment 8</div>

For patchbot:

Apply: trac_7522-perp-ts.patch



---

archive/issue_comments_057162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,7 @@\n ....:         return space.basis_matrix().right_kernel()\n ```\n One would also want to add an option to specify the larger space in which you were dealing, with it defaulting to the ambient vector space.  Probably 'perp()' should be an alias.\n+\n+---\n+\n+Apply: [attachment: trac_7522-perp-ts.patch]\n``````\n",
    "created_at": "2013-04-04T22:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57162",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,7 @@
 ....:         return space.basis_matrix().right_kernel()
 ```
 One would also want to add an option to specify the larger space in which you were dealing, with it defaulting to the ambient vector space.  Probably 'perp()' should be an alias.
+
+---
+
+Apply: [attachment: trac_7522-perp-ts.patch]
``````




---

archive/issue_comments_057163.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n`perp()` isn't documented in this patch.  Also,\n\n```\nsage: c = FreeModule(Integers(8), 2)\nsage: c.perp()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\nAttributeError: 'FreeModule_ambient_with_category' object has no attribute 'perp'\n<and later>\nAttributeError: 'IntegerModRing_generic_with_category' object has no attribute 'parent'\n```\nApparently `Integers(8)` isn't a PID, according to Sage?  This isn't bad, but perhaps we should have a different error message... or maybe this is okay.",
    "created_at": "2013-04-05T00:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57163",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">Comment 9</div>

`perp()` isn't documented in this patch.  Also,

```
sage: c = FreeModule(Integers(8), 2)
sage: c.perp()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
AttributeError: 'FreeModule_ambient_with_category' object has no attribute 'perp'
<and later>
AttributeError: 'IntegerModRing_generic_with_category' object has no attribute 'parent'
```
Apparently `Integers(8)` isn't a PID, according to Sage?  This isn't bad, but perhaps we should have a different error message... or maybe this is okay.



---

archive/issue_events_083871.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-04-05T00:41:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83871"
}
```



---

archive/issue_events_083872.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-04-05T00:41:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83872"
}
```



---

archive/issue_comments_057164.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nAlso, would it be better to do the kernel first and then change the ring?  Just wondering if there might be any difference.",
    "created_at": "2013-04-05T00:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57164",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">Comment 10</div>

Also, would it be better to do the kernel first and then change the ring?  Just wondering if there might be any difference.



---

archive/issue_comments_057165.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\n- You only have an orthogonal complement on an inner product space.\n  - Whenever you have a canonical isomorphism between a vector space and its dual, you can do the \"kernel trick\" that you're doing (note you have to take a transpose somewhere). A basis choice induces such a canonical isomorphism, as does an inner product. For every subspace `W subset V` it gives you a complementary subspace `W'` such that V is a direct product of `W` and `W'`.\n  - For (free) modules over rings this doesn't really work, because not every submodule is a direct summand.\n  - Of course, if your ring is a domain, you can tensor with the field of fractions, take the complement, and intersect with the module inside to get another submodule. Doing that twice should get you the \"saturation\" of your original module.\n\nI suggest you don't call it orthogonal complement. For instance, on vector spaces over finite fields, it's not (but a basis choice still induces an isomorphism to the dual).",
    "created_at": "2013-04-05T01:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57165",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:11" align="right">Comment 11</div>

- You only have an orthogonal complement on an inner product space.
  - Whenever you have a canonical isomorphism between a vector space and its dual, you can do the "kernel trick" that you're doing (note you have to take a transpose somewhere). A basis choice induces such a canonical isomorphism, as does an inner product. For every subspace `W subset V` it gives you a complementary subspace `W'` such that V is a direct product of `W` and `W'`.
  - For (free) modules over rings this doesn't really work, because not every submodule is a direct summand.
  - Of course, if your ring is a domain, you can tensor with the field of fractions, take the complement, and intersect with the module inside to get another submodule. Doing that twice should get you the "saturation" of your original module.

I suggest you don't call it orthogonal complement. For instance, on vector spaces over finite fields, it's not (but a basis choice still induces an isomorphism to the dual).



---

archive/issue_comments_057166.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\n> - You only have an orthogonal complement on an inner product space.\n> - Whenever you have a canonical isomorphism between a vector space and its dual, you can do the \"kernel trick\" that you're doing (note you have to take a transpose somewhere). A basis choice induces such a canonical isomorphism, as does an inner product. For every subspace `W subset V` it gives you a complementary subspace `W'` such that V is a direct product of `W` and `W'`.\n> - For (free) modules over rings this doesn't really work, because not every submodule is a direct summand.\n\nAargh!  You had to go remind us of the whole mathematical correctness thing.  You're right, of course.  Not every submodule is projective.\n> - Of course, if your ring is a domain, you can tensor with the field of fractions, take the complement, and intersect with the module inside to get another submodule. Doing that twice should get you the \"saturation\" of your original module.\n> I suggest you don't call it orthogonal complement. For instance, on vector spaces over finite fields, it's not (but a basis choice still induces an isomorphism to the dual).\n\nThen what do you suggest?  Since this is primarily useful for pedagogical purposes, perhaps we can just raise an error outside of QQ, RR, and friends.  In particular, I think it's definitely appropriate to not allow this for anything but vector spaces.\n\nOne interesting thing is that Sage is already doing something analogous to your suggestion about tensoring in getting the \"basis matrix\", which led to the workaround Travis made.  Then again,\n\n```\nVector space of degree 3 and dimension 2 over Integer Ring\n```\nshouldn't even be legal to appear in Sage, in some sense...",
    "created_at": "2013-04-05T01:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57166",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">Comment 12</div>

> - You only have an orthogonal complement on an inner product space.
> - Whenever you have a canonical isomorphism between a vector space and its dual, you can do the "kernel trick" that you're doing (note you have to take a transpose somewhere). A basis choice induces such a canonical isomorphism, as does an inner product. For every subspace `W subset V` it gives you a complementary subspace `W'` such that V is a direct product of `W` and `W'`.
> - For (free) modules over rings this doesn't really work, because not every submodule is a direct summand.

Aargh!  You had to go remind us of the whole mathematical correctness thing.  You're right, of course.  Not every submodule is projective.
> - Of course, if your ring is a domain, you can tensor with the field of fractions, take the complement, and intersect with the module inside to get another submodule. Doing that twice should get you the "saturation" of your original module.
> I suggest you don't call it orthogonal complement. For instance, on vector spaces over finite fields, it's not (but a basis choice still induces an isomorphism to the dual).

Then what do you suggest?  Since this is primarily useful for pedagogical purposes, perhaps we can just raise an error outside of QQ, RR, and friends.  In particular, I think it's definitely appropriate to not allow this for anything but vector spaces.

One interesting thing is that Sage is already doing something analogous to your suggestion about tensoring in getting the "basis matrix", which led to the workaround Travis made.  Then again,

```
Vector space of degree 3 and dimension 2 over Integer Ring
```
shouldn't even be legal to appear in Sage, in some sense...



---

archive/issue_comments_057167.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@kcrisman](#comment%3A12):\n> Then what do you suggest?  Since this is primarily useful for pedagogical purposes, perhaps we can just raise an error outside of QQ, RR, and friends.\n\nEven there it's only wrt the standard inner product (i.e., if your basis is orthogonal) that this complement is *orthogonal*.\n\nWouldn't just `complement` work? I think that's a reasonably established term for direct cofactor.\n\nAnd indeed, you should probably only offer this for vector spaces, i.e., when the base ring is a field.",
    "created_at": "2013-04-05T03:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57167",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@kcrisman](#comment%3A12):
> Then what do you suggest?  Since this is primarily useful for pedagogical purposes, perhaps we can just raise an error outside of QQ, RR, and friends.

Even there it's only wrt the standard inner product (i.e., if your basis is orthogonal) that this complement is *orthogonal*.

Wouldn't just `complement` work? I think that's a reasonably established term for direct cofactor.

And indeed, you should probably only offer this for vector spaces, i.e., when the base ring is a field.



---

archive/issue_comments_057168.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nFirst, if the ring is not a PID, there are many attributes that are not there anymore (ex. `span()`), so getting the attribute error is consistent with the rest of free modules.\n\nAs for them being inner product spaces, we have this in sage:\n\n```\nsage: F = FreeModule(Integers(8), 3)\nsage: v = F([1, 2, 3])\nsage: v*v\n6\nsage: F.inner_product_matrix()\n[1 0 0]\n[0 1 0]\n[0 0 1]\n```\nso I think sage always assumes it has an inner product (although not necessarily a nice inner product).\n\nFor the\n\n```\nVector space of degree 3 and dimension 2 over Integer Ring\n```\nthat was a doctest error coming from me thinking I know what the output should be >_<.\n\nAnyways, new version of the patch with the method now called `complement()`, removed `perp()`, and only works for vector spaces.\n\nFor patchbot:\n\nApply: trac_7522-perp-ts.patch",
    "created_at": "2013-04-05T16:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57168",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">Comment 14</div>

First, if the ring is not a PID, there are many attributes that are not there anymore (ex. `span()`), so getting the attribute error is consistent with the rest of free modules.

As for them being inner product spaces, we have this in sage:

```
sage: F = FreeModule(Integers(8), 3)
sage: v = F([1, 2, 3])
sage: v*v
6
sage: F.inner_product_matrix()
[1 0 0]
[0 1 0]
[0 0 1]
```
so I think sage always assumes it has an inner product (although not necessarily a nice inner product).

For the

```
Vector space of degree 3 and dimension 2 over Integer Ring
```
that was a doctest error coming from me thinking I know what the output should be >_<.

Anyways, new version of the patch with the method now called `complement()`, removed `perp()`, and only works for vector spaces.

For patchbot:

Apply: trac_7522-perp-ts.patch



---

archive/issue_events_083873.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-05T16:09:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83873"
}
```



---

archive/issue_events_083874.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-05T16:09:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83874"
}
```



---

archive/issue_comments_057169.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nQuestion for Jason and Rob: for teaching linear algebra, would it be useful to have `complement` but not `perp` or `orthogonal_complement`?  I think that the standard basis is always kind of implicit in such situations; we aren't asking for complements with respect to other (orthogonal or not) bases with this function, or at least originally weren't.",
    "created_at": "2013-04-05T17:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57169",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">Comment 15</div>

Question for Jason and Rob: for teaching linear algebra, would it be useful to have `complement` but not `perp` or `orthogonal_complement`?  I think that the standard basis is always kind of implicit in such situations; we aren't asking for complements with respect to other (orthogonal or not) bases with this function, or at least originally weren't.



---

archive/issue_comments_057170.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nRather than testing if the base ring is a field, shouldn't you place the method on `sage.modules.free_module.FreeModule_generic_field` or something like that? The usual idea is to let inheritance take care of which methods are available rather than explicit argument checking wherever possible.",
    "created_at": "2013-04-05T17:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57170",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:16" align="right">Comment 16</div>

Rather than testing if the base ring is a field, shouldn't you place the method on `sage.modules.free_module.FreeModule_generic_field` or something like that? The usual idea is to let inheritance take care of which methods are available rather than explicit argument checking wherever possible.



---

archive/issue_comments_057171.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nAttachment: **[trac_7522-perp-ts.patch.gz](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz)**\n\nHere I was looking for something called `VectorSpace`... Done. Now just waiting on a response from Rob or Jason.",
    "created_at": "2013-04-05T18:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57171",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">Comment 17</div>

Attachment: **[trac_7522-perp-ts.patch.gz](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz)**

Here I was looking for something called `VectorSpace`... Done. Now just waiting on a response from Rob or Jason.



---

archive/issue_comments_057172.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI've just discussed this with Rob and Jason at Sage Days 48.  The consensus is that the solution here is acceptable.\n\nPatchbot, apply: trac_7522-perp-ts.patch",
    "created_at": "2013-06-18T23:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57172",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">Comment 18</div>

I've just discussed this with Rob and Jason at Sage Days 48.  The consensus is that the solution here is acceptable.

Patchbot, apply: trac_7522-perp-ts.patch



---

archive/issue_comments_057173.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Nils Bruin**",
    "created_at": "2013-06-18T23:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57173",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Karl-Dieter Crisman** to **Karl-Dieter Crisman, Nils Bruin**



---

archive/issue_comments_057174.json:
```json
{
    "body": "Changed keywords from none to **sd48**",
    "created_at": "2013-06-18T23:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57174",
    "user": "https://github.com/kcrisman"
}
```

Changed keywords from none to **sd48**



---

archive/issue_comments_057175.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI'm going to add an example pointing out that over a finite field this gives a complement which intersects the original subspace, which 3 people here say is fine (in the sense that it's not wrong, but we should just point out it's not what one might expect from the \"usual\" case).  Nils, is it okay as long as we don't call it orthogonal?",
    "created_at": "2013-06-18T23:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57175",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">Comment 19</div>

I'm going to add an example pointing out that over a finite field this gives a complement which intersects the original subspace, which 3 people here say is fine (in the sense that it's not wrong, but we should just point out it's not what one might expect from the "usual" case).  Nils, is it okay as long as we don't call it orthogonal?



---

archive/issue_comments_057176.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n \n ---\n \n-Apply: [attachment: trac_7522-perp-ts.patch]\n+Apply: [attachment: trac_7522-perp-ts.patch] and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)\n``````\n",
    "created_at": "2013-06-18T23:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57176",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 
 ---
 
-Apply: [attachment: trac_7522-perp-ts.patch]
+Apply: [attachment: trac_7522-perp-ts.patch] and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)
``````




---

archive/issue_comments_057177.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nOkay, Travis and/or Nils and/or anyone else, is this okay?  The terminology is really the issue here, but hopefully this will satisfy everyone.\n\nPatchbot, apply trac_7522-perp-ts.patch and trac_7522-finite.patch",
    "created_at": "2013-06-18T23:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57177",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">Comment 20</div>

Okay, Travis and/or Nils and/or anyone else, is this okay?  The terminology is really the issue here, but hopefully this will satisfy everyone.

Patchbot, apply trac_7522-perp-ts.patch and trac_7522-finite.patch



---

archive/issue_comments_057178.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nThere's a small typo:\n\n```\na a vector\n```\nonce that is fixed, I'm fine with this being set to positive reivew (but I'm probably one of the less opinionated people on this). Feel free to do this on my behalf because I'm going to sleep now to be ready for more Sage Days 49. Hope the 48 is going well.\n\nTravis",
    "created_at": "2013-06-18T23:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57178",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">Comment 21</div>

There's a small typo:

```
a a vector
```
once that is fixed, I'm fine with this being set to positive reivew (but I'm probably one of the less opinionated people on this). Feel free to do this on my behalf because I'm going to sleep now to be ready for more Sage Days 49. Hope the 48 is going well.

Travis



---

archive/issue_comments_057179.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nAttachment: **[trac_7522-finite.patch.gz](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)**\n\nThanks, fixed.\n\nPatchbot, apply trac_7522-perp-ts.patch and trac_7522-finite.patch",
    "created_at": "2013-06-18T23:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57179",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">Comment 22</div>

Attachment: **[trac_7522-finite.patch.gz](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)**

Thanks, fixed.

Patchbot, apply trac_7522-perp-ts.patch and trac_7522-finite.patch



---

archive/issue_comments_057180.json:
```json
{
    "body": "Changed reviewer from **Karl-Dieter Crisman, Nils Bruin** to **Karl-Dieter Crisman, Nils Bruin, Jason Grout, Gregory Bard**",
    "created_at": "2013-06-20T00:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57180",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Karl-Dieter Crisman, Nils Bruin** to **Karl-Dieter Crisman, Nils Bruin, Jason Grout, Gregory Bard**



---

archive/issue_events_083875.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-06-20T00:18:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83875"
}
```



---

archive/issue_events_083876.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-06-20T00:18:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83876"
}
```



---

archive/issue_comments_057181.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n \n ---\n \n-Apply: [attachment: trac_7522-perp-ts.patch] and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)\n+Apply: [attachment: trac_7522-perp-ts.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz) and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)\n``````\n",
    "created_at": "2013-06-20T07:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57181",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 
 ---
 
-Apply: [attachment: trac_7522-perp-ts.patch] and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)
+Apply: [attachment: trac_7522-perp-ts.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-perp-ts.patch.gz) and [attachment: trac_7522-finite.patch](https://github.com/sagemath/sage/files/ticket7522/trac_7522-finite.patch.gz)
``````




---

archive/issue_events_083877.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-20T21:33:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83877"
}
```



---

archive/issue_events_083878.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-20T21:33:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7522#event-83878"
}
```



---

archive/issue_comments_057182.json:
```json
{
    "body": "Merged: **sage-5.11.beta3**",
    "created_at": "2013-06-20T21:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7522#issuecomment-57182",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.11.beta3**
