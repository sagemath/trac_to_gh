# Issue 7344: New libjpeg package

archive/issues_007344.json:
```json
{
    "body": "This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.\n\nThe latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg\n\n**Assignee:** mabshoff\n\n**CC:**  david.kirkby@onetel.net @kcrisman @nexttime\n\n**Keywords:** sd32\n\n**Author:** Tim Dumol\n\n**Resolution:** invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/7344\n\n",
    "closed_at": "2021-09-01T06:17:10Z",
    "created_at": "2009-10-29T04:24:27Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "New libjpeg package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7344",
    "user": "https://github.com/TimDumol"
}
```
This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.

The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg

**Assignee:** mabshoff

**CC:**  david.kirkby@onetel.net @kcrisman @nexttime

**Keywords:** sd32

**Author:** Tim Dumol

**Resolution:** invalid

Issue created by migration from https://trac.sagemath.org/ticket/7344





---

archive/issue_comments_077702.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-11-01T02:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77702",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_077703.json:
```json
{
    "body": "<a id='comment:2'></a>\nThere is an extra file, SPKG.txt~, in the package.\n\nI don't know if this should block its inclusion (I think this should go in as an optional package ASAP so it gets wider testing) but the show function doesn't work on my intel mac, 10.4.11, opening a TIFF file:\n\n```\nsage: import Image\nsage: im = Image.open(\"/Users/mh/Pictures/psym.tiff\")\nsage: print im.format, im.size, im.mode\nTIFF (455, 495) 1\nsage: im.show()\nsage: dyld: Symbol not found: __cg_jpeg_resync_to_restart\n  Referenced from: /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO\n  Expected in: /Volumes/E/sage-4.2.1/local/lib//libJPEG.dylib\n```",
    "created_at": "2009-11-17T15:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77703",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:2'></a>
There is an extra file, SPKG.txt~, in the package.

I don't know if this should block its inclusion (I think this should go in as an optional package ASAP so it gets wider testing) but the show function doesn't work on my intel mac, 10.4.11, opening a TIFF file:

```
sage: import Image
sage: im = Image.open("/Users/mh/Pictures/psym.tiff")
sage: print im.format, im.size, im.mode
TIFF (455, 495) 1
sage: im.show()
sage: dyld: Symbol not found: __cg_jpeg_resync_to_restart
  Referenced from: /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO
  Expected in: /Volumes/E/sage-4.2.1/local/lib//libJPEG.dylib
```



---

archive/issue_comments_077704.json:
```json
{
    "body": "<a id='comment:3'></a>\nOops that was a TIFF example, but it happens with jpegs too:\n\n```\nsage: im = Image.open(\"/Users/mh/Pictures/v2shot.jpg\")\nsage: im.show()\nsage: dyld: Symbol not found: __cg_jpeg_resync_to_restart\n  Referenced from: /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO\n  Expected in: /Volumes/E/sage-4.2.1/local/lib//libJPEG.dylib\n```",
    "created_at": "2009-11-17T15:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77704",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:3'></a>
Oops that was a TIFF example, but it happens with jpegs too:

```
sage: im = Image.open("/Users/mh/Pictures/v2shot.jpg")
sage: im.show()
sage: dyld: Symbol not found: __cg_jpeg_resync_to_restart
  Referenced from: /System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/ImageIO
  Expected in: /Volumes/E/sage-4.2.1/local/lib//libJPEG.dylib
```



---

archive/issue_comments_077705.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe error seems to be an issue with having multiple versions of libjpeg in OS X. Refer to: http://old.nabble.com/dyld:-Symbol-not-found:-__cg_jpeg_resync_to_restart-to9949988.html. I am unsure as to how to fix that problem (I haven ever used a Mac).",
    "created_at": "2009-11-18T15:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77705",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:4'></a>
The error seems to be an issue with having multiple versions of libjpeg in OS X. Refer to: http://old.nabble.com/dyld:-Symbol-not-found:-__cg_jpeg_resync_to_restart-to9949988.html. I am unsure as to how to fix that problem (I haven ever used a Mac).



---

archive/issue_comments_077706.json:
```json
{
    "body": "<a id='comment:5'></a>\nA new version without SPKG.txt~ is up at http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg.",
    "created_at": "2009-11-18T15:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77706",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:5'></a>
A new version without SPKG.txt~ is up at http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg.



---

archive/issue_comments_077707.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.\n \n-The package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p0.spkg\n+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg\n``````\n",
    "created_at": "2009-11-18T15:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77707",
    "user": "https://github.com/TimDumol"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.
 
-The package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p0.spkg
+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg
``````




---

archive/issue_comments_077708.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis needs checking on Solaris",
    "created_at": "2009-12-03T05:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77708",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:6'></a>
This needs checking on Solaris



---

archive/issue_comments_077709.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2009-12-03T05:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77709",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Upstream:** N/A



---

archive/issue_comments_077710.json:
```json
{
    "body": "<a id='comment:7'></a>\nWhen I try an example like mhampton's above (`im = Image.open(...), im.show()`, I get the message\n\n```\nImportError: The _imaging C module is not installed\n```\n(This is on OS X 10.6.)  Is this an issue?",
    "created_at": "2009-12-22T06:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77710",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
When I try an example like mhampton's above (`im = Image.open(...), im.show()`, I get the message

```
ImportError: The _imaging C module is not installed
```
(This is on OS X 10.6.)  Is this an issue?



---

archive/issue_comments_077711.json:
```json
{
    "body": "<a id='comment:8'></a>\nSorry, I did not  set up email notifications until recently, so cc'ing me did not help. I only stumbled across this when looking for tickets to review. I will check it on Solaris. \n\nDave",
    "created_at": "2010-01-10T04:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77711",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>
Sorry, I did not  set up email notifications until recently, so cc'ing me did not help. I only stumbled across this when looking for tickets to review. I will check it on Solaris. 

Dave



---

archive/issue_comments_077712.json:
```json
{
    "body": "<a id='comment:9'></a>\nA few points looking at spkg-install, which is overly complicated following recent updates to sage-env. \n\n* The recent changes to sage-env (#7818) will mean a **lot** of spkg-install can be removed. In particular most, if not all the SAGE64 stuff, as sage-env will automatically add the right flags to CFLAGS, CXFLAGS etc for a 64-bit build. It will not do this (yet) for LDFLAGS so it **may** be necessary to add that, but I'm not convinced it will be necessary. It needs testing on bsd.math without the LD flags set. If it builds, then forgot it all. If it needs LDFLAGS to have -m64, replace -m64 with \n\n```\nif [ \"x$SAGE64\" = xyes ] ; then\n  LDFLAGS=\"$LDFLAGS $CFLAG64\" \n  export $LDFLAGS\nfi\n```\nthen it will work irrespective of the flag needed to generate 64-bit binaries. (Not all compilers need -m64, as others use -q64 and other flags). I'm not totally convinced LDFLAGS ever needs -m64, as I believe LDFLAGS gets passed to the linker. No linker I am aware of has the -m64 option (check GNU binutils manual if you wish). But I'm not 100% sure it is never needed. I think the right flag if needed is -64 for the GNU linker, but it is rarely needed, as normally the linker can work out whether a 32 or 64 bit binary is needed, based on the object files. The exception is when creasting shared libraries from archives, where the linker may not be able to determine this.\n* Remove the checks for the Sun compiler and adding -Wall with gcc. The updates to sage-env will add the -Wall for you with gcc. \n* Remove the checks to see if there is a mix of Sun and GNU compilers - that is taken care of elsewhere now. \n\n* Unless there is good reason, remove the \n\n```\n: ${CP=cp}; CP=\"$CP -f\"; export CP\n: ${MV=mv}; MV=\"$MV -f\"; export MV\n: ${RM=rm}; RM=\"$RM -f\"; export RM\n```\nas it was agreed recently (see sage-devel) that there is no need for there to be variables for very basic commands. However, if the source code makes use of $CP etc, then they might have to stay. But if possible, just use mv, cp etc. \n\n* Someting called 'CC' is used here. I'm not sure what that is, but be aware the Sun C++ compiler is called 'CC' so there might be a name clash. Make sure the absolute path to CC is specified if it's not already done, otherwise it may break if the Sun C++ compiler is in the path. \n\n* Give me a day or so, and I'll put on sage-devel a **considerably** simpler skeleton spkg-install which will remove 95% of this. \n\nIt does actually build on Solaris, but the spkg-install could be reduced considerably in size, as most of these checks are now done in once place. \n\nI'll help you do this. \n\nDave",
    "created_at": "2010-01-10T05:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77712",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>
A few points looking at spkg-install, which is overly complicated following recent updates to sage-env. 

* The recent changes to sage-env (#7818) will mean a **lot** of spkg-install can be removed. In particular most, if not all the SAGE64 stuff, as sage-env will automatically add the right flags to CFLAGS, CXFLAGS etc for a 64-bit build. It will not do this (yet) for LDFLAGS so it **may** be necessary to add that, but I'm not convinced it will be necessary. It needs testing on bsd.math without the LD flags set. If it builds, then forgot it all. If it needs LDFLAGS to have -m64, replace -m64 with 

```
if [ "x$SAGE64" = xyes ] ; then
  LDFLAGS="$LDFLAGS $CFLAG64" 
  export $LDFLAGS
fi
```
then it will work irrespective of the flag needed to generate 64-bit binaries. (Not all compilers need -m64, as others use -q64 and other flags). I'm not totally convinced LDFLAGS ever needs -m64, as I believe LDFLAGS gets passed to the linker. No linker I am aware of has the -m64 option (check GNU binutils manual if you wish). But I'm not 100% sure it is never needed. I think the right flag if needed is -64 for the GNU linker, but it is rarely needed, as normally the linker can work out whether a 32 or 64 bit binary is needed, based on the object files. The exception is when creasting shared libraries from archives, where the linker may not be able to determine this.
* Remove the checks for the Sun compiler and adding -Wall with gcc. The updates to sage-env will add the -Wall for you with gcc. 
* Remove the checks to see if there is a mix of Sun and GNU compilers - that is taken care of elsewhere now. 

* Unless there is good reason, remove the 

```
: ${CP=cp}; CP="$CP -f"; export CP
: ${MV=mv}; MV="$MV -f"; export MV
: ${RM=rm}; RM="$RM -f"; export RM
```
as it was agreed recently (see sage-devel) that there is no need for there to be variables for very basic commands. However, if the source code makes use of $CP etc, then they might have to stay. But if possible, just use mv, cp etc. 

* Someting called 'CC' is used here. I'm not sure what that is, but be aware the Sun C++ compiler is called 'CC' so there might be a name clash. Make sure the absolute path to CC is specified if it's not already done, otherwise it may break if the Sun C++ compiler is in the path. 

* Give me a day or so, and I'll put on sage-devel a **considerably** simpler skeleton spkg-install which will remove 95% of this. 

It does actually build on Solaris, but the spkg-install could be reduced considerably in size, as most of these checks are now done in once place. 

I'll help you do this. 

Dave



---

archive/issue_comments_077713.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-01-10T05:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77713",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_077714.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [drkirkby](#comment%3A9):\n> [...]\n> * Give me a day or so, and I'll put on sage-devel a **considerably** simpler skeleton spkg-install which will remove 95% of this. \n> \n> It does actually build on Solaris, but the spkg-install could be reduced considerably in size, as most of these checks are now done in once place. \n> \n> I'll help you do this. \n> \n> Dave \n> \n>  \n\n\nPerfect, thanks. The libjpeg makefile actually uses $CP, $RM and $MV, so that section can't be removed.",
    "created_at": "2010-01-10T05:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77714",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:10'></a>
Replying to [drkirkby](#comment%3A9):
> [...]
> * Give me a day or so, and I'll put on sage-devel a **considerably** simpler skeleton spkg-install which will remove 95% of this. 
> 
> It does actually build on Solaris, but the spkg-install could be reduced considerably in size, as most of these checks are now done in once place. 
> 
> I'll help you do this. 
> 
> Dave 
> 
>  


Perfect, thanks. The libjpeg makefile actually uses $CP, $RM and $MV, so that section can't be removed.



---

archive/attachments_008814.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "spkg-install",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7344/spkg-install",
    "created_at": "2010-01-11T20:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```



---

archive/issue_comments_077715.json:
```json
{
    "body": "",
    "created_at": "2010-01-11T20:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77715",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```





---

archive/issue_comments_077716.json:
```json
{
    "body": "<a id='comment:11'></a>\nI've looked at this, and have attached a revised spkg-install, which is a lot simpler. However, there are some odd things about this. \n\n* Why is the package called libjpeg-7.p1, rather than libjpeg-7 ? The .p0 is appended when a patch is applied, .p1 is used when a second patch is applied. This would therefore imply it's been patched twice, whereas in fact it has not. \n* There is no need for a patches directory when there are no patches.\n* What is the purpose of this code \n\n```\n: ${CP=cp}; CP=\"$CP -f\"; export CP\n: ${MV=mv}; MV=\"$MV -f\"; export MV\n: ${RM=rm}; RM=\"$RM -f\"; export RM\n```\n\nI just took the libjpeg source code, then built it with:\n\n```\n$ ./configure --prefix=/tmp\n$ make \n$ make install\n```\nand it all went ok, without me having to override 'cp', 'mv' or 'rm'. \n\n* You would need to get William or someone else to look over the license. I know there is one requirement there, which is not a requirement of the GPL. That is, if you use their code, you must acknowledge them. Having had some GPL'ed code of mine ripped off without acknowledgment, I was a bit annoyed, but I've been told there is no requirement to acknowledge anyone if you use their GPL code. I am not a lawyer are more interested in the technical aspects than license conditions, but someone would need to verify this license is compatible. \n\nIn the attacked in spkg-install I've left all the overriding of cp, but I don't feel it should be necessary. \n\nDave",
    "created_at": "2010-01-11T20:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77716",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
I've looked at this, and have attached a revised spkg-install, which is a lot simpler. However, there are some odd things about this. 

* Why is the package called libjpeg-7.p1, rather than libjpeg-7 ? The .p0 is appended when a patch is applied, .p1 is used when a second patch is applied. This would therefore imply it's been patched twice, whereas in fact it has not. 
* There is no need for a patches directory when there are no patches.
* What is the purpose of this code 

```
: ${CP=cp}; CP="$CP -f"; export CP
: ${MV=mv}; MV="$MV -f"; export MV
: ${RM=rm}; RM="$RM -f"; export RM
```

I just took the libjpeg source code, then built it with:

```
$ ./configure --prefix=/tmp
$ make 
$ make install
```
and it all went ok, without me having to override 'cp', 'mv' or 'rm'. 

* You would need to get William or someone else to look over the license. I know there is one requirement there, which is not a requirement of the GPL. That is, if you use their code, you must acknowledge them. Having had some GPL'ed code of mine ripped off without acknowledgment, I was a bit annoyed, but I've been told there is no requirement to acknowledge anyone if you use their GPL code. I am not a lawyer are more interested in the technical aspects than license conditions, but someone would need to verify this license is compatible. 

In the attacked in spkg-install I've left all the overriding of cp, but I don't feel it should be necessary. 

Dave



---

archive/issue_comments_077717.json:
```json
{
    "body": "<a id='comment:12'></a>\nSee also [here](http://groups.google.com/group/sage-devel/browse_frm/thread/48f720062cc4e38b/ff817dfb819e5ce).",
    "created_at": "2010-08-02T17:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77717",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
See also [here](http://groups.google.com/group/sage-devel/browse_frm/thread/48f720062cc4e38b/ff817dfb819e5ce).



---

archive/issue_comments_077718.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-08-17T18:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77718",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_077719.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.\n \n-The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg\n+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg\n``````\n",
    "created_at": "2010-08-17T18:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77719",
    "user": "https://github.com/TimDumol"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.
 
-The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p1.spkg
+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg
``````




---

archive/issue_comments_077720.json:
```json
{
    "body": "<a id='comment:13'></a>\nNew package version here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg\n\nAs stated in #7818, some makefiles depend on $RM being unset or set to \"rm -f\". The above code overrides any $RM setting, which otherwise causes compilation failure (at least for me).\n\nI am unsure of the GPL compatibility of libjpeg's licensing, but this message on: http://www.mail-archive.com/mozilla-license@mozilla.org/msg00143.html seems to suggest that it is widely considered GPL compatible. Otherwise, we may want to consider libjpeg-turbo (http://sourceforge.net/projects/libjpeg-turbo/) and patch PIL to use that.\n\nRegarding review of this package:\n\nThe package may be reviewed by using the PIL package, as above:\n\n```\nsage: import Image\nsage: im = Image.open(\"<your-jpeg-file-here>\")\nsage: im.resize((im.size[0]/2,im.size[1]/2))\nsage: print im.format, im.size, im.mode\nTIFF (455, 495) 1\nsage: im.show()\nsage: im.save(\"wherever.jpg\")\n```",
    "created_at": "2010-08-17T18:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77720",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:13'></a>
New package version here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg

As stated in #7818, some makefiles depend on $RM being unset or set to "rm -f". The above code overrides any $RM setting, which otherwise causes compilation failure (at least for me).

I am unsure of the GPL compatibility of libjpeg's licensing, but this message on: http://www.mail-archive.com/mozilla-license@mozilla.org/msg00143.html seems to suggest that it is widely considered GPL compatible. Otherwise, we may want to consider libjpeg-turbo (http://sourceforge.net/projects/libjpeg-turbo/) and patch PIL to use that.

Regarding review of this package:

The package may be reviewed by using the PIL package, as above:

```
sage: import Image
sage: im = Image.open("<your-jpeg-file-here>")
sage: im.resize((im.size[0]/2,im.size[1]/2))
sage: print im.format, im.size, im.mode
TIFF (455, 495) 1
sage: im.show()
sage: im.save("wherever.jpg")
```



---

archive/issue_comments_077721.json:
```json
{
    "body": "<a id='comment:14'></a>\n(I could have deleted Dave from the cc-list, but just added the missing trailing \"t\"...)",
    "created_at": "2010-09-03T21:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77721",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
(I could have deleted Dave from the cc-list, but just added the missing trailing "t"...)



---

archive/issue_comments_077722.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [timdumol](#comment%3A13):\n> New package version here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg\n> \n> As stated in #7818, some makefiles depend on $RM being unset or set to \"rm -f\". The above code overrides any $RM setting, which otherwise causes compilation failure (at least for me).\n\n\nThere's a much simpler way to unset RM than use\n\n```\n: ${RM=rm}; RM=\"$RM -f\"; export RM\n```\n\none can use:\n\n```\nunset RM\n```\n\nIf a Makefile needs RM set, I feel it would be better to fix the Makefile and report that upstream. Likewise if a Makefile needs `rm -f`, it should use `rm -f`",
    "created_at": "2011-04-08T08:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77722",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>
Replying to [timdumol](#comment%3A13):
> New package version here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg
> 
> As stated in #7818, some makefiles depend on $RM being unset or set to "rm -f". The above code overrides any $RM setting, which otherwise causes compilation failure (at least for me).


There's a much simpler way to unset RM than use

```
: ${RM=rm}; RM="$RM -f"; export RM
```

one can use:

```
unset RM
```

If a Makefile needs RM set, I feel it would be better to fix the Makefile and report that upstream. Likewise if a Makefile needs `rm -f`, it should use `rm -f`



---

archive/issue_comments_077723.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-05-13T13:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77723",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_077724.json:
```json
{
    "body": "<a id='comment:16'></a>\nIf this package causes compilation failure, then it needs work, not\nreview.",
    "created_at": "2011-05-13T13:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77724",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:16'></a>
If this package causes compilation failure, then it needs work, not
review.



---

archive/issue_comments_077725.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-08-02T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77725",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_077726.json:
```json
{
    "body": "<a id='comment:17'></a>\n.p1 gave compilation failure. .p2 fixes it.",
    "created_at": "2011-08-02T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77726",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:17'></a>
.p1 gave compilation failure. .p2 fixes it.



---

archive/issue_comments_077727.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-08-02T21:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77727",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_077728.json:
```json
{
    "body": "<a id='comment:18'></a>\nIt seems that libjpeg's license is not compatible with GPL, according to: http://www.thomasalspaugh.org/pub/osl-sps/libjpeg8c.html. Also, libjpeg-turbo seems to be significantly faster than libjpeg, while being licensed under GPL. I'm making a package for that now.",
    "created_at": "2011-08-02T21:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77728",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:18'></a>
It seems that libjpeg's license is not compatible with GPL, according to: http://www.thomasalspaugh.org/pub/osl-sps/libjpeg8c.html. Also, libjpeg-turbo seems to be significantly faster than libjpeg, while being licensed under GPL. I'm making a package for that now.



---

archive/issue_comments_077729.json:
```json
{
    "body": "<a id='comment:19'></a>\nHere is the new libjpeg-turbo package: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg",
    "created_at": "2011-08-02T22:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77729",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:19'></a>
Here is the new libjpeg-turbo package: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg



---

archive/issue_comments_077730.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.\n \n-The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg\n+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg\n``````\n",
    "created_at": "2011-08-02T22:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77730",
    "user": "https://github.com/TimDumol"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This is used by PIL (c.f. #7273). Inclusion as an optional or even as a standard package would be helpful.
 
-The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg-7.p2.spkg
+The latest version of the package is here: http://sage.math.washington.edu/home/timdumol/libjpeg_turbo-1.1.1.spkg
``````




---

archive/issue_comments_077731.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-08-02T22:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77731",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_077732.json:
```json
{
    "body": "<a id='comment:20'></a>\nReview instructions are as above. This definitely needs testing on a Mac, as I am unsure as to whether the patches that were included in the libjpeg package are required for libjpeg-turbo. This version does not include those patches.",
    "created_at": "2011-08-02T22:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77732",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:20'></a>
Review instructions are as above. This definitely needs testing on a Mac, as I am unsure as to whether the patches that were included in the libjpeg package are required for libjpeg-turbo. This version does not include those patches.



---

archive/issue_comments_077733.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis fails to build on my OS X box. Here is the tail end of the log:\n\n```\nchecking whether to use version script when building libjpeg-turbo... yes\nchecking whether to include arithmetic encoding support... yes\nchecking whether to include arithmetic decoding support... yes\nchecking if we have SIMD optimisations for cpu type... yes (i386)\nchecking for nasm... nasm\nchecking for object file format of host system... Mach-O\nchecking for object file format specifier (NAFLAGS) ... -fmacho -DMACHO\nchecking whether the assembler (nasm -fmacho -DMACHO) works... yes\nchecking whether the linker accepts assembler output... no\nconfigure: error: configuration problem: maybe object file format mismatch.\nFailed to configure libjpeg ... exiting\n```",
    "created_at": "2011-08-02T23:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77733",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
This fails to build on my OS X box. Here is the tail end of the log:

```
checking whether to use version script when building libjpeg-turbo... yes
checking whether to include arithmetic encoding support... yes
checking whether to include arithmetic decoding support... yes
checking if we have SIMD optimisations for cpu type... yes (i386)
checking for nasm... nasm
checking for object file format of host system... Mach-O
checking for object file format specifier (NAFLAGS) ... -fmacho -DMACHO
checking whether the assembler (nasm -fmacho -DMACHO) works... yes
checking whether the linker accepts assembler output... no
configure: error: configuration problem: maybe object file format mismatch.
Failed to configure libjpeg ... exiting
```



---

archive/issue_comments_077734.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-08-02T23:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77734",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_077735.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [jhpalmieri](#comment%3A21):\n> This fails to build on my OS X box. Here is the tail end of the log:\n\n\nHaven't looked at the spkg yet, but perhaps attach your `config.log`; I'm not sure if (i.e., rather doubt that) we intend to use `nasm` at all, which probably requires some additional `configure` option (if `nasm` is installed) or perhaps setting `AS`.",
    "created_at": "2011-08-03T00:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77735",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [jhpalmieri](#comment%3A21):
> This fails to build on my OS X box. Here is the tail end of the log:


Haven't looked at the spkg yet, but perhaps attach your `config.log`; I'm not sure if (i.e., rather doubt that) we intend to use `nasm` at all, which probably requires some additional `configure` option (if `nasm` is installed) or perhaps setting `AS`.



---

archive/issue_comments_077736.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [leif](#comment%3A22):\n> Replying to [jhpalmieri](#comment%3A21):\n> > This fails to build on my OS X box. Here is the tail end of the log:\n\n> \n> Haven't looked at the spkg yet, but perhaps attach your `config.log`\n\n\nI've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).",
    "created_at": "2011-08-03T03:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77736",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
Replying to [leif](#comment%3A22):
> Replying to [jhpalmieri](#comment%3A21):
> > This fails to build on my OS X box. Here is the tail end of the log:

> 
> Haven't looked at the spkg yet, but perhaps attach your `config.log`


I've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).



---

archive/issue_comments_077737.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jhpalmieri](#comment%3A23):\n> I've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).\n\n\nHmmm, the error is just that `nasm` doesn't produce 64-bit object files by default. (`configure` should notice that, and use `-fmacho64` instead of `-fmacho`.)\n\nJohn, did you set `SAGE64=yes`?\n\nHaven't yet looked if there are further `configure` options (`./configure --help` doesn't show appropriate ones), or what happens if `nasm` isn't installed. (Guess it then just defaults to C implementations rather than using GCC with inline assembly; MacOS X / XCode doesn't have a `gas` IIRC.)\n\n---\n\nBtw., there's crap in the spkg, and I can't read the Mercurial files:\n\n```sh\n$ ls -a\n.   .hg        .hgignore~     spkg-install       SPKG.txt       src\n..  .hgignore  .hgignore.swp  .spkg-install.swp  .SPKG.txt.swp\n$ hg log ; hg status\nabort: requirement 'dotencode' not supported!\nabort: requirement 'dotencode' not supported!\n```\n\nAlso, unfortunately Tim has deleted the old \"patches\" that were applied on MacOS X\n\n```sh\n# This was needed for libjpeg. Is this needed for libjpeg-turbo?\n#if [ -n \"`uname -s | grep Darwin`\" ]; then\n#   $CP ../patches/config.sub .\n#   $CP ../patches/config.guess .\n#   # Required for Mac OS (http://jetfar.com/libjpeg-and-python-imaging-pil-on-snow-leopard/)\n#   ./configure --enable-shared --enable-static --prefix=\"$SAGE_LOCAL\"\n#else\n./configure --prefix=\"$SAGE_LOCAL\"\n#fi\n```\nthough that's not necessarily the problem.",
    "created_at": "2011-08-03T05:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77737",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Replying to [jhpalmieri](#comment%3A23):
> I've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).


Hmmm, the error is just that `nasm` doesn't produce 64-bit object files by default. (`configure` should notice that, and use `-fmacho64` instead of `-fmacho`.)

John, did you set `SAGE64=yes`?

Haven't yet looked if there are further `configure` options (`./configure --help` doesn't show appropriate ones), or what happens if `nasm` isn't installed. (Guess it then just defaults to C implementations rather than using GCC with inline assembly; MacOS X / XCode doesn't have a `gas` IIRC.)

---

Btw., there's crap in the spkg, and I can't read the Mercurial files:

```sh
$ ls -a
.   .hg        .hgignore~     spkg-install       SPKG.txt       src
..  .hgignore  .hgignore.swp  .spkg-install.swp  .SPKG.txt.swp
$ hg log ; hg status
abort: requirement 'dotencode' not supported!
abort: requirement 'dotencode' not supported!
```

Also, unfortunately Tim has deleted the old "patches" that were applied on MacOS X

```sh
# This was needed for libjpeg. Is this needed for libjpeg-turbo?
#if [ -n "`uname -s | grep Darwin`" ]; then
#   $CP ../patches/config.sub .
#   $CP ../patches/config.guess .
#   # Required for Mac OS (http://jetfar.com/libjpeg-and-python-imaging-pil-on-snow-leopard/)
#   ./configure --enable-shared --enable-static --prefix="$SAGE_LOCAL"
#else
./configure --prefix="$SAGE_LOCAL"
#fi
```
though that's not necessarily the problem.



---

archive/issue_comments_077738.json:
```json
{
    "body": "<a id='comment:25'></a>\n> John, did you set SAGE64=yes?\n\n\nI hadn't, because with OS X 10.6 on 64-bit machines, it shouldn't be necessary.  I just tried it anyway, and got the same result.\n\nThe file BUILDING.txt in the src directory says this:\n\n```\n-- NASM\n   * 0.98, or 2.01 or later is required for a 32-bit build\n   * NASM 2.00 or later is required for a 64-bit build\n   * NASM 2.07 or later is required for a 64-bit build on OS X.  This can be\n     obtained from MacPorts (http://www.macports.org/).\n```\nThe default version of nasm seems to be 0.98.40, or at least that's what I have installed.  The same file also says this; perhaps this is the way to go:\n\n```\n32-bit Library Build on 64-bit OS X\n-----------------------------------\n\nAdd\n\n  CFLAGS='-O3 -m32' LDFLAGS=-m32\n\nto the configure command line.\n```\nIf I configure with those options, it seems to succeed.  That is, I ran \"sage -sh\", then changed to the directory `sage/spkg/build/libjpeg_turbo-1.1.1/src` and ran\n\n```\nCFLAGS='-O3 -m32' LDFLAGS=-m32 ./configure --prefix=/Applications/sage/local\n```\nThen `make` succeeded.  I haven't tried `make install` or testing it inside of Sage.",
    "created_at": "2011-08-03T05:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77738",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
> John, did you set SAGE64=yes?


I hadn't, because with OS X 10.6 on 64-bit machines, it shouldn't be necessary.  I just tried it anyway, and got the same result.

The file BUILDING.txt in the src directory says this:

```
-- NASM
   * 0.98, or 2.01 or later is required for a 32-bit build
   * NASM 2.00 or later is required for a 64-bit build
   * NASM 2.07 or later is required for a 64-bit build on OS X.  This can be
     obtained from MacPorts (http://www.macports.org/).
```
The default version of nasm seems to be 0.98.40, or at least that's what I have installed.  The same file also says this; perhaps this is the way to go:

```
32-bit Library Build on 64-bit OS X
-----------------------------------

Add

  CFLAGS='-O3 -m32' LDFLAGS=-m32

to the configure command line.
```
If I configure with those options, it seems to succeed.  That is, I ran "sage -sh", then changed to the directory `sage/spkg/build/libjpeg_turbo-1.1.1/src` and ran

```
CFLAGS='-O3 -m32' LDFLAGS=-m32 ./configure --prefix=/Applications/sage/local
```
Then `make` succeeded.  I haven't tried `make install` or testing it inside of Sage.



---

archive/issue_comments_077739.json:
```json
{
    "body": "<a id='comment:26'></a>\n> perhaps this is the way to go\n\n\nOr maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build, but it doesn't seem to work in Sage: it keeps telling me \"IOError: decoder jpeg not available\".  Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)",
    "created_at": "2011-08-03T05:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77739",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
> perhaps this is the way to go


Or maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build, but it doesn't seem to work in Sage: it keeps telling me "IOError: decoder jpeg not available".  Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)



---

archive/issue_comments_077740.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> Or maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build\n\n\nYeah, you cannot use both 32- and 64-bit libraries or modules within / from the same executable.\n\n> Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)\n\n\nI wonder if it builds (on MacOS X) without assembly parts (perhaps with `--without-simd` passed to `configure`), as I mentioned above.\n\n(You could also try temporarily \"removing\" `nasm` by renaming it to something obscure and then run `./configure`.)\n\nIf `libjpeg` stays an optional package, we could of course also add an optional `nasm` package (if the licence allows this), but I won't add more (binary?) standard spkgs just to accomplish prerequisites. Fortran is IMHO bad enough.\n\nOr we have to resort to some other (upstream) `libjpeg` package.",
    "created_at": "2011-08-03T06:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77740",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A26):
> Or maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build


Yeah, you cannot use both 32- and 64-bit libraries or modules within / from the same executable.

> Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)


I wonder if it builds (on MacOS X) without assembly parts (perhaps with `--without-simd` passed to `configure`), as I mentioned above.

(You could also try temporarily "removing" `nasm` by renaming it to something obscure and then run `./configure`.)

If `libjpeg` stays an optional package, we could of course also add an optional `nasm` package (if the licence allows this), but I won't add more (binary?) standard spkgs just to accomplish prerequisites. Fortran is IMHO bad enough.

Or we have to resort to some other (upstream) `libjpeg` package.



---

archive/issue_comments_077741.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [leif](#comment%3A27):\n> I wonder if it builds (on MacOS X) without assembly parts (perhaps with `--without-simd` passed to `configure`), as I mentioned above.\n\n\nYep, configuring with `--without-simd` should work, as the only assembler source files are all in `src/simd/`.",
    "created_at": "2011-08-03T06:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77741",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
Replying to [leif](#comment%3A27):
> I wonder if it builds (on MacOS X) without assembly parts (perhaps with `--without-simd` passed to `configure`), as I mentioned above.


Yep, configuring with `--without-simd` should work, as the only assembler source files are all in `src/simd/`.



---

archive/issue_comments_077742.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [leif](#comment%3A24):\n> Replying to [jhpalmieri](#comment%3A23):\n> > I've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).\n\n> \n> Hmmm, the error is just that `nasm` doesn't produce 64-bit object files by default. (`configure` should notice that, and use `-fmacho64` instead of `-fmacho`.)\n> \n> John, did you set `SAGE64=yes`?\n> \n> Haven't yet looked if there are further `configure` options (`./configure --help` doesn't show appropriate ones), or what happens if `nasm` isn't installed. (Guess it then just defaults to C implementations rather than using GCC with inline assembly; MacOS X / XCode doesn't have a `gas` IIRC.)\n> \n> \n> ---\n> \n> Btw., there's crap in the spkg, and I can't read the Mercurial files:\n> \n> ```sh\n> $ ls -a\n> .   .hg        .hgignore~     spkg-install       SPKG.txt       src\n> ..  .hgignore  .hgignore.swp  .spkg-install.swp  .SPKG.txt.swp\n> $ hg log ; hg status\n> abort: requirement 'dotencode' not supported!\n> abort: requirement 'dotencode' not supported!\n> ```\n\n\nSorry, I used a pretty recent version of Mercurial to create the repository, and it seems that it is backwards incompatible. I'll use `sage -hg` instead. I'll delete the trash files.\n\n> \n> Also, unfortunately Tim has deleted the old \"patches\" that were applied on MacOS X\n> \n> ```sh\n> # This was needed for libjpeg. Is this needed for libjpeg-turbo?\n> #if [ -n \"`uname -s | grep Darwin`\" ]; then\n> #   $CP ../patches/config.sub .\n> #   $CP ../patches/config.guess .\n> #   # Required for Mac OS (http://jetfar.com/libjpeg-and-python-imaging-pil-on-snow-leopard/)\n> #   ./configure --enable-shared --enable-static --prefix=\"$SAGE_LOCAL\"\n> #else\n> ./configure --prefix=\"$SAGE_LOCAL\"\n> #fi\n> ```\n> though that's not necessarily the problem.\n",
    "created_at": "2011-08-03T09:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77742",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:29'></a>
Replying to [leif](#comment%3A24):
> Replying to [jhpalmieri](#comment%3A23):
> > I've posted it here: [http://sage.math.washington.edu/home/palmieri/misc/config.log](http://sage.math.washington.edu/home/palmieri/misc/config.log).

> 
> Hmmm, the error is just that `nasm` doesn't produce 64-bit object files by default. (`configure` should notice that, and use `-fmacho64` instead of `-fmacho`.)
> 
> John, did you set `SAGE64=yes`?
> 
> Haven't yet looked if there are further `configure` options (`./configure --help` doesn't show appropriate ones), or what happens if `nasm` isn't installed. (Guess it then just defaults to C implementations rather than using GCC with inline assembly; MacOS X / XCode doesn't have a `gas` IIRC.)
> 
> 
> ---
> 
> Btw., there's crap in the spkg, and I can't read the Mercurial files:
> 
> ```sh
> $ ls -a
> .   .hg        .hgignore~     spkg-install       SPKG.txt       src
> ..  .hgignore  .hgignore.swp  .spkg-install.swp  .SPKG.txt.swp
> $ hg log ; hg status
> abort: requirement 'dotencode' not supported!
> abort: requirement 'dotencode' not supported!
> ```


Sorry, I used a pretty recent version of Mercurial to create the repository, and it seems that it is backwards incompatible. I'll use `sage -hg` instead. I'll delete the trash files.

> 
> Also, unfortunately Tim has deleted the old "patches" that were applied on MacOS X
> 
> ```sh
> # This was needed for libjpeg. Is this needed for libjpeg-turbo?
> #if [ -n "`uname -s | grep Darwin`" ]; then
> #   $CP ../patches/config.sub .
> #   $CP ../patches/config.guess .
> #   # Required for Mac OS (http://jetfar.com/libjpeg-and-python-imaging-pil-on-snow-leopard/)
> #   ./configure --enable-shared --enable-static --prefix="$SAGE_LOCAL"
> #else
> ./configure --prefix="$SAGE_LOCAL"
> #fi
> ```
> though that's not necessarily the problem.




---

archive/issue_comments_077743.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> > perhaps this is the way to go\n\n> \n> Or maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build, but it doesn't seem to work in Sage: it keeps telling me \"IOError: decoder jpeg not available\".  Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)\n\n\nI am uncertain, but I believe that you need to reinstall PIL (sage -f pil) in order to enable JPEG capabilities.",
    "created_at": "2011-08-03T09:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77743",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:30'></a>
Replying to [jhpalmieri](#comment%3A26):
> > perhaps this is the way to go

> 
> Or maybe not; either I did something wrong or I can't use the 32-bit library in the 64-bit Sage build, but it doesn't seem to work in Sage: it keeps telling me "IOError: decoder jpeg not available".  Maybe we should require nasm as a prerequisite on 64-bit OS X.  (That could be another spkg.)


I am uncertain, but I believe that you need to reinstall PIL (sage -f pil) in order to enable JPEG capabilities.



---

archive/issue_comments_077744.json:
```json
{
    "body": "<a id='comment:31'></a>\nI think we should simply check whether `nasm` is installed (`command -v nasm >/dev/null`), and if so, its version (`nasm -v`), and then -- depending on the operating system (especially 32-bit vs. 64-bit on Darwin) -- decide whether we configure with `--without-simd` or not.\n\nThis should work on all platforms, and this way machines having (at least) the required version installed won't suffer from not using faster implementations.\n\nIf `SAGE_FAT_BINARY=yes`, we should perhaps disable it too.\n\nAccording to the docs, it might also be necessary to either pass `--build=...` or update the **very old** `config.guess`, at least on / for 64-bit Darwin (MacOS X >=10.6, or 10.5 if `SAGE64=yes`). Maybe setting `ABI` accordingly also works.",
    "created_at": "2011-08-03T11:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77744",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>
I think we should simply check whether `nasm` is installed (`command -v nasm >/dev/null`), and if so, its version (`nasm -v`), and then -- depending on the operating system (especially 32-bit vs. 64-bit on Darwin) -- decide whether we configure with `--without-simd` or not.

This should work on all platforms, and this way machines having (at least) the required version installed won't suffer from not using faster implementations.

If `SAGE_FAT_BINARY=yes`, we should perhaps disable it too.

According to the docs, it might also be necessary to either pass `--build=...` or update the **very old** `config.guess`, at least on / for 64-bit Darwin (MacOS X >=10.6, or 10.5 if `SAGE64=yes`). Maybe setting `ABI` accordingly also works.



---

archive/issue_comments_077745.json:
```json
{
    "body": "<a id='comment:32'></a>\nBuilding with `--without-simd` and then reinstalling PIL allows me to execute the code above (although `im.format` is `None`).",
    "created_at": "2011-08-03T15:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77745",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
Building with `--without-simd` and then reinstalling PIL allows me to execute the code above (although `im.format` is `None`).



---

archive/issue_comments_077746.json:
```json
{
    "body": "<a id='comment:33'></a>\nAs with the spkg at #7345, you should also provide a patch to the scripts repo, adding the appropriate files to .hgignore there.",
    "created_at": "2011-08-03T22:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77746",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>
As with the spkg at #7345, you should also provide a patch to the scripts repo, adding the appropriate files to .hgignore there.



---

archive/issue_comments_077747.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jhpalmieri](#comment%3A33):\n> As with the spkg at #7345, you should also provide a patch to the scripts repo, adding the appropriate files to .hgignore there.\n\n\n... if we really want to install any executables as well.\n\nUsing them from Sage would certainly be inefficient, and `local/bin/` is already filled up with a lot of .... useful tools.",
    "created_at": "2011-08-04T11:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77747",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:34'></a>
Replying to [jhpalmieri](#comment%3A33):
> As with the spkg at #7345, you should also provide a patch to the scripts repo, adding the appropriate files to .hgignore there.


... if we really want to install any executables as well.

Using them from Sage would certainly be inefficient, and `local/bin/` is already filled up with a lot of .... useful tools.



---

archive/issue_comments_077748.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77748",
    "user": "https://github.com/williamstein"
}
```

**Changing keywords** from "" to "sd32".



---

archive/issue_comments_077749.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [timdumol](#comment%3A18):\n> It seems that libjpeg's license is not compatible with GPL, \n> according to: http://www.thomasalspaugh.org/pub/osl-sps/libjpeg8c.html. \n> Also, libjpeg-turbo seems to be significantly faster than libjpeg, while being \n> licensed under GPL. I'm making a package for that now.\n\n\nThere is a discussion of the libjpeg-turbo license by the main developer (I think) here: http://sourceforge.net/projects/libjpeg-turbo/forums/forum/1086868/topic/4519797\n\nIt's definitely \"licensed under GPL\".   However, it seems to be licensed under a subset of LGPL, which would definitely be GPL compatible.",
    "created_at": "2011-11-14T16:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77749",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:36'></a>
Replying to [timdumol](#comment%3A18):
> It seems that libjpeg's license is not compatible with GPL, 
> according to: http://www.thomasalspaugh.org/pub/osl-sps/libjpeg8c.html. 
> Also, libjpeg-turbo seems to be significantly faster than libjpeg, while being 
> licensed under GPL. I'm making a package for that now.


There is a discussion of the libjpeg-turbo license by the main developer (I think) here: http://sourceforge.net/projects/libjpeg-turbo/forums/forum/1086868/topic/4519797

It's definitely "licensed under GPL".   However, it seems to be licensed under a subset of LGPL, which would definitely be GPL compatible.



---

archive/issue_comments_077750.json:
```json
{
    "body": "<a id='comment:37'></a>\nI tried building libjpeg_turbo-1.1.1.spkg on OS X 10.7 (Lion) with XCode 4.2.x and it fails during the ./configure stage:\n\n```\n...\nchecking whether the assembler (nasm -fmacho -DMACHO) works... yes\nchecking whether the linker accepts assembler output... no\nconfigure: error: configuration problem: maybe object file format mismatch.\nFailed to configure libjpeg ... exiting\n\nreal\t0m14.878s\n```",
    "created_at": "2011-11-14T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77750",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:37'></a>
I tried building libjpeg_turbo-1.1.1.spkg on OS X 10.7 (Lion) with XCode 4.2.x and it fails during the ./configure stage:

```
...
checking whether the assembler (nasm -fmacho -DMACHO) works... yes
checking whether the linker accepts assembler output... no
configure: error: configuration problem: maybe object file format mismatch.
Failed to configure libjpeg ... exiting

real	0m14.878s
```



---

archive/issue_events_022067.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:40:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7344#event-22067"
}
```



---

archive/issue_comments_077751.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-08-26T02:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77751",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_077752.json:
```json
{
    "body": "<a id='comment:39'></a>\noutdated, should close",
    "created_at": "2021-08-26T02:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77752",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
outdated, should close



---

archive/issue_comments_077753.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-08-26T03:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77753",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_022068.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-09-01T06:17:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7344#event-22068"
}
```



---

archive/issue_comments_077754.json:
```json
{
    "body": "**Resolution:** invalid",
    "created_at": "2021-09-01T06:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7344#issuecomment-77754",
    "user": "https://github.com/fchapoton"
}
```

**Resolution:** invalid
