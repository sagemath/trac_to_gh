# Issue 7856: update matplotlib hack for OS X

archive/issues_007856.json:
```json
{
    "assignees": [],
    "body": "See the discussion on #7095.  \n\n\nAuthor: **William Stein**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-4.3.1.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7856_\n\n",
    "closed_at": "2010-01-13T06:39:02Z",
    "created_at": "2010-01-06T15:01:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "update matplotlib hack for OS X",
    "type": "issue",
    "updated_at": "2010-01-13T19:55:20Z",
    "url": "https://github.com/sagemath/sage/issues/7856",
    "user": "https://github.com/williamstein"
}
```
See the discussion on #7095.  


Author: **William Stein**

Reviewer: **John Palmieri**

Merged: **sage-4.3.1.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/7856_





---

archive/issue_events_088514.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:01:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "milestone_number": null,
    "milestone_title": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88514"
}
```



---

archive/issue_events_088515.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88515"
}
```



---

archive/issue_events_088516.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88516"
}
```



---

archive/issue_events_088517.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:01:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88517"
}
```



---

archive/issue_comments_061276.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+See the discussion on #7095.  \n \n+This is the new spkg:  \n+\n+   http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg\n``````\n",
    "created_at": "2010-01-06T15:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61276",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+See the discussion on #7095.  
 
+This is the new spkg:  
+
+   http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg
``````




---

archive/issue_events_088518.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88518"
}
```



---

archive/issue_comments_061277.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,2 @@\n See the discussion on #7095.  \n \n-This is the new spkg:  \n-\n-   http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg\n``````\n",
    "created_at": "2010-01-06T15:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61277",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,2 @@
 See the discussion on #7095.  
 
-This is the new spkg:  
-
-   http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg
``````




---

archive/issue_events_088519.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:14:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88519"
}
```



---

archive/issue_events_088520.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:14:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88520"
}
```



---

archive/issue_events_088521.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:35:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88521"
}
```



---

archive/issue_events_088522.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T15:35:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88522"
}
```



---

archive/issue_comments_061278.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nhttp://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg",
    "created_at": "2010-01-06T15:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61278",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:4" align="right">Comment 4</div>

http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg



---

archive/issue_events_088523.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-06T16:02:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88523"
}
```



---

archive/issue_events_088524.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-06T16:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88524"
}
```



---

archive/issue_comments_061279.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nA few quick comments: SPGK.txt needs to be updated.  Also, is the hack appropriate for OS X running 10.5 (since it now just checks for \"DARWIN\", not the version number)?  I don't have access to a machine to test that.\n\nFinally, if SAGE64 is set and we're on DARWIN, is it worth making some of the other changes in [http://blog.hyperjeff.net/?p=160](http://blog.hyperjeff.net/?p=160)?  For example, in src/make.osx, changing \n\n```\nCFLAGS=\"-arch i386 -arch ppc -I${PREFIX}/include -I${PREFIX}/include/freetype2 -isysroot /Developer/SDKs/MacOSX10.4u.sdk\"\nLDFLAGS=\"-arch i386 -arch ppc -L${PREFIX}/lib -syslibroot,/Developer/SDKs/MacOSX10.4u.sdk\"\n```\nso that \"-arch ppc\" gets changed to \"-arch x86_64\"?  (That web page also suggests adding \"FFLAGS\", and making a few other changes.  We can defer these until later, also.)",
    "created_at": "2010-01-06T16:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61279",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">Comment 5</div>

A few quick comments: SPGK.txt needs to be updated.  Also, is the hack appropriate for OS X running 10.5 (since it now just checks for "DARWIN", not the version number)?  I don't have access to a machine to test that.

Finally, if SAGE64 is set and we're on DARWIN, is it worth making some of the other changes in [http://blog.hyperjeff.net/?p=160](http://blog.hyperjeff.net/?p=160)?  For example, in src/make.osx, changing 

```
CFLAGS="-arch i386 -arch ppc -I${PREFIX}/include -I${PREFIX}/include/freetype2 -isysroot /Developer/SDKs/MacOSX10.4u.sdk"
LDFLAGS="-arch i386 -arch ppc -L${PREFIX}/lib -syslibroot,/Developer/SDKs/MacOSX10.4u.sdk"
```
so that "-arch ppc" gets changed to "-arch x86_64"?  (That web page also suggests adding "FFLAGS", and making a few other changes.  We can defer these until later, also.)



---

archive/issue_comments_061280.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nOh, also, the file patches/osx10.6hack~ should be deleted.",
    "created_at": "2010-01-06T16:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61280",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">Comment 6</div>

Oh, also, the file patches/osx10.6hack~ should be deleted.



---

archive/issue_comments_061281.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nAs far as actual testing goes, on my OS X 10.6 machines:\n\n- before the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` causes a crash.\n\n- after the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` works fine.\n\n- this is completely reproducible: if I force installation of the old matplotlib spkg, then the crashes come back, and then if I force installation of the new one, the crashes go away.\n\nSo positive review, modulo the comments made above.\n\nDo we need to test on an OS X 10.5 machine?",
    "created_at": "2010-01-06T18:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61281",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">Comment 7</div>

As far as actual testing goes, on my OS X 10.6 machines:

- before the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` causes a crash.

- after the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` works fine.

- this is completely reproducible: if I force installation of the old matplotlib spkg, then the crashes come back, and then if I force installation of the new one, the crashes go away.

So positive review, modulo the comments made above.

Do we need to test on an OS X 10.5 machine?



---

archive/issue_events_088525.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T23:14:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88525"
}
```



---

archive/issue_events_088526.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-01-06T23:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88526"
}
```



---

archive/issue_comments_061282.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\n> A few quick comments: SPGK.txt needs to be updated. Also, is the hack \n> appropriate for OS X running 10.5 (since it now just checks for \"DARWIN\", \n> not the version number)?\n\nIt runs patches/osx10.6hack on any OS X, but *only* actually applies the hack on 10.6.  It immediately exits patches/osx10.6hack on other than 10.6. \n\nI've updated the spkg, and also now tested it on 10.5 and it works fine (as before).  So, can you change it to positive review?",
    "created_at": "2010-01-06T23:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61282",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:8" align="right">Comment 8</div>

> A few quick comments: SPGK.txt needs to be updated. Also, is the hack 
> appropriate for OS X running 10.5 (since it now just checks for "DARWIN", 
> not the version number)?

It runs patches/osx10.6hack on any OS X, but *only* actually applies the hack on 10.6.  It immediately exits patches/osx10.6hack on other than 10.6. 

I've updated the spkg, and also now tested it on 10.5 and it works fine (as before).  So, can you change it to positive review?



---

archive/issue_events_088527.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-06T23:22:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88527"
}
```



---

archive/issue_events_088528.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-01-06T23:22:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88528"
}
```



---

archive/issue_comments_061283.json:
```json
{
    "body": "Author: **William Stein**",
    "created_at": "2010-01-06T23:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61283",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **William Stein**



---

archive/issue_comments_061284.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2010-01-06T23:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61284",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_061285.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nPlease see [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.",
    "created_at": "2010-01-08T01:24:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61285",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:11" align="right">Comment 11</div>

Please see [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.



---

archive/issue_comments_061286.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@kcrisman](#comment%3A11):\n> Please see [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.\n\nI tried just the patches mentioned above, not the \"horrible hack\", but it didn't work: the hack was needed to avoid crashes.",
    "created_at": "2010-01-08T06:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61286",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@kcrisman](#comment%3A11):
> Please see [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins@lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.

I tried just the patches mentioned above, not the "horrible hack", but it didn't work: the hack was needed to avoid crashes.



---

archive/issue_events_088529.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T06:39:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88529"
}
```



---

archive/issue_events_088530.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T06:39:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7856#event-88530"
}
```



---

archive/issue_comments_061287.json:
```json
{
    "body": "Merged: **4.3.1.alpha2**",
    "created_at": "2010-01-13T06:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61287",
    "user": "https://github.com/rlmill"
}
```

Merged: **4.3.1.alpha2**



---

archive/issue_comments_061288.json:
```json
{
    "body": "Changed merged from **4.3.1.alpha2** to **sage-4.3.1.alpha2**",
    "created_at": "2010-01-13T19:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7856#issuecomment-61288",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed merged from **4.3.1.alpha2** to **sage-4.3.1.alpha2**
