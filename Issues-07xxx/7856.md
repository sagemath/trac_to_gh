# Issue 7856: update matplotlib hack for OS X

archive/issues_007856.json:
```json
{
    "body": "See the discussion on #7095.  \n\n\nAssignee: tbd\n\nResolution: fixed\n\nAuthor: William Stein\n\nReviewer: John Palmieri\n\nMerged: sage-4.3.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/7856\n\n",
    "closed_at": "2010-01-13T06:39:02Z",
    "created_at": "2010-01-06T15:01:56Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.1",
    "title": "update matplotlib hack for OS X",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7856",
    "user": "https://github.com/williamstein"
}
```
See the discussion on #7095.  


Assignee: tbd

Resolution: fixed

Author: William Stein

Reviewer: John Palmieri

Merged: sage-4.3.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/7856





---

archive/issue_comments_067950.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-06T15:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67950",
    "user": "https://github.com/williamstein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_067951.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-06T15:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67951",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_067952.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-06T15:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67952",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_067953.json:
```json
{
    "body": "<a id='comment:4'></a>http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg",
    "created_at": "2010-01-06T15:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67953",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>http://wstein.org/home/wstein/patches/matplotlib-0.99.1.p3.spkg



---

archive/issue_comments_067954.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-06T16:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67954",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_067955.json:
```json
{
    "body": "<a id='comment:5'></a>A few quick comments: SPGK.txt needs to be updated.  Also, is the hack appropriate for OS X running 10.5 (since it now just checks for \"DARWIN\", not the version number)?  I don't have access to a machine to test that.\n\nFinally, if SAGE64 is set and we're on DARWIN, is it worth making some of the other changes in [http://blog.hyperjeff.net/?p=160](http://blog.hyperjeff.net/?p=160)?  For example, in src/make.osx, changing \n\n```\nCFLAGS=\"-arch i386 -arch ppc -I${PREFIX}/include -I${PREFIX}/include/freetype2 -isysroot /Developer/SDKs/MacOSX10.4u.sdk\"\nLDFLAGS=\"-arch i386 -arch ppc -L${PREFIX}/lib -syslibroot,/Developer/SDKs/MacOSX10.4u.sdk\"\n```\nso that \"-arch ppc\" gets changed to \"-arch x86_64\"?  (That web page also suggests adding \"FFLAGS\", and making a few other changes.  We can defer these until later, also.)",
    "created_at": "2010-01-06T16:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67955",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>A few quick comments: SPGK.txt needs to be updated.  Also, is the hack appropriate for OS X running 10.5 (since it now just checks for "DARWIN", not the version number)?  I don't have access to a machine to test that.

Finally, if SAGE64 is set and we're on DARWIN, is it worth making some of the other changes in [http://blog.hyperjeff.net/?p=160](http://blog.hyperjeff.net/?p=160)?  For example, in src/make.osx, changing 

```
CFLAGS="-arch i386 -arch ppc -I${PREFIX}/include -I${PREFIX}/include/freetype2 -isysroot /Developer/SDKs/MacOSX10.4u.sdk"
LDFLAGS="-arch i386 -arch ppc -L${PREFIX}/lib -syslibroot,/Developer/SDKs/MacOSX10.4u.sdk"
```
so that "-arch ppc" gets changed to "-arch x86_64"?  (That web page also suggests adding "FFLAGS", and making a few other changes.  We can defer these until later, also.)



---

archive/issue_comments_067956.json:
```json
{
    "body": "<a id='comment:6'></a>Oh, also, the file patches/osx10.6hack~ should be deleted.",
    "created_at": "2010-01-06T16:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67956",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Oh, also, the file patches/osx10.6hack~ should be deleted.



---

archive/issue_comments_067957.json:
```json
{
    "body": "<a id='comment:7'></a>As far as actual testing goes, on my OS X 10.6 machines:\n\n- before the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` causes a crash.\n\n- after the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` works fine.\n\n- this is completely reproducible: if I force installation of the old matplotlib spkg, then the crashes come back, and then if I force installation of the new one, the crashes go away.\n\nSo positive review, modulo the comments made above.\n\nDo we need to test on an OS X 10.5 machine?",
    "created_at": "2010-01-06T18:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67957",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>As far as actual testing goes, on my OS X 10.6 machines:

- before the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` causes a crash.

- after the patch, if I delete the files in ~/.matplotlib, then `sage: plot(sin)` works fine.

- this is completely reproducible: if I force installation of the old matplotlib spkg, then the crashes come back, and then if I force installation of the new one, the crashes go away.

So positive review, modulo the comments made above.

Do we need to test on an OS X 10.5 machine?



---

archive/issue_comments_067958.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-06T23:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67958",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_067959.json:
```json
{
    "body": "<a id='comment:8'></a>> A few quick comments: SPGK.txt needs to be updated. Also, is the hack \n> appropriate for OS X running 10.5 (since it now just checks for \"DARWIN\", \n> not the version number)?\n\n\nIt runs patches/osx10.6hack on any OS X, but *only* actually applies the hack on 10.6.  It immediately exits patches/osx10.6hack on other than 10.6. \n\nI've updated the spkg, and also now tested it on 10.5 and it works fine (as before).  So, can you change it to positive review?",
    "created_at": "2010-01-06T23:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67959",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>> A few quick comments: SPGK.txt needs to be updated. Also, is the hack 
> appropriate for OS X running 10.5 (since it now just checks for "DARWIN", 
> not the version number)?


It runs patches/osx10.6hack on any OS X, but *only* actually applies the hack on 10.6.  It immediately exits patches/osx10.6hack on other than 10.6. 

I've updated the spkg, and also now tested it on 10.5 and it works fine (as before).  So, can you change it to positive review?



---

archive/issue_comments_067960.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-06T23:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67960",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_067961.json:
```json
{
    "body": "<a id='comment:11'></a>Please see [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.",
    "created_at": "2010-01-08T01:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67961",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>Please see [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.



---

archive/issue_comments_067962.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 kcrisman]:\n> Please see [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.\n\n\nI tried just the patches mentioned above, not the \"horrible hack\", but it didn't work: the hack was needed to avoid crashes.",
    "created_at": "2010-01-08T06:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67962",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Replying to [comment:11 kcrisman]:
> Please see [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04165.html) and [http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html](http://www.mail-archive.com/matplotlib-checkins`@`lists.sourceforge.net/msg04166.html) for something which looks relevant - namely, DPY_ARRAYAUNIQUE_SYMBOL is, in fact, a typo for DPY_ARRAY_UNIQUE_SYMBOL.  I don't know if this would fix things for us, but at any rate the 'horrible hack' uses precisely this (incorrect) variable, so we should at least fix both the source and the hack to use the correct one.


I tried just the patches mentioned above, not the "horrible hack", but it didn't work: the hack was needed to avoid crashes.



---

archive/issue_comments_067963.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-13T06:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7856#issuecomment-67963",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_events_018782.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T06:39:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7856",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7856#event-18782"
}
```
