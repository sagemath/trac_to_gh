# Issue 7571: use more dicts in graph.py

archive/issues_007571.json:
```json
{
    "body": "This patch improves 3 methods in graph.py:\n\n* connected_components: we use python set instead of lists to enable fast lookup\n* blocks_and_cut_vertices: using dicts instead of lists enable us to avoid relabeling\n* girth: idem\n\nAssignee: @rlmill\n\nResolution: fixed\n\nAuthor: Yann Laigle-Chapuy\n\nReviewer: Robert Miller\n\nMerged: sage-4.3.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/7571\n\n",
    "closed_at": "2009-12-02T08:13:47Z",
    "created_at": "2009-12-01T15:10:38Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3",
    "title": "use more dicts in graph.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7571",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```
This patch improves 3 methods in graph.py:

* connected_components: we use python set instead of lists to enable fast lookup
* blocks_and_cut_vertices: using dicts instead of lists enable us to avoid relabeling
* girth: idem

Assignee: @rlmill

Resolution: fixed

Author: Yann Laigle-Chapuy

Reviewer: Robert Miller

Merged: sage-4.3.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/7571





---

archive/issue_comments_074857.json:
```json
{
    "body": "<a id='comment:1'></a>\nfor the record:\n\nBefore:\n\n```\nsage: g=graphs.RandomGNP(10000,.00011)\nsage: time g.girth()\nCPU times: user 8.19 s, sys: 0.02 s, total: 8.20 s\nWall time: 8.21 s\n33\nsage: time g.connected_components_number()\nCPU times: user 2.06 s, sys: 0.00 s, total: 2.07 s\nWall time: 2.09 s\n4474\nsage: g=g.connected_components_subgraphs()[0]\nsage: len(g)\n1784\nsage: time b=g.blocks_and_cut_vertices()\nCPU times: user 0.28 s, sys: 0.00 s, total: 0.28 s\nWall time: 0.28 s\n```\n\nAfter:\n\n```\nsage: g=graphs.RandomGNP(10000,.00011)\nsage: time g.girth()\nCPU times: user 5.00 s, sys: 0.00 s, total: 5.00 s\nWall time: 5.00 s\n33\nsage: time g.connected_components_number()\nCPU times: user 0.20 s, sys: 0.00 s, total: 0.20 s\nWall time: 0.20 s\n4487\nsage: g=g.connected_components_subgraphs()[0]\nsage: len(g)\n2509\nsage: time b=g.blocks_and_cut_vertices()\nCPU times: user 0.16 s, sys: 0.00 s, total: 0.16 s\nWall time: 0.16 s\n```\n\nAnd more importantly:\n\n```\nsage: g = graphs.KrackhardtKiteGraph()\nsage: g.relabel(map(lambda i: 'x'+str(i),range(len(g))))\n```\n\nbefore:\n\n```\nsage: g.blocks_and_cut_vertices()\n([[9, 8], [8, 7], [7, 4, 6, 5, 2, 3, 1, 0]], [8, 7])\n```\n\nafter:\n\n```\nsage: g.blocks_and_cut_vertices()\n\n([['x9', 'x8'],\n  ['x5', 'x4', 'x1', 'x0', 'x2', 'x3', 'x6', 'x7'],\n  ['x7', 'x8']],\n ['x8', 'x7'])\n```",
    "created_at": "2009-12-01T15:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74857",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:1'></a>
for the record:

Before:

```
sage: g=graphs.RandomGNP(10000,.00011)
sage: time g.girth()
CPU times: user 8.19 s, sys: 0.02 s, total: 8.20 s
Wall time: 8.21 s
33
sage: time g.connected_components_number()
CPU times: user 2.06 s, sys: 0.00 s, total: 2.07 s
Wall time: 2.09 s
4474
sage: g=g.connected_components_subgraphs()[0]
sage: len(g)
1784
sage: time b=g.blocks_and_cut_vertices()
CPU times: user 0.28 s, sys: 0.00 s, total: 0.28 s
Wall time: 0.28 s
```

After:

```
sage: g=graphs.RandomGNP(10000,.00011)
sage: time g.girth()
CPU times: user 5.00 s, sys: 0.00 s, total: 5.00 s
Wall time: 5.00 s
33
sage: time g.connected_components_number()
CPU times: user 0.20 s, sys: 0.00 s, total: 0.20 s
Wall time: 0.20 s
4487
sage: g=g.connected_components_subgraphs()[0]
sage: len(g)
2509
sage: time b=g.blocks_and_cut_vertices()
CPU times: user 0.16 s, sys: 0.00 s, total: 0.16 s
Wall time: 0.16 s
```

And more importantly:

```
sage: g = graphs.KrackhardtKiteGraph()
sage: g.relabel(map(lambda i: 'x'+str(i),range(len(g))))
```

before:

```
sage: g.blocks_and_cut_vertices()
([[9, 8], [8, 7], [7, 4, 6, 5, 2, 3, 1, 0]], [8, 7])
```

after:

```
sage: g.blocks_and_cut_vertices()

([['x9', 'x8'],
  ['x5', 'x4', 'x1', 'x0', 'x2', 'x3', 'x6', 'x7'],
  ['x7', 'x8']],
 ['x8', 'x7'])
```



---

archive/issue_comments_074858.json:
```json
{
    "body": "Attachment [trac_7571.patch](tarball://root/attachments/some-uuid/ticket7571/trac_7571.patch) by ylchapuy created at 2009-12-01 15:47:54",
    "created_at": "2009-12-01T15:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74858",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Attachment [trac_7571.patch](tarball://root/attachments/some-uuid/ticket7571/trac_7571.patch) by ylchapuy created at 2009-12-01 15:47:54



---

archive/issue_comments_074859.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2009-12-01T15:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74859",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_074860.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2009-12-01T15:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74860",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

Changing priority from major to minor.



---

archive/issue_comments_074861.json:
```json
{
    "body": "<a id='comment:3'></a>\nYour benchmarks would be more convincing if you used `set_random_seed` beforehand, so you're actually testing the same \"random\" graph.\n\nThe changes to the code look good, and the speedups are impressive.",
    "created_at": "2009-12-01T16:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74861",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:3'></a>
Your benchmarks would be more convincing if you used `set_random_seed` beforehand, so you're actually testing the same "random" graph.

The changes to the code look good, and the speedups are impressive.



---

archive/issue_comments_074862.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2009-12-01T16:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74862",
    "user": "https://github.com/rlmill"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_074863.json:
```json
{
    "body": "<a id='comment:4'></a>\nthat's true, benchmarks are not very convincing. Here are new ones:\n\nbefore:\n\n```\nsage: set_random_seed(42)\nsage: g=graphs.RandomGNP(20000,.00005)\nsage: time g.girth()\nCPU times: user 17.55 s, sys: 0.07 s, total: 17.62 s\nWall time: 17.83 s\n16\nsage: time g.connected_components_number()\nCPU times: user 8.40 s, sys: 0.08 s, total: 8.48 s\nWall time: 8.72 s\n9810\nsage: set_random_seed(42)\nsage: g=graphs.RandomGNP(10000,.005)\nsage: time b=g.blocks_and_cut_vertices()\nCPU times: user 17.19 s, sys: 0.44 s, total: 17.63 s\nWall time: 17.98 s\n```\n\nafter:\n\n```\nsage: set_random_seed(42)\nsage: g=graphs.RandomGNP(20000,.00005)\nsage: time g.girth()\nCPU times: user 2.15 s, sys: 0.00 s, total: 2.16 s\nWall time: 2.15 s\n16\nsage: time g.connected_components_number()\nCPU times: user 0.32 s, sys: 0.00 s, total: 0.32 s\nWall time: 0.32 s\n9810\nsage: set_random_seed(42)\nsage: g=graphs.RandomGNP(10000,.005)\nsage: time b=g.blocks_and_cut_vertices()\nCPU times: user 10.22 s, sys: 0.04 s, total: 10.27 s\nWall time: 10.57 s\n```",
    "created_at": "2009-12-01T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74863",
    "user": "https://trac.sagemath.org/admin/accounts/users/ylchapuy"
}
```

<a id='comment:4'></a>
that's true, benchmarks are not very convincing. Here are new ones:

before:

```
sage: set_random_seed(42)
sage: g=graphs.RandomGNP(20000,.00005)
sage: time g.girth()
CPU times: user 17.55 s, sys: 0.07 s, total: 17.62 s
Wall time: 17.83 s
16
sage: time g.connected_components_number()
CPU times: user 8.40 s, sys: 0.08 s, total: 8.48 s
Wall time: 8.72 s
9810
sage: set_random_seed(42)
sage: g=graphs.RandomGNP(10000,.005)
sage: time b=g.blocks_and_cut_vertices()
CPU times: user 17.19 s, sys: 0.44 s, total: 17.63 s
Wall time: 17.98 s
```

after:

```
sage: set_random_seed(42)
sage: g=graphs.RandomGNP(20000,.00005)
sage: time g.girth()
CPU times: user 2.15 s, sys: 0.00 s, total: 2.16 s
Wall time: 2.15 s
16
sage: time g.connected_components_number()
CPU times: user 0.32 s, sys: 0.00 s, total: 0.32 s
Wall time: 0.32 s
9810
sage: set_random_seed(42)
sage: g=graphs.RandomGNP(10000,.005)
sage: time b=g.blocks_and_cut_vertices()
CPU times: user 10.22 s, sys: 0.04 s, total: 10.27 s
Wall time: 10.57 s
```



---

archive/issue_events_017954.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-12-02T08:13:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7571#event-17954"
}
```



---

archive/issue_comments_074864.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-12-02T08:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74864",
    "user": "https://github.com/mwhansen"
}
```

Resolution: fixed



---

archive/issue_comments_074865.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Robert Miller\"",
    "created_at": "2009-12-02T08:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74865",
    "user": "https://github.com/mwhansen"
}
```

Changing reviewer from "" to "Robert Miller"



---

archive/issue_comments_074866.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.3.alpha1\"",
    "created_at": "2009-12-02T08:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7571#issuecomment-74866",
    "user": "https://github.com/mwhansen"
}
```

Changing merged from "" to "sage-4.3.alpha1"
