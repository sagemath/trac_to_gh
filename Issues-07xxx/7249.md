# Issue 7249: switch the notebook's templating system to Jinja2

archive/issues_007249.json:
```json
{
    "body": "We should switch the notebook's templating system from Jinja to Jinja2. Jinja2, among other things, makes i18n much easier.\n\n**Assignee:** boothby\n\n**CC:**  @mwhansen @qed777 @dandrake\n\n**Resolution:** fixed\n\n**Author:** Tim Dumol, Dan Drake\n\n**Reviewer:** Mitesh Patel\n\n**Merged:** sagenb-0.7\n\nIssue created by migration from https://trac.sagemath.org/ticket/7249\n\n",
    "closed_at": "2010-01-25T00:50:48Z",
    "created_at": "2009-10-19T08:44:15Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.2",
    "title": "switch the notebook's templating system to Jinja2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7249",
    "user": "https://github.com/dandrake"
}
```
We should switch the notebook's templating system from Jinja to Jinja2. Jinja2, among other things, makes i18n much easier.

**Assignee:** boothby

**CC:**  @mwhansen @qed777 @dandrake

**Resolution:** fixed

**Author:** Tim Dumol, Dan Drake

**Reviewer:** Mitesh Patel

**Merged:** sagenb-0.7

Issue created by migration from https://trac.sagemath.org/ticket/7249





---

archive/issue_comments_076041.json:
```json
{
    "body": "apply to sagenb repo",
    "created_at": "2009-10-20T00:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76041",
    "user": "https://github.com/dandrake"
}
```

apply to sagenb repo



---

archive/issue_comments_076042.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_7249_switch_notebook_to_jinja2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_switch_notebook_to_jinja2.patch) by @dandrake created at 2009-10-20 00:32:11",
    "created_at": "2009-10-20T00:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76042",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:1'></a>
Attachment [trac_7249_switch_notebook_to_jinja2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_switch_notebook_to_jinja2.patch) by @dandrake created at 2009-10-20 00:32:11



---

archive/issue_comments_076043.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2009-10-20T00:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76043",
    "user": "https://github.com/dandrake"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_076044.json:
```json
{
    "body": "**Author:** Dan Drake",
    "created_at": "2009-10-20T00:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76044",
    "user": "https://github.com/dandrake"
}
```

**Author:** Dan Drake



---

archive/issue_comments_076045.json:
```json
{
    "body": "<a id='comment:2'></a>\n#7269 should now include these changes.",
    "created_at": "2009-10-24T19:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76045",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>
#7269 should now include these changes.



---

archive/issue_comments_076046.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2009-12-19T12:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76046",
    "user": "https://github.com/TimDumol"
}
```

**Upstream:** N/A



---

archive/issue_comments_076047.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-12-19T12:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76047",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_076048.json:
```json
{
    "body": "<a id='comment:3'></a>\n#7269 no longer includes these changes. Refer to[comment:25](#comment%3A25):ticket:7269.\n\nChanges must be made to deal with unicode encoding/decoding before this can be reviewed.",
    "created_at": "2009-12-19T12:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76048",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:3'></a>
#7269 no longer includes these changes. Refer to[comment:25](#comment%3A25):ticket:7269.

Changes must be made to deal with unicode encoding/decoding before this can be reviewed.



---

archive/issue_comments_076049.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [timdumol](#comment%3A3):\n> #7269 no longer includes these changes. Refer to[comment:25](#comment%3A25):ticket:7269.\n> \n> Changes must be made to deal with unicode encoding/decoding before this can be reviewed.\n\n\nAt[comment:24](#comment%3A24):ticket:7269 you say that we need Model-View-Presenter/Controller separation. How hard will that be? It sounds hard. :)  I've run into Unicode string problems while trying to internationalize the notebook, so I'd definitely like to do this if it's the right way to go about it.",
    "created_at": "2009-12-22T04:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76049",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>
Replying to [timdumol](#comment%3A3):
> #7269 no longer includes these changes. Refer to[comment:25](#comment%3A25):ticket:7269.
> 
> Changes must be made to deal with unicode encoding/decoding before this can be reviewed.


At[comment:24](#comment%3A24):ticket:7269 you say that we need Model-View-Presenter/Controller separation. How hard will that be? It sounds hard. :)  I've run into Unicode string problems while trying to internationalize the notebook, so I'd definitely like to do this if it's the right way to go about it.



---

archive/issue_comments_076050.json:
```json
{
    "body": "<a id='comment:5'></a>\nMVC [1] separates the layers of the program into a model, which has the data; views, which are ways to present the data; and the controller/s, which control which data to show etc.\n\nCurrently the notebook serves as a model/controller and has some view functions mixed into it (`html_*`). Separating things will make things cleaner, and will make dealing with unicode easier: the view is presented with encoded byte strings, the controller deals with unicode strings, and data is retrieved from the model (db or filesystem) in encoded data which is converted to unicode strings.\n\nWithout this separation, one will need to check whether each string passed is an encoded byte string or a unicode string.\n\nSeparation will entail first removing the `html_*` functions, which in turn means restructuring the templates. I'll be working on that very soon.\n\n[1] http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller",
    "created_at": "2009-12-22T05:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76050",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:5'></a>
MVC [1] separates the layers of the program into a model, which has the data; views, which are ways to present the data; and the controller/s, which control which data to show etc.

Currently the notebook serves as a model/controller and has some view functions mixed into it (`html_*`). Separating things will make things cleaner, and will make dealing with unicode easier: the view is presented with encoded byte strings, the controller deals with unicode strings, and data is retrieved from the model (db or filesystem) in encoded data which is converted to unicode strings.

Without this separation, one will need to check whether each string passed is an encoded byte string or a unicode string.

Separation will entail first removing the `html_*` functions, which in turn means restructuring the templates. I'll be working on that very soon.

[1] http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller



---

archive/issue_comments_076051.json:
```json
{
    "body": "Converts much storage to unicode, and adds the necessary encoding for storage and networking. Uses jinja2 instead of jinja. Depends on #7835, #7786 and their dependencies.",
    "created_at": "2010-01-06T20:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76051",
    "user": "https://github.com/TimDumol"
}
```

Converts much storage to unicode, and adds the necessary encoding for storage and networking. Uses jinja2 instead of jinja. Depends on #7835, #7786 and their dependencies.



---

archive/issue_comments_076052.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-01-06T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76052",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_076053.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac_7249_jinja2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2.patch) by @TimDumol created at 2010-01-06 20:14:01\n\nHopefully this patch will do the trick and make i18n easier.",
    "created_at": "2010-01-06T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76053",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:6'></a>
Attachment [trac_7249_jinja2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2.patch) by @TimDumol created at 2010-01-06 20:14:01

Hopefully this patch will do the trick and make i18n easier.



---

archive/issue_comments_076054.json:
```json
{
    "body": "Attachment [trac_7249_jinja2_v2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v2.patch) by @qed777 created at 2010-01-06 21:41:59\n\nFix several doctests.  Replaces previous.",
    "created_at": "2010-01-06T21:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76054",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7249_jinja2_v2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v2.patch) by @qed777 created at 2010-01-06 21:41:59

Fix several doctests.  Replaces previous.



---

archive/issue_comments_076055.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2010-01-06T22:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76055",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_076056.json:
```json
{
    "body": "<a id='comment:7'></a>\nV3:\n\n* Fixes a number of doctests.\n* `iamges` --> `images` in `cell.py`.\n* `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.\n\nI'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?\n\nShould the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?\n\nDoes the change to `Worksheet.preparse` belong at #7835?\n\nIf we're planning to use unicode \"everywhere\", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?\n\nI apologize for my ignorance.",
    "created_at": "2010-01-06T22:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76056",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
V3:

* Fixes a number of doctests.
* `iamges` --> `images` in `cell.py`.
* `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.

I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?

Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?

Does the change to `Worksheet.preparse` belong at #7835?

If we're planning to use unicode "everywhere", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?

I apologize for my ignorance.



---

archive/issue_comments_076057.json:
```json
{
    "body": "**Changing author** from \"Dan Drake\" to \"Tim Dumol, Dan Drake\".",
    "created_at": "2010-01-06T22:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76057",
    "user": "https://github.com/qed777"
}
```

**Changing author** from "Dan Drake" to "Tim Dumol, Dan Drake".



---

archive/issue_comments_076058.json:
```json
{
    "body": "Rebased vs. #7835 v2, #7786 v8, etc.  Replaces previous.",
    "created_at": "2010-01-07T02:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76058",
    "user": "https://github.com/qed777"
}
```

Rebased vs. #7835 v2, #7786 v8, etc.  Replaces previous.



---

archive/issue_comments_076059.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [trac_7249_jinja2_v3.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v3.patch) by @qed777 created at 2010-01-07 02:39:24\n\nV3 (really) is rebased against the latest at #7835, #7786.  Besides consistently using UTF-8 for the cell/worksheet system, I'm curious about `Cell.__init__`, where `str`s are `encode`d, not `decode`d.  Again, I'm not very familiar with encodings, so I may well be wrong.  Thanks!",
    "created_at": "2010-01-07T02:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76059",
    "user": "https://github.com/qed777"
}
```

<a id='comment:9'></a>
Attachment [trac_7249_jinja2_v3.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v3.patch) by @qed777 created at 2010-01-07 02:39:24

V3 (really) is rebased against the latest at #7835, #7786.  Besides consistently using UTF-8 for the cell/worksheet system, I'm curious about `Cell.__init__`, where `str`s are `encode`d, not `decode`d.  Again, I'm not very familiar with encodings, so I may well be wrong.  Thanks!



---

archive/issue_comments_076060.json:
```json
{
    "body": "<a id='comment:10'></a>\nAccording to the [Python Unicode HOWTO](http://docs.python.org/dev/howto/unicode.html#reading-and-writing-unicode-data), we can use the [codecs.open](http://docs.python.org/library/codecs.html#codecs.open) to read from (decode) and write to (encode) files transparently.",
    "created_at": "2010-01-07T05:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76060",
    "user": "https://github.com/qed777"
}
```

<a id='comment:10'></a>
According to the [Python Unicode HOWTO](http://docs.python.org/dev/howto/unicode.html#reading-and-writing-unicode-data), we can use the [codecs.open](http://docs.python.org/library/codecs.html#codecs.open) to read from (decode) and write to (encode) files transparently.



---

archive/issue_comments_076061.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mpatel](#comment%3A7):\n> V3:\n> \n> * Fixes a number of doctests.\n> * `iamges` --> `images` in `cell.py`.\n> * `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.\n> \n> I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?\n> \n\n\nSure, and yes.\n\n> Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?\n\n\ndiv_wrap is a boolean. The div_wrap_ and wrap_ variables are workarounds to limitations present in Jinja2 but not in Jinja, so no, it's not for #7786.\n> \n> Does the change to `Worksheet.preparse` belong at #7835?\n\n\nSince this particular ticket is for Jinja2, which requires unicode, no. #7835 only replaces functionality that was previously present.\n\n> \n> If we're planning to use unicode \"everywhere\", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?\n\n\nYes, unicode functionality should be doctested.\n\n> \n> I apologize for my ignorance.",
    "created_at": "2010-01-10T06:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76061",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:11'></a>
Replying to [mpatel](#comment%3A7):
> V3:
> 
> * Fixes a number of doctests.
> * `iamges` --> `images` in `cell.py`.
> * `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.
> 
> I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?
> 


Sure, and yes.

> Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?


div_wrap is a boolean. The div_wrap_ and wrap_ variables are workarounds to limitations present in Jinja2 but not in Jinja, so no, it's not for #7786.
> 
> Does the change to `Worksheet.preparse` belong at #7835?


Since this particular ticket is for Jinja2, which requires unicode, no. #7835 only replaces functionality that was previously present.

> 
> If we're planning to use unicode "everywhere", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?


Yes, unicode functionality should be doctested.

> 
> I apologize for my ignorance.



---

archive/issue_comments_076062.json:
```json
{
    "body": "<a id='comment:12'></a>\nAlso, don't apologize for any supposed ignorance please. We're all ignorant.",
    "created_at": "2010-01-10T06:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76062",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:12'></a>
Also, don't apologize for any supposed ignorance please. We're all ignorant.



---

archive/issue_comments_076063.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-01-16T08:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76063",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_076064.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe new patch fixes the styling of the worksheet listing page and adds two new functions in `sage.misc.misc`: `encoded_str` and `unicode_str` for encoding and decoding strings automatically.",
    "created_at": "2010-01-16T08:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76064",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:13'></a>
The new patch fixes the styling of the worksheet listing page and adds two new functions in `sage.misc.misc`: `encoded_str` and `unicode_str` for encoding and decoding strings automatically.



---

archive/issue_comments_076065.json:
```json
{
    "body": "Attachment [trac_7249_jinja2_v4.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v4.patch) by @TimDumol created at 2010-01-16 23:24:36\n\nFixes the styling of the worksheet listing page.",
    "created_at": "2010-01-16T23:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76065",
    "user": "https://github.com/TimDumol"
}
```

Attachment [trac_7249_jinja2_v4.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v4.patch) by @TimDumol created at 2010-01-16 23:24:36

Fixes the styling of the worksheet listing page.



---

archive/issue_comments_076066.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis is the new patch queue:\n\n```\ntrac_7650-sagenb_doctesting_v6.patch\ntrac_7650-reviewer.patch\ntrac_7648-missing_indent.patch\ntrac_7663-rstrip_prompt.patch\ntrac_7847-empty-trash-no-referer.patch\ntrac_7786-template-jinja-idiomatic.patch\ntrac_7863-declare_vars_aux_js_v2.patch\ntrac_7874-typeset_interact_labels.patch\ntrac_7858-key_binding_vars_v2.patch\ntrac_7666-alphanumeric_cell_ids_B5.patch\ntrac_7666-reviewer.patch\ntrac_7835-preparsing-unicode_v2.patch\ntrac_7249_jinja2_v5.patch\n```",
    "created_at": "2010-01-17T21:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76066",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:14'></a>
This is the new patch queue:

```
trac_7650-sagenb_doctesting_v6.patch
trac_7650-reviewer.patch
trac_7648-missing_indent.patch
trac_7663-rstrip_prompt.patch
trac_7847-empty-trash-no-referer.patch
trac_7786-template-jinja-idiomatic.patch
trac_7863-declare_vars_aux_js_v2.patch
trac_7874-typeset_interact_labels.patch
trac_7858-key_binding_vars_v2.patch
trac_7666-alphanumeric_cell_ids_B5.patch
trac_7666-reviewer.patch
trac_7835-preparsing-unicode_v2.patch
trac_7249_jinja2_v5.patch
```



---

archive/issue_comments_076067.json:
```json
{
    "body": "Rebase on a new patch set.",
    "created_at": "2010-01-18T00:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76067",
    "user": "https://github.com/TimDumol"
}
```

Rebase on a new patch set.



---

archive/issue_comments_076068.json:
```json
{
    "body": "Attachment [trac_7249_jinja2_v5.2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.2.patch) by @TimDumol created at 2010-01-18 01:26:17\n\nAdded an 'ignore' errors directive to `unicode_string`",
    "created_at": "2010-01-18T01:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76068",
    "user": "https://github.com/TimDumol"
}
```

Attachment [trac_7249_jinja2_v5.2.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.2.patch) by @TimDumol created at 2010-01-18 01:26:17

Added an 'ignore' errors directive to `unicode_string`



---

archive/issue_comments_076069.json:
```json
{
    "body": "**Reviewer:** Mitesh Patel",
    "created_at": "2010-01-18T07:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76069",
    "user": "https://github.com/qed777"
}
```

**Reviewer:** Mitesh Patel



---

archive/issue_comments_076070.json:
```json
{
    "body": "<a id='comment:15'></a>\nIn `notebook.py`, should `hunk = encoded_str(hunk)` be `hunk = unicode_str(hunk)`?\n\nIn `Cell.__init__`, can we simplify `self.set_input_text(str(input).replace('\\r',''))`?\n\nIn `twist.py`, do we need to call `unicode_str` on the incoming input?  The constructors and `set_input_text` do this.",
    "created_at": "2010-01-18T07:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76070",
    "user": "https://github.com/qed777"
}
```

<a id='comment:15'></a>
In `notebook.py`, should `hunk = encoded_str(hunk)` be `hunk = unicode_str(hunk)`?

In `Cell.__init__`, can we simplify `self.set_input_text(str(input).replace('\r',''))`?

In `twist.py`, do we need to call `unicode_str` on the incoming input?  The constructors and `set_input_text` do this.



---

archive/issue_comments_076071.json:
```json
{
    "body": "<a id='comment:16'></a>\nAlso, evaluating `print '\u00e9'` raises\n\n```python\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/twist.py\", line 1281, in render\n            cell.set_input_text(input_text)\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/cell.py\", line 1270, in set_input_text\n            input = unicode_str(input)\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/misc/misc.py\", line 441, in unicode_str\n            return unicode(str(obj), encoding, 'ignore')\n        exceptions.UnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 7: ordinal not in range(128)\n\n```",
    "created_at": "2010-01-18T07:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76071",
    "user": "https://github.com/qed777"
}
```

<a id='comment:16'></a>
Also, evaluating `print 'é'` raises

```python
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/twist.py", line 1281, in render
            cell.set_input_text(input_text)
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/cell.py", line 1270, in set_input_text
            input = unicode_str(input)
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/misc/misc.py", line 441, in unicode_str
            return unicode(str(obj), encoding, 'ignore')
        exceptions.UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 7: ordinal not in range(128)

```



---

archive/issue_comments_076072.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-01-18T07:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76072",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_076073.json:
```json
{
    "body": "<a id='comment:17'></a>\nNice catches. Here's a patch to fix them.",
    "created_at": "2010-01-18T07:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76073",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:17'></a>
Nice catches. Here's a patch to fix them.



---

archive/issue_comments_076074.json:
```json
{
    "body": "Adds the suggested fixes by mpatel.",
    "created_at": "2010-01-18T08:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76074",
    "user": "https://github.com/TimDumol"
}
```

Adds the suggested fixes by mpatel.



---

archive/issue_comments_076075.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2010-01-18T08:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76075",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_076076.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [trac_7249_jinja2_v5.3.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.3.patch) by @TimDumol created at 2010-01-18 08:19:14\n\nWoops! Sorry, accidentally put it to positive review. You should be the one, if ever.",
    "created_at": "2010-01-18T08:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76076",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:18'></a>
Attachment [trac_7249_jinja2_v5.3.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.3.patch) by @TimDumol created at 2010-01-18 08:19:14

Woops! Sorry, accidentally put it to positive review. You should be the one, if ever.



---

archive/issue_comments_076077.json:
```json
{
    "body": "<a id='comment:19'></a>\nUpon saving and quitting a worksheet that contains an evaluated `print `\u00e9`` cell, I see\n\n```python\nworksheet.py:1924: exceptions.UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal\n```\n\nWhat about the `unicode_str`s in `twist.py`?  I'm just wondering why we need them.\n\nMinor: It appears we can just call `encoded_str` in `sage_inspect.py`.\n\nAlso, can you slip some Unicode characters into the Se and/or doctests, so that we can detect potential regressions?",
    "created_at": "2010-01-18T08:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76077",
    "user": "https://github.com/qed777"
}
```

<a id='comment:19'></a>
Upon saving and quitting a worksheet that contains an evaluated `print `é`` cell, I see

```python
worksheet.py:1924: exceptions.UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
```

What about the `unicode_str`s in `twist.py`?  I'm just wondering why we need them.

Minor: It appears we can just call `encoded_str` in `sage_inspect.py`.

Also, can you slip some Unicode characters into the Se and/or doctests, so that we can detect potential regressions?



---

archive/issue_comments_076078.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'm pretty sure that that warning is unavoidable (has to do with upgrading from non-unicode to unicode). The `unicode_str`s are there just out of paranoia. Nice catch with the sage_inspect.py thing. I'll update the tests now.",
    "created_at": "2010-01-18T09:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76078",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:20'></a>
I'm pretty sure that that warning is unavoidable (has to do with upgrading from non-unicode to unicode). The `unicode_str`s are there just out of paranoia. Nice catch with the sage_inspect.py thing. I'll update the tests now.



---

archive/issue_comments_076079.json:
```json
{
    "body": "Attachment [trac_7249_jinja2_v5.4.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.4.patch) by @TimDumol created at 2010-01-18 10:51:38\n\nAdds the requested doctests and Se tests and the cleanup on `sage_inspect.py`",
    "created_at": "2010-01-18T10:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76079",
    "user": "https://github.com/TimDumol"
}
```

Attachment [trac_7249_jinja2_v5.4.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249_jinja2_v5.4.patch) by @TimDumol created at 2010-01-18 10:51:38

Adds the requested doctests and Se tests and the cleanup on `sage_inspect.py`



---

archive/issue_comments_076080.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis new patch should add the requested tests.",
    "created_at": "2010-01-18T10:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76080",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:21'></a>
This new patch should add the requested tests.



---

archive/issue_comments_076081.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2010-01-18T10:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76081",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_076082.json:
```json
{
    "body": "Fixes a problem with text cells with unicode contents.",
    "created_at": "2010-01-19T04:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76082",
    "user": "https://github.com/TimDumol"
}
```

Fixes a problem with text cells with unicode contents.



---

archive/issue_comments_076083.json:
```json
{
    "body": "Attachment [trac_7249-jinja2_v6.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v6.patch) by @qed777 created at 2010-01-19 11:31:46\n\nTest fix, drop pdb.  Replaces previous.",
    "created_at": "2010-01-19T11:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76083",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7249-jinja2_v6.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v6.patch) by @qed777 created at 2010-01-19 11:31:46

Test fix, drop pdb.  Replaces previous.



---

archive/issue_comments_076084.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-01-19T11:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76084",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_076085.json:
```json
{
    "body": "<a id='comment:22'></a>\nAttachment [trac_7249-jinja2_v7.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v7.patch) by @qed777 created at 2010-01-19 11:31:54\n\nV7 fixes a failed doctest in `cell.py` (line 138) and removes `import pdb; pdb.set_trace()` from `test_worksheet_list.py`.",
    "created_at": "2010-01-19T11:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76085",
    "user": "https://github.com/qed777"
}
```

<a id='comment:22'></a>
Attachment [trac_7249-jinja2_v7.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v7.patch) by @qed777 created at 2010-01-19 11:31:54

V7 fixes a failed doctest in `cell.py` (line 138) and removes `import pdb; pdb.set_trace()` from `test_worksheet_list.py`.



---

archive/issue_comments_076086.json:
```json
{
    "body": "<a id='comment:23'></a>\nOn the non-ASCII Unicode characters which may break docbuilds, please see #8000.",
    "created_at": "2010-01-19T16:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76086",
    "user": "https://github.com/qed777"
}
```

<a id='comment:23'></a>
On the non-ASCII Unicode characters which may break docbuilds, please see #8000.



---

archive/issue_comments_076087.json:
```json
{
    "body": "<a id='comment:24'></a>\nSphinx raises\n\n```\nreading sources... [100%] sagenb/notebook/worksheet\nSphinx error:\n'utf8' codec can't decode bytes in position 420-422: invalid data\n```\nThe \"invalid\" data appears to be `u'\\xe4'` in line 695 (or so) of `worksheet.py`:\n\n```python\n            u'\\u03ab\\xe4\\u013b\\u01be\\u1e40\\u0411'                               \n```\nV8 just makes the docstring raw (`\"\"\"` --> `r\"\"\"`).  I've added `'\u0422\u0435\u043e\u0440\u0438\u044f \u0447\u0438\u0441\u0435\u043b'`, partly for fun.",
    "created_at": "2010-01-19T19:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76087",
    "user": "https://github.com/qed777"
}
```

<a id='comment:24'></a>
Sphinx raises

```
reading sources... [100%] sagenb/notebook/worksheet
Sphinx error:
'utf8' codec can't decode bytes in position 420-422: invalid data
```
The "invalid" data appears to be `u'\xe4'` in line 695 (or so) of `worksheet.py`:

```python
            u'\u03ab\xe4\u013b\u01be\u1e40\u0411'                               
```
V8 just makes the docstring raw (`"""` --> `r"""`).  I've added `'Теория чисел'`, partly for fun.



---

archive/issue_comments_076088.json:
```json
{
    "body": "Attachment [trac_7249-jinja2_v8.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v8.patch) by @qed777 created at 2010-01-19 19:04:58\n\nMake `Worksheet.name`'s docstring raw, for Sphinx.  Replaces previous.",
    "created_at": "2010-01-19T19:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76088",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7249-jinja2_v8.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v8.patch) by @qed777 created at 2010-01-19 19:04:58

Make `Worksheet.name`'s docstring raw, for Sphinx.  Replaces previous.



---

archive/issue_comments_076089.json:
```json
{
    "body": "<a id='comment:25'></a>\nIt may be better to make the docstrings unicode strings.  V9 does this, but I can't attach it right now:\n\n```\nTrac detected an internal error:\n    IOError: [Errno 28] No space left on device\n```",
    "created_at": "2010-01-19T19:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76089",
    "user": "https://github.com/qed777"
}
```

<a id='comment:25'></a>
It may be better to make the docstrings unicode strings.  V9 does this, but I can't attach it right now:

```
Trac detected an internal error:
    IOError: [Errno 28] No space left on device
```



---

archive/issue_comments_076090.json:
```json
{
    "body": "Attachment [trac_7249-jinja2_v9.5.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v9.5.patch) by @qed777 created at 2010-01-19 19:23:45\n\nMake the docstrings unicode strings.  Replaces previous.",
    "created_at": "2010-01-19T19:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76090",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7249-jinja2_v9.5.patch](tarball://root/attachments/some-uuid/ticket7249/trac_7249-jinja2_v9.5.patch) by @qed777 created at 2010-01-19 19:23:45

Make the docstrings unicode strings.  Replaces previous.



---

archive/issue_comments_076091.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe review patches look good. Nice work. I must say, the reviewing of this patch is real messy.",
    "created_at": "2010-01-19T20:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76091",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:26'></a>
The review patches look good. Nice work. I must say, the reviewing of this patch is real messy.



---

archive/issue_comments_076092.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-01-25T00:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76092",
    "user": "https://github.com/qed777"
}
```

**Resolution:** fixed



---

archive/issue_events_021835.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:50:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7249#event-21835"
}
```



---

archive/issue_comments_076093.json:
```json
{
    "body": "**Merged:** sagenb-0.7",
    "created_at": "2010-01-25T00:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76093",
    "user": "https://github.com/qed777"
}
```

**Merged:** sagenb-0.7



---

archive/issue_comments_076094.json:
```json
{
    "body": "**Blocking:** 8051",
    "created_at": "2010-01-27T05:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7249#issuecomment-76094",
    "user": "https://github.com/qed777"
}
```

**Blocking:** 8051
