# Issue 7249: switch the notebook's templating system to Jinja2

archive/issues_007249.json:
```json
{
    "assignees": [
        "https://github.com/boothby"
    ],
    "body": "We should switch the notebook's templating system from Jinja to Jinja2. Jinja2, among other things, makes i18n much easier.\n\nCC:  @mwhansen @qed777 @dandrake\n\nComponent: **notebook**\n\nAuthor: **Tim Dumol, Dan Drake**\n\nReviewer: **Mitesh Patel**\n\nMerged: **sagenb-0.7**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7249_\n\n",
    "closed_at": "2010-01-25T00:50:48Z",
    "created_at": "2009-10-19T08:44:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "switch the notebook's templating system to Jinja2",
    "type": "issue",
    "updated_at": "2010-01-25T00:50:48Z",
    "url": "https://github.com/sagemath/sage/issues/7249",
    "user": "https://github.com/dandrake"
}
```
We should switch the notebook's templating system from Jinja to Jinja2. Jinja2, among other things, makes i18n much easier.

CC:  @mwhansen @qed777 @dandrake

Component: **notebook**

Author: **Tim Dumol, Dan Drake**

Reviewer: **Mitesh Patel**

Merged: **sagenb-0.7**

_Issue created by migration from https://trac.sagemath.org/ticket/7249_





---

archive/issue_events_088782.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2009-10-19T08:44:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88782"
}
```



---

archive/issue_events_088783.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2009-10-19T08:44:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "000080",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88783"
}
```



---

archive/issue_events_088784.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2009-10-19T08:44:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88784"
}
```



---

archive/issue_events_088785.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2009-10-19T08:44:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88785"
}
```



---

archive/issue_events_088786.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2009-10-19T08:44:15Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "subject": "https://github.com/dandrake",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88786"
}
```



---

archive/issue_comments_052217.json:
```json
{
    "body": "apply to sagenb repo",
    "created_at": "2009-10-20T00:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52217",
    "user": "https://github.com/dandrake"
}
```

apply to sagenb repo



---

archive/issue_comments_052218.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_7249_switch_notebook_to_jinja2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_switch_notebook_to_jinja2.patch.gz)**",
    "created_at": "2009-10-20T00:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52218",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_7249_switch_notebook_to_jinja2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_switch_notebook_to_jinja2.patch.gz)**



---

archive/issue_events_088787.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2009-10-20T00:32:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88787"
}
```



---

archive/issue_comments_052219.json:
```json
{
    "body": "Author: **Dan Drake**",
    "created_at": "2009-10-20T00:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52219",
    "user": "https://github.com/dandrake"
}
```

Author: **Dan Drake**



---

archive/issue_comments_052220.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n#7269 should now include these changes.",
    "created_at": "2009-10-24T19:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52220",
    "user": "https://github.com/qed777"
}
```

<div id="comment:2" align="right">comment:2</div>

#7269 should now include these changes.



---

archive/issue_events_088788.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-12-19T12:17:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88788"
}
```



---

archive/issue_events_088789.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2009-12-19T12:17:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88789"
}
```



---

archive/issue_comments_052221.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n#7269 no longer includes these changes. Refer to [#7269 comment:25](https://github.com/sagemath/sage/issues/7269#comment:25).\n\nChanges must be made to deal with unicode encoding/decoding before this can be reviewed.",
    "created_at": "2009-12-19T12:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52221",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:3" align="right">comment:3</div>

#7269 no longer includes these changes. Refer to [#7269 comment:25](https://github.com/sagemath/sage/issues/7269#comment:25).

Changes must be made to deal with unicode encoding/decoding before this can be reviewed.



---

archive/issue_comments_052222.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@TimDumol](#comment:3):\n> #7269 no longer includes these changes. Refer to [#7269 comment:25](https://github.com/sagemath/sage/issues/7269#comment:25).\n> \n> Changes must be made to deal with unicode encoding/decoding before this can be reviewed.\n\nAt [#7269 comment:24](https://github.com/sagemath/sage/issues/7269#comment:24) you say that we need Model-View-Presenter/Controller separation. How hard will that be? It sounds hard. :)  I've run into Unicode string problems while trying to internationalize the notebook, so I'd definitely like to do this if it's the right way to go about it.",
    "created_at": "2009-12-22T04:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52222",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@TimDumol](#comment:3):
> #7269 no longer includes these changes. Refer to [#7269 comment:25](https://github.com/sagemath/sage/issues/7269#comment:25).
> 
> Changes must be made to deal with unicode encoding/decoding before this can be reviewed.

At [#7269 comment:24](https://github.com/sagemath/sage/issues/7269#comment:24) you say that we need Model-View-Presenter/Controller separation. How hard will that be? It sounds hard. :)  I've run into Unicode string problems while trying to internationalize the notebook, so I'd definitely like to do this if it's the right way to go about it.



---

archive/issue_comments_052223.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nMVC [1] separates the layers of the program into a model, which has the data; views, which are ways to present the data; and the controller/s, which control which data to show etc.\n\nCurrently the notebook serves as a model/controller and has some view functions mixed into it (`html_*`). Separating things will make things cleaner, and will make dealing with unicode easier: the view is presented with encoded byte strings, the controller deals with unicode strings, and data is retrieved from the model (db or filesystem) in encoded data which is converted to unicode strings.\n\nWithout this separation, one will need to check whether each string passed is an encoded byte string or a unicode string.\n\nSeparation will entail first removing the `html_*` functions, which in turn means restructuring the templates. I'll be working on that very soon.\n\n[1] http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller",
    "created_at": "2009-12-22T05:19:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52223",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:5" align="right">comment:5</div>

MVC [1] separates the layers of the program into a model, which has the data; views, which are ways to present the data; and the controller/s, which control which data to show etc.

Currently the notebook serves as a model/controller and has some view functions mixed into it (`html_*`). Separating things will make things cleaner, and will make dealing with unicode easier: the view is presented with encoded byte strings, the controller deals with unicode strings, and data is retrieved from the model (db or filesystem) in encoded data which is converted to unicode strings.

Without this separation, one will need to check whether each string passed is an encoded byte string or a unicode string.

Separation will entail first removing the `html_*` functions, which in turn means restructuring the templates. I'll be working on that very soon.

[1] http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller



---

archive/issue_comments_052224.json:
```json
{
    "body": "Converts much storage to unicode, and adds the necessary encoding for storage and networking. Uses jinja2 instead of jinja. Depends on #7835, #7786 and their dependencies.",
    "created_at": "2010-01-06T20:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52224",
    "user": "https://github.com/TimDumol"
}
```

Converts much storage to unicode, and adds the necessary encoding for storage and networking. Uses jinja2 instead of jinja. Depends on #7835, #7786 and their dependencies.



---

archive/issue_events_088790.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-06T20:14:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88790"
}
```



---

archive/issue_events_088791.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-06T20:14:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88791"
}
```



---

archive/issue_comments_052225.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[trac_7249_jinja2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2.patch.gz)**\n\nHopefully this patch will do the trick and make i18n easier.",
    "created_at": "2010-01-06T20:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52225",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[trac_7249_jinja2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2.patch.gz)**

Hopefully this patch will do the trick and make i18n easier.



---

archive/issue_comments_052226.json:
```json
{
    "body": "Attachment: **[trac_7249_jinja2_v2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v2.patch.gz)**\n\nFix several doctests.  Replaces previous.",
    "created_at": "2010-01-06T21:41:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52226",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_7249_jinja2_v2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v2.patch.gz)**

Fix several doctests.  Replaces previous.



---

archive/issue_events_088792.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-06T22:00:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88792"
}
```



---

archive/issue_events_088793.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-06T22:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88793"
}
```



---

archive/issue_comments_052227.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nV3:\n\n* Fixes a number of doctests.\n* `iamges` --> `images` in `cell.py`.\n* `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.\n\nI'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?\n\nShould the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?\n\nDoes the change to `Worksheet.preparse` belong at #7835?\n\nIf we're planning to use unicode \"everywhere\", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?\n\nI apologize for my ignorance.",
    "created_at": "2010-01-06T22:00:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52227",
    "user": "https://github.com/qed777"
}
```

<div id="comment:7" align="right">comment:7</div>

V3:

* Fixes a number of doctests.
* `iamges` --> `images` in `cell.py`.
* `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.

I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?

Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?

Does the change to `Worksheet.preparse` belong at #7835?

If we're planning to use unicode "everywhere", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?

I apologize for my ignorance.



---

archive/issue_comments_052228.json:
```json
{
    "body": "Changed author from **Dan Drake** to **Tim Dumol, Dan Drake**",
    "created_at": "2010-01-06T22:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52228",
    "user": "https://github.com/qed777"
}
```

Changed author from **Dan Drake** to **Tim Dumol, Dan Drake**



---

archive/issue_comments_052229.json:
```json
{
    "body": "Rebased vs. #7835 v2, #7786 v8, etc.  Replaces previous.",
    "created_at": "2010-01-07T02:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52229",
    "user": "https://github.com/qed777"
}
```

Rebased vs. #7835 v2, #7786 v8, etc.  Replaces previous.



---

archive/issue_comments_052230.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_7249_jinja2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v3.patch.gz)**\n\nV3 (really) is rebased against the latest at #7835, #7786.  Besides consistently using UTF-8 for the cell/worksheet system, I'm curious about `Cell.__init__`, where `str`s are `encode`d, not `decode`d.  Again, I'm not very familiar with encodings, so I may well be wrong.  Thanks!",
    "created_at": "2010-01-07T02:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52230",
    "user": "https://github.com/qed777"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_7249_jinja2_v3.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v3.patch.gz)**

V3 (really) is rebased against the latest at #7835, #7786.  Besides consistently using UTF-8 for the cell/worksheet system, I'm curious about `Cell.__init__`, where `str`s are `encode`d, not `decode`d.  Again, I'm not very familiar with encodings, so I may well be wrong.  Thanks!



---

archive/issue_comments_052231.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAccording to the [Python Unicode HOWTO](http://docs.python.org/dev/howto/unicode.html#reading-and-writing-unicode-data), we can use the [codecs.open](http://docs.python.org/library/codecs.html#codecs.open) to read from (decode) and write to (encode) files transparently.",
    "created_at": "2010-01-07T05:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52231",
    "user": "https://github.com/qed777"
}
```

<div id="comment:10" align="right">comment:10</div>

According to the [Python Unicode HOWTO](http://docs.python.org/dev/howto/unicode.html#reading-and-writing-unicode-data), we can use the [codecs.open](http://docs.python.org/library/codecs.html#codecs.open) to read from (decode) and write to (encode) files transparently.



---

archive/issue_comments_052232.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@qed777](#comment:7):\n> V3:\n> \n> * Fixes a number of doctests.\n> * `iamges` --> `images` in `cell.py`.\n> * `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.\n> \n> I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?\n> \n\nSure, and yes.\n\n> Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?\n\ndiv_wrap is a boolean. The div_wrap_ and wrap_ variables are workarounds to limitations present in Jinja2 but not in Jinja, so no, it's not for #7786.\n> \n> Does the change to `Worksheet.preparse` belong at #7835?\n\nSince this particular ticket is for Jinja2, which requires unicode, no. #7835 only replaces functionality that was previously present.\n\n> \n> If we're planning to use unicode \"everywhere\", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?\n\nYes, unicode functionality should be doctested.\n\n> \n> I apologize for my ignorance.",
    "created_at": "2010-01-10T06:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52232",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@qed777](#comment:7):
> V3:
> 
> * Fixes a number of doctests.
> * `iamges` --> `images` in `cell.py`.
> * `inpit_text = input_text.decode('utf-8', str)` --> `input_text = input_text.decode('utf-8', 'ignore')` in `cell.py`.
> 
> I'm not sure about the choice of `encode` / `decode` in some places.  Should we always `decode` instances of `str` and `encode` instances of `unicode`?  Could you please double-check the patch?  Also, would it be better to write and use a helper function to do the conversions?
> 

Sure, and yes.

> Should the changes to `cell.html` be at #7786?  Isn't `div_wrap` a `boolean`?

div_wrap is a boolean. The div_wrap_ and wrap_ variables are workarounds to limitations present in Jinja2 but not in Jinja, so no, it's not for #7786.
> 
> Does the change to `Worksheet.preparse` belong at #7835?

Since this particular ticket is for Jinja2, which requires unicode, no. #7835 only replaces functionality that was previously present.

> 
> If we're planning to use unicode "everywhere", even for the worksheet / cell *system*, should we also **consistently** cover the relevant methods (and examples for) in `worksheet.py` and elsewhere?

Yes, unicode functionality should be doctested.

> 
> I apologize for my ignorance.



---

archive/issue_comments_052233.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAlso, don't apologize for any supposed ignorance please. We're all ignorant.",
    "created_at": "2010-01-10T06:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52233",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:12" align="right">comment:12</div>

Also, don't apologize for any supposed ignorance please. We're all ignorant.



---

archive/issue_events_088794.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-16T08:40:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88794"
}
```



---

archive/issue_events_088795.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-16T08:40:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88795"
}
```



---

archive/issue_comments_052234.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe new patch fixes the styling of the worksheet listing page and adds two new functions in `sage.misc.misc`: `encoded_str` and `unicode_str` for encoding and decoding strings automatically.",
    "created_at": "2010-01-16T08:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52234",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:13" align="right">comment:13</div>

The new patch fixes the styling of the worksheet listing page and adds two new functions in `sage.misc.misc`: `encoded_str` and `unicode_str` for encoding and decoding strings automatically.



---

archive/issue_comments_052235.json:
```json
{
    "body": "Attachment: **[trac_7249_jinja2_v4.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v4.patch.gz)**\n\nFixes the styling of the worksheet listing page.",
    "created_at": "2010-01-16T23:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52235",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_7249_jinja2_v4.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v4.patch.gz)**

Fixes the styling of the worksheet listing page.



---

archive/issue_comments_052236.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis is the new patch queue:\n\n```\ntrac_7650-sagenb_doctesting_v6.patch\ntrac_7650-reviewer.patch\ntrac_7648-missing_indent.patch\ntrac_7663-rstrip_prompt.patch\ntrac_7847-empty-trash-no-referer.patch\ntrac_7786-template-jinja-idiomatic.patch\ntrac_7863-declare_vars_aux_js_v2.patch\ntrac_7874-typeset_interact_labels.patch\ntrac_7858-key_binding_vars_v2.patch\ntrac_7666-alphanumeric_cell_ids_B5.patch\ntrac_7666-reviewer.patch\ntrac_7835-preparsing-unicode_v2.patch\ntrac_7249_jinja2_v5.patch\n```",
    "created_at": "2010-01-17T21:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52236",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:14" align="right">comment:14</div>

This is the new patch queue:

```
trac_7650-sagenb_doctesting_v6.patch
trac_7650-reviewer.patch
trac_7648-missing_indent.patch
trac_7663-rstrip_prompt.patch
trac_7847-empty-trash-no-referer.patch
trac_7786-template-jinja-idiomatic.patch
trac_7863-declare_vars_aux_js_v2.patch
trac_7874-typeset_interact_labels.patch
trac_7858-key_binding_vars_v2.patch
trac_7666-alphanumeric_cell_ids_B5.patch
trac_7666-reviewer.patch
trac_7835-preparsing-unicode_v2.patch
trac_7249_jinja2_v5.patch
```



---

archive/issue_comments_052237.json:
```json
{
    "body": "Rebase on a new patch set.",
    "created_at": "2010-01-18T00:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52237",
    "user": "https://github.com/TimDumol"
}
```

Rebase on a new patch set.



---

archive/issue_comments_052238.json:
```json
{
    "body": "Attachment: **[trac_7249_jinja2_v5.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.patch.gz)**\n\nAttachment: **[trac_7249_jinja2_v5.2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.2.patch.gz)**\n\nAdded an 'ignore' errors directive to `unicode_string`",
    "created_at": "2010-01-18T01:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52238",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_7249_jinja2_v5.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.patch.gz)**

Attachment: **[trac_7249_jinja2_v5.2.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.2.patch.gz)**

Added an 'ignore' errors directive to `unicode_string`



---

archive/issue_comments_052239.json:
```json
{
    "body": "Reviewer: **Mitesh Patel**",
    "created_at": "2010-01-18T07:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52239",
    "user": "https://github.com/qed777"
}
```

Reviewer: **Mitesh Patel**



---

archive/issue_comments_052240.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIn `notebook.py`, should `hunk = encoded_str(hunk)` be `hunk = unicode_str(hunk)`?\n\nIn `Cell.__init__`, can we simplify `self.set_input_text(str(input).replace('\\r',''))`?\n\nIn `twist.py`, do we need to call `unicode_str` on the incoming input?  The constructors and `set_input_text` do this.",
    "created_at": "2010-01-18T07:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52240",
    "user": "https://github.com/qed777"
}
```

<div id="comment:15" align="right">comment:15</div>

In `notebook.py`, should `hunk = encoded_str(hunk)` be `hunk = unicode_str(hunk)`?

In `Cell.__init__`, can we simplify `self.set_input_text(str(input).replace('\r',''))`?

In `twist.py`, do we need to call `unicode_str` on the incoming input?  The constructors and `set_input_text` do this.



---

archive/issue_comments_052241.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAlso, evaluating `print '\u00e9'` raises\n\n```python\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/twist.py\", line 1281, in render\n            cell.set_input_text(input_text)\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/cell.py\", line 1270, in set_input_text\n            input = unicode_str(input)\n          File \"/home/tmp/sagenb-0.5/src/sagenb/sagenb/misc/misc.py\", line 441, in unicode_str\n            return unicode(str(obj), encoding, 'ignore')\n        exceptions.UnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 7: ordinal not in range(128)\n\n```",
    "created_at": "2010-01-18T07:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52241",
    "user": "https://github.com/qed777"
}
```

<div id="comment:16" align="right">comment:16</div>

Also, evaluating `print 'é'` raises

```python
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/twist.py", line 1281, in render
            cell.set_input_text(input_text)
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/notebook/cell.py", line 1270, in set_input_text
            input = unicode_str(input)
          File "/home/tmp/sagenb-0.5/src/sagenb/sagenb/misc/misc.py", line 441, in unicode_str
            return unicode(str(obj), encoding, 'ignore')
        exceptions.UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 7: ordinal not in range(128)

```



---

archive/issue_events_088796.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T07:58:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88796"
}
```



---

archive/issue_events_088797.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T07:58:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88797"
}
```



---

archive/issue_comments_052242.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNice catches. Here's a patch to fix them.",
    "created_at": "2010-01-18T07:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52242",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:17" align="right">comment:17</div>

Nice catches. Here's a patch to fix them.



---

archive/issue_comments_052243.json:
```json
{
    "body": "Adds the suggested fixes by mpatel.",
    "created_at": "2010-01-18T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52243",
    "user": "https://github.com/TimDumol"
}
```

Adds the suggested fixes by mpatel.



---

archive/issue_events_088798.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T08:19:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88798"
}
```



---

archive/issue_events_088799.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T08:19:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88799"
}
```



---

archive/issue_comments_052244.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[trac_7249_jinja2_v5.3.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.3.patch.gz)**\n\nWoops! Sorry, accidentally put it to positive review. You should be the one, if ever.",
    "created_at": "2010-01-18T08:19:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52244",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[trac_7249_jinja2_v5.3.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.3.patch.gz)**

Woops! Sorry, accidentally put it to positive review. You should be the one, if ever.



---

archive/issue_comments_052245.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nUpon saving and quitting a worksheet that contains an evaluated <code>print \\`\u00e9\\`</code> cell, I see\n\n```python\nworksheet.py:1924: exceptions.UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal\n```\n\nWhat about the `unicode_str`s in `twist.py`?  I'm just wondering why we need them.\n\nMinor: It appears we can just call `encoded_str` in `sage_inspect.py`.\n\nAlso, can you slip some Unicode characters into the Se and/or doctests, so that we can detect potential regressions?",
    "created_at": "2010-01-18T08:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52245",
    "user": "https://github.com/qed777"
}
```

<div id="comment:19" align="right">comment:19</div>

Upon saving and quitting a worksheet that contains an evaluated <code>print \`é\`</code> cell, I see

```python
worksheet.py:1924: exceptions.UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
```

What about the `unicode_str`s in `twist.py`?  I'm just wondering why we need them.

Minor: It appears we can just call `encoded_str` in `sage_inspect.py`.

Also, can you slip some Unicode characters into the Se and/or doctests, so that we can detect potential regressions?



---

archive/issue_comments_052246.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm pretty sure that that warning is unavoidable (has to do with upgrading from non-unicode to unicode). The `unicode_str`s are there just out of paranoia. Nice catch with the sage_inspect.py thing. I'll update the tests now.",
    "created_at": "2010-01-18T09:25:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52246",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm pretty sure that that warning is unavoidable (has to do with upgrading from non-unicode to unicode). The `unicode_str`s are there just out of paranoia. Nice catch with the sage_inspect.py thing. I'll update the tests now.



---

archive/issue_comments_052247.json:
```json
{
    "body": "Attachment: **[trac_7249_jinja2_v5.4.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.4.patch.gz)**\n\nAdds the requested doctests and Se tests and the cleanup on `sage_inspect.py`",
    "created_at": "2010-01-18T10:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52247",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_7249_jinja2_v5.4.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249_jinja2_v5.4.patch.gz)**

Adds the requested doctests and Se tests and the cleanup on `sage_inspect.py`



---

archive/issue_comments_052248.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThis new patch should add the requested tests.",
    "created_at": "2010-01-18T10:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52248",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:21" align="right">comment:21</div>

This new patch should add the requested tests.



---

archive/issue_events_088800.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T10:55:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88800"
}
```



---

archive/issue_events_088801.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-18T10:55:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88801"
}
```



---

archive/issue_comments_052249.json:
```json
{
    "body": "Fixes a problem with text cells with unicode contents.",
    "created_at": "2010-01-19T04:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52249",
    "user": "https://github.com/TimDumol"
}
```

Fixes a problem with text cells with unicode contents.



---

archive/issue_comments_052250.json:
```json
{
    "body": "Attachment: **[trac_7249-jinja2_v6.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v6.patch.gz)**\n\nTest fix, drop pdb.  Replaces previous.",
    "created_at": "2010-01-19T11:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52250",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_7249-jinja2_v6.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v6.patch.gz)**

Test fix, drop pdb.  Replaces previous.



---

archive/issue_events_088802.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-19T11:31:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88802"
}
```



---

archive/issue_events_088803.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-19T11:31:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88803"
}
```



---

archive/issue_comments_052251.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAttachment: **[trac_7249-jinja2_v7.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v7.patch.gz)**\n\nV7 fixes a failed doctest in `cell.py` (line 138) and removes `import pdb; pdb.set_trace()` from `test_worksheet_list.py`.",
    "created_at": "2010-01-19T11:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52251",
    "user": "https://github.com/qed777"
}
```

<div id="comment:22" align="right">comment:22</div>

Attachment: **[trac_7249-jinja2_v7.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v7.patch.gz)**

V7 fixes a failed doctest in `cell.py` (line 138) and removes `import pdb; pdb.set_trace()` from `test_worksheet_list.py`.



---

archive/issue_comments_052252.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOn the non-ASCII Unicode characters which may break docbuilds, please see #8000.",
    "created_at": "2010-01-19T16:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52252",
    "user": "https://github.com/qed777"
}
```

<div id="comment:23" align="right">comment:23</div>

On the non-ASCII Unicode characters which may break docbuilds, please see #8000.



---

archive/issue_comments_052253.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSphinx raises\n\n```\nreading sources... [100%] sagenb/notebook/worksheet\nSphinx error:\n'utf8' codec can't decode bytes in position 420-422: invalid data\n```\nThe \"invalid\" data appears to be `u'\\xe4'` in line 695 (or so) of `worksheet.py`:\n\n```python\n            u'\\u03ab\\xe4\\u013b\\u01be\\u1e40\\u0411'                               \n```\nV8 just makes the docstring raw (`\"\"\"` --> `r\"\"\"`).  I've added `'\u0422\u0435\u043e\u0440\u0438\u044f \u0447\u0438\u0441\u0435\u043b'`, partly for fun.",
    "created_at": "2010-01-19T19:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52253",
    "user": "https://github.com/qed777"
}
```

<div id="comment:24" align="right">comment:24</div>

Sphinx raises

```
reading sources... [100%] sagenb/notebook/worksheet
Sphinx error:
'utf8' codec can't decode bytes in position 420-422: invalid data
```
The "invalid" data appears to be `u'\xe4'` in line 695 (or so) of `worksheet.py`:

```python
            u'\u03ab\xe4\u013b\u01be\u1e40\u0411'                               
```
V8 just makes the docstring raw (`"""` --> `r"""`).  I've added `'Теория чисел'`, partly for fun.



---

archive/issue_comments_052254.json:
```json
{
    "body": "Attachment: **[trac_7249-jinja2_v8.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v8.patch.gz)**\n\nMake `Worksheet.name`'s docstring raw, for Sphinx.  Replaces previous.",
    "created_at": "2010-01-19T19:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52254",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_7249-jinja2_v8.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v8.patch.gz)**

Make `Worksheet.name`'s docstring raw, for Sphinx.  Replaces previous.



---

archive/issue_comments_052255.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIt may be better to make the docstrings unicode strings.  V9 does this, but I can't attach it right now:\n\n```\nTrac detected an internal error:\n    IOError: [Errno 28] No space left on device\n```",
    "created_at": "2010-01-19T19:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52255",
    "user": "https://github.com/qed777"
}
```

<div id="comment:25" align="right">comment:25</div>

It may be better to make the docstrings unicode strings.  V9 does this, but I can't attach it right now:

```
Trac detected an internal error:
    IOError: [Errno 28] No space left on device
```



---

archive/issue_comments_052256.json:
```json
{
    "body": "Attachment: **[trac_7249-jinja2_v9.5.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v9.5.patch.gz)**\n\nMake the docstrings unicode strings.  Replaces previous.",
    "created_at": "2010-01-19T19:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52256",
    "user": "https://github.com/qed777"
}
```

Attachment: **[trac_7249-jinja2_v9.5.patch.gz](https://github.com/sagemath/sage/files/ticket7249/trac_7249-jinja2_v9.5.patch.gz)**

Make the docstrings unicode strings.  Replaces previous.



---

archive/issue_comments_052257.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe review patches look good. Nice work. I must say, the reviewing of this patch is real messy.",
    "created_at": "2010-01-19T20:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52257",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:26" align="right">comment:26</div>

The review patches look good. Nice work. I must say, the reviewing of this patch is real messy.



---

archive/issue_events_088804.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:50:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88804"
}
```



---

archive/issue_events_088805.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:50:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7249#event-88805"
}
```



---

archive/issue_comments_052258.json:
```json
{
    "body": "Merged: **sagenb-0.7**",
    "created_at": "2010-01-25T00:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52258",
    "user": "https://github.com/qed777"
}
```

Merged: **sagenb-0.7**



---

archive/issue_comments_052259.json:
```json
{
    "body": "Blocking: **8051**",
    "created_at": "2010-01-27T05:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7249",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7249#issuecomment-52259",
    "user": "https://github.com/qed777"
}
```

Blocking: **8051**
