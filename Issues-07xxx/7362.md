# Issue 7362: Make worksheet auto-sync and collaborative editing smarter and more granular

archive/issues_007362.json:
```json
{
    "assignees": [],
    "body": "We ought to make collaborative worksheet editing somewhat more intuitive, even if we stop short (for now) of implementing full-strength [operational transformations](http://en.wikipedia.org/wiki/Operational_transformation) or employing the [Wave Federation Protocol](http://www.waveprotocol.org/).\n\nSee [sage-notebook](http://groups.google.com/group/sage-notebook/browse_thread/thread/d46ab54616c03b88/df5e0b2e82af4d5a#df5e0b2e82af4d5a).\n\nFrom [this comment](https://github.com/sagemath/sage/issues/7254#comment:11) at #7254:\n\n     The browser and server do not update their `state_number`s if a new cell is added at the end of a sheet, when text cells are added, or cells are deleted. Should we add these to the list, along with the `'delete_all_output'`, `'pretty_print'`, `'system'` worksheet commands? \n\n\n\nAssignee: **@boothby**\n\nCC:  @jasongrout @haraldschilly\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7362_\n\n",
    "closed_at": "2020-03-29T02:12:30Z",
    "created_at": "2009-10-31T14:43:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20notebook",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make worksheet auto-sync and collaborative editing smarter and more granular",
    "type": "issue",
    "updated_at": "2020-03-29T02:12:30Z",
    "url": "https://github.com/sagemath/sage/issues/7362",
    "user": "https://github.com/qed777"
}
```
We ought to make collaborative worksheet editing somewhat more intuitive, even if we stop short (for now) of implementing full-strength [operational transformations](http://en.wikipedia.org/wiki/Operational_transformation) or employing the [Wave Federation Protocol](http://www.waveprotocol.org/).

See [sage-notebook](http://groups.google.com/group/sage-notebook/browse_thread/thread/d46ab54616c03b88/df5e0b2e82af4d5a#df5e0b2e82af4d5a).

From [this comment](https://github.com/sagemath/sage/issues/7254#comment:11) at #7254:

     The browser and server do not update their `state_number`s if a new cell is added at the end of a sheet, when text cells are added, or cells are deleted. Should we add these to the list, along with the `'delete_all_output'`, `'pretty_print'`, `'system'` worksheet commands? 



Assignee: **@boothby**

CC:  @jasongrout @haraldschilly

_Issue created by migration from https://trac.sagemath.org/ticket/7362_





---

archive/issue_events_081724.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-10-31T14:43:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20notebook",
    "label_color": "000080",
    "label_name": "component: notebook",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81724"
}
```



---

archive/issue_events_081725.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-10-31T14:43:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81725"
}
```



---

archive/issue_events_081726.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-10-31T14:43:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81726"
}
```



---

archive/issue_comments_055233.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nSee [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/56cf668a71172b8e/8f1fac23aaca42d3?#8f1fac23aaca42d3), too.",
    "created_at": "2009-11-06T02:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7362#issuecomment-55233",
    "user": "https://github.com/qed777"
}
```

<div id="comment:1" align="right">Comment 1</div>

See [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/56cf668a71172b8e/8f1fac23aaca42d3?#8f1fac23aaca42d3), too.



---

archive/issue_comments_055234.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nReplying to [@qed777](#comment%3A1):\n> See [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/56cf668a71172b8e/8f1fac23aaca42d3?#8f1fac23aaca42d3), too.\n\nThe links:\n\n* [MobWrite](http://code.google.com/p/google-mobwrite/) - [theory](http://code.google.com/p/google-mobwrite/wiki/Theory), [client setup](http://code.google.com/p/google-mobwrite/wiki/WebClient), [server setup](http://code.google.com/p/google-mobwrite/wiki/Daemon), [status](http://code.google.com/p/google-mobwrite/wiki/Status).\n* [Cola](http://wiki.eclipse.org/RT_Shared_Editing) - Real-time shared editing in Eclipse - [screencast](http://www.vimeo.com/1195398).\n\nMobWrite seems to be a good option, provided it doesn't overload client and server.  We can call `mobwrite.share` for new input cells and `mobwrite.unshare` for deleted cells.  *If* MobWrite cannot synchronize arbitrary HTML, perhaps we can `mobwrite.share` a hidden auxiliary cell that holds the escaped HTML of its corresponding output cell.  We can update the output cell's `innerHTML` when MobWrite triggers the auxiliary's `onchange` handler.  Of course, this assumes that we don't run more than one synchronization algorithm at a time.",
    "created_at": "2009-11-11T18:13:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7362#issuecomment-55234",
    "user": "https://github.com/qed777"
}
```

<div id="comment:2" align="right">Comment 2</div>

Replying to [@qed777](#comment%3A1):
> See [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/56cf668a71172b8e/8f1fac23aaca42d3?#8f1fac23aaca42d3), too.

The links:

* [MobWrite](http://code.google.com/p/google-mobwrite/) - [theory](http://code.google.com/p/google-mobwrite/wiki/Theory), [client setup](http://code.google.com/p/google-mobwrite/wiki/WebClient), [server setup](http://code.google.com/p/google-mobwrite/wiki/Daemon), [status](http://code.google.com/p/google-mobwrite/wiki/Status).
* [Cola](http://wiki.eclipse.org/RT_Shared_Editing) - Real-time shared editing in Eclipse - [screencast](http://www.vimeo.com/1195398).

MobWrite seems to be a good option, provided it doesn't overload client and server.  We can call `mobwrite.share` for new input cells and `mobwrite.unshare` for deleted cells.  *If* MobWrite cannot synchronize arbitrary HTML, perhaps we can `mobwrite.share` a hidden auxiliary cell that holds the escaped HTML of its corresponding output cell.  We can update the output cell's `innerHTML` when MobWrite triggers the auxiliary's `onchange` handler.  Of course, this assumes that we don't run more than one synchronization algorithm at a time.



---

archive/issue_events_081727.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-11-11T18:13:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81727"
}
```



---

archive/issue_events_081728.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2009-11-11T18:13:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81728"
}
```



---

archive/issue_events_081729.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2020-03-29T02:12:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81729"
}
```



---

archive/issue_events_081730.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2020-03-29T02:12:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81730"
}
```



---

archive/issue_events_081731.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2020-03-29T02:12:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7362#event-81731"
}
```



---

archive/issue_comments_055235.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nClosing deprecated notebook tickets",
    "created_at": "2020-03-29T02:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7362#issuecomment-55235",
    "user": "https://github.com/boothby"
}
```

<div id="comment:3" align="right">Comment 3</div>

Closing deprecated notebook tickets
