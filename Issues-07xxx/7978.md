# Issue 7978: Cleanup of crystal code

archive/issues_007978.json:
```json
{
    "body": "Fixed some issues in crystals, such as\n- Comparison of elements\n- Latex output\n- Fixes whitespaces in /combinat/crystals/affine.py (as reported by Jason Bandlow)\n- All crystals have unique representation\n- Preparation of categorification of crystals:\n   - C.element_class -> C.Element\n   - All crystals are at least in the EnumeratedSets category\n   - Use rename, or define _repr_, instead of setting _name\n     Eventually, crystals should only use _repr_\n   => Removed dependency upon deprecated CombinatorialClass\n- Systematic use of TestSuite instead of loads/dumps test\n- Fixed bug in fast_crystal: delpat is not immutable (which should be\n  eventually be fixed), and was accidentally changed by the weight\n  method). This was caught by turning on unique representation which\n  made the crystals to be reused longer in the tests.\n\nDepends on #8028 (element wrapper improvement)\n\n\nAssignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: crystals\n\nResolution: fixed\n\nAuthor: Nicolas M. Thi\u00e9ry, Anne Schilling\n\nReviewer: Dan Bump\n\nMerged: sage-4.3.3.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/7978\n\n",
    "closed_at": "2010-02-11T14:48:23Z",
    "created_at": "2010-01-18T14:43:28Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.3",
    "title": "Cleanup of crystal code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7978",
    "user": "https://github.com/jbandlow"
}
```
Fixed some issues in crystals, such as
- Comparison of elements
- Latex output
- Fixes whitespaces in /combinat/crystals/affine.py (as reported by Jason Bandlow)
- All crystals have unique representation
- Preparation of categorification of crystals:
   - C.element_class -> C.Element
   - All crystals are at least in the EnumeratedSets category
   - Use rename, or define _repr_, instead of setting _name
     Eventually, crystals should only use _repr_
   => Removed dependency upon deprecated CombinatorialClass
- Systematic use of TestSuite instead of loads/dumps test
- Fixed bug in fast_crystal: delpat is not immutable (which should be
  eventually be fixed), and was accidentally changed by the weight
  method). This was caught by turning on unique representation which
  made the crystals to be reused longer in the tests.

Depends on #8028 (element wrapper improvement)


Assignee: sage-combinat

CC:  sage-combinat

Keywords: crystals

Resolution: fixed

Author: Nicolas M. Thiéry, Anne Schilling

Reviewer: Dan Bump

Merged: sage-4.3.3.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/7978





---

archive/issue_comments_087974.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2010-01-18T15:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87974",
    "user": "https://github.com/jbandlow"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_087975.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_7978_fix_tabs_in_affine_py-jb.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_fix_tabs_in_affine_py-jb.patch) by @jbandlow created at 2010-01-18 15:17:51\n\nOops.  This patch depends on some patches in the combinat stack.  (I suspect the 'crystal-cleanup' patches.)  The change is trivial, but I'll coordinate with the sage-combinat list before marking this ready for review.",
    "created_at": "2010-01-18T15:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87975",
    "user": "https://github.com/jbandlow"
}
```

<a id='comment:1'></a>
Attachment [trac_7978_fix_tabs_in_affine_py-jb.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_fix_tabs_in_affine_py-jb.patch) by @jbandlow created at 2010-01-18 15:17:51

Oops.  This patch depends on some patches in the combinat stack.  (I suspect the 'crystal-cleanup' patches.)  The change is trivial, but I'll coordinate with the sage-combinat list before marking this ready for review.



---

archive/issue_comments_087976.json:
```json
{
    "body": "Attachment [trac_7978_crystal_cleanup-as.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_crystal_cleanup-as.patch) by @anneschilling created at 2010-01-25 06:27:16",
    "created_at": "2010-01-25T06:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87976",
    "user": "https://github.com/anneschilling"
}
```

Attachment [trac_7978_crystal_cleanup-as.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_crystal_cleanup-as.patch) by @anneschilling created at 2010-01-25 06:27:16



---

archive/issue_comments_087977.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,19 @@\n-They should be replaced with spaces.\n+Fixed some issues in crystals, such as\n+- Comparison of elements\n+- Latex output\n+- Fixes whitespaces in /combinat/crystals/affine.py (as reported by Jason Bandlow)\n+- All crystals have unique representation\n+- Preparation of categorification of crystals:\n+   - C.element_class -> C.Element\n+   - All crystals are at least in the EnumeratedSets category\n+   - Use rename, or define _repr_, instead of setting _name\n+     Eventually, crystals should only use _repr_\n+   => Removed dependency upon deprecated CombinatorialClass\n+- Systematic use of TestSuite instead of loads/dumps test\n+- Fixed bug in fast_crystal: delpat is not immutable (which should be\n+  eventually be fixed), and was accidentally changed by the weight\n+  method). This was caught by turning on unique representation which\n+  made the crystals to be reused longer in the tests.\n+\n+Depends on trac ticket 8028 (element wrapper improvement)\n+\n``````\n",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87977",
    "user": "https://github.com/anneschilling"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,19 @@
-They should be replaced with spaces.
+Fixed some issues in crystals, such as
+- Comparison of elements
+- Latex output
+- Fixes whitespaces in /combinat/crystals/affine.py (as reported by Jason Bandlow)
+- All crystals have unique representation
+- Preparation of categorification of crystals:
+   - C.element_class -> C.Element
+   - All crystals are at least in the EnumeratedSets category
+   - Use rename, or define _repr_, instead of setting _name
+     Eventually, crystals should only use _repr_
+   => Removed dependency upon deprecated CombinatorialClass
+- Systematic use of TestSuite instead of loads/dumps test
+- Fixed bug in fast_crystal: delpat is not immutable (which should be
+  eventually be fixed), and was accidentally changed by the weight
+  method). This was caught by turning on unique representation which
+  made the crystals to be reused longer in the tests.
+
+Depends on trac ticket 8028 (element wrapper improvement)
+
``````




---

archive/issue_comments_087978.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe patch trac_7978_crystal_cleanup-as.patch supersedes Jason's patch. It fixes the whitespace issues in combinat/crystals/affine.py and does a lot more improvements in crystals (see description).",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87978",
    "user": "https://github.com/anneschilling"
}
```

<a id='comment:2'></a>
The patch trac_7978_crystal_cleanup-as.patch supersedes Jason's patch. It fixes the whitespace issues in combinat/crystals/affine.py and does a lot more improvements in crystals (see description).



---

archive/issue_comments_087979.json:
```json
{
    "body": "Changing keywords from \"\" to \"crystals\".",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87979",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "" to "crystals".



---

archive/issue_comments_087980.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87980",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_087981.json:
```json
{
    "body": "Changing author from \"\" to \"Nicolas M. Thiery, Anne Schilling\"",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87981",
    "user": "https://github.com/anneschilling"
}
```

Changing author from "" to "Nicolas M. Thiery, Anne Schilling"



---

archive/issue_comments_087982.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dan Bump\"",
    "created_at": "2010-01-25T06:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87982",
    "user": "https://github.com/anneschilling"
}
```

Changing reviewer from "" to "Dan Bump"



---

archive/issue_events_023907.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "rename": {
        "from": "The file sage/combinat/affine.py contains lots of 'tab' characters",
        "to": "Cleanup of crystal code"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7978#event-23907"
}
```



---

archive/issue_comments_087983.json:
```json
{
    "body": "Changing author from \"Nicolas M. Thiery, Anne Schilling\" to \"Nicolas M. Thi\u00e9ry, Anne Schilling\"",
    "created_at": "2010-01-25T21:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87983",
    "user": "https://github.com/nthiery"
}
```

Changing author from "Nicolas M. Thiery, Anne Schilling" to "Nicolas M. Thiéry, Anne Schilling"



---

archive/issue_comments_087984.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,5 +15,5 @@\n   method). This was caught by turning on unique representation which\n   made the crystals to be reused longer in the tests.\n \n-Depends on trac ticket 8028 (element wrapper improvement)\n+Depends on #8028 (element wrapper improvement)\n \n``````\n",
    "created_at": "2010-01-25T21:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87984",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,5 +15,5 @@
   method). This was caught by turning on unique representation which
   made the crystals to be reused longer in the tests.
 
-Depends on trac ticket 8028 (element wrapper improvement)
+Depends on #8028 (element wrapper improvement)
 
``````




---

archive/issue_comments_087985.json:
```json
{
    "body": "Updated patch updates one doctest.",
    "created_at": "2010-01-27T01:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87985",
    "user": "https://github.com/nthiery"
}
```

Updated patch updates one doctest.



---

archive/issue_comments_087986.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [trac_7978_crystal_cleanup-as.2.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_crystal_cleanup-as.2.patch) by @dwbump created at 2010-02-02 14:45:40\n\nI checked that the patch passes sage --testall, either with or without #8028.\n\nI checked that it does not break latex method for classical crystals or metapost method for fastcrystals. I think the latex changes are specific to\naffine crystals.\n\nThe patch does not seem to break anything, and fixes some problems. I recommend merging it.",
    "created_at": "2010-02-02T14:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87986",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:4'></a>
Attachment [trac_7978_crystal_cleanup-as.2.patch](tarball://root/attachments/some-uuid/ticket7978/trac_7978_crystal_cleanup-as.2.patch) by @dwbump created at 2010-02-02 14:45:40

I checked that the patch passes sage --testall, either with or without #8028.

I checked that it does not break latex method for classical crystals or metapost method for fastcrystals. I think the latex changes are specific to
affine crystals.

The patch does not seem to break anything, and fixes some problems. I recommend merging it.



---

archive/issue_comments_087987.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-02-02T14:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87987",
    "user": "https://github.com/dwbump"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_087988.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've added the ticket number in the refreshed patch I'm applying to 4.3.3.alpha0.",
    "created_at": "2010-02-10T14:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87988",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>
I've added the ticket number in the refreshed patch I'm applying to 4.3.3.alpha0.



---

archive/issue_comments_087989.json:
```json
{
    "body": "<a id='comment:6'></a>\nI'm having trouble parsing mpatel's message. Does this mean the patch is to be merged in 4.3.3.alpha0?\n\nWhat \"refreshed patch\" does this message refer to?  The patch trac_7978_crystal_cleanup-as.2.patch\napplies cleanly to sage-4.3.2 and does not break anything in sage/combinat/crystals.",
    "created_at": "2010-02-11T13:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87989",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:6'></a>
I'm having trouble parsing mpatel's message. Does this mean the patch is to be merged in 4.3.3.alpha0?

What "refreshed patch" does this message refer to?  The patch trac_7978_crystal_cleanup-as.2.patch
applies cleanly to sage-4.3.2 and does not break anything in sage/combinat/crystals.



---

archive/issue_comments_087990.json:
```json
{
    "body": "<a id='comment:7'></a>\nI'll merge this ticket into 4.3.3.alpha0.  I mean only that I've prepended the ticket number to the first line of the commit string of the patch I've added to my working tree for 4.3.3.alpha0.  I apologize for being so cryptic.",
    "created_at": "2010-02-11T13:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87990",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
I'll merge this ticket into 4.3.3.alpha0.  I mean only that I've prepended the ticket number to the first line of the commit string of the patch I've added to my working tree for 4.3.3.alpha0.  I apologize for being so cryptic.



---

archive/issue_comments_087991.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.3.3.alpha0\"",
    "created_at": "2010-02-11T14:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87991",
    "user": "https://github.com/qed777"
}
```

Changing merged from "" to "sage-4.3.3.alpha0"



---

archive/issue_comments_087992.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-02-11T14:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7978#issuecomment-87992",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed



---

archive/issue_events_023908.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-02-11T14:48:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7978",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7978#event-23908"
}
```
