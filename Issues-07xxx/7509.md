# Issue 7509: notebook -- make it possible to debug Python code in the notebook, e.g., something like pdb that works in the notebook

archive/issues_007509.json:
```json
{
    "body": "NOTE: \"sage -coverage\" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.\n\n\n---\n\n\n**Assignee:** boothby\n\n**CC:**  @novoselt whuss\n\n**Author:** William Stein, Wilfried Huss\n\n**Reviewer:** David Roe\n\n**Merged:** sage-5.0.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/7509\n\n",
    "closed_at": "2012-02-07T13:20:52Z",
    "created_at": "2009-11-21T13:11:41Z",
    "labels": [
        "component: interact",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "notebook -- make it possible to debug Python code in the notebook, e.g., something like pdb that works in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7509",
    "user": "https://github.com/williamstein"
}
```
NOTE: "sage -coverage" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.


---


**Assignee:** boothby

**CC:**  @novoselt whuss

**Author:** William Stein, Wilfried Huss

**Reviewer:** David Roe

**Merged:** sage-5.0.beta3

Issue created by migration from https://trac.sagemath.org/ticket/7509





---

archive/issue_comments_073301.json:
```json
{
    "body": "<a id='comment:2'></a>\nPaste the following code into any notebook cell (in any version of sage ever) and you have a debugger. \n\n```\nclass debug:\n    \"\"\"\n    If you get a traceback in the notebook, type ``d=debug()`` right\n    after the error to create a debugger object on that traceback.\n    Using the debugger you can move and down the call stack, and \n    evaluate arbitrary code anywhere in the call stack (typically\n    to inspect the value of variables).\n    \n        - printing ``d`` shows the call stack and some context\n        - ``d.up(n)`` (or ``d.u(n)``) moves up `n` frames in \n          the call stack\n        - ``d.down(n)`` (or ``d.d(n)``) moves down `n` frames\n          in the call stack\n        - ``d.list(n)`` (or ``d.l(n)``) displays `n` lines of source \n          code context around the current position in the stack trace\n        - ``d(\"some code\")`` executes the given code in the\n          context of the current position in the stack trace\n          \n    Notes:\n        - Input is not preparsed. \n        - You can define and work with many debug objects at the same time.\n    \"\"\"\n    def __init__(self):\n        import inspect, traceback\n        self.stack = inspect.getinnerframes(sys.last_traceback)\n        self.__curframe = len(self.stack) - 1\n        self.tb = traceback.format_tb(sys.last_traceback)\n        \n    def curframe(self):\n        return self.stack[self.__curframe][0]\n        \n    def frameno(self):\n        return self.__curframe\n        \n    def __call__(self, line):\n        locals = self.curframe().f_locals\n        globals = self.curframe().f_globals\n        try:\n            code = compile(line + '\\n', '<stdin>', 'single')\n            exec code in globals, locals\n        except:\n            t, v = sys.exc_info()[:2]\n            if type(t) == type(''):\n                exc_type_name = t\n            else: exc_type_name = t.__name__\n            print '***', exc_type_name + ':', v\n        \n    def _highlight(self, line):\n        from pygments import highlight\n        from pygments.lexers import PythonLexer\n        from pygments.formatters import HtmlFormatter\n        return highlight(line, PythonLexer(), HtmlFormatter())        \n\n    def __repr__(self):\n        v = ['  ' + str(i) + ':  ' + ' '*(2*i) + \n                 ('\\n'+' '*(2*i)).join(self.tb[i].splitlines()) \n                  for i in range(self.__curframe+1)]\n        if len(v) < len(self.stack):\n            v.append('  ............')\n            v.append('  ' + str(len(self.stack)-1) + ':  (bottom frame)')\n        s = '<b>Traceback:</b>' + self._highlight('\\n'.join(v)) + self._list()\n        return '<html>%s</html>'%s\n\n    def up(self, n=1):\n        self.__curframe -= n\n        if self.__curframe < 0:\n            self.__curframe = 0\n    u = up\n        \n    def down(self, n=1):\n        self.__curframe += n\n        if self.__curframe >= len(self.stack):\n            self.__curframe = len(self.stack)-1\n    d = down\n        \n    def _list(self, n=3):\n        curframe = self.curframe()\n        filename = curframe.f_code.co_filename\n        lineno = curframe.f_lineno\n        import linecache\n        code = ''.join('--> ' if i ==lineno else '    ' + \n                    linecache.getline(filename, i, curframe.f_globals) for\n                    i in range(lineno-n, lineno+n+1))\n        i = filename.rfind('site-packages/sage')\n        if i != -1:\n            fname = filename[i+len('site-packages/sage')+1:].rstrip('/')\n            file = '<a href=\"/src/%s\" target=\"_new\">%s</a>'%(fname,fname)\n        else:\n            file = '<pre>%s</pre>'%filename\n        t = \"\"\"<b>Frame:</b> %s\\n<b>File:  </b>%s<hr>%s<hr>\"\"\"%(\n                 self.frameno(),                \n                 file,self._highlight(code).strip())\n        return t\n                 \n    def list(self, n=3):\n        html(self._list(n))\n    l = list\n```",
    "created_at": "2009-11-21T13:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73301",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
Paste the following code into any notebook cell (in any version of sage ever) and you have a debugger. 

```
class debug:
    """
    If you get a traceback in the notebook, type ``d=debug()`` right
    after the error to create a debugger object on that traceback.
    Using the debugger you can move and down the call stack, and 
    evaluate arbitrary code anywhere in the call stack (typically
    to inspect the value of variables).
    
        - printing ``d`` shows the call stack and some context
        - ``d.up(n)`` (or ``d.u(n)``) moves up `n` frames in 
          the call stack
        - ``d.down(n)`` (or ``d.d(n)``) moves down `n` frames
          in the call stack
        - ``d.list(n)`` (or ``d.l(n)``) displays `n` lines of source 
          code context around the current position in the stack trace
        - ``d("some code")`` executes the given code in the
          context of the current position in the stack trace
          
    Notes:
        - Input is not preparsed. 
        - You can define and work with many debug objects at the same time.
    """
    def __init__(self):
        import inspect, traceback
        self.stack = inspect.getinnerframes(sys.last_traceback)
        self.__curframe = len(self.stack) - 1
        self.tb = traceback.format_tb(sys.last_traceback)
        
    def curframe(self):
        return self.stack[self.__curframe][0]
        
    def frameno(self):
        return self.__curframe
        
    def __call__(self, line):
        locals = self.curframe().f_locals
        globals = self.curframe().f_globals
        try:
            code = compile(line + '\n', '<stdin>', 'single')
            exec code in globals, locals
        except:
            t, v = sys.exc_info()[:2]
            if type(t) == type(''):
                exc_type_name = t
            else: exc_type_name = t.__name__
            print '***', exc_type_name + ':', v
        
    def _highlight(self, line):
        from pygments import highlight
        from pygments.lexers import PythonLexer
        from pygments.formatters import HtmlFormatter
        return highlight(line, PythonLexer(), HtmlFormatter())        

    def __repr__(self):
        v = ['  ' + str(i) + ':  ' + ' '*(2*i) + 
                 ('\n'+' '*(2*i)).join(self.tb[i].splitlines()) 
                  for i in range(self.__curframe+1)]
        if len(v) < len(self.stack):
            v.append('  ............')
            v.append('  ' + str(len(self.stack)-1) + ':  (bottom frame)')
        s = '<b>Traceback:</b>' + self._highlight('\n'.join(v)) + self._list()
        return '<html>%s</html>'%s

    def up(self, n=1):
        self.__curframe -= n
        if self.__curframe < 0:
            self.__curframe = 0
    u = up
        
    def down(self, n=1):
        self.__curframe += n
        if self.__curframe >= len(self.stack):
            self.__curframe = len(self.stack)-1
    d = down
        
    def _list(self, n=3):
        curframe = self.curframe()
        filename = curframe.f_code.co_filename
        lineno = curframe.f_lineno
        import linecache
        code = ''.join('--> ' if i ==lineno else '    ' + 
                    linecache.getline(filename, i, curframe.f_globals) for
                    i in range(lineno-n, lineno+n+1))
        i = filename.rfind('site-packages/sage')
        if i != -1:
            fname = filename[i+len('site-packages/sage')+1:].rstrip('/')
            file = '<a href="/src/%s" target="_new">%s</a>'%(fname,fname)
        else:
            file = '<pre>%s</pre>'%filename
        t = """<b>Frame:</b> %s\n<b>File:  </b>%s<hr>%s<hr>"""%(
                 self.frameno(),                
                 file,self._highlight(code).strip())
        return t
                 
    def list(self, n=3):
        html(self._list(n))
    l = list
```



---

archive/issue_comments_073302.json:
```json
{
    "body": "<a id='comment:3'></a>\nHere's a proof concept interact, assuming one did:\n\n```\nd1 = debug()\n```\nat some point.\n\n```\n@interact\ndef _(command=[None, 'up','down'], code=''):\n    if command == 'up':\n        d1.up()\n    if command == 'down':\n        d1.down()\n    if code:\n        print \"<html>>>> %s\"%code\n        d1(code)\n        print '<hr></html>'\n        \n    print d1\n```",
    "created_at": "2009-11-21T13:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73302",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
Here's a proof concept interact, assuming one did:

```
d1 = debug()
```
at some point.

```
@interact
def _(command=[None, 'up','down'], code=''):
    if command == 'up':
        d1.up()
    if command == 'down':
        d1.down()
    if code:
        print "<html>>>> %s"%code
        d1(code)
        print '<hr></html>'
        
    print d1
```



---

archive/issue_comments_073303.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2012-01-29T19:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73303",
    "user": "https://github.com/novoselt"
}
```

**Upstream:** N/A



---

archive/issue_comments_073304.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+NOTE: \"sage -coverage\" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.\n \n+\n``````\n",
    "created_at": "2012-01-30T03:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73304",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+NOTE: "sage -coverage" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.
 
+
``````




---

archive/issue_comments_073305.json:
```json
{
    "body": "<a id='comment:6'></a>\nSteps to try this out interactively in the notebook:\n\n1. install the patch and rebuild Sage.\n\n2. Do anything that causes a traceback in the notebook, e.g., `EllipticCurve([0,0])`\n\n3. Type `debug()` in any other notebook cell.    You can move up and down the call stack, adjust the amount of context, and evaluate code in the box.   These are the *only* features currently supported -- no setting of breakpoints, stepping through execution, etc.  But this is a very useful first step. \n\nSource code display for Cython code isn't implemented yet.  That's for another ticket.  I think it's OK to put off, since the command line debugger doesn't support it anyways.",
    "created_at": "2012-01-30T03:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73305",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
Steps to try this out interactively in the notebook:

1. install the patch and rebuild Sage.

2. Do anything that causes a traceback in the notebook, e.g., `EllipticCurve([0,0])`

3. Type `debug()` in any other notebook cell.    You can move up and down the call stack, adjust the amount of context, and evaluate code in the box.   These are the *only* features currently supported -- no setting of breakpoints, stepping through execution, etc.  But this is a very useful first step. 

Source code display for Cython code isn't implemented yet.  That's for another ticket.  I think it's OK to put off, since the command line debugger doesn't support it anyways.



---

archive/issue_comments_073306.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-01-30T03:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73306",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from new to needs_review.



---

archive/attachments_009069.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509.patch",
    "created_at": "2012-01-30T03:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_073307.json:
```json
{
    "body": "ready to go",
    "created_at": "2012-01-30T03:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73307",
    "user": "https://github.com/williamstein"
}
```

ready to go



---

archive/issue_comments_073308.json:
```json
{
    "body": "<a id='comment:8'></a>\nShould line 192 of your patch contain the string as r\"\"\" \"\"\"?\n\n```\n        t = \"\"\"%s<hr>> %s\"\"\"%(code, file)\n```\nI see that \"< >\" constructs are eaten away by the browser. An example code which you can use to debug your `Debug()` (pun intended :)) is the following:\n\n```\nReedSolomonCode(15,2,GF(16,'a')).minimum_distance()\n```\nYou need to go to stack frame 8, and look at line 396 of the code that is printed.\n\nOtherwise, it functions very nicely!",
    "created_at": "2012-01-30T19:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73308",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:8'></a>
Should line 192 of your patch contain the string as r""" """?

```
        t = """%s<hr>> %s"""%(code, file)
```
I see that "< >" constructs are eaten away by the browser. An example code which you can use to debug your `Debug()` (pun intended :)) is the following:

```
ReedSolomonCode(15,2,GF(16,'a')).minimum_distance()
```
You need to go to stack frame 8, and look at line 396 of the code that is printed.

Otherwise, it functions very nicely!



---

archive/issue_comments_073309.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [ppurka](#comment%3A8):\n> Should line 192 of your patch contain the string as r\"\"\" \"\"\"?\n> \n> ```\n>         t = \"\"\"%s<hr>> %s\"\"\"%(code, file)\n> ```\n\n\nNo.  r is *only* needed if your string contains backslashes and you don't want to escape them.  It has nothing to do with HTML tags at all. \n\n> I see that \"< >\" constructs are eaten away by the browser. \n\n\nAbove t is an HTML string that I'm construting, and output within an <html> block for the notebook.  It thus gets displayed properly. \n\n> An example code which you can use to debug your `Debug()` (pun intended :)) is the following:\n> \n> ```\n> ReedSolomonCode(15,2,GF(16,'a')).minimum_distance()\n> ```\n> You need to go to stack frame 8, and look at line 396 of the code that is printed.\n\n\nAh, now I see what you mean. The stupid source code display needs to have some HTML escaping done, e.g., < turned to &lt;.  There is a function in the notebook that does that properly, and I'll fix the patch accordingly.  Thanks for finding a genuine bug.  I'll also modify my example functions to include something like. \n\n\n> \n> Otherwise, it functions very nicely!\n",
    "created_at": "2012-01-30T19:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73309",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>
Replying to [ppurka](#comment%3A8):
> Should line 192 of your patch contain the string as r""" """?
> 
> ```
>         t = """%s<hr>> %s"""%(code, file)
> ```


No.  r is *only* needed if your string contains backslashes and you don't want to escape them.  It has nothing to do with HTML tags at all. 

> I see that "< >" constructs are eaten away by the browser. 


Above t is an HTML string that I'm construting, and output within an <html> block for the notebook.  It thus gets displayed properly. 

> An example code which you can use to debug your `Debug()` (pun intended :)) is the following:
> 
> ```
> ReedSolomonCode(15,2,GF(16,'a')).minimum_distance()
> ```
> You need to go to stack frame 8, and look at line 396 of the code that is printed.


Ah, now I see what you mean. The stupid source code display needs to have some HTML escaping done, e.g., < turned to &lt;.  There is a function in the notebook that does that properly, and I'll fix the patch accordingly.  Thanks for finding a genuine bug.  I'll also modify my example functions to include something like. 


> 
> Otherwise, it functions very nicely!




---

archive/attachments_009070.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509.2.patch",
    "created_at": "2012-01-30T20:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_073310.json:
```json
{
    "body": "new version addressing the bug that was found ppurka -- apply only this",
    "created_at": "2012-01-30T20:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73310",
    "user": "https://github.com/williamstein"
}
```

new version addressing the bug that was found ppurka -- apply only this



---

archive/issue_comments_073311.json:
```json
{
    "body": "<a id='comment:10'></a>\nppurka  -- please continue to review the patch now.",
    "created_at": "2012-01-30T20:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73311",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>
ppurka  -- please continue to review the patch now.



---

archive/issue_comments_073312.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [was](#comment%3A10):\n>  ppurka  -- please continue to review the patch now.\n\n\nYes. The listing is fixed now. But the hyperlink to the file is broken. I fail to see why this should happen, since the `<hr>` and filename are not escaped. (Tested this functionality on sagenb.org.)",
    "created_at": "2012-01-30T20:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73312",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:11'></a>
Replying to [was](#comment%3A10):
>  ppurka  -- please continue to review the patch now.


Yes. The listing is fixed now. But the hyperlink to the file is broken. I fail to see why this should happen, since the `<hr>` and filename are not escaped. (Tested this functionality on sagenb.org.)



---

archive/issue_comments_073313.json:
```json
{
    "body": "address bug introduced by bugfix.  apply only this.",
    "created_at": "2012-01-30T20:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73313",
    "user": "https://github.com/williamstein"
}
```

address bug introduced by bugfix.  apply only this.



---

archive/attachments_009071.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509.3.patch",
    "created_at": "2012-01-30T20:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_073314.json:
```json
{
    "body": "<a id='comment:12'></a>\nDoh -- fixed now.",
    "created_at": "2012-01-30T20:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73314",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
Doh -- fixed now.



---

archive/issue_comments_073315.json:
```json
{
    "body": "adds syntax highlighting",
    "created_at": "2012-01-30T20:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73315",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

adds syntax highlighting



---

archive/attachments_009072.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509_syntax_highlight.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509_syntax_highlight.patch",
    "created_at": "2012-01-30T20:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```



---

archive/issue_comments_073316.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis is very nice und useful.\n\nThe patch [trac_7509_syntax_highlight.patch] adds syntax highlighting to the stack frame,\nand removes the first few frames, since they don't show anything interesting.\n\nThe <hr>> things are also fixed. Apply after the first patch [trac_7509.patch].",
    "created_at": "2012-01-30T20:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73316",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

<a id='comment:13'></a>
This is very nice und useful.

The patch [trac_7509_syntax_highlight.patch] adds syntax highlighting to the stack frame,
and removes the first few frames, since they don't show anything interesting.

The <hr>> things are also fixed. Apply after the first patch [trac_7509.patch].



---

archive/issue_comments_073317.json:
```json
{
    "body": "<a id='comment:14'></a>\nHi whuss.  Thanks.    I'm reluctant to do syntax hilighting that way (the way you do in your patch, just on code), since it is very often completely wrong if we don't hilight the whole file.   We need to hilight the whole file, then grab just the relevant part back.    Interesting about removing the first few frames -- I was concerned about doing that; is this now consistent with %debug on the command line?",
    "created_at": "2012-01-30T21:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73317",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:14'></a>
Hi whuss.  Thanks.    I'm reluctant to do syntax hilighting that way (the way you do in your patch, just on code), since it is very often completely wrong if we don't hilight the whole file.   We need to hilight the whole file, then grab just the relevant part back.    Interesting about removing the first few frames -- I was concerned about doing that; is this now consistent with %debug on the command line?



---

archive/issue_comments_073318.json:
```json
{
    "body": "<a id='comment:15'></a>\nI think I agree that we should remove the first few frames.  In the example I was playing with they were actually empty.\n\nI don't know about syntax highlighting.  I think it may be best to focus on in a later ticket.",
    "created_at": "2012-01-31T00:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73318",
    "user": "https://github.com/roed314"
}
```

<a id='comment:15'></a>
I think I agree that we should remove the first few frames.  In the example I was playing with they were actually empty.

I don't know about syntax highlighting.  I think it may be best to focus on in a later ticket.



---

archive/issue_comments_073319.json:
```json
{
    "body": "apply only this -- includes shrinking the stack; also prints a message if source code not known.",
    "created_at": "2012-01-31T06:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73319",
    "user": "https://github.com/williamstein"
}
```

apply only this -- includes shrinking the stack; also prints a message if source code not known.



---

archive/attachments_009073.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509.4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509.4.patch",
    "created_at": "2012-01-31T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_073320.json:
```json
{
    "body": "<a id='comment:16'></a>\nI made a new patch:\n\n* has the shrunk stack\n* prints something when source code not available (yet) \n* adds whuff as co-author.",
    "created_at": "2012-01-31T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73320",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:16'></a>
I made a new patch:

* has the shrunk stack
* prints something when source code not available (yet) 
* adds whuff as co-author.



---

archive/issue_comments_073321.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-01-31T23:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73321",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_073322.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis is while debugging the example\n\n```\nEllipticCurve([0,0])\n```\n\nIf you type in a command (e.g. \"print ainvs\"), execute it, switch to a different frame and press enter again, nothing happens: it doesn't execute the print statement in the new frame.  You can get it to execute by hitting the button though.  If you type in a different command, then it starts executing upon pressing enter again.\n\nThere are doctest failures in listing, since you updated the functions.\n\nAnother small request would be to add a doctest to the evaluate function that demonstrates the case that a user types in a command to the text box which raises an error.",
    "created_at": "2012-01-31T23:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73322",
    "user": "https://github.com/roed314"
}
```

<a id='comment:17'></a>
This is while debugging the example

```
EllipticCurve([0,0])
```

If you type in a command (e.g. "print ainvs"), execute it, switch to a different frame and press enter again, nothing happens: it doesn't execute the print statement in the new frame.  You can get it to execute by hitting the button though.  If you type in a different command, then it starts executing upon pressing enter again.

There are doctest failures in listing, since you updated the functions.

Another small request would be to add a doctest to the evaluate function that demonstrates the case that a user types in a command to the text box which raises an error.



---

archive/issue_comments_073323.json:
```json
{
    "body": "**Reviewer:** David Roe",
    "created_at": "2012-01-31T23:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73323",
    "user": "https://github.com/roed314"
}
```

**Reviewer:** David Roe



---

archive/issue_comments_073324.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [roed](#comment%3A17):\n> This is while debugging the example\n> \n> ```\n> EllipticCurve([0,0])\n> ```\n> \n> If you type in a command (e.g. \"print ainvs\"), execute it, switch to a different frame and press enter again, nothing happens: it doesn't execute the print statement in the new frame.  You can get it to execute by hitting the button though.  If you type in a different command, then it starts executing upon pressing enter again.\n> \n\n\nThis is a fundamental limitation of `@`interact right now.   I can make a remark about this in the docstring.\n\nI'll fix + improve the doctests and post a new patch.\n\n> There are doctest failures in listing, since you updated the functions.\n> \n> Another small request would be to add a doctest to the evaluate function that demonstrates the case that a user types in a command to the text box which raises an error.\n",
    "created_at": "2012-02-01T00:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73324",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:18'></a>
Replying to [roed](#comment%3A17):
> This is while debugging the example
> 
> ```
> EllipticCurve([0,0])
> ```
> 
> If you type in a command (e.g. "print ainvs"), execute it, switch to a different frame and press enter again, nothing happens: it doesn't execute the print statement in the new frame.  You can get it to execute by hitting the button though.  If you type in a different command, then it starts executing upon pressing enter again.
> 


This is a fundamental limitation of `@`interact right now.   I can make a remark about this in the docstring.

I'll fix + improve the doctests and post a new patch.

> There are doctest failures in listing, since you updated the functions.
> 
> Another small request would be to add a doctest to the evaluate function that demonstrates the case that a user types in a command to the text box which raises an error.




---

archive/attachments_009074.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_7509.5.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket7509/trac_7509.5.patch",
    "created_at": "2012-02-01T07:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_073325.json:
```json
{
    "body": "apply only this; addresses referee remarks.",
    "created_at": "2012-02-01T07:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73325",
    "user": "https://github.com/williamstein"
}
```

apply only this; addresses referee remarks.



---

archive/issue_comments_073326.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-02-01T07:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73326",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_073327.json:
```json
{
    "body": "<a id='comment:20'></a>\nTesting...",
    "created_at": "2012-02-01T13:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73327",
    "user": "https://github.com/roed314"
}
```

<a id='comment:20'></a>
Testing...



---

archive/issue_comments_073328.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-02-01T20:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73328",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_073329.json:
```json
{
    "body": "<a id='comment:21'></a>\nAll tests pass.",
    "created_at": "2012-02-01T20:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73329",
    "user": "https://github.com/roed314"
}
```

<a id='comment:21'></a>
All tests pass.



---

archive/issue_comments_073330.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [was](#comment%3A14):\n> Hi whuss.  Thanks.    I'm reluctant to do syntax hilighting that way (the way you do in your patch, just on code), since it is very often completely wrong if we don't hilight the whole file.   We need to hilight the whole file, then grab just the relevant part back.\n\n\nI want to avoid highlighting the whole file, since this can be quite slow.\nOn my computer it takes about 2 seconds to load and highlight graphs/generic_graph.py.\n\nI think the main problem when one gets wrong highlighting is when the code fragment\nstarts in the middle of a docstring. At ticket:12451 there is an improved patch which\ndetects when the code fragments starts in the middle of a tripple quoted string, and does the correct highlighting in this case.",
    "created_at": "2012-02-06T11:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73330",
    "user": "https://trac.sagemath.org/admin/accounts/users/whuss"
}
```

<a id='comment:22'></a>
Replying to [was](#comment%3A14):
> Hi whuss.  Thanks.    I'm reluctant to do syntax hilighting that way (the way you do in your patch, just on code), since it is very often completely wrong if we don't hilight the whole file.   We need to hilight the whole file, then grab just the relevant part back.


I want to avoid highlighting the whole file, since this can be quite slow.
On my computer it takes about 2 seconds to load and highlight graphs/generic_graph.py.

I think the main problem when one gets wrong highlighting is when the code fragment
starts in the middle of a docstring. At ticket:12451 there is an improved patch which
detects when the code fragments starts in the middle of a tripple quoted string, and does the correct highlighting in this case.



---

archive/issue_events_022001.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22001"
}
```



---

archive/issue_events_022002.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-06T16:19:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22002"
}
```



---

archive/issue_events_022003.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-06T16:19:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22003"
}
```



---

archive/issue_comments_073331.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Please report this patch to the SageNB developers**",
    "created_at": "2012-02-06T16:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73331",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
**Please report this patch to the SageNB developers**



---

archive/issue_comments_073332.json:
```json
{
    "body": "<a id='comment:24'></a>\nReported: [http://code.google.com/p/sagenb/issues/detail?id=89](http://code.google.com/p/sagenb/issues/detail?id=89)",
    "created_at": "2012-02-06T16:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73332",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Reported: [http://code.google.com/p/sagenb/issues/detail?id=89](http://code.google.com/p/sagenb/issues/detail?id=89)



---

archive/issue_comments_073333.json:
```json
{
    "body": "**Changing status** from closed to new.",
    "created_at": "2012-02-06T16:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73333",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from closed to new.



---

archive/issue_comments_073334.json:
```json
{
    "body": "<a id='comment:25'></a>\nApologies, this is actually independent of the notebook.",
    "created_at": "2012-02-06T16:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73334",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Apologies, this is actually independent of the notebook.



---

archive/issue_events_022004.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-06T16:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22004"
}
```



---

archive/issue_events_022005.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-06T16:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22005"
}
```



---

archive/issue_events_022006.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22006"
}
```



---

archive/issue_comments_073335.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-02-06T16:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73335",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_073336.json:
```json
{
    "body": "**Author:** William Stein, Wilfried Huss",
    "created_at": "2012-02-06T16:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73336",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** William Stein, Wilfried Huss



---

archive/issue_comments_073337.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-02-06T16:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73337",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_073338.json:
```json
{
    "body": "**Merged:** sage-5.0.beta3",
    "created_at": "2012-02-07T13:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73338",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta3



---

archive/issue_events_022007.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-07T13:20:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7509#event-22007"
}
```



---

archive/issue_comments_073339.json:
```json
{
    "body": "<a id='comment:29'></a>\ni think there is a minor typo in the docstring line 264\n\nmissing word \"up\": Using the debugger you can move <up> and down the stack frame and\u00a0\n\n--\n\ni'm not sure what is the preferred convention for fixing typos, i can make a patch for this isolated line.",
    "created_at": "2012-02-09T14:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73339",
    "user": "https://trac.sagemath.org/admin/accounts/users/aranc"
}
```

<a id='comment:29'></a>
i think there is a minor typo in the docstring line 264

missing word "up": Using the debugger you can move <up> and down the stack frame and 

--

i'm not sure what is the preferred convention for fixing typos, i can make a patch for this isolated line.



---

archive/issue_comments_073340.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n NOTE: \"sage -coverage\" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.\n \n \n+---\n+\n``````\n",
    "created_at": "2012-02-13T15:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73340",
    "user": "https://github.com/williamstein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 NOTE: "sage -coverage" claims less than 100% coverage, but there is 100% coverage. It's a bug in the coverage script that it doesn't count doctests marked with `>>>`.
 
 
+---
+
``````




---

archive/issue_comments_073341.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [aranc](#comment%3A29):\n> i think there is a minor typo in the docstring line 264\n> \n> missing word \"up\": Using the debugger you can move <up> and down the stack frame and\u00a0\n> \n> --\n> \n> i'm not sure what is the preferred convention for fixing typos, i can make a patch for this isolated line.\n\n\nSee #12506.  Please review!",
    "created_at": "2012-02-13T15:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7509#issuecomment-73341",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:30'></a>
Replying to [aranc](#comment%3A29):
> i think there is a minor typo in the docstring line 264
> 
> missing word "up": Using the debugger you can move <up> and down the stack frame and 
> 
> --
> 
> i'm not sure what is the preferred convention for fixing typos, i can make a patch for this isolated line.


See #12506.  Please review!
