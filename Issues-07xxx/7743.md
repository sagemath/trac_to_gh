# Issue 7743: Piecewise integration fixes

archive/issues_007743.json:
```json
{
    "body": "This patch fixes two issues with the piecewise class, brought up in this sage-support thread:\n\nhttp://groups.google.com/group/sage-support/browse_thread/thread/18d830ece7826898/86c401e4d6b8f3dd\n\nThe first issue is that when a piece of the function belongs to the Integer ring, integration doesn't work. This is fixed by coercing each piece to the symbolic expression ring.\n\nThe second issue is that there are cases where maxima needs to be given assumptions about the domain of x for the piece being integrated. This is fixed with the assume and forget functions.\n\nAdditional unit tests have been added (or existing tests modified) for each issue.\n\nAssignee: @burcin\n\nKeywords: integration\n\nResolution: fixed\n\nAuthor: Paul Butler\n\nReviewer: David Joyner\n\nMerged: sage-4.3.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/7743\n\n",
    "closed_at": "2010-01-13T09:12:43Z",
    "created_at": "2009-12-19T22:52:08Z",
    "labels": [
        "component: calculus",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.1",
    "title": "Piecewise integration fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7743",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```
This patch fixes two issues with the piecewise class, brought up in this sage-support thread:

http://groups.google.com/group/sage-support/browse_thread/thread/18d830ece7826898/86c401e4d6b8f3dd

The first issue is that when a piece of the function belongs to the Integer ring, integration doesn't work. This is fixed by coercing each piece to the symbolic expression ring.

The second issue is that there are cases where maxima needs to be given assumptions about the domain of x for the piece being integrated. This is fixed with the assume and forget functions.

Additional unit tests have been added (or existing tests modified) for each issue.

Assignee: @burcin

Keywords: integration

Resolution: fixed

Author: Paul Butler

Reviewer: David Joyner

Merged: sage-4.3.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/7743





---

archive/issue_comments_076084.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [12159.patch](tarball://root/attachments/some-uuid/ticket7743/12159.patch) by @aghitza created at 2009-12-19 23:36:02",
    "created_at": "2009-12-19T23:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76084",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:1'></a>
Attachment [12159.patch](tarball://root/attachments/some-uuid/ticket7743/12159.patch) by @aghitza created at 2009-12-19 23:36:02



---

archive/issue_comments_076085.json:
```json
{
    "body": "Changing assignee from @aghitza to @burcin.",
    "created_at": "2009-12-19T23:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76085",
    "user": "https://github.com/aghitza"
}
```

Changing assignee from @aghitza to @burcin.



---

archive/issue_comments_076086.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2009-12-20T13:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76086",
    "user": "https://github.com/wdjoyner"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_076087.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch failed to apply to sage-4.3.a1 and 4.3.rc0. Maybe it needs rebasing?",
    "created_at": "2009-12-20T13:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76087",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:2'></a>
This patch failed to apply to sage-4.3.a1 and 4.3.rc0. Maybe it needs rebasing?



---

archive/issue_comments_076088.json:
```json
{
    "body": "Attachment [13311.patch](tarball://root/attachments/some-uuid/ticket7743/13311.patch) by pbutler created at 2009-12-20 17:03:46",
    "created_at": "2009-12-20T17:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76088",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [13311.patch](tarball://root/attachments/some-uuid/ticket7743/13311.patch) by pbutler created at 2009-12-20 17:03:46



---

archive/issue_comments_076089.json:
```json
{
    "body": "<a id='comment:3'></a>\nMy mistake; I was using a much older version of sage. I've attached another patch that should apply to sage-4.2, but I'm not sure to actually obtain the latest development version of sage-4.3 for testing. Is there documentation on this somewhere?",
    "created_at": "2009-12-20T17:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76089",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:3'></a>
My mistake; I was using a much older version of sage. I've attached another patch that should apply to sage-4.2, but I'm not sure to actually obtain the latest development version of sage-4.3 for testing. Is there documentation on this somewhere?



---

archive/issue_comments_076090.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [pbutler](#comment%3A3):\n> My mistake; I was using a much older version of sage. I've attached another \n> patch that should apply to sage-4.2, but I'm not sure to actually obtain \n\n\n\nThis doesn't work either.\n\n> the latest development version of sage-4.3 for testing. Is there documentation \n> on this somewhere?\n\n\nI sent you the link by separate email to your gmail address.",
    "created_at": "2009-12-21T02:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76090",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:4'></a>
Replying to [pbutler](#comment%3A3):
> My mistake; I was using a much older version of sage. I've attached another 
> patch that should apply to sage-4.2, but I'm not sure to actually obtain 



This doesn't work either.

> the latest development version of sage-4.3 for testing. Is there documentation 
> on this somewhere?


I sent you the link by separate email to your gmail address.



---

archive/issue_events_030798.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-24T07:06:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "milestone": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7743#event-30798"
}
```



---

archive/issue_comments_076091.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'm declaring a total feature freeze on sage-4.3.",
    "created_at": "2009-12-24T07:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76091",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
I'm declaring a total feature freeze on sage-4.3.



---

archive/issue_comments_076092.json:
```json
{
    "body": "Attachment [13535.patch](tarball://root/attachments/some-uuid/ticket7743/13535.patch) by pbutler created at 2010-01-06 05:06:41",
    "created_at": "2010-01-06T05:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76092",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

Attachment [13535.patch](tarball://root/attachments/some-uuid/ticket7743/13535.patch) by pbutler created at 2010-01-06 05:06:41



---

archive/issue_comments_076093.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've attached 13535.patch and tested that it can be applied on sage 4.3, but it doesn't look much different from the previous one (aside from a try/except that I had to add because of a change to the behaviour of `assume`). If it still doesn't apply, could you paste the shell transcript?",
    "created_at": "2010-01-06T06:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76093",
    "user": "https://trac.sagemath.org/admin/accounts/users/pbutler"
}
```

<a id='comment:6'></a>
I've attached 13535.patch and tested that it can be applied on sage 4.3, but it doesn't look much different from the previous one (aside from a try/except that I had to add because of a change to the behaviour of `assume`). If it still doesn't apply, could you paste the shell transcript?



---

archive/issue_comments_076094.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks, I'll review it.",
    "created_at": "2010-01-06T23:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76094",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:7'></a>
Thanks, I'll review it.



---

archive/issue_comments_076095.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-06T23:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76095",
    "user": "https://github.com/wdjoyner"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_076096.json:
```json
{
    "body": "<a id='comment:8'></a>\nApplies to 4.3.1.a0 (the hacked version) and 4.3. Passes all tests but sagedoc on 64bit ubuntu 9.10 with 4.3.1.a0\nand only with seemingly unrelated failures on imac 10.6.2 with 4.3.\n\nThanks for fixing this bug!\n\nPositive review.",
    "created_at": "2010-01-07T00:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76096",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:8'></a>
Applies to 4.3.1.a0 (the hacked version) and 4.3. Passes all tests but sagedoc on 64bit ubuntu 9.10 with 4.3.1.a0
and only with seemingly unrelated failures on imac 10.6.2 with 4.3.

Thanks for fixing this bug!

Positive review.



---

archive/issue_comments_076097.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-07T00:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76097",
    "user": "https://github.com/wdjoyner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_076098.json:
```json
{
    "body": "<a id='comment:9'></a>\nmerged just 13535.patch",
    "created_at": "2010-01-13T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76098",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:9'></a>
merged just 13535.patch



---

archive/issue_comments_076099.json:
```json
{
    "body": "Changing author from \"\" to \"Paul Butler\"",
    "created_at": "2010-01-13T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76099",
    "user": "https://github.com/rlmill"
}
```

Changing author from "" to "Paul Butler"



---

archive/issue_comments_076100.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Joyner\"",
    "created_at": "2010-01-13T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76100",
    "user": "https://github.com/rlmill"
}
```

Changing reviewer from "" to "David Joyner"



---

archive/issue_comments_076101.json:
```json
{
    "body": "Changing merged from \"\" to \"4.3.1.alpha2\"",
    "created_at": "2010-01-13T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76101",
    "user": "https://github.com/rlmill"
}
```

Changing merged from "" to "4.3.1.alpha2"



---

archive/issue_events_030799.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-13T09:12:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7743#event-30799"
}
```



---

archive/issue_comments_076102.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-13T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76102",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_events_030800.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "rename": {
        "from": "Piecewise integration fixes [with patch; needs review]",
        "to": "Piecewise integration fixes"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7743#event-30800"
}
```



---

archive/issue_comments_076103.json:
```json
{
    "body": "Changing merged from \"4.3.1.alpha2\" to \"sage-4.3.1.alpha2\"",
    "created_at": "2010-01-13T19:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7743#issuecomment-76103",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "4.3.1.alpha2" to "sage-4.3.1.alpha2"
