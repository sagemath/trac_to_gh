# Issue 7021: Update prereq from 0.3 to 0.4

archive/issues_007021.json:
```json
{
    "body": "This is an updated version of the code which does the preliminary checks of the Sage build. \n\nThe update consists of two files, which should be installed as:\n* $SAGE_HOME/spkg/base/prereq-0.4-install\n* $SAGE_HOME/spkg/base/prereq-0.4.tar\n\nNote there is no need to extract the tar file, and so have a directory $SAGE_HOME/spkg/base/prereq-0.4, though this was done on prereq-0.3. The tar files contents gets extracted to $SAGE_HOME/spkg/build/prereq-0.4 during the build process. \n\nThe tar file contains a configure script, configure.ac, and several macros. \n\n**Changes to the configure script**\n* Adds AC_COPYRIGHT([GPL version 2])\n* Uses several autoconf macros, mainly taken from [the autoconf macro archive](http://www.nongnu.org/autoconf-archive/). This are better written than the pseudo-autoconf macros of the earlier configure.ac file. The macros get extracted to the directory  $SAGE_HOME/spkg/build/prereq-0.4/m4\n* The configure script allows one to try to build Sage with a non GNU compiler. A warning is issued, but the configure script does not exit as before. \n* If gcc is used as the C compiler, the configure script checks it is at least gcc 4.0.1\n* If gcc is used as the C compiler, the configure script checks that g++ is used as the C++ compiler. You are not permitted to mix GNU and non-GNU compilers. \n* If gcc and g++ are used, the configure script checks they are of the same version. It is not easily possible to do this with the Fortran compiler. \n* If SAGE_FORTRAN is set, the configure script checks the binary actually exists. \n* If SAGE_FORTRAN_LIB is set, the configure script checks the library actually exists. \n* The configure script checks perl is at least version 5.6.0. I could not work out what the original code was supposed to do, but 5.6.0 is quite old, so everyone should have at least that. \n* Tests for the Sun linker. I'm not sure the test is very good, and while it attempts to export SAGE_LINKER, I'm not sure whether this will actually work. (It probably needs a bit more work, but I'll leave it for now).\n\n**Changes to prereq-0.4-install**\n* Issue a warning on OS X to use Apple's latest XCode, and provide a link to [http://developer.apple.com/TOOLS/Xcode/](http://developer.apple.com/TOOLS/Xcode/)\n* Specific messages are issued if one tries to build Sage on any of these operating systems, to encourage developers. A 'catch-all' is used for other operating systems. SAGE_PORT needs to be set to a non-empty value to proceed with any of these. \n  * AIX\n  * HP-UX\n  * Tru64\n  * IRIX\n  * FreeBSD \n* Exit codes on errors are changed from -1 to 1, as -1 is an invalid value. \n* Less checks are performed on a makefile. More is done in the configure script. \n* Changes comments about Sage being support on Cygwin several months ago (around March 2007), to several years ago.\n* VirtualBox gets a mention if one tries to use cygwin\n* If one of the important commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)\n\n**Testing**\nThe Sun T5240 't2' would be a good place to test this. Try these things, remembering to type 'make distclean' after any test. \n\n**Test 1**\n* Set CC to /usr/sfw/bin/gcc which is an old C compiler\n* Set CXX to /usr/sfw/bin/g++ which is an old C++ compiler\nThe configure script should exit, and say you need at least gcc 4.0.1\n\n**Test 2**\n\n* Make one of the compilers a Sun compiler, while leaving the other a GNU one. The Sun C compiler is /opt/SUNWspro/bin/cc and the C++ compiler is /opt/SUNWspro/bin/CC\n\nIt should exit with a message that you can't mix compilers. \n\n**Test 3**\n\nSet CC=/opt/SUNWspro/bin/cc and CXX to /opt/SUNWspro/bin/CC and try to build Sage with the Sun compiler. \n\n**Test 4**\nSet CC and CXX to be different version of gcc. You should see something like this. \n\n\n```\nchecking gcc version... 4.2.4\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 4.4.1\nconfigure: WARNING: gcc (4.2.4) and g++ (4.4.1) are not the same version\nconfigure: WARNING: which they must be. Check your setting of CC and CXX\nconfigure: error: Exiting since the C and C++ compilers have different versions\n```\n\n\nIf this is updated, it can close at least two tickets - #6701 and #3384\n\n\n\n**CC:**  @williamstein mvngu\n\n**Reviewer:** Georg S. Weber\n\n**Author:** David Kirkby, Minh Van Nguyen\n\nIssue created by migration from https://trac.sagemath.org/ticket/7021\n\n",
    "closed_at": "2009-10-07T15:42:41Z",
    "created_at": "2009-09-27T01:28:38Z",
    "labels": [
        "component: build",
        "blocker",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1.2",
    "title": "Update prereq from 0.3 to 0.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/7021",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
This is an updated version of the code which does the preliminary checks of the Sage build. 

The update consists of two files, which should be installed as:
* $SAGE_HOME/spkg/base/prereq-0.4-install
* $SAGE_HOME/spkg/base/prereq-0.4.tar

Note there is no need to extract the tar file, and so have a directory $SAGE_HOME/spkg/base/prereq-0.4, though this was done on prereq-0.3. The tar files contents gets extracted to $SAGE_HOME/spkg/build/prereq-0.4 during the build process. 

The tar file contains a configure script, configure.ac, and several macros. 

**Changes to the configure script**
* Adds AC_COPYRIGHT([GPL version 2])
* Uses several autoconf macros, mainly taken from [the autoconf macro archive](http://www.nongnu.org/autoconf-archive/). This are better written than the pseudo-autoconf macros of the earlier configure.ac file. The macros get extracted to the directory  $SAGE_HOME/spkg/build/prereq-0.4/m4
* The configure script allows one to try to build Sage with a non GNU compiler. A warning is issued, but the configure script does not exit as before. 
* If gcc is used as the C compiler, the configure script checks it is at least gcc 4.0.1
* If gcc is used as the C compiler, the configure script checks that g++ is used as the C++ compiler. You are not permitted to mix GNU and non-GNU compilers. 
* If gcc and g++ are used, the configure script checks they are of the same version. It is not easily possible to do this with the Fortran compiler. 
* If SAGE_FORTRAN is set, the configure script checks the binary actually exists. 
* If SAGE_FORTRAN_LIB is set, the configure script checks the library actually exists. 
* The configure script checks perl is at least version 5.6.0. I could not work out what the original code was supposed to do, but 5.6.0 is quite old, so everyone should have at least that. 
* Tests for the Sun linker. I'm not sure the test is very good, and while it attempts to export SAGE_LINKER, I'm not sure whether this will actually work. (It probably needs a bit more work, but I'll leave it for now).

**Changes to prereq-0.4-install**
* Issue a warning on OS X to use Apple's latest XCode, and provide a link to [http://developer.apple.com/TOOLS/Xcode/](http://developer.apple.com/TOOLS/Xcode/)
* Specific messages are issued if one tries to build Sage on any of these operating systems, to encourage developers. A 'catch-all' is used for other operating systems. SAGE_PORT needs to be set to a non-empty value to proceed with any of these. 
  * AIX
  * HP-UX
  * Tru64
  * IRIX
  * FreeBSD 
* Exit codes on errors are changed from -1 to 1, as -1 is an invalid value. 
* Less checks are performed on a makefile. More is done in the configure script. 
* Changes comments about Sage being support on Cygwin several months ago (around March 2007), to several years ago.
* VirtualBox gets a mention if one tries to use cygwin
* If one of the important commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)

**Testing**
The Sun T5240 't2' would be a good place to test this. Try these things, remembering to type 'make distclean' after any test. 

**Test 1**
* Set CC to /usr/sfw/bin/gcc which is an old C compiler
* Set CXX to /usr/sfw/bin/g++ which is an old C++ compiler
The configure script should exit, and say you need at least gcc 4.0.1

**Test 2**

* Make one of the compilers a Sun compiler, while leaving the other a GNU one. The Sun C compiler is /opt/SUNWspro/bin/cc and the C++ compiler is /opt/SUNWspro/bin/CC

It should exit with a message that you can't mix compilers. 

**Test 3**

Set CC=/opt/SUNWspro/bin/cc and CXX to /opt/SUNWspro/bin/CC and try to build Sage with the Sun compiler. 

**Test 4**
Set CC and CXX to be different version of gcc. You should see something like this. 


```
checking gcc version... 4.2.4
checking if g++ accepts -dumpversion option... yes
checking g++ version... 4.4.1
configure: WARNING: gcc (4.2.4) and g++ (4.4.1) are not the same version
configure: WARNING: which they must be. Check your setting of CC and CXX
configure: error: Exiting since the C and C++ compilers have different versions
```


If this is updated, it can close at least two tickets - #6701 and #3384



**CC:**  @williamstein mvngu

**Reviewer:** Georg S. Weber

**Author:** David Kirkby, Minh Van Nguyen

Issue created by migration from https://trac.sagemath.org/ticket/7021





---

archive/issue_comments_051949.json:
```json
{
    "body": "tar file to be installed as $SAGE_HOME/spkg/base",
    "created_at": "2009-09-27T01:32:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51949",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

tar file to be installed as $SAGE_HOME/spkg/base



---

archive/attachments_008736.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "prereq-0.4.tar",
    "asset_url": "tarball://root/attachments/ticket7021/prereq-0.4.tar",
    "created_at": "2009-09-27T01:39:14Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7021/prereq-0.4.tar",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```



---

archive/attachments_008737.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "prereq-0.4-install",
    "asset_url": "tarball://root/attachments/ticket7021/prereq-0.4-install",
    "created_at": "2009-09-27T01:39:14Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket7021/prereq-0.4-install",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```



---

archive/issue_comments_051950.json:
```json
{
    "body": "**Attachment:** [prereq-0.4.tar](https://github.com/sagemath/sage/files/ticket7021/prereq-0.4.tar)\n\n**Attachment:** [prereq-0.4-install](https://github.com/sagemath/sage/files/ticket7021/prereq-0.4-install)\n\nexecutable shell script to install as $SAGE_HOME/spkg/base/prereq-0.4-install",
    "created_at": "2009-09-27T01:39:14Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51950",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Attachment:** [prereq-0.4.tar](https://github.com/sagemath/sage/files/ticket7021/prereq-0.4.tar)

**Attachment:** [prereq-0.4-install](https://github.com/sagemath/sage/files/ticket7021/prereq-0.4-install)

executable shell script to install as $SAGE_HOME/spkg/base/prereq-0.4-install



---

archive/issue_comments_051951.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -32,7 +32,39 @@\n * Less checks are performed on a makefile. More is done in the configure script. \n * Changes comments about Sage being support on Cygwin several months ago (around March 2007), to several years ago.\n * VirtualBox gets a mention if one tries to use cygwin\n-* If one of the following commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)\n+* If one of the important commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)\n+\n+**Testing**\n+The Sun T5240 't2' would be a good place to test this. Try these things, remembering to type 'make distclean' after any test. \n+\n+**Test 1**\n+* Set CC to /usr/sfw/bin/gcc which is an old C compiler\n+* Set CXX to /usr/sfw/bin/g++ which is an old C++ compiler\n+The configure script should exit, and say you need at least gcc 4.0.1\n+\n+**Test 2**\n+\n+* Make one of the compilers a Sun compiler, while leaving the other a GNU one. The Sun C compiler is /opt/SUNWspro/bin/cc and the C++ compiler is /opt/SUNWspro/bin/CC\n+\n+It should exit with a message that you can't mix compilers. \n+\n+**Test 3**\n+\n+Set CC=/opt/SUNWspro/bin/cc and CXX to /opt/SUNWspro/bin/CC and try to build Sage with the Sun compiler. \n+\n+**Test 4**\n+Set CC and CXX to be different version of gcc. You should see something like this. \n+\n+\n+```\n+checking gcc version... 4.2.4\n+checking if g++ accepts -dumpversion option... yes\n+checking g++ version... 4.4.1\n+configure: WARNING: gcc (4.2.4) and g++ (4.4.1) are not the same version\n+configure: WARNING: which they must be. Check your setting of CC and CXX\n+configure: error: Exiting since the C and C++ compilers have different versions\n+```\n+\n \n If this is updated, it can close at least two tickets - #6701 and #3384\n \n``````\n",
    "created_at": "2009-09-27T01:58:15Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51951",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -32,7 +32,39 @@
 * Less checks are performed on a makefile. More is done in the configure script. 
 * Changes comments about Sage being support on Cygwin several months ago (around March 2007), to several years ago.
 * VirtualBox gets a mention if one tries to use cygwin
-* If one of the following commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)
+* If one of the important commands are not found, the script says to install them or put them in  your path. The previous wording said they had to be installed, but in some cases might not be in the path. (m4 on Solaris is in /usr/ccs/bin, which many people may not know about)
+
+**Testing**
+The Sun T5240 't2' would be a good place to test this. Try these things, remembering to type 'make distclean' after any test. 
+
+**Test 1**
+* Set CC to /usr/sfw/bin/gcc which is an old C compiler
+* Set CXX to /usr/sfw/bin/g++ which is an old C++ compiler
+The configure script should exit, and say you need at least gcc 4.0.1
+
+**Test 2**
+
+* Make one of the compilers a Sun compiler, while leaving the other a GNU one. The Sun C compiler is /opt/SUNWspro/bin/cc and the C++ compiler is /opt/SUNWspro/bin/CC
+
+It should exit with a message that you can't mix compilers. 
+
+**Test 3**
+
+Set CC=/opt/SUNWspro/bin/cc and CXX to /opt/SUNWspro/bin/CC and try to build Sage with the Sun compiler. 
+
+**Test 4**
+Set CC and CXX to be different version of gcc. You should see something like this. 
+
+
+```
+checking gcc version... 4.2.4
+checking if g++ accepts -dumpversion option... yes
+checking g++ version... 4.4.1
+configure: WARNING: gcc (4.2.4) and g++ (4.4.1) are not the same version
+configure: WARNING: which they must be. Check your setting of CC and CXX
+configure: error: Exiting since the C and C++ compilers have different versions
+```
+
 
 If this is updated, it can close at least two tickets - #6701 and #3384
 
``````




---

archive/issue_comments_051952.json:
```json
{
    "body": "<a id='comment:2'></a>\n* I read \"prereq-0.4-install\" and was very happy with everything I saw.\n\n  * in configure.ac it says: \"# Very loosly based on configure.ac in prereq-0.3, of unknown author.\".  The \"unknown author\" is me (=William Stein). \n\n\nAnyway, I've read it all and give this a *big thumbs up* assuming it actually works.  Regarding, actually working, I'd be happy with us just dropping this in an alpha and see.",
    "created_at": "2009-09-27T05:56:51Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51952",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
* I read "prereq-0.4-install" and was very happy with everything I saw.

  * in configure.ac it says: "# Very loosly based on configure.ac in prereq-0.3, of unknown author.".  The "unknown author" is me (=William Stein). 


Anyway, I've read it all and give this a *big thumbs up* assuming it actually works.  Regarding, actually working, I'd be happy with us just dropping this in an alpha and see.



---

archive/issue_comments_051953.json:
```json
{
    "body": "<a id='comment:3'></a>\nWould this updated spkg invalidate the GCC 3.4.x requirement for ratpoint at #6580?",
    "created_at": "2009-09-27T06:22:20Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51953",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:3'></a>
Would this updated spkg invalidate the GCC 3.4.x requirement for ratpoint at #6580?



---

archive/issue_comments_051954.json:
```json
{
    "body": "<a id='comment:4'></a>\n> Would this updated spkg invalidate the GCC 3.4.x requirement for ratpoint at #6580?\n\n\nProbably we need a clear decision from our BDFL here, whether Sage continues to officially support being built with GCC 3.4.x, or not.\n\nCygwin's default compiler is GCC 3.4.4, by the way (but GCC 4.3.x seems to be available at least as an optional package). Currently, GCC 3.4.x works pretty fine. The original reason to force \">= 4.0.1\" was to rule out GCC 4.0.0 with which many problems occur, but I guess this could be done without kicking GCC 3.4.x entirely.\n\nCheers,\nGeorg",
    "created_at": "2009-09-27T07:48:25Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51954",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:4'></a>
> Would this updated spkg invalidate the GCC 3.4.x requirement for ratpoint at #6580?


Probably we need a clear decision from our BDFL here, whether Sage continues to officially support being built with GCC 3.4.x, or not.

Cygwin's default compiler is GCC 3.4.4, by the way (but GCC 4.3.x seems to be available at least as an optional package). Currently, GCC 3.4.x works pretty fine. The original reason to force ">= 4.0.1" was to rule out GCC 4.0.0 with which many problems occur, but I guess this could be done without kicking GCC 3.4.x entirely.

Cheers,
Georg



---

archive/issue_comments_051955.json:
```json
{
    "body": "<a id='comment:5'></a>\nUps,\n\nI misinterpreted the comment about #6580, reading the comments there, this decision already has been made, sorry for the noise.",
    "created_at": "2009-09-27T07:50:49Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51955",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:5'></a>
Ups,

I misinterpreted the comment about #6580, reading the comments there, this decision already has been made, sorry for the noise.



---

archive/issue_comments_051956.json:
```json
{
    "body": "<a id='comment:6'></a>\nI did some general clean up to the file `prereq-0.4-install`. The changes include:\n\n* spell check\n* format code in a consistent manner\n \nAn updated `prereq-0.4-install` is up at\n\nhttp://sage.math.washington.edu/home/mvngu/release/spkg/base/prereq-0.4-install\n\nUse that updated `prereq-0.4-install` file together with David's tarball `prereq-0.4.tar`.",
    "created_at": "2009-09-28T07:11:45Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51956",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:6'></a>
I did some general clean up to the file `prereq-0.4-install`. The changes include:

* spell check
* format code in a consistent manner
 
An updated `prereq-0.4-install` is up at

http://sage.math.washington.edu/home/mvngu/release/spkg/base/prereq-0.4-install

Use that updated `prereq-0.4-install` file together with David's tarball `prereq-0.4.tar`.



---

archive/issue_comments_051957.json:
```json
{
    "body": "**Changing author** from \"David Kirkby\" to \"David Kirkby, Minh Nguyen\".",
    "created_at": "2009-09-28T16:01:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51957",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Changing author** from "David Kirkby" to "David Kirkby, Minh Nguyen".



---

archive/issue_comments_051958.json:
```json
{
    "body": "<a id='comment:7'></a>\nThank you to Minh for tidying this up a bit. I've made a few changes to it, though have kept the version number the same. The revised version can be found at \n\nhttp://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/\n\nThe script prereq-0.4-install must have execute permission. \n\n**Please use the version at http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/ and not the files attached here.** \n\n* Check's for the program 'ar' as that is needed. \n* Inform a user there is no support for Cygwin, but there is active work to support Cygwin. \n* More complex testing of the compiler version, and what it does. This should help anyone wishing to fix ratpoints, without risking allowing anyone to mess up their build, unless they are blind!\n  * Exits with a message gcc is too old if the gcc version is below 3.4.0\n  * Exits with a message the compiler is too buggy, if the gcc version is 4.0.0\n  * Warns the user that gcc will not build Sage, but allows the build to continue for gcc 3.4.x. This will allow ratpoints to be debugged, without allowing a casual user to build with a gcc 3.4.x by mistake. \n  * Allows the build to continue if gcc is version 4.0.1 or later. \n* Credits William with writing the version 0.3 of prereq. \n* No longer checks for 'xtar' it was a leftover by mistake.\n* No longer checks if the linker is the GNU linker or not. My check was not reliable and I'll wait until I have something better before adding that. \n* Makes the message about using the latest XCode on Darwin a bit more obvious - before it could easily have been missed. \n\nIf anyone else can think of any sanity checks that need to be made, then these can perhaps be added. But I'd like to get this into Sage asap, as this code really does help find lots of bugs in Sage, as it allows one to try building Sage with the Sun compiler, which uncovers all sorts of bugs.",
    "created_at": "2009-09-28T16:01:19Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51958",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>
Thank you to Minh for tidying this up a bit. I've made a few changes to it, though have kept the version number the same. The revised version can be found at 

http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/

The script prereq-0.4-install must have execute permission. 

**Please use the version at http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/ and not the files attached here.** 

* Check's for the program 'ar' as that is needed. 
* Inform a user there is no support for Cygwin, but there is active work to support Cygwin. 
* More complex testing of the compiler version, and what it does. This should help anyone wishing to fix ratpoints, without risking allowing anyone to mess up their build, unless they are blind!
  * Exits with a message gcc is too old if the gcc version is below 3.4.0
  * Exits with a message the compiler is too buggy, if the gcc version is 4.0.0
  * Warns the user that gcc will not build Sage, but allows the build to continue for gcc 3.4.x. This will allow ratpoints to be debugged, without allowing a casual user to build with a gcc 3.4.x by mistake. 
  * Allows the build to continue if gcc is version 4.0.1 or later. 
* Credits William with writing the version 0.3 of prereq. 
* No longer checks for 'xtar' it was a leftover by mistake.
* No longer checks if the linker is the GNU linker or not. My check was not reliable and I'll wait until I have something better before adding that. 
* Makes the message about using the latest XCode on Darwin a bit more obvious - before it could easily have been missed. 

If anyone else can think of any sanity checks that need to be made, then these can perhaps be added. But I'd like to get this into Sage asap, as this code really does help find lots of bugs in Sage, as it allows one to try building Sage with the Sun compiler, which uncovers all sorts of bugs.



---

archive/issue_events_046775.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-10-04T02:45:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "milestone": "sage-4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46775"
}
```



---

archive/issue_events_046776.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-10-04T02:45:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "milestone": "sage-4.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46776"
}
```



---

archive/issue_comments_051959.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis is such a major improvement -- and fairly safe -- I would really like this in 4.1.2 so I'm upgrading this to blocker.",
    "created_at": "2009-10-04T02:45:31Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51959",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>
This is such a major improvement -- and fairly safe -- I would really like this in 4.1.2 so I'm upgrading this to blocker.



---

archive/issue_events_046777.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-10-04T02:45:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46777"
}
```



---

archive/issue_comments_051960.json:
```json
{
    "body": "<a id='comment:9'></a>\nWilliam, since you believe this is fairly safe and a major improvement, can you update it to 'positive review'? And thank you for the comments!",
    "created_at": "2009-10-04T09:06:14Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51960",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>
William, since you believe this is fairly safe and a major improvement, can you update it to 'positive review'? And thank you for the comments!



---

archive/issue_events_046778.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2009-10-04T15:01:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46778"
}
```



---

archive/issue_events_046779.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2009-10-04T15:01:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46779"
}
```



---

archive/issue_comments_051961.json:
```json
{
    "body": "<a id='comment:10'></a>\nReviewer report:\n\n1. There is a .bak-file in the tar-file in http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/ and a subdirectory \"autom4te.cache\", one might want to remove this file and this (entire) subdirectory.\n\n2. In \"prereq-0.4-install\", line 135, one might want to remove William's name and email-adress, just leave \"email sage-devel\" there (this has been another ticket already for all the Sage library code AFAIK).\n\n3. \"prereq-0.4-install\" is not executable, take care that it is.\n\n4. In configure.ac, line 22, please change AC_COPYRIGHT([GPL version 2]) into AC_COPYRIGHT([GPL version 2, or (at your option) any later version]), and regenerate configure to reflect the update.\n\n5. (maybe a non-issue) In configure.ac, line 44, possibly missing parentheses after: AC_PROG_CPP\n\nI tried to do the test cases on my Mac, there's some gcc-3.3 and g++-3.3 in /usr/bin/ additionally to the usual gcc(-4.0) and g++(-4.0). All in all, this looks good to me. IMHO the only blocker is 4. (the one about the license), the other findings are pretty unimportant.",
    "created_at": "2009-10-04T15:01:45Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51961",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:10'></a>
Reviewer report:

1. There is a .bak-file in the tar-file in http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4/ and a subdirectory "autom4te.cache", one might want to remove this file and this (entire) subdirectory.

2. In "prereq-0.4-install", line 135, one might want to remove William's name and email-adress, just leave "email sage-devel" there (this has been another ticket already for all the Sage library code AFAIK).

3. "prereq-0.4-install" is not executable, take care that it is.

4. In configure.ac, line 22, please change AC_COPYRIGHT([GPL version 2]) into AC_COPYRIGHT([GPL version 2, or (at your option) any later version]), and regenerate configure to reflect the update.

5. (maybe a non-issue) In configure.ac, line 44, possibly missing parentheses after: AC_PROG_CPP

I tried to do the test cases on my Mac, there's some gcc-3.3 and g++-3.3 in /usr/bin/ additionally to the usual gcc(-4.0) and g++(-4.0). All in all, this looks good to me. IMHO the only blocker is 4. (the one about the license), the other findings are pretty unimportant.



---

archive/issue_comments_051962.json:
```json
{
    "body": "<a id='comment:11'></a>\nThank you. I will address tommorow - I am going out in about 15 minutes. \n\nThere was one other change I was intending making. If one tries to build on Cywin, with SAGE_PORT not set, it will exit, but there is no message that tells you that you can bypass it by setting SAGE_PORT. (It will work if you know this, but it would be sensible to let someone know). \n\nI have made prereq-install executable on the web site, but when I download it, it looses the exe permissions. I dont think there is anything I can do about that - whoever adds it to sage will have to do that. \n\n\ndave.",
    "created_at": "2009-10-04T18:46:58Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51962",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
Thank you. I will address tommorow - I am going out in about 15 minutes. 

There was one other change I was intending making. If one tries to build on Cywin, with SAGE_PORT not set, it will exit, but there is no message that tells you that you can bypass it by setting SAGE_PORT. (It will work if you know this, but it would be sensible to let someone know). 

I have made prereq-install executable on the web site, but when I download it, it looses the exe permissions. I dont think there is anything I can do about that - whoever adds it to sage will have to do that. 


dave.



---

archive/issue_comments_051963.json:
```json
{
    "body": "<a id='comment:12'></a>\n> I have made prereq-install executable on the web site, but when I download it, it\n> looses the exe permissions. I dont think there is anything I can do about that - whoever adds it to sage will have to do that.\n\n\nYep, that's reasonable.",
    "created_at": "2009-10-04T18:59:55Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51963",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
> I have made prereq-install executable on the web site, but when I download it, it
> looses the exe permissions. I dont think there is anything I can do about that - whoever adds it to sage will have to do that.


Yep, that's reasonable.



---

archive/issue_comments_051964.json:
```json
{
    "body": "<a id='comment:13'></a>\nThank you for all your comments. In light of these, and some thoughts I had, I've made a few changes. \n\n* I removed the configure.ac.bak file, which was an oversight on my part. \n* I left the directory *autom4te.cache*, as that is something created by *autoreconf* and is not simply a left-over from me typing *configure*. However, I did remove the file *autom4te.cache/requests* as it says at the top of the file that it can be safely removed. There is nothing to indicate to me that it is safe to remove the other files in the directory *autom4te.cache*, so I think they are best left. \n* I removed Williams's name, but suggested sage-support was emailed, not sage-devel, as the failure to find the files checked for (make, ar, perl, m4, ranlib, tar and gcc) are really support issues, not developer issues. I provided a link to the Google group sage-support.\n* I added 'g++' to that list of files too, just in case someone has GCC built for only compiling C, and not C++.\n* I do not believe there should be any parentheses after AC_PROG_CPP see [the autoconf manual](http://www.gnu.org/software/autoconf/manual/html_node/C-Compiler.html) Hence I left that unchanged. \n* I changed the license as suggested, though I'm not convinced that was really necessary, as the GPL 2 specifically says you can use a later version. \n* There were two places CYGWIN were checked. Both said it was not supported, and both caused it to exit. I removed the second check, but left the first, which will now exits unless SAGE_PORT is exported. If someone really wants to build on cygwin, we should not stop them. The code now has:\n\n```\nif [ \"$SAGE_PORT\" = \"\" ]; then\n    if [ `uname | sed -e 's/WIN.\\+/WIN/'` = \"CYGWIN\" ]; then\n        echo \"Unfortunately, building SAGE on Cygwin is not currently supported,\"\n        echo \"though we are actively working on supporting it.  If you would like\"\n        echo \"to help with the porting effort, please post to\"\n        echo \"\"\n        echo \"   http://groups.google.com/group/sage-windows\"\n        echo \"\"\n        echo \"Also, see http://trac.sagemath.org/sage_trac/ticket/6743\"\n        echo \"In the meantime, to run Sage on Windows, please use\"\n        echo \"a virtualization solution instead, such as VMware.\"\n        echo \"To get past this message, export the variable 'SAGE_PORT' to\"\n        echo \"something non-empty.\"\n        exit 1\n    elif [ `uname` = \"SunOS\" -a \"`uname -p`\" != \"sparc\" ]; then\n\n```\n\n* I changed one line of code\n   \n\n```\n elif [ `uname` != \"SunOS\" -a `uname` != \"Darwin\" -a `uname` != \"Linux\" ]; then\n```\n\nto\n\n```\n    elif [ `uname` != \"SunOS\" ] && [ `uname` != \"Darwin\" ] && [ `uname` != \"Linux\" ]; then\n```\nas I understand the former is not portable if there is more than one '-a'. Since this code is run by /bin/sh, and not bash, we can't assume that more that one '-a' will work. \n\nThe changes can be found on the web at:\nhttp://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/\nbut if you download the files, the execute permissions on prereq-0.4-install will be lost, so they will need to be added back manually. \n\nIf you are happy with those changes, could you please check them in my name. If you take the files from sage.math from the directory\n\n```\n/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/\n```\n\nthen the permissions should be ok.  \n\nThere is an issue which I noticed, which might want addressing later, but I have left, as it probably needs some discussion. \n\nIf one wished to build Sage on a platform without GCC, it would fail due to the checks for gcc and g++, **even if one's aim was to use another compiler**. When I try to build Sage with Sun Studio, it would actually be advantages to **not** have gcc in my path, as then I would spot the bits of code that rely on gcc. Perhaps it might be sensible to not check gcc and g++ if SAGE_PORT was defined to something non-empty. Anyway, for now at least, having gcc and g++ is a requirement, even if you wished to improve sage so it does not rely on gcc, but used better compilers when available.",
    "created_at": "2009-10-05T11:27:06Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51964",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
Thank you for all your comments. In light of these, and some thoughts I had, I've made a few changes. 

* I removed the configure.ac.bak file, which was an oversight on my part. 
* I left the directory *autom4te.cache*, as that is something created by *autoreconf* and is not simply a left-over from me typing *configure*. However, I did remove the file *autom4te.cache/requests* as it says at the top of the file that it can be safely removed. There is nothing to indicate to me that it is safe to remove the other files in the directory *autom4te.cache*, so I think they are best left. 
* I removed Williams's name, but suggested sage-support was emailed, not sage-devel, as the failure to find the files checked for (make, ar, perl, m4, ranlib, tar and gcc) are really support issues, not developer issues. I provided a link to the Google group sage-support.
* I added 'g++' to that list of files too, just in case someone has GCC built for only compiling C, and not C++.
* I do not believe there should be any parentheses after AC_PROG_CPP see [the autoconf manual](http://www.gnu.org/software/autoconf/manual/html_node/C-Compiler.html) Hence I left that unchanged. 
* I changed the license as suggested, though I'm not convinced that was really necessary, as the GPL 2 specifically says you can use a later version. 
* There were two places CYGWIN were checked. Both said it was not supported, and both caused it to exit. I removed the second check, but left the first, which will now exits unless SAGE_PORT is exported. If someone really wants to build on cygwin, we should not stop them. The code now has:

```
if [ "$SAGE_PORT" = "" ]; then
    if [ `uname | sed -e 's/WIN.\+/WIN/'` = "CYGWIN" ]; then
        echo "Unfortunately, building SAGE on Cygwin is not currently supported,"
        echo "though we are actively working on supporting it.  If you would like"
        echo "to help with the porting effort, please post to"
        echo ""
        echo "   http://groups.google.com/group/sage-windows"
        echo ""
        echo "Also, see http://trac.sagemath.org/sage_trac/ticket/6743"
        echo "In the meantime, to run Sage on Windows, please use"
        echo "a virtualization solution instead, such as VMware."
        echo "To get past this message, export the variable 'SAGE_PORT' to"
        echo "something non-empty."
        exit 1
    elif [ `uname` = "SunOS" -a "`uname -p`" != "sparc" ]; then

```

* I changed one line of code
   

```
 elif [ `uname` != "SunOS" -a `uname` != "Darwin" -a `uname` != "Linux" ]; then
```

to

```
    elif [ `uname` != "SunOS" ] && [ `uname` != "Darwin" ] && [ `uname` != "Linux" ]; then
```
as I understand the former is not portable if there is more than one '-a'. Since this code is run by /bin/sh, and not bash, we can't assume that more that one '-a' will work. 

The changes can be found on the web at:
http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/
but if you download the files, the execute permissions on prereq-0.4-install will be lost, so they will need to be added back manually. 

If you are happy with those changes, could you please check them in my name. If you take the files from sage.math from the directory

```
/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/
```

then the permissions should be ok.  

There is an issue which I noticed, which might want addressing later, but I have left, as it probably needs some discussion. 

If one wished to build Sage on a platform without GCC, it would fail due to the checks for gcc and g++, **even if one's aim was to use another compiler**. When I try to build Sage with Sun Studio, it would actually be advantages to **not** have gcc in my path, as then I would spot the bits of code that rely on gcc. Perhaps it might be sensible to not check gcc and g++ if SAGE_PORT was defined to something non-empty. Anyway, for now at least, having gcc and g++ is a requirement, even if you wished to improve sage so it does not rely on gcc, but used better compilers when available.



---

archive/issue_comments_051965.json:
```json
{
    "body": "<a id='comment:14'></a>\nGood work, positive review!",
    "created_at": "2009-10-05T20:52:07Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51965",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:14'></a>
Good work, positive review!



---

archive/issue_comments_051966.json:
```json
{
    "body": "**Reviewer:** Georg S. Weber",
    "created_at": "2009-10-05T20:52:07Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51966",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

**Reviewer:** Georg S. Weber



---

archive/issue_events_046780.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2009-10-05T20:52:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46780"
}
```



---

archive/issue_events_046781.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2009-10-05T20:52:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46781"
}
```



---

archive/issue_comments_051967.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhen implemented, in additon to the two tickets mentioned above, I found another one this can close. I believe all these 3 can be closed. \n\n* #6707   \t Sage will try to build on compilers known to be too old.\n* #6701   \t prereq-0.3.tar has many issues and needs updating.\n* #3384   \t Issues a warning for all unsupported / poorly supported operating systems.\n\nDave",
    "created_at": "2009-10-07T08:46:26Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51967",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>
When implemented, in additon to the two tickets mentioned above, I found another one this can close. I believe all these 3 can be closed. 

* #6707   	 Sage will try to build on compilers known to be too old.
* #6701   	 prereq-0.3.tar has many issues and needs updating.
* #3384   	 Issues a warning for all unsupported / poorly supported operating systems.

Dave



---

archive/issue_events_046782.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-10-07T15:42:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46782"
}
```



---

archive/issue_events_046783.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-10-07T15:42:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7021#event-46783"
}
```



---

archive/issue_comments_051968.json:
```json
{
    "body": "<a id='comment:16'></a>\nI've merged the code from http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/ into sage-4.1.2.rc1.alpha3.",
    "created_at": "2009-10-07T15:42:41Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51968",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:16'></a>
I've merged the code from http://sage.math.washington.edu/home/kirkby/Solaris-fixes/prereq-0.4-3rd-try/ into sage-4.1.2.rc1.alpha3.



---

archive/issue_comments_051969.json:
```json
{
    "body": "<a id='comment:17'></a>\nI have closed #6707, #6701, and #3384.",
    "created_at": "2009-10-07T15:44:10Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51969",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:17'></a>
I have closed #6707, #6701, and #3384.



---

archive/issue_comments_051970.json:
```json
{
    "body": "<a id='comment:18'></a>\nunique name please",
    "created_at": "2017-07-19T08:51:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51970",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
unique name please



---

archive/issue_comments_051971.json:
```json
{
    "body": "**Changing author** from \"David Kirkby, Minh Nguyen\" to \"David Kirkby, Minh Van Nguyen\".",
    "created_at": "2017-07-19T08:51:09Z",
    "issue": "https://github.com/sagemath/sage/issues/7021",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7021#issuecomment-51971",
    "user": "https://github.com/fchapoton"
}
```

**Changing author** from "David Kirkby, Minh Nguyen" to "David Kirkby, Minh Van Nguyen".
