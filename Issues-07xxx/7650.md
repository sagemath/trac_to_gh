# Issue 7650: Fix sagenb doctesting

archive/issues_007650.json:
```json
{
    "body": "We have not been doctesting SageNB files as often as we test Sage files.\n\nPlease apply\n\n* [attachment:trac_7650-scripts_doctest_force_lib_v5.patch] to the scripts repository.  This adds two options to `sage -t`: `-sagenb` tests all SageNB files and `-force_lib` tests files *as if* they live in `SAGE_ROOT/devel/sage`, i.e., in the Sage library.\n\n* [attachment:trac_7650-sagenb_doctesting_v6.patch] **and** [attachment:trac_7650-reviewer_v2.patch] to the sagenb repository.  This fixes broken SageNB tests.\n\nand replace `SAGE_ROOT/makefile` with\n\n* [attachment:makefile].  This makes `make test` and `make ptest` test all SageNB files, too.\n\nDependencies: Sage 4.3.1.alpha1, #7269.\n\nAssignee: @williamstein\n\nCC:  @williamstein @TimDumol @mwhansen @jasongrout\n\nResolution: fixed\n\nAuthor: Mitesh Patel\n\nReviewer: Tim Dumol\n\nMerged: sage-4.3.1.rc1\n\nIssue created by migration from https://trac.sagemath.org/ticket/7650\n\n",
    "closed_at": "2010-01-19T02:55:28Z",
    "created_at": "2009-12-10T03:12:15Z",
    "labels": [
        "component: notebook",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.1",
    "title": "Fix sagenb doctesting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/7650",
    "user": "https://github.com/qed777"
}
```
We have not been doctesting SageNB files as often as we test Sage files.

Please apply

* [attachment:trac_7650-scripts_doctest_force_lib_v5.patch] to the scripts repository.  This adds two options to `sage -t`: `-sagenb` tests all SageNB files and `-force_lib` tests files *as if* they live in `SAGE_ROOT/devel/sage`, i.e., in the Sage library.

* [attachment:trac_7650-sagenb_doctesting_v6.patch] **and** [attachment:trac_7650-reviewer_v2.patch] to the sagenb repository.  This fixes broken SageNB tests.

and replace `SAGE_ROOT/makefile` with

* [attachment:makefile].  This makes `make test` and `make ptest` test all SageNB files, too.

Dependencies: Sage 4.3.1.alpha1, #7269.

Assignee: @williamstein

CC:  @williamstein @TimDumol @mwhansen @jasongrout

Resolution: fixed

Author: Mitesh Patel

Reviewer: Tim Dumol

Merged: sage-4.3.1.rc1

Issue created by migration from https://trac.sagemath.org/ticket/7650





---

archive/issue_comments_065274.json:
```json
{
    "body": "<a id='comment:1'></a>Part of the problem is that notebook directories now need to end in `.sagenb`.\n\nI'm working on a patch for this and whatever other problems I can fix.",
    "created_at": "2009-12-10T03:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65274",
    "user": "https://github.com/qed777"
}
```

<a id='comment:1'></a>Part of the problem is that notebook directories now need to end in `.sagenb`.

I'm working on a patch for this and whatever other problems I can fix.



---

archive/issue_comments_065275.json:
```json
{
    "body": "<a id='comment:2'></a>\n```python\nsage -t -verbose \"notebook.py\"                              \nTraceback (most recent call last):\n  File \"/home/.sage//tmp/.doctest_notebook.py\", line 18, in <module>\n    from notebook import *\n  File \"/home/.sage/tmp/notebook.py\", line 38, in <module>\n    import css          # style\nImportError: No module named css\n         [2.5 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -verbose \"notebook.py\"\nTotal time for all tests: 2.5 seconds\n```\n\nAdding\n\n```python\nimport sys\nsys.path.append('/home/sage/notebook/sagenb/sagenb')\nsys.path.append('/home/sage/notebook/sagenb/sagenb/notebook')\n```\nto the top of `notebook.py` allows testing to proceed.  I'm not sure about a real solution.",
    "created_at": "2009-12-10T03:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65275",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>
```python
sage -t -verbose "notebook.py"                              
Traceback (most recent call last):
  File "/home/.sage//tmp/.doctest_notebook.py", line 18, in <module>
    from notebook import *
  File "/home/.sage/tmp/notebook.py", line 38, in <module>
    import css          # style
ImportError: No module named css
         [2.5 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -verbose "notebook.py"
Total time for all tests: 2.5 seconds
```

Adding

```python
import sys
sys.path.append('/home/sage/notebook/sagenb/sagenb')
sys.path.append('/home/sage/notebook/sagenb/sagenb/notebook')
```
to the top of `notebook.py` allows testing to proceed.  I'm not sure about a real solution.



---

archive/issue_comments_065276.json:
```json
{
    "body": "Attachment [trac_7650-sagenb_doctesting.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting.patch) by @qed777 created at 2009-12-10 11:39:48\n\nAdd `--force_lib` option to `sage-doctest`.  Use `os.path.join`.  **scripts** repo.",
    "created_at": "2009-12-10T11:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65276",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-sagenb_doctesting.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting.patch) by @qed777 created at 2009-12-10 11:39:48

Add `--force_lib` option to `sage-doctest`.  Use `os.path.join`.  **scripts** repo.



---

archive/issue_comments_065277.json:
```json
{
    "body": "Fix sagenb doctests.  **sagenb** repo.",
    "created_at": "2009-12-10T11:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65277",
    "user": "https://github.com/qed777"
}
```

Fix sagenb doctests.  **sagenb** repo.



---

archive/issue_comments_065278.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2009-12-10T11:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65278",
    "user": "https://github.com/qed777"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_065279.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_7650-scripts_doctest_force_lib.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib.patch) by @qed777 created at 2009-12-10 11:57:53\n\n**Please note: The attachments (or their descriptions) are switched.**  I apologize for this.\n\nAnyway, with the scripts repository patch, we can do, e.g.,\n\n```sh\n$ sage -t --force_lib sagenb/\n```\nWith the sagenb repository patch applied to #7625 + #7483 + #7482 + #7514 + #7648, all tests but 3 pass.  The failures are in `sagenb/misc/sageinspect.py` (cf. #7514).  The Selenium tests still pass.\n\nRemarks:\n\n* I hope I did not create false-negatives.\n* [This sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/9dd524690bb1588b/38855ecc2819205a?#38855ecc2819205a) *might* be relevant to some tests that evaluate cells.\n* I \"untabified\" `cell.py`, `worksheet.py`, `notebook.py`, and `twist.py`.\n* I added `'nodoctest'` to `simple/twist.py`, since at least one test appears to hang indefinitely.  I don't know why.\n* Feel free to lower the priority.",
    "created_at": "2009-12-10T11:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65279",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>Attachment [trac_7650-scripts_doctest_force_lib.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib.patch) by @qed777 created at 2009-12-10 11:57:53

**Please note: The attachments (or their descriptions) are switched.**  I apologize for this.

Anyway, with the scripts repository patch, we can do, e.g.,

```sh
$ sage -t --force_lib sagenb/
```
With the sagenb repository patch applied to #7625 + #7483 + #7482 + #7514 + #7648, all tests but 3 pass.  The failures are in `sagenb/misc/sageinspect.py` (cf. #7514).  The Selenium tests still pass.

Remarks:

* I hope I did not create false-negatives.
* [This sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/9dd524690bb1588b/38855ecc2819205a?#38855ecc2819205a) *might* be relevant to some tests that evaluate cells.
* I "untabified" `cell.py`, `worksheet.py`, `notebook.py`, and `twist.py`.
* I added `'nodoctest'` to `simple/twist.py`, since at least one test appears to hang indefinitely.  I don't know why.
* Feel free to lower the priority.



---

archive/issue_comments_065280.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2009-12-10T11:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65280",
    "user": "https://github.com/qed777"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_065281.json:
```json
{
    "body": "<a id='comment:5'></a>Should we add, e.g., \n\n```sh\nsage -t --force_lib $SAGE_ROOT/local/lib/python/site-packages/sagenb\n```\nto `$SAGE_ROOT/makefile`?  Or `sage-test`?",
    "created_at": "2009-12-10T12:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65281",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'></a>Should we add, e.g., 

```sh
sage -t --force_lib $SAGE_ROOT/local/lib/python/site-packages/sagenb
```
to `$SAGE_ROOT/makefile`?  Or `sage-test`?



---

archive/issue_comments_065282.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2009-12-10T18:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65282",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_065283.json:
```json
{
    "body": "<a id='comment:6'></a>I like this patch a lot.  However, a nitpick: get rid of the / before tmp here:\n\n```\nSAGE_TESTDIR = os.path.join(DOT_SAGE, \"/tmp\") \n```\nLikewise, elsewhere in the patch there are a bunch of os.path.joins combined with explicit* slashes.  \n\nRegarding adding sage -t sagenb, etc., to sage-test or whatever: \"yes!\"",
    "created_at": "2009-12-10T18:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65283",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>I like this patch a lot.  However, a nitpick: get rid of the / before tmp here:

```
SAGE_TESTDIR = os.path.join(DOT_SAGE, "/tmp") 
```
Likewise, elsewhere in the patch there are a bunch of os.path.joins combined with explicit* slashes.  

Regarding adding sage -t sagenb, etc., to sage-test or whatever: "yes!"



---

archive/issue_comments_065284.json:
```json
{
    "body": "Updated scripts repo patch.  Replaces previous.",
    "created_at": "2009-12-11T14:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65284",
    "user": "https://github.com/qed777"
}
```

Updated scripts repo patch.  Replaces previous.



---

archive/issue_comments_065285.json:
```json
{
    "body": "Attachment [trac_7650-sagenb_doctesting_v2.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v2.patch) by @qed777 created at 2009-12-13 14:18:53\n\nQuit spawned worksheet processes.  Replaces previous sagenb repo patch.",
    "created_at": "2009-12-13T14:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65285",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-sagenb_doctesting_v2.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v2.patch) by @qed777 created at 2009-12-13 14:18:53

Quit spawned worksheet processes.  Replaces previous sagenb repo patch.



---

archive/issue_events_018199.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-14T01:58:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "milestone": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7650#event-18199"
}
```



---

archive/issue_comments_065286.json:
```json
{
    "body": "Auto-detect `site-packages`.  scripts repo.  Replaces previous.",
    "created_at": "2009-12-14T03:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65286",
    "user": "https://github.com/qed777"
}
```

Auto-detect `site-packages`.  scripts repo.  Replaces previous.



---

archive/issue_comments_065287.json:
```json
{
    "body": "Attachment [trac_7650-scripts_doctest_force_lib_v3.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v3.patch) by @qed777 created at 2009-12-14 06:06:45\n\nAdds `-sagenb` option.  scripts repo.  Replaces previous.",
    "created_at": "2009-12-14T06:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65287",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-scripts_doctest_force_lib_v3.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v3.patch) by @qed777 created at 2009-12-14 06:06:45

Adds `-sagenb` option.  scripts repo.  Replaces previous.



---

archive/issue_comments_065288.json:
```json
{
    "body": "Attachment [trac_7650-scripts_doctest_force_lib_v4.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v4.patch) by @qed777 created at 2009-12-14 06:09:51\n\nUpdated `SAGE_ROOT/makefile`.",
    "created_at": "2009-12-14T06:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65288",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-scripts_doctest_force_lib_v4.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v4.patch) by @qed777 created at 2009-12-14 06:09:51

Updated `SAGE_ROOT/makefile`.



---

archive/issue_comments_065289.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2009-12-14T06:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65289",
    "user": "https://github.com/qed777"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_065290.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [makefile](tarball://root/attachments/some-uuid/ticket7650/makefile) by @qed777 created at 2009-12-14 06:18:29\n\nWith [attachment:trac_7650-scripts_doctest_force_lib_v4.patch] and an updated top-level [attachment: makefile], we can do\n\n* `make test`\n* `make ptest`\n* `sage -t -sagenb`\n* `sage -tp -sagenb`\n\netc.  Maybe we should unify the test scripts and use [optparse](http://docs.python.org/library/optparse.html)?",
    "created_at": "2009-12-14T06:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65290",
    "user": "https://github.com/qed777"
}
```

<a id='comment:8'></a>Attachment [makefile](tarball://root/attachments/some-uuid/ticket7650/makefile) by @qed777 created at 2009-12-14 06:18:29

With [attachment:trac_7650-scripts_doctest_force_lib_v4.patch] and an updated top-level [attachment: makefile], we can do

* `make test`
* `make ptest`
* `sage -t -sagenb`
* `sage -tp -sagenb`

etc.  Maybe we should unify the test scripts and use [optparse](http://docs.python.org/library/optparse.html)?



---

archive/issue_comments_065291.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2009-12-21T03:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65291",
    "user": "https://github.com/TimDumol"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_065292.json:
```json
{
    "body": "<a id='comment:9'></a>The new options to `sage -t` (-force_lib and -sagenb) are not documented in the help message. Please do so.",
    "created_at": "2009-12-21T03:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65292",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:9'></a>The new options to `sage -t` (-force_lib and -sagenb) are not documented in the help message. Please do so.



---

archive/issue_comments_065293.json:
```json
{
    "body": "<a id='comment:10'></a>I'm declaring a total feature freeze on sage-4.3.",
    "created_at": "2009-12-24T07:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65293",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>I'm declaring a total feature freeze on sage-4.3.



---

archive/issue_events_018200.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-24T07:06:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "milestone": "sage-4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7650#event-18200"
}
```



---

archive/issue_events_018201.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-12-24T07:06:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "milestone": "sage-4.3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7650#event-18201"
}
```



---

archive/issue_comments_065294.json:
```json
{
    "body": "<a id='comment:11'></a>Also: Be more agressive with `os.path.join`-ery.",
    "created_at": "2009-12-24T18:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65294",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'></a>Also: Be more agressive with `os.path.join`-ery.



---

archive/issue_comments_065295.json:
```json
{
    "body": "Attachment [trac_7650-scripts_doctest_force_lib_v5.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v5.patch) by @qed777 created at 2009-12-28 23:10:03\n\nDocument new options.  More `os.path.join`-ery.  Replaces previous.",
    "created_at": "2009-12-28T23:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65295",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-scripts_doctest_force_lib_v5.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-scripts_doctest_force_lib_v5.patch) by @qed777 created at 2009-12-28 23:10:03

Document new options.  More `os.path.join`-ery.  Replaces previous.



---

archive/issue_comments_065296.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2009-12-28T23:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65296",
    "user": "https://github.com/qed777"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_065297.json:
```json
{
    "body": "Rebased vs. #7482's v4.  Replaces previous **sagenb** patch.",
    "created_at": "2010-01-01T10:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65297",
    "user": "https://github.com/qed777"
}
```

Rebased vs. #7482's v4.  Replaces previous **sagenb** patch.



---

archive/issue_comments_065298.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [trac_7650-sagenb_doctesting_v3.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v3.patch) by @qed777 created at 2010-01-01 10:57:37",
    "created_at": "2010-01-01T10:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65298",
    "user": "https://github.com/qed777"
}
```

<a id='comment:13'></a>Attachment [trac_7650-sagenb_doctesting_v3.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v3.patch) by @qed777 created at 2010-01-01 10:57:37



---

archive/issue_comments_065299.json:
```json
{
    "body": "Rebased vs. 4.3.1.alpha0 + #7269.  Replaces previous sagenb patch.",
    "created_at": "2010-01-05T00:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65299",
    "user": "https://github.com/qed777"
}
```

Rebased vs. 4.3.1.alpha0 + #7269.  Replaces previous sagenb patch.



---

archive/issue_comments_065300.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [trac_7650-sagenb_doctesting_v4.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v4.patch) by @qed777 created at 2010-01-05 00:49:32",
    "created_at": "2010-01-05T00:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65300",
    "user": "https://github.com/qed777"
}
```

<a id='comment:14'></a>Attachment [trac_7650-sagenb_doctesting_v4.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v4.patch) by @qed777 created at 2010-01-05 00:49:32



---

archive/issue_comments_065301.json:
```json
{
    "body": "<a id='comment:15'></a>I've attached a rebased sagenb patch.  I added `\"\"\"nodoctests\"\"\"` to the top of `sagenb.misc.ipaddr`.  It's also easy to make its doctest pass, but I haven't done this.  Please let me know, if I should.",
    "created_at": "2010-01-05T00:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65301",
    "user": "https://github.com/qed777"
}
```

<a id='comment:15'></a>I've attached a rebased sagenb patch.  I added `"""nodoctests"""` to the top of `sagenb.misc.ipaddr`.  It's also easy to make its doctest pass, but I haven't done this.  Please let me know, if I should.



---

archive/issue_comments_065302.json:
```json
{
    "body": "Attachment [trac_7650-sagenb_doctesting_v5.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v5.patch) by @qed777 created at 2010-01-14 21:58:17\n\nFix tags / user_view asymmetry.  Replaces previous sagenb patch.",
    "created_at": "2010-01-14T21:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65302",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-sagenb_doctesting_v5.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v5.patch) by @qed777 created at 2010-01-14 21:58:17

Fix tags / user_view asymmetry.  Replaces previous sagenb patch.



---

archive/issue_comments_065303.json:
```json
{
    "body": "<a id='comment:17'></a>V5 makes it so a worksheet `reconstruct`ed from the `basic` representation of another has the same `tags` and `user_view` as the original.",
    "created_at": "2010-01-14T22:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65303",
    "user": "https://github.com/qed777"
}
```

<a id='comment:17'></a>V5 makes it so a worksheet `reconstruct`ed from the `basic` representation of another has the same `tags` and `user_view` as the original.



---

archive/issue_comments_065304.json:
```json
{
    "body": "Fix interact doctests for 4.3.1.alpha2 (colors.py).  Replaces previous sagenb patch.",
    "created_at": "2010-01-15T21:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65304",
    "user": "https://github.com/qed777"
}
```

Fix interact doctests for 4.3.1.alpha2 (colors.py).  Replaces previous sagenb patch.



---

archive/issue_comments_065305.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [trac_7650-sagenb_doctesting_v6.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v6.patch) by @TimDumol created at 2010-01-16 21:22:05\n\nReplying to [comment:17 mpatel]:\n> V5 makes it so a worksheet `reconstruct`ed from the `basic` representation of another has the same `tags` and `user_view` as the original.\n\n\nShouldn't this be put in a new ticket?",
    "created_at": "2010-01-16T21:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65305",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:18'></a>Attachment [trac_7650-sagenb_doctesting_v6.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-sagenb_doctesting_v6.patch) by @TimDumol created at 2010-01-16 21:22:05

Replying to [comment:17 mpatel]:
> V5 makes it so a worksheet `reconstruct`ed from the `basic` representation of another has the same `tags` and `user_view` as the original.


Shouldn't this be put in a new ticket?



---

archive/issue_comments_065306.json:
```json
{
    "body": "<a id='comment:19'></a>Yes, but it's already here.  :)  In the course of fixing many failed doctests, I noticed it and a few other small problems:\n\n* In `run_notebook.notebook_twisted`: Replaced `nb.directory()` (not defined) with `nb._dir`.\n* In `worksheet`: Replaced `self.__collaborators` (`AttributeError`) with `self.collaborators()` in a few places.\n* In `worksheet.set_filename`:\n\n```diff\n-        self.__dir = os.path.join(self.notebook().worksheet_directory(), filename)\n+        self.__dir = os.path.join(self.notebook()._dir, filename)\n```\n* In `worksheet.tags`:\n\n```diff\n             d = dict(self.__user_view)\n         except AttributeError:\n             self.user_view(self.owner())\n-            d = self.__user_view\n+            d = copy.copy(self.__user_view)\n         for user, val in d.iteritems():\n-            d[user] = [val]\n+            if not isinstance(val, list):\n+                d[user] = [val]\n         return d\n```\n This ensures the tests in `Worksheet.reconstruct_from_basic` pass and that calling `tags` does not alter the current user view, e.g., turning `1` into `[1]`.\n\nAlso:\n\n* Removed argument `verbose` (obsolete) from `Cell.set_introspect_html`.",
    "created_at": "2010-01-17T14:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65306",
    "user": "https://github.com/qed777"
}
```

<a id='comment:19'></a>Yes, but it's already here.  :)  In the course of fixing many failed doctests, I noticed it and a few other small problems:

* In `run_notebook.notebook_twisted`: Replaced `nb.directory()` (not defined) with `nb._dir`.
* In `worksheet`: Replaced `self.__collaborators` (`AttributeError`) with `self.collaborators()` in a few places.
* In `worksheet.set_filename`:

```diff
-        self.__dir = os.path.join(self.notebook().worksheet_directory(), filename)
+        self.__dir = os.path.join(self.notebook()._dir, filename)
```
* In `worksheet.tags`:

```diff
             d = dict(self.__user_view)
         except AttributeError:
             self.user_view(self.owner())
-            d = self.__user_view
+            d = copy.copy(self.__user_view)
         for user, val in d.iteritems():
-            d[user] = [val]
+            if not isinstance(val, list):
+                d[user] = [val]
         return d
```
 This ensures the tests in `Worksheet.reconstruct_from_basic` pass and that calling `tags` does not alter the current user view, e.g., turning `1` into `[1]`.

Also:

* Removed argument `verbose` (obsolete) from `Cell.set_introspect_html`.



---

archive/issue_comments_065307.json:
```json
{
    "body": "<a id='comment:20'></a>This bags a positive review from me, except for the few changes I've made in the reviewer patch. Can someone sign them off?",
    "created_at": "2010-01-17T18:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65307",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:20'></a>This bags a positive review from me, except for the few changes I've made in the reviewer patch. Can someone sign them off?



---

archive/issue_comments_065308.json:
```json
{
    "body": "A few documentation fixes (precision errors and style), and a couple of changes to try-except blocks to make it easier to transition to Python 3",
    "created_at": "2010-01-17T19:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65308",
    "user": "https://github.com/TimDumol"
}
```

A few documentation fixes (precision errors and style), and a couple of changes to try-except blocks to make it easier to transition to Python 3



---

archive/issue_comments_065309.json:
```json
{
    "body": "Attachment [trac_7650-reviewer.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-reviewer.patch) by @qed777 created at 2010-01-18 04:10:43\n\nFix two doctest failures.  Replaces reviewer patch.  sagenb repo.",
    "created_at": "2010-01-18T04:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65309",
    "user": "https://github.com/qed777"
}
```

Attachment [trac_7650-reviewer.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-reviewer.patch) by @qed777 created at 2010-01-18 04:10:43

Fix two doctest failures.  Replaces reviewer patch.  sagenb repo.



---

archive/issue_comments_065310.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-18T04:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65310",
    "user": "https://github.com/qed777"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_065311.json:
```json
{
    "body": "<a id='comment:21'></a>Attachment [trac_7650-reviewer_v2.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-reviewer_v2.patch) by @qed777 created at 2010-01-18 04:17:30\n\nV2 of the reviewer patch:\n\n* Adds a missing dot (`.`) in `interact.py`.\n* Moves `# output depends on timezone` to the input statement in `worksheet.py`.\n* [Pre-existing] `most be defined` --> `must be defined`.",
    "created_at": "2010-01-18T04:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65311",
    "user": "https://github.com/qed777"
}
```

<a id='comment:21'></a>Attachment [trac_7650-reviewer_v2.patch](tarball://root/attachments/some-uuid/ticket7650/trac_7650-reviewer_v2.patch) by @qed777 created at 2010-01-18 04:17:30

V2 of the reviewer patch:

* Adds a missing dot (`.`) in `interact.py`.
* Moves `# output depends on timezone` to the input statement in `worksheet.py`.
* [Pre-existing] `most be defined` --> `must be defined`.



---

archive/issue_comments_065312.json:
```json
{
    "body": "<a id='comment:22'></a>I applied the scripts patch and replaced makefile in SAGE_ROOT. Please post a `sagenb-0.5.1.spkg`.",
    "created_at": "2010-01-19T01:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65312",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:22'></a>I applied the scripts patch and replaced makefile in SAGE_ROOT. Please post a `sagenb-0.5.1.spkg`.



---

archive/issue_events_018202.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-19T02:55:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/7650#event-18202"
}
```



---

archive/issue_comments_065313.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-19T02:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65313",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_comments_065314.json:
```json
{
    "body": "<a id='comment:23'></a>Merged http://boxen.math.washington.edu/home/timdumol/sagenb-0.6.spkg into spkg/standard.",
    "created_at": "2010-01-19T02:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/7650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/7650#issuecomment-65314",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:23'></a>Merged http://boxen.math.washington.edu/home/timdumol/sagenb-0.6.spkg into spkg/standard.
