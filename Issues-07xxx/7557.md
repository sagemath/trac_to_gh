# Issue 7557: conversion of complex numbers in symbolic expressions to maxima broken

archive/issues_007557.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "Reported on sage-support:\n\n```\nvar('y', domain='real')\nassume(y, 'real')\n\nabs(exp(y*I)).simplify()\n    1\n\nabs(exp(1.1*y*I)).simplify()\n    e^(1.1*I*y)\n\nThe last result is incorrect. It seems simplify() doesn't like\nfloating point?\n```\n\nIn this thread:\n\nhttp://groups.google.com/group/sage-support/browse_thread/thread/c6d4c757cef8cc4a\n\n\nMore evidence:\n\n```\nsage: t = abs(exp(y*I)); t\nabs(e^(I*y))\nsage: t._maxima_init_()\n'abs(exp((y)*(0+%i*1)))'\n\nsage: u = abs(exp(1.1*y*I)); u\nabs(e^(1.10000000000000*I*y))\nsage: u._maxima_init_()\n'abs(exp((y)*(1.1000000000000001*I)))'\n```\n\nThis might be the reason:\n\n```\nsage: t.operands()[0].operands()[0].operands()[1].pyobject()\nI\nsage: type(t.operands()[0].operands()[0].operands()[1].pyobject())\n<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>\n\nsage: u.operands()[0].operands()[0].operands()[1].pyobject()\n1.10000000000000*I\nsage: type(u.operands()[0].operands()[0].operands()[1].pyobject())\n<type 'sage.rings.complex_number.ComplexNumber'>\n```\n\n**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz), [attachment: trac_7557-fix_doctest_precision.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)\n\nCC:  @kcrisman\n\nKeywords: **interfaces**\n\nReviewer: **Volker Braun, Karl-Dieter Crisman**\n\nAuthor: **Burcin Erocal**\n\nMerged: **sage-5.7.beta0**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/7557_\n\n",
    "closed_at": "2013-01-21T21:07:48Z",
    "created_at": "2009-11-30T09:58:16Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "conversion of complex numbers in symbolic expressions to maxima broken",
    "type": "issue",
    "updated_at": "2013-01-21T21:07:48Z",
    "url": "https://github.com/sagemath/sage/issues/7557",
    "user": "https://github.com/burcin"
}
```
Reported on sage-support:

```
var('y', domain='real')
assume(y, 'real')

abs(exp(y*I)).simplify()
    1

abs(exp(1.1*y*I)).simplify()
    e^(1.1*I*y)

The last result is incorrect. It seems simplify() doesn't like
floating point?
```

In this thread:

http://groups.google.com/group/sage-support/browse_thread/thread/c6d4c757cef8cc4a


More evidence:

```
sage: t = abs(exp(y*I)); t
abs(e^(I*y))
sage: t._maxima_init_()
'abs(exp((y)*(0+%i*1)))'

sage: u = abs(exp(1.1*y*I)); u
abs(e^(1.10000000000000*I*y))
sage: u._maxima_init_()
'abs(exp((y)*(1.1000000000000001*I)))'
```

This might be the reason:

```
sage: t.operands()[0].operands()[0].operands()[1].pyobject()
I
sage: type(t.operands()[0].operands()[0].operands()[1].pyobject())
<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>

sage: u.operands()[0].operands()[0].operands()[1].pyobject()
1.10000000000000*I
sage: type(u.operands()[0].operands()[0].operands()[1].pyobject())
<type 'sage.rings.complex_number.ComplexNumber'>
```

**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz), [attachment: trac_7557-fix_doctest_precision.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)

CC:  @kcrisman

Keywords: **interfaces**

Reviewer: **Volker Braun, Karl-Dieter Crisman**

Author: **Burcin Erocal**

Merged: **sage-5.7.beta0**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/7557_





---

archive/issue_events_092859.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-11-30T09:58:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92859"
}
```



---

archive/issue_events_092860.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-11-30T09:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92860"
}
```



---

archive/issue_events_092861.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-11-30T09:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92861"
}
```



---

archive/issue_events_092862.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-11-30T09:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92862"
}
```



---

archive/issue_events_092863.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-11-30T09:58:16Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "subject": "https://github.com/burcin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92863"
}
```



---

archive/issue_comments_056052.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe thread [here](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/a6cbc2743ca47948) suggests perhaps this is fixed in Maxima 5.23.",
    "created_at": "2011-02-08T17:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56052",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

The thread [here](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/a6cbc2743ca47948) suggests perhaps this is fixed in Maxima 5.23.



---

archive/issue_comments_056053.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nRobert Dodier of Maxima suggests in [this sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/d8db720220ee3508?show_docid=d8db720220ee3508#) that this should now be fixed.",
    "created_at": "2012-02-27T13:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56053",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

Robert Dodier of Maxima suggests in [this sage-support thread](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/d8db720220ee3508?show_docid=d8db720220ee3508#) that this should now be fixed.



---

archive/issue_comments_056054.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOops, those were the same thread!",
    "created_at": "2012-02-27T15:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56054",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Oops, those were the same thread!



---

archive/issue_comments_056055.json:
```json
{
    "body": "Changed keywords from none to **interfaces**",
    "created_at": "2012-11-20T09:53:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56055",
    "user": "https://github.com/burcin"
}
```

Changed keywords from none to **interfaces**



---

archive/issue_comments_056056.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n[This sage-support thread](https://groups.google.com/d/topic/sage-support/mua3IYmrAWc/discussion) is also about the same problem. Patch coming up.",
    "created_at": "2012-11-20T09:53:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56056",
    "user": "https://github.com/burcin"
}
```

<div id="comment:4" align="right">comment:4</div>

[This sage-support thread](https://groups.google.com/d/topic/sage-support/mua3IYmrAWc/discussion) is also about the same problem. Patch coming up.



---

archive/issue_comments_056057.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPatch up. Please review.",
    "created_at": "2012-11-20T10:27:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56057",
    "user": "https://github.com/burcin"
}
```

<div id="comment:5" align="right">comment:5</div>

Patch up. Please review.



---

archive/issue_events_092864.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-11-20T10:27:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92864"
}
```



---

archive/issue_comments_056058.json:
```json
{
    "body": "Author: **Burcin Erocal**",
    "created_at": "2012-11-20T10:27:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56058",
    "user": "https://github.com/burcin"
}
```

Author: **Burcin Erocal**



---

archive/issue_comments_056059.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI updated the patch with a minor doctest correction in `expression.pyx`.",
    "created_at": "2012-11-20T10:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56059",
    "user": "https://github.com/burcin"
}
```

<div id="comment:6" align="right">comment:6</div>

I updated the patch with a minor doctest correction in `expression.pyx`.



---

archive/issue_events_092865.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-20T13:21:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92865"
}
```



---

archive/issue_events_092866.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-11-20T13:21:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92866"
}
```



---

archive/issue_comments_056060.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLooks good to me!",
    "created_at": "2012-11-20T13:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56060",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Looks good to me!



---

archive/issue_comments_056061.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2012-11-20T13:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56061",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_056062.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAm I testing this correctly? I don't see any change:\n\n```\n0 jan@osprey:~/sage/sage-5.4/devel$hg qpush \napplying trac_7557-maxima_complex_number_conversion.patch\nnow at: trac_7557-maxima_complex_number_conversion.patch\n0 jan@osprey:~/sage/sage-5.4/devel$hg qapplied\ntrac_7557-maxima_complex_number_conversion.patch\n0 jan@osprey:~/sage/sage-5.4/devel$mysage -b complexbug\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nExecuting 0 commands (using 1 thread)\nTime to execute 0 commands: 0.0179660320282 seconds\nFinished compiling Cython code (time = 0.490197181702 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nExecuting 0 commands (using 1 thread)\nTime to execute 0 commands: 0.00303983688354 seconds\nTotal time spent compiling C/C++ extensions:  0.0404081344604 seconds.\nrunning install_lib\nrunning install_egg_info\nRemoving /home/jan/sage/sage-5.4/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\nWriting /home/jan/sage/sage-5.4/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\n\nreal\t0m1.531s\nuser\t0m1.112s\nsys\t0m0.240s\n0 jan@osprey:~/sage/sage-5.4/devel$mysage\n----------------------------------------------------------------------\n| Sage Version 5.4, Release Date: 2012-11-09                         |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n----------------------------------------------------------------------\n^[[ALoading Sage library. Current Mercurial branch is: complexbug\nsage: u=1.2; m=0.5; jacobi('sn',u,m)          \n0.887715488619\nsage: jacobi('sn',u+2*I*elliptic_kc(1-m),m)   \njacobi_sn(1.2 + 3.7081493546*I, 0.500000000000000)\nsage: n(jacobi('sn',u+2*I*elliptic_kc(1-m),m))\n\n```\n\n(Hangs, I interrupted it after 30 seconds. Running this calculation directly in maxima takes one second)",
    "created_at": "2012-11-20T15:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56062",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:8" align="right">comment:8</div>

Am I testing this correctly? I don't see any change:

```
0 jan@osprey:~/sage/sage-5.4/devel$hg qpush 
applying trac_7557-maxima_complex_number_conversion.patch
now at: trac_7557-maxima_complex_number_conversion.patch
0 jan@osprey:~/sage/sage-5.4/devel$hg qapplied
trac_7557-maxima_complex_number_conversion.patch
0 jan@osprey:~/sage/sage-5.4/devel$mysage -b complexbug

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Executing 0 commands (using 1 thread)
Time to execute 0 commands: 0.0179660320282 seconds
Finished compiling Cython code (time = 0.490197181702 seconds)
running install
running build
running build_py
running build_ext
Executing 0 commands (using 1 thread)
Time to execute 0 commands: 0.00303983688354 seconds
Total time spent compiling C/C++ extensions:  0.0404081344604 seconds.
running install_lib
running install_egg_info
Removing /home/jan/sage/sage-5.4/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info
Writing /home/jan/sage/sage-5.4/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info

real	0m1.531s
user	0m1.112s
sys	0m0.240s
0 jan@osprey:~/sage/sage-5.4/devel$mysage
----------------------------------------------------------------------
| Sage Version 5.4, Release Date: 2012-11-09                         |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
----------------------------------------------------------------------
^[[ALoading Sage library. Current Mercurial branch is: complexbug
sage: u=1.2; m=0.5; jacobi('sn',u,m)          
0.887715488619
sage: jacobi('sn',u+2*I*elliptic_kc(1-m),m)   
jacobi_sn(1.2 + 3.7081493546*I, 0.500000000000000)
sage: n(jacobi('sn',u+2*I*elliptic_kc(1-m),m))

```

(Hangs, I interrupted it after 30 seconds. Running this calculation directly in maxima takes one second)



---

archive/issue_comments_056063.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYou need the latest Sage version. On Sage-5.5.rc0 + the patch from this ticket I get the following:\n\n```\nsage: u=1.2; m=0.5; jacobi('sn',u,m)\n0.887715488619\nsage: jacobi('sn',u+2*I*elliptic_kc(1-m),m)   \n0.887715488619 - 1.79195288805e-15*I\nsage: n(jacobi('sn',u+2*I*elliptic_kc(1-m),m))\n0.887715488619280 - 1.79195288804672e-15*I\n```\nso it works as it should.",
    "created_at": "2012-11-20T21:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56063",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

You need the latest Sage version. On Sage-5.5.rc0 + the patch from this ticket I get the following:

```
sage: u=1.2; m=0.5; jacobi('sn',u,m)
0.887715488619
sage: jacobi('sn',u+2*I*elliptic_kc(1-m),m)   
0.887715488619 - 1.79195288805e-15*I
sage: n(jacobi('sn',u+2*I*elliptic_kc(1-m),m))
0.887715488619280 - 1.79195288804672e-15*I
```
so it works as it should.



---

archive/issue_comments_056064.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nGreat work, Burcin!",
    "created_at": "2012-11-20T21:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56064",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">comment:10</div>

Great work, Burcin!



---

archive/issue_comments_056065.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe documentation isn't properly formatted:\n\n```\ndocstring of sage.symbolic.expression.Expression.abs:24: WARNING: Literal block expected; none found.\n```",
    "created_at": "2012-12-18T14:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56065",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

The documentation isn't properly formatted:

```
docstring of sage.symbolic.expression.Expression.abs:24: WARNING: Literal block expected; none found.
```



---

archive/issue_events_092867.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-18T14:56:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92867"
}
```



---

archive/issue_events_092868.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-18T14:56:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92868"
}
```



---

archive/issue_comments_056066.json:
```json
{
    "body": "Attachment: **[trac_7557-maxima_complex_number_conversion.2.patch.gz](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)**\n\nUse this patch",
    "created_at": "2012-12-18T15:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56066",
    "user": "https://github.com/kcrisman"
}
```

Attachment: **[trac_7557-maxima_complex_number_conversion.2.patch.gz](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)**

Use this patch



---

archive/issue_comments_056067.json:
```json
{
    "body": "Changed reviewer from **Volker Braun** to **Volker Braun, Karl-Dieter Crisman**",
    "created_at": "2012-12-18T15:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56067",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Volker Braun** to **Volker Braun, Karl-Dieter Crisman**



---

archive/issue_comments_056068.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -46,3 +46,5 @@\n sage: type(u.operands()[0].operands()[0].operands()[1].pyobject())\n <type 'sage.rings.complex_number.ComplexNumber'>\n ```\n+\n+**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)\n``````\n",
    "created_at": "2012-12-18T15:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56068",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -46,3 +46,5 @@
 sage: type(u.operands()[0].operands()[0].operands()[1].pyobject())
 <type 'sage.rings.complex_number.ComplexNumber'>
 ```
+
+**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)
``````




---

archive/issue_events_092869.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-18T15:03:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92869"
}
```



---

archive/issue_events_092870.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-12-18T15:03:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92870"
}
```



---

archive/issue_comments_056069.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think this one should work?\n\nPatchbot, apply trac_7557-maxima_complex_number_conversion.2.patch",
    "created_at": "2012-12-18T15:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56069",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:12" align="right">comment:12</div>

I think this one should work?

Patchbot, apply trac_7557-maxima_complex_number_conversion.2.patch



---

archive/issue_comments_056070.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOn arando (32-bit Linux i686) and possibly all 32-bit systems:\n\n```\nsage -t  --long -force_lib devel/sage/sage/functions/special.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.6.beta1/devel/sage-main/sage/functions/special.py\", line 481:\n    sage: t._maxima_init_(maxima)\nExpected:\n    '0.88771548861927996 - 1.7919528880467190e-15*%i'\nGot:\n    '0.88771548861927740 - 4.3254035228713778e-16*%i'\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.6.beta1/devel/sage-main/sage/functions/special.py\", line 483:\n    sage: t.n()\nExpected:\n    0.887715488619280 - 1.79195288804672e-15*I\nGot:\n    0.887715488619277 - 4.32540352287138e-16*I\n**********************************************************************\n```",
    "created_at": "2012-12-19T21:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56070",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

On arando (32-bit Linux i686) and possibly all 32-bit systems:

```
sage -t  --long -force_lib devel/sage/sage/functions/special.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.6.beta1/devel/sage-main/sage/functions/special.py", line 481:
    sage: t._maxima_init_(maxima)
Expected:
    '0.88771548861927996 - 1.7919528880467190e-15*%i'
Got:
    '0.88771548861927740 - 4.3254035228713778e-16*%i'
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.6.beta1/devel/sage-main/sage/functions/special.py", line 483:
    sage: t.n()
Expected:
    0.887715488619280 - 1.79195288804672e-15*I
Got:
    0.887715488619277 - 4.32540352287138e-16*I
**********************************************************************
```



---

archive/issue_events_092871.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-19T21:12:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92871"
}
```



---

archive/issue_events_092872.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-19T21:12:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92872"
}
```



---

archive/issue_comments_056071.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n*** ping ***\n\nUsing `# abs tol` should fix these.",
    "created_at": "2013-01-10T15:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56071",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

*** ping ***

Using `# abs tol` should fix these.



---

archive/issue_events_092873.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-01-10T16:06:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92873"
}
```



---

archive/issue_events_092874.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-01-10T16:06:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92874"
}
```



---

archive/issue_comments_056072.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks for the reminder Jeroen.",
    "created_at": "2013-01-10T16:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56072",
    "user": "https://github.com/burcin"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks for the reminder Jeroen.



---

archive/issue_comments_056073.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -47,4 +47,4 @@\n <type 'sage.rings.complex_number.ComplexNumber'>\n ```\n \n-**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)\n+**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz), [attachment: trac_7557-fix_doctest_precision.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)\n``````\n",
    "created_at": "2013-01-10T16:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56073",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -47,4 +47,4 @@
 <type 'sage.rings.complex_number.ComplexNumber'>
 ```
 
-**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz)
+**Apply** [attachment: trac_7557-maxima_complex_number_conversion.2.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-maxima_complex_number_conversion.2.patch.gz), [attachment: trac_7557-fix_doctest_precision.patch](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)
``````




---

archive/issue_comments_056074.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI get \n\n```\n\nsage -t  \"devel/sage-main/sage/functions/special.py\"        \n    ... ''', res, 1e-13, 'ab\n    ^\nSyntaxError: invalid syntax\n\n\t [0.2 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage-main/sage/functions/special.py\"\nTotal time for all tests: 0.2 seconds\n```\nNot sure what happened here.  This is on 64-bit, apparently - I get the old answer.",
    "created_at": "2013-01-10T16:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56074",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">comment:16</div>

I get 

```

sage -t  "devel/sage-main/sage/functions/special.py"        
    ... ''', res, 1e-13, 'ab
    ^
SyntaxError: invalid syntax

	 [0.2 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage-main/sage/functions/special.py"
Total time for all tests: 0.2 seconds
```
Not sure what happened here.  This is on 64-bit, apparently - I get the old answer.



---

archive/issue_comments_056075.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHere's the relevant part from the tmp file.\n\n```\n\n        TESTS:\n\n        Check if complex numbers in the arguments are converted to maxima\n        correctly :trac:`7557`::\n\n            >>> t = jacobi('sn',RealNumber('1.2')+Integer(2)*I*elliptic_kc(Integer(1)-RealNumber('.5')),RealNumber('.5'))###line 480:_sage_    >>> t = jacobi($\n            >>> t._maxima_init_(maxima)###line 481:_sage_    >>> t._maxima_init_(maxima)\n            '0.88771548861927...*%i'\n>>> res = Exception\n>>> res =  t.n() # abs tol 1e-13###line 483:_sage_    >>> t.n() # abs tol 1e-13\n>>> check_with_tolerance('''\n...             0.887715488619280 - 1.79195288804672e-15*I\n...         \"\"\"\n... ''', res, 1e-13, 'ab\n>>> sig_on_count()\n0\n\"\"\"\n```\nSo this might be something that only works with a working abs tol, which I may not yet have - is this based on beta3 or beta2?  I haven't compiled beta3 yet since I can't upgrade it ;-)",
    "created_at": "2013-01-10T16:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56075",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:17" align="right">comment:17</div>

Here's the relevant part from the tmp file.

```

        TESTS:

        Check if complex numbers in the arguments are converted to maxima
        correctly :trac:`7557`::

            >>> t = jacobi('sn',RealNumber('1.2')+Integer(2)*I*elliptic_kc(Integer(1)-RealNumber('.5')),RealNumber('.5'))###line 480:_sage_    >>> t = jacobi($
            >>> t._maxima_init_(maxima)###line 481:_sage_    >>> t._maxima_init_(maxima)
            '0.88771548861927...*%i'
>>> res = Exception
>>> res =  t.n() # abs tol 1e-13###line 483:_sage_    >>> t.n() # abs tol 1e-13
>>> check_with_tolerance('''
...             0.887715488619280 - 1.79195288804672e-15*I
...         """
... ''', res, 1e-13, 'ab
>>> sig_on_count()
0
"""
```
So this might be something that only works with a working abs tol, which I may not yet have - is this based on beta3 or beta2?  I haven't compiled beta3 yet since I can't upgrade it ;-)



---

archive/issue_comments_056076.json:
```json
{
    "body": "Attachment: **[trac_7557-fix_doctest_precision.patch.gz](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)**",
    "created_at": "2013-01-11T13:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56076",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_7557-fix_doctest_precision.patch.gz](https://github.com/sagemath/sage/files/ticket7557/trac_7557-fix_doctest_precision.patch.gz)**



---

archive/issue_comments_056077.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@kcrisman](#comment:16):\n> \n> ```\n> \n> sage -t  \"devel/sage-main/sage/functions/special.py\"        \n>     ... ''', res, 1e-13, 'ab\n>     ^\n> SyntaxError: invalid syntax\n> ```\n\nThis seems to be a problem with the `sage-doctest` script. If the triple-quotes immediately follow the doctest result, it generates a temporary file with a syntax error. I cleaned up the patch before submitting, but didn't realize deleting empty lines could cause doctest failures.\n\nI uploaded a new patch with the same name. It should work now.\n\nI don't have time to open a ticket for the `sage-doctest` bug right now.",
    "created_at": "2013-01-11T13:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56077",
    "user": "https://github.com/burcin"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@kcrisman](#comment:16):
> 
> ```
> 
> sage -t  "devel/sage-main/sage/functions/special.py"        
>     ... ''', res, 1e-13, 'ab
>     ^
> SyntaxError: invalid syntax
> ```

This seems to be a problem with the `sage-doctest` script. If the triple-quotes immediately follow the doctest result, it generates a temporary file with a syntax error. I cleaned up the patch before submitting, but didn't realize deleting empty lines could cause doctest failures.

I uploaded a new patch with the same name. It should work now.

I don't have time to open a ticket for the `sage-doctest` bug right now.



---

archive/issue_events_092875.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-11T17:11:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92875"
}
```



---

archive/issue_events_092876.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-11T17:11:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92876"
}
```



---

archive/issue_comments_056078.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSeems fine now, thanks.  I don't have a 32-bit system to test this on, though.\n\nPatchbot, apply trac_7557-maxima_complex_number_conversion.2.patch and trac_7557-fix_doctest_precision.patch",
    "created_at": "2013-01-11T17:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56078",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:19" align="right">comment:19</div>

Seems fine now, thanks.  I don't have a 32-bit system to test this on, though.

Patchbot, apply trac_7557-maxima_complex_number_conversion.2.patch and trac_7557-fix_doctest_precision.patch



---

archive/issue_events_092877.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T08:55:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92877"
}
```



---

archive/issue_events_092878.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T08:55:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92878"
}
```



---

archive/issue_events_092879.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:07:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92879"
}
```



---

archive/issue_events_092880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:07:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/7557#event-92880"
}
```



---

archive/issue_comments_056079.json:
```json
{
    "body": "Merged: **sage-5.7.beta0**",
    "created_at": "2013-01-21T21:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/7557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/7557#issuecomment-56079",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.7.beta0**
