# Issue 30911: MR51: Allow Matplotlib to use system qhull >= 7.2.0

Issue created by migration from https://trac.sagemath.org/ticket/31148

Original creator: galois

Original creation time: 2021-01-02 05:37:26

CC:  slelievre

zlscherr ([`@`zlscherr](https://gitlab.com/zlscherr)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/51:
----

```markdown
My system has qhull 8.0.0 installed.  Because Matplotlib
doesn't know about my system qhull it builds its own version.
This can cause runtime issues with Matplotlib trying to call
the wrong qhull library.  For example, this fixes the error that

./sage -tp 8 --long --warn-long 31.1 --random-seed=0 src/sage/plot/plot3d/list_plot3d.py

produces

QH6249 qh_lib_check: Incorrect qhull library called.  Size of qhT for caller is 2896, but for library is 2792.
QH6256 qh_lib_check: Cannot continue.  Library 'qhull 7.2.0 (2015.2 2016/01/18)' uses a static qhT (e.g., libqhull.so)

if the system has qhull 8.0.0 installed.
```



---

Comment by @zlscherr created at 2021-01-02 05:40:40

Changing priority from major to minor.


---

Comment by @zlscherr created at 2021-01-02 05:40:40

Changing component from PLEASE CHANGE to build.


---

Comment by @zlscherr created at 2021-01-02 05:40:40

Changing type from PLEASE CHANGE to defect.


---

Comment by dimpase created at 2021-01-02 10:05:53

lgtm


---

Comment by dimpase created at 2021-01-02 10:05:53

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-01-02 14:44:27

Full name in Author field please.


---

Comment by slelievre created at 2021-01-02 15:28:08

Thanks!


---

Comment by mkoeppe created at 2021-01-02 18:11:04

The cffi upgrade that is on the ticket should be mentioned in the ticket description


---

Comment by @zlscherr created at 2021-01-02 18:14:56

Oops, that's my fault since I'm still learning about contributing.  That was leftover from the last ticket I submitted as I had merged it into my local develop branch.  Is there an easy way to separate those or should I just submit a new ticket? Sorry about that.


---

Comment by mkoeppe created at 2021-01-02 18:45:46

As the branch is on top of the one of #31128, it's OK to just add that ticket as a dependency. I have just done that.

(Best practice, however, would be to have independent branches for independent tickets.)


---

Comment by @zlscherr created at 2021-01-02 21:51:39

Thanks.

Also, what is best practice for package dependencies? Matplotlib depends on numpy which depends on pkgconfig, which I use in this ticket.  Does that mean I should explicitly add pkgconfig to Matplotlib's dependency file?


---

Comment by mkoeppe created at 2021-01-02 22:31:21

It would be clearer to add it explicitly; 
but it is correct as is because we currently do not use any system Python packages - and hence the indirect dependencies are guaranteed to be present.


---

Comment by dimpase created at 2021-01-02 23:26:17

I just opened #31165 to deal with system-wide qhull.

We should also update our qhull.


---

Comment by vbraun created at 2021-01-31 20:52:40

Resolution: fixed
