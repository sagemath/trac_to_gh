# Issue 28313: DeprecationWarning: invalid escape sequence in docstrings when building with py3

Issue created by migration from https://trac.sagemath.org/ticket/28550

Original creator: strogdon

Original creation time: 2019-10-02 15:42:22

Keywords: python3

This is a follow-up to #28408, #27521 and #26984. Building the html docs for sage-8.9 with python3 I have the following `DeprecationWarnings`:


```
[repl     ] <unknown>:181: DeprecationWarning: invalid escape sequence \)
[repl     ] <unknown>:365: DeprecationWarning: invalid escape sequence \w
[combinat ] <unknown>:265: DeprecationWarning: invalid escape sequence \l
[combinat ] <unknown>:1274: DeprecationWarning: invalid escape sequence \G
```



---

Comment by strogdon created at 2019-10-02 15:44:32

I believe the warnings in `combinat` can be resolved with

```diff
diff --git a/src/sage/combinat/posets/hasse_diagram.py b/src/sage/combinat/posets/hasse_diagram.py
index 02b03e6dbc..69d48fbf43 100644
--- a/src/sage/combinat/posets/hasse_diagram.py
+++ b/src/sage/combinat/posets/hasse_diagram.py
@@ -1231,7 +1231,7 @@ class HasseDiagram(DiGraph):
         return M
 
     def lequal_matrix(self, boolean=False):
-        """
+        r"""
         Return a matrix whose ``(i,j)`` entry is 1 if ``i`` is less
         than ``j`` in the poset, and 0 otherwise; and redefines
         ``__lt__`` to use the boolean version of this matrix.
diff --git a/src/sage/combinat/shifted_primed_tableau.py b/src/sage/combinat/shifted_primed_tableau.py
index 7fac2e48b1..ca76bed033 100644
--- a/src/sage/combinat/shifted_primed_tableau.py
+++ b/src/sage/combinat/shifted_primed_tableau.py
@@ -242,7 +242,7 @@ class ShiftedPrimedTableau(ClonableArray):
             raise ValueError("{} is not an element of Shifted Primed Tableaux".format(self))
 
     def is_standard(self):
-        """
+        r"""
         Return ``True`` if the entries of ``self`` are in bijection with
         positive primed integers `1', 1, 2', \ldots, n`.
```


but I haven't been able to find the source of the warnings in `repl`.


---

Comment by jhpalmieri created at 2019-10-02 23:27:45

Got it! The problem comes from `IPython.core.inputtransformer`, which is imported in `sage.repl.interpreter`. Lines 180-181:

```
def assemble_logical_lines():
    """Join lines following explicit line continuations (\)"""
```

Adding `r` to the start of the triple quotes fixes the problem with `\)`.

Line 365:

```
    cellmagic_help_re = re.compile('%%\w+\?')
```

This is in Python code, so I don't know why it causes any problems, but prefixing this quote with `r` fixes the problem with `\w`.

The bad news is that this file is part of IPython and so is not under our control. The good news is that we should update to a new version of IPython soon (#28197), and presumably these are fixed there. This update may be Python 3 only, but see #28190. In any case, I suggest ignoring these two issues and fixing the two in `combinat`.


---

Comment by strogdon created at 2019-10-03 16:36:47

Changing status from new to needs_review.


---

Comment by strogdon created at 2019-10-03 16:36:47

OK, so the changes have been pushed.
----
New commits:


---

Comment by jhpalmieri created at 2019-10-03 17:25:27

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2019-10-03 17:25:27

Looks good, thanks.


---

Comment by strogdon created at 2019-10-04 19:52:12

Replying to [comment:2 jhpalmieri]:
> Got it! The problem comes from `IPython.core.inputtransformer`, which is imported in `sage.repl.interpreter`. Lines 180-181:
> {{{
> def assemble_logical_lines():
>     """Join lines following explicit line continuations (\)"""
> }}}
> Adding `r` to the start of the triple quotes fixes the problem with `\)`.
> 
> Line 365:
> {{{
>     cellmagic_help_re = re.compile('%%\w+\?')
> }}}
> This is in Python code, so I don't know why it causes any problems, but prefixing this quote with `r` fixes the problem with `\w`.
> 
> The bad news is that this file is part of IPython and so is not under our control. The good news is that we should update to a new version of IPython soon (#28197), and presumably these are fixed there. This update may be Python 3 only, but see #28190. In any case, I suggest ignoring these two issues and fixing the two in `combinat`.

The ipython-7.5.0 that's available on Gentoo has these corrections.


---

Comment by jhpalmieri created at 2019-10-04 20:04:55

Replying to [comment:6 strogdon]:
> The ipython-7.5.0 that's available on Gentoo has these corrections.

That's good to know. Thank you for checking.


---

Comment by vbraun created at 2019-10-06 23:07:04

Resolution: fixed
