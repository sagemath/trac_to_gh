# Issue 20367: failing doctest with coxeter3

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-05-13 12:09:00

CC:  jdemeyer tscrim stumpc5

Needs to solve that

```
File "src/sage/libs/coxeter3/coxeter_group.py", line 44, in sage.libs.coxeter3.coxeter_group.CoxeterGroup.__init__
Failed example:
    TestSuite(CoxeterGroup(['A',2])).run()                    # optional - coxeter3
Expected nothing
...
The following tests failed: _test_codegrees, _test_degrees
```



---

Comment by chapoton created at 2016-05-13 12:12:58

New commits:


---

Comment by chapoton created at 2016-05-13 12:12:58

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2016-05-13 12:21:24

Am I correct that this is tested since it goes into the category `FiniteCoxeterGroups`?

Frédéric, could you remind me where your generic code for the degrees go - couldn't we use that here as well (and for finite Coxeter groups, the codegrees are just two less than the degrees).


---

Comment by chapoton created at 2016-05-13 12:24:10

Failure comes from the absence of the matrix method:

```
    Failure in _test_codegrees:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/categories/finite_complex_reflection_groups.py", line 283, in _test_codegrees
        codegrees = self.codegrees()
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/categories/finite_coxeter_groups.py", line 285, in codegrees
        return tuple(d - 2 for d in self.degrees())
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/categories/finite_coxeter_groups.py", line 259, in degrees
        for I in self.irreducible_component_index_sets()), ())
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/categories/finite_coxeter_groups.py", line 259, in <genexpr>
        for I in self.irreducible_component_index_sets()), ())
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/categories/finite_coxeter_groups.py", line 250, in degrees_of_irreducible_component
        roots = c.matrix().change_ring(QQbar).charpoly().roots()
      File "sage/structure/element.pyx", line 413, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4649)
        return getattr_from_other_class(self, P._abstract_element_class, name)
      File "sage/structure/misc.pyx", line 253, in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1763)
        raise dummy_attribute_error
    AttributeError: 'CoxeterGroup_with_category.element_class' object has no attribute 'matrix'
```

when trying to compute `c.matrix().change_ring(QQbar).charpoly().roots()`


---

Comment by jdemeyer created at 2016-05-13 12:29:28

I didn't mention this, but it my latest patchbot tests on `arando` and `sage4` I installed all doctested optional packages and then I got the above failure.


---

Comment by stumpc5 created at 2016-05-13 12:31:36

I don't seem to be able to test:

```
$ sage-git -i coxeter3
...
Successfully installed coxeter3-1.1
...
sage: from sage.libs.coxeter3.coxeter_group import CoxeterGroup
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
...
ImportError: No module named coxeter
```

I am either fine with this, or we quickly implement the matrices for `Coxeter3` Coxeter groups, if that is easy to be done.


---

Comment by chapoton created at 2016-05-13 12:32:29

I have no time for a better fix. Let us keep that simple.


---

Comment by stumpc5 created at 2016-05-13 12:33:39

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-05-13 12:41:03

Given our policy for opinional doctests, shouldn't this be a blocker?


---

Comment by stumpc5 created at 2016-05-13 12:44:03

I love the term *opinional*!


---

Comment by tscrim created at 2016-05-13 13:00:55

Got to love autocorrect on my phone... *optional* is what I meant of course.


---

Comment by jdemeyer created at 2016-05-13 15:21:40

Replying to [comment:5 stumpc5]:
> I don't seem to be able to test:

Did you forget to run `make`?


---

Comment by stumpc5 created at 2016-05-14 19:38:05

Replying to [comment:11 jdemeyer]:
> Did you forget to run `make`?

works now -- I didn't know that I have to rerun `make` after installing an optional package (or did I possibly by accident forget to run make


---

Comment by tscrim created at 2016-05-15 03:26:53

Replying to [comment:12 stumpc5]:
> Replying to [comment:11 jdemeyer]:
> > Did you forget to run `make`?
> 
> works now -- I didn't know that I have to rerun `make` after installing an optional package (or did I possibly by accident forget to run make 

It is because there are the cython files that need to be compiled, which are only done so when the optional spkg is installed.


---

Comment by jdemeyer created at 2016-05-15 06:43:26

Rule of thumb: you always have to run `make` after changing anything in your Sage installation.


---

Comment by stumpc5 created at 2016-05-15 07:36:32

Replying to [comment:14 jdemeyer]:
> Rule of thumb: you always have to run `make` after changing anything in your Sage installation.

Wouldn't that be good to be added to http://doc.sagemath.org/html/en/reference/misc/sage/misc/package.html ?


---

Comment by tscrim created at 2016-05-15 14:14:21

I'm upgrading this to a 7.2 blocker so all optional doctests pass as per our policy.


---

Comment by tscrim created at 2016-05-15 14:14:21

Changing priority from major to blocker.


---

Comment by vbraun created at 2016-05-15 18:58:41

Resolution: fixed
