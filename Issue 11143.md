# Issue 11143: remove pstricks from default latex preamble

Issue created by migration from Trac.

Original creator: saliola

Original creation time: 2011-05-08 17:34:28

Assignee: jason, was

CC:  jhpalmieri

Keywords: latex

At Sage Days 30 we noticed some problems with trying to ``view`` a
graph using pdflatex on Mac OS X. It seems to be related to having
pstricks loaded as part of the default latex preamble:

```
   ! LaTeX Error: You have run the document with pdflatex, but PSTricks
                  requires latex->dvips->ps2pdf or alternatively the use
                  of the package `auto-pst-pdf'. Then you can run
                    `pdflatex -shell-escape <file>' (TeX Live)
                  or
                    `pdflatex -enable-write18 <file>' (MikTeX).

   See the LaTeX manual or LaTeX Companion for explanation.
   Type  H <return>  for immediate help.
    ...

   l.3 \begin{document}

   ?
```


If you have a Mac, you can test this on the following minimal example.
(I have the latest version of MacTeX installed.)

```
   \documentclass{article}
   \usepackage{pstricks}
   \begin{document}
   \begin{center}{\Large\bf SAGE}\end{center}
   \end{document}
```


This causes the following example to fail:

```
   sage: g = sage.misc.latex.latex_examples.graph()
   sage: latex.add_to_preamble(r"\usepackage{tkz-graph}")
   sage: view(g, pdflatex=True, tightpage=True)
   ...
   Latex error
```


But it works if we remove pstricks from LATEX_HEADER:

```
   sage: LATEX_HEADER = sage.misc.latex.LATEX_HEADER
   sage: sage.misc.latex.LATEX_HEADER = LATEX_HEADER.replace(r"\usepackage{pstricks}","")
   sage: view(g, pdflatex=True, tightpage=True)
```


So, we should remove pstricks from the default
latex preamble.


---

Comment by saliola created at 2011-05-08 17:44:21

Changing status from new to needs_review.


---

Attachment

I modified the `_repr_` method of the pstricks example to explain that one needs to add the pstricks package to the preamble. This is consistent with how things are done in the other `sage.misc.latex.latex_examples`.

I also fixed things so that there is a line break following every usepackage in the preamble:


```
sage: print sage.misc.latex.COMMON_HEADER
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{graphicx}
\pagestyle{empty}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

sage: print sage.misc.latex.LATEX_HEADER
\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{graphicx}
\pagestyle{empty}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\oddsidemargin 0.0in
\evensidemargin 0.0in
\textwidth 6.45in
\topmargin 0.0in
\headheight 0.0in
\headsep 0.0in
\textheight 9.0in

sage: print sage.misc.latex.SLIDE_HEADER
\documentclass[a0,8pt]{beamer}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{graphicx}
\pagestyle{empty}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\textwidth=1.1\textwidth
\textheight=2\textheight
```



---

Comment by saliola created at 2011-05-08 18:29:35

Changing keywords from "latex" to "latex, days30".


---

Comment by rbeezer created at 2011-05-08 20:38:47

Thanks, Franco.  This patch looks good to me, in principle.  But I'm traveling and am not really in a position to fully test, so will not be able to do a review for a while.

Rob


---

Comment by jhpalmieri created at 2011-05-10 17:15:03

Looks good to me, fixes the problem, and passes all tests.  I still think we should get rid of "\\usepackage{graphicx}" as well, but that can happen another time.


---

Comment by jhpalmieri created at 2011-05-10 17:15:03

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-05-25 12:53:32

Resolution: fixed
