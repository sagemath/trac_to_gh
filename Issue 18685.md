# Issue 18685: Speedup creation of spin crystals

Issue created by migration from https://trac.sagemath.org/ticket/18922

Original creator: tscrim

Original creation time: 2015-07-19 12:55:54

Assignee: sage-combinat

CC:  sage-combinat aschilling

Keywords: spin crystals

Currently, when we construct a spin crystal, we build the full digraph to implement a comparison operation. This ticket, in effect, makes constructing the digraph a lazy attribute which gets called when doing the comparison operation.


---

Comment by tscrim created at 2015-07-19 13:01:01

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-07-19 13:01:01

I also did some cleanup:

- I removed the caching of the elements since the e/f operations aren't cached (which I think is where the real speed gains are) and it was a hack IMO.

- I removed the `list` command because that (and the respective caching) is done by `FiniteEnumeratedSets` (and will result in a speedup for iteration after calling `.list()` once).
----
New commits:


---

Comment by aschilling created at 2015-07-21 11:35:40

Instead of deleting the tests for the methods that you removed, it would be better if they would be moved (perhaps as tests for the class). Also, could you provide timings and an example where this was a problem before?

Thanks,

Anne


---

Comment by tscrim created at 2015-07-21 13:49:01

The `.list()` test is already in the function which creates the B<sub>n</sub> spin crystal object, so I just added back the element construction example to the `_element_constructor_` and added a test to check for consistency. Here are my timings.

With branch:

```
sage: %time C = crystals.SpinsPlus(['D',6])
CPU times: user 472 µs, sys: 58 µs, total: 530 µs
Wall time: 542 µs
sage: %time C = crystals.SpinsPlus(['D',7])
CPU times: user 453 µs, sys: 56 µs, total: 509 µs
Wall time: 523 µs
sage: %time C = crystals.SpinsMinus(['D',8])
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 956 µs
sage: %time C = crystals.Spins(['B',10])
CPU times: user 488 µs, sys: 56 µs, total: 544 µs
Wall time: 490 µs
```

Before:

```
sage: %time C = crystals.SpinsPlus(['D',6])
CPU times: user 465 ms, sys: 69.7 ms, total: 535 ms
Wall time: 549 ms
sage: %time C = crystals.SpinsPlus(['D',7])
CPU times: user 52 ms, sys: 12.7 ms, total: 64.7 ms
Wall time: 58.6 ms
sage: %time C = crystals.SpinsMinus(['D',8])
CPU times: user 223 ms, sys: 20.6 ms, total: 244 ms
Wall time: 228 ms
sage: %time C = crystals.Spins(['B',10])
I got tired after waiting for 10 minutes and killed it and then ran this:
sage: %time C = crystals.Spins(['B',8])
CPU times: user 2.59 s, sys: 24 ms, total: 2.61 s
Wall time: 2.58 s
```



---

Comment by git created at 2015-07-21 13:49:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-05 16:52:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2015-08-06 17:02:03

Ok, looks good!


---

Comment by aschilling created at 2015-08-06 17:02:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-08-07 07:31:32

Resolution: fixed
