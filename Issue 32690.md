# Issue 32690: pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional

archive/issues_032690.json:
```json
{
    "body": "CC:  @kiwifb @jhpalmieri\n\n... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/32927\n\n",
    "created_at": "2021-11-24T07:09:16Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32690",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kiwifb @jhpalmieri

... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).

Issue created by migration from https://trac.sagemath.org/ticket/32927





---

archive/issue_comments_465829.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465829",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465830.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465830",
    "user": "https://github.com/mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_465831.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465831",
    "user": "https://github.com/mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_comments_465832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465834.json:
```json
{
    "body": "Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.",
    "created_at": "2022-02-06T23:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465834",
    "user": "https://github.com/kiwifb"
}
```

Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.



---

archive/issue_comments_465835.json:
```json
{
    "body": "No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`",
    "created_at": "2022-02-07T00:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465835",
    "user": "https://github.com/mkoeppe"
}
```

No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`



---

archive/issue_comments_465836.json:
```json
{
    "body": "I think that may be best. But I must say so far I am a bit confused. I do not see where that \"install-cleaner\" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?",
    "created_at": "2022-02-07T00:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465836",
    "user": "https://github.com/kiwifb"
}
```

I think that may be best. But I must say so far I am a bit confused. I do not see where that "install-cleaner" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?



---

archive/issue_comments_465837.json:
```json
{
    "body": "It's invoked by `build/pkgs/sagelib/spkg-install`",
    "created_at": "2022-02-07T00:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465837",
    "user": "https://github.com/mkoeppe"
}
```

It's invoked by `build/pkgs/sagelib/spkg-install`



---

archive/issue_comments_465838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T02:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465839.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-07T03:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465839",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_465840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T03:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465841.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> It's invoked by `build/pkgs/sagelib/spkg-install`\n\nOh yes I see. Like it says, that's not a bit I am usually concerned with downstream.",
    "created_at": "2022-02-07T04:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465841",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:17 mkoeppe]:
> It's invoked by `build/pkgs/sagelib/spkg-install`

Oh yes I see. Like it says, that's not a bit I am usually concerned with downstream.



---

archive/issue_comments_465842.json:
```json
{
    "body": "Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.",
    "created_at": "2022-02-07T04:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465842",
    "user": "https://github.com/mkoeppe"
}
```

Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.



---

archive/issue_comments_465843.json:
```json
{
    "body": "If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.",
    "created_at": "2022-02-07T04:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465843",
    "user": "https://github.com/kiwifb"
}
```

If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.



---

archive/issue_comments_465844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-09T21:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465845.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-12T02:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465846.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-12T20:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465847.json:
```json
{
    "body": "Not needed with #32874",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465847",
    "user": "https://github.com/mkoeppe"
}
```

Not needed with #32874



---

archive/issue_comments_465848.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465848",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_465849.json:
```json
{
    "body": "Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:\n\nWould `setup install` work when optional distributions that contain namespace packages were installed?\n\nWould `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?\n\nIf answers to both are yes, then the branch of this ticket could be an alternative to #32874?",
    "created_at": "2022-10-14T04:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465849",
    "user": "https://github.com/kwankyu"
}
```

Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:

Would `setup install` work when optional distributions that contain namespace packages were installed?

Would `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?

If answers to both are yes, then the branch of this ticket could be an alternative to #32874?



---

archive/issue_comments_465850.json:
```json
{
    "body": "Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.",
    "created_at": "2022-10-14T23:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465850",
    "user": "https://github.com/mkoeppe"
}
```

Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.



---

archive/issue_comments_465851.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465851",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_465852.json:
```json
{
    "body": "Okay. Thanks.",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465852",
    "user": "https://github.com/kwankyu"
}
```

Okay. Thanks.



---

archive/issue_comments_465853.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-11-14T19:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-465853",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
