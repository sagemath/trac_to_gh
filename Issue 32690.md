# Issue 32690: pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional

archive/issues_032690.json:
```json
{
    "body": "CC:  fbissey jhpalmieri\n\n... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/32927\n\n",
    "created_at": "2021-11-24T07:09:16Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32690",
    "user": "mkoeppe"
}
```
CC:  fbissey jhpalmieri

... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).

Issue created by migration from https://trac.sagemath.org/ticket/32927





---

archive/issue_comments_466397.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466397",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_466398.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-11-27T21:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466398",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_466399.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466399",
    "user": "mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_comments_466400.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466400",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466401.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-23T06:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466401",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466402.json:
```json
{
    "body": "Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.",
    "created_at": "2022-02-06T23:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466402",
    "user": "fbissey"
}
```

Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.



---

archive/issue_comments_466403.json:
```json
{
    "body": "No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`",
    "created_at": "2022-02-07T00:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466403",
    "user": "mkoeppe"
}
```

No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`



---

archive/issue_comments_466404.json:
```json
{
    "body": "I think that may be best. But I must say so far I am a bit confused. I do not see where that \"install-cleaner\" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?",
    "created_at": "2022-02-07T00:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466404",
    "user": "fbissey"
}
```

I think that may be best. But I must say so far I am a bit confused. I do not see where that "install-cleaner" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?



---

archive/issue_comments_466405.json:
```json
{
    "body": "It's invoked by `build/pkgs/sagelib/spkg-install`",
    "created_at": "2022-02-07T00:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466405",
    "user": "mkoeppe"
}
```

It's invoked by `build/pkgs/sagelib/spkg-install`



---

archive/issue_comments_466406.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T02:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466406",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466407.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-07T03:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466407",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_466408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-07T03:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466408",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466409.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> It's invoked by `build/pkgs/sagelib/spkg-install`\n\nOh yes I see. Like it says, that's not a bit I am usually concerned with downstream.",
    "created_at": "2022-02-07T04:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466409",
    "user": "fbissey"
}
```

Replying to [comment:17 mkoeppe]:
> It's invoked by `build/pkgs/sagelib/spkg-install`

Oh yes I see. Like it says, that's not a bit I am usually concerned with downstream.



---

archive/issue_comments_466410.json:
```json
{
    "body": "Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.",
    "created_at": "2022-02-07T04:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466410",
    "user": "mkoeppe"
}
```

Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.



---

archive/issue_comments_466411.json:
```json
{
    "body": "If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.",
    "created_at": "2022-02-07T04:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466411",
    "user": "fbissey"
}
```

If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.



---

archive/issue_comments_466412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-09T21:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466412",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_466413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-12T02:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-12T20:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466414",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_466415.json:
```json
{
    "body": "Not needed with #32874",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466415",
    "user": "mkoeppe"
}
```

Not needed with #32874



---

archive/issue_comments_466416.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-26T05:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466416",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_466417.json:
```json
{
    "body": "Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:\n\nWould `setup install` work when optional distributions that contain namespace packages were installed?\n\nWould `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?\n\nIf answers to both are yes, then the branch of this ticket could be an alternative to #32874?",
    "created_at": "2022-10-14T04:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466417",
    "user": "klee"
}
```

Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:

Would `setup install` work when optional distributions that contain namespace packages were installed?

Would `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?

If answers to both are yes, then the branch of this ticket could be an alternative to #32874?



---

archive/issue_comments_466418.json:
```json
{
    "body": "Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.",
    "created_at": "2022-10-14T23:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466418",
    "user": "mkoeppe"
}
```

Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.



---

archive/issue_comments_466419.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466419",
    "user": "klee"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_466420.json:
```json
{
    "body": "Okay. Thanks.",
    "created_at": "2022-10-15T02:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466420",
    "user": "klee"
}
```

Okay. Thanks.



---

archive/issue_comments_466421.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-11-14T19:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32690#issuecomment-466421",
    "user": "mkoeppe"
}
```

Resolution: invalid
