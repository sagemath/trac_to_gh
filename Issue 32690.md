# Issue 32690: pkgs/sagemath-standard/setup.py: Move distributions logic to a new package sagemath-optional

Issue created by migration from https://trac.sagemath.org/ticket/32927

Original creator: mkoeppe

Original creation time: 2021-11-24 07:09:16

CC:  fbissey jhpalmieri

... which generates `install-requires` on `setup.py egg_info` (or `prepare_metadata_for_build_wheel`/`prepare_metadata_for_build_editable`).


---

Comment by mkoeppe created at 2021-11-27 21:41:20

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-11-27 21:41:20

Last 10 new commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by git created at 2022-01-23 06:08:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-23 06:14:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-02-06 23:45:27

Is this installing a nested package? The kind of stuff that we finally ditched with R/rpy a few years ago.


---

Comment by mkoeppe created at 2022-02-07 00:04:29

No, the distribution in `build/pkgs/sagelib/install-cleaner/` does not install anything and is not nested in anything. If it's clearer, I can also move it to `pkgs/install-cleaner/`


---

Comment by fbissey created at 2022-02-07 00:11:33

I think that may be best. But I must say so far I am a bit confused. I do not see where that "install-cleaner" is ever used. Is it just functionality you are keeping in reserve for now or for a dependent ticket?


---

Comment by mkoeppe created at 2022-02-07 00:13:09

It's invoked by `build/pkgs/sagelib/spkg-install`


---

Comment by git created at 2022-02-07 02:58:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-07 03:05:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-02-07 03:25:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-02-07 04:36:10

Replying to [comment:17 mkoeppe]:
> It's invoked by `build/pkgs/sagelib/spkg-install`

Oh yes I see. Like it says, that's not a bit I am usually concerned with downstream.


---

Comment by mkoeppe created at 2022-02-07 04:38:04

Yes, the only effect of this ticket on downstream packaging is that sagemath-standard's `setup.py` no longer does weird things with `site-packages`.


---

Comment by fbissey created at 2022-02-07 04:41:33

If I was doing a bit of archeology on the sage-on-gentoo repo I think I would find bits where I suppressed some of that clean up. I seem to have let go of that part recently.


---

Comment by git created at 2022-06-09 21:28:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-06-12 02:07:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-12 20:01:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-09-26 05:54:41

Not needed with #32874


---

Comment by mkoeppe created at 2022-09-26 05:54:41

Changing status from needs_work to needs_review.


---

Comment by klee created at 2022-10-14 04:17:00

Before we close this ticket, to clarify why this approach was abandoned, let me ask a couple of questions:

Would `setup install` work when optional distributions that contain namespace packages were installed?

Would `legacy-install-cleaner` work when optional distributions that contain namespace packages were installed?

If answers to both are yes, then the branch of this ticket could be an alternative to #32874?


---

Comment by mkoeppe created at 2022-10-14 23:26:39

Well, the branch here would have been a temporary solution, good enough until external packages arrive that fill the namespace `sage.*` and are maintained out of tree. Then #30152 would have been the next step, but I did not have an implementation strategy for it.


---

Comment by klee created at 2022-10-15 02:45:10

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-10-15 02:45:10

Okay. Thanks.


---

Comment by mkoeppe created at 2022-11-14 19:36:43

Resolution: invalid
