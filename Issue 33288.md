# Issue 33288: modernize coercion in monsky_washnitzer.py

Issue created by migration from https://trac.sagemath.org/ticket/33525

Original creator: chapoton

Original creation time: 2022-03-18 15:25:02

CC:  vdelecroix tscrim

to help for #33497


---

Comment by chapoton created at 2022-03-18 15:25:09

Changing status from new to needs_review.


---

Comment by git created at 2022-03-18 15:34:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-18 15:34:46

there remains one little failing doctest..


---

Comment by tscrim created at 2022-03-18 23:36:46

That doctest will not pass in the current implementation (and I am not sure it should) as `B = Z[‘t’]` and `R._poly_ring == Z[‘T’]`, where `Z = Integers(125)` and we do not allow coercion between polynomial rings with different variable names IIRC. I don’t see an equivalent doctest in the old code. Why should this doctest work? I would have expected it to be from `Z`.

Some comments for possible optimizations for general modernization (feel free to push them to a followup ticket, which I can do):

- In `_mul_`, it will never be the case that the first check is true by the coercion framework. I also believe the `todo` with the recast is also a no-op and can be removed once the cast is done in the parent.
- If a matrix is hard-coded and then an inverse taken, why don’t we just hard-code the inverse?
- `__repr__` to `_repr_` in the parent.
- `gens()` should return a tuple and it can be cached. Although, IIRC, this is taken care of automatically if `gen()` is implemented instead. (It’s better to use `zero()` and `one()` there as well.)
- Why not make `create_element()` an alias of `_element_constructor_()`?
- ``@`cached_method` the `one()`.
- I know I would appreciate having those long output lines broken over multiple lines, but that is very cosmetic.
- Cythonize the element.
- Use `_poly_ring` instead of `poly_ring()` in the element `__init__` check.
- I don’ think we need the Python2 compatibility `__nonzero__ = __bool__` alias.
- Indentation levels on various `INPUT:` bullet points.


---

Comment by git created at 2022-03-19 07:58:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-19 08:06:51

Concerning the coercion test, it seems strange to me that the variable "T" is hardcoded.

About your suggestions, I did what I could. Maybe one can keep the rest for another ticket.


---

Comment by git created at 2022-03-19 08:37:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-03-19 08:38:26

Thank you.

Having the variable `T` being hard coded is mildly strange, but that variable is unrelated to the variable for the univariate polynomial that defines the quotient. In the examples, it gets changed from `t` to `x`. Perhaps then the thing to do is to check that either it coerces into the base ring (of `_poly_ring`) or it is a univariate polynomial ring that whose base ring coerces into the base ring?


---

Comment by git created at 2022-03-19 09:17:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-19 10:25:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-03-19 12:38:40

so we have a green bot. Good enough ?


---

Comment by tscrim created at 2022-03-19 14:08:54

Yes, thank you.


---

Comment by tscrim created at 2022-03-19 14:08:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-03-27 15:43:34

Resolution: fixed
