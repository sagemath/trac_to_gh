# Issue 33288: modernize coercion in monsky_washnitzer.py

archive/issues_033288.json:
```json
{
    "body": "CC:  @videlec @tscrim\n\nto help for #33497\n\nIssue created by migration from https://trac.sagemath.org/ticket/33525\n\n",
    "closed_at": "2022-03-27T15:43:34Z",
    "created_at": "2022-03-18T15:25:02Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "modernize coercion in monsky_washnitzer.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33288",
    "user": "https://github.com/fchapoton"
}
```
CC:  @videlec @tscrim

to help for #33497

Issue created by migration from https://trac.sagemath.org/ticket/33525





---

archive/issue_comments_473317.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-18T15:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473317",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_473318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-18T15:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473319.json:
```json
{
    "body": "there remains one little failing doctest..",
    "created_at": "2022-03-18T15:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473319",
    "user": "https://github.com/fchapoton"
}
```

there remains one little failing doctest..



---

archive/issue_comments_473320.json:
```json
{
    "body": "That doctest will not pass in the current implementation (and I am not sure it should) as `B = Z[\u2018t\u2019]` and `R._poly_ring == Z[\u2018T\u2019]`, where `Z = Integers(125)` and we do not allow coercion between polynomial rings with different variable names IIRC. I don\u2019t see an equivalent doctest in the old code. Why should this doctest work? I would have expected it to be from `Z`.\n\nSome comments for possible optimizations for general modernization (feel free to push them to a followup ticket, which I can do):\n\n- In `_mul_`, it will never be the case that the first check is true by the coercion framework. I also believe the `todo` with the recast is also a no-op and can be removed once the cast is done in the parent.\n- If a matrix is hard-coded and then an inverse taken, why don\u2019t we just hard-code the inverse?\n- `__repr__` to `_repr_` in the parent.\n- `gens()` should return a tuple and it can be cached. Although, IIRC, this is taken care of automatically if `gen()` is implemented instead. (It\u2019s better to use `zero()` and `one()` there as well.)\n- Why not make `create_element()` an alias of `_element_constructor_()`?\n- ``@`cached_method` the `one()`.\n- I know I would appreciate having those long output lines broken over multiple lines, but that is very cosmetic.\n- Cythonize the element.\n- Use `_poly_ring` instead of `poly_ring()` in the element `__init__` check.\n- I don\u2019 think we need the Python2 compatibility `__nonzero__ = __bool__` alias.\n- Indentation levels on various `INPUT:` bullet points.",
    "created_at": "2022-03-18T23:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473320",
    "user": "https://github.com/tscrim"
}
```

That doctest will not pass in the current implementation (and I am not sure it should) as `B = Z[‘t’]` and `R._poly_ring == Z[‘T’]`, where `Z = Integers(125)` and we do not allow coercion between polynomial rings with different variable names IIRC. I don’t see an equivalent doctest in the old code. Why should this doctest work? I would have expected it to be from `Z`.

Some comments for possible optimizations for general modernization (feel free to push them to a followup ticket, which I can do):

- In `_mul_`, it will never be the case that the first check is true by the coercion framework. I also believe the `todo` with the recast is also a no-op and can be removed once the cast is done in the parent.
- If a matrix is hard-coded and then an inverse taken, why don’t we just hard-code the inverse?
- `__repr__` to `_repr_` in the parent.
- `gens()` should return a tuple and it can be cached. Although, IIRC, this is taken care of automatically if `gen()` is implemented instead. (It’s better to use `zero()` and `one()` there as well.)
- Why not make `create_element()` an alias of `_element_constructor_()`?
- ``@`cached_method` the `one()`.
- I know I would appreciate having those long output lines broken over multiple lines, but that is very cosmetic.
- Cythonize the element.
- Use `_poly_ring` instead of `poly_ring()` in the element `__init__` check.
- I don’ think we need the Python2 compatibility `__nonzero__ = __bool__` alias.
- Indentation levels on various `INPUT:` bullet points.



---

archive/issue_comments_473321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-19T07:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473322.json:
```json
{
    "body": "Concerning the coercion test, it seems strange to me that the variable \"T\" is hardcoded.\n\nAbout your suggestions, I did what I could. Maybe one can keep the rest for another ticket.",
    "created_at": "2022-03-19T08:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473322",
    "user": "https://github.com/fchapoton"
}
```

Concerning the coercion test, it seems strange to me that the variable "T" is hardcoded.

About your suggestions, I did what I could. Maybe one can keep the rest for another ticket.



---

archive/issue_comments_473323.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-19T08:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473324.json:
```json
{
    "body": "Thank you.\n\nHaving the variable `T` being hard coded is mildly strange, but that variable is unrelated to the variable for the univariate polynomial that defines the quotient. In the examples, it gets changed from `t` to `x`. Perhaps then the thing to do is to check that either it coerces into the base ring (of `_poly_ring`) or it is a univariate polynomial ring that whose base ring coerces into the base ring?",
    "created_at": "2022-03-19T08:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473324",
    "user": "https://github.com/tscrim"
}
```

Thank you.

Having the variable `T` being hard coded is mildly strange, but that variable is unrelated to the variable for the univariate polynomial that defines the quotient. In the examples, it gets changed from `t` to `x`. Perhaps then the thing to do is to check that either it coerces into the base ring (of `_poly_ring`) or it is a univariate polynomial ring that whose base ring coerces into the base ring?



---

archive/issue_comments_473325.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-19T09:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-19T10:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_473327.json:
```json
{
    "body": "so we have a green bot. Good enough ?",
    "created_at": "2022-03-19T12:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473327",
    "user": "https://github.com/fchapoton"
}
```

so we have a green bot. Good enough ?



---

archive/issue_comments_473328.json:
```json
{
    "body": "Yes, thank you.",
    "created_at": "2022-03-19T14:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473328",
    "user": "https://github.com/tscrim"
}
```

Yes, thank you.



---

archive/issue_comments_473329.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-19T14:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473329",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_088270.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-27T15:43:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33288#event-88270"
}
```



---

archive/issue_comments_473330.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33288#issuecomment-473330",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
