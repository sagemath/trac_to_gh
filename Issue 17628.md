# Issue 17628: get rid of _native_coercion_ranks_inv and _native_coercion_ranks

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2015-02-26 22:30:46

In the file `sage/structure/coerce.pyx` there is an homemade coercion for python numeric objects (i.e. `bool -> int -> long -> float -> complex`). Instead we should use the ready made python function `coerce`. Or even use the [PyNumber_Coerce](https://docs.python.org/2/c-api/number.html#c.PyNumber_Coerce) function from the C API.


---

Comment by vdelecroix created at 2015-02-27 13:03:42

Last 10 new commits:


---

Comment by vdelecroix created at 2015-02-27 13:03:42

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-02-27 13:07:36

The new solution looks twice faster from Python

Old timings:

```
sage: cm = sage.structure.element.get_coercion_model()
sage: %timeit cm.canonical_coercion(1r,2.r)
1000000 loops, best of 3: 520 ns per loop
sage: %timeit cm.canonical_coercion(1r,complex(1r,1r))
1000000 loops, best of 3: 812 ns per loop
```


New timings

```
sage: cm = sage.structure.element.get_coercion_model()
sage: %timeit cm.canonical_coercion(1r,2.r)
1000000 loops, best of 3: 234 ns per loop
sage: %timeit cm.canonical_coercion(1r,complex(1r,1r))
1000000 loops, best of 3: 469 ns per loop
```



---

Comment by vdelecroix created at 2015-02-28 11:56:36

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-02-28 11:56:36

conflicts with #17862 and there is a reference counting issue...


---

Comment by vdelecroix created at 2015-03-28 12:07:03

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-03-28 12:07:03

Hello,

I propose to close this one as duplicate because I found a much better solution in #18076.

Vincent


---

Comment by jdemeyer created at 2015-04-02 16:04:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-02 22:27:27

Resolution: duplicate
