# Issue 16403: Graphics3d.show abuses graphics_filename

archive/issues_016403.json:
```json
{
    "body": "Code in [sage/plot/plot3d/base.pyx](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/plot/plot3d/base.pyx?id=6.3.beta1#n1131) in the method `Graphics3d.show()` makes invalid use of `graphics_filename`: it generates a name (like `sage0.png`), then strips the extension and appends various other extensions during the course of the method. But `graphics_filename` makes no guarantees that these other file names will be unused. In fact chances are pretty good that these files already exist from a different run of that method inside the same cell. So we get clashes there. Perhaps if things change in other places we might even get a security issue due to a race condition here.\n\nI can think of two possible approaches: either call `graphics_filename` in several places, once for every file name we need to generate. Or create a temporary directory and write all files inside that with fixed names. The former will likely be easier to handle for notebook, but may make the code harder to read. Particularly those cases where some tool will use one file name to derive another file name might be a real pain, like when the applet size is encoded in the file name, or the magic aroud the `archive_name` for jmol. Will need some good interactive testing to make sure that everything still works after these changes.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16640\n\n",
    "created_at": "2014-07-10T06:59:14Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Graphics3d.show abuses graphics_filename",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16403",
    "user": "https://github.com/gagern"
}
```
Code in [sage/plot/plot3d/base.pyx](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/plot/plot3d/base.pyx?id=6.3.beta1#n1131) in the method `Graphics3d.show()` makes invalid use of `graphics_filename`: it generates a name (like `sage0.png`), then strips the extension and appends various other extensions during the course of the method. But `graphics_filename` makes no guarantees that these other file names will be unused. In fact chances are pretty good that these files already exist from a different run of that method inside the same cell. So we get clashes there. Perhaps if things change in other places we might even get a security issue due to a race condition here.

I can think of two possible approaches: either call `graphics_filename` in several places, once for every file name we need to generate. Or create a temporary directory and write all files inside that with fixed names. The former will likely be easier to handle for notebook, but may make the code harder to read. Particularly those cases where some tool will use one file name to derive another file name might be a real pain, like when the applet size is encoded in the file name, or the magic aroud the `archive_name` for jmol. Will need some good interactive testing to make sure that everything still works after these changes.

Issue created by migration from https://trac.sagemath.org/ticket/16640





---

archive/issue_comments_215117.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-11T21:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215117",
    "user": "https://github.com/gagern"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_215118.json:
```json
{
    "body": "Note that only the last two commits are new for this ticket; the rest comes from #16645 and its dependencies.\n\nI tested things both in notebook and interactively. java3d failed in both cases, for which I just filed #16647. Apart from that, everything looks fine. In particular it seems as if I got all the file name interdependencies for jmol right.\n\n---\nNew commits:",
    "created_at": "2014-07-11T21:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215118",
    "user": "https://github.com/gagern"
}
```

Note that only the last two commits are new for this ticket; the rest comes from #16645 and its dependencies.

I tested things both in notebook and interactively. java3d failed in both cases, for which I just filed #16647. Apart from that, everything looks fine. In particular it seems as if I got all the file name interdependencies for jmol right.

---
New commits:



---

archive/issue_comments_215119.json:
```json
{
    "body": "[These are the changes](http://git.sagemath.org/sage.git/diff/?h=u/gagern/ticket/16640&id2=bb7307f0649cfa90916f74c102d1d09a424b759a) that need reviewing in this ticket here.",
    "created_at": "2014-07-11T21:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215119",
    "user": "https://github.com/gagern"
}
```

[These are the changes](http://git.sagemath.org/sage.git/diff/?h=u/gagern/ticket/16640&id2=bb7307f0649cfa90916f74c102d1d09a424b759a) that need reviewing in this ticket here.



---

archive/issue_events_048803.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16403#event-48803"
}
```



---

archive/issue_comments_215120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-05T07:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_215121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-05T07:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_215122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-11T20:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215123.json:
```json
{
    "body": "Merged with 6.4.beta4 and added some fixes. Please review.",
    "created_at": "2014-10-11T20:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215123",
    "user": "https://github.com/jdemeyer"
}
```

Merged with 6.4.beta4 and added some fixes. Please review.



---

archive/issue_comments_215124.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-11T21:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215125.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-30T16:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215125",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215126.json:
```json
{
    "body": "Hi Jeroen: Your first two commits are fine, as is the first commit of Martin's.  (Currently looking at his main, second one.)  How much slower did the doctests become without your last commit?  (Martin, if you see this, what was your thinking on changing the doctest mode?)",
    "created_at": "2014-10-31T01:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215126",
    "user": "https://github.com/kcrisman"
}
```

Hi Jeroen: Your first two commits are fine, as is the first commit of Martin's.  (Currently looking at his main, second one.)  How much slower did the doctests become without your last commit?  (Martin, if you see this, what was your thinking on changing the doctest mode?)



---

archive/issue_comments_215127.json:
```json
{
    "body": "Hi, sorry I didn't respond to the commits by Jeroen any sooner.\n\nReplying to [comment:13 kcrisman]:\n> Hi Jeroen: Your first two commits are fine,\n\n\nI agree. Thanks a lot!\n\n> (Martin, if you see this, what was your thinking on changing the doctest mode?)\n\n\nMy main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users. My reson for including it in doctests is simply because all the other possible viewers are active in doctest mode as well. There is a doctest specifically for the canvas3d case, but if I restrict canvas3d to embedded mode only, that one would fail. So staying in line with all the other tests seemed the reasonable thing to do.\n\nIf things really are too slow, I'd change that to\n`if viewer == 'canvas3d' and (DOCTEST_MODE or EMBEDDED_MODE):`\nso we can have that one explicit doctest nevertheless. But first I'd like to quantify that effect on test execution time, and right now I have a build problem.",
    "created_at": "2014-10-31T07:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215127",
    "user": "https://github.com/gagern"
}
```

Hi, sorry I didn't respond to the commits by Jeroen any sooner.

Replying to [comment:13 kcrisman]:
> Hi Jeroen: Your first two commits are fine,


I agree. Thanks a lot!

> (Martin, if you see this, what was your thinking on changing the doctest mode?)


My main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users. My reson for including it in doctests is simply because all the other possible viewers are active in doctest mode as well. There is a doctest specifically for the canvas3d case, but if I restrict canvas3d to embedded mode only, that one would fail. So staying in line with all the other tests seemed the reasonable thing to do.

If things really are too slow, I'd change that to
`if viewer == 'canvas3d' and (DOCTEST_MODE or EMBEDDED_MODE):`
so we can have that one explicit doctest nevertheless. But first I'd like to quantify that effect on test execution time, and right now I have a build problem.



---

archive/issue_comments_215128.json:
```json
{
    "body": "Always doing `canvas3d` is really too slow, I remember one file(!) taking over 1000s to doctest.",
    "created_at": "2014-10-31T08:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215128",
    "user": "https://github.com/jdemeyer"
}
```

Always doing `canvas3d` is really too slow, I remember one file(!) taking over 1000s to doctest.



---

archive/issue_comments_215129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-31T08:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215130.json:
```json
{
    "body": "Replying to [comment:14 gagern]:\n> My main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users.\n\nFixed by raising a suitable exception.",
    "created_at": "2014-10-31T08:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215130",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 gagern]:
> My main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users.

Fixed by raising a suitable exception.



---

archive/issue_comments_215131.json:
```json
{
    "body": "> > My main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users.\n\n> Fixed by raising a suitable exception.\nThat was something we needed a while ago anyway!  Thanks.",
    "created_at": "2014-10-31T12:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215131",
    "user": "https://github.com/kcrisman"
}
```

> > My main reason for modifying that line at all was the fact that canvas3d only works in embedded mode, so having it available otherwise might confuse users.

> Fixed by raising a suitable exception.
That was something we needed a while ago anyway!  Thanks.



---

archive/issue_comments_215132.json:
```json
{
    "body": "Here is something minor but still needing attention. The documentation says\n\n```\n        -  ``filename`` -- string (default: a temp file); file\n           to save the image to\n```\nbut of course this is now only going to be true in the command line.  Which probably makes sense.  But this should be noted.  Similarly,\n\n```\n        # Tachyon resolution options\n```\nshould probably just add a quick note that \"mode defaults\" also are being set in the next few lines.\n\nInterestingly,\n\n```\n            # Temporary hack: encode the desired applet size in the end of the filename:\n            # (This will be removed once we have dynamic resizing of applets in the browser.)\n```\nand the following code could in principle be removed, as the update does indeed have dynamic resizing!  But I think let's leave that be for somewhere else; I don't want to mess with the already messy naming of jmol stuff...\n\nFinally, I don't understand this comment - I'm sorry if I am just thinking inside the box:\n\n```\n                # when testing this, modify graphics_filename so that it\n                # returns files which don't automatically share a base name,\n                # e.g.: \"import random; i = random.randint(0, 10000)\"\n```\nWas this just a \"note to self\" or do you mean that, as a tester, I should actually change `graphics_filename` instead of letting it just keep adding one to base names, or ... ?  I figured the whole point of this change was to test where they *did* share a base name, but again I may be thinking too conventionally.",
    "created_at": "2014-10-31T12:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215132",
    "user": "https://github.com/kcrisman"
}
```

Here is something minor but still needing attention. The documentation says

```
        -  ``filename`` -- string (default: a temp file); file
           to save the image to
```
but of course this is now only going to be true in the command line.  Which probably makes sense.  But this should be noted.  Similarly,

```
        # Tachyon resolution options
```
should probably just add a quick note that "mode defaults" also are being set in the next few lines.

Interestingly,

```
            # Temporary hack: encode the desired applet size in the end of the filename:
            # (This will be removed once we have dynamic resizing of applets in the browser.)
```
and the following code could in principle be removed, as the update does indeed have dynamic resizing!  But I think let's leave that be for somewhere else; I don't want to mess with the already messy naming of jmol stuff...

Finally, I don't understand this comment - I'm sorry if I am just thinking inside the box:

```
                # when testing this, modify graphics_filename so that it
                # returns files which don't automatically share a base name,
                # e.g.: "import random; i = random.randint(0, 10000)"
```
Was this just a "note to self" or do you mean that, as a tester, I should actually change `graphics_filename` instead of letting it just keep adding one to base names, or ... ?  I figured the whole point of this change was to test where they *did* share a base name, but again I may be thinking too conventionally.



---

archive/issue_comments_215133.json:
```json
{
    "body": "So far it seems fine, though I rediscovered and diagnosed #11275 along the way.",
    "created_at": "2014-10-31T14:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215133",
    "user": "https://github.com/kcrisman"
}
```

So far it seems fine, though I rediscovered and diagnosed #11275 along the way.



---

archive/issue_comments_215134.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-31T14:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215134",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_215135.json:
```json
{
    "body": "The following in the *command line* don't seem to create any files (I mean visible ones in my directory).  Maybe they aren't supposed to?\n\n```\nsage: var('y')\ny\nsage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),filename='foo')\nsage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')\n```\nNote that the second thing pops up a jmol viewer.  I can't figure out if this ticket introduced it, though it seems to predate that, based on my experimentation.\n\nAlso, with the current documentation, there is no example of how to *properly* use the `filename` keyword here, and that should be added.\n\nAnyway, \"needs work\" to clarify/fix these `filename` use issues.",
    "created_at": "2014-10-31T14:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215135",
    "user": "https://github.com/kcrisman"
}
```

The following in the *command line* don't seem to create any files (I mean visible ones in my directory).  Maybe they aren't supposed to?

```
sage: var('y')
y
sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),filename='foo')
sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')
```
Note that the second thing pops up a jmol viewer.  I can't figure out if this ticket introduced it, though it seems to predate that, based on my experimentation.

Also, with the current documentation, there is no example of how to *properly* use the `filename` keyword here, and that should be added.

Anyway, "needs work" to clarify/fix these `filename` use issues.



---

archive/issue_comments_215136.json:
```json
{
    "body": "Replying to [comment:21 kcrisman]:\n> {{{\n> sage: var('y')\n> y\n> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')\n> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')\n> }}}\n\n\nThe correct syntax is\n\n```\nsage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1)).show(filename='foo')\n```",
    "created_at": "2014-10-31T16:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215136",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 kcrisman]:
> {{{
> sage: var('y')
> y
> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')
> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')
> }}}


The correct syntax is

```
sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1)).show(filename='foo')
```



---

archive/issue_comments_215137.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> Here is something minor but still needing attention. The documentation says\n> \n> ```\n>         -  ``filename`` -- string (default: a temp file); file\n>            to save the image to\n> ```\n> but of course this is now only going to be true in the command line.  Which probably makes sense.\n\nNo, it doesn't make sense. An explicit `filename` should override the default, even in the notebook.",
    "created_at": "2014-10-31T16:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215137",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 kcrisman]:
> Here is something minor but still needing attention. The documentation says
> 
> ```
>         -  ``filename`` -- string (default: a temp file); file
>            to save the image to
> ```
> but of course this is now only going to be true in the command line.  Which probably makes sense.

No, it doesn't make sense. An explicit `filename` should override the default, even in the notebook.



---

archive/issue_comments_215138.json:
```json
{
    "body": "> > {{{\n> > sage: var('y')\n> > y\n> > sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')\n> > sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')\n> > }}}\n\n> \n> The correct syntax is\n> \n> ```\n> sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1)).show(filename='foo')\n> ```\n\nGood to know.  But that sort of proves my point, then, that the documentation (old and new) doesn't tell me that - in this case, because so  many keywords can be passed to the plot and then show up in `show()`.  Such as what worked in Sage 6.2 and possibly broken by the new display hook\n\n```\nsage: var('y')\ny\nsage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),viewer='jmol')  # jmol applet pops up\nsage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),viewer='tachyon') # tachyon-generated png pops up in a viewer\n```\nIf you confirm that this does work properly to generate the filenames in the command line then I'm okay with making sure there are explicit examples that say it doesn't work from the plot command - preferably in the plot command docs!",
    "created_at": "2014-10-31T16:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215138",
    "user": "https://github.com/kcrisman"
}
```

> > {{{
> > sage: var('y')
> > y
> > sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')
> > sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')
> > }}}

> 
> The correct syntax is
> 
> ```
> sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1)).show(filename='foo')
> ```

Good to know.  But that sort of proves my point, then, that the documentation (old and new) doesn't tell me that - in this case, because so  many keywords can be passed to the plot and then show up in `show()`.  Such as what worked in Sage 6.2 and possibly broken by the new display hook

```
sage: var('y')
y
sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),viewer='jmol')  # jmol applet pops up
sage: plot3d(x^2+y^3,(x,-1,1),(y,-1,1),viewer='tachyon') # tachyon-generated png pops up in a viewer
```
If you confirm that this does work properly to generate the filenames in the command line then I'm okay with making sure there are explicit examples that say it doesn't work from the plot command - preferably in the plot command docs!



---

archive/issue_comments_215139.json:
```json
{
    "body": "> > Here is something minor but still needing attention. The documentation says\n> > \n> > ```\n> >         -  ``filename`` -- string (default: a temp file); file\n> >            to save the image to\n> > ```\n> > but of course this is now only going to be true in the command line.  Which probably makes sense.\n\n> No, it doesn't make sense. An explicit `filename` should override the default, even in the notebook.\nHmm, I guess.  But I don't know that there is any easy way to find files in a cell directory in the notebook - though I guess a good use case is to save it in the `DATA` directory, where it of course shouldn't show up in the cell output.",
    "created_at": "2014-10-31T16:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215139",
    "user": "https://github.com/kcrisman"
}
```

> > Here is something minor but still needing attention. The documentation says
> > 
> > ```
> >         -  ``filename`` -- string (default: a temp file); file
> >            to save the image to
> > ```
> > but of course this is now only going to be true in the command line.  Which probably makes sense.

> No, it doesn't make sense. An explicit `filename` should override the default, even in the notebook.
Hmm, I guess.  But I don't know that there is any easy way to find files in a cell directory in the notebook - though I guess a good use case is to save it in the `DATA` directory, where it of course shouldn't show up in the cell output.



---

archive/issue_comments_215140.json:
```json
{
    "body": "Any files created in the current directory are picked up by the notebook, so it would actually work!",
    "created_at": "2014-10-31T17:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215140",
    "user": "https://github.com/jdemeyer"
}
```

Any files created in the current directory are picked up by the notebook, so it would actually work!



---

archive/issue_comments_215141.json:
```json
{
    "body": "> Any files created in the current directory are picked up by the notebook, so it would actually work!\n\nSorry, I wasn't clear.  I meant that the current code in this ticket doesn't allow the filenames, and if one enabled it, it would be kind of useless since there is no access to the cell directory.  My counterexample to that is that one might want to use `filename=DATA+'foo'` or something to put a graphic file in the data directory, though I haven't tested whether this actually works.",
    "created_at": "2014-10-31T17:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215141",
    "user": "https://github.com/kcrisman"
}
```

> Any files created in the current directory are picked up by the notebook, so it would actually work!

Sorry, I wasn't clear.  I meant that the current code in this ticket doesn't allow the filenames, and if one enabled it, it would be kind of useless since there is no access to the cell directory.  My counterexample to that is that one might want to use `filename=DATA+'foo'` or something to put a graphic file in the data directory, though I haven't tested whether this actually works.



---

archive/issue_comments_215142.json:
```json
{
    "body": "(never mind)",
    "created_at": "2014-10-31T17:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215142",
    "user": "https://github.com/jdemeyer"
}
```

(never mind)



---

archive/issue_comments_215143.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> Finally, I don't understand this comment - I'm sorry if I am just thinking inside the box:\n> \n> ```\n>                 # when testing this, modify graphics_filename so that it\n>                 # returns files which don't automatically share a base name,\n>                 # e.g.: \"import random; i = random.randint(0, 10000)\"\n> ```\n> Was this just a \"note to self\" or do you mean that, as a tester, I should actually change `graphics_filename` instead of letting it just keep adding one to base names, or ... ?\n\n\nDoctests mostly check whether a given file can be created, but to check whether that file displays as intended, you'd use an interactive setup not a doctest. So I envision testers using the notebook to run tests, with no way to programmatically tell whether he is doing tests or something else.\n\nAnd the notebook numbers files by incrementing some counter until they are unique. I.e. starting by `sage0.png` then `sage1.png`. But the critical point here is that the collision detection takes file extensions into account. So if I were to request e.g. a `.foo` file and a `.bar` file, I'd get `sage0.foo` and `sage0.bar` not `sage1.bar`. Usually. Unless `sage0.bar` already exists at the time the graphics file name is requested, in which case I'd get `sage0.foo` but `sage1.bar`.\n\nThe problematic case I had in mind was one where some viewer uses one file name to derive some other file name. So if a viewer were to open `sage0.foo` and *from that name* infer that it also has to open `sage0.bar`, then this would work during test cases, but might fail unexpectedly if a user creates `sage0.bar` in some other code inside the same cell.\n\nI'd like to detect such situations. I'd like to make sure that if there is more than one file required for some viewer, then all file names are stated explicitly somewhere, and not inferred by some extension replacement. And that's the point of the comment. I'd like to break the sequential numbering and replace it by random numbers to ensure that inferred file names would break.\n\nSo yes, anyone who tests a patch that might be affected by the scenario outlined above should, in my opinion, temporarily modify the code of `graphics_filename` to ensure that no file name inference is used. If you can think of a better wording to convey this idea, please let me know. I guess we could also add a link to this comment here, since the whole explanation is too long to put into such a comment, imho.",
    "created_at": "2014-10-31T17:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215143",
    "user": "https://github.com/gagern"
}
```

Replying to [comment:19 kcrisman]:
> Finally, I don't understand this comment - I'm sorry if I am just thinking inside the box:
> 
> ```
>                 # when testing this, modify graphics_filename so that it
>                 # returns files which don't automatically share a base name,
>                 # e.g.: "import random; i = random.randint(0, 10000)"
> ```
> Was this just a "note to self" or do you mean that, as a tester, I should actually change `graphics_filename` instead of letting it just keep adding one to base names, or ... ?


Doctests mostly check whether a given file can be created, but to check whether that file displays as intended, you'd use an interactive setup not a doctest. So I envision testers using the notebook to run tests, with no way to programmatically tell whether he is doing tests or something else.

And the notebook numbers files by incrementing some counter until they are unique. I.e. starting by `sage0.png` then `sage1.png`. But the critical point here is that the collision detection takes file extensions into account. So if I were to request e.g. a `.foo` file and a `.bar` file, I'd get `sage0.foo` and `sage0.bar` not `sage1.bar`. Usually. Unless `sage0.bar` already exists at the time the graphics file name is requested, in which case I'd get `sage0.foo` but `sage1.bar`.

The problematic case I had in mind was one where some viewer uses one file name to derive some other file name. So if a viewer were to open `sage0.foo` and *from that name* infer that it also has to open `sage0.bar`, then this would work during test cases, but might fail unexpectedly if a user creates `sage0.bar` in some other code inside the same cell.

I'd like to detect such situations. I'd like to make sure that if there is more than one file required for some viewer, then all file names are stated explicitly somewhere, and not inferred by some extension replacement. And that's the point of the comment. I'd like to break the sequential numbering and replace it by random numbers to ensure that inferred file names would break.

So yes, anyone who tests a patch that might be affected by the scenario outlined above should, in my opinion, temporarily modify the code of `graphics_filename` to ensure that no file name inference is used. If you can think of a better wording to convey this idea, please let me know. I guess we could also add a link to this comment here, since the whole explanation is too long to put into such a comment, imho.



---

archive/issue_comments_215144.json:
```json
{
    "body": "In vanilla (i.e. without this patch) sage-6.4.rc0 in the notebook, when doing\n\n```\ncube(viewer=\"jmol\")\n```\nI get\n\n```\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/cor\\\ne/formatters.py:239: FormatterWarning: Exception in text/plain\nformatter: Jmol failed to create file\n'/tmp/tmpE8eQHg/.jmol_images/sage0-size500.jmol.png', see\n'/home/jdemeyer/.sage/temp/tamiyo/24593/tmp_rBkFiX.txt' for details\n  FormatterWarning,\nNone\n```\n(not the clearest error message) followed by a blank red square.\n\nLooking at the file mentioned for details gives\n\n```\nException in thread \"main\" java.lang.UnsupportedClassVersionError: org/jmol/translation/Jmol/en_GB/Messages_en_GB : Unsupported major.minor version 51.0\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:634)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:277)\n        at java.net.URLClassLoader.access$000(URLClassLoader.java:73)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:212)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:205)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:321)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:294)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:266)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:188)\n        at org.jmol.api.Interface.getInterface(Unknown Source)\n        at org.jmol.i18n.Resource.getResource(Unknown Source)\n        at org.jmol.i18n.GT.addBundle(Unknown Source)\n        at org.jmol.i18n.GT.addBundles(Unknown Source)\n        at org.jmol.i18n.GT.<init>(Unknown Source)\n        at org.jmol.i18n.GT.getTextWrapper(Unknown Source)\n        at org.jmol.i18n.GT._(Unknown Source)\n        at org.openscience.jmol.app.JmolApp.getOptions(Unknown Source)\n        at org.openscience.jmol.app.JmolApp.parseCommandLine(Unknown Source)\n        at org.openscience.jmol.app.JmolData.main(Unknown Source)\n```\nDoes this mean my Java version is too old?",
    "created_at": "2014-10-31T17:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215144",
    "user": "https://github.com/jdemeyer"
}
```

In vanilla (i.e. without this patch) sage-6.4.rc0 in the notebook, when doing

```
cube(viewer="jmol")
```
I get

```
/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/cor\
e/formatters.py:239: FormatterWarning: Exception in text/plain
formatter: Jmol failed to create file
'/tmp/tmpE8eQHg/.jmol_images/sage0-size500.jmol.png', see
'/home/jdemeyer/.sage/temp/tamiyo/24593/tmp_rBkFiX.txt' for details
  FormatterWarning,
None
```
(not the clearest error message) followed by a blank red square.

Looking at the file mentioned for details gives

```
Exception in thread "main" java.lang.UnsupportedClassVersionError: org/jmol/translation/Jmol/en_GB/Messages_en_GB : Unsupported major.minor version 51.0
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:634)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:277)
        at java.net.URLClassLoader.access$000(URLClassLoader.java:73)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:212)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:205)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:321)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:294)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:266)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:188)
        at org.jmol.api.Interface.getInterface(Unknown Source)
        at org.jmol.i18n.Resource.getResource(Unknown Source)
        at org.jmol.i18n.GT.addBundle(Unknown Source)
        at org.jmol.i18n.GT.addBundles(Unknown Source)
        at org.jmol.i18n.GT.<init>(Unknown Source)
        at org.jmol.i18n.GT.getTextWrapper(Unknown Source)
        at org.jmol.i18n.GT._(Unknown Source)
        at org.openscience.jmol.app.JmolApp.getOptions(Unknown Source)
        at org.openscience.jmol.app.JmolApp.parseCommandLine(Unknown Source)
        at org.openscience.jmol.app.JmolData.main(Unknown Source)
```
Does this mean my Java version is too old?



---

archive/issue_comments_215145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-31T17:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215146.json:
```json
{
    "body": "I think this patch should fix the issues mentioned above (apart from Martin's comment which I decided to simply remove, note that doctests also generate random filenames).",
    "created_at": "2014-10-31T17:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215146",
    "user": "https://github.com/jdemeyer"
}
```

I think this patch should fix the issues mentioned above (apart from Martin's comment which I decided to simply remove, note that doctests also generate random filenames).



---

archive/issue_comments_215147.json:
```json
{
    "body": "The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.",
    "created_at": "2014-10-31T18:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215147",
    "user": "https://github.com/jdemeyer"
}
```

The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.



---

archive/issue_comments_215148.json:
```json
{
    "body": "With this patch, the `filename=` option does work in the notebook.",
    "created_at": "2014-10-31T18:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215148",
    "user": "https://github.com/jdemeyer"
}
```

With this patch, the `filename=` option does work in the notebook.



---

archive/issue_comments_215149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-31T18:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215149",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_215150.json:
```json
{
    "body": "> The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.\n\nThat indicates to me that your notebook instantiation is somehow corrupted and/or the display hook stuff didn't even come through.   Earlier today I had it all working, for example, and now it doesn't even have the extra click boxes in the template, mysteriously.  I'm baffled.   But that shouldn't happen.  Though you may be right about the old java.",
    "created_at": "2014-10-31T19:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215150",
    "user": "https://github.com/kcrisman"
}
```

> The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.

That indicates to me that your notebook instantiation is somehow corrupted and/or the display hook stuff didn't even come through.   Earlier today I had it all working, for example, and now it doesn't even have the extra click boxes in the template, mysteriously.  I'm baffled.   But that shouldn't happen.  Though you may be right about the old java.



---

archive/issue_comments_215151.json:
```json
{
    "body": "```\ncube(viewer=\"jmol\")\n```\n> > The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.\n\n> That indicates to me that your notebook instantiation is somehow corrupted and/or the display hook stuff didn't even come through.   Earlier today I had it all working, for example, and now it doesn't even have the extra click boxes in the template, mysteriously.  I'm baffled.   But that shouldn't happen.  Though you may be right about the old java.\n\nYeah, I can't replicate this here, though the old java could possible contribute.  What happens if you click on the \"live 3d\" box and then evaluate?  That would bypass java creating the static image.",
    "created_at": "2014-10-31T20:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215151",
    "user": "https://github.com/kcrisman"
}
```

```
cube(viewer="jmol")
```
> > The error in [comment:30] occurs with or without this patch, but I would still like to know what is wrong.

> That indicates to me that your notebook instantiation is somehow corrupted and/or the display hook stuff didn't even come through.   Earlier today I had it all working, for example, and now it doesn't even have the extra click boxes in the template, mysteriously.  I'm baffled.   But that shouldn't happen.  Though you may be right about the old java.

Yeah, I can't replicate this here, though the old java could possible contribute.  What happens if you click on the "live 3d" box and then evaluate?  That would bypass java creating the static image.



---

archive/issue_comments_215152.json:
```json
{
    "body": "Replying to [comment:37 kcrisman]:\n> What happens if you click on the \"live 3d\" box and then evaluate?\n\nWhen enabling \"Load 3-D Live\" I get the horrifying error message (it's Halloween, right?)\n\n```\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/IPython/core/f\\\normatters.py:239: FormatterWarning: Exception in text/plain formatter:\nJmol failed to create file\n'/tmp/tmpJEIc27/.jmol_images/sage0-size500.jmol.png', see\n'/home/jdemeyer/.sage/temp/tamiyo/2874/tmp_IABUbj.txt' for details\n  FormatterWarning,\nNone\n```\nthen some 3d figure which does work nicely, then the sentence \"Right-click to get options menu.\"",
    "created_at": "2014-10-31T21:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215152",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 kcrisman]:
> What happens if you click on the "live 3d" box and then evaluate?

When enabling "Load 3-D Live" I get the horrifying error message (it's Halloween, right?)

```
/usr/local/src/sage-git/local/lib/python2.7/site-packages/IPython/core/f\
ormatters.py:239: FormatterWarning: Exception in text/plain formatter:
Jmol failed to create file
'/tmp/tmpJEIc27/.jmol_images/sage0-size500.jmol.png', see
'/home/jdemeyer/.sage/temp/tamiyo/2874/tmp_IABUbj.txt' for details
  FormatterWarning,
None
```
then some 3d figure which does work nicely, then the sentence "Right-click to get options menu."



---

archive/issue_comments_215153.json:
```json
{
    "body": "When enabling \"Use java for 3-D\" and not \"Load 3-D Live\" I get a very similar result (with one interesting difference: the right-click menu uses a different font and is in English, with \"Load 3-D Live\" the menu was in Dutch).\n\n(edit: cannot reproduce this anymore, getting a light grey square like in [comment:40])\n(edit2: restarting the browser fixed this again)",
    "created_at": "2014-10-31T21:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215153",
    "user": "https://github.com/jdemeyer"
}
```

When enabling "Use java for 3-D" and not "Load 3-D Live" I get a very similar result (with one interesting difference: the right-click menu uses a different font and is in English, with "Load 3-D Live" the menu was in Dutch).

(edit: cannot reproduce this anymore, getting a light grey square like in [comment:40])
(edit2: restarting the browser fixed this again)



---

archive/issue_comments_215154.json:
```json
{
    "body": "When enabling both \"Use java for 3-D\" and \"Load 3-D Live\" I get a result similar to [comment:30] except that the blank square is light grey instead of red.",
    "created_at": "2014-10-31T21:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215154",
    "user": "https://github.com/jdemeyer"
}
```

When enabling both "Use java for 3-D" and "Load 3-D Live" I get a result similar to [comment:30] except that the blank square is light grey instead of red.



---

archive/issue_comments_215155.json:
```json
{
    "body": "For the record, I am using\n\n```\njava version \"1.6.0_31\"\nOpenJDK Runtime Environment (IcedTea6 1.13.3) (Gentoo build 1.6.0_31-b31)\nOpenJDK 64-Bit Server VM (build 23.25-b01, mixed mode)\n```\nand\n\n```\nFirefox ESR 24.8.0\n```",
    "created_at": "2014-10-31T22:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215155",
    "user": "https://github.com/jdemeyer"
}
```

For the record, I am using

```
java version "1.6.0_31"
OpenJDK Runtime Environment (IcedTea6 1.13.3) (Gentoo build 1.6.0_31-b31)
OpenJDK 64-Bit Server VM (build 23.25-b01, mixed mode)
```
and

```
Firefox ESR 24.8.0
```



---

archive/issue_comments_215156.json:
```json
{
    "body": "I won't have time to look at this over the weekend, nor do I have the jmol/jsmol expertise to diagnose it, but I would recommend putting something about it on the 6.4.rc0 release thread so that Jonathan Gutow sees it.",
    "created_at": "2014-11-01T02:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215156",
    "user": "https://github.com/kcrisman"
}
```

I won't have time to look at this over the weekend, nor do I have the jmol/jsmol expertise to diagnose it, but I would recommend putting something about it on the 6.4.rc0 release thread so that Jonathan Gutow sees it.



---

archive/issue_comments_215157.json:
```json
{
    "body": "I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?",
    "created_at": "2014-11-01T18:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215157",
    "user": "https://github.com/strogdon"
}
```

I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?



---

archive/issue_comments_215158.json:
```json
{
    "body": "> I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?\n\n\nHmm.  Do you know where you first saw this?  (I'm not suggesting you do a full bisection!  Just wondering.)",
    "created_at": "2014-11-03T13:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215158",
    "user": "https://github.com/kcrisman"
}
```

> I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?


Hmm.  Do you know where you first saw this?  (I'm not suggesting you do a full bisection!  Just wondering.)



---

archive/issue_comments_215159.json:
```json
{
    "body": "I've tried to report the things on this ticket not actually related to this ticket to sage-release.  However, now I've forgotten where we were in the review!",
    "created_at": "2014-11-03T13:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215159",
    "user": "https://github.com/kcrisman"
}
```

I've tried to report the things on this ticket not actually related to this ticket to sage-release.  However, now I've forgotten where we were in the review!



---

archive/issue_comments_215160.json:
```json
{
    "body": "Replying to [comment:45 kcrisman]:\n> I've forgotten where we were in the review!\n\n\nThe commit from comment:31 seems to deal with all outstanding issues from comment:19, so if you review that, I believe we should be fine. I guess Jeroen contributed enough that he should be an author as well. Do you want to file a ticket for the dynamic resizing of applets you mentioned in comment:19?",
    "created_at": "2014-11-03T14:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215160",
    "user": "https://github.com/gagern"
}
```

Replying to [comment:45 kcrisman]:
> I've forgotten where we were in the review!


The commit from comment:31 seems to deal with all outstanding issues from comment:19, so if you review that, I believe we should be fine. I guess Jeroen contributed enough that he should be an author as well. Do you want to file a ticket for the dynamic resizing of applets you mentioned in comment:19?



---

archive/issue_comments_215161.json:
```json
{
    "body": "Replying to [comment:44 kcrisman]:\n> > I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?\n\n> \n> Hmm.  Do you know where you first saw this?  (I'm not suggesting you do a full bisection!  Just wondering.)\n  \nI believe on sage-release. But this is not related to this ticket. I only saw your comment:21 above. It should be addressed somewhere.",
    "created_at": "2014-11-03T16:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215161",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:44 kcrisman]:
> > I don't know if anyone has tried it but I removed the patches associated with #17170 from 6.4.r0 and I still have the issue with `viewer='tachyon'` opening a jmol window instead of creating a png. So perhaps someother displayhook-related ticket?

> 
> Hmm.  Do you know where you first saw this?  (I'm not suggesting you do a full bisection!  Just wondering.)
  
I believe on sage-release. But this is not related to this ticket. I only saw your comment:21 above. It should be addressed somewhere.



---

archive/issue_comments_215162.json:
```json
{
    "body": "Replying to [comment:21 kcrisman]:\n> {{{\n> sage: var('y')\n> y\n> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')\n> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')\n> }}}\n> Note that the second thing pops up a jmol viewer.\n\nThis is now #17284.",
    "created_at": "2014-11-04T07:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215162",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 kcrisman]:
> {{{
> sage: var('y')
> y
> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo')
> sage: plot3d(x<sup>2+y</sup>3,(x,-1,1),(y,-1,1),filename='foo',viewer='tachyon')
> }}}
> Note that the second thing pops up a jmol viewer.

This is now #17284.



---

archive/issue_comments_215163.json:
```json
{
    "body": "For the record: I give positive_review to everything on this ticket not authored by me.",
    "created_at": "2014-11-04T16:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215163",
    "user": "https://github.com/jdemeyer"
}
```

For the record: I give positive_review to everything on this ticket not authored by me.



---

archive/issue_comments_215164.json:
```json
{
    "body": "And I am happy with everything except I need to look at the very last patch one more time... okay, looks good other than two questions.\n\nQuestion - is this a Python syntax I'm not aware of?\n\n```\ndef show(self, *, filename=None, **kwds):\n```\nIn particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)\n\nOh, and maybe add a doctest for [this commit](http://git.sagemath.org/sage.git/commit/?h=3852a0a23966400e02a14512e97e8ae46e45ec2a&id=bd1479d38fe1adb42755ab92499ff8c1ba35592d) with the error raised?  Maybe that's too trivial to do... but for some reason the doctest\n\n```\nsage: p.show(viewer='canvas3d')\n```\ndoesn't raise an error, which makes sense because of the code.  But it *also* is now doctested with the [most recent change](http://git.sagemath.org/sage.git/commit/?id=bd1479d38fe1adb42755ab92499ff8c1ba35592d) you made, despite what you just said earlier that making canvas3d guys was too long!  \n\nSomehow this should be resolved.  I think the best way is to doctest the *creation* of the file, perhaps by setting a one-time flag or something, rather than the error - as long as we tell people that in the command line it will give an error.  (Well, we could doctest both as well!)",
    "created_at": "2014-11-07T17:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215164",
    "user": "https://github.com/kcrisman"
}
```

And I am happy with everything except I need to look at the very last patch one more time... okay, looks good other than two questions.

Question - is this a Python syntax I'm not aware of?

```
def show(self, *, filename=None, **kwds):
```
In particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)

Oh, and maybe add a doctest for [this commit](http://git.sagemath.org/sage.git/commit/?h=3852a0a23966400e02a14512e97e8ae46e45ec2a&id=bd1479d38fe1adb42755ab92499ff8c1ba35592d) with the error raised?  Maybe that's too trivial to do... but for some reason the doctest

```
sage: p.show(viewer='canvas3d')
```
doesn't raise an error, which makes sense because of the code.  But it *also* is now doctested with the [most recent change](http://git.sagemath.org/sage.git/commit/?id=bd1479d38fe1adb42755ab92499ff8c1ba35592d) you made, despite what you just said earlier that making canvas3d guys was too long!  

Somehow this should be resolved.  I think the best way is to doctest the *creation* of the file, perhaps by setting a one-time flag or something, rather than the error - as long as we tell people that in the command line it will give an error.  (Well, we could doctest both as well!)



---

archive/issue_comments_215165.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-07T17:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215165",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_215166.json:
```json
{
    "body": "Replying to [comment:50 kcrisman]:\n> In particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)\n\n\nThis syntax for keyword-only parameters comes from Python 3 but is supported by Cython even for older versions of Python. In #16607 I suggested support for keyword-only parameters in pure Python code, and there jdemeyer pointed out that Cython support.",
    "created_at": "2014-11-07T17:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215166",
    "user": "https://github.com/gagern"
}
```

Replying to [comment:50 kcrisman]:
> In particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)


This syntax for keyword-only parameters comes from Python 3 but is supported by Cython even for older versions of Python. In #16607 I suggested support for keyword-only parameters in pure Python code, and there jdemeyer pointed out that Cython support.



---

archive/issue_comments_215167.json:
```json
{
    "body": "> > In particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)\n\n> \n> This syntax for keyword-only parameters comes from Python 3 but is supported by Cython even for older versions of Python. In #16607 I suggested support for keyword-only parameters in pure Python code, and there jdemeyer pointed out that Cython support.\n\n\nAha.\n\n> With this patch, the `filename=` option does work in the notebook.\n\n\nAnd it really does save to where needed, awesome!  Especially in `DATA` could be useful.\n\n> despite what you just said earlier that making canvas3d guys was too long! \n\nOkay, sorry, I see what you did now - got a little too excited there.  What do you think about testing the warning?\n\nOtherwise this was good teamwork by you two, very nice.",
    "created_at": "2014-11-07T17:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215167",
    "user": "https://github.com/kcrisman"
}
```

> > In particular, the extra `*` mystifies me.  (Edit - okay, I found it, but it appears to be Python 3 only?  I believe it works in recent Python 2.x since you used it, but I couldn't find a definitive reference - even the Python reference was ambiguous.)

> 
> This syntax for keyword-only parameters comes from Python 3 but is supported by Cython even for older versions of Python. In #16607 I suggested support for keyword-only parameters in pure Python code, and there jdemeyer pointed out that Cython support.


Aha.

> With this patch, the `filename=` option does work in the notebook.


And it really does save to where needed, awesome!  Especially in `DATA` could be useful.

> despite what you just said earlier that making canvas3d guys was too long! 

Okay, sorry, I see what you did now - got a little too excited there.  What do you think about testing the warning?

Otherwise this was good teamwork by you two, very nice.



---

archive/issue_comments_215168.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2014-11-07T17:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215168",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_215169.json:
```json
{
    "body": "Replying to [comment:52 kcrisman]:\n> > despite what you just said earlier that making canvas3d guys was too long! \n\n> Okay, sorry, I see what you did now - got a little too excited there.  What do you think about testing the warning?\n\nI'm too confused, what are you (plural) trying to say here?",
    "created_at": "2014-11-08T10:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215169",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:52 kcrisman]:
> > despite what you just said earlier that making canvas3d guys was too long! 

> Okay, sorry, I see what you did now - got a little too excited there.  What do you think about testing the warning?

I'm too confused, what are you (plural) trying to say here?



---

archive/issue_comments_215170.json:
```json
{
    "body": "Here is the short version:\n> p.show(viewer='canvas3d')\n\nraises an error in the command line but not during doctesting because of the way you wrote the code (creates the file).    Perhaps the warning should also be doctested.",
    "created_at": "2014-11-09T00:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215170",
    "user": "https://github.com/kcrisman"
}
```

Here is the short version:
> p.show(viewer='canvas3d')

raises an error in the command line but not during doctesting because of the way you wrote the code (creates the file).    Perhaps the warning should also be doctested.



---

archive/issue_comments_215171.json:
```json
{
    "body": "Replying to [comment:54 kcrisman]:\n> Perhaps the warning should also be doctested.\n\nThat's possible but requires some messing around with `DOCTEST_MODE`. Given that it's a minor thing and that Volker has plans to change all this code anyway, I feel that it's not worth the trouble. But if you insist, I will add that test.\n\nPS: I assume you mean \"error\", not \"warning\".",
    "created_at": "2014-11-09T13:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215171",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:54 kcrisman]:
> Perhaps the warning should also be doctested.

That's possible but requires some messing around with `DOCTEST_MODE`. Given that it's a minor thing and that Volker has plans to change all this code anyway, I feel that it's not worth the trouble. But if you insist, I will add that test.

PS: I assume you mean "error", not "warning".



---

archive/issue_comments_215172.json:
```json
{
    "body": "> > Perhaps the warning should also be doctested.\n\n> That's possible but requires some messing around with `DOCTEST_MODE`. \nYes.\n> Given that it's a minor thing and that Volker has plans to change all this code anyway, I feel that it's not worth the trouble. But if you insist, I will add that test.\n\nOk.\n> PS: I assume you mean \"error\", not \"warning\".\n\nYes, though I recall writing both of those a few times and then accidentally closing the browser/getting timed out!",
    "created_at": "2014-11-10T13:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215172",
    "user": "https://github.com/kcrisman"
}
```

> > Perhaps the warning should also be doctested.

> That's possible but requires some messing around with `DOCTEST_MODE`. 
Yes.
> Given that it's a minor thing and that Volker has plans to change all this code anyway, I feel that it's not worth the trouble. But if you insist, I will add that test.

Ok.
> PS: I assume you mean "error", not "warning".

Yes, though I recall writing both of those a few times and then accidentally closing the browser/getting timed out!



---

archive/issue_comments_215173.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-11-10T13:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215173",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_215174.json:
```json
{
    "body": "Conflicts with 6.4, please merge.",
    "created_at": "2014-11-14T21:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215174",
    "user": "https://github.com/vbraun"
}
```

Conflicts with 6.4, please merge.



---

archive/issue_comments_215175.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-14T21:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215175",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_215176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-15T09:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215177.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-11-15T09:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215177",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_215178.json:
```json
{
    "body": "Done, the conflict was the removal of a redundant import of `tmp_filename`.",
    "created_at": "2014-11-15T09:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215178",
    "user": "https://github.com/jdemeyer"
}
```

Done, the conflict was the removal of a redundant import of `tmp_filename`.



---

archive/issue_comments_215179.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-15T11:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215179",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_215180.json:
```json
{
    "body": "```\nsage -t --long src/sage/repl/display/formatter.py\n**********************************************************************\nFile \"src/sage/repl/display/formatter.py\", line 320, in sage.repl.display.formatter.SageNBTextFormatter.__call__\nFailed example:\n    fmt(FooGraphics())\nExpected:\n    showing graphics\n    ''\nGot:\n    showing graphics\n    doctest:239: FormatterWarning: Exception in text/plain formatter: [Errno 2] No such file or directory: '/nonexistent.png'\n**********************************************************************\n```",
    "created_at": "2014-11-15T11:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215180",
    "user": "https://github.com/jdemeyer"
}
```

```
sage -t --long src/sage/repl/display/formatter.py
**********************************************************************
File "src/sage/repl/display/formatter.py", line 320, in sage.repl.display.formatter.SageNBTextFormatter.__call__
Failed example:
    fmt(FooGraphics())
Expected:
    showing graphics
    ''
Got:
    showing graphics
    doctest:239: FormatterWarning: Exception in text/plain formatter: [Errno 2] No such file or directory: '/nonexistent.png'
**********************************************************************
```



---

archive/issue_comments_215181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-17T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215182.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-17T09:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215182",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_215183.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-17T09:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215183",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_215184.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-17T21:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16403#issuecomment-215184",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_048804.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-17T21:21:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16403",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16403#event-48804"
}
```
