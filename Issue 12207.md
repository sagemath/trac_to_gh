# Issue 12207: Graph chromatic_number - change default algorithm.

Issue created by migration from Trac.

Original creator: JoalHeagney

Original creation time: 2012-01-29 03:21:29

Assignee: jason, ncohen, rlm

Keywords: graph, MILP, chromatic_number

The following page in the documentation (and the sage docstring for this method)
[http://www.sagemath.org/doc/reference/sage/graphs/graph.html](http://www.sagemath.org/doc/reference/sage/graphs/graph.html)
states chromatic_number uses the less efficient DLX algorithm by default, as opposed to the MILP algorithm.

It's my understanding that sage now includes GLPK by default.

I'd recommend that the default be changed to the more efficient algorithm="MILP".

I've already created a ticket [http://trac.sagemath.org/sage_trac/ticket/12378](http://trac.sagemath.org/sage_trac/ticket/12378) for the required change in documentation.


---

Comment by JoalHeagney created at 2012-01-29 03:27:01

Additionally, someone should probably do a code check to see if there are other methods and functions that use default algorithms that are less efficient than already-written MILP alternatives.


---

Comment by was created at 2012-02-09 20:26:45

A student in my class -- Andrew Johnson -- looked at doing this ticket.  But he was surprised to find that your assertion that 


```
g = graphs.CubeGraph(11)
time g.chromatic_number(algorithm='DLX')
Time: CPU 0.27 s, Wall: 0.27 s
time g.chromatic_number(algorithm='MILP')
Time: CPU 0.06 s, Wall: 0.06 s
```


But the next one has DLX way ahead:

```
g = graphs.RandomGNP(30, .4)
time g.chromatic_number(algorithm='DLX')
Time: CPU 1.37 s, Wall: 1.37 s
time g.chromatic_number(algorithm='MILP')
Time: CPU 11.29 s, Wall: 11.30 s
```



---

Comment by was created at 2012-02-09 21:05:11

I just wrote this:


```
def use_all(f, algorithms):
    `@`parallel(len(algorithms), verbose=False)
    def h(alg):
        return f(algorithm=alg)
    for input, output in h(algorithms):
        return output, input[0][0]
```


which one can use like this:


```
set_random_seed(0)
g = graphs.RandomGNP(20, .5)
time use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
```


This way all algorithms get run, and the first to finish is used.  This could be useful.  Perhaps my function above could go in devel/sage-main/sage/parallel/algorithm.py and provide a way to easily implement an algorithm="parallel" option.


---

Comment by dcoudert created at 2022-04-30 13:57:30

Changing status from new to needs_review.


---

Comment by dcoudert created at 2022-04-30 13:57:30

Based on #comment:3, I have added algorithm `'parallel'`. It's working well but when I tried to set it as default algorithm, I get the following issue. So it seems safer to let `'DLX'` as default algorithm to avoid random doctest errors.

```
sage -t --warn-long 290.4 --random-seed=83463765161747970581723517233090779640 src/sage/graphs/generators/smallgraphs.py
**********************************************************************
File "src/sage/graphs/generators/smallgraphs.py", line 4506, in sage.graphs.generators.smallgraphs.WatkinsSnarkGraph
Failed example:
    g.chromatic_number()
Expected:
    3
Got:
    Exception raised by child process with pid=40818:
    3
```

----
New commits:


---

Comment by dcoudert created at 2022-04-30 14:01:15

To see that there is no clear winner between `DLX` and `MILP` (with `cplex` as default solver):

```
sage: from collections import Counter
sage: count = Counter()
sage: def use_all(f, algorithms):
....:     `@`parallel(len(algorithms), verbose=False)
....:     def h(alg):
....:         return f(algorithm=alg)
....:     for input, output in h(algorithms):
....:         return output, input[0][0]
sage: for i in range(100):
....:     g = graphs.RandomGNP(20, .5)
....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
....:     count[algo] += 1
sage: count
Counter({'DLX': 79, 'MILP': 21})
sage: count = Counter()
sage: for i in range(100):
....:     g = graphs.RandomGNP(30, .4)
....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
....:     count[algo] += 1
sage: count
Counter({'MILP': 74, 'DLX': 26})
```



---

Comment by git created at 2022-05-21 12:29:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-05-21 12:30:34

the preview doctest was subject to errors. This is more robust now.


---

Comment by dcoudert created at 2022-05-21 16:18:21

The random doctest errors reported by the patchbot are independent from this ticket and tracked in #32773 and #33880.
