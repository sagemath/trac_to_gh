# Issue 12207: Graph chromatic_number - change default algorithm.

archive/issues_012207.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nKeywords: graph, MILP, chromatic_number\n\nThe following page in the documentation (and the sage docstring for this method)\n[http://www.sagemath.org/doc/reference/sage/graphs/graph.html](http://www.sagemath.org/doc/reference/sage/graphs/graph.html)\nstates chromatic_number uses the less efficient DLX algorithm by default, as opposed to the MILP algorithm.\n\nIt's my understanding that sage now includes GLPK by default.\n\nI'd recommend that the default be changed to the more efficient algorithm=\"MILP\".\n\nI've already created a ticket [http://trac.sagemath.org/sage_trac/ticket/12378](http://trac.sagemath.org/sage_trac/ticket/12378) for the required change in documentation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12379\n\n",
    "created_at": "2012-01-29T03:21:29Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Graph chromatic_number - change default algorithm.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12207",
    "user": "https://trac.sagemath.org/admin/accounts/users/JoalHeagney"
}
```
Assignee: jason, ncohen, rlm

Keywords: graph, MILP, chromatic_number

The following page in the documentation (and the sage docstring for this method)
[http://www.sagemath.org/doc/reference/sage/graphs/graph.html](http://www.sagemath.org/doc/reference/sage/graphs/graph.html)
states chromatic_number uses the less efficient DLX algorithm by default, as opposed to the MILP algorithm.

It's my understanding that sage now includes GLPK by default.

I'd recommend that the default be changed to the more efficient algorithm="MILP".

I've already created a ticket [http://trac.sagemath.org/sage_trac/ticket/12378](http://trac.sagemath.org/sage_trac/ticket/12378) for the required change in documentation.

Issue created by migration from https://trac.sagemath.org/ticket/12379





---

archive/issue_comments_142380.json:
```json
{
    "body": "Additionally, someone should probably do a code check to see if there are other methods and functions that use default algorithms that are less efficient than already-written MILP alternatives.",
    "created_at": "2012-01-29T03:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142380",
    "user": "https://trac.sagemath.org/admin/accounts/users/JoalHeagney"
}
```

Additionally, someone should probably do a code check to see if there are other methods and functions that use default algorithms that are less efficient than already-written MILP alternatives.



---

archive/issue_comments_142381.json:
```json
{
    "body": "A student in my class -- Andrew Johnson -- looked at doing this ticket.  But he was surprised to find that your assertion that \n\n\n```\ng = graphs.CubeGraph(11)\ntime g.chromatic_number(algorithm='DLX')\nTime: CPU 0.27 s, Wall: 0.27 s\ntime g.chromatic_number(algorithm='MILP')\nTime: CPU 0.06 s, Wall: 0.06 s\n```\n\n\nBut the next one has DLX way ahead:\n\n```\ng = graphs.RandomGNP(30, .4)\ntime g.chromatic_number(algorithm='DLX')\nTime: CPU 1.37 s, Wall: 1.37 s\ntime g.chromatic_number(algorithm='MILP')\nTime: CPU 11.29 s, Wall: 11.30 s\n```\n",
    "created_at": "2012-02-09T20:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142381",
    "user": "https://github.com/williamstein"
}
```

A student in my class -- Andrew Johnson -- looked at doing this ticket.  But he was surprised to find that your assertion that 


```
g = graphs.CubeGraph(11)
time g.chromatic_number(algorithm='DLX')
Time: CPU 0.27 s, Wall: 0.27 s
time g.chromatic_number(algorithm='MILP')
Time: CPU 0.06 s, Wall: 0.06 s
```


But the next one has DLX way ahead:

```
g = graphs.RandomGNP(30, .4)
time g.chromatic_number(algorithm='DLX')
Time: CPU 1.37 s, Wall: 1.37 s
time g.chromatic_number(algorithm='MILP')
Time: CPU 11.29 s, Wall: 11.30 s
```




---

archive/issue_comments_142382.json:
```json
{
    "body": "I just wrote this:\n\n\n```\ndef use_all(f, algorithms):\n    @parallel(len(algorithms), verbose=False)\n    def h(alg):\n        return f(algorithm=alg)\n    for input, output in h(algorithms):\n        return output, input[0][0]\n```\n\n\nwhich one can use like this:\n\n\n```\nset_random_seed(0)\ng = graphs.RandomGNP(20, .5)\ntime use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])\n```\n\n\nThis way all algorithms get run, and the first to finish is used.  This could be useful.  Perhaps my function above could go in devel/sage-main/sage/parallel/algorithm.py and provide a way to easily implement an algorithm=\"parallel\" option.",
    "created_at": "2012-02-09T21:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142382",
    "user": "https://github.com/williamstein"
}
```

I just wrote this:


```
def use_all(f, algorithms):
    @parallel(len(algorithms), verbose=False)
    def h(alg):
        return f(algorithm=alg)
    for input, output in h(algorithms):
        return output, input[0][0]
```


which one can use like this:


```
set_random_seed(0)
g = graphs.RandomGNP(20, .5)
time use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
```


This way all algorithms get run, and the first to finish is used.  This could be useful.  Perhaps my function above could go in devel/sage-main/sage/parallel/algorithm.py and provide a way to easily implement an algorithm="parallel" option.



---

archive/issue_comments_142383.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-30T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142383",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142384.json:
```json
{
    "body": "Based on #comment:3, I have added algorithm `'parallel'`. It's working well but when I tried to set it as default algorithm, I get the following issue. So it seems safer to let `'DLX'` as default algorithm to avoid random doctest errors.\n\n```\nsage -t --warn-long 290.4 --random-seed=83463765161747970581723517233090779640 src/sage/graphs/generators/smallgraphs.py\n**********************************************************************\nFile \"src/sage/graphs/generators/smallgraphs.py\", line 4506, in sage.graphs.generators.smallgraphs.WatkinsSnarkGraph\nFailed example:\n    g.chromatic_number()\nExpected:\n    3\nGot:\n    Exception raised by child process with pid=40818:\n    3\n```\n\n----\nNew commits:",
    "created_at": "2022-04-30T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142384",
    "user": "https://github.com/dcoudert"
}
```

Based on #comment:3, I have added algorithm `'parallel'`. It's working well but when I tried to set it as default algorithm, I get the following issue. So it seems safer to let `'DLX'` as default algorithm to avoid random doctest errors.

```
sage -t --warn-long 290.4 --random-seed=83463765161747970581723517233090779640 src/sage/graphs/generators/smallgraphs.py
**********************************************************************
File "src/sage/graphs/generators/smallgraphs.py", line 4506, in sage.graphs.generators.smallgraphs.WatkinsSnarkGraph
Failed example:
    g.chromatic_number()
Expected:
    3
Got:
    Exception raised by child process with pid=40818:
    3
```

----
New commits:



---

archive/issue_comments_142385.json:
```json
{
    "body": "To see that there is no clear winner between `DLX` and `MILP` (with `cplex` as default solver):\n\n```\nsage: from collections import Counter\nsage: count = Counter()\nsage: def use_all(f, algorithms):\n....:     @parallel(len(algorithms), verbose=False)\n....:     def h(alg):\n....:         return f(algorithm=alg)\n....:     for input, output in h(algorithms):\n....:         return output, input[0][0]\nsage: for i in range(100):\n....:     g = graphs.RandomGNP(20, .5)\n....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])\n....:     count[algo] += 1\nsage: count\nCounter({'DLX': 79, 'MILP': 21})\nsage: count = Counter()\nsage: for i in range(100):\n....:     g = graphs.RandomGNP(30, .4)\n....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])\n....:     count[algo] += 1\nsage: count\nCounter({'MILP': 74, 'DLX': 26})\n```\n",
    "created_at": "2022-04-30T14:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142385",
    "user": "https://github.com/dcoudert"
}
```

To see that there is no clear winner between `DLX` and `MILP` (with `cplex` as default solver):

```
sage: from collections import Counter
sage: count = Counter()
sage: def use_all(f, algorithms):
....:     @parallel(len(algorithms), verbose=False)
....:     def h(alg):
....:         return f(algorithm=alg)
....:     for input, output in h(algorithms):
....:         return output, input[0][0]
sage: for i in range(100):
....:     g = graphs.RandomGNP(20, .5)
....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
....:     count[algo] += 1
sage: count
Counter({'DLX': 79, 'MILP': 21})
sage: count = Counter()
sage: for i in range(100):
....:     g = graphs.RandomGNP(30, .4)
....:     c, algo = use_all(g.chromatic_number, ['DLX', 'MILP', 'CP'])
....:     count[algo] += 1
sage: count
Counter({'MILP': 74, 'DLX': 26})
```




---

archive/issue_comments_142386.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-21T12:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_142387.json:
```json
{
    "body": "the preview doctest was subject to errors. This is more robust now.",
    "created_at": "2022-05-21T12:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142387",
    "user": "https://github.com/dcoudert"
}
```

the preview doctest was subject to errors. This is more robust now.



---

archive/issue_comments_142388.json:
```json
{
    "body": "The random doctest errors reported by the patchbot are independent from this ticket and tracked in #32773 and #33880.",
    "created_at": "2022-05-21T16:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12207",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12207#issuecomment-142388",
    "user": "https://github.com/dcoudert"
}
```

The random doctest errors reported by the patchbot are independent from this ticket and tracked in #32773 and #33880.
