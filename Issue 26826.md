# Issue 26826: Polyhedron: let CombinatorialPolyhedron do all combinatorial calculations

Issue created by migration from https://trac.sagemath.org/ticket/27063

Original creator: @kliem

Original creation time: 2019-01-15 16:40:58

CC:  jipilab mkoeppe

Keywords: polyhedron, face lattice

In #26887 we create a new class, that handles the calculations depending only on the combinatorial type much more quickly. This includes the following methods of the class Polyhedron:

- face_lattice
- faces
- f_vector
- vertex_graph
- vertex_digraph (?)
- neighborliness

Maybe adding new methods concerning flag-vector, h-Vector k-simplicial, k-neighborly etc.


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by @kliem created at 2019-06-14 06:51:53

Last 10 new commits:


---

Comment by git created at 2019-06-14 11:42:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by jipilab created at 2019-08-27 19:26:37

Concerning the `.faces()` method. Currently, `.iter_face` only deals with proper faces. ... is that the intended behavior?

From an old list (so maybe some of them are renamed), I also saw the following methods make use of `.face_lattice`, and probably would benefit from the combinatorial polyhedra:

 - adjacency_matrix
 - facet_adjacency_matrix
 - facial_adjacencies
 - is_simple
 - vertex_adjacency_matrix

It would be nice to make a thorough checking of which methods make use of "old style face lattice" things. It would be bad to not make the whole `Polyhedron` objects not benefit from this new class...


---

Comment by @kliem created at 2019-08-27 20:05:38

Replying to [comment:7 jipilab]:
> Concerning the `.faces()` method. Currently, `.iter_face` only deals with proper faces. ... is that the intended behavior?

This is simply, because my method of intersecting faces and avoiding double counting has no guarantee to hit the empty face in the unbounded case. So one has to manually add it anyway. I would prefer leaving it like this in `FaceIterator`. But I can see that one wants to add those two extra faces (or only one for the empty polyhedron) when wrapping the class.
> 
> From an old list (so maybe some of them are renamed), I also saw the following methods make use of `.face_lattice`, and probably would benefit from the combinatorial polyhedra:
> 
>  - adjacency_matrix
>  - facet_adjacency_matrix
>  - facial_adjacencies
what does it do, I can't find it
>  - is_simple
not anymore
>  - vertex_adjacency_matrix
> 
> It would be nice to make a thorough checking of which methods make use of "old style face lattice" things. It would be bad to not make the whole `Polyhedron` objects not benefit from this new class...

Yes, that's my plan. If I actually go through with it and make `CombinatorialPolyhedron` a parent of `Polyhedron_base`, as was proposed in #10777, then `CombinatorialPolyhedron` should do all calculations that depend only on the incidence matrix.


---

Comment by jipilab created at 2019-08-27 20:34:01

Replying to [comment:8 gh-kliem]:
> Replying to [comment:7 jipilab]:
> > Concerning the `.faces()` method. Currently, `.iter_face` only deals with proper faces. ... is that the intended behavior?
> 
> This is simply, because my method of intersecting faces and avoiding double counting has no guarantee to hit the empty face in the unbounded case. So one has to manually add it anyway. I would prefer leaving it like this in `FaceIterator`. But I can see that one wants to add those two extra faces (or only one for the empty polyhedron) when wrapping the class.

Sounds good.

> > 
> > From an old list (so maybe some of them are renamed), I also saw the following methods make use of `.face_lattice`, and probably would benefit from the combinatorial polyhedra:
> > 
> >  - adjacency_matrix
> >  - facet_adjacency_matrix
> >  - facial_adjacencies
> what does it do, I can't find it
Then, fine.
> >  - is_simple
> not anymore
Good
> >  - vertex_adjacency_matrix
> > 
> > It would be nice to make a thorough checking of which methods make use of "old style face lattice" things. It would be bad to not make the whole `Polyhedron` objects not benefit from this new class...
> 
> Yes, that's my plan. If I actually go through with it and make `CombinatorialPolyhedron` a parent of `Polyhedron_base`, as was proposed in #10777, then `CombinatorialPolyhedron` should do all calculations that depend only on the incidence matrix.

Great! Then, one should also take care to not let the `Polyhedron_base` overwrite them, but duh... I'm sure you know what your doing... :)


---

Comment by @kliem created at 2019-08-27 20:59:50

Replying to [comment:9 jipilab]:
> Great! Then, one should also take care to not let the `Polyhedron_base` overwrite them, but duh... I'm sure you know what your doing... :)

Well, you can always access overwritten methods using `super`.

Does it make sense to leave a method as e.g. `simple` in `Polyhedron_base` just to have a more specific docstring? Otherwise we would eventually end up with docstrings gathering all examples from `Polyhedron`, `LatticePolytope` and `Cone`.


---

Comment by jipilab created at 2019-09-01 10:04:55

Replying to [comment:10 gh-kliem]:
> Replying to [comment:9 jipilab]:
> > Great! Then, one should also take care to not let the `Polyhedron_base` overwrite them, but duh... I'm sure you know what your doing... :)
> 
> Well, you can always access overwritten methods using `super`.
> 
> Does it make sense to leave a method as e.g. `simple` in `Polyhedron_base` just to have a more specific docstring? Otherwise we would eventually end up with docstrings gathering all examples from `Polyhedron`, `LatticePolytope` and `Cone`.

I am not 100% sure about this. I believe that the method would stay in `Polyhedron_base` (think about the documentation online too) because one expects to see it there (and one does not directly think about the `CombinatorialPolyhedron` class directly, maybe) and the method would be only a couple of lines long and calling the combinatorial algorithm using `super` with the appropriate parameters.

On the long run, `CombinatorialPolyhedron` will contain the bulk of codes that strictly makes use of combinatorial data and `Polyhedron_base` things that use the geometry.

Further, concerning the present ticket, I believe it would make sense to make it a preparation ticket. Then each method would have 1 ticket. This way the changes will be more manageable.

Another open question: currently how is the relation between a `Polyhedron` object and a `CombinatorialPolyhedron` object? I guess that as of now, since the double description is computed by default, it is worth maybe creating the combinatorial counter part as an attribute and make it accessible via a method say named `.combinatorial_polyhedron`. This might make it easier to then transfer the computations to the combinatorial type.

When I create a combinatorial polyhedron from a polyhedron, it seems to keep the polyhedron object. Ideally, it would be nice to be able to go back and forth between them like it is for `LP` and `Polyhedron` (okay, it is not fully bakc and forth but still).

... and it would be nice if the methods of `CombinatorialPolyhedron` have exactly the same names for the same things `H_representation` vs `Hrepr`.


---

Comment by @kliem created at 2019-09-01 12:50:06

Ok, this is a bunch of things. I realized that at some point it makes sense to create some sort of meta ticket for `CombinatorialPolyhedron`, also I realize that this ticket is more an agenda than anything else.

First of all, we should figure out, whether `Polyhedron` shall inherit from `CombinatorialPolyhedron` as a base class or whether its better to have it as a (lazy) method available.

Having it as a base class was proposed in #10777.

Maybe I should start a discussion on sage-devel to see what (interested) people think.


---

Comment by @kliem created at 2019-10-18 06:40:18

I'm going to put this on needs review, so that people looking at #22420 will notice.

This way I can avoid adding each of the tickets to #22420.

If there is a better way of doing it, please tell me.


---

Comment by @kliem created at 2019-10-18 06:40:18

Changing status from new to needs_review.


---

Comment by jipilab created at 2019-10-18 07:38:08

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-10-18 07:38:08

Changing type from enhancement to task.


---

Comment by jipilab created at 2019-10-18 07:41:34

Replying to [comment:13 gh-kliem]:
> I'm going to put this on needs review, so that people looking at #22420 will notice.
> 
> This way I can avoid adding each of the tickets to #22420.
> 
> If there is a better way of doing it, please tell me.

Putting it at needs review is not the appropriate status. In #22420, change the title of the #27063 ticket to "TASK: XXX", where XXX is the current title. Then, what is written will be sufficient to understand what is going on in this ticket. No need to add every single ticket from here, to #22420.


---

Comment by jipilab created at 2019-10-18 07:44:59

> Finally, it might make sense to move code to `CombinatorialPolyhedron`. E.g. `is_prism` can be checked there and should only be checked there to avoid code duplication.

Yes, I agree, I adapted the description of the ticket.


---

Comment by jipilab created at 2019-10-26 11:47:37

Concerning the face lattice, when it is going to be done, it would be nice to verify if some functions are then obsolete. (For example `_make_polyhedron_face` which is only used in the `face_lattice` method.)


---

Comment by @kliem created at 2020-05-26 13:42:18

Obtaining a graph that has vertices of the polyhedron as vertices is really slow. If you expose the option to obtain a graph with the vertices being the corresponding indices, that is much much faster.


---

Comment by @kliem created at 2022-03-31 09:24:59

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-03-31 13:57:07

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-31 13:57:07

Mission accomplished!


---

Comment by mkoeppe created at 2022-05-11 02:14:43

Resolution: invalid
