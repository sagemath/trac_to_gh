# Issue 15987: incorrect translation of Bessel from Maxima?

archive/issues_015987.json:
```json
{
    "body": "From [https://groups.google.com/forum/#!topic/sage-support/IgC78rcdO7c this sage-suppot thread}:\n\n```\nBut other sums are simply wrong.\n\nk = var('k')\nsum(x^(2*k)/factorial(2*k),k,0,oo)\n\ngives\n\n-1/4*sqrt(2)*sqrt(pi)*x^(3/2)\n\nbut the answer should be sinh(x). \n\nHmm.  That shouldn't be happening, though I wouldn't be surprised if it didn't turn out as easy as that.\n\n(%i1) load(simplify_sum);\n(%o1) /Users/.../Sage-5.12-OSX-64bit-10.6.app/Contents/Reso\\\nurces/sage/local/share/maxima/5.29.1/share/solve_rec/simplify_sum.mac\n(%i3) display2d:false;\n\n(%o3) false\n(%i4) simplify_sum(sum(x^(2*k)/factorial(2*k),k,0,inf));\n\n(%o4) sqrt(%pi)*bessel_i(-1/2,x)*sqrt(x)/sqrt(2)\n\nSo I'm not sure why that would happen - maybe because of incorrect Bessel simplification?\n\nsage: maxima_calculus('bessel_i(-1/2,x)')\nbessel_i(-1/2,x)\nsage: _._sage_()\nsqrt(2)*sqrt(1/(pi*x))*cosh(x)\n\nThat gives cosh(x), which I think is what you meant.\n```\n\nI don't know why this would happen, but presumably it should be possible to track down without too much effort.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16224\n\n",
    "created_at": "2014-04-24T01:37:35Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "incorrect translation of Bessel from Maxima?",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15987",
    "user": "kcrisman"
}
```
From [https://groups.google.com/forum/#!topic/sage-support/IgC78rcdO7c this sage-suppot thread}:

```
But other sums are simply wrong.

k = var('k')
sum(x^(2*k)/factorial(2*k),k,0,oo)

gives

-1/4*sqrt(2)*sqrt(pi)*x^(3/2)

but the answer should be sinh(x). 

Hmm.  That shouldn't be happening, though I wouldn't be surprised if it didn't turn out as easy as that.

(%i1) load(simplify_sum);
(%o1) /Users/.../Sage-5.12-OSX-64bit-10.6.app/Contents/Reso\
urces/sage/local/share/maxima/5.29.1/share/solve_rec/simplify_sum.mac
(%i3) display2d:false;

(%o3) false
(%i4) simplify_sum(sum(x^(2*k)/factorial(2*k),k,0,inf));

(%o4) sqrt(%pi)*bessel_i(-1/2,x)*sqrt(x)/sqrt(2)

So I'm not sure why that would happen - maybe because of incorrect Bessel simplification?

sage: maxima_calculus('bessel_i(-1/2,x)')
bessel_i(-1/2,x)
sage: _._sage_()
sqrt(2)*sqrt(1/(pi*x))*cosh(x)

That gives cosh(x), which I think is what you meant.
```

I don't know why this would happen, but presumably it should be possible to track down without too much effort.

Issue created by migration from https://trac.sagemath.org/ticket/16224





---

archive/issue_comments_207523.json:
```json
{
    "body": "It's a problem in the automatic translation learning for `max_to_sr`. If we force it to learn about Bessel functions beforehand, there's no problem:\n\n```\nsage: var('k')\nk\nsage: sum(bessel_I(2,x),k,1,10)\n10*bessel_I(2, x)\nsage: sum(x^(2*k)/factorial(2*k),k,0,oo)\nsqrt(pi)*sqrt(x)*sqrt(1/(pi*x))*cosh(x)\nsage: from sage.interfaces.maxima_lib import *\nsage: sage_op_dict[operator.mul] #as it should be\n<ECL: MTIMES>\n```\n\nOn the other hand, in a fresh session:\n\n```\nsage: var('k')\nk\nsage: sum(x^(2*k)/factorial(2*k),k,0,oo)\n-1/4*sqrt(2)*sqrt(pi)*x^(3/2)\nsage: from sage.interfaces.maxima_lib import *\nsage: sage_op_dict[operator.mul]\n<ECL: %BESSEL_I>\n```\n\nThe problem is that the `bessel_I(-1/2,x)` gets immediately rewritten to another expression, so the default heuristics for `max_to_sr` fail. The remedy: initialize the translation of `%BESSEL_I`. This consists simply of adding the line\n\n```\n    sage.functions.bessel.bessel_I: \"%BESSEL_I\",\n```\n\nto sage_op_dict in sage/interfaces/maxima_lib.py",
    "created_at": "2014-04-24T03:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207523",
    "user": "nbruin"
}
```

It's a problem in the automatic translation learning for `max_to_sr`. If we force it to learn about Bessel functions beforehand, there's no problem:

```
sage: var('k')
k
sage: sum(bessel_I(2,x),k,1,10)
10*bessel_I(2, x)
sage: sum(x^(2*k)/factorial(2*k),k,0,oo)
sqrt(pi)*sqrt(x)*sqrt(1/(pi*x))*cosh(x)
sage: from sage.interfaces.maxima_lib import *
sage: sage_op_dict[operator.mul] #as it should be
<ECL: MTIMES>
```

On the other hand, in a fresh session:

```
sage: var('k')
k
sage: sum(x^(2*k)/factorial(2*k),k,0,oo)
-1/4*sqrt(2)*sqrt(pi)*x^(3/2)
sage: from sage.interfaces.maxima_lib import *
sage: sage_op_dict[operator.mul]
<ECL: %BESSEL_I>
```

The problem is that the `bessel_I(-1/2,x)` gets immediately rewritten to another expression, so the default heuristics for `max_to_sr` fail. The remedy: initialize the translation of `%BESSEL_I`. This consists simply of adding the line

```
    sage.functions.bessel.bessel_I: "%BESSEL_I",
```

to sage_op_dict in sage/interfaces/maxima_lib.py



---

archive/issue_comments_207524.json:
```json
{
    "body": "OK, this should do the trick. I've also made the routines produce an error rather than corrupt the dictionaries. That should make diagnosing such problems a little easier in the future.\n\nIf someone wants to add a doctest for this somewhere, go ahead.\n----\nNew commits:",
    "created_at": "2014-04-25T00:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207524",
    "user": "nbruin"
}
```

OK, this should do the trick. I've also made the routines produce an error rather than corrupt the dictionaries. That should make diagnosing such problems a little easier in the future.

If someone wants to add a doctest for this somewhere, go ahead.
----
New commits:



---

archive/issue_comments_207525.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-25T00:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207525",
    "user": "nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_207526.json:
```json
{
    "body": "On second thought we can probably do better than having to register all this in two spots:sage: \n\n```\nsage: bessel_I._maxima_()\nbessel_i\nsage: tbl=sage.symbolic.pynac.symbol_table['maxima']\nsage: tbl['bessel_i']\nbessel_I\n```\n\nso the information is there already. We should just let `sr_to_max` and `max_to_sr` look in those spots before reverting to just converting strings back and forth and trying to guess the appropriate symbols from that. That would provide an extra level and would mean that functions like `bessel_I` that are spelled differently in `maxima` and/or get rewritten can be converted without entering their translations in another spot.",
    "created_at": "2014-04-25T17:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207526",
    "user": "nbruin"
}
```

On second thought we can probably do better than having to register all this in two spots:sage: 

```
sage: bessel_I._maxima_()
bessel_i
sage: tbl=sage.symbolic.pynac.symbol_table['maxima']
sage: tbl['bessel_i']
bessel_I
```

so the information is there already. We should just let `sr_to_max` and `max_to_sr` look in those spots before reverting to just converting strings back and forth and trying to guess the appropriate symbols from that. That would provide an extra level and would mean that functions like `bessel_I` that are spelled differently in `maxima` and/or get rewritten can be converted without entering their translations in another spot.



---

archive/issue_comments_207527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-25T18:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207527",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_207528.json:
```json
{
    "body": "Replying to [comment:6 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[b7f21d5](http://git.sagemath.org/sage.git/commit/?id=b7f21d58b3a5bd58254e659e67aa947e166b5fd3)||`trac 16224: make max_to_sr look in sage.symbolic.pynac.symbol_table['maxima']`||\nThis should do a much more programmatic and hence more reliable job than forcing people to register the same information in yet another spot.",
    "created_at": "2014-04-25T18:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207528",
    "user": "nbruin"
}
```

Replying to [comment:6 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[b7f21d5](http://git.sagemath.org/sage.git/commit/?id=b7f21d58b3a5bd58254e659e67aa947e166b5fd3)||`trac 16224: make max_to_sr look in sage.symbolic.pynac.symbol_table['maxima']`||
This should do a much more programmatic and hence more reliable job than forcing people to register the same information in yet another spot.



---

archive/issue_comments_207529.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-21T09:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207529",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_207530.json:
```json
{
    "body": "reviewer patch adds doctest\n----\nNew commits:",
    "created_at": "2014-05-21T09:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207530",
    "user": "pbruin"
}
```

reviewer patch adds doctest
----
New commits:



---

archive/issue_comments_207531.json:
```json
{
    "body": "Thanks for both of your work!",
    "created_at": "2014-05-21T13:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207531",
    "user": "kcrisman"
}
```

Thanks for both of your work!



---

archive/issue_comments_207532.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-21T15:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15987",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15987#issuecomment-207532",
    "user": "vbraun"
}
```

Resolution: fixed
