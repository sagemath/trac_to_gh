# Issue 15987: incorrect translation of Bessel from Maxima?

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2014-04-24 01:37:35

From [https://groups.google.com/forum/#!topic/sage-support/IgC78rcdO7c this sage-suppot thread}:

```
But other sums are simply wrong.

k = var('k')
sum(x^(2*k)/factorial(2*k),k,0,oo)

gives

-1/4*sqrt(2)*sqrt(pi)*x^(3/2)

but the answer should be sinh(x). 

Hmm.  That shouldn't be happening, though I wouldn't be surprised if it didn't turn out as easy as that.

(%i1) load(simplify_sum);
(%o1) /Users/.../Sage-5.12-OSX-64bit-10.6.app/Contents/Reso\
urces/sage/local/share/maxima/5.29.1/share/solve_rec/simplify_sum.mac
(%i3) display2d:false;

(%o3) false
(%i4) simplify_sum(sum(x^(2*k)/factorial(2*k),k,0,inf));

(%o4) sqrt(%pi)*bessel_i(-1/2,x)*sqrt(x)/sqrt(2)

So I'm not sure why that would happen - maybe because of incorrect Bessel simplification?

sage: maxima_calculus('bessel_i(-1/2,x)')
bessel_i(-1/2,x)
sage: _._sage_()
sqrt(2)*sqrt(1/(pi*x))*cosh(x)

That gives cosh(x), which I think is what you meant.
```

I don't know why this would happen, but presumably it should be possible to track down without too much effort.


---

Comment by nbruin created at 2014-04-24 03:12:12

It's a problem in the automatic translation learning for `max_to_sr`. If we force it to learn about Bessel functions beforehand, there's no problem:

```
sage: var('k')
k
sage: sum(bessel_I(2,x),k,1,10)
10*bessel_I(2, x)
sage: sum(x^(2*k)/factorial(2*k),k,0,oo)
sqrt(pi)*sqrt(x)*sqrt(1/(pi*x))*cosh(x)
sage: from sage.interfaces.maxima_lib import *
sage: sage_op_dict[operator.mul] #as it should be
<ECL: MTIMES>
```

On the other hand, in a fresh session:

```
sage: var('k')
k
sage: sum(x^(2*k)/factorial(2*k),k,0,oo)
-1/4*sqrt(2)*sqrt(pi)*x^(3/2)
sage: from sage.interfaces.maxima_lib import *
sage: sage_op_dict[operator.mul]
<ECL: %BESSEL_I>
```

The problem is that the `bessel_I(-1/2,x)` gets immediately rewritten to another expression, so the default heuristics for `max_to_sr` fail. The remedy: initialize the translation of `%BESSEL_I`. This consists simply of adding the line

```
    sage.functions.bessel.bessel_I: "%BESSEL_I",
```

to sage_op_dict in sage/interfaces/maxima_lib.py


---

Comment by nbruin created at 2014-04-25 00:01:47

OK, this should do the trick. I've also made the routines produce an error rather than corrupt the dictionaries. That should make diagnosing such problems a little easier in the future.

If someone wants to add a doctest for this somewhere, go ahead.
----
New commits:


---

Comment by nbruin created at 2014-04-25 00:01:47

Changing status from new to needs_review.


---

Comment by nbruin created at 2014-04-25 17:13:03

On second thought we can probably do better than having to register all this in two spots:sage: 

```
sage: bessel_I._maxima_()
bessel_i
sage: tbl=sage.symbolic.pynac.symbol_table['maxima']
sage: tbl['bessel_i']
bessel_I
```

so the information is there already. We should just let `sr_to_max` and `max_to_sr` look in those spots before reverting to just converting strings back and forth and trying to guess the appropriate symbols from that. That would provide an extra level and would mean that functions like `bessel_I` that are spelled differently in `maxima` and/or get rewritten can be converted without entering their translations in another spot.


---

Comment by git created at 2014-04-25 18:25:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2014-04-25 18:27:11

Replying to [comment:6 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[b7f21d5](http://git.sagemath.org/sage.git/commit/?id=b7f21d58b3a5bd58254e659e67aa947e166b5fd3)||`trac 16224: make max_to_sr look in sage.symbolic.pynac.symbol_table['maxima']`||
This should do a much more programmatic and hence more reliable job than forcing people to register the same information in yet another spot.


---

Comment by pbruin created at 2014-05-21 09:26:06

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2014-05-21 09:26:06

reviewer patch adds doctest
----
New commits:


---

Comment by kcrisman created at 2014-05-21 13:16:03

Thanks for both of your work!


---

Comment by vbraun created at 2014-05-21 15:33:34

Resolution: fixed
