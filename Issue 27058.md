# Issue 27058: Add GAP's Semigroups package to gap_packages

archive/issues_027058.json:
```json
{
    "body": "CC:  @dimpase @isuruf\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27295\n\n",
    "created_at": "2019-02-15T15:00:34Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Add GAP's Semigroups package to gap_packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27058",
    "user": "@nthiery"
}
```
CC:  @dimpase @isuruf



Issue created by migration from https://trac.sagemath.org/ticket/27295





---

archive/issue_comments_381174.json:
```json
{
    "body": "of these, only Semigroups doesn't want to get installed.\n\n```\n#W dlopen() error: libsemigroups.so.0: cannot open shared object file: No such file or directory\nError, module '/mnt/opt/Sage/sage-dev/local/share/gap/pkg/semigroups-3.0.20/bin/x86_64-pc-linux-gnu-default64/semigroups.so' not found in\n  if not LOAD_DYN( arg[1], false ) then\n    Error( \"no support for dynamic loading\" );\nfi; at /mnt/opt/Sage/sage-dev/local/share/gap/lib/files.gd:583 called from \n<function \"LoadDynamicModule\">( <arguments> )\n called from read-eval loop at /mnt/opt/Sage/sage-dev/local/share/gap/pkg/semigroups-3.0.20/init.g:26\nError, was not in any namespace at /mnt/opt/Sage/sage-dev/local/share/gap/lib/variable.g:291 called from\nLEAVE_NAMESPACE(  ); at /mnt/opt/Sage/sage-dev/local/share/gap/lib/package.gi:1253 called from\nReadPackage( pkgname, \"init.g\" ); at /mnt/opt/Sage/sage-dev/local/share/gap/lib/package.gi:1616 called from\n<function \"LoadPackage\">( <arguments> )\n called from read-eval loop at *stdin*:1\n...\n```\n\nAnd indeed:\n\n```\n$ find local/ -name semigroups.so\nlocal/lib/gap/pkg/semigroups-3.0.20/bin/x86_64-pc-linux-gnu-default64/semigroups.so\n$ find local/ -name libsemigroups.so\nlocal/lib/gap/pkg/semigroups-3.0.20/bin/lib/libsemigroups.so\n$ ldd `find local/ -name libsemigroups.so`\n\tlinux-vdso.so.1 (0x00007ffd85de3000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa1ffc9e000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libstdc++.so.6 (0x00007fa1ffa95000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fa1ff91a000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fa1ff74b000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libgcc_s.so.1 (0x00007fa1ff731000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fa1ffd35000)\n$ ldd `find local/ -name semigroups.so`\n\tlinux-vdso.so.1 (0x00007ffd8e160000)\n\tlibsemigroups.so.0 => not found\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fd7baaf4000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libstdc++.so.6 (0x00007fd7ba8eb000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fd7ba770000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fd7ba5a1000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libgcc_s.so.1 (0x00007fd7ba585000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fd7bab88000)\n```\n",
    "created_at": "2019-03-01T13:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381174",
    "user": "@dimpase"
}
```

of these, only Semigroups doesn't want to get installed.

```
#W dlopen() error: libsemigroups.so.0: cannot open shared object file: No such file or directory
Error, module '/mnt/opt/Sage/sage-dev/local/share/gap/pkg/semigroups-3.0.20/bin/x86_64-pc-linux-gnu-default64/semigroups.so' not found in
  if not LOAD_DYN( arg[1], false ) then
    Error( "no support for dynamic loading" );
fi; at /mnt/opt/Sage/sage-dev/local/share/gap/lib/files.gd:583 called from 
<function "LoadDynamicModule">( <arguments> )
 called from read-eval loop at /mnt/opt/Sage/sage-dev/local/share/gap/pkg/semigroups-3.0.20/init.g:26
Error, was not in any namespace at /mnt/opt/Sage/sage-dev/local/share/gap/lib/variable.g:291 called from
LEAVE_NAMESPACE(  ); at /mnt/opt/Sage/sage-dev/local/share/gap/lib/package.gi:1253 called from
ReadPackage( pkgname, "init.g" ); at /mnt/opt/Sage/sage-dev/local/share/gap/lib/package.gi:1616 called from
<function "LoadPackage">( <arguments> )
 called from read-eval loop at *stdin*:1
...
```

And indeed:

```
$ find local/ -name semigroups.so
local/lib/gap/pkg/semigroups-3.0.20/bin/x86_64-pc-linux-gnu-default64/semigroups.so
$ find local/ -name libsemigroups.so
local/lib/gap/pkg/semigroups-3.0.20/bin/lib/libsemigroups.so
$ ldd `find local/ -name libsemigroups.so`
	linux-vdso.so.1 (0x00007ffd85de3000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa1ffc9e000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libstdc++.so.6 (0x00007fa1ffa95000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fa1ff91a000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fa1ff74b000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libgcc_s.so.1 (0x00007fa1ff731000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fa1ffd35000)
$ ldd `find local/ -name semigroups.so`
	linux-vdso.so.1 (0x00007ffd8e160000)
	libsemigroups.so.0 => not found
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fd7baaf4000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libstdc++.so.6 (0x00007fd7ba8eb000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fd7ba770000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fd7ba5a1000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/8.3.0/libgcc_s.so.1 (0x00007fd7ba585000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fd7bab88000)
```




---

archive/issue_comments_381175.json:
```json
{
    "body": "This is after applying\n\n```diff\ndiff --git a/build/pkgs/gap_packages/spkg-install b/build/pkgs/gap_packages/spkg-install\nindex d8260b9aa0..4592675553 100644\n--- a/build/pkgs/gap_packages/spkg-install\n+++ b/build/pkgs/gap_packages/spkg-install\n@@ -19,6 +19,7 @@ sdh_install \\\n     crystcat \\\n     design \\\n     gbnp \\\n+    genss-* \\\n     Hap* \\\n     HAPcryst \\\n     hecke-* \\\n@@ -76,7 +77,7 @@ done\n # These packages have a new-style autoconf ./configure\n # that takes --with-gaproot\n \n-for pkg in nq-* io-*\n+for pkg in nq-* io-* orb-* digraphs-* semigroups-*\n do\n     cd \"$PKG_SRC_DIR/$pkg\"\n     sdh_configure --with-gaproot=\"$GAP_ROOT\"\n```\n\nto the branch of #26930.",
    "created_at": "2019-03-01T13:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381175",
    "user": "@dimpase"
}
```

This is after applying

```diff
diff --git a/build/pkgs/gap_packages/spkg-install b/build/pkgs/gap_packages/spkg-install
index d8260b9aa0..4592675553 100644
--- a/build/pkgs/gap_packages/spkg-install
+++ b/build/pkgs/gap_packages/spkg-install
@@ -19,6 +19,7 @@ sdh_install \
     crystcat \
     design \
     gbnp \
+    genss-* \
     Hap* \
     HAPcryst \
     hecke-* \
@@ -76,7 +77,7 @@ done
 # These packages have a new-style autoconf ./configure
 # that takes --with-gaproot
 
-for pkg in nq-* io-*
+for pkg in nq-* io-* orb-* digraphs-* semigroups-*
 do
     cd "$PKG_SRC_DIR/$pkg"
     sdh_configure --with-gaproot="$GAP_ROOT"
```

to the branch of #26930.



---

archive/issue_comments_381176.json:
```json
{
    "body": "This is a sort of upstream issue - they install a libsemigroup, a C++ library, in the tree, etc etc. I've opened https://github.com/gap-packages/Semigroups/issues/580\n---a clean way would be to install in advance, libsemigroup separately.",
    "created_at": "2019-03-01T13:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381176",
    "user": "@dimpase"
}
```

This is a sort of upstream issue - they install a libsemigroup, a C++ library, in the tree, etc etc. I've opened https://github.com/gap-packages/Semigroups/issues/580
---a clean way would be to install in advance, libsemigroup separately.



---

archive/issue_comments_381177.json:
```json
{
    "body": "upstream welcomes PRs, so I'll try doing this in a proper way.",
    "created_at": "2019-03-02T07:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381177",
    "user": "@dimpase"
}
```

upstream welcomes PRs, so I'll try doing this in a proper way.



---

archive/issue_comments_381178.json:
```json
{
    "body": "Changing keywords from \"\" to \"GAP packages, semigroups\".",
    "created_at": "2019-03-02T08:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381178",
    "user": "@dimpase"
}
```

Changing keywords from "" to "GAP packages, semigroups".



---

archive/issue_comments_381179.json:
```json
{
    "body": "`digraphs` includes its own copy of `bliss` and just trying to do the right thing they just digraphs name_spaced bliss functions.\n\n```\nfbissey@moonloop ~/sandbox/gap-4.10.0/pkg/digraphs-0.13.0 $ diff -u /dev/shm/portage/sci-libs/bliss-0.73-r1/work/bliss-0.73/bliss_C.h src/bliss-0.73/bliss_C.h \n--- /dev/shm/portage/sci-libs/bliss-0.73-r1/work/bliss-0.73/bliss_C.h   2015-09-01 19:23:10.000000000 +1200\n+++ src/bliss-0.73/bliss_C.h    2018-11-02 11:56:12.000000000 +1300\n@@ -1,5 +1,5 @@\n-#ifndef BLISS_C_H\n-#define BLISS_C_H\n+#ifndef bliss_digraphs_C_H\n+#define bliss_digraphs_C_H\n \n /*\n   Copyright (c) 2003-2015 Tommi Junttila\n@@ -37,14 +37,14 @@\n /**\n  * \\brief The true bliss graph is hiding behind this typedef.\n  */\n-typedef struct bliss_graph_struct BlissGraph;\n+typedef struct bliss_digraphs_graph_struct BlissGraph;\n....\n```\n",
    "created_at": "2019-03-04T01:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381179",
    "user": "@kiwifb"
}
```

`digraphs` includes its own copy of `bliss` and just trying to do the right thing they just digraphs name_spaced bliss functions.

```
fbissey@moonloop ~/sandbox/gap-4.10.0/pkg/digraphs-0.13.0 $ diff -u /dev/shm/portage/sci-libs/bliss-0.73-r1/work/bliss-0.73/bliss_C.h src/bliss-0.73/bliss_C.h 
--- /dev/shm/portage/sci-libs/bliss-0.73-r1/work/bliss-0.73/bliss_C.h   2015-09-01 19:23:10.000000000 +1200
+++ src/bliss-0.73/bliss_C.h    2018-11-02 11:56:12.000000000 +1300
@@ -1,5 +1,5 @@
-#ifndef BLISS_C_H
-#define BLISS_C_H
+#ifndef bliss_digraphs_C_H
+#define bliss_digraphs_C_H
 
 /*
   Copyright (c) 2003-2015 Tommi Junttila
@@ -37,14 +37,14 @@
 /**
  * \brief The true bliss graph is hiding behind this typedef.
  */
-typedef struct bliss_graph_struct BlissGraph;
+typedef struct bliss_digraphs_graph_struct BlissGraph;
....
```




---

archive/issue_comments_381180.json:
```json
{
    "body": "I don't seem to have a problem with digraphs, it installs just fine, and uses a static copy of bliss, it seems. \n\nDo you mean to say one has to watch out for something, still?",
    "created_at": "2019-03-04T07:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381180",
    "user": "@dimpase"
}
```

I don't seem to have a problem with digraphs, it installs just fine, and uses a static copy of bliss, it seems. 

Do you mean to say one has to watch out for something, still?



---

archive/issue_comments_381181.json:
```json
{
    "body": "Replying to [comment:9 dimpase]:\n> I don't seem to have a problem with digraphs, it installs just fine, and uses a static copy of bliss, it seems. \n> \n> Do you mean to say one has to watch out for something, still?\n\nNo, just don't like it I guess.",
    "created_at": "2019-03-04T07:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381181",
    "user": "@kiwifb"
}
```

Replying to [comment:9 dimpase]:
> I don't seem to have a problem with digraphs, it installs just fine, and uses a static copy of bliss, it seems. 
> 
> Do you mean to say one has to watch out for something, still?

No, just don't like it I guess.



---

archive/issue_comments_381182.json:
```json
{
    "body": "At least with semigroups, hopefully after my https://github.com/gap-packages/Semigroups/pull/584 is in, it can be done in a clean way.",
    "created_at": "2019-03-07T11:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381182",
    "user": "@dimpase"
}
```

At least with semigroups, hopefully after my https://github.com/gap-packages/Semigroups/pull/584 is in, it can be done in a clean way.



---

archive/issue_comments_381183.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> At least with semigroups, hopefully after my https://github.com/gap-packages/Semigroups/pull/584 is in, it can be done in a clean way.\n\nLooks good. It looks like that will have to wait gap-4.10.2 for it. I just finished updating all my sage-on-gentoo gap packages to offer 4.10.1 and I must say I was shocked when `orb` ditched autotools for a `gac` setup a la `crypting` which I think is an inferior solution. I hope it doesn't become a standard practise across gap packages.",
    "created_at": "2019-03-07T20:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381183",
    "user": "@kiwifb"
}
```

Replying to [comment:11 dimpase]:
> At least with semigroups, hopefully after my https://github.com/gap-packages/Semigroups/pull/584 is in, it can be done in a clean way.

Looks good. It looks like that will have to wait gap-4.10.2 for it. I just finished updating all my sage-on-gentoo gap packages to offer 4.10.1 and I must say I was shocked when `orb` ditched autotools for a `gac` setup a la `crypting` which I think is an inferior solution. I hope it doesn't become a standard practise across gap packages.



---

archive/issue_comments_381184.json:
```json
{
    "body": "Upstream has https://github.com/gap-packages/Semigroups/tree/v3.1.2 which has all the needed changes. Should we make a separate optional package for this?",
    "created_at": "2019-03-19T12:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381184",
    "user": "@dimpase"
}
```

Upstream has https://github.com/gap-packages/Semigroups/tree/v3.1.2 which has all the needed changes. Should we make a separate optional package for this?



---

archive/issue_comments_381185.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381185",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_381186.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381186",
    "user": "@embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_381187.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-01T15:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381187",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_381188.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-01T15:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381188",
    "user": "@dimpase"
}
```

New commits:



---

archive/issue_comments_381189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-01T15:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381189",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381190.json:
```json
{
    "body": "Doesn't Digraphs have the same problem with planarity?",
    "created_at": "2019-07-02T17:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381190",
    "user": "@isuruf"
}
```

Doesn't Digraphs have the same problem with planarity?



---

archive/issue_comments_381191.json:
```json
{
    "body": "Replying to [comment:19 isuruf]:\n> Doesn't Digraphs have the same problem with planarity?\n\nsorry, what problem?",
    "created_at": "2019-07-02T17:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381191",
    "user": "@dimpase"
}
```

Replying to [comment:19 isuruf]:
> Doesn't Digraphs have the same problem with planarity?

sorry, what problem?



---

archive/issue_comments_381192.json:
```json
{
    "body": "Replying to [comment:20 dimpase]:\n> Replying to [comment:19 isuruf]:\n> > Doesn't Digraphs have the same problem with planarity?\n> \n> sorry, what problem?\n\nThis: https://github.com/gap-packages/Digraphs/pull/207\n\nAny version of Digraphs we include in Sage should have this patch, and should be built with `--with-external-planarity` (as such, libplanarity then needs to be a dependency of gap_packages, assuming it isn't already).",
    "created_at": "2019-07-04T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381192",
    "user": "@embray"
}
```

Replying to [comment:20 dimpase]:
> Replying to [comment:19 isuruf]:
> > Doesn't Digraphs have the same problem with planarity?
> 
> sorry, what problem?

This: https://github.com/gap-packages/Digraphs/pull/207

Any version of Digraphs we include in Sage should have this patch, and should be built with `--with-external-planarity` (as such, libplanarity then needs to be a dependency of gap_packages, assuming it isn't already).



---

archive/issue_comments_381193.json:
```json
{
    "body": "IIRC there are also some patches to libplanarity that are needed by digraphs.  Isuru would know what they are since he included them in the conda package.",
    "created_at": "2019-07-04T13:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381193",
    "user": "@embray"
}
```

IIRC there are also some patches to libplanarity that are needed by digraphs.  Isuru would know what they are since he included them in the conda package.



---

archive/issue_comments_381194.json:
```json
{
    "body": "Does this imply that this ticket is (abot) broken, as it adds Digraphs in an \"old\" way?\nHow does one test?\n\nNote that https://github.com/gap-packages/Digraphs/pull/207 isn't even in a released version of Digraphs.",
    "created_at": "2019-07-04T13:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381194",
    "user": "@dimpase"
}
```

Does this imply that this ticket is (abot) broken, as it adds Digraphs in an "old" way?
How does one test?

Note that https://github.com/gap-packages/Digraphs/pull/207 isn't even in a released version of Digraphs.



---

archive/issue_comments_381195.json:
```json
{
    "body": "Only patch needed by planarity is extern patch that sage already has.\n\n> Does this imply that this ticket is (abot) broken, as it adds Digraphs in an \"old\" way? How does one test? \n\nProbably. Digraphs adds planarity as a subdirectory just like semigroups does with libsemigroups and therefore planarity inside digraphs is not installed. Since planarity is installed in sage and the two versions of planarity are ABI compatible, you might not see a missing planarity issue. This would break if planarity versions differ in Digraphs and Sage which is pretty unlikely since planarity changes rarely.",
    "created_at": "2019-07-04T13:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381195",
    "user": "@isuruf"
}
```

Only patch needed by planarity is extern patch that sage already has.

> Does this imply that this ticket is (abot) broken, as it adds Digraphs in an "old" way? How does one test? 

Probably. Digraphs adds planarity as a subdirectory just like semigroups does with libsemigroups and therefore planarity inside digraphs is not installed. Since planarity is installed in sage and the two versions of planarity are ABI compatible, you might not see a missing planarity issue. This would break if planarity versions differ in Digraphs and Sage which is pretty unlikely since planarity changes rarely.



---

archive/issue_comments_381196.json:
```json
{
    "body": "Replying to [comment:24 isuruf]:\n> Only patch needed by planarity is extern patch that sage already has.\n> \n> > Does this imply that this ticket is (abot) broken, as it adds Digraphs in an \"old\" way? How does one test? \n> \n> Probably. Digraphs adds planarity as a subdirectory just like semigroups does with libsemigroups and therefore planarity inside digraphs is not installed. Since planarity is installed in sage and the two versions of planarity are ABI compatible, you might not see a missing planarity issue. This would break if planarity versions differ in Digraphs and Sage which is pretty unlikely since planarity changes rarely.\n\nYou're right that `Digraphs` pick up Sage's libplanarity.so:\n\n```\n$ ldd local/lib/gap/pkg/digraphs-0.15.2/bin/x86_64-pc-linux-gnu-default64-kv3/digraphs.so\n\tlinux-vdso.so.1 (0x00007fff9bdb7000)\n\tlibplanarity.so.0 => /mnt/opt/Sage/sage-dev/local/lib/libplanarity.so.0 (0x00007f55c349d000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libstdc++.so.6 (0x00007f55c3200000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f55c30c3000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f55c2ef3000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libgcc_s.so.1 (0x00007f55c2ed9000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f55c350e000)\n```\n\n\nSo in this sense the only thing to fix is to add `planarity` to dependencies of `gap_packages`. I've checked that `Digraphs` passes its own testsuite, just in case.",
    "created_at": "2019-07-04T15:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381196",
    "user": "@dimpase"
}
```

Replying to [comment:24 isuruf]:
> Only patch needed by planarity is extern patch that sage already has.
> 
> > Does this imply that this ticket is (abot) broken, as it adds Digraphs in an "old" way? How does one test? 
> 
> Probably. Digraphs adds planarity as a subdirectory just like semigroups does with libsemigroups and therefore planarity inside digraphs is not installed. Since planarity is installed in sage and the two versions of planarity are ABI compatible, you might not see a missing planarity issue. This would break if planarity versions differ in Digraphs and Sage which is pretty unlikely since planarity changes rarely.

You're right that `Digraphs` pick up Sage's libplanarity.so:

```
$ ldd local/lib/gap/pkg/digraphs-0.15.2/bin/x86_64-pc-linux-gnu-default64-kv3/digraphs.so
	linux-vdso.so.1 (0x00007fff9bdb7000)
	libplanarity.so.0 => /mnt/opt/Sage/sage-dev/local/lib/libplanarity.so.0 (0x00007f55c349d000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libstdc++.so.6 (0x00007f55c3200000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f55c30c3000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f55c2ef3000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/9.1.0/libgcc_s.so.1 (0x00007f55c2ed9000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f55c350e000)
```


So in this sense the only thing to fix is to add `planarity` to dependencies of `gap_packages`. I've checked that `Digraphs` passes its own testsuite, just in case.



---

archive/issue_comments_381197.json:
```json
{
    "body": "Would still be best to use `--with-external-planarity` if possible.  Or if nothing else, delete the vendored copy it builds before installing into Sage if we definitely don't need it.",
    "created_at": "2019-07-04T15:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381197",
    "user": "@embray"
}
```

Would still be best to use `--with-external-planarity` if possible.  Or if nothing else, delete the vendored copy it builds before installing into Sage if we definitely don't need it.



---

archive/issue_comments_381198.json:
```json
{
    "body": "Since there hasn't been a release of Digraphs, it wouldn't work, but it's still okay to add `--with-external-planarity` and released Digraph's configure just ignores it and you wouldn't have to do anything when a new release comes in.",
    "created_at": "2019-07-04T16:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381198",
    "user": "@isuruf"
}
```

Since there hasn't been a release of Digraphs, it wouldn't work, but it's still okay to add `--with-external-planarity` and released Digraph's configure just ignores it and you wouldn't have to do anything when a new release comes in.



---

archive/issue_comments_381199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-04T16:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381199",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-04T16:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381200",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381201.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-04T16:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381201",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_381202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-04T16:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381202",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381203.json:
```json
{
    "body": "Replying to [comment:27 isuruf]:\n> Since there hasn't been a release of Digraphs, it wouldn't work, but it's still okay to add `--with-external-planarity` and released Digraph's configure just ignores it and you wouldn't have to do anything when a new release comes in.\n\nI've added this, and missing deps, and the correct tarball checksum for libsemigroups from #27396. I didn't try to remove dead wood copy of planarity installed by\nDigraph, as this appears to be harmless, and won't be needed once we get updated Digraph.",
    "created_at": "2019-07-04T16:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381203",
    "user": "@dimpase"
}
```

Replying to [comment:27 isuruf]:
> Since there hasn't been a release of Digraphs, it wouldn't work, but it's still okay to add `--with-external-planarity` and released Digraph's configure just ignores it and you wouldn't have to do anything when a new release comes in.

I've added this, and missing deps, and the correct tarball checksum for libsemigroups from #27396. I didn't try to remove dead wood copy of planarity installed by
Digraph, as this appears to be harmless, and won't be needed once we get updated Digraph.



---

archive/issue_comments_381204.json:
```json
{
    "body": "Dear me, I forgot those horrors so fast. No only does Digraphs use plain \"planarity\" it also include its own vendored (and prefixed so it doesn't clash) version of bliss-0.73. I had some fun patching that in 0.13.0 and 0.15.0. No I may have to reproduce it for 0.15.2.",
    "created_at": "2019-07-04T20:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381204",
    "user": "@kiwifb"
}
```

Dear me, I forgot those horrors so fast. No only does Digraphs use plain "planarity" it also include its own vendored (and prefixed so it doesn't clash) version of bliss-0.73. I had some fun patching that in 0.13.0 and 0.15.0. No I may have to reproduce it for 0.15.2.



---

archive/issue_comments_381205.json:
```json
{
    "body": "This package vendors bliss. Is that okay?",
    "created_at": "2019-07-17T16:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381205",
    "user": "@isuruf"
}
```

This package vendors bliss. Is that okay?



---

archive/issue_comments_381206.json:
```json
{
    "body": "We know about vendored bliss. It builds it statically, so it should not be a show-stopper. It should be unvendored upstream. \n\nSome of us actually do research in semigroup algorithms, so we want it in...",
    "created_at": "2019-07-17T16:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381206",
    "user": "@dimpase"
}
```

We know about vendored bliss. It builds it statically, so it should not be a show-stopper. It should be unvendored upstream. 

Some of us actually do research in semigroup algorithms, so we want it in...



---

archive/issue_comments_381207.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-17T16:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381207",
    "user": "@isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_381208.json:
```json
{
    "body": "Do you mind creating a new trac ticket for unvendoring bliss?",
    "created_at": "2019-07-17T16:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381208",
    "user": "@isuruf"
}
```

Do you mind creating a new trac ticket for unvendoring bliss?



---

archive/issue_comments_381209.json:
```json
{
    "body": "To be more precise, it's Digraphs, a dependency of Semigroups, that vendors bliss.\n\nSo this is  in fact https://github.com/gap-packages/Digraphs/issues/205",
    "created_at": "2019-07-17T17:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381209",
    "user": "@dimpase"
}
```

To be more precise, it's Digraphs, a dependency of Semigroups, that vendors bliss.

So this is  in fact https://github.com/gap-packages/Digraphs/issues/205



---

archive/issue_comments_381210.json:
```json
{
    "body": "I have an unvendoring patch in sage-on-gentoo, but it is minimal. I pass `LIBS=\"-lbliss -lplanarity -lgap\"` to configure, it should be improved to get configure to figure it itself. https://github.com/cschwan/sage-on-gentoo/blob/master/dev-gap/digraphs/files/digraphs-0.15.2-system_pkg.patch",
    "created_at": "2019-07-17T20:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381210",
    "user": "@kiwifb"
}
```

I have an unvendoring patch in sage-on-gentoo, but it is minimal. I pass `LIBS="-lbliss -lplanarity -lgap"` to configure, it should be improved to get configure to figure it itself. https://github.com/cschwan/sage-on-gentoo/blob/master/dev-gap/digraphs/files/digraphs-0.15.2-system_pkg.patch



---

archive/issue_comments_381211.json:
```json
{
    "body": "Improved unvendoring patch: https://github.com/cschwan/sage-on-gentoo/blob/master/dev-gap/digraphs/files/digraphs-0.15.2-system_pkg-r1.patch\n\n`configure` now searches for the libraries by itself.",
    "created_at": "2019-07-17T23:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381211",
    "user": "@kiwifb"
}
```

Improved unvendoring patch: https://github.com/cschwan/sage-on-gentoo/blob/master/dev-gap/digraphs/files/digraphs-0.15.2-system_pkg-r1.patch

`configure` now searches for the libraries by itself.



---

archive/issue_comments_381212.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-10T13:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381212",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_381213.json:
```json
{
    "body": "Seems to work on Cygwin too, FWIW.",
    "created_at": "2019-08-15T18:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27058#issuecomment-381213",
    "user": "@embray"
}
```

Seems to work on Cygwin too, FWIW.
