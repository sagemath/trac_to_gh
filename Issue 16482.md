# Issue 16482: not all gap integers get converted

archive/issues_016482.json:
```json
{
    "body": "CC:  @vbraun\n\nKeywords: gap, bignum, expect, pexpect\n\nAs first reported in #15625 (comment:7) with `lucas_number1`, the same problem is encountered with gap evaluation of Stirling numbers:\n\n```\nsage: stirling_number1(1000,2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-22-b29f3b3e2003> in <module>()\n----> 1 stirling_number1(Integer(1000),Integer(2))\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in stirling_number1(n, k)\n    650     \"\"\"\n    651     return Integer(gap.eval(\"Stirling1({0},{1})\".format(Integer(n),\n--> 652                                                         Integer(k))))\n    653 \n    654 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:7902)()\n\nTypeError: unable to convert x (=<integer 301...000 (2566 digits)>) to an integer\n```\n\nAlternatively, this ticket may discuss abandoning the GAP expect interface for such big number results and use libpari instead.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16719\n\n",
    "created_at": "2014-07-27T07:19:18Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "not all gap integers get converted",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16482",
    "user": "https://github.com/rwst"
}
```
CC:  @vbraun

Keywords: gap, bignum, expect, pexpect

As first reported in #15625 (comment:7) with `lucas_number1`, the same problem is encountered with gap evaluation of Stirling numbers:

```
sage: stirling_number1(1000,2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-22-b29f3b3e2003> in <module>()
----> 1 stirling_number1(Integer(1000),Integer(2))

/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in stirling_number1(n, k)
    650     """
    651     return Integer(gap.eval("Stirling1({0},{1})".format(Integer(n),
--> 652                                                         Integer(k))))
    653 
    654 

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:7902)()

TypeError: unable to convert x (=<integer 301...000 (2566 digits)>) to an integer
```

Alternatively, this ticket may discuss abandoning the GAP expect interface for such big number results and use libpari instead.

Issue created by migration from https://trac.sagemath.org/ticket/16719





---

archive/issue_comments_216466.json:
```json
{
    "body": "Changing component from interfaces to combinatorics.",
    "created_at": "2014-07-27T07:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216466",
    "user": "https://github.com/rwst"
}
```

Changing component from interfaces to combinatorics.



---

archive/issue_comments_216467.json:
```json
{
    "body": "Changing keywords from \"gap, bignum, expect, pexpect\" to \"gap, bignum, expect, pexpect, libgap\".",
    "created_at": "2014-07-27T07:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216467",
    "user": "https://github.com/rwst"
}
```

Changing keywords from "gap, bignum, expect, pexpect" to "gap, bignum, expect, pexpect, libgap".



---

archive/issue_comments_216468.json:
```json
{
    "body": "Changing keywords from \"gap, bignum, expect, pexpect, libgap\" to \"gap, bignum, expect, pexpect, libgap, stirling\".",
    "created_at": "2014-07-27T16:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216468",
    "user": "https://github.com/rwst"
}
```

Changing keywords from "gap, bignum, expect, pexpect, libgap" to "gap, bignum, expect, pexpect, libgap, stirling".



---

archive/issue_comments_216469.json:
```json
{
    "body": "Also with #16380 (which I've added as a dependency because it's not been put into a release yet), we don't have to worry about the startup time of libgap anymore (which was *really* annoying). +1 to doing this.",
    "created_at": "2014-07-27T19:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216469",
    "user": "https://github.com/tscrim"
}
```

Also with #16380 (which I've added as a dependency because it's not been put into a release yet), we don't have to worry about the startup time of libgap anymore (which was *really* annoying). +1 to doing this.



---

archive/issue_comments_216470.json:
```json
{
    "body": "This is blocked by:\n\n```\nsage: ans=libgap.eval(\"UnorderedTuples(['a','b','c'],2)\")\nsage: type(ans)\n<type 'sage.libs.gap.element.GapElement_List'>\nsage: a=ans.sage()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-4-43379484318b> in <module>()\n----> 1 a=ans.sage()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)()\n```\n\nSee #16750",
    "created_at": "2014-08-02T09:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216470",
    "user": "https://github.com/rwst"
}
```

This is blocked by:

```
sage: ans=libgap.eval("UnorderedTuples(['a','b','c'],2)")
sage: type(ans)
<type 'sage.libs.gap.element.GapElement_List'>
sage: a=ans.sage()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-4-43379484318b> in <module>()
----> 1 a=ans.sage()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)()
```

See #16750



---

archive/issue_comments_216471.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-02T13:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216471",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_216472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-03T07:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216473.json:
```json
{
    "body": "OK, now that strings get to GAP, back they get as `GapElement_List` of chars:\n\n```\nsage: ans = libgap.eval(\"UnorderedTuples(['a', 'b', 'c'],2)\"); ans\n[ \"aa\", \"ab\", \"ac\", \"bb\", \"bc\", \"cc\" ]\nsage: type(ans[0])\n<type 'sage.libs.gap.element.GapElement_List'>\nsage: ans.sage()\n[[\"'a'\", \"'a'\"],\n [\"'a'\", \"'b'\"],\n [\"'a'\", \"'c'\"],\n [\"'b'\", \"'b'\"],\n [\"'b'\", \"'c'\"],\n [\"'c'\", \"'c'\"]]\n```\n\nShouldn't lists of chars be converted to strings?",
    "created_at": "2014-08-03T07:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216473",
    "user": "https://github.com/rwst"
}
```

OK, now that strings get to GAP, back they get as `GapElement_List` of chars:

```
sage: ans = libgap.eval("UnorderedTuples(['a', 'b', 'c'],2)"); ans
[ "aa", "ab", "ac", "bb", "bc", "cc" ]
sage: type(ans[0])
<type 'sage.libs.gap.element.GapElement_List'>
sage: ans.sage()
[["'a'", "'a'"],
 ["'a'", "'b'"],
 ["'a'", "'c'"],
 ["'b'", "'b'"],
 ["'b'", "'c'"],
 ["'c'", "'c'"]]
```

Shouldn't lists of chars be converted to strings?



---

archive/issue_comments_216474.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-04T09:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216475.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-06T15:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216476.json:
```json
{
    "body": "It felt more natural to give tuples of chars as string, but tuples of char+string as list of strings. If the latter had been the original behaviour the GAP T_CHAR hassle wouldn't have been necessary.\n\nPlease review.",
    "created_at": "2014-08-06T15:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216476",
    "user": "https://github.com/rwst"
}
```

It felt more natural to give tuples of chars as string, but tuples of char+string as list of strings. If the latter had been the original behaviour the GAP T_CHAR hassle wouldn't have been necessary.

Please review.



---

archive/issue_comments_216477.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-06T15:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216477",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-20T14:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216479.json:
```json
{
    "body": "Note that this will conflict with #13982 for `unordered_tuples` (FYI I handled GAP's output as strings differently).",
    "created_at": "2014-08-22T03:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216479",
    "user": "https://github.com/tscrim"
}
```

Note that this will conflict with #13982 for `unordered_tuples` (FYI I handled GAP's output as strings differently).



---

archive/issue_comments_216480.json:
```json
{
    "body": "I wouldn't mind removing the unordered tuples bit from this patch, especially for speed reasons, and choice of algorithm. It's just that I don't like it that you simply remove that doctest that results in `['aa', 'ab', 'ac', 'bb', 'bc', 'cc']`. I think you should support it.",
    "created_at": "2014-08-22T06:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216480",
    "user": "https://github.com/rwst"
}
```

I wouldn't mind removing the unordered tuples bit from this patch, especially for speed reasons, and choice of algorithm. It's just that I don't like it that you simply remove that doctest that results in `['aa', 'ab', 'ac', 'bb', 'bc', 'cc']`. I think you should support it.



---

archive/issue_comments_216481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-26T10:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216482.json:
```json
{
    "body": "For `bell_number()`, I'm making the change at #17157, so you can remove that piece.",
    "created_at": "2014-10-15T21:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216482",
    "user": "https://github.com/jdemeyer"
}
```

For `bell_number()`, I'm making the change at #17157, so you can remove that piece.



---

archive/issue_comments_216483.json:
```json
{
    "body": "Reviewer patch needs review.\n----\nNew commits:",
    "created_at": "2014-10-16T09:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216483",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer patch needs review.
----
New commits:



---

archive/issue_comments_216484.json:
```json
{
    "body": "The reviewer commits look good to me. I've added a patch to make the calls to my beautiful library interface less ugly ;-)\n----\nNew commits:",
    "created_at": "2014-10-26T11:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216484",
    "user": "https://github.com/vbraun"
}
```

The reviewer commits look good to me. I've added a patch to make the calls to my beautiful library interface less ugly ;-)
----
New commits:



---

archive/issue_comments_216485.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-27T07:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216485",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_216486.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-10-27T11:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216486",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_216487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:",
    "created_at": "2014-10-27T11:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:



---

archive/issue_comments_216488.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-27T16:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16482",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16482#issuecomment-216488",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
