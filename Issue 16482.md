# Issue 16482: not all gap integers get converted

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-07-27 07:19:18

CC:  vbraun

Keywords: gap, bignum, expect, pexpect

As first reported in #15625 (comment:7) with `lucas_number1`, the same problem is encountered with gap evaluation of Stirling numbers:

```
sage: stirling_number1(1000,2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-22-b29f3b3e2003> in <module>()
----> 1 stirling_number1(Integer(1000),Integer(2))

/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in stirling_number1(n, k)
    650     """
    651     return Integer(gap.eval("Stirling1({0},{1})".format(Integer(n),
--> 652                                                         Integer(k))))
    653 
    654 

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:7902)()

TypeError: unable to convert x (=<integer 301...000 (2566 digits)>) to an integer
```

Alternatively, this ticket may discuss abandoning the GAP expect interface for such big number results and use libpari instead.


---

Comment by rws created at 2014-07-27 07:59:10

Changing component from interfaces to combinatorics.


---

Comment by rws created at 2014-07-27 07:59:10

Changing keywords from "gap, bignum, expect, pexpect" to "gap, bignum, expect, pexpect, libgap".


---

Comment by rws created at 2014-07-27 16:19:27

Changing keywords from "gap, bignum, expect, pexpect, libgap" to "gap, bignum, expect, pexpect, libgap, stirling".


---

Comment by tscrim created at 2014-07-27 19:58:26

Also with #16380 (which I've added as a dependency because it's not been put into a release yet), we don't have to worry about the startup time of libgap anymore (which was _really_ annoying). +1 to doing this.


---

Comment by rws created at 2014-08-02 09:31:29

This is blocked by:

```
sage: ans=libgap.eval("UnorderedTuples(['a','b','c'],2)")
sage: type(ans)
<type 'sage.libs.gap.element.GapElement_List'>
sage: a=ans.sage()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-4-43379484318b> in <module>()
----> 1 a=ans.sage()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement_List.sage (build/cythonized/sage/libs/gap/element.c:14661)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)()
```

See #16750


---

Comment by vbraun created at 2014-08-02 13:12:45

New commits:


---

Comment by git created at 2014-08-03 07:04:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-08-03 07:16:40

OK, now that strings get to GAP, back they get as `GapElement_List` of chars:

```
sage: ans = libgap.eval("UnorderedTuples(['a', 'b', 'c'],2)"); ans
[ "aa", "ab", "ac", "bb", "bc", "cc" ]
sage: type(ans[0])
<type 'sage.libs.gap.element.GapElement_List'>
sage: ans.sage()
[["'a'", "'a'"],
 ["'a'", "'b'"],
 ["'a'", "'c'"],
 ["'b'", "'b'"],
 ["'b'", "'c'"],
 ["'c'", "'c'"]]
```

Shouldn't lists of chars be converted to strings?


---

Comment by git created at 2014-08-04 09:46:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-06 15:32:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-08-06 15:37:07

It felt more natural to give tuples of chars as string, but tuples of char+string as list of strings. If the latter had been the original behaviour the GAP T_CHAR hassle wouldn't have been necessary.

Please review.


---

Comment by rws created at 2014-08-06 15:37:07

Changing status from new to needs_review.


---

Comment by git created at 2014-08-20 14:23:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-08-22 03:45:19

Note that this will conflict with #13982 for `unordered_tuples` (FYI I handled GAP's output as strings differently).


---

Comment by rws created at 2014-08-22 06:00:24

I wouldn't mind removing the unordered tuples bit from this patch, especially for speed reasons, and choice of algorithm. It's just that I don't like it that you simply remove that doctest that results in `['aa', 'ab', 'ac', 'bb', 'bc', 'cc']`. I think you should support it.


---

Comment by git created at 2014-08-26 10:29:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-10-15 21:46:06

For `bell_number()`, I'm making the change at #17157, so you can remove that piece.


---

Comment by jdemeyer created at 2014-10-16 09:59:18

Reviewer patch needs review.
----
New commits:


---

Comment by vbraun created at 2014-10-26 11:59:42

The reviewer commits look good to me. I've added a patch to make the calls to my beautiful library interface less ugly ;-)
----
New commits:


---

Comment by jdemeyer created at 2014-10-27 07:47:57

Changing status from needs_review to positive_review.


---

Comment by git created at 2014-10-27 11:54:55

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-10-27 11:54:55

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by vbraun created at 2014-10-27 16:02:28

Resolution: fixed
