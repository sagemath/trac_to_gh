# Issue 28546: fix opacity for add_condition in mono-coloured plot3d

Issue created by migration from https://trac.sagemath.org/ticket/28783

Original creator: chapoton

Original creation time: 2019-11-21 13:03:19

CC:  tscrim kcrisman vklein

as required by https://ask.sagemath.org/question/48752/translucency-lost-after-applying-add_condition-method/


---

Comment by chapoton created at 2019-11-21 13:03:47

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-11-21 13:03:47

New commits:


---

Comment by chapoton created at 2019-11-21 15:14:46

green bot, please review


---

Comment by kcrisman created at 2019-11-21 15:58:58

I like this.  A few questions:
* Are there any other attributes of `Texture` that may go missing in a similar way?  Might as well get them all at once.
* In particular, where does `texture.color` go - presumably it's used elsewhere?
* Can you think of a relevant doctest (perhaps from the ask.sagemath question) that could be added?


---

Comment by chapoton created at 2019-11-21 16:59:43

Replying to [comment:3 kcrisman]:
> I like this.  A few questions:
> * Are there any other attributes of `Texture` that may go missing in a similar way?  Might as well get them all at once.

No idea, and no time to check. I do not think so, I would say.

> * In particular, where does `texture.color` go - presumably it's used elsewhere?

Well, it's used everywhere. The Texture object that is transmitted after cutting the surface contains both the color and the opacity. For some reason the opacity is not fetched from the Texture but needs to be given through an additional parameter.

> * Can you think of a relevant doctest (perhaps from the ask.sagemath question) that could be added?

Well, one could test Q.texture.opacity after the cutting, sure.


---

Comment by kcrisman created at 2019-11-21 17:16:03

> > * Can you think of a relevant doctest (perhaps from the ask.sagemath question) that could be added?
> 
> Well, one could test Q.texture.opacity after the cutting, sure.

That sounds pretty reasonable, then.


---

Comment by git created at 2019-11-21 19:18:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-11-21 19:26:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-11-21 19:27:24

ok, here it is. The added doctest would fail before the branch, and passes after.


---

Comment by kcrisman created at 2019-11-21 19:27:37

There is something weird going on, at least with the Sage cell server running 8.9.  [This test](https://sagecell.sagemath.org/?z=eJw9jkEOgjAQRfck3GESFy1QieDGGLkDnIAQWkMNdkip0Hp6B6LO6s3_-fPHiyDeUMHSWc78trAkjmpSphHdWfIeZ-7TkAjuxbEUJUH4Qo8j2opZJZnAqeu1C9UpL8Si1arIcINV6jFvB6W6Q49Gar53JNc4Ahqr3MsaMOiow2chDXCroKBAQx_UeSdlu8ecRsN3EnAh-8AkUBUDbaDJn25sZ2c5GfOAK69_0PyVrEk-odVELQ==&lang=sage&interacts=eJyLjgUAARUAuQ==) shows that sometimes we only get the bug when things are plotted together.  Further, [this example](https://sagecell.sagemath.org/?z=eJw9jsEKwjAQRO-C_xB6Suu2mBY9CPFTKjEpGkibkERN-vVuS_WwMDvMztu38LRIkGEuyv0uDim-_EA4UVpGKq2xnhcPL3IBxDohdcz82JwxGjCkR2c0ejdnbOwUTX17yH1bz33LOQNCE9QddCWq_Fcz1G1zAhzcqmpDYqN1MfzIapB6FCZwtqAY2qERSt2knZSO2k7UiPGuBFlfv5D5SlPNyo3PgB3XuyY87YdW1VKNhvN6iuQ9-LA0lF8rpEsX&lang=sage&interacts=eJyLjgUAARUAuQ==) shows that the jsmol (at least on Sage cell server) seems not to be affected!  
----
New commits:


---

Comment by kcrisman created at 2019-11-21 19:30:45

Agreed that the new doctest is better and does capture the issue.  Unfortunately the other platform-dependent thing probably should be sorted out - or at least mentioned as "known bug" or something if you think they are somewhat orthogonal and deserve a different ticket.  Although I cannot test it on my local install now this should be the right solution.


---

Comment by chapoton created at 2019-11-23 13:01:28

I would say that any other problem should go to another ticket.


---

Comment by kcrisman created at 2019-11-24 03:05:42

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2019-11-24 03:05:42

If I run into them (or someone else does) with more detail, ok.  This ticket seems good to go, though as I say I can't test its efficacy in viewing it in a local build.


---

Comment by vbraun created at 2019-11-30 13:36:12

Resolution: fixed
