# Issue 12971: Use MathJax by default when building docs from Makefile

archive/issues_012971.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @nthiery\n\nKeywords: Makefile doc MathJax\n\nAt the moment, running `make` runs `make doc`, which in turn runs `make doc-html`. This runs Sphinx without the `-j` option, so MathJax (or jsMath, pre #9774) is not used: png image files are used instead. Using png images is much slower (although takes less disk space), so we should use MathJax (or jsMath) by default.\n\nTiming and disk space information:\n\nTutorial without MathJax: \n\n```\n$ rm -rf devel/sage/doc/output\n$ time sage --docbuild tutorial html\n...\nreal\t2m17.950s\nuser\t1m29.441s\nsys\t0m15.478s\n$ du -s -h devel/sage/doc/output\n3.9M\toutput/\n```\n\nWith MathJax:\n\n```\n$ rm -rf devel/sage/doc/output\n$ time sage --docbuild tutorial html -j\n...\nreal\t0m9.871s\nuser\t0m6.530s\nsys\t0m1.739s\n$ du -s -h devel/sage/doc/output\n 8.5M\toutput/\n```\n\nWhen building all of the documentation, the disk space goes from about 320 M (without MathJax) to about 465M (with).\n\nIssue created by migration from https://trac.sagemath.org/ticket/13143\n\n",
    "created_at": "2012-06-20T18:27:05Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "Use MathJax by default when building docs from Makefile",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12971",
    "user": "https://github.com/jhpalmieri"
}
```
Assignee: GeorgSWeber

CC:  @nthiery

Keywords: Makefile doc MathJax

At the moment, running `make` runs `make doc`, which in turn runs `make doc-html`. This runs Sphinx without the `-j` option, so MathJax (or jsMath, pre #9774) is not used: png image files are used instead. Using png images is much slower (although takes less disk space), so we should use MathJax (or jsMath) by default.

Timing and disk space information:

Tutorial without MathJax: 

```
$ rm -rf devel/sage/doc/output
$ time sage --docbuild tutorial html
...
real	2m17.950s
user	1m29.441s
sys	0m15.478s
$ du -s -h devel/sage/doc/output
3.9M	output/
```

With MathJax:

```
$ rm -rf devel/sage/doc/output
$ time sage --docbuild tutorial html -j
...
real	0m9.871s
user	0m6.530s
sys	0m1.739s
$ du -s -h devel/sage/doc/output
 8.5M	output/
```

When building all of the documentation, the disk space goes from about 320 M (without MathJax) to about 465M (with).

Issue created by migration from https://trac.sagemath.org/ticket/13143





---

archive/issue_comments_156452.json:
```json
{
    "body": "root repo",
    "created_at": "2012-06-20T18:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156452",
    "user": "https://github.com/jhpalmieri"
}
```

root repo



---

archive/issue_comments_156453.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-20T18:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156453",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156454.json:
```json
{
    "body": "Attachment [trac_13143-use-mathjax.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-use-mathjax.patch) by @jhpalmieri created at 2012-06-20 18:28:05",
    "created_at": "2012-06-20T18:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156454",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13143-use-mathjax.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-use-mathjax.patch) by @jhpalmieri created at 2012-06-20 18:28:05



---

archive/issue_comments_156455.json:
```json
{
    "body": "Here's a question.  I've noticed that sometimes looking at MathJax stuff when I'm not on the internet is less than great.  What is the story then?\n\nBut this certainly looks right.\n\nMaybe something should then also be added to the developer or installation guide (wherever the make options are documented other than in the Makefile) that points out how *not* to use MathJax in a build.   Like to do `make build doc-html` or whatever the correct syntax would be.",
    "created_at": "2012-07-05T16:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156455",
    "user": "https://github.com/kcrisman"
}
```

Here's a question.  I've noticed that sometimes looking at MathJax stuff when I'm not on the internet is less than great.  What is the story then?

But this certainly looks right.

Maybe something should then also be added to the developer or installation guide (wherever the make options are documented other than in the Makefile) that points out how *not* to use MathJax in a build.   Like to do `make build doc-html` or whatever the correct syntax would be.



---

archive/issue_comments_156456.json:
```json
{
    "body": "The \"v2\" patches do the following: \n\n- turn MathJax on by default, by modifying the script sage-env and by modifying how the variable's value is checked in the doc building files\n- pass the \"no-pdf-links\" option only when building the website document, so its presence (or lack) on the command-line doesn't cause the reference manual to be rebuilt.",
    "created_at": "2012-07-09T22:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156456",
    "user": "https://github.com/jhpalmieri"
}
```

The "v2" patches do the following: 

- turn MathJax on by default, by modifying the script sage-env and by modifying how the variable's value is checked in the doc building files
- pass the "no-pdf-links" option only when building the website document, so its presence (or lack) on the command-line doesn't cause the reference manual to be rebuilt.



---

archive/issue_comments_156457.json:
```json
{
    "body": "In response to Karl-Dieter's comment, I've added some documentation, to the \"environment variables\" section of the installation guide.",
    "created_at": "2012-07-10T03:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156457",
    "user": "https://github.com/jhpalmieri"
}
```

In response to Karl-Dieter's comment, I've added some documentation, to the "environment variables" section of the installation guide.



---

archive/issue_comments_156458.json:
```json
{
    "body": "Ok, this is more minimalist than I would like (i.e., have all the make targets documented somewhere) but I think it's appropriate for this ticket.  I'm sorry that I don't have time to give this full review, though again it seems ok.",
    "created_at": "2012-07-10T03:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156458",
    "user": "https://github.com/kcrisman"
}
```

Ok, this is more minimalist than I would like (i.e., have all the make targets documented somewhere) but I think it's appropriate for this ticket.  I'm sorry that I don't have time to give this full review, though again it seems ok.



---

archive/issue_comments_156459.json:
```json
{
    "body": "See #13219 for documentation of the make targets.",
    "created_at": "2012-07-10T04:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156459",
    "user": "https://github.com/jhpalmieri"
}
```

See #13219 for documentation of the make targets.



---

archive/issue_comments_156460.json:
```json
{
    "body": "Changing keywords from \"Makefile doc MathJax\" to \"Makefile doc MathJax sd40\".",
    "created_at": "2012-07-10T12:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156460",
    "user": "https://github.com/jhpalmieri"
}
```

Changing keywords from "Makefile doc MathJax" to "Makefile doc MathJax sd40".



---

archive/issue_comments_156461.json:
```json
{
    "body": "I had a problem with Latex creating thousands of errors on CentOS 4.7 (an old version of Linux, which I need to run for some commercial software). See discussion at:\n\nhttp://groups.google.com/forum/?fromgroups#!topic/sage-devel/7erAQRbHYUU\n\nAt John Palmieri's suggestion, I run:\n\n\n```\n$ rm -rf SAGE_ROOT/devel/sage/doc/output\n$ sage --docbuild all html -j\n```\n\n\nand the documentation built OK, with no errors. \n\n\nDave",
    "created_at": "2012-07-24T20:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156461",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

I had a problem with Latex creating thousands of errors on CentOS 4.7 (an old version of Linux, which I need to run for some commercial software). See discussion at:

http://groups.google.com/forum/?fromgroups#!topic/sage-devel/7erAQRbHYUU

At John Palmieri's suggestion, I run:


```
$ rm -rf SAGE_ROOT/devel/sage/doc/output
$ sage --docbuild all html -j
```


and the documentation built OK, with no errors. 


Dave



---

archive/issue_comments_156462.json:
```json
{
    "body": "root repo",
    "created_at": "2012-10-01T20:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156462",
    "user": "https://github.com/jhpalmieri"
}
```

root repo



---

archive/issue_comments_156463.json:
```json
{
    "body": "Attachment [trac_13143-sage.v2.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-sage.v2.patch) by @jhpalmieri created at 2012-10-01 20:35:42\n\nSage library",
    "created_at": "2012-10-01T20:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156463",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13143-sage.v2.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-sage.v2.patch) by @jhpalmieri created at 2012-10-01 20:35:42

Sage library



---

archive/issue_comments_156464.json:
```json
{
    "body": "Hi John,\n\nAs a prerequisite of #6495 I'm starting to review this one.\n\nFlorent",
    "created_at": "2012-10-04T12:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156464",
    "user": "https://github.com/hivert"
}
```

Hi John,

As a prerequisite of #6495 I'm starting to review this one.

Florent



---

archive/issue_comments_156465.json:
```json
{
    "body": "Hi Florent,\n\nGreat. Please let me know if you have any questions or comments.\n\n   John",
    "created_at": "2012-10-04T14:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156465",
    "user": "https://github.com/jhpalmieri"
}
```

Hi Florent,

Great. Please let me know if you have any questions or comments.

   John



---

archive/issue_comments_156466.json:
```json
{
    "body": "Hi John,\n\nReplying to [comment:18 jhpalmieri]:\n> Great. Please let me know if you have any questions or comments.\n\nI'm running into some problems. Here are what I did: on a fresh 5.4.rc0, I\nmade a clone and imported the two `v2` patches. Then I removed the\n`doc/output` directory and issued a\n\n```\nsage -docbuild reference html\n```\n\nAfter that some pages are perfectly Ok but for some other (I can't find a\npattern) there is a line in the bottom saying\n\n```\nLoading [MathJax]/fonts/HTML-CSS/TeX/png/imagedata.js\n```\n\nAnd after somehow ten seconds the text changes to\n\n```\nFile failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js\n```\n\nIndeed the file doesn't exists on my filesystem. By the way, I'm using\nFirefox 15.0 on openSuSE 12.1 64 bits.\n\nAm I missing something trivial ?\n\nCheers,\n\nFlorent",
    "created_at": "2012-10-05T15:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156466",
    "user": "https://github.com/hivert"
}
```

Hi John,

Replying to [comment:18 jhpalmieri]:
> Great. Please let me know if you have any questions or comments.

I'm running into some problems. Here are what I did: on a fresh 5.4.rc0, I
made a clone and imported the two `v2` patches. Then I removed the
`doc/output` directory and issued a

```
sage -docbuild reference html
```

After that some pages are perfectly Ok but for some other (I can't find a
pattern) there is a line in the bottom saying

```
Loading [MathJax]/fonts/HTML-CSS/TeX/png/imagedata.js
```

And after somehow ten seconds the text changes to

```
File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js
```

Indeed the file doesn't exists on my filesystem. By the way, I'm using
Firefox 15.0 on openSuSE 12.1 64 bits.

Am I missing something trivial ?

Cheers,

Florent



---

archive/issue_comments_156467.json:
```json
{
    "body": "Sorry for the two answers.\n\n> And after somehow ten seconds the text changes to\n> {{{\n> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js\n> }}}\n\nYou probably guessed it but after that the maths are replaced by a red\n`[Math Processing Error]`.\n\nCheers,\n\nFlorent",
    "created_at": "2012-10-05T15:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156467",
    "user": "https://github.com/hivert"
}
```

Sorry for the two answers.

> And after somehow ten seconds the text changes to
> {{{
> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js
> }}}

You probably guessed it but after that the maths are replaced by a red
`[Math Processing Error]`.

Cheers,

Florent



---

archive/issue_comments_156468.json:
```json
{
    "body": "Hi Florent,\n\nI have no idea. I tried on my machine (OS X). I browsed through 10-20 pages of the reference manual and saw no problems. Does this depend on this ticket? If you don't apply the patches and run\n\n```\nsage -docbuild reference html -j\n```\n\ndo you see the same problem?\n\n```\nFile failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js\n```\n\nI don't even see a \"png\" directory. I see \"eot\", \"otf\", and \"svg\" directories.",
    "created_at": "2012-10-05T18:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156468",
    "user": "https://github.com/jhpalmieri"
}
```

Hi Florent,

I have no idea. I tried on my machine (OS X). I browsed through 10-20 pages of the reference manual and saw no problems. Does this depend on this ticket? If you don't apply the patches and run

```
sage -docbuild reference html -j
```

do you see the same problem?

```
File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js
```

I don't even see a "png" directory. I see "eot", "otf", and "svg" directories.



---

archive/issue_comments_156469.json:
```json
{
    "body": "Replying to [comment:21 jhpalmieri]:\n> Hi Florent,\n> \n> I have no idea. I tried on my machine (OS X). I browsed through 10-20 pages of the reference manual and saw no problems. Does this depend on this ticket? If you don't apply the patches and run\n> {{{\n> sage -docbuild reference html -j\n> }}}\n> do you see the same problem?\n\nRunning... I can't wait having #6495 ;-)\n\n> {{{\n> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js\n> }}}\n> I don't even see a \"png\" directory. I see \"eot\", \"otf\", and \"svg\" directories.\n\nSorry I wasn't precise enough. The same holds for me.",
    "created_at": "2012-10-06T08:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156469",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:21 jhpalmieri]:
> Hi Florent,
> 
> I have no idea. I tried on my machine (OS X). I browsed through 10-20 pages of the reference manual and saw no problems. Does this depend on this ticket? If you don't apply the patches and run
> {{{
> sage -docbuild reference html -j
> }}}
> do you see the same problem?

Running... I can't wait having #6495 ;-)

> {{{
> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js
> }}}
> I don't even see a "png" directory. I see "eot", "otf", and "svg" directories.

Sorry I wasn't precise enough. The same holds for me.



---

archive/issue_comments_156470.json:
```json
{
    "body": "Apparently it has nothing to do with the patch... I'm trying with sage-5.3...\n\nFlorent",
    "created_at": "2012-10-06T10:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156470",
    "user": "https://github.com/hivert"
}
```

Apparently it has nothing to do with the patch... I'm trying with sage-5.3...

Florent



---

archive/issue_comments_156471.json:
```json
{
    "body": "So the problem has nothing to do with the patch here. MathJax math seems to be Ok on my laptop with sage 5.3 but are both broken with sage 5.4.rc0 and 5.4.rc1. More precisely I just did the following:\n\n- Build from sources a fresh 5.4.rc1\n- removed `devel/sage-main/doc/output/html/en/reference`\n- issued `./sage -docbuild reference html --mathjax`\n\nthen the file `index.html` displayed correctly in firefox but `devel/sage-main/doc/output/html/en/reference/sage/modular/modsym/p1list.html` was broken. The error message is the same as before. Any idea ? May this be related to #9774 ?\n\nFlorent",
    "created_at": "2012-10-07T14:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156471",
    "user": "https://github.com/hivert"
}
```

So the problem has nothing to do with the patch here. MathJax math seems to be Ok on my laptop with sage 5.3 but are both broken with sage 5.4.rc0 and 5.4.rc1. More precisely I just did the following:

- Build from sources a fresh 5.4.rc1
- removed `devel/sage-main/doc/output/html/en/reference`
- issued `./sage -docbuild reference html --mathjax`

then the file `index.html` displayed correctly in firefox but `devel/sage-main/doc/output/html/en/reference/sage/modular/modsym/p1list.html` was broken. The error message is the same as before. Any idea ? May this be related to #9774 ?

Florent



---

archive/issue_comments_156472.json:
```json
{
    "body": "There is also a problem with compiling the doc with `MathJax`. Some pages use advanced LateX stuff such as pictures. Unfortunately they doesn't work with `MathJax` activated. See eg:\n\n```\nsage/graphs/base/static_sparse_graph.pyx\n```\n\n\nCheers,\n\nFlorent",
    "created_at": "2012-10-07T19:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156472",
    "user": "https://github.com/hivert"
}
```

There is also a problem with compiling the doc with `MathJax`. Some pages use advanced LateX stuff such as pictures. Unfortunately they doesn't work with `MathJax` activated. See eg:

```
sage/graphs/base/static_sparse_graph.pyx
```


Cheers,

Florent



---

archive/issue_comments_156473.json:
```json
{
    "body": "Ideally, this would be dealt with by Sphinx (and I'm glad you wrote to sphinx-devel about it). But the documentation should be written so that it looks good with or without MathJax (or jsMath, in older versions of Sage). The `picture` mode LaTeX code isn't processed correctly with these: it only works with the pngmath Sphinx extension. (I checked some older versions of Sage, and it didn't work with jsMath either.) So I think the documentation should be changed: for pictures like these, someone should just produce some pngs and then include them, as is done in several other places in the docs. Indeed, that documentation should never have been allowed in Sage in the first place, since it didn't build using Sphinx's jsMath extension.\n\nI've been playing around with Sphinx, trying to see if there is a way to turn extensions like pngmath on or off using a function `process_mathjax` called like\n\n```\n    app.connect('autodoc-process-docstring', process_mathjax)\n```\n\nin the `setup` function at the end of devel/sage/doc/common/conf.py, but I haven't gotten anywhere yet.",
    "created_at": "2012-10-08T05:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156473",
    "user": "https://github.com/jhpalmieri"
}
```

Ideally, this would be dealt with by Sphinx (and I'm glad you wrote to sphinx-devel about it). But the documentation should be written so that it looks good with or without MathJax (or jsMath, in older versions of Sage). The `picture` mode LaTeX code isn't processed correctly with these: it only works with the pngmath Sphinx extension. (I checked some older versions of Sage, and it didn't work with jsMath either.) So I think the documentation should be changed: for pictures like these, someone should just produce some pngs and then include them, as is done in several other places in the docs. Indeed, that documentation should never have been allowed in Sage in the first place, since it didn't build using Sphinx's jsMath extension.

I've been playing around with Sphinx, trying to see if there is a way to turn extensions like pngmath on or off using a function `process_mathjax` called like

```
    app.connect('autodoc-process-docstring', process_mathjax)
```

in the `setup` function at the end of devel/sage/doc/common/conf.py, but I haven't gotten anywhere yet.



---

archive/issue_comments_156474.json:
```json
{
    "body": "Here is a patch which replaces several picture environments with pngs. I tried searching the Sage library for possible problems, but I don't know exactly what MathJax cannot handle, so I searched for files containing both \".. math\" and \"begin{\". These were the only instances I found which didn't render correctly with MathJax. I'm afraid it would be almost impossible to search the whole reference manual to look for other problems, since I think they only appear upon rendering in the web browser.",
    "created_at": "2012-10-08T20:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156474",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a patch which replaces several picture environments with pngs. I tried searching the Sage library for possible problems, but I don't know exactly what MathJax cannot handle, so I searched for files containing both ".. math" and "begin{". These were the only instances I found which didn't render correctly with MathJax. I'm afraid it would be almost impossible to search the whole reference manual to look for other problems, since I think they only appear upon rendering in the web browser.



---

archive/issue_comments_156475.json:
```json
{
    "body": "If this approach (pngs instead of picture environments) looks okay, I'll rebase #6495 on top of it.",
    "created_at": "2012-10-08T20:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156475",
    "user": "https://github.com/jhpalmieri"
}
```

If this approach (pngs instead of picture environments) looks okay, I'll rebase #6495 on top of it.



---

archive/issue_comments_156476.json:
```json
{
    "body": "Replying to [comment:19 hivert]:\n>       Hi John,\n> \n> Replying to [comment:18 jhpalmieri]:\n> > Great. Please let me know if you have any questions or comments.\n> \n> I'm running into some problems. Here are what I did: on a fresh 5.4.rc0, I\n> made a clone and imported the two `v2` patches. Then I removed the\n> `doc/output` directory and issued a\n> {{{\n> sage -docbuild reference html\n> }}}\n> After that some pages are perfectly Ok but for some other (I can't find a\n> pattern) there is a line in the bottom saying\n> {{{\n> Loading [MathJax]/fonts/HTML-CSS/TeX/png/imagedata.js\n> }}}\n> And after somehow ten seconds the text changes to\n> {{{\n> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js\n> }}}\n> Indeed the file doesn't exists on my filesystem. By the way, I'm using\n> Firefox 15.0 on openSuSE 12.1 64 bits.\n\nI still don't know what's going on with this. On several systems (OS X and sage.math.washington.edu), I don't see this. A few weeks ago, I made a version of the documentation using MathJax and #6495: [http://sage.math.washington.edu/home/palmieri/misc/6495-jsmath/html/en/index.html](http://sage.math.washington.edu/home/palmieri/misc/6495-jsmath/html/en/index.html). I skimmed through some pages, and don't see any of these problems. Do you have any ideas what could be causing it? I can't imagine why it would make a difference, but did you run `sage -b` in addition to removing `doc/output`? Is it repeatable, and are the web pages on which the problems occur repeatable?",
    "created_at": "2012-10-09T16:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156476",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:19 hivert]:
>       Hi John,
> 
> Replying to [comment:18 jhpalmieri]:
> > Great. Please let me know if you have any questions or comments.
> 
> I'm running into some problems. Here are what I did: on a fresh 5.4.rc0, I
> made a clone and imported the two `v2` patches. Then I removed the
> `doc/output` directory and issued a
> {{{
> sage -docbuild reference html
> }}}
> After that some pages are perfectly Ok but for some other (I can't find a
> pattern) there is a line in the bottom saying
> {{{
> Loading [MathJax]/fonts/HTML-CSS/TeX/png/imagedata.js
> }}}
> And after somehow ten seconds the text changes to
> {{{
> File failed to load: file:///home/data/Sage-Install/sage-5.4.rc0/devel/sage-doc/doc/output/html/en/reference/_static/fonts/HTML-CSS/TeX/png/imagedata.js
> }}}
> Indeed the file doesn't exists on my filesystem. By the way, I'm using
> Firefox 15.0 on openSuSE 12.1 64 bits.

I still don't know what's going on with this. On several systems (OS X and sage.math.washington.edu), I don't see this. A few weeks ago, I made a version of the documentation using MathJax and #6495: [http://sage.math.washington.edu/home/palmieri/misc/6495-jsmath/html/en/index.html](http://sage.math.washington.edu/home/palmieri/misc/6495-jsmath/html/en/index.html). I skimmed through some pages, and don't see any of these problems. Do you have any ideas what could be causing it? I can't imagine why it would make a difference, but did you run `sage -b` in addition to removing `doc/output`? Is it repeatable, and are the web pages on which the problems occur repeatable?



---

archive/issue_comments_156477.json:
```json
{
    "body": "As far as other possibly incompatible pieces of LaTeX in the Sage library, I haven't found any. I ran\n\n```\nsage: search_src('\\\\\\\\[a-zA-Z]', interact=False)\n```\n\nto get a list of all strings starting with a backslash and then a letter, then turned this into a list of all of the potential LaTeX commands used in Sage, and compared it to [MathJax's list](http://docs.mathjax.org/en/latest/tex.html#supported-latex-commands). For items on Sage's list that aren't recognized by MathJax, I looked at how they were used in the Sage library. This wasn't a very long list, and I admit that I wasn't extremely careful, but I didn't find any problems.",
    "created_at": "2012-10-09T22:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156477",
    "user": "https://github.com/jhpalmieri"
}
```

As far as other possibly incompatible pieces of LaTeX in the Sage library, I haven't found any. I ran

```
sage: search_src('\\\\[a-zA-Z]', interact=False)
```

to get a list of all strings starting with a backslash and then a letter, then turned this into a list of all of the potential LaTeX commands used in Sage, and compared it to [MathJax's list](http://docs.mathjax.org/en/latest/tex.html#supported-latex-commands). For items on Sage's list that aren't recognized by MathJax, I looked at how they were used in the Sage library. This wasn't a very long list, and I admit that I wasn't extremely careful, but I didn't find any problems.



---

archive/issue_comments_156478.json:
```json
{
    "body": "(I just fixed a typo in the commit message.)",
    "created_at": "2012-10-18T20:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156478",
    "user": "https://github.com/jhpalmieri"
}
```

(I just fixed a typo in the commit message.)



---

archive/issue_comments_156479.json:
```json
{
    "body": "Replying to [comment:30 jhpalmieri]:\n> As far as other possibly incompatible pieces of LaTeX in the Sage library, I haven't found any. I ran\n> {{{\n> sage: search_src('\\\\\\\\[a-zA-Z]', interact=False)\n> }}}\n> to get a list of all strings starting with a backslash and then a letter, then turned this into a list of all of the potential LaTeX commands used in Sage, and compared it to [MathJax's list](http://docs.mathjax.org/en/latest/tex.html#supported-latex-commands). For items on Sage's list that aren't recognized by MathJax, I looked at how they were used in the Sage library. This wasn't a very long list, and I admit that I wasn't extremely careful, but I didn't find any problems.\n\nHere is one thing I found: compare http://www.sagemath.org/doc/thematic_tutorials/numtheory_rsa.html and\nthe corresponding page in your output, somewhere in the middle:\n\n\n```\nFormally, let\n\n\u03a3={A,B,C,...,Z}\n\nbe the set of capital letters of the English alphabet. Furthermore, let\n```\n\nOn your pages (and also on my own build with this patch), the formula \\Sigma={A,B,C,...,Z} is broken (viewed on OSX10.6.8, with Chrome or with Safari). Namely, \nit looks like \u03a3={\\textttA,\\textttB,\\textttC,...,\\textttZ}, with \\texttt typeset in red.\n\nIn the source I see\n\n```\n.. MATH::\n\n    \\Sigma\n    =\n    \\{ \\texttt{A}, \\texttt{B}, \\texttt{C}, \\dots, \\texttt{Z} \\}\n\n```\n\nwhich look like 100% kosher TeX to me.\n\nCan you fix this in `MathJax` config?",
    "created_at": "2012-10-27T14:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156479",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:30 jhpalmieri]:
> As far as other possibly incompatible pieces of LaTeX in the Sage library, I haven't found any. I ran
> {{{
> sage: search_src('\\\\[a-zA-Z]', interact=False)
> }}}
> to get a list of all strings starting with a backslash and then a letter, then turned this into a list of all of the potential LaTeX commands used in Sage, and compared it to [MathJax's list](http://docs.mathjax.org/en/latest/tex.html#supported-latex-commands). For items on Sage's list that aren't recognized by MathJax, I looked at how they were used in the Sage library. This wasn't a very long list, and I admit that I wasn't extremely careful, but I didn't find any problems.

Here is one thing I found: compare http://www.sagemath.org/doc/thematic_tutorials/numtheory_rsa.html and
the corresponding page in your output, somewhere in the middle:


```
Formally, let

Σ={A,B,C,...,Z}

be the set of capital letters of the English alphabet. Furthermore, let
```

On your pages (and also on my own build with this patch), the formula \Sigma={A,B,C,...,Z} is broken (viewed on OSX10.6.8, with Chrome or with Safari). Namely, 
it looks like Σ={\textttA,\textttB,\textttC,...,\textttZ}, with \texttt typeset in red.

In the source I see

```
.. MATH::

    \Sigma
    =
    \{ \texttt{A}, \texttt{B}, \texttt{C}, \dots, \texttt{Z} \}

```

which look like 100% kosher TeX to me.

Can you fix this in `MathJax` config?



---

archive/issue_comments_156480.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-27T14:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156480",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156481.json:
```json
{
    "body": "Replying to [comment:32 dimpase]:\n\n> Can you fix this in `MathJax` config?\nThis appears to be a mathjax bug, of sorts, according to [google](http://www.mail-archive.com/wikibugs-l`@`lists.wikimedia.org/msg134519.html).\nIf I put the following into `Macro:` section of `mathjax_sage.js` in `output/html/en/thematic_tutorials/_static/` then it displays just right (`textfs` and `emph` are added just for good measure, as they suffer the same fate, apparently).\n\n\n```\ntexttt:             ['\\\\mathord{\\\\tt{\\\\text{#1}}}',1],\ntextsf:             ['\\\\mathord{\\\\sf{\\\\text{#1}}}',1],\nemph:               ['\\\\textit{#1}',1]\n }}}\n\napparently this should be added to the appropriate `mathjax_sage.js_t` file, although how to rebuild the docs to take care of this change this way, I don't know. If someone tells me this, I could come up with a patch.",
    "created_at": "2012-10-27T15:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156481",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:32 dimpase]:

> Can you fix this in `MathJax` config?
This appears to be a mathjax bug, of sorts, according to [google](http://www.mail-archive.com/wikibugs-l`@`lists.wikimedia.org/msg134519.html).
If I put the following into `Macro:` section of `mathjax_sage.js` in `output/html/en/thematic_tutorials/_static/` then it displays just right (`textfs` and `emph` are added just for good measure, as they suffer the same fate, apparently).


```
texttt:             ['\\mathord{\\tt{\\text{#1}}}',1],
textsf:             ['\\mathord{\\sf{\\text{#1}}}',1],
emph:               ['\\textit{#1}',1]
 }}}

apparently this should be added to the appropriate `mathjax_sage.js_t` file, although how to rebuild the docs to take care of this change this way, I don't know. If someone tells me this, I could come up with a patch.



---

archive/issue_comments_156482.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-10-27T15:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156482",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_156483.json:
```json
{
    "body": "`\\texttt` is supposed to be used in text mode, not math mode, so whether it's a MathJax bug, we should replace it with `\\mathtt`. That fixes the problem for me. I'll add this patch in a few minutes. I also don't know what version of MathJax we have; at some point we should probably upgrade.",
    "created_at": "2012-10-27T15:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156483",
    "user": "https://github.com/jhpalmieri"
}
```

`\texttt` is supposed to be used in text mode, not math mode, so whether it's a MathJax bug, we should replace it with `\mathtt`. That fixes the problem for me. I'll add this patch in a few minutes. I also don't know what version of MathJax we have; at some point we should probably upgrade.



---

archive/issue_comments_156484.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-10-27T15:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156484",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_156485.json:
```json
{
    "body": "In fact, I think that MathJax is only designed to handle math mode, so we shouldn't expect `\\texttt` or `\\textsf` to work, or `\\emph` in text mode. (Sphinx won't even call MathJax on text not between single backquotes, i.e., on non-math.) Using `\\emph` in math mode is not very common, so I suggest not worrying about it.",
    "created_at": "2012-10-27T15:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156485",
    "user": "https://github.com/jhpalmieri"
}
```

In fact, I think that MathJax is only designed to handle math mode, so we shouldn't expect `\texttt` or `\textsf` to work, or `\emph` in text mode. (Sphinx won't even call MathJax on text not between single backquotes, i.e., on non-math.) Using `\emph` in math mode is not very common, so I suggest not worrying about it.



---

archive/issue_comments_156486.json:
```json
{
    "body": "Note that `\\texttt` appears in two more places in the Sage library, but not in the documentation: in combinat/posets/linear_extension.py and in modules/vector_space_morphism.py. In the first of these, it should be replace by `\\mathtt`, and in the second, probably by `\\text`. These changes are not related to this ticket, but we can add them on anyway...",
    "created_at": "2012-10-27T15:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156486",
    "user": "https://github.com/jhpalmieri"
}
```

Note that `\texttt` appears in two more places in the Sage library, but not in the documentation: in combinat/posets/linear_extension.py and in modules/vector_space_morphism.py. In the first of these, it should be replace by `\mathtt`, and in the second, probably by `\text`. These changes are not related to this ticket, but we can add them on anyway...



---

archive/issue_comments_156487.json:
```json
{
    "body": "Replying to [comment:36 jhpalmieri]:\n> Note that `\\texttt` appears in two more places in the Sage library, but not in the documentation: in combinat/posets/linear_extension.py and in modules/vector_space_morphism.py. In the first of these, it should be replace by `\\mathtt`, and in the second, probably by `\\text`. These changes are not related to this ticket, but we can add them on anyway...\n\nRight, let's do this, and hopefully be done with! Indeed, I didn't think straight about `\\texttt{`}.",
    "created_at": "2012-10-27T15:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156487",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:36 jhpalmieri]:
> Note that `\texttt` appears in two more places in the Sage library, but not in the documentation: in combinat/posets/linear_extension.py and in modules/vector_space_morphism.py. In the first of these, it should be replace by `\mathtt`, and in the second, probably by `\text`. These changes are not related to this ticket, but we can add them on anyway...

Right, let's do this, and hopefully be done with! Indeed, I didn't think straight about `\texttt{`}.



---

archive/issue_comments_156488.json:
```json
{
    "body": "Attachment [trac_13143-optional.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-optional.patch) by @jhpalmieri created at 2012-10-27 15:51:33\n\noptional patch, independent of the others",
    "created_at": "2012-10-27T15:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156488",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13143-optional.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-optional.patch) by @jhpalmieri created at 2012-10-27 15:51:33

optional patch, independent of the others



---

archive/issue_comments_156489.json:
```json
{
    "body": "If you think we should apply the \"optional\" patch, please add it to the ticket description (under the list of patches to be applied).",
    "created_at": "2012-10-27T15:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156489",
    "user": "https://github.com/jhpalmieri"
}
```

If you think we should apply the "optional" patch, please add it to the ticket description (under the list of patches to be applied).



---

archive/issue_comments_156490.json:
```json
{
    "body": "Replying to [comment:38 jhpalmieri]:\n> If you think we should apply the \"optional\" patch, please add it to the ticket description (under the list of patches to be applied).\nIn both cases it's inside the docs for _latex function, which do not appear in the HTML documentation at all, for some reason.\nI guess sphynx skips stuff beginning from _. I don't know whether it's a bug or a feature.",
    "created_at": "2012-10-27T16:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156490",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:38 jhpalmieri]:
> If you think we should apply the "optional" patch, please add it to the ticket description (under the list of patches to be applied).
In both cases it's inside the docs for _latex function, which do not appear in the HTML documentation at all, for some reason.
I guess sphynx skips stuff beginning from _. I don't know whether it's a bug or a feature.



---

archive/issue_comments_156491.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-27T17:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156491",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156492.json:
```json
{
    "body": "Sage library",
    "created_at": "2012-11-01T12:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156492",
    "user": "https://github.com/jdemeyer"
}
```

Sage library



---

archive/issue_comments_156493.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-01T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156493",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_156494.json:
```json
{
    "body": "Attachment [trac_13143-pictures.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-pictures.patch) by @jdemeyer created at 2012-11-01 12:47:11\n\nRebased to sage-5.5.beta1.",
    "created_at": "2012-11-01T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12971",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12971#issuecomment-156494",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_13143-pictures.patch](tarball://root/attachments/some-uuid/ticket13143/trac_13143-pictures.patch) by @jdemeyer created at 2012-11-01 12:47:11

Rebased to sage-5.5.beta1.
