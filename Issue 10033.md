# Issue 10033: Make evaluation possible for Pynac 'hold' objects

Issue created by migration from https://trac.sagemath.org/ticket/10034

Original creator: kcrisman

Original creation time: 2010-09-29 18:59:28

Assignee: burcin

CC:  eviatarbach paulmasson

See #9879, where it is now possible to 'hold' a symbolic expression:

```
sage: a = (pi/12).tan(hold=True)
sage: a
tan(1/12*pi)
```


However, without going through Maxima and `a.simplify()`, it isn't clear how to get the actual answer for this.  Either by changing `simplify()` to try simplifying through Pynac first, or by adding something like an `a.eval()` method, we should make that possible without Maxima.


---

Comment by kcrisman created at 2010-10-06 14:28:56

This is related to #10071, which is about functions which can't even be evaluated using Maxima or `n()`.  This ticket is saying that one should be able to evaluate all held functions without using Maxima or `n()`, whether or not a function currently can be evaluated in that way or not.


---

Comment by eviatarbach created at 2013-07-03 02:50:49

Here's a patch which makes evaluation possible, simply by walking the expression and evaluating all operations. It does not work for the functions in #10071, because the `.operator()` method doesn't work on them; I believe this is a separate issue for another ticket though.

Patchbot apply trac_10034.patch


---

Comment by eviatarbach created at 2013-07-03 02:50:49

Changing status from new to needs_review.


---

Attachment


---

Comment by kcrisman created at 2013-07-03 16:05:04

Glance looks good.  Before I think more about this, a question - is `eval` the right name for this?  I know I'm the one who suggested it... but what do other eval methods do?  Also, I think there are a lot of examples which use `simplify` to evaluate these currently - maybe we could switch them to this (or add this, perhaps).  Yes, I agree that #10071 is fine not to try to handle here - that's why I opened #10071.


---

Comment by eviatarbach created at 2013-07-03 18:10:20

The `_eval_` method for symbolic functions defines what to do when the function is evaluated, and the `_eval_self` method for expressions tries to do numerical evaluation. Maybe a name like `unhold` would be better?

Ah right, I'll switch the examples to this. There's no reason why these expressions should be transferred to Maxima simply for evaluating an operation.


---

Comment by kcrisman created at 2013-07-03 18:26:03

Ok.

As another remark (and you might hate me for this one), I could imagine someone wanting to evaluate _some_ but not _all_ of the held operations.   I think this is possible with your patch and judicious use of `op` and the tree, but at least adding an example of that would be helpful. Particularly in the `x * x + x * x` example, though, I wonder if it wouldn't be pretty annoying to simplify this to `2 * x * x` using this.  What do you think about such cases?


---

Comment by eviatarbach created at 2013-07-03 18:42:44

I've thought about this. One option is to use pattern matching to specify the parts to evaluate, but I don't how the expression could be reconstructed afterwards.

Another option is to have an argument for providing a list of operators not to evaluate (I think it's better to have an argument to exclude rather than include, because it is difficult to find all the operators in Sage, while finding ones to exclude just involves searching the expression). Then for the `2 * x * x` example you could just add `operator.mul` to the excluded operators and it would work.


---

Comment by eviatarbach created at 2013-07-03 22:15:05

Okay, the new patch renames `eval` to `unhold`, moves the examples to use the new method, and adds an `exclude` option. Excluding arithmetic operators doesn't yet work because of #14850.

Patchbot apply trac_10034_2.patch


---

Attachment


---

Comment by eviatarbach created at 2013-07-05 18:38:14

Actually, the way I implemented it is not correct, since if the length of the operands is over two it reduces the rest of the operands using the operator. This is the desired behaviour for the arithmetic operators, but not generally.


---

Comment by eviatarbach created at 2013-07-05 18:38:14

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-08-20 00:59:58

Maybe this should also fix other places the hold stuff is shown, e.g. functions/trig.py.


---

Comment by rws created at 2014-12-25 08:25:21

I don't think an `eval` member is right here. The end user would expect `.simplify_trig()` to work, and it does actually. The only problem the original submitter had was the Maxima overhead, so it boils down to a native implementation called from `simplify_trig()`.


---

Comment by rws created at 2015-07-27 07:21:43

What I wrote:
> I don't think an `eval` member is right here. The end user would expect `.simplify_trig()` to work, and it does actually. The only problem the original submitter had was the Maxima overhead, so it boils down to a native implementation called from `simplify_trig()`.
is of course nonsense. Every function that sends the held expression through Maxima unchanged would work because the hold status gets lost. The expansion happens in Pynac's `(function)::eval` so is already implemented outside Maxima.


---

Comment by rws created at 2015-10-22 15:21:18

Previous title restored.


---

Comment by rws created at 2015-10-23 14:15:11

Changing status from needs_work to needs_review.


---

Comment by rws created at 2015-10-23 14:15:11

I used the convenient `ExpressionTreeWalker` that takes care of the caveats mentioned above.
----
New commits:


---

Comment by git created at 2016-06-13 08:04:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-06-24 20:39:01

Everything I tested functions just fine, including building documents. Ready for positive review.

One minor quibble: the exclude option references Trac #14850, which is a closed duplicate of #10169. Shouldn't that be updated?


---

Comment by git created at 2016-06-25 06:47:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-06-25 06:48:36

Right. Thanks for the review. Please add your name to Reviewers: too.


---

Comment by paulmasson created at 2016-06-25 19:40:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-26 23:37:52

Resolution: fixed
