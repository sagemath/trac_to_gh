# Issue 34587: do not include parent in hash of parking functions

Issue created by migration from https://trac.sagemath.org/ticket/34824

Original creator: mantepse

Original creation time: 2022-12-05 06:54:16

CC:  nthiery




---

Comment by mantepse created at 2022-12-05 07:10:29

Changing type from PLEASE CHANGE to defect.


---

Comment by mantepse created at 2022-12-05 07:10:29

New commits:


---

Comment by mantepse created at 2022-12-05 07:10:29

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by mantepse created at 2022-12-05 07:10:29

Changing status from new to needs_info.


---

Comment by nbruin created at 2022-12-05 07:43:52

I expect that you'll have to redefine equality comparison as well: `__hash__` and `__eq__` go hand-in-hand. See

https://docs.python.org/3/reference/datamodel.html#object.__hash__

You could try to override `_hash_` instead, which is the internal routine that is used by the default `__hash__` to populate the `_hash_` cache attribute.


---

Comment by git created at 2022-12-05 10:30:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-12-10 22:43:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-12-10 22:46:01

Changing status from needs_info to needs_review.


---

Comment by mantepse created at 2022-12-11 10:12:41

I do not understand this - shouldn't the hash be inherited from `ClonableArray`?

Is this because of `metaclass=InheritComparisonClasscallMetaclass`?


```
sage: A = SetPartition([[1],[2,3],[4]])
sage: hash(A)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Cell In [3], line 1
----> 1 hash(A)

TypeError: unhashable type: 'SetPartitions_all_with_category.element_class'
```



---

Comment by mantepse created at 2022-12-11 10:16:56

No, for `ParkingFunction`, hashing works, even though 

```
class ParkingFunction(ClonableArray, metaclass=InheritComparisonClasscallMetaclass):
```



---

Comment by git created at 2022-12-13 09:18:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-12-13 14:57:14

See also https://groups.google.com/g/sage-devel/c/0J2jiBh5AvE


---

Comment by tscrim created at 2022-12-14 04:54:01

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-12-14 04:54:01

LGTM. This will make handling equality easier for subclasses.

Note that this will cause a slight performance regression when there is hashing involving things that are represented by the same list but should not be compared. For example `[3, 2, 1]` as a permutation versus as a partition (if they both inherited from `ClonableArray`). However, I don't see this having a practical effect and it is still outweighed by the ease-of-use IMO.
