# Issue 34587: do not include parent in hash of parking functions

archive/issues_034587.json:
```json
{
    "body": "CC:  nthiery\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34824\n\n",
    "created_at": "2022-12-05T06:54:16Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "do not include parent in hash of parking functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34587",
    "user": "mantepse"
}
```
CC:  nthiery



Issue created by migration from https://trac.sagemath.org/ticket/34824





---

archive/issue_comments_489140.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489140",
    "user": "mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_489141.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489141",
    "user": "mantepse"
}
```

New commits:



---

archive/issue_comments_489142.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489142",
    "user": "mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_489143.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2022-12-05T07:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489143",
    "user": "mantepse"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_489144.json:
```json
{
    "body": "I expect that you'll have to redefine equality comparison as well: `__hash__` and `__eq__` go hand-in-hand. See\n\nhttps://docs.python.org/3/reference/datamodel.html#object.__hash__\n\nYou could try to override `_hash_` instead, which is the internal routine that is used by the default `__hash__` to populate the `_hash_` cache attribute.",
    "created_at": "2022-12-05T07:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489144",
    "user": "nbruin"
}
```

I expect that you'll have to redefine equality comparison as well: `__hash__` and `__eq__` go hand-in-hand. See

https://docs.python.org/3/reference/datamodel.html#object.__hash__

You could try to override `_hash_` instead, which is the internal routine that is used by the default `__hash__` to populate the `_hash_` cache attribute.



---

archive/issue_comments_489145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-05T10:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489145",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-10T22:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489146",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489147.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-12-10T22:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489147",
    "user": "mantepse"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_489148.json:
```json
{
    "body": "I do not understand this - shouldn't the hash be inherited from `ClonableArray`?\n\nIs this because of `metaclass=InheritComparisonClasscallMetaclass`?\n\n\n```\nsage: A = SetPartition([[1],[2,3],[4]])\nsage: hash(A)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nCell In [3], line 1\n----> 1 hash(A)\n\nTypeError: unhashable type: 'SetPartitions_all_with_category.element_class'\n```\n",
    "created_at": "2022-12-11T10:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489148",
    "user": "mantepse"
}
```

I do not understand this - shouldn't the hash be inherited from `ClonableArray`?

Is this because of `metaclass=InheritComparisonClasscallMetaclass`?


```
sage: A = SetPartition([[1],[2,3],[4]])
sage: hash(A)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Cell In [3], line 1
----> 1 hash(A)

TypeError: unhashable type: 'SetPartitions_all_with_category.element_class'
```




---

archive/issue_comments_489149.json:
```json
{
    "body": "No, for `ParkingFunction`, hashing works, even though \n\n```\nclass ParkingFunction(ClonableArray, metaclass=InheritComparisonClasscallMetaclass):\n```\n",
    "created_at": "2022-12-11T10:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489149",
    "user": "mantepse"
}
```

No, for `ParkingFunction`, hashing works, even though 

```
class ParkingFunction(ClonableArray, metaclass=InheritComparisonClasscallMetaclass):
```




---

archive/issue_comments_489150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-13T09:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489150",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489151.json:
```json
{
    "body": "See also https://groups.google.com/g/sage-devel/c/0J2jiBh5AvE",
    "created_at": "2022-12-13T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489151",
    "user": "mantepse"
}
```

See also https://groups.google.com/g/sage-devel/c/0J2jiBh5AvE



---

archive/issue_comments_489152.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-14T04:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489152",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_489153.json:
```json
{
    "body": "LGTM. This will make handling equality easier for subclasses.\n\nNote that this will cause a slight performance regression when there is hashing involving things that are represented by the same list but should not be compared. For example `[3, 2, 1]` as a permutation versus as a partition (if they both inherited from `ClonableArray`). However, I don't see this having a practical effect and it is still outweighed by the ease-of-use IMO.",
    "created_at": "2022-12-14T04:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34587#issuecomment-489153",
    "user": "tscrim"
}
```

LGTM. This will make handling equality easier for subclasses.

Note that this will cause a slight performance regression when there is hashing involving things that are represented by the same list but should not be compared. For example `[3, 2, 1]` as a permutation versus as a partition (if they both inherited from `ClonableArray`). However, I don't see this having a practical effect and it is still outweighed by the ease-of-use IMO.
