# Issue 26195: clean graph.py

archive/issues_026195.json:
```json
{
    "body": "CC:  @tscrim @fchapoton\n\nWe do as much cleaning as possible: alignment, PEP8, avoid many vertex comparisons or sorting.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26432\n\n",
    "created_at": "2018-10-07T20:59:15Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "clean graph.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26195",
    "user": "@dcoudert"
}
```
CC:  @tscrim @fchapoton

We do as much cleaning as possible: alignment, PEP8, avoid many vertex comparisons or sorting.

Issue created by migration from https://trac.sagemath.org/ticket/26432





---

archive/issue_comments_369093.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-10-07T21:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369093",
    "user": "@dcoudert"
}
```

New commits:



---

archive/issue_comments_369094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-07T21:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369094",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369095.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-07T22:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369095",
    "user": "@dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369096.json:
```json
{
    "body": "So far, remaining issues are:\n- sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation ? (could be done in a specific ticket)\n- sorting in examples of `cliques_number_of`, `cliques_vertex_clique_number`, `cliques_containing_vertex`. This can be changed here.\n- recursion on method `DFS` of `ear_decomposition`. I can do it here or in specific ticket.\n\nAny advise is more than welcome.",
    "created_at": "2018-10-07T22:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369096",
    "user": "@dcoudert"
}
```

So far, remaining issues are:
- sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation ? (could be done in a specific ticket)
- sorting in examples of `cliques_number_of`, `cliques_vertex_clique_number`, `cliques_containing_vertex`. This can be changed here.
- recursion on method `DFS` of `ear_decomposition`. I can do it here or in specific ticket.

Any advise is more than welcome.



---

archive/issue_comments_369097.json:
```json
{
    "body": "Edit: sorry, I was wrong about this. It does not help with the homology doctests.",
    "created_at": "2018-10-07T23:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369097",
    "user": "@jhpalmieri"
}
```

Edit: sorry, I was wrong about this. It does not help with the homology doctests.



---

archive/issue_comments_369098.json:
```json
{
    "body": "Small things that I think should be fixed before a positive review:\n\n`sorted(V.keys())` -> `sorted(V)`.\n\nWhile I understand why, it still looks ugly\n\n```\n+        A snark has chromatic index 4 hence its line graph has chromatic number\n+        4::\n```\n\nprobably better to also move down `number` and maybe also `chromatic`.\n\nThe bullet points are over-indented:\n\n```diff\n         Here are two very simple modules :\n \n-            * A connected component `C` (or the union of some --but\n-              not all-- of them) of a disconnected graph `G`, for\n-              instance, is a module, as no vertex of `C` has a\n-              neighbor outside of it.\n+            * A connected component `C` (or the union of some --but not all-- of\n+              them) of a disconnected graph `G`, for instance, is a module, as\n+              no vertex of `C` has a neighbor outside of it.\n \n-            * An anticomponent `C` (or the union of some --but not\n-              all-- of them) of an non-anticonnected graph `G`, for\n-              the same reason (it is just the complement of the\n-              previous graph !).\n+            * An anticomponent `C` (or the union of some --but not all-- of\n+              them) of an non-anticonnected graph `G`, for the same reason (it\n+              is just the complement of the previous graph !).\n```\n\n\nI would move off on the `ear_decomposition` changes to a separate ticket as this one is big enough (and likely to have conflicts). However, I would probably consider doing the sorting here.",
    "created_at": "2018-10-08T06:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369098",
    "user": "@tscrim"
}
```

Small things that I think should be fixed before a positive review:

`sorted(V.keys())` -> `sorted(V)`.

While I understand why, it still looks ugly

```
+        A snark has chromatic index 4 hence its line graph has chromatic number
+        4::
```

probably better to also move down `number` and maybe also `chromatic`.

The bullet points are over-indented:

```diff
         Here are two very simple modules :
 
-            * A connected component `C` (or the union of some --but
-              not all-- of them) of a disconnected graph `G`, for
-              instance, is a module, as no vertex of `C` has a
-              neighbor outside of it.
+            * A connected component `C` (or the union of some --but not all-- of
+              them) of a disconnected graph `G`, for instance, is a module, as
+              no vertex of `C` has a neighbor outside of it.
 
-            * An anticomponent `C` (or the union of some --but not
-              all-- of them) of an non-anticonnected graph `G`, for
-              the same reason (it is just the complement of the
-              previous graph !).
+            * An anticomponent `C` (or the union of some --but not all-- of
+              them) of an non-anticonnected graph `G`, for the same reason (it
+              is just the complement of the previous graph !).
```


I would move off on the `ear_decomposition` changes to a separate ticket as this one is big enough (and likely to have conflicts). However, I would probably consider doing the sorting here.



---

archive/issue_comments_369099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T07:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369099",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369100.json:
```json
{
    "body": "Thanks for all the comments. I will modify `ear_decomposition` in a separate ticket.\n\nI have removed sorting from several example. Was not needed.\n\nConcerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?",
    "created_at": "2018-10-08T07:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369100",
    "user": "@dcoudert"
}
```

Thanks for all the comments. I will modify `ear_decomposition` in a separate ticket.

I have removed sorting from several example. Was not needed.

Concerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?



---

archive/issue_comments_369101.json:
```json
{
    "body": "Replying to [comment:7 dcoudert]:\n> Concerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?\n\nI would say it is fine. There is not a decent reason I can think of why someone should be assuming the output is sorted. Nor was it documented that the output was sorted.",
    "created_at": "2018-10-08T09:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369101",
    "user": "@tscrim"
}
```

Replying to [comment:7 dcoudert]:
> Concerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?

I would say it is fine. There is not a decent reason I can think of why someone should be assuming the output is sorted. Nor was it documented that the output was sorted.



---

archive/issue_comments_369102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T12:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369102",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T12:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369103",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369104.json:
```json
{
    "body": "Concerning the removal of sorting. It was easier than expected and I have not noticed any impact on other methods.\n\nAfter that I did additional improvements in INPUT blocks and lambda statements.\n\nFurther improvements are certainly possible like moving references to the global file, but I suggest to do that only after the giant patch #26423 is closed.",
    "created_at": "2018-10-08T12:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369104",
    "user": "@dcoudert"
}
```

Concerning the removal of sorting. It was easier than expected and I have not noticed any impact on other methods.

After that I did additional improvements in INPUT blocks and lambda statements.

Further improvements are certainly possible like moving references to the global file, but I suggest to do that only after the giant patch #26423 is closed.



---

archive/issue_comments_369105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-09T02:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369105",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369106.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2018-10-09T02:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369106",
    "user": "@tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_369107.json:
```json
{
    "body": "The `python3_py` test of the patchbot indicates the following issue \n\n```diff\n+ @@ -2141,34 +2117,40 @@ class Graph(GenericGraph):\n+        for u,d in six.iteritems(H.degree(labels=True)):\nPython3 incompatible code inserted on 1 non-empty lines\n```\n\nI'm pushing a small change to fix that.",
    "created_at": "2018-10-09T08:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369107",
    "user": "@dcoudert"
}
```

The `python3_py` test of the patchbot indicates the following issue 

```diff
+ @@ -2141,34 +2117,40 @@ class Graph(GenericGraph):
+        for u,d in six.iteritems(H.degree(labels=True)):
Python3 incompatible code inserted on 1 non-empty lines
```

I'm pushing a small change to fix that.



---

archive/issue_comments_369108.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-10-09T08:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369108",
    "user": "@dcoudert"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_369109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-09T08:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369109",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369110.json:
```json
{
    "body": "What was there was correct and works on python3, that is what six does. However, in this case, this makes the code a little easier to understand, although not by much. So I will keep the change.",
    "created_at": "2018-10-09T09:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369110",
    "user": "@tscrim"
}
```

What was there was correct and works on python3, that is what six does. However, in this case, this makes the code a little easier to understand, although not by much. So I will keep the change.



---

archive/issue_comments_369111.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-09T09:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369111",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369112.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-10-09T09:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369112",
    "user": "@dcoudert"
}
```

Thank you.



---

archive/issue_comments_369113.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369113",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_369114.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26195#issuecomment-369114",
    "user": "@embray"
}
```

This should be re-targeted for 8.5.
