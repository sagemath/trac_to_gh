# Issue 26195: clean graph.py

Issue created by migration from https://trac.sagemath.org/ticket/26432

Original creator: dcoudert

Original creation time: 2018-10-07 20:59:15

CC:  tscrim chapoton

We do as much cleaning as possible: alignment, PEP8, avoid many vertex comparisons or sorting.


---

Comment by dcoudert created at 2018-10-07 21:01:45

New commits:


---

Comment by git created at 2018-10-07 21:42:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-07 22:09:51

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-10-07 22:09:51

So far, remaining issues are:
- sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation ? (could be done in a specific ticket)
- sorting in examples of `cliques_number_of`, `cliques_vertex_clique_number`, `cliques_containing_vertex`. This can be changed here.
- recursion on method `DFS` of `ear_decomposition`. I can do it here or in specific ticket.

Any advise is more than welcome.


---

Comment by jhpalmieri created at 2018-10-07 23:38:18

Edit: sorry, I was wrong about this. It does not help with the homology doctests.


---

Comment by tscrim created at 2018-10-08 06:06:31

Small things that I think should be fixed before a positive review:

`sorted(V.keys())` -> `sorted(V)`.

While I understand why, it still looks ugly

```
+        A snark has chromatic index 4 hence its line graph has chromatic number
+        4::
```

probably better to also move down `number` and maybe also `chromatic`.

The bullet points are over-indented:

```diff
         Here are two very simple modules :
 
-            * A connected component `C` (or the union of some --but
-              not all-- of them) of a disconnected graph `G`, for
-              instance, is a module, as no vertex of `C` has a
-              neighbor outside of it.
+            * A connected component `C` (or the union of some --but not all-- of
+              them) of a disconnected graph `G`, for instance, is a module, as
+              no vertex of `C` has a neighbor outside of it.
 
-            * An anticomponent `C` (or the union of some --but not
-              all-- of them) of an non-anticonnected graph `G`, for
-              the same reason (it is just the complement of the
-              previous graph !).
+            * An anticomponent `C` (or the union of some --but not all-- of
+              them) of an non-anticonnected graph `G`, for the same reason (it
+              is just the complement of the previous graph !).
```


I would move off on the `ear_decomposition` changes to a separate ticket as this one is big enough (and likely to have conflicts). However, I would probably consider doing the sorting here.


---

Comment by git created at 2018-10-08 07:06:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-08 07:10:17

Thanks for all the comments. I will modify `ear_decomposition` in a separate ticket.

I have removed sorting from several example. Was not needed.

Concerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?


---

Comment by tscrim created at 2018-10-08 09:13:36

Replying to [comment:7 dcoudert]:
> Concerning the sorting of output in `cliques_maximal` and `vertex_cover`. Should we put a deprecation warning ? if so, a dedicated ticket is certainly better (easier to check), no ?

I would say it is fine. There is not a decent reason I can think of why someone should be assuming the output is sorted. Nor was it documented that the output was sorted.


---

Comment by git created at 2018-10-08 12:22:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-08 12:33:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-08 12:39:18

Concerning the removal of sorting. It was easier than expected and I have not noticed any impact on other methods.

After that I did additional improvements in INPUT blocks and lambda statements.

Further improvements are certainly possible like moving references to the global file, but I suggest to do that only after the giant patch #26423 is closed.


---

Comment by tscrim created at 2018-10-09 02:13:50

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-10-09 02:13:50

Thanks. LGTM.


---

Comment by dcoudert created at 2018-10-09 08:12:38

The `python3_py` test of the patchbot indicates the following issue 

```diff
+ @@ -2141,34 +2117,40 @@ class Graph(GenericGraph):
+        for u,d in six.iteritems(H.degree(labels=True)):
Python3 incompatible code inserted on 1 non-empty lines
```

I'm pushing a small change to fix that.


---

Comment by dcoudert created at 2018-10-09 08:12:38

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-10-09 08:12:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-09 09:24:06

What was there was correct and works on python3, that is what six does. However, in this case, this makes the code a little easier to understand, although not by much. So I will keep the change.


---

Comment by tscrim created at 2018-10-09 09:24:06

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2018-10-09 09:35:09

Thank you.


---

Comment by vbraun created at 2018-10-20 11:58:14

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
