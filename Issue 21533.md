# Issue 21533: Package libpcre as a standard package

Issue created by migration from https://trac.sagemath.org/ticket/21770

Original creator: charpent

Original creation time: 2016-10-26 17:58:10

CC:  mkoeppe dimpase

Keywords: r-project

Rationale : R (standard package) requires libpcre (in a non-default configuration), but stopped to package it with version 3.3.0.

See this [discussion](https://groups.google.com/forum/#!topic/sage-devel/QpTvLGSu3w8) on sage-devel, but look also [here](https://groups.google.com/forum/#!topic/sage-devel/9gun2Wo6zGM) and contribute [here](https://groups.google.com/forum/#!topic/sage-devel/RrYAqEdsObo).

*Tarball* : [ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.39.tar.gz.sig] (Note : ftp !)


---

Comment by charpent created at 2016-10-26 18:56:05

New commits:


---

Comment by charpent created at 2016-10-26 19:53:09

Changing status from new to needs_review.


---

Comment by charpent created at 2016-10-26 19:53:09

The initial packaging builds without problem and passes its own testsuite ; the resulting Sage passes ptestlong with only the usual transient error on `simplicial_complex.py` (which passes standalone).

==> `needs_review`.


---

Comment by jdemeyer created at 2016-10-26 21:04:20

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-10-26 21:04:20

In the light of #20692, please remove this patch block (especially given that there are no patches):

```
# Patch sources.
for patch in ../patches/*.patch; do
    [ -r "$patch" ] || continue  # Skip non-existing or non-readable patches
    patch -p1 <"$patch"
    if [ $? -ne 0 ]; then
        echo >&2 "Error applying '$patch'"
        exit 1
    fi
done
```



---

Comment by git created at 2016-10-27 06:39:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2016-10-27 06:41:10

Replying to [comment:5 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[21ce3e7](https://git.sagemath.org/sage.git/commit/?id=21ce3e75574d3a08266324b7fac41e044e0ef280)||`Removed patches handling.`||

Builds OK, passes its own test suite.


---

Comment by charpent created at 2016-10-27 06:41:43

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2017-02-19 04:48:21

Sage-7.6.beta4 + #20523 + #21767 + #21770 (this patch) passes ptestlong witht two transient errors :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_set_morphism.py  # Bad exit: 2
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```

Both tests pass when run standalone.

This should close the R saga (for now) by allowing the current interfaces to work with R >= 3.3.x.

Still `needs_review`


---

Comment by charpent created at 2017-02-20 19:52:45

Merged with #20523

This ticket should be marked as invalid by someeone with the right rights...


---

Comment by charpent created at 2017-02-20 20:34:10

After discussion of (potential) #20523 reviewers, I now think that this ticket should be kept, reviewed and validated. Pleas DON'T invalidate it.


---

Comment by jdemeyer created at 2017-02-21 10:23:04


```
[pcre-8.39] WARNING: spkg-install is not executable, making it executable
```



---

Comment by jdemeyer created at 2017-02-21 10:23:04

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-21 10:39:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-02-21 10:44:12

Replying to [comment:11 jdemeyer]:
> {{{
> [pcre-8.39] WARNING: spkg-install is not executable, making it executable
> }}}

Done. `needs_review`


---

Comment by charpent created at 2017-02-21 10:44:12

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2017-02-21 11:53:43

I wonder if `pcre` also pops up in `polymake`-related tickets (which do need a lot of `perl`)...


---

Comment by charpent created at 2017-02-24 18:10:26

Updated the address of the original tarball (patchbots seem to be unable to use an FTP address...).


---

Comment by jdemeyer created at 2017-02-27 14:52:17

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-02-27 14:52:17

I would suggest to make the package _optional_ for now and only make it standard when really needed.


---

Comment by charpent created at 2017-02-27 15:14:33

Replying to [comment:16 jdemeyer]:
> I would suggest to make the package _optional_ for now and only make it standard when really needed.

We've already been there (see previous saga...) :
* R is a standard package
* R depends on PCRE starting 3.3.x
* A standard package cannot depend on an optional package

Therefore pcre has to be standard. QED.


---

Comment by charpent created at 2017-02-27 15:15:38

And, yes, it `needs_review`.


---

Comment by charpent created at 2017-02-27 15:15:38

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-02-27 15:28:50

Replying to [comment:17 charpent]:
> * R *version 3.2.4-revised* is a standard package
> * R *version 3.3.x* depends on PCRE
> * A standard package cannot depend on an optional package

I stand by my proposal: make it standard when really needed.


---

Comment by charpent created at 2017-02-27 15:48:57

Replying to [comment:19 jdemeyer]:
> Replying to [comment:17 charpent]:
> > * R *version 3.2.4-revised* is a standard package

And is about 1 year late on current R. Having an up-to-date R version is a //sine qua non// to get help on R-help, and to be able to install recent versions of the >10 000 R packages. Which are a not inconsiderable resource to those lowly life-forms called applied statisticians...

> > * R *version 3.3.x* depends on PCRE
> > * A standard package cannot depend on an optional package
> 
> I stand by my proposal: make it standard when really needed.

IMHO it ***is*** really needed. But it happens that I need R for my everyday work. Do you ?


---

Comment by jdemeyer created at 2017-02-27 15:54:32

Replying to [comment:20 charpent]:
> Replying to [comment:19 jdemeyer]:
> > Replying to [comment:17 charpent]:
> > > * R *version 3.2.4-revised* is a standard package
> 
> And is about 1 year late on current R. Having an up-to-date R version is a //sine qua non// to get help on R-help, and to be able to install recent versions of the >10 000 R packages. Which are a not inconsiderable resource to those lowly life-forms called applied statisticians...

That may be all true, but I don't see how that matters here.

> > > * R *version 3.3.x* depends on PCRE
> > > * A standard package cannot depend on an optional package
> > 
> > I stand by my proposal: make it standard when really needed.
> 
> IMHO it ***is*** really needed.

...when we upgrade to R-3.3.0, which is not the case yet.


---

Comment by charpent created at 2017-02-27 15:59:23

Replying to [comment:21 jdemeyer]:
> Replying to [comment:20 charpent]:
> > Replying to [comment:19 jdemeyer]:
> > > Replying to [comment:17 charpent]:
> > > > * R *version 3.2.4-revised* is a standard package
> > 
> > And is about 1 year late on current R. Having an up-to-date R version is a //sine qua non// to get help on R-help, and to be able to install recent versions of the >10 000 R packages. Which are a not inconsiderable resource to those lowly life-forms called applied statisticians...
> 
> That may be all true, but I don't see how that matters here.
> 
> > > > * R *version 3.3.x* depends on PCRE
> > > > * A standard package cannot depend on an optional package
> > > 
> > > I stand by my proposal: make it standard when really needed.
> > 
> > IMHO it ***is*** really needed.
> 
> ...when we upgrade to R-3.3.0, which is not the case yet.
#20523 is waiting on this ticket for review (and has been for a looong time : it has been delayed by the openssl brouhaha).


---

Comment by jdemeyer created at 2017-02-27 16:00:27

Replying to [comment:22 charpent]:
> #20523 is waiting on this ticket for review (and has been for a looong time : it has been delayed by the openssl brouhaha).

Then make it optional here and standard in #20523.


---

Comment by charpent created at 2017-02-27 16:14:51

Replying to [comment:23 jdemeyer]:
> Replying to [comment:22 charpent]:
> > #20523 is waiting on this ticket for review (and has been for a looong time : it has been delayed by the openssl brouhaha).
> 
> Then make it optional here and standard in #20523.
I can't see the point... Care to explain ?


---

Comment by jdemeyer created at 2017-03-14 11:05:42

Replying to [comment:24 charpent]:
> I can't see the point... Care to explain ?

I don't see the point of having a standard package which is not used by anything in Sage.


---

Comment by charpent created at 2017-03-14 11:10:54

Replying to [comment:25 jdemeyer]:
> Replying to [comment:24 charpent]:
> > I can't see the point... Care to explain ?
> 
> I don't see the point of having a standard package which is not used by anything in Sage.

OK. If I follow you :
* PCRE is not used by anything in Sage
* PCRE is used by R

Therefore, by //modus tollens//:
* R is not in Sage.

We should submit this interesting conclusion to `sage-devel` : the discussion would probably be lively and entertaining (for questionable values of "entertaining"...).


---

Comment by jpflori created at 2017-03-15 14:44:43

`@`emmanuel: can you update to 8.40 pls?


---

Comment by charpent created at 2017-03-15 14:48:32

Replying to [comment:28 jpflori]:
> `@`emmanuel: can you update to 8.40 pls?

I'm on it. Count about 15 minutes to post an update patch, about 2-3 hours to compile and ptestlong it.

BTW : since #21767 and the present patch have been merged in #20523, I'll have to update it also before review.


---

Comment by git created at 2017-03-15 15:04:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-03-15 15:07:00

Upgrade as requested. Therefore, tarball modified accordingly.
----
New commits:


---

Comment by charpent created at 2017-03-15 17:01:53

* Passes its own testsuite.
* (#21567 + #21770 + #20523 remerged with the two previous ones) passes ptestlong with two failures :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
```


The first one is transient (passes when ran standalone) ; the second one is a well-documented, ticketed and not yet fixed difference on the expression of the expected result.

==> `needs_review` for good.


---

Comment by jpflori created at 2017-03-15 17:15:46

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2017-03-15 17:15:46

Looks ok.


---

Comment by jpflori created at 2017-03-16 16:40:04

Changing keywords from "r-project" to "r-project, days85".


---

Comment by vbraun created at 2017-03-27 20:43:08

Resolution: fixed


---

Comment by jdemeyer created at 2018-02-05 09:33:00

Is the `--enable-jit` flag really required? It already caused problems on Cygwin and it is breaking on Solaris too (#24628).
