# Issue 30068: Lifting doesn't work for an augmented valuation over a number field

Issue created by migration from https://trac.sagemath.org/ticket/30305

Original creator: swewers

Original creation time: 2020-08-06 20:17:03

CC:  saraedum

Keywords: valuations

The following produces an AssertionError:


```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: v0 = GaussValuation(R, valuations.TrivialValuation(K))
sage: v = v0.augmentation(x^2+x+2, 1)
sage: v.lift(v.reduce(x))
```


The problem only seems to occur for an augmented valuation on a polynomial ring K[x] over a number field. In this case, the residue field often is a relative number field L/K, and for elements of L the method `polynomial()` does not work as expected.   


---

Comment by swewers created at 2020-08-11 19:59:06

It seems to me that this is caused by a bug in the method `polynomial()` for elements of relative number fields:


```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: L.<alpha> = K.extension(x^2+x+2)
sage: alpha.polynomial()
1/2*x^3 + 3*x - 1/2
sage: alpha.polynomial()(L.gen()) == alpha
False
```



---

Comment by saraedum created at 2020-08-27 23:13:43

New commits:


---

Comment by saraedum created at 2020-08-27 23:16:21

I have not run doctests, just tried this by monkey-patching my local [SageMath](SageMath) but this should work. Let's see what the patchbot thinks about this.


---

Comment by saraedum created at 2020-08-27 23:16:28

Changing status from new to needs_review.


---

Comment by git created at 2020-08-28 09:05:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by swewers created at 2020-08-28 16:15:08

It works. Thanks!


---

Comment by swewers created at 2020-08-28 16:15:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-09-05 09:44:44

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-09-05 09:44:44

See patchbot


---

Comment by git created at 2020-09-05 23:37:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2020-09-05 23:38:47

Something changed with polynomials it seems. Let's try with another example then.


---

Comment by saraedum created at 2020-09-05 23:38:47

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2020-09-12 19:28:24

swewers, do you want to have another look?


---

Comment by swewers created at 2020-09-13 09:52:10

The changes made to the doctest are fine.

I am not sure what to do about the pyflakes error from the patchbot. This is related to the augmented valuation code.
I don't even understand what 'import 'islice' from line 1803 shadowed by loop variable' means.


---

Comment by chapoton created at 2020-09-13 14:44:57

patchbot plugins can be ignored if not clear enough


---

Comment by swewers created at 2020-09-13 15:18:43

Ok, then I give a positive review.


---

Comment by swewers created at 2020-09-13 15:18:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-11-07 16:23:11

Resolution: fixed
