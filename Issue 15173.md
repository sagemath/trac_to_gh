# Issue 15173: Simplify cythonization of sage/structure.

Issue created by migration from Trac.

Original creator: robertwb

Original creation time: 2013-11-13 08:20:06

No need to enumerate modules.


---

Comment by git created at 2013-11-13 08:20:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by robertwb created at 2013-11-13 08:22:05

Changing status from new to needs_review.


---

Comment by git created at 2013-11-13 09:02:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-13 09:10:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2013-11-13 15:37:37

Hmmmm... Looks like the 'gmp' dependency in `sage.quadratic_forms.count_local_2` was useless ?

Nathann


---

Comment by git created at 2013-11-13 18:45:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by robertwb created at 2013-11-13 18:48:22

Eventually this will be inferred from the cimports (e.g. of integer_ring). There's a mess of includes and pxi files that needs to be sorted out before that can happen...


---

Comment by ncohen created at 2013-11-14 10:08:43

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-11-14 10:08:43

Hmmmmmm... Well I applied your three patches, deleted the build/ directory, built Sage again and passes all long tests. I got the following errors, and I believe that none of them comes from your commits 

```
----------------------------------------------------------------------
sage -t --long misc/trace.py  # 2 doctests failed
sage -t --long misc/interpreter.py  # 1 doctest failed
sage -t --long combinat/sf/sfa.py  # 1 doctest failed
sage -t --long calculus/desolvers.py  # 8 doctests failed
sage -t --long libs/symmetrica/symmetrica.pxi  # 1 doctest failed
sage -t --long dev/sagedev.py  # 5 doctests failed
sage -t --long dev/patch.py  # 6 doctests failed
sage -t --long tests/cmdline.py  # 14 doctests failed
sage -t --long tests/interrupt.pyx  # Time out
sage -t --long /home/ncohen/.Sage/src/doc/en/constructions/calculus.rst  # 4 doctests failed
sage -t --long /home/ncohen/.Sage/src/doc/en/prep/Quickstarts/Differential-Equations.rst  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 7355.7 seconds
    cpu time: 4916.7 seconds
    cumulative wall time: 5432.8 seconds
```


Soooooooo well. I'd say "good to go" `:-)`

Nathann


---

Comment by vbraun created at 2013-12-20 14:09:28

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2013-12-20 14:09:28

I'm having problems with this ticket, it works on an incremental build but not in a full rebuild. Dies in conway polynomials: http://build.sagemath.org/sage/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2019%20x86_64%29%20full/builds/5/steps/compile_1/logs/conway


---

Comment by felixs created at 2014-01-08 12:05:55

while there is no *need* to enumerate files, the proposed wildcarding has been flagged as bad practice outside the sage/distutils world. see http://www.gnu.org/software/automake/manual/html_node/Wildcards.html for an explanation. or just view the explicit listing of files as an extra integrity check similar to docchecks. you get the idea...

python distutils requires a lot of overhead in file lists, which is bad. but wildcards are worse.

this ticket does not improve anything. better leave it like that (YMMV).


---

Comment by robertwb created at 2014-01-11 01:53:07

From your link:

_Still, these are philosophical objections, and as such you may disagree, or find enough value in wildcards to dismiss all of them. Before you start writing a patch against Automake to teach it about wildcards, letâ€™s see the main technical issue: portability._

You can guess where I fall :). 

Portability is not an issue here. The main downside is someone might forget to add/commit the file, but here this is no worse than we are with .py files, and I would say that this inconsistency is bad (.pyx files should be as similar to .py files as possible). Would you propose enumerating the .py files somewhere as an enhancement?


---

Comment by felixs created at 2014-01-11 09:49:48

Replying to [comment:15 robertwb]:
> Would you propose enumerating the .py files somewhere as an enhancement? 

yes.

when i implemented the make/autotools based build system (#15039), i started off with wildcards (which are not a portability issue, since GNU make is a requirement in various other places). only later, i considered integrity/sanity more important than having random files processed/installed/distributed. so I switched over to explicit lists.

unlike distutils, autotools provides some integrity checks ('distcheck') out of the box, i didn't want to miss them. i cant help to note that enhancing/replacing distutils would be far superior to getting rid of the existing file lists.


---

Comment by vbraun created at 2014-01-11 17:18:24

The main reason for autotools requiring explicit file lists is that there is no reliable introspection in C/C++. This is very different in Python. There are certainly pros and cons to wildcards, but just because autotools is doing it doesn't count as an argument IMHO.


---

Comment by felixs created at 2014-01-11 18:02:24

autotools (in combination with GNU make) works with wildcards, but it will not end up smarter than distutils with wildcards. reliable introspection should not be used to decide which files belong to a project.

sage (the library) has tests for every implemented function, no matter how trivisl it is. not checking whether all files are present does not seem to fit. if you are not convinced, go ahead and delete the lists.


---

Comment by robertwb created at 2014-01-25 22:48:06

I'm unable to reproduce this issue with a full rebuild (and your logs are gone). Are you still seeing this?


---

Comment by jpflori created at 2014-02-20 16:41:52

Should we go on with this ticket?
That is use wildcards and move dependency tracking ot the cython file themselves?


---

Comment by leif created at 2015-04-13 11:16:32

Changing type from defect to enhancement.


---

Comment by jdemeyer created at 2015-06-24 11:43:59

I'm rebooting this ticket to handle only the _trivial_ cases (where no additional libraries or compiler flags need to be added).


---

Comment by jdemeyer created at 2015-06-24 12:15:53

New commits:


---

Comment by jdemeyer created at 2015-06-24 12:15:53

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2015-07-01 12:28:12

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-07-01 13:44:18

See #15412 for a very similar ticket.


---

Comment by vbraun created at 2015-07-02 20:09:22

Resolution: fixed
