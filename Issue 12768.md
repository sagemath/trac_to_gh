# Issue 12768: Combinatorial implementation of the affine symmetric group

archive/issues_012768.json:
```json
{
    "body": "Assignee: tom denton\n\nCC:  @nthiery @anneschilling chrisjamesberg\n\nKeywords: affine, combinatorics, days38\n\nThis is a combinatorial implementation of the affine symmetric group, providing a second implementation of the WeylGroup(['A',k,1]), but quite a bit faster.  The basic idea should be easily extensible to the combinatorial interpretations of the other affine types with window notations, and I've discussed a bit with N. Thiery about hacking together a kind of window notation for the other types.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12940\n\n",
    "created_at": "2012-05-11T19:25:19Z",
    "labels": [
        "PLEASE CHANGE",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.11",
    "title": "Combinatorial implementation of the affine symmetric group",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12768",
    "user": "@sdenton4"
}
```
Assignee: tom denton

CC:  @nthiery @anneschilling chrisjamesberg

Keywords: affine, combinatorics, days38

This is a combinatorial implementation of the affine symmetric group, providing a second implementation of the WeylGroup(['A',k,1]), but quite a bit faster.  The basic idea should be easily extensible to the combinatorial interpretations of the other affine types with window notations, and I've discussed a bit with N. Thiery about hacking together a kind of window notation for the other types.

Issue created by migration from https://trac.sagemath.org/ticket/12940





---

archive/issue_comments_153018.json:
```json
{
    "body": "Attachment [affine_permutations.pyx](tarball://root/attachments/some-uuid/ticket12940/affine_permutations.pyx) by @sdenton4 created at 2012-05-11 19:28:48\n\naffine permutations class.  (Attach this first, if testing.)",
    "created_at": "2012-05-11T19:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153018",
    "user": "@sdenton4"
}
```

Attachment [affine_permutations.pyx](tarball://root/attachments/some-uuid/ticket12940/affine_permutations.pyx) by @sdenton4 created at 2012-05-11 19:28:48

affine permutations class.  (Attach this first, if testing.)



---

archive/issue_comments_153019.json:
```json
{
    "body": "Attachment [affine_symmetric_group.py](tarball://root/attachments/some-uuid/ticket12940/affine_symmetric_group.py) by @sdenton4 created at 2012-05-11 19:29:20\n\nAffine symmetric group class file.",
    "created_at": "2012-05-11T19:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153019",
    "user": "@sdenton4"
}
```

Attachment [affine_symmetric_group.py](tarball://root/attachments/some-uuid/ticket12940/affine_symmetric_group.py) by @sdenton4 created at 2012-05-11 19:29:20

Affine symmetric group class file.



---

archive/issue_comments_153020.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2012-05-17T18:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153020",
    "user": "@sdenton4"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_153021.json:
```json
{
    "body": "Attachment [affine_permutations.py](tarball://root/attachments/some-uuid/ticket12940/affine_permutations.py) by @sdenton4 created at 2012-05-17 18:48:11",
    "created_at": "2012-05-17T18:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153021",
    "user": "@sdenton4"
}
```

Attachment [affine_permutations.py](tarball://root/attachments/some-uuid/ticket12940/affine_permutations.py) by @sdenton4 created at 2012-05-17 18:48:11



---

archive/issue_comments_153022.json:
```json
{
    "body": "Removed the cython-ified version of the affine permutations class as it was creating issues, and wasn't really improving run times that much.  Made numerous algorithm improvements, though; the patch is now int he sage-combinat queue as well.",
    "created_at": "2012-05-17T18:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153022",
    "user": "@sdenton4"
}
```

Removed the cython-ified version of the affine permutations class as it was creating issues, and wasn't really improving run times that much.  Made numerous algorithm improvements, though; the patch is now int he sage-combinat queue as well.



---

archive/issue_comments_153023.json:
```json
{
    "body": "Hi Tom,\n\nIt looks like that Affine Permutations really need to be integrated into the sage file system. At the moment this seems to be a stand-alone patch!\n\nBest,\n\nAnne",
    "created_at": "2012-08-25T04:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153023",
    "user": "@anneschilling"
}
```

Hi Tom,

It looks like that Affine Permutations really need to be integrated into the sage file system. At the moment this seems to be a stand-alone patch!

Best,

Anne



---

archive/issue_comments_153024.json:
```json
{
    "body": "Ok, at long last, I've fixed up the sage combinat patch and exported; it's the attachment above.  It should also patch the sage files that point out that the new directory and file exist!",
    "created_at": "2012-10-07T13:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153024",
    "user": "@sdenton4"
}
```

Ok, at long last, I've fixed up the sage combinat patch and exported; it's the attachment above.  It should also patch the sage files that point out that the new directory and file exist!



---

archive/issue_comments_153025.json:
```json
{
    "body": "Hi Tom,\n\nCould we entice you to add a to_core method? Also, some of your documentation using INPUT: etc is not standard and needs to be fixed. And ... please put your patch on the sage-combinat queue.\n\nCheers,\n\nAnne",
    "created_at": "2012-10-08T05:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153025",
    "user": "@anneschilling"
}
```

Hi Tom,

Could we entice you to add a to_core method? Also, some of your documentation using INPUT: etc is not standard and needs to be fixed. And ... please put your patch on the sage-combinat queue.

Cheers,

Anne



---

archive/issue_comments_153026.json:
```json
{
    "body": "Ok, changed the documentation, updated the patch in the combinat queue, and added some new functions.\n\nThere are two ways to pull a dominant element out of an affine permutation: one is to sort the Lehmer code, and the other is to write x=g*f, where g is dominant and f is finite type (0-parabolic).  The to_dominant method does the sorting, and the grassmannian_quotient() method returns the pair (g,f).  (Or (f,g) if you specify side='left'.)  I also put in a to_core method, which uses the sorting approach.  One can get the core for the quotient element by doing x.grassmannian_quotient()[0].to_core().\n\nBest,\n-tom",
    "created_at": "2012-10-16T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153026",
    "user": "@sdenton4"
}
```

Ok, changed the documentation, updated the patch in the combinat queue, and added some new functions.

There are two ways to pull a dominant element out of an affine permutation: one is to sort the Lehmer code, and the other is to write x=g*f, where g is dominant and f is finite type (0-parabolic).  The to_dominant method does the sorting, and the grassmannian_quotient() method returns the pair (g,f).  (Or (f,g) if you specify side='left'.)  I also put in a to_core method, which uses the sorting approach.  One can get the core for the quotient element by doing x.grassmannian_quotient()[0].to_core().

Best,
-tom



---

archive/issue_comments_153027.json:
```json
{
    "body": "Hi Tom,\n\nWithout looking at the mathematics yet, here are some Sage specific requirements that your patch does not yet fulfill:\n\n- You need 100% coverage:\n\n\n```\n$affine_permutations anne$ sage -coverage affine_permutations.py \n----------------------------------------------------------------------\naffine_permutations.py\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE affine_permutations.py: 95% (46 of 48)\n\nMissing doctests:\n\t * __init__(self, parent, lst, check=True):\n\t * random_element(self, n):\n\n\nPossibly wrong (function name doesn't occur in doctests):\n\t * _repr_(self):\n\t * check(self):\n\t * lower_covers(self,side=\"right\"):\n\t * _element_constructor_(self, *args, **keywords):\n\t * _repr_(self):\n\t * is_crystallographic(self):\n\t * _an_element_(self):\n```\n\n\n- The preamble of your patch needs to start with #12940: Title + then a summary of what this patch implements.\n\n- The indents of your tests are not right for many of your methods. You need\n\n```\n    EXAMPLES::\n\n        sage: ....\n```\n\nLook at your documentation by building it via \n\n```\nsage -docbuild reference html\n```\n\nI can already see many places where you forgot ` for math display such as in `\\ZZ`.\n\nSo much for now,\n\nAnne",
    "created_at": "2012-10-24T02:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153027",
    "user": "@anneschilling"
}
```

Hi Tom,

Without looking at the mathematics yet, here are some Sage specific requirements that your patch does not yet fulfill:

- You need 100% coverage:


```
$affine_permutations anne$ sage -coverage affine_permutations.py 
----------------------------------------------------------------------
affine_permutations.py
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE affine_permutations.py: 95% (46 of 48)

Missing doctests:
	 * __init__(self, parent, lst, check=True):
	 * random_element(self, n):


Possibly wrong (function name doesn't occur in doctests):
	 * _repr_(self):
	 * check(self):
	 * lower_covers(self,side="right"):
	 * _element_constructor_(self, *args, **keywords):
	 * _repr_(self):
	 * is_crystallographic(self):
	 * _an_element_(self):
```


- The preamble of your patch needs to start with #12940: Title + then a summary of what this patch implements.

- The indents of your tests are not right for many of your methods. You need

```
    EXAMPLES::

        sage: ....
```

Look at your documentation by building it via 

```
sage -docbuild reference html
```

I can already see many places where you forgot ` for math display such as in `\ZZ`.

So much for now,

Anne



---

archive/issue_comments_153028.json:
```json
{
    "body": "Ok, fixed up the docs.  I hadn't seen the -coverage command before.  The ones that are giving warnings now are methods (like _repr_) that are implicitly called within the doc test for that function.\n\nI went through and fixed up latex parts by hand, and am still waiting on the documentation to build to really make a visual check...\n\nBest,\n-tom",
    "created_at": "2012-10-24T07:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153028",
    "user": "@sdenton4"
}
```

Ok, fixed up the docs.  I hadn't seen the -coverage command before.  The ones that are giving warnings now are methods (like _repr_) that are implicitly called within the doc test for that function.

I went through and fixed up latex parts by hand, and am still waiting on the documentation to build to really make a visual check...

Best,
-tom



---

archive/issue_comments_153029.json:
```json
{
    "body": "Thanks, tom. You can put #indirect doctest in the line after your test to calm the \n\n```\nsage -coverage\n```\n\ncommand, if the test indeed indirectly tests the method.\n\nAnne",
    "created_at": "2012-10-24T15:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153029",
    "user": "@anneschilling"
}
```

Thanks, tom. You can put #indirect doctest in the line after your test to calm the 

```
sage -coverage
```

command, if the test indeed indirectly tests the method.

Anne



---

archive/issue_comments_153030.json:
```json
{
    "body": "Hi tom,\n\nSome more Sage comments:\n\n- Currently you have a directory in /sage/combinat called affine_permutations, but there is only one file in there, namely affine_permutations.py. Unless you forsee the addition of further file to break up the code, I would strongly suggest to get rid of the directory and just put affine_permutations.py in /sage/cominbat as is done for permutations, partitions etc..\n\n- For the documentation you need to put a link in /doc/en/reference/combinat\n\nBest,\n\nAnne",
    "created_at": "2012-10-24T16:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153030",
    "user": "@anneschilling"
}
```

Hi tom,

Some more Sage comments:

- Currently you have a directory in /sage/combinat called affine_permutations, but there is only one file in there, namely affine_permutations.py. Unless you forsee the addition of further file to break up the code, I would strongly suggest to get rid of the directory and just put affine_permutations.py in /sage/cominbat as is done for permutations, partitions etc..

- For the documentation you need to put a link in /doc/en/reference/combinat

Best,

Anne



---

archive/issue_comments_153031.json:
```json
{
    "body": "Hi Tom!\n\nFor the directory structure, you may want to follow that of permutation groups. Something like:\n\n```\n    sage/groups/affine_permutation_groups/affine_permutation.py\n                                          affine_symmetric_group.py\n                                          affine_permutation_group.py\n```\n\n\nWhich just made me think: is there a way to generalize the algorithmic\nfor permutation groups (see\nhttp://en.wikipedia.org/wiki/Strong_generating_set) to subgroups of\nthe affine symmetric group? Hmm, if this hasn't been done yet, that\ncould be a fun research project. Of course, the obvious first\ncandidates to play with would be the affine coxeter groups realized as\ngroups of permutations as we had discussed in Montreal.\n\nCheers,\n                           Nicolas",
    "created_at": "2012-10-25T10:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153031",
    "user": "@nthiery"
}
```

Hi Tom!

For the directory structure, you may want to follow that of permutation groups. Something like:

```
    sage/groups/affine_permutation_groups/affine_permutation.py
                                          affine_symmetric_group.py
                                          affine_permutation_group.py
```


Which just made me think: is there a way to generalize the algorithmic
for permutation groups (see
http://en.wikipedia.org/wiki/Strong_generating_set) to subgroups of
the affine symmetric group? Hmm, if this hasn't been done yet, that
could be a fun research project. Of course, the obvious first
candidates to play with would be the affine coxeter groups realized as
groups of permutations as we had discussed in Montreal.

Cheers,
                           Nicolas



---

archive/issue_comments_153032.json:
```json
{
    "body": "Hello!\n\nI've been trying to get this expanded and finished up.  The following changes happened lately:\n\n* Changed the names of things to AffinePermutation and AffinePermutationGroup, because:\n* I added affine permutation groups of types ABCDG.  (E and F are in Eriksson, but are ugly; I want to think about whether there's a cleaner way to go about these ones.)\n* Everything is just in the file affine_permutations.py, which sits directly in sage/combinat\n\nI'm now getting a problem I can't figure out, though: Sage is refusing to import the AffinePermutationGroup name.  It doesn't seem to be previously defined, and when I disable all of the import statements I still get an error (so it can't be an import loop; also, nothing calls my file...).  I can manually attach the file just fine, too.\n\nI've stared at this a good long time and haven't been able to figure out what's going wrong...",
    "created_at": "2013-01-21T12:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153032",
    "user": "@sdenton4"
}
```

Hello!

I've been trying to get this expanded and finished up.  The following changes happened lately:

* Changed the names of things to AffinePermutation and AffinePermutationGroup, because:
* I added affine permutation groups of types ABCDG.  (E and F are in Eriksson, but are ugly; I want to think about whether there's a cleaner way to go about these ones.)
* Everything is just in the file affine_permutations.py, which sits directly in sage/combinat

I'm now getting a problem I can't figure out, though: Sage is refusing to import the AffinePermutationGroup name.  It doesn't seem to be previously defined, and when I disable all of the import statements I still get an error (so it can't be an import loop; also, nothing calls my file...).  I can manually attach the file just fine, too.

I've stared at this a good long time and haven't been able to figure out what's going wrong...



---

archive/issue_comments_153033.json:
```json
{
    "body": "Replying to [comment:12 sdenton]:\n> Hello!\n> \n> I've been trying to get this expanded and finished up.  The following changes happened lately:\n> \n> * Changed the names of things to AffinePermutation and AffinePermutationGroup, because:\n> * I added affine permutation groups of types ABCDG.  (E and F are in Eriksson, but are ugly; I want to think about whether there's a cleaner way to go about these ones.)\n> * Everything is just in the file affine_permutations.py, which sits directly in sage/combinat\n> \n> I'm now getting a problem I can't figure out, though: Sage is refusing to import the AffinePermutationGroup name.  It doesn't seem to be previously defined, and when I disable all of the import statements I still get an error (so it can't be an import loop; also, nothing calls my file...).  I can manually attach the file just fine, too.\n> \n> I've stared at this a good long time and haven't been able to figure out what's going wrong...\n\nAnne tries to write: Don't you mean non-twisted rather than non-exceptional? Type G is exceptional!",
    "created_at": "2013-01-22T09:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153033",
    "user": "@haraldschilly"
}
```

Replying to [comment:12 sdenton]:
> Hello!
> 
> I've been trying to get this expanded and finished up.  The following changes happened lately:
> 
> * Changed the names of things to AffinePermutation and AffinePermutationGroup, because:
> * I added affine permutation groups of types ABCDG.  (E and F are in Eriksson, but are ugly; I want to think about whether there's a cleaner way to go about these ones.)
> * Everything is just in the file affine_permutations.py, which sits directly in sage/combinat
> 
> I'm now getting a problem I can't figure out, though: Sage is refusing to import the AffinePermutationGroup name.  It doesn't seem to be previously defined, and when I disable all of the import statements I still get an error (so it can't be an import loop; also, nothing calls my file...).  I can manually attach the file just fine, too.
> 
> I've stared at this a good long time and haven't been able to figure out what's going wrong...

Anne tries to write: Don't you mean non-twisted rather than non-exceptional? Type G is exceptional!



---

archive/issue_comments_153034.json:
```json
{
    "body": "Hi Tom,\n\nI just answered your question on sage-combinat. In short, you need to remove some old files left over from your /combinat/affine_permutations/ directory by hand since it gets confused about the file and the directory.\n\nAlso, to be consistent with permutation.py, core.py, etc, shouldn't your file be called affine_permutation.py (without the s)?\n\nIn the documentation of AffinePermuation you says\n\n\n```\n    These are combinatorial implmentations of the affine Weyl groups of\n    non-exceptional type as permutations of the set of all integers.\n    the basic algorithms are derived from Bjorner and Brenti's `Combinatorics\n    of Coxeter Groups.'\n```\n\n\nDon't you mean non-twisted rather than non-exceptional. Type G is exceptional!\n\nBest,\n\nAnne",
    "created_at": "2013-01-22T09:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153034",
    "user": "@anneschilling"
}
```

Hi Tom,

I just answered your question on sage-combinat. In short, you need to remove some old files left over from your /combinat/affine_permutations/ directory by hand since it gets confused about the file and the directory.

Also, to be consistent with permutation.py, core.py, etc, shouldn't your file be called affine_permutation.py (without the s)?

In the documentation of AffinePermuation you says


```
    These are combinatorial implmentations of the affine Weyl groups of
    non-exceptional type as permutations of the set of all integers.
    the basic algorithms are derived from Bjorner and Brenti's `Combinatorics
    of Coxeter Groups.'
```


Don't you mean non-twisted rather than non-exceptional. Type G is exceptional!

Best,

Anne



---

archive/issue_comments_153035.json:
```json
{
    "body": "Replying to [ticket:12940 sdenton]:\n> This is a combinatorial implementation of the affine symmetric group, providing a second implementation of the WeylGroup(['A',k,1]), but quite a bit faster.  The basic idea should be easily extensible to the combinatorial interpretations of the other affine types with window notations, and I've discussed a bit with N. Thiery about hacking together a kind of window notation for the other types.",
    "created_at": "2013-02-10T20:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153035",
    "user": "@sdenton4"
}
```

Replying to [ticket:12940 sdenton]:
> This is a combinatorial implementation of the affine symmetric group, providing a second implementation of the WeylGroup(['A',k,1]), but quite a bit faster.  The basic idea should be easily extensible to the combinatorial interpretations of the other affine types with window notations, and I've discussed a bit with N. Thiery about hacking together a kind of window notation for the other types.



---

archive/issue_comments_153036.json:
```json
{
    "body": "Recent changes:\n* Moved everything into a single file, as per reviewer request\n* Expanded to include types affine A,B,C,D,G\n* added TestSuite runs, for better coverage\n* fixed a bug with apply_simple_reflection_left in Type G",
    "created_at": "2013-02-10T23:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153036",
    "user": "@sdenton4"
}
```

Recent changes:
* Moved everything into a single file, as per reviewer request
* Expanded to include types affine A,B,C,D,G
* added TestSuite runs, for better coverage
* fixed a bug with apply_simple_reflection_left in Type G



---

archive/issue_comments_153037.json:
```json
{
    "body": "Added is_fully_commutative to type A.\nRebased to fix an issue with the new documentation system.",
    "created_at": "2013-03-17T20:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153037",
    "user": "@sdenton4"
}
```

Added is_fully_commutative to type A.
Rebased to fix an issue with the new documentation system.



---

archive/issue_comments_153038.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-17T20:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153038",
    "user": "@sdenton4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153039.json:
```json
{
    "body": "Nicolas volunteered me to review the patch. =)\nI sent my comments directly to Tom. When he posts a new version, I can review that.\n\nChris",
    "created_at": "2013-03-24T16:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153039",
    "user": "chrisjamesberg"
}
```

Nicolas volunteered me to review the patch. =)
I sent my comments directly to Tom. When he posts a new version, I can review that.

Chris



---

archive/issue_comments_153040.json:
```json
{
    "body": "This will need to have a minor rebase over #14673.",
    "created_at": "2013-06-01T17:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153040",
    "user": "@tscrim"
}
```

This will need to have a minor rebase over #14673.



---

archive/issue_comments_153041.json:
```json
{
    "body": "Changing keywords from \"affine, combinatorics, days38\" to \"affine, combinatorics, days38, days49\".",
    "created_at": "2013-06-18T08:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153041",
    "user": "chrisjamesberg"
}
```

Changing keywords from "affine, combinatorics, days38" to "affine, combinatorics, days38, days49".



---

archive/issue_comments_153042.json:
```json
{
    "body": "Hi Tom,\n\nI think you need to rebase your patch on top of #8392. There is a conflict with the all.py file!\n\nAlso, would it be possible to explain the input of AffinePermutations in the header, since this is what the user will see if (s)he types AffinePermutations??.\n\nThank you!\n\nAnne",
    "created_at": "2013-06-18T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153042",
    "user": "@anneschilling"
}
```

Hi Tom,

I think you need to rebase your patch on top of #8392. There is a conflict with the all.py file!

Also, would it be possible to explain the input of AffinePermutations in the header, since this is what the user will see if (s)he types AffinePermutations??.

Thank you!

Anne



---

archive/issue_comments_153043.json:
```json
{
    "body": "Hi Tom,\n\nI put a rebased version of the patch on the sage-combinat queue. But please also add the input information for the AffinePermutations.\n\nAnne",
    "created_at": "2013-06-18T09:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153043",
    "user": "@anneschilling"
}
```

Hi Tom,

I put a rebased version of the patch on the sage-combinat queue. But please also add the input information for the AffinePermutations.

Anne



---

archive/issue_comments_153044.json:
```json
{
    "body": "Hi Tom,\n\nHere are some more comments about your patch:\n\n-  is_i_grassmannian(i=0, side='right') needs a description of the input (like the i).\n\n- Please explain the input of to_weyl_group_element(W=None)\n\n- has_right_descent has a description of an option which is not there ('right' or 'left').\nSame for has_left_descent.\n\n- Everywhere in the file you seem to use OPTIONS:. This should be replaced by or combined with INPUT. Also, as far as I know the syntax is\n\n```\n- ``variable`` -- description of what it does.\n```\n\n\nTom, could you make the above changes? Also, I left a review patch called trac_12940-review-as.patch on the sage-combinat queue. Please fold it into the rebased patch on the sage-combinat queue.\n\nThanks!\n\nAnne",
    "created_at": "2013-06-18T13:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153044",
    "user": "@anneschilling"
}
```

Hi Tom,

Here are some more comments about your patch:

-  is_i_grassmannian(i=0, side='right') needs a description of the input (like the i).

- Please explain the input of to_weyl_group_element(W=None)

- has_right_descent has a description of an option which is not there ('right' or 'left').
Same for has_left_descent.

- Everywhere in the file you seem to use OPTIONS:. This should be replaced by or combined with INPUT. Also, as far as I know the syntax is

```
- ``variable`` -- description of what it does.
```


Tom, could you make the above changes? Also, I left a review patch called trac_12940-review-as.patch on the sage-combinat queue. Please fold it into the rebased patch on the sage-combinat queue.

Thanks!

Anne



---

archive/issue_comments_153045.json:
```json
{
    "body": "Hi Tom,\n\nOne more comment: please use\n\nREFERENCE:\n\n[XXX] blaba\n\nfor references and cite them via [XXX]_. See elsewhere in Sage how this is done!\n\nAnne",
    "created_at": "2013-06-18T13:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153045",
    "user": "@anneschilling"
}
```

Hi Tom,

One more comment: please use

REFERENCE:

[XXX] blaba

for references and cite them via [XXX]_. See elsewhere in Sage how this is done!

Anne



---

archive/issue_comments_153046.json:
```json
{
    "body": "Attachment [trac_12940_affine_permutations-td.2.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.2.patch) by @sdenton4 created at 2013-06-19 07:57:35",
    "created_at": "2013-06-19T07:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153046",
    "user": "@sdenton4"
}
```

Attachment [trac_12940_affine_permutations-td.2.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.2.patch) by @sdenton4 created at 2013-06-19 07:57:35



---

archive/issue_comments_153047.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-06-19T10:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153047",
    "user": "@anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153048.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2013-06-20T07:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153048",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_153049.json:
```json
{
    "body": "The patch needs a proper commit message (use hg qrefresh -e to change the message).",
    "created_at": "2013-06-20T07:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153049",
    "user": "@jdemeyer"
}
```

The patch needs a proper commit message (use hg qrefresh -e to change the message).



---

archive/issue_comments_153050.json:
```json
{
    "body": "Attachment [trac_12940_affine_permutations-td.3.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.3.patch) by @anneschilling created at 2013-06-20 08:31:00",
    "created_at": "2013-06-20T08:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153050",
    "user": "@anneschilling"
}
```

Attachment [trac_12940_affine_permutations-td.3.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.3.patch) by @anneschilling created at 2013-06-20 08:31:00



---

archive/issue_comments_153051.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-06-20T08:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153051",
    "user": "@anneschilling"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_153052.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-06-20T08:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153052",
    "user": "chrisjamesberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153053.json:
```json
{
    "body": "Apply: trac_12940_affine_permutations-td.3.patch",
    "created_at": "2013-06-20T08:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153053",
    "user": "chrisjamesberg"
}
```

Apply: trac_12940_affine_permutations-td.3.patch



---

archive/issue_comments_153054.json:
```json
{
    "body": "This patch badly abuses `assert` statements. Assertions should be used to check correctness of the code, not to validate user input. Any `AssertionError` caused by the use of public functions is by definition a bug.",
    "created_at": "2013-06-20T09:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153054",
    "user": "@jdemeyer"
}
```

This patch badly abuses `assert` statements. Assertions should be used to check correctness of the code, not to validate user input. Any `AssertionError` caused by the use of public functions is by definition a bug.



---

archive/issue_comments_153055.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-06-20T09:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153055",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_153056.json:
```json
{
    "body": "Also, while you're at it, could you use the new style doctest continuations:\n\n```\nsage: for a in CP: \n....:     p.to_lehmer_code(a[0],a[1])\n```\n\ninstead of\n\n```\nsage: for a in CP: \n...     p.to_lehmer_code(a[0],a[1])\n```\n",
    "created_at": "2013-06-20T09:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153056",
    "user": "@jdemeyer"
}
```

Also, while you're at it, could you use the new style doctest continuations:

```
sage: for a in CP: 
....:     p.to_lehmer_code(a[0],a[1])
```

instead of

```
sage: for a in CP: 
...     p.to_lehmer_code(a[0],a[1])
```




---

archive/issue_comments_153057.json:
```json
{
    "body": "I'm confused, then; my understanding of the clonable array class was that it needs to have a check method which throws assertion errors if the 'checked' clonable array doesn't actually check out as a proper object.  This checks simultaneously for user errors and for code errors.\n\nCould you point me to a discussion or coding convention on proper ways to use assert statements or check for input correctness?",
    "created_at": "2013-06-20T09:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153057",
    "user": "@sdenton4"
}
```

I'm confused, then; my understanding of the clonable array class was that it needs to have a check method which throws assertion errors if the 'checked' clonable array doesn't actually check out as a proper object.  This checks simultaneously for user errors and for code errors.

Could you point me to a discussion or coding convention on proper ways to use assert statements or check for input correctness?



---

archive/issue_comments_153058.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-06-20T10:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153058",
    "user": "@sdenton4"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153059.json:
```json
{
    "body": "Changed all assert statements outside of the 'check' and '_test.+' methods into ValueErrors.  Others left as 'assert' according to conventions in:\nhttp://www.sagemath.org/doc/reference/structure/sage/structure/list_clone.html",
    "created_at": "2013-06-20T10:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153059",
    "user": "@sdenton4"
}
```

Changed all assert statements outside of the 'check' and '_test.+' methods into ValueErrors.  Others left as 'assert' according to conventions in:
http://www.sagemath.org/doc/reference/structure/sage/structure/list_clone.html



---

archive/issue_comments_153060.json:
```json
{
    "body": "Replying to [comment:34 sdenton]:\n> Could you point me to a discussion or coding convention on proper ways to use assert statements or check for input correctness?\nThis has been discussed before, but I can't find the discussion anymore. There is some discussion at [http://stackoverflow.com/questions/944592/best-practice-for-python-assert/945135#945135](http://stackoverflow.com/questions/944592/best-practice-for-python-assert/945135#945135)\n\nAssertions (and this is not specific to Sage or Python) are internal checks for code correctness. Don't forget that assertions can be turned off (run Python with `-O` switch) and you don't want user code to depend on whether on not assertions are enabled.\n\nI think of assertion failures as serious as a crash due to a Segmentation Fault: it is always a bug in the program if one occurs.\n\nMost of the assertions in this ticket should be replaced by something of the form\n\n```\nif not some_condition:\n    raise ValueError(\"some_condition failed\")\n```\n\nor `TypeError` depending on the kind of error.",
    "created_at": "2013-06-20T10:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153060",
    "user": "@jdemeyer"
}
```

Replying to [comment:34 sdenton]:
> Could you point me to a discussion or coding convention on proper ways to use assert statements or check for input correctness?
This has been discussed before, but I can't find the discussion anymore. There is some discussion at [http://stackoverflow.com/questions/944592/best-practice-for-python-assert/945135#945135](http://stackoverflow.com/questions/944592/best-practice-for-python-assert/945135#945135)

Assertions (and this is not specific to Sage or Python) are internal checks for code correctness. Don't forget that assertions can be turned off (run Python with `-O` switch) and you don't want user code to depend on whether on not assertions are enabled.

I think of assertion failures as serious as a crash due to a Segmentation Fault: it is always a bug in the program if one occurs.

Most of the assertions in this ticket should be replaced by something of the form

```
if not some_condition:
    raise ValueError("some_condition failed")
```

or `TypeError` depending on the kind of error.



---

archive/issue_comments_153061.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-06-20T10:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153061",
    "user": "chrisjamesberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153062.json:
```json
{
    "body": "Replying to [comment:36 sdenton]:\n> Changed all assert statements outside of the 'check' and '_test.+' methods into ValueErrors.  Others left as 'assert' according to conventions in:\n> http://www.sagemath.org/doc/reference/structure/sage/structure/list_clone.html\nI think that `IncreasingArray` is doing things wrongly, so don't copy from that. It's not so bad though, since `IncreasingArray` is not meant to be used directly by users (it's a \"small extension class for testing `ClonableArray`\").",
    "created_at": "2013-06-20T10:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153062",
    "user": "@jdemeyer"
}
```

Replying to [comment:36 sdenton]:
> Changed all assert statements outside of the 'check' and '_test.+' methods into ValueErrors.  Others left as 'assert' according to conventions in:
> http://www.sagemath.org/doc/reference/structure/sage/structure/list_clone.html
I think that `IncreasingArray` is doing things wrongly, so don't copy from that. It's not so bad though, since `IncreasingArray` is not meant to be used directly by users (it's a "small extension class for testing `ClonableArray`").



---

archive/issue_comments_153063.json:
```json
{
    "body": "I think that's the whole idea of the check methods: they aren't directly accessed by the user, but called to check the integrity of the object.",
    "created_at": "2013-06-20T10:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153063",
    "user": "@sdenton4"
}
```

I think that's the whole idea of the check methods: they aren't directly accessed by the user, but called to check the integrity of the object.



---

archive/issue_comments_153064.json:
```json
{
    "body": "Similarly, should one use asserts or exceptions in test suite methods?",
    "created_at": "2013-06-20T10:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153064",
    "user": "@sdenton4"
}
```

Similarly, should one use asserts or exceptions in test suite methods?



---

archive/issue_comments_153065.json:
```json
{
    "body": "Replying to [comment:41 sdenton]:\n> Similarly, should one use asserts or exceptions in test suite methods?\nIn test suites, assertions are fine.",
    "created_at": "2013-06-20T10:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153065",
    "user": "@jdemeyer"
}
```

Replying to [comment:41 sdenton]:
> Similarly, should one use asserts or exceptions in test suite methods?
In test suites, assertions are fine.



---

archive/issue_comments_153066.json:
```json
{
    "body": "The following is still a bug. It's a clear example of bad user input leading to an `AssertionError`:\n\n```\nsage: AffinePermutationGroup(['A',8,1])([0])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n...\nAssertionError: Length of list must be k+1=9.\n```\n",
    "created_at": "2013-06-20T10:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153066",
    "user": "@jdemeyer"
}
```

The following is still a bug. It's a clear example of bad user input leading to an `AssertionError`:

```
sage: AffinePermutationGroup(['A',8,1])([0])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
...
AssertionError: Length of list must be k+1=9.
```




---

archive/issue_comments_153067.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-06-20T10:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153067",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_153068.json:
```json
{
    "body": "Replying to [comment:40 sdenton]:\n> I think that's the whole idea of the check methods: they aren't directly accessed by the user\nIt doesn't matter if they are directly or indirectly accessed by the user, what matters is that these \"check\" methods are used for validating user input.",
    "created_at": "2013-06-20T10:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153068",
    "user": "@jdemeyer"
}
```

Replying to [comment:40 sdenton]:
> I think that's the whole idea of the check methods: they aren't directly accessed by the user
It doesn't matter if they are directly or indirectly accessed by the user, what matters is that these "check" methods are used for validating user input.



---

archive/issue_comments_153069.json:
```json
{
    "body": "Read this sentence again: **I think of assertion failures as serious as a crash due to a Segmentation Fault: it is always a bug in the program if one occurs.**",
    "created_at": "2013-06-20T10:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153069",
    "user": "@jdemeyer"
}
```

Read this sentence again: **I think of assertion failures as serious as a crash due to a Segmentation Fault: it is always a bug in the program if one occurs.**



---

archive/issue_comments_153070.json:
```json
{
    "body": "Please don't use `ClonableArray` as an example, it shouldn't be using assertions that way.",
    "created_at": "2013-06-20T10:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153070",
    "user": "@jdemeyer"
}
```

Please don't use `ClonableArray` as an example, it shouldn't be using assertions that way.



---

archive/issue_comments_153071.json:
```json
{
    "body": "One more way to think of assertions: they express \"I *know* this condition is true\", not \"I want to *check* that this condition is true\".",
    "created_at": "2013-06-20T11:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153071",
    "user": "@jdemeyer"
}
```

One more way to think of assertions: they express "I *know* this condition is true", not "I want to *check* that this condition is true".



---

archive/issue_comments_153072.json:
```json
{
    "body": "Hi Jeroen,\n\nThank you for your comments! The asserts in the check methods of ClonableArrays/Lists seem to be in a grey area, since they are used for both the user input check as well as internal checks. Is assert ok here? If not, I would strongly suggest to change the documentation of ClonableArray to show how things are supposed to be used!\n\nThank you,\n\nAnne\n\nReplying to [comment:47 jdemeyer]:\n> One more way to think of assertions: they express \"I *know* this condition is true\", not \"I want to *check* that this condition is true\".",
    "created_at": "2013-06-20T12:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153072",
    "user": "@anneschilling"
}
```

Hi Jeroen,

Thank you for your comments! The asserts in the check methods of ClonableArrays/Lists seem to be in a grey area, since they are used for both the user input check as well as internal checks. Is assert ok here? If not, I would strongly suggest to change the documentation of ClonableArray to show how things are supposed to be used!

Thank you,

Anne

Replying to [comment:47 jdemeyer]:
> One more way to think of assertions: they express "I *know* this condition is true", not "I want to *check* that this condition is true".



---

archive/issue_comments_153073.json:
```json
{
    "body": "If this is the accepted usage of asserts vs ValueErrors in Sage, they should be written up as such in the developer's guide; there wasn't any way for me to know this was the local convention.  Additionally, a bug+patch should be made for the Cloneable Array class.\n\nThe line between internal assumptions and user input becomes very thin in Sage, and this is an example of a very close case.  The idea of the Cloneable Array is that it's a simple data type with some extra assumptions.  When making a new one of these objects, you might break those assumptions temporarily, but should end up with something that satisfies the assumptions, and the 'check' methods are intended to check that your methods have actually made this transformation effectively.  This is a machine use of the check method, but - as you say - the check method also works well to check user input.  After all, user input IS code in Sage!  It's not a bug in my code if buggy input fails to run.  It's a very, very different situation from taking user input from, say, a web form and getting an Assertion Error.  Users can run arbitrary code, so if you want to avoid assertion errors at all cost, it should simply be completely off-limits to use assert statements at all.  I have, as a user, definitely used statements like ``X._test_whatever()``, which, as you say, are fine to have assert statements.\n\nIn short, if an assertion error happens in my code, yes, it's a bug in the program.  If one happens due to code that's been supplied by the user, it's a bug in the user's input.  \n\nThe only reason I can actually get behind to switch to ValueErrors is that it's possible to turn off assertion errors at the Python level.  But this doesn't seem to be why you think they're as bad as segmentation faults....\n\nIn any case, I've refactored the code, and am attaching a new version of the patch.",
    "created_at": "2013-06-20T13:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153073",
    "user": "@sdenton4"
}
```

If this is the accepted usage of asserts vs ValueErrors in Sage, they should be written up as such in the developer's guide; there wasn't any way for me to know this was the local convention.  Additionally, a bug+patch should be made for the Cloneable Array class.

The line between internal assumptions and user input becomes very thin in Sage, and this is an example of a very close case.  The idea of the Cloneable Array is that it's a simple data type with some extra assumptions.  When making a new one of these objects, you might break those assumptions temporarily, but should end up with something that satisfies the assumptions, and the 'check' methods are intended to check that your methods have actually made this transformation effectively.  This is a machine use of the check method, but - as you say - the check method also works well to check user input.  After all, user input IS code in Sage!  It's not a bug in my code if buggy input fails to run.  It's a very, very different situation from taking user input from, say, a web form and getting an Assertion Error.  Users can run arbitrary code, so if you want to avoid assertion errors at all cost, it should simply be completely off-limits to use assert statements at all.  I have, as a user, definitely used statements like ``X._test_whatever()``, which, as you say, are fine to have assert statements.

In short, if an assertion error happens in my code, yes, it's a bug in the program.  If one happens due to code that's been supplied by the user, it's a bug in the user's input.  

The only reason I can actually get behind to switch to ValueErrors is that it's possible to turn off assertion errors at the Python level.  But this doesn't seem to be why you think they're as bad as segmentation faults....

In any case, I've refactored the code, and am attaching a new version of the patch.



---

archive/issue_comments_153074.json:
```json
{
    "body": "Replying to [comment:49 sdenton]:\n> If this is the accepted usage of asserts vs ValueErrors in Sage, they should be written up as such in the developer's guide; there wasn't any way for me to know this was the local convention.\nIt's not a local convention, it is a general convention independent of Sage or Python. I think you will find that [http://en.wikipedia.org/wiki/Assertion_(software_development)#Comparison_with_error_handling](http://en.wikipedia.org/wiki/Assertion_(software_development)#Comparison_with_error_handling) mostly agrees with me.\n\n> After all, user input IS code in Sage!\nI don't understand what you mean with this.\n\n> It's a very, very different situation from taking user input from, say, a web form and getting an Assertion Error.\nWhy? What makes calling `AffinePermutationGroup()` so different from filling in a web form?\n\n> I have, as a user, definitely used statements like ``X._test_whatever()``, which, as you say, are fine to have assert statements.\nUnderscored methods are supposed to be private, so you're expected to know what you're doing. Everything I said applies to using public, documented functions. Of course, everything can happen if you mess with internal data structures.\n\n> It's not a bug in my code if buggy input fails to run.\nThat's perhaps a matter of opinion. Would you find it a bug in the `rm` command if it crashed with a Segmentation Fault if the file could not be found? Would you find it a bug in your web browser if it crashed every time you fill in a non-existing URL?",
    "created_at": "2013-06-20T14:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153074",
    "user": "@jdemeyer"
}
```

Replying to [comment:49 sdenton]:
> If this is the accepted usage of asserts vs ValueErrors in Sage, they should be written up as such in the developer's guide; there wasn't any way for me to know this was the local convention.
It's not a local convention, it is a general convention independent of Sage or Python. I think you will find that [http://en.wikipedia.org/wiki/Assertion_(software_development)#Comparison_with_error_handling](http://en.wikipedia.org/wiki/Assertion_(software_development)#Comparison_with_error_handling) mostly agrees with me.

> After all, user input IS code in Sage!
I don't understand what you mean with this.

> It's a very, very different situation from taking user input from, say, a web form and getting an Assertion Error.
Why? What makes calling `AffinePermutationGroup()` so different from filling in a web form?

> I have, as a user, definitely used statements like ``X._test_whatever()``, which, as you say, are fine to have assert statements.
Underscored methods are supposed to be private, so you're expected to know what you're doing. Everything I said applies to using public, documented functions. Of course, everything can happen if you mess with internal data structures.

> It's not a bug in my code if buggy input fails to run.
That's perhaps a matter of opinion. Would you find it a bug in the `rm` command if it crashed with a Segmentation Fault if the file could not be found? Would you find it a bug in your web browser if it crashed every time you fill in a non-existing URL?



---

archive/issue_comments_153075.json:
```json
{
    "body": "Perhaps this should be a `NotImplementedError`:\n\n```\nraise ValueError('Cartan type provided is not implemented as an affine permutation group.')\n```\n",
    "created_at": "2013-06-20T14:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153075",
    "user": "@jdemeyer"
}
```

Perhaps this should be a `NotImplementedError`:

```
raise ValueError('Cartan type provided is not implemented as an affine permutation group.')
```




---

archive/issue_comments_153076.json:
```json
{
    "body": "Switched to NotImplementedError in the indicated place.  Can this finally get out the door now?",
    "created_at": "2013-06-20T15:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153076",
    "user": "@sdenton4"
}
```

Switched to NotImplementedError in the indicated place.  Can this finally get out the door now?



---

archive/issue_comments_153077.json:
```json
{
    "body": "Patch file.",
    "created_at": "2013-06-20T16:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153077",
    "user": "@sdenton4"
}
```

Patch file.



---

archive/issue_comments_153078.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-06-20T16:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153078",
    "user": "@anneschilling"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_153079.json:
```json
{
    "body": "Attachment [trac_12940_affine_permutations-td.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.patch) by @anneschilling created at 2013-06-20 16:45:02",
    "created_at": "2013-06-20T16:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153079",
    "user": "@anneschilling"
}
```

Attachment [trac_12940_affine_permutations-td.patch](tarball://root/attachments/some-uuid/ticket12940/trac_12940_affine_permutations-td.patch) by @anneschilling created at 2013-06-20 16:45:02



---

archive/issue_comments_153080.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-07-31T12:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12768#issuecomment-153080",
    "user": "@jdemeyer"
}
```

Resolution: fixed
