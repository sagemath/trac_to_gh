# Issue 15726: finite_state_machine: New attribute FSMState.color to prohibit merging in simplification

Issue created by migration from Trac.

Original creator: cheuberg

Original creation time: 2014-03-17 14:52:13

CC:  skropf

Keywords: finite_state_machine

In some circumstances, it might be desirable to prohibit merging of states
in finite state machine simplification, e.g., if there is some extra distinction between states
that is not captured in outgoing transitions. Therefore, the notion of "color" of a state
is introduced such that states of different colors are never merged.


---

Comment by cheuberg created at 2014-03-17 14:52:21

Changing status from new to needs_review.


---

Comment by dkrenn created at 2014-03-18 09:54:42

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2014-03-18 09:54:42

code looks fine, doctests pass, docu checked, coverage checked

(also reviewed all its dependencies)


---

Comment by git created at 2014-04-05 07:19:12

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-04-05 07:19:12

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by cheuberg created at 2014-04-05 07:24:46

The following behaviour is undesired (docstrings says that
colors are tuples of the colors of the constituent states,
but this is not the case and leads to problems in
Automaton.determinisation):

```
sage: A = Automaton([This is the Trac macro *0, 0, 0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 0, 0-macro), initial_states=[0])
sage: B = A.product_FiniteStateMachine(A,
....:                                  lambda t1, t2: (0, None))
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
sage: A = Automaton([This is the Trac macro *0, 0, 0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0, 0, 0-macro), initial_states=[0])
sage: B = A.composition(A, algorithm='explorative')
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
```

I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.


---

Comment by vbraun created at 2014-04-05 10:43:44

Resolution: fixed


---

Comment by dkrenn created at 2014-04-09 17:07:14

Replying to [comment:4 cheuberg]:
> The following behaviour is undesired (docstrings says that
> colors are tuples of the colors of the constituent states,
> but this is not the case and leads to problems in
> Automaton.determinisation):
> ...
> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.

I've reviewed those --> positive_review


---

Comment by cheuberg created at 2015-04-17 04:25:02

The last commit was not merged in this ticket, but at #16128.
