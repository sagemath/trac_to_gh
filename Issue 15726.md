# Issue 15726: finite_state_machine: New attribute FSMState.color to prohibit merging in simplification

archive/issues_015726.json:
```json
{
    "body": "CC:  skropf\n\nKeywords: finite_state_machine\n\nIn some circumstances, it might be desirable to prohibit merging of states\nin finite state machine simplification, e.g., if there is some extra distinction between states\nthat is not captured in outgoing transitions. Therefore, the notion of \"color\" of a state\nis introduced such that states of different colors are never merged.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15963\n\n",
    "created_at": "2014-03-17T14:52:13Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "finite_state_machine: New attribute FSMState.color to prohibit merging in simplification",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15726",
    "user": "@cheuberg"
}
```
CC:  skropf

Keywords: finite_state_machine

In some circumstances, it might be desirable to prohibit merging of states
in finite state machine simplification, e.g., if there is some extra distinction between states
that is not captured in outgoing transitions. Therefore, the notion of "color" of a state
is introduced such that states of different colors are never merged.

Issue created by migration from https://trac.sagemath.org/ticket/15963





---

archive/issue_comments_203562.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-17T14:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203562",
    "user": "@cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_203563.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-18T09:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203563",
    "user": "@dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_203564.json:
```json
{
    "body": "code looks fine, doctests pass, docu checked, coverage checked\n\n(also reviewed all its dependencies)",
    "created_at": "2014-03-18T09:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203564",
    "user": "@dkrenn"
}
```

code looks fine, doctests pass, docu checked, coverage checked

(also reviewed all its dependencies)



---

archive/issue_comments_203565.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-04-05T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203565",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_203566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-04-05T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_203567.json:
```json
{
    "body": "The following behaviour is undesired (docstrings says that\ncolors are tuples of the colors of the constituent states,\nbut this is not the case and leads to problems in\nAutomaton.determinisation):\n\n```\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.product_FiniteStateMachine(A,\n....:                                  lambda t1, t2: (0, None))\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\nsage: A = Automaton([[0, 0, 0]], initial_states=[0])\nsage: B = A.composition(A, algorithm='explorative')\nsage: B.states()[0].color\n[None, None]\nsage: B.determinisation()\nTraceback (most recent call last):\n...\nTypeError: unhashable type: 'list'\n```\n\nI pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.",
    "created_at": "2014-04-05T07:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203567",
    "user": "@cheuberg"
}
```

The following behaviour is undesired (docstrings says that
colors are tuples of the colors of the constituent states,
but this is not the case and leads to problems in
Automaton.determinisation):

```
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.product_FiniteStateMachine(A,
....:                                  lambda t1, t2: (0, None))
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
sage: A = Automaton([[0, 0, 0]], initial_states=[0])
sage: B = A.composition(A, algorithm='explorative')
sage: B.states()[0].color
[None, None]
sage: B.determinisation()
Traceback (most recent call last):
...
TypeError: unhashable type: 'list'
```

I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.



---

archive/issue_comments_203568.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-05T10:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203568",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_203569.json:
```json
{
    "body": "Replying to [comment:4 cheuberg]:\n> The following behaviour is undesired (docstrings says that\n> colors are tuples of the colors of the constituent states,\n> but this is not the case and leads to problems in\n> Automaton.determinisation):\n> ...\n> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.\n\nI've reviewed those --> positive_review",
    "created_at": "2014-04-09T17:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203569",
    "user": "@dkrenn"
}
```

Replying to [comment:4 cheuberg]:
> The following behaviour is undesired (docstrings says that
> colors are tuples of the colors of the constituent states,
> but this is not the case and leads to problems in
> Automaton.determinisation):
> ...
> I pushed commits correcting this and adding two more docstrings to emphasize that colors have to be hashable in order to be able to use Automaton.determinisation.

I've reviewed those --> positive_review



---

archive/issue_comments_203570.json:
```json
{
    "body": "The last commit was not merged in this ticket, but at #16128.",
    "created_at": "2015-04-17T04:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15726#issuecomment-203570",
    "user": "@cheuberg"
}
```

The last commit was not merged in this ticket, but at #16128.
