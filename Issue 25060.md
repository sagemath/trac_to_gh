# Issue 25060: Quotient ring elements don't convert correctly from Singular

Issue created by migration from Trac.

Original creator: @BrentBaccala

Original creation time: 2018-05-06 04:16:45

CC:  mmezzarobba

Test case:

Create a multivariate quotient ring, construct an ideal, extract a generator from the ideal, and ensure that it can be `lift`ed back to the original ring:


```
sage: R.<x,y> = QQ[]
sage: SE.<xbar,ybar> = R.quotient(x^2 + y^2 - 1)
sage: P = ideal(xbar,ybar)
sage: P.0
xbar
sage: P.0.parent()
Quotient of Multivariate Polynomial Ring in x, y over Rational Field by the ideal (x^2 + y^2 - 1)
sage: P.0.lift()
x
sage: P.0.lift().parent()
Multivariate Polynomial Ring in x, y over Rational Field
```


Now convert the ideal to Singular, then back to Sage, and try to do the lift again:


```
sage: P2 = P._singular_().sage()
sage: P2
Ideal (x, y) of Quotient of Multivariate Polynomial Ring in x, y over Rational Field by the ideal (x^2 + y^2 - 1)
sage: P2.0
x
sage: P2.0.parent()
Quotient of Multivariate Polynomial Ring in x, y over Rational Field by the ideal (x^2 + y^2 - 1)
sage: P2.0.lift()
x
sage: P2.0.lift().parent()
Quotient of Multivariate Polynomial Ring in x, y over Rational Field by the ideal (x^2 + y^2 - 1)
```


The problem is related to how a QuotientRingElement is constructed:


```
Help on class QuotientRingElement in module sage.rings.quotient_ring_element:

class QuotientRingElement(sage.structure.element.RingElement)
 |  An element of a quotient ring `R/I`.
 |  
 |  INPUT:
 |  
 |  - ``parent`` - the ring `R/I`
 |  
 |  - ``rep`` - a representative of the element in `R`; this is used
 |    as the internal representation of the element
 |  
 |  - ``reduce`` - bool (optional, default: True) - if True, then the
 |    internal representation of the element is ``rep`` reduced modulo
 |    the ideal `I`
```


Notice that `rep` should be in the cover ring, but the Singular conversion function builds it in the quotient ring itself.

Another problem with this code is that it assumes that any QuotientRing_generic is implemented using MPolynomial_polydict.

This patch uses the default element constructors of both the QuotientRing and the MPolynomialRing to correctly convert quotient ring elements back from Singular to Sage.

There is a single change to a regression test, where a Singular element is now reduced modulo the quotient ring's ideal when it gets converted to Sage (as it should be, in my opinion).

I couldn't simplify the test case any further, because just converting a quotient ring element to Singular and back to Sage moved it into the cover ring:


```
sage: xbar._singular_().sage()
x
sage: xbar._singular_().sage().parent()
Multivariate Polynomial Ring in x, y over Rational Field
```


I think this might be a separate bug.

Also, should the term "cover ring" or "ambient ring" be preferred?  QuotientRing implements the method `cover_ring` and makes `ambient` a copy of it.


---

Comment by @BrentBaccala created at 2018-05-06 04:27:46

New commits:


---

Comment by @BrentBaccala created at 2018-05-06 04:27:46

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2018-05-10 19:04:39

Travis, sorry, but while I sometimes have to patch stuff that uses libsingular, I know very little about Singular in general, or about the Singular text interface in Sage...

That being said, the changes in this ticket look good to me. (A question on a minor point though: why are you changing `isinstance()` to `is_Foo()` in some places? I think the current tendency is to slowly get rid of these `is_Foo()` functions in cases where they don't bring anything.)


---

Comment by tscrim created at 2018-05-10 22:21:14

Replying to [comment:3 mmezzarobba]:
> Travis, sorry, but while I sometimes have to patch stuff that uses libsingular, I know very little about Singular in general, or about the Singular text interface in Sage...

No worries. I have even less knowledge, but I was just trying to put someone in cc who might either know, use the code, or know who could review the code.

> That being said, the changes in this ticket look good to me. (A question on a minor point though: why are you changing `isinstance()` to `is_Foo()` in some places? I think the current tendency is to slowly get rid of these `is_Foo()` functions in cases where they don't bring anything.)

+1 on reverting these changes as well.


---

Comment by git created at 2018-05-13 01:56:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2018-05-13 01:57:44

Replying to [comment:4 tscrim]:
> Replying to [comment:3 mmezzarobba]:
> > That being said, the changes in this ticket look good to me. (A question on a minor point though: why are you changing `isinstance()` to `is_Foo()` in some places? I think the current tendency is to slowly get rid of these `is_Foo()` functions in cases where they don't bring anything.)
> 
> +1 on reverting these changes as well.

I'm pretty new to Sage, and thought that those `is_Foo()` were provided, and so should be preferred.  Change reverted.


---

Comment by tscrim created at 2018-05-13 08:34:02

Patchbot is green, so I am going to give the go-ahead. Thanks to both.

Brent, the reasoning is that it is an extra Python function call, which is relatively expensive compared to an `isinstance`. Plus we eventually hope to do away with most/all of the `is_Foo()` functions.


---

Comment by tscrim created at 2018-05-13 08:34:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-15 22:33:34

Resolution: fixed
