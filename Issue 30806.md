# Issue 30806: Preparsing aborts when first line is a comment

Issue created by migration from https://trac.sagemath.org/ticket/31043

Original creator: @spaghettisalat

Original creation time: 2020-12-12 14:56:08

CC:  slelievre egourgoulhon strogdon

For example


```
preparse('''# some comment

some_function(some_var) = some_var
         ''')
```


yields


```
# ðšœðš˜ðš–ðšŽ ðšŒðš˜ðš–ðš–ðšŽðš—ðš

ðšœðš˜ðš–ðšŽ_ðšðšžðš—ðšŒðšðš’ðš˜ðš—(ðšœðš˜ðš–ðšŽ_ðšŸðšŠðš›)=ðšœðš˜ðš–ðšŽ_ðšŸðšŠðš›
```


instead of the correct


```
# ðšœðš˜ðš–ðšŽ ðšŒðš˜ðš–ðš–ðšŽðš—ðš

__ðšðš–ðš™__=ðšŸðšŠðš›("ðšœðš˜ðš–ðšŽ_ðšŸðšŠðš›");ðšœðš˜ðš–ðšŽ_ðšðšžðš—ðšŒðšðš’ðš˜ðš—=ðšœðš¢ðš–ðš‹ðš˜ðš•ðš’ðšŒ_ðšŽðš¡ðš™ðš›ðšŽðšœðšœðš’ðš˜ðš—(ðšœðš˜ðš–ðšŽ_ðšŸðšŠðš›).ðšðšžðš—ðšŒðšðš’ðš˜ðš—(ðšœðš˜ðš–ðšŽ_ðšŸðšŠðš›)
```




---

Comment by @spaghettisalat created at 2020-12-12 14:59:16

New commits:


---

Comment by @spaghettisalat created at 2020-12-12 14:59:16

Changing status from new to needs_review.


---

Comment by git created at 2020-12-29 23:09:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2020-12-29 23:13:34

I believe I broke this with my fix for #30928. Thank you for spotting it and submitting a fix! I've taken the liberty of adding a regression test. Oh, please add yourself as the first author, too.


---

Comment by @jcamp0x2a created at 2020-12-29 23:13:34

Changing component from PLEASE CHANGE to user interface.


---

Comment by slelievre created at 2021-01-02 20:01:32

Maybe the doctest could be more similar to the one above it.

Something like:


```diff
-        sage: preparse('''# some comment
-        ....: some_function(some_var) = some_var''')
-        '# some comment\n__tmp__=var("some_var"); some_function = symbolic_expression(some_var).function(some_var)'
+        sage: print(preparse('''# some comment
+        ....: f(x) = x + 1'''))
+        # some comment
+        __tmp__=var("x"); f = symbolic_expression(x + Integer(1)).function(x)
```



---

Comment by git created at 2021-01-03 16:55:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2021-01-03 16:57:11

Replying to [comment:4 slelievre]:
> Maybe the doctest could be more similar to the one above it.

Agreed. I've incorporated your suggested change into the branch. Thanks!


---

Comment by slelievre created at 2021-01-04 10:14:51

Thanks! Good to go.


---

Comment by slelievre created at 2021-01-04 10:14:51

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-01-04 10:17:07

Changing keywords from "" to "preparser, multiline input, comment".


---

Comment by vbraun created at 2021-01-17 13:45:57

Resolution: fixed
