# Issue 31451: Pullbacks of manifold subsets under continuous maps

archive/issues_031451.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim @mjungmath\n\nSimilar to #31653, given a continuous map `\\Phi: N -> M` and a manifold subset `S` of `M`, we define the pullback (preimage) of `S` as the subset of `N` of points `p` with `\\Phi(p)` in `S`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31688\n\n",
    "created_at": "2021-04-19T00:13:11Z",
    "labels": [
        "manifolds",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Pullbacks of manifold subsets under continuous maps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31451",
    "user": "@mkoeppe"
}
```
CC:  @egourgoulhon @tscrim @mjungmath

Similar to #31653, given a continuous map `\Phi: N -> M` and a manifold subset `S` of `M`, we define the pullback (preimage) of `S` as the subset of `N` of points `p` with `\Phi(p)` in `S`.

Issue created by migration from https://trac.sagemath.org/ticket/31688





---

archive/issue_comments_449788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-31T02:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-31T05:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-31T05:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-01T20:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-02T01:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449792",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-02T19:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449793",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449794.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-03T19:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449794",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449795.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-04T23:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449795",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-05T00:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449796",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_449797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T18:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449798.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T19:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449798",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T20:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449799",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449800.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T20:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449800",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449801.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-05T21:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449801",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449802.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-05T21:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449802",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449803.json:
```json
{
    "body": "This is not quite ready yet, but comments are very welcome",
    "created_at": "2021-06-05T21:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449803",
    "user": "@mkoeppe"
}
```

This is not quite ready yet, but comments are very welcome



---

archive/issue_comments_449804.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-06T03:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449804",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449805.json:
```json
{
    "body": "For a possible follow-up, it might be a good idea to bear in mind that the preimage of a regular value of a differentiable map between manifolds of dimension `n` and `m` respectively is a differentiable manifold of dimension `n-m` again.",
    "created_at": "2021-06-06T10:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449805",
    "user": "@mjungmath"
}
```

For a possible follow-up, it might be a good idea to bear in mind that the preimage of a regular value of a differentiable map between manifolds of dimension `n` and `m` respectively is a differentiable manifold of dimension `n-m` again.



---

archive/issue_comments_449806.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-06T21:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449806",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449807.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-13T19:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449807",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449808.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-15T03:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449808",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_449809.json:
```json
{
    "body": "As revealed by the patchbot, there are some doctest failures, as well as some coverage and pyflakes issues.",
    "created_at": "2021-06-16T12:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449809",
    "user": "@egourgoulhon"
}
```

As revealed by the patchbot, there are some doctest failures, as well as some coverage and pyflakes issues.



---

archive/issue_comments_449810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-16T16:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449810",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449811.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-16T16:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449811",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_449812.json:
```json
{
    "body": "Thanks for taking a look! Yes, I'll have to add more documentation and examples.",
    "created_at": "2021-06-16T16:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449812",
    "user": "@mkoeppe"
}
```

Thanks for taking a look! Yes, I'll have to add more documentation and examples.



---

archive/issue_comments_449813.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-16T17:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449813",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T00:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449814",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T01:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449815",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449816.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-17T01:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449816",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T05:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449817",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T13:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449819.json:
```json
{
    "body": "Thanks for the last changes. \nSome comments regarding the documentation:\n\n- there is no entry for the class `ManifoldSubsetPullback` in the reference manual\n- in the files `continuous_map.py` and `subsets/pullback.py`, each instance of `:class:`ManifoldSubset`` should be replaced by `:class:`~sage.manifolds.subset.ManifoldSubset``\n- the docstring of `ScalarField.pullback` should have an INPUT and OUTPUT sections similar to those of `ContinuousMap.preimage`. By the way, to be consistent with `ContinuousMap.preimage`, shouldn't `ScalarField.pullback` be renamed to `ScalarField.preimage`, with `pullback` defined as an alias to `preimage`?\n- the INPUT and OUTPUT sections of `DiffMap.pullback` should be updated to take into account the new arguments.",
    "created_at": "2021-06-17T20:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449819",
    "user": "@egourgoulhon"
}
```

Thanks for the last changes. 
Some comments regarding the documentation:

- there is no entry for the class `ManifoldSubsetPullback` in the reference manual
- in the files `continuous_map.py` and `subsets/pullback.py`, each instance of `:class:`ManifoldSubset`` should be replaced by `:class:`~sage.manifolds.subset.ManifoldSubset``
- the docstring of `ScalarField.pullback` should have an INPUT and OUTPUT sections similar to those of `ContinuousMap.preimage`. By the way, to be consistent with `ContinuousMap.preimage`, shouldn't `ScalarField.pullback` be renamed to `ScalarField.preimage`, with `pullback` defined as an alias to `preimage`?
- the INPUT and OUTPUT sections of `DiffMap.pullback` should be updated to take into account the new arguments.



---

archive/issue_comments_449820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-18T18:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449820",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_449821.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-18T19:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449821",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-20T05:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449822",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449823.json:
```json
{
    "body": "In the docstring of  `ManifoldSubsetPullback`: \n- in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation\n\n- in the following part of the EXAMPLES block:\n\n```\nsage: r_squared = M.scalar_field(x^2+y^2)\nsage: r_squared.set_immutable()\nsage: cl_I = RealSet((1, 4)); cl_I\n(1, 4)\nsage: cl_O = ManifoldSubsetPullback(r_squared, None, I); cl_O\n```\n\n  I guess `I` in the last line (which, at this stage, is the imaginary number *i*) should be replaced by `cl_I` and the subsequent `True` and `False` should become `False` and `True` respectively. But then, `cl_I` and `cl_O` are identical to `I` and `O` in the example that follows...",
    "created_at": "2021-06-21T17:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449823",
    "user": "@egourgoulhon"
}
```

In the docstring of  `ManifoldSubsetPullback`: 
- in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation

- in the following part of the EXAMPLES block:

```
sage: r_squared = M.scalar_field(x^2+y^2)
sage: r_squared.set_immutable()
sage: cl_I = RealSet((1, 4)); cl_I
(1, 4)
sage: cl_O = ManifoldSubsetPullback(r_squared, None, I); cl_O
```

  I guess `I` in the last line (which, at this stage, is the imaginary number *i*) should be replaced by `cl_I` and the subsequent `True` and `False` should become `False` and `True` respectively. But then, `cl_I` and `cl_O` are identical to `I` and `O` in the example that follows...



---

archive/issue_comments_449824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T18:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449825.json:
```json
{
    "body": "Thanks for spotting this - I have fixed this and a similar example",
    "created_at": "2021-06-21T18:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449825",
    "user": "@mkoeppe"
}
```

Thanks for spotting this - I have fixed this and a similar example



---

archive/issue_comments_449826.json:
```json
{
    "body": "Replying to [comment:50 egourgoulhon]:\n> In the docstring of  `ManifoldSubsetPullback`: \n> - in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation\n\nYou may need to run `./sage -docbuild reference/discrete_geometry html`",
    "created_at": "2021-06-21T18:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449826",
    "user": "@mkoeppe"
}
```

Replying to [comment:50 egourgoulhon]:
> In the docstring of  `ManifoldSubsetPullback`: 
> - in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation

You may need to run `./sage -docbuild reference/discrete_geometry html`



---

archive/issue_comments_449827.json:
```json
{
    "body": "Replying to [comment:53 mkoeppe]:\n> Replying to [comment:50 egourgoulhon]:\n> > In the docstring of  `ManifoldSubsetPullback`: \n> > - in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation\n> \n> You may need to run `./sage -docbuild reference/discrete_geometry html`\nYes indeed!",
    "created_at": "2021-06-21T20:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449827",
    "user": "@egourgoulhon"
}
```

Replying to [comment:53 mkoeppe]:
> Replying to [comment:50 egourgoulhon]:
> > In the docstring of  `ManifoldSubsetPullback`: 
> > - in the INPUT section, there seems to be no entry for `ConvexSet_base` in the documentation
> 
> You may need to run `./sage -docbuild reference/discrete_geometry html`
Yes indeed!



---

archive/issue_comments_449828.json:
```json
{
    "body": "Replying to [comment:52 mkoeppe]:\n> Thanks for spotting this - I have fixed this and a similar example\nThanks. \n\nAt the moment, we have \n\n```\nsage: M = Manifold(2, 'M')                                                                          \nsage: X.<x,y> = M.chart()                                                                           \nsage: M.identity_map().preimage(M)                                                                  \nSubset Id_M_inv_M of the 2-dimensional differentiable manifold M\nsage: M.identity_map().preimage(M) is M                                                             \nFalse\nsage: M.zero_scalar_field().preimage(RealSet.point(0))                                              \nSubset zero_inv_{0} of the 2-dimensional differentiable manifold M\nsage: M.zero_scalar_field().preimage(RealSet.point(0)) is M                                         \nFalse\n```\n\nDo you think it would be easy to have both answers to be `True`? If no, this should not hamper the current ticket, but be differed to another ticket.",
    "created_at": "2021-06-21T20:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449828",
    "user": "@egourgoulhon"
}
```

Replying to [comment:52 mkoeppe]:
> Thanks for spotting this - I have fixed this and a similar example
Thanks. 

At the moment, we have 

```
sage: M = Manifold(2, 'M')                                                                          
sage: X.<x,y> = M.chart()                                                                           
sage: M.identity_map().preimage(M)                                                                  
Subset Id_M_inv_M of the 2-dimensional differentiable manifold M
sage: M.identity_map().preimage(M) is M                                                             
False
sage: M.zero_scalar_field().preimage(RealSet.point(0))                                              
Subset zero_inv_{0} of the 2-dimensional differentiable manifold M
sage: M.zero_scalar_field().preimage(RealSet.point(0)) is M                                         
False
```

Do you think it would be easy to have both answers to be `True`? If no, this should not hamper the current ticket, but be differed to another ticket.



---

archive/issue_comments_449829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T21:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449829",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449830.json:
```json
{
    "body": "Sure, that's easy to do and certainly a good idea. Here it is for `ContinuousMap.preimage` already, I'll look into the case of the scalar fields",
    "created_at": "2021-06-21T21:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449830",
    "user": "@mkoeppe"
}
```

Sure, that's easy to do and certainly a good idea. Here it is for `ContinuousMap.preimage` already, I'll look into the case of the scalar fields



---

archive/issue_comments_449831.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T21:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449831",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449832.json:
```json
{
    "body": "More general things such as detecting that the preimage of [0,oo) under squaring is the full domain will have to wait until a follow-up ticket",
    "created_at": "2021-06-21T21:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449832",
    "user": "@mkoeppe"
}
```

More general things such as detecting that the preimage of [0,oo) under squaring is the full domain will have to wait until a follow-up ticket



---

archive/issue_comments_449833.json:
```json
{
    "body": "Replying to [comment:57 mkoeppe]:\n> Sure, that's easy to do and certainly a good idea. Here it is for `ContinuousMap.preimage` already, \n\nThanks. Maybe one can add\n\n```\nif self._is_isomorphism and codomain_subset == self._codomain:\n    return self._domain\n```\n",
    "created_at": "2021-06-22T04:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449833",
    "user": "@egourgoulhon"
}
```

Replying to [comment:57 mkoeppe]:
> Sure, that's easy to do and certainly a good idea. Here it is for `ContinuousMap.preimage` already, 

Thanks. Maybe one can add

```
if self._is_isomorphism and codomain_subset == self._codomain:
    return self._domain
```




---

archive/issue_comments_449834.json:
```json
{
    "body": "The patchbot reports a doctest error in `src/sage/geometry/polyhedron/base.py` as well as pyflakes errors in `src/sage/manifolds/subsets/pullback.py`.",
    "created_at": "2021-06-22T04:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449834",
    "user": "@egourgoulhon"
}
```

The patchbot reports a doctest error in `src/sage/geometry/polyhedron/base.py` as well as pyflakes errors in `src/sage/manifolds/subsets/pullback.py`.



---

archive/issue_comments_449835.json:
```json
{
    "body": "Replying to [comment:60 egourgoulhon]:\n> Maybe one can add\n> {{{\n> if self._is_isomorphism and codomain_subset == self._codomain:\n>     return self._domain\n> }}}\n\nI think I can do more generally\n\n```\n  if self._codomain.is_subset(codomain_subset):\n      return self._domain\n```\n",
    "created_at": "2021-06-22T04:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449835",
    "user": "@mkoeppe"
}
```

Replying to [comment:60 egourgoulhon]:
> Maybe one can add
> {{{
> if self._is_isomorphism and codomain_subset == self._codomain:
>     return self._domain
> }}}

I think I can do more generally

```
  if self._codomain.is_subset(codomain_subset):
      return self._domain
```




---

archive/issue_comments_449836.json:
```json
{
    "body": "Replying to [comment:61 egourgoulhon]:\n> The patchbot reports a doctest error in `src/sage/geometry/polyhedron/base.py` \n\nI've seen this one before locally, I don't think it's coming from this ticket, but I have opened #32030 for it",
    "created_at": "2021-06-22T04:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449836",
    "user": "@mkoeppe"
}
```

Replying to [comment:61 egourgoulhon]:
> The patchbot reports a doctest error in `src/sage/geometry/polyhedron/base.py` 

I've seen this one before locally, I don't think it's coming from this ticket, but I have opened #32030 for it



---

archive/issue_comments_449837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-22T05:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449837",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449838.json:
```json
{
    "body": "Replying to [comment:62 mkoeppe]:\n> Replying to [comment:60 egourgoulhon]:\n> > Maybe one can add\n> > {{{\n> > if self._is_isomorphism and codomain_subset == self._codomain:\n> >     return self._domain\n> > }}}\n> \n> I think I can do more generally\n> {{{\n>   if self._codomain.is_subset(codomain_subset):\n>       return self._domain\n> }}}\n> \nYes, indeed! Being an isomorphism is not necessary in that case.",
    "created_at": "2021-06-22T08:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449838",
    "user": "@egourgoulhon"
}
```

Replying to [comment:62 mkoeppe]:
> Replying to [comment:60 egourgoulhon]:
> > Maybe one can add
> > {{{
> > if self._is_isomorphism and codomain_subset == self._codomain:
> >     return self._domain
> > }}}
> 
> I think I can do more generally
> {{{
>   if self._codomain.is_subset(codomain_subset):
>       return self._domain
> }}}
> 
Yes, indeed! Being an isomorphism is not necessary in that case.



---

archive/issue_comments_449839.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-22T16:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449839",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449840.json:
```json
{
    "body": "A minor point: to generate correctly the documentation, the following change shall be made in the docstring of `ManifoldSubsetPullback`:\n\n```diff\n-    - ``map`` - an instance of :class:`ContinuousMap`,\n+    - ``map`` - an instance of :class:`~sage.manifolds.continuous_map.ContinuousMap`,\n       :class:`ScalarField`, or :class:`Chart`\n```\n\nFor `:class:`ScalarField`` and `:class:`Chart``, this is not necessary because these classes are imported in `pullback.py`.",
    "created_at": "2021-06-24T10:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449840",
    "user": "@egourgoulhon"
}
```

A minor point: to generate correctly the documentation, the following change shall be made in the docstring of `ManifoldSubsetPullback`:

```diff
-    - ``map`` - an instance of :class:`ContinuousMap`,
+    - ``map`` - an instance of :class:`~sage.manifolds.continuous_map.ContinuousMap`,
       :class:`ScalarField`, or :class:`Chart`
```

For `:class:`ScalarField`` and `:class:`Chart``, this is not necessary because these classes are imported in `pullback.py`.



---

archive/issue_comments_449841.json:
```json
{
    "body": "This example in the doctstring of `ManifoldSubsetPullback.is_closed` is dubious:\n\n```\n\n        The pullback of finite sets is closed::\n\n            sage: F = Family([vector(QQ, [1, 2], immutable=True), vector(QQ, [2, 3], immutable=True)])\n            sage: McF = ManifoldSubsetPullback(c_cart, F, name='McF'); McF\n            Subset McF of the 2-dimensional topological manifold R^2\n            sage: McF.is_closed()\n            False\n\n```\n",
    "created_at": "2021-06-24T13:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449841",
    "user": "@egourgoulhon"
}
```

This example in the doctstring of `ManifoldSubsetPullback.is_closed` is dubious:

```

        The pullback of finite sets is closed::

            sage: F = Family([vector(QQ, [1, 2], immutable=True), vector(QQ, [2, 3], immutable=True)])
            sage: McF = ManifoldSubsetPullback(c_cart, F, name='McF'); McF
            Subset McF of the 2-dimensional topological manifold R^2
            sage: McF.is_closed()
            False

```




---

archive/issue_comments_449842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T16:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449842",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449843.json:
```json
{
    "body": "Replying to [comment:68 egourgoulhon]:\n> This example in the doctstring of `ManifoldSubsetPullback.is_closed` is dubious:\n\nIndeed. Looks like I had forgotten to actually implement this case. Done now",
    "created_at": "2021-06-24T16:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449843",
    "user": "@mkoeppe"
}
```

Replying to [comment:68 egourgoulhon]:
> This example in the doctstring of `ManifoldSubsetPullback.is_closed` is dubious:

Indeed. Looks like I had forgotten to actually implement this case. Done now



---

archive/issue_comments_449844.json:
```json
{
    "body": "Thanks for the update. As soon as the patchbot visits the ticket and is green, the ticket can be set to positive review.",
    "created_at": "2021-06-26T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449844",
    "user": "@egourgoulhon"
}
```

Thanks for the update. As soon as the patchbot visits the ticket and is green, the ticket can be set to positive review.



---

archive/issue_comments_449845.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-28T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449845",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449846.json:
```json
{
    "body": "OK, since the changes since the last time the patchbot visited the ticket are quite minor, let us move on without waiting for another visit. \n\nThank you for the new features introduced here!",
    "created_at": "2021-06-28T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449846",
    "user": "@egourgoulhon"
}
```

OK, since the changes since the last time the patchbot visited the ticket are quite minor, let us move on without waiting for another visit. 

Thank you for the new features introduced here!



---

archive/issue_comments_449847.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2021-06-28T20:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449847",
    "user": "@mkoeppe"
}
```

Thanks for the review!



---

archive/issue_comments_449848.json:
```json
{
    "body": "Replying to [comment:72 egourgoulhon]:\n> OK, since the changes since the last time the patchbot visited the ticket are quite minor, let us move on without waiting for another visit. \n\nIt seems that we don't have any patchbot at the moment:\nhttps://patchbot.sagemath.org/ticket/0/",
    "created_at": "2021-06-30T11:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449848",
    "user": "@egourgoulhon"
}
```

Replying to [comment:72 egourgoulhon]:
> OK, since the changes since the last time the patchbot visited the ticket are quite minor, let us move on without waiting for another visit. 

It seems that we don't have any patchbot at the moment:
https://patchbot.sagemath.org/ticket/0/



---

archive/issue_comments_449849.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-07-01T22:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449849",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_449850.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-07-01T22:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449850",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_449851.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-01T23:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449851",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449852.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-07T21:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449852",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_449853.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 41.5 --random-seed=0 src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 2975, in sage.geometry.polyhedron.base.Polyhedron_base.incidence_matrix\nFailed example:\n    M == P.incidence_matrix()\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n1 item had failures:\n   1 of  31 in sage.geometry.polyhedron.base.Polyhedron_base.incidence_matrix\n    [1737 tests, 1 failure, 35.30 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 41.5 --random-seed=0 src/sage/geometry/polyhedron/base.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2021-07-07T21:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449853",
    "user": "@vbraun"
}
```


```
sage -t --long --warn-long 41.5 --random-seed=0 src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 2975, in sage.geometry.polyhedron.base.Polyhedron_base.incidence_matrix
Failed example:
    M == P.incidence_matrix()
Expected:
    False
Got:
    True
**********************************************************************
1 item had failures:
   1 of  31 in sage.geometry.polyhedron.base.Polyhedron_base.incidence_matrix
    [1737 tests, 1 failure, 35.30 s]
----------------------------------------------------------------------
sage -t --long --warn-long 41.5 --random-seed=0 src/sage/geometry/polyhedron/base.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_449854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-07T23:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449855.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-07T23:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449855",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449856.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-07T23:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449856",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449857.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-18T22:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31451#issuecomment-449857",
    "user": "@vbraun"
}
```

Resolution: fixed
