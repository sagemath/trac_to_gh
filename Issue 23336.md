# Issue 23336: Implement suffix walk for suffix tree

Issue created by migration from Trac.

Original creator: enadeau

Original creation time: 2017-08-02 14:24:31

CC:  saliola nadialafreniere kdilks

A suffix walk takes a node path-labeled "aw" with "a" a letter the state path-labeled "w".


---

Comment by enadeau created at 2017-08-03 14:29:45

New commits:


---

Comment by enadeau created at 2017-08-03 14:29:45

Changing status from new to needs_review.


---

Comment by git created at 2017-11-12 00:17:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-11-12 01:42:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-11-12 20:26:44

Recursion is slow in Python. You would better implement a more direct loop.


---

Comment by git created at 2017-11-13 19:52:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-18 20:50:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 11:48:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enadeau created at 2019-07-11 11:53:34

Changing keywords from "" to "fpsac2019".


---

Comment by nadialafreniere created at 2019-07-11 14:22:51

In the documentation of the function, you should say what `d` is (the last parameter of the output). It is not specified anywhere.


---

Comment by nadialafreniere created at 2019-07-11 14:56:01

There probably is something I don't understand, but I don't see why when the node is a leaf, the algorithm for `self._count_and_skip()` returns `implicit` just like if it stopped on an edge. For example, 


```
sage: T = ImplicitSuffixTree(Word("cacao"))
sage: T._count_and_skip(3,(2,5))
('implicit', (3, 1), 3)
```


It's coherent with the condition in the code `if (trans[0][1] != None [...]):`, but I don't see how it is coherent with the documentation.


---

Comment by git created at 2019-07-11 16:30:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enadeau created at 2019-07-11 16:32:15

Your last observation was in fact a mistake, it was introduced when I derecursify the `_count_and_skip` method.

I've fixed it with other minor improvements.


---

Comment by git created at 2019-07-12 06:59:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nadialafreniere created at 2019-07-12 07:32:38

Changing status from needs_review to positive_review.


---

Comment by nadialafreniere created at 2019-07-12 07:32:38

Thanks for the fixes! It now looks good and I think it should enter in the next version of Sage.


---

Comment by vbraun created at 2019-07-14 09:32:10

The documentation doesn't build:

```
[dochtml] [combinat ] The inventory files are in local/share/doc/sage/inventory/en/reference/combinat.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1719, in main
[dochtml]     builder()
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 354, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 550, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 288, in _build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/local/sage-patchbot/sage/local/lib/python2.7/multiprocessing/pool.py", line 572, in get
[dochtml]     raise self._value
[dochtml] OSError: WARNING: error while formatting arguments for sage.combinat.words.suffix_trees.ImplicitSuffixTree.suffix_walk: unhashable type: 'list'
Makefile:2035: recipe for target 'doc-html' failed
make[1]: *** [doc-html] Error 1
```



---

Comment by vbraun created at 2019-07-14 09:32:10

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-07-14 09:36:54

Note that the argument tuple unpacking was removed in Python 3: https://www.python.org/dev/peps/pep-3113/


---

Comment by git created at 2019-07-14 09:54:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nadialafreniere created at 2019-07-14 11:28:23

Replying to [comment:21 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[1967ce8](https://git.sagemath.org/sage.git/commit/?id=1967ce87f34488068b22c0db73237e4a50ff3cf5)||`remove argument tuple unpacking`||

Does that affect ticket:28182?

Otherwise, the doc now seems to build.


---

Comment by enadeau created at 2019-07-14 11:40:42

Yes ticket:28182 is affected. Minor changes in function call will be sufficient. I'm working on it.


---

Comment by enadeau created at 2019-07-15 00:09:32

Changing status from needs_work to needs_review.


---

Comment by nadialafreniere created at 2019-07-15 13:01:06

Changing status from needs_review to positive_review.


---

Comment by enadeau created at 2019-07-16 11:41:09

The patchbot does not pass the pyflakes test but the error mentioned is completely unrelated to the changes that were made. Moreover, as far as I can tell, the error reported is not a real error since the if statement on line 123-125 won't be entered on the first pass of the loop when `old_s` is still undefined. Hence, I don't think any change to the code is needed.

Is there any way to silence the error?


```
========== pyflakes ==========
git checkout patchbot/ticket_merged
Bereits auf 'patchbot/ticket_merged'
src/sage/combinat/words/suffix_trees.py:125: undefined name 'old_s'

found 1 pyflakes errors in the modified files
Traceback (most recent call last):
  File "/home/sage-patchbot/.local/lib/python3.5/site-packages/sage_patchbot/patchbot.py", line 1126, in test_a_ticket
    baseline=baseline, **kwds)
  File "/home/sage-patchbot/.local/lib/python3.5/site-packages/sage_patchbot/plugins.py", line 281, in pyflakes
    raise ValueError(full_msg)
ValueError: found 1 pyflakes errors in the modified files
pyflakes -- 0 seconds
========== end pyflakes ==========
```



---

Comment by hderycke created at 2019-07-16 14:56:02

You can add ` old_s = None ` before the loop.


---

Comment by git created at 2019-07-17 08:51:51

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-07-17 08:51:51

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by kdilks created at 2019-07-22 14:43:49

I'll make some minor changes to the docstring phrasing while I'm at Sage Days to have it be a little bit more in line with the General Conventions ( http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content ). Then you can feel free to reset positive review if you're ok with my changes.


---

Comment by git created at 2019-07-29 16:00:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-29 17:18:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by enadeau created at 2019-07-29 17:26:48

I've updated the branch for 8.9beta4 and updated the docstring. kdilks did you have anything other improvements in mind for the doctring?


---

Comment by nadialafreniere created at 2019-08-05 14:57:48

Since kdilks doesn't answer, I am resetting the positive review. The patchbot tests now seem fine.

Thanks Ã‰mile for this contribution!


---

Comment by nadialafreniere created at 2019-08-05 14:57:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-10 13:08:35

Resolution: fixed
