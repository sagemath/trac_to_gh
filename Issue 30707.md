# Issue 30707: tox: Improve local-sudo-ubuntu-standard

archive/issues_030707.json:
```json
{
    "body": "CC:  @mkoeppe @dimpase @kliem\n\nAs a follow up to #30923, we improve the `local-sudo-ubuntu-standard` environment as follows:\n- Remove `sudo` requirement (which is not installed on github actions and not needed there)\n- Add `DEBIAN_FRONTEND: noninteractive` to the installation of packages via `apt get` (otherwise installation of `tzdata` blocks CI)\n- Make `tox -e local-sudo-standard -- config.status` stop after `configure` (and don't run `make`)\n- Enable `--enable-build-as-root` for tox (Tobias: not sure about this one)\n\nIssue created by migration from https://trac.sagemath.org/ticket/30944\n\n",
    "created_at": "2020-11-22T17:52:52Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "tox: Improve local-sudo-ubuntu-standard",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30707",
    "user": "https://github.com/tobiasdiez"
}
```
CC:  @mkoeppe @dimpase @kliem

As a follow up to #30923, we improve the `local-sudo-ubuntu-standard` environment as follows:
- Remove `sudo` requirement (which is not installed on github actions and not needed there)
- Add `DEBIAN_FRONTEND: noninteractive` to the installation of packages via `apt get` (otherwise installation of `tzdata` blocks CI)
- Make `tox -e local-sudo-standard -- config.status` stop after `configure` (and don't run `make`)
- Enable `--enable-build-as-root` for tox (Tobias: not sure about this one)

Issue created by migration from https://trac.sagemath.org/ticket/30944





---

archive/issue_comments_438476.json:
```json
{
    "body": "The variant could be called `local-root-ubuntu-standard`, I guess",
    "created_at": "2020-11-22T19:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438476",
    "user": "https://github.com/mkoeppe"
}
```

The variant could be called `local-root-ubuntu-standard`, I guess



---

archive/issue_comments_438477.json:
```json
{
    "body": "Replying to [ticket:30944 gh-tobiasdiez]:\n> - Make `tox -e local-sudo-standard -- config.status` stop after `configure` (and don't run `make`)\n\n\nRight, I forgot about the mess with `TARGETS_PRE` and `TARGETS_OPTIONAL` in `tox.ini`, which do not get the same defaults for `local` as they do for `docker` - I'll fix this\n\n---\nNew commits:",
    "created_at": "2020-11-22T20:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438477",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [ticket:30944 gh-tobiasdiez]:
> - Make `tox -e local-sudo-standard -- config.status` stop after `configure` (and don't run `make`)


Right, I forgot about the mess with `TARGETS_PRE` and `TARGETS_OPTIONAL` in `tox.ini`, which do not get the same defaults for `local` as they do for `docker` - I'll fix this

---
New commits:



---

archive/issue_comments_438478.json:
```json
{
    "body": "Replying to [comment:1 mkoeppe]:\n> The variant could be called `local-root-ubuntu-standard`, I guess\n\nAdding this in #29124",
    "created_at": "2020-11-24T05:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438478",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:1 mkoeppe]:
> The variant could be called `local-root-ubuntu-standard`, I guess

Adding this in #29124



---

archive/issue_comments_438479.json:
```json
{
    "body": "Replying to [gh-tobiasdiez in #29124](https://trac.sagemath.org/ticket/29124?replyto=22#comment:22):\n> I'm not sure about the naming of the `local-` environments. Why should I expect as a developer that `local-sudo` installs system packages? What about `local-system-packages-ubuntu` (for root) and `local-sudo-system-packages-ubuntu` (for sudo)?\n\nAll of these environments install system packages... The only one that does not is `local-direct`",
    "created_at": "2020-11-24T18:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438479",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [gh-tobiasdiez in #29124](https://trac.sagemath.org/ticket/29124?replyto=22#comment:22):
> I'm not sure about the naming of the `local-` environments. Why should I expect as a developer that `local-sudo` installs system packages? What about `local-system-packages-ubuntu` (for root) and `local-sudo-system-packages-ubuntu` (for sudo)?

All of these environments install system packages... The only one that does not is `local-direct`



---

archive/issue_comments_438480.json:
```json
{
    "body": "Ah ok...than it makes sense.",
    "created_at": "2020-11-25T16:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438480",
    "user": "https://github.com/tobiasdiez"
}
```

Ah ok...than it makes sense.



---

archive/issue_comments_438481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-11-25T22:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_438482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-25T22:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438483.json:
```json
{
    "body": "To simplify the build rule for `local`, the next step is to do #30721 so we can eliminate the separate `make base-toolchain` step.",
    "created_at": "2020-11-25T22:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438483",
    "user": "https://github.com/mkoeppe"
}
```

To simplify the build rule for `local`, the next step is to do #30721 so we can eliminate the separate `make base-toolchain` step.



---

archive/issue_comments_438484.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-25T22:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438485.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-26T05:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438486.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> To simplify the build rule for `local`, the next step is to do #30721 so we can eliminate the separate `make base-toolchain` step.\n\nWell, I'll work on that another time. For now I have implemented it in a different way, special casing on \"config*\" targets.",
    "created_at": "2020-11-26T05:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438486",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:13 mkoeppe]:
> To simplify the build rule for `local`, the next step is to do #30721 so we can eliminate the separate `make base-toolchain` step.

Well, I'll work on that another time. For now I have implemented it in a different way, special casing on "config*" targets.



---

archive/issue_comments_438487.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-26T05:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438487",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438488.json:
```json
{
    "body": "Thanks! Looks good to me, as far as I understand the changes.\n\nJust to make sure:\n> Make tox -e local-sudo-standard -- config.status stop after configure\n\n\nIs fixed as well?",
    "created_at": "2020-11-26T08:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438488",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks! Looks good to me, as far as I understand the changes.

Just to make sure:
> Make tox -e local-sudo-standard -- config.status stop after configure


Is fixed as well?



---

archive/issue_comments_438489.json:
```json
{
    "body": "Replying to [comment:17 gh-tobiasdiez]:\n> Thanks! Looks good to me, as far as I understand the changes.\n> \n> Just to make sure:\n> > Make tox -e local-sudo-standard -- config.status stop after configure\n\n> \n> Is fixed as well?\n\n\nYes. This is what I meant in the previous comment - \"special casing on `config*` targets\"",
    "created_at": "2020-11-26T18:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438489",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 gh-tobiasdiez]:
> Thanks! Looks good to me, as far as I understand the changes.
> 
> Just to make sure:
> > Make tox -e local-sudo-standard -- config.status stop after configure

> 
> Is fixed as well?


Yes. This is what I meant in the previous comment - "special casing on `config*` targets"



---

archive/issue_comments_438490.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> Replying to [comment:17 gh-tobiasdiez]:\n> > Thanks! Looks good to me, as far as I understand the changes.\n> > \n> > Just to make sure:\n> > > Make tox -e local-sudo-standard -- config.status stop after configure\n\n> > \n> > Is fixed as well?\n\n> \n> Yes. This is what I meant in the previous comment - \"special casing on `config*` targets\"\n\n\nOk, then is good! Me with my limited bash knowledge thought that the final `make` that builds the sage packages is still invoked even though `-- config.status` is specified.",
    "created_at": "2020-11-26T20:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438490",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:18 mkoeppe]:
> Replying to [comment:17 gh-tobiasdiez]:
> > Thanks! Looks good to me, as far as I understand the changes.
> > 
> > Just to make sure:
> > > Make tox -e local-sudo-standard -- config.status stop after configure

> > 
> > Is fixed as well?

> 
> Yes. This is what I meant in the previous comment - "special casing on `config*` targets"


Ok, then is good! Me with my limited bash knowledge thought that the final `make` that builds the sage packages is still invoked even though `-- config.status` is specified.



---

archive/issue_comments_438491.json:
```json
{
    "body": "It's only invoked on nonempty `$TARGETS_OPTIONAL`",
    "created_at": "2020-11-26T21:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438491",
    "user": "https://github.com/mkoeppe"
}
```

It's only invoked on nonempty `$TARGETS_OPTIONAL`



---

archive/issue_comments_438492.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-02T20:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438492",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438493.json:
```json
{
    "body": "Running `tox -e local-sudo-ubuntu-standard -- SAGE_NUM_THREADS=16 build` (in WLS) yields\n\n```\nReading package lists... Done\nE: Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)\nE: Unable to lock directory /var/lib/apt/lists/\nW: Problem unlinking the file /var/cache/apt/pkgcache.bin - RemoveCaches (13: Permission denied)\nW: Problem unlinking the file /var/cache/apt/srcpkgcache.bin - RemoveCaches (13: Permission denied)\nERROR: InvocationError for command /usr/bin/bash -c '$(build/bin/sage-print-system-package-command debian update) #' (exited with code 100)\n```\nRunning the same command with sudo is successful, so I guess a `--sudo` is missing somewhere.\n\n\nMoreover, `./bootstrap` didn't run with following error:\n\n```\n/mnt/d/Programming/sage/src/bin/sage-env: line 133: cd: /mnt/d/Programming/Projects/sage: No such file or directory\nWarning: overwriting SAGE_ROOT environment variable:\nOld SAGE_ROOT=/mnt/d/Programming/Projects/sage\nNew SAGE_ROOT=\nError: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this\nError setting environment variables by sourcing '/mnt/d/Programming/sage/src/bin/sage-env';\npossibly contact sage-devel (see http://groups.google.com/group/sage-devel).\n```\nuntil I deleted src/bin/sage-env manually. And the root version `sudo tox -e local-root-ubuntu-standard -- SAGE_NUM_THREADS=10 build` yields\n\n```\nlocal-root-ubuntu-standard run-test: commands[2] | bash -c 'PACKAGES=$(build/bin/sage-get-system-packages debian $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap); $(build/bin/sage-print-system-package-command debian  --yes --no-install-recommends install $PACKAGES) || [ \"$IGNORE_MISSING_SYSTEM_PACKAGES\" = yes ] && echo \"(ignoring errors)\" '\n/usr/bin/bash: DEBIAN_FRONTEND=noninteractive: command not found\nERROR: InvocationError for command /usr/bin/bash -c 'PACKAGES=$(build/bin/sage-get-system-packages debian $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap); $(build/bin/sage-print-system-package-command debian  --yes --no-install-recommends install $PACKAGES) || [ \"$IGNORE_MISSING_SYSTEM_PACKAGES\" = yes ] && echo \"(ignoring errors)\" ' (exited with code 1)\n```",
    "created_at": "2020-12-02T20:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438493",
    "user": "https://github.com/tobiasdiez"
}
```

Running `tox -e local-sudo-ubuntu-standard -- SAGE_NUM_THREADS=16 build` (in WLS) yields

```
Reading package lists... Done
E: Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)
E: Unable to lock directory /var/lib/apt/lists/
W: Problem unlinking the file /var/cache/apt/pkgcache.bin - RemoveCaches (13: Permission denied)
W: Problem unlinking the file /var/cache/apt/srcpkgcache.bin - RemoveCaches (13: Permission denied)
ERROR: InvocationError for command /usr/bin/bash -c '$(build/bin/sage-print-system-package-command debian update) #' (exited with code 100)
```
Running the same command with sudo is successful, so I guess a `--sudo` is missing somewhere.


Moreover, `./bootstrap` didn't run with following error:

```
/mnt/d/Programming/sage/src/bin/sage-env: line 133: cd: /mnt/d/Programming/Projects/sage: No such file or directory
Warning: overwriting SAGE_ROOT environment variable:
Old SAGE_ROOT=/mnt/d/Programming/Projects/sage
New SAGE_ROOT=
Error: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this
Error setting environment variables by sourcing '/mnt/d/Programming/sage/src/bin/sage-env';
possibly contact sage-devel (see http://groups.google.com/group/sage-devel).
```
until I deleted src/bin/sage-env manually. And the root version `sudo tox -e local-root-ubuntu-standard -- SAGE_NUM_THREADS=10 build` yields

```
local-root-ubuntu-standard run-test: commands[2] | bash -c 'PACKAGES=$(build/bin/sage-get-system-packages debian $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap); $(build/bin/sage-print-system-package-command debian  --yes --no-install-recommends install $PACKAGES) || [ "$IGNORE_MISSING_SYSTEM_PACKAGES" = yes ] && echo "(ignoring errors)" '
/usr/bin/bash: DEBIAN_FRONTEND=noninteractive: command not found
ERROR: InvocationError for command /usr/bin/bash -c 'PACKAGES=$(build/bin/sage-get-system-packages debian $(PATH=build/bin:$PATH build/bin/sage-package list --has-file=spkg-configure.m4 :standard:) _bootstrap); $(build/bin/sage-print-system-package-command debian  --yes --no-install-recommends install $PACKAGES) || [ "$IGNORE_MISSING_SYSTEM_PACKAGES" = yes ] && echo "(ignoring errors)" ' (exited with code 1)
```



---

archive/issue_comments_438494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-02T21:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438495.json:
```json
{
    "body": "Replying to [comment:21 gh-tobiasdiez]:\n> Moreover, `./bootstrap` didn't run with following error:\n> \n> ```\n> /mnt/d/Programming/sage/src/bin/sage-env: line 133: cd: /mnt/d/Programming/Projects/sage: No such file or directory\n> Warning: overwriting SAGE_ROOT environment variable:\n> Old SAGE_ROOT=/mnt/d/Programming/Projects/sage\n> New SAGE_ROOT=\n> Error: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this\n> Error setting environment variables by sourcing '/mnt/d/Programming/sage/src/bin/sage-env';\n> possibly contact sage-devel (see http://groups.google.com/group/sage-devel).\n> ```\n> until I deleted src/bin/sage-env manually.\n\n\nThis is fixed by #22731, I think. I'll merge it",
    "created_at": "2020-12-03T01:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438495",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:21 gh-tobiasdiez]:
> Moreover, `./bootstrap` didn't run with following error:
> 
> ```
> /mnt/d/Programming/sage/src/bin/sage-env: line 133: cd: /mnt/d/Programming/Projects/sage: No such file or directory
> Warning: overwriting SAGE_ROOT environment variable:
> Old SAGE_ROOT=/mnt/d/Programming/Projects/sage
> New SAGE_ROOT=
> Error: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this
> Error setting environment variables by sourcing '/mnt/d/Programming/sage/src/bin/sage-env';
> possibly contact sage-devel (see http://groups.google.com/group/sage-devel).
> ```
> until I deleted src/bin/sage-env manually.


This is fixed by #22731, I think. I'll merge it



---

archive/issue_comments_438496.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-03T01:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438496",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-03T01:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438498.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-03T01:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438498",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438499.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-12-06T21:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_438500.json:
```json
{
    "body": "Rebased on top of 9.3.beta3 and rebased #29124",
    "created_at": "2020-12-06T21:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438500",
    "user": "https://github.com/mkoeppe"
}
```

Rebased on top of 9.3.beta3 and rebased #29124



---

archive/issue_comments_438501.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-10T06:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438502.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-16T23:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438503.json:
```json
{
    "body": "Merged newest version of #29124. Still needs review",
    "created_at": "2020-12-16T23:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438503",
    "user": "https://github.com/mkoeppe"
}
```

Merged newest version of #29124. Still needs review



---

archive/issue_comments_438504.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-12-29T00:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438504",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_438505.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-12-29T19:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_438506.json:
```json
{
    "body": "Merged newest #29124, needs review",
    "created_at": "2020-12-29T19:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438506",
    "user": "https://github.com/mkoeppe"
}
```

Merged newest #29124, needs review



---

archive/issue_comments_438507.json:
```json
{
    "body": "Let's get this in please (dependency of #31064 and #31099)",
    "created_at": "2021-01-06T19:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438507",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please (dependency of #31064 and #31099)



---

archive/issue_comments_438508.json:
```json
{
    "body": "I think #29124 isn't merged completely.",
    "created_at": "2021-01-06T20:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438508",
    "user": "https://github.com/kliem"
}
```

I think #29124 isn't merged completely.



---

archive/issue_comments_438509.json:
```json
{
    "body": "What does\n\n```diff\n+    local:             case \"{posargs:}\" in \\\n+    local:                 config*) ;; \\\n+    local:                 *)       make -k V=0 base-toolchain ;; \\\n+    local:             esac && \\\n-    local:                     make -k V=0 base-toolchain && \\\n```\n\ndo? (That is not the diff, but I think morally it is.)",
    "created_at": "2021-01-06T20:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438509",
    "user": "https://github.com/kliem"
}
```

What does

```diff
+    local:             case "{posargs:}" in \
+    local:                 config*) ;; \
+    local:                 *)       make -k V=0 base-toolchain ;; \
+    local:             esac && \
-    local:                     make -k V=0 base-toolchain && \
```

do? (That is not the diff, but I think morally it is.)



---

archive/issue_comments_438510.json:
```json
{
    "body": "It implements the last bullet point of the ticket description: \nWhen something like `config.status` is given as the target, `make base-toolchain` should not be run.",
    "created_at": "2021-01-06T20:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438510",
    "user": "https://github.com/mkoeppe"
}
```

It implements the last bullet point of the ticket description: 
When something like `config.status` is given as the target, `make base-toolchain` should not be run.



---

archive/issue_comments_438511.json:
```json
{
    "body": "Thanks. But does it stop then or are the other things still run?:\n\n```diff\n+    local:             make -k V=0 SAGE_SPKG=\"sage-spkg -y -o\" SAGE_CHECK=warn SAGE_CHECK_PACKAGES=\"!cython,!r,!python3,!nose,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!networkx,!symengine_py\" {env:TARGETS_PRE:} {posargs:build} && \\\n+    local:             ([ -z \"{env:TARGETS_OPTIONAL:}\" ] || make -k V=0 SAGE_SPKG=\"sage-spkg -y -o\" SAGE_CHECK=warn SAGE_CHECK_PACKAGES=\"!cython,!r,!python3,!nose,!gap,!cysignals,!linbox,!git,!ppl,!cmake\" {env:TARGETS_OPTIONAL:} || echo \"(error ignored)\" ) '\n }}}",
    "created_at": "2021-01-06T20:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438511",
    "user": "https://github.com/kliem"
}
```

Thanks. But does it stop then or are the other things still run?:

```diff
+    local:             make -k V=0 SAGE_SPKG="sage-spkg -y -o" SAGE_CHECK=warn SAGE_CHECK_PACKAGES="!cython,!r,!python3,!nose,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!networkx,!symengine_py" {env:TARGETS_PRE:} {posargs:build} && \
+    local:             ([ -z "{env:TARGETS_OPTIONAL:}" ] || make -k V=0 SAGE_SPKG="sage-spkg -y -o" SAGE_CHECK=warn SAGE_CHECK_PACKAGES="!cython,!r,!python3,!nose,!gap,!cysignals,!linbox,!git,!ppl,!cmake" {env:TARGETS_OPTIONAL:} || echo "(error ignored)" ) '
 }}}



---

archive/issue_comments_438512.json:
```json
{
    "body": "I have reworded the ticket description to clarify it.",
    "created_at": "2021-01-06T21:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438512",
    "user": "https://github.com/mkoeppe"
}
```

I have reworded the ticket description to clarify it.



---

archive/issue_comments_438513.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-07T06:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438513",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438514.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-01-07T06:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438514",
    "user": "https://github.com/kliem"
}
```

LGTM.



---

archive/issue_comments_438515.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-01-07T06:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438515",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_events_080815.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-24T10:38:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30707#event-80815"
}
```



---

archive/issue_comments_438516.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-24T10:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30707#issuecomment-438516",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
