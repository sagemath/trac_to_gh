# Issue 23926: blocks_and_cut_vertices() for disconnected graphs

archive/issues_023926.json:
```json
{
    "body": "This patch adds slow but working code to `blocks_and_cut_vertices()` handling disconnected graphs. I also change documentation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24163\n\n",
    "created_at": "2017-11-06T09:27:23Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "blocks_and_cut_vertices() for disconnected graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23926",
    "user": "https://github.com/jm58660"
}
```
This patch adds slow but working code to `blocks_and_cut_vertices()` handling disconnected graphs. I also change documentation.

Issue created by migration from https://trac.sagemath.org/ticket/24163





---

archive/issue_comments_334892.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-06T09:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334892",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334893.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-06T09:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334893",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_334894.json:
```json
{
    "body": "I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.\n\nThis said, I run tests on `src/sage/graphs/` without error, but we have to check that we are not introducing inconsistency. So we have to check in each method using `blocks_and_cut_vertices` that what we do is not changing the behavior. For instance, the `blocks_and_cuts_tree` method now returns a forest... We should certainly document that.",
    "created_at": "2017-11-06T13:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334894",
    "user": "https://github.com/dcoudert"
}
```

I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.

This said, I run tests on `src/sage/graphs/` without error, but we have to check that we are not introducing inconsistency. So we have to check in each method using `blocks_and_cut_vertices` that what we do is not changing the behavior. For instance, the `blocks_and_cuts_tree` method now returns a forest... We should certainly document that.



---

archive/issue_comments_334895.json:
```json
{
    "body": "Replying to [comment:3 dcoudert]:\n> I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.\n\nLet's look at it.\n----\nNew commits:",
    "created_at": "2017-11-06T20:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334895",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:3 dcoudert]:
> I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.

Let's look at it.
----
New commits:



---

archive/issue_comments_334896.json:
```json
{
    "body": "As the main code now handles special cases too, you can remove\n\n\n```\nif not self: # empty graph                                              \n    return [],[]\n\nif len(self) == 1: # only one vertex                                    \n    return [self.vertices()],[]\n```\n\n\nIt seems strange to say\n\n\n```\ntry:\n    # We consider the next of its neighbors                     \n    w = next(neighbors[v])\n      . . .\n# We went through all of v's neighbors                          \nexcept StopIteration:\n . . .\n```\n\n\nas you could just use\n\n\n```\nfor w in neighbors[v]:\n   . . .\n. . .\n```\n\n\nOtherwise I did not yet read the code.",
    "created_at": "2017-11-07T05:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334896",
    "user": "https://github.com/jm58660"
}
```

As the main code now handles special cases too, you can remove


```
if not self: # empty graph                                              
    return [],[]

if len(self) == 1: # only one vertex                                    
    return [self.vertices()],[]
```


It seems strange to say


```
try:
    # We consider the next of its neighbors                     
    w = next(neighbors[v])
      . . .
# We went through all of v's neighbors                          
except StopIteration:
 . . .
```


as you could just use


```
for w in neighbors[v]:
   . . .
. . .
```


Otherwise I did not yet read the code.



---

archive/issue_comments_334897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-07T07:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334898.json:
```json
{
    "body": "I have removed the special cases.\n\nThe try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.",
    "created_at": "2017-11-07T07:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334898",
    "user": "https://github.com/dcoudert"
}
```

I have removed the special cases.

The try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.



---

archive/issue_comments_334899.json:
```json
{
    "body": "Seems to work, here is my test code:\n\n\n```\nset_random_seed(0)\nN = 4\nfor _ in range(100):\n    gg = []\n    while len(gg) < N:\n        g = graphs.RandomGNP(randint(2, 20), 0.3)\n        if g.is_biconnected():\n            gg.append(g)\n    \n    g = Graph()\n    for g_ in gg:\n        g = g+g_\n    a,b = g.blocks_and_cut_vertices()\n    if sorted(x.order() for x in gg) != sorted(len(x) for x in a):\n        raise AssertionError(\"Error 1\")\n    if b:\n        raise AssertionError(\"Error 2\")\n    \n    g.merge_vertices([x[0] for x in g.connected_components()])\n    a,b = g.blocks_and_cut_vertices()\n    if len(b) != 1:\n        raise AssertionError(\"Error 3\")\n    if len(a) != N:\n        raise AssertionError(\"Error 4\")\n    if not all(b[0] in x for x in a):\n        raise AssertionError(\"Error 5\")\n    \n    g = Graph()\n    for g_ in gg:\n        g = g+g_\n    con = g.connected_components()\n    for i in range(N-1):\n        g.merge_vertices([con[i][-1], con[i+1][0]])\n    a,b = g.blocks_and_cut_vertices()\n    if len(b) != N-1:\n        raise AssertionError(\"Error 6\")\n    if len(a) != N:\n        raise AssertionError(\"Error 7\")\n    \nprint(\"Seems to work\")\n```\n",
    "created_at": "2017-11-07T08:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334899",
    "user": "https://github.com/jm58660"
}
```

Seems to work, here is my test code:


```
set_random_seed(0)
N = 4
for _ in range(100):
    gg = []
    while len(gg) < N:
        g = graphs.RandomGNP(randint(2, 20), 0.3)
        if g.is_biconnected():
            gg.append(g)
    
    g = Graph()
    for g_ in gg:
        g = g+g_
    a,b = g.blocks_and_cut_vertices()
    if sorted(x.order() for x in gg) != sorted(len(x) for x in a):
        raise AssertionError("Error 1")
    if b:
        raise AssertionError("Error 2")
    
    g.merge_vertices([x[0] for x in g.connected_components()])
    a,b = g.blocks_and_cut_vertices()
    if len(b) != 1:
        raise AssertionError("Error 3")
    if len(a) != N:
        raise AssertionError("Error 4")
    if not all(b[0] in x for x in a):
        raise AssertionError("Error 5")
    
    g = Graph()
    for g_ in gg:
        g = g+g_
    con = g.connected_components()
    for i in range(N-1):
        g.merge_vertices([con[i][-1], con[i+1][0]])
    a,b = g.blocks_and_cut_vertices()
    if len(b) != N-1:
        raise AssertionError("Error 6")
    if len(a) != N:
        raise AssertionError("Error 7")
    
print("Seems to work")
```




---

archive/issue_comments_334900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-09T09:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334901.json:
```json
{
    "body": "I went through all methods using `blocks_and_cut_vertices` in `graph/` to check that we are not changing behavior.",
    "created_at": "2017-11-09T09:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334901",
    "user": "https://github.com/dcoudert"
}
```

I went through all methods using `blocks_and_cut_vertices` in `graph/` to check that we are not changing behavior.



---

archive/issue_comments_334902.json:
```json
{
    "body": "Replying to [comment:8 dcoudert]:\n> I have removed the special cases.\n\nGood. This addition actually made parts of Sage simpler.\n\n> The try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.\n\nYeah, that was my bad.\n\nI did a technical merge and will check this one.\n----\nNew commits:",
    "created_at": "2017-11-10T06:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334902",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:8 dcoudert]:
> I have removed the special cases.

Good. This addition actually made parts of Sage simpler.

> The try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.

Yeah, that was my bad.

I did a technical merge and will check this one.
----
New commits:



---

archive/issue_comments_334903.json:
```json
{
    "body": "I assume that the technical merge is a rebase on rc0. Thanks.",
    "created_at": "2017-11-10T07:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334903",
    "user": "https://github.com/dcoudert"
}
```

I assume that the technical merge is a rebase on rc0. Thanks.



---

archive/issue_comments_334904.json:
```json
{
    "body": "Replying to [comment:14 dcoudert]:\n> I assume that the technical merge is a rebase on rc0. Thanks.\n\nJust that.\n\nThis is good to go, but rc0 is out so I changed the milestone.",
    "created_at": "2017-11-10T08:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334904",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:14 dcoudert]:
> I assume that the technical merge is a rebase on rc0. Thanks.

Just that.

This is good to go, but rc0 is out so I changed the milestone.



---

archive/issue_comments_334905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-10T08:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334905",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334906.json:
```json
{
    "body": "OK. Thanks. This is useful improvement.",
    "created_at": "2017-11-10T08:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334906",
    "user": "https://github.com/dcoudert"
}
```

OK. Thanks. This is useful improvement.



---

archive/issue_comments_334907.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-11-17T09:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_334908.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2017-11-17T09:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_334909.json:
```json
{
    "body": "Arghs, wrong ticket number...\n----\nNew commits:",
    "created_at": "2017-11-17T09:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334909",
    "user": "https://github.com/jm58660"
}
```

Arghs, wrong ticket number...
----
New commits:



---

archive/issue_comments_334910.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-17T09:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_334911.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-17T10:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334911",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334912.json:
```json
{
    "body": "Back to positive, this was automatically put to needs_review after my error.",
    "created_at": "2017-11-17T10:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334912",
    "user": "https://github.com/jm58660"
}
```

Back to positive, this was automatically put to needs_review after my error.



---

archive/issue_events_022385.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-12-14T12:40:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23926#event-22385"
}
```



---

archive/issue_comments_334913.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-14T12:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23926#issuecomment-334913",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
