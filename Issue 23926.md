# Issue 23926: blocks_and_cut_vertices() for disconnected graphs

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2017-11-06 09:27:23

This patch adds slow but working code to `blocks_and_cut_vertices()` handling disconnected graphs. I also change documentation.


---

Comment by jmantysalo created at 2017-11-06 09:28:08

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2017-11-06 09:28:08

New commits:


---

Comment by dcoudert created at 2017-11-06 13:18:58

I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.

This said, I run tests on `src/sage/graphs/` without error, but we have to check that we are not introducing inconsistency. So we have to check in each method using `blocks_and_cut_vertices` that what we do is not changing the behavior. For instance, the `blocks_and_cuts_tree` method now returns a forest... We should certainly document that.


---

Comment by jmantysalo created at 2017-11-06 20:39:39

Replying to [comment:3 dcoudert]:
> I pushed in `u/dcoudert/24163` a much better solution. There is no need to decompose the graph into connected components.

Let's look at it.
----
New commits:


---

Comment by jmantysalo created at 2017-11-07 05:22:34

As the main code now handles special cases too, you can remove


```
if not self: # empty graph                                              
    return [],[]

if len(self) == 1: # only one vertex                                    
    return [self.vertices()],[]
```


It seems strange to say


```
try:
    # We consider the next of its neighbors                     
    w = next(neighbors[v])
      . . .
# We went through all of v's neighbors                          
except StopIteration:
 . . .
```


as you could just use


```
for w in neighbors[v]:
   . . .
. . .
```


Otherwise I did not yet read the code.


---

Comment by git created at 2017-11-07 07:35:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-11-07 07:42:28

I have removed the special cases.

The try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.


---

Comment by jmantysalo created at 2017-11-07 08:12:10

Seems to work, here is my test code:


```
set_random_seed(0)
N = 4
for _ in range(100):
    gg = []
    while len(gg) < N:
        g = graphs.RandomGNP(randint(2, 20), 0.3)
        if g.is_biconnected():
            gg.append(g)
    
    g = Graph()
    for g_ in gg:
        g = g+g_
    a,b = g.blocks_and_cut_vertices()
    if sorted(x.order() for x in gg) != sorted(len(x) for x in a):
        raise AssertionError("Error 1")
    if b:
        raise AssertionError("Error 2")
    
    g.merge_vertices([x[0] for x in g.connected_components()])
    a,b = g.blocks_and_cut_vertices()
    if len(b) != 1:
        raise AssertionError("Error 3")
    if len(a) != N:
        raise AssertionError("Error 4")
    if not all(b[0] in x for x in a):
        raise AssertionError("Error 5")
    
    g = Graph()
    for g_ in gg:
        g = g+g_
    con = g.connected_components()
    for i in range(N-1):
        g.merge_vertices([con[i][-1], con[i+1][0]])
    a,b = g.blocks_and_cut_vertices()
    if len(b) != N-1:
        raise AssertionError("Error 6")
    if len(a) != N:
        raise AssertionError("Error 7")
    
print("Seems to work")
```



---

Comment by git created at 2017-11-09 09:13:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2017-11-09 09:17:12

I went through all methods using `blocks_and_cut_vertices` in `graph/` to check that we are not changing behavior.


---

Comment by jmantysalo created at 2017-11-10 06:35:49

Replying to [comment:8 dcoudert]:
> I have removed the special cases.

Good. This addition actually made parts of Sage simpler.

> The try/except is needed here. The original algorithm do recursive calls. To avoid that, we use stack, plus we use an array (dictionary) of iterators over the neighbors to do the for loop.

Yeah, that was my bad.

I did a technical merge and will check this one.
----
New commits:


---

Comment by dcoudert created at 2017-11-10 07:44:11

I assume that the technical merge is a rebase on rc0. Thanks.


---

Comment by jmantysalo created at 2017-11-10 08:11:01

Replying to [comment:14 dcoudert]:
> I assume that the technical merge is a rebase on rc0. Thanks.

Just that.

This is good to go, but rc0 is out so I changed the milestone.


---

Comment by jmantysalo created at 2017-11-10 08:11:01

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2017-11-10 08:13:02

OK. Thanks. This is useful improvement.


---

Comment by git created at 2017-11-17 09:10:35

Changing status from positive_review to needs_review.


---

Comment by git created at 2017-11-17 09:10:35

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-11-17 09:12:41

Arghs, wrong ticket number...
----
New commits:


---

Comment by git created at 2017-11-17 09:59:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-11-17 10:45:12

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2017-11-17 10:45:12

Back to positive, this was automatically put to needs_review after my error.


---

Comment by vbraun created at 2017-12-14 12:40:03

Resolution: fixed
