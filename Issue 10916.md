# Issue 10916: Improve support for lazy_import inside classes

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2011-03-23 23:05:02

Assignee: jason

CC:  rishi jason rlm rbradshaw

Currently, one can do:


```
    sage: class foo(object):
    ...       bar = LazyImport('sage.bar', 'bar')
    sage: foo.bar
    bar
```


and this works (assuming sage.bar.bar exists of course). As a
syntactic sugar, it would be nice to have lazy_import work as well, if
possible with the automatic back-insertion of the object into the
class after the actual import occurred:


```
    sage: class foo(object):
    ...       lazy_import('sage.bar', 'bar')
    sage: type(foo.bar)
    <type 'sage.misc.lazy_import.LazyImport'>
    sage: foo.bar
    bar
    sage: type(foo.bar)
    <type 'bar_type>
```



---

Comment by mhansen created at 2011-06-13 07:36:51

I think this should be good, but the only thing I have questions about is the switch from `f_globals` to `f_locals`.


---

Comment by mhansen created at 2011-06-13 07:36:51

Changing status from new to needs_review.


---

Comment by nthiery created at 2011-06-13 10:23:48

Thanks Mike!

What's the rationale for not always walking through the whole mro?

I would suggest to replace ``walk_owner_namespaces=False_ by ``owner=None_.

Otherwise, this looks overall looks good. I have no clue at this point about the f_globals vs f_locals point though.

Cheers,
                       Nicolas


---

Comment by nthiery created at 2011-06-13 10:23:48

Changing status from needs_review to needs_work.


---

Comment by mhansen created at 2011-06-13 10:35:35

Replying to [comment:2 nthiery]:
> What's the rationale for not always walking through the whole mro?

Do you mean the break?


---

Comment by nthiery created at 2011-06-13 11:04:19

Replying to [comment:3 mhansen]:
> Replying to [comment:2 nthiery]:
> > What's the rationale for not always walking through the whole mro?
> 
> Do you mean the break?

Sorry, I should have been more explicit. It's about the using `owner.__bases__' rather than ``owner.__mro__''.

By the way, what about using ``owner.mro()'' to respect encapsulation? Speed is not an issue here, right?


---

Comment by mhansen created at 2011-06-13 11:43:43

Changing status from needs_work to needs_review.


---

Comment by mhansen created at 2011-06-13 11:43:43

I've updated the patch to fix these two issues.


---

Comment by nthiery created at 2011-06-13 14:45:23

Changing status from needs_review to needs_work.


---

Comment by nthiery created at 2011-06-13 14:45:23

Thanks! 

It seems the builtin inspect.mro should do the job of supporting both old style and new style classes. Also, just for test-completeness, could you add a test with a lazy imported method in a super class of a class?

Cheers,
             Nicolas


---

Attachment


---

Comment by mhansen created at 2011-06-13 15:21:01

`inspect.getmro()` was what I was looking for and couldn't find last night.  Thanks.


---

Comment by mhansen created at 2011-06-13 15:21:01

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2011-06-13 17:51:42

Hi Mike!

I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.

Cheers,
               Nicolas


---

Comment by mhansen created at 2011-06-13 17:54:21

Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.


---

Comment by nthiery created at 2012-01-27 16:29:23

Hi!

Replying to [comment:9 mhansen]:
> Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.

What was the result of this discussion?

Shall we get this patch in?

Cheers,
                          Nicolas


---

Attachment


---

Comment by hivert created at 2012-02-06 15:03:59

Changing status from needs_review to positive_review.


---

Comment by hivert created at 2012-02-06 15:03:59

> I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.

I'm ok with the review patch. => Positive review.


---

Comment by nthiery created at 2012-02-08 01:23:21

Changing keywords from "" to "Cernay2012".


---

Comment by jdemeyer created at 2012-02-14 14:19:57

Resolution: fixed
