# Issue 10916: Improve support for lazy_import inside classes

archive/issues_010916.json:
```json
{
    "body": "Assignee: jason\n\nCC:  rishi jason rlm rbradshaw\n\nCurrently, one can do:\n\n\n```\n    sage: class foo(object):\n    ...       bar = LazyImport('sage.bar', 'bar')\n    sage: foo.bar\n    bar\n```\n\n\nand this works (assuming sage.bar.bar exists of course). As a\nsyntactic sugar, it would be nice to have lazy_import work as well, if\npossible with the automatic back-insertion of the object into the\nclass after the actual import occurred:\n\n\n```\n    sage: class foo(object):\n    ...       lazy_import('sage.bar', 'bar')\n    sage: type(foo.bar)\n    <type 'sage.misc.lazy_import.LazyImport'>\n    sage: foo.bar\n    bar\n    sage: type(foo.bar)\n    <type 'bar_type>\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11003\n\n",
    "created_at": "2011-03-23T23:05:02Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "title": "Improve support for lazy_import inside classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10916",
    "user": "nthiery"
}
```
Assignee: jason

CC:  rishi jason rlm rbradshaw

Currently, one can do:


```
    sage: class foo(object):
    ...       bar = LazyImport('sage.bar', 'bar')
    sage: foo.bar
    bar
```


and this works (assuming sage.bar.bar exists of course). As a
syntactic sugar, it would be nice to have lazy_import work as well, if
possible with the automatic back-insertion of the object into the
class after the actual import occurred:


```
    sage: class foo(object):
    ...       lazy_import('sage.bar', 'bar')
    sage: type(foo.bar)
    <type 'sage.misc.lazy_import.LazyImport'>
    sage: foo.bar
    bar
    sage: type(foo.bar)
    <type 'bar_type>
```


Issue created by migration from https://trac.sagemath.org/ticket/11003





---

archive/issue_comments_117214.json:
```json
{
    "body": "I think this should be good, but the only thing I have questions about is the switch from `f_globals` to `f_locals`.",
    "created_at": "2011-06-13T07:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117214",
    "user": "mhansen"
}
```

I think this should be good, but the only thing I have questions about is the switch from `f_globals` to `f_locals`.



---

archive/issue_comments_117215.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-13T07:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117215",
    "user": "mhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_117216.json:
```json
{
    "body": "Thanks Mike!\n\nWhat's the rationale for not always walking through the whole mro?\n\nI would suggest to replace ``walk_owner_namespaces=False* by ``owner=None*.\n\nOtherwise, this looks overall looks good. I have no clue at this point about the f_globals vs f_locals point though.\n\nCheers,\n                       Nicolas",
    "created_at": "2011-06-13T10:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117216",
    "user": "nthiery"
}
```

Thanks Mike!

What's the rationale for not always walking through the whole mro?

I would suggest to replace ``walk_owner_namespaces=False* by ``owner=None*.

Otherwise, this looks overall looks good. I have no clue at this point about the f_globals vs f_locals point though.

Cheers,
                       Nicolas



---

archive/issue_comments_117217.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-13T10:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117217",
    "user": "nthiery"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_117218.json:
```json
{
    "body": "Replying to [comment:2 nthiery]:\n> What's the rationale for not always walking through the whole mro?\n\nDo you mean the break?",
    "created_at": "2011-06-13T10:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117218",
    "user": "mhansen"
}
```

Replying to [comment:2 nthiery]:
> What's the rationale for not always walking through the whole mro?

Do you mean the break?



---

archive/issue_comments_117219.json:
```json
{
    "body": "Replying to [comment:3 mhansen]:\n> Replying to [comment:2 nthiery]:\n> > What's the rationale for not always walking through the whole mro?\n> \n> Do you mean the break?\n\nSorry, I should have been more explicit. It's about the using `owner.__bases__' rather than ``owner.__mro__''.\n\nBy the way, what about using ``owner.mro()'' to respect encapsulation? Speed is not an issue here, right?",
    "created_at": "2011-06-13T11:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117219",
    "user": "nthiery"
}
```

Replying to [comment:3 mhansen]:
> Replying to [comment:2 nthiery]:
> > What's the rationale for not always walking through the whole mro?
> 
> Do you mean the break?

Sorry, I should have been more explicit. It's about the using `owner.__bases__' rather than ``owner.__mro__''.

By the way, what about using ``owner.mro()'' to respect encapsulation? Speed is not an issue here, right?



---

archive/issue_comments_117220.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-13T11:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117220",
    "user": "mhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_117221.json:
```json
{
    "body": "I've updated the patch to fix these two issues.",
    "created_at": "2011-06-13T11:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117221",
    "user": "mhansen"
}
```

I've updated the patch to fix these two issues.



---

archive/issue_comments_117222.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-13T14:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117222",
    "user": "nthiery"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_117223.json:
```json
{
    "body": "Thanks! \n\nIt seems the builtin inspect.mro should do the job of supporting both old style and new style classes. Also, just for test-completeness, could you add a test with a lazy imported method in a super class of a class?\n\nCheers,\n             Nicolas",
    "created_at": "2011-06-13T14:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117223",
    "user": "nthiery"
}
```

Thanks! 

It seems the builtin inspect.mro should do the job of supporting both old style and new style classes. Also, just for test-completeness, could you add a test with a lazy imported method in a super class of a class?

Cheers,
             Nicolas



---

archive/issue_comments_117224.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-06-13T15:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117224",
    "user": "mhansen"
}
```

Attachment



---

archive/issue_comments_117225.json:
```json
{
    "body": "`inspect.getmro()` was what I was looking for and couldn't find last night.  Thanks.",
    "created_at": "2011-06-13T15:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117225",
    "user": "mhansen"
}
```

`inspect.getmro()` was what I was looking for and couldn't find last night.  Thanks.



---

archive/issue_comments_117226.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-13T15:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117226",
    "user": "mhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_117227.json:
```json
{
    "body": "Hi Mike!\n\nI just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.\n\nCheers,\n               Nicolas",
    "created_at": "2011-06-13T17:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117227",
    "user": "nthiery"
}
```

Hi Mike!

I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.

Cheers,
               Nicolas



---

archive/issue_comments_117228.json:
```json
{
    "body": "Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.",
    "created_at": "2011-06-13T17:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117228",
    "user": "mhansen"
}
```

Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.



---

archive/issue_comments_117229.json:
```json
{
    "body": "Hi!\n\nReplying to [comment:9 mhansen]:\n> Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.\n\nWhat was the result of this discussion?\n\nShall we get this patch in?\n\nCheers,\n                          Nicolas",
    "created_at": "2012-01-27T16:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117229",
    "user": "nthiery"
}
```

Hi!

Replying to [comment:9 mhansen]:
> Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.

What was the result of this discussion?

Shall we get this patch in?

Cheers,
                          Nicolas



---

archive/issue_comments_117230.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-02-06T15:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117230",
    "user": "hivert"
}
```

Attachment



---

archive/issue_comments_117231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-06T15:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117231",
    "user": "hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_117232.json:
```json
{
    "body": "> I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.\n\nI'm ok with the review patch. => Positive review.",
    "created_at": "2012-02-06T15:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117232",
    "user": "hivert"
}
```

> I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.

I'm ok with the review patch. => Positive review.



---

archive/issue_comments_117233.json:
```json
{
    "body": "Changing keywords from \"\" to \"Cernay2012\".",
    "created_at": "2012-02-08T01:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117233",
    "user": "nthiery"
}
```

Changing keywords from "" to "Cernay2012".



---

archive/issue_comments_117234.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10916",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10916#issuecomment-117234",
    "user": "jdemeyer"
}
```

Resolution: fixed
