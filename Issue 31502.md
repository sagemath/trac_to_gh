# Issue 31502: Problem with exponential of arctanh and arcosh

Issue created by migration from https://trac.sagemath.org/ticket/31739

Original creator: @Yapadcoi

Original creation time: 2021-04-27 09:17:06

CC:  dimpase slelievre mjo

It seems to me that there is a problem during the computation of exp(2*arctanh(x)). I tried both on Sagemath on my own computer and on https://sagecell.sagemath.org. The evaluation gives

(x + 1)/(x - 1)

However, the correct answer is (1+x)/(1-x). 

The problem also exists with exp(2*arccoth(x)) which leads to

(x - 1)/(x + 1)

and the correct answer is (x+1)/(x-1).

Do I make something wrong?


---

Comment by slelievre created at 2021-04-27 14:17:46

This is likely a Pynac bug. Please report at

- https://github.com/pynac/pynac


---

Comment by slelievre created at 2021-04-27 15:59:42

Changing priority from major to critical.


---

Comment by slelievre created at 2021-04-27 15:59:42

Changing type from PLEASE CHANGE to defect.


---

Comment by slelievre created at 2021-04-27 15:59:42

I proposed a fix to Pynac, see link in ticket description.

We should either apply it here as a patch
or wait for a new Pynac release with the fix.

We should also add doctests.


---

Comment by dimpase created at 2021-06-24 12:27:54

OK, I've tested the pynac patch, it seems to work. Now the full doctest...


---

Comment by dimpase created at 2021-06-25 08:59:09

OK, this works. I'm merging this upstream.


---

Comment by dimpase created at 2021-06-25 09:00:41

Changing status from new to needs_review.


---

Comment by dimpase created at 2021-06-25 09:00:55

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-06-25 09:54:23

Should we add doctests though?


---

Comment by dimpase created at 2021-06-25 11:29:14

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2021-06-25 11:29:14

Could you add doctests here, on top of #31694?


---

Comment by slelievre created at 2021-07-25 23:39:55

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2021-07-25 23:39:55

Thanks Dima for merging my pull request in Pynac.

I'm adding examples in `src/sage/functions/hyperbolic.py`.
Having added the examples in the file's main docstring,
I skipped mentioning the ticket number, which I would
have done if I had put the doctests in TESTS blocks.
Hope that's okay.

Follow-up Pynac issue for the case c = 1 at

- https://github.com/pynac/pynac/issues/381
----
New commits:


---

Comment by slelievre created at 2021-07-26 00:14:34

Changing priority from critical to major.


---

Comment by slelievre created at 2021-07-26 00:14:34

Lowering priority as the fix is in
and we merely add doctests here.


---

Comment by mjo created at 2021-09-18 11:42:26

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2021-09-18 11:42:26

For robust test cases, something like


```
sage: bool(exp(2*atanh(x)) == -(x + 1)/(x - 1))
True
```


would be preferable as it does not depend on an exact string representation. But with _examples_, it's hard to avoid. And now that we've officially adopted pynac I guess it's OK to doctest this here, rather than in pynac "upstream."


---

Comment by vbraun created at 2021-09-25 23:18:15

Resolution: fixed
