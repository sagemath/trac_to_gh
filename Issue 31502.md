# Issue 31502: Problem with exponential of arctanh and arcosh

archive/issues_031502.json:
```json
{
    "body": "CC:  @dimpase @slel @orlitzky\n\nIt seems to me that there is a problem during the computation of exp(2*arctanh(x)). I tried both on Sagemath on my own computer and on https://sagecell.sagemath.org. The evaluation gives\n\n(x + 1)/(x - 1)\n\nHowever, the correct answer is (1+x)/(1-x). \n\nThe problem also exists with exp(2*arccoth(x)) which leads to\n\n(x - 1)/(x + 1)\n\nand the correct answer is (x+1)/(x-1).\n\nDo I make something wrong?\n\nIssue created by migration from https://trac.sagemath.org/ticket/31739\n\n",
    "created_at": "2021-04-27T09:17:06Z",
    "labels": [
        "calculus",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Problem with exponential of arctanh and arcosh",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31502",
    "user": "@Yapadcoi"
}
```
CC:  @dimpase @slel @orlitzky

It seems to me that there is a problem during the computation of exp(2*arctanh(x)). I tried both on Sagemath on my own computer and on https://sagecell.sagemath.org. The evaluation gives

(x + 1)/(x - 1)

However, the correct answer is (1+x)/(1-x). 

The problem also exists with exp(2*arccoth(x)) which leads to

(x - 1)/(x + 1)

and the correct answer is (x+1)/(x-1).

Do I make something wrong?

Issue created by migration from https://trac.sagemath.org/ticket/31739





---

archive/issue_comments_450479.json:
```json
{
    "body": "This is likely a Pynac bug. Please report at\n\n- https://github.com/pynac/pynac",
    "created_at": "2021-04-27T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450479",
    "user": "@slel"
}
```

This is likely a Pynac bug. Please report at

- https://github.com/pynac/pynac



---

archive/issue_comments_450480.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450480",
    "user": "@slel"
}
```

Changing priority from major to critical.



---

archive/issue_comments_450481.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450481",
    "user": "@slel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_450482.json:
```json
{
    "body": "I proposed a fix to Pynac, see link in ticket description.\n\nWe should either apply it here as a patch\nor wait for a new Pynac release with the fix.\n\nWe should also add doctests.",
    "created_at": "2021-04-27T15:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450482",
    "user": "@slel"
}
```

I proposed a fix to Pynac, see link in ticket description.

We should either apply it here as a patch
or wait for a new Pynac release with the fix.

We should also add doctests.



---

archive/issue_comments_450483.json:
```json
{
    "body": "OK, I've tested the pynac patch, it seems to work. Now the full doctest...",
    "created_at": "2021-06-24T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450483",
    "user": "@dimpase"
}
```

OK, I've tested the pynac patch, it seems to work. Now the full doctest...



---

archive/issue_comments_450484.json:
```json
{
    "body": "OK, this works. I'm merging this upstream.",
    "created_at": "2021-06-25T08:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450484",
    "user": "@dimpase"
}
```

OK, this works. I'm merging this upstream.



---

archive/issue_comments_450485.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-25T09:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450485",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450486.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-25T09:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450486",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450487.json:
```json
{
    "body": "Should we add doctests though?",
    "created_at": "2021-06-25T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450487",
    "user": "@slel"
}
```

Should we add doctests though?



---

archive/issue_comments_450488.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-25T11:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450488",
    "user": "@dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_450489.json:
```json
{
    "body": "Could you add doctests here, on top of #31694?",
    "created_at": "2021-06-25T11:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450489",
    "user": "@dimpase"
}
```

Could you add doctests here, on top of #31694?



---

archive/issue_comments_450490.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-25T23:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450490",
    "user": "@slel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_450491.json:
```json
{
    "body": "Thanks Dima for merging my pull request in Pynac.\n\nI'm adding examples in `src/sage/functions/hyperbolic.py`.\nHaving added the examples in the file's main docstring,\nI skipped mentioning the ticket number, which I would\nhave done if I had put the doctests in TESTS blocks.\nHope that's okay.\n\nFollow-up Pynac issue for the case c = 1 at\n\n- https://github.com/pynac/pynac/issues/381\n----\nNew commits:",
    "created_at": "2021-07-25T23:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450491",
    "user": "@slel"
}
```

Thanks Dima for merging my pull request in Pynac.

I'm adding examples in `src/sage/functions/hyperbolic.py`.
Having added the examples in the file's main docstring,
I skipped mentioning the ticket number, which I would
have done if I had put the doctests in TESTS blocks.
Hope that's okay.

Follow-up Pynac issue for the case c = 1 at

- https://github.com/pynac/pynac/issues/381
----
New commits:



---

archive/issue_comments_450492.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2021-07-26T00:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450492",
    "user": "@slel"
}
```

Changing priority from critical to major.



---

archive/issue_comments_450493.json:
```json
{
    "body": "Lowering priority as the fix is in\nand we merely add doctests here.",
    "created_at": "2021-07-26T00:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450493",
    "user": "@slel"
}
```

Lowering priority as the fix is in
and we merely add doctests here.



---

archive/issue_comments_450494.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-18T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450494",
    "user": "@orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450495.json:
```json
{
    "body": "For robust test cases, something like\n\n\n```\nsage: bool(exp(2*atanh(x)) == -(x + 1)/(x - 1))\nTrue\n```\n\n\nwould be preferable as it does not depend on an exact string representation. But with *examples*, it's hard to avoid. And now that we've officially adopted pynac I guess it's OK to doctest this here, rather than in pynac \"upstream.\"",
    "created_at": "2021-09-18T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450495",
    "user": "@orlitzky"
}
```

For robust test cases, something like


```
sage: bool(exp(2*atanh(x)) == -(x + 1)/(x - 1))
True
```


would be preferable as it does not depend on an exact string representation. But with *examples*, it's hard to avoid. And now that we've officially adopted pynac I guess it's OK to doctest this here, rather than in pynac "upstream."



---

archive/issue_comments_450496.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-25T23:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31502#issuecomment-450496",
    "user": "@vbraun"
}
```

Resolution: fixed
