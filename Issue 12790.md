# Issue 12790: Implement multi-function plotting options in plot()

Issue created by migration from Trac.

Original creator: alauve

Original creation time: 2012-05-17 14:53:10

Assignee: was

CC:  kcrisman ppurka jdemeyer jason saliola jhonrubia6 paulmasson novoselt

Keywords: plot, linestyle, color

The code `plot([x,x^ 2],-.2,2)` is a nice shortcut for plotting both x and x!^ 2 on the same graph. However, if you want to choose different colors or linestyles for each function, then it seems you have to execute, e.g.,


```
p1=plot(x,-.2,1.2,color='blue',linestyle='dotted'); 
p2=plot(x^2,-.2,1.2,color='red',linestyle='dashed');Â 
p1+p2
```

Here is how Maple and Mathematica handle this issue, respectively:

`[> plot([x, x^ 2], x= -.2..1.2, color=["blue", "red"],linestyle=[dot, longdash]);^

In[1]:= Plot[{x, x^2}, {x, -.2, 1.2}, PlotStyle -> {{Blue, Dotted}, {Red, Dashed}}]`^


---

Comment by alauve created at 2015-07-13 19:45:12

Changing status from new to needs_review.


---

Comment by alauve created at 2015-07-13 19:45:12

I've pushed a possible solution and set the ticket to 'needs_review'. 

Comments?
----
New commits:


---

Comment by git created at 2015-07-13 19:45:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 04:00:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 04:21:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 19:50:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 20:19:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2015-07-20 20:24:29

New commits:


---

Comment by kcrisman created at 2015-07-25 01:48:48

Regarding the default coloring, please see also #8164.


---

Comment by git created at 2015-07-25 04:07:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ppurka created at 2015-08-29 14:52:45

I like what is done in this ticket. One of the first things I tried after seeing automatic colors and plots, is try to enable legend labels. I think it would be a good idea to also accept `legend_label` as a list and enable the legends in the same order as the multiple figures. Would it be too hard to do so?


---

Comment by alauve created at 2015-08-29 15:33:25

Probably not. I'll look into it soon. 

(What is beyond my powers is to do a better job of picking colors; see comments 15 and 16 at #8164.)


---

Comment by ppurka created at 2015-08-29 15:37:49

Or, we can make a separate ticket for `legend_labels`. I am fine with this ticket as it is. Let me know which approach you prefer.

I have seen your comments in #8164. I agree that the colors could be chosen better, but that better be addressed in that ticket itself.

Otherwise there will be too much overlap between the tickets and it will take ages to merge anything. I have a feeling that getting consensus on the automatic color spectrum will take some time and discussion since different people tend to like different things. Some are worried about how the colors will look - how much they can be differentiated -  when printed in grayscale, while some others are more concerned about how they will look on the screen.


---

Comment by kcrisman created at 2015-08-29 21:07:00

Not to mention accessibility issues - Jeroen, if you see this, do you have any particular thoughts from your perspective?


---

Comment by tscrim created at 2016-07-02 19:09:35

Just rebased the current branch, but it would be good to have this functionality.
----
New commits:


---

Comment by git created at 2016-07-02 19:26:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-07-03 22:24:30

Doctests failing with message


```
Error: TAB character found at lines 1089,1092,1099
    [383 tests, 47.56 s]
```


Building documentation produces too many errors to copy here.


---

Comment by paulmasson created at 2016-07-03 22:24:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-07-08 17:42:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2016-07-08 18:11:05

Travis and Paul,

Just be sure to check out some of the discussion here and #8164 regarding the _auto_-coloring options.  I'm still somewhat reluctant to change the default due to accessibility and 'backwards compatibility' (and that the yellow and a couple others are harder to see), since it's not like we are doing proper release notes and this may surprise some ...  (There was also discussion of whether `rainbow()` is the best choice for multicolor for other reasons but I'll stay out of that.)  Even a scale of different blues might be better than that.


---

Comment by paulmasson created at 2016-07-09 00:26:14

Karl-Dieter, since you appear to be the only developer disagreeing about having automatic colors, is there some way to solicit input on this question from users? Does Sage have some sort of user mailing list for sending out questions or making announcements of this sort? What about an open question on ask.sagemath.org?

I personally like the rainbow colors, and this version is actually better than Mathematica's.


---

Comment by paulmasson created at 2016-07-09 00:42:16

On matters of code, the doctests now pass but documentation building is still a problem, with at least two plots failing. Aaron, please try building the documentation to see where the errors are.

One feature that I do not like in this branch is that `linestyle` defaults to automatic. I find solid lines much easier to read and would prefer that `linestyle` default to solid. That is in line with Mathematica behavior.

Also, if both `rgbcolor` and `color` are specified, this branch silently overrides the former with the latter. In the current version of `plot.py`, specifying both of these options leads to a `RuntimeError` coming from the current line 780:


```
`@`rename_keyword(color='rgbcolor')
```


I was in the future planning to remove that line and add code to raise a `ValueError` as Travis had me do in #9654. I think this branch should raise the `ValueError` rather than silently override an option, and then this decorator can be removed.


---

Comment by novoselt created at 2016-07-09 00:57:38

After reading all comments but not studying the code:
- I most definitely agree that `linestyle` should be a solid line for all unless changed by a user;
- I don't think we should be too concerned with making "proper choice" for default different colors: the current situation is that they all are the same and users who care about multiple functions probably have multiple plot commands with custom colors. Hence we will not affect/break old code as long as the default for a single plot is the same/similar.


---

Comment by kcrisman created at 2016-07-09 01:35:31

> Karl-Dieter, since you appear to be the only developer disagreeing about having automatic colors, is there some way to solicit input on this question from users? Does Sage have some sort of user mailing list for sending out questions or making announcements of this sort? What about an open question on ask.sagemath.org?

Usually in this case one of two things is done (I don't think this is an "official" policy, though):
 * Ask on sage-devel if anyone cares
 * Majority rule on the ticket
Sometimes it does matter enough, but even then usually on sage-devel only a few people will pipe up unless it's something that affects a fairly broad range of people.

In this case, I don't care strongly enough to block this now that several people have 'officially' weighed in (including on #8164).  You may still want to look there regarding different _options_ for auto-coloring - matplotlib had a [huge and long debate](https://www.youtube.com/watch?v=xAoljeRJ3lU) over their new default colormap for best visualization of data.  But in any case once it's decided here, you should close #8164 as a dup.


---

Comment by chapoton created at 2016-07-12 09:48:55

public/graphics/multi_function_plot_options-12962

was not a correct git branch name, so I removed it


---

Comment by tscrim created at 2016-07-12 14:42:29

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-07-12 14:42:29

I have no idea about what happened to the branch...strange...

My 2 cents: I think having the default linestyle being a solid color is what we should do. I haven't really looked into the code, but just having the option of providing multiple colors is a huge +1 for including this (and is a natural thing for people to try when doing multiple plots).
----
New commits:


---

Comment by alauve created at 2016-07-12 20:34:07

Sorry, Travis, Not quite ready for review... I think there are one or two points to address in the preceding comments. Expect to see me revert it to 'needs review' later in the week.

* accept `legend_label` as a list
* restore `linestyle` default back to 'solid'
* implement `ValueError` when using two color models
* build documentation to find failing (sphinx?) plots

Stay tuned


---

Comment by alauve created at 2016-07-12 20:34:07

Changing status from needs_review to needs_work.


---

Comment by alauve created at 2016-07-14 02:56:59

Karl-Dieter,
I found a nice website that will take a url and pass its content through assorted "color blind" filters. They do b&w too. Follow the instructions here: [color test](http://webpages.math.luc.edu/~lauve/scratch/color_test.html)

It seems that advancing colors on the hue scale by 1/(golden ratio) works well in all cases, so I'm going with this for now. One can always start a new ticket to implement more advanced color theory methods. (In particular, I have no idea how to bring the matplotlib 2.0 [colormaps](https://www.youtube.com/watch?v=xAoljeRJ3lU) into the picture.)


---

Comment by git created at 2016-07-14 04:40:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-07-14 21:56:36

One doctest failing with error message:


```
File "src/sage/plot/plot.py", line 1967, in sage.plot.plot.?
Failed example:
    len((q1).matplotlib().axes[0].legend().texts) # used to raise AttributeError
Expected:
    1
Got:
    2
```



---

Comment by alauve created at 2016-07-15 18:47:06

Hmm..

Okay, I confirm the `RuntimeError` when both `color` and `rgbcolor` are specified. But I'm not sure I understand what you are proposing. 
 * Do you want a `ValueError` if the keyword `color` is used at all? (or if you prefer, `rgbcolor` is used?)
 * Or do you want a `ValueError` if _both_ are specified? I don't know why anybody would do this, but I also don't have an objection to adding such a check.

Is there any reason to have both keywords floating around? Perhaps the simplest solution is for me to replace all instances of `rgbcolor` with `color` within `plot.py`?  (When I first read this code, I assumed the ``@`rename_keyword` call was a generous short-cut provided to the end-user by the code-writer. I certainly don't want to write `rgbcolor=` if I don't have to.)



Replying to [comment:27 paulmasson]:
> On matters of code, the doctests now pass but documentation building is still a problem, with at least two plots failing. Aaron, please try building the documentation to see where the errors are.
> 
> One feature that I do not like in this branch is that `linestyle` defaults to automatic. I find solid lines much easier to read and would prefer that `linestyle` default to solid. That is in line with Mathematica behavior.
> 
> Also, if both `rgbcolor` and `color` are specified, this branch silently overrides the former with the latter. In the current version of `plot.py`, specifying both of these options leads to a `RuntimeError` coming from the current line 780:
> 
> {{{
> `@`rename_keyword(color='rgbcolor')
> }}}
> 
> I was in the future planning to remove that line and add code to raise a `ValueError` as Travis had me do in #9654. I think this branch should raise the `ValueError` rather than silently override an option, and then this decorator can be removed.


---

Comment by paulmasson created at 2016-07-17 22:36:54

The ``@`rename_keyword` decorator in this file first appeared in #4201. On the same ticket this decorator and ``@`options` were added to `misc/decorators.py`. The description for the latter is about the convenience of the end user, so I think we can assume the same for the former.

The functions in a plot get passed to `line.py` as subplots, and the `_allowed_options` for lines include `rgbcolor` but not `color`. We can't just rename keywords here that are expected to have a certain name elsewhere, unless you want to track down every plot file that will get output from `plot.py` and change all of them.

What Travis had me do in #9654 was raise the `ValueError` only if both keywords were used at the same time. This lets the end user input either keyword as desired but avoids conflicting information that might confuse.

On #9654 color values were passed to another keyword, so I did the check to make sure only one was present and set the new keyword value. For this ticket `rgbcolor` is expected in other places, so after checking that only one is present you could use presumably use  the function `rename_keyword(color='rgbcolor')` when `color` is present to copy over values, but then always use the keyword `rgbcolor` when passing values elsewhere.

This reply is bit long-winded, but I'd like to have a record of some of the details of how plotting works in Sage. Let me also know if I've not yet been clear enough.


---

Comment by git created at 2016-07-18 16:29:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-07-19 02:51:55

Aaron, a couple minor things:

1) When the plot/subplot is created in what is currently L1994, please use the keyword `rgbcolor`  rather than `color` for consistency with other plot files.

2) Most files I've seen in Sage don't have spaces around the equals sign when assigning keyword arguments. Please remove the extra white space for consistency with other files. 

Thanks!


---

Comment by git created at 2016-07-19 04:00:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2016-07-19 04:03:37

Replying to [comment:40 paulmasson]:
> Aaron, a couple minor things:
> 
> 1) When the plot/subplot is created in what is currently L1994, please use the keyword `rgbcolor`  rather than `color` for consistency with other plot files.

ran into a problem naively implementing this. Simply replacing `color` with `rgbcolor` on L2139 (in current ticket) breaks Sage's plot() function. **I'm not sure I can track down the problem,** but I'll give it a try tomorrow.
> 
> 2) Most files I've seen in Sage don't have spaces around the equals sign when assigning keyword arguments. Please remove the extra white space for consistency with other files. 

done.


---

Comment by git created at 2016-08-09 04:24:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2016-08-09 04:30:37

A remark on the documentation fix mentioned above.
This is what I want to mimic with sphinx_plot:

```
        sage: p1 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill={1: [0]}, fillcolor='blue', fillalpha=.25, color='blue')
        sage: p2 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill={0: 1, 1:[0]}, color=['blue'])
        sage: p3 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill=[0, [0]], fillcolor=['#f60'], fillalpha=1, color={1: 'blue'})
        sage: p4 = plot([sin(x), cos(2*x)*sin(x)], (x,-pi, pi), fill=[0, x/pi], fillcolor='grey', color=['red', 'blue'])
        sage: graphics_array([[p1, p2], [p3, p4]]).show(frame=True, axes=False) # long time
```

I'm not quite sure how to get frame and axes options passed to sphinx_plot:

Any ideas?


---

Comment by git created at 2016-08-09 20:52:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2016-08-09 20:53:12

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-08-09 23:08:08

Unfortunately, I don't think `GraphicsArray` currently has the capabilities to set options like `axes` and `frame`.


---

Comment by kcrisman created at 2016-08-10 02:23:08

See e.g. #10657 and #11160.


---

Comment by jhonrubia6 created at 2016-08-10 09:13:21

You can hack the axes part thanks to the `axes` method in `Graphics`, I've used this trick in other tickets


```
p1 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill={1: [0]}, fillcolor='blue', fillalpha=.25, color='blue')
p2 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill={0: 1, 1:[0]}, color=['blue'])
p3 = plot([sin(x), cos(2*x)*sin(x)], -pi, pi, fill=[0, [0]], fillcolor=['#f60'], fillalpha=1, color={1: 'blue'})
p4 = plot([sin(x), cos(2*x)*sin(x)], (x,-pi, pi), fill=[0, x/pi], fillcolor='grey', color=['red', 'blue'])
p1.axes(show=False);p2.axes(show=False);p3.axes(show=False);p4.axes(show=False)
sphinx_plot(graphics_array([[p1, p2], [p3, p4]]))
```

Unfortunately we don't have a `frame` method neither in `Graphics` nor in `GraphicsArray`


---

Comment by paulmasson created at 2016-08-10 23:39:07

Replying to [comment:42 alauve]:
> Replying to [comment:40 paulmasson]:
> > Aaron, a couple minor things:
> > 
> > 1) When the plot/subplot is created in what is currently L1994, please use the keyword `rgbcolor`  rather than `color` for consistency with other plot files.
> 
> ran into a problem naively implementing this. Simply replacing `color` with `rgbcolor` on L2139 (in current ticket) breaks Sage's plot() function. **I'm not sure I can track down the problem,** but I'll give it a try tomorrow.
`plot()` works for me with this change. Do you still consider this a problem?
> > 
> > 2) Most files I've seen in Sage don't have spaces around the equals sign when assigning keyword arguments. Please remove the extra white space for consistency with other files. 
> 
> done.
Thanks.


---

Comment by alauve created at 2016-08-10 23:43:41

Replying to [comment:50 paulmasson]:
> Replying to [comment:42 alauve]:
> > Replying to [comment:40 paulmasson]:
> > > Aaron, a couple minor things:
> > > 
> > > 1) When the plot/subplot is created in what is currently L1994, please use the keyword `rgbcolor`  rather than `color` for consistency with other plot files.
> > 
> > ran into a problem naively implementing this. Simply replacing `color` with `rgbcolor` on L2139 (in current ticket) breaks Sage's plot() function. **I'm not sure I can track down the problem,** but I'll give it a try tomorrow.
> `plot()` works for me with this change. Do you still consider this a problem?

Nope. All is well. I must have made a complementary change since that time.

> > > 
> > > 2) Most files I've seen in Sage don't have spaces around the equals sign when assigning keyword arguments. Please remove the extra white space for consistency with other files. 
> > 
> > done.
> Thanks.


---

Comment by paulmasson created at 2016-08-11 00:08:30

Doctests pass. Documentation builds and looks good as is.

Aaron, are you still planning to work on plots on this ticket or can I set positive review?


---

Comment by alauve created at 2016-08-11 02:09:56

Hmm,
Looking over the documentation, I see a few minor changes that I should make. I'll toggle back to needs_work. When you see it return to needs_review, I'm done.

Thx.

Replying to [comment:52 paulmasson]:
> Doctests pass. Documentation builds and looks good as is.
> 
> Aaron, are you still planning to work on plots on this ticket or can I set positive review?


---

Comment by alauve created at 2016-08-11 02:10:52

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-08-11 05:27:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alauve created at 2016-08-11 05:27:50

Changing status from needs_work to needs_review.


---

Comment by paulmasson created at 2016-08-11 20:56:23

Aaron, you added a bit more that what's in your description: the options for `legend_color` are expanded which is good and functions as expected.

Regarding legends, for the case of multiple graph colors with a single `legend_label`, I find the empty spaces in the legend unexpected. Wouldn't it make more sense to repeat the single label for all lines? If I'm graphing multiple functions and deliberately give one label, I'd expect it to appear for all of them.


---

Comment by paulmasson created at 2016-08-11 20:59:36

Also, the documentation for `legend_color` and `fillcolor` says that they follow the same conventions as `color`. That's not completely true, since the default for `legend_color` is black and the default for `fillcolor` is gray. Please add those defaults for clarity.


---

Comment by alauve created at 2016-08-11 21:32:50

Replying to [comment:57 paulmasson]:
> Aaron, you added a bit more that what's in your description: the options for `legend_color` are expanded which is good and functions as expected.

ah yes... it occurred to me that this was a natural extension of what was asked for in [comment:16]. My apologies for not mentioning it.
> 
> Regarding legends, for the case of multiple graph colors with a single `legend_label`, I find the empty spaces in the legend unexpected. Wouldn't it make more sense to repeat the single label for all lines? If I'm graphing multiple functions and deliberately give one label, I'd expect it to appear for all of them.

I don't know that I agree. I was trying to think of all the reasons I'd just include one label... "trig functions" or "cos(nx)" or some such. I don't think I'd want to see that written multiple times. Certainly, seeing "f" or "x<sup>2</sup>" written multiple times would be silly. But, it is nearly as easy to write ["trig functions", "", ""] as it is to write "trig functions", so I'm happy to modify the code accordingly.


---

Comment by git created at 2016-08-12 05:40:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-08-12 19:59:07

Good to go.


---

Comment by paulmasson created at 2016-08-12 19:59:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-13 23:45:35

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-08-13 23:45:35

Branch seems to be missing?


---

Comment by git created at 2016-08-13 23:46:38

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tscrim created at 2016-08-13 23:47:44

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-08-13 23:47:44

Hmm...strange. I have the most recent copy, so I've pushed it back.


---

Comment by vbraun created at 2016-08-14 19:05:10

Resolution: fixed
