# Issue 31338: Remove full boost package

Issue created by migration from https://trac.sagemath.org/ticket/31575

Original creator: mkoeppe

Original creation time: 2021-03-28 19:23:43

CC:  dimpase vbraun jhpalmieri charpent fbissey

(from #29620)

We propose to remove the full `boost` package, which was added in 2016 (#20754, #20776) and updated once in 2018 (#26597), and only offer our cropped version of boost, which is enough for all of our packages. 

We argue that it's not Sage's job to provide a full boost installation.



---

Comment by jhpalmieri created at 2021-03-28 21:54:10

I don't see `boost` listed as a dependency for any other package or any doctests that depend on it. Can we just delete `build/pkgs/boost`?


---

Comment by fbissey created at 2021-03-28 22:02:17

No doctests depend on it. It can be used instead of boost_cropped though. The point of it is that some people wanted the full boost rather than a little bit being available in sage. Either because they wanted to use it or install packages through pip that may need it. 

Some optional packages could have undeclared dependency but chances are low.

As we move to use more and more system packages - including boost, I am OK with a move to remove it.


---

Comment by jhpalmieri created at 2021-03-28 22:06:18

Replying to [comment:2 fbissey]:
> Some optional packages could have undeclared dependency but chances are low.

Especially since our `boost` package has been around so long as an optional package.

> As we move to use more and more system packages - including boost, I am OK with a move to remove it.

Right, and `boost_cropped` will skip installation and use the system `boost` if it's present.


---

Comment by fbissey created at 2021-03-28 22:11:08

Replying to [comment:3 jhpalmieri]:
> Replying to [comment:2 fbissey]:
> > As we move to use more and more system packages - including boost, I am OK with a move to remove it.
> 
> Right, and `boost_cropped` will skip installation and use the system `boost` if it's present.

Exactly. `boost` is a somewhat high demand maintenance package. There are regular releases and the build system is highly unusual. Working on it has shown some interesting quirks. I won't be sorry to see it go.


---

Comment by jhpalmieri created at 2021-03-28 22:20:08

I think that the boost options in `./configure` should be kept (so that users can specify non-standard locations for a boost library), but I'm not sure.


---

Comment by fbissey created at 2021-03-28 22:25:25

The boost option in configure is provided from `build/pkgs/boost_cropped/spkg-configure.m4` if I am not mistaken. The stuff in the boost folder makes sure that boost and boost_cropped are not installed at the same time I think.


---

Comment by jhpalmieri created at 2021-03-28 22:26:26

There is also `m4/ax_boost_base.m4`.


---

Comment by fbissey created at 2021-03-28 22:28:30

Replying to [comment:7 jhpalmieri]:
> There is also `m4/ax_boost_base.m4`.

Yes, [https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4](https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4)'s only job is to call it.


---

Comment by jhpalmieri created at 2021-03-29 00:10:04

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2021-03-29 00:10:04

Here's a branch to consider.
----
New commits:


---

Comment by mkoeppe created at 2021-03-29 00:22:34

Distros information for `boost` for `nix` and `void` should be moved to `boost_cropped`. I haven't checked whether the other distro files are identical


---

Comment by git created at 2021-03-29 01:19:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-03-29 01:19:44

The other distro files are all identical.


---

Comment by mkoeppe created at 2021-03-29 02:06:31

LGTM. 

This is for the Sage 9.4 series, right? Then I don't set it to positive review yet - Volker's merging scripts do not look at the Milestone field - https://groups.google.com/g/sage-devel/c/EN8IOtySC-w/m/l9dVq3_2CQAJ


---

Comment by jhpalmieri created at 2021-03-29 05:12:41

Okay, sounds good.


---

Comment by mkoeppe created at 2021-05-08 15:56:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-05-27 20:28:54

Resolution: fixed


---

Comment by dimpase created at 2021-05-28 15:05:29

with #30668 (autoconf 2.71), I see 

```
$ ./bootstrap
...
configure.ac:43: installing 'config/missing'
m4/sage_spkg_configures.m4:498: warning: SAGE_SPKG_CONFIGURE_BOOST is m4_require'd but not m4_defun'd
m4/sage_spkg_configure.m4:159: SAGE_SPKG_DEPCHECK is expanded from...
lib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
lib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
m4/sage_spkg_collect.m4:69: SAGE_SPKG_COLLECT is expanded from...
m4/sage_spkg_configures.m4:498: the top level
```

and this is after `make distclean bootstrap-clean`.


---

Comment by dimpase created at 2021-05-28 15:16:11

namely, the following is the fix:

```diff
--- a/build/pkgs/brial/spkg-configure.m4
+++ b/build/pkgs/brial/spkg-configure.m4
@@ -1,6 +1,6 @@
 SAGE_SPKG_CONFIGURE([brial], [
   dnl Trac #31624: Avoid C++ ABI issues
-  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [
+  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [
     # If we're using the system m4ri and boost, ensure that we can
     # compile and run an executable linked against both libbrial and
     # libbrial_groebner (both are used by SageMath).
```


I'll open another ticket for this.


---

Comment by dimpase created at 2021-05-28 16:54:36

Replying to [comment:19 dimpase]:
> namely, the following is the fix:
> {{{#!diff
> --- a/build/pkgs/brial/spkg-configure.m4
> +++ b/build/pkgs/brial/spkg-configure.m4
> `@``@` -1,6 +1,6 `@``@`
>  SAGE_SPKG_CONFIGURE([brial], [
>    dnl Trac #31624: Avoid C++ ABI issues
> -  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [
> +  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [
>      # If we're using the system m4ri and boost, ensure that we can
>      # compile and run an executable linked against both libbrial and
>      # libbrial_groebner (both are used by SageMath).
> }}}
> 
> I'll open another ticket for this.

fixed by #31871
