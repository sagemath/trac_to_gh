# Issue 31338: Remove full boost package

archive/issues_031338.json:
```json
{
    "body": "CC:  dimpase vbraun jhpalmieri charpent fbissey\n\n(from #29620)\n\nWe propose to remove the full `boost` package, which was added in 2016 (#20754, #20776) and updated once in 2018 (#26597), and only offer our cropped version of boost, which is enough for all of our packages. \n\nWe argue that it's not Sage's job to provide a full boost installation.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31575\n\n",
    "created_at": "2021-03-28T19:23:43Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "title": "Remove full boost package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31338",
    "user": "mkoeppe"
}
```
CC:  dimpase vbraun jhpalmieri charpent fbissey

(from #29620)

We propose to remove the full `boost` package, which was added in 2016 (#20754, #20776) and updated once in 2018 (#26597), and only offer our cropped version of boost, which is enough for all of our packages. 

We argue that it's not Sage's job to provide a full boost installation.


Issue created by migration from https://trac.sagemath.org/ticket/31575





---

archive/issue_comments_448162.json:
```json
{
    "body": "I don't see `boost` listed as a dependency for any other package or any doctests that depend on it. Can we just delete `build/pkgs/boost`?",
    "created_at": "2021-03-28T21:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448162",
    "user": "jhpalmieri"
}
```

I don't see `boost` listed as a dependency for any other package or any doctests that depend on it. Can we just delete `build/pkgs/boost`?



---

archive/issue_comments_448163.json:
```json
{
    "body": "No doctests depend on it. It can be used instead of boost_cropped though. The point of it is that some people wanted the full boost rather than a little bit being available in sage. Either because they wanted to use it or install packages through pip that may need it. \n\nSome optional packages could have undeclared dependency but chances are low.\n\nAs we move to use more and more system packages - including boost, I am OK with a move to remove it.",
    "created_at": "2021-03-28T22:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448163",
    "user": "fbissey"
}
```

No doctests depend on it. It can be used instead of boost_cropped though. The point of it is that some people wanted the full boost rather than a little bit being available in sage. Either because they wanted to use it or install packages through pip that may need it. 

Some optional packages could have undeclared dependency but chances are low.

As we move to use more and more system packages - including boost, I am OK with a move to remove it.



---

archive/issue_comments_448164.json:
```json
{
    "body": "Replying to [comment:2 fbissey]:\n> Some optional packages could have undeclared dependency but chances are low.\n\nEspecially since our `boost` package has been around so long as an optional package.\n\n> As we move to use more and more system packages - including boost, I am OK with a move to remove it.\n\nRight, and `boost_cropped` will skip installation and use the system `boost` if it's present.",
    "created_at": "2021-03-28T22:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448164",
    "user": "jhpalmieri"
}
```

Replying to [comment:2 fbissey]:
> Some optional packages could have undeclared dependency but chances are low.

Especially since our `boost` package has been around so long as an optional package.

> As we move to use more and more system packages - including boost, I am OK with a move to remove it.

Right, and `boost_cropped` will skip installation and use the system `boost` if it's present.



---

archive/issue_comments_448165.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> Replying to [comment:2 fbissey]:\n> > As we move to use more and more system packages - including boost, I am OK with a move to remove it.\n> \n> Right, and `boost_cropped` will skip installation and use the system `boost` if it's present.\n\nExactly. `boost` is a somewhat high demand maintenance package. There are regular releases and the build system is highly unusual. Working on it has shown some interesting quirks. I won't be sorry to see it go.",
    "created_at": "2021-03-28T22:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448165",
    "user": "fbissey"
}
```

Replying to [comment:3 jhpalmieri]:
> Replying to [comment:2 fbissey]:
> > As we move to use more and more system packages - including boost, I am OK with a move to remove it.
> 
> Right, and `boost_cropped` will skip installation and use the system `boost` if it's present.

Exactly. `boost` is a somewhat high demand maintenance package. There are regular releases and the build system is highly unusual. Working on it has shown some interesting quirks. I won't be sorry to see it go.



---

archive/issue_comments_448166.json:
```json
{
    "body": "I think that the boost options in `./configure` should be kept (so that users can specify non-standard locations for a boost library), but I'm not sure.",
    "created_at": "2021-03-28T22:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448166",
    "user": "jhpalmieri"
}
```

I think that the boost options in `./configure` should be kept (so that users can specify non-standard locations for a boost library), but I'm not sure.



---

archive/issue_comments_448167.json:
```json
{
    "body": "The boost option in configure is provided from `build/pkgs/boost_cropped/spkg-configure.m4` if I am not mistaken. The stuff in the boost folder makes sure that boost and boost_cropped are not installed at the same time I think.",
    "created_at": "2021-03-28T22:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448167",
    "user": "fbissey"
}
```

The boost option in configure is provided from `build/pkgs/boost_cropped/spkg-configure.m4` if I am not mistaken. The stuff in the boost folder makes sure that boost and boost_cropped are not installed at the same time I think.



---

archive/issue_comments_448168.json:
```json
{
    "body": "There is also `m4/ax_boost_base.m4`.",
    "created_at": "2021-03-28T22:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448168",
    "user": "jhpalmieri"
}
```

There is also `m4/ax_boost_base.m4`.



---

archive/issue_comments_448169.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> There is also `m4/ax_boost_base.m4`.\n\nYes, [https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4](https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4)'s only job is to call it.",
    "created_at": "2021-03-28T22:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448169",
    "user": "fbissey"
}
```

Replying to [comment:7 jhpalmieri]:
> There is also `m4/ax_boost_base.m4`.

Yes, [https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4](https://github.com/sagemath/sage/blob/develop/build/pkgs/boost_cropped/spkg-configure.m4)'s only job is to call it.



---

archive/issue_comments_448170.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-29T00:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448170",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_448171.json:
```json
{
    "body": "Here's a branch to consider.\n----\nNew commits:",
    "created_at": "2021-03-29T00:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448171",
    "user": "jhpalmieri"
}
```

Here's a branch to consider.
----
New commits:



---

archive/issue_comments_448172.json:
```json
{
    "body": "Distros information for `boost` for `nix` and `void` should be moved to `boost_cropped`. I haven't checked whether the other distro files are identical",
    "created_at": "2021-03-29T00:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448172",
    "user": "mkoeppe"
}
```

Distros information for `boost` for `nix` and `void` should be moved to `boost_cropped`. I haven't checked whether the other distro files are identical



---

archive/issue_comments_448173.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-29T01:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448173",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448174.json:
```json
{
    "body": "The other distro files are all identical.",
    "created_at": "2021-03-29T01:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448174",
    "user": "jhpalmieri"
}
```

The other distro files are all identical.



---

archive/issue_comments_448175.json:
```json
{
    "body": "LGTM. \n\nThis is for the Sage 9.4 series, right? Then I don't set it to positive review yet - Volker's merging scripts do not look at the Milestone field - https://groups.google.com/g/sage-devel/c/EN8IOtySC-w/m/l9dVq3_2CQAJ",
    "created_at": "2021-03-29T02:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448175",
    "user": "mkoeppe"
}
```

LGTM. 

This is for the Sage 9.4 series, right? Then I don't set it to positive review yet - Volker's merging scripts do not look at the Milestone field - https://groups.google.com/g/sage-devel/c/EN8IOtySC-w/m/l9dVq3_2CQAJ



---

archive/issue_comments_448176.json:
```json
{
    "body": "Okay, sounds good.",
    "created_at": "2021-03-29T05:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448176",
    "user": "jhpalmieri"
}
```

Okay, sounds good.



---

archive/issue_comments_448177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-08T15:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448177",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_448178.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448178",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_448179.json:
```json
{
    "body": "with #30668 (autoconf 2.71), I see \n\n```\n$ ./bootstrap\n...\nconfigure.ac:43: installing 'config/missing'\nm4/sage_spkg_configures.m4:498: warning: SAGE_SPKG_CONFIGURE_BOOST is m4_require'd but not m4_defun'd\nm4/sage_spkg_configure.m4:159: SAGE_SPKG_DEPCHECK is expanded from...\nlib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...\nlib/m4sugar/m4sh.m4:699: AS_IF is expanded from...\nlib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...\nlib/m4sugar/m4sh.m4:699: AS_IF is expanded from...\nlib/m4sugar/m4sh.m4:699: AS_IF is expanded from...\nm4/sage_spkg_collect.m4:69: SAGE_SPKG_COLLECT is expanded from...\nm4/sage_spkg_configures.m4:498: the top level\n```\n\nand this is after `make distclean bootstrap-clean`.",
    "created_at": "2021-05-28T15:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448179",
    "user": "dimpase"
}
```

with #30668 (autoconf 2.71), I see 

```
$ ./bootstrap
...
configure.ac:43: installing 'config/missing'
m4/sage_spkg_configures.m4:498: warning: SAGE_SPKG_CONFIGURE_BOOST is m4_require'd but not m4_defun'd
m4/sage_spkg_configure.m4:159: SAGE_SPKG_DEPCHECK is expanded from...
lib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
lib/m4sugar/m4sh.m4:692: _AS_IF_ELSE is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
lib/m4sugar/m4sh.m4:699: AS_IF is expanded from...
m4/sage_spkg_collect.m4:69: SAGE_SPKG_COLLECT is expanded from...
m4/sage_spkg_configures.m4:498: the top level
```

and this is after `make distclean bootstrap-clean`.



---

archive/issue_comments_448180.json:
```json
{
    "body": "namely, the following is the fix:\n\n```diff\n--- a/build/pkgs/brial/spkg-configure.m4\n+++ b/build/pkgs/brial/spkg-configure.m4\n@@ -1,6 +1,6 @@\n SAGE_SPKG_CONFIGURE([brial], [\n   dnl Trac #31624: Avoid C++ ABI issues\n-  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [\n+  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [\n     # If we're using the system m4ri and boost, ensure that we can\n     # compile and run an executable linked against both libbrial and\n     # libbrial_groebner (both are used by SageMath).\n```\n\n\nI'll open another ticket for this.",
    "created_at": "2021-05-28T15:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448180",
    "user": "dimpase"
}
```

namely, the following is the fix:

```diff
--- a/build/pkgs/brial/spkg-configure.m4
+++ b/build/pkgs/brial/spkg-configure.m4
@@ -1,6 +1,6 @@
 SAGE_SPKG_CONFIGURE([brial], [
   dnl Trac #31624: Avoid C++ ABI issues
-  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [
+  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [
     # If we're using the system m4ri and boost, ensure that we can
     # compile and run an executable linked against both libbrial and
     # libbrial_groebner (both are used by SageMath).
```


I'll open another ticket for this.



---

archive/issue_comments_448181.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> namely, the following is the fix:\n> {{{#!diff\n> --- a/build/pkgs/brial/spkg-configure.m4\n> +++ b/build/pkgs/brial/spkg-configure.m4\n> `@``@` -1,6 +1,6 `@``@`\n>  SAGE_SPKG_CONFIGURE([brial], [\n>    dnl Trac #31624: Avoid C++ ABI issues\n> -  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [\n> +  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [\n>      # If we're using the system m4ri and boost, ensure that we can\n>      # compile and run an executable linked against both libbrial and\n>      # libbrial_groebner (both are used by SageMath).\n> }}}\n> \n> I'll open another ticket for this.\n\nfixed by #31871",
    "created_at": "2021-05-28T16:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31338",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31338#issuecomment-448181",
    "user": "dimpase"
}
```

Replying to [comment:19 dimpase]:
> namely, the following is the fix:
> {{{#!diff
> --- a/build/pkgs/brial/spkg-configure.m4
> +++ b/build/pkgs/brial/spkg-configure.m4
> `@``@` -1,6 +1,6 `@``@`
>  SAGE_SPKG_CONFIGURE([brial], [
>    dnl Trac #31624: Avoid C++ ABI issues
> -  SAGE_SPKG_DEPCHECK([gcc boost m4ri], [
> +  SAGE_SPKG_DEPCHECK([gcc boost_cropped m4ri], [
>      # If we're using the system m4ri and boost, ensure that we can
>      # compile and run an executable linked against both libbrial and
>      # libbrial_groebner (both are used by SageMath).
> }}}
> 
> I'll open another ticket for this.

fixed by #31871
