# Issue 29466: Upgrade gcc to latest 9.x, fix --without-system-gcc builds

archive/issues_029466.json:
```json
{
    "body": "CC:  @zlscherr @jhpalmieri @dimpase @vbraun @kiwifb @enriqueartal\n\nFollow-up from #29674 (fedora-32: If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10). As noted there, on many systems, building `--without-system-gcc` fails.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29703\n\n",
    "created_at": "2020-05-17T18:22:27Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Upgrade gcc to latest 9.x, fix --without-system-gcc builds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29466",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @zlscherr @jhpalmieri @dimpase @vbraun @kiwifb @enriqueartal

Follow-up from #29674 (fedora-32: If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10). As noted there, on many systems, building `--without-system-gcc` fails.

Issue created by migration from https://trac.sagemath.org/ticket/29703





---

archive/issue_events_075953.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75953"
}
```



---

archive/issue_events_075954.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75954"
}
```



---

archive/issue_events_075955.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75955"
}
```



---

archive/issue_comments_417735.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417735",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_417736.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-05-03T17:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417736",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_417737.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-03T18:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417737",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_417738.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-03T18:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417738",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_events_075956.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-03T18:16:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75956"
}
```



---

archive/issue_events_075957.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-03T18:16:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75957"
}
```



---

archive/issue_comments_417739.json:
```json
{
    "body": "local build (with `make gcc`) fails on `homebrew-macos`\n\n```\nIn file included from ../../src/gcc/gengtype.c:26:\n../../src/gcc/system.h:544:20: error: conflicting declaration of C function 'const char* strsignal(int)'\n  544 | extern const char *strsignal (int);\n      |                    ^~~~~~~~~\nIn file included from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/gcc-10.3.0/gcc-build/prev-x86_64-apple-darwin19.6.0/libstdc++-v3/include/cstring:42,\n                 from ../../src/gcc/system.h:235,\n                 from ../../src/gcc/gengtype.c:26:\n/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/string.h:134:7: note: previous declaration 'char* strsignal(int)'\n  134 | char *strsignal(int __sig);\n      |       ^~~~~~~~~\nmake[6]: *** [build/sort.o] Error 1\nmake[6]: *** [build/gengtype-parse.o] Error 1\nmake[6]: *** [build/gengenrtl.o] Error 1\n```\n\n\nBut it did not work with the previous version either.",
    "created_at": "2021-05-06T16:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417739",
    "user": "https://github.com/mkoeppe"
}
```

local build (with `make gcc`) fails on `homebrew-macos`

```
In file included from ../../src/gcc/gengtype.c:26:
../../src/gcc/system.h:544:20: error: conflicting declaration of C function 'const char* strsignal(int)'
  544 | extern const char *strsignal (int);
      |                    ^~~~~~~~~
In file included from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/gcc-10.3.0/gcc-build/prev-x86_64-apple-darwin19.6.0/libstdc++-v3/include/cstring:42,
                 from ../../src/gcc/system.h:235,
                 from ../../src/gcc/gengtype.c:26:
/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/string.h:134:7: note: previous declaration 'char* strsignal(int)'
  134 | char *strsignal(int __sig);
      |       ^~~~~~~~~
make[6]: *** [build/sort.o] Error 1
make[6]: *** [build/gengtype-parse.o] Error 1
make[6]: *** [build/gengenrtl.o] Error 1
```


But it did not work with the previous version either.



---

archive/issue_comments_417740.json:
```json
{
    "body": "Looking fine for Linux and macOS (`-minimal` configurations where we build `gfortran` from the spkg) - https://github.com/mkoeppe/sage/runs/2494424419",
    "created_at": "2021-05-06T17:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417740",
    "user": "https://github.com/mkoeppe"
}
```

Looking fine for Linux and macOS (`-minimal` configurations where we build `gfortran` from the spkg) - https://github.com/mkoeppe/sage/runs/2494424419



---

archive/issue_comments_417741.json:
```json
{
    "body": "However, this upgrade does NOT fix #31624 (fedora-34-standard: eclib, singular build failures with system ntl). https://github.com/mkoeppe/sage/runs/2494425736\n\nSo there is no urgency to this upgrade.",
    "created_at": "2021-05-06T18:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417741",
    "user": "https://github.com/mkoeppe"
}
```

However, this upgrade does NOT fix #31624 (fedora-34-standard: eclib, singular build failures with system ntl). https://github.com/mkoeppe/sage/runs/2494425736

So there is no urgency to this upgrade.



---

archive/issue_events_075958.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-06T18:21:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75958"
}
```



---

archive/issue_events_075959.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-06T18:21:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75959"
}
```



---

archive/issue_comments_417742.json:
```json
{
    "body": "... unless this helps with Big Sur?",
    "created_at": "2021-05-06T18:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417742",
    "user": "https://github.com/mkoeppe"
}
```

... unless this helps with Big Sur?



---

archive/issue_comments_417743.json:
```json
{
    "body": "let's not duplicate the efforts of Homebree and Conda...",
    "created_at": "2021-05-06T20:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417743",
    "user": "https://github.com/dimpase"
}
```

let's not duplicate the efforts of Homebree and Conda...



---

archive/issue_comments_417744.json:
```json
{
    "body": "In any case... needs review",
    "created_at": "2021-05-07T17:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417744",
    "user": "https://github.com/mkoeppe"
}
```

In any case... needs review



---

archive/issue_comments_417745.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-08T09:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417745",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_417746.json:
```json
{
    "body": "good to get rid of patches.",
    "created_at": "2021-05-08T09:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417746",
    "user": "https://github.com/dimpase"
}
```

good to get rid of patches.



---

archive/issue_comments_417747.json:
```json
{
    "body": "Thanks",
    "created_at": "2021-05-08T15:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417747",
    "user": "https://github.com/mkoeppe"
}
```

Thanks



---

archive/issue_comments_417748.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> let's not duplicate the efforts of Homebree and Conda...\n\n\nAnd here we go. Our Sage 9.3 does not build with Big Sur / Homebrew - as just reported https://groups.google.com/g/sage-devel/c/Yut08rvqgvg/m/9uD4W6hFBAAJ",
    "created_at": "2021-05-10T18:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417748",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:19 dimpase]:
> let's not duplicate the efforts of Homebree and Conda...


And here we go. Our Sage 9.3 does not build with Big Sur / Homebrew - as just reported https://groups.google.com/g/sage-devel/c/Yut08rvqgvg/m/9uD4W6hFBAAJ



---

archive/issue_comments_417749.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-05-10T19:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417749",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_417750.json:
```json
{
    "body": "we need a  proper formula for building Sage using Homebrew, then we can pin versions of dependencies etc.",
    "created_at": "2021-05-10T20:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417750",
    "user": "https://github.com/dimpase"
}
```

we need a  proper formula for building Sage using Homebrew, then we can pin versions of dependencies etc.



---

archive/issue_comments_417751.json:
```json
{
    "body": "Downstream packaging is traditionally considered not part of the upstream project. But if you want to work on it, this would certainly be valuable to some mac users. But lots of packages are missing on homebrew, so you'd be ... duplicating packaging work that has already been done in conda-forge.",
    "created_at": "2021-05-10T20:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417751",
    "user": "https://github.com/mkoeppe"
}
```

Downstream packaging is traditionally considered not part of the upstream project. But if you want to work on it, this would certainly be valuable to some mac users. But lots of packages are missing on homebrew, so you'd be ... duplicating packaging work that has already been done in conda-forge.



---

archive/issue_events_075960.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29466#event-75960"
}
```



---

archive/issue_comments_417752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29466#issuecomment-417752",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
