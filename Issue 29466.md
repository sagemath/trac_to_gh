# Issue 29466: Upgrade gcc to latest 9.x, fix --without-system-gcc builds

Issue created by migration from https://trac.sagemath.org/ticket/29703

Original creator: mkoeppe

Original creation time: 2020-05-17 18:22:27

CC:  @zlscherr jhpalmieri dimpase vbraun fbissey enriqueartal

Follow-up from #29674 (fedora-32: If gcc 10 is found, install gcc spkg; fix building gcc (9.2.0) spkg with gcc 10). As noted there, on many systems, building `--without-system-gcc` fails.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-05-03 17:45:56

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-05-03 18:12:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-05-03 18:12:55

New commits:


---

Comment by mkoeppe created at 2021-05-06 16:59:45

local build (with `make gcc`) fails on `homebrew-macos`

```
In file included from ../../src/gcc/gengtype.c:26:
../../src/gcc/system.h:544:20: error: conflicting declaration of C function 'const char* strsignal(int)'
  544 | extern const char *strsignal (int);
      |                    ^~~~~~~~~
In file included from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/gcc-10.3.0/gcc-build/prev-x86_64-apple-darwin19.6.0/libstdc++-v3/include/cstring:42,
                 from ../../src/gcc/system.h:235,
                 from ../../src/gcc/gengtype.c:26:
/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/string.h:134:7: note: previous declaration 'char* strsignal(int)'
  134 | char *strsignal(int __sig);
      |       ^~~~~~~~~
make[6]: *** [build/sort.o] Error 1
make[6]: *** [build/gengtype-parse.o] Error 1
make[6]: *** [build/gengenrtl.o] Error 1
```


But it did not work with the previous version either.


---

Comment by mkoeppe created at 2021-05-06 17:07:42

Looking fine for Linux and macOS (`-minimal` configurations where we build `gfortran` from the spkg) - https://github.com/mkoeppe/sage/runs/2494424419


---

Comment by mkoeppe created at 2021-05-06 18:21:27

Changing priority from critical to major.


---

Comment by mkoeppe created at 2021-05-06 18:21:27

However, this upgrade does NOT fix #31624 (fedora-34-standard: eclib, singular build failures with system ntl). https://github.com/mkoeppe/sage/runs/2494425736

So there is no urgency to this upgrade.


---

Comment by mkoeppe created at 2021-05-06 18:22:17

... unless this helps with Big Sur?


---

Comment by dimpase created at 2021-05-06 20:27:42

let's not duplicate the efforts of Homebree and Conda...


---

Comment by mkoeppe created at 2021-05-07 17:04:29

In any case... needs review


---

Comment by dimpase created at 2021-05-08 09:17:21

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-05-08 09:17:21

good to get rid of patches.


---

Comment by mkoeppe created at 2021-05-08 15:47:42

Thanks


---

Comment by mkoeppe created at 2021-05-10 18:58:24

Replying to [comment:19 dimpase]:
> let's not duplicate the efforts of Homebree and Conda...


And here we go. Our Sage 9.3 does not build with Big Sur / Homebrew - as just reported https://groups.google.com/g/sage-devel/c/Yut08rvqgvg/m/9uD4W6hFBAAJ


---

Comment by mkoeppe created at 2021-05-10 19:06:21

Changing priority from major to blocker.


---

Comment by dimpase created at 2021-05-10 20:07:25

we need a  proper formula for building Sage using Homebrew, then we can pin versions of dependencies etc.


---

Comment by mkoeppe created at 2021-05-10 20:16:42

Downstream packaging is traditionally considered not part of the upstream project. But if you want to work on it, this would certainly be valuable to some mac users. But lots of packages are missing on homebrew, so you'd be ... duplicating packaging work that has already been done in conda-forge.


---

Comment by vbraun created at 2021-05-27 20:30:19

Resolution: fixed
