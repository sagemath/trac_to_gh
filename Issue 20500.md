# Issue 20500: Use of representative_prime may fail in finding semi-global minimal models of elliptic curves

archive/issues_020500.json:
```json
{
    "body": "Keywords: global minimal model\n\nWhen an elliptic curve E defined over a number field has no global minimal model, the obstruction is a non-trivial ideal class and E.global_minimal_model(semi_global=True) finds a prime ideal in that class and returns a model minimal at all primes but that one.  However the line in kraus.py (line 916) does that using {{{P = c.representative_prime()}} which can fail since by default only primes of norm up to 1000 are tested, as that is the default value of the parameter norm_bound of representative_prime().\n\nExample (an elliptic curve with everywhere good reduction over an imaginary quadratic field of class number 3315):\n\n```\nsage: K.<a> = NumberField(x^2-x+31821453)\nsage: ainvs = (0, 0, 0, -382586771000351226384*a - 2498023791133552294513515, 358777608829102441023422458989\n744*a + 1110881475104109582383304709231832166)\nsage: E = EllipticCurve(ainvs)\nsage: assert E.conductor().norm() == 1\nsage: E.global_minimal_model(semi_global=True)\n<boom>\nRuntimeError: No prime of norm less than 1000 found in class Fractional ideal class (1569, a + 867)\n```\n\nExperiment with this example shows that the smallest prime in that class has norm 23567.\n\nThe obvious solution is to keep doubling the bound until success.  The ideal in the error message has norm 1569 and is a product of two primes so could be used instead but then the model returned would not be \"semi-global\" in the above sense.\n\nWhatever is decided, the semi-global=True option (which is not the default) should not cause a run-time error.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20737\n\n",
    "created_at": "2016-05-31T19:41:02Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "title": "Use of representative_prime may fail in finding semi-global minimal models of elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20500",
    "user": "cremona"
}
```
Keywords: global minimal model

When an elliptic curve E defined over a number field has no global minimal model, the obstruction is a non-trivial ideal class and E.global_minimal_model(semi_global=True) finds a prime ideal in that class and returns a model minimal at all primes but that one.  However the line in kraus.py (line 916) does that using {{{P = c.representative_prime()}} which can fail since by default only primes of norm up to 1000 are tested, as that is the default value of the parameter norm_bound of representative_prime().

Example (an elliptic curve with everywhere good reduction over an imaginary quadratic field of class number 3315):

```
sage: K.<a> = NumberField(x^2-x+31821453)
sage: ainvs = (0, 0, 0, -382586771000351226384*a - 2498023791133552294513515, 358777608829102441023422458989
744*a + 1110881475104109582383304709231832166)
sage: E = EllipticCurve(ainvs)
sage: assert E.conductor().norm() == 1
sage: E.global_minimal_model(semi_global=True)
<boom>
RuntimeError: No prime of norm less than 1000 found in class Fractional ideal class (1569, a + 867)
```

Experiment with this example shows that the smallest prime in that class has norm 23567.

The obvious solution is to keep doubling the bound until success.  The ideal in the error message has norm 1569 and is a product of two primes so could be used instead but then the model returned would not be "semi-global" in the above sense.

Whatever is decided, the semi-global=True option (which is not the default) should not cause a run-time error.


Issue created by migration from https://trac.sagemath.org/ticket/20737





---

archive/issue_comments_283028.json:
```json
{
    "body": "This fixes the problem by calling the representative_prime function with an explicit bound and repeatedly increaisng the bound until success.  It might be preferable to rewrite the representative_prime method on ideal classes to allow (in effect) bound=Infinity, but that can be done elsewhere.\n\nI added a new test with the example given here, but it takes 15s to find the prime so the test is tagged with # long time.\n----\nNew commits:",
    "created_at": "2016-10-24T08:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283028",
    "user": "cremona"
}
```

This fixes the problem by calling the representative_prime function with an explicit bound and repeatedly increaisng the bound until success.  It might be preferable to rewrite the representative_prime method on ideal classes to allow (in effect) bound=Infinity, but that can be done elsewhere.

I added a new test with the example given here, but it takes 15s to find the prime so the test is tagged with # long time.
----
New commits:



---

archive/issue_comments_283029.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-24T08:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283029",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_283030.json:
```json
{
    "body": "There are currently 2 patchbot report for this ticket:  one says that all tests pass but that some plugin gailed (what's that?).  the other says that a test failed but this is bogus, just some file being tested timed out for reasons nothing to do with this ticket.\n\nBut I am guessing that the negative reports will prevent a uman with some intelligence looking at this.  Not good!",
    "created_at": "2016-10-26T19:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283030",
    "user": "cremona"
}
```

There are currently 2 patchbot report for this ticket:  one says that all tests pass but that some plugin gailed (what's that?).  the other says that a test failed but this is bogus, just some file being tested timed out for reasons nothing to do with this ticket.

But I am guessing that the negative reports will prevent a uman with some intelligence looking at this.  Not good!



---

archive/issue_comments_283031.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-06T01:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283031",
    "user": "wuthrich"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_283032.json:
```json
{
    "body": "All fine. Tests pass and even the patchbot is fully happy.\n\nThe new test is a bit long, but I can't see a way to make that faster and I agree that a test for this should be added.",
    "created_at": "2016-11-06T01:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283032",
    "user": "wuthrich"
}
```

All fine. Tests pass and even the patchbot is fully happy.

The new test is a bit long, but I can't see a way to make that faster and I agree that a test for this should be added.



---

archive/issue_comments_283033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-07T18:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20500#issuecomment-283033",
    "user": "vbraun"
}
```

Resolution: fixed
