# Issue 20872: Faster meet() for lattice

archive/issues_020872.json:
```json
{
    "body": "CC:  chapoton\n\nKeywords: latticeposet\n\nThis trivial patch will speed up computation of meet matrix in lattices. Before:\n\n\n```\nsage: P = Posets.BooleanLattice(10)\nsage: timeit(\"_ = P._hasse_diagram._meet\", repeat=1, number=1)\n1 loops, best of 1: 2.24 s per loop\n```\n\n\nAfter:\n\n\n```\nsage: P = Posets.BooleanLattice(10)\nsage: timeit(\"_ = P._hasse_diagram._meet\", repeat=1, number=1)\n1 loops, best of 1: 917 ms per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21109\n\n",
    "created_at": "2016-07-28T08:06:16Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Faster meet() for lattice",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20872",
    "user": "jmantysalo"
}
```
CC:  chapoton

Keywords: latticeposet

This trivial patch will speed up computation of meet matrix in lattices. Before:


```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 2.24 s per loop
```


After:


```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 917 ms per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/21109





---

archive/issue_comments_288581.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-28T08:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288581",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288582.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-07-28T08:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288582",
    "user": "jmantysalo"
}
```

New commits:



---

archive/issue_comments_288583.json:
```json
{
    "body": "I have some questions:\n\nI do not understand the comment `# T = {x_i \\wedge z : z>-x_k`}\nWhat is the meaning of `>-` ?\n\nDoes lc stands for \"lower covers\" ? if yes, that would be worth to say in a comment\n\nCould you take the opportunity to make the method fully pep8 compliant ? only the line\n\n```\nraise ValueError(\"No meet for x=%s y=%s\"%(x,y))\n```\n\nmust be changed to\n\n```\nraise ValueError(\"No meet for x=%s y=%s\" % (x, y))\n```\n",
    "created_at": "2016-07-28T16:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288583",
    "user": "chapoton"
}
```

I have some questions:

I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
What is the meaning of `>-` ?

Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment

Could you take the opportunity to make the method fully pep8 compliant ? only the line

```
raise ValueError("No meet for x=%s y=%s"%(x,y))
```

must be changed to

```
raise ValueError("No meet for x=%s y=%s" % (x, y))
```




---

archive/issue_comments_288584.json:
```json
{
    "body": "Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?",
    "created_at": "2016-07-28T19:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288584",
    "user": "tscrim"
}
```

Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?



---

archive/issue_comments_288585.json:
```json
{
    "body": "Changing keywords from \"latticeposet\" to \"lattice poset\".",
    "created_at": "2016-07-29T01:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288585",
    "user": "tscrim"
}
```

Changing keywords from "latticeposet" to "lattice poset".



---

archive/issue_comments_288586.json:
```json
{
    "body": "If you haven't, just let me know, and I can run the tests.",
    "created_at": "2016-07-29T01:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288586",
    "user": "tscrim"
}
```

If you haven't, just let me know, and I can run the tests.



---

archive/issue_comments_288587.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-29T05:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288587",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288588.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?\n\nIt is very hard to think an example where my code would be slower. This references to a python dict, whereas current code references to a matrix; referencing to matrix elements in a loop is slow. And that matrix must be precomputed first. You can test what happens if you compute le-matrix first (assuming that the user has, say, computed M\u00f6bius function matrix), but there will still be speedup.\n\nI added another example to description.",
    "created_at": "2016-07-29T05:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288588",
    "user": "jmantysalo"
}
```

Replying to [comment:4 tscrim]:
> Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?

It is very hard to think an example where my code would be slower. This references to a python dict, whereas current code references to a matrix; referencing to matrix elements in a loop is slow. And that matrix must be precomputed first. You can test what happens if you compute le-matrix first (assuming that the user has, say, computed MÃ¶bius function matrix), but there will still be speedup.

I added another example to description.



---

archive/issue_comments_288589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-29T05:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288589",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288590.json:
```json
{
    "body": "Replying to [comment:3 chapoton]:\n\n> Could you take the opportunity to make the method fully pep8 compliant ? only the line\n> {{{\n> raise ValueError(\"No meet for x=%s y=%s\"%(x,y))\n> }}}\n> must be changed to\n> {{{\n> raise ValueError(\"No meet for x=%s y=%s\" % (x, y))\n> }}}\n\nChanged. Then there is the error message formatting question... Python exceptions start with lowercase and do not end to a period. But this has been discussed in sage-devel without clear conclusion.\n\n> I do not understand the comment `# T = {x_i \\wedge z : z>-x_k`}\n> What is the meaning of `>-` ?\n\nI guess it has meant covering. I removed it.\n\n> Does lc stands for \"lower covers\" ? if yes, that would be worth to say in a comment\n\nDone.",
    "created_at": "2016-07-29T05:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288590",
    "user": "jmantysalo"
}
```

Replying to [comment:3 chapoton]:

> Could you take the opportunity to make the method fully pep8 compliant ? only the line
> {{{
> raise ValueError("No meet for x=%s y=%s"%(x,y))
> }}}
> must be changed to
> {{{
> raise ValueError("No meet for x=%s y=%s" % (x, y))
> }}}

Changed. Then there is the error message formatting question... Python exceptions start with lowercase and do not end to a period. But this has been discussed in sage-devel without clear conclusion.

> I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
> What is the meaning of `>-` ?

I guess it has meant covering. I removed it.

> Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment

Done.



---

archive/issue_comments_288591.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-29T05:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288591",
    "user": "jmantysalo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288592.json:
```json
{
    "body": "rc0 is out.",
    "created_at": "2016-07-29T08:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288592",
    "user": "jmantysalo"
}
```

rc0 is out.



---

archive/issue_comments_288593.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-29T18:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288593",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288594.json:
```json
{
    "body": "ok, looks good enough. Thanks",
    "created_at": "2016-07-29T18:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288594",
    "user": "chapoton"
}
```

ok, looks good enough. Thanks



---

archive/issue_comments_288595.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-10T22:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20872#issuecomment-288595",
    "user": "vbraun"
}
```

Resolution: fixed
