# Issue 20872: Faster meet() for lattice

Issue created by migration from https://trac.sagemath.org/ticket/21109

Original creator: jmantysalo

Original creation time: 2016-07-28 08:06:16

CC:  chapoton

Keywords: latticeposet

This trivial patch will speed up computation of meet matrix in lattices. Before:


```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 2.24 s per loop
```


After:


```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 917 ms per loop
```



---

Comment by jmantysalo created at 2016-07-28 08:07:08

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2016-07-28 08:07:08

New commits:


---

Comment by chapoton created at 2016-07-28 16:55:04

I have some questions:

I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
What is the meaning of `>-` ?

Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment

Could you take the opportunity to make the method fully pep8 compliant ? only the line

```
raise ValueError("No meet for x=%s y=%s"%(x,y))
```

must be changed to

```
raise ValueError("No meet for x=%s y=%s" % (x, y))
```



---

Comment by tscrim created at 2016-07-28 19:47:54

Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?


---

Comment by tscrim created at 2016-07-29 01:50:57

Changing keywords from "latticeposet" to "lattice poset".


---

Comment by tscrim created at 2016-07-29 01:50:57

If you haven't, just let me know, and I can run the tests.


---

Comment by jmantysalo created at 2016-07-29 05:36:06

Changing status from needs_review to needs_work.


---

Comment by jmantysalo created at 2016-07-29 05:40:40

Replying to [comment:4 tscrim]:
> Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?

It is very hard to think an example where my code would be slower. This references to a python dict, whereas current code references to a matrix; referencing to matrix elements in a loop is slow. And that matrix must be precomputed first. You can test what happens if you compute le-matrix first (assuming that the user has, say, computed MÃ¶bius function matrix), but there will still be speedup.

I added another example to description.


---

Comment by git created at 2016-07-29 05:44:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-07-29 05:51:23

Replying to [comment:3 chapoton]:

> Could you take the opportunity to make the method fully pep8 compliant ? only the line
> {{{
> raise ValueError("No meet for x=%s y=%s"%(x,y))
> }}}
> must be changed to
> {{{
> raise ValueError("No meet for x=%s y=%s" % (x, y))
> }}}

Changed. Then there is the error message formatting question... Python exceptions start with lowercase and do not end to a period. But this has been discussed in sage-devel without clear conclusion.

> I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
> What is the meaning of `>-` ?

I guess it has meant covering. I removed it.

> Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment

Done.


---

Comment by jmantysalo created at 2016-07-29 05:51:23

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2016-07-29 08:05:21

rc0 is out.


---

Comment by chapoton created at 2016-07-29 18:15:24

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-07-29 18:15:24

ok, looks good enough. Thanks


---

Comment by vbraun created at 2016-08-10 22:27:17

Resolution: fixed
