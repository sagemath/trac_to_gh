# Issue 27212: py3: fix all doctests in schemes/product_projective

Issue created by migration from https://trac.sagemath.org/ticket/27449

Original creator: chapoton

Original creation time: 2019-03-09 13:17:47

by adding a missing `__len__` method.

plus some light code cleanup.


---

Comment by chapoton created at 2019-03-09 13:18:11

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-03-09 13:18:11

New commits:


---

Comment by chapoton created at 2019-03-09 16:38:04

green bot, please review


---

Comment by tscrim created at 2019-03-09 21:29:03

It turns out that it is actually faster to do a `yield` statement in Python2 than give a generator object back for a single list:

```
sage: def gen(n):
....:     return (x for x in range(n))
sage: def it(n):
....:     for x in range(n):
....:         yield x
sage: %timeit len(list(gen(5)))
1000000 loops, best of 3: 1.15 µs per loop
sage: %timeit len(list(it(5)))
1000000 loops, best of 3: 1.05 µs per loop

sage: %timeit len(list(gen(100)))
100000 loops, best of 3: 5.18 µs per loop
sage: %timeit len(list(it(100)))
100000 loops, best of 3: 4.64 µs per loop

sage: %timeit len(list(gen(10000)))
1000 loops, best of 3: 402 µs per loop
sage: %timeit len(list(it(10000)))
1000 loops, best of 3: 385 µs per loop
```

For a double, there ends up being not much noticable difference:

```
sage: def gen(n):
....:     return (x*y for x in range(n) for y in range(n))
sage: def it(n):
....:     for x in range(n):
....:         for y in range(n):
....:             yield x*y
sage: %timeit len(list(gen(5)))
100000 loops, best of 3: 3.56 µs per loop
sage: %timeit len(list(it(5)))
100000 loops, best of 3: 3.41 µs per loop
sage: %timeit len(list(gen(100)))
1000 loops, best of 3: 530 µs per loop
sage: %timeit len(list(it(100)))
1000 loops, best of 3: 534 µs per loop
```

I am not saying that anything needs to be changed (I actually like the simplicity of returning the generator), just pointing out some timings (this probably does not need to be super optimized anyways).

So LGTM.


---

Comment by tscrim created at 2019-03-09 21:39:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-11 22:42:05

Resolution: fixed
