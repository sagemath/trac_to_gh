# Issue 17603: Factorization of multivariate polynomials over the integers

Issue created by migration from Trac.

Original creator: bruno

Original creation time: 2015-02-23 14:00:17

Keywords: multivariate integer polynomial

Currently, Sage does not know how to factor multivariate polynomials over the integers:


```python
sage: R.<x,y> = ZZ[]
sage: p = 12 * (x*y - 1) * (x + 2*y + 3)
sage: p.factor()
Traceback (most recent call last):
...
NotImplementedError: Factorization of multivariate polynomials over non-fields is not implemented.
```


I propose to implement it using the factorization over `QQ`. Of course it may not be the best possible solution, but at least it is some (temporary?) workaround. This now gives:


```python
sage: R.<x,y> = ZZ[]
sage: p = 12 * (x*y - 1) * (x + 2*y + 3)
sage: p.factor()
2^2 * 3 * (x + 2*y + 3) * (x*y - 1)
```



---

Comment by bruno created at 2015-02-23 14:10:21

New commits:


---

Comment by bruno created at 2015-02-23 14:10:21

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-02-23 14:19:08

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-02-23 14:19:08

Add a doctest with a negative sign to show that signs are preserved.


---

Comment by git created at 2015-02-23 19:33:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-02-23 19:34:22

Replying to [comment:3 jdemeyer]:
> Add a doctest with a negative sign to show that signs are preserved.

They were not! Thanks for spotting this `:-)`.


---

Comment by bruno created at 2015-02-23 19:34:22

Changing status from needs_work to needs_review.


---

Comment by bruno created at 2015-02-23 20:35:34

I have a question: Since the computation for non-fields is enclosed inside a `try`/`except` construction, if a computation is long and interrupted with `Ctrl+c`, a `KeyboardInterrupt` exception is raised and caught by the `except` to raise a `NotImplementedError` exception.

What is a correct solution so that it does not return `NotImplementedError`? 

* Should the `KeyboardInterrupt` exception be filtered?
* Should the `try`/`except` be enclosed in `sig_on()`/`sig_off()`?
* Something else?


---

Comment by jdemeyer created at 2015-02-24 09:40:27

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-02-24 09:40:27

Use `except Exception:` instead of a bare `except:`


---

Comment by git created at 2015-02-24 09:55:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-02-24 09:55:56

Replying to [comment:7 jdemeyer]:
> Use `except Exception:` instead of a bare `except:`

Thank you!


---

Comment by bruno created at 2015-02-24 09:55:56

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-02-24 14:09:15

You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).


---

Comment by jdemeyer created at 2015-02-24 14:09:29

Changing status from needs_review to needs_work.


---

Comment by bruno created at 2015-02-24 14:54:25

Replying to [comment:10 jdemeyer]:
> You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).

Actually, polynomials over the ring of integers of a number field belong to the class `MPolynomial_polydict` (defined in `multi_polynomial_element.py`) and not to `MPolynomial_libsingular` (defined in `multi_polynomial_libsingular.pyx`). So it does not make sense to test this in this file.ยน

It would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.

ยน One may do the same thing for rings of integers of a number field to obtain a factorization algorithm. The point is that the returned factors are not in the rings of integers in this case, so we have to reconstruct them. It's a bit more work than in the current case.


---

Comment by git created at 2015-02-27 10:25:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-02-27 10:29:56

Replying to [comment:12 bruno]:
> It would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.

I haven't been able to find a non-field integral domain `D`, different from `ZZ`, such that `D['x','y']` belongs to `MPolynomial_libsingular`. So I add a doctest for `Zmod(4)['x','y']` for which the factorization indeed fails.


---

Comment by bruno created at 2015-02-27 10:29:56

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-03-23 18:45:37

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-03-23 18:45:37

Some comments:

1. Replace `raise Exception, "Message."` by `raise Exception("message")`.

2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.

3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.

4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says "factorization of multivariate polynomials is not supported, use multivariate polynomials instead".


---

Comment by git created at 2015-03-25 14:18:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-03-25 14:27:02

Changing status from needs_work to needs_review.


---

Comment by bruno created at 2015-03-25 14:27:02

Replying to [comment:15 jdemeyer]:

> 1. Replace `raise Exception, "Message."` by `raise Exception("message")`.
Done.

> 2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.
> 3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.

These both tests were not really needed. I added them in order to give more meaningful error messages. Now, the error message for the `SymbolicRing` is kind of weird, but the test I added was probably not the right place where to correct this.ยน 

For non-integral domains, you know have that `multivariate factorization over Ring of integers modulo 4 is not implemented` (for instance) while with the previous version it said that the factorization over non-integral rings is not implemented. I personally find the previous message more informative, but that is a matter of taste and I am also fine with the current message.


> 4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says "factorization of multivariate polynomials is not supported, use multivariate polynomials instead".
Not relevant anymore, though I agree with the confusing aspect of this message!

ยน The main problem is that the `SymbolicRing` has no `is_finite()` method. Thus we get a `NotImplementedError` which is not very informative. See #18054.


---

Comment by mmezzarobba created at 2015-04-13 16:23:21

Related: #2179


---

Comment by bruno created at 2015-04-22 13:43:42

It seems that the code proposed in #2179 is not in its current form ready to use (based on his author's comments). There was supposed to be some improved version, but since it is already 7 years old, we should maybe ignore it for now?


---

Comment by mmezzarobba created at 2015-04-22 15:10:03

Yes, probably, I was only pointing out the other ticket just in case there was something relevant there.


---

Comment by jdemeyer created at 2015-05-24 09:47:32

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-05-24 09:47:32

New commits:


---

Comment by vbraun created at 2015-05-25 07:29:53

Resolution: fixed


---

Comment by chapoton created at 2016-04-15 07:47:03

see #20435 for something going wrong
