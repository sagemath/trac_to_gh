# Issue 17603: Factorization of multivariate polynomials over the integers

archive/issues_017603.json:
```json
{
    "body": "Keywords: multivariate integer polynomial\n\nCurrently, Sage does not know how to factor multivariate polynomials over the integers:\n\n\n```python\nsage: R.<x,y> = ZZ[]\nsage: p = 12 * (x*y - 1) * (x + 2*y + 3)\nsage: p.factor()\nTraceback (most recent call last):\n...\nNotImplementedError: Factorization of multivariate polynomials over non-fields is not implemented.\n```\n\n\nI propose to implement it using the factorization over `QQ`. Of course it may not be the best possible solution, but at least it is some (temporary?) workaround. This now gives:\n\n\n```python\nsage: R.<x,y> = ZZ[]\nsage: p = 12 * (x*y - 1) * (x + 2*y + 3)\nsage: p.factor()\n2^2 * 3 * (x + 2*y + 3) * (x*y - 1)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17840\n\n",
    "created_at": "2015-02-23T14:00:17Z",
    "labels": [
        "component: factorization"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Factorization of multivariate polynomials over the integers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17603",
    "user": "https://github.com/bgrenet"
}
```
Keywords: multivariate integer polynomial

Currently, Sage does not know how to factor multivariate polynomials over the integers:


```python
sage: R.<x,y> = ZZ[]
sage: p = 12 * (x*y - 1) * (x + 2*y + 3)
sage: p.factor()
Traceback (most recent call last):
...
NotImplementedError: Factorization of multivariate polynomials over non-fields is not implemented.
```


I propose to implement it using the factorization over `QQ`. Of course it may not be the best possible solution, but at least it is some (temporary?) workaround. This now gives:


```python
sage: R.<x,y> = ZZ[]
sage: p = 12 * (x*y - 1) * (x + 2*y + 3)
sage: p.factor()
2^2 * 3 * (x + 2*y + 3) * (x*y - 1)
```


Issue created by migration from https://trac.sagemath.org/ticket/17840





---

archive/issue_comments_234813.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-23T14:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234813",
    "user": "https://github.com/bgrenet"
}
```

New commits:



---

archive/issue_comments_234814.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-23T14:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234814",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234815.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-23T14:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234815",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234816.json:
```json
{
    "body": "Add a doctest with a negative sign to show that signs are preserved.",
    "created_at": "2015-02-23T14:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234816",
    "user": "https://github.com/jdemeyer"
}
```

Add a doctest with a negative sign to show that signs are preserved.



---

archive/issue_comments_234817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-23T19:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234818.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> Add a doctest with a negative sign to show that signs are preserved.\n\nThey were not! Thanks for spotting this `:-)`.",
    "created_at": "2015-02-23T19:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234818",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:3 jdemeyer]:
> Add a doctest with a negative sign to show that signs are preserved.

They were not! Thanks for spotting this `:-)`.



---

archive/issue_comments_234819.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-23T19:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234819",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234820.json:
```json
{
    "body": "I have a question: Since the computation for non-fields is enclosed inside a `try`/`except` construction, if a computation is long and interrupted with `Ctrl+c`, a `KeyboardInterrupt` exception is raised and caught by the `except` to raise a `NotImplementedError` exception.\n\nWhat is a correct solution so that it does not return `NotImplementedError`? \n\n* Should the `KeyboardInterrupt` exception be filtered?\n* Should the `try`/`except` be enclosed in `sig_on()`/`sig_off()`?\n* Something else?",
    "created_at": "2015-02-23T20:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234820",
    "user": "https://github.com/bgrenet"
}
```

I have a question: Since the computation for non-fields is enclosed inside a `try`/`except` construction, if a computation is long and interrupted with `Ctrl+c`, a `KeyboardInterrupt` exception is raised and caught by the `except` to raise a `NotImplementedError` exception.

What is a correct solution so that it does not return `NotImplementedError`? 

* Should the `KeyboardInterrupt` exception be filtered?
* Should the `try`/`except` be enclosed in `sig_on()`/`sig_off()`?
* Something else?



---

archive/issue_comments_234821.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-24T09:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234821",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234822.json:
```json
{
    "body": "Use `except Exception:` instead of a bare `except:`",
    "created_at": "2015-02-24T09:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234822",
    "user": "https://github.com/jdemeyer"
}
```

Use `except Exception:` instead of a bare `except:`



---

archive/issue_comments_234823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-24T09:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234824.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Use `except Exception:` instead of a bare `except:`\n\nThank you!",
    "created_at": "2015-02-24T09:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234824",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:7 jdemeyer]:
> Use `except Exception:` instead of a bare `except:`

Thank you!



---

archive/issue_comments_234825.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-24T09:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234825",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234826.json:
```json
{
    "body": "You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).",
    "created_at": "2015-02-24T14:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234826",
    "user": "https://github.com/jdemeyer"
}
```

You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).



---

archive/issue_comments_234827.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-24T14:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234827",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234828.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).\n\nActually, polynomials over the ring of integers of a number field belong to the class `MPolynomial_polydict` (defined in `multi_polynomial_element.py`) and not to `MPolynomial_libsingular` (defined in `multi_polynomial_libsingular.pyx`). So it does not make sense to test this in this file.\u00b9\n\nIt would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.\n\n\u00b9 One may do the same thing for rings of integers of a number field to obtain a factorization algorithm. The point is that the returned factors are not in the rings of integers in this case, so we have to reconstruct them. It's a bit more work than in the current case.",
    "created_at": "2015-02-24T14:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234828",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:10 jdemeyer]:
> You should add an example where the factorisation currently fails (say, over the ring of integers of some number field).

Actually, polynomials over the ring of integers of a number field belong to the class `MPolynomial_polydict` (defined in `multi_polynomial_element.py`) and not to `MPolynomial_libsingular` (defined in `multi_polynomial_libsingular.pyx`). So it does not make sense to test this in this file.¹

It would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.

¹ One may do the same thing for rings of integers of a number field to obtain a factorization algorithm. The point is that the returned factors are not in the rings of integers in this case, so we have to reconstruct them. It's a bit more work than in the current case.



---

archive/issue_comments_234829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T10:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234830.json:
```json
{
    "body": "Replying to [comment:12 bruno]:\n> It would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.\n\nI haven't been able to find a non-field integral domain `D`, different from `ZZ`, such that `D['x','y']` belongs to `MPolynomial_libsingular`. So I add a doctest for `Zmod(4)['x','y']` for which the factorization indeed fails.",
    "created_at": "2015-02-27T10:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234830",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:12 bruno]:
> It would be interesting to have such an example of a non-working case. Though I do not know for which ring(s) do the polynomials belong to the class `MPolynomial_libsingular`.

I haven't been able to find a non-field integral domain `D`, different from `ZZ`, such that `D['x','y']` belongs to `MPolynomial_libsingular`. So I add a doctest for `Zmod(4)['x','y']` for which the factorization indeed fails.



---

archive/issue_comments_234831.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-27T10:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234831",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234832.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-23T18:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234832",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234833.json:
```json
{
    "body": "Some comments:\n\n1. Replace `raise Exception, \"Message.\"` by `raise Exception(\"message\")`.\n\n2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.\n\n3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.\n\n4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says \"factorization of multivariate polynomials is not supported, use multivariate polynomials instead\".",
    "created_at": "2015-03-23T18:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234833",
    "user": "https://github.com/jdemeyer"
}
```

Some comments:

1. Replace `raise Exception, "Message."` by `raise Exception("message")`.

2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.

3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.

4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says "factorization of multivariate polynomials is not supported, use multivariate polynomials instead".



---

archive/issue_comments_234834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T14:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234835.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-25T14:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234835",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234836.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n\n> 1. Replace `raise Exception, \"Message.\"` by `raise Exception(\"message\")`.\nDone.\n\n> 2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.\n> 3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.\n\nThese both tests were not really needed. I added them in order to give more meaningful error messages. Now, the error message for the `SymbolicRing` is kind of weird, but the test I added was probably not the right place where to correct this.\u00b9 \n\nFor non-integral domains, you know have that `multivariate factorization over Ring of integers modulo 4 is not implemented` (for instance) while with the previous version it said that the factorization over non-integral rings is not implemented. I personally find the previous message more informative, but that is a matter of taste and I am also fine with the current message.\n\n\n> 4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says \"factorization of multivariate polynomials is not supported, use multivariate polynomials instead\".\nNot relevant anymore, though I agree with the confusing aspect of this message!\n\n\u00b9 The main problem is that the `SymbolicRing` has no `is_finite()` method. Thus we get a `NotImplementedError` which is not very informative. See #18054.",
    "created_at": "2015-03-25T14:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234836",
    "user": "https://github.com/bgrenet"
}
```

Replying to [comment:15 jdemeyer]:

> 1. Replace `raise Exception, "Message."` by `raise Exception("message")`.
Done.

> 2. Is the check for integral domain really needed? If it's not an integral domain, it will be caught by the branch below.
> 3. Why did you add the check for symbolic ring? If it's needed, there should also be a doctest added for this case.

These both tests were not really needed. I added them in order to give more meaningful error messages. Now, the error message for the `SymbolicRing` is kind of weird, but the test I added was probably not the right place where to correct this.¹ 

For non-integral domains, you know have that `multivariate factorization over Ring of integers modulo 4 is not implemented` (for instance) while with the previous version it said that the factorization over non-integral rings is not implemented. I personally find the previous message more informative, but that is a matter of taste and I am also fine with the current message.


> 4. The message `Factorization of multivariate polynomials over Symbolic Ring is not implemented. Consider using multivariate polynomial rings instead.` is confusing, it essentially says "factorization of multivariate polynomials is not supported, use multivariate polynomials instead".
Not relevant anymore, though I agree with the confusing aspect of this message!

¹ The main problem is that the `SymbolicRing` has no `is_finite()` method. Thus we get a `NotImplementedError` which is not very informative. See #18054.



---

archive/issue_comments_234837.json:
```json
{
    "body": "Related: #2179",
    "created_at": "2015-04-13T16:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234837",
    "user": "https://github.com/mezzarobba"
}
```

Related: #2179



---

archive/issue_comments_234838.json:
```json
{
    "body": "It seems that the code proposed in #2179 is not in its current form ready to use (based on his author's comments). There was supposed to be some improved version, but since it is already 7 years old, we should maybe ignore it for now?",
    "created_at": "2015-04-22T13:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234838",
    "user": "https://github.com/bgrenet"
}
```

It seems that the code proposed in #2179 is not in its current form ready to use (based on his author's comments). There was supposed to be some improved version, but since it is already 7 years old, we should maybe ignore it for now?



---

archive/issue_comments_234839.json:
```json
{
    "body": "Yes, probably, I was only pointing out the other ticket just in case there was something relevant there.",
    "created_at": "2015-04-22T15:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234839",
    "user": "https://github.com/mezzarobba"
}
```

Yes, probably, I was only pointing out the other ticket just in case there was something relevant there.



---

archive/issue_comments_234840.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-24T09:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234840",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_234841.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-24T09:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234841",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_234842.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-25T07:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234842",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050893.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-25T07:29:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17603#event-50893"
}
```



---

archive/issue_comments_234843.json:
```json
{
    "body": "see #20435 for something going wrong",
    "created_at": "2016-04-15T07:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17603#issuecomment-234843",
    "user": "https://github.com/fchapoton"
}
```

see #20435 for something going wrong
