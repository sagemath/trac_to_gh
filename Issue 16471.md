# Issue 16471: Class group part of the Selmer group of a number field is incorrectly computed

Issue created by migration from https://trac.sagemath.org/ticket/16708

Original creator: pbruin

Original creation time: 2014-07-23 20:09:32

CC:  cremona

Keywords: Selmer group

The construction of elements of the _m_-Selmer group of a number field from elements of the _m_-torsion of the class group uses an incorrect formula, as the following example shows:

```
sage: K.<a> = QuadraticField(-5)
sage: p = K.primes_above(2)[0]
sage: S = K.selmer_group((), 4)
sage: all(4.divides(x.valuation(p)) for x in S)
False  # should be True
```

The class group is cyclic of order 2, generated by the unique prime ideal _p_ above 2.  To construct an element of the _m_-Selmer group from it, for _m_ even, one has to take a generator of the principal ideal _p<sup>m</sup>_.  However. the `selmer_group()` method currently uses a generator of _p_<sup>2</sup> for any even _m_.


---

Comment by pbruin created at 2014-07-23 20:16:31

Changing status from new to needs_review.


---

Comment by cremona created at 2014-07-24 11:24:50

I agree with the fact that there is a bug, and the prescribed fix is correct.  I tested the entire Sage library (since who knows where this code is used -- mostly in elliptic curve functions I think).

I was distracted by the notation in the doctest (and ticket description) which used S for the Sel;mer group and not for a set of primes, but no worries!


---

Comment by cremona created at 2014-07-24 11:24:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-07-25 05:05:42

Resolution: fixed
