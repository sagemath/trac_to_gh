# Issue 31150: Cosmetic update in building the pdf docs

archive/issues_031150.json:
```json
{
    "body": "CC:  jhpalmieri\n\nWith the current `9.3.beta7` devel version there is\n\n```\n(/usr/share/texmf-dist/tex/latex/xcite/xcite.sty\nPackage: xcite 2020/01/21 v16383.99998 eXternal Citations (EG)\n\n(/usr/share/texmf-dist/tex/latex/tools/xr.sty\nPackage: xr 2019/07/22 v5.05 eXternal References (DPC)\n))\n(/usr/share/texmf-dist/tex/latex/hyperref/xr-hyper.sty\nPackage: xr-hyper 2019/10/03 v6.1 eXternal References (DPC)\n)\nPackage xr Info: IMPORTING LABELS FROM ../references/references.aux on input li\nne 66.\nPackage xr Info: IMPORTING LABELS FROM ../references/references.aux on input li\nne 68.\n\n\nLaTeX Warning: Label `../references/index:aagmrz2019' multiply defined.\n```\n\n\nwhen building the pdf docs. This appears in every latex generated `.log` file.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31387\n\n",
    "created_at": "2021-02-12T05:01:40Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "title": "Cosmetic update in building the pdf docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31150",
    "user": "strogdon"
}
```
CC:  jhpalmieri

With the current `9.3.beta7` devel version there is

```
(/usr/share/texmf-dist/tex/latex/xcite/xcite.sty
Package: xcite 2020/01/21 v16383.99998 eXternal Citations (EG)

(/usr/share/texmf-dist/tex/latex/tools/xr.sty
Package: xr 2019/07/22 v5.05 eXternal References (DPC)
))
(/usr/share/texmf-dist/tex/latex/hyperref/xr-hyper.sty
Package: xr-hyper 2019/10/03 v6.1 eXternal References (DPC)
)
Package xr Info: IMPORTING LABELS FROM ../references/references.aux on input li
ne 66.
Package xr Info: IMPORTING LABELS FROM ../references/references.aux on input li
ne 68.


LaTeX Warning: Label `../references/index:aagmrz2019' multiply defined.
```


when building the pdf docs. This appears in every latex generated `.log` file.

Issue created by migration from https://trac.sagemath.org/ticket/31387





---

archive/issue_comments_445123.json:
```json
{
    "body": "I'm not sure why `index:aagmrz2019` is the only reference that is multiply defined unless it is because it is the first reference in `src/doc/en/reference/references/index.rst` - the labels are imported twice. The following seems to get rid of the warnings\n\n```diff\ndiff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py\nindex 28c95c69e4..be60aefdb1 100644\n--- a/src/doc/en/reference/conf_sub.py\n+++ b/src/doc/en/reference/conf_sub.py\n@@ -70,7 +70,6 @@ latex_elements['hyperref'] = r\"\"\"\n \\usepackage{xcite}\n \\usepackage{xr-hyper}\n \\externaldocument[../references/]{../references/references}\n-\\externalcitedocument[../references/]{../references/references}\n % Include hyperref last.\n \\usepackage{hyperref}\n % Fix anchor placement for figures with captions.\n```\n\nI believe the `xr-hyper` package aliases `\\externalcitedocument` to `\\externaldocument`. I haven't thoroughly tested this to determine if references are OK, but the `multiply defined` warnings are not present.",
    "created_at": "2021-02-12T05:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445123",
    "user": "strogdon"
}
```

I'm not sure why `index:aagmrz2019` is the only reference that is multiply defined unless it is because it is the first reference in `src/doc/en/reference/references/index.rst` - the labels are imported twice. The following seems to get rid of the warnings

```diff
diff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py
index 28c95c69e4..be60aefdb1 100644
--- a/src/doc/en/reference/conf_sub.py
+++ b/src/doc/en/reference/conf_sub.py
@@ -70,7 +70,6 @@ latex_elements['hyperref'] = r"""
 \usepackage{xcite}
 \usepackage{xr-hyper}
 \externaldocument[../references/]{../references/references}
-\externalcitedocument[../references/]{../references/references}
 % Include hyperref last.
 \usepackage{hyperref}
 % Fix anchor placement for figures with captions.
```

I believe the `xr-hyper` package aliases `\externalcitedocument` to `\externaldocument`. I haven't thoroughly tested this to determine if references are OK, but the `multiply defined` warnings are not present.



---

archive/issue_comments_445124.json:
```json
{
    "body": "No, perhaps the warnings are to be tolerated. At a very minimum `local/share/doc/sage/pdf/en/reference/cryptography/cryptography.pdf` has undefined references with the change.",
    "created_at": "2021-02-12T06:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445124",
    "user": "strogdon"
}
```

No, perhaps the warnings are to be tolerated. At a very minimum `local/share/doc/sage/pdf/en/reference/cryptography/cryptography.pdf` has undefined references with the change.



---

archive/issue_comments_445125.json:
```json
{
    "body": "What happens if you delete `\\usepackage{xcite}`?  (In addition to deleting `\\externalcitedocument`.)  There is no reason to import this package:\n\n```\nThe package xcite is no longer necessary, because its functionality has been taken \nover by xr, so this final version is just a stub that loads xr. \n    (from https://ctan.org/pkg/xcite)\n```\n\nThere is no reason to load both `xr` and `xr-hyper`, because they both do the same thing. I do not understand why only one reference would be multiply defined, but maybe the problem is an incompatibility between these two packages.\n\nIt may also help to update to the latest version of `xr-hyper` (7.00j 2021-02-10), or, at least, a newer version than 2019/10/03 v6.1.",
    "created_at": "2021-02-12T07:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445125",
    "user": "@DaveWitteMorris"
}
```

What happens if you delete `\usepackage{xcite}`?  (In addition to deleting `\externalcitedocument`.)  There is no reason to import this package:

```
The package xcite is no longer necessary, because its functionality has been taken 
over by xr, so this final version is just a stub that loads xr. 
    (from https://ctan.org/pkg/xcite)
```

There is no reason to load both `xr` and `xr-hyper`, because they both do the same thing. I do not understand why only one reference would be multiply defined, but maybe the problem is an incompatibility between these two packages.

It may also help to update to the latest version of `xr-hyper` (7.00j 2021-02-10), or, at least, a newer version than 2019/10/03 v6.1.



---

archive/issue_comments_445126.json:
```json
{
    "body": "Certainly not intended but even without addressing the `multiply defined` warnings there are undefined references.\n\n```\n$ grep -r \"LaTeX Warning: Citation\" local/share/doc/sage/latex/\nlocal/share/doc/sage/latex/en/reference/coding/coding.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/matrices/hadamard_\nlocal/share/doc/sage/latex/en/reference/algebras/algebras.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/sf/macdonald:macdo\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:cp1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/designs/database:designhandb\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1\nlocal/share/doc/sage/latex/en/reference/arithmetic_curves/arithmetic_curves.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/dyck_word:cha2005'\nlocal/share/doc/sage/latex/en/reference/categories/categories.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/root_system/hecke\n```\n",
    "created_at": "2021-02-12T19:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445126",
    "user": "strogdon"
}
```

Certainly not intended but even without addressing the `multiply defined` warnings there are undefined references.

```
$ grep -r "LaTeX Warning: Citation" local/share/doc/sage/latex/
local/share/doc/sage/latex/en/reference/coding/coding.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/matrices/hadamard_
local/share/doc/sage/latex/en/reference/algebras/algebras.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/sf/macdonald:macdo
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:cp1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/designs/database:designhandb
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/graphs/graphs.log:LaTeX Warning: Citation `../combinat/sage/combinat/matrices/hadamard_matrix:bh1
local/share/doc/sage/latex/en/reference/arithmetic_curves/arithmetic_curves.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/dyck_word:cha2005'
local/share/doc/sage/latex/en/reference/categories/categories.log:LaTeX Warning: Citation `../graphs/../combinat/sage/combinat/root_system/hecke
```




---

archive/issue_comments_445127.json:
```json
{
    "body": "A more serious problem is that the pdf docs don't build for me: I get an error in `reference/stats`. From `local/share/docs/sage/latex/en/reference/stats/stats.log`:\n\n```\nChapter 8.\n! TeX capacity exceeded, sorry [input stack size=5000].\n\\non@alpherr #1->\\@latex@error {\\string #1\n                                          allowed only in math mode}\\@ehd \nl.2922 ...Samplers for \\protect\\(\\ZZ[x]\\protect\\)}\n                                                  \nIf you really absolutely need more capacity,\nyou can ask a wizard to enlarge me.\n```\n",
    "created_at": "2021-02-12T21:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445127",
    "user": "jhpalmieri"
}
```

A more serious problem is that the pdf docs don't build for me: I get an error in `reference/stats`. From `local/share/docs/sage/latex/en/reference/stats/stats.log`:

```
Chapter 8.
! TeX capacity exceeded, sorry [input stack size=5000].
\non@alpherr #1->\@latex@error {\string #1
                                          allowed only in math mode}\@ehd 
l.2922 ...Samplers for \protect\(\ZZ[x]\protect\)}
                                                  
If you really absolutely need more capacity,
you can ask a wizard to enlarge me.
```




---

archive/issue_comments_445128.json:
```json
{
    "body": "`reference/stats/stats.tex` does produce `stats.pdf` here. I don't know what controls the stack size nor how to change it. From `stats.log` I have\n\n```\nHere is how much of TeX's memory you used:\n 15408 strings out of 482818\n 241885 string characters out of 5956944\n 529798 words of memory out of 5000000\n 30147 multiletter control sequences out of 15000+600000\n 588142 words of font info for 119 fonts, out of 8000000 for 9000\n 37 hyphenation exceptions out of 8191\n 38i,13n,49p,908b,642s stack positions out of 5000i,500n,10000p,200000b,80000s\n```\n",
    "created_at": "2021-02-12T21:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445128",
    "user": "strogdon"
}
```

`reference/stats/stats.tex` does produce `stats.pdf` here. I don't know what controls the stack size nor how to change it. From `stats.log` I have

```
Here is how much of TeX's memory you used:
 15408 strings out of 482818
 241885 string characters out of 5956944
 529798 words of memory out of 5000000
 30147 multiletter control sequences out of 15000+600000
 588142 words of font info for 119 fonts, out of 8000000 for 9000
 37 hyphenation exceptions out of 8191
 38i,13n,49p,908b,642s stack positions out of 5000i,500n,10000p,200000b,80000s
```




---

archive/issue_comments_445129.json:
```json
{
    "body": "It doesn't build for me on two different OS X machines (one running Catalina 10.15, one running Big Sur 11.2), for what that's worth.",
    "created_at": "2021-02-12T22:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445129",
    "user": "jhpalmieri"
}
```

It doesn't build for me on two different OS X machines (one running Catalina 10.15, one running Big Sur 11.2), for what that's worth.



---

archive/issue_comments_445130.json:
```json
{
    "body": "Replying to [comment:4 gh-DaveWitteMorris]:\n> What happens if you delete `\\usepackage{xcite}`?  (In addition to deleting `\\externalcitedocument`.)  There is no reason to import this package:\n> {{{\n> The package xcite is no longer necessary, because its functionality has been taken \n> over by xr, so this final version is just a stub that loads xr. \n>     (from https://ctan.org/pkg/xcite)\n> }}}\n> There is no reason to load both `xr` and `xr-hyper`, because they both do the same thing. I do not understand why only one reference would be multiply defined, but maybe the problem is an incompatibility between these two packages.\n> \n> It may also help to update to the latest version of `xr-hyper` (7.00j 2021-02-10), or, at least, a newer version than 2019/10/03 v6.1.\n\nThis performs much better for me. Of course I'm able to build things.\n\n```diff\ndiff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py\nindex 28c95c69e4..eef8721bdd 100644\n--- a/src/doc/en/reference/conf_sub.py\n+++ b/src/doc/en/reference/conf_sub.py\n@@ -67,10 +67,8 @@ latex_documents = [\n ]\n \n latex_elements['hyperref'] = r\"\"\"\n-\\usepackage{xcite}\n-\\usepackage{xr-hyper}\n+\\usepackage{xr}\n \\externaldocument[../references/]{../references/references}\n-\\externalcitedocument[../references/]{../references/references}\n % Include hyperref last.\n \\usepackage{hyperref}\n % Fix anchor placement for figures with captions.\n```\n\nThere are no `multiply defined` references and the references in `local/share/doc/sage/pdf/en/reference/cryptography/cryptography.pdf` look correct. I still see the undefined references [above](https://trac.sagemath.org/ticket/31387?replyto=4#comment:5) which is another issue. My distro (gentoo) provides\n\n```\n      xr.sty    2019/07/22 v5.05 eXternal References (DPC)\n```\n\nand\n\n```\nhyperref.sty    2020/01/14 v7.00d Hypertext links for LaTeX\n```\n",
    "created_at": "2021-02-13T03:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445130",
    "user": "strogdon"
}
```

Replying to [comment:4 gh-DaveWitteMorris]:
> What happens if you delete `\usepackage{xcite}`?  (In addition to deleting `\externalcitedocument`.)  There is no reason to import this package:
> {{{
> The package xcite is no longer necessary, because its functionality has been taken 
> over by xr, so this final version is just a stub that loads xr. 
>     (from https://ctan.org/pkg/xcite)
> }}}
> There is no reason to load both `xr` and `xr-hyper`, because they both do the same thing. I do not understand why only one reference would be multiply defined, but maybe the problem is an incompatibility between these two packages.
> 
> It may also help to update to the latest version of `xr-hyper` (7.00j 2021-02-10), or, at least, a newer version than 2019/10/03 v6.1.

This performs much better for me. Of course I'm able to build things.

```diff
diff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py
index 28c95c69e4..eef8721bdd 100644
--- a/src/doc/en/reference/conf_sub.py
+++ b/src/doc/en/reference/conf_sub.py
@@ -67,10 +67,8 @@ latex_documents = [
 ]
 
 latex_elements['hyperref'] = r"""
-\usepackage{xcite}
-\usepackage{xr-hyper}
+\usepackage{xr}
 \externaldocument[../references/]{../references/references}
-\externalcitedocument[../references/]{../references/references}
 % Include hyperref last.
 \usepackage{hyperref}
 % Fix anchor placement for figures with captions.
```

There are no `multiply defined` references and the references in `local/share/doc/sage/pdf/en/reference/cryptography/cryptography.pdf` look correct. I still see the undefined references [above](https://trac.sagemath.org/ticket/31387?replyto=4#comment:5) which is another issue. My distro (gentoo) provides

```
      xr.sty    2019/07/22 v5.05 eXternal References (DPC)
```

and

```
hyperref.sty    2020/01/14 v7.00d Hypertext links for LaTeX
```




---

archive/issue_comments_445131.json:
```json
{
    "body": "I thought `xr-hyper` would be better, because it is distributed with `hyperref`, and is therefore less likely to have a version clash, but `xr` is probably more stable:\n\n```\n%% xr-hyper package (beta release) ...\n%% This is a modified version of the xr package from the Standard LaTeX\n%% tools distribution. ...\n%% If no problems are reported the version in the tools distribution\n%% will be updated to match this at the next LaTeX release.\n```\n\nSo using `xr` is probably a good idea.\n\nI tested the patch of comment:9 on Ubuntu 20.04 (`CoCalc`) and had the good results, just the same 15 undefined references as in comment:5.  I noticed that some Japanese fonts are missing (not surprising), and I also had 2 other LaTeX Warnings:\n\n```\nlocal/share/doc/sage/latex/en/installation/installation.log:LaTeX Warning: Hyper reference `index:installation-guide' on page 6 undefined o\nlocal/share/doc/sage/latex/en/installation/installation.log:LaTeX Warning: Hyper reference `index:installation-guide' on page 35 undefined \n```\n\n\nI will test on MacOS 10.15.",
    "created_at": "2021-02-14T05:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445131",
    "user": "@DaveWitteMorris"
}
```

I thought `xr-hyper` would be better, because it is distributed with `hyperref`, and is therefore less likely to have a version clash, but `xr` is probably more stable:

```
%% xr-hyper package (beta release) ...
%% This is a modified version of the xr package from the Standard LaTeX
%% tools distribution. ...
%% If no problems are reported the version in the tools distribution
%% will be updated to match this at the next LaTeX release.
```

So using `xr` is probably a good idea.

I tested the patch of comment:9 on Ubuntu 20.04 (`CoCalc`) and had the good results, just the same 15 undefined references as in comment:5.  I noticed that some Japanese fonts are missing (not surprising), and I also had 2 other LaTeX Warnings:

```
local/share/doc/sage/latex/en/installation/installation.log:LaTeX Warning: Hyper reference `index:installation-guide' on page 6 undefined o
local/share/doc/sage/latex/en/installation/installation.log:LaTeX Warning: Hyper reference `index:installation-guide' on page 35 undefined 
```


I will test on MacOS 10.15.



---

archive/issue_comments_445132.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> A more serious problem is that the pdf docs don't build for me: ... `! TeX capacity exceeded, sorry [input stack size=5000]` ...\n\nIn my experience, this error is almost always due to an infinite loop (such as `\\def\\foo{\\foo}`). \n\nDid these results use a patch to `conf_sub.py`? What are the versions of `xr.sty`, `xr-hyper.sty` and `hyperref.sty` that are reported in the TeX log?",
    "created_at": "2021-02-14T05:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445132",
    "user": "@DaveWitteMorris"
}
```

Replying to [comment:6 jhpalmieri]:
> A more serious problem is that the pdf docs don't build for me: ... `! TeX capacity exceeded, sorry [input stack size=5000]` ...

In my experience, this error is almost always due to an infinite loop (such as `\def\foo{\foo}`). 

Did these results use a patch to `conf_sub.py`? What are the versions of `xr.sty`, `xr-hyper.sty` and `hyperref.sty` that are reported in the TeX log?



---

archive/issue_comments_445133.json:
```json
{
    "body": "Also, I wonder whether we are using the same commands to make the documentation.  I did:\n\n```\nmake doc-clean\n./configure\nmake doc-pdf\n```\n\nShould I be doing something else?",
    "created_at": "2021-02-14T05:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445133",
    "user": "@DaveWitteMorris"
}
```

Also, I wonder whether we are using the same commands to make the documentation.  I did:

```
make doc-clean
./configure
make doc-pdf
```

Should I be doing something else?



---

archive/issue_comments_445134.json:
```json
{
    "body": "Replying to [comment:10 gh-DaveWitteMorris]:\n> \n> I tested the patch of comment:9 on Ubuntu 20.04 (`CoCalc`) and had the good results, just the same 15 undefined references as in comment:5.  I noticed that some Japanese fonts are missing (not surprising), and I also had 2 other LaTeX Warnings:\nI believe I know how to deal with the 15 undefined references in comment:5. Additional references need to be added to `src/doc/en/reference/references/index.rst`. But perhaps this should be another ticket?",
    "created_at": "2021-02-14T06:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445134",
    "user": "strogdon"
}
```

Replying to [comment:10 gh-DaveWitteMorris]:
> 
> I tested the patch of comment:9 on Ubuntu 20.04 (`CoCalc`) and had the good results, just the same 15 undefined references as in comment:5.  I noticed that some Japanese fonts are missing (not surprising), and I also had 2 other LaTeX Warnings:
I believe I know how to deal with the 15 undefined references in comment:5. Additional references need to be added to `src/doc/en/reference/references/index.rst`. But perhaps this should be another ticket?



---

archive/issue_comments_445135.json:
```json
{
    "body": "Replying to [comment:11 gh-DaveWitteMorris]:\n> Replying to [comment:6 jhpalmieri]:\n> > A more serious problem is that the pdf docs don't build for me: ... `! TeX capacity exceeded, sorry [input stack size=5000]` ...\n> \n> In my experience, this error is almost always due to an infinite loop (such as `\\def\\foo{\\foo}`). \n> \n> Did these results use a patch to `conf_sub.py`? What are the versions of `xr.sty`, `xr-hyper.sty` and `hyperref.sty` that are reported in the TeX log?\n\nI've seen in on several machines with different branches, and I'm not patching anything. \n\n```\n/usr/local/texlive/2020/texmf-dist/tex/latex/tools/xr.sty\nPackage: xr 2020-05-10 v5.06 eXternal References (DPC)\n\n/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/xr-hyper.sty\npackage: xr-hyper 2021-02-07 v7.00h eXternal References (DPC)\n\n/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/hyperref.sty\nPackage: hyperref 2021-02-07 v7.00h Hypertext links for LaTeX\n```\n\nI do\n\n```\nmake doc-clean\nmake doc # sometimes I include this, sometimes not, make no difference\nmake doc-pdf\n```\n\nThe complaint comes from the line\n\n```\nl.2922 ...Samplers for \\protect\\(\\ZZ[x]\\protect\\)}\n```\n\nIf I change this (for example, to \"...Samplers for ZZ[x]\", removing the math mode, the error goes away.",
    "created_at": "2021-02-14T06:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445135",
    "user": "jhpalmieri"
}
```

Replying to [comment:11 gh-DaveWitteMorris]:
> Replying to [comment:6 jhpalmieri]:
> > A more serious problem is that the pdf docs don't build for me: ... `! TeX capacity exceeded, sorry [input stack size=5000]` ...
> 
> In my experience, this error is almost always due to an infinite loop (such as `\def\foo{\foo}`). 
> 
> Did these results use a patch to `conf_sub.py`? What are the versions of `xr.sty`, `xr-hyper.sty` and `hyperref.sty` that are reported in the TeX log?

I've seen in on several machines with different branches, and I'm not patching anything. 

```
/usr/local/texlive/2020/texmf-dist/tex/latex/tools/xr.sty
Package: xr 2020-05-10 v5.06 eXternal References (DPC)

/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/xr-hyper.sty
package: xr-hyper 2021-02-07 v7.00h eXternal References (DPC)

/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/hyperref.sty
Package: hyperref 2021-02-07 v7.00h Hypertext links for LaTeX
```

I do

```
make doc-clean
make doc # sometimes I include this, sometimes not, make no difference
make doc-pdf
```

The complaint comes from the line

```
l.2922 ...Samplers for \protect\(\ZZ[x]\protect\)}
```

If I change this (for example, to "...Samplers for ZZ[x]", removing the math mode, the error goes away.



---

archive/issue_comments_445136.json:
```json
{
    "body": "Please try the patch of comment:9. It worked for me on MacOS 10.15 (although I do get those same 15 missing citations).  The original `conf_sub.py` file is out of date, since it was written when `xcite` was still needed, and it may be that `xr` is conflicting with `xr-hyper`.  I will try the unpatched `conf_sub.py` on my mac.\n\nMy packages are:\n\n```\n/usr/local/texlive/2020/texmf-dist/tex/latex/tools/xr.sty\nPackage: xr 2019/07/22 v5.05 eXternal References (DPC)\n\n/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/hyperref.sty\nPackage: hyperref 2020/01/14 v7.00d Hypertext links for LaTeX\n```\n\n\nIf the patch doesn't work for you, I will update `xr` and `hyperref`, to see if I get the same error as you, because the problem could be a bug in one of those packages. Hyperref is certainly active in that line.",
    "created_at": "2021-02-14T07:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445136",
    "user": "@DaveWitteMorris"
}
```

Please try the patch of comment:9. It worked for me on MacOS 10.15 (although I do get those same 15 missing citations).  The original `conf_sub.py` file is out of date, since it was written when `xcite` was still needed, and it may be that `xr` is conflicting with `xr-hyper`.  I will try the unpatched `conf_sub.py` on my mac.

My packages are:

```
/usr/local/texlive/2020/texmf-dist/tex/latex/tools/xr.sty
Package: xr 2019/07/22 v5.05 eXternal References (DPC)

/usr/local/texlive/2020/texmf-dist/tex/latex/hyperref/hyperref.sty
Package: hyperref 2020/01/14 v7.00d Hypertext links for LaTeX
```


If the patch doesn't work for you, I will update `xr` and `hyperref`, to see if I get the same error as you, because the problem could be a bug in one of those packages. Hyperref is certainly active in that line.



---

archive/issue_comments_445137.json:
```json
{
    "body": "The unpatched `conf_sub.py` file worked for me on MacOS 10.15 (but I got the multiply defined label that was the original issue on this ticket).  I will see what happens when I upgrade `xr.sty` and `hyperref.sty`.\n\nI forgot to ask: what version of `xcite.sty` do you have?  I think mine is 2020/01/21 v16383.99998",
    "created_at": "2021-02-14T09:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445137",
    "user": "@DaveWitteMorris"
}
```

The unpatched `conf_sub.py` file worked for me on MacOS 10.15 (but I got the multiply defined label that was the original issue on this ticket).  I will see what happens when I upgrade `xr.sty` and `hyperref.sty`.

I forgot to ask: what version of `xcite.sty` do you have?  I think mine is 2020/01/21 v16383.99998



---

archive/issue_comments_445138.json:
```json
{
    "body": "Running `pdflatex` on this file produces the same error for me:\n\n```\n\\documentclass{report}\n\\usepackage{hyperref}\n\\newcommand{\\ZZ}{\\Bold{Z}}\n\\newcommand{\\Bold}[1]{\\mathbf{#1}}\n\n\\begin{document}\n\n\\chapter{Discrete Gaussian Samplers for \\protect\\(\\ZZ[x]\\protect\\)}\n\ntesting\n\n\\end{document}\n```\n\nMore version information:\n\n```\nThis is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)\n restricted \\write18 enabled.\nentering extended mode\n(./junk.tex\nLaTeX2e <2020-10-01> patch level 4\nL3 programming layer <2021-02-06>\n```\n",
    "created_at": "2021-02-14T19:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445138",
    "user": "jhpalmieri"
}
```

Running `pdflatex` on this file produces the same error for me:

```
\documentclass{report}
\usepackage{hyperref}
\newcommand{\ZZ}{\Bold{Z}}
\newcommand{\Bold}[1]{\mathbf{#1}}

\begin{document}

\chapter{Discrete Gaussian Samplers for \protect\(\ZZ[x]\protect\)}

testing

\end{document}
```

More version information:

```
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)
 restricted \write18 enabled.
entering extended mode
(./junk.tex
LaTeX2e <2020-10-01> patch level 4
L3 programming layer <2021-02-06>
```




---

archive/issue_comments_445139.json:
```json
{
    "body": "Thanks!  That's very helpful (much faster to test than running a whole docbuild).  The test file works for me, even after upgrading hyperref. (However, the upgrade of hyperref gave me `hyperref 2021-02-10 v7.00j`, which is not quite the same as yours.) The only issue (which is expected) is that the math in the chapter title gives a hyperref warning:\n\n```\nPackage hyperref Warning: Token not allowed in a PDF string (Unicode):\n(hyperref)                removing `math shift' on input line 8.\n```\n\n\nI assume that removing `\\usepackage{hyperref}` eliminates the error for you, so we know that the problem has something to do with hyperref. Please try changing the `chapter` line to each of the following three variations:\n\n```\n\\chapter{Discrete Gaussian Samplers for \\texorpdfstring{\\protect\\(\\ZZ[x]\\protect\\)}{Z[x]}}\n```\n\n\n```\n\\chapter{Discrete Gaussian Samplers for \\(\\ZZ[x]\\)}\n```\n\n\n```\n\\chapter{Discrete Gaussian Samplers for $\\ZZ[x]$}\n```\n\n\n\nMy version info:\n\n```\nThis is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)\n restricted \\write18 enabled.\nentering extended mode\n(./test.tex\nLaTeX2e <2020-02-02> patch level 5\nL3 programming layer <2020-03-06>\n```\n\nI will try to upgrade to the latest version.",
    "created_at": "2021-02-14T19:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445139",
    "user": "@DaveWitteMorris"
}
```

Thanks!  That's very helpful (much faster to test than running a whole docbuild).  The test file works for me, even after upgrading hyperref. (However, the upgrade of hyperref gave me `hyperref 2021-02-10 v7.00j`, which is not quite the same as yours.) The only issue (which is expected) is that the math in the chapter title gives a hyperref warning:

```
Package hyperref Warning: Token not allowed in a PDF string (Unicode):
(hyperref)                removing `math shift' on input line 8.
```


I assume that removing `\usepackage{hyperref}` eliminates the error for you, so we know that the problem has something to do with hyperref. Please try changing the `chapter` line to each of the following three variations:

```
\chapter{Discrete Gaussian Samplers for \texorpdfstring{\protect\(\ZZ[x]\protect\)}{Z[x]}}
```


```
\chapter{Discrete Gaussian Samplers for \(\ZZ[x]\)}
```


```
\chapter{Discrete Gaussian Samplers for $\ZZ[x]$}
```



My version info:

```
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)
 restricted \write18 enabled.
entering extended mode
(./test.tex
LaTeX2e <2020-02-02> patch level 5
L3 programming layer <2020-03-06>
```

I will try to upgrade to the latest version.



---

archive/issue_comments_445140.json:
```json
{
    "body": "Switching between `$` and `\\(` makes no difference, nor do the `\\protect` statements. Using `\\texorpdfstring` works, though. This works:\n\n```\n\\documentclass{report}\n\\usepackage{hyperref}\n\\begin{document}\n\n\\chapter{Testing \\texorpdfstring{\\(\\mathbf{y}=4\\)}{blah}}\n\ntest\n\n\\chapter{Testing \\(\\mathbf{x}=3\\)}\n\ntest\n\n\\end{document}\n```\n\nThis does not:\n\n```\n{{{\n\\documentclass{report}\n\\usepackage{hyperref}\n\\begin{document}\n\n\\chapter{Testing \\(\\mathbf{x}=3\\)}\n\ntest\n\n\\chapter{Testing \\texorpdfstring{\\(\\mathbf{y}=4\\)}{blah}}\n\ntest\n\n\\end{document}\n}}}",
    "created_at": "2021-02-14T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445140",
    "user": "jhpalmieri"
}
```

Switching between `$` and `\(` makes no difference, nor do the `\protect` statements. Using `\texorpdfstring` works, though. This works:

```
\documentclass{report}
\usepackage{hyperref}
\begin{document}

\chapter{Testing \texorpdfstring{\(\mathbf{y}=4\)}{blah}}

test

\chapter{Testing \(\mathbf{x}=3\)}

test

\end{document}
```

This does not:

```
{{{
\documentclass{report}
\usepackage{hyperref}
\begin{document}

\chapter{Testing \(\mathbf{x}=3\)}

test

\chapter{Testing \texorpdfstring{\(\mathbf{y}=4\)}{blah}}

test

\end{document}
}}}



---

archive/issue_comments_445141.json:
```json
{
    "body": "Replying to [comment:18 gh-DaveWitteMorris]:\n> \n> {{{\n> Package hyperref Warning: Token not allowed in a PDF string (Unicode):\n> (hyperref)                removing `math shift' on input line 8.\n> }}}\n> \n\nI see the above as well with\n\n\n```\nhyperref.sty    2020/01/14 v7.00d Hypertext links for LaTeX\n```\n",
    "created_at": "2021-02-14T20:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445141",
    "user": "strogdon"
}
```

Replying to [comment:18 gh-DaveWitteMorris]:
> 
> {{{
> Package hyperref Warning: Token not allowed in a PDF string (Unicode):
> (hyperref)                removing `math shift' on input line 8.
> }}}
> 

I see the above as well with


```
hyperref.sty    2020/01/14 v7.00d Hypertext links for LaTeX
```




---

archive/issue_comments_445142.json:
```json
{
    "body": "Now that I've upgraded Latex, I'm getting the results that jhpalmieri reported in comment:19. Changing the order of the chapters makes a difference, but I have no idea why.",
    "created_at": "2021-02-14T21:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445142",
    "user": "@DaveWitteMorris"
}
```

Now that I've upgraded Latex, I'm getting the results that jhpalmieri reported in comment:19. Changing the order of the chapters makes a difference, but I have no idea why.



---

archive/issue_comments_445143.json:
```json
{
    "body": "Now under discussion at https://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter",
    "created_at": "2021-02-14T21:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445143",
    "user": "jhpalmieri"
}
```

Now under discussion at https://tex.stackexchange.com/questions/583391/mactex-2020-error-with-report-hyperref-mathbf-in-chapter



---

archive/issue_comments_445144.json:
```json
{
    "body": "And proposed as a bug at https://github.com/latex3/latex2e/issues/501",
    "created_at": "2021-02-14T22:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445144",
    "user": "jhpalmieri"
}
```

And proposed as a bug at https://github.com/latex3/latex2e/issues/501



---

archive/issue_comments_445145.json:
```json
{
    "body": "Anyway, I have no opinions on the subject of this ticket. I've created #31397 for the errors in building the PDF documents. Let's keep this ticket focused on the original cosmetic issues; sorry for derailing it in the first place.",
    "created_at": "2021-02-14T22:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445145",
    "user": "jhpalmieri"
}
```

Anyway, I have no opinions on the subject of this ticket. I've created #31397 for the errors in building the PDF documents. Let's keep this ticket focused on the original cosmetic issues; sorry for derailing it in the first place.



---

archive/issue_comments_445146.json:
```json
{
    "body": "I will address the undefined references on another ticket.\n----\nNew commits:",
    "created_at": "2021-02-15T06:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445146",
    "user": "strogdon"
}
```

I will address the undefined references on another ticket.
----
New commits:



---

archive/issue_comments_445147.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-15T06:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445147",
    "user": "strogdon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_445148.json:
```json
{
    "body": "The `undefined references` are now addressed on #31398.",
    "created_at": "2021-02-15T06:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445148",
    "user": "strogdon"
}
```

The `undefined references` are now addressed on #31398.



---

archive/issue_comments_445149.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-02-16T05:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445149",
    "user": "@DaveWitteMorris"
}
```

Changing priority from major to minor.



---

archive/issue_comments_445150.json:
```json
{
    "body": "Thanks for fixing this.",
    "created_at": "2021-02-16T05:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445150",
    "user": "@DaveWitteMorris"
}
```

Thanks for fixing this.



---

archive/issue_comments_445151.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-16T05:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445151",
    "user": "@DaveWitteMorris"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_445152.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-14T15:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31150#issuecomment-445152",
    "user": "vbraun"
}
```

Resolution: fixed
