# Issue 10756: sage -sh doesn't work on OSX

archive/issues_010756.json:
```json
{
    "body": "On OSX (10.6.6), when starting zsh, the /etc/zshenv file is always executed (even if the -f option is used to start zsh).  This file:\n\n\n```\n# system-wide environment settings for zsh(1)\nif [ -x /usr/libexec/path_helper ]; then\n\teval `/usr/libexec/path_helper -s`\nfi\n```\n\n\nmodifies the path to put things like /usr/bin, etc., in at the *start* of the path (even though the documentation for path_helper says that it *appends* things to the PATH variable).\n\nSo in the end, I get:\n\n\n```\nbash-3.2$ ~/sage/sage -sh\nDetected SAGE64 flag\nBuilding Sage on OS X in 64-bit mode\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nSAGE_ROOT=/Users/grout/sage\n(sage subshell) tiny:~/sage/local/bin grout$ echo $PATH    \n/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:.\nSAGE_ROOT=/Users/grout/sage\n(sage subshell) tiny:~/sage/local/bin grout$ \n\n\n```\n\n\nNotice that the Sage paths are at the end of the PATH variable.  This causes all sorts of problems when trying to do anything with sage -sh.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10822\n\n",
    "created_at": "2011-02-22T19:38:27Z",
    "labels": [
        "component: scripts",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0.1",
    "title": "sage -sh doesn't work on OSX",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10756",
    "user": "https://github.com/jasongrout"
}
```
On OSX (10.6.6), when starting zsh, the /etc/zshenv file is always executed (even if the -f option is used to start zsh).  This file:


```
# system-wide environment settings for zsh(1)
if [ -x /usr/libexec/path_helper ]; then
	eval `/usr/libexec/path_helper -s`
fi
```


modifies the path to put things like /usr/bin, etc., in at the *start* of the path (even though the documentation for path_helper says that it *appends* things to the PATH variable).

So in the end, I get:


```
bash-3.2$ ~/sage/sage -sh
Detected SAGE64 flag
Building Sage on OS X in 64-bit mode

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

SAGE_ROOT=/Users/grout/sage
(sage subshell) tiny:~/sage/local/bin grout$ echo $PATH    
/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:.
SAGE_ROOT=/Users/grout/sage
(sage subshell) tiny:~/sage/local/bin grout$ 


```


Notice that the Sage paths are at the end of the PATH variable.  This causes all sorts of problems when trying to do anything with sage -sh.

Issue created by migration from https://trac.sagemath.org/ticket/10822





---

archive/issue_comments_113472.json:
```json
{
    "body": "First of all, I think path_helper might be working properly.  On my machine, the documentation says that it adds paths found in the files in /etc/paths.d/, which on my machine just adds `/usr/texbin` and `/usr/X11/bin`.  In particular, I think that /usr/bin, etc. are already at the start of the path before path_helper is run.\n\nSecond, I don't see this problem, but maybe I'm not doing things right.  My default shell is bash, but if I do\n\n```\n$ zsh\njpalmieri538% sage -sh\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nSAGE_ROOT=/Applications/sage\n(sage subshell) jpalmieri538:~ palmieri$ echo $PATH\n/Applications/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Applications/sage:/Applications/sage/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/texbin:/usr/X11/bin:/Users/palmieri/bin:/Applications/sage\nSAGE_ROOT=/Applications/sage\n```\n\n(Also, are you sure that this has to do with zsh?  Your first line says `bash-3.2$`.)\n\nTo troubleshoot this, try applying this patch to sage-sage in SAGE_ROOT/local/bin:\n\n```diff\n\ndiff -r e7a865848991 sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -476,6 +476,7 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n     SHELL_NAME=`basename $SHELL`\n     echo \"Bypassing shell configuration files ...\"\n     echo\n+    echo \"PATH is set to $PATH\"\n     # We must start a new shell with no .profile or .bashrc files\n     # processed, so that we know our path is correct\n     PS1=\"SAGE_ROOT=${SAGE_ROOT}\\n(sage subshell) \\h:\\W \\u\\$ \"\n```\n\nThen it will print the PATH before it even starts the new shell.",
    "created_at": "2011-02-22T21:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113472",
    "user": "https://github.com/jhpalmieri"
}
```

First of all, I think path_helper might be working properly.  On my machine, the documentation says that it adds paths found in the files in /etc/paths.d/, which on my machine just adds `/usr/texbin` and `/usr/X11/bin`.  In particular, I think that /usr/bin, etc. are already at the start of the path before path_helper is run.

Second, I don't see this problem, but maybe I'm not doing things right.  My default shell is bash, but if I do

```
$ zsh
jpalmieri538% sage -sh

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

SAGE_ROOT=/Applications/sage
(sage subshell) jpalmieri538:~ palmieri$ echo $PATH
/Applications/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Applications/sage:/Applications/sage/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/texbin:/usr/X11/bin:/Users/palmieri/bin:/Applications/sage
SAGE_ROOT=/Applications/sage
```

(Also, are you sure that this has to do with zsh?  Your first line says `bash-3.2$`.)

To troubleshoot this, try applying this patch to sage-sage in SAGE_ROOT/local/bin:

```diff

diff -r e7a865848991 sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -476,6 +476,7 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
     SHELL_NAME=`basename $SHELL`
     echo "Bypassing shell configuration files ..."
     echo
+    echo "PATH is set to $PATH"
     # We must start a new shell with no .profile or .bashrc files
     # processed, so that we know our path is correct
     PS1="SAGE_ROOT=${SAGE_ROOT}\n(sage subshell) \h:\W \u\$ "
```

Then it will print the PATH before it even starts the new shell.



---

archive/issue_comments_113473.json:
```json
{
    "body": "At first I thought it was peculiar to zsh, but then in my example above I tried it with bash, so it's not particular to zsh on my computer.\n\nCan you try the following simple test?\n\n\n```\nbash-3.2$ PATH='.';export PATH\nbash-3.2$ /usr/libexec/path_helper -s\nPATH=\"/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:.\"; export PATH;\n```\n\n\nDo you see \".\" at the end or the start of PATH in the output of path_helper?",
    "created_at": "2011-02-22T22:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113473",
    "user": "https://github.com/jasongrout"
}
```

At first I thought it was peculiar to zsh, but then in my example above I tried it with bash, so it's not particular to zsh on my computer.

Can you try the following simple test?


```
bash-3.2$ PATH='.';export PATH
bash-3.2$ /usr/libexec/path_helper -s
PATH="/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:."; export PATH;
```


Do you see "." at the end or the start of PATH in the output of path_helper?



---

archive/issue_comments_113474.json:
```json
{
    "body": "Also, just to make sure, could you check the md5 of your path_helper binary?\n\n\n```\n$ md5 /usr/libexec/path_helper \nMD5 (/usr/libexec/path_helper) = 66b40636fd8adb430b0b8667135bcefe\n```\n",
    "created_at": "2011-02-22T22:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113474",
    "user": "https://github.com/jasongrout"
}
```

Also, just to make sure, could you check the md5 of your path_helper binary?


```
$ md5 /usr/libexec/path_helper 
MD5 (/usr/libexec/path_helper) = 66b40636fd8adb430b0b8667135bcefe
```




---

archive/issue_comments_113475.json:
```json
{
    "body": "Replying to [comment:2 jason]:\n> At first I thought it was peculiar to zsh, but then in my example above I tried it with bash, so it's not particular to zsh on my computer.\n> \n> Can you try the following simple test?\n> \n> {{{\n> bash-3.2$ PATH='.';export PATH\n> bash-3.2$ /usr/libexec/path_helper -s\n> PATH=\"/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:.\"; export PATH;\n> }}}\n> \n> Do you see \".\" at the end or the start of PATH in the output of path_helper?\n\nI just tried the simple test above with the guest account on my computer and I got the same results---path_helper prepended its paths instead of appending them.",
    "created_at": "2011-02-22T22:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113475",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:2 jason]:
> At first I thought it was peculiar to zsh, but then in my example above I tried it with bash, so it's not particular to zsh on my computer.
> 
> Can you try the following simple test?
> 
> {{{
> bash-3.2$ PATH='.';export PATH
> bash-3.2$ /usr/libexec/path_helper -s
> PATH="/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:."; export PATH;
> }}}
> 
> Do you see "." at the end or the start of PATH in the output of path_helper?

I just tried the simple test above with the guest account on my computer and I got the same results---path_helper prepended its paths instead of appending them.



---

archive/issue_comments_113476.json:
```json
{
    "body": "I get the same as you in both cases.  Now I see I didn't read all of the path_helper documentation: in addition to adding paths from /etc/paths.d/, it also says\n\n```\nPrior to reading these directories, default PATH and MANPATH values are obtained from the files\n/etc/paths and /etc/manpaths respectively.\n```\n\nNote that there are no promises about appending anything.\n\nHowever, I still don't have the problem you're having with \"sage -sh\".  Indeed, I would guess that your PATH is set incorrectly whenever you run Sage, and then I'm surprised that anything works right.  What happens if you do this in Sage:\n\n```\nsage: import os\nsage: os.environ.get('PATH')\n```\n\nAre the Sage directories at the beginning or end?",
    "created_at": "2011-02-22T22:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113476",
    "user": "https://github.com/jhpalmieri"
}
```

I get the same as you in both cases.  Now I see I didn't read all of the path_helper documentation: in addition to adding paths from /etc/paths.d/, it also says

```
Prior to reading these directories, default PATH and MANPATH values are obtained from the files
/etc/paths and /etc/manpaths respectively.
```

Note that there are no promises about appending anything.

However, I still don't have the problem you're having with "sage -sh".  Indeed, I would guess that your PATH is set incorrectly whenever you run Sage, and then I'm surprised that anything works right.  What happens if you do this in Sage:

```
sage: import os
sage: os.environ.get('PATH')
```

Are the Sage directories at the beginning or end?



---

archive/issue_comments_113477.json:
```json
{
    "body": "John, when I apply your patch, I get:\n\n\n```\n% sage -sh\nDetected SAGE64 flag\nBuilding Sage on OS X in 64-bit mode\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nPATH is set to /Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:/Users/grout/sage:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/opt/local/bin:/Users/grout/bin:/opt/local/bin\n```\n\n\nSo the path is set correctly before starting up the shell (well, except that I don't know what's going on with the 2.5 version framework, but regardless, sage is at the start of the path).\n\nJason",
    "created_at": "2011-02-22T22:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113477",
    "user": "https://github.com/jasongrout"
}
```

John, when I apply your patch, I get:


```
% sage -sh
Detected SAGE64 flag
Building Sage on OS X in 64-bit mode

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

PATH is set to /Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:/Users/grout/sage:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/opt/local/bin:/Users/grout/bin:/opt/local/bin
```


So the path is set correctly before starting up the shell (well, except that I don't know what's going on with the 2.5 version framework, but regardless, sage is at the start of the path).

Jason



---

archive/issue_comments_113478.json:
```json
{
    "body": "From within Sage:\n\n\n```\nsage: os.environ.get('PATH')\n'/Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:/Users/grout/sage:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/opt/local/bin:/Users/grout/bin:/opt/local/bin'\n```\n\n\nSo it's set correctly in there.  I'm positive it's also set correctly when I'm installing spkgs.",
    "created_at": "2011-02-22T22:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113478",
    "user": "https://github.com/jasongrout"
}
```

From within Sage:


```
sage: os.environ.get('PATH')
'/Users/grout/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/grout/sage:/Users/grout/sage/local/bin:/Users/grout/sage:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/texbin:/usr/X11/bin:/opt/local/bin:/Users/grout/bin:/opt/local/bin'
```


So it's set correctly in there.  I'm positive it's also set correctly when I'm installing spkgs.



---

archive/issue_comments_113479.json:
```json
{
    "body": "Okay, so if I use chsh to change my shell to bash, then sage -sh has the right $PATH.  John, if you change your shell to zsh using chsh, do you have the right $PATH?\n\nThanks, Jason",
    "created_at": "2011-02-22T22:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113479",
    "user": "https://github.com/jasongrout"
}
```

Okay, so if I use chsh to change my shell to bash, then sage -sh has the right $PATH.  John, if you change your shell to zsh using chsh, do you have the right $PATH?

Thanks, Jason



---

archive/issue_comments_113480.json:
```json
{
    "body": "Replying to [comment:8 jason]:\n> Okay, so if I use chsh to change my shell to bash, then sage -sh has the right $PATH.  John, if you change your shell to zsh using chsh, do you have the right $PATH?\n\nNo, the Sage stuff comes at the end.  Also, the prompt is bad:\n\n```\nMacintosh% /Applications/sage/sage -sh\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nBypassing shell configuration files ...\n\nSAGE_ROOT=/Applications/sage\\n(sage subshell) \\h:\\W \\u$ echo $PATH\n/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/texbin:/usr/X11/bin:/Applications/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Applications/sage:/Applications/sage/local/bin\n```\n",
    "created_at": "2011-02-23T02:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113480",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:8 jason]:
> Okay, so if I use chsh to change my shell to bash, then sage -sh has the right $PATH.  John, if you change your shell to zsh using chsh, do you have the right $PATH?

No, the Sage stuff comes at the end.  Also, the prompt is bad:

```
Macintosh% /Applications/sage/sage -sh

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

Bypassing shell configuration files ...

SAGE_ROOT=/Applications/sage\n(sage subshell) \h:\W \u$ echo $PATH
/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/texbin:/usr/X11/bin:/Applications/sage/local/Frameworks/Python.framework/Versions/2.5/bin:/Applications/sage:/Applications/sage/local/bin
```




---

archive/issue_comments_113481.json:
```json
{
    "body": "I have one idea how to fix this, but it doesn't seem ideal: first, change the SHELL_OPTS for zsh to \" -d\".  Then create a .zshrc file, say in SAGE_ROOT/local/bin, containing \n\n```\nexport PATH=$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH\n```\n\nand then tell zsh to read this file when starting up.  The following patch to sage-sage does it, and also fixes the prompt:\n\n```diff\ndiff -r e7a865848991 sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -478,16 +478,19 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n     echo\n     # We must start a new shell with no .profile or .bashrc files\n     # processed, so that we know our path is correct\n-    PS1=\"SAGE_ROOT=${SAGE_ROOT}\\n(sage subshell) \\h:\\W \\u\\$ \"\n-    export PS1\n     case $SHELL_NAME in\n         bash)\n+\t    PS1=\"SAGE_ROOT=${SAGE_ROOT}\\n(sage subshell) \\h:\\W \\u\\$ \"\n+\t    export PS1\n             SHELL_OPTS=\" --norc\"\n             ;;\n         csh)\n             SHELL_OPTS=\" -f\"\n             ;;\n         ksh)\n+\t    PS1=\"\"\"SAGE_ROOT=${SAGE_ROOT}\n+(sage subshell) `hostname -s`:\\${PWD##*/} $USER$ \"\"\"\n+\t    export PS1\n             SHELL_OPTS=\" -p\"\n             ;;\n         sh)\n@@ -497,7 +500,12 @@ if [ \"$1\" = '-sh'  -o \"$1\" = '--sh' ]; t\n             SHELL_OPTS=\" -f\"\n             ;;\n         zsh)\n-            SHELL_OPTS=\" -f -d\"\n+\t    PS1=\"\"\"SAGE_ROOT=${SAGE_ROOT}\n+(sage subshell) %m:%1~ %n$ \"\"\"\n+\t    export PS1\n+\t    ZDOTDIR=${SAGE_ROOT}/local/bin/\n+\t    export ZDOTDIR\n+            SHELL_OPTS=\" -d\"\n             ;;\n         *)\n             echo >&2 \"Unknown shell: $SHELL!\"\n```\n\nI think that setting the prompt for csh and tcsh might require a similar trick, since their prompt doesn't seem to be governed by an environment variable the same way.",
    "created_at": "2011-02-23T03:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113481",
    "user": "https://github.com/jhpalmieri"
}
```

I have one idea how to fix this, but it doesn't seem ideal: first, change the SHELL_OPTS for zsh to " -d".  Then create a .zshrc file, say in SAGE_ROOT/local/bin, containing 

```
export PATH=$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH
```

and then tell zsh to read this file when starting up.  The following patch to sage-sage does it, and also fixes the prompt:

```diff
diff -r e7a865848991 sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -478,16 +478,19 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
     echo
     # We must start a new shell with no .profile or .bashrc files
     # processed, so that we know our path is correct
-    PS1="SAGE_ROOT=${SAGE_ROOT}\n(sage subshell) \h:\W \u\$ "
-    export PS1
     case $SHELL_NAME in
         bash)
+	    PS1="SAGE_ROOT=${SAGE_ROOT}\n(sage subshell) \h:\W \u\$ "
+	    export PS1
             SHELL_OPTS=" --norc"
             ;;
         csh)
             SHELL_OPTS=" -f"
             ;;
         ksh)
+	    PS1="""SAGE_ROOT=${SAGE_ROOT}
+(sage subshell) `hostname -s`:\${PWD##*/} $USER$ """
+	    export PS1
             SHELL_OPTS=" -p"
             ;;
         sh)
@@ -497,7 +500,12 @@ if [ "$1" = '-sh'  -o "$1" = '--sh' ]; t
             SHELL_OPTS=" -f"
             ;;
         zsh)
-            SHELL_OPTS=" -f -d"
+	    PS1="""SAGE_ROOT=${SAGE_ROOT}
+(sage subshell) %m:%1~ %n$ """
+	    export PS1
+	    ZDOTDIR=${SAGE_ROOT}/local/bin/
+	    export ZDOTDIR
+            SHELL_OPTS=" -d"
             ;;
         *)
             echo >&2 "Unknown shell: $SHELL!"
```

I think that setting the prompt for csh and tcsh might require a similar trick, since their prompt doesn't seem to be governed by an environment variable the same way.



---

archive/issue_comments_113482.json:
```json
{
    "body": "(We could also generate the file `.zshrc` on the fly and store it in some temporary directory.)",
    "created_at": "2011-02-23T19:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113482",
    "user": "https://github.com/jhpalmieri"
}
```

(We could also generate the file `.zshrc` on the fly and store it in some temporary directory.)



---

archive/issue_comments_113483.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-25T22:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113483",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113484.json:
```json
{
    "body": "Here's a patch implementing the idea above.  I can't figure out a safe way to deal with csh and tcsh: the only idea I have is to temporarily overwrite the user's .cshrc or .tcshrc file, and this seems risky.  So with this patch, the prompts for those shells are not set correctly.",
    "created_at": "2011-03-25T22:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113484",
    "user": "https://github.com/jhpalmieri"
}
```

Here's a patch implementing the idea above.  I can't figure out a safe way to deal with csh and tcsh: the only idea I have is to temporarily overwrite the user's .cshrc or .tcshrc file, and this seems risky.  So with this patch, the prompts for those shells are not set correctly.



---

archive/issue_comments_113485.json:
```json
{
    "body": "It would be good to test this on different platforms.  I can test it on my mac, but I don't know if I have access to another system which has zsh installed and on which I can run \"chsh\" successfully.",
    "created_at": "2011-03-25T22:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113485",
    "user": "https://github.com/jhpalmieri"
}
```

It would be good to test this on different platforms.  I can test it on my mac, but I don't know if I have access to another system which has zsh installed and on which I can run "chsh" successfully.



---

archive/issue_comments_113486.json:
```json
{
    "body": "Rebased to #11866 and #11790.",
    "created_at": "2011-09-28T21:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113486",
    "user": "https://github.com/jhpalmieri"
}
```

Rebased to #11866 and #11790.



---

archive/issue_comments_113487.json:
```json
{
    "body": "Attachment [trac_10822-sage-sh.patch](tarball://root/attachments/some-uuid/ticket10822/trac_10822-sage-sh.patch) by @jhpalmieri created at 2011-09-28 21:07:50\n\nscripts repo",
    "created_at": "2011-09-28T21:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113487",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_10822-sage-sh.patch](tarball://root/attachments/some-uuid/ticket10822/trac_10822-sage-sh.patch) by @jhpalmieri created at 2011-09-28 21:07:50

scripts repo



---

archive/issue_comments_113488.json:
```json
{
    "body": "Not an expert on zsh but the patch works for me on Debian GNU/Linux using zsh. \n\nOn my machine `mktemp -t sage` wouldn't work though:\n\n\n```\n$ mktemp -t sage\nmktemp: too few X's in template `sage'\n$ mktemp -t sageXXX\n/tmp/sage5WO\n```\n",
    "created_at": "2011-09-28T21:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113488",
    "user": "https://github.com/malb"
}
```

Not an expert on zsh but the patch works for me on Debian GNU/Linux using zsh. 

On my machine `mktemp -t sage` wouldn't work though:


```
$ mktemp -t sage
mktemp: too few X's in template `sage'
$ mktemp -t sageXXX
/tmp/sage5WO
```




---

archive/issue_comments_113489.json:
```json
{
    "body": "What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.\n\nSecondly, I believe one of the reasons for creating a new .zshrc is to avoid sourcing user settings (as I read it in sage-sage). In this case, one should invoke zsh as `zsh -o noglobalrcs` see [Files](http://zsh.sourceforge.net/Doc/Release/Files.html#Files).\n\nA cleaner way to implement the ZDOTDIR would be to then **remove** /tmp/.zshrc if it is present and echo a newer one. In fact, one could even use the RPROMPT of zsh to get a cleaner prompt. It is less annoying that a massive prompt that is obtained otherwise. :)\n\nHere's a diff of what changes I did to sage-sage.\n\n```diff\n# HG changeset patch\n# User P Purkayastha <ppurka@gmail.com>\n# Date 1317310855 -28800\n# Node ID 469d05f30083d92990be2a0af692062d9b51c7be\n# Parent  f8f1496d316ce8556a8d7350de61e0f755c23681\n[mq]: trac_10822_fix_zsh_shell.patch\n\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -497,7 +497,23 @@\n             SHELL_OPTS=\" -f\"\n             ;;\n         zsh)\n-            SHELL_OPTS=\" -f -d\"\n+            FILE=\"/tmp/.zshrc\"\n+            if [ -e \"$FILE\" ]; then\n+                if ! rm -f \"$FILE\"; then\n+                    echo \"No permission to delete and create new file $FILE\"\n+                    exit 1\n+                fi\n+            fi\n+            cat > \"$FILE\" << EOF\n+PATH=\"$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH\"\n+export PATH\n+PS1=\"%m:%~ %n$ \"\n+export PS1\n+RPROMPT=\" #SAGE_ROOT=${SAGE_ROOT} (sage subshell)\"\n+export RPROMPT\n+EOF\n+            export ZDOTDIR=\"/tmp\"\n+            SHELL_OPTS=\"-o noglobalrcs\"\n             ;;\n         *)\n             echo >&2 \"Unknown shell: $SHELL!\"\n```\n",
    "created_at": "2011-09-29T15:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113489",
    "user": "https://github.com/ppurka"
}
```

What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.

Secondly, I believe one of the reasons for creating a new .zshrc is to avoid sourcing user settings (as I read it in sage-sage). In this case, one should invoke zsh as `zsh -o noglobalrcs` see [Files](http://zsh.sourceforge.net/Doc/Release/Files.html#Files).

A cleaner way to implement the ZDOTDIR would be to then **remove** /tmp/.zshrc if it is present and echo a newer one. In fact, one could even use the RPROMPT of zsh to get a cleaner prompt. It is less annoying that a massive prompt that is obtained otherwise. :)

Here's a diff of what changes I did to sage-sage.

```diff
# HG changeset patch
# User P Purkayastha <ppurka@gmail.com>
# Date 1317310855 -28800
# Node ID 469d05f30083d92990be2a0af692062d9b51c7be
# Parent  f8f1496d316ce8556a8d7350de61e0f755c23681
[mq]: trac_10822_fix_zsh_shell.patch

diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -497,7 +497,23 @@
             SHELL_OPTS=" -f"
             ;;
         zsh)
-            SHELL_OPTS=" -f -d"
+            FILE="/tmp/.zshrc"
+            if [ -e "$FILE" ]; then
+                if ! rm -f "$FILE"; then
+                    echo "No permission to delete and create new file $FILE"
+                    exit 1
+                fi
+            fi
+            cat > "$FILE" << EOF
+PATH="$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH"
+export PATH
+PS1="%m:%~ %n$ "
+export PS1
+RPROMPT=" #SAGE_ROOT=${SAGE_ROOT} (sage subshell)"
+export RPROMPT
+EOF
+            export ZDOTDIR="/tmp"
+            SHELL_OPTS="-o noglobalrcs"
             ;;
         *)
             echo >&2 "Unknown shell: $SHELL!"
```




---

archive/issue_comments_113490.json:
```json
{
    "body": "Sorry, I got my exports all backwards.\n\n```diff\n# HG changeset patch\n# User P Purkayastha <ppurka@gmail.com>\n# Date 1317311589 -28800\n# Node ID 09875d34e10e03692a831a8b5cb9f65693c6a7b3\n# Parent  f8f1496d316ce8556a8d7350de61e0f755c23681\n[mq]: trac_10822_fix_zsh_shell.patch\n\ndiff --git a/sage-sage b/sage-sage\n--- a/sage-sage\n+++ b/sage-sage\n@@ -497,7 +497,20 @@\n             SHELL_OPTS=\" -f\"\n             ;;\n         zsh)\n-            SHELL_OPTS=\" -f -d\"\n+            FILE=\"/tmp/.zshrc\"\n+            if [ -e \"$FILE\" ]; then\n+                if ! rm -f \"$FILE\"; then\n+                    echo \"No permission to delete and create new file $FILE\"\n+                    exit 1\n+                fi\n+            fi\n+            cat > \"$FILE\" << EOF\n+export PATH=\"$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH\"\n+export PS1=\"%m:%~ %n$ \"\n+export RPROMPT=\" #SAGE_ROOT=${SAGE_ROOT} (sage subshell)\"\n+EOF\n+            ZDOTDIR=\"/tmp\" && export ZDOTDIR\n+            SHELL_OPTS=\"-o noglobalrcs\"\n             ;;\n         *)\n             echo >&2 \"Unknown shell: $SHELL!\"\n```\n",
    "created_at": "2011-09-29T15:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113490",
    "user": "https://github.com/ppurka"
}
```

Sorry, I got my exports all backwards.

```diff
# HG changeset patch
# User P Purkayastha <ppurka@gmail.com>
# Date 1317311589 -28800
# Node ID 09875d34e10e03692a831a8b5cb9f65693c6a7b3
# Parent  f8f1496d316ce8556a8d7350de61e0f755c23681
[mq]: trac_10822_fix_zsh_shell.patch

diff --git a/sage-sage b/sage-sage
--- a/sage-sage
+++ b/sage-sage
@@ -497,7 +497,20 @@
             SHELL_OPTS=" -f"
             ;;
         zsh)
-            SHELL_OPTS=" -f -d"
+            FILE="/tmp/.zshrc"
+            if [ -e "$FILE" ]; then
+                if ! rm -f "$FILE"; then
+                    echo "No permission to delete and create new file $FILE"
+                    exit 1
+                fi
+            fi
+            cat > "$FILE" << EOF
+export PATH="$SAGE_ROOT:$SAGE_LOCAL/bin:$PATH"
+export PS1="%m:%~ %n$ "
+export RPROMPT=" #SAGE_ROOT=${SAGE_ROOT} (sage subshell)"
+EOF
+            ZDOTDIR="/tmp" && export ZDOTDIR
+            SHELL_OPTS="-o noglobalrcs"
             ;;
         *)
             echo >&2 "Unknown shell: $SHELL!"
```




---

archive/issue_comments_113491.json:
```json
{
    "body": "Replying to [comment:17 ppurka]:\n> What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.\n\nIn section 16.2.5 of [http://zsh.sourceforge.net/Doc/Release/Options.html#Options](http://zsh.sourceforge.net/Doc/Release/Options.html#Options), it says\n\n```\nGLOBAL_RCS (-d) <D>\nIf this option is unset, the startup files /etc/zprofile, /etc/zshrc, /etc/zlogin and /etc/zlogout will not be run. It can be disabled and re-enabled at any time, including inside local startup files (.zshrc, etc.).\n```\n\n\nI'll take a look at the rest of your changes later (as will other people, I hope).",
    "created_at": "2011-09-29T17:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113491",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:17 ppurka]:
> What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.

In section 16.2.5 of [http://zsh.sourceforge.net/Doc/Release/Options.html#Options](http://zsh.sourceforge.net/Doc/Release/Options.html#Options), it says

```
GLOBAL_RCS (-d) <D>
If this option is unset, the startup files /etc/zprofile, /etc/zshrc, /etc/zlogin and /etc/zlogout will not be run. It can be disabled and re-enabled at any time, including inside local startup files (.zshrc, etc.).
```


I'll take a look at the rest of your changes later (as will other people, I hope).



---

archive/issue_comments_113492.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> Replying to [comment:17 ppurka]:\n> > What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.\n> \n> In section 16.2.5 of [http://zsh.sourceforge.net/Doc/Release/Options.html#Options](http://zsh.sourceforge.net/Doc/Release/Options.html#Options), it says\n> {{{\n> GLOBAL_RCS (-d) <D>\n> If this option is unset, the startup files /etc/zprofile, /etc/zshrc, /etc/zlogin and /etc/zlogout will not be run. It can be disabled and re-enabled at any time, including inside local startup files (.zshrc, etc.).\n> }}}\n> \n> I'll take a look at the rest of your changes later (as will other people, I hope).\n\nThanks. It is the same as `-o noglobalopts` then.",
    "created_at": "2011-09-29T17:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113492",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:19 jhpalmieri]:
> Replying to [comment:17 ppurka]:
> > What does the -d option do for zsh? I can't find anything [at the manual](http://zsh.sourceforge.net/Doc/Release/Options.html#Single-Letter-Options) which suggests that that option is available.
> 
> In section 16.2.5 of [http://zsh.sourceforge.net/Doc/Release/Options.html#Options](http://zsh.sourceforge.net/Doc/Release/Options.html#Options), it says
> {{{
> GLOBAL_RCS (-d) <D>
> If this option is unset, the startup files /etc/zprofile, /etc/zshrc, /etc/zlogin and /etc/zlogout will not be run. It can be disabled and re-enabled at any time, including inside local startup files (.zshrc, etc.).
> }}}
> 
> I'll take a look at the rest of your changes later (as will other people, I hope).

Thanks. It is the same as `-o noglobalopts` then.



---

archive/issue_comments_113493.json:
```json
{
    "body": "This obviously needs to be rebased...",
    "created_at": "2012-04-02T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113493",
    "user": "https://github.com/jdemeyer"
}
```

This obviously needs to be rebased...



---

archive/issue_comments_113494.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-02T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113494",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113495.json:
```json
{
    "body": "Moreover: it's better not to use `mktemp -p` or `mktemp -t`: use `mktemp TEMPLATE` which seems to be portable.",
    "created_at": "2012-04-02T10:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113495",
    "user": "https://github.com/jdemeyer"
}
```

Moreover: it's better not to use `mktemp -p` or `mktemp -t`: use `mktemp TEMPLATE` which seems to be portable.



---

archive/issue_comments_113496.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-05T10:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113496",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113497.json:
```json
{
    "body": "I've uploaded my take on what should be done.  Apply patch to root repository.",
    "created_at": "2012-04-05T10:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113497",
    "user": "https://github.com/jasongrout"
}
```

I've uploaded my take on what should be done.  Apply patch to root repository.



---

archive/issue_comments_113498.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-05T14:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113498",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113499.json:
```json
{
    "body": "This still needs to be rebased to a recent beta.",
    "created_at": "2012-04-05T14:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113499",
    "user": "https://github.com/jdemeyer"
}
```

This still needs to be rebased to a recent beta.



---

archive/issue_comments_113500.json:
```json
{
    "body": "I had it based on beta6.  I'm downloading beta12 now.",
    "created_at": "2012-04-05T14:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113500",
    "user": "https://github.com/jasongrout"
}
```

I had it based on beta6.  I'm downloading beta12 now.



---

archive/issue_comments_113501.json:
```json
{
    "body": "apply instead of previous patch",
    "created_at": "2012-04-06T01:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113501",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patch



---

archive/issue_comments_113502.json:
```json
{
    "body": "Attachment [trac-10822-zsh-path.patch](tarball://root/attachments/some-uuid/ticket10822/trac-10822-zsh-path.patch) by @jasongrout created at 2012-04-06 01:22:39\n\nI rebased the patch to beta12",
    "created_at": "2012-04-06T01:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113502",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac-10822-zsh-path.patch](tarball://root/attachments/some-uuid/ticket10822/trac-10822-zsh-path.patch) by @jasongrout created at 2012-04-06 01:22:39

I rebased the patch to beta12



---

archive/issue_comments_113503.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-06T01:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113503",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113504.json:
```json
{
    "body": "The patch looks okay on visual inspection, but I cannot give positive_review because I don't have zsh to test this.",
    "created_at": "2012-04-06T08:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113504",
    "user": "https://github.com/jdemeyer"
}
```

The patch looks okay on visual inspection, but I cannot give positive_review because I don't have zsh to test this.



---

archive/issue_comments_113505.json:
```json
{
    "body": "I run zsh as my shell. But I don't have a Mac to test it on. So, I can't give a proper review either.",
    "created_at": "2012-04-06T09:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113505",
    "user": "https://github.com/ppurka"
}
```

I run zsh as my shell. But I don't have a Mac to test it on. So, I can't give a proper review either.



---

archive/issue_comments_113506.json:
```json
{
    "body": "This change is quite small and looks good. Just needs someone with a mac to test.",
    "created_at": "2012-05-26T15:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113506",
    "user": "https://github.com/ppurka"
}
```

This change is quite small and looks good. Just needs someone with a mac to test.



---

archive/issue_comments_113507.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-26T15:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113507",
    "user": "https://github.com/ppurka"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_113508.json:
```json
{
    "body": "1. Trivial nitpick: it says \"`create a temporary .zshenv to reset the path`\" but shouldn't it say \"`create .zshenv to reset the path.`\", since the file is in fact *not* temporary.\n\n2. After reading the above I still don't get the point of this patch.  Before applying it, on OS X 10.7 I get:\n\n```\n$ zsh\n...\n$ sage -sh\n$ echo $PATH\n(sage-sh) wstein@blastoff:sage-5.0.beta15$ echo $PATH\n/Users/wstein/sage/build/sage-5.0.beta15/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/wstein/sage/build/sage-5.0.beta15/spkg/bin:/Users/wstein/sage/build/sage-5.0.beta15/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/usr/texbin:/Users/wstein/sage/build/sage-5.0.beta15:/Users/wstein/bin:/Users/wstein/local/bin\n```\n\nwhich looks fine to me.",
    "created_at": "2012-05-27T18:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113508",
    "user": "https://github.com/williamstein"
}
```

1. Trivial nitpick: it says "`create a temporary .zshenv to reset the path`" but shouldn't it say "`create .zshenv to reset the path.`", since the file is in fact *not* temporary.

2. After reading the above I still don't get the point of this patch.  Before applying it, on OS X 10.7 I get:

```
$ zsh
...
$ sage -sh
$ echo $PATH
(sage-sh) wstein@blastoff:sage-5.0.beta15$ echo $PATH
/Users/wstein/sage/build/sage-5.0.beta15/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/wstein/sage/build/sage-5.0.beta15/spkg/bin:/Users/wstein/sage/build/sage-5.0.beta15/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/usr/texbin:/Users/wstein/sage/build/sage-5.0.beta15:/Users/wstein/bin:/Users/wstein/local/bin
```

which looks fine to me.



---

archive/issue_comments_113509.json:
```json
{
    "body": "Regarding point 2, try instead to use `chsh` to switch your shell to `/bin/zsh`, open up a new terminal window (now running zsh) and try\n\n```\n$ sage -sh\n$ echo $PATH\n```\n\nagain. When I do this, I get things like /usr/bin at the front of the path.",
    "created_at": "2012-05-27T23:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113509",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding point 2, try instead to use `chsh` to switch your shell to `/bin/zsh`, open up a new terminal window (now running zsh) and try

```
$ sage -sh
$ echo $PATH
```

again. When I do this, I get things like /usr/bin at the front of the path.



---

archive/issue_comments_113510.json:
```json
{
    "body": "In sage -sh, it has this code to pick the shell run:\n\n\n```\n\n    # If $SHELL is unset, default to bash\n    if [ -z \"$SHELL\" ]; then\n        export SHELL=bash\n    fi\n```\n\n\nIs your $SHELL variable set to zsh?",
    "created_at": "2012-05-28T13:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113510",
    "user": "https://github.com/jasongrout"
}
```

In sage -sh, it has this code to pick the shell run:


```

    # If $SHELL is unset, default to bash
    if [ -z "$SHELL" ]; then
        export SHELL=bash
    fi
```


Is your $SHELL variable set to zsh?



---

archive/issue_comments_113511.json:
```json
{
    "body": "I can confirm on a Mac with Sage 5.0 (having run `chsh -s /bin/zsh`) that without the patch my PATH starts with `/usr/bin:/bin:/usr/sbin:/sbin:...`, but after applying the patch it starts with `/Users/gvol/SageStuff/sage-5.0.rc0/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/gvol/SageStuff/sage-5.0.rc0/spkg/bin:/Users/gvol/SageStuff/sage-5.0.rc0/local/bin:`.  \n\nI give it a positive review based on my reading of the comments here that testing on a Mac was all that was required.  Looking at the patch I don't see any problems, but then, I don't use zsh either.",
    "created_at": "2012-05-29T15:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113511",
    "user": "https://github.com/gvol"
}
```

I can confirm on a Mac with Sage 5.0 (having run `chsh -s /bin/zsh`) that without the patch my PATH starts with `/usr/bin:/bin:/usr/sbin:/sbin:...`, but after applying the patch it starts with `/Users/gvol/SageStuff/sage-5.0.rc0/local/Frameworks/Python.framework/Versions/2.5/bin:/Users/gvol/SageStuff/sage-5.0.rc0/spkg/bin:/Users/gvol/SageStuff/sage-5.0.rc0/local/bin:`.  

I give it a positive review based on my reading of the comments here that testing on a Mac was all that was required.  Looking at the patch I don't see any problems, but then, I don't use zsh either.



---

archive/issue_comments_113512.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-29T15:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113512",
    "user": "https://github.com/gvol"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_010874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T13:42:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10756#event-10874"
}
```



---

archive/issue_comments_113513.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-02T13:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10756#issuecomment-113513",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
