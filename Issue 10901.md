# Issue 10901: Make sure symbolic gridline values are okay

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2011-03-22 14:15:21

Assignee: jason, was

CC:  jason dsm

Keywords: beginner

From [this ask.sagemath.org question](http://ask.sagemath.org/question/454/can-gridlines-be-painted-at-sqrt2).

```
plot(x,0,2,gridlines=([sqrt(2)],[]))
```

blows up.  

The fix is probably to make sure that symbolic input with a `n()` method passes something right to matplotlib, which of course cannot handle `sqrt(2)`.  Possibly beginner ticket.


---

Comment by kcrisman created at 2011-03-22 14:18:30

Update: perhaps this is something that could be considered an upstream bug - or a bug that we give a `len()` to symbolic expressions, see DSM's answer in the question.


---

Comment by kcrisman created at 2011-03-23 12:13:04

Update: From the question, Jason says

```
I think matplotlib should check for iterability by either: calling iter(obj) and checking for a TypeError, or doing isinstance(obj, collections.Iterable). 
```

Changing to 'not yet reported upstream'.


---

Comment by kcrisman created at 2011-03-23 12:13:55

We'll still have to include a fix, of course; an mpl change will just make sure the error is caught earlier by them, but we should be making sure we turn sqrt(2) into something plottable.


---

Comment by jason created at 2011-03-23 15:15:53

It is reported: http://thread.gmane.org/gmane.comp.python.matplotlib.devel/10009


---

Comment by mdboom created at 2011-03-24 00:41:04

Committed to matplotlib master here:

https://github.com/matplotlib/matplotlib/commit/0a9e86a91d9cb180919b99363cea1839a8f6196c

Since this has a likelihood of accidental breakage, this is not on the bugfix branch.


---

Comment by dsm created at 2011-03-24 16:51:00

So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..

(3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)?


---

Comment by kcrisman created at 2011-03-24 17:01:50

Replying to [comment:6 dsm]:
> So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..
> 
> (3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)? 

Yes, we fix (1) here.  I don't think that (2) necessarily has to be fixed, as long as we're aware of it.   It's presumably been around a while, and we'd have to deprecate it.  Though of course `number_of_operands` is more accurate.

```
sage: f(x)=x^2+1+sin(ln(x))
sage: len(f)
3
```

seems reasonable...

Changing the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.


---

Comment by dsm created at 2011-03-24 17:39:33

Replying to [comment:7 kcrisman]:

> Changing the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.

Oops!  That wasn't intended.  I couldn't decide if it counted as a stable or unstable release, and I guess I set it to NA instead of restoring it.  [I find it surprisingly easy to make errors on trac.  I think I've assigned a couple of tickets to myself now..]

As for the len issue, I'm inclined to agree with Jason that it should go.  If there's no interpretation of iter(sqrt(x)) natural enough to be canonical, then IMHO len(sqrt(2)) shouldn't work either.  OTOH if we think that it's natural that len(sqrt(2)) should be two, because len counts the operands, then list(sqrt(2)) should be list((sqrt(2)).operands()) and give [2, 1/2].  That goes against my instincts, because I'd assume that taking the len of an expression, or iterating over it, would work over the "terms" of an expression.  But len(x) == 0, because there are no operations so there are no operands, which is completely consistent but isn't what I'd have expected.

I don't think it's important enough for me to learn how Sage deprecation policies work, though, given that I'm still having trouble counting colons. `:-)`


---

Comment by kcrisman created at 2012-05-27 06:46:39

This does actually work now, by the way.

```
plot(x,0,2,gridlines=([sqrt(2)],[]))
```

This doesn't resolve the issue of whether symbolic things should have a `len`.

```

    def __len__(self):
        """
        Returns the number of arguments of this expression.

        EXAMPLES::
        
            sage: var('a,b,c,x,y')
            (a, b, c, x, y)
            sage: len(a)
            0
            sage: len((a^2 + b^2 + (x+y)^2))
            3
            sage: len((a^2))
            2
            sage: len(a*b^2*c)
            3
        """
        return self.number_of_operands()
```

But this has been in for at least three years (the Pynac switch).


---

Comment by jhonrubia6 created at 2016-01-21 18:49:13

Replying to [comment:9 kcrisman]:

> This does actually work now, by the way.
> {{{
> plot(x,0,2,gridlines=([sqrt(2)],[]))
> }}}
> This doesn't resolve the issue of whether symbolic things should have a `len`.
> {{{
> 
>     def __len__(self):
>         """
>         Returns the number of arguments of this expression.
> 
>         EXAMPLES::
>         
>             sage: var('a,b,c,x,y')
>             (a, b, c, x, y)
>             sage: len(a)
>             0
>             sage: len((a^2 + b^2 + (x+y)^2))
>             3
>             sage: len((a^2))
>             2
>             sage: len(a*b^2*c)
>             3
>         """
>         return self.number_of_operands()
> }}}
> But this has been in for at least three years (the Pynac switch).

so, should this go to a _closed_ state? or instead go to a _need_work_ state? in my opinion it should move to a sage-devel discussion before


---

Comment by cturo created at 2017-06-05 20:59:35

I'm a beginner, and found this too hard!


---

Comment by cturo created at 2017-06-05 20:59:35

Changing keywords from "beginner" to "".


---

Comment by tscrim created at 2017-06-06 02:44:01

Changing keywords from "" to "beginner".


---

Comment by tscrim created at 2017-06-06 02:44:01

This is fixed now, so it just needs a doctest added.


---

Comment by @DaveWitteMorris created at 2020-05-27 00:44:55

To close this ticket, we just need a doctest that checks whether the example in the description gives good output, instead of an error.

The discussion of whether symbolic expressions should have a length has been moved to #29738.


---

Comment by @DaveWitteMorris created at 2021-03-14 05:12:21

Thanks for fixing this.

Please add your (real) name in the `Authors:` field and set the status of the ticket to `needs review`. (To do both of these, click on the `Modify Ticket` button to open up a panel that lets you make these changes. Then click `Submit changes` when you are done.) This tells potential reviewers and the automated patchbots that you have completed your work.
----
New commits:


---

Comment by chapoton created at 2021-03-14 07:43:49

This line

```
Verify that :trac `10980` is fixed
```

should be

```
Verify that :trac:`10980` is fixed::
```



---

Comment by git created at 2021-03-14 13:15:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @hur created at 2021-03-14 13:17:59

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2021-03-21 03:15:43

The correction is not right, because the second colon needs to come immediately after "trac", not at the end:

```
:trac:`10980`
```

not

```
:trac`10980`:
```

It needs to be done this way so that `sphinx` will make a correct [hyperlink](https://doc.sagemath.org/html/en/developer/sage_manuals.html#hyperlinks) in the sagemath documentation.


---

Comment by @DaveWitteMorris created at 2021-03-21 19:49:52

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by @DaveWitteMorris created at 2022-07-08 06:55:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-08-07 23:00:44

Resolution: fixed
