# Issue 10901: Make sure symbolic gridline values are okay

archive/issues_010901.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @jasongrout dsm\n\nKeywords: beginner\n\nFrom [this ask.sagemath.org question](http://ask.sagemath.org/question/454/can-gridlines-be-painted-at-sqrt2).\n\n```\nplot(x,0,2,gridlines=([sqrt(2)],[]))\n```\n\nblows up.  \n\nThe fix is probably to make sure that symbolic input with a `n()` method passes something right to matplotlib, which of course cannot handle `sqrt(2)`.  Possibly beginner ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10980\n\n",
    "created_at": "2011-03-22T14:15:21Z",
    "labels": [
        "graphics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Make sure symbolic gridline values are okay",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10901",
    "user": "@kcrisman"
}
```
Assignee: jason, was

CC:  @jasongrout dsm

Keywords: beginner

From [this ask.sagemath.org question](http://ask.sagemath.org/question/454/can-gridlines-be-painted-at-sqrt2).

```
plot(x,0,2,gridlines=([sqrt(2)],[]))
```

blows up.  

The fix is probably to make sure that symbolic input with a `n()` method passes something right to matplotlib, which of course cannot handle `sqrt(2)`.  Possibly beginner ticket.

Issue created by migration from https://trac.sagemath.org/ticket/10980





---

archive/issue_comments_116805.json:
```json
{
    "body": "Update: perhaps this is something that could be considered an upstream bug - or a bug that we give a `len()` to symbolic expressions, see DSM's answer in the question.",
    "created_at": "2011-03-22T14:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116805",
    "user": "@kcrisman"
}
```

Update: perhaps this is something that could be considered an upstream bug - or a bug that we give a `len()` to symbolic expressions, see DSM's answer in the question.



---

archive/issue_comments_116806.json:
```json
{
    "body": "Update: From the question, Jason says\n\n```\nI think matplotlib should check for iterability by either: calling iter(obj) and checking for a TypeError, or doing isinstance(obj, collections.Iterable). \n```\n\nChanging to 'not yet reported upstream'.",
    "created_at": "2011-03-23T12:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116806",
    "user": "@kcrisman"
}
```

Update: From the question, Jason says

```
I think matplotlib should check for iterability by either: calling iter(obj) and checking for a TypeError, or doing isinstance(obj, collections.Iterable). 
```

Changing to 'not yet reported upstream'.



---

archive/issue_comments_116807.json:
```json
{
    "body": "We'll still have to include a fix, of course; an mpl change will just make sure the error is caught earlier by them, but we should be making sure we turn sqrt(2) into something plottable.",
    "created_at": "2011-03-23T12:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116807",
    "user": "@kcrisman"
}
```

We'll still have to include a fix, of course; an mpl change will just make sure the error is caught earlier by them, but we should be making sure we turn sqrt(2) into something plottable.



---

archive/issue_comments_116808.json:
```json
{
    "body": "It is reported: http://thread.gmane.org/gmane.comp.python.matplotlib.devel/10009",
    "created_at": "2011-03-23T15:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116808",
    "user": "@jasongrout"
}
```

It is reported: http://thread.gmane.org/gmane.comp.python.matplotlib.devel/10009



---

archive/issue_comments_116809.json:
```json
{
    "body": "Committed to matplotlib master here:\n\nhttps://github.com/matplotlib/matplotlib/commit/0a9e86a91d9cb180919b99363cea1839a8f6196c\n\nSince this has a likelihood of accidental breakage, this is not on the bugfix branch.",
    "created_at": "2011-03-24T00:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116809",
    "user": "mdboom"
}
```

Committed to matplotlib master here:

https://github.com/matplotlib/matplotlib/commit/0a9e86a91d9cb180919b99363cea1839a8f6196c

Since this has a likelihood of accidental breakage, this is not on the bugfix branch.



---

archive/issue_comments_116810.json:
```json
{
    "body": "So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..\n\n(3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)?",
    "created_at": "2011-03-24T16:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116810",
    "user": "dsm"
}
```

So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..

(3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)?



---

archive/issue_comments_116811.json:
```json
{
    "body": "Replying to [comment:6 dsm]:\n> So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..\n> \n> (3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)? \n\nYes, we fix (1) here.  I don't think that (2) necessarily has to be fixed, as long as we're aware of it.   It's presumably been around a while, and we'd have to deprecate it.  Though of course `number_of_operands` is more accurate.\n\n```\nsage: f(x)=x^2+1+sin(ln(x))\nsage: len(f)\n3\n```\n\nseems reasonable...\n\nChanging the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.",
    "created_at": "2011-03-24T17:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116811",
    "user": "@kcrisman"
}
```

Replying to [comment:6 dsm]:
> So what now?  This bug had three causes:  (1) we weren't passing floats, (2) symbolic expressions have a `__len__` even though they probably shouldn't, and (3) matplotlib used a suboptimal way of determining iterability.  If any of those three didn't fire then there's no bug..
> 
> (3) is fixed upstream and we'll eventually pick it up, which leaves (1) and (2).  Should we fix (1) here and open a new ticket to fix (2)? 

Yes, we fix (1) here.  I don't think that (2) necessarily has to be fixed, as long as we're aware of it.   It's presumably been around a while, and we'd have to deprecate it.  Though of course `number_of_operands` is more accurate.

```
sage: f(x)=x^2+1+sin(ln(x))
sage: len(f)
3
```

seems reasonable...

Changing the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.



---

archive/issue_comments_116812.json:
```json
{
    "body": "Replying to [comment:7 kcrisman]:\n\n> Changing the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.\n\nOops!  That wasn't intended.  I couldn't decide if it counted as a stable or unstable release, and I guess I set it to NA instead of restoring it.  [I find it surprisingly easy to make errors on trac.  I think I've assigned a couple of tickets to myself now..]\n\nAs for the len issue, I'm inclined to agree with Jason that it should go.  If there's no interpretation of iter(sqrt(x)) natural enough to be canonical, then IMHO len(sqrt(2)) shouldn't work either.  OTOH if we think that it's natural that len(sqrt(2)) should be two, because len counts the operands, then list(sqrt(2)) should be list((sqrt(2)).operands()) and give [2, 1/2].  That goes against my instincts, because I'd assume that taking the len of an expression, or iterating over it, would work over the \"terms\" of an expression.  But len(x) == 0, because there are no operations so there are no operands, which is completely consistent but isn't what I'd have expected.\n\nI don't think it's important enough for me to learn how Sage deprecation policies work, though, given that I'm still having trouble counting colons. `:-)`",
    "created_at": "2011-03-24T17:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116812",
    "user": "dsm"
}
```

Replying to [comment:7 kcrisman]:

> Changing the upstream report.  NA is only if literally NA.  In this case, there were a couple things going on, so not NA; according to the post above, it's fixed but not yet in the bugfix branch i.e. stable release.

Oops!  That wasn't intended.  I couldn't decide if it counted as a stable or unstable release, and I guess I set it to NA instead of restoring it.  [I find it surprisingly easy to make errors on trac.  I think I've assigned a couple of tickets to myself now..]

As for the len issue, I'm inclined to agree with Jason that it should go.  If there's no interpretation of iter(sqrt(x)) natural enough to be canonical, then IMHO len(sqrt(2)) shouldn't work either.  OTOH if we think that it's natural that len(sqrt(2)) should be two, because len counts the operands, then list(sqrt(2)) should be list((sqrt(2)).operands()) and give [2, 1/2].  That goes against my instincts, because I'd assume that taking the len of an expression, or iterating over it, would work over the "terms" of an expression.  But len(x) == 0, because there are no operations so there are no operands, which is completely consistent but isn't what I'd have expected.

I don't think it's important enough for me to learn how Sage deprecation policies work, though, given that I'm still having trouble counting colons. `:-)`



---

archive/issue_comments_116813.json:
```json
{
    "body": "This does actually work now, by the way.\n\n```\nplot(x,0,2,gridlines=([sqrt(2)],[]))\n```\n\nThis doesn't resolve the issue of whether symbolic things should have a `len`.\n\n```\n\n    def __len__(self):\n        \"\"\"\n        Returns the number of arguments of this expression.\n\n        EXAMPLES::\n        \n            sage: var('a,b,c,x,y')\n            (a, b, c, x, y)\n            sage: len(a)\n            0\n            sage: len((a^2 + b^2 + (x+y)^2))\n            3\n            sage: len((a^2))\n            2\n            sage: len(a*b^2*c)\n            3\n        \"\"\"\n        return self.number_of_operands()\n```\n\nBut this has been in for at least three years (the Pynac switch).",
    "created_at": "2012-05-27T06:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116813",
    "user": "@kcrisman"
}
```

This does actually work now, by the way.

```
plot(x,0,2,gridlines=([sqrt(2)],[]))
```

This doesn't resolve the issue of whether symbolic things should have a `len`.

```

    def __len__(self):
        """
        Returns the number of arguments of this expression.

        EXAMPLES::
        
            sage: var('a,b,c,x,y')
            (a, b, c, x, y)
            sage: len(a)
            0
            sage: len((a^2 + b^2 + (x+y)^2))
            3
            sage: len((a^2))
            2
            sage: len(a*b^2*c)
            3
        """
        return self.number_of_operands()
```

But this has been in for at least three years (the Pynac switch).



---

archive/issue_comments_116814.json:
```json
{
    "body": "Replying to [comment:9 kcrisman]:\n\n> This does actually work now, by the way.\n> {{{\n> plot(x,0,2,gridlines=([sqrt(2)],[]))\n> }}}\n> This doesn't resolve the issue of whether symbolic things should have a `len`.\n> {{{\n> \n>     def __len__(self):\n>         \"\"\"\n>         Returns the number of arguments of this expression.\n> \n>         EXAMPLES::\n>         \n>             sage: var('a,b,c,x,y')\n>             (a, b, c, x, y)\n>             sage: len(a)\n>             0\n>             sage: len((a^2 + b^2 + (x+y)^2))\n>             3\n>             sage: len((a^2))\n>             2\n>             sage: len(a*b^2*c)\n>             3\n>         \"\"\"\n>         return self.number_of_operands()\n> }}}\n> But this has been in for at least three years (the Pynac switch).\n\nso, should this go to a *closed* state? or instead go to a *need_work* state? in my opinion it should move to a sage-devel discussion before",
    "created_at": "2016-01-21T18:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116814",
    "user": "jhonrubia6"
}
```

Replying to [comment:9 kcrisman]:

> This does actually work now, by the way.
> {{{
> plot(x,0,2,gridlines=([sqrt(2)],[]))
> }}}
> This doesn't resolve the issue of whether symbolic things should have a `len`.
> {{{
> 
>     def __len__(self):
>         """
>         Returns the number of arguments of this expression.
> 
>         EXAMPLES::
>         
>             sage: var('a,b,c,x,y')
>             (a, b, c, x, y)
>             sage: len(a)
>             0
>             sage: len((a^2 + b^2 + (x+y)^2))
>             3
>             sage: len((a^2))
>             2
>             sage: len(a*b^2*c)
>             3
>         """
>         return self.number_of_operands()
> }}}
> But this has been in for at least three years (the Pynac switch).

so, should this go to a *closed* state? or instead go to a *need_work* state? in my opinion it should move to a sage-devel discussion before



---

archive/issue_comments_116815.json:
```json
{
    "body": "I'm a beginner, and found this too hard!",
    "created_at": "2017-06-05T20:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116815",
    "user": "cturo"
}
```

I'm a beginner, and found this too hard!



---

archive/issue_comments_116816.json:
```json
{
    "body": "Changing keywords from \"beginner\" to \"\".",
    "created_at": "2017-06-05T20:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116816",
    "user": "cturo"
}
```

Changing keywords from "beginner" to "".



---

archive/issue_comments_116817.json:
```json
{
    "body": "Changing keywords from \"\" to \"beginner\".",
    "created_at": "2017-06-06T02:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116817",
    "user": "@tscrim"
}
```

Changing keywords from "" to "beginner".



---

archive/issue_comments_116818.json:
```json
{
    "body": "This is fixed now, so it just needs a doctest added.",
    "created_at": "2017-06-06T02:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116818",
    "user": "@tscrim"
}
```

This is fixed now, so it just needs a doctest added.



---

archive/issue_comments_116819.json:
```json
{
    "body": "To close this ticket, we just need a doctest that checks whether the example in the description gives good output, instead of an error.\n\nThe discussion of whether symbolic expressions should have a length has been moved to #29738.",
    "created_at": "2020-05-27T00:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116819",
    "user": "@DaveWitteMorris"
}
```

To close this ticket, we just need a doctest that checks whether the example in the description gives good output, instead of an error.

The discussion of whether symbolic expressions should have a length has been moved to #29738.



---

archive/issue_comments_116820.json:
```json
{
    "body": "Thanks for fixing this.\n\nPlease add your (real) name in the `Authors:` field and set the status of the ticket to `needs review`. (To do both of these, click on the `Modify Ticket` button to open up a panel that lets you make these changes. Then click `Submit changes` when you are done.) This tells potential reviewers and the automated patchbots that you have completed your work.\n----\nNew commits:",
    "created_at": "2021-03-14T05:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116820",
    "user": "@DaveWitteMorris"
}
```

Thanks for fixing this.

Please add your (real) name in the `Authors:` field and set the status of the ticket to `needs review`. (To do both of these, click on the `Modify Ticket` button to open up a panel that lets you make these changes. Then click `Submit changes` when you are done.) This tells potential reviewers and the automated patchbots that you have completed your work.
----
New commits:



---

archive/issue_comments_116821.json:
```json
{
    "body": "This line\n\n```\nVerify that :trac `10980` is fixed\n```\n\nshould be\n\n```\nVerify that :trac:`10980` is fixed::\n```\n",
    "created_at": "2021-03-14T07:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116821",
    "user": "@fchapoton"
}
```

This line

```
Verify that :trac `10980` is fixed
```

should be

```
Verify that :trac:`10980` is fixed::
```




---

archive/issue_comments_116822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-14T13:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116822",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_116823.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-14T13:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116823",
    "user": "@hur"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_116824.json:
```json
{
    "body": "The correction is not right, because the second colon needs to come immediately after \"trac\", not at the end:\n\n```\n:trac:`10980`\n```\n\nnot\n\n```\n:trac`10980`:\n```\n\nIt needs to be done this way so that `sphinx` will make a correct [hyperlink](https://doc.sagemath.org/html/en/developer/sage_manuals.html#hyperlinks) in the sagemath documentation.",
    "created_at": "2021-03-21T03:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116824",
    "user": "@DaveWitteMorris"
}
```

The correction is not right, because the second colon needs to come immediately after "trac", not at the end:

```
:trac:`10980`
```

not

```
:trac`10980`:
```

It needs to be done this way so that `sphinx` will make a correct [hyperlink](https://doc.sagemath.org/html/en/developer/sage_manuals.html#hyperlinks) in the sagemath documentation.



---

archive/issue_comments_116825.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-21T19:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116825",
    "user": "@DaveWitteMorris"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_116826.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116826",
    "user": "@mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_116827.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116827",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_116828.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-08T06:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116828",
    "user": "@DaveWitteMorris"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_116829.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-07T23:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10901#issuecomment-116829",
    "user": "@vbraun"
}
```

Resolution: fixed
