# Issue 20968: algorithm to compute bounds for the joint spectral radius

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-08-10 13:35:58

CC:  slelievre

Implement an algorithm (according to a work of Gripenberg) to obtain some bounds for the joint spectral radius.



---

Comment by dkrenn created at 2016-08-10 13:37:10

The file still needs some polishing...
----
New commits:


---

Comment by git created at 2016-09-02 15:36:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-09-02 15:41:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-09-06 18:21:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-07 08:18:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-07 08:19:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-09-07 08:20:19

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-09-08 09:21:21

As shown from `%prun` this is a bad idea

```
def rho(M):
    return max(R(abs(v)) for v in M.eigenvalues())
```


Moreover, the Python max is *not* reliable for intervals

```
sage: max(RIF(1,3),RIF(0,4)).endpoints()
(1.00000000000000, 3.00000000000000)
```



---

Comment by vdelecroix created at 2016-09-08 09:27:56

If you want much faster lower bound you can use http://perso.uclouvain.be/chia-tche.chang/resources/CB11b_paper.pdf


---

Comment by vdelecroix created at 2016-09-08 09:28:10

Did you have a look at https://perso.uclouvain.be/julien.hendrickx/availablepublications/hscc33_VHJ.pdf ?


---

Comment by dkrenn created at 2016-09-08 14:44:31

Replying to [comment:9 vdelecroix]:
> As shown from `%prun` this is a bad idea
> {{{
> def rho(M):
>     return max(R(abs(v)) for v in M.eigenvalues())
> }}}
> 
> Moreover, the Python max is *not* reliable for intervals
> {{{
> sage: max(RIF(1,3),RIF(0,4)).endpoints()
> (1.00000000000000, 3.00000000000000)
> }}}

Uh oh, I wasn't aware of this. Thanks for pointing it out. I'll change my code soon.


---

Comment by dkrenn created at 2016-09-08 14:46:24

Replying to [comment:10 vdelecroix]:
> If you want much faster lower bound you can use http://perso.uclouvain.be/chia-tche.chang/resources/CB11b_paper.pdf

What's on this ticket suffices for me, that was why I implemented only a basic algorithm.

I suggest to implement extensions/improvements on a follow up ticket. The function `joint_spectral_radius` could/should then be equipped with a parameter `algorithm=...`.


---

Comment by dkrenn created at 2016-09-08 14:47:03

Replying to [comment:11 vdelecroix]:
> Did you have a look at https://perso.uclouvain.be/julien.hendrickx/availablepublications/hscc33_VHJ.pdf ?

Yes.


---

Comment by git created at 2016-09-08 15:19:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-09-08 15:20:35

Replying to [comment:12 dkrenn]:
> Replying to [comment:9 vdelecroix]:
> > As shown from `%prun` this is a bad idea
> > {{{
> > def rho(M):
> >     return max(R(abs(v)) for v in M.eigenvalues())
> > }}}
> > 
> > Moreover, the Python max is *not* reliable for intervals
> > {{{
> > sage: max(RIF(1,3),RIF(0,4)).endpoints()
> > (1.00000000000000, 3.00000000000000)
> > }}}
> 
> Uh oh, I wasn't aware of this. Thanks for pointing it out. I'll change my code soon.

Changed now.


---

Comment by vdelecroix created at 2019-03-04 20:05:12

merge conflict


---

Comment by vdelecroix created at 2019-03-04 20:05:12

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-03-27 17:07:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2019-03-27 17:14:55

Merged in 8.7.


---

Comment by dkrenn created at 2019-03-27 17:14:55

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2019-03-27 17:16:28

On 8.7.beta1 and 8.7.beta2 some patchbots failed on the following, but some not. Strange. Let's wait for the 8.7 patchbots and then see.

```
File "src/sage/matrix/joint_spectral_radius.py", line 98, in sage.matrix.joint_spectral_radius.?
Failed example:
    joint_spectral_radius(  # long time
        (Matrix([[3, 0],  [1, 3]]) / 5,
         Matrix([[3, -3], [0, -1]]) / 5),
        delta=RIF(0.01))
Expected:
    DEBUG:...:m=2, alpha=0.6000000000000000?, beta=0.70827625302982189?, len(T)=4
[...]
Got:
    DEBUG:sage.matrix.joint_spectral_radius:m=2, alpha=0.6000000000000000?, beta=0.70827625302982201?, len(T)=4
[...]
```



---

Comment by git created at 2019-03-28 15:25:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2019-03-28 15:28:31

Replying to [comment:20 dkrenn]:
> On 8.7.beta1 and 8.7.beta2 some patchbots failed on the following, but some not. Strange. Let's wait for the 8.7 patchbots and then see.
> {{{
> File "src/sage/matrix/joint_spectral_radius.py", line 98, in sage.matrix.joint_spectral_radius.?
> Failed example:
>     joint_spectral_radius(  # long time
>         (Matrix([[3, 0],  [1, 3]]) / 5,
>          Matrix([[3, -3], [0, -1]]) / 5),
>         delta=RIF(0.01))
> Expected:
>     DEBUG:...:m=2, alpha=0.6000000000000000?, beta=0.70827625302982189?, len(T)=4
> [...]
> Got:
>     DEBUG:sage.matrix.joint_spectral_radius:m=2, alpha=0.6000000000000000?, beta=0.70827625302982201?, len(T)=4
> [...]
> }}}

Should be fixed now.


---

Comment by git created at 2019-03-29 09:47:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-03-31 17:20:46

You would better use arb matrices whose multiplications are infinitely faster than the generic Sage matrices (which is what is used for mpir). With this change, you can write direct C code for the routines `max`, `min`, `rho`, `pp` and `p`. Even if your input are rational matrices, I bet that it is better to first convert them to real ball matrices. Carrying large numerators/denominators is most of the time a terrible idea.


---

Comment by vdelecroix created at 2019-03-31 17:22:10

Why using the 2-norm (involving the square root) as a default? Wouldn't the 1-norm or oo-norm be ok?


---

Comment by vdelecroix created at 2019-03-31 17:22:31

When the input is inexact (e.g. mpir) this is absolutely wrong

```
max(R(abs(v)) for v in M.eigenvalues())
```



---

Comment by vdelecroix created at 2019-03-31 17:22:39

Changing status from needs_review to needs_work.


---

Comment by dkrenn created at 2019-04-01 08:43:31

Replying to [comment:25 vdelecroix]:
> You would better use arb matrices whose multiplications are infinitely faster than the generic Sage matrices (which is what is used for mpir). 

The problem with arb matrices (and even with matrices over interval fields) is that they do not support computation of eigenvalues. Therefore, when writing the code, the decision of sticking to the given exact matrices was made.


---

Comment by vdelecroix created at 2019-04-01 09:01:55

Replying to [comment:29 dkrenn]:
> Replying to [comment:25 vdelecroix]:
> > You would better use arb matrices whose multiplications are infinitely faster than the generic Sage matrices (which is what is used for mpir). 
> 
> The problem with arb matrices (and even with matrices over interval fields) is that they do not support computation of eigenvalues. Therefore, when writing the code, the decision of sticking to the given exact matrices was made.

http://arblib.org/arb_mat.html#eigenvalues-and-eigenvectors


---

Comment by vdelecroix created at 2019-04-01 09:02:54

(though, there is a warning: "The functions in this section are experimental")


---

Comment by dkrenn created at 2019-04-02 13:43:26

Replying to [comment:26 vdelecroix]:
> Why using the 2-norm (involving the square root) as a default? Wouldn't the 1-norm or oo-norm be ok?

Because this is the default for `.norm` of a matrix (which unfortunately only results a `RDF` element).


---

Comment by dkrenn created at 2019-04-02 13:44:24

Replying to [comment:30 vdelecroix]:
> Replying to [comment:29 dkrenn]:
> http://arblib.org/arb_mat.html#eigenvalues-and-eigenvectors
Replying to [comment:31 vdelecroix]:
> (though, there is a warning: "The functions in this section are experimental")

So no change here.


---

Comment by dkrenn created at 2019-04-02 14:00:52

Replying to [comment:27 vdelecroix]:
> When the input is inexact (e.g. mpir) this is absolutely wrong
> {{{
> max(R(abs(v)) for v in M.eigenvalues())
> }}}

Note that there is

```
    def max(m):
        m = list(m)
        return m[0].max(*m[1:])
```

defined a couple of lines above, so this is IMO indeed what is wanted.

And, eigenvalues are not there for inexact rings:

```
sage: Matrix(RIF, [[1,2],[4,5]]).eigenvalues()
/opt/sage/8.6/src/bin/sage-ipython:1: UserWarning: Using generic algorithm for an inexact ring, which will probably give incorrect results due to numerical precision issues.
... 
NotImplementedError: 
```



---

Comment by dkrenn created at 2019-04-02 14:02:44

Replying to [comment:25 vdelecroix]:
> You would better use arb matrices whose multiplications are infinitely faster than the generic Sage matrices (which is what is used for mpir). With this change, you can write direct C code for the routines `max`, `min`, `rho`, `pp` and `p`. Even if your input are rational matrices, I bet that it is better to first convert them to real ball matrices. Carrying large numerators/denominators is most of the time a terrible idea.

I agree that using matrices over `QQ` is not ideal, but with the eigenvalue discussion I do not see much other choices here.

And, after all, this should be a first implementation to compute something at all. Improvments later on are very welcome.


---

Comment by dkrenn created at 2019-04-02 14:02:56

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2019-04-02 14:25:21

Replying to [comment:35 dkrenn]:
> Replying to [comment:25 vdelecroix]:
> And, after all, this should be a first implementation to compute something at all. Improvments later on are very welcome.

true :-)


---

Comment by vdelecroix created at 2019-04-04 16:11:40

If you do computations over rational numbers I don't see the point in returning an element in `RIF`. What you compute is an interval bounded by rational numbers isn't it?


---

Comment by vdelecroix created at 2019-04-04 16:34:26

Replying to [comment:34 dkrenn]:
> Replying to [comment:27 vdelecroix]:
> > When the input is inexact (e.g. mpir) this is absolutely wrong
> > {{{
> > max(R(abs(v)) for v in M.eigenvalues())
> > }}}
> 
> Note that there is
> {{{
>     def max(m):
>         m = list(m)
>         return m[0].max(*m[1:])
> }}}
> defined a couple of lines above, so this is IMO indeed what is wanted.

And there is also

```
def rho(M):
   return max(R(abs(v)) for v in M.eigenvalues())
```

which is incorrect (since here `R=RIF` (at least in the default situation)).


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mmezzarobba created at 2020-08-19 15:10:12

Replying to [comment:30 vdelecroix]:
> http://arblib.org/arb_mat.html#eigenvalues-and-eigenvectors

Sage wrappers at #30393.


---

Comment by slelievre created at 2020-09-08 01:03:55

Changing status from needs_review to needs_work.


---

Comment by slelievre created at 2020-09-08 01:03:55

Needs rebasing on latest develop.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
