# Issue 20972: update fricas to 1.2.7 (current)

archive/issues_020972.json:
```json
{
    "body": "CC:  @dkrenn @mantepse @hemmecke\n\nsubject says it all, see http://fricas.sourceforge.net/\n\nIssue created by migration from https://trac.sagemath.org/ticket/21209\n\n",
    "created_at": "2016-08-10T16:52:59Z",
    "labels": [
        "component: packages: experimental",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "update fricas to 1.2.7 (current)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20972",
    "user": "https://github.com/dimpase"
}
```
CC:  @dkrenn @mantepse @hemmecke

subject says it all, see http://fricas.sourceforge.net/

Issue created by migration from https://trac.sagemath.org/ticket/21209





---

archive/issue_comments_289901.json:
```json
{
    "body": "I am currently rebuilding sage-develop...\n\nDo I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?",
    "created_at": "2016-08-11T19:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289901",
    "user": "https://github.com/mantepse"
}
```

I am currently rebuilding sage-develop...

Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?



---

archive/issue_comments_289902.json:
```json
{
    "body": "Replying to [comment:4 mantepse]:\n> Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?\n\nWould make sense.\n\nNot sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.\n\nIf you do, you could create an `spkg-src` script, or at least document what you did in *\"Special !Update/Build Instructions\"* in `SPKG.txt`.",
    "created_at": "2016-08-11T19:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289902",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:4 mantepse]:
> Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?

Would make sense.

Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.

If you do, you could create an `spkg-src` script, or at least document what you did in *"Special !Update/Build Instructions"* in `SPKG.txt`.



---

archive/issue_comments_289903.json:
```json
{
    "body": "More precisely, `fricas-VERSION-full.tar.bz2` in `checksums.ini` is supposed to work as well.",
    "created_at": "2016-08-11T19:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289903",
    "user": "https://github.com/nexttime"
}
```

More precisely, `fricas-VERSION-full.tar.bz2` in `checksums.ini` is supposed to work as well.



---

archive/issue_comments_289904.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> Replying to [comment:4 mantepse]:\n> > Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?\n> \n> Would make sense.\n>\n> Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.\n\nAs far as I know: no, the things included in the \"full\" tarball are precisely those needed.\n\nUnfortunately, build with ecl fails for the same reason as reported.",
    "created_at": "2016-08-11T19:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289904",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:5 leif]:
> Replying to [comment:4 mantepse]:
> > Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?
> 
> Would make sense.
>
> Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.

As far as I know: no, the things included in the "full" tarball are precisely those needed.

Unfortunately, build with ecl fails for the same reason as reported.



---

archive/issue_comments_289905.json:
```json
{
    "body": "From Dima via sage-devel:\n\nECL does not use uffi: prefix any more, it's ffi: instead, according to their docs.\nReplacing all the  uffi: with ffi: in src/lisp/fricas-lisp.lisp makes compiler happy.\n\nCurrently running the build, takes a while...",
    "created_at": "2016-08-11T19:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289905",
    "user": "https://github.com/mantepse"
}
```

From Dima via sage-devel:

ECL does not use uffi: prefix any more, it's ffi: instead, according to their docs.
Replacing all the  uffi: with ffi: in src/lisp/fricas-lisp.lisp makes compiler happy.

Currently running the build, takes a while...



---

archive/issue_comments_289906.json:
```json
{
    "body": "Dima said the following works:\n\n```diff\ndiff -Naur fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp fricas-1.2.7/src/lisp/fricas-lisp.lisp\n--- fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp\t2015-09-25 02:06:15.000000000 +0200\n+++ fricas-1.2.7/src/lisp/fricas-lisp.lisp\t2016-08-11 21:57:25.840863287 +0200\n@@ -556,10 +556,10 @@\n                     (dolist (el strs)\n                         (setf wrapper `(FFI:WITH-CSTRING ,el ,wrapper)))\n                     (setf wrapper `(defun ,name ,largs ,wrapper))\n-                    `(progn (uffi:def-function (,c-name ,sym)\n+                    `(progn (ffi:def-function (,c-name ,sym)\n                                 ,fargs :returning ,l-ret)\n                             ,wrapper))\n-                `(uffi:def-function (,c-name ,name)\n+                `(ffi:def-function (,c-name ,name)\n                      ,fargs :returning ,l-ret)))))\n \n (defmacro fricas-foreign-call (name c-name return-type &rest arguments)\n@@ -788,14 +788,14 @@\n #+:ecl\n (progn\n \n-(uffi:def-function (\"sock_get_string_buf\" sock_get_string_buf_wrapper)\n+(ffi:def-function (\"sock_get_string_buf\" sock_get_string_buf_wrapper)\n                    ((purpose :int) (buf (:array :unsigned-char 10000)) (len :int))\n                    :returning :void)\n \n (defun |sockGetStringFrom| (purpose)\n-    (uffi:with-foreign-object (buf '(:array :unsigned-char 10000))\n+    (ffi:with-foreign-object (buf '(:array :unsigned-char 10000))\n         (sock_get_string_buf_wrapper purpose buf 10000)\n-        (uffi:convert-from-foreign-string buf)))\n+        (ffi:convert-from-foreign-string buf)))\n \n )\n \n@@ -825,7 +825,7 @@\n   (LISP::defentry |makedir| (LISP::string)         (LISP::int \"makedir\")))\n \n #+:ecl\n-(uffi:def-function (\"directoryp\" raw_file_kind)\n+(ffi:def-function (\"directoryp\" raw_file_kind)\n                    ((arg :cstring))\n                    :returning :int)\n #+:ecl\n@@ -834,7 +834,7 @@\n            (raw_file_kind cname)))\n \n #+:ecl\n-(uffi:def-function (\"makedir\" raw_makedir)\n+(ffi:def-function (\"makedir\" raw_makedir)\n                    ((arg :cstring))\n                    :returning :int)\n \n```\n\n\n(`sed -i 's/uffi:/ffi:/' fricas-1.2.7/src/lisp/fricas-lisp.lisp`)",
    "created_at": "2016-08-11T19:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289906",
    "user": "https://github.com/nexttime"
}
```

Dima said the following works:

```diff
diff -Naur fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp fricas-1.2.7/src/lisp/fricas-lisp.lisp
--- fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp	2015-09-25 02:06:15.000000000 +0200
+++ fricas-1.2.7/src/lisp/fricas-lisp.lisp	2016-08-11 21:57:25.840863287 +0200
@@ -556,10 +556,10 @@
                     (dolist (el strs)
                         (setf wrapper `(FFI:WITH-CSTRING ,el ,wrapper)))
                     (setf wrapper `(defun ,name ,largs ,wrapper))
-                    `(progn (uffi:def-function (,c-name ,sym)
+                    `(progn (ffi:def-function (,c-name ,sym)
                                 ,fargs :returning ,l-ret)
                             ,wrapper))
-                `(uffi:def-function (,c-name ,name)
+                `(ffi:def-function (,c-name ,name)
                      ,fargs :returning ,l-ret)))))
 
 (defmacro fricas-foreign-call (name c-name return-type &rest arguments)
@@ -788,14 +788,14 @@
 #+:ecl
 (progn
 
-(uffi:def-function ("sock_get_string_buf" sock_get_string_buf_wrapper)
+(ffi:def-function ("sock_get_string_buf" sock_get_string_buf_wrapper)
                    ((purpose :int) (buf (:array :unsigned-char 10000)) (len :int))
                    :returning :void)
 
 (defun |sockGetStringFrom| (purpose)
-    (uffi:with-foreign-object (buf '(:array :unsigned-char 10000))
+    (ffi:with-foreign-object (buf '(:array :unsigned-char 10000))
         (sock_get_string_buf_wrapper purpose buf 10000)
-        (uffi:convert-from-foreign-string buf)))
+        (ffi:convert-from-foreign-string buf)))
 
 )
 
@@ -825,7 +825,7 @@
   (LISP::defentry |makedir| (LISP::string)         (LISP::int "makedir")))
 
 #+:ecl
-(uffi:def-function ("directoryp" raw_file_kind)
+(ffi:def-function ("directoryp" raw_file_kind)
                    ((arg :cstring))
                    :returning :int)
 #+:ecl
@@ -834,7 +834,7 @@
            (raw_file_kind cname)))
 
 #+:ecl
-(uffi:def-function ("makedir" raw_makedir)
+(ffi:def-function ("makedir" raw_makedir)
                    ((arg :cstring))
                    :returning :int)
 
```


(`sed -i 's/uffi:/ffi:/' fricas-1.2.7/src/lisp/fricas-lisp.lisp`)



---

archive/issue_comments_289907.json:
```json
{
    "body": "I can confirm this, the build just finished.  I am now looking for tests.",
    "created_at": "2016-08-11T20:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289907",
    "user": "https://github.com/mantepse"
}
```

I can confirm this, the build just finished.  I am now looking for tests.



---

archive/issue_comments_289908.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-08-11T20:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289908",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_289909.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-11T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289909",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289910.json:
```json
{
    "body": "Here is a discussion on [FriCAS list](https://groups.google.com/d/msg/fricas-devel/tko6MdXgFNM/fRb_JgGhCAAJ).\nI take it that they see this as a bug. Perhaps there is a more intelligent way to fix this, more CL-y one...",
    "created_at": "2016-08-11T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289910",
    "user": "https://github.com/dimpase"
}
```

Here is a discussion on [FriCAS list](https://groups.google.com/d/msg/fricas-devel/tko6MdXgFNM/fRb_JgGhCAAJ).
I take it that they see this as a bug. Perhaps there is a more intelligent way to fix this, more CL-y one...



---

archive/issue_comments_289911.json:
```json
{
    "body": "As far as I can see fix is CL-y, because it is fixing precisely the ecl-dependend functions...\n\nI am still looking into the tests, but I suppose fixing them belongs to a different ticket.\n\nCan I give this positive review?  (It works on my computer...)",
    "created_at": "2016-08-11T20:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289911",
    "user": "https://github.com/mantepse"
}
```

As far as I can see fix is CL-y, because it is fixing precisely the ecl-dependend functions...

I am still looking into the tests, but I suppose fixing them belongs to a different ticket.

Can I give this positive review?  (It works on my computer...)



---

archive/issue_comments_289912.json:
```json
{
    "body": "`SPKG.txt` should get fixed and updated (as the patch has no header)... ;-)\n\nI'd also add `[ -r \"$patch\" ] && ...` as usual.\n\nIs there a test suite?\n\nDoes `make install` install the docs as well?  Do we otherwise want to install them, and if so, how, where?",
    "created_at": "2016-08-11T20:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289912",
    "user": "https://github.com/nexttime"
}
```

`SPKG.txt` should get fixed and updated (as the patch has no header)... ;-)

I'd also add `[ -r "$patch" ] && ...` as usual.

Is there a test suite?

Does `make install` install the docs as well?  Do we otherwise want to install them, and if so, how, where?



---

archive/issue_comments_289913.json:
```json
{
    "body": "P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.",
    "created_at": "2016-08-11T20:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289913",
    "user": "https://github.com/nexttime"
}
```

P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.



---

archive/issue_comments_289914.json:
```json
{
    "body": "Replying to [comment:16 leif]:\n> P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.\n\nNeedless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)",
    "created_at": "2016-08-11T21:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289914",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:16 leif]:
> P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.

Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)



---

archive/issue_comments_289915.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> Replying to [comment:16 leif]:\n> > P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.\n> \n> Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)\n\nThere are more elsewhere.\n\n(I assume you **did** specify `--optional=fricas`... ;-) )",
    "created_at": "2016-08-11T21:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289915",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:17 dimpase]:
> Replying to [comment:16 leif]:
> > P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.
> 
> Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)

There are more elsewhere.

(I assume you **did** specify `--optional=fricas`... ;-) )



---

archive/issue_comments_289916.json:
```json
{
    "body": "There is one trivial fix in ```axiom.py``` (line 686 should not be \"\\leqno(11)\" but rather \"...\"), but the conversion of even basic fricas types to sage types is broken.\n\nCan anybody tell me where the method ``variables`` comes from (is implemented):\n\n```\nsage: a = fricas(1/2)\nsage: a.variables()\n[]\n```\n\n?",
    "created_at": "2016-08-11T21:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289916",
    "user": "https://github.com/mantepse"
}
```

There is one trivial fix in ```axiom.py``` (line 686 should not be "\leqno(11)" but rather "..."), but the conversion of even basic fricas types to sage types is broken.

Can anybody tell me where the method ``variables`` comes from (is implemented):

```
sage: a = fricas(1/2)
sage: a.variables()
[]
```

?



---

archive/issue_comments_289917.json:
```json
{
    "body": "Just found out, it's provided by FriCAS.  But it's use is very likely abuse.",
    "created_at": "2016-08-11T21:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289917",
    "user": "https://github.com/mantepse"
}
```

Just found out, it's provided by FriCAS.  But it's use is very likely abuse.



---

archive/issue_comments_289918.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-11T22:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289919.json:
```json
{
    "body": "For `fricas(1/2).sage()`, the fix looks doable, one needs to deal with `FriCAS`'s type Fraction. But the following is a bit weird:\n\n```\nsage: fricas(1/x).type()\nFraction(Polynomial(Integer))\nsage: fricas(1/x).denominator()\nx\nsage: fricas(1/x).numerator()\n1\nsage: fricas(1/x).numerator().type()\nFraction(Polynomial(Integer))\nsage: fricas(1/x).denominator().type()\nFraction(Polynomial(Integer))\n```\n\nWhy do types of numerators and denominator are still `Fraction(...)`? This does not look right.",
    "created_at": "2016-08-11T22:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289919",
    "user": "https://github.com/dimpase"
}
```

For `fricas(1/2).sage()`, the fix looks doable, one needs to deal with `FriCAS`'s type Fraction. But the following is a bit weird:

```
sage: fricas(1/x).type()
Fraction(Polynomial(Integer))
sage: fricas(1/x).denominator()
x
sage: fricas(1/x).numerator()
1
sage: fricas(1/x).numerator().type()
Fraction(Polynomial(Integer))
sage: fricas(1/x).denominator().type()
Fraction(Polynomial(Integer))
```

Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.



---

archive/issue_comments_289920.json:
```json
{
    "body": "Replying to [comment:22 dimpase]:\n\n> Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.\n\nThis is actually correct.  You want `denom` and `numer`.",
    "created_at": "2016-08-11T22:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289920",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:22 dimpase]:

> Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.

This is actually correct.  You want `denom` and `numer`.



---

archive/issue_comments_289921.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-12T15:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-12T16:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289923.json:
```json
{
    "body": "OK, all done. Please have another look.\nBy the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n\nStarting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.",
    "created_at": "2016-08-12T16:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289923",
    "user": "https://github.com/dimpase"
}
```

OK, all done. Please have another look.
By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.

Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.



---

archive/issue_comments_289924.json:
```json
{
    "body": "Replying to [comment:26 dimpase]:\n> By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n\nHmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)\n\n\\\\\n \n> Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.\n\nIs this a problem on MacOS X?",
    "created_at": "2016-08-12T16:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289924",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:26 dimpase]:
> By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.

Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)

\\
 
> Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.

Is this a problem on MacOS X?



---

archive/issue_comments_289925.json:
```json
{
    "body": "Ok, looks better.  (Haven't pulled nor run tests though yet.)\n\n\\\\\n\nAre the (upload) scripts smart enough to remove the old version if we keep the `-full`?  (I'm not sure, but don't care much either.  I guess the mirrors will only delete if we do so as well.)",
    "created_at": "2016-08-12T16:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289925",
    "user": "https://github.com/nexttime"
}
```

Ok, looks better.  (Haven't pulled nor run tests though yet.)

\\

Are the (upload) scripts smart enough to remove the old version if we keep the `-full`?  (I'm not sure, but don't care much either.  I guess the mirrors will only delete if we do so as well.)



---

archive/issue_comments_289926.json:
```json
{
    "body": "Oh, forgot:\n\nA note in the patch (probably a link to the upstream report) would be good as well.",
    "created_at": "2016-08-12T16:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289926",
    "user": "https://github.com/nexttime"
}
```

Oh, forgot:

A note in the patch (probably a link to the upstream report) would be good as well.



---

archive/issue_comments_289927.json:
```json
{
    "body": "Replying to [comment:27 leif]:\n> Replying to [comment:26 dimpase]:\n> > By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n> \n> Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)\n> \n> \\\\\n>  \n> > Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.\n> \n> Is this a problem on MacOS X?\n> \nIt's not a problem on SMC - it just prints a warning, and carries on regardless (probably the same on OSX). Anyhow, there is an option to disable GUI at startup completely.",
    "created_at": "2016-08-12T16:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289927",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:27 leif]:
> Replying to [comment:26 dimpase]:
> > By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.
> 
> Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)
> 
> \\
>  
> > Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.
> 
> Is this a problem on MacOS X?
> 
It's not a problem on SMC - it just prints a warning, and carries on regardless (probably the same on OSX). Anyhow, there is an option to disable GUI at startup completely.



---

archive/issue_comments_289928.json:
```json
{
    "body": "Replying to [comment:29 leif]:\n> Oh, forgot:\n> \n> A note in the patch (probably a link to the upstream report) would be good as well.\n>  \nThis patch shall go as soon as new FriCAS is released. They already [have it](https://github.com/fricas/fricas/commit/9146dcb84a6f671cf0699d8df568c20a0a95553f) in their repos.",
    "created_at": "2016-08-12T16:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289928",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:29 leif]:
> Oh, forgot:
> 
> A note in the patch (probably a link to the upstream report) would be good as well.
>  
This patch shall go as soon as new FriCAS is released. They already [have it](https://github.com/fricas/fricas/commit/9146dcb84a6f671cf0699d8df568c20a0a95553f) in their repos.



---

archive/issue_comments_289929.json:
```json
{
    "body": "OK.",
    "created_at": "2016-08-12T16:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289929",
    "user": "https://github.com/nexttime"
}
```

OK.



---

archive/issue_comments_289930.json:
```json
{
    "body": "Changing keywords from \"\" to \"uffi ECL\".",
    "created_at": "2016-08-12T16:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289930",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "uffi ECL".



---

archive/issue_comments_289931.json:
```json
{
    "body": "ping?",
    "created_at": "2016-08-14T10:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289931",
    "user": "https://github.com/dimpase"
}
```

ping?



---

archive/issue_comments_289932.json:
```json
{
    "body": "Since the interface has its own ticket #21231 I vote for merging this as soon as possible.\n\nMartin",
    "created_at": "2016-08-14T15:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289932",
    "user": "https://github.com/mantepse"
}
```

Since the interface has its own ticket #21231 I vote for merging this as soon as possible.

Martin



---

archive/issue_comments_289933.json:
```json
{
    "body": "I'll trigger a final test...\n\nDoes #21231 logically depend on this (apart from the UFFI patch)?",
    "created_at": "2016-08-14T15:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289933",
    "user": "https://github.com/nexttime"
}
```

I'll trigger a final test...

Does #21231 logically depend on this (apart from the UFFI patch)?



---

archive/issue_comments_289934.json:
```json
{
    "body": "Replying to [comment:36 leif]:\n> I'll trigger a final test...\n> \n> Does #21231 logically depend on this (apart from the UFFI patch)?\n\nthis ticket updates the FriCAS version too, you know... :-)",
    "created_at": "2016-08-14T15:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289934",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:36 leif]:
> I'll trigger a final test...
> 
> Does #21231 logically depend on this (apart from the UFFI patch)?

this ticket updates the FriCAS version too, you know... :-)



---

archive/issue_comments_289935.json:
```json
{
    "body": "Replying to [comment:37 dimpase]:\n> Replying to [comment:36 leif]:\n> > I'll trigger a final test...\n> > \n> > Does #21231 logically depend on this (apart from the UFFI patch)?\n> \n> this ticket updates the FriCAS version too, you know... :-) \n\n1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).\n\n2) The *Dependencies* field of #21231 is empty.\n\nSo I was asking mainly because of 2).",
    "created_at": "2016-08-14T15:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289935",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:37 dimpase]:
> Replying to [comment:36 leif]:
> > I'll trigger a final test...
> > 
> > Does #21231 logically depend on this (apart from the UFFI patch)?
> 
> this ticket updates the FriCAS version too, you know... :-) 

1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).

2) The *Dependencies* field of #21231 is empty.

So I was asking mainly because of 2).



---

archive/issue_comments_289936.json:
```json
{
    "body": "As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.",
    "created_at": "2016-08-14T15:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289936",
    "user": "https://github.com/mantepse"
}
```

As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.



---

archive/issue_comments_289937.json:
```json
{
    "body": "Replying to [comment:39 mantepse]:\n> As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.\n\nIMHO it is better to stick with a version provided by Sage, to make sure that all doctests pass (for the output might depend on FriCAS version).",
    "created_at": "2016-08-14T15:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289937",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:39 mantepse]:
> As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.

IMHO it is better to stick with a version provided by Sage, to make sure that all doctests pass (for the output might depend on FriCAS version).



---

archive/issue_comments_289938.json:
```json
{
    "body": "Replying to [comment:38 leif]:\n> Replying to [comment:37 dimpase]:\n> > Replying to [comment:36 leif]:\n> > > I'll trigger a final test...\n> > > \n> > > Does #21231 logically depend on this (apart from the UFFI patch)?\n> > \n> > this ticket updates the FriCAS version too, you know... :-) \n> \n> 1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).\n> \nto my non-musical ear, minor does not differ much from major...\n\n> 2) The *Dependencies* field of #21231 is empty.\n\n#21231 is about a different, new interface.\n\n> \n> So I was asking mainly because of 2).\n>",
    "created_at": "2016-08-14T15:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289938",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:38 leif]:
> Replying to [comment:37 dimpase]:
> > Replying to [comment:36 leif]:
> > > I'll trigger a final test...
> > > 
> > > Does #21231 logically depend on this (apart from the UFFI patch)?
> > 
> > this ticket updates the FriCAS version too, you know... :-) 
> 
> 1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).
> 
to my non-musical ear, minor does not differ much from major...

> 2) The *Dependencies* field of #21231 is empty.

#21231 is about a different, new interface.

> 
> So I was asking mainly because of 2).
>



---

archive/issue_comments_289939.json:
```json
{
    "body": "Replying to [comment:38 leif]:\n> 2) The *Dependencies* field of #21231 is empty.\nwell, no, it is not.",
    "created_at": "2016-08-14T15:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289939",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:38 leif]:
> 2) The *Dependencies* field of #21231 is empty.
well, no, it is not.



---

archive/issue_comments_289940.json:
```json
{
    "body": "Replying to [comment:42 dimpase]:\n> Replying to [comment:38 leif]:\n> > 2) The *Dependencies* field of #21231 is empty.\n> well, no, it is not.\n\nRace condition. ;-)",
    "created_at": "2016-08-14T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289940",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:42 dimpase]:
> Replying to [comment:38 leif]:
> > 2) The *Dependencies* field of #21231 is empty.
> well, no, it is not.

Race condition. ;-)



---

archive/issue_comments_289941.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-14T16:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289941",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289942.json:
```json
{
    "body": "I won't comment on the 5043 style warnings... XD",
    "created_at": "2016-08-14T16:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289942",
    "user": "https://github.com/nexttime"
}
```

I won't comment on the 5043 style warnings... XD



---

archive/issue_comments_289943.json:
```json
{
    "body": "Replying to [comment:44 leif]:\n> I won't comment on the 5043 style warnings... XD\n[Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...",
    "created_at": "2016-08-14T20:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289943",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:44 leif]:
> I won't comment on the 5043 style warnings... XD
[Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...



---

archive/issue_comments_289944.json:
```json
{
    "body": "Replying to [comment:45 dimpase]:\n> Replying to [comment:44 leif]:\n> > I won't comment on the 5043 style warnings... XD\n> [Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...\n\nWell, [unfortunately due to popular demand this product is currently out of stock.](http://indiarush.com/velvet-zari-work-green-semi-stiitched-lehenga-style-saree-5043/)",
    "created_at": "2016-08-14T20:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289944",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:45 dimpase]:
> Replying to [comment:44 leif]:
> > I won't comment on the 5043 style warnings... XD
> [Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...

Well, [unfortunately due to popular demand this product is currently out of stock.](http://indiarush.com/velvet-zari-work-green-semi-stiitched-lehenga-style-saree-5043/)



---

archive/issue_comments_289945.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-15T18:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289945",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019888.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-08-15T18:27:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20972#event-19888"
}
```



---

archive/issue_comments_289946.json:
```json
{
    "body": "Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...",
    "created_at": "2016-08-27T21:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289946",
    "user": "https://github.com/nexttime"
}
```

Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...



---

archive/issue_comments_289947.json:
```json
{
    "body": "Replying to [comment:48 leif]:\n> Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n\nCould you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?",
    "created_at": "2016-08-28T06:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289947",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:48 leif]:
> Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...

Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?



---

archive/issue_comments_289948.json:
```json
{
    "body": "Replying to [comment:49 mantepse]:\n> Replying to [comment:48 leif]:\n> > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n> \n> Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n\nJust with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n\nSo when reviewing #21231, one should look whether there's still a problem.",
    "created_at": "2016-08-28T12:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289948",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:49 mantepse]:
> Replying to [comment:48 leif]:
> > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...
> 
> Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?

Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)

So when reviewing #21231, one should look whether there's still a problem.



---

archive/issue_comments_289949.json:
```json
{
    "body": "Replying to [comment:50 leif]:\n> Replying to [comment:49 mantepse]:\n> > Replying to [comment:48 leif]:\n> > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n> > \n> > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n> \n> Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n> \n> So when reviewing #21231, one should look whether there's still a problem.\n\nCould you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...",
    "created_at": "2016-08-28T12:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289949",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:50 leif]:
> Replying to [comment:49 mantepse]:
> > Replying to [comment:48 leif]:
> > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...
> > 
> > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?
> 
> Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)
> 
> So when reviewing #21231, one should look whether there's still a problem.

Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...



---

archive/issue_comments_289950.json:
```json
{
    "body": "To see if there are orphans on Linux, look at the output of\n\n```\n$ ps -def | grep fricas\n```\n\nI see a couple of these just after one run of\n\n```\n./sage -tp --optional=fricas,sage src/sage/interfaces/fricas.py \n```\n",
    "created_at": "2016-08-28T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289950",
    "user": "https://github.com/dimpase"
}
```

To see if there are orphans on Linux, look at the output of

```
$ ps -def | grep fricas
```

I see a couple of these just after one run of

```
./sage -tp --optional=fricas,sage src/sage/interfaces/fricas.py 
```




---

archive/issue_comments_289951.json:
```json
{
    "body": "Replying to [comment:51 mantepse]:\n> Replying to [comment:50 leif]:\n> > Replying to [comment:49 mantepse]:\n> > > Replying to [comment:48 leif]:\n> > > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n> > > \n> > > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n> > \n> > Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n> > \n> > So when reviewing #21231, one should look whether there's still a problem.\n> \n> Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...\n\nAh, sorry, forgot to answer.\n\nYou can also use e.g. `ps x | grep AXIOMsys | grep -v grep`.\n\n(And `kill $(ps x | grep AXIOMsys | grep -v grep | awk '{ print $1 }')` ;-) )",
    "created_at": "2016-08-28T23:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289951",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:51 mantepse]:
> Replying to [comment:50 leif]:
> > Replying to [comment:49 mantepse]:
> > > Replying to [comment:48 leif]:
> > > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...
> > > 
> > > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?
> > 
> > Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)
> > 
> > So when reviewing #21231, one should look whether there's still a problem.
> 
> Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...

Ah, sorry, forgot to answer.

You can also use e.g. `ps x | grep AXIOMsys | grep -v grep`.

(And `kill $(ps x | grep AXIOMsys | grep -v grep | awk '{ print $1 }')` ;-) )



---

archive/issue_comments_289952.json:
```json
{
    "body": "Note that you should look a while *after* you've left Sage, as normally the Sage Cleaner should kill them (but that only works if the interfaces are properly written / their PIDs properly recorded).",
    "created_at": "2016-08-28T23:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289952",
    "user": "https://github.com/nexttime"
}
```

Note that you should look a while *after* you've left Sage, as normally the Sage Cleaner should kill them (but that only works if the interfaces are properly written / their PIDs properly recorded).



---

archive/issue_comments_289953.json:
```json
{
    "body": "Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)",
    "created_at": "2016-08-29T06:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289953",
    "user": "https://github.com/mantepse"
}
```

Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)



---

archive/issue_comments_289954.json:
```json
{
    "body": "Replying to [comment:55 mantepse]:\n> Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)\n\nI think the problem is that more child processes of FriCAS are launched than `sage-cleaner` (a script that cleans up after Sage ends) is able to deal with.\nIn fact, you see that\n\n```\nsage: fricas._quit_string()\n')lisp (quit)'\n```\n\nwhich is as it should be, as `FriCAS` inherits from `PanAxiom` class (in `sage/interfaces/axiom.py`), where `_quit_string` is defined.\nAnd you see that `fricas.quit()` does kill the instance corresponding to `fricas.pid()`, as it should, by looking at the output of `ps -def...`.\n\nHere is how it goes: I start Sage and execute `fricas.pid()` at the prompt; I see that this results in launching of a bunch of things:\n\n```\ndima     30739 30652  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\ndima     30745 30739  1 10:21 pts/5    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/\ndima     30746 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/session\ndima     30747 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/spadclient\ndima     30748 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n```\n\nof which the 1st one corresponds to PID reported by `fricas.pid()`. \n\nIf I issue `fricas.quit()` and then quit Sage then no zombies live on. But if I just quit Sage then I get a zombie, one of these\n\n```\n/home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/\n```\n\n\nProbably, the information on these extra processes' PIDs has to be registered somewhere for `sage-cleaner` to succeed.",
    "created_at": "2016-08-29T09:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289954",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:55 mantepse]:
> Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)

I think the problem is that more child processes of FriCAS are launched than `sage-cleaner` (a script that cleans up after Sage ends) is able to deal with.
In fact, you see that

```
sage: fricas._quit_string()
')lisp (quit)'
```

which is as it should be, as `FriCAS` inherits from `PanAxiom` class (in `sage/interfaces/axiom.py`), where `_quit_string` is defined.
And you see that `fricas.quit()` does kill the instance corresponding to `fricas.pid()`, as it should, by looking at the output of `ps -def...`.

Here is how it goes: I start Sage and execute `fricas.pid()` at the prompt; I see that this results in launching of a bunch of things:

```
dima     30739 30652  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
dima     30745 30739  1 10:21 pts/5    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/
dima     30746 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/session
dima     30747 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/spadclient
dima     30748 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
```

of which the 1st one corresponds to PID reported by `fricas.pid()`. 

If I issue `fricas.quit()` and then quit Sage then no zombies live on. But if I just quit Sage then I get a zombie, one of these

```
/home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/
```


Probably, the information on these extra processes' PIDs has to be registered somewhere for `sage-cleaner` to succeed.



---

archive/issue_comments_289955.json:
```json
{
    "body": "Are you sure that `_quit_string` is used at all?  Because, if it is sent to fricas, then fricas should quit (and it does so on my machine).\n\nSimply killing a few processes is error prone, I'd say.",
    "created_at": "2016-08-29T10:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289955",
    "user": "https://github.com/mantepse"
}
```

Are you sure that `_quit_string` is used at all?  Because, if it is sent to fricas, then fricas should quit (and it does so on my machine).

Simply killing a few processes is error prone, I'd say.



---

archive/issue_comments_289956.json:
```json
{
    "body": "`_quit_string` is used when you explicitly call `fricas.quit()`. But it is not used by `sage-cleaner`, AFAICS (although this is fixable, I guess). `sage-cleaner` would kill all sub-processed spawned by a process launched by a process with the PID it knows. But it seems that that zombie suprocesses of FriCAS don't have parent's PID equal to FriCAS, they are parented by the same PID as the main FriCAS process, if I read this correctly from the output of `ps -def`. \n\nDo you know how FriCAS launches these (sub?)processes?",
    "created_at": "2016-08-29T11:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289956",
    "user": "https://github.com/dimpase"
}
```

`_quit_string` is used when you explicitly call `fricas.quit()`. But it is not used by `sage-cleaner`, AFAICS (although this is fixable, I guess). `sage-cleaner` would kill all sub-processed spawned by a process launched by a process with the PID it knows. But it seems that that zombie suprocesses of FriCAS don't have parent's PID equal to FriCAS, they are parented by the same PID as the main FriCAS process, if I read this correctly from the output of `ps -def`. 

Do you know how FriCAS launches these (sub?)processes?



---

archive/issue_comments_289957.json:
```json
{
    "body": "The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.\n\nThe Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.",
    "created_at": "2016-08-29T11:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289957",
    "user": "https://github.com/nexttime"
}
```

The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.

The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.



---

archive/issue_comments_289958.json:
```json
{
    "body": "Replying to [comment:58 dimpase]:\n\n> `_quit_string' is used when you explicitly call `fricas.quit()`.\n\nI cannot see this in the code. However, I do see it when tracing.  Possibly a newline is missing?\n\n> Do you know how FriCAS launches these (sub?)processes?\n\nNo.",
    "created_at": "2016-08-29T12:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289958",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:58 dimpase]:

> `_quit_string' is used when you explicitly call `fricas.quit()`.

I cannot see this in the code. However, I do see it when tracing.  Possibly a newline is missing?

> Do you know how FriCAS launches these (sub?)processes?

No.



---

archive/issue_comments_289959.json:
```json
{
    "body": "Replying to [comment:59 leif]:\n> The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.\n> \n> The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.\n\nOK, what happens is more subtle: if `fricas.quit()` is not invoked before exiting Sage, then zombie arises with parent's ID of `systemd`. Before exit, however, the (pre)zombie parent's ID is good, it's the same as shown by `fricas.pid()`. \n\nIMHO this means that `sage-cleaner` fails to kill it; when it did get `fricas.quit()` it flips to a ready to die state, but not otherwise.",
    "created_at": "2016-08-29T14:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289959",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:59 leif]:
> The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.
> 
> The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.

OK, what happens is more subtle: if `fricas.quit()` is not invoked before exiting Sage, then zombie arises with parent's ID of `systemd`. Before exit, however, the (pre)zombie parent's ID is good, it's the same as shown by `fricas.pid()`. 

IMHO this means that `sage-cleaner` fails to kill it; when it did get `fricas.quit()` it flips to a ready to die state, but not otherwise.



---

archive/issue_comments_289960.json:
```json
{
    "body": "I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:\n\n```\nsage: def doit():\n....:     F = fricas(1+1).parent(); a = time.time(); F.quit()\n....:     result = [\"testing\"]\n....:     while result != []:\n....:         result = !ps x | grep AXIOMsys | grep -v grep\n....:         sleep(1)\n....:     print time.time() - a\n....:     \nsage: doit()\n16.3083839417\n```\n\n\nIt shouldn't.  If I use `fricas._expect.write(\")quit\\r\")`, fricas quits immediately.  So, indeed, `\"\\r\"` is missing.  Should I simply modify the quitstring?",
    "created_at": "2016-08-29T18:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289960",
    "user": "https://github.com/mantepse"
}
```

I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:

```
sage: def doit():
....:     F = fricas(1+1).parent(); a = time.time(); F.quit()
....:     result = ["testing"]
....:     while result != []:
....:         result = !ps x | grep AXIOMsys | grep -v grep
....:         sleep(1)
....:     print time.time() - a
....:     
sage: doit()
16.3083839417
```


It shouldn't.  If I use `fricas._expect.write(")quit\r")`, fricas quits immediately.  So, indeed, `"\r"` is missing.  Should I simply modify the quitstring?



---

archive/issue_comments_289961.json:
```json
{
    "body": "Replying to [comment:62 mantepse]:\n> I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:\n> {{{\n> sage: def doit():\n> ....:     F = fricas(1+1).parent(); a = time.time(); F.quit()\n> ....:     result = [\"testing\"]\n> ....:     while result != []:\n> ....:         result = !ps x | grep AXIOMsys | grep -v grep\n> ....:         sleep(1)\n> ....:     print time.time() - a\n> ....:     \n> sage: doit()\n> 16.3083839417\n> }}}\n> \n> It shouldn't.  If I use `fricas._expect.write(\")quit\\r\")`, fricas quits immediately.  So, indeed, `\"\\r\"` is missing.  Should I simply modify the quitstring?\n\nwell, IMHO if `\\r` was missing in _quit_string then `fricas.quit()` would not be working at all... (well, perhaps it is slow as it is because it invokes lisp.)\n\nHere your command has no effect:\n\n```\nsage: fricas.pid()\n6130\nsage: fricas._expect.write(\")quit\\r\")\nsage: fricas.pid()\n6130\nsage: fricas.quit()\nsage: fricas.pid() # right, now we get a new instance!\n6507\n```\n\nPlease check that you don't see the same picture with your new interface.",
    "created_at": "2016-08-29T19:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289961",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:62 mantepse]:
> I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:
> {{{
> sage: def doit():
> ....:     F = fricas(1+1).parent(); a = time.time(); F.quit()
> ....:     result = ["testing"]
> ....:     while result != []:
> ....:         result = !ps x | grep AXIOMsys | grep -v grep
> ....:         sleep(1)
> ....:     print time.time() - a
> ....:     
> sage: doit()
> 16.3083839417
> }}}
> 
> It shouldn't.  If I use `fricas._expect.write(")quit\r")`, fricas quits immediately.  So, indeed, `"\r"` is missing.  Should I simply modify the quitstring?

well, IMHO if `\r` was missing in _quit_string then `fricas.quit()` would not be working at all... (well, perhaps it is slow as it is because it invokes lisp.)

Here your command has no effect:

```
sage: fricas.pid()
6130
sage: fricas._expect.write(")quit\r")
sage: fricas.pid()
6130
sage: fricas.quit()
sage: fricas.pid() # right, now we get a new instance!
6507
```

Please check that you don't see the same picture with your new interface.



---

archive/issue_comments_289962.json:
```json
{
    "body": "On my computer, `fricas.pid()` cannot be used to see whether fricas is running:\n\n```\nsage: fricas.pid()\n10923\nsage: !ps x | grep AXIOMsys | grep -v grep\n10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/\n10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\nsage: fricas._expect.write(\")quit\\r\")\nsage: !ps x | grep AXIOMsys | grep -v grep\nsage: fricas.pid()\n10923\n```\n",
    "created_at": "2016-08-29T20:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289962",
    "user": "https://github.com/mantepse"
}
```

On my computer, `fricas.pid()` cannot be used to see whether fricas is running:

```
sage: fricas.pid()
10923
sage: !ps x | grep AXIOMsys | grep -v grep
10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/
10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
sage: fricas._expect.write(")quit\r")
sage: !ps x | grep AXIOMsys | grep -v grep
sage: fricas.pid()
10923
```




---

archive/issue_comments_289963.json:
```json
{
    "body": "Replying to [comment:64 mantepse]:\n> On my computer, `fricas.pid()` cannot be used to see whether fricas is running:\n> {{{\n> sage: fricas.pid()\n> 10923\n> sage: !ps x | grep AXIOMsys | grep -v grep\n> 10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n> 10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/\n> 10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n> sage: fricas._expect.write(\")quit\\r\")\n> sage: !ps x | grep AXIOMsys | grep -v grep\n> sage: fricas.pid()\n> 10923\n> }}}\n\nno, what you see is that fricas is running, with pid 10923, and that `fricas._expect.write(\")quit\\r\")` is ignored by it. If you implemented `_quit_string` properly you would also be able to stop it as is possible with the old interface.",
    "created_at": "2016-08-30T04:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289963",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:64 mantepse]:
> On my computer, `fricas.pid()` cannot be used to see whether fricas is running:
> {{{
> sage: fricas.pid()
> 10923
> sage: !ps x | grep AXIOMsys | grep -v grep
> 10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
> 10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/
> 10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
> sage: fricas._expect.write(")quit\r")
> sage: !ps x | grep AXIOMsys | grep -v grep
> sage: fricas.pid()
> 10923
> }}}

no, what you see is that fricas is running, with pid 10923, and that `fricas._expect.write(")quit\r")` is ignored by it. If you implemented `_quit_string` properly you would also be able to stop it as is possible with the old interface.



---

archive/issue_comments_289964.json:
```json
{
    "body": "Dima, I don't understand your reasoning.  I would think that the first line below quits the fricas process on my machine, as the output of the second line shows.\n\n```\nsage: fricas._expect.write(\")quit\\r\")\nsage: !ps x | grep AXIOMsys | grep -v grep\nsage: fricas.pid()\n10923\n```\n\nThe third line is in accordance with the doc of `.pid()`:\n\n```\n   Return the PID of the underlying sub-process.\n\n   REMARK:\n\n   If the interface terminates unexpectedly, the original PID will\n   still be used. But if it was terminated using \"quit()\", a new sub-\n   process with a new PID is automatically started.\n\n   EXAMPLE:\n\n      sage: pid = gap.pid()\n      sage: gap.eval('quit;')\n      ''\n      sage: pid == gap.pid()\n      True\n      sage: gap.quit()\n      sage: pid == gap.pid()\n      False\n```\n\n\nSo, in my opinion a possible fix is to append a `\\r` to the quitstring - and of course, this should work with the old interface, too, although I did not test.\n\nNo idea though why fricas needs it, and, for example, gap, doesn't.",
    "created_at": "2016-08-30T06:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289964",
    "user": "https://github.com/mantepse"
}
```

Dima, I don't understand your reasoning.  I would think that the first line below quits the fricas process on my machine, as the output of the second line shows.

```
sage: fricas._expect.write(")quit\r")
sage: !ps x | grep AXIOMsys | grep -v grep
sage: fricas.pid()
10923
```

The third line is in accordance with the doc of `.pid()`:

```
   Return the PID of the underlying sub-process.

   REMARK:

   If the interface terminates unexpectedly, the original PID will
   still be used. But if it was terminated using "quit()", a new sub-
   process with a new PID is automatically started.

   EXAMPLE:

      sage: pid = gap.pid()
      sage: gap.eval('quit;')
      ''
      sage: pid == gap.pid()
      True
      sage: gap.quit()
      sage: pid == gap.pid()
      False
```


So, in my opinion a possible fix is to append a `\r` to the quitstring - and of course, this should work with the old interface, too, although I did not test.

No idea though why fricas needs it, and, for example, gap, doesn't.



---

archive/issue_comments_289965.json:
```json
{
    "body": "Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it. Are there any git-related issues you need to fix?",
    "created_at": "2016-09-02T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289965",
    "user": "https://github.com/dimpase"
}
```

Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it. Are there any git-related issues you need to fix?



---

archive/issue_comments_289966.json:
```json
{
    "body": "Replying to [comment:67 dimpase]:\n> Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it.\n\nThank you!\n\n> Are there any git-related issues you need to fix?\n\nIndeed - I made a mess with the commits and found no time to correct them.  It would be of great help if you could, for example, create a \"clean\" branch from my branch, deleting all the commits which obviously don't belong (I made a list at the ticket).\n\nI think the only work that remains to be done there is to add that \"\\r\" to the quitstring, add a test to the `quit()` method, and probably some others to make the patchbot happy.\n\nIf the following an acceptable test for `quit()`?\n\n```\nsage: p = fricas.pid();\nsage: l = !ps x | grep AXIOMsys | grep -v grep\nsage: any(s.strip().startswith(str(p)) for s in l)\nTrue\nsage: fricas.quit()\nsage: any(s.strip().startswith(str(p)) for s in l)\nFalse\n```\n",
    "created_at": "2016-09-02T13:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289966",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:67 dimpase]:
> Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it.

Thank you!

> Are there any git-related issues you need to fix?

Indeed - I made a mess with the commits and found no time to correct them.  It would be of great help if you could, for example, create a "clean" branch from my branch, deleting all the commits which obviously don't belong (I made a list at the ticket).

I think the only work that remains to be done there is to add that "\r" to the quitstring, add a test to the `quit()` method, and probably some others to make the patchbot happy.

If the following an acceptable test for `quit()`?

```
sage: p = fricas.pid();
sage: l = !ps x | grep AXIOMsys | grep -v grep
sage: any(s.strip().startswith(str(p)) for s in l)
True
sage: fricas.quit()
sage: any(s.strip().startswith(str(p)) for s in l)
False
```




---

archive/issue_comments_289967.json:
```json
{
    "body": "Replying to [comment:68 mantepse]:\n> Is the following an acceptable test for `quit()`?\n> {{{\n> sage: p = fricas.pid();\n> sage: l = !ps x | grep AXIOMsys | grep -v grep\n> sage: any(s.strip().startswith(str(p)) for s in l)\n> True\n> sage: fricas.quit()\n> sage: any(s.strip().startswith(str(p)) for s in l)\n> False\n> }}}\n\nUnfortunately no.  Neither `ps`, nor `x`, nor the output format are really portable *I think<sup>TM</sup>*.  So you'd presumably have to use some Python stuff instead.  Not to mention you shouldn't use `!` (but `os.system()` or one of its replacements instead).\n\nRather orthogonal to that, you must not use `.startswith()`, but rather `.split()[0]==str(p)`.",
    "created_at": "2016-09-02T19:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289967",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:68 mantepse]:
> Is the following an acceptable test for `quit()`?
> {{{
> sage: p = fricas.pid();
> sage: l = !ps x | grep AXIOMsys | grep -v grep
> sage: any(s.strip().startswith(str(p)) for s in l)
> True
> sage: fricas.quit()
> sage: any(s.strip().startswith(str(p)) for s in l)
> False
> }}}

Unfortunately no.  Neither `ps`, nor `x`, nor the output format are really portable *I think<sup>TM</sup>*.  So you'd presumably have to use some Python stuff instead.  Not to mention you shouldn't use `!` (but `os.system()` or one of its replacements instead).

Rather orthogonal to that, you must not use `.startswith()`, but rather `.split()[0]==str(p)`.



---

archive/issue_comments_289968.json:
```json
{
    "body": "Jeroen just suggested on sage-devel to make the Python package `psutil` standard.\n\nYou could look into that for retrieving process information in a portable way.",
    "created_at": "2016-09-07T13:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289968",
    "user": "https://github.com/nexttime"
}
```

Jeroen just suggested on sage-devel to make the Python package `psutil` standard.

You could look into that for retrieving process information in a portable way.



---

archive/issue_comments_289969.json:
```json
{
    "body": "I just managed to install `psutil`, and found out:\n\n```\nsage: import psutil\nsage: p = fricas.pid(); p\n22184\nsage: pr = psutil.Process(p); pr\n<psutil.Process(pid=22184, name='sman') at 140240479360400>\nsage: pr.children()\n[<psutil.Process(pid=22190, name='AXIOMsys') at 140240479356752>,\n <psutil.Process(pid=22191, name='session') at 140240479356816>,\n <psutil.Process(pid=22192, name='spadclient') at 140240479356880>,\n <psutil.Process(pid=22193, name='sman') at 140240479356944>]\nsage: fricas._expect.write(\")quit\\r\")\nsage: pr.children()\n[]\nsage: pr\n<psutil.Process(pid=22184, name='sman') at 140240479360400>\n```\n\nThis remaining job is killed when exiting sage.  However:\n\n```\nsage: p = gap.pid(); p\n22582\nsage: pr = psutil.Process(p); pr\n<psutil.Process(pid=22582, name='gap') at 140240479291088>\nsage: pr.children()\n[]\nsage: gap.quit()\nsage: pr\n<psutil.Process(pid=22582 (terminated)) at 140240479291088>\n```\n\nSo it's better, but not perfect.  Is it good enough?",
    "created_at": "2016-09-08T20:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20972#issuecomment-289969",
    "user": "https://github.com/mantepse"
}
```

I just managed to install `psutil`, and found out:

```
sage: import psutil
sage: p = fricas.pid(); p
22184
sage: pr = psutil.Process(p); pr
<psutil.Process(pid=22184, name='sman') at 140240479360400>
sage: pr.children()
[<psutil.Process(pid=22190, name='AXIOMsys') at 140240479356752>,
 <psutil.Process(pid=22191, name='session') at 140240479356816>,
 <psutil.Process(pid=22192, name='spadclient') at 140240479356880>,
 <psutil.Process(pid=22193, name='sman') at 140240479356944>]
sage: fricas._expect.write(")quit\r")
sage: pr.children()
[]
sage: pr
<psutil.Process(pid=22184, name='sman') at 140240479360400>
```

This remaining job is killed when exiting sage.  However:

```
sage: p = gap.pid(); p
22582
sage: pr = psutil.Process(p); pr
<psutil.Process(pid=22582, name='gap') at 140240479291088>
sage: pr.children()
[]
sage: gap.quit()
sage: pr
<psutil.Process(pid=22582 (terminated)) at 140240479291088>
```

So it's better, but not perfect.  Is it good enough?
