# Issue 31072: sage_getargspec mishandles keyword-only arguments

Issue created by migration from https://trac.sagemath.org/ticket/31309

Original creator: mkoeppe

Original creation time: 2021-01-31 07:30:06

CC:  yzh @tobiasdiez klee chapoton tscrim

`sage_getargspec` seems broken for functions with keyword-only arguments.

In #31307, the sphinx documentation for

```
@staticmethod
def random_element(m, n, bound=5, special_probability=0.2,
                   *, is_primal=True, **kwds):
```

is generated as

```
static random_element(m, n, bound, special_probability=5, is_primal=0.2, **kwds)
Construct a random InteractiveLPProblemStandardForm.
```



---

Comment by mkoeppe created at 2021-01-31 07:48:24

The implementation of `sage_getargspec` uses `inspect.getargs` -- which so old that it is not even deprecated - https://docs.python.org/3/library/inspect.html


---

Comment by mkoeppe created at 2021-01-31 07:56:10

If we can't get rid of `sage_getargspec` (#30884?), we should make a version of `sage_getargspec` that returns a `FullArgSpec` (see https://docs.python.org/3/library/inspect.html#inspect.getfullargspec) or `Signature` (https://docs.python.org/3/library/inspect.html#inspect.signature) instead of an `ArgSpec`.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-09-06 03:19:10

Without #26254, `inspect.signature` is not able to return signatures of Cython-defined functions -- so the plan to just replace all uses of `sage_getargspec` by `inspect.signature` cannot work.

Instead we should create a function `signature` in `sage.misc.sageinspect` that is compatible with `inspect.signature` and switch all uses of `sage_getargspec` to that.
----
New commits:
