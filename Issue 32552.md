# Issue 32552: Fix spkg-configure.m4 for singular

archive/issues_032552.json:
```json
{
    "body": "CC:  dimpase fbissey slelievre isuruf mjo @tobiasdiez thansen\n\nFollow-up from #29024. This time with testing on more than 1 platform.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32789\n\n",
    "created_at": "2021-10-29T02:38:28Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "title": "Fix spkg-configure.m4 for singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32552",
    "user": "mkoeppe"
}
```
CC:  dimpase fbissey slelievre isuruf mjo @tobiasdiez thansen

Follow-up from #29024. This time with testing on more than 1 platform.

Issue created by migration from https://trac.sagemath.org/ticket/32789





---

archive/issue_comments_464416.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-11-28T03:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464416",
    "user": "mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_464417.json:
```json
{
    "body": "We already tried to fix the path to libSingular on cygwin once. Where does it really live?",
    "created_at": "2021-11-28T13:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464417",
    "user": "mjo"
}
```

We already tried to fix the path to libSingular on cygwin once. Where does it really live?



---

archive/issue_comments_464418.json:
```json
{
    "body": "We have a GH Actions workflow for Cygwin that allows you to download logs and the installation in `SAGE_LOCAL` for inspection, see for example https://github.com/sagemath/sage/actions/runs/1478855916",
    "created_at": "2021-11-28T19:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464418",
    "user": "mkoeppe"
}
```

We have a GH Actions workflow for Cygwin that allows you to download logs and the installation in `SAGE_LOCAL` for inspection, see for example https://github.com/sagemath/sage/actions/runs/1478855916



---

archive/issue_comments_464419.json:
```json
{
    "body": "Happy to run any commands under Cygwin too.",
    "created_at": "2021-11-29T18:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464419",
    "user": "slelievre"
}
```

Happy to run any commands under Cygwin too.



---

archive/issue_comments_464420.json:
```json
{
    "body": "From https://github.com/mkoeppe/sage/suites/4487559073/artifacts/119913634:\nThe following DLLs are installed in `SAGE_LOCAL/bin`:\n\n```\ncygfactory-4-2-1.dll\ncygomalloc-0-9-6.dll\ncygpolys-4-2-1.dll\ncygsingular_resources-4-2-1.dll\ncygSingular-4-2-1.dll\n```\n",
    "created_at": "2021-11-29T19:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464420",
    "user": "mkoeppe"
}
```

From https://github.com/mkoeppe/sage/suites/4487559073/artifacts/119913634:
The following DLLs are installed in `SAGE_LOCAL/bin`:

```
cygfactory-4-2-1.dll
cygomalloc-0-9-6.dll
cygpolys-4-2-1.dll
cygsingular_resources-4-2-1.dll
cygSingular-4-2-1.dll
```




---

archive/issue_comments_464421.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> {{{\n> cygSingular-4-2-1.dll\n> }}}\n\nIs there a symlink from `cygSingular.dll` to that file?",
    "created_at": "2021-11-29T20:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464421",
    "user": "mjo"
}
```

Replying to [comment:7 mkoeppe]:
> {{{
> cygSingular-4-2-1.dll
> }}}

Is there a symlink from `cygSingular.dll` to that file?



---

archive/issue_comments_464422.json:
```json
{
    "body": "No",
    "created_at": "2021-11-29T20:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464422",
    "user": "mkoeppe"
}
```

No



---

archive/issue_comments_464423.json:
```json
{
    "body": "There is also a file `SAGE_LOCAL/lib/libSingular.dll.a`, which is used by the linker, and probably contains the information about the name of the actual DLL somehow.",
    "created_at": "2021-11-29T20:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464423",
    "user": "mkoeppe"
}
```

There is also a file `SAGE_LOCAL/lib/libSingular.dll.a`, which is used by the linker, and probably contains the information about the name of the actual DLL somehow.



---

archive/issue_comments_464424.json:
```json
{
    "body": "Apparently https://sourceware.org/binutils/docs/binutils/dlltool.html can be used for reading this info.\n\n`@`slelievre, could you run `dlltool --identify local/lib/libSingular.dll.a` please?",
    "created_at": "2021-11-29T20:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464424",
    "user": "mkoeppe"
}
```

Apparently https://sourceware.org/binutils/docs/binutils/dlltool.html can be used for reading this info.

`@`slelievre, could you run `dlltool --identify local/lib/libSingular.dll.a` please?



---

archive/issue_comments_464425.json:
```json
{
    "body": "The SPKG won't be installed yet, so we can't read `local/lib/libSingular.dll.a` to obtain the necessary path during `./configure.` For the SPKG, we could hard-code the value as a last resort. Their library versioning scheme also corresponds to `package-version.txt`, but I doubt that's reliable.\n\nDetecting the system copy should be relatively easy in comparison. Unless there's a way to install multiple copies into the system libdir, we can use `find` to pick out what is hopefully the only copy of `cygSingular*.dll` during `./configure`.",
    "created_at": "2021-11-29T20:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464425",
    "user": "mjo"
}
```

The SPKG won't be installed yet, so we can't read `local/lib/libSingular.dll.a` to obtain the necessary path during `./configure.` For the SPKG, we could hard-code the value as a last resort. Their library versioning scheme also corresponds to `package-version.txt`, but I doubt that's reliable.

Detecting the system copy should be relatively easy in comparison. Unless there's a way to install multiple copies into the system libdir, we can use `find` to pick out what is hopefully the only copy of `cygSingular*.dll` during `./configure`.



---

archive/issue_comments_464426.json:
```json
{
    "body": "It would probably be a good idea to first test whether this whole symbol visibility issue is even a thing on Cygwin.",
    "created_at": "2021-11-29T20:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464426",
    "user": "mkoeppe"
}
```

It would probably be a good idea to first test whether this whole symbol visibility issue is even a thing on Cygwin.



---

archive/issue_comments_464427.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-11-29T21:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464427",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_464428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-29T21:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_464429.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-29T21:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464429",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464430.json:
```json
{
    "body": "I've put this on top of other Cygwin fixes for convenience of testing",
    "created_at": "2021-11-29T21:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464430",
    "user": "mkoeppe"
}
```

I've put this on top of other Cygwin fixes for convenience of testing



---

archive/issue_comments_464431.json:
```json
{
    "body": "Hm, the test with `CYGWIN_VERSION` does not seem to have worked\nhttps://github.com/sagemath/sagetrac-mirror/runs/4371131888?check_suite_focus=true",
    "created_at": "2021-11-30T21:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464431",
    "user": "mkoeppe"
}
```

Hm, the test with `CYGWIN_VERSION` does not seem to have worked
https://github.com/sagemath/sagetrac-mirror/runs/4371131888?check_suite_focus=true



---

archive/issue_comments_464432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-30T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464432",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-30T22:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464433",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464434.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2021-12-01T17:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464434",
    "user": "mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_464435.json:
```json
{
    "body": "I've split out the cygwin issue to #32954, ready for review",
    "created_at": "2021-12-01T17:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464435",
    "user": "mkoeppe"
}
```

I've split out the cygwin issue to #32954, ready for review



---

archive/issue_comments_464436.json:
```json
{
    "body": "Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here",
    "created_at": "2021-12-23T19:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464436",
    "user": "mkoeppe"
}
```

Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here



---

archive/issue_comments_464437.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2021-12-23T19:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464437",
    "user": "mkoeppe"
}
```

Changing priority from critical to major.



---

archive/issue_comments_464438.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here\n\nI didn't get that. Is there something that needs to be changed in a Debian package?",
    "created_at": "2021-12-24T12:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464438",
    "user": "thansen"
}
```

Replying to [comment:25 mkoeppe]:
> Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here

I didn't get that. Is there something that needs to be changed in a Debian package?



---

archive/issue_comments_464439.json:
```json
{
    "body": "Replying to [comment:26 thansen]:\n> Replying to [comment:25 mkoeppe]:\n> > Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here\n> \n> I didn't get that. Is there something that needs to be changed in a Debian package?\n\nYes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)",
    "created_at": "2021-12-25T19:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464439",
    "user": "mkoeppe"
}
```

Replying to [comment:26 thansen]:
> Replying to [comment:25 mkoeppe]:
> > Currently on all `ubuntu` including `-jammy`, singular's dependency `cddlib` is rejected - so there's no urgency here
> 
> I didn't get that. Is there something that needs to be changed in a Debian package?

Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)



---

archive/issue_comments_464440.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)\n\nOk, done.",
    "created_at": "2021-12-29T13:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464440",
    "user": "thansen"
}
```

Replying to [comment:27 mkoeppe]:
> Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)

Ok, done.



---

archive/issue_comments_464441.json:
```json
{
    "body": "Replying to [comment:28 thansen]:\n> Replying to [comment:27 mkoeppe]:\n> > Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)\n> \n> Ok, done.\n\nGreat. `tox -e docker-ubuntu-jammy-standard -- config.status` now gives:\n\n```\nChecking whether SageMath should install SPKG singular...\nchecking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\nchecking for Singular... /usr/bin/Singular\nchecking for Singular >= 4.1.1... yes\nchecking if we can dlopen(/usr/lib/x86_64-linux-gnu/libSingular.so)... no\nconfigure: no suitable system package found for SPKG singular\n```\n\n\nSo it makes sense now to work on the present ticket.",
    "created_at": "2021-12-30T01:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464441",
    "user": "mkoeppe"
}
```

Replying to [comment:28 thansen]:
> Replying to [comment:27 mkoeppe]:
> > Yes, I think Debian's `cddlib` needs upgrading to 0.94m (see https://repology.org/project/cddlib/versions)
> 
> Ok, done.

Great. `tox -e docker-ubuntu-jammy-standard -- config.status` now gives:

```
Checking whether SageMath should install SPKG singular...
checking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
checking for Singular... /usr/bin/Singular
checking for Singular >= 4.1.1... yes
checking if we can dlopen(/usr/lib/x86_64-linux-gnu/libSingular.so)... no
configure: no suitable system package found for SPKG singular
```


So it makes sense now to work on the present ticket.



---

archive/issue_comments_464442.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-01-26T16:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464442",
    "user": "slelievre"
}
```

Changing priority from major to critical.



---

archive/issue_comments_464443.json:
```json
{
    "body": "Changing to critical in view of #33139.",
    "created_at": "2022-01-26T16:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464443",
    "user": "slelievre"
}
```

Changing to critical in view of #33139.



---

archive/issue_comments_464444.json:
```json
{
    "body": "What does this have to do with a docbuild failure?",
    "created_at": "2022-01-26T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464444",
    "user": "mjo"
}
```

What does this have to do with a docbuild failure?



---

archive/issue_comments_464445.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2022-01-26T20:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464445",
    "user": "slelievre"
}
```

Changing priority from critical to major.



---

archive/issue_comments_464446.json:
```json
{
    "body": "Right, the link with singular was ruled out\nin ticket:32954#comment:8.\n\nSorry for the noise.",
    "created_at": "2022-01-26T20:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464446",
    "user": "slelievre"
}
```

Right, the link with singular was ruled out
in ticket:32954#comment:8.

Sorry for the noise.



---

archive/issue_comments_464447.json:
```json
{
    "body": "still testing. the library on Debian is recognised, at least.\n----\nNew commits:",
    "created_at": "2022-02-11T12:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464447",
    "user": "dimpase"
}
```

still testing. the library on Debian is recognised, at least.
----
New commits:



---

archive/issue_comments_464448.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-11T17:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464448",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464449.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-11T17:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464449",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_464450.json:
```json
{
    "body": "Needs review. I suppose allowing Singular 4.1.1 was to be bumped up, as 4.1.1 doesn't actually have `polylib.lib` (it's called `poly.lib` there, but it's anyway too old, I think).",
    "created_at": "2022-02-11T17:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464450",
    "user": "dimpase"
}
```

Needs review. I suppose allowing Singular 4.1.1 was to be bumped up, as 4.1.1 doesn't actually have `polylib.lib` (it's called `poly.lib` there, but it's anyway too old, I think).



---

archive/issue_comments_464451.json:
```json
{
    "body": "I actually checked that the branch allows using system Singular 4.1.1 on Debian 11, but then the result has test failures due to that `polylib.lib` absense.",
    "created_at": "2022-02-11T18:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464451",
    "user": "dimpase"
}
```

I actually checked that the branch allows using system Singular 4.1.1 on Debian 11, but then the result has test failures due to that `polylib.lib` absense.



---

archive/issue_comments_464452.json:
```json
{
    "body": "OK, this still correctly rejects singular on all ubuntu releases earlier than `jammy`.",
    "created_at": "2022-02-11T19:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464452",
    "user": "mkoeppe"
}
```

OK, this still correctly rejects singular on all ubuntu releases earlier than `jammy`.



---

archive/issue_comments_464453.json:
```json
{
    "body": "With `TARGETS_PRE=build-local tox -e docker-ubuntu-jammy-standard -- build ptest` I see the following failures:\n\n```\nsage -t --random-seed=75077202530737540355693167266645487963 src/sage/interfaces/singular.py\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2243, in sage.interfaces.singular.SingularFunction._instancedoc_\nFailed example:\n    'groebner' in singular.groebner.__doc__\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.SingularFunction._instancedoc_[0]>\", line 1, in <module>\n        'groebner' in singular.groebner.__doc__\n      File \"sage/docs/instancedoc.pyx\", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)\n        return self.instancedoc(obj)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2247, in _instancedoc_\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2283, in sage.interfaces.singular.SingularFunctionElement._instancedoc_\nFailed example:\n    'matrix_expression' in A.nrows.__doc__\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.SingularFunctionElement._instancedoc_[2]>\", line 1, in <module>\n        'matrix_expression' in A.nrows.__doc__\n      File \"sage/docs/instancedoc.pyx\", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)\n        return self.instancedoc(obj)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2287, in _instancedoc_\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2319, in sage.interfaces.singular.generate_docstring_dictionary\nFailed example:\n    generate_docstring_dictionary()\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.generate_docstring_dictionary[1]>\", line 1, in <module>\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2371, in sage.interfaces.singular.get_docstring\nFailed example:\n    'groebner' in get_docstring('groebner')\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.get_docstring[1]>\", line 1, in <module>\n        'groebner' in get_docstring('groebner')\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2378, in get_docstring\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\nFile \"src/sage/interfaces/singular.py\", line 2373, in sage.interfaces.singular.get_docstring\nFailed example:\n    'standard.lib' in get_docstring('groebner')\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.singular.get_docstring[2]>\", line 1, in <module>\n        'standard.lib' in get_docstring('groebner')\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2378, in get_docstring\n        generate_docstring_dictionary()\n      File \"/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py\", line 2337, in generate_docstring_dictionary\n        with io.open(singular_info_file,\n    TypeError: expected str, bytes or os.PathLike object, not NoneType\n**********************************************************************\n\nsage -t --random-seed=75077202530737540355693167266645487963 src/sage/libs/singular/singular.pyx\n**********************************************************************\nFile \"src/sage/libs/singular/singular.pyx\", line 1583, in sage.libs.singular.singular.get_resource\nFailed example:\n    get_resource('i')            # SINGULAR_INFO_FILE\nExpected:\n    '.../singular...'\nGot:\n    <BLANKLINE>\n**********************************************************************\n```\n\nand similar",
    "created_at": "2022-02-11T22:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464453",
    "user": "mkoeppe"
}
```

With `TARGETS_PRE=build-local tox -e docker-ubuntu-jammy-standard -- build ptest` I see the following failures:

```
sage -t --random-seed=75077202530737540355693167266645487963 src/sage/interfaces/singular.py
**********************************************************************
File "src/sage/interfaces/singular.py", line 2243, in sage.interfaces.singular.SingularFunction._instancedoc_
Failed example:
    'groebner' in singular.groebner.__doc__
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.SingularFunction._instancedoc_[0]>", line 1, in <module>
        'groebner' in singular.groebner.__doc__
      File "sage/docs/instancedoc.pyx", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)
        return self.instancedoc(obj)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2247, in _instancedoc_
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2283, in sage.interfaces.singular.SingularFunctionElement._instancedoc_
Failed example:
    'matrix_expression' in A.nrows.__doc__
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.SingularFunctionElement._instancedoc_[2]>", line 1, in <module>
        'matrix_expression' in A.nrows.__doc__
      File "sage/docs/instancedoc.pyx", line 211, in sage.docs.instancedoc.InstanceDocDescriptor.__get__ (build/cythonized/sage/docs/instancedoc.c:1878)
        return self.instancedoc(obj)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2287, in _instancedoc_
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2319, in sage.interfaces.singular.generate_docstring_dictionary
Failed example:
    generate_docstring_dictionary()
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.generate_docstring_dictionary[1]>", line 1, in <module>
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2371, in sage.interfaces.singular.get_docstring
Failed example:
    'groebner' in get_docstring('groebner')
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.get_docstring[1]>", line 1, in <module>
        'groebner' in get_docstring('groebner')
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2378, in get_docstring
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************
File "src/sage/interfaces/singular.py", line 2373, in sage.interfaces.singular.get_docstring
Failed example:
    'standard.lib' in get_docstring('groebner')
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.singular.get_docstring[2]>", line 1, in <module>
        'standard.lib' in get_docstring('groebner')
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2378, in get_docstring
        generate_docstring_dictionary()
      File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/singular.py", line 2337, in generate_docstring_dictionary
        with io.open(singular_info_file,
    TypeError: expected str, bytes or os.PathLike object, not NoneType
**********************************************************************

sage -t --random-seed=75077202530737540355693167266645487963 src/sage/libs/singular/singular.pyx
**********************************************************************
File "src/sage/libs/singular/singular.pyx", line 1583, in sage.libs.singular.singular.get_resource
Failed example:
    get_resource('i')            # SINGULAR_INFO_FILE
Expected:
    '.../singular...'
Got:
    <BLANKLINE>
**********************************************************************
```

and similar



---

archive/issue_comments_464454.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-11T22:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464454",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464455.json:
```json
{
    "body": "this appears to be fixed by \n\n```\nexport SINGULAR_INFO_FILE=/usr/share/doc/singular/singular.hlp\n```\n\nbefore starting Sage. After this, instead of\n\n```\nsage: from sage.libs.singular.singular import get_resource\nsage: get_resource('i')\n// ** Could not get 'InfoFile'.\n// ** Either set environment variable 'SINGULAR_INFO_FILE' to 'InfoFile',\n// ** or make sure that 'InfoFile' is at \"/usr/bin/../share/info/singular.hlp\"\n```\n\none gets, as it should be:\n\n```\nsage: from sage.libs.singular.singular import get_resource\nsage: get_resource('i')\n'/usr/share/doc/singular/singular.hlp'\n```\n\nThe latter needs `singular-doc` installed, so it must be added to\n`build/pkgs/singular/distros/debian.txt`.",
    "created_at": "2022-02-12T10:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464455",
    "user": "dimpase"
}
```

this appears to be fixed by 

```
export SINGULAR_INFO_FILE=/usr/share/doc/singular/singular.hlp
```

before starting Sage. After this, instead of

```
sage: from sage.libs.singular.singular import get_resource
sage: get_resource('i')
// ** Could not get 'InfoFile'.
// ** Either set environment variable 'SINGULAR_INFO_FILE' to 'InfoFile',
// ** or make sure that 'InfoFile' is at "/usr/bin/../share/info/singular.hlp"
```

one gets, as it should be:

```
sage: from sage.libs.singular.singular import get_resource
sage: get_resource('i')
'/usr/share/doc/singular/singular.hlp'
```

The latter needs `singular-doc` installed, so it must be added to
`build/pkgs/singular/distros/debian.txt`.



---

archive/issue_comments_464456.json:
```json
{
    "body": "Should be fixed by\n\n```diff\n--- a/src/sage/libs/singular/singular.pyx\n+++ b/src/sage/libs/singular/singular.pyx\n@@ -1587,5 +1587,8 @@ def get_resource(id):\n     \"\"\"\n     cdef char *result = feGetResource(<char>ord(id))\n     if result == NULL:\n-        return None\n+        os.environ['SINGULAR_INFO_FILE']='/usr/share/doc/singular/singular.hlp'\n+        result = feGetResource(<char>ord(id))\n+        if result == NULL:\n+            return None\n     return bytes_to_str(result)\n```\n",
    "created_at": "2022-02-12T10:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464456",
    "user": "dimpase"
}
```

Should be fixed by

```diff
--- a/src/sage/libs/singular/singular.pyx
+++ b/src/sage/libs/singular/singular.pyx
@@ -1587,5 +1587,8 @@ def get_resource(id):
     """
     cdef char *result = feGetResource(<char>ord(id))
     if result == NULL:
-        return None
+        os.environ['SINGULAR_INFO_FILE']='/usr/share/doc/singular/singular.hlp'
+        result = feGetResource(<char>ord(id))
+        if result == NULL:
+            return None
     return bytes_to_str(result)
```




---

archive/issue_comments_464457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-12T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464457",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464458.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-12T11:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464458",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464459.json:
```json
{
    "body": "All !Debian/Ubuntu Singular 4.2.1 packages are  broken, some of them do not install the needed .hlp file at all.",
    "created_at": "2022-02-12T16:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464459",
    "user": "dimpase"
}
```

All !Debian/Ubuntu Singular 4.2.1 packages are  broken, some of them do not install the needed .hlp file at all.



---

archive/issue_comments_464460.json:
```json
{
    "body": "Replying to [comment:42 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)||`make singular.hlp known to Sage for Debian Singular`||\n\nI don't think we should have this in our code",
    "created_at": "2022-02-12T16:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464460",
    "user": "mkoeppe"
}
```

Replying to [comment:42 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)||`make singular.hlp known to Sage for Debian Singular`||

I don't think we should have this in our code



---

archive/issue_comments_464461.json:
```json
{
    "body": "Probably best to wait until there's a suitable version packaged",
    "created_at": "2022-02-12T16:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464461",
    "user": "mkoeppe"
}
```

Probably best to wait until there's a suitable version packaged



---

archive/issue_comments_464462.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-02-12T16:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464462",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_464463.json:
```json
{
    "body": "indeed, there are no packages that work for us atm.",
    "created_at": "2022-02-12T19:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464463",
    "user": "dimpase"
}
```

indeed, there are no packages that work for us atm.



---

archive/issue_comments_464464.json:
```json
{
    "body": "It seems that actually something either goes wrong with dpkg in Ubuntu Jammy, or something is wrong in my Docker setup, but\ninstalling singular-doc Ubuntu package results in many (most) missing files.\nIn particular the crucial file \"singular.info\" is missing.",
    "created_at": "2022-02-12T23:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464464",
    "user": "dimpase"
}
```

It seems that actually something either goes wrong with dpkg in Ubuntu Jammy, or something is wrong in my Docker setup, but
installing singular-doc Ubuntu package results in many (most) missing files.
In particular the crucial file "singular.info" is missing.



---

archive/issue_comments_464465.json:
```json
{
    "body": "Disturbingly, while on my Jammy Docker installing singular-doc leads to missing files,\ninstalling the same package on another (\"real\") Ubuntu system works.\nSo this might be Docker-specific :-(",
    "created_at": "2022-02-12T23:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464465",
    "user": "dimpase"
}
```

Disturbingly, while on my Jammy Docker installing singular-doc leads to missing files,
installing the same package on another ("real") Ubuntu system works.
So this might be Docker-specific :-(



---

archive/issue_comments_464466.json:
```json
{
    "body": "You can use `docker system prune --all` to get rid of bad stuff in the cache",
    "created_at": "2022-02-13T00:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464466",
    "user": "mkoeppe"
}
```

You can use `docker system prune --all` to get rid of bad stuff in the cache



---

archive/issue_comments_464467.json:
```json
{
    "body": "cache? No, it's worse, it's `dpkg -i` which does not do the job. \n\nIf I take the same .deb file, unpack it using `ar x` and manually install `data.tar.zst` using tar (one might have to install `zstd` first, to do un-compression), *all* the files from the package get installed.",
    "created_at": "2022-02-13T00:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464467",
    "user": "dimpase"
}
```

cache? No, it's worse, it's `dpkg -i` which does not do the job. 

If I take the same .deb file, unpack it using `ar x` and manually install `data.tar.zst` using tar (one might have to install `zstd` first, to do un-compression), *all* the files from the package get installed.



---

archive/issue_comments_464468.json:
```json
{
    "body": "Further inspection shows that the problem is in the official !Ubuntu/Jammy Docker image. Both official Ubuntu's and Debian \n`singular-doc_4.2.1-p3+ds-1_all.deb` files exhibit the same error (apt used dpkg to install files .deb files, and the same error shows up if installation is done by `dpkg -i singular-doc_4.2.1-p3+ds-1_all.deb`).\n\nCould you check it's not only my Docker that plays up here? Steps to reproduce: \n\n* launch official Jammy image\n\n* get shell prompt there\n\n* run \n\n```\napt install singular-doc\ndpkg -V singular-doc\n```\n\n\nThe latter command should not output anything - but for me it outputs a log of missing files.\n\n\n\nIn !Debian/Bookworm image, which carries the same singular-doc version, everything is fine.\n\nPS. It would be good to check on a non-Docker installation of Jammy, too.",
    "created_at": "2022-02-13T08:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464468",
    "user": "dimpase"
}
```

Further inspection shows that the problem is in the official !Ubuntu/Jammy Docker image. Both official Ubuntu's and Debian 
`singular-doc_4.2.1-p3+ds-1_all.deb` files exhibit the same error (apt used dpkg to install files .deb files, and the same error shows up if installation is done by `dpkg -i singular-doc_4.2.1-p3+ds-1_all.deb`).

Could you check it's not only my Docker that plays up here? Steps to reproduce: 

* launch official Jammy image

* get shell prompt there

* run 

```
apt install singular-doc
dpkg -V singular-doc
```


The latter command should not output anything - but for me it outputs a log of missing files.



In !Debian/Bookworm image, which carries the same singular-doc version, everything is fine.

PS. It would be good to check on a non-Docker installation of Jammy, too.



---

archive/issue_comments_464469.json:
```json
{
    "body": "We can go forward with this ticker (at least in Debian unstable it will be working) - but we will want a test to check that Singular docs work out of the box.\nOn a working system\n\n```\n# echo \"help;\" | Singular | grep error\n```\n\ndoes not return anything. On a broken one, one sees\n\n```\n# echo \"help;\" | Singular | grep error\n   ? No functioning help browser available.\n   ? error occurred in or before STDIN line 1: `help;`\n```\n",
    "created_at": "2022-02-13T08:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464469",
    "user": "dimpase"
}
```

We can go forward with this ticker (at least in Debian unstable it will be working) - but we will want a test to check that Singular docs work out of the box.
On a working system

```
# echo "help;" | Singular | grep error
```

does not return anything. On a broken one, one sees

```
# echo "help;" | Singular | grep error
   ? No functioning help browser available.
   ? error occurred in or before STDIN line 1: `help;`
```




---

archive/issue_comments_464470.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n> Replying to [comment:42 git]:\n> > Branch pushed to git repo; I updated commit sha1. New commits:\n> > ||[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)||`make singular.hlp known to Sage for Debian Singular`||\n> \n> I don't think we should have this in our code\n\nindeed, I'll remove it.",
    "created_at": "2022-02-13T08:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464470",
    "user": "dimpase"
}
```

Replying to [comment:45 mkoeppe]:
> Replying to [comment:42 git]:
> > Branch pushed to git repo; I updated commit sha1. New commits:
> > ||[cb82ed0](https://git.sagemath.org/sage.git/commit/?id=cb82ed03d722e8e1e1a8fb6e8a0320c28f8a3ea7)||`make singular.hlp known to Sage for Debian Singular`||
> 
> I don't think we should have this in our code

indeed, I'll remove it.



---

archive/issue_comments_464471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-13T10:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_464472.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-02-13T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464472",
    "user": "dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_464473.json:
```json
{
    "body": "this should pick up system Singular on Debian/bookworm and sid.\n(and reject broken one on Jammy)",
    "created_at": "2022-02-13T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464473",
    "user": "dimpase"
}
```

this should pick up system Singular on Debian/bookworm and sid.
(and reject broken one on Jammy)



---

archive/issue_comments_464474.json:
```json
{
    "body": "By the way, I see the same Jammy failure with singular-doc in Podman running on Fedora, as I see with Docker on macOS.\nSo it really points at a faulty image. Or it's fault in OS itself, for this one needs a non-!Docker/Podman test.",
    "created_at": "2022-02-13T11:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464474",
    "user": "dimpase"
}
```

By the way, I see the same Jammy failure with singular-doc in Podman running on Fedora, as I see with Docker on macOS.
So it really points at a faulty image. Or it's fault in OS itself, for this one needs a non-!Docker/Podman test.



---

archive/issue_comments_464475.json:
```json
{
    "body": "Everything is fine in Jammy run in an lxc container, so that's really !Docker/Podman.\nI filed https://github.com/tianon/docker-brew-ubuntu-core/issues/230",
    "created_at": "2022-02-13T12:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464475",
    "user": "dimpase"
}
```

Everything is fine in Jammy run in an lxc container, so that's really !Docker/Podman.
I filed https://github.com/tianon/docker-brew-ubuntu-core/issues/230



---

archive/issue_comments_464476.json:
```json
{
    "body": "I'm told it's Jammy Ubuntu feature, not a bug, here:\nhttps://bugs.launchpad.net/ubuntu/+source/dpkg/+bug/1960749",
    "created_at": "2022-02-13T20:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464476",
    "user": "dimpase"
}
```

I'm told it's Jammy Ubuntu feature, not a bug, here:
https://bugs.launchpad.net/ubuntu/+source/dpkg/+bug/1960749



---

archive/issue_comments_464477.json:
```json
{
    "body": "Bizarre, so this means we need to add a test for the availability of the info file to `spkg-configure.m4`.",
    "created_at": "2022-02-13T20:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464477",
    "user": "mkoeppe"
}
```

Bizarre, so this means we need to add a test for the availability of the info file to `spkg-configure.m4`.



---

archive/issue_comments_464478.json:
```json
{
    "body": "Oh, I see you already did this in 45f1b19",
    "created_at": "2022-02-13T20:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464478",
    "user": "mkoeppe"
}
```

Oh, I see you already did this in 45f1b19



---

archive/issue_comments_464479.json:
```json
{
    "body": "https://askubuntu.com/questions/1173337/how-to-prevent-system-from-being-minimized",
    "created_at": "2022-02-13T20:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464479",
    "user": "mkoeppe"
}
```

https://askubuntu.com/questions/1173337/how-to-prevent-system-from-being-minimized



---

archive/issue_comments_464480.json:
```json
{
    "body": "We can certainly add this step to `build/bin/write-dockerfile.sh` for Debian/Ubuntu",
    "created_at": "2022-02-13T20:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464480",
    "user": "mkoeppe"
}
```

We can certainly add this step to `build/bin/write-dockerfile.sh` for Debian/Ubuntu



---

archive/issue_comments_464481.json:
```json
{
    "body": "Using their `unminimize` command, I see\n\n```\nReinstalling packages with system documentation in /usr/share/doc/ ..\ndpkg-query: error: --search needs at least one file name pattern argument\n\nUse --help for help about querying packages.\n```\n\nClearly commercial-grade work there",
    "created_at": "2022-02-13T20:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464481",
    "user": "mkoeppe"
}
```

Using their `unminimize` command, I see

```
Reinstalling packages with system documentation in /usr/share/doc/ ..
dpkg-query: error: --search needs at least one file name pattern argument

Use --help for help about querying packages.
```

Clearly commercial-grade work there



---

archive/issue_comments_464482.json:
```json
{
    "body": "It might be quicker just to remove the `exclude` policy - this won't trigger reinstallation of all the packages already there. \n----\nNew commits:",
    "created_at": "2022-02-13T21:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464482",
    "user": "dimpase"
}
```

It might be quicker just to remove the `exclude` policy - this won't trigger reinstallation of all the packages already there. 
----
New commits:



---

archive/issue_comments_464483.json:
```json
{
    "body": "Fine with me, go ahead",
    "created_at": "2022-02-13T21:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464483",
    "user": "mkoeppe"
}
```

Fine with me, go ahead



---

archive/issue_comments_464484.json:
```json
{
    "body": "Replying to [comment:69 mkoeppe]:\n> Fine with me, go ahead\nYour branch is actually good (I was worried that images will get much bigger, but I haven't noticed this at all).\nWhat worries me is what happens if `unminimize` is not even present, wouldn't it trigger an error?",
    "created_at": "2022-02-14T10:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464484",
    "user": "dimpase"
}
```

Replying to [comment:69 mkoeppe]:
> Fine with me, go ahead
Your branch is actually good (I was worried that images will get much bigger, but I haven't noticed this at all).
What worries me is what happens if `unminimize` is not even present, wouldn't it trigger an error?



---

archive/issue_comments_464485.json:
```json
{
    "body": "OK, it's ignored if missing. No problem then.\nI actually tested this branch in a Ubuntu Jammy Docker, all good (with system Singular).",
    "created_at": "2022-02-14T10:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464485",
    "user": "dimpase"
}
```

OK, it's ignored if missing. No problem then.
I actually tested this branch in a Ubuntu Jammy Docker, all good (with system Singular).



---

archive/issue_comments_464486.json:
```json
{
    "body": "Replying to [comment:66 mkoeppe]:\n> Clearly commercial-grade work there\n\nI heard stories from a long-term Canonical insider, such as : \"Boss: We're closing down project X, you're fired. \nProgrammer: But, but, I'm also doing projects Y, Z, ...?! Boss: Uhm, OK. You can stay then.\"",
    "created_at": "2022-02-14T11:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464486",
    "user": "dimpase"
}
```

Replying to [comment:66 mkoeppe]:
> Clearly commercial-grade work there

I heard stories from a long-term Canonical insider, such as : "Boss: We're closing down project X, you're fired. 
Programmer: But, but, I'm also doing projects Y, Z, ...?! Boss: Uhm, OK. You can stay then."



---

archive/issue_comments_464487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-14T22:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464487",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464488.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-02-15T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464488",
    "user": "dimpase"
}
```

Thanks!



---

archive/issue_comments_464489.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-20T13:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32552#issuecomment-464489",
    "user": "vbraun"
}
```

Resolution: fixed
