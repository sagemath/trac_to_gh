# Issue 34572: Vizing edge coloring optimization

archive/issues_034572.json:
```json
{
    "body": "Keywords: graph coloring\n\nThis is an optimization of the existing edge_coloring algorithm for graphs, the implementation was discussed at https://groups.google.com/g/sage-devel/c/AzD3codkw2I\n\nIssue created by migration from https://trac.sagemath.org/ticket/34809\n\n",
    "created_at": "2022-11-29T23:25:33Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "Vizing edge coloring optimization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34572",
    "user": "@mam15"
}
```
Keywords: graph coloring

This is an optimization of the existing edge_coloring algorithm for graphs, the implementation was discussed at https://groups.google.com/g/sage-devel/c/AzD3codkw2I

Issue created by migration from https://trac.sagemath.org/ticket/34809





---

archive/issue_comments_489032.json:
```json
{
    "body": "It is not a good idea to change the label of edges inside the method. This main erase other data. Consider using an external dictionary.",
    "created_at": "2022-11-30T09:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489032",
    "user": "dcoudert"
}
```

It is not a good idea to change the label of edges inside the method. This main erase other data. Consider using an external dictionary.



---

archive/issue_comments_489033.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-30T19:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489033",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489034.json:
```json
{
    "body": "Should be good now. I thought g = copy(g) would be enough but using another dict is much cleaner.",
    "created_at": "2022-11-30T21:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489034",
    "user": "@mam15"
}
```

Should be good now. I thought g = copy(g) would be enough but using another dict is much cleaner.



---

archive/issue_comments_489035.json:
```json
{
    "body": "You should use `frozenset(e)` instead of `tuple(sorted(e))`. \n\nAlso, can you push the branch in something like `public/graphs/34809_vizing` to allow me to push review commits. It shall ease the reviewing process.",
    "created_at": "2022-12-01T07:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489035",
    "user": "dcoudert"
}
```

You should use `frozenset(e)` instead of `tuple(sorted(e))`. 

Also, can you push the branch in something like `public/graphs/34809_vizing` to allow me to push review commits. It shall ease the reviewing process.



---

archive/issue_comments_489036.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-02T15:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489036",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-02T15:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489037",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489038.json:
```json
{
    "body": "I did multiple corrections and small improvements(avoid recursive calls, avoid searching in lists, etc.). I have also strengthen the doctests to avoid issues due too small changes. Please do many tests to check if its correct.",
    "created_at": "2022-12-02T15:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489038",
    "user": "dcoudert"
}
```

I did multiple corrections and small improvements(avoid recursive calls, avoid searching in lists, etc.). I have also strengthen the doctests to avoid issues due too small changes. Please do many tests to check if its correct.



---

archive/issue_comments_489039.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-03T06:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489039",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489040.json:
```json
{
    "body": "I couldn't really think of anything the example you created didn't cover, so I ended up testing that example on random graphs, the only difference is I test for len(colors) == Delta or Delta+1.",
    "created_at": "2022-12-03T06:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489040",
    "user": "@mam15"
}
```

I couldn't really think of anything the example you created didn't cover, so I ended up testing that example on random graphs, the only difference is I test for len(colors) == Delta or Delta+1.



---

archive/issue_comments_489041.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-03T10:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489041",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489042.json:
```json
{
    "body": "I changed the doctest to something smaller / faster.\n\nDo you have other improvements for this method ?",
    "created_at": "2022-12-03T10:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489042",
    "user": "dcoudert"
}
```

I changed the doctest to something smaller / faster.

Do you have other improvements for this method ?



---

archive/issue_comments_489043.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-12-03T10:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489043",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_489044.json:
```json
{
    "body": "Not really for the time being, my focus was the ```O(|E||V|)``` algorithm",
    "created_at": "2022-12-03T18:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489044",
    "user": "@mam15"
}
```

Not really for the time being, my focus was the ```O(|E||V|)``` algorithm



---

archive/issue_comments_489045.json:
```json
{
    "body": "There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.\n\n```\nsage: from sage.graphs.graph_coloring import edge_coloring\nsage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)\nsage: edge_coloring(G, value_only=True, vizing=False)\n4\nsage: len(edge_coloring(G, value_only=False, vizing=False))\n5\n```\n\n\nAlso, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).",
    "created_at": "2022-12-04T09:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489045",
    "user": "dcoudert"
}
```

There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.

```
sage: from sage.graphs.graph_coloring import edge_coloring
sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)
sage: edge_coloring(G, value_only=True, vizing=False)
4
sage: len(edge_coloring(G, value_only=False, vizing=False))
5
```


Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).



---

archive/issue_comments_489046.json:
```json
{
    "body": "I have a few minor comments/suggestions.\n\n1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?\n\nActually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.\n\n2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.\n\nI can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.\n\n3) The docstring's phrase \"This may result in either a `\\Delta`-edge-coloring or a `Delta + 1`-edge-coloring\" is very unclear.  I think the usual definition of \"k-coloring\" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term \"`\\Delta`-edge-coloring\", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.\n\n(Also, I think parentheses are necessary around \"`Delta + 1`\", and I think there is a typo: \"\\Delta\" is missing its backslash in \"`Delta + 1`-edge-coloring\".)\n\n4) Please add a reference to this trac ticket in a docstring or comment.",
    "created_at": "2022-12-04T18:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489046",
    "user": "@DaveWitteMorris"
}
```

I have a few minor comments/suggestions.

1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?

Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.

2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.

I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.

3) The docstring's phrase "This may result in either a `\Delta`-edge-coloring or a `Delta + 1`-edge-coloring" is very unclear.  I think the usual definition of "k-coloring" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term "`\Delta`-edge-coloring", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.

(Also, I think parentheses are necessary around "`Delta + 1`", and I think there is a typo: "\Delta" is missing its backslash in "`Delta + 1`-edge-coloring".)

4) Please add a reference to this trac ticket in a docstring or comment.



---

archive/issue_comments_489047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-04T23:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489048.json:
```json
{
    "body": "Replying to [comment:14 David Coudert]:\n> There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.\n> {{{\n> sage: from sage.graphs.graph_coloring import edge_coloring\n> sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)\n> sage: edge_coloring(G, value_only=True, vizing=False)\n> 4\n> sage: len(edge_coloring(G, value_only=False, vizing=False))\n> 5\n> }}}\n> \n> Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).\n\nShould be fixed now\n\nReplying to [comment:15 Dave Morris]:\n> I have a few minor comments/suggestions.\n> \n> 1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?\n> \n> Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.\n> \n> 2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.\n> \n> I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.\n> \n\nThis can be fixed by adding a new color class with a random edge if a coloring with Delta colors is found, not sure if it's the best solution though. Please let me know if you have any other idea or if we should just start a discussion on sage-devel about the deprecation of this function.\n\n> 3) The docstring's phrase \"This may result in either a `\\Delta`-edge-coloring or a `Delta + 1`-edge-coloring\" is very unclear.  I think the usual definition of \"k-coloring\" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term \"`\\Delta`-edge-coloring\", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.\n> \n> (Also, I think parentheses are necessary around \"`Delta + 1`\", and I think there is a typo: \"\\Delta\" is missing its backslash in \"`Delta + 1`-edge-coloring\".)\n> \n> 4) Please add a reference to this trac ticket in a docstring or comment.\n\nAdded all your suggestions.",
    "created_at": "2022-12-04T23:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489048",
    "user": "@mam15"
}
```

Replying to [comment:14 David Coudert]:
> There is an error due to the call `return _vizing_edge_coloring(g, hex_colors)` in the except statement.
> {{{
> sage: from sage.graphs.graph_coloring import edge_coloring
> sage: G = graphs.CycleGraph(5) + graphs.Grid2dGraph(3, 4)
> sage: edge_coloring(G, value_only=True, vizing=False)
> 4
> sage: len(edge_coloring(G, value_only=False, vizing=False))
> 5
> }}}
> 
> Also, you should check before the `ILP` if `Delta + 1 <= chi`, in which case you can directly call vizing on that component (but not on the graph).

Should be fixed now

Replying to [comment:15 Dave Morris]:
> I have a few minor comments/suggestions.
> 
> 1) Please eliminate the `hex_color` code duplication. Instead of copy-pasting the `hex_color` code, wouldn't it be better to have the private method return the coloring, and let the main routine process it if necessary?
> 
> Actually I would be +1 on deleting the `hex_color` keyword, but that would be a separate ticket. Duplicating this code is moving entirely in the wrong direction, in my opinion.
> 
> 2) The new implementation changes the method in a backward-incompatible way.  Sage policy therefore requires a deprecation period.  This policy is not always enforced, but there should be a good reason, so it should be specifically discussed, and perhaps the change should be announced on sage-devel, to see if there are any objections.
> 
> I can easily imagine cases where this change breaks code.  For example, if I were looking at lots of graphs of the same maximum degree, I might want to make an incidence matrix that keeps track of which edges are incident with which colors of edges. In the current implementation, I am guaranteed that these matrices all have the same size, but that guarantee is being dropped.
> 

This can be fixed by adding a new color class with a random edge if a coloring with Delta colors is found, not sure if it's the best solution though. Please let me know if you have any other idea or if we should just start a discussion on sage-devel about the deprecation of this function.

> 3) The docstring's phrase "This may result in either a `\Delta`-edge-coloring or a `Delta + 1`-edge-coloring" is very unclear.  I think the usual definition of "k-coloring" is that it can use k colors or less, so every `(Delta + 1)`-edge-coloring is also a `\Delta`-edge-coloring.  Thus, Vizing's Theorem always produces a `(Delta + 1)`-edge coloring. So, instead of using the term "`\Delta`-edge-coloring", I think the phrasing should make it more clear that the number of colors that actually appear in the coloring is either `Delta` or `Delta + 1`.
> 
> (Also, I think parentheses are necessary around "`Delta + 1`", and I think there is a typo: "\Delta" is missing its backslash in "`Delta + 1`-edge-coloring".)
> 
> 4) Please add a reference to this trac ticket in a docstring or comment.

Added all your suggestions.



---

archive/issue_comments_489049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-05T10:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489049",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489050.json:
```json
{
    "body": "I added an internal function to avoir some code duplication. I also make sure that chi is updated.\n\nSeveral points raised by Dave must be addressed. I agree that Vizing should return a `Delta + 1` coloring, even if the last color is an empty set (e.g., for the star graph which requires only `Delta` colors).",
    "created_at": "2022-12-05T10:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489050",
    "user": "dcoudert"
}
```

I added an internal function to avoir some code duplication. I also make sure that chi is updated.

Several points raised by Dave must be addressed. I agree that Vizing should return a `Delta + 1` coloring, even if the last color is an empty set (e.g., for the star graph which requires only `Delta` colors).



---

archive/issue_comments_489051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-06T23:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489051",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489052.json:
```json
{
    "body": "I think everything should be up to standard now, please let me know if I missed anything",
    "created_at": "2022-12-06T23:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489052",
    "user": "@mam15"
}
```

I think everything should be up to standard now, please let me know if I missed anything



---

archive/issue_comments_489053.json:
```json
{
    "body": "The is still some ambiguity in the description of the case `vizing == True`. The method should return a coloring using `Delta+ 1` colors, even if some colors are empty.",
    "created_at": "2022-12-10T13:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489053",
    "user": "dcoudert"
}
```

The is still some ambiguity in the description of the case `vizing == True`. The method should return a coloring using `Delta+ 1` colors, even if some colors are empty.



---

archive/issue_comments_489054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-12T00:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489054",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_489055.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-12T00:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34572#issuecomment-489055",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:
