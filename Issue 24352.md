# Issue 24352: Pickling matrices over GF(2) does not preserve their immutability

Issue created by migration from Trac.

Original creator: nbruin

Original creation time: 2018-01-24 11:56:52

CC:  embray jdemeyer slelievre


```
sage: A=matrix(GF(2),[[1,0],[0,1]])
sage: A.set_immutable()
sage: loads(dumps(A)).is_immutable()
False
```


from `explain_pickle(dumps(A))` it looks like the pickling routine for `sage.matrix.matrix_mod2_dense` is just a little too naive. For several other base rings immutability is preserved.

Reported on

https://ask.sagemath.org/question/40756/making-a-dictionary-of-matrices-and-save-the-session/


---

Comment by embray created at 2018-09-24 14:29:44

It's probably a simple fix in case anyone would like to try to do it for Sage 8.4 (which I believe will be accepting new fixes for ~1 week).


---

Comment by nbruin created at 2018-09-24 17:20:20

I'm afraid it could be a bit of work: You need to store a new value in the pickle, so this possibly needs a new format for pickling these matrices. Some care needs to be taken that old pickles are still read correctly. When I made the ticket I did take a look if I could fix it easily and at the time I concluded it was a bit more work/took a little more expertise than I had available.


---

Comment by tscrim created at 2018-09-24 22:57:27

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-09-24 22:57:27

It should just be a matter of appending on another optional value `immutable=True` to the `unpickle_matrix_mod2_dense_v1` (or maybe call it `v2` with an `register_unpickle_override`) and just add the extra input of the `_is_immutable` to the corresponding `__reduce__`. So I did that on this branch.
----
New commits:


---

Comment by nbruin created at 2018-09-25 09:08:10

Thanks. That's what I roughly had in mind. It's good you know the details for how to accomplish it.


---

Comment by nbruin created at 2018-09-25 09:08:10

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-09-25 12:25:30

Thanks for the review.


---

Comment by vbraun created at 2018-09-27 17:41:22

Resolution: fixed
