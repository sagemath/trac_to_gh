# Issue 15474: DiscreteHiddenMarkovModel instances do not unpickle correctly

Issue created by migration from https://trac.sagemath.org/ticket/15711

Original creator: ppurka

Original creation time: 2014-01-22 16:55:47

From the [google notebook bug reports](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA)

_As you can see in the following script, even though an unpickled instance claims to be equal to the original, it behaves differently. Worse, several of the functions (e.g., M2.transition_matrix()) throw exceptions, and an exception is thrown if you just try to print the object's value. _

```
sage: from sage.stats.hmm.hmm import DIscreteHiddenMarkovModel
sage: M = DiscreteHiddenMarkovModel([[1.0]], [[0.1, 0.9]], [1.0])
sage: import pickle
sage: M2 = pickle.loads(pickle.dumps(M))
sage: M2 == M
True
sage: M.log_likelihood([1]*4)
-0.4214420626313051
sage: M2.log_likelihood([1]*4)
-inf
sage: M2.emission_matrix()
---------------------------------------------------------------------------
ValueError Traceback (most recent call last)
<ipython-input-24-2ee08778d25e> in <module>()
----> 1 M2.emission_matrix()

/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/stats/hmm/hmm.so in sage.stats.hmm.hmm.DiscreteHiddenMarkovModel.emission_matrix (sage/stats/hmm/hmm.c:2760)()

/opt/sage-5.12-linux-64bit-fedora_release_16_verne-x86_64-Linux/local/lib/python2.7/site-packages/sage/matrix/constructor.pyc in _matrix_constructor(*args, **kwds)
641 raise ValueError, "entries has the wrong length"
642 elif len(args[0]) > 0:
--> 643 raise ValueError, "entries has the wrong length"
644 
645 entries = args[0]

ValueError: entries has the wrong length

sage: M2
---------------------------------------------------------------------------
ValueError Traceback (most recent call last)
<ipython-input-20-13669956a766> in <module>()
... (long trace deleted)
```



---

Comment by msaaltink created at 2016-11-14 00:59:52

Changing status from new to needs_review.


---

Comment by msaaltink created at 2016-11-14 00:59:52

New commits:


---

Comment by saraedum created at 2016-11-17 06:46:02

Btw. I could not find your name on https://trac.sagemath.org/wiki, you might want to add it there.


---

Comment by saraedum created at 2016-11-17 07:05:13

I tweaked the docstring a bit. If you are fine with this, feel free to set it to positive review yourself.
----
New commits:


---

Comment by msaaltink created at 2016-11-17 21:50:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-19 22:10:03

Resolution: fixed
