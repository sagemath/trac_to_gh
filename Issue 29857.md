# Issue 29857: Basis-dependent isomorphism from FiniteRankFreeModule to an object in the category ModulesWithBasis

archive/issues_029857.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim @mjungmath\n\n(This ticket has been narrowed to the topic mainly discussed in the comments. The topic originally in title and ticket description has been moved to #30174)\n\nThere are multiple incompatible protocols for dealing with bases of a free module in Sage (#19346).\n\nOne such protocol is defined by the category `ModulesWithBasis`. `CombinatorialFreeModule` is one of the parent classes in this category.\n\nAnother such protocol is defined by the parent class `FiniteRankFreeModule`, which is in the category `Modules`.\nA `FiniteRankFreeModule` can be equipped with a finite list of bases (each represented by an instance of `FreeModuleBasis`), none of which are considered distinguished. `FiniteRankFreeModule`s are unique parents; the operation of equipping a `FiniteRankFreeModule`  does not change the identity of the parent.\n\nWe define a method `FiniteRankFreeModule. isomorphism_with_fixed_basis` that establishes, given a basis, an isomorphism with a `CombinatorialFreeModule` (and thus a parent in the category `ModulesWithBasis`.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30094\n\n",
    "closed_at": "2020-08-02T08:20:38Z",
    "created_at": "2020-07-08T20:40:59Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Basis-dependent isomorphism from FiniteRankFreeModule to an object in the category ModulesWithBasis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29857",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @egourgoulhon @tscrim @mjungmath

(This ticket has been narrowed to the topic mainly discussed in the comments. The topic originally in title and ticket description has been moved to #30174)

There are multiple incompatible protocols for dealing with bases of a free module in Sage (#19346).

One such protocol is defined by the category `ModulesWithBasis`. `CombinatorialFreeModule` is one of the parent classes in this category.

Another such protocol is defined by the parent class `FiniteRankFreeModule`, which is in the category `Modules`.
A `FiniteRankFreeModule` can be equipped with a finite list of bases (each represented by an instance of `FreeModuleBasis`), none of which are considered distinguished. `FiniteRankFreeModule`s are unique parents; the operation of equipping a `FiniteRankFreeModule`  does not change the identity of the parent.

We define a method `FiniteRankFreeModule. isomorphism_with_fixed_basis` that establishes, given a basis, an isomorphism with a `CombinatorialFreeModule` (and thus a parent in the category `ModulesWithBasis`.



Issue created by migration from https://trac.sagemath.org/ticket/30094





---

archive/issue_comments_423623.json:
```json
{
    "body": "Also it seems various maps are missing.\n\n```\nsage: Q3.has_coerce_map_from(QQ^3)\nFalse\nsage: Q3((QQ^3).an_element())\nValueError: the None has not been defined on the 3-dimensional vector space over the Rational Field\n```",
    "created_at": "2020-07-10T18:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423623",
    "user": "https://github.com/mkoeppe"
}
```

Also it seems various maps are missing.

```
sage: Q3.has_coerce_map_from(QQ^3)
False
sage: Q3((QQ^3).an_element())
ValueError: the None has not been defined on the 3-dimensional vector space over the Rational Field
```



---

archive/issue_comments_423624.json:
```json
{
    "body": "These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.\n\nMy 2 cents for the error reported in the ticket is to first check that the object is not in the category. The other option is to lift the `vector_space` method up to the category of modules and then implement a `change_ring` method for `Q3`.",
    "created_at": "2020-07-17T02:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423624",
    "user": "https://github.com/tscrim"
}
```

These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.

My 2 cents for the error reported in the ticket is to first check that the object is not in the category. The other option is to lift the `vector_space` method up to the category of modules and then implement a `change_ring` method for `Q3`.



---

archive/issue_comments_423625.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.\n\n\nShouldn't there be a map in one direction that forgets the distinguished basis?",
    "created_at": "2020-07-17T02:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423625",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:4 tscrim]:
> These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.


Shouldn't there be a map in one direction that forgets the distinguished basis?



---

archive/issue_comments_423626.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> Replying to [comment:4 tscrim]:\n> > These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.\n\n> \n> Shouldn't there be a map in one direction that forgets the distinguished basis?\n\n\nNo, because where would you send the point `(1,3,1)` to? How would you know how it is expressed in one of the bases of `Q3`?",
    "created_at": "2020-07-17T02:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423626",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:5 mkoeppe]:
> Replying to [comment:4 tscrim]:
> > These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.

> 
> Shouldn't there be a map in one direction that forgets the distinguished basis?


No, because where would you send the point `(1,3,1)` to? How would you know how it is expressed in one of the bases of `Q3`?



---

archive/issue_comments_423627.json:
```json
{
    "body": "Ok, I feel we had this discussion before",
    "created_at": "2020-07-17T18:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423627",
    "user": "https://github.com/mkoeppe"
}
```

Ok, I feel we had this discussion before



---

archive/issue_comments_423628.json:
```json
{
    "body": "Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?",
    "created_at": "2020-07-17T18:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423628",
    "user": "https://github.com/mkoeppe"
}
```

Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?



---

archive/issue_comments_423629.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n\nNo, I don't think it should. The identity map (like any other automorphism) is a basis independent object.",
    "created_at": "2020-07-17T18:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423629",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:8 mkoeppe]:
> Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?


No, I don't think it should. The identity map (like any other automorphism) is a basis independent object.



---

archive/issue_comments_423630.json:
```json
{
    "body": "Replying to [comment:9 gh-mjungmath]:\n> Replying to [comment:8 mkoeppe]:\n> > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n> \n> No, I don't think it should. The identity map (like any other automorphism) is a basis independent object.\n\n\nI might even go further to say that it would not be the identity map, but an isomorphism of free modules. We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. So there is no identity map from `V -> W` because I am not looking at `End(V)`, but `Mor(V, W)`. Yes, they are isomorphic, but there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.",
    "created_at": "2020-07-17T23:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423630",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:9 gh-mjungmath]:
> Replying to [comment:8 mkoeppe]:
> > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?

> 
> No, I don't think it should. The identity map (like any other automorphism) is a basis independent object.


I might even go further to say that it would not be the identity map, but an isomorphism of free modules. We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. So there is no identity map from `V -> W` because I am not looking at `End(V)`, but `Mor(V, W)`. Yes, they are isomorphic, but there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.



---

archive/issue_comments_423631.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> Replying to [comment:9 gh-mjungmath]:\n> > Replying to [comment:8 mkoeppe]:\n> > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n> > \n> > No, I don't think it should. The identity map (like any other automorphism) is a basis independent object.\n\n> \n> I might even go further to say that it would not be the identity map, but an isomorphism of free modules. \n\n\nOf course, that's what I meant.",
    "created_at": "2020-07-17T23:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423631",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 tscrim]:
> Replying to [comment:9 gh-mjungmath]:
> > Replying to [comment:8 mkoeppe]:
> > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?

> > 
> > No, I don't think it should. The identity map (like any other automorphism) is a basis independent object.

> 
> I might even go further to say that it would not be the identity map, but an isomorphism of free modules. 


Of course, that's what I meant.



---

archive/issue_comments_423632.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> > Replying to [comment:8 mkoeppe]:\n> > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n> > \n> We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. \n> ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.\n\n\nIn my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis.",
    "created_at": "2020-07-17T23:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423632",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 tscrim]:
> > Replying to [comment:8 mkoeppe]:
> > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?

> > 
> We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. 
> ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.


In my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis.



---

archive/issue_comments_423633.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> Replying to [comment:10 tscrim]:\n> > > Replying to [comment:8 mkoeppe]:\n> > > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n> > > \n> > We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. \n> > ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.\n  \n> \n> In my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis. \n\n\nYou were asking for a map from `self.free_module()`, which is the free module without a distinguished basis. If you want to go from a `FreeModuleBasis`, then that might be a good method as there is a canonical isomorphism of the homspace with the endspace and an identity map. Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.",
    "created_at": "2020-07-18T00:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423633",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:12 mkoeppe]:
> Replying to [comment:10 tscrim]:
> > > Replying to [comment:8 mkoeppe]:
> > > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?

> > > 
> > We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. 
> > ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.
  
> 
> In my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis. 


You were asking for a map from `self.free_module()`, which is the free module without a distinguished basis. If you want to go from a `FreeModuleBasis`, then that might be a good method as there is a canonical isomorphism of the homspace with the endspace and an identity map. Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.



---

archive/issue_comments_423634.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> Replying to [comment:12 mkoeppe]:\n> > Replying to [comment:10 tscrim]:\n> > > > Replying to [comment:8 mkoeppe]:\n> > > > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?\n\n> > > > \n> > > We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. \n> > > ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.\n  \n> > \n> > In my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis. \n\n> \n> You were asking for a map from `self.free_module()`, which is the free module without a distinguished basis. If you want to go from a `FreeModuleBasis`, then that might be a good method as there is a canonical isomorphism of the homspace with the endspace and an identity map. Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.\n\n\nI of course agree that one may implement a method in `FreeModuleBasis` that returns an isomorphism between `Q3` and `QQ^3`, but for which purpose? Such an isomorphism cannot be used for a coercion since a coercion must be unique and cannot depend on a extra parameter such as a\nbasis-dependent isomorphism.\n\nComing back to the issue mentioned in the ticket title and description, I would say that the problem arises because \"vector spaces\" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.",
    "created_at": "2020-07-18T14:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423634",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:13 tscrim]:
> Replying to [comment:12 mkoeppe]:
> > Replying to [comment:10 tscrim]:
> > > > Replying to [comment:8 mkoeppe]:
> > > > > Should `FreeModuleBasis` get a method that creates the identity map from `self.free_module()` to a free module with that basis?

> > > > 
> > > We have to be careful about distinguishing things up to equality and up to isomorphism. For example, if I have `V = span_R{x,y,z}`, this is not equal to `W = R^3`. 
> > > ... there is no canonical isomorphism until I choose a distinguished basis for `V` and `W`.
  
> > 
> > In my question above, this would be a method of `FreeModuleBasis` - so there is a particular basis. And `RR^3` also has a distinguished basis. 

> 
> You were asking for a map from `self.free_module()`, which is the free module without a distinguished basis. If you want to go from a `FreeModuleBasis`, then that might be a good method as there is a canonical isomorphism of the homspace with the endspace and an identity map. Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.


I of course agree that one may implement a method in `FreeModuleBasis` that returns an isomorphism between `Q3` and `QQ^3`, but for which purpose? Such an isomorphism cannot be used for a coercion since a coercion must be unique and cannot depend on a extra parameter such as a
basis-dependent isomorphism.

Coming back to the issue mentioned in the ticket title and description, I would say that the problem arises because "vector spaces" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.



---

archive/issue_comments_423635.json:
```json
{
    "body": "Replying to [comment:14 egourgoulhon]:\n> Coming back to the issue mentioned in the ticket title and description, I would say that the problem arises because \"vector spaces\" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.    \n\n\nOK, I think we are getting closer. \n\nWhen you say, '\"vector spaces\" as they are implemented in Sage', I assume you mean the ones implemented in `sage.modules.free_module` and constructed by the function `VectorSpace`, and then I agree with what you wrote.\n\nWhat I was asking for in comment 8 is, given a basis, a map from a `FiniteRankFreeModule` (which is in the category of finite dimensional modules) to a parent that is in the category of finite dimensional modules with basis.",
    "created_at": "2020-07-18T16:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423635",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:14 egourgoulhon]:
> Coming back to the issue mentioned in the ticket title and description, I would say that the problem arises because "vector spaces" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.    


OK, I think we are getting closer. 

When you say, '"vector spaces" as they are implemented in Sage', I assume you mean the ones implemented in `sage.modules.free_module` and constructed by the function `VectorSpace`, and then I agree with what you wrote.

What I was asking for in comment 8 is, given a basis, a map from a `FiniteRankFreeModule` (which is in the category of finite dimensional modules) to a parent that is in the category of finite dimensional modules with basis.



---

archive/issue_comments_423636.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> I might even go further to say that it would not be the identity map, but an isomorphism of free modules.\n\n\nWell, yes. It is a special kind of automorphism. However, I wouldn't see it as an isomorphism between any two free modules of the same rank, in case this is what you are referring to.\n\nReplying to [comment:13 tscrim]:\n> Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.\n\n\nI am not sure what you mean with \"the span of the basis elements\". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).",
    "created_at": "2020-07-18T19:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423636",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:10 tscrim]:
> I might even go further to say that it would not be the identity map, but an isomorphism of free modules.


Well, yes. It is a special kind of automorphism. However, I wouldn't see it as an isomorphism between any two free modules of the same rank, in case this is what you are referring to.

Replying to [comment:13 tscrim]:
> Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.


I am not sure what you mean with "the span of the basis elements". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).



---

archive/issue_comments_423637.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.\n\n\nAgreed.\n\n> My 2 cents for the error reported in the ticket is to first check that the object is not in the category. The other option is to lift the `vector_space` method up to the category of modules and then implement a `change_ring` method for `Q3`.\n\n\nSounds good. Who goes for it?",
    "created_at": "2020-07-18T20:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423637",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:4 tscrim]:
> These are incompatible objects since `QQ^3` has a distinguished basis (the standard Euclidean basis) whereas `Q3` does not. So there should not be a map between them.


Agreed.

> My 2 cents for the error reported in the ticket is to first check that the object is not in the category. The other option is to lift the `vector_space` method up to the category of modules and then implement a `change_ring` method for `Q3`.


Sounds good. Who goes for it?



---

archive/issue_comments_423638.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> Replying to [comment:14 egourgoulhon]:\n> > Coming back to the issue mentioned in the ticket title and description, I would say that the problem arises because \"vector spaces\" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.    \n\n> \n> OK, I think we are getting closer. \n> \n> When you say, '\"vector spaces\" as they are implemented in Sage', I assume you mean the ones implemented in `sage.modules.free_module` and constructed by the function `VectorSpace`, \n\nYes.\n>and then I agree with what you wrote.\n>\n>What I was asking for in comment 8 is, given a basis, a map from a `FiniteRankFreeModule` (which is in the category of finite dimensional modules) to a parent that is in the category of finite dimensional modules with basis.\n> \n\nYes, this is the basis-dependent isomorphism I was referring to comment:14, but my concern, and that of Travis if I understand correctly, is that such an isomorphism cannot be used for a coercion, because it is not canonical (by definition, it depends on a choice of basis).",
    "created_at": "2020-07-18T22:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423638",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:15 mkoeppe]:
> Replying to [comment:14 egourgoulhon]:
> > Coming back to the issue mentioned in the ticket title and description, I would say that the problem arises because "vector spaces" as they are implemented in Sage are not really vector spaces in all their generality but only Cartesian powers `F^n`, where `F` is the base field.    

> 
> OK, I think we are getting closer. 
> 
> When you say, '"vector spaces" as they are implemented in Sage', I assume you mean the ones implemented in `sage.modules.free_module` and constructed by the function `VectorSpace`, 

Yes.
>and then I agree with what you wrote.
>
>What I was asking for in comment 8 is, given a basis, a map from a `FiniteRankFreeModule` (which is in the category of finite dimensional modules) to a parent that is in the category of finite dimensional modules with basis.
> 

Yes, this is the basis-dependent isomorphism I was referring to comment:14, but my concern, and that of Travis if I understand correctly, is that such an isomorphism cannot be used for a coercion, because it is not canonical (by definition, it depends on a choice of basis).



---

archive/issue_comments_423639.json:
```json
{
    "body": "Replying to [comment:18 egourgoulhon]:\n> Yes, this is the basis-dependent isomorphism I was referring to comment:14, but my concern, and that of Travis if I understand correctly, is that such an isomorphism cannot be used for a coercion, because it is not canonical (by definition, it depends on a choice of basis). \n\n\nI've pushed a rough implementation of this to the ticket.\n\nSure, I don't need this to be a coercion. Just a module morphism.\n\n\n\n---\nNew commits:",
    "created_at": "2020-07-18T22:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423639",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:18 egourgoulhon]:
> Yes, this is the basis-dependent isomorphism I was referring to comment:14, but my concern, and that of Travis if I understand correctly, is that such an isomorphism cannot be used for a coercion, because it is not canonical (by definition, it depends on a choice of basis). 


I've pushed a rough implementation of this to the ticket.

Sure, I don't need this to be a coercion. Just a module morphism.



---
New commits:



---

archive/issue_comments_423640.json:
```json
{
    "body": "Replying to [comment:16 gh-mjungmath]:\n> Replying to [comment:13 tscrim]:\n> > Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.\n\n> \n> I am not sure what you mean with \"the span of the basis elements\". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).\n\n\nThe question is what does this class represent:\n\n1. The basis itself, which is a finite set.\n2. The span of the basis elements, which is a vector space where we can represent the points in terms of the chosen basis elements.\n\nThese are very different objects. One is finite, one is infinite (well, |R|<sup>n</sup>, where R is the base ring). Since you want to think of it as 1, then you are saying there should not be a morphism. However, most of the points of the free module should not be elements of this parent. The actual implementation is really treating it like 2, and its elements are the points of the free module represented using the chosen basis.\n\n---\n\nI like the proposed method overall. I have some suggestions:\n\n1 - Change the name to something like `morphism_with_fixed_basis` as right now it sounds like it is constructing a map that happens to fix a basis.\n2 - Allow the codomain of the map to be passed to the function. Then you can have the map be defined as\n\n```python\n        if codomain.dimension() != self.dimension():\n            raise ValueError\n        B = list(codomain.basis())\n        def function(x):\n            return codomain.sum(x[basis, i] * B[i] for i in self.irange())\n```\nThis should be implementation independent (if it is not, then it is a bug IMO).",
    "created_at": "2020-07-18T23:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423640",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:16 gh-mjungmath]:
> Replying to [comment:13 tscrim]:
> > Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.

> 
> I am not sure what you mean with "the span of the basis elements". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).


The question is what does this class represent:

1. The basis itself, which is a finite set.
2. The span of the basis elements, which is a vector space where we can represent the points in terms of the chosen basis elements.

These are very different objects. One is finite, one is infinite (well, |R|<sup>n</sup>, where R is the base ring). Since you want to think of it as 1, then you are saying there should not be a morphism. However, most of the points of the free module should not be elements of this parent. The actual implementation is really treating it like 2, and its elements are the points of the free module represented using the chosen basis.

---

I like the proposed method overall. I have some suggestions:

1 - Change the name to something like `morphism_with_fixed_basis` as right now it sounds like it is constructing a map that happens to fix a basis.
2 - Allow the codomain of the map to be passed to the function. Then you can have the map be defined as

```python
        if codomain.dimension() != self.dimension():
            raise ValueError
        B = list(codomain.basis())
        def function(x):
            return codomain.sum(x[basis, i] * B[i] for i in self.irange())
```
This should be implementation independent (if it is not, then it is a bug IMO).



---

archive/issue_comments_423641.json:
```json
{
    "body": "Replying to [comment:21 tscrim]:\n> Replying to [comment:16 gh-mjungmath]:\n> > Replying to [comment:13 tscrim]:\n> > > Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.\n\n> > \n> > I am not sure what you mean with \"the span of the basis elements\". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).\n\n> \n> The question is what does this class represent:\n> \n> 1. The basis itself, which is a finite set.\n> 2. The span of the basis elements, which is a vector space where we can represent the points in terms of the chosen basis elements.\n\n\nI think it's clear that 1 is intended:\n\n```\nsage: V = FiniteRankFreeModule(QQ, 3)\nsage: e = V.basis(\"e\")\nsage: e[0] in e\nTrue\nsage: e[1] in e\nTrue\nsage: e[0] + e[1] in e\nFalse",
    "created_at": "2020-07-19T00:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423641",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:21 tscrim]:
> Replying to [comment:16 gh-mjungmath]:
> > Replying to [comment:13 tscrim]:
> > > Although I am not sure how much the basis is intended as a basis as a set or the span of the basis elements. I suspect the former, so such a method would not make sense. I would have to see what Eric and Michal say.

> > 
> > I am not sure what you mean with "the span of the basis elements". This does not make any sense to me because the span is always the free module again. Anyway, I would see an instance of `FreeModuleBasis` as a representation of a (finite) subset of the corresponding free module which is linearly independent and generates the module (possibly in the sense of formal linear combinations).

> 
> The question is what does this class represent:
> 
> 1. The basis itself, which is a finite set.
> 2. The span of the basis elements, which is a vector space where we can represent the points in terms of the chosen basis elements.


I think it's clear that 1 is intended:

```
sage: V = FiniteRankFreeModule(QQ, 3)
sage: e = V.basis("e")
sage: e[0] in e
True
sage: e[1] in e
True
sage: e[0] + e[1] in e
False



---

archive/issue_comments_423642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-19T00:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423643.json:
```json
{
    "body": "Ah, right. Yes, it is clear that it is 1. I got myself confused.",
    "created_at": "2020-07-19T01:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423643",
    "user": "https://github.com/tscrim"
}
```

Ah, right. Yes, it is clear that it is 1. I got myself confused.



---

archive/issue_comments_423644.json:
```json
{
    "body": "Replying to [comment:23 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                    |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n> |[7366741](https://git.sagemath.org/sage.git/commit/?id=73667410fb02014b789a49ef58e9846ecc729419)|`Rename, generalize`|\n\n\nI must agree Eric in comment:14, I don't see the use of such a method `isomorphism_with_fixed_basis`, not even in `FiniteRankFreeModule`.\n\nI see no problem in implementing the coercion on the level of modules right away. There is no need for such method either in this case. The vector space `QQ^3` forgets about the basis we have chosen, anyway (i.e. there is no going back). The important thing is that we are able to choose a basis. But this is ensured due to the definition of a free module.\n\nI have to admit, I am not sure what's the problem is we're still discussing; apart from the error reported in the description. Is it still all about comment:2? As reported in this ticket, we want to coerce the free modules themselves and not their elements.",
    "created_at": "2020-07-19T08:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423644",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:23 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                    |
> |-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
> |[7366741](https://git.sagemath.org/sage.git/commit/?id=73667410fb02014b789a49ef58e9846ecc729419)|`Rename, generalize`|


I must agree Eric in comment:14, I don't see the use of such a method `isomorphism_with_fixed_basis`, not even in `FiniteRankFreeModule`.

I see no problem in implementing the coercion on the level of modules right away. There is no need for such method either in this case. The vector space `QQ^3` forgets about the basis we have chosen, anyway (i.e. there is no going back). The important thing is that we are able to choose a basis. But this is ensured due to the definition of a free module.

I have to admit, I am not sure what's the problem is we're still discussing; apart from the error reported in the description. Is it still all about comment:2? As reported in this ticket, we want to coerce the free modules themselves and not their elements.



---

archive/issue_comments_423645.json:
```json
{
    "body": "Replying to [comment:25 gh-mjungmath]:\n> I have to admit, I am not sure what's the problem is we're still discussing\n\n\nThanks. I will split the ticket into two and clarify the descriptions.",
    "created_at": "2020-07-19T14:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423645",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 gh-mjungmath]:
> I have to admit, I am not sure what's the problem is we're still discussing


Thanks. I will split the ticket into two and clarify the descriptions.



---

archive/issue_comments_423646.json:
```json
{
    "body": "The topic originally on the ticket description is now in #30174.\nI hope this helps.",
    "created_at": "2020-07-19T14:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423646",
    "user": "https://github.com/mkoeppe"
}
```

The topic originally on the ticket description is now in #30174.
I hope this helps.



---

archive/issue_comments_423647.json:
```json
{
    "body": "Looking at the code, I begin to like the idea, too. :)\n\nIt's still a draft, however I'd like to propose an improvement regarding the docstring:\n\n```diff\n         Construct the canonical isomorphism from the free module ``self``\n-        to a free module in which ``basis`` of ``self`` is the distinguished basis.\n+        to a free module in which ``basis`` of ``self`` is mapped to the\n+        distinguished basis of ``codomain``.\n```\n\nI think it would also be good to specify input and output in the docstring. In particular, the input `codomain` should be described as an element of `ModulesWithBasis` having the same rank as `self` and over the same base ring. Furthermore, it should be explained that `CombinatorialFreeModule` is chosen by default if the input is `None`.",
    "created_at": "2020-07-19T15:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423647",
    "user": "https://github.com/mjungmath"
}
```

Looking at the code, I begin to like the idea, too. :)

It's still a draft, however I'd like to propose an improvement regarding the docstring:

```diff
         Construct the canonical isomorphism from the free module ``self``
-        to a free module in which ``basis`` of ``self`` is the distinguished basis.
+        to a free module in which ``basis`` of ``self`` is mapped to the
+        distinguished basis of ``codomain``.
```

I think it would also be good to specify input and output in the docstring. In particular, the input `codomain` should be described as an element of `ModulesWithBasis` having the same rank as `self` and over the same base ring. Furthermore, it should be explained that `CombinatorialFreeModule` is chosen by default if the input is `None`.



---

archive/issue_comments_423648.json:
```json
{
    "body": "And probably we should raise an error in case both base rings are not equal.",
    "created_at": "2020-07-19T15:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423648",
    "user": "https://github.com/mjungmath"
}
```

And probably we should raise an error in case both base rings are not equal.



---

archive/issue_comments_423649.json:
```json
{
    "body": "Thanks for the suggestions, sounds all good. I don't have time to work on it today. Please feel free to commit changes to the branch",
    "created_at": "2020-07-19T16:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423649",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the suggestions, sounds all good. I don't have time to work on it today. Please feel free to commit changes to the branch



---

archive/issue_comments_423650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-19T19:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423651.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-19T20:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423651",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423652.json:
```json
{
    "body": "Thanks for the code! I think this should be changed:\n\n```diff\n-            return codomain.sum(x[basis, i] * codomain_basis[i]\n-                                for i in self.irange())\n+            return codomain.sum(x[basis, i] * codomain_basis[i - self._sindex]\n+                                for i in self.irange())\n```\nThe doctest \n\n```\nsage: self = V = FiniteRankFreeModule(QQ, 3); V\n```\ncould be changed to\n\n```\nsage: self = V = FiniteRankFreeModule(QQ, 3, start_index=1); V\n```\nto check that everything is OK with index ranges.",
    "created_at": "2020-07-20T12:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423652",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the code! I think this should be changed:

```diff
-            return codomain.sum(x[basis, i] * codomain_basis[i]
-                                for i in self.irange())
+            return codomain.sum(x[basis, i] * codomain_basis[i - self._sindex]
+                                for i in self.irange())
```
The doctest 

```
sage: self = V = FiniteRankFreeModule(QQ, 3); V
```
could be changed to

```
sage: self = V = FiniteRankFreeModule(QQ, 3, start_index=1); V
```
to check that everything is OK with index ranges.



---

archive/issue_comments_423653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-20T13:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423653",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423654.json:
```json
{
    "body": "Replying to [comment:35 egourgoulhon]:\n> Thanks for the code! I think this should be changed:\n> \n> ```\n> #!diff\n> -            return codomain.sum(x[basis, i] * codomain_basis[i]\n> -                                for i in self.irange())\n> +            return codomain.sum(x[basis, i] * codomain_basis[i - self._sindex]\n> +                                for i in self.irange())\n> ```\n> The doctest \n> \n> ```\n> sage: self = V = FiniteRankFreeModule(QQ, 3); V\n> ```\n> could be changed to\n> \n> ```\n> sage: self = V = FiniteRankFreeModule(QQ, 3, start_index=1); V\n> ```\n> to check that everything is OK with index ranges.\n\n\nVery good objection. I took that into consideration. I think, the ticket is ready for review now. Matthias?",
    "created_at": "2020-07-20T13:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423654",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:35 egourgoulhon]:
> Thanks for the code! I think this should be changed:
> 
> ```
> #!diff
> -            return codomain.sum(x[basis, i] * codomain_basis[i]
> -                                for i in self.irange())
> +            return codomain.sum(x[basis, i] * codomain_basis[i - self._sindex]
> +                                for i in self.irange())
> ```
> The doctest 
> 
> ```
> sage: self = V = FiniteRankFreeModule(QQ, 3); V
> ```
> could be changed to
> 
> ```
> sage: self = V = FiniteRankFreeModule(QQ, 3, start_index=1); V
> ```
> to check that everything is OK with index ranges.


Very good objection. I took that into consideration. I think, the ticket is ready for review now. Matthias?



---

archive/issue_comments_423655.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-20T15:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423655",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423656.json:
```json
{
    "body": "I'm happy with these changes, thanks very much!",
    "created_at": "2020-07-20T15:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423656",
    "user": "https://github.com/mkoeppe"
}
```

I'm happy with these changes, thanks very much!



---

archive/issue_comments_423657.json:
```json
{
    "body": "Of course, one could ask what the basis of the `CombinatorialFreeModule` should be indexed by.\n\n```\nsage: V = FiniteRankFreeModule(QQ, 3, start_index=1)\nsage: basis = e = V.basis(\"e\")\nsage: phi_e.codomain().basis()\nFinite family {'e_1': B['e_1'], 'e_2': B['e_2'], 'e_3': B['e_3']}\n```\nI think it would be more natural if this family was indexed by `V.irange()`.",
    "created_at": "2020-07-20T18:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423657",
    "user": "https://github.com/mkoeppe"
}
```

Of course, one could ask what the basis of the `CombinatorialFreeModule` should be indexed by.

```
sage: V = FiniteRankFreeModule(QQ, 3, start_index=1)
sage: basis = e = V.basis("e")
sage: phi_e.codomain().basis()
Finite family {'e_1': B['e_1'], 'e_2': B['e_2'], 'e_3': B['e_3']}
```
I think it would be more natural if this family was indexed by `V.irange()`.



---

archive/issue_comments_423658.json:
```json
{
    "body": "Replying to [comment:40 mkoeppe]:\n> Of course, one could ask what the basis of the `CombinatorialFreeModule` should be indexed by.\n> \n> ```\n> sage: V = FiniteRankFreeModule(QQ, 3, start_index=1)\n> sage: basis = e = V.basis(\"e\")\n> sage: phi_e.codomain().basis()\n> Finite family {'e_1': B['e_1'], 'e_2': B['e_2'], 'e_3': B['e_3']}\n> ```\n> I think it would be more natural if this family was indexed by `V.irange()`.\n\n\nI don't quite get what you want. I have quickly overviewd the documentation of `CombinatorialFreeModule`, and I think that our implementation already carries out the intended behavior.",
    "created_at": "2020-07-20T18:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423658",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:40 mkoeppe]:
> Of course, one could ask what the basis of the `CombinatorialFreeModule` should be indexed by.
> 
> ```
> sage: V = FiniteRankFreeModule(QQ, 3, start_index=1)
> sage: basis = e = V.basis("e")
> sage: phi_e.codomain().basis()
> Finite family {'e_1': B['e_1'], 'e_2': B['e_2'], 'e_3': B['e_3']}
> ```
> I think it would be more natural if this family was indexed by `V.irange()`.


I don't quite get what you want. I have quickly overviewd the documentation of `CombinatorialFreeModule`, and I think that our implementation already carries out the intended behavior.



---

archive/issue_comments_423659.json:
```json
{
    "body": "```\nsage: phi_e.codomain().basis().keys()\n{'e_1', 'e_2', 'e_3'}\n```\nI think the code should be changed so that\n\n```\nsage: phi_e.codomain().basis().keys()\n{1, 2, 3}\n```",
    "created_at": "2020-07-20T19:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423659",
    "user": "https://github.com/mkoeppe"
}
```

```
sage: phi_e.codomain().basis().keys()
{'e_1', 'e_2', 'e_3'}
```
I think the code should be changed so that

```
sage: phi_e.codomain().basis().keys()
{1, 2, 3}
```



---

archive/issue_comments_423660.json:
```json
{
    "body": "Replying to [comment:42 mkoeppe]:\n> {{{\n> sage: phi_e.codomain().basis().keys()\n> {'e_1', 'e_2', 'e_3'}\n> }}}\n> I think the code should be changed so that\n> \n> ```\n> sage: phi_e.codomain().basis().keys()\n> {1, 2, 3}\n> ```\n\n\nAs far as I understand it, the keys correspond to the basis element's name. And I thought that the intention was to name them after the basis we are coming from, wasn't it?\n\nNotice that the names can also differ from the canonical choice, for example `a, b, c`, without labeled indices. In that case, the current implementation is preferrable anyway.",
    "created_at": "2020-07-20T19:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423660",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:42 mkoeppe]:
> {{{
> sage: phi_e.codomain().basis().keys()
> {'e_1', 'e_2', 'e_3'}
> }}}
> I think the code should be changed so that
> 
> ```
> sage: phi_e.codomain().basis().keys()
> {1, 2, 3}
> ```


As far as I understand it, the keys correspond to the basis element's name. And I thought that the intention was to name them after the basis we are coming from, wasn't it?

Notice that the names can also differ from the canonical choice, for example `a, b, c`, without labeled indices. In that case, the current implementation is preferrable anyway.



---

archive/issue_comments_423661.json:
```json
{
    "body": "Are there methods in `FreeModuleBasis` or `FiniteRankFreeModule` that allow the user to look up a basis element by name?",
    "created_at": "2020-07-20T19:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423661",
    "user": "https://github.com/mkoeppe"
}
```

Are there methods in `FreeModuleBasis` or `FiniteRankFreeModule` that allow the user to look up a basis element by name?



---

archive/issue_comments_423662.json:
```json
{
    "body": "I am sorry. I am little off track. You were obiously right:\n\n> `basis_keys` - list, tuple, family, set, etc. defining the indexing set for the basis of this module\n\n\nWhat you suggest sounds good then.",
    "created_at": "2020-07-20T21:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423662",
    "user": "https://github.com/mjungmath"
}
```

I am sorry. I am little off track. You were obiously right:

> `basis_keys` - list, tuple, family, set, etc. defining the indexing set for the basis of this module


What you suggest sounds good then.



---

archive/issue_comments_423663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-20T21:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-20T21:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423665.json:
```json
{
    "body": "Perhaps the prefix \"B\" should be changed to `basis._symbol`",
    "created_at": "2020-07-20T21:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423665",
    "user": "https://github.com/mkoeppe"
}
```

Perhaps the prefix "B" should be changed to `basis._symbol`



---

archive/issue_comments_423666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-21T00:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423667.json:
```json
{
    "body": "Replying to [comment:49 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                          |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n> |[40f589f](https://git.sagemath.org/sage.git/commit/?id=40f589f9033607bae86eec49b1eeb2d020003880)|`Use basis._symbol as prefix instead of B`|\n\n\nReplying to [comment:48 mkoeppe]:\n> Perhaps the prefix \"B\" should be changed to `basis._symbol`\n\n\n\nThis won't work:\n\n```\nsage: M = FiniteRankFreeModule(QQ, 3)\nsage: e = M.basis(['a', 'b', 'c'], symbol_dual=['d', 'e', 'f'])\nsage: phi_e = phi_e = M.isomorphism_with_fixed_basis(e)\nsage: phi_e.codomain().basis()\n<repr(<sage.sets.family.FiniteFamily_with_category at 0x7f03d6b8bb88>) failed: TypeError: can only concatenate tuple (not \"str\") to tuple>\n```\n\nSee comment:43.",
    "created_at": "2020-07-21T07:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423667",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:49 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                          |
> |-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
> |[40f589f](https://git.sagemath.org/sage.git/commit/?id=40f589f9033607bae86eec49b1eeb2d020003880)|`Use basis._symbol as prefix instead of B`|


Replying to [comment:48 mkoeppe]:
> Perhaps the prefix "B" should be changed to `basis._symbol`



This won't work:

```
sage: M = FiniteRankFreeModule(QQ, 3)
sage: e = M.basis(['a', 'b', 'c'], symbol_dual=['d', 'e', 'f'])
sage: phi_e = phi_e = M.isomorphism_with_fixed_basis(e)
sage: phi_e.codomain().basis()
<repr(<sage.sets.family.FiniteFamily_with_category at 0x7f03d6b8bb88>) failed: TypeError: can only concatenate tuple (not "str") to tuple>
```

See comment:43.



---

archive/issue_comments_423668.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-21T07:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423668",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_423669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-21T14:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423670.json:
```json
{
    "body": "Thanks for catching this. Here's a better version",
    "created_at": "2020-07-21T14:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423670",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for catching this. Here's a better version



---

archive/issue_comments_423671.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-21T14:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423671",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_423672.json:
```json
{
    "body": "I don't think the prefix is even necessary, but I can live with that.",
    "created_at": "2020-07-21T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423672",
    "user": "https://github.com/mjungmath"
}
```

I don't think the prefix is even necessary, but I can live with that.



---

archive/issue_comments_423673.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-22T09:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423673",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423674.json:
```json
{
    "body": "LGTM. Thanks!",
    "created_at": "2020-07-22T09:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423674",
    "user": "https://github.com/egourgoulhon"
}
```

LGTM. Thanks!



---

archive/issue_comments_423675.json:
```json
{
    "body": "Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency.",
    "created_at": "2020-07-22T09:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423675",
    "user": "https://github.com/egourgoulhon"
}
```

Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency.



---

archive/issue_comments_423676.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2020-07-22T09:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423676",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_423677.json:
```json
{
    "body": "Replying to [comment:57 egourgoulhon]:\n> Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. \n\n\nI think, the independence should be the other way around, right Matthias?",
    "created_at": "2020-07-22T09:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423677",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:57 egourgoulhon]:
> Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. 


I think, the independence should be the other way around, right Matthias?



---

archive/issue_comments_423678.json:
```json
{
    "body": "Replying to [comment:58 gh-mjungmath]:\n> Replying to [comment:57 egourgoulhon]:\n> > Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. \n\n> \n> I think, the independence should be the other way around, right Matthias?\n\nNo, if the code in this ticket makes use of #30180's code, the dependency shall be set here to #30180.",
    "created_at": "2020-07-22T14:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423678",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:58 gh-mjungmath]:
> Replying to [comment:57 egourgoulhon]:
> > Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. 

> 
> I think, the independence should be the other way around, right Matthias?

No, if the code in this ticket makes use of #30180's code, the dependency shall be set here to #30180.



---

archive/issue_comments_423679.json:
```json
{
    "body": "Replying to [comment:59 egourgoulhon]:\n> Replying to [comment:58 gh-mjungmath]:\n> > Replying to [comment:57 egourgoulhon]:\n> > > Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. \n\n> > \n> > I think, the independence should be the other way around, right Matthias?\n\n> No, if the code in this ticket makes use of #30180's code, the dependency shall be set here to #30180. \n\nThis code works independently of #30180 and I don't see any snippets from #30180 used here.",
    "created_at": "2020-07-22T14:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423679",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:59 egourgoulhon]:
> Replying to [comment:58 gh-mjungmath]:
> > Replying to [comment:57 egourgoulhon]:
> > > Shouldn't the code of this ticket use #30180 (cf. comment 1 in that ticket)? Then #30180 should be added as a dependency. 

> > 
> > I think, the independence should be the other way around, right Matthias?

> No, if the code in this ticket makes use of #30180's code, the dependency shall be set here to #30180. 

This code works independently of #30180 and I don't see any snippets from #30180 used here.



---

archive/issue_comments_423680.json:
```json
{
    "body": "Both of you are right.",
    "created_at": "2020-07-22T15:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423680",
    "user": "https://github.com/mkoeppe"
}
```

Both of you are right.



---

archive/issue_comments_423681.json:
```json
{
    "body": "Thanks to the speedy review of #30180, I will use it now to simplify the code on the present ticket.",
    "created_at": "2020-07-22T15:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423681",
    "user": "https://github.com/mkoeppe"
}
```

Thanks to the speedy review of #30180, I will use it now to simplify the code on the present ticket.



---

archive/issue_comments_423682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-22T15:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423683.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-07-22T15:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423683",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_423684.json:
```json
{
    "body": "Morally green patchbot.",
    "created_at": "2020-07-24T00:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423684",
    "user": "https://github.com/tscrim"
}
```

Morally green patchbot.



---

archive/issue_comments_423685.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-24T08:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423685",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423686.json:
```json
{
    "body": "Thanks for the update!",
    "created_at": "2020-07-24T08:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423686",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the update!



---

archive/issue_comments_423687.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-07-24T15:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423687",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_077483.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-02T08:20:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29857#event-77483"
}
```



---

archive/issue_comments_423688.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-02T08:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29857#issuecomment-423688",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
