# Issue 27154: some additionnal checks about sws files

Issue created by migration from https://trac.sagemath.org/ticket/27391

Original creator: chapoton

Original creation time: 2019-03-01 13:27:03

CC:  embray jdemeyer dcoudert tscrim dimpase

adding some sanity checks for the extraction of sws files.


---

Comment by chapoton created at 2019-03-01 13:27:31

New commits:


---

Comment by chapoton created at 2019-03-01 13:27:31

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-03-01 19:21:19

Does anybody have a better way to check that no file is extracted outside the directory ?


---

Comment by dcoudert created at 2019-03-02 07:56:18

You check that paths don't start with `\\`. Shouldn't you also check that it's not `/` ?

An alternative could be to build absolute paths (using `os.path.abspath`) and to check that each absolute path starts with the absolute path of extraction directory.


---

Comment by chapoton created at 2019-03-02 08:00:48

feel free to take over!


---

Comment by chapoton created at 2019-03-02 20:32:24

Changing priority from major to critical.


---

Comment by git created at 2019-03-03 07:33:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-03-03 07:42:04

better like that ?


---

Comment by dcoudert created at 2019-03-03 15:14:30

I think so, but I prefer to wait for other opinions. I don't know if one can use other tricks to put files in different directory.


---

Comment by chapoton created at 2019-03-05 07:55:34

Please have a look, Erik and Jeroen


---

Comment by chapoton created at 2019-03-05 07:55:34

Changing priority from critical to blocker.


---

Comment by jdemeyer created at 2019-03-05 11:08:31

Which problem is this ticket supposed to fix? There is very little explanation.


---

Comment by chapoton created at 2019-03-05 11:09:37

I am going to forward you an email about that.


---

Comment by jdemeyer created at 2019-03-05 11:30:17

Changing component from refactoring to packages: standard.


---

Comment by jdemeyer created at 2019-03-05 11:30:17

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2019-03-05 11:30:17

Changing priority from blocker to major.


---

Comment by jdemeyer created at 2019-03-05 11:30:17

I think that this issue should be fixed in Python's `tarfile` module. Given that it's known since 2014, there is no way that this is a blocker. After reading the upstream issue, it's clear that there are many more potential problems than just paths starting with `/` or containing `..`. So this patch doesn't really fix the security hole.


---

Comment by chapoton created at 2019-03-08 13:04:59

but it would be better than nothing, no ??


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by chapoton created at 2019-04-05 15:51:59

so should we just close that one, or what ???


---

Comment by chapoton created at 2019-04-05 15:52:14

Changing status from needs_work to needs_info.


---

Comment by tscrim created at 2019-04-06 08:26:59

I might just leave this open until this is fixed upstream.


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2020-07-08 04:18:41

sagenb stuff, should be closed


---

Comment by mkoeppe created at 2020-07-08 04:18:41

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2020-07-08 06:21:16

Resolution: invalid
