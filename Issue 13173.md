# Issue 13173: Test if the assumptions made by quotient rings are fulfilled

archive/issues_013173.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nCC:  mstreng slelievre\n\nIn the definition of a QuotientRing there is the following assumption\n\nASSUMPTION:\n\n    ``I`` has a method ``I.reduce(x)`` returning the normal form\n    of elements `x\\in R`. In other words, it is required that\n    ``I.reduce(x)==I.reduce(y)`` `\\iff x-y \\in I`, and\n    ``x-I.reduce(x) in I``, for all `x,y\\in R`.\n\nOn the other hand, the default definition of reduce in\nsage/rings/ideal.py says\n    def reduce(self, f):\n        return f       # default\n\nAs a consequence one gets \n\n```\nsage: Z4x.<x> = Integers(4)[]\nsage: GR.<y> = Z4x.quotient_ring(x**2+x+1)\nsage: R = GR.quo(GR.ideal(2))\nsage: R(y+2) == R(y)\nFalse       \n```\n\n\nThis patch adds a deprecation warning in reduce(). It also introduces a test in QuotientRing_nc.__init__(), which determines if the ideal class overwrites the definition of reduce().\n\nThere is also a discussion about this on https://groups.google.com/d/topic/sage-devel/s5y604ZPiQ8/discussion.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13345\n\n",
    "created_at": "2012-08-06T09:51:33Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "title": "Test if the assumptions made by quotient rings are fulfilled",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13173",
    "user": "tfeulner"
}
```
Assignee: AlexGhitza

CC:  mstreng slelievre

In the definition of a QuotientRing there is the following assumption

ASSUMPTION:

    ``I`` has a method ``I.reduce(x)`` returning the normal form
    of elements `x\in R`. In other words, it is required that
    ``I.reduce(x)==I.reduce(y)`` `\iff x-y \in I`, and
    ``x-I.reduce(x) in I``, for all `x,y\in R`.

On the other hand, the default definition of reduce in
sage/rings/ideal.py says
    def reduce(self, f):
        return f       # default

As a consequence one gets 

```
sage: Z4x.<x> = Integers(4)[]
sage: GR.<y> = Z4x.quotient_ring(x**2+x+1)
sage: R = GR.quo(GR.ideal(2))
sage: R(y+2) == R(y)
False       
```


This patch adds a deprecation warning in reduce(). It also introduces a test in QuotientRing_nc.__init__(), which determines if the ideal class overwrites the definition of reduce().

There is also a discussion about this on https://groups.google.com/d/topic/sage-devel/s5y604ZPiQ8/discussion.

Issue created by migration from https://trac.sagemath.org/ticket/13345





---

archive/issue_comments_160774.json:
```json
{
    "body": "I know that there are more doctest failures but maybe someone could first tell me if my approach is correct.",
    "created_at": "2012-08-06T10:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160774",
    "user": "tfeulner"
}
```

I know that there are more doctest failures but maybe someone could first tell me if my approach is correct.



---

archive/issue_comments_160775.json:
```json
{
    "body": "Does this patch lead to test failures?\n\nIf yes, are the tests wrong or did they pass only by accident in the past?\n\nI don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use `NotImplementedError` right away and b) reimplement `reduce()` where necessary.",
    "created_at": "2012-08-06T10:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160775",
    "user": "sluther"
}
```

Does this patch lead to test failures?

If yes, are the tests wrong or did they pass only by accident in the past?

I don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use `NotImplementedError` right away and b) reimplement `reduce()` where necessary.



---

archive/issue_comments_160776.json:
```json
{
    "body": "Replying to [comment:2 sluther]:\n> Does this patch lead to test failures?\n\nI was talking about the failures where I did not catch the deprecation warning. I will start this work as soon as there is a decision if there should be some deprecation warning or a NotImplementedError at those places.\n\n> I don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use NotImplementedError right away and b) reimplement reduce() where necessary.\n\nThis is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce.",
    "created_at": "2012-08-06T11:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160776",
    "user": "tfeulner"
}
```

Replying to [comment:2 sluther]:
> Does this patch lead to test failures?

I was talking about the failures where I did not catch the deprecation warning. I will start this work as soon as there is a decision if there should be some deprecation warning or a NotImplementedError at those places.

> I don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use NotImplementedError right away and b) reimplement reduce() where necessary.

This is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce.



---

archive/issue_comments_160777.json:
```json
{
    "body": "Replying to [comment:3 tfeulner]:\n> This is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce. \n\nThen start new tickets as needed and make them block this one.",
    "created_at": "2012-08-06T11:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160777",
    "user": "sluther"
}
```

Replying to [comment:3 tfeulner]:
> This is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce. 

Then start new tickets as needed and make them block this one.



---

archive/issue_comments_160778.json:
```json
{
    "body": "Judging just from reading the patch, I think you make the assumption very clear :)\n\nI don't have any experience with deprecation, but what you're doing to sage/rings/ideal.py looks fine to me.\n\nAbout the `DeprecationWarning` you are adding to sage/rings/quotient_ring.py:\n\n1) Any existing Sage doctest where your patch gives this warning is very likely a Sage bug. Thanks for finding them, you can list them in a separate ticket.\n\n2) For your final patch, please remove this test and this warning. There is not much added benefit of this warning (you get an indirect warning from reduce when you use the quotient ring anyway), and it tests something different from what it claims to check (reduce being implemented is not equivalent to the assumption being satisfied, so lots of potential false positives and false negatives), while it also forces people to do extra work later (when the deprecated function \"reduce\" is changed to `NotImplementedError`). Also, you are not deprecating any functionality at this location in the source code.",
    "created_at": "2012-08-06T21:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160778",
    "user": "mstreng"
}
```

Judging just from reading the patch, I think you make the assumption very clear :)

I don't have any experience with deprecation, but what you're doing to sage/rings/ideal.py looks fine to me.

About the `DeprecationWarning` you are adding to sage/rings/quotient_ring.py:

1) Any existing Sage doctest where your patch gives this warning is very likely a Sage bug. Thanks for finding them, you can list them in a separate ticket.

2) For your final patch, please remove this test and this warning. There is not much added benefit of this warning (you get an indirect warning from reduce when you use the quotient ring anyway), and it tests something different from what it claims to check (reduce being implemented is not equivalent to the assumption being satisfied, so lots of potential false positives and false negatives), while it also forces people to do extra work later (when the deprecated function "reduce" is changed to `NotImplementedError`). Also, you are not deprecating any functionality at this location in the source code.



---

archive/issue_comments_160779.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:5 mstreng]:\n\nI removed the `DeprecationWarning` from sage/rings/quotient_ring.py as you proposed and started a new ticket, see ticket:13347.\n\nI suppose that the documentation of mod() in sage/structure/element.pyx should also be modified:     \n        ''Return a **unique** representative for self modulo the ideal I (or the ideal\n        generated by the elements of I if I is not an ideal.) '''I.e. it is required that\n        x.mod(I) == y.mod(I) `\\iff x-y \\in I`, and\n        x-x.mod(I) in I, for all `x,y\\in R`.*' *",
    "created_at": "2012-08-07T09:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160779",
    "user": "tfeulner"
}
```

Attachment

Replying to [comment:5 mstreng]:

I removed the `DeprecationWarning` from sage/rings/quotient_ring.py as you proposed and started a new ticket, see ticket:13347.

I suppose that the documentation of mod() in sage/structure/element.pyx should also be modified:     
        ''Return a **unique** representative for self modulo the ideal I (or the ideal
        generated by the elements of I if I is not an ideal.) '''I.e. it is required that
        x.mod(I) == y.mod(I) `\iff x-y \in I`, and
        x-x.mod(I) in I, for all `x,y\in R`.*' *



---

archive/issue_comments_160780.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-04T06:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160780",
    "user": "tfeulner"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160781.json:
```json
{
    "body": "The changes themselves look reasonable. The patch rebases with some fuzz 2 only on 6.2.base5. The links to the ticket in the docs should be given as `:trac:`````13345```` Note also the proposed document change in comment:5 could be added. If you please make these changes (rebase, trac links, doc fix) then you can set positive review yourself, so that you need not wait for another round of review.",
    "created_at": "2014-03-31T09:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160781",
    "user": "rws"
}
```

The changes themselves look reasonable. The patch rebases with some fuzz 2 only on 6.2.base5. The links to the ticket in the docs should be given as `:trac:`````13345```` Note also the proposed document change in comment:5 could be added. If you please make these changes (rebase, trac links, doc fix) then you can set positive review yourself, so that you need not wait for another round of review.



---

archive/issue_comments_160782.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-30T18:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160782",
    "user": "malb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_160783.json:
```json
{
    "body": "Should we not simply remove the default implementation of `reduce`? It is wrong for anything but the zero ideal, right? At least we should add a stopgap I guess?",
    "created_at": "2015-08-26T23:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160783",
    "user": "saraedum"
}
```

Should we not simply remove the default implementation of `reduce`? It is wrong for anything but the zero ideal, right? At least we should add a stopgap I guess?



---

archive/issue_comments_160784.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2015-08-27T00:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13173#issuecomment-160784",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_info.
