# Issue 13173: Test if the assumptions made by quotient rings are fulfilled

Issue created by migration from https://trac.sagemath.org/ticket/13345

Original creator: tfeulner

Original creation time: 2012-08-06 09:51:33

Assignee: AlexGhitza

CC:  mstreng slelievre

In the definition of a QuotientRing there is the following assumption

ASSUMPTION:

    ``I`` has a method ``I.reduce(x)`` returning the normal form
    of elements `x\in R`. In other words, it is required that
    ``I.reduce(x)==I.reduce(y)`` `\iff x-y \in I`, and
    ``x-I.reduce(x) in I``, for all `x,y\in R`.

On the other hand, the default definition of reduce in
sage/rings/ideal.py says
    def reduce(self, f):
        return f       # default

As a consequence one gets 

```
sage: Z4x.<x> = Integers(4)[]
sage: GR.<y> = Z4x.quotient_ring(x**2+x+1)
sage: R = GR.quo(GR.ideal(2))
sage: R(y+2) == R(y)
False       
```


This patch adds a deprecation warning in reduce(). It also introduces a test in QuotientRing_nc.__init__(), which determines if the ideal class overwrites the definition of reduce().

There is also a discussion about this on https://groups.google.com/d/topic/sage-devel/s5y604ZPiQ8/discussion.


---

Comment by tfeulner created at 2012-08-06 10:29:58

I know that there are more doctest failures but maybe someone could first tell me if my approach is correct.


---

Comment by sluther created at 2012-08-06 10:39:42

Does this patch lead to test failures?

If yes, are the tests wrong or did they pass only by accident in the past?

I don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use `NotImplementedError` right away and b) reimplement `reduce()` where necessary.


---

Comment by tfeulner created at 2012-08-06 11:26:07

Replying to [comment:2 sluther]:
> Does this patch lead to test failures?

I was talking about the failures where I did not catch the deprecation warning. I will start this work as soon as there is a decision if there should be some deprecation warning or a NotImplementedError at those places.

> I don't know the involved math, but it sounds to me like sage currently returns wrong answers. If this is the case, the bug should be fixed and not deprecated. This means: a) use NotImplementedError right away and b) reimplement reduce() where necessary.

This is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce.


---

Comment by sluther created at 2012-08-06 11:49:10

Replying to [comment:3 tfeulner]:
> This is definitely a bug. I am not sure if I will be able to reimplement all occurrences of reduce. 

Then start new tickets as needed and make them block this one.


---

Comment by mstreng created at 2012-08-06 21:39:06

Judging just from reading the patch, I think you make the assumption very clear :)

I don't have any experience with deprecation, but what you're doing to sage/rings/ideal.py looks fine to me.

About the `DeprecationWarning` you are adding to sage/rings/quotient_ring.py:

1) Any existing Sage doctest where your patch gives this warning is very likely a Sage bug. Thanks for finding them, you can list them in a separate ticket.

2) For your final patch, please remove this test and this warning. There is not much added benefit of this warning (you get an indirect warning from reduce when you use the quotient ring anyway), and it tests something different from what it claims to check (reduce being implemented is not equivalent to the assumption being satisfied, so lots of potential false positives and false negatives), while it also forces people to do extra work later (when the deprecated function "reduce" is changed to `NotImplementedError`). Also, you are not deprecating any functionality at this location in the source code.


---

Attachment

Replying to [comment:5 mstreng]:

I removed the `DeprecationWarning` from sage/rings/quotient_ring.py as you proposed and started a new ticket, see ticket:13347.

I suppose that the documentation of mod() in sage/structure/element.pyx should also be modified:     
        ''Return a *unique* representative for self modulo the ideal I (or the ideal
        generated by the elements of I if I is not an ideal.) '''I.e. it is required that
        x.mod(I) == y.mod(I) `\iff x-y \in I`, and
        x-x.mod(I) in I, for all `x,y\in R`._' _


---

Comment by tfeulner created at 2012-09-04 06:54:51

Changing status from new to needs_review.


---

Comment by rws created at 2014-03-31 09:24:36

The changes themselves look reasonable. The patch rebases with some fuzz 2 only on 6.2.base5. The links to the ticket in the docs should be given as `:trac:`````13345```` Note also the proposed document change in comment:5 could be added. If you please make these changes (rebase, trac links, doc fix) then you can set positive review yourself, so that you need not wait for another round of review.


---

Comment by malb created at 2014-06-30 18:20:48

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2015-08-26 23:59:21

Should we not simply remove the default implementation of `reduce`? It is wrong for anything but the zero ideal, right? At least we should add a stopgap I guess?


---

Comment by saraedum created at 2015-08-27 00:01:13

Changing status from needs_work to needs_info.
