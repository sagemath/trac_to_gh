# Issue 28373: coercion bug with polynomial ring over matrix space

archive/issues_028373.json:
```json
{
    "body": "\n```\nsage: M = MatrixSpace(ZZ, 2)\nsage: x = polygen(M)\nsage: p = M([1,0,1,2]) + M([-1,2,3,0]) * x\nsage: p / 2\nTraceback (most recent call last):\n/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:6950)()\n    839         try:\n--> 840             return self.__cached_methods[name]\n    841         except KeyError:\n\nKeyError: '_coerce_'\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n<ipython-input-27-c81a6e48866e> in <module>()\n----> 1 p / Integer(2)\n\n/opt/sage/local/lib/python3.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__truediv__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:22911)()\n   2235             R = (<Polynomial>left)._parent._base\n   2236             try:\n-> 2237                 x = R._coerce_(right)\n   2238                 return left * ~x\n   2239             except TypeError:\n\n/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6872)()\n    832             AttributeError: 'PrimeNumbers_with_category' object has no attribute 'sadfasdf'\n    833         \"\"\"\n--> 834         return self.getattr_from_category(name)\n    835 \n    836     cdef getattr_from_category(self, name):\n\n/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7035)()\n    847                 cls = self._category.parent_class\n    848 \n--> 849             attr = getattr_from_other_class(self, cls, name)\n    850             self.__cached_methods[name] = attr\n    851             return attr\n\n/opt/sage/local/lib/python3.7/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2547)()\n    387         dummy_error_message.cls = type(self)\n    388         dummy_error_message.name = name\n--> 389         raise AttributeError(dummy_error_message)\n    390     cdef PyObject* attr = instance_getattr(cls, name)\n    391     if attr is NULL:\n\nAttributeError: 'MatrixSpace_with_category' object has no attribute '_coerce_'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28610\n\n",
    "created_at": "2019-10-15T17:29:36Z",
    "labels": [
        "component: coercion",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "coercion bug with polynomial ring over matrix space",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28373",
    "user": "https://github.com/videlec"
}
```

```
sage: M = MatrixSpace(ZZ, 2)
sage: x = polygen(M)
sage: p = M([1,0,1,2]) + M([-1,2,3,0]) * x
sage: p / 2
Traceback (most recent call last):
/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:6950)()
    839         try:
--> 840             return self.__cached_methods[name]
    841         except KeyError:

KeyError: '_coerce_'

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
<ipython-input-27-c81a6e48866e> in <module>()
----> 1 p / Integer(2)

/opt/sage/local/lib/python3.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__truediv__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:22911)()
   2235             R = (<Polynomial>left)._parent._base
   2236             try:
-> 2237                 x = R._coerce_(right)
   2238                 return left * ~x
   2239             except TypeError:

/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6872)()
    832             AttributeError: 'PrimeNumbers_with_category' object has no attribute 'sadfasdf'
    833         """
--> 834         return self.getattr_from_category(name)
    835 
    836     cdef getattr_from_category(self, name):

/opt/sage/local/lib/python3.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7035)()
    847                 cls = self._category.parent_class
    848 
--> 849             attr = getattr_from_other_class(self, cls, name)
    850             self.__cached_methods[name] = attr
    851             return attr

/opt/sage/local/lib/python3.7/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2547)()
    387         dummy_error_message.cls = type(self)
    388         dummy_error_message.name = name
--> 389         raise AttributeError(dummy_error_message)
    390     cdef PyObject* attr = instance_getattr(cls, name)
    391     if attr is NULL:

AttributeError: 'MatrixSpace_with_category' object has no attribute '_coerce_'
```


Issue created by migration from https://trac.sagemath.org/ticket/28610





---

archive/issue_comments_400211.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28373#issuecomment-400211",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_400212.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28373#issuecomment-400212",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.
