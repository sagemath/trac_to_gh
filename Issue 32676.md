# Issue 32676: Revert #32713 (Apply "configure --enable-editable" to other packages) for sage-conf, sage-setup

Issue created by migration from https://trac.sagemath.org/ticket/32913

Original creator: mkoeppe

Original creation time: 2021-11-20 19:15:42

CC:  @tobiasdiez klee

(from #32713#comment:11)

Users need the wheel of *sage-conf* when creating venvs. And we need the wheels of packages when testing distributions using `./sage -sh -c '(cd pkgs/sagemath-standard && tox -v -v -v -e python-sagewheels-nopypi)'` and similar.

Until editable wheels (PEP 660) are implemented in *setuptools* (or we switch the distributions to another build system that implements PEP 660 such as *flit*), we revert the change made in #32713 for these packages.

But we keep *sage-docbuild* editable.


---

Comment by mkoeppe created at 2021-11-20 19:19:03

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-11-20 19:19:03

New commits:


---

Comment by @tobiasdiez created at 2021-11-21 18:17:22

Can you please expand on why this leads to problems? For example, end-users should normally not use  an editable install anyway, neither should the build process for the wheels on ci. For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.

I would fine it confusing if `make --enable-editable-install` installs some packages in editable mode and others not.


---

Comment by mkoeppe created at 2021-11-21 18:58:46

Replying to [comment:4 gh-tobiasdiez]:
> For the tox cmd, wouldn't be better if the tox config of sagemath-standard only applies the -e only to that package if that's the desired behavior.

Please take a look at `pkgs/sagemath-standard/tox.ini`, then you'll see what it does...


---

Comment by mkoeppe created at 2021-11-21 18:59:32

Replying to [comment:4 gh-tobiasdiez]:
> I would fine it confusing if `configure --enable-editable` installs some packages in editable mode and others not. 

Hasn't confused anyone so far...


---

Comment by mkoeppe created at 2021-11-21 19:01:35

Also note that `configure --help` explains:

```
  --enable-editable       use an editable install of the Sage library
```



---

Comment by @tobiasdiez created at 2021-12-06 17:30:20

Sorry, but I still don't understand why you need to build and use wheels for sage packages if all of them use editable installs. Why can one not install them (as editable) in the tox environments?

For example, something along the following lines (in src/tox):

```
[testenv]
usedevelop=True # Instruct tox to use editable install of main sagemath package
deps=
  --editable=file:///{toxinidir}/../path/to/sage_conf # Install sage-conf as editable install
```


Potentially combined with a custom `install_command` that invokes pip with `find-links` to discover the wheels of other dependencies that are build during `make`.


---

Comment by mkoeppe created at 2021-12-06 17:55:13

That could be implemented but it is not implemented.


---

Comment by mkoeppe created at 2021-12-06 17:56:16

And the installation procedure would also be more difficult to document than just to say "install all wheels from ...".


---

Comment by mkoeppe created at 2021-12-06 18:25:28

#32616 may be a way to resolve this


---

Comment by @tobiasdiez created at 2021-12-06 20:47:24

Replying to [comment:10 mkoeppe]:
> That could be implemented but it is not implemented.

I would strongly prefer that over reverting something that works in principle. I'll have a look the coming days and create a prototype.


---

Comment by mkoeppe created at 2021-12-12 18:31:58

Any progress on this?


---

Comment by @tobiasdiez created at 2021-12-19 16:04:28

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2021-12-19 16:04:28

With the new branch `public/build/trac_editable` you can run `tox -e py38` (or 39) from the `src` folder and get a tox environment with editable installs of sagemath-standard and sage-conf. Some of the tests are failing (because gap and blas are not using sage-conf but determine stuff at runtime during env variables) and there might be a more elegant way to set the env variables but as a prototype this should suffice.
----
New commits:


---

Comment by mkoeppe created at 2021-12-19 19:14:16

This branch doesn't fix what is described in the ticket description


---

Comment by @tobiasdiez created at 2021-12-19 19:41:00

Maybe not (as I said above in comment 4 I don't quite get what your problem is). But it shows how to use editable installs with tox and thus provides a way around the problem "we need the wheels of packages sage-conf and sage-setup when testing distributions [with tox]". Also it was meant as a prototype not as a complete solution.


---

Comment by mkoeppe created at 2021-12-19 22:29:09

Well we are in the release phase for Sage 9.5 and can't merge "prototypes"


---

Comment by slelievre created at 2022-01-30 15:44:20

Set milestone to sage-9.6 after Sage 9.5 release.


---

Comment by mkoeppe created at 2022-05-06 22:12:45

I have a different solution in #33817


---

Comment by mkoeppe created at 2022-05-06 22:12:54

Changing status from needs_work to needs_review.
