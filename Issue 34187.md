# Issue 34187: Common base class for FiniteRankFreeModule and TensorFreeModule

Issue created by migration from https://trac.sagemath.org/ticket/34424

Original creator: mkoeppe

Original creation time: 2022-08-24 17:33:05

CC:  egourgoulhon tscrim

Currently `TensorFreeModule` (and similar classes) inherits many methods from `FiniteRankFreeModule` that actually only work with the base module.
Trying to use them leads to incomprehensible error messages. For example:

```
sage: M = FiniteRankFreeModule(ZZ, 3, name='M')
sage: M.tensor_module(2, 1).tensor_module(3, 3)
Free module of type-(3,3) tensors on the Free module of type-(2,1) tensors on the Rank-3 free module M over the Integer Ring
sage: _.an_element()
ValueError: the None has not been defined on the Free module of type-(2,1) tensors on the Rank-3 free module M over the Integer Ring
```


As discussed in #30229#comment:6, we introduce a common base class that only defines the methods that should be inherited by `TensorFreeModule` and other such classes.



---

Comment by mkoeppe created at 2022-08-24 17:52:45

I'd just call it `FiniteRankFreeModule_abstract` in analogy to the existing `Basis_abstract` unless there are better suggestions


---

Comment by mkoeppe created at 2022-08-25 02:40:16

Here's a basic version that works.

Some more of the methods can probably be moved to `FiniteRankFreeModule_abstract` -- but currently all doctests pass as is, so in this case we should add some examples that use subclasses.
----
New commits:


---

Comment by git created at 2022-08-25 03:12:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-25 03:17:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-25 03:46:40

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2022-08-25 09:36:42

Thanks for implementing this!

Replying to [comment:1 mkoeppe]:
> I'd just call it `FiniteRankFreeModule_abstract` in analogy to the existing `Basis_abstract` unless there are better suggestions

Sounds good to me.


---

Comment by egourgoulhon created at 2022-08-26 15:27:05

Just one suggestion: in the docstring of `FiniteRankFreeModule_abstract`:

```diff
- Free module of finite rank over a commutative ring.
+ Abstract base class for free modules of finite rank over a commutative ring.
```

Otherwise, LGTM.


---

Comment by git created at 2022-08-26 19:13:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-08-26 22:06:42

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2022-08-26 22:06:42

Thanks!


---

Comment by mkoeppe created at 2022-08-26 22:09:33

Thank you!


---

Comment by mkoeppe created at 2022-08-28 23:49:41

When merged with #31276, this gives a doctest failure


---

Comment by git created at 2022-08-28 23:51:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2022-08-28 23:51:58

Changing status from positive_review to needs_review.


---

Comment by mkoeppe created at 2022-08-29 02:29:32

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-08-29 02:29:32

Bots are green, back to positive review (hoping that's OK)


---

Comment by vbraun created at 2022-08-30 19:05:03

Resolution: fixed
