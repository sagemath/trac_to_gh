# Issue 15003: Switch lattice polytopes to point collections

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2013-09-30 08:40:20

CC:  vbraun

Keywords: toric sd53

The goals of this ticket are:
 * make the code of `LatticePolytope` less interdependent for easier maintenance and backend switch;
 * use `PointCollection` container internally to unify it with other classes for toric geometry (`Cone` and `Fan`);
 * deprecate current methods returning points as matrices so that their output can be changed in the future.


---

Comment by git created at 2013-09-30 10:37:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-10-02 12:34:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2013-10-07 04:32:47

Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket). So far I've deprecated constructing polytopes from matrices, perhaps constructing them from files should be deprecated as well and handled by separate functions?

What about "desc"? I'd like to print polytopes similar to cones/fans: "3-d lattice polytope in 4-d lattice N", perhaps with "lattice" replaced by "reflexive" automatically and with the index for 2- and 3-d cases. Should then "desc" be gone and those who really want can use Sage standard "rename"?

Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice. Maybe the corresponding polytope in `ToricLattice(dim).dual()`? Then polytopes from built-in lists will return themselves and be equal to their normal form.

`projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with "octa" for vertices other than 8!


---

Comment by git created at 2013-10-07 05:48:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-07 10:34:51

Replying to [comment:4 novoselt]:
> Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket).

Sounds good!

> What about "desc"? I'd like to print polytopes similar to cones/fans: "3-d lattice polytope in 4-d lattice N", perhaps with "lattice" replaced by "reflexive" automatically and with the index for 2- and 3-d cases. Should then "desc" be gone and those who really want can use Sage standard "rename"?

+1

> Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice.

A matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.

If you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.

> `projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with "octa" for vertices other than 8!

Should probably be `cross_polytope` ;-)


---

Comment by novoselt created at 2013-10-07 14:38:57

Replying to [comment:6 vbraun]:
> Replying to [comment:4 novoselt]:
> > Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice.
> 
> A matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.
> 
> If you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.

I always want to preserve order, especially when the input consists of vertices rather than spanning points ;-) The issue with the same lattice as the original one is that normal forms of equivalent polytopes in different lattices will compare as different, which seems a bit counterintuitive with respect to index, i.e. with my default lattice choice we would have for any 2- or 3-d reflexive polytope

```
sage: p.normal_form() == ReflexivePolytope(p.dim(), p.index())
True
```

On the other hand starting with a polytope in N and getting as its normal form something in M isn't great either... So maybe a matrix is the way to go. Perhaps with vertices as rows rather than columns?

Speaking of `index` - are you OK with the name or something like `db_index` would be better? I definitely find it very useful, but the meaning of `index` for morphisms and cones is completely different and there are "more mathematical" indices associated to polytopes, like Gorenstein one.


---

Comment by vbraun created at 2013-10-07 14:49:15

Having normal forms compare different if they live in different lattices would be fine with me, for the record.

As for the index, how about `.label()` or `.id()`? It could return a pair of (dim, index) that would be valid input for ReflexivePolytope


---

Comment by git created at 2014-03-26 23:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-27 00:23:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-28 00:17:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-03-28 20:32:24

Picking up the previous discussion, I think using `PointCollection` for `normal_form` is a good choice with the lattice being the same as the lattice of the polytope. Then for polytopes in normal form `p.vertices() == p.normal_form()` without any extra remarks. The index for 2 and 3 dimensions will mean matching these normal forms but ignoring lattices.


---

Comment by git created at 2014-03-28 22:57:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-07 21:26:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-10 00:05:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-11 19:28:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-04-11 19:33:31

OK, I better stop given that a few thousands lines are affected already. Except for `lattice_polytope.py` they are mostly doctest fixes due to deprecated `octahedron` and changed representation.

The main thing that is left is fix the mess with polytope faces, but that definitely should be a separate ticket.


---

Comment by novoselt created at 2014-04-11 19:33:31

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-04-11 19:43:05

Conflicts with the already-merged #15990, either resolve now or with the next beta


---

Comment by git created at 2014-04-11 20:06:16

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by novoselt created at 2014-04-11 20:08:27

OK, I've done 

```
git merge 136948a88bbf731a916184b91adf52fb93daa0d4
```

which is the commit listed as "branch" on #15990 and then resolved the conflict. Was it the way to go?


---

Comment by novoselt created at 2014-04-11 20:10:49

When I click on commits on trac, then my two merges with betas are shown as single commits, while this resent change shows also other stuff - what is the difference between merging "develop" and other commits into my branch?


---

Comment by vbraun created at 2014-04-11 21:35:13

The betas that you merged are (by definition) already released, so in the trac view they (that is, the second parent of the merge) is excluded. But the ticket that you merged in is not yet released in a beta, so its entire history is shown as well. When I release the next beta containing #15990 then it will be removed from the trac view.


---

Comment by vbraun created at 2014-04-11 22:41:58


```
  File "/home/buildbot/build/sage/eno-1/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/lattice_polytope.py", line 1058
    result = stdout.read()
         ^
SyntaxError: invalid syntax
```



---

Comment by git created at 2014-04-11 23:17:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-04-13 19:33:34

Resolution: fixed


---

Comment by novoselt created at 2014-04-14 05:51:18

Wow, looks like tachyons are real, thanks Volker!


---

Comment by nthiery created at 2014-04-25 14:23:57

Hi!

Do you mind editing the ticket description so that users can easily find what's the current alternative to constructing lattice polytopes from a matrix?

Thanks!
                                   Nicolas


---

Comment by novoselt created at 2014-04-25 16:46:15

Done. Any ideas why do I have

```
  #!/usr/bin/env python
```

in the end of the warning?..


---

Comment by nthiery created at 2014-04-25 17:01:09

Thanks!

No clue about the warning.
