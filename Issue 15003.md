# Issue 15003: Switch lattice polytopes to point collections

archive/issues_015003.json:
```json
{
    "body": "CC:  vbraun\n\nKeywords: toric sd53\n\nThe goals of this ticket are:\n* make the code of `LatticePolytope` less interdependent for easier maintenance and backend switch;\n* use `PointCollection` container internally to unify it with other classes for toric geometry (`Cone` and `Fan`);\n* deprecate current methods returning points as matrices so that their output can be changed in the future.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15240\n\n",
    "created_at": "2013-09-30T08:40:20Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Switch lattice polytopes to point collections",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15003",
    "user": "novoselt"
}
```
CC:  vbraun

Keywords: toric sd53

The goals of this ticket are:
* make the code of `LatticePolytope` less interdependent for easier maintenance and backend switch;
* use `PointCollection` container internally to unify it with other classes for toric geometry (`Cone` and `Fan`);
* deprecate current methods returning points as matrices so that their output can be changed in the future.

Issue created by migration from https://trac.sagemath.org/ticket/15240





---

archive/issue_comments_191768.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-30T10:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191768",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T12:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191769",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191770.json:
```json
{
    "body": "Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket). So far I've deprecated constructing polytopes from matrices, perhaps constructing them from files should be deprecated as well and handled by separate functions?\n\nWhat about \"desc\"? I'd like to print polytopes similar to cones/fans: \"3-d lattice polytope in 4-d lattice N\", perhaps with \"lattice\" replaced by \"reflexive\" automatically and with the index for 2- and 3-d cases. Should then \"desc\" be gone and those who really want can use Sage standard \"rename\"?\n\nAlso, I am not sure what the output of \"normal_form\" should be - keeping it as a matrix does not seem a good choice. Maybe the corresponding polytope in `ToricLattice(dim).dual()`? Then polytopes from built-in lists will return themselves and be equal to their normal form.\n\n`projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with \"octa\" for vertices other than 8!",
    "created_at": "2013-10-07T04:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191770",
    "user": "novoselt"
}
```

Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket). So far I've deprecated constructing polytopes from matrices, perhaps constructing them from files should be deprecated as well and handled by separate functions?

What about "desc"? I'd like to print polytopes similar to cones/fans: "3-d lattice polytope in 4-d lattice N", perhaps with "lattice" replaced by "reflexive" automatically and with the index for 2- and 3-d cases. Should then "desc" be gone and those who really want can use Sage standard "rename"?

Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice. Maybe the corresponding polytope in `ToricLattice(dim).dual()`? Then polytopes from built-in lists will return themselves and be equal to their normal form.

`projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with "octa" for vertices other than 8!



---

archive/issue_comments_191771.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-07T05:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191771",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191772.json:
```json
{
    "body": "Replying to [comment:4 novoselt]:\n> Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket).\n\nSounds good!\n\n> What about \"desc\"? I'd like to print polytopes similar to cones/fans: \"3-d lattice polytope in 4-d lattice N\", perhaps with \"lattice\" replaced by \"reflexive\" automatically and with the index for 2- and 3-d cases. Should then \"desc\" be gone and those who really want can use Sage standard \"rename\"?\n\n+1\n\n> Also, I am not sure what the output of \"normal_form\" should be - keeping it as a matrix does not seem a good choice.\n\nA matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.\n\nIf you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.\n\n> `projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with \"octa\" for vertices other than 8!\n\nShould probably be `cross_polytope` ;-)",
    "created_at": "2013-10-07T10:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191772",
    "user": "vbraun"
}
```

Replying to [comment:4 novoselt]:
> Hey Volker - I think it would be nice to deprecate in this ticket everything that we don't want to keep except for the way how faces are handled (which I'd rather do in a follow up ticket).

Sounds good!

> What about "desc"? I'd like to print polytopes similar to cones/fans: "3-d lattice polytope in 4-d lattice N", perhaps with "lattice" replaced by "reflexive" automatically and with the index for 2- and 3-d cases. Should then "desc" be gone and those who really want can use Sage standard "rename"?

+1

> Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice.

A matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.

If you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.

> `projective_space` and `octahedron(2)` better disappear as well, not sure how did I come up with "octa" for vertices other than 8!

Should probably be `cross_polytope` ;-)



---

archive/issue_comments_191773.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> Replying to [comment:4 novoselt]:\n> > Also, I am not sure what the output of \"normal_form\" should be - keeping it as a matrix does not seem a good choice.\n> \n> A matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.\n> \n> If you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.\n\nI always want to preserve order, especially when the input consists of vertices rather than spanning points ;-) The issue with the same lattice as the original one is that normal forms of equivalent polytopes in different lattices will compare as different, which seems a bit counterintuitive with respect to index, i.e. with my default lattice choice we would have for any 2- or 3-d reflexive polytope\n\n```\nsage: p.normal_form() == ReflexivePolytope(p.dim(), p.index())\nTrue\n```\n\nOn the other hand starting with a polytope in N and getting as its normal form something in M isn't great either... So maybe a matrix is the way to go. Perhaps with vertices as rows rather than columns?\n\nSpeaking of `index` - are you OK with the name or something like `db_index` would be better? I definitely find it very useful, but the meaning of `index` for morphisms and cones is completely different and there are \"more mathematical\" indices associated to polytopes, like Gorenstein one.",
    "created_at": "2013-10-07T14:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191773",
    "user": "novoselt"
}
```

Replying to [comment:6 vbraun]:
> Replying to [comment:4 novoselt]:
> > Also, I am not sure what the output of "normal_form" should be - keeping it as a matrix does not seem a good choice.
> 
> A matrix isn't totally strange, after all the normal form is a version of hermite normal form together with permutation of vertices.
> 
> If you want to return it as another `LatticePolytope` then the constructor should keep the vertices in the specified order. The ambient lattice should be the same as the lattice of the original polytope, imho.

I always want to preserve order, especially when the input consists of vertices rather than spanning points ;-) The issue with the same lattice as the original one is that normal forms of equivalent polytopes in different lattices will compare as different, which seems a bit counterintuitive with respect to index, i.e. with my default lattice choice we would have for any 2- or 3-d reflexive polytope

```
sage: p.normal_form() == ReflexivePolytope(p.dim(), p.index())
True
```

On the other hand starting with a polytope in N and getting as its normal form something in M isn't great either... So maybe a matrix is the way to go. Perhaps with vertices as rows rather than columns?

Speaking of `index` - are you OK with the name or something like `db_index` would be better? I definitely find it very useful, but the meaning of `index` for morphisms and cones is completely different and there are "more mathematical" indices associated to polytopes, like Gorenstein one.



---

archive/issue_comments_191774.json:
```json
{
    "body": "Having normal forms compare different if they live in different lattices would be fine with me, for the record.\n\nAs for the index, how about `.label()` or `.id()`? It could return a pair of (dim, index) that would be valid input for ReflexivePolytope",
    "created_at": "2013-10-07T14:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191774",
    "user": "vbraun"
}
```

Having normal forms compare different if they live in different lattices would be fine with me, for the record.

As for the index, how about `.label()` or `.id()`? It could return a pair of (dim, index) that would be valid input for ReflexivePolytope



---

archive/issue_comments_191775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-26T23:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191775",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191776.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-27T00:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191776",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191777.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-28T00:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191777",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191778.json:
```json
{
    "body": "Picking up the previous discussion, I think using `PointCollection` for `normal_form` is a good choice with the lattice being the same as the lattice of the polytope. Then for polytopes in normal form `p.vertices() == p.normal_form()` without any extra remarks. The index for 2 and 3 dimensions will mean matching these normal forms but ignoring lattices.",
    "created_at": "2014-03-28T20:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191778",
    "user": "novoselt"
}
```

Picking up the previous discussion, I think using `PointCollection` for `normal_form` is a good choice with the lattice being the same as the lattice of the polytope. Then for polytopes in normal form `p.vertices() == p.normal_form()` without any extra remarks. The index for 2 and 3 dimensions will mean matching these normal forms but ignoring lattices.



---

archive/issue_comments_191779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-28T22:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191780.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-07T21:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191780",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-10T00:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191782.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-11T19:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191782",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191783.json:
```json
{
    "body": "OK, I better stop given that a few thousands lines are affected already. Except for `lattice_polytope.py` they are mostly doctest fixes due to deprecated `octahedron` and changed representation.\n\nThe main thing that is left is fix the mess with polytope faces, but that definitely should be a separate ticket.",
    "created_at": "2014-04-11T19:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191783",
    "user": "novoselt"
}
```

OK, I better stop given that a few thousands lines are affected already. Except for `lattice_polytope.py` they are mostly doctest fixes due to deprecated `octahedron` and changed representation.

The main thing that is left is fix the mess with polytope faces, but that definitely should be a separate ticket.



---

archive/issue_comments_191784.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-11T19:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191784",
    "user": "novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_191785.json:
```json
{
    "body": "Conflicts with the already-merged #15990, either resolve now or with the next beta",
    "created_at": "2014-04-11T19:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191785",
    "user": "vbraun"
}
```

Conflicts with the already-merged #15990, either resolve now or with the next beta



---

archive/issue_comments_191786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-04-11T20:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191786",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_191787.json:
```json
{
    "body": "OK, I've done \n\n```\ngit merge 136948a88bbf731a916184b91adf52fb93daa0d4\n```\n\nwhich is the commit listed as \"branch\" on #15990 and then resolved the conflict. Was it the way to go?",
    "created_at": "2014-04-11T20:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191787",
    "user": "novoselt"
}
```

OK, I've done 

```
git merge 136948a88bbf731a916184b91adf52fb93daa0d4
```

which is the commit listed as "branch" on #15990 and then resolved the conflict. Was it the way to go?



---

archive/issue_comments_191788.json:
```json
{
    "body": "When I click on commits on trac, then my two merges with betas are shown as single commits, while this resent change shows also other stuff - what is the difference between merging \"develop\" and other commits into my branch?",
    "created_at": "2014-04-11T20:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191788",
    "user": "novoselt"
}
```

When I click on commits on trac, then my two merges with betas are shown as single commits, while this resent change shows also other stuff - what is the difference between merging "develop" and other commits into my branch?



---

archive/issue_comments_191789.json:
```json
{
    "body": "The betas that you merged are (by definition) already released, so in the trac view they (that is, the second parent of the merge) is excluded. But the ticket that you merged in is not yet released in a beta, so its entire history is shown as well. When I release the next beta containing #15990 then it will be removed from the trac view.",
    "created_at": "2014-04-11T21:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191789",
    "user": "vbraun"
}
```

The betas that you merged are (by definition) already released, so in the trac view they (that is, the second parent of the merge) is excluded. But the ticket that you merged in is not yet released in a beta, so its entire history is shown as well. When I release the next beta containing #15990 then it will be removed from the trac view.



---

archive/issue_comments_191790.json:
```json
{
    "body": "\n```\n  File \"/home/buildbot/build/sage/eno-1/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/lattice_polytope.py\", line 1058\n    result = stdout.read()\n         ^\nSyntaxError: invalid syntax\n```\n",
    "created_at": "2014-04-11T22:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191790",
    "user": "vbraun"
}
```


```
  File "/home/buildbot/build/sage/eno-1/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/lattice_polytope.py", line 1058
    result = stdout.read()
         ^
SyntaxError: invalid syntax
```




---

archive/issue_comments_191791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-11T23:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191792.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-13T19:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191792",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_191793.json:
```json
{
    "body": "Wow, looks like tachyons are real, thanks Volker!",
    "created_at": "2014-04-14T05:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191793",
    "user": "novoselt"
}
```

Wow, looks like tachyons are real, thanks Volker!



---

archive/issue_comments_191794.json:
```json
{
    "body": "Hi!\n\nDo you mind editing the ticket description so that users can easily find what's the current alternative to constructing lattice polytopes from a matrix?\n\nThanks!\n                                   Nicolas",
    "created_at": "2014-04-25T14:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191794",
    "user": "nthiery"
}
```

Hi!

Do you mind editing the ticket description so that users can easily find what's the current alternative to constructing lattice polytopes from a matrix?

Thanks!
                                   Nicolas



---

archive/issue_comments_191795.json:
```json
{
    "body": "Done. Any ideas why do I have\n\n```\n  #!/usr/bin/env python\n```\n\nin the end of the warning?..",
    "created_at": "2014-04-25T16:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191795",
    "user": "novoselt"
}
```

Done. Any ideas why do I have

```
  #!/usr/bin/env python
```

in the end of the warning?..



---

archive/issue_comments_191796.json:
```json
{
    "body": "Thanks!\n\nNo clue about the warning.",
    "created_at": "2014-04-25T17:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15003#issuecomment-191796",
    "user": "nthiery"
}
```

Thanks!

No clue about the warning.
