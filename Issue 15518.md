# Issue 15518: upgrade cython to version 0.20

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2014-01-28 22:35:29

CC:  robertwb mmezzarobba jpflori




---

Comment by ohanar created at 2014-01-28 22:39:33

Still needs some work. There seems to be some new overflow issues popping up with the libgap and polybori interfaces (at least that appears to be the issue with the failing doctests in `sage.groups.matrix_gps.finitely_generated` and `sage.rings.polynomial.pbori`).
----
New commits:


---

Comment by fbissey created at 2014-01-29 07:34:51

well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.
[https://github.com/cschwan/sage-on-gentoo/issues/275](https://github.com/cschwan/sage-on-gentoo/issues/275) I also posted about it on the cython user list earlier today.


---

Comment by ohanar created at 2014-01-29 07:55:39

Replying to [comment:3 fbissey]:
> well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.
Yes, I already added a patch to revert the broken optimizations.


---

Comment by fbissey created at 2014-01-29 07:57:25

I didn't see that one before posting. That's quite a lot of broken doctests without.


---

Comment by ohanar created at 2014-01-29 08:08:08

Replying to [comment:5 fbissey]:
> I didn't see that one before posting. That's quite a lot of broken doctests without.

Yes, it is really amazing that these are the first doctests that actually test list multiplication with more than two terms (i.e. `[None] * 2 * 3` fails to produce the correct result in Cython-0.20) and that there are no tests in the Cython test suite that test such basic functionality.


---

Comment by jdemeyer created at 2014-01-29 16:39:42

Remember to document the patch in `SPKG.txt`.


---

Comment by robertwb created at 2014-01-31 21:03:41

Did you run into issues with PPL? E.g. 

https://sage.math.washington.edu:8091/hudson/job/sage-git-build/40/consoleText


```
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_11MIP_Problem_30solve(__pyx_obj_4sage_4libs_3ppl_MIP_Problem*)':
sage/libs/ppl.cpp:5514:33: error: 'PPL_MIP_Problem_Status' in namespace 'Parma_Polyhedra_Library' does not name a type
sage/libs/ppl.cpp:5514:67: error: invalid type in declaration before ';' token
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_16type(__pyx_obj_4sage_4libs_3ppl_Generator*)':
sage/libs/ppl.cpp:19487:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'
sage/libs/ppl.cpp:19487:57: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:19502:3: error: '__pyx_v_t' was not declared in this scope
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_40__reduce__(__pyx_obj_4sage_4libs_3ppl_Generator*)':
sage/libs/ppl.cpp:20508:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'
sage/libs/ppl.cpp:20508:57: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:20527:3: error: '__pyx_v_t' was not declared in this scope
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_10Constraint_8type(__pyx_obj_4sage_4libs_3ppl_Constraint*)':
sage/libs/ppl.cpp:23983:3: error: 'PPL_ConstraintType' is not a member of 'Parma_Polyhedra_Library::Constraint'
sage/libs/ppl.cpp:23983:59: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:23995:3: error: '__pyx_v_t' was not declared in this scope
```



---

Comment by fbissey created at 2014-01-31 21:07:12

I didn't when I built sage against pristine cython-0.20 here. In fact it all built, it just failed so many doctests on matroids it wasn't funny.


---

Comment by fbissey created at 2014-01-31 21:10:21

Would you actually be getting ppl headers from the distro rather than sage's one?


---

Comment by jdemeyer created at 2014-02-08 11:15:02

PPL problem confirmed.
----
New commits:


---

Comment by git created at 2014-02-08 11:16:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-02-08 13:11:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-02-08 14:08:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-02-08 15:03:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2014-02-08 15:05:31

This last version passes doctests, but we should wait until Cython 0.20.1 is officially released.


---

Comment by git created at 2014-02-12 10:13:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-02-12 10:13:24

Changing status from new to needs_review.


---

Comment by ohanar created at 2014-02-14 03:27:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-20 23:17:03

Resolution: fixed


---

Comment by vbraun created at 2014-02-21 09:05:51

Full rebuild doesn't work:

```
Successfully installed eclib-20140128
Deleting temporary build directory
/home/release/Sage/local/var/tmp/sage/build/eclib-20140128
Finished installing eclib-20140128.spkg
if [ -z "$SAGE_INSTALL_FETCH_ONLY" ]; then \
	cd /home/release/Sage/src && source bin/sage-env && \
	/home/release/Sage/build/pipestatus 'time python setup.py install 2>&1' 'tee -a /home/release/Sage/logs/pkgs/sage-6.2.beta2.log' && \
	touch /home/release/Sage/local/var/lib/sage/installed/sage; \
fi
Updating Cython code....
Traceback (most recent call last):
  File "setup.py", line 501, in <module>
    from Cython.Build import cythonize
ImportError: No module named Cython.Build
```



---

Comment by vbraun created at 2014-02-21 09:05:51

Changing status from closed to new.


---

Comment by vbraun created at 2014-02-21 09:05:51

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2014-02-21 13:06:25

New commits:


---

Comment by jdemeyer created at 2014-02-21 14:30:01

Replying to [comment:24 vbraun]:
> Full rebuild doesn't work:
What does the "full rebuild" script do? Works for me after `make distclean`.


---

Comment by jdemeyer created at 2014-02-21 14:31:36

Do you have a link to the complete `install.log` from that build?


---

Comment by vbraun created at 2014-02-21 16:07:13

Thats what I meant... maybe the failure was from another ticket. Will try again...


---

Comment by vbraun created at 2014-02-21 20:07:50

Resolution: fixed


---

Comment by jdemeyer created at 2014-02-24 08:45:30

Fails on 32-bit: [http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio](http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio)


---

Comment by jdemeyer created at 2014-02-24 10:21:22

New commits:


---

Comment by jdemeyer created at 2014-02-24 11:10:15

New commits:


---

Comment by jdemeyer created at 2014-02-24 11:10:15

Changing status from closed to new.


---

Comment by jdemeyer created at 2014-02-24 11:10:15

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2014-02-24 11:10:27

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-03-02 16:15:06

Resolution: fixed
