# Issue 15518: upgrade cython to version 0.20

archive/issues_015518.json:
```json
{
    "body": "CC:  robertwb mmezzarobba jpflori\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15755\n\n",
    "created_at": "2014-01-28T22:35:29Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "upgrade cython to version 0.20",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15518",
    "user": "ohanar"
}
```
CC:  robertwb mmezzarobba jpflori



Issue created by migration from https://trac.sagemath.org/ticket/15755





---

archive/issue_comments_200467.json:
```json
{
    "body": "Still needs some work. There seems to be some new overflow issues popping up with the libgap and polybori interfaces (at least that appears to be the issue with the failing doctests in `sage.groups.matrix_gps.finitely_generated` and `sage.rings.polynomial.pbori`).\n----\nNew commits:",
    "created_at": "2014-01-28T22:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200467",
    "user": "ohanar"
}
```

Still needs some work. There seems to be some new overflow issues popping up with the libgap and polybori interfaces (at least that appears to be the issue with the failing doctests in `sage.groups.matrix_gps.finitely_generated` and `sage.rings.polynomial.pbori`).
----
New commits:



---

archive/issue_comments_200468.json:
```json
{
    "body": "well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.\n[https://github.com/cschwan/sage-on-gentoo/issues/275](https://github.com/cschwan/sage-on-gentoo/issues/275) I also posted about it on the cython user list earlier today.",
    "created_at": "2014-01-29T07:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200468",
    "user": "fbissey"
}
```

well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.
[https://github.com/cschwan/sage-on-gentoo/issues/275](https://github.com/cschwan/sage-on-gentoo/issues/275) I also posted about it on the cython user list earlier today.



---

archive/issue_comments_200469.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.\nYes, I already added a patch to revert the broken optimizations.",
    "created_at": "2014-01-29T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200469",
    "user": "ohanar"
}
```

Replying to [comment:3 fbissey]:
> well we have some fun with cython-0.20 in sage-on-gentoo since yesterday. We have a whole series of tests that fail in matroids.
Yes, I already added a patch to revert the broken optimizations.



---

archive/issue_comments_200470.json:
```json
{
    "body": "I didn't see that one before posting. That's quite a lot of broken doctests without.",
    "created_at": "2014-01-29T07:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200470",
    "user": "fbissey"
}
```

I didn't see that one before posting. That's quite a lot of broken doctests without.



---

archive/issue_comments_200471.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> I didn't see that one before posting. That's quite a lot of broken doctests without.\n\nYes, it is really amazing that these are the first doctests that actually test list multiplication with more than two terms (i.e. `[None] * 2 * 3` fails to produce the correct result in Cython-0.20) and that there are no tests in the Cython test suite that test such basic functionality.",
    "created_at": "2014-01-29T08:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200471",
    "user": "ohanar"
}
```

Replying to [comment:5 fbissey]:
> I didn't see that one before posting. That's quite a lot of broken doctests without.

Yes, it is really amazing that these are the first doctests that actually test list multiplication with more than two terms (i.e. `[None] * 2 * 3` fails to produce the correct result in Cython-0.20) and that there are no tests in the Cython test suite that test such basic functionality.



---

archive/issue_comments_200472.json:
```json
{
    "body": "Remember to document the patch in `SPKG.txt`.",
    "created_at": "2014-01-29T16:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200472",
    "user": "jdemeyer"
}
```

Remember to document the patch in `SPKG.txt`.



---

archive/issue_comments_200473.json:
```json
{
    "body": "Did you run into issues with PPL? E.g. \n\nhttps://sage.math.washington.edu:8091/hudson/job/sage-git-build/40/consoleText\n\n\n```\nsage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_11MIP_Problem_30solve(__pyx_obj_4sage_4libs_3ppl_MIP_Problem*)':\nsage/libs/ppl.cpp:5514:33: error: 'PPL_MIP_Problem_Status' in namespace 'Parma_Polyhedra_Library' does not name a type\nsage/libs/ppl.cpp:5514:67: error: invalid type in declaration before ';' token\nsage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_16type(__pyx_obj_4sage_4libs_3ppl_Generator*)':\nsage/libs/ppl.cpp:19487:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'\nsage/libs/ppl.cpp:19487:57: error: expected ';' before '__pyx_v_t'\nsage/libs/ppl.cpp:19502:3: error: '__pyx_v_t' was not declared in this scope\nsage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_40__reduce__(__pyx_obj_4sage_4libs_3ppl_Generator*)':\nsage/libs/ppl.cpp:20508:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'\nsage/libs/ppl.cpp:20508:57: error: expected ';' before '__pyx_v_t'\nsage/libs/ppl.cpp:20527:3: error: '__pyx_v_t' was not declared in this scope\nsage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_10Constraint_8type(__pyx_obj_4sage_4libs_3ppl_Constraint*)':\nsage/libs/ppl.cpp:23983:3: error: 'PPL_ConstraintType' is not a member of 'Parma_Polyhedra_Library::Constraint'\nsage/libs/ppl.cpp:23983:59: error: expected ';' before '__pyx_v_t'\nsage/libs/ppl.cpp:23995:3: error: '__pyx_v_t' was not declared in this scope\n```\n",
    "created_at": "2014-01-31T21:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200473",
    "user": "robertwb"
}
```

Did you run into issues with PPL? E.g. 

https://sage.math.washington.edu:8091/hudson/job/sage-git-build/40/consoleText


```
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_11MIP_Problem_30solve(__pyx_obj_4sage_4libs_3ppl_MIP_Problem*)':
sage/libs/ppl.cpp:5514:33: error: 'PPL_MIP_Problem_Status' in namespace 'Parma_Polyhedra_Library' does not name a type
sage/libs/ppl.cpp:5514:67: error: invalid type in declaration before ';' token
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_16type(__pyx_obj_4sage_4libs_3ppl_Generator*)':
sage/libs/ppl.cpp:19487:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'
sage/libs/ppl.cpp:19487:57: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:19502:3: error: '__pyx_v_t' was not declared in this scope
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_9Generator_40__reduce__(__pyx_obj_4sage_4libs_3ppl_Generator*)':
sage/libs/ppl.cpp:20508:3: error: 'PPL_GeneratorType' is not a member of 'Parma_Polyhedra_Library::Generator'
sage/libs/ppl.cpp:20508:57: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:20527:3: error: '__pyx_v_t' was not declared in this scope
sage/libs/ppl.cpp: In function 'PyObject* __pyx_pf_4sage_4libs_3ppl_10Constraint_8type(__pyx_obj_4sage_4libs_3ppl_Constraint*)':
sage/libs/ppl.cpp:23983:3: error: 'PPL_ConstraintType' is not a member of 'Parma_Polyhedra_Library::Constraint'
sage/libs/ppl.cpp:23983:59: error: expected ';' before '__pyx_v_t'
sage/libs/ppl.cpp:23995:3: error: '__pyx_v_t' was not declared in this scope
```




---

archive/issue_comments_200474.json:
```json
{
    "body": "I didn't when I built sage against pristine cython-0.20 here. In fact it all built, it just failed so many doctests on matroids it wasn't funny.",
    "created_at": "2014-01-31T21:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200474",
    "user": "fbissey"
}
```

I didn't when I built sage against pristine cython-0.20 here. In fact it all built, it just failed so many doctests on matroids it wasn't funny.



---

archive/issue_comments_200475.json:
```json
{
    "body": "Would you actually be getting ppl headers from the distro rather than sage's one?",
    "created_at": "2014-01-31T21:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200475",
    "user": "fbissey"
}
```

Would you actually be getting ppl headers from the distro rather than sage's one?



---

archive/issue_comments_200476.json:
```json
{
    "body": "PPL problem confirmed.\n----\nNew commits:",
    "created_at": "2014-02-08T11:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200476",
    "user": "jdemeyer"
}
```

PPL problem confirmed.
----
New commits:



---

archive/issue_comments_200477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-02-08T11:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200477",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_200478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-08T13:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200478",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200479.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-02-08T14:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200479",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_200480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-02-08T15:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200480",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_200481.json:
```json
{
    "body": "This last version passes doctests, but we should wait until Cython 0.20.1 is officially released.",
    "created_at": "2014-02-08T15:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200481",
    "user": "jdemeyer"
}
```

This last version passes doctests, but we should wait until Cython 0.20.1 is officially released.



---

archive/issue_comments_200482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-12T10:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200482",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200483.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-12T10:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200483",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200484.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-14T03:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200484",
    "user": "ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200485.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-20T23:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200485",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_200486.json:
```json
{
    "body": "Full rebuild doesn't work:\n\n```\nSuccessfully installed eclib-20140128\nDeleting temporary build directory\n/home/release/Sage/local/var/tmp/sage/build/eclib-20140128\nFinished installing eclib-20140128.spkg\nif [ -z \"$SAGE_INSTALL_FETCH_ONLY\" ]; then \\\n\tcd /home/release/Sage/src && source bin/sage-env && \\\n\t/home/release/Sage/build/pipestatus 'time python setup.py install 2>&1' 'tee -a /home/release/Sage/logs/pkgs/sage-6.2.beta2.log' && \\\n\ttouch /home/release/Sage/local/var/lib/sage/installed/sage; \\\nfi\nUpdating Cython code....\nTraceback (most recent call last):\n  File \"setup.py\", line 501, in <module>\n    from Cython.Build import cythonize\nImportError: No module named Cython.Build\n```\n",
    "created_at": "2014-02-21T09:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200486",
    "user": "vbraun"
}
```

Full rebuild doesn't work:

```
Successfully installed eclib-20140128
Deleting temporary build directory
/home/release/Sage/local/var/tmp/sage/build/eclib-20140128
Finished installing eclib-20140128.spkg
if [ -z "$SAGE_INSTALL_FETCH_ONLY" ]; then \
	cd /home/release/Sage/src && source bin/sage-env && \
	/home/release/Sage/build/pipestatus 'time python setup.py install 2>&1' 'tee -a /home/release/Sage/logs/pkgs/sage-6.2.beta2.log' && \
	touch /home/release/Sage/local/var/lib/sage/installed/sage; \
fi
Updating Cython code....
Traceback (most recent call last):
  File "setup.py", line 501, in <module>
    from Cython.Build import cythonize
ImportError: No module named Cython.Build
```




---

archive/issue_comments_200487.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-02-21T09:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200487",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_200488.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-02-21T09:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200488",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_200489.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-21T13:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200489",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_200490.json:
```json
{
    "body": "Replying to [comment:24 vbraun]:\n> Full rebuild doesn't work:\nWhat does the \"full rebuild\" script do? Works for me after `make distclean`.",
    "created_at": "2014-02-21T14:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200490",
    "user": "jdemeyer"
}
```

Replying to [comment:24 vbraun]:
> Full rebuild doesn't work:
What does the "full rebuild" script do? Works for me after `make distclean`.



---

archive/issue_comments_200491.json:
```json
{
    "body": "Do you have a link to the complete `install.log` from that build?",
    "created_at": "2014-02-21T14:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200491",
    "user": "jdemeyer"
}
```

Do you have a link to the complete `install.log` from that build?



---

archive/issue_comments_200492.json:
```json
{
    "body": "Thats what I meant... maybe the failure was from another ticket. Will try again...",
    "created_at": "2014-02-21T16:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200492",
    "user": "vbraun"
}
```

Thats what I meant... maybe the failure was from another ticket. Will try again...



---

archive/issue_comments_200493.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-21T20:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200493",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_200494.json:
```json
{
    "body": "Fails on 32-bit: [http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio](http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio)",
    "created_at": "2014-02-24T08:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200494",
    "user": "jdemeyer"
}
```

Fails on 32-bit: [http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio](http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio)



---

archive/issue_comments_200495.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-24T10:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200495",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_200496.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-24T11:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200496",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_200497.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-02-24T11:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200497",
    "user": "jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_comments_200498.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-02-24T11:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200498",
    "user": "jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_200499.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-24T11:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200499",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200500.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-02T16:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15518#issuecomment-200500",
    "user": "vbraun"
}
```

Resolution: fixed
