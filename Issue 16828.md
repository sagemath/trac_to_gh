# Issue 16828: use Maxima's trigrat() in symbolic simplify

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-09-29 08:50:53

Keywords: maxima, simplification, trigonometric

The ask page
http://ask.sagemath.org/question/11365/simplify-trigonometric-expression/
showed that trigrat() is not used. What a waste. 


---

Comment by rws created at 2014-09-30 13:50:44

Changing status from new to needs_review.


---

Comment by rws created at 2014-09-30 13:50:44

Please review.
----
New commits:


---

Comment by nbruin created at 2014-09-30 17:54:18

Changing status from needs_review to needs_work.


---

Comment by nbruin created at 2014-09-30 17:54:18

Quite some doctest failures on the buildbot. Some of them are probably not due this particular change, but others most probably are. A few are simply *better* answers now (that's just a matter of changing the expected output), but there are also some that are much *worse*. So the change is not uniformly an improvement.

ratsimp claims "canonical form", so that's definitely attractive. However, do we know if its rewrites always apply across the whole domain? We'd have to document if it deviates.


---

Comment by rws created at 2014-10-02 09:29:41

Since setting "needs_work" makes the buildbot link disappear, and I'm too stupid to find the results otherwise (I tried), I cannot sort this out without help, sorry.


---

Comment by kcrisman created at 2014-10-02 16:02:26

This can even lead to disaster, I think:

```
sage: F = (4*cos(9*pi/180)^2 - 3)*(4*cos(27*pi/180)^2 - 3)
sage: F.maxima_methods().trigrat()
sqrt(5) + 2*cos(7/10*pi) - 2*cos(1/10*pi) - 2*I*sin(3/5*pi) +
2*I*sin(2/5*pi) + 1
```

I really am not interested in seeing `I` turn up in such a simplification, regardless of the "correct" answer.


---

Comment by nbruin created at 2014-10-03 15:02:47

Changing status from needs_work to needs_review.


---

Comment by nbruin created at 2014-10-03 15:02:47

Replying to [comment:4 rws]:
> Since setting "needs_work" makes the buildbot link disappear, and I'm too stupid to find the results otherwise (I tried), I cannot sort this out without help, sorry.

Oh, that's silly. I'm setting it back to "needs review" to make the report visible for now. Hopefully we can have this fixed.


---

Comment by rws created at 2014-10-03 16:07:47

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-10-03 16:07:47

Thanks, the link is now here: http://build.sagedev.org/trac/builders/trac_builder/builds/1046
so the ticket can be set to the right status.


---

Comment by rws created at 2014-10-04 13:34:08

Replying to [comment:5 kcrisman]:
> This can even lead to disaster, I think:
> {{{
> sage: F = (4*cos(9*pi/180)^2 - 3)*(4*cos(27*pi/180)^2 - 3)
> sage: F.maxima_methods().trigrat()
> sqrt(5) + 2*cos(7/10*pi) - 2*cos(1/10*pi) - 2*I*sin(3/5*pi) +
> 2*I*sin(2/5*pi) + 1
> }}}
> I really am not interested in seeing `I` turn up in such a simplification, regardless of the "correct" answer.
While this one could be resolved by adding a `trigreduce` to the queue:

```
sage: F = (4*cos(9*pi/180)^2 - 3)*(4*cos(27*pi/180)^2 - 3)
sage: F.maxima_methods().trigrat()
sqrt(5) + 2*cos(7/10*pi) - 2*cos(1/10*pi) - 2*I*sin(3/5*pi) +
2*I*sin(2/5*pi) + 1
sage: _.maxima_methods().trigreduce()
sqrt(5) - 2*cos(3/10*pi) - 2*cos(1/10*pi) + 1
```

I cannot see how to fix the doctest failure:

```
File "src/doc/de/thematische_anleitungen/sage_gymnasium.rst", line 394, in doc.de.thematische_anleitungen.sage_gymnasium
Failed example:
    (sin(x + y)/(log(x) + log(y))).simplify_full()
Expected:
    (cos(y)*sin(x) + cos(x)*sin(y))/log(x*y)
Got:
    ((-I*arctan2(0, x) - I*arctan2(0, y))*sin(x + y) + log(abs(x)*abs(y))*sin(x + y))/(arctan2(0, x)^2 + 2*arctan2(0, x)*arctan2(0, y) + arctan2(0, y)^2 + log(abs(x))^2 + 2*log(abs(x))*log(abs(y)) + log(abs(y))^2)
```

the minimal case being

```
sage: log(x).maxima_methods().trigrat()
I*arctan2(0, x) + log(abs(x))
```



---

Comment by rws created at 2014-10-04 13:44:27

On the other hand, replacing `trigrat` with `trigsimp/trigexpand/trigreduce` will fail in this case:

```
sage: sin(1/8*pi)*sin(3/8*pi)*sin(5/8*pi)*sin(7/8*pi)
sin(7/8*pi)*sin(5/8*pi)*sin(3/8*pi)*sin(1/8*pi)
sage: _.maxima_methods().trigreduce()
TypeError                                 Traceback (most recent call last)
/home/ralf/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __init__(self, parent, value, is_name, name)
    624                 self._name = parent._create(value, name=name)
    625             except (TypeError, RuntimeError, ValueError) as x:
--> 626                 raise TypeError(x)
    627 
    628     def _latex_(self):

TypeError: ECL says: Unrecognised output from sp1sintcos.
```



---

Comment by nbruin created at 2014-10-05 18:52:32

Replying to [comment:9 rws]:
> On the other hand, replacing `trigrat` with `trigsimp/trigexpand/trigreduce` will fail in this case:
> [...]
Yes, I noticed that one too. I have confirmed that the same problem arises in Maxima 5.34.1 on SBCL, so it's probably a maxima problem. This is now:
[https://sourceforge.net/p/maxima/bugs/2818/](https://sourceforge.net/p/maxima/bugs/2818/)


---

Comment by rws created at 2015-02-11 15:28:36

While some of the mentioned problems have been fixed in recent Maxima, this no longer works:
> {{{
> sage: F = (4*cos(9*pi/180)^2 - 3)*(4*cos(27*pi/180)^2 - 3)
> sage: F.maxima_methods().trigrat()
> sqrt(5) + 2*cos(7/10*pi) - 2*cos(1/10*pi) - 2*I*sin(3/5*pi) +
> 2*I*sin(2/5*pi) + 1
> sage: _.maxima_methods().trigreduce()
> sqrt(5) - 2*cos(3/10*pi) - 2*cos(1/10*pi) + 1
> }}}
