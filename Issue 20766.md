# Issue 20766: Add SCIP backend using PySCIPOpt

archive/issues_020766.json:
```json
{
    "body": "CC:  moritz yzh malb dcoudert dimpase\n\nKeywords: lp\n\nhttp://scip.zib.de/doc/html/PYTHON_INTERFACE.php\n\nIssue created by migration from https://trac.sagemath.org/ticket/21003\n\n",
    "created_at": "2016-07-11T19:11:53Z",
    "labels": [
        "linear programming",
        "major",
        "enhancement"
    ],
    "title": "Add SCIP backend using PySCIPOpt",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20766",
    "user": "mkoeppe"
}
```
CC:  moritz yzh malb dcoudert dimpase

Keywords: lp

http://scip.zib.de/doc/html/PYTHON_INTERFACE.php

Issue created by migration from https://trac.sagemath.org/ticket/21003





---

archive/issue_comments_286788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-31T23:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-15T02:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-05T13:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_286791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-07T14:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286792.json:
```json
{
    "body": "Changing keywords from \"lp\" to \"lp, days84\".",
    "created_at": "2017-03-07T21:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286792",
    "user": "vdelecroix"
}
```

Changing keywords from "lp" to "lp, days84".



---

archive/issue_comments_286793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-17T05:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286793",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286794.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-19T21:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286794",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_286795.json:
```json
{
    "body": "This (hopefully) works now, after putting PySCIPOpt-1.4.0.tar.gz into upstream, which can be found here:\n\nhttps://pypi.python.org/packages/59/73/087bcb1d4e284681346a8847b83c5a86568dd19034ead0884450fa6bda50/PySCIPOpt-1.4.0.tar.gz#md5=6d40750e286348247e31e568bf16ee2d\n\n*UPDATE* (from a later edit): now you need to put PySCIPOpt-1.4.2.tar.gz\nhttps://pypi.python.org/packages/c0/b6/b619a33cd90dbf5579de341c873f85f0388030c47ee5da71a9113ee308d4/PySCIPOpt-1.4.2.tar.gz#md5=4f175316bc3ba4ce97c284434a4b62f0\n\n*UPDATE* (from yet a later edit): Check the description of the ticket for the latest version!\n----\nLast 10 new commits:",
    "created_at": "2018-04-05T21:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286795",
    "user": "moritz"
}
```

This (hopefully) works now, after putting PySCIPOpt-1.4.0.tar.gz into upstream, which can be found here:

https://pypi.python.org/packages/59/73/087bcb1d4e284681346a8847b83c5a86568dd19034ead0884450fa6bda50/PySCIPOpt-1.4.0.tar.gz#md5=6d40750e286348247e31e568bf16ee2d

*UPDATE* (from a later edit): now you need to put PySCIPOpt-1.4.2.tar.gz
https://pypi.python.org/packages/c0/b6/b619a33cd90dbf5579de341c873f85f0388030c47ee5da71a9113ee308d4/PySCIPOpt-1.4.2.tar.gz#md5=4f175316bc3ba4ce97c284434a4b62f0

*UPDATE* (from yet a later edit): Check the description of the ticket for the latest version!
----
Last 10 new commits:



---

archive/issue_comments_286796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T21:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286796",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T22:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286798.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-07T16:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286798",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286799.json:
```json
{
    "body": "Changing keywords from \"lp, days84\" to \"lp, days84, IMA-PolyGeom\".",
    "created_at": "2018-04-08T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286799",
    "user": "mkoeppe"
}
```

Changing keywords from "lp, days84" to "lp, days84, IMA-PolyGeom".



---

archive/issue_comments_286800.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-09T14:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286800",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286801.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-11T15:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286801",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286802.json:
```json
{
    "body": "In this version, there are a number of patches in the `patches` directory. All of them will be merged upstream in a version of pyscipopt with version number >=1.4.3, which should be available on Pypi not too long from now. I will update the pyscipopt package then.",
    "created_at": "2018-04-11T15:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286802",
    "user": "moritz"
}
```

In this version, there are a number of patches in the `patches` directory. All of them will be merged upstream in a version of pyscipopt with version number >=1.4.3, which should be available on Pypi not too long from now. I will update the pyscipopt package then.



---

archive/issue_comments_286803.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-11T15:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286803",
    "user": "moritz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286804.json:
```json
{
    "body": "I merged latest #24662.\n\nAll doctests need to be marked `# optional - pyscipopt`\n----\nNew commits:",
    "created_at": "2018-04-16T11:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286804",
    "user": "mkoeppe"
}
```

I merged latest #24662.

All doctests need to be marked `# optional - pyscipopt`
----
New commits:



---

archive/issue_comments_286805.json:
```json
{
    "body": "Also 1.4.3 is out.",
    "created_at": "2018-04-16T11:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286805",
    "user": "mkoeppe"
}
```

Also 1.4.3 is out.



---

archive/issue_comments_286806.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-16T11:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286806",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286807.json:
```json
{
    "body": "in the meantime its version 1.4.4: I am on it...",
    "created_at": "2018-04-16T13:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286807",
    "user": "moritz"
}
```

in the meantime its version 1.4.4: I am on it...



---

archive/issue_comments_286808.json:
```json
{
    "body": "I marked all doctest `optional` and updated.\n\n\nSuddenly, one doctest doesn't work anymore:\n\n```\nsage: g = graphs.CubeGraph(9)\nsage: p = MixedIntegerLinearProgram(solver = \"SCIP\")                # optional - pyscipopt\n\nsage: b = p.new_variable(binary=True)                               # optional - pyscipopt\nsage: p.set_objective(p.sum(b[v] for v in g))                       # optional - pyscipopt\nsage: for v in g:                                                   # optional - pyscipopt\n....:     p.add_constraint(b[v]+p.sum(b[u] for u in g.neighbors(v)) <= 1) # optional - pyscipopt\nsage: p.add_constraint(b[v] == 1) # Force an easy non-0 solution    # optional - pyscipopt\nsage: p.solver_parameter(\"limits/absgap\", 100)                      # optional - pyscipopt\nsage: p.solve() # rel tol 100                                       # optional - pyscipopt\n```\n \nand totaly chrashes sage with an error message `free(): invalid pointer`. I don't quite know what is going on. \n\nWhat is really weird is that it works if I don't run the last line, but instead:\n\n```\nsage: q = copy(p)\nsage: q.solver_parameter(\"limits/absgap\", 100)\nsage: q.solve()\n0\n```\n\n\n(I temperarily change `9` to `4` in the doctest above, in order to be able to run the rest of the doctest. The current branch works without failures for me.)\n----\nLast 10 new commits:",
    "created_at": "2018-04-16T21:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286808",
    "user": "moritz"
}
```

I marked all doctest `optional` and updated.


Suddenly, one doctest doesn't work anymore:

```
sage: g = graphs.CubeGraph(9)
sage: p = MixedIntegerLinearProgram(solver = "SCIP")                # optional - pyscipopt

sage: b = p.new_variable(binary=True)                               # optional - pyscipopt
sage: p.set_objective(p.sum(b[v] for v in g))                       # optional - pyscipopt
sage: for v in g:                                                   # optional - pyscipopt
....:     p.add_constraint(b[v]+p.sum(b[u] for u in g.neighbors(v)) <= 1) # optional - pyscipopt
sage: p.add_constraint(b[v] == 1) # Force an easy non-0 solution    # optional - pyscipopt
sage: p.solver_parameter("limits/absgap", 100)                      # optional - pyscipopt
sage: p.solve() # rel tol 100                                       # optional - pyscipopt
```
 
and totaly chrashes sage with an error message `free(): invalid pointer`. I don't quite know what is going on. 

What is really weird is that it works if I don't run the last line, but instead:

```
sage: q = copy(p)
sage: q.solver_parameter("limits/absgap", 100)
sage: q.solve()
0
```


(I temperarily change `9` to `4` in the doctest above, in order to be able to run the rest of the doctest. The current branch works without failures for me.)
----
Last 10 new commits:



---

archive/issue_comments_286809.json:
```json
{
    "body": "... the nice thing: all my patches have been merged by a very responsive upstream!",
    "created_at": "2018-04-16T21:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286809",
    "user": "moritz"
}
```

... the nice thing: all my patches have been merged by a very responsive upstream!



---

archive/issue_comments_286810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-04-17T10:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286810",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286811.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-04-17T10:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286811",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286812.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-17T11:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286812",
    "user": "moritz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286813.json:
```json
{
    "body": "now everything seems to work! I reviewed the stubs and everything written by Matthias on this ticket.",
    "created_at": "2018-04-17T11:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286813",
    "user": "moritz"
}
```

now everything seems to work! I reviewed the stubs and everything written by Matthias on this ticket.



---

archive/issue_comments_286814.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-19T08:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286814",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286815.json:
```json
{
    "body": "In the `spkg-install` script you should not be using the `make` command but rather `sdh_make` from the \"Sage-distribution helper\" tools (see `src/bin/sage-dist-helpers`).",
    "created_at": "2018-04-19T08:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286815",
    "user": "vdelecroix"
}
```

In the `spkg-install` script you should not be using the `make` command but rather `sdh_make` from the "Sage-distribution helper" tools (see `src/bin/sage-dist-helpers`).



---

archive/issue_comments_286816.json:
```json
{
    "body": "Also avoid `$MAKE test  | tee testsuite.log` (in `spkg-check`). It is not the role of the script to perform redirections.",
    "created_at": "2018-04-19T08:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286816",
    "user": "vdelecroix"
}
```

Also avoid `$MAKE test  | tee testsuite.log` (in `spkg-check`). It is not the role of the script to perform redirections.



---

archive/issue_comments_286817.json:
```json
{
    "body": "Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..",
    "created_at": "2018-04-19T08:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286817",
    "user": "moritz"
}
```

Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..



---

archive/issue_comments_286818.json:
```json
{
    "body": "Please use multiple lines for\n\n```\ncmake .. -DCMAKE_INSTALL_PREFIX=\"${SAGE_LOCAL}\"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR=\"${SAGE_LOCAL}\" -DZLIB_ROOT=\"${SAGE_LOCAL}\" -DReadline_ROOT_DIR=\"${SAGE_LOCAL}\" -DBLISS_DIR=\"${SAGE_LOCAL}\" -DIPOPT=FALSE\n```\n",
    "created_at": "2018-04-19T08:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286818",
    "user": "vdelecroix"
}
```

Please use multiple lines for

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR="${SAGE_LOCAL}" -DZLIB_ROOT="${SAGE_LOCAL}" -DReadline_ROOT_DIR="${SAGE_LOCAL}" -DBLISS_DIR="${SAGE_LOCAL}" -DIPOPT=FALSE
```




---

archive/issue_comments_286819.json:
```json
{
    "body": "Replying to [comment:43 moritz]:\n> Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..\n\nYou should not, this ticket is in positive review!",
    "created_at": "2018-04-19T08:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286819",
    "user": "vdelecroix"
}
```

Replying to [comment:43 moritz]:
> Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..

You should not, this ticket is in positive review!



---

archive/issue_comments_286820.json:
```json
{
    "body": "Replying to [comment:45 vdelecroix]:\n> Replying to [comment:43 moritz]:\n> > Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..\n> \n> You should not, this ticket is in positive review!\nok",
    "created_at": "2018-04-19T08:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286820",
    "user": "moritz"
}
```

Replying to [comment:45 vdelecroix]:
> Replying to [comment:43 moritz]:
> > Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..
> 
> You should not, this ticket is in positive review!
ok



---

archive/issue_comments_286821.json:
```json
{
    "body": "Why this change in `numerical/mip.pyx`\n\n```\n-        self._p._backend.set_variable_type(j, self._vtype)\n+        #self._p._backend.set_variable_type(j, self._vtype)\n```\n\nIf this line is not needed anymore just remove it.",
    "created_at": "2018-04-19T08:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286821",
    "user": "vdelecroix"
}
```

Why this change in `numerical/mip.pyx`

```
-        self._p._backend.set_variable_type(j, self._vtype)
+        #self._p._backend.set_variable_type(j, self._vtype)
```

If this line is not needed anymore just remove it.



---

archive/issue_comments_286822.json:
```json
{
    "body": "You could also simplify the `SPKG.txt` file:\n- the section `SPKG Maintainers` of SPKG.txt is not needed anymore (the information is likely to be not up to date in few time)\n- if `Special Update/Build Instructions` is empty, just avoid it.",
    "created_at": "2018-04-19T08:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286822",
    "user": "vdelecroix"
}
```

You could also simplify the `SPKG.txt` file:
- the section `SPKG Maintainers` of SPKG.txt is not needed anymore (the information is likely to be not up to date in few time)
- if `Special Update/Build Instructions` is empty, just avoid it.



---

archive/issue_comments_286823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-04-19T09:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286823",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T09:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286825.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-19T09:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286825",
    "user": "moritz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286826.json:
```json
{
    "body": "I addressed all suggestions by Vincent and tested the install of scipoptsuite as well as pyscipopt.",
    "created_at": "2018-04-19T09:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286826",
    "user": "moritz"
}
```

I addressed all suggestions by Vincent and tested the install of scipoptsuite as well as pyscipopt.



---

archive/issue_comments_286827.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-12T19:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286827",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286828.json:
```json
{
    "body": "merge conflicts",
    "created_at": "2018-05-12T19:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286828",
    "user": "vdelecroix"
}
```

merge conflicts



---

archive/issue_comments_286829.json:
```json
{
    "body": "And this will not work\n\n```\ncmake .. -DCMAKE_INSTALL_PREFIX=\"${SAGE_LOCAL}\"/\n         -DCMAKE_VERBOSE_MAKEFILE=ON\n         -DGMP_DIR=\"${SAGE_LOCAL}\"\n         -DZLIB_ROOT=\"${SAGE_LOCAL}\"\n         -DReadline_ROOT_DIR=\"${SAGE_LOCAL}\"\n         -DBLISS_DIR=\"${SAGE_LOCAL}\"\n         -DIPOPT=FALSE\n```\n\nYou need to add backslashes for line continuation\n\n```\ncmake .. -DCMAKE_INSTALL_PREFIX=\"${SAGE_LOCAL}\" \\\n         -DCMAKE_VERBOSE_MAKEFILE=ON            \\\n         -DGMP_DIR=\"${SAGE_LOCAL}\"              \\\n         -DZLIB_ROOT=\"${SAGE_LOCAL}\"            \\\n         -DReadline_ROOT_DIR=\"${SAGE_LOCAL}\"    \\\n         -DBLISS_DIR=\"${SAGE_LOCAL}\"            \\\n         -DIPOPT=FALSE\n```\n",
    "created_at": "2018-05-12T19:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286829",
    "user": "vdelecroix"
}
```

And this will not work

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}"/
         -DCMAKE_VERBOSE_MAKEFILE=ON
         -DGMP_DIR="${SAGE_LOCAL}"
         -DZLIB_ROOT="${SAGE_LOCAL}"
         -DReadline_ROOT_DIR="${SAGE_LOCAL}"
         -DBLISS_DIR="${SAGE_LOCAL}"
         -DIPOPT=FALSE
```

You need to add backslashes for line continuation

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}" \
         -DCMAKE_VERBOSE_MAKEFILE=ON            \
         -DGMP_DIR="${SAGE_LOCAL}"              \
         -DZLIB_ROOT="${SAGE_LOCAL}"            \
         -DReadline_ROOT_DIR="${SAGE_LOCAL}"    \
         -DBLISS_DIR="${SAGE_LOCAL}"            \
         -DIPOPT=FALSE
```




---

archive/issue_comments_286830.json:
```json
{
    "body": "I will get to work. I think the line break issue was fixed here:\nhttps://git.sagemath.org/sage.git/commit/?id=c0b432c427236c07f76f930a156a15d3f33eb1f1\n\nBut I can make the slashes align, of course.",
    "created_at": "2018-05-12T19:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286830",
    "user": "moritz"
}
```

I will get to work. I think the line break issue was fixed here:
https://git.sagemath.org/sage.git/commit/?id=c0b432c427236c07f76f930a156a15d3f33eb1f1

But I can make the slashes align, of course.



---

archive/issue_comments_286831.json:
```json
{
    "body": "Alignment does not matter. But there should be backslashes.",
    "created_at": "2018-05-12T19:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286831",
    "user": "vdelecroix"
}
```

Alignment does not matter. But there should be backslashes.



---

archive/issue_comments_286832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-05-12T21:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286832",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286833.json:
```json
{
    "body": "Replying to [comment:52 vdelecroix]:\n> merge conflicts\n\nI did a rebase, and it was done automatically.\nI ran all the tests, and (at least on my machine) everything works..\n\nI am a bit confused, because I expected to see merge conflicts..",
    "created_at": "2018-05-12T21:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286833",
    "user": "moritz"
}
```

Replying to [comment:52 vdelecroix]:
> merge conflicts

I did a rebase, and it was done automatically.
I ran all the tests, and (at least on my machine) everything works..

I am a bit confused, because I expected to see merge conflicts..



---

archive/issue_comments_286834.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-12T21:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286834",
    "user": "moritz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286835.json:
```json
{
    "body": "Replying to [comment:57 moritz]:\n> Replying to [comment:52 vdelecroix]:\n> > merge conflicts\n> \n> I did a rebase, and it was done automatically.\n> I ran all the tests, and (at least on my machine) everything works..\n> \n> I am a bit confused, because I expected to see merge conflicts..\n\nApplying patches is not commutative!",
    "created_at": "2018-05-13T08:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286835",
    "user": "vdelecroix"
}
```

Replying to [comment:57 moritz]:
> Replying to [comment:52 vdelecroix]:
> > merge conflicts
> 
> I did a rebase, and it was done automatically.
> I ran all the tests, and (at least on my machine) everything works..
> 
> I am a bit confused, because I expected to see merge conflicts..

Applying patches is not commutative!



---

archive/issue_comments_286836.json:
```json
{
    "body": "What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.",
    "created_at": "2018-05-13T08:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286836",
    "user": "vdelecroix"
}
```

What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.



---

archive/issue_comments_286837.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-05-13T08:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286837",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_286838.json:
```json
{
    "body": "Replying to [comment:59 vdelecroix]:\n> What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.\n\nI think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. \n\nI agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me.",
    "created_at": "2018-05-13T08:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286838",
    "user": "moritz"
}
```

Replying to [comment:59 vdelecroix]:
> What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.

I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. 

I agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me.



---

archive/issue_comments_286839.json:
```json
{
    "body": "Replying to [comment:61 moritz]:\n> Replying to [comment:59 vdelecroix]:\n> > What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.\n> \n> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. \n> \n> I agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me. \n\nOn the plus side\n\n- do like the other backends\n\nOn the minus side\n\n- two files (pxd/pyx) instead of one\n- longer compilation time\n- more delicate to debug\n\nThe reason why all other backends are written in Cython is because they do call C functions.",
    "created_at": "2018-05-13T08:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286839",
    "user": "vdelecroix"
}
```

Replying to [comment:61 moritz]:
> Replying to [comment:59 vdelecroix]:
> > What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.
> 
> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. 
> 
> I agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me. 

On the plus side

- do like the other backends

On the minus side

- two files (pxd/pyx) instead of one
- longer compilation time
- more delicate to debug

The reason why all other backends are written in Cython is because they do call C functions.



---

archive/issue_comments_286840.json:
```json
{
    "body": "Replying to [comment:61 moritz]:\n> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. \n\nThat's correct, I did this just for copypastability and no technical reason otherwise.",
    "created_at": "2018-05-14T01:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286840",
    "user": "mkoeppe"
}
```

Replying to [comment:61 moritz]:
> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. 

That's correct, I did this just for copypastability and no technical reason otherwise.



---

archive/issue_comments_286841.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-05-31T17:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286841",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286842.json:
```json
{
    "body": "Another update to SCIPoptsuite 6.0 is due",
    "created_at": "2018-07-16T19:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286842",
    "user": "mkoeppe"
}
```

Another update to SCIPoptsuite 6.0 is due



---

archive/issue_comments_286843.json:
```json
{
    "body": "milestone update 8.3 -> 8.4",
    "created_at": "2018-08-03T19:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286843",
    "user": "vdelecroix"
}
```

milestone update 8.3 -> 8.4



---

archive/issue_comments_286844.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2021-02-03T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286844",
    "user": "mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_286845.json:
```json
{
    "body": "Squashed/rebased onto #31329 (Update scipoptsuite to 7.0.2)",
    "created_at": "2021-02-03T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286845",
    "user": "mkoeppe"
}
```

Squashed/rebased onto #31329 (Update scipoptsuite to 7.0.2)



---

archive/issue_comments_286846.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-03T07:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286846",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286847.json:
```json
{
    "body": "\n```\nsage: from pyscipopt import Model                                                                                                                                                                                        \n---------------------------------------------------------------------------\nImportError                               Traceback (most recent call last)\n<ipython-input-1-fcc6f2f967b1> in <module>\n----> 1 from pyscipopt import Model\n\n~/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/__init__.py in <module>\n      9 # export user-relevant objects:\n     10 from pyscipopt.Multidict import multidict\n---> 11 from pyscipopt.scip      import Model\n     12 from pyscipopt.scip      import Benders\n     13 from pyscipopt.scip      import Benderscut\n\nImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so, 2): Library not loaded: libscip.7.0.dylib\n  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so\n  Reason: image not found\n```\n",
    "created_at": "2021-02-03T07:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286847",
    "user": "mkoeppe"
}
```


```
sage: from pyscipopt import Model                                                                                                                                                                                        
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-fcc6f2f967b1> in <module>
----> 1 from pyscipopt import Model

~/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/__init__.py in <module>
      9 # export user-relevant objects:
     10 from pyscipopt.Multidict import multidict
---> 11 from pyscipopt.scip      import Model
     12 from pyscipopt.scip      import Benders
     13 from pyscipopt.scip      import Benderscut

ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so, 2): Library not loaded: libscip.7.0.dylib
  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so
  Reason: image not found
```




---

archive/issue_comments_286848.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286848",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_286849.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286849",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_286850.json:
```json
{
    "body": "yes, I came here to note the license change too :-)",
    "created_at": "2022-11-04T23:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286850",
    "user": "dimpase"
}
```

yes, I came here to note the license change too :-)



---

archive/issue_comments_286851.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-11-12T07:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286851",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286852.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-11-14T04:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286852",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_286853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-11-14T05:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286853",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_286854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-14T06:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286855.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-20T05:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286855",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286856.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-22T20:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286856",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-22T21:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286857",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286858.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-22T22:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286858",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286859.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-23T20:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286859",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286860.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-23T23:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286860",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-11-28T00:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286861",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286862.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-28T01:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286862",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286863.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-11-28T01:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286863",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286864.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-28T02:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286864",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286865.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-28T02:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286865",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286866.json:
```json
{
    "body": "I tried with Fedor 35 and all my tests are successful.\n\nHow can I run all doctests with scip as default solver ?",
    "created_at": "2022-11-29T10:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286866",
    "user": "dcoudert"
}
```

I tried with Fedor 35 and all my tests are successful.

How can I run all doctests with scip as default solver ?



---

archive/issue_comments_286867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-29T18:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286867",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286868.json:
```json
{
    "body": "After this fix, you can use `~/.sage/init-doctests.sage` to set `default_mip_solver('scip')`",
    "created_at": "2022-11-29T18:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286868",
    "user": "mkoeppe"
}
```

After this fix, you can use `~/.sage/init-doctests.sage` to set `default_mip_solver('scip')`



---

archive/issue_comments_286869.json:
```json
{
    "body": "In the last commit, you added `elif solver == \"Scip\":` but in other places we have `for s in [\"Cplex\", \"Gurobi\", \"Coin\", \"Glpk\", \"SCIP\"]:` and in the last comment you used `'scip'`. I'm not sure which is the correct way to write it. In fact, I think that the name of the solver should not be case sensitive.\n\nI tried different ways to write `scip` in `~/.sage/init-doctests.sage` and it's working, but I cannot ensure that `SCIP` has been used...",
    "created_at": "2022-11-30T12:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286869",
    "user": "dcoudert"
}
```

In the last commit, you added `elif solver == "Scip":` but in other places we have `for s in ["Cplex", "Gurobi", "Coin", "Glpk", "SCIP"]:` and in the last comment you used `'scip'`. I'm not sure which is the correct way to write it. In fact, I think that the name of the solver should not be case sensitive.

I tried different ways to write `scip` in `~/.sage/init-doctests.sage` and it's working, but I cannot ensure that `SCIP` has been used...



---

archive/issue_comments_286870.json:
```json
{
    "body": "The solver name is case-insensitive. Functions such as `default_mip_solver` normalize it using `solver = solver.capitalize()` before comparing it with the known solver names.",
    "created_at": "2022-11-30T17:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286870",
    "user": "mkoeppe"
}
```

The solver name is case-insensitive. Functions such as `default_mip_solver` normalize it using `solver = solver.capitalize()` before comparing it with the known solver names.



---

archive/issue_comments_286871.json:
```json
{
    "body": "Do you have some examples in `sage.graphs` where the default solver takes noticeable time? Perhaps we can add some doctests that are `# optional - pyscipopt`.",
    "created_at": "2022-11-30T17:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286871",
    "user": "mkoeppe"
}
```

Do you have some examples in `sage.graphs` where the default solver takes noticeable time? Perhaps we can add some doctests that are `# optional - pyscipopt`.



---

archive/issue_comments_286872.json:
```json
{
    "body": "While searching for an example, I found an issue:\n- in method `G.pathwidth`, we can specify \u00e0lgorithm=\"MILP\"` but not the solver\n- in method `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation` we can not set parameter `integrality=True` that is used in `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP`. It is currently set to `False`. The problem is that with `SCIP`, I get an error when set to `False` and the correct answer when `True`.\n\n\n```\nsage: from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP\nsage: G = graphs.PetersenGraph()\nsage: %time vertex_separation_MILP(G, solver=\"GLPK\")\nCPU times: user 10.2 s, sys: 2.96 ms, total: 10.2 s\nWall time: 10.3 s\n(5, [1, 2, 4, 9, 7, 0, 5, 6, 3, 8])\nsage: %time vertex_separation_MILP(G, solver=\"SCIP\")\n---------------------------------------------------------------------------\nMIPSolverException                        Traceback (most recent call last)\nFile /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1405, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()\n   1404 try:\n-> 1405     obj = p.solve(log=verbose)\n   1406 except MIPSolverException:\n\nFile /home/dcoudert/sage/src/sage/numerical/mip.pyx:2559, in sage.numerical.mip.MixedIntegerLinearProgram.solve()\n   2558 if log is not None: self._backend.set_verbosity(log)\n-> 2559 self._backend.solve()\n   2560 return self._backend.get_objective_value()\n\nFile /home/dcoudert/sage/src/sage/numerical/backends/scip_backend.pyx:632, in sage.numerical.backends.scip_backend.SCIPBackend.solve()\n    631 elif status=='infeasible':\n--> 632     raise MIPSolverException(\"SCIP : There is no feasible solution\")\n    633 #elif status=='timelimit':\n\nMIPSolverException: SCIP : There is no feasible solution\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\nFile <timed eval>:1\n\nFile /home/dcoudert/sage/src/sage/misc/decorators.py:651, in rename_keyword.__call__.<locals>.wrapper(*args, **kwds)\n    649         kwds[new_name] = kwds[old_name]\n    650         del kwds[old_name]\n--> 651 return func(*args, **kwds)\n\nFile /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1410, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()\n   1408         raise ValueError(\"unbounded or unexpected error\")\n   1409     else:\n-> 1410         raise ValueError(\"unbounded or unexpected error, try with 'integrality = True'\")\n   1411 \n   1412 taby = p.get_values(y, convert=bool, tolerance=integrality_tolerance)\n\nValueError: unbounded or unexpected error, try with 'integrality = True'\nsage: %time vertex_separation_MILP(G, solver=\"SCIP\", integrality=True)\nCPU times: user 845 ms, sys: 3.98 ms, total: 849 ms\nWall time: 851 ms\n(5, [7, 9, 8, 3, 6, 2, 5, 4, 1, 0])\n```\n\n\nSo we should:\n- allow to specify the solver in `pathwidth`\n- set parameter `integrality` to `True` by default in `vertex_separation_MILP`\n- add a dockets with the Petersen graph  marked `# optional - pyscipopt` (too long for glpk)",
    "created_at": "2022-12-01T10:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286872",
    "user": "dcoudert"
}
```

While searching for an example, I found an issue:
- in method `G.pathwidth`, we can specify lgorithm="MILP"` but not the solver
- in method `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation` we can not set parameter `integrality=True` that is used in `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP`. It is currently set to `False`. The problem is that with `SCIP`, I get an error when set to `False` and the correct answer when `True`.


```
sage: from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP
sage: G = graphs.PetersenGraph()
sage: %time vertex_separation_MILP(G, solver="GLPK")
CPU times: user 10.2 s, sys: 2.96 ms, total: 10.2 s
Wall time: 10.3 s
(5, [1, 2, 4, 9, 7, 0, 5, 6, 3, 8])
sage: %time vertex_separation_MILP(G, solver="SCIP")
---------------------------------------------------------------------------
MIPSolverException                        Traceback (most recent call last)
File /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1405, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()
   1404 try:
-> 1405     obj = p.solve(log=verbose)
   1406 except MIPSolverException:

File /home/dcoudert/sage/src/sage/numerical/mip.pyx:2559, in sage.numerical.mip.MixedIntegerLinearProgram.solve()
   2558 if log is not None: self._backend.set_verbosity(log)
-> 2559 self._backend.solve()
   2560 return self._backend.get_objective_value()

File /home/dcoudert/sage/src/sage/numerical/backends/scip_backend.pyx:632, in sage.numerical.backends.scip_backend.SCIPBackend.solve()
    631 elif status=='infeasible':
--> 632     raise MIPSolverException("SCIP : There is no feasible solution")
    633 #elif status=='timelimit':

MIPSolverException: SCIP : There is no feasible solution

During handling of the above exception, another exception occurred:

ValueError                                Traceback (most recent call last)
File <timed eval>:1

File /home/dcoudert/sage/src/sage/misc/decorators.py:651, in rename_keyword.__call__.<locals>.wrapper(*args, **kwds)
    649         kwds[new_name] = kwds[old_name]
    650         del kwds[old_name]
--> 651 return func(*args, **kwds)

File /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1410, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()
   1408         raise ValueError("unbounded or unexpected error")
   1409     else:
-> 1410         raise ValueError("unbounded or unexpected error, try with 'integrality = True'")
   1411 
   1412 taby = p.get_values(y, convert=bool, tolerance=integrality_tolerance)

ValueError: unbounded or unexpected error, try with 'integrality = True'
sage: %time vertex_separation_MILP(G, solver="SCIP", integrality=True)
CPU times: user 845 ms, sys: 3.98 ms, total: 849 ms
Wall time: 851 ms
(5, [7, 9, 8, 3, 6, 2, 5, 4, 1, 0])
```


So we should:
- allow to specify the solver in `pathwidth`
- set parameter `integrality` to `True` by default in `vertex_separation_MILP`
- add a dockets with the Petersen graph  marked `# optional - pyscipopt` (too long for glpk)



---

archive/issue_comments_286873.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-01T19:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286873",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286874.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-01T20:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286874",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286875.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-12-01T22:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286875",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286876.json:
```json
{
    "body": "Turns out that all uses of `self.model.getVars()` are broken - this functions does not return variables in the order of their indices.",
    "created_at": "2022-12-01T22:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286876",
    "user": "mkoeppe"
}
```

Turns out that all uses of `self.model.getVars()` are broken - this functions does not return variables in the order of their indices.



---

archive/issue_comments_286877.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-01T22:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286877",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-02T01:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286878",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-02T03:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286880.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-12-02T03:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286880",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286881.json:
```json
{
    "body": "This is working well on fedora 35 and macOS M1, and it is much faster than `GLPK`.\nFor me this is OK.\n\nI have not checked if we can have homebrew install of some parts.",
    "created_at": "2022-12-03T23:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286881",
    "user": "dcoudert"
}
```

This is working well on fedora 35 and macOS M1, and it is much faster than `GLPK`.
For me this is OK.

I have not checked if we can have homebrew install of some parts.



---

archive/issue_comments_286882.json:
```json
{
    "body": "Thanks for testing!\n\nI've tested it here with onetbb installed from homebrew.",
    "created_at": "2022-12-03T23:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286882",
    "user": "mkoeppe"
}
```

Thanks for testing!

I've tested it here with onetbb installed from homebrew.



---

archive/issue_comments_286883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-03T23:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286883",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286884.json:
```json
{
    "body": "For me this is good to go, so I'm setting this ticket to positive review.",
    "created_at": "2022-12-04T11:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286884",
    "user": "dcoudert"
}
```

For me this is good to go, so I'm setting this ticket to positive review.



---

archive/issue_comments_286885.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-04T11:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286885",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286886.json:
```json
{
    "body": "Thank you! \n\nDependency tickets #34726, #34742, #31329 also need review",
    "created_at": "2022-12-04T21:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286886",
    "user": "mkoeppe"
}
```

Thank you! 

Dependency tickets #34726, #34742, #31329 also need review



---

archive/issue_comments_286887.json:
```json
{
    "body": "The patchbot reports block errors when building the doc of `src/sage/numerical/backends/scip_backend.pyx`. Furthermore, this file has some pycodestyle issues such as 80 columns alignements, use of `Returns` instead of `Return`, ...\n\n\n```\nFor explanations on these warnings, see the wiki.\n========== blocks ==========\ngit checkout patchbot/ticket_merged\nAlready on 'patchbot/ticket_merged'\ninside file:  b/src/sage/numerical/backends/scip_backend.pyx\n@@ -0,0 +1,1185 @@\n+        - ``vtype`` (integer) :\n+        - ``sense`` (integer) :\ninside file:  b/src/sage/numerical/backends/scip_backend.pyx\n@@ -0,0 +1,1185 @@\n+        Returns the value of the objective function.\n+        Returns the value of a variable given by the solver.\n+        Returns the value of the auxiliary variable associated with i-th row.\n+        Returns a copy of self.\nwrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines\nTraceback (most recent call last):\n  File \"/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/patchbot.py\", line 1087, in test_a_ticket\n    res = plugin(ticket, baseline=baseline, **kwds)\n  File \"/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py\", line 609, in blocks\n    exclude_new(ticket, regex=regexps,\n  File \"/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py\", line 405, in exclude_new\n    raise ValueError(full_msg)\nValueError: wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines\nblocks -- 0 seconds\n========== end blocks ==========\n```\n",
    "created_at": "2022-12-17T10:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286887",
    "user": "dcoudert"
}
```

The patchbot reports block errors when building the doc of `src/sage/numerical/backends/scip_backend.pyx`. Furthermore, this file has some pycodestyle issues such as 80 columns alignements, use of `Returns` instead of `Return`, ...


```
For explanations on these warnings, see the wiki.
========== blocks ==========
git checkout patchbot/ticket_merged
Already on 'patchbot/ticket_merged'
inside file:  b/src/sage/numerical/backends/scip_backend.pyx
@@ -0,0 +1,1185 @@
+        - ``vtype`` (integer) :
+        - ``sense`` (integer) :
inside file:  b/src/sage/numerical/backends/scip_backend.pyx
@@ -0,0 +1,1185 @@
+        Returns the value of the objective function.
+        Returns the value of a variable given by the solver.
+        Returns the value of the auxiliary variable associated with i-th row.
+        Returns a copy of self.
wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines
Traceback (most recent call last):
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/patchbot.py", line 1087, in test_a_ticket
    res = plugin(ticket, baseline=baseline, **kwds)
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py", line 609, in blocks
    exclude_new(ticket, regex=regexps,
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py", line 405, in exclude_new
    raise ValueError(full_msg)
ValueError: wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines
blocks -- 0 seconds
========== end blocks ==========
```




---

archive/issue_comments_286888.json:
```json
{
    "body": "I only see irrelevant to this ticket lint reports:\n\n```\nRun tox -e pycodestyle-minimal\npycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/.tox/src\npycodestyle-minimal run-test-pre: PYTHONHASHSEED='1886447434'\npycodestyle-minimal run-test: commands[0] | tox -c /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/tox.ini -e pycodestyle-minimal --\npycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal\npycodestyle-minimal installdeps: pycodestyle\npycodestyle-minimal installed: pycodestyle==2.10.0\npycodestyle-minimal run-test-pre: PYTHONHASHSEED='4154509342'\npycodestyle-minimal run-test: commands[0] | pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/sage/\nsage/rings/lazy_series_ring.py:1546:9: E306 expected 1 blank line before a nested definition, found 0\nsage/combinat/diagram.py:1471:1: W391 blank line at end of file\nsage/combinat/skew_partition.py:1970:1: W391 blank line at end of file\nsage/algebras/all.py:68:1: W391 blank line at end of file\nsage/algebras/fusion_rings/all.py:20:1: W391 blank line at end of file\nsage/algebras/fusion_rings/f_matrix.py:2460:1: W391 blank line at end of file\nsage/algebras/fusion_rings/fusion_ring.py:1575:1: W391 blank line at end of file\n1       E306 expected 1 blank line before a nested definition, found 0\n6       W391 blank line at end of file\nERROR: InvocationError for command /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal/bin/pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 sage (exited with code 1)\n___________________________________ summary ____________________________________\nERROR:   pycodestyle-minimal: commands failed\nERROR: InvocationError for command /opt/hostedtoolcache/Python/3.8.14/x64/bin/tox -c src/tox.ini -e pycodestyle-minimal --",
    "created_at": "2022-12-17T12:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286888",
    "user": "dimpase"
}
```

I only see irrelevant to this ticket lint reports:

```
Run tox -e pycodestyle-minimal
pycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/.tox/src
pycodestyle-minimal run-test-pre: PYTHONHASHSEED='1886447434'
pycodestyle-minimal run-test: commands[0] | tox -c /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/tox.ini -e pycodestyle-minimal --
pycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal
pycodestyle-minimal installdeps: pycodestyle
pycodestyle-minimal installed: pycodestyle==2.10.0
pycodestyle-minimal run-test-pre: PYTHONHASHSEED='4154509342'
pycodestyle-minimal run-test: commands[0] | pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/sage/
sage/rings/lazy_series_ring.py:1546:9: E306 expected 1 blank line before a nested definition, found 0
sage/combinat/diagram.py:1471:1: W391 blank line at end of file
sage/combinat/skew_partition.py:1970:1: W391 blank line at end of file
sage/algebras/all.py:68:1: W391 blank line at end of file
sage/algebras/fusion_rings/all.py:20:1: W391 blank line at end of file
sage/algebras/fusion_rings/f_matrix.py:2460:1: W391 blank line at end of file
sage/algebras/fusion_rings/fusion_ring.py:1575:1: W391 blank line at end of file
1       E306 expected 1 blank line before a nested definition, found 0
6       W391 blank line at end of file
ERROR: InvocationError for command /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal/bin/pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 sage (exited with code 1)
___________________________________ summary ____________________________________
ERROR:   pycodestyle-minimal: commands failed
ERROR: InvocationError for command /opt/hostedtoolcache/Python/3.8.14/x64/bin/tox -c src/tox.ini -e pycodestyle-minimal --



---

archive/issue_comments_286889.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-12-17T20:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286889",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_286890.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-12-17T20:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286890",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_286891.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-17T20:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286891",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286892.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-12-23T19:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286892",
    "user": "mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_286893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-23T19:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286893",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286894.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-12-23T19:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286894",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286895.json:
```json
{
    "body": "I checked why copying is so incredibly slow (see #33238).  Apparently, almost all of the time is spent in preparing the arguments for `add_linear_constraint`, more precisely, in `self.model.getConss()[index]`.  Indeed, calling `row_bounds` only once saves a quarter of the time.  \nI have not found the definition of `self.model.getConss()` yet, but perhaps that there is some copying going on?\n\nHere is the necessary modification to the backend:\n\n```diff\ndiff --git a/src/sage/numerical/backends/scip_backend.pyx b/src/sage/numerical/backends/scip_backend.pyx\nindex d063d012b98..9f184355918 100644\n--- a/src/sage/numerical/backends/scip_backend.pyx\n+++ b/src/sage/numerical/backends/scip_backend.pyx\n@@ -1,3 +1,7 @@\n+# cython: profile=True\n+# cython: linetrace=True\n+# cython: binding=True\n+# distutils: define_macros=CYTHON_TRACE_NOGIL=1\n # distutils: language = c++\n # sage.doctest: optional - pyscipopt\n \"\"\"\n@@ -1148,7 +1152,7 @@ cdef class SCIPBackend(GenericBackend):\n         cdef SCIPBackend cp = type(self)(maximization=self.is_maximization())\n         cp.problem_name(self.problem_name())\n         for i, v in enumerate(self.variables):\n-            vtype = v.vtype\n+            vtype = v.vtype()\n             cp.add_variable(self.variable_lower_bound(i),\n                             self.variable_upper_bound(i),\n                             binary=vtype == 'BINARY',\n@@ -1159,13 +1163,19 @@ cdef class SCIPBackend(GenericBackend):\n         assert self.ncols() == cp.ncols()\n \n         for i in range(self.nrows()):\n-            cp.add_linear_constraint(zip(*self.row(i)),\n-                                     self.row_bounds(i)[0],\n-                                     self.row_bounds(i)[1],\n-                                     name=self.row_name(i))\n+            coefficients = zip(*self.row(i))\n+            lower_bound, upper_bound = self.row_bounds(i)\n+            name = self.row_name(i)\n+            cp.add_linear_constraint(coefficients,\n+                                     lower_bound,\n+                                     upper_bound,\n+                                     name=name)\n         assert self.nrows() == cp.nrows()\n         return cp\n```\n\nhere is the code I run:\n\n```\nsage: As = Bs = [[],\n....:            [(1,i,j) for i in [-1,0,1] for j in [-1,1]],\n....:            [(2,i,j) for i in [-1,0,1] for j in [-1,1]],\n....:            [(3,i,j) for i in [-2,-1,0,1,2] for j in [-1,1]]]\nsage: c1 = lambda a, b: (a[0]+b[0], a[1]*b[1], a[2]*b[2])\nsage: c2 = lambda a: (a[0], -a[1], a[2])\nsage: bij = Bijectionist(sum(As, []), sum(Bs, []), solver=\"scip\")\nsage: bij.set_statistics((lambda x: x[0], lambda x: x[0]))\nsage: bij.set_intertwining_relations((2, c1, c1), (1, c2, c2))\nsage: bmilp = bij._initialize_new_bmilp()\n```\n\nand here is the output:\n\n```\nsage: %lprun -f sage.numerical.backends.scip_backend.SCIPBackend.__copy__ copy(bmilp.milp)\n\nTimer unit: 1e-06 s\n\nTotal time: 18.5058 s\n\nCould not find file sage/numerical/backends/scip_backend.pyx\nAre you sure you are running this program from the same directory\nthat you ran the profiler from?\nContinuing without the function's contents.\n\nLine #      Hits         Time  Per Hit   % Time  Line Contents\n==============================================================\n  1138                                           \n  1139                                           \n  1140                                           \n  1141                                           \n  1142                                           \n  1143                                           \n  1144                                           \n  1145                                           \n  1146                                           \n  1147                                           \n  1148                                           \n  1149                                           \n  1150                                           \n  1151                                           \n  1152         1       1559.0   1559.0      0.0  \n  1153         1          9.0      9.0      0.0  \n  1154       173         99.0      0.6      0.0  \n  1155       172        108.0      0.6      0.0  \n  1156       344       2473.0      7.2      0.0  \n  1157       172        270.0      1.6      0.0  \n  1158       172         76.0      0.4      0.0  \n  1159       172         65.0      0.4      0.0  \n  1160       172         62.0      0.4      0.0  \n  1161       172        231.0      1.3      0.0  \n  1162       172        214.0      1.2      0.0  \n  1163         1          1.0      1.0      0.0  \n  1164                                           \n  1165      4093       3722.0      0.9      0.0  \n  1166      4092    6189936.0   1512.7     33.4  \n  1167      4092    6019723.0   1471.1     32.5  \n  1168      4092    6032504.0   1474.2     32.6  \n  1169      4092     193583.0     47.3      1.0  \n  1170                                           \n  1171                                           \n  1172                                           \n  1173         1      61158.0  61158.0      0.3  \n  1174         1          5.0      5.0      0.0\n```\n",
    "created_at": "2022-12-23T20:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286895",
    "user": "mantepse"
}
```

I checked why copying is so incredibly slow (see #33238).  Apparently, almost all of the time is spent in preparing the arguments for `add_linear_constraint`, more precisely, in `self.model.getConss()[index]`.  Indeed, calling `row_bounds` only once saves a quarter of the time.  
I have not found the definition of `self.model.getConss()` yet, but perhaps that there is some copying going on?

Here is the necessary modification to the backend:

```diff
diff --git a/src/sage/numerical/backends/scip_backend.pyx b/src/sage/numerical/backends/scip_backend.pyx
index d063d012b98..9f184355918 100644
--- a/src/sage/numerical/backends/scip_backend.pyx
+++ b/src/sage/numerical/backends/scip_backend.pyx
@@ -1,3 +1,7 @@
+# cython: profile=True
+# cython: linetrace=True
+# cython: binding=True
+# distutils: define_macros=CYTHON_TRACE_NOGIL=1
 # distutils: language = c++
 # sage.doctest: optional - pyscipopt
 """
@@ -1148,7 +1152,7 @@ cdef class SCIPBackend(GenericBackend):
         cdef SCIPBackend cp = type(self)(maximization=self.is_maximization())
         cp.problem_name(self.problem_name())
         for i, v in enumerate(self.variables):
-            vtype = v.vtype
+            vtype = v.vtype()
             cp.add_variable(self.variable_lower_bound(i),
                             self.variable_upper_bound(i),
                             binary=vtype == 'BINARY',
@@ -1159,13 +1163,19 @@ cdef class SCIPBackend(GenericBackend):
         assert self.ncols() == cp.ncols()
 
         for i in range(self.nrows()):
-            cp.add_linear_constraint(zip(*self.row(i)),
-                                     self.row_bounds(i)[0],
-                                     self.row_bounds(i)[1],
-                                     name=self.row_name(i))
+            coefficients = zip(*self.row(i))
+            lower_bound, upper_bound = self.row_bounds(i)
+            name = self.row_name(i)
+            cp.add_linear_constraint(coefficients,
+                                     lower_bound,
+                                     upper_bound,
+                                     name=name)
         assert self.nrows() == cp.nrows()
         return cp
```

here is the code I run:

```
sage: As = Bs = [[],
....:            [(1,i,j) for i in [-1,0,1] for j in [-1,1]],
....:            [(2,i,j) for i in [-1,0,1] for j in [-1,1]],
....:            [(3,i,j) for i in [-2,-1,0,1,2] for j in [-1,1]]]
sage: c1 = lambda a, b: (a[0]+b[0], a[1]*b[1], a[2]*b[2])
sage: c2 = lambda a: (a[0], -a[1], a[2])
sage: bij = Bijectionist(sum(As, []), sum(Bs, []), solver="scip")
sage: bij.set_statistics((lambda x: x[0], lambda x: x[0]))
sage: bij.set_intertwining_relations((2, c1, c1), (1, c2, c2))
sage: bmilp = bij._initialize_new_bmilp()
```

and here is the output:

```
sage: %lprun -f sage.numerical.backends.scip_backend.SCIPBackend.__copy__ copy(bmilp.milp)

Timer unit: 1e-06 s

Total time: 18.5058 s

Could not find file sage/numerical/backends/scip_backend.pyx
Are you sure you are running this program from the same directory
that you ran the profiler from?
Continuing without the function's contents.

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
  1138                                           
  1139                                           
  1140                                           
  1141                                           
  1142                                           
  1143                                           
  1144                                           
  1145                                           
  1146                                           
  1147                                           
  1148                                           
  1149                                           
  1150                                           
  1151                                           
  1152         1       1559.0   1559.0      0.0  
  1153         1          9.0      9.0      0.0  
  1154       173         99.0      0.6      0.0  
  1155       172        108.0      0.6      0.0  
  1156       344       2473.0      7.2      0.0  
  1157       172        270.0      1.6      0.0  
  1158       172         76.0      0.4      0.0  
  1159       172         65.0      0.4      0.0  
  1160       172         62.0      0.4      0.0  
  1161       172        231.0      1.3      0.0  
  1162       172        214.0      1.2      0.0  
  1163         1          1.0      1.0      0.0  
  1164                                           
  1165      4093       3722.0      0.9      0.0  
  1166      4092    6189936.0   1512.7     33.4  
  1167      4092    6019723.0   1471.1     32.5  
  1168      4092    6032504.0   1474.2     32.6  
  1169      4092     193583.0     47.3      1.0  
  1170                                           
  1171                                           
  1172                                           
  1173         1      61158.0  61158.0      0.3  
  1174         1          5.0      5.0      0.0
```




---

archive/issue_comments_286896.json:
```json
{
    "body": "Replying to [comment:127 Martin Rubey]:\n> I have not found the definition of `self.model.getConss()` yet\n\nhttps://github.com/scipopt/PySCIPOpt/blob/46f8eb87f9f95af0f0b5187cc10ce2a4de3a0ef0/src/pyscipopt/scip.pyx#L3090",
    "created_at": "2022-12-23T20:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286896",
    "user": "mkoeppe"
}
```

Replying to [comment:127 Martin Rubey]:
> I have not found the definition of `self.model.getConss()` yet

https://github.com/scipopt/PySCIPOpt/blob/46f8eb87f9f95af0f0b5187cc10ce2a4de3a0ef0/src/pyscipopt/scip.pyx#L3090



---

archive/issue_comments_286897.json:
```json
{
    "body": "Indeed.\n\n```\n    def getConss(self):\n        \"\"\"Retrieve all constraints.\"\"\"\n        cdef SCIP_CONS** _conss\n        cdef int _nconss\n        conss = []\n\n        _conss = SCIPgetConss(self._scip)\n        _nconss = SCIPgetNConss(self._scip)\n        return [Constraint.create(_conss[i]) for i in range(_nconss)]\n```\n\nSo we are creating a list of 4100 constraints, pick one, throw the list away again.  We do this 4 (or at least 3) times per constraint, and for each of the 4100 constraints.",
    "created_at": "2022-12-23T20:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286897",
    "user": "mantepse"
}
```

Indeed.

```
    def getConss(self):
        """Retrieve all constraints."""
        cdef SCIP_CONS** _conss
        cdef int _nconss
        conss = []

        _conss = SCIPgetConss(self._scip)
        _nconss = SCIPgetNConss(self._scip)
        return [Constraint.create(_conss[i]) for i in range(_nconss)]
```

So we are creating a list of 4100 constraints, pick one, throw the list away again.  We do this 4 (or at least 3) times per constraint, and for each of the 4100 constraints.



---

archive/issue_comments_286898.json:
```json
{
    "body": "Maybe we can have something along the following lines:\n\n```\ndef constraints(self):\n    if self._constraints is None:\n        self._constraints = self.model.getConss()\n    return self._constraints\n```\n\nand do `self._constraints = None` in all methods that modify the array of constraints?",
    "created_at": "2022-12-23T20:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286898",
    "user": "mantepse"
}
```

Maybe we can have something along the following lines:

```
def constraints(self):
    if self._constraints is None:
        self._constraints = self.model.getConss()
    return self._constraints
```

and do `self._constraints = None` in all methods that modify the array of constraints?



---

archive/issue_comments_286899.json:
```json
{
    "body": "Sounds good",
    "created_at": "2022-12-23T20:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286899",
    "user": "mkoeppe"
}
```

Sounds good



---

archive/issue_comments_286900.json:
```json
{
    "body": "I hope that this is not too off topic here - please let me provide background on why I am copying MILPS:\n\nIn #33238, I need to solve a program with temporarily added constraints.  In principle, I see two options for doing this:\n\n1. copy the MILP, add the new constraints to the copy, solve, throw away the copy\n\n2. add the constraints, solve, remove the constraints\n\nCurrently, I am doing 1., because I am afraid that I cannot control what happens when adding a constraint.  In particular, a clever solver might detect that it is redundant, or an even more intelligent solver might rewrite the whole list of constraints.  Possibly I could check whether my new constraint wasn't added at all, but could a complete rewrite of a program happen in theory?",
    "created_at": "2022-12-23T20:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286900",
    "user": "mantepse"
}
```

I hope that this is not too off topic here - please let me provide background on why I am copying MILPS:

In #33238, I need to solve a program with temporarily added constraints.  In principle, I see two options for doing this:

1. copy the MILP, add the new constraints to the copy, solve, throw away the copy

2. add the constraints, solve, remove the constraints

Currently, I am doing 1., because I am afraid that I cannot control what happens when adding a constraint.  In particular, a clever solver might detect that it is redundant, or an even more intelligent solver might rewrite the whole list of constraints.  Possibly I could check whether my new constraint wasn't added at all, but could a complete rewrite of a program happen in theory?



---

archive/issue_comments_286901.json:
```json
{
    "body": "Replying to [comment:132 Martin Rubey]:\n> In #33238, I need to solve a program with temporarily added constraints.  In principle, I see two options for doing this:\n> \n> 1. copy the MILP, add the new constraints to the copy, solve, throw away the copy\n> \n> 2. add the constraints, solve, remove the constraints\n> \n> Currently, I am doing 1., because I am afraid that I cannot control what happens when adding a constraint.\n\nRemoving constraints is supported by our frontend and backend interfaces and by the SCIP API.\n\n> In particular, a clever solver might detect that it is redundant, or an even more intelligent solver might rewrite the whole list of constraints.\n\nThere's no need to worry about this. Working with dynamically modified models is a very typical operation in IP solvers, that includes delete constraints. See `SCIPdelCons` https://github.com/scipopt/PySCIPOpt/blob/master/src/pyscipopt/scip.pyx#L3104",
    "created_at": "2022-12-23T20:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286901",
    "user": "mkoeppe"
}
```

Replying to [comment:132 Martin Rubey]:
> In #33238, I need to solve a program with temporarily added constraints.  In principle, I see two options for doing this:
> 
> 1. copy the MILP, add the new constraints to the copy, solve, throw away the copy
> 
> 2. add the constraints, solve, remove the constraints
> 
> Currently, I am doing 1., because I am afraid that I cannot control what happens when adding a constraint.

Removing constraints is supported by our frontend and backend interfaces and by the SCIP API.

> In particular, a clever solver might detect that it is redundant, or an even more intelligent solver might rewrite the whole list of constraints.

There's no need to worry about this. Working with dynamically modified models is a very typical operation in IP solvers, that includes delete constraints. See `SCIPdelCons` https://github.com/scipopt/PySCIPOpt/blob/master/src/pyscipopt/scip.pyx#L3104



---

archive/issue_comments_286902.json:
```json
{
    "body": "Are you saying that it is *very* hard to imagine a solver that rewrites the constraints upon solving?\n\nI would prefer that my code works generically, and not just specifically for SCIP.\n\nAlso, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.",
    "created_at": "2022-12-23T21:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286902",
    "user": "mantepse"
}
```

Are you saying that it is *very* hard to imagine a solver that rewrites the constraints upon solving?

I would prefer that my code works generically, and not just specifically for SCIP.

Also, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.



---

archive/issue_comments_286903.json:
```json
{
    "body": "Solvers do this kind of rewriting internally but do not expose it to the user. The API functions are there to be actually used.",
    "created_at": "2022-12-23T21:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286903",
    "user": "mkoeppe"
}
```

Solvers do this kind of rewriting internally but do not expose it to the user. The API functions are there to be actually used.



---

archive/issue_comments_286904.json:
```json
{
    "body": "Replying to [comment:134 Martin Rubey]:\n> Also, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.\n\nYes, that's a valid concern. Our MIP frontend and backend interfaces are unfortunately underdeveloped and underdocumented. While the backend method `add_variable` returns a backend variable index, the method `add_linear_constraint` does not return anything, which leaves the user to make assumptions about constraint indices in methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.",
    "created_at": "2022-12-23T21:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286904",
    "user": "mkoeppe"
}
```

Replying to [comment:134 Martin Rubey]:
> Also, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.

Yes, that's a valid concern. Our MIP frontend and backend interfaces are unfortunately underdeveloped and underdocumented. While the backend method `add_variable` returns a backend variable index, the method `add_linear_constraint` does not return anything, which leaves the user to make assumptions about constraint indices in methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.



---

archive/issue_comments_286905.json:
```json
{
    "body": "That said, it's OK to assume that the constraint is added at the end.",
    "created_at": "2022-12-23T21:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286905",
    "user": "mkoeppe"
}
```

That said, it's OK to assume that the constraint is added at the end.



---

archive/issue_comments_286906.json:
```json
{
    "body": "different solvers do it differently. Some are doing some kind of postprocessing, and so the problem as held by the backend might be different (but equivalent)",
    "created_at": "2022-12-23T21:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286906",
    "user": "dimpase"
}
```

different solvers do it differently. Some are doing some kind of postprocessing, and so the problem as held by the backend might be different (but equivalent)



---

archive/issue_comments_286907.json:
```json
{
    "body": "Here is a patch.  With this patch SCIP does the problem in roughly 2/3 of the time, which is quite OK.  I don't have gurobi installed right now.\n\nCould you please check and commit it - provided it is OK - on my behalf?\n\n\n```diff\ndiff --git a/src/sage/numerical/backends/scip_backend.pxd b/src/sage/numerical/backends/scip_backend.pxd\nindex b919fe4c223..dc4981a89c3 100644\n--- a/src/sage/numerical/backends/scip_backend.pxd\n+++ b/src/sage/numerical/backends/scip_backend.pxd\n@@ -14,6 +14,7 @@ cdef class SCIPBackend(GenericBackend):\n \n     cdef model\n     cdef object variables\n+    cdef object constraints\n \n     cpdef _get_model(self)\n     cpdef get_row_prim(self, int i)\ndiff --git a/src/sage/numerical/backends/scip_backend.pyx b/src/sage/numerical/backends/scip_backend.pyx\nindex d063d012b98..b2ecf0f923b 100644\n--- a/src/sage/numerical/backends/scip_backend.pyx\n+++ b/src/sage/numerical/backends/scip_backend.pyx\n@@ -60,6 +60,16 @@ cdef class SCIPBackend(GenericBackend):\n         self.obj_constant_term = 0.0\n         self.variables = []\n         self.model.hideOutput()\n+        # always set this to None if the list of constraints may change\n+        self.constraints = None\n+\n+    def get_constraints(self):\n+        \"\"\"\n+        Get all constraints of the problem.\n+        \"\"\"\n+        if self.constraints is None:\n+            self.constraints = self.model.getConss()\n+        return self.constraints\n \n     cpdef _get_model(self):\n         \"\"\"\n@@ -360,7 +370,9 @@ cdef class SCIPBackend(GenericBackend):\n             raise ValueError(\"The constraint's index i must satisfy 0 <= i < number_of_constraints\")\n         if self.model.getStatus() != 'unknown':\n             self.model.freeTransform()\n-        self.model.delCons(self.model.getConss()[i])\n+            self.constraints = None\n+        self.model.delCons(self.get_constraints()[i])\n+        self.constraints = None\n \n     cpdef add_linear_constraint(self, coefficients, lower_bound, upper_bound, name=None):\n         \"\"\"\n@@ -408,6 +420,7 @@ cdef class SCIPBackend(GenericBackend):\n \n         cons = lower_bound <= (linfun <= upper_bound)\n         self.model.addCons(cons, name=name)\n+        self.constraints = None\n \n     cpdef row(self, int index):\n         r\"\"\"\n@@ -438,7 +451,7 @@ cdef class SCIPBackend(GenericBackend):\n             (2.0, 2.0)\n         \"\"\"\n         namedvars = [var.name for var in self.variables]\n-        valslinear = self.model.getValsLinear(self.model.getConss()[index])\n+        valslinear = self.model.getValsLinear(self.get_constraints()[index])\n         cdef list indices = []\n         cdef list values = []\n         for var, coeff in valslinear.iteritems():\n@@ -470,7 +483,7 @@ cdef class SCIPBackend(GenericBackend):\n             sage: p.row_bounds(0)\n             (2.0, 2.0)\n         \"\"\"\n-        cons = self.model.getConss()[index]\n+        cons = self.get_constraints()[index]\n         lhs = self.model.getLhs(cons)\n         rhs = self.model.getRhs(cons)\n         if lhs == -self.model.infinity():\n@@ -548,7 +561,8 @@ cdef class SCIPBackend(GenericBackend):\n             sage: p.nrows()\n             5\n         \"\"\"\n-        mcons = self.model.getConss()\n+        mcons = self.get_constraints()\n+        self.constraints = None  # is this necessary?\n         # after update of\n         index = self.add_variable(lower_bound=-self.model.infinity())\n         var = self.variables[index]\n@@ -770,7 +784,7 @@ cdef class SCIPBackend(GenericBackend):\n             sage: lp.get_row_prim(2)\n             8.0\n         \"\"\"\n-        return self.model.getActivity(self.model.getConss()[i])\n+        return self.model.getActivity(self.get_constraints()[i])\n \n     cpdef int ncols(self):\n         \"\"\"\n@@ -803,7 +817,7 @@ cdef class SCIPBackend(GenericBackend):\n             sage: p.nrows()\n             2\n         \"\"\"\n-        return len(self.model.getConss())\n+        return len(self.get_constraints())\n \n     cpdef col_name(self, int index):\n         \"\"\"\n@@ -840,7 +854,7 @@ cdef class SCIPBackend(GenericBackend):\n             sage: p.row_name(0)\n             'Empty constraint 1'\n         \"\"\"\n-        return self.model.getConss()[index].name\n+        return self.get_constraints()[index].name\n \n     cpdef bint is_variable_binary(self, int index):\n         \"\"\"\n@@ -1148,7 +1162,7 @@ cdef class SCIPBackend(GenericBackend):\n         cdef SCIPBackend cp = type(self)(maximization=self.is_maximization())\n         cp.problem_name(self.problem_name())\n         for i, v in enumerate(self.variables):\n-            vtype = v.vtype\n+            vtype = v.vtype()\n             cp.add_variable(self.variable_lower_bound(i),\n                             self.variable_upper_bound(i),\n                             binary=vtype == 'BINARY',\n@@ -1159,10 +1173,13 @@ cdef class SCIPBackend(GenericBackend):\n         assert self.ncols() == cp.ncols()\n \n         for i in range(self.nrows()):\n-            cp.add_linear_constraint(zip(*self.row(i)),\n-                                     self.row_bounds(i)[0],\n-                                     self.row_bounds(i)[1],\n-                                     name=self.row_name(i))\n+            coefficients = zip(*self.row(i))\n+            lower_bound, upper_bound = self.row_bounds(i)\n+            name = self.row_name(i)\n+            cp.add_linear_constraint(coefficients,\n+                                     lower_bound,\n+                                     upper_bound,\n+                                     name=name)\n         assert self.nrows() == cp.nrows()\n         return cp\n```\n",
    "created_at": "2022-12-23T21:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286907",
    "user": "mantepse"
}
```

Here is a patch.  With this patch SCIP does the problem in roughly 2/3 of the time, which is quite OK.  I don't have gurobi installed right now.

Could you please check and commit it - provided it is OK - on my behalf?


```diff
diff --git a/src/sage/numerical/backends/scip_backend.pxd b/src/sage/numerical/backends/scip_backend.pxd
index b919fe4c223..dc4981a89c3 100644
--- a/src/sage/numerical/backends/scip_backend.pxd
+++ b/src/sage/numerical/backends/scip_backend.pxd
@@ -14,6 +14,7 @@ cdef class SCIPBackend(GenericBackend):
 
     cdef model
     cdef object variables
+    cdef object constraints
 
     cpdef _get_model(self)
     cpdef get_row_prim(self, int i)
diff --git a/src/sage/numerical/backends/scip_backend.pyx b/src/sage/numerical/backends/scip_backend.pyx
index d063d012b98..b2ecf0f923b 100644
--- a/src/sage/numerical/backends/scip_backend.pyx
+++ b/src/sage/numerical/backends/scip_backend.pyx
@@ -60,6 +60,16 @@ cdef class SCIPBackend(GenericBackend):
         self.obj_constant_term = 0.0
         self.variables = []
         self.model.hideOutput()
+        # always set this to None if the list of constraints may change
+        self.constraints = None
+
+    def get_constraints(self):
+        """
+        Get all constraints of the problem.
+        """
+        if self.constraints is None:
+            self.constraints = self.model.getConss()
+        return self.constraints
 
     cpdef _get_model(self):
         """
@@ -360,7 +370,9 @@ cdef class SCIPBackend(GenericBackend):
             raise ValueError("The constraint's index i must satisfy 0 <= i < number_of_constraints")
         if self.model.getStatus() != 'unknown':
             self.model.freeTransform()
-        self.model.delCons(self.model.getConss()[i])
+            self.constraints = None
+        self.model.delCons(self.get_constraints()[i])
+        self.constraints = None
 
     cpdef add_linear_constraint(self, coefficients, lower_bound, upper_bound, name=None):
         """
@@ -408,6 +420,7 @@ cdef class SCIPBackend(GenericBackend):
 
         cons = lower_bound <= (linfun <= upper_bound)
         self.model.addCons(cons, name=name)
+        self.constraints = None
 
     cpdef row(self, int index):
         r"""
@@ -438,7 +451,7 @@ cdef class SCIPBackend(GenericBackend):
             (2.0, 2.0)
         """
         namedvars = [var.name for var in self.variables]
-        valslinear = self.model.getValsLinear(self.model.getConss()[index])
+        valslinear = self.model.getValsLinear(self.get_constraints()[index])
         cdef list indices = []
         cdef list values = []
         for var, coeff in valslinear.iteritems():
@@ -470,7 +483,7 @@ cdef class SCIPBackend(GenericBackend):
             sage: p.row_bounds(0)
             (2.0, 2.0)
         """
-        cons = self.model.getConss()[index]
+        cons = self.get_constraints()[index]
         lhs = self.model.getLhs(cons)
         rhs = self.model.getRhs(cons)
         if lhs == -self.model.infinity():
@@ -548,7 +561,8 @@ cdef class SCIPBackend(GenericBackend):
             sage: p.nrows()
             5
         """
-        mcons = self.model.getConss()
+        mcons = self.get_constraints()
+        self.constraints = None  # is this necessary?
         # after update of
         index = self.add_variable(lower_bound=-self.model.infinity())
         var = self.variables[index]
@@ -770,7 +784,7 @@ cdef class SCIPBackend(GenericBackend):
             sage: lp.get_row_prim(2)
             8.0
         """
-        return self.model.getActivity(self.model.getConss()[i])
+        return self.model.getActivity(self.get_constraints()[i])
 
     cpdef int ncols(self):
         """
@@ -803,7 +817,7 @@ cdef class SCIPBackend(GenericBackend):
             sage: p.nrows()
             2
         """
-        return len(self.model.getConss())
+        return len(self.get_constraints())
 
     cpdef col_name(self, int index):
         """
@@ -840,7 +854,7 @@ cdef class SCIPBackend(GenericBackend):
             sage: p.row_name(0)
             'Empty constraint 1'
         """
-        return self.model.getConss()[index].name
+        return self.get_constraints()[index].name
 
     cpdef bint is_variable_binary(self, int index):
         """
@@ -1148,7 +1162,7 @@ cdef class SCIPBackend(GenericBackend):
         cdef SCIPBackend cp = type(self)(maximization=self.is_maximization())
         cp.problem_name(self.problem_name())
         for i, v in enumerate(self.variables):
-            vtype = v.vtype
+            vtype = v.vtype()
             cp.add_variable(self.variable_lower_bound(i),
                             self.variable_upper_bound(i),
                             binary=vtype == 'BINARY',
@@ -1159,10 +1173,13 @@ cdef class SCIPBackend(GenericBackend):
         assert self.ncols() == cp.ncols()
 
         for i in range(self.nrows()):
-            cp.add_linear_constraint(zip(*self.row(i)),
-                                     self.row_bounds(i)[0],
-                                     self.row_bounds(i)[1],
-                                     name=self.row_name(i))
+            coefficients = zip(*self.row(i))
+            lower_bound, upper_bound = self.row_bounds(i)
+            name = self.row_name(i)
+            cp.add_linear_constraint(coefficients,
+                                     lower_bound,
+                                     upper_bound,
+                                     name=name)
         assert self.nrows() == cp.nrows()
         return cp
```




---

archive/issue_comments_286908.json:
```json
{
    "body": "It might indeed be faster to add and remove constraints, because I am doing a lot of this.  However, comment:138 seems to contradict comment:137 and comment:135.\n\nSo maybe we could have some kind of flag telling us whether a solver does rewrite constraints or not?",
    "created_at": "2022-12-23T21:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286908",
    "user": "mantepse"
}
```

It might indeed be faster to add and remove constraints, because I am doing a lot of this.  However, comment:138 seems to contradict comment:137 and comment:135.

So maybe we could have some kind of flag telling us whether a solver does rewrite constraints or not?



---

archive/issue_comments_286909.json:
```json
{
    "body": "I recommend that in your code you wrap your use of `add_constraint` with a check that exactly one constraint is added - just to document this assumption (which you are allowed to make).",
    "created_at": "2022-12-23T21:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286909",
    "user": "mkoeppe"
}
```

I recommend that in your code you wrap your use of `add_constraint` with a check that exactly one constraint is added - just to document this assumption (which you are allowed to make).



---

archive/issue_comments_286910.json:
```json
{
    "body": "Also, `__copy__` can likely be improved by using `Model(sourceModel=...)` instead of manually transferring variables and constraints - see https://github.com/scipopt/PySCIPOpt/blob/master/src/pyscipopt/scip.pyx#L939",
    "created_at": "2022-12-23T21:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286910",
    "user": "mkoeppe"
}
```

Also, `__copy__` can likely be improved by using `Model(sourceModel=...)` instead of manually transferring variables and constraints - see https://github.com/scipopt/PySCIPOpt/blob/master/src/pyscipopt/scip.pyx#L939



---

archive/issue_comments_286911.json:
```json
{
    "body": "Well, there is another thing with adding and removing: removing will - with the patch above - unnecessarily recompute the list of constraints again.  If I additionally check that adding the constraint also increases the number of constraints by one, then I have this overhead twice.\n\nIt's a bit strange that the backend needs the constraint to remove it, whereas in sage we need the index.\n\nThat said, replacing copy with adding/removing constraints makes a HUGE difference for this problem, roughly a factor of 8!\n\nI won't be able to improve `__copy__` right now, but I'd appreciate improvements.",
    "created_at": "2022-12-23T22:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286911",
    "user": "mantepse"
}
```

Well, there is another thing with adding and removing: removing will - with the patch above - unnecessarily recompute the list of constraints again.  If I additionally check that adding the constraint also increases the number of constraints by one, then I have this overhead twice.

It's a bit strange that the backend needs the constraint to remove it, whereas in sage we need the index.

That said, replacing copy with adding/removing constraints makes a HUGE difference for this problem, roughly a factor of 8!

I won't be able to improve `__copy__` right now, but I'd appreciate improvements.



---

archive/issue_comments_286912.json:
```json
{
    "body": "Replying to [comment:136 Matthias K\u00f6ppe]:\n> Replying to [comment:134 Martin Rubey]:\n> > Also, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.\n> \n> Yes, that's a valid concern. Our MIP frontend and backend interfaces are unfortunately underdeveloped and underdocumented. While the backend method `add_variable` returns a backend variable index, the method `add_linear_constraint` does not return anything, which leaves the user to make assumptions about constraint indices in methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.\n\nI've opened #34878 for an API improvement",
    "created_at": "2022-12-23T22:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20766#issuecomment-286912",
    "user": "mkoeppe"
}
```

Replying to [comment:136 Matthias Kppe]:
> Replying to [comment:134 Martin Rubey]:
> > Also, I don't really have any means to identify a constraint, except by index.  I admit it may be silly, but in principle I do not even know whether my solver adds a constraint at the beginning or at the end.
> 
> Yes, that's a valid concern. Our MIP frontend and backend interfaces are unfortunately underdeveloped and underdocumented. While the backend method `add_variable` returns a backend variable index, the method `add_linear_constraint` does not return anything, which leaves the user to make assumptions about constraint indices in methods that take row indices as input, such as `row`, `row_bounds`, `remove_constraint`.

I've opened #34878 for an API improvement
