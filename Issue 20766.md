# Issue 20766: Add SCIP backend using PySCIPOpt

Issue created by migration from https://trac.sagemath.org/ticket/21003

Original creator: mkoeppe

Original creation time: 2016-07-11 19:11:53

CC:  moritz yzh malb dcoudert dimpase

Keywords: lp

http://scip.zib.de/doc/html/PYTHON_INTERFACE.php


---

Comment by git created at 2016-07-31 23:54:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-15 02:16:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-03-05 13:19:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-03-07 14:25:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-03-07 21:13:51

Changing keywords from "lp" to "lp, days84".


---

Comment by git created at 2017-03-17 05:42:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-03-19 21:08:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by moritz created at 2018-04-05 21:54:04

This (hopefully) works now, after putting PySCIPOpt-1.4.0.tar.gz into upstream, which can be found here:

https://pypi.python.org/packages/59/73/087bcb1d4e284681346a8847b83c5a86568dd19034ead0884450fa6bda50/PySCIPOpt-1.4.0.tar.gz#md5=6d40750e286348247e31e568bf16ee2d

*UPDATE* (from a later edit): now you need to put PySCIPOpt-1.4.2.tar.gz
https://pypi.python.org/packages/c0/b6/b619a33cd90dbf5579de341c873f85f0388030c47ee5da71a9113ee308d4/PySCIPOpt-1.4.2.tar.gz#md5=4f175316bc3ba4ce97c284434a4b62f0

*UPDATE* (from yet a later edit): Check the description of the ticket for the latest version!
----
Last 10 new commits:


---

Comment by git created at 2018-04-05 21:55:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-05 22:07:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-07 16:38:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-04-08 20:14:01

Changing keywords from "lp, days84" to "lp, days84, IMA-PolyGeom".


---

Comment by git created at 2018-04-09 14:43:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-11 15:29:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2018-04-11 15:32:11

In this version, there are a number of patches in the `patches` directory. All of them will be merged upstream in a version of pyscipopt with version number >=1.4.3, which should be available on Pypi not too long from now. I will update the pyscipopt package then.


---

Comment by moritz created at 2018-04-11 15:32:11

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2018-04-16 11:02:38

I merged latest #24662.

All doctests need to be marked `# optional - pyscipopt`
----
New commits:


---

Comment by mkoeppe created at 2018-04-16 11:05:19

Also 1.4.3 is out.


---

Comment by mkoeppe created at 2018-04-16 11:05:19

Changing status from needs_review to needs_work.


---

Comment by moritz created at 2018-04-16 13:46:02

in the meantime its version 1.4.4: I am on it...


---

Comment by moritz created at 2018-04-16 21:04:22

I marked all doctest `optional` and updated.


Suddenly, one doctest doesn't work anymore:

```
sage: g = graphs.CubeGraph(9)
sage: p = MixedIntegerLinearProgram(solver = "SCIP")                # optional - pyscipopt

sage: b = p.new_variable(binary=True)                               # optional - pyscipopt
sage: p.set_objective(p.sum(b[v] for v in g))                       # optional - pyscipopt
sage: for v in g:                                                   # optional - pyscipopt
....:     p.add_constraint(b[v]+p.sum(b[u] for u in g.neighbors(v)) <= 1) # optional - pyscipopt
sage: p.add_constraint(b[v] == 1) # Force an easy non-0 solution    # optional - pyscipopt
sage: p.solver_parameter("limits/absgap", 100)                      # optional - pyscipopt
sage: p.solve() # rel tol 100                                       # optional - pyscipopt
}}} 
and totaly chrashes sage with an error message `free(): invalid pointer`. I don't quite know what is going on. 

What is really weird is that it works if I don't run the last line, but instead:
{{{
sage: q = copy(p)
sage: q.solver_parameter("limits/absgap", 100)
sage: q.solve()
0
}}}

(I temperarily change `9` to `4` in the doctest above, in order to be able to run the rest of the doctest. The current branch works without failures for me.)
----
Last 10 new commits:


---

Comment by moritz created at 2018-04-16 21:05:06

... the nice thing: all my patches have been merged by a very responsive upstream!


---

Comment by git created at 2018-04-17 10:16:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2018-04-17 10:32:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by moritz created at 2018-04-17 11:21:52

now everything seems to work! I reviewed the stubs and everything written by Matthias on this ticket.


---

Comment by moritz created at 2018-04-17 11:21:52

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-04-19 08:10:33

In the `spkg-install` script you should not be using the `make` command but rather `sdh_make` from the "Sage-distribution helper" tools (see `src/bin/sage-dist-helpers`).


---

Comment by vdelecroix created at 2018-04-19 08:10:33

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-04-19 08:13:05

Also avoid `$MAKE test  | tee testsuite.log` (in `spkg-check`). It is not the role of the script to perform redirections.


---

Comment by moritz created at 2018-04-19 08:18:19

Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..


---

Comment by vdelecroix created at 2018-04-19 08:19:11

Please use multiple lines for

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR="${SAGE_LOCAL}" -DZLIB_ROOT="${SAGE_LOCAL}" -DReadline_ROOT_DIR="${SAGE_LOCAL}" -DBLISS_DIR="${SAGE_LOCAL}" -DIPOPT=FALSE
```



---

Comment by vdelecroix created at 2018-04-19 08:19:25

Replying to [comment:43 moritz]:
> Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..

You should not, this ticket is in positive review!


---

Comment by moritz created at 2018-04-19 08:21:04

Replying to [comment:45 vdelecroix]:
> Replying to [comment:43 moritz]:
> > Thanks for the comments, Vincent! I assume, they are meant for the scipoptsuite package, not the pyscipopt one, I will change that on #24662..
> 
> You should not, this ticket is in positive review!
ok


---

Comment by vdelecroix created at 2018-04-19 08:23:24

Why this change in `numerical/mip.pyx`

```
-        self._p._backend.set_variable_type(j, self._vtype)
+        #self._p._backend.set_variable_type(j, self._vtype)
```

If this line is not needed anymore just remove it.


---

Comment by vdelecroix created at 2018-04-19 08:26:29

You could also simplify the `SPKG.txt` file:
- the section `SPKG Maintainers` of SPKG.txt is not needed anymore (the information is likely to be not up to date in few time)
- if `Special Update/Build Instructions` is empty, just avoid it.


---

Comment by git created at 2018-04-19 09:32:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2018-04-19 09:35:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2018-04-19 09:37:04

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-04-19 09:37:04

I addressed all suggestions by Vincent and tested the install of scipoptsuite as well as pyscipopt.


---

Comment by vdelecroix created at 2018-05-12 19:40:29

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-05-12 19:40:29

merge conflicts


---

Comment by vdelecroix created at 2018-05-12 19:42:00

And this will not work

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}"/
         -DCMAKE_VERBOSE_MAKEFILE=ON
         -DGMP_DIR="${SAGE_LOCAL}"
         -DZLIB_ROOT="${SAGE_LOCAL}"
         -DReadline_ROOT_DIR="${SAGE_LOCAL}"
         -DBLISS_DIR="${SAGE_LOCAL}"
         -DIPOPT=FALSE
```

You need to add backslashes for line continuation

```
cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}" \
         -DCMAKE_VERBOSE_MAKEFILE=ON            \
         -DGMP_DIR="${SAGE_LOCAL}"              \
         -DZLIB_ROOT="${SAGE_LOCAL}"            \
         -DReadline_ROOT_DIR="${SAGE_LOCAL}"    \
         -DBLISS_DIR="${SAGE_LOCAL}"            \
         -DIPOPT=FALSE
```



---

Comment by moritz created at 2018-05-12 19:50:58

I will get to work. I think the line break issue was fixed here:
https://git.sagemath.org/sage.git/commit/?id=c0b432c427236c07f76f930a156a15d3f33eb1f1

But I can make the slashes align, of course.


---

Comment by vdelecroix created at 2018-05-12 19:52:54

Alignment does not matter. But there should be backslashes.


---

Comment by git created at 2018-05-12 21:51:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by moritz created at 2018-05-12 21:53:23

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-05-12 21:53:23

Replying to [comment:52 vdelecroix]:
> merge conflicts

I did a rebase, and it was done automatically.
I ran all the tests, and (at least on my machine) everything works..

I am a bit confused, because I expected to see merge conflicts..


---

Comment by vdelecroix created at 2018-05-13 08:07:00

Replying to [comment:57 moritz]:
> Replying to [comment:52 vdelecroix]:
> > merge conflicts
> 
> I did a rebase, and it was done automatically.
> I ran all the tests, and (at least on my machine) everything works..
> 
> I am a bit confused, because I expected to see merge conflicts..

Applying patches is not commutative!


---

Comment by vdelecroix created at 2018-05-13 08:16:10

What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.


---

Comment by vdelecroix created at 2018-05-13 08:17:45

Changing status from needs_review to needs_info.


---

Comment by moritz created at 2018-05-13 08:24:27

Replying to [comment:59 vdelecroix]:
> What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.

I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. 

I agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me.


---

Comment by vdelecroix created at 2018-05-13 08:32:51

Replying to [comment:61 moritz]:
> Replying to [comment:59 vdelecroix]:
> > What is the point of using Cython here? Because you use `pyscipopt` everywhere there is no C at all in the file `scip_backend.pyx`. I would keep it simple and use pure python here.
> 
> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. However other backends might actually need this. 
> 
> I agree that there we don't really need Cython for the pyscipopt backend. But it doesn't do any harm, does it? I am indifferent; we can change it or leave it, both is fine with me. 

On the plus side

- do like the other backends

On the minus side

- two files (pxd/pyx) instead of one
- longer compilation time
- more delicate to debug

The reason why all other backends are written in Cython is because they do call C functions.


---

Comment by mkoeppe created at 2018-05-14 01:35:25

Replying to [comment:61 moritz]:
> I think Matthias made the backend Cython, because the `generic_backend.pyx` is also written this way and all the other files are written in this way. 

That's correct, I did this just for copypastability and no technical reason otherwise.


---

Comment by git created at 2018-05-31 17:21:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2018-07-16 19:04:05

Another update to SCIPoptsuite 6.0 is due


---

Comment by vdelecroix created at 2018-08-03 19:18:42

milestone update 8.3 -> 8.4


---

Comment by mkoeppe created at 2021-02-03 07:22:48

Changing status from needs_info to needs_work.


---

Comment by mkoeppe created at 2021-02-03 07:22:48

Squashed/rebased onto #31329 (Update scipoptsuite to 7.0.2)


---

Comment by git created at 2021-02-03 07:35:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-03 07:36:05


```
sage: from pyscipopt import Model                                                                                                                                                                                        
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-fcc6f2f967b1> in <module>
----> 1 from pyscipopt import Model

~/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/__init__.py in <module>
      9 # export user-relevant objects:
     10 from pyscipopt.Multidict import multidict
---> 11 from pyscipopt.scip      import Model
     12 from pyscipopt.scip      import Benders
     13 from pyscipopt.scip      import Benderscut

ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so, 2): Library not loaded: libscip.7.0.dylib
  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/lib/python3.9/site-packages/pyscipopt/scip.cpython-39-darwin.so
  Reason: image not found
```



---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by dimpase created at 2022-11-04 23:30:10

yes, I came here to note the license change too :-)


---

Comment by git created at 2022-11-12 07:40:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-11-14 04:23:30

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-11-14 05:51:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-11-14 06:32:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-20 05:22:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-22 20:38:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-22 21:02:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-22 22:53:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-23 20:34:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-23 23:03:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-28 00:31:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-11-28 01:08:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-28 01:20:26

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-11-28 02:16:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-28 02:23:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-11-29 10:46:21

I tried with Fedor 35 and all my tests are successful.

How can I run all doctests with scip as default solver ?


---

Comment by git created at 2022-11-29 18:34:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-29 18:35:36

After this fix, you can use `~/.sage/init-doctests.sage` to set `default_mip_solver('scip')`


---

Comment by dcoudert created at 2022-11-30 12:35:00

In the last commit, you added `elif solver == "Scip":` but in other places we have `for s in ["Cplex", "Gurobi", "Coin", "Glpk", "SCIP"]:` and in the last comment you used `'scip'`. I'm not sure which is the correct way to write it. In fact, I think that the name of the solver should not be case sensitive.

I tried different ways to write `scip` in `~/.sage/init-doctests.sage` and it's working, but I cannot ensure that `SCIP` has been used...


---

Comment by mkoeppe created at 2022-11-30 17:41:35

The solver name is case-insensitive. Functions such as `default_mip_solver` normalize it using `solver = solver.capitalize()` before comparing it with the known solver names.


---

Comment by mkoeppe created at 2022-11-30 17:43:11

Do you have some examples in `sage.graphs` where the default solver takes noticeable time? Perhaps we can add some doctests that are `# optional - pyscipopt`.


---

Comment by dcoudert created at 2022-12-01 10:39:50

While searching for an example, I found an issue:
- in method `G.pathwidth`, we can specify àlgorithm="MILP"` but not the solver
- in method `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation` we can not set parameter `integrality=True` that is used in `from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP`. It is currently set to `False`. The problem is that with `SCIP`, I get an error when set to `False` and the correct answer when `True`.


```
sage: from sage.graphs.graph_decompositions.vertex_separation import vertex_separation_MILP
sage: G = graphs.PetersenGraph()
sage: %time vertex_separation_MILP(G, solver="GLPK")
CPU times: user 10.2 s, sys: 2.96 ms, total: 10.2 s
Wall time: 10.3 s
(5, [1, 2, 4, 9, 7, 0, 5, 6, 3, 8])
sage: %time vertex_separation_MILP(G, solver="SCIP")
---------------------------------------------------------------------------
MIPSolverException                        Traceback (most recent call last)
File /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1405, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()
   1404 try:
-> 1405     obj = p.solve(log=verbose)
   1406 except MIPSolverException:

File /home/dcoudert/sage/src/sage/numerical/mip.pyx:2559, in sage.numerical.mip.MixedIntegerLinearProgram.solve()
   2558 if log is not None: self._backend.set_verbosity(log)
-> 2559 self._backend.solve()
   2560 return self._backend.get_objective_value()

File /home/dcoudert/sage/src/sage/numerical/backends/scip_backend.pyx:632, in sage.numerical.backends.scip_backend.SCIPBackend.solve()
    631 elif status=='infeasible':
--> 632     raise MIPSolverException("SCIP : There is no feasible solution")
    633 #elif status=='timelimit':

MIPSolverException: SCIP : There is no feasible solution

During handling of the above exception, another exception occurred:

ValueError                                Traceback (most recent call last)
File <timed eval>:1

File /home/dcoudert/sage/src/sage/misc/decorators.py:651, in rename_keyword.__call__.<locals>.wrapper(*args, **kwds)
    649         kwds[new_name] = kwds[old_name]
    650         del kwds[old_name]
--> 651 return func(*args, **kwds)

File /home/dcoudert/sage/src/sage/graphs/graph_decompositions/vertex_separation.pyx:1410, in sage.graphs.graph_decompositions.vertex_separation.vertex_separation_MILP()
   1408         raise ValueError("unbounded or unexpected error")
   1409     else:
-> 1410         raise ValueError("unbounded or unexpected error, try with 'integrality = True'")
   1411 
   1412 taby = p.get_values(y, convert=bool, tolerance=integrality_tolerance)

ValueError: unbounded or unexpected error, try with 'integrality = True'
sage: %time vertex_separation_MILP(G, solver="SCIP", integrality=True)
CPU times: user 845 ms, sys: 3.98 ms, total: 849 ms
Wall time: 851 ms
(5, [7, 9, 8, 3, 6, 2, 5, 4, 1, 0])
```


So we should:
- allow to specify the solver in `pathwidth`
- set parameter `integrality` to `True` by default in `vertex_separation_MILP`
- add a dockets with the Petersen graph  marked `# optional - pyscipopt` (too long for glpk)


---

Comment by git created at 2022-12-01 19:54:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-12-01 20:13:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-12-01 22:17:30

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-12-01 22:31:14

Turns out that all uses of `self.model.getVars()` are broken - this functions does not return variables in the order of their indices.


---

Comment by git created at 2022-12-01 22:47:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-12-02 01:30:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-12-02 03:17:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-12-02 03:20:08

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2022-12-03 23:33:18

This is working well on fedora 35 and macOS M1, and it is much faster than `GLPK`.
For me this is OK.

I have not checked if we can have homebrew install of some parts.


---

Comment by mkoeppe created at 2022-12-03 23:36:18

Thanks for testing!

I've tested it here with onetbb installed from homebrew.


---

Comment by git created at 2022-12-03 23:39:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-12-04 11:42:50

For me this is good to go, so I'm setting this ticket to positive review.


---

Comment by dcoudert created at 2022-12-04 11:42:50

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-12-04 21:39:47

Thank you! 

Dependency tickets #34726, #34742, #31329 also need review


---

Comment by dcoudert created at 2022-12-17 10:25:19

The patchbot reports block errors when building the doc of `src/sage/numerical/backends/scip_backend.pyx`. Furthermore, this file has some pycodestyle issues such as 80 columns alignements, use of `Returns` instead of `Return`, ...


```
For explanations on these warnings, see the wiki.
========== blocks ==========
git checkout patchbot/ticket_merged
Already on 'patchbot/ticket_merged'
inside file:  b/src/sage/numerical/backends/scip_backend.pyx
@@ -0,0 +1,1185 @@
+        - ``vtype`` (integer) :
+        - ``sense`` (integer) :
inside file:  b/src/sage/numerical/backends/scip_backend.pyx
@@ -0,0 +1,1185 @@
+        Returns the value of the objective function.
+        Returns the value of a variable given by the solver.
+        Returns the value of the auxiliary variable associated with i-th row.
+        Returns a copy of self.
wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines
Traceback (most recent call last):
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/patchbot.py", line 1087, in test_a_ticket
    res = plugin(ticket, baseline=baseline, **kwds)
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py", line 609, in blocks
    exclude_new(ticket, regex=regexps,
  File "/home/iovoid/.local/lib/python3.10/site-packages/sage_patchbot/plugins.py", line 405, in exclude_new
    raise ValueError(full_msg)
ValueError: wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 6 non-empty lines
blocks -- 0 seconds
========== end blocks ==========
```



---

Comment by dimpase created at 2022-12-17 12:53:28

I only see irrelevant to this ticket lint reports:

```
Run tox -e pycodestyle-minimal
pycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/.tox/src
pycodestyle-minimal run-test-pre: PYTHONHASHSEED='1886447434'
pycodestyle-minimal run-test: commands[0] | tox -c /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/tox.ini -e pycodestyle-minimal --
pycodestyle-minimal create: /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal
pycodestyle-minimal installdeps: pycodestyle
pycodestyle-minimal installed: pycodestyle==2.10.0
pycodestyle-minimal run-test-pre: PYTHONHASHSEED='4154509342'
pycodestyle-minimal run-test: commands[0] | pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/sage/
sage/rings/lazy_series_ring.py:1546:9: E306 expected 1 blank line before a nested definition, found 0
sage/combinat/diagram.py:1471:1: W391 blank line at end of file
sage/combinat/skew_partition.py:1970:1: W391 blank line at end of file
sage/algebras/all.py:68:1: W391 blank line at end of file
sage/algebras/fusion_rings/all.py:20:1: W391 blank line at end of file
sage/algebras/fusion_rings/f_matrix.py:2460:1: W391 blank line at end of file
sage/algebras/fusion_rings/fusion_ring.py:1575:1: W391 blank line at end of file
1       E306 expected 1 blank line before a nested definition, found 0
6       W391 blank line at end of file
ERROR: InvocationError for command /home/runner/work/sagetrac-mirror/sagetrac-mirror/src/.tox/pycodestyle-minimal/bin/pycodestyle --select E111,E306,E401,E701,E702,E703,W391,W605,E711,E712,E713,E721,E722 sage (exited with code 1)
___________________________________ summary ____________________________________
ERROR:   pycodestyle-minimal: commands failed
ERROR: InvocationError for command /opt/hostedtoolcache/Python/3.8.14/x64/bin/tox -c src/tox.ini -e pycodestyle-minimal --


---

Comment by git created at 2022-12-17 20:36:38

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2022-12-17 20:36:38

Changing status from positive_review to needs_review.


---

Comment by mkoeppe created at 2022-12-17 20:36:59

Changing status from needs_review to positive_review.
