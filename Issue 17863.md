# Issue 17863: Parallelization of computations on tensors on free modules

archive/issues_017863.json:
```json
{
    "body": "CC:  tscrim\n\nKeywords: parallelization, free module, tensor\n\nThis ticket implements parallelization of basic operations (arithmetics, contractions) on tensors on free modules of finite rank. The parallelization is performed by means of Python's module `multiprocessing`, via the decorator ``@`parallel`.\n\nThis work is an extension of #15916, within the [SageManifolds](http://sagemanifolds.obspm.fr/) project.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18100\n\n",
    "created_at": "2015-04-01T14:06:30Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "title": "Parallelization of computations on tensors on free modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17863",
    "user": "egourgoulhon"
}
```
CC:  tscrim

Keywords: parallelization, free module, tensor

This ticket implements parallelization of basic operations (arithmetics, contractions) on tensors on free modules of finite rank. The parallelization is performed by means of Python's module `multiprocessing`, via the decorator ``@`parallel`.

This work is an extension of #15916, within the [SageManifolds](http://sagemanifolds.obspm.fr/) project.

Issue created by migration from https://trac.sagemath.org/ticket/18100





---

archive/issue_comments_239595.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-01T14:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239595",
    "user": "mmancini"
}
```

New commits:



---

archive/issue_comments_239596.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T14:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239596",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-07T14:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T14:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239598",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T09:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239599",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-16T08:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239600",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-21T16:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239601",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239602.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-22T09:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239602",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239603.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-22T09:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239603",
    "user": "mmancini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_239604.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-06-30T22:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239604",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_239605.json:
```json
{
    "body": "Hello,\n\nThe name `set_nproc` is not appropriate for a function that is intended to be used only for tensor products. Secondly, why are you duplicating the interface with a class `TensorParallelCompute` and functions `set_nproc`, `get_nproc`?\n\nVincent",
    "created_at": "2015-06-30T22:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239605",
    "user": "vdelecroix"
}
```

Hello,

The name `set_nproc` is not appropriate for a function that is intended to be used only for tensor products. Secondly, why are you duplicating the interface with a class `TensorParallelCompute` and functions `set_nproc`, `get_nproc`?

Vincent



---

archive/issue_comments_239606.json:
```json
{
    "body": "Replying to [comment:13 vdelecroix]:\nHello Vincent,\n\nThanks to review our work.\n\nWe try to reply to the two points:\n1) You are right, the names `set_nproc` and `get_nproc` are generic names and not clearly referred to tensors, so we propose to changes them in `set_nproc_tensor` and `get_nproc_tensor`. \n\n2) The functions `set_nproc` and `get_nproc`  were introduced in order to avoid \nto the users to typing the two more verbose (and less clear) functions `TensorParallelCompute().set(nproc)` and  `TensorParallelCompute._nproc`\nNote that the singleton `TensorParallelCompute` is not in the global namespace but only the functions `set_nproc` and `get_nproc`.\n\nBest regards,\n\nMarco\n\n> Hello,\n> \n> The name `set_nproc` is not appropriate for a function that is intended to be used only for tensor products. Secondly, why are you duplicating the interface with a class `TensorParallelCompute` and functions `set_nproc`, `get_nproc`?\n> \n> Vincent",
    "created_at": "2015-07-07T11:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239606",
    "user": "mmancini"
}
```

Replying to [comment:13 vdelecroix]:
Hello Vincent,

Thanks to review our work.

We try to reply to the two points:
1) You are right, the names `set_nproc` and `get_nproc` are generic names and not clearly referred to tensors, so we propose to changes them in `set_nproc_tensor` and `get_nproc_tensor`. 

2) The functions `set_nproc` and `get_nproc`  were introduced in order to avoid 
to the users to typing the two more verbose (and less clear) functions `TensorParallelCompute().set(nproc)` and  `TensorParallelCompute._nproc`
Note that the singleton `TensorParallelCompute` is not in the global namespace but only the functions `set_nproc` and `get_nproc`.

Best regards,

Marco

> Hello,
> 
> The name `set_nproc` is not appropriate for a function that is intended to be used only for tensor products. Secondly, why are you duplicating the interface with a class `TensorParallelCompute` and functions `set_nproc`, `get_nproc`?
> 
> Vincent



---

archive/issue_comments_239607.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-26T14:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239607",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239608.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-27T08:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239608",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239609.json:
```json
{
    "body": "In the last 2 commits we modified the variables name set_nproc get_nproc in set_nproc_tensor and get_nproc_tensor as proposed.",
    "created_at": "2015-08-27T08:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239609",
    "user": "mmancini"
}
```

In the last 2 commits we modified the variables name set_nproc get_nproc in set_nproc_tensor and get_nproc_tensor as proposed.



---

archive/issue_comments_239610.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-08-27T08:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239610",
    "user": "mmancini"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_239611.json:
```json
{
    "body": "This ticket is now the basis for parallelization of demanding computations involving affine connections on differentiable manifolds (#19147), as well as in pseudo-Riemannian manifolds (#19209).",
    "created_at": "2015-10-15T21:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239611",
    "user": "egourgoulhon"
}
```

This ticket is now the basis for parallelization of demanding computations involving affine connections on differentiable manifolds (#19147), as well as in pseudo-Riemannian manifolds (#19209).



---

archive/issue_comments_239612.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-10-21T19:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239612",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_239613.json:
```json
{
    "body": "Some more questions:\n\n- I still don't understand why there is an object oriented interface **and** a function interface. Why not only one?\n\n- Wouldn't it be better to gather everything related to parallelism in a single place? You could mimic what is done for proofs (`sage.structure.proof.proof`) or global options (`sage.structure.global_options`). These two are not perfect but at least they intend to be general and reusable. The object oriented interface could be something like:\n\n```\nsage: Parallelism().get('tensor')\n1\nsage: Parallelism().set('tensor', 3)\nsage: Parallelism().set_default(3)\nsage: Parallelism().get_default()\n3\nsage: Parallellism().get_all()\n{\n 'tensor': 3,\n 'xyz': 2\n}\n```\n\n(though that could be postponed to some other tickets)\n\n- The functions `get_nproc_tensor` and `set_nproc_tensor` should definitely not be in the global namespace as they are very much specialized.",
    "created_at": "2015-10-21T19:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239613",
    "user": "vdelecroix"
}
```

Some more questions:

- I still don't understand why there is an object oriented interface **and** a function interface. Why not only one?

- Wouldn't it be better to gather everything related to parallelism in a single place? You could mimic what is done for proofs (`sage.structure.proof.proof`) or global options (`sage.structure.global_options`). These two are not perfect but at least they intend to be general and reusable. The object oriented interface could be something like:

```
sage: Parallelism().get('tensor')
1
sage: Parallelism().set('tensor', 3)
sage: Parallelism().set_default(3)
sage: Parallelism().get_default()
3
sage: Parallellism().get_all()
{
 'tensor': 3,
 'xyz': 2
}
```

(though that could be postponed to some other tickets)

- The functions `get_nproc_tensor` and `set_nproc_tensor` should definitely not be in the global namespace as they are very much specialized.



---

archive/issue_comments_239614.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T10:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239614",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T21:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239615",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239616.json:
```json
{
    "body": "Thanks for the heavy changes! If you are done with your changes and want a review again you need to switch the status of the ticket from \"needs info\" to \"needs review\". \n\nYou also need to update the ticket description.\n\nIt would be good to advertise this ticket on sage-devel. Other people might be interested (e.g. #18987 for which the parallelization option can use some default).",
    "created_at": "2015-10-27T22:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239616",
    "user": "vdelecroix"
}
```

Thanks for the heavy changes! If you are done with your changes and want a review again you need to switch the status of the ticket from "needs info" to "needs review". 

You also need to update the ticket description.

It would be good to advertise this ticket on sage-devel. Other people might be interested (e.g. #18987 for which the parallelization option can use some default).



---

archive/issue_comments_239617.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-10-28T05:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239617",
    "user": "egourgoulhon"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_239618.json:
```json
{
    "body": "Replying to [comment:23 vdelecroix]:\n> Thanks for the heavy changes! If you are done with your changes and want a review again you need to switch the status of the ticket from \"needs info\" to \"needs review\". \n\nActually a few improvements in the documentation are under way and will be committed soon.\n> \n> You also need to update the ticket description.\n\nYes indeed.\n> \n> It would be good to advertise this ticket on sage-devel. Other people might be interested (e.g. #18987 for which the parallelization option can use some default).\n\nOK.",
    "created_at": "2015-10-28T05:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239618",
    "user": "egourgoulhon"
}
```

Replying to [comment:23 vdelecroix]:
> Thanks for the heavy changes! If you are done with your changes and want a review again you need to switch the status of the ticket from "needs info" to "needs review". 

Actually a few improvements in the documentation are under way and will be committed soon.
> 
> You also need to update the ticket description.

Yes indeed.
> 
> It would be good to advertise this ticket on sage-devel. Other people might be interested (e.g. #18987 for which the parallelization option can use some default).

OK.



---

archive/issue_comments_239619.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-28T06:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239619",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239620.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-28T06:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239620",
    "user": "egourgoulhon"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_239621.json:
```json
{
    "body": "Note that the documentation of class `Parallelism` has been added to the *Parallel Computing* section of the reference manual.",
    "created_at": "2015-10-28T06:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239621",
    "user": "egourgoulhon"
}
```

Note that the documentation of class `Parallelism` has been added to the *Parallel Computing* section of the reference manual.



---

archive/issue_comments_239622.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-28T10:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239622",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_239623.json:
```json
{
    "body": "Hello,\n\nAll right. This is a good start for further improvements...\n\nVincent",
    "created_at": "2015-11-10T11:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239623",
    "user": "vdelecroix"
}
```

Hello,

All right. This is a good start for further improvements...

Vincent



---

archive/issue_comments_239624.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-10T11:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239624",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_239625.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-10T22:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239625",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_239626.json:
```json
{
    "body": "Replying to [comment:30 vdelecroix]:\n> Hello,\n> \n> All right. This is a good start for further improvements...\n> \n> Vincent\n\n\n\nHello Vincent,\n\nThanks a lot for the review, advices and suggestions.\nRegards,\nMarco",
    "created_at": "2015-11-11T06:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17863#issuecomment-239626",
    "user": "mmancini"
}
```

Replying to [comment:30 vdelecroix]:
> Hello,
> 
> All right. This is a good start for further improvements...
> 
> Vincent



Hello Vincent,

Thanks a lot for the review, advices and suggestions.
Regards,
Marco
