# Issue 27728: py3: fix the last doctest in geometry

archive/issues_027728.json:
```json
{
    "body": "CC:  @jplab @videlec @tscrim\n\nor rather tag it with # py2\n\nI have no idea why this does fail only in python3. But anyway, we cannot really do anything with the snub dodecahedron currently.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27965\n\n",
    "created_at": "2019-06-10T19:34:30Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "py3: fix the last doctest in geometry",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27728",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jplab @videlec @tscrim

or rather tag it with # py2

I have no idea why this does fail only in python3. But anyway, we cannot really do anything with the snub dodecahedron currently.

Issue created by migration from https://trac.sagemath.org/ticket/27965





---

archive/issue_comments_391238.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-10T19:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391238",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391239.json:
```json
{
    "body": "very trivial ticket, please review swiftly\n----\nNew commits:",
    "created_at": "2019-06-10T19:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391239",
    "user": "https://github.com/fchapoton"
}
```

very trivial ticket, please review swiftly
----
New commits:



---

archive/issue_comments_391240.json:
```json
{
    "body": "I think the issue here is not that `polytopes.snub_dodecahedron()` is broken in Python 3, but rather that Python 3 prints warning messages multiple times, whereas Python 2 only prints them once, at least while doctesting. A change like that in #27612 might be another option:\n\n```diff\ndiff --git a/src/sage/geometry/polyhedron/library.py b/src/sage/geometry/polyhedron/library.py\nindex 71914d635a..c9bb1f35e8 100644\n--- a/src/sage/geometry/polyhedron/library.py\n+++ b/src/sage/geometry/polyhedron/library.py\n@@ -1489,7 +1489,11 @@ class Polytopes():\n         Unfortunately, no polyhedra backend supports the construction of the\n         snub dodecahedron at the moment::\n \n-            sage: sd = polytopes.snub_dodecahedron()\n+            sage: sd = polytopes.snub_dodecahedron() # py2\n+            sage: sd = polytopes.snub_dodecahedron() # py3\n+            doctest:warning\n+            ...\n+            UserWarning: This polyhedron data is numerically complicated; cdd could not convert between the inexact V and H representation without loss of data. The resulting object might show inconsistencies.\n             sage: sd.f_vector() # not tested\n             (1, 60, 150, 92, 1)\n             sage: sd.base_ring() # not tested\n```\n\nGiven the comment, though (\"no polyhedra backend supports the construction of the snub dodecahedron at the moment\"), it's not a big deal.",
    "created_at": "2019-06-10T20:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391240",
    "user": "https://github.com/jhpalmieri"
}
```

I think the issue here is not that `polytopes.snub_dodecahedron()` is broken in Python 3, but rather that Python 3 prints warning messages multiple times, whereas Python 2 only prints them once, at least while doctesting. A change like that in #27612 might be another option:

```diff
diff --git a/src/sage/geometry/polyhedron/library.py b/src/sage/geometry/polyhedron/library.py
index 71914d635a..c9bb1f35e8 100644
--- a/src/sage/geometry/polyhedron/library.py
+++ b/src/sage/geometry/polyhedron/library.py
@@ -1489,7 +1489,11 @@ class Polytopes():
         Unfortunately, no polyhedra backend supports the construction of the
         snub dodecahedron at the moment::
 
-            sage: sd = polytopes.snub_dodecahedron()
+            sage: sd = polytopes.snub_dodecahedron() # py2
+            sage: sd = polytopes.snub_dodecahedron() # py3
+            doctest:warning
+            ...
+            UserWarning: This polyhedron data is numerically complicated; cdd could not convert between the inexact V and H representation without loss of data. The resulting object might show inconsistencies.
             sage: sd.f_vector() # not tested
             (1, 60, 150, 92, 1)
             sage: sd.base_ring() # not tested
```

Given the comment, though ("no polyhedra backend supports the construction of the snub dodecahedron at the moment"), it's not a big deal.



---

archive/issue_comments_391241.json:
```json
{
    "body": "I prefer my suggestion. When we move away from Python 2, it leaves a valid py3 command to execute.\n----\nNew commits:",
    "created_at": "2019-06-11T04:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391241",
    "user": "https://github.com/jhpalmieri"
}
```

I prefer my suggestion. When we move away from Python 2, it leaves a valid py3 command to execute.
----
New commits:



---

archive/issue_comments_391242.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-11T05:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391242",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391243.json:
```json
{
    "body": "ok, good for me.",
    "created_at": "2019-06-11T05:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391243",
    "user": "https://github.com/fchapoton"
}
```

ok, good for me.



---

archive/issue_comments_391244.json:
```json
{
    "body": "... have a look at #25097.\n\nThis test was removed and replaced by a reasonable test using the backend normaliz.\n\nI would say that such computation over `RDF` should not be encouraged via examples/doctests as the backend normaliz provide reasonably fast computations with algebraic numbers.",
    "created_at": "2019-06-11T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391244",
    "user": "https://github.com/jplab"
}
```

... have a look at #25097.

This test was removed and replaced by a reasonable test using the backend normaliz.

I would say that such computation over `RDF` should not be encouraged via examples/doctests as the backend normaliz provide reasonably fast computations with algebraic numbers.



---

archive/issue_comments_391245.json:
```json
{
    "body": "`cdd` and python2 and 3 have different behavior. In #27760, I was obtaining several times this kind of warnings in the default case due to approximation errors. When such errors occurred, I simply change the default behavior _not_ to produce such warnings and go for an exact solution.\n\nI would really try to simply avoid making such tests in the future as we know that they are prone to produce such errors and we have a viable faster and reliable alternative (ok, with an optional package...).",
    "created_at": "2019-06-11T19:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391245",
    "user": "https://github.com/jplab"
}
```

`cdd` and python2 and 3 have different behavior. In #27760, I was obtaining several times this kind of warnings in the default case due to approximation errors. When such errors occurred, I simply change the default behavior _not_ to produce such warnings and go for an exact solution.

I would really try to simply avoid making such tests in the future as we know that they are prone to produce such errors and we have a viable faster and reliable alternative (ok, with an optional package...).



---

archive/issue_comments_391246.json:
```json
{
    "body": "But #25097 is not yet approved. The main aim in the present ticket is to later be able to lock the geometry folder (which means adding it to the list of python3-known-passing folders), so that no py3 failure could happen by accident.",
    "created_at": "2019-06-11T19:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391246",
    "user": "https://github.com/fchapoton"
}
```

But #25097 is not yet approved. The main aim in the present ticket is to later be able to lock the geometry folder (which means adding it to the list of python3-known-passing folders), so that no py3 failure could happen by accident.



---

archive/issue_comments_391247.json:
```json
{
    "body": "I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.",
    "created_at": "2019-06-11T19:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391247",
    "user": "https://github.com/jhpalmieri"
}
```

I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.



---

archive/issue_comments_391248.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.\n\nAll right, sounds good!\n\nI put the present ticket as dependancy in #25097. The ticket is essentially ready and tested, it only gets slowed due to similar conflicts/dependancies, ;) that was the reason of my reserve.",
    "created_at": "2019-06-12T07:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391248",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:9 jhpalmieri]:
> I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.

All right, sounds good!

I put the present ticket as dependancy in #25097. The ticket is essentially ready and tested, it only gets slowed due to similar conflicts/dependancies, ;) that was the reason of my reserve.



---

archive/issue_comments_391249.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-28T04:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391249",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_391250.json:
```json
{
    "body": "Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27728#issuecomment-391250",
    "user": "https://github.com/embray"
}
```

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.
