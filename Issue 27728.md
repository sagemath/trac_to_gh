# Issue 27728: py3: fix the last doctest in geometry

Issue created by migration from https://trac.sagemath.org/ticket/27965

Original creator: chapoton

Original creation time: 2019-06-10 19:34:30

CC:  jipilab vdelecroix tscrim

or rather tag it with # py2

I have no idea why this does fail only in python3. But anyway, we cannot really do anything with the snub dodecahedron currently.


---

Comment by chapoton created at 2019-06-10 19:35:19

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-06-10 19:35:19

very trivial ticket, please review swiftly
----
New commits:


---

Comment by jhpalmieri created at 2019-06-10 20:11:31

I think the issue here is not that `polytopes.snub_dodecahedron()` is broken in Python 3, but rather that Python 3 prints warning messages multiple times, whereas Python 2 only prints them once, at least while doctesting. A change like that in #27612 might be another option:

```diff
diff --git a/src/sage/geometry/polyhedron/library.py b/src/sage/geometry/polyhedron/library.py
index 71914d635a..c9bb1f35e8 100644
--- a/src/sage/geometry/polyhedron/library.py
+++ b/src/sage/geometry/polyhedron/library.py
@@ -1489,7 +1489,11 @@ class Polytopes():
         Unfortunately, no polyhedra backend supports the construction of the
         snub dodecahedron at the moment::
 
-            sage: sd = polytopes.snub_dodecahedron()
+            sage: sd = polytopes.snub_dodecahedron() # py2
+            sage: sd = polytopes.snub_dodecahedron() # py3
+            doctest:warning
+            ...
+            UserWarning: This polyhedron data is numerically complicated; cdd could not convert between the inexact V and H representation without loss of data. The resulting object might show inconsistencies.
             sage: sd.f_vector() # not tested
             (1, 60, 150, 92, 1)
             sage: sd.base_ring() # not tested
```

Given the comment, though ("no polyhedra backend supports the construction of the snub dodecahedron at the moment"), it's not a big deal.


---

Comment by jhpalmieri created at 2019-06-11 04:06:38

I prefer my suggestion. When we move away from Python 2, it leaves a valid py3 command to execute.
----
New commits:


---

Comment by chapoton created at 2019-06-11 05:53:35

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-06-11 05:53:35

ok, good for me.


---

Comment by jipilab created at 2019-06-11 19:26:46

... have a look at #25097.

This test was removed and replaced by a reasonable test using the backend normaliz.

I would say that such computation over `RDF` should not be encouraged via examples/doctests as the backend normaliz provide reasonably fast computations with algebraic numbers.


---

Comment by jipilab created at 2019-06-11 19:33:10

`cdd` and python2 and 3 have different behavior. In #27760, I was obtaining several times this kind of warnings in the default case due to approximation errors. When such errors occurred, I simply change the default behavior _not_ to produce such warnings and go for an exact solution.

I would really try to simply avoid making such tests in the future as we know that they are prone to produce such errors and we have a viable faster and reliable alternative (ok, with an optional package...).


---

Comment by chapoton created at 2019-06-11 19:39:57

But #25097 is not yet approved. The main aim in the present ticket is to later be able to lock the geometry folder (which means adding it to the list of python3-known-passing folders), so that no py3 failure could happen by accident.


---

Comment by jhpalmieri created at 2019-06-11 19:51:11

I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.


---

Comment by jipilab created at 2019-06-12 07:52:48

Replying to [comment:9 jhpalmieri]:
> I think this can be merged and geometry white-listed, and then #25097 can replace the test here when that ticket is ready.

All right, sounds good!

I put the present ticket as dependancy in #25097. The ticket is essentially ready and tested, it only gets slowed due to similar conflicts/dependancies, ;) that was the reason of my reserve.


---

Comment by vbraun created at 2019-06-28 04:30:30

Resolution: fixed


---

Comment by embray created at 2019-07-03 11:34:48

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were _actually_ included, especially when closing tickets.
