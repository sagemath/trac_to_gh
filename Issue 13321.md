# Issue 13321: PALP/Laurent Normal Form

archive/issues_013321.json:
```json
{
    "body": "Assignee: mhampton\n\nCC:  @novoselt tomc trehn jkeitel\n\nThis patch adds the PALP normal form algorithm natively into the `lattice_polytope` class, as well as a modified algorithm that is more efficient for some polytopes. This is then also used directly to calculate a normal form for Laurent polynomials.\n\nThese algorithms require abilities to permute rows and columns of matrices, as well as find automorphisms of matrices under these operations, and lattice polytopes under GL(n,Z) transformations. These are also implemented here.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13525\n\n",
    "created_at": "2012-09-24T13:06:09Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "PALP/Laurent Normal Form",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13321",
    "user": "https://trac.sagemath.org/admin/accounts/users/sjg10"
}
```
Assignee: mhampton

CC:  @novoselt tomc trehn jkeitel

This patch adds the PALP normal form algorithm natively into the `lattice_polytope` class, as well as a modified algorithm that is more efficient for some polytopes. This is then also used directly to calculate a normal form for Laurent polynomials.

These algorithms require abilities to permute rows and columns of matrices, as well as find automorphisms of matrices under these operations, and lattice polytopes under GL(n,Z) transformations. These are also implemented here.

Issue created by migration from https://trac.sagemath.org/ticket/13525





---

archive/issue_comments_163389.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-24T13:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163389",
    "user": "https://trac.sagemath.org/admin/accounts/users/sjg10"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163390.json:
```json
{
    "body": "Very nice! Thanks for tackling this, I always wanted this implemented!\n\nSome minor nitpicks: Whenever you return a list of stuff, its better to return a tuple (which is immutable).\n\n```\ndef matrix_transformation(self,NewPolytope): \n```\nCamelCase should only be used for class names, not parameters. Also, space after comma. Thats just the standard Python code style.\n\n```\ndef lexicographical_order(self,certify=False): \n```\nThe name is a bit confusing, how about `permutation_normal_form()` or something like that?\n\n\n```\ndef is_isomorphic(self,N,certify=False): \n```\nThe linear algebra people will probably object to that kind of isomorphism check of matrices. How about `is_permutation_of()`?\n\n```\nBy default, in general one can't mix matrices and permutations\n```\nShould be just \"in general, ...\".",
    "created_at": "2012-09-24T13:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163390",
    "user": "https://github.com/vbraun"
}
```

Very nice! Thanks for tackling this, I always wanted this implemented!

Some minor nitpicks: Whenever you return a list of stuff, its better to return a tuple (which is immutable).

```
def matrix_transformation(self,NewPolytope): 
```
CamelCase should only be used for class names, not parameters. Also, space after comma. Thats just the standard Python code style.

```
def lexicographical_order(self,certify=False): 
```
The name is a bit confusing, how about `permutation_normal_form()` or something like that?


```
def is_isomorphic(self,N,certify=False): 
```
The linear algebra people will probably object to that kind of isomorphism check of matrices. How about `is_permutation_of()`?

```
By default, in general one can't mix matrices and permutations
```
Should be just "in general, ...".



---

archive/issue_comments_163391.json:
```json
{
    "body": "The reference you give in the code does not define the normal form you are computing. Is this published anywhere? If yes, please give a proper reference. If not, it would be great if you give a definition in the docstrings. \n\nPS. Well, I am very curious to find out what it is. That's one of the reasons I ask :\u2013)",
    "created_at": "2012-09-24T16:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163391",
    "user": "https://github.com/dimpase"
}
```

The reference you give in the code does not define the normal form you are computing. Is this published anywhere? If yes, please give a proper reference. If not, it would be great if you give a definition in the docstrings. 

PS. Well, I am very curious to find out what it is. That's one of the reasons I ask :–)



---

archive/issue_comments_163392.json:
```json
{
    "body": "Replying to [comment:3 dimpase]:\n> The reference you give in the code does not define the normal form you are computing. Is this published anywhere? If yes, please give a proper reference. If not, it would be great if you give a definition in the docstrings. \n> \n> PS. Well, I am very curious to find out what it is. That's one of the reasons I ask :\u2013)\n\n\nVolker kindly [wrote](https://groups.google.com/d/msg/sage-devel/3o7vRy2FByI/pLPEAPgNbn4J):\nSee Section 3.4 of http://arxiv.org/pdf/hep-th/9805190.pdf for the definition of the PALP normal form. \nSo this would be a reference to add.",
    "created_at": "2012-09-24T16:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163392",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:3 dimpase]:
> The reference you give in the code does not define the normal form you are computing. Is this published anywhere? If yes, please give a proper reference. If not, it would be great if you give a definition in the docstrings. 
> 
> PS. Well, I am very curious to find out what it is. That's one of the reasons I ask :–)


Volker kindly [wrote](https://groups.google.com/d/msg/sage-devel/3o7vRy2FByI/pLPEAPgNbn4J):
See Section 3.4 of http://arxiv.org/pdf/hep-th/9805190.pdf for the definition of the PALP normal form. 
So this would be a reference to add.



---

archive/issue_comments_163393.json:
```json
{
    "body": "I have one brief remark about the method *automorphisms()*. If I see this correctly, you build the complete face lattice, compute its automorphism group (i.e. the combinatorial automorphism group of the polytope) and filter those permutations that correspond to GL(n,ZZ)-transformations.\n\nThere seems to be already a method of *Polyhedron* that computes the combinatorial automorphism group, so you could use this method. For the combinatorial automorphisms of the polytope you don't need the whole face lattice, but the bipartite vertex-facet-incidence graph is enough.",
    "created_at": "2012-09-26T10:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163393",
    "user": "https://trac.sagemath.org/admin/accounts/users/trehn"
}
```

I have one brief remark about the method *automorphisms()*. If I see this correctly, you build the complete face lattice, compute its automorphism group (i.e. the combinatorial automorphism group of the polytope) and filter those permutations that correspond to GL(n,ZZ)-transformations.

There seems to be already a method of *Polyhedron* that computes the combinatorial automorphism group, so you could use this method. For the combinatorial automorphisms of the polytope you don't need the whole face lattice, but the bipartite vertex-facet-incidence graph is enough.



---

archive/issue_comments_163394.json:
```json
{
    "body": "Thanks all, fixing up the small issues now. Regarding what [comment:6 trehn] said, firstly, `LatticePolytope` does not inherit at all from `Polyhedron` and there does not seem to be an easy way to cast between the two, though as an aside, maybe this should be rectified?\n\nSecondly it is possible, and such was the intent (though I haven't personally checked this out, but have been told) that checking if a permutation corresponds to a GL(n,ZZ) transformation is a more hefty computation than constructing the face lattice. Doing so (especially as it is decorated with some lattice polytope invariants) and reducing the number of permutations to check, over just finding the combinatorial automorphisms and checking all of these may be quicker.",
    "created_at": "2012-09-27T08:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163394",
    "user": "https://trac.sagemath.org/admin/accounts/users/sjg10"
}
```

Thanks all, fixing up the small issues now. Regarding what [comment:6 trehn] said, firstly, `LatticePolytope` does not inherit at all from `Polyhedron` and there does not seem to be an easy way to cast between the two, though as an aside, maybe this should be rectified?

Secondly it is possible, and such was the intent (though I haven't personally checked this out, but have been told) that checking if a permutation corresponds to a GL(n,ZZ) transformation is a more hefty computation than constructing the face lattice. Doing so (especially as it is decorated with some lattice polytope invariants) and reducing the number of permutations to check, over just finding the combinatorial automorphisms and checking all of these may be quicker.



---

archive/issue_comments_163395.json:
```json
{
    "body": "Replying to [comment:7 sjg10]:\n> Secondly it is possible, and such was the intent (though I haven't personally checked this out, but have been told) that checking if a permutation corresponds to a GL(n,ZZ) transformation is a more hefty computation than constructing the face lattice. Doing so (especially as it is decorated with some lattice polytope invariants) and reducing the number of permutations to check, over just finding the combinatorial automorphisms and checking all of these may be quicker.\n\n\nSorry, I didn't see the lattice index invariants at first. Of course, my comment is not relevant if your input is \"easy\". Because you check all permutations whether they correspond to GL(n,ZZ)-transformations, trying to keep this number small seems reasonable. \n\nI think that, depending on the polytope, either the size of the face lattice or the number of group elements will cause problems if you go to dimensions beyond the PALP limit.",
    "created_at": "2012-09-27T13:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163395",
    "user": "https://trac.sagemath.org/admin/accounts/users/trehn"
}
```

Replying to [comment:7 sjg10]:
> Secondly it is possible, and such was the intent (though I haven't personally checked this out, but have been told) that checking if a permutation corresponds to a GL(n,ZZ) transformation is a more hefty computation than constructing the face lattice. Doing so (especially as it is decorated with some lattice polytope invariants) and reducing the number of permutations to check, over just finding the combinatorial automorphisms and checking all of these may be quicker.


Sorry, I didn't see the lattice index invariants at first. Of course, my comment is not relevant if your input is "easy". Because you check all permutations whether they correspond to GL(n,ZZ)-transformations, trying to keep this number small seems reasonable. 

I think that, depending on the polytope, either the size of the face lattice or the number of group elements will cause problems if you go to dimensions beyond the PALP limit.



---

archive/issue_comments_163396.json:
```json
{
    "body": "Replying to [comment:8 trehn]:\n> I think that, depending on the polytope, either the size of the face lattice or the number of group elements will cause problems if you go to dimensions beyond the PALP limit.\n\n\nThis is one of the main reasons of having implemented the PALP algorithm natively, the overflow errors that PALP is susceptible to in higher dimensions is removed when running the algorithm through python.",
    "created_at": "2012-10-02T12:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163396",
    "user": "https://trac.sagemath.org/admin/accounts/users/sjg10"
}
```

Replying to [comment:8 trehn]:
> I think that, depending on the polytope, either the size of the face lattice or the number of group elements will cause problems if you go to dimensions beyond the PALP limit.


This is one of the main reasons of having implemented the PALP algorithm natively, the overflow errors that PALP is susceptible to in higher dimensions is removed when running the algorithm through python.



---

archive/issue_comments_163397.json:
```json
{
    "body": "Attachment [trac13525_palplaurentnormalform2.patch](tarball://root/attachments/some-uuid/ticket13525/trac13525_palplaurentnormalform2.patch) by sjg10 created at 2012-10-03 13:47:48\n\nIssues in comments addressed",
    "created_at": "2012-10-03T13:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163397",
    "user": "https://trac.sagemath.org/admin/accounts/users/sjg10"
}
```

Attachment [trac13525_palplaurentnormalform2.patch](tarball://root/attachments/some-uuid/ticket13525/trac13525_palplaurentnormalform2.patch) by sjg10 created at 2012-10-03 13:47:48

Issues in comments addressed



---

archive/issue_comments_163398.json:
```json
{
    "body": "#14319 improves the graph automorphisms so you don't have to track the relabeling any more. This would simplify the code here, too. \n\nAs a minor nitpick, pep8 would be nice:\n\n```\ndef palp_modified_normal_form(L,affine_transform=False,certify=False):    # no\ndef palp_modified_normal_form(L, affine_transform=False, certify=False):  # yes\n```\nAlso, docstring should be imperative: \"Return foobar\". Not: \"Returns foobar\" or \"We return foobar\".",
    "created_at": "2013-05-01T09:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163398",
    "user": "https://github.com/vbraun"
}
```

#14319 improves the graph automorphisms so you don't have to track the relabeling any more. This would simplify the code here, too. 

As a minor nitpick, pep8 would be nice:

```
def palp_modified_normal_form(L,affine_transform=False,certify=False):    # no
def palp_modified_normal_form(L, affine_transform=False, certify=False):  # yes
```
Also, docstring should be imperative: "Return foobar". Not: "Returns foobar" or "We return foobar".



---

archive/issue_events_037534.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37534"
}
```



---

archive/issue_comments_163399.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2013-09-28T16:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_163400.json:
```json
{
    "body": "I have tried to rebase the patch and, in particular, tried to adapt to the changes from #14319. However, automorphisms of LatticePolytopes do not work yet and there is probably much code that could be rewritten.\n\nAs far as the code in lattice_polytope.py is concerned, I've only reformated and not checked what the code actually does.\nThe same is true for all other normal_form methods.",
    "created_at": "2013-09-28T16:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163400",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

I have tried to rebase the patch and, in particular, tried to adapt to the changes from #14319. However, automorphisms of LatticePolytopes do not work yet and there is probably much code that could be rewritten.

As far as the code in lattice_polytope.py is concerned, I've only reformated and not checked what the code actually does.
The same is true for all other normal_form methods.



---

archive/issue_comments_163401.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-09-28T16:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163401",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163402.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-23T14:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163403.json:
```json
{
    "body": "This is now almost at a point where things are working. For now I have removed the attempts at a method finding isomorphisms between two given polytopes.\nThe plan is to write a proper method for general affine transformations in #15280.",
    "created_at": "2013-10-23T14:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163403",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

This is now almost at a point where things are working. For now I have removed the attempts at a method finding isomorphisms between two given polytopes.
The plan is to write a proper method for general affine transformations in #15280.



---

archive/issue_comments_163404.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-28T10:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163404",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-30T11:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163406.json:
```json
{
    "body": "Alright, I think I am more or less done rewriting the patch. I have\n* removed functionality for Laurent normal form and finding isomorphisms between LatticePolytopes. These were broken and at least the latter will be reintroduced (in more general form) in #15280\n* restructured the _palp* methods for computing normal forms in lattice_polytope.py\n* rebased and partially rewritten the code and tried to use the common formatting conventions\n* included permutation read-out directly from PALP\n* extended docstrings and tests\n\nThere are some issues:\nTwo key functions, namely LatticePolytopeClass._palp_normal_form_native and Matrix.permutation_normal_form, both of which calculate the maximal form of a matrix under permutations of columns and rows have fairly tense bits of code and I did not understand everything.\nWhile I verified that after fixing a couple of small errors they now give the correct results for several thousand examples, there may additional bugs. There might also be potential for optimization.\n\nWhat should be done in this case?",
    "created_at": "2013-10-30T12:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163406",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Alright, I think I am more or less done rewriting the patch. I have
* removed functionality for Laurent normal form and finding isomorphisms between LatticePolytopes. These were broken and at least the latter will be reintroduced (in more general form) in #15280
* restructured the _palp* methods for computing normal forms in lattice_polytope.py
* rebased and partially rewritten the code and tried to use the common formatting conventions
* included permutation read-out directly from PALP
* extended docstrings and tests

There are some issues:
Two key functions, namely LatticePolytopeClass._palp_normal_form_native and Matrix.permutation_normal_form, both of which calculate the maximal form of a matrix under permutations of columns and rows have fairly tense bits of code and I did not understand everything.
While I verified that after fixing a couple of small errors they now give the correct results for several thousand examples, there may additional bugs. There might also be potential for optimization.

What should be done in this case?



---

archive/issue_comments_163407.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-30T13:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163407",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_037535.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37535"
}
```



---

archive/issue_events_037536.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37536"
}
```



---

archive/issue_events_037537.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37537"
}
```



---

archive/issue_events_037538.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37538"
}
```



---

archive/issue_comments_163408.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-09T08:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163408",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163409.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T13:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_163410.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-05-12T13:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163410",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_163411.json:
```json
{
    "body": "I've fixed the merge conflict and some minor nitpicks (unnused `_normal_form`, doc build). Functionality looks good to me.",
    "created_at": "2014-05-12T13:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163411",
    "user": "https://github.com/vbraun"
}
```

I've fixed the merge conflict and some minor nitpicks (unnused `_normal_form`, doc build). Functionality looks good to me.



---

archive/issue_comments_163412.json:
```json
{
    "body": "This branch \"undoes\" some of the deprecation-related changes from #15240, let me try to go over it too, will have a version in a few hours.",
    "created_at": "2014-05-12T19:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163412",
    "user": "https://github.com/novoselt"
}
```

This branch "undoes" some of the deprecation-related changes from #15240, let me try to go over it too, will have a version in a few hours.



---

archive/issue_comments_163413.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-12T19:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163413",
    "user": "https://github.com/novoselt"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_163414.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-12T21:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163414",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_163415.json:
```json
{
    "body": "Done!\n\n---\nNew commits:",
    "created_at": "2014-05-12T21:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163415",
    "user": "https://github.com/novoselt"
}
```

Done!

---
New commits:



---

archive/issue_comments_163416.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-13T08:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163416",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163417.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-13T13:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13321#issuecomment-163417",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_037539.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-13T13:11:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13321",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13321#event-37539"
}
```
