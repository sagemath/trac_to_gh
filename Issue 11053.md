# Issue 11053: improve piecewise plotting

archive/issues_011053.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @wdjoyner @jasongrout @jondo @kcrisman @vbraun @slel @mkoeppe @eviatarbach @rwst\n\nUntil we actual totally rewrite piecewise functions, we should improve some things.\n\nFor concreteness, here is one thing that should work but doesn't. I'm sure there are more - add to this list, and then whatever isn't fixed in this ticket can be moved to another ticket.  I just want to make sure they're listed in one place, not ten tickets.\n* plotting more than one\n\n```\nsage: f = Piecewise([[(0,1),x^3], [(1,2),x^2]], x)\nsage: plot([f,x^3],(x,0,2))\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11225\n\n",
    "created_at": "2011-04-20T15:52:28Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "improve piecewise plotting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11053",
    "user": "https://github.com/kcrisman"
}
```
Assignee: jason, was

CC:  @wdjoyner @jasongrout @jondo @kcrisman @vbraun @slel @mkoeppe @eviatarbach @rwst

Until we actual totally rewrite piecewise functions, we should improve some things.

For concreteness, here is one thing that should work but doesn't. I'm sure there are more - add to this list, and then whatever isn't fixed in this ticket can be moved to another ticket.  I just want to make sure they're listed in one place, not ten tickets.
* plotting more than one

```
sage: f = Piecewise([[(0,1),x^3], [(1,2),x^2]], x)
sage: plot([f,x^3],(x,0,2))
```


Issue created by migration from https://trac.sagemath.org/ticket/11225





---

archive/issue_comments_120251.json:
```json
{
    "body": "Regarding the first item (can't plot two of them), It probably wouldn't even be that hard to fix.  The problem is that `setup_for_eval_on_grid` wants to use `fast_float` but `Piecewise` guys don't have that, or more precisely don't have `__float__`.",
    "created_at": "2011-11-03T15:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-120251",
    "user": "https://github.com/kcrisman"
}
```

Regarding the first item (can't plot two of them), It probably wouldn't even be that hard to fix.  The problem is that `setup_for_eval_on_grid` wants to use `fast_float` but `Piecewise` guys don't have that, or more precisely don't have `__float__`.



---

archive/issue_comments_120252.json:
```json
{
    "body": "From DSM on [this ask.sagemath.org question](http://ask.sagemath.org/question/925/piecewise-functions-and-legend-label):\n\n```\n# monkeypatch legend duplication of trac #11225\ndef fix_piecewise(fn):\n    import types\n    def fixed_plot(self, *args, **kwargs): \n        from sage.plot.all import plot\n        return sum([plot(f, a, b, *args, **(dict((k,v) for k,v in kwargs.items() if i == 0 or k != 'legend_label')))\n                    for i, ((a,b),f) in enumerate(self.list())])\n    def fn2(*args, **kwargs):\n        ans = fn(*args, **kwargs)\n        ans.plot = types.MethodType(fixed_plot, ans)\n        return ans\n    return fn2\n\nPiecewise = fix_piecewise(Piecewise)\n```\n\nNice protopatch, perhaps?",
    "created_at": "2011-11-22T17:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-120252",
    "user": "https://github.com/kcrisman"
}
```

From DSM on [this ask.sagemath.org question](http://ask.sagemath.org/question/925/piecewise-functions-and-legend-label):

```
# monkeypatch legend duplication of trac #11225
def fix_piecewise(fn):
    import types
    def fixed_plot(self, *args, **kwargs): 
        from sage.plot.all import plot
        return sum([plot(f, a, b, *args, **(dict((k,v) for k,v in kwargs.items() if i == 0 or k != 'legend_label')))
                    for i, ((a,b),f) in enumerate(self.list())])
    def fn2(*args, **kwargs):
        ans = fn(*args, **kwargs)
        ans.plot = types.MethodType(fixed_plot, ans)
        return ans
    return fn2

Piecewise = fix_piecewise(Piecewise)
```

Nice protopatch, perhaps?



---

archive/issue_comments_120253.json:
```json
{
    "body": "I removed the last bullet point and created #12651 where I'll post a patch with dsm's fix.",
    "created_at": "2012-03-10T18:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-120253",
    "user": "https://github.com/orlitzky"
}
```

I removed the last bullet point and created #12651 where I'll post a patch with dsm's fix.



---

archive/issue_comments_120254.json:
```json
{
    "body": "Changing keywords from \"\" to \"piecewise\".",
    "created_at": "2016-06-25T18:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-120254",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "piecewise".



---

archive/issue_comments_120255.json:
```json
{
    "body": "Updated description for new `piecewise` (#14801).\nDidn't check the xmin/xmax etc. behavior that is mentioned in the description.\n\nThis can probably be closed when the old `Piecewise` (now deprecated) is removed completely.",
    "created_at": "2016-06-25T18:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11053#issuecomment-120255",
    "user": "https://github.com/mkoeppe"
}
```

Updated description for new `piecewise` (#14801).
Didn't check the xmin/xmax etc. behavior that is mentioned in the description.

This can probably be closed when the old `Piecewise` (now deprecated) is removed completely.
