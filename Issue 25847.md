# Issue 25847: Detect default colorscheme (dark/light)

archive/issues_025847.json:
```json
{
    "body": "CC:  @kwankyu @jhpalmieri\n\nThe default sage colorscheme is pretty much [unreadable](https://ask.sagemath.org/question/10060/sage-terminal-colors/) on a black background. I can fix this by putting `%colors Linux` in `init.sage`, but every user with a dark terminal background has to figure that out for themselves.\n\nWe should be automatically setting that value. Unfortunately, figuring out the terminal background reliably is no easy task. Some terminals set `COLORFGBG`, others react to xterm queries. Resources:\n\n- a bash script that seems to be pretty relilable: https://github.com/rocky/bash-term-background/blob/master/term-background.sh\n- an attempt to implement it in python, based on [this question](https://stackoverflow.com/questions/45426412/an-xterm-compatible-tty-color-query-command). For me that works with xterm but not with termite (while the bash script does work with termite): https://github.com/rocky/python-term-background\n- the way emacs does it: https://github.com/emacs-mirror/emacs/blob/master/lisp/term/xterm.el#L722\n- [apparently](https://bugzilla.gnome.org/show_bug.cgi?id=733423) [xtermcontrol](https://thrysoee.dk/xtermcontrol/) provides a `--get-bg` option and it works for me. [soruce mirror on github](https://github.com/JessThrysoee/xtermcontrol)\n- python library to get terminal colors, I didn't test this: https://github.com/dranjan/termcolors\n- neovim issue to re-add detection (vim supports this, apparently got lost during neovim refactoring). Includes vim code snippet: https://github.com/neovim/neovim/issues/2764\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26084\n\n",
    "created_at": "2018-08-17T12:26:31Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Detect default colorscheme (dark/light)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25847",
    "user": "https://github.com/timokau"
}
```
CC:  @kwankyu @jhpalmieri

The default sage colorscheme is pretty much [unreadable](https://ask.sagemath.org/question/10060/sage-terminal-colors/) on a black background. I can fix this by putting `%colors Linux` in `init.sage`, but every user with a dark terminal background has to figure that out for themselves.

We should be automatically setting that value. Unfortunately, figuring out the terminal background reliably is no easy task. Some terminals set `COLORFGBG`, others react to xterm queries. Resources:

- a bash script that seems to be pretty relilable: https://github.com/rocky/bash-term-background/blob/master/term-background.sh
- an attempt to implement it in python, based on [this question](https://stackoverflow.com/questions/45426412/an-xterm-compatible-tty-color-query-command). For me that works with xterm but not with termite (while the bash script does work with termite): https://github.com/rocky/python-term-background
- the way emacs does it: https://github.com/emacs-mirror/emacs/blob/master/lisp/term/xterm.el#L722
- [apparently](https://bugzilla.gnome.org/show_bug.cgi?id=733423) [xtermcontrol](https://thrysoee.dk/xtermcontrol/) provides a `--get-bg` option and it works for me. [soruce mirror on github](https://github.com/JessThrysoee/xtermcontrol)
- python library to get terminal colors, I didn't test this: https://github.com/dranjan/termcolors
- neovim issue to re-add detection (vim supports this, apparently got lost during neovim refactoring). Includes vim code snippet: https://github.com/neovim/neovim/issues/2764


Issue created by migration from https://trac.sagemath.org/ticket/26084





---

archive/issue_comments_364387.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to user interface.",
    "created_at": "2018-08-17T12:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364387",
    "user": "https://github.com/timokau"
}
```

Changing component from PLEASE CHANGE to user interface.



---

archive/issue_comments_364388.json:
```json
{
    "body": "There's no need to detect the terminal colors. This issue is due to the \"SageIpythonConfiguration.colors()\" function returning 'LightBG' in sage/repl/configuration.py.\n\nTo fix, it's as simple as returning 'Neutral', or better yet getting the default option from iPython via the SageTerminalInteractiveShell.colors.default()",
    "created_at": "2022-11-04T12:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364388",
    "user": "https://github.com/CryptoPunk"
}
```

There's no need to detect the terminal colors. This issue is due to the "SageIpythonConfiguration.colors()" function returning 'LightBG' in sage/repl/configuration.py.

To fix, it's as simple as returning 'Neutral', or better yet getting the default option from iPython via the SageTerminalInteractiveShell.colors.default()



---

archive/issue_comments_364389.json:
```json
{
    "body": "I've followed the second suggestion",
    "created_at": "2022-11-12T22:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364389",
    "user": "https://github.com/mkoeppe"
}
```

I've followed the second suggestion



---

archive/issue_comments_364390.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-12T22:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364390",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_065104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-11-12T22:45:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25847#event-65104"
}
```



---

archive/issue_comments_364391.json:
```json
{
    "body": "At a quick glance it looks good. I might prefer the old style with a light background window, but this one looks much better with a dark background and is serviceable with either.\n\n---\nNew commits:",
    "created_at": "2022-11-13T01:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364391",
    "user": "https://github.com/jhpalmieri"
}
```

At a quick glance it looks good. I might prefer the old style with a light background window, but this one looks much better with a dark background and is serviceable with either.

---
New commits:



---

archive/issue_comments_364392.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-14T03:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364392",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364393.json:
```json
{
    "body": "If we're convinced that there is no viable way to detect a light or dark color scheme (and it seems that way from the ticket description), then this is the right solution.",
    "created_at": "2022-11-14T03:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364393",
    "user": "https://github.com/jhpalmieri"
}
```

If we're convinced that there is no viable way to detect a light or dark color scheme (and it seems that way from the ticket description), then this is the right solution.



---

archive/issue_events_065105.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-11-15T23:43:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25847#event-65105"
}
```



---

archive/issue_comments_364394.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-11-15T23:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25847",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25847#issuecomment-364394",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
