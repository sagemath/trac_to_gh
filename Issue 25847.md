# Issue 25847: Detect default colorscheme (dark/light)

Issue created by migration from https://trac.sagemath.org/ticket/26084

Original creator: @timokau

Original creation time: 2018-08-17 12:26:31

CC:  klee jhpalmieri

The default sage colorscheme is pretty much [unreadable](https://ask.sagemath.org/question/10060/sage-terminal-colors/) on a black background. I can fix this by putting `%colors Linux` in `init.sage`, but every user with a dark terminal background has to figure that out for themselves.

We should be automatically setting that value. Unfortunately, figuring out the terminal background reliably is no easy task. Some terminals set `COLORFGBG`, others react to xterm queries. Resources:

- a bash script that seems to be pretty relilable: https://github.com/rocky/bash-term-background/blob/master/term-background.sh
- an attempt to implement it in python, based on [this question](https://stackoverflow.com/questions/45426412/an-xterm-compatible-tty-color-query-command). For me that works with xterm but not with termite (while the bash script does work with termite): https://github.com/rocky/python-term-background
- the way emacs does it: https://github.com/emacs-mirror/emacs/blob/master/lisp/term/xterm.el#L722
- [apparently](https://bugzilla.gnome.org/show_bug.cgi?id=733423) [xtermcontrol](https://thrysoee.dk/xtermcontrol/) provides a `--get-bg` option and it works for me. [soruce mirror on github](https://github.com/JessThrysoee/xtermcontrol)
- python library to get terminal colors, I didn't test this: https://github.com/dranjan/termcolors
- neovim issue to re-add detection (vim supports this, apparently got lost during neovim refactoring). Includes vim code snippet: https://github.com/neovim/neovim/issues/2764



---

Comment by @timokau created at 2018-08-17 12:27:16

Changing component from PLEASE CHANGE to user interface.


---

Comment by @CryptoPunk created at 2022-11-04 12:28:05

There's no need to detect the terminal colors. This issue is due to the "SageIpythonConfiguration.colors()" function returning 'LightBG' in sage/repl/configuration.py.

To fix, it's as simple as returning 'Neutral', or better yet getting the default option from iPython via the SageTerminalInteractiveShell.colors.default()


---

Comment by mkoeppe created at 2022-11-12 22:45:38

I've followed the second suggestion


---

Comment by mkoeppe created at 2022-11-12 22:45:38

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-11-13 01:57:02

At a quick glance it looks good. I might prefer the old style with a light background window, but this one looks much better with a dark background and is serviceable with either.
----
New commits:


---

Comment by jhpalmieri created at 2022-11-14 03:57:27

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2022-11-14 03:57:27

If we're convinced that there is no viable way to detect a light or dark color scheme (and it seems that way from the ticket description), then this is the right solution.


---

Comment by vbraun created at 2022-11-15 23:43:14

Resolution: fixed
