# Issue 26330: clean dense_graph.pyx

Issue created by migration from https://trac.sagemath.org/ticket/26567

Original creator: dcoudert

Original creation time: 2018-10-27 12:50:39

CC:  tscrim chapoton

Keywords: py3, graph

The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.

We also do PEP8 cleaning.


---

Comment by dcoudert created at 2018-10-27 12:54:18

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-10-27 12:54:18

New commits:


---

Comment by tscrim created at 2018-10-27 13:08:08

On the error messages, please remove the `!`.

I think a better way to do

```python
                        try:
                            v, u = sorted((self.vertex_label(v_int),
                                           self.vertex_label(u_int)))
                        except TypeError:
                            v = self.vertex_label(v_int)
                            u = self.vertex_label(u_int)
```

is to do

```python
                        v = self.vertex_label(v_int)
                        u = self.vertex_label(u_int)
                        try:
                            if u < v:
                                v, u = u, v
                        except TypeError:
                            pass
```

as it does not create an intermediary objects (the tuple and the resulting list), I would guess one comparison is faster than calling `sorted`, and we only change things if we need to.


---

Comment by git created at 2018-10-27 14:20:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-27 14:22:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-27 14:23:34

All comment's implemented.


---

Comment by tscrim created at 2018-10-27 14:38:42

Thanks. I just want to wait for a green patchbot. Once one comes back (morally) green, we can set a positive review.


---

Comment by tscrim created at 2018-10-27 19:01:31

The doctest failures seem unrelated.


---

Comment by tscrim created at 2018-10-27 19:01:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-29 22:46:32

Resolution: fixed


---

Comment by jhpalmieri created at 2018-11-29 00:34:16

Are there any plans for similar changes to sparse_graph.pyx, in particular to `iterator_edges`? I tried doing something similar, but it led to other problems, so it would be better if someone who knows the graph theory stuff better to do it. The code in sparse_graph.pyx leads to Python 3 doctest failures with simplicial complexes.
