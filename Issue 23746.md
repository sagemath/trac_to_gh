# Issue 23746: dot2tex breaks docbuild

Issue created by migration from https://trac.sagemath.org/ticket/23983

Original creator: jdemeyer

Original creation time: 2017-10-07 10:33:25

CC:  mderickx nthiery




---

Comment by jdemeyer created at 2017-10-07 12:43:35

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-10-07 12:43:35

New commits:


---

Comment by mderickx created at 2017-10-07 20:30:24

Wouldn't it be better to check for wether Graphviz is installed during the installation of dot2tex an raise an appropriate error telling the user to install graphviz if it is not? I find it a bit confusing that now after a succesfull:


```
sage -i dot2tex
```


one still can have  `have_dot2tex()` return false.


---

Comment by mderickx created at 2017-10-07 22:36:40

P.s. the experimental package graphiz still builds on OS X but apparently not on other platforms, see #7438 .


---

Comment by tscrim created at 2017-10-08 01:49:43

We basically require a system-wide installation of Graphviz because I don't think anyone uses the broken(? and outdated?) experimental package. So Graphviz is a dependency, but not during the installation of dot2tex. I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.


---

Comment by mantepse created at 2017-10-08 05:58:49

Replying to [comment:7 tscrim]:
> I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.

Yes, please - together with a helpful error message!  That would have saved me quite some time in the past.


---

Comment by tscrim created at 2017-10-09 04:23:01

I do not object to the change here as it matches the docstring. However, I think we should have the same changes in `assert_have_dot2tex`.


---

Comment by jdemeyer created at 2017-10-09 08:42:56

I think the question is: could it ever make sense to run `dot2tex` _without_ graphviz? If there is some (even minor) usefulness to dot2tex without graphviz, then graphviz should not be a dependency of dot2tex.


---

Comment by jdemeyer created at 2017-10-09 13:30:10

The description on PyPI says "Dot2tex is a tool for converting graphs rendered by Graphviz to formats that can be used with LaTeX."

So I guess that one could consider graphviz to be a hard dependency.


---

Comment by mderickx created at 2017-10-09 14:00:46

I also checked the sage code on occurrences of dot2tex, and they where all related to `set_latex_options` of graphs or things that render like graphs. The documentation of `set_latex_options` also clearly state that graph layout programs have to be one of the graphviz layout programs.

It is in theory possible for another program then one from graphviz suite to generate dot files, however all things that I have seen outside of sage (like [gprof2dot](https://github.com/jrfonseca/gprof2dot)) all have graphviz as a dependency since the dot file is a standard created by graphviz and graphviz provides a lot of utilities for generating/manipulating dot files.

I am for a hard dependency as well since at the moment dot2tex in sage is completely useless without graphviz, and I think it will be very unlikely that use cases of the dot file format will pop up in the future that do not in some way or another require graphviz.


---

Comment by mderickx created at 2017-10-09 14:10:20

And to the above I would like to add that having a hard dependency will make the user experience of sage less confusing. Since I think:


```
sage -i dot2tex
Error: you should install graphviz from http://www.graphviz.org/Download..php
```


is a better user experience then `sage -i dot2tex` seemingly succeeding, but all the places in sage that say they require dot2tex not working as they should, or falling back to an implementation not using dot2tex .


---

Comment by git created at 2017-10-10 09:58:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mderickx created at 2017-10-10 11:52:23

I tested that with this ticket dot2tex fails to install if graphviz is not installed and that it correctly installs if graphviz is installed. The error message looks very clear.


---

Comment by mderickx created at 2017-10-10 11:52:23

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-10-10 15:27:22

Typo? `http://www.graphviz.org/Download..php"`


---

Comment by mderickx created at 2017-10-10 15:52:00

Nope, I was surprised as well, but that is actually the link. It works without the double dot as well, but will then redirect you to the double dot version.


---

Comment by vbraun created at 2017-10-16 22:45:01

Resolution: fixed
