# Issue 23746: dot2tex breaks docbuild

archive/issues_023746.json:
```json
{
    "body": "CC:  @koffie @nthiery\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23983\n\n",
    "created_at": "2017-10-07T10:33:25Z",
    "labels": [
        "packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "dot2tex breaks docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23746",
    "user": "@jdemeyer"
}
```
CC:  @koffie @nthiery



Issue created by migration from https://trac.sagemath.org/ticket/23983





---

archive/issue_comments_332724.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-07T12:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332724",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332725.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-07T12:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332725",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_332726.json:
```json
{
    "body": "Wouldn't it be better to check for wether Graphviz is installed during the installation of dot2tex an raise an appropriate error telling the user to install graphviz if it is not? I find it a bit confusing that now after a succesfull:\n\n\n```\nsage -i dot2tex\n```\n\n\none still can have  `have_dot2tex()` return false.",
    "created_at": "2017-10-07T20:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332726",
    "user": "@koffie"
}
```

Wouldn't it be better to check for wether Graphviz is installed during the installation of dot2tex an raise an appropriate error telling the user to install graphviz if it is not? I find it a bit confusing that now after a succesfull:


```
sage -i dot2tex
```


one still can have  `have_dot2tex()` return false.



---

archive/issue_comments_332727.json:
```json
{
    "body": "P.s. the experimental package graphiz still builds on OS X but apparently not on other platforms, see #7438 .",
    "created_at": "2017-10-07T22:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332727",
    "user": "@koffie"
}
```

P.s. the experimental package graphiz still builds on OS X but apparently not on other platforms, see #7438 .



---

archive/issue_comments_332728.json:
```json
{
    "body": "We basically require a system-wide installation of Graphviz because I don't think anyone uses the broken(? and outdated?) experimental package. So Graphviz is a dependency, but not during the installation of dot2tex. I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.",
    "created_at": "2017-10-08T01:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332728",
    "user": "@tscrim"
}
```

We basically require a system-wide installation of Graphviz because I don't think anyone uses the broken(? and outdated?) experimental package. So Graphviz is a dependency, but not during the installation of dot2tex. I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.



---

archive/issue_comments_332729.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.\n\nYes, please - together with a helpful error message!  That would have saved me quite some time in the past.",
    "created_at": "2017-10-08T05:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332729",
    "user": "@mantepse"
}
```

Replying to [comment:7 tscrim]:
> I would be in favor of erroring out of a dot2tex installation if Graphviz is not installed.

Yes, please - together with a helpful error message!  That would have saved me quite some time in the past.



---

archive/issue_comments_332730.json:
```json
{
    "body": "I do not object to the change here as it matches the docstring. However, I think we should have the same changes in `assert_have_dot2tex`.",
    "created_at": "2017-10-09T04:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332730",
    "user": "@tscrim"
}
```

I do not object to the change here as it matches the docstring. However, I think we should have the same changes in `assert_have_dot2tex`.



---

archive/issue_comments_332731.json:
```json
{
    "body": "I think the question is: could it ever make sense to run `dot2tex` *without* graphviz? If there is some (even minor) usefulness to dot2tex without graphviz, then graphviz should not be a dependency of dot2tex.",
    "created_at": "2017-10-09T08:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332731",
    "user": "@jdemeyer"
}
```

I think the question is: could it ever make sense to run `dot2tex` *without* graphviz? If there is some (even minor) usefulness to dot2tex without graphviz, then graphviz should not be a dependency of dot2tex.



---

archive/issue_comments_332732.json:
```json
{
    "body": "The description on PyPI says \"Dot2tex is a tool for converting graphs rendered by Graphviz to formats that can be used with LaTeX.\"\n\nSo I guess that one could consider graphviz to be a hard dependency.",
    "created_at": "2017-10-09T13:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332732",
    "user": "@jdemeyer"
}
```

The description on PyPI says "Dot2tex is a tool for converting graphs rendered by Graphviz to formats that can be used with LaTeX."

So I guess that one could consider graphviz to be a hard dependency.



---

archive/issue_comments_332733.json:
```json
{
    "body": "I also checked the sage code on occurrences of dot2tex, and they where all related to `set_latex_options` of graphs or things that render like graphs. The documentation of `set_latex_options` also clearly state that graph layout programs have to be one of the graphviz layout programs.\n\nIt is in theory possible for another program then one from graphviz suite to generate dot files, however all things that I have seen outside of sage (like [gprof2dot](https://github.com/jrfonseca/gprof2dot)) all have graphviz as a dependency since the dot file is a standard created by graphviz and graphviz provides a lot of utilities for generating/manipulating dot files.\n\nI am for a hard dependency as well since at the moment dot2tex in sage is completely useless without graphviz, and I think it will be very unlikely that use cases of the dot file format will pop up in the future that do not in some way or another require graphviz.",
    "created_at": "2017-10-09T14:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332733",
    "user": "@koffie"
}
```

I also checked the sage code on occurrences of dot2tex, and they where all related to `set_latex_options` of graphs or things that render like graphs. The documentation of `set_latex_options` also clearly state that graph layout programs have to be one of the graphviz layout programs.

It is in theory possible for another program then one from graphviz suite to generate dot files, however all things that I have seen outside of sage (like [gprof2dot](https://github.com/jrfonseca/gprof2dot)) all have graphviz as a dependency since the dot file is a standard created by graphviz and graphviz provides a lot of utilities for generating/manipulating dot files.

I am for a hard dependency as well since at the moment dot2tex in sage is completely useless without graphviz, and I think it will be very unlikely that use cases of the dot file format will pop up in the future that do not in some way or another require graphviz.



---

archive/issue_comments_332734.json:
```json
{
    "body": "And to the above I would like to add that having a hard dependency will make the user experience of sage less confusing. Since I think:\n\n\n```\nsage -i dot2tex\nError: you should install graphviz from http://www.graphviz.org/Download..php\n```\n\n\nis a better user experience then `sage -i dot2tex` seemingly succeeding, but all the places in sage that say they require dot2tex not working as they should, or falling back to an implementation not using dot2tex .",
    "created_at": "2017-10-09T14:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332734",
    "user": "@koffie"
}
```

And to the above I would like to add that having a hard dependency will make the user experience of sage less confusing. Since I think:


```
sage -i dot2tex
Error: you should install graphviz from http://www.graphviz.org/Download..php
```


is a better user experience then `sage -i dot2tex` seemingly succeeding, but all the places in sage that say they require dot2tex not working as they should, or falling back to an implementation not using dot2tex .



---

archive/issue_comments_332735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-10T09:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332735",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_332736.json:
```json
{
    "body": "I tested that with this ticket dot2tex fails to install if graphviz is not installed and that it correctly installs if graphviz is installed. The error message looks very clear.",
    "created_at": "2017-10-10T11:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332736",
    "user": "@koffie"
}
```

I tested that with this ticket dot2tex fails to install if graphviz is not installed and that it correctly installs if graphviz is installed. The error message looks very clear.



---

archive/issue_comments_332737.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-10T11:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332737",
    "user": "@koffie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332738.json:
```json
{
    "body": "Typo? `http://www.graphviz.org/Download..php\"`",
    "created_at": "2017-10-10T15:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332738",
    "user": "@tscrim"
}
```

Typo? `http://www.graphviz.org/Download..php"`



---

archive/issue_comments_332739.json:
```json
{
    "body": "Nope, I was surprised as well, but that is actually the link. It works without the double dot as well, but will then redirect you to the double dot version.",
    "created_at": "2017-10-10T15:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332739",
    "user": "@koffie"
}
```

Nope, I was surprised as well, but that is actually the link. It works without the double dot as well, but will then redirect you to the double dot version.



---

archive/issue_comments_332740.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-16T22:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23746#issuecomment-332740",
    "user": "@vbraun"
}
```

Resolution: fixed
