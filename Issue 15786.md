# Issue 15786: remove deprecated code in functions/ and symbolic/

Issue created by migration from https://trac.sagemath.org/ticket/16023

Original creator: rws

Original creation time: 2014-03-27 15:18:46

Keywords: deprecation




---

Comment by rws created at 2014-03-27 15:21:45

Changing status from new to needs_review.


---

Comment by rws created at 2014-03-27 15:21:45

New commits:


---

Comment by burcin created at 2014-03-27 16:52:00

Changing status from needs_review to needs_work.


---

Comment by burcin created at 2014-03-27 16:52:00

Many thanks for cleaning up!

It looks like some function bodies are reduced to `BuiltinFunction.__call__()` or `GinacFunction.__call__()`. Moving the doctest somewhere else and removing these functions would be better.


---

Comment by git created at 2014-03-27 17:27:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-03-27 17:29:03

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-03-27 17:29:03

Thanks. I believe you mean `Ei` and `exp`.


---

Comment by burcin created at 2014-03-27 17:33:19

Looks good to me. You can switch to positive review once the patchbot gives it a greenlight. (Does patchbot work with the git workflow now?)


---

Comment by git created at 2014-03-27 17:35:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-03-29 08:31:48

Replying to [comment:5 burcin]:
> Looks good to me. You can switch to positive review once the patchbot gives it a greenlight. (Does patchbot work with the git workflow now?)

Not here. This is still unresolved:
https://github.com/robertwb/sage-patchbot/issues/10

Thanks.


---

Comment by kcrisman created at 2014-04-01 14:33:05

The Bessel functions weren't removed that long ago, and note that there is a LOT more to be removed - namely, the whole underscore versions of them, see https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1102 - basically to the end of the document.

Still, hopefully it wouldn't be a problem.  I am pretty sure that all the doctests in the stuff to be removed is replicated elsewhere, but it might be worth checking out just to be sure.   Also note that [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1071) there is a small bit to be removed.  I wouldn't cry if the whole Bessel removal were another ticket.


---

Comment by rws created at 2014-04-15 07:08:49

Last 10 new commits:


---

Comment by rws created at 2014-04-15 07:49:19

Oops wrong branch.


---

Comment by kcrisman created at 2014-04-15 19:04:44

Now the branch doesn't seem to be coming up...


---

Comment by git created at 2014-04-16 14:14:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-04-16 14:16:21

Replying to [comment:8 kcrisman]:
> The Bessel functions weren't removed that long ago, and note that there is a LOT more to be removed - namely, the whole underscore versions of them, see https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1102 - basically to the end of the document.
This is now #16173 
> ... Also note that [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1071) there is a small bit to be removed.
Done.


---

Comment by kcrisman created at 2014-04-17 01:13:18

I'm really sorry to be nitpicky, this is actually really good to do.
> > The Bessel functions weren't removed that long ago, and note that there is a LOT more to be removed - namely, the whole underscore versions of them, see https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1102 - basically to the end of the document.
> This is now #16173 
Do you want to wait on removing the deprecated Bessel things to there, then?  I guess that's my point.  (But not the little bit below about `prec`, that is okay to remove here.)
> > ... Also note that [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/bessel.py?id=9db8c5c598ec9de953a33b14e531bee3c092c199#n1071) there is a small bit to be removed.
> Done.
And if you can still keep a doctest which does something like `gamma(6.)` that would be useful, as it seems to sometimes unlock inconsistencies on different platforms we otherwise might not know about.

```
sage: search_src("gamma\(6")
functions/other.py:758:            sage: gamma(6, prec=53)
functions/other.py:820:            sage: log_gamma(6)
functions/other.py:822:            sage: log_gamma(6.)
functions/other.py:824:            sage: log_gamma(6).n()
functions/other.py:997:            sage: gamma(6)
rings/rational.pyx:2920:            sage: gamma(6/1)
```

The following test ought to do it.

```
sage: gamma(6.)
120.000000000000
```



---

Comment by git created at 2014-05-04 09:30:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-29 13:56:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-28 13:15:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-08-15 04:28:48

Somewhat surprisingly, given the attention to detail you've clearly given, there is still work to be done here - but easy work, I believe.

* In other.py, in the `__call__` method for gamma, there is still an import of deprecation which is now not needed.
* [comment:7:ticket:7490 This comment] suggests that perhaps 

```
sage: Q.<i> = NumberField(x^2+1) 
sage: gamma(i) 
```

  should not work at all.  So either we should confirm it raises an error, check what "should" happen, or make it break...


---

Comment by kcrisman created at 2014-08-15 04:31:09

Burcin, in case you're reading this - what was your intent with that doctest?   Should this not work because an embedding needs to be specified, or should it "just work"?


---

Comment by kcrisman created at 2014-08-15 07:37:11

Also, after #16173 and #16737 this one will probably be a little smaller.


---

Comment by git created at 2014-08-20 14:03:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-08-27 19:18:43

> * In other.py, in the `__call__` method for gamma, there is still an import of deprecation which is now not needed.
Still needed, I believe.
> * [comment:7:ticket:7490 This comment] suggests that perhaps 
> {{{
> sage: Q.<i> = NumberField(x^2+1) 
> sage: gamma(i) 
> }}}
>   should not work at all.  So either we should confirm it raises an error, check what "should" happen, or make it break...
Given that `e^i`, `ln(i)`, and `sqrt(i)` all fail in this case for various reasons related to embedding, maybe this should really be broken now.  Since

```
            if not str(err).startswith("cannot coerce"):
                raise
```

suggests that this is the only kind of error we treat, and then we just plop it in RR or CC as we can, I suppose we could remove that entire thing and do

```
return GinacFunction.__call__(self, x, coerce=coerce, hold=hold)
```

as the entire body of call or even remove it.  What do you think?


---

Comment by burcin created at 2014-08-28 03:19:54

Replying to [comment:21 kcrisman]:
> Burcin, in case you're reading this - what was your intent with that doctest?   Should this not work because an embedding needs to be specified, or should it "just work"?

Right. It shouldn't work without specifying an explicit embedding in the `NumberField` constructor.

I don't have time to try the patch now. It would be nice to give the user a helpful error message in this case, but I have no idea how much trouble that is.


---

Comment by kcrisman created at 2014-08-28 14:22:14

Thanks, Burcin!

Okay, I will look at this today, then.  Here are a few notes to myself so I don't forget (they are probably taken care of elsewhere or not needed):
 * make sure 13608 is still doctested
 * check whether 2607, 6094, 10859 were doctested and remove those if needed
 * see if just raising a slightly different error message in the number field case will be enough


---

Comment by kcrisman created at 2014-08-28 15:46:01

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2014-08-28 15:46:01

>  * make sure 13608 is still doctested
Yeah, although something similar is tested in symbolic/function.pyx this is testing something very specific to exp, so that test should be kept, probably just in the same place as the other example, or in some generic tests place in the file.
>  * check whether 2607, 6094, 10859 were doctested and remove those if needed
The 2607 stuff actually just removes the deprecated _method_ for local max/min, but there is also the deprecated function it depended on which we might as well remove at the same time, seems weird not to

```
numerical/optimize.py:233:find_maximum_on_interval = deprecated_function_alias(2607, find_local_maximum)
numerical/optimize.py:234:find_minimum_on_interval = deprecated_function_alias(2607, find_local_minimum)
```

These don't seem to have been tested, though, which is good for this ticket.  The stuff for 6094 I found is unrelated to this ticket and not high priority, and 10859 was already all set.
>  * see if just raising a slightly different error message in the number field case will be enough
Here is current status if I just remove the call method entirely like you did the others.

```
sage: gamma(i).n()
-0.154949828301811 - 0.498015668118356*I
sage: Q.<i> = NumberField(x^2+1)
sage: gamma(i)
---------------------------------------------------------------------------
TypeError: cannot coerce arguments: no canonical coercion from Number Field in i with defining polynomial x^2 + 1 to Symbolic Ring
```

I guess we could keep the method and raise an error about embedding, or keep this one.  This is the only doctest failure in either directory, and we would want to rescue the tests from that module.

----

What do you think?  I hope it's okay with the multi back and forth on this.


---

Comment by rws created at 2014-09-03 09:33:40

Well then, is this still really needs_work?


---

Comment by kcrisman created at 2014-09-03 12:28:46

> Well then, is this still really needs_work?
Yes, because currently 

```
sage: Q.<i> = NumberField(x^2+1) 
sage: gamma(i) 
```

doesn't just work, it is doctested!  But the discussion above confirms it should not be allowed to work.

So, as I said [comment:27:ticket:16023 above], we can either remove the call method entirely and then doctest that error, or keep it and make sure it raises an error about embedding as appropriate.  We should also rescue the _correct_ doctests from that method and put them somewhere as tests.


---

Comment by git created at 2014-09-03 14:11:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-09-03 14:13:45

Ah ok. I should have looked into it better. I think after the buildbot thumbs up this can be set to positive?


---

Comment by rws created at 2014-09-03 14:13:45

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2014-09-03 15:21:50

Yup, thanks!


---

Comment by rws created at 2014-09-04 06:36:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-09-06 11:02:57

Resolution: fixed
