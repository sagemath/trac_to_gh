# Issue 23763: is_planar, error when circular=True

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2017-10-09 18:28:18


```
sage: g = graphs.CubeGraph(3)
sage: g.is_circular_planar()
False
sage: from sage.graphs.planarity import is_planar
sage: is_planar(g, circular=True)
True
```




---

Comment by dcoudert created at 2017-10-12 11:35:03

To the best of my understanding, the `is_planar` method is not to be called directly. This could be clarified from its documentation.

The `is_circular_planar` method first adds an extra vertex to the graph and an edge from each vertex at the boundary to it. In our case, the extra vertex is a universal vertex connected to all vertices of the graph.
Then, is calls `is_planar` on this modified graph.


```
sage: g = graphs.CubeGraph(3)
sage: g.is_circular_planar()
False
sage: h = copy(g)
sage: extra = h.add_vertex()
sage: h.add_edges([(u,extra) for u in h if u!=extra])
sage: is_planar(h,circular=True)
False
```



---

Comment by jmantysalo created at 2017-10-12 13:31:30

So the `circular` only makes sense when the user does not use the return value but uses `set_pos`-argument? At least the code could check this and raise an error when `cicular and not set_pos`.


---

Comment by dcoudert created at 2017-10-16 11:28:27

I don't get what you mean. My understanding is that the `is_planar` method is for internal use only. One can however clarify the meaning of the parameters and the combinations of parameters.


---

Comment by jmantysalo created at 2017-10-16 12:55:16

Can you give an example where `circular=True` would be used?

Only place in the source I found was

`result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`

at `src/sage/graphs/generic_graph.py`, but before the call the code adds an extra vertex. So I don't quite understand.


---

Comment by dcoudert created at 2017-10-25 12:11:04

The `is_planar` method from `planarity` is used twice in `generic_graph.py`.
- in method `is_planar` we have `planar = is_planar(G,kuratowski=kuratowski,set_pos=set_pos,set_embedding=set_embedding)`. In this case it is used with the default value, so `circular=False`.
- in method `is_circular_planar` we have `result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`


---

Comment by jmantysalo created at 2017-10-25 15:55:43

But if I say


```
for g in graphs(6):
    if not g.is_connected():
        continue
    if g.is_circular_planar(set_pos=True):
        g.show()
```


I get some planar but not outerplanar drawings.


---

Comment by dcoudert created at 2017-10-25 16:44:13

If you check more carefully method `is_circular_planar`, you will see at the end a call to

```
            if (set_pos and set_embedding):
                self.set_planar_positions()
```

and here is your problem. The positions have nothing to do with the existence of a circular planar layout, but with a planar layout. In other words, we are missing a method ensuring a circular planar layout and more generally an outer planar layout.


---

Comment by jmantysalo created at 2017-10-26 12:38:13

Then shoudn't we disable `set_pos` for `is_circular_planar`?
