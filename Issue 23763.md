# Issue 23763: is_planar, error when circular=True

archive/issues_023763.json:
```json
{
    "body": "\n```\nsage: g = graphs.CubeGraph(3)\nsage: g.is_circular_planar()\nFalse\nsage: from sage.graphs.planarity import is_planar\nsage: is_planar(g, circular=True)\nTrue\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24000\n\n",
    "created_at": "2017-10-09T18:28:18Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "is_planar, error when circular=True",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23763",
    "user": "https://github.com/jm58660"
}
```

```
sage: g = graphs.CubeGraph(3)
sage: g.is_circular_planar()
False
sage: from sage.graphs.planarity import is_planar
sage: is_planar(g, circular=True)
True
```



Issue created by migration from https://trac.sagemath.org/ticket/24000





---

archive/issue_comments_332572.json:
```json
{
    "body": "To the best of my understanding, the `is_planar` method is not to be called directly. This could be clarified from its documentation.\n\nThe `is_circular_planar` method first adds an extra vertex to the graph and an edge from each vertex at the boundary to it. In our case, the extra vertex is a universal vertex connected to all vertices of the graph.\nThen, is calls `is_planar` on this modified graph.\n\n\n```\nsage: g = graphs.CubeGraph(3)\nsage: g.is_circular_planar()\nFalse\nsage: h = copy(g)\nsage: extra = h.add_vertex()\nsage: h.add_edges([(u,extra) for u in h if u!=extra])\nsage: is_planar(h,circular=True)\nFalse\n```\n",
    "created_at": "2017-10-12T11:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332572",
    "user": "https://github.com/dcoudert"
}
```

To the best of my understanding, the `is_planar` method is not to be called directly. This could be clarified from its documentation.

The `is_circular_planar` method first adds an extra vertex to the graph and an edge from each vertex at the boundary to it. In our case, the extra vertex is a universal vertex connected to all vertices of the graph.
Then, is calls `is_planar` on this modified graph.


```
sage: g = graphs.CubeGraph(3)
sage: g.is_circular_planar()
False
sage: h = copy(g)
sage: extra = h.add_vertex()
sage: h.add_edges([(u,extra) for u in h if u!=extra])
sage: is_planar(h,circular=True)
False
```




---

archive/issue_comments_332573.json:
```json
{
    "body": "So the `circular` only makes sense when the user does not use the return value but uses `set_pos`-argument? At least the code could check this and raise an error when `cicular and not set_pos`.",
    "created_at": "2017-10-12T13:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332573",
    "user": "https://github.com/jm58660"
}
```

So the `circular` only makes sense when the user does not use the return value but uses `set_pos`-argument? At least the code could check this and raise an error when `cicular and not set_pos`.



---

archive/issue_comments_332574.json:
```json
{
    "body": "I don't get what you mean. My understanding is that the `is_planar` method is for internal use only. One can however clarify the meaning of the parameters and the combinations of parameters.",
    "created_at": "2017-10-16T11:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332574",
    "user": "https://github.com/dcoudert"
}
```

I don't get what you mean. My understanding is that the `is_planar` method is for internal use only. One can however clarify the meaning of the parameters and the combinations of parameters.



---

archive/issue_comments_332575.json:
```json
{
    "body": "Can you give an example where `circular=True` would be used?\n\nOnly place in the source I found was\n\n`result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`\n\nat `src/sage/graphs/generic_graph.py`, but before the call the code adds an extra vertex. So I don't quite understand.",
    "created_at": "2017-10-16T12:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332575",
    "user": "https://github.com/jm58660"
}
```

Can you give an example where `circular=True` would be used?

Only place in the source I found was

`result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`

at `src/sage/graphs/generic_graph.py`, but before the call the code adds an extra vertex. So I don't quite understand.



---

archive/issue_comments_332576.json:
```json
{
    "body": "The `is_planar` method from `planarity` is used twice in `generic_graph.py`.\n- in method `is_planar` we have `planar = is_planar(G,kuratowski=kuratowski,set_pos=set_pos,set_embedding=set_embedding)`. In this case it is used with the default value, so `circular=False`.\n- in method `is_circular_planar` we have `result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`",
    "created_at": "2017-10-25T12:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332576",
    "user": "https://github.com/dcoudert"
}
```

The `is_planar` method from `planarity` is used twice in `generic_graph.py`.
- in method `is_planar` we have `planar = is_planar(G,kuratowski=kuratowski,set_pos=set_pos,set_embedding=set_embedding)`. In this case it is used with the default value, so `circular=False`.
- in method `is_circular_planar` we have `result = is_planar(graph,kuratowski=kuratowski,set_embedding=set_embedding,circular=True)`



---

archive/issue_comments_332577.json:
```json
{
    "body": "But if I say\n\n\n```\nfor g in graphs(6):\n    if not g.is_connected():\n        continue\n    if g.is_circular_planar(set_pos=True):\n        g.show()\n```\n\n\nI get some planar but not outerplanar drawings.",
    "created_at": "2017-10-25T15:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332577",
    "user": "https://github.com/jm58660"
}
```

But if I say


```
for g in graphs(6):
    if not g.is_connected():
        continue
    if g.is_circular_planar(set_pos=True):
        g.show()
```


I get some planar but not outerplanar drawings.



---

archive/issue_comments_332578.json:
```json
{
    "body": "If you check more carefully method `is_circular_planar`, you will see at the end a call to\n\n```\n            if (set_pos and set_embedding):\n                self.set_planar_positions()\n```\n\nand here is your problem. The positions have nothing to do with the existence of a circular planar layout, but with a planar layout. In other words, we are missing a method ensuring a circular planar layout and more generally an outer planar layout.",
    "created_at": "2017-10-25T16:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332578",
    "user": "https://github.com/dcoudert"
}
```

If you check more carefully method `is_circular_planar`, you will see at the end a call to

```
            if (set_pos and set_embedding):
                self.set_planar_positions()
```

and here is your problem. The positions have nothing to do with the existence of a circular planar layout, but with a planar layout. In other words, we are missing a method ensuring a circular planar layout and more generally an outer planar layout.



---

archive/issue_comments_332579.json:
```json
{
    "body": "Then shoudn't we disable `set_pos` for `is_circular_planar`?",
    "created_at": "2017-10-26T12:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23763#issuecomment-332579",
    "user": "https://github.com/jm58660"
}
```

Then shoudn't we disable `set_pos` for `is_circular_planar`?
