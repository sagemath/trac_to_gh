# Issue 27027: spkg-configure.m4 for flint

Issue created by migration from https://trac.sagemath.org/ticket/27264

Original creator: dimpase

Original creation time: 2019-02-12 16:07:19

CC:  embray

Flint on Sage is linked with NTL, and this can be checked by testing for presence of
`fmpz_poly_get_ZZX` there. So, this:

```
SAGE_SPKG_CONFIGURE([flint], [
    AC_CHECK_HEADER(flint/flint.h, [], [sage_spkg_install_flint=yes])
dnl fmpz_mat_is_hadamard appears in Flint 2.5.0
    AC_SEARCH_LIBS([fmpz_mat_is_hadamard], [flint], [], [sage_spkg_install_flint=yes])
    AC_SEARCH_LIBS([fmpz_poly_get_ZZX], [flint], [break], [sage_spkg_install_flint=yes])
])
```



---

Comment by embray created at 2019-02-12 16:13:02

Do you want to go ahead and add a branch?  Obviously, it seems fine to me at first glance.


---

Comment by dimpase created at 2019-02-12 16:20:48

Yes, but need to do #27265 (NTL) first


---

Comment by dimpase created at 2019-03-21 11:57:24

Last 10 new commits:


---

Comment by dimpase created at 2019-03-21 11:59:19

Changing status from new to needs_review.


---

Comment by embray created at 2019-03-21 12:00:52

Should we still look at NTL first, or maybe try testing with both this ticket _and_ #27265 merged together?


---

Comment by dimpase created at 2019-03-21 12:07:39

Naturally, I am testing them all together...
(this branch has them all).

Actually, there is a lot of common boilerplate in spkg-configure.m4's for mpfr, mpc, ntl, and flint. But OK, perhaps this simplification can wait---depending upon how many more spkgs need `--with-...=` support.


---

Comment by embray created at 2019-03-21 12:13:17

I agree, I think that for now it will be simpler and easier to understand if we are somewhat repetitive.  If, once we've made more progress, a clear pattern emerges then I can certainly collapse the repetitive bits into a macro.


---

Comment by dimpase created at 2019-03-21 12:47:29

This needs an extra test that flint was not built with `--with-gc=...` option, which results in a memory layout different from what Sage interface expects, and leads to crashes, e.g. in `src/sage/libs/flint/fmpz_poly.pyx`.

This option is on on some systems by default, e.g. on Gentoo...


---

Comment by git created at 2019-03-21 14:20:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by git created at 2019-04-01 13:25:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-30 21:27:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2019-04-30 22:51:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-21 12:06:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dimpase created at 2019-05-21 12:07:30

rebased over #27822 branch, added deps checks, etc


---

Comment by dimpase created at 2019-05-21 15:22:49

should this be bundled with arb?


---

Comment by dimpase created at 2019-06-04 11:40:44

to be merged as a part of #27270


---

Comment by dimpase created at 2019-06-04 11:40:44

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-07-31 09:39:12

Resolution: duplicate
