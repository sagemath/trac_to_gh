# Issue 25390: RuntimeError: ECL says: THROW: The catch RAT-ERR is undefined

archive/issues_025390.json:
```json
{
    "body": "Keywords: RuntimeError:\n\nUsing `8.3.beta6` on Linux Manjaro\n\nIs this a known issue? Problem with integrate. \n\n\n```\n    sage: var('x')\n    sage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x)\n\n```\n\ngives\n\n\n```\n    RuntimeError                              Traceback (most recent call last)\n    <ipython-input-2-f1dceacbaccd> in <module>()\n    ----> 1 integrate((cos(x) + Integer(2)*sin(x) + Integer(1))/(cos(x)**Integer(2) - Integer(2)*cos(x)*sin(x) + Integer(2)*sin(x) + Integer(3)),x)\n    \n     .......    \n    RuntimeError: ECL says: THROW: The catch RAT-ERR is undefined.\n\n```\n\nThis one also \n\n\n```\n         integrate(log(x + sqrt(x + 1))/(x^2 + 1),x)\n\n```\n\ngives\n\n\n```\n    RuntimeError                              Traceback (most recent call last)\n    <ipython-input-70-f29d0d9e0a0b> in <module>()\n    ----> 1 anti=integrate(log(x + sqrt(x + Integer(1)))/(x**Integer(2) + Integer(1)),x)\n      ......\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25627\n\n",
    "created_at": "2018-06-21T11:07:36Z",
    "labels": [
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "RuntimeError: ECL says: THROW: The catch RAT-ERR is undefined",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25390",
    "user": "https://github.com/nasser1"
}
```
Keywords: RuntimeError:

Using `8.3.beta6` on Linux Manjaro

Is this a known issue? Problem with integrate. 


```
    sage: var('x')
    sage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x)

```

gives


```
    RuntimeError                              Traceback (most recent call last)
    <ipython-input-2-f1dceacbaccd> in <module>()
    ----> 1 integrate((cos(x) + Integer(2)*sin(x) + Integer(1))/(cos(x)**Integer(2) - Integer(2)*cos(x)*sin(x) + Integer(2)*sin(x) + Integer(3)),x)
    
     .......    
    RuntimeError: ECL says: THROW: The catch RAT-ERR is undefined.

```

This one also 


```
         integrate(log(x + sqrt(x + 1))/(x^2 + 1),x)

```

gives


```
    RuntimeError                              Traceback (most recent call last)
    <ipython-input-70-f29d0d9e0a0b> in <module>()
    ----> 1 anti=integrate(log(x + sqrt(x + Integer(1)))/(x**Integer(2) + Integer(1)),x)
      ......

```


Issue created by migration from https://trac.sagemath.org/ticket/25627





---

archive/issue_comments_357598.json:
```json
{
    "body": "In maxima, the throw/catch RAT-ERR is used because it's a frequently occurring condition that needs to be handled efficiently, and the common-lisp way of handing \"conditions\" (close to python's exceptions) is slow on some lisps. That's why they set up a RAT-ERR. Since this error should happen a lot anyway, I'm a little surprised that we're finding this here. If we're supposed to be running maxima code inside a \"catch\" for this, then I expect we would have noticed elsewhere. It's also strange that these integrals in maxima itself do not seem to generate an error of this type. So I suspect this may be more a bug/anomalous in maxima's integrate (bad interaction with other options sage is setting?) than the obvious solution: catch the throw and raise an error.",
    "created_at": "2018-06-21T17:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357598",
    "user": "https://github.com/nbruin"
}
```

In maxima, the throw/catch RAT-ERR is used because it's a frequently occurring condition that needs to be handled efficiently, and the common-lisp way of handing "conditions" (close to python's exceptions) is slow on some lisps. That's why they set up a RAT-ERR. Since this error should happen a lot anyway, I'm a little surprised that we're finding this here. If we're supposed to be running maxima code inside a "catch" for this, then I expect we would have noticed elsewhere. It's also strange that these integrals in maxima itself do not seem to generate an error of this type. So I suspect this may be more a bug/anomalous in maxima's integrate (bad interaction with other options sage is setting?) than the obvious solution: catch the throw and raise an error.



---

archive/issue_comments_357599.json:
```json
{
    "body": "These no longer give an error:\n\n```\nsage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x)\nHelp file /Applications/usr/share/giac/doc/fr/aide_cas not found\nAdded 0 synonyms\n-arctan(-tan(1/2*x)^2 - tan(1/2*x))\nsage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x, algorithm=\"maxima\")\nintegrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3), x)\nsage: integrate(log(x + sqrt(x + 1))/(x^2 + 1),x, algorithm=\"maxima\")\nintegrate(log(x + sqrt(x + 1))/(x^2 + 1), x)\n```\nMaxima does not give a good answer for either integral, so I don't think they are worth adding as doctests.",
    "created_at": "2022-02-15T06:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357599",
    "user": "https://github.com/DaveWitteMorris"
}
```

These no longer give an error:

```
sage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x)
Help file /Applications/usr/share/giac/doc/fr/aide_cas not found
Added 0 synonyms
-arctan(-tan(1/2*x)^2 - tan(1/2*x))
sage: integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3),x, algorithm="maxima")
integrate((cos(x) + 2*sin(x) + 1)/(cos(x)^2 - 2*cos(x)*sin(x) + 2*sin(x) + 3), x)
sage: integrate(log(x + sqrt(x + 1))/(x^2 + 1),x, algorithm="maxima")
integrate(log(x + sqrt(x + 1))/(x^2 + 1), x)
```
Maxima does not give a good answer for either integral, so I don't think they are worth adding as doctests.



---

archive/issue_comments_357600.json:
```json
{
    "body": "Changing keywords from \"RuntimeError:\" to \"RuntimeError, integration, maxima\".",
    "created_at": "2022-02-15T06:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357600",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing keywords from "RuntimeError:" to "RuntimeError, integration, maxima".



---

archive/issue_comments_357601.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to calculus.",
    "created_at": "2022-02-15T06:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357601",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing component from PLEASE CHANGE to calculus.



---

archive/issue_comments_357602.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-15T06:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357602",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_events_064185.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2022-02-15T06:14:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25390#event-64185"
}
```



---

archive/issue_comments_357603.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-15T20:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357603",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357604.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-02-26T18:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25390#issuecomment-357604",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_064186.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-26T18:53:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25390",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25390#event-64186"
}
```
