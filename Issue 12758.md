# Issue 12758: Poset of Alternating sign matrices

archive/issues_012758.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat pierre.cagne@ens.fr\n\nKeywords: alternating sign matrices, posets\n\nImplementation of the poset of alternating sign matrices\n\nThis is best done by implementing a bijection to monotone triangles (or contre tableaux). This was already done in MuPAD\n\nhttp://mupad-combinat.svn.sourceforge.net/viewvc/mupad-combinat/trunk/MuPAD-Combinat/lib/COMBINAT/alternatingSignMatrices.mu?view=log\n\nOne way of the bijection is already implemented::\n\n\n```\n  sage: import sage.combinat.alternating_sign_matrix as asm\n        sage: asm.from_contre_tableau([[1, 2, 3], [1, 2], [1]])\n        [0 0 1]\n        [0 1 0]\n        [1 0 0]\n        sage: asm.from_contre_tableau([[1, 2, 3], [2, 3], [3]])\n        [1 0 0]\n        [0 1 0]\n        [0 0 1]\n```\n\n\nIt remains to implement the reverse bijection, and the ASM lattice from the ContreTableaux lattice.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12930\n\n",
    "created_at": "2012-05-09T16:27:48Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Poset of Alternating sign matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12758",
    "user": "https://github.com/anneschilling"
}
```
Assignee: sage-combinat

CC:  sage-combinat pierre.cagne@ens.fr

Keywords: alternating sign matrices, posets

Implementation of the poset of alternating sign matrices

This is best done by implementing a bijection to monotone triangles (or contre tableaux). This was already done in MuPAD

http://mupad-combinat.svn.sourceforge.net/viewvc/mupad-combinat/trunk/MuPAD-Combinat/lib/COMBINAT/alternatingSignMatrices.mu?view=log

One way of the bijection is already implemented::


```
  sage: import sage.combinat.alternating_sign_matrix as asm
        sage: asm.from_contre_tableau([[1, 2, 3], [1, 2], [1]])
        [0 0 1]
        [0 1 0]
        [1 0 0]
        sage: asm.from_contre_tableau([[1, 2, 3], [2, 3], [3]])
        [1 0 0]
        [0 1 0]
        [0 0 1]
```


It remains to implement the reverse bijection, and the ASM lattice from the ContreTableaux lattice.

Issue created by migration from https://trac.sagemath.org/ticket/12930





---

archive/issue_comments_152680.json:
```json
{
    "body": "Changing keywords from \"alternating sign matrices, posets\" to \"alternating sign matrices, posets, days38\".",
    "created_at": "2012-05-09T22:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152680",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "alternating sign matrices, posets" to "alternating sign matrices, posets, days38".



---

archive/issue_comments_152681.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-08T11:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152681",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152682.json:
```json
{
    "body": "I have implemented the reverse bijection under the name \"to_contre_tableau\"\n\nI have also implemented the lattice, but only for alternating sign matrices, because contre-tableau are not hashable.",
    "created_at": "2012-06-08T11:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152682",
    "user": "https://github.com/fchapoton"
}
```

I have implemented the reverse bijection under the name "to_contre_tableau"

I have also implemented the lattice, but only for alternating sign matrices, because contre-tableau are not hashable.



---

archive/issue_comments_152683.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> I have implemented the reverse bijection under the name \"to_contre_tableau\"\n> \n> I have also implemented the lattice, but only for alternating sign matrices, because contre-tableau are not hashable.\n\nThanks Frederic for implementing this! However, at Sage Days 38 Pierre Cagne <pierre.cagne`@`ens.fr> also implemented this bijection and the poset. He got over the problem of nonhashable matrices. I recently contacted him to post his patch, but have not heard since. I added his e-mail to this ticket. Hopefully he will post his patch here as well.\n\nBest wishes,\n\nAnne",
    "created_at": "2012-06-08T16:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152683",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:2 chapoton]:
> I have implemented the reverse bijection under the name "to_contre_tableau"
> 
> I have also implemented the lattice, but only for alternating sign matrices, because contre-tableau are not hashable.

Thanks Frederic for implementing this! However, at Sage Days 38 Pierre Cagne <pierre.cagne`@`ens.fr> also implemented this bijection and the poset. He got over the problem of nonhashable matrices. I recently contacted him to post his patch, but have not heard since. I added his e-mail to this ticket. Hopefully he will post his patch here as well.

Best wishes,

Anne



---

archive/issue_comments_152684.json:
```json
{
    "body": "Sorry for the delay, I didn't have the time lately.\n\nBut as Anne said, I implemented it (with the help of Luis Serrano) and I used the occasion to do some cleaning in the file alternating_sign_matrix.py.\nIn fact, there was some obsolete uses (like CombinatorialClass) that I changed. I settled a factory pattern based on classes instead of functions to allow some 'isinstance'. An other issue was the lack of documentation about contre-tableaux : except Sage's documentation, I was unable to find anything about them, even a definition ! So this new implementation uses monotone triangles, that are pretty well referenced on the web. I kept the default definition through contre-tableaux, but consider it obsolete and recommend to work with monotone triangles (by putting the keyword 'use_monotone_triangles' as True when declaring the object, see documentation).\n\nTo get the lattice, just use the 'lattice' method of your object of type AlternatingSignMatrices or MonotoneTriangles. (I got round the non-hashability of the lists for the monotone triangles by making them tuples.)\n\n\nRegards.\n\nEDIT : that's my first patch, do I have to add my name as 'Authors' in the ticket ?",
    "created_at": "2012-06-11T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152684",
    "user": "https://trac.sagemath.org/admin/accounts/users/PierreCagne"
}
```

Sorry for the delay, I didn't have the time lately.

But as Anne said, I implemented it (with the help of Luis Serrano) and I used the occasion to do some cleaning in the file alternating_sign_matrix.py.
In fact, there was some obsolete uses (like CombinatorialClass) that I changed. I settled a factory pattern based on classes instead of functions to allow some 'isinstance'. An other issue was the lack of documentation about contre-tableaux : except Sage's documentation, I was unable to find anything about them, even a definition ! So this new implementation uses monotone triangles, that are pretty well referenced on the web. I kept the default definition through contre-tableaux, but consider it obsolete and recommend to work with monotone triangles (by putting the keyword 'use_monotone_triangles' as True when declaring the object, see documentation).

To get the lattice, just use the 'lattice' method of your object of type AlternatingSignMatrices or MonotoneTriangles. (I got round the non-hashability of the lists for the monotone triangles by making them tuples.)


Regards.

EDIT : that's my first patch, do I have to add my name as 'Authors' in the ticket ?



---

archive/issue_comments_152685.json:
```json
{
    "body": "Well, I guess my patch is no longer useful.\n\n* for the bot : apply only trac_12930-add_mt_lattice.patch\n\n* Please replace my name by yours in the Author field\n\n* The lattices should be **lattices** and not only **posets**, this has to be corrected.",
    "created_at": "2012-06-14T18:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152685",
    "user": "https://github.com/fchapoton"
}
```

Well, I guess my patch is no longer useful.

* for the bot : apply only trac_12930-add_mt_lattice.patch

* Please replace my name by yours in the Author field

* The lattices should be **lattices** and not only **posets**, this has to be corrected.



---

archive/issue_comments_152686.json:
```json
{
    "body": "Hi Pierre, \n\nThanks for your work on this. I will also put your patch on the sage-combinat server since it will be easier to review it that way.\n\nThanks,\n\nAnne",
    "created_at": "2012-06-14T19:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152686",
    "user": "https://github.com/anneschilling"
}
```

Hi Pierre, 

Thanks for your work on this. I will also put your patch on the sage-combinat server since it will be easier to review it that way.

Thanks,

Anne



---

archive/issue_comments_152687.json:
```json
{
    "body": "Hi Pierre, \n\nHere are some first comments on your patch:\n\n- The doctest did not pass for me on /combinat/alternating_sign_matrix.py\n\n\n```\n    sage -t  \"devel/sage-combinat/sage/combinat/alternating_sign_matrix.py\"\nException raised by doctesting framework. Use -verbose for details.\n\t [14.0 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage-combinat/sage/combinat/alternating_sign_matrix.py\" # Exception from doctest framework\nTotal time for all tests: 14.0 seconds\nd099:combinat anne$ sage -t -verbose alternating_sign_matrix.py \nsage -t -verbose \"devel/sage-combinat/sage/combinat/alternating_sign_matrix.py\"\nTraceback (most recent call last):\n  File \"/Users/anne/.sage//tmp/alternating_sign_matrix_49336.py\", line 805, in <module>\n    runner=runner)\n  File \"/Applications/sage-5.0/local/bin/sagedoctest.py\", line 54, in testmod_returning_runner\n    runner=runner)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 1819, in testmod_returning_runner\n    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 839, in find\n    self._find(tests, obj, name, module, source_lines, globs, {})\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 893, in _find\n    globs, seen)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 881, in _find\n    test = self._get_test(obj, name, module, globs, source_lines)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 965, in _get_test\n    filename, lineno)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 594, in get_doctest\n    return DocTest(self.get_examples(string, name), globs,\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 608, in get_examples\n    return [x for x in self.parse(string, name)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 570, in parse\n    self._parse_example(m, name, lineno)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 628, in _parse_example\n    self._check_prompt_blank(source_lines, indent, name, lineno)\n  File \"/Applications/sage-5.0/local/bin/ncadoctest.py\", line 715, in _check_prompt_blank\n    line[indent:indent+3], line))\nValueError: line 13 of the docstring for __main__.example_18 lacks blank after ...: '            ....:'\nException raised by doctesting framework. Use -verbose for details.\n\t [1.4 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -verbose \"devel/sage-combinat/sage/combinat/alternating_sign_matrix.py\" # Exception from doctest framework\nTotal time for all tests: 1.4 seconds\n```\n\n\n- You need doctests for all methods!!!\n\n\n```\n    sage -coverage alternating_sign_matrix.py \n----------------------------------------------------------------------\nalternating_sign_matrix.py\nSCORE alternating_sign_matrix.py: 69% (25 of 36)\n\nMissing documentation:\n\t * __classcall_private__(cls, n, **kwds):\n\t * __init__(self, n, use_monotone_triangles=False):\n\t * __classcall_private__(cls, n, **kwds):\n\t * __init__(self, n):\n\t * __classcall_private__(cls, n, **kwds):\n\t * __classcall_private__(cls, n, **kwds):\n\n\nMissing doctests:\n\t * _lattice_initializer(self):\n\t * _lattice_initializer(self):\n\t * _is_a_cover(mt0, mt1):\n\t * _top_rows(row):\n\t * _triangular_arrangements_base(row):\n\n----------------------------------------------------------------------\n```\n\n\n- Since to_monotone_triangle and from_montone_triangle are inverses of each other you could add some tests as follows:\n\n\n```\n    sage: T = [[1, 2, 3], [1, 2], [1]]\n    sage: asm.to_monotone_triangle(asm.from_monotone_triangle(T)) == T\n    True\n```\n\n\n- Please add Examples to class AlternatingSignMatrices(Parent) below line 87. In fact I would suggest to add EXAMPLES to all of your classes so that the user knows how to use them!\n\n- Please use a line break on line 111 of your patch so that it is easier to read.\n\n- Line 180 of your patch it says \"Return a couple to use in argument of ``Poset``. \" Do you mean tuple instead of couple? Please add an EXAMPLES:: here so it is clear what the method does. A similar sentence appears in line 363.\n\n- As Frederic also mentioned, in line 282 you might want to use Lattice instead of Poset.\n\n- After line 324, please add an empty line.\n\n- After line 374 the TESTS are missing!\n\n- I would suggest to reuse all the doctests in the code that you are deleting since you want your new code to give the same answers as before. For example, I do not see the more systematic test such as\n\n\n```\n     sage: [ AlternatingSignMatrices(n).cardinality() for n in range(0, 11)]\n     [1, 1, 2, 7, 42, 429, 7436, 218348, 10850216, 911835460, 129534272700] \n```\n\n\nBut please reuse all of it in the appropriate places.\n\n- I think if you are removing code or renaming methods, you first need to \"deprecate them\" for one release cycle.\n\nSo much for now. Impressive work for a first patch!\n\nAnne",
    "created_at": "2012-06-14T21:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152687",
    "user": "https://github.com/anneschilling"
}
```

Hi Pierre, 

Here are some first comments on your patch:

- The doctest did not pass for me on /combinat/alternating_sign_matrix.py


```
    sage -t  "devel/sage-combinat/sage/combinat/alternating_sign_matrix.py"
Exception raised by doctesting framework. Use -verbose for details.
	 [14.0 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage-combinat/sage/combinat/alternating_sign_matrix.py" # Exception from doctest framework
Total time for all tests: 14.0 seconds
d099:combinat anne$ sage -t -verbose alternating_sign_matrix.py 
sage -t -verbose "devel/sage-combinat/sage/combinat/alternating_sign_matrix.py"
Traceback (most recent call last):
  File "/Users/anne/.sage//tmp/alternating_sign_matrix_49336.py", line 805, in <module>
    runner=runner)
  File "/Applications/sage-5.0/local/bin/sagedoctest.py", line 54, in testmod_returning_runner
    runner=runner)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 1819, in testmod_returning_runner
    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 839, in find
    self._find(tests, obj, name, module, source_lines, globs, {})
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 893, in _find
    globs, seen)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 881, in _find
    test = self._get_test(obj, name, module, globs, source_lines)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 965, in _get_test
    filename, lineno)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 594, in get_doctest
    return DocTest(self.get_examples(string, name), globs,
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 608, in get_examples
    return [x for x in self.parse(string, name)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 570, in parse
    self._parse_example(m, name, lineno)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 628, in _parse_example
    self._check_prompt_blank(source_lines, indent, name, lineno)
  File "/Applications/sage-5.0/local/bin/ncadoctest.py", line 715, in _check_prompt_blank
    line[indent:indent+3], line))
ValueError: line 13 of the docstring for __main__.example_18 lacks blank after ...: '            ....:'
Exception raised by doctesting framework. Use -verbose for details.
	 [1.4 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -verbose "devel/sage-combinat/sage/combinat/alternating_sign_matrix.py" # Exception from doctest framework
Total time for all tests: 1.4 seconds
```


- You need doctests for all methods!!!


```
    sage -coverage alternating_sign_matrix.py 
----------------------------------------------------------------------
alternating_sign_matrix.py
SCORE alternating_sign_matrix.py: 69% (25 of 36)

Missing documentation:
	 * __classcall_private__(cls, n, **kwds):
	 * __init__(self, n, use_monotone_triangles=False):
	 * __classcall_private__(cls, n, **kwds):
	 * __init__(self, n):
	 * __classcall_private__(cls, n, **kwds):
	 * __classcall_private__(cls, n, **kwds):


Missing doctests:
	 * _lattice_initializer(self):
	 * _lattice_initializer(self):
	 * _is_a_cover(mt0, mt1):
	 * _top_rows(row):
	 * _triangular_arrangements_base(row):

----------------------------------------------------------------------
```


- Since to_monotone_triangle and from_montone_triangle are inverses of each other you could add some tests as follows:


```
    sage: T = [[1, 2, 3], [1, 2], [1]]
    sage: asm.to_monotone_triangle(asm.from_monotone_triangle(T)) == T
    True
```


- Please add Examples to class AlternatingSignMatrices(Parent) below line 87. In fact I would suggest to add EXAMPLES to all of your classes so that the user knows how to use them!

- Please use a line break on line 111 of your patch so that it is easier to read.

- Line 180 of your patch it says "Return a couple to use in argument of ``Poset``. " Do you mean tuple instead of couple? Please add an EXAMPLES:: here so it is clear what the method does. A similar sentence appears in line 363.

- As Frederic also mentioned, in line 282 you might want to use Lattice instead of Poset.

- After line 324, please add an empty line.

- After line 374 the TESTS are missing!

- I would suggest to reuse all the doctests in the code that you are deleting since you want your new code to give the same answers as before. For example, I do not see the more systematic test such as


```
     sage: [ AlternatingSignMatrices(n).cardinality() for n in range(0, 11)]
     [1, 1, 2, 7, 42, 429, 7436, 218348, 10850216, 911835460, 129534272700] 
```


But please reuse all of it in the appropriate places.

- I think if you are removing code or renaming methods, you first need to "deprecate them" for one release cycle.

So much for now. Impressive work for a first patch!

Anne



---

archive/issue_comments_152688.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-14T22:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152688",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_152689.json:
```json
{
    "body": "Thanks for pointing those things out, Anne.\n\nThe failure you get with 'sage -t' is due to something weird about doctesting (cf #10458, you can't use multi-line tests due to some formattings by the IPython interactive shell). But removing this, I get a ton of others doctest failure : i'm working on it.\n\nI notably get some failure about the tests which passed for the implementation with CombinatorialClass because of the inherited methods like first(), last() or random_element(). By dropping out the inheritance in favor of Parent, we loose those kind of methods. However, the implementations of those are naive and do not bring any improvement in comparison with a user's straightforward implementation.\nFor example, this is last() :\n\n\n```\nfor i in self: \n    pass\nreturn i\n```\n\n\nSo I'm wondering about the usefulness of the reimplementation of those methods. Maybe can we skip them ?\nIn fact, this is the only removing/renaming code (that we have to 'deprecate' so, but maybe as the CombinatorialClass level directly). For the rest, I kept by default all the old implementation and allowed mine by keyword option. For example :\n\n\n```\nA = AlternatingSignMatrices(4) #inner implementation uses contre-tableaux as before\nA = AlternatingSignMatrices(4, use_monotone_triangles=True) #inner implementation uses monotone triangles as it should\n```\n\n\nRemark that some methods assert the use of monotone triangles (like lattice()).\n\n\nI noticed also that EXAMPLES and TESTS are checked by 'sage -t' : is there a real difference between them ?\n\n\nRegards,\n\nPierre",
    "created_at": "2012-06-15T14:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152689",
    "user": "https://trac.sagemath.org/admin/accounts/users/PierreCagne"
}
```

Thanks for pointing those things out, Anne.

The failure you get with 'sage -t' is due to something weird about doctesting (cf #10458, you can't use multi-line tests due to some formattings by the IPython interactive shell). But removing this, I get a ton of others doctest failure : i'm working on it.

I notably get some failure about the tests which passed for the implementation with CombinatorialClass because of the inherited methods like first(), last() or random_element(). By dropping out the inheritance in favor of Parent, we loose those kind of methods. However, the implementations of those are naive and do not bring any improvement in comparison with a user's straightforward implementation.
For example, this is last() :


```
for i in self: 
    pass
return i
```


So I'm wondering about the usefulness of the reimplementation of those methods. Maybe can we skip them ?
In fact, this is the only removing/renaming code (that we have to 'deprecate' so, but maybe as the CombinatorialClass level directly). For the rest, I kept by default all the old implementation and allowed mine by keyword option. For example :


```
A = AlternatingSignMatrices(4) #inner implementation uses contre-tableaux as before
A = AlternatingSignMatrices(4, use_monotone_triangles=True) #inner implementation uses monotone triangles as it should
```


Remark that some methods assert the use of monotone triangles (like lattice()).


I noticed also that EXAMPLES and TESTS are checked by 'sage -t' : is there a real difference between them ?


Regards,

Pierre



---

archive/issue_comments_152690.json:
```json
{
    "body": "Hi Pierre,\n\n> The failure you get with 'sage -t' is due to something weird about doctesting (cf #10458, you can't use multi-line tests due to some formattings by the IPython interactive shell). But removing this, I get a ton of others doctest failure : i'm working on it.\n\nCould you point me to the line in your code? I think if you use\n\n```\n    ...\n```\n\ninstead of \n\n```\n    ...:\n```\n\nit should work.\n\nI noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?\n\n> I notably get some failure about the tests which passed for the implementation with CombinatorialClass because of the inherited methods like first(), last() or random_element(). By dropping out the inheritance in favor of Parent, we loose those kind of methods. However, the implementations of those are naive and do not bring any improvement in comparison with a user's straightforward implementation.\n> For example, this is last() :\n> \n> {{{\n> for i in self: \n>     pass\n> return i\n> }}}\n> \n> So I'm wondering about the usefulness of the reimplementation of those methods. Maybe can we skip them ?\n\nMost likely skipping them is ok. Perhaps confirm this with Nicolas.\n\n> In fact, this is the only removing/renaming code (that we have to 'deprecate' so, but maybe as the CombinatorialClass level directly). For the rest, I kept by default all the old implementation and allowed mine by keyword option. For example :\n> \n> {{{\n> A = AlternatingSignMatrices(4) #inner implementation uses contre-tableaux as before\n> A = AlternatingSignMatrices(4, use_monotone_triangles=True) #inner implementation uses monotone triangles as it should\n> }}}\n\nDon't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.\n\n> I noticed also that EXAMPLES and TESTS are checked by 'sage -t' : is there a real difference between them ?\n\nYes, both are tested. For myself, I usually use EXAMPLES if these are tests that are also useful for the user to read to understand how the code is used. TESTS is for internal tests like in __init__ or something like this or corner cases that need to be checked, but not necessarily read.\n\nBest wishes,\n\nAnne",
    "created_at": "2012-06-15T15:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152690",
    "user": "https://github.com/anneschilling"
}
```

Hi Pierre,

> The failure you get with 'sage -t' is due to something weird about doctesting (cf #10458, you can't use multi-line tests due to some formattings by the IPython interactive shell). But removing this, I get a ton of others doctest failure : i'm working on it.

Could you point me to the line in your code? I think if you use

```
    ...
```

instead of 

```
    ...:
```

it should work.

I noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?

> I notably get some failure about the tests which passed for the implementation with CombinatorialClass because of the inherited methods like first(), last() or random_element(). By dropping out the inheritance in favor of Parent, we loose those kind of methods. However, the implementations of those are naive and do not bring any improvement in comparison with a user's straightforward implementation.
> For example, this is last() :
> 
> {{{
> for i in self: 
>     pass
> return i
> }}}
> 
> So I'm wondering about the usefulness of the reimplementation of those methods. Maybe can we skip them ?

Most likely skipping them is ok. Perhaps confirm this with Nicolas.

> In fact, this is the only removing/renaming code (that we have to 'deprecate' so, but maybe as the CombinatorialClass level directly). For the rest, I kept by default all the old implementation and allowed mine by keyword option. For example :
> 
> {{{
> A = AlternatingSignMatrices(4) #inner implementation uses contre-tableaux as before
> A = AlternatingSignMatrices(4, use_monotone_triangles=True) #inner implementation uses monotone triangles as it should
> }}}

Don't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.

> I noticed also that EXAMPLES and TESTS are checked by 'sage -t' : is there a real difference between them ?

Yes, both are tested. For myself, I usually use EXAMPLES if these are tests that are also useful for the user to read to understand how the code is used. TESTS is for internal tests like in __init__ or something like this or corner cases that need to be checked, but not necessarily read.

Best wishes,

Anne



---

archive/issue_comments_152691.json:
```json
{
    "body": "> Could you point me to the line in your code? I think if you use\n> {{{\n>     ...\n> }}}\n> instead of \n> {{{\n>     ...:\n> }}}\n> it should work.\n\nYes, that is the trick explained in #10458. But this is definitely something to fix : we want to be able to copy/paste our tests from the sage shell.\n\n\n> I noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?\n\nYes, it was careless mistakes. I fixed it.\n\n\n> Most likely skipping them is ok. Perhaps confirm this with Nicolas.\n\nI think it is better too. I will contact Nicolas about that.\n\n \n> Don't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.\n\nWell, yes. I was just thinking about compatibility with older code. But I can switch to monotone triangles only (or at least default) and go through a deprecation cycle.\n\n> Yes, both are tested. For myself, I usually use EXAMPLES if these are tests that are also useful for the user to read to understand how the code is used. TESTS is for internal tests like in __init__ or something like this or corner cases that need to be checked, but not necessarily read.\n\nOk, thanks. I see now.\n\nPierre",
    "created_at": "2012-06-15T15:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152691",
    "user": "https://trac.sagemath.org/admin/accounts/users/PierreCagne"
}
```

> Could you point me to the line in your code? I think if you use
> {{{
>     ...
> }}}
> instead of 
> {{{
>     ...:
> }}}
> it should work.

Yes, that is the trick explained in #10458. But this is definitely something to fix : we want to be able to copy/paste our tests from the sage shell.


> I noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?

Yes, it was careless mistakes. I fixed it.


> Most likely skipping them is ok. Perhaps confirm this with Nicolas.

I think it is better too. I will contact Nicolas about that.

 
> Don't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.

Well, yes. I was just thinking about compatibility with older code. But I can switch to monotone triangles only (or at least default) and go through a deprecation cycle.

> Yes, both are tested. For myself, I usually use EXAMPLES if these are tests that are also useful for the user to read to understand how the code is used. TESTS is for internal tests like in __init__ or something like this or corner cases that need to be checked, but not necessarily read.

Ok, thanks. I see now.

Pierre



---

archive/issue_comments_152692.json:
```json
{
    "body": "Replying to [comment:12 PierreCagne]:\n>  > Could you point me to the line in your code? I think if you use\n> > {{{\n> >     ...\n> > }}}\n> > instead of \n> > {{{\n> >     ...:\n> > }}}\n> > it should work.\n> \n> Yes, that is the trick explained in #10458. But this is definitely something to fix : we want to be able to copy/paste our tests from the sage shell.\n\nSure, but the above works and you can use it for now for your patch to get the tests to pass!\n\n> > I noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?\n> \n> Yes, it was careless mistakes. I fixed it.\n\nDid you post your new patch? When you do, could you please also put the new version on the sage-combinat server (well, if it is too complicated for you, I can do it, but it is easier to review this way for me).\n\n> > Don't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.\n> \n> Well, yes. I was just thinking about compatibility with older code. But I can switch to monotone triangles only (or at least default) and go through a deprecation cycle.\n\nYes, I think we should start the deprecation cycle.\n\nBest wishes,\n\nAnne",
    "created_at": "2012-06-15T22:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152692",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:12 PierreCagne]:
>  > Could you point me to the line in your code? I think if you use
> > {{{
> >     ...
> > }}}
> > instead of 
> > {{{
> >     ...:
> > }}}
> > it should work.
> 
> Yes, that is the trick explained in #10458. But this is definitely something to fix : we want to be able to copy/paste our tests from the sage shell.

Sure, but the above works and you can use it for now for your patch to get the tests to pass!

> > I noticed that sometimes you do not repeat a definition (for example of A) from one doctest to the next. Is this the problem when you remove the offending doctest?
> 
> Yes, it was careless mistakes. I fixed it.

Did you post your new patch? When you do, could you please also put the new version on the sage-combinat server (well, if it is too complicated for you, I can do it, but it is easier to review this way for me).

> > Don't we want to get rid of the name contre-tableaux at some point? I was thinking of deprecating that name, so that at some point there would only be monotone_triangles.
> 
> Well, yes. I was just thinking about compatibility with older code. But I can switch to monotone triangles only (or at least default) and go through a deprecation cycle.

Yes, I think we should start the deprecation cycle.

Best wishes,

Anne



---

archive/issue_comments_152693.json:
```json
{
    "body": "I am not aware of this sage-combinat server. But I will find out if it is easier for some reviewers to use it.",
    "created_at": "2012-06-15T22:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152693",
    "user": "https://trac.sagemath.org/admin/accounts/users/PierreCagne"
}
```

I am not aware of this sage-combinat server. But I will find out if it is easier for some reviewers to use it.



---

archive/issue_comments_152694.json:
```json
{
    "body": "Replying to [comment:14 PierreCagne]:\n> I am not aware of this sage-combinat server. But I will find out if it is easier for some reviewers to use it.\n\nSee http://wiki.sagemath.org/combinat/MercurialStepByStep\nBut if you have not installed/used the sage-combinat queue, then do not worry about this. Just post the patch here and I will import it to the sage-combinat queue (which makes my reviewing easier).\n\nThanks,\n\nAnne",
    "created_at": "2012-06-15T22:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152694",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:14 PierreCagne]:
> I am not aware of this sage-combinat server. But I will find out if it is easier for some reviewers to use it.

See http://wiki.sagemath.org/combinat/MercurialStepByStep
But if you have not installed/used the sage-combinat queue, then do not worry about this. Just post the patch here and I will import it to the sage-combinat queue (which makes my reviewing easier).

Thanks,

Anne



---

archive/issue_comments_152695.json:
```json
{
    "body": "I have done some clean-up work on the file.\n\napply only trac_12930-add_mt_lattice-v2",
    "created_at": "2012-09-20T16:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152695",
    "user": "https://github.com/fchapoton"
}
```

I have done some clean-up work on the file.

apply only trac_12930-add_mt_lattice-v2



---

archive/issue_comments_152696.json:
```json
{
    "body": "New patch, with clean-up of all whitespaces in the file.",
    "created_at": "2012-09-22T09:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152696",
    "user": "https://github.com/fchapoton"
}
```

New patch, with clean-up of all whitespaces in the file.



---

archive/issue_comments_152697.json:
```json
{
    "body": "Hi!\n\nI just posted a slightly revised patch with some extra doctests and some clean-up in the documentation.\n\nPlease deprecate the old contre_tableaux methods and classes. Other than that, the patch seems to be finished.\n\nAnne",
    "created_at": "2012-09-25T03:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152697",
    "user": "https://github.com/anneschilling"
}
```

Hi!

I just posted a slightly revised patch with some extra doctests and some clean-up in the documentation.

Please deprecate the old contre_tableaux methods and classes. Other than that, the patch seems to be finished.

Anne



---

archive/issue_comments_152698.json:
```json
{
    "body": "For the bot:\n\napply only trac_12930-add_mt_lattice-as.patch",
    "created_at": "2012-10-19T08:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152698",
    "user": "https://github.com/fchapoton"
}
```

For the bot:

apply only trac_12930-add_mt_lattice-as.patch



---

archive/issue_comments_152699.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-29T13:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152699",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_152700.json:
```json
{
    "body": "apply only trac_12930-add_mt_lattice-v2.patch\n\nI have added deprecations, but I am not sure that I have done it right. Could you please check ? Is it necessary to deprecate every single method in the classes of contre-tableaux ? I have not done that.",
    "created_at": "2012-10-29T13:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152700",
    "user": "https://github.com/fchapoton"
}
```

apply only trac_12930-add_mt_lattice-v2.patch

I have added deprecations, but I am not sure that I have done it right. Could you please check ? Is it necessary to deprecate every single method in the classes of contre-tableaux ? I have not done that.



---

archive/issue_comments_152701.json:
```json
{
    "body": "Well, it seems that something is going wrong with deprecations. I have no idea what to do. Did I make a mistake ? Is this because I have made the patch with a sage 5.2 ?",
    "created_at": "2012-10-29T14:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152701",
    "user": "https://github.com/fchapoton"
}
```

Well, it seems that something is going wrong with deprecations. I have no idea what to do. Did I make a mistake ? Is this because I have made the patch with a sage 5.2 ?



---

archive/issue_comments_152702.json:
```json
{
    "body": "clean-up",
    "created_at": "2012-10-29T19:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152702",
    "user": "https://github.com/fchapoton"
}
```

clean-up



---

archive/issue_comments_152703.json:
```json
{
    "body": "Attachment [trac_12930-add_mt_lattice-v2.patch](tarball://root/attachments/some-uuid/ticket12930/trac_12930-add_mt_lattice-v2.patch) by @fchapoton created at 2012-10-29 19:20:01\n\nwell, I removed some of the deprecations, that were seemingly misplaced. Probably one still has to deprecate every single function on contre tableaux.",
    "created_at": "2012-10-29T19:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152703",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_12930-add_mt_lattice-v2.patch](tarball://root/attachments/some-uuid/ticket12930/trac_12930-add_mt_lattice-v2.patch) by @fchapoton created at 2012-10-29 19:20:01

well, I removed some of the deprecations, that were seemingly misplaced. Probably one still has to deprecate every single function on contre tableaux.



---

archive/issue_comments_152704.json:
```json
{
    "body": "apply only trac_12930-add_mt_lattice-v2.patch",
    "created_at": "2012-10-29T19:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152704",
    "user": "https://github.com/fchapoton"
}
```

apply only trac_12930-add_mt_lattice-v2.patch



---

archive/issue_comments_152705.json:
```json
{
    "body": "Looks good now. I will set a positive review.\n\nAnne",
    "created_at": "2012-11-20T08:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152705",
    "user": "https://github.com/anneschilling"
}
```

Looks good now. I will set a positive review.

Anne



---

archive/issue_comments_152706.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-20T08:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152706",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152707.json:
```json
{
    "body": "Thanks !",
    "created_at": "2012-11-20T08:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152707",
    "user": "https://github.com/fchapoton"
}
```

Thanks !



---

archive/issue_comments_152708.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-18T11:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12758#issuecomment-152708",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_012726.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-18T11:16:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12758",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12758#event-12726"
}
```
