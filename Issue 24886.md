# Issue 24886: Addition of Random Sampling method for closeness centrality to centrality.pyx

archive/issues_024886.json:
```json
{
    "body": "CC:  @dcoudert @dimpase\n\nKeywords: Closeness Centrality\n\nI would like to know, is it a good idea to add random sampling method for calculating closeness centrality, which will give error percentage < 5% on avg.\n\nReference:\nhttps://arxiv.org/pdf/1409.0035.pdf\n\nCurrently, in sage, the closeness centrality is calculated by using\nhttp://arxiv.org/abs/1507.01490\n\nIssue created by migration from https://trac.sagemath.org/ticket/25123\n\n",
    "created_at": "2018-04-08T20:04:20Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Addition of Random Sampling method for closeness centrality to centrality.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24886",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```
CC:  @dcoudert @dimpase

Keywords: Closeness Centrality

I would like to know, is it a good idea to add random sampling method for calculating closeness centrality, which will give error percentage < 5% on avg.

Reference:
https://arxiv.org/pdf/1409.0035.pdf

Currently, in sage, the closeness centrality is calculated by using
http://arxiv.org/abs/1507.01490

Issue created by migration from https://trac.sagemath.org/ticket/25123





---

archive/issue_comments_349338.json:
```json
{
    "body": "It's an interesting proposal. You plan to code it in python or in cython ?",
    "created_at": "2018-04-09T07:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349338",
    "user": "https://github.com/dcoudert"
}
```

It's an interesting proposal. You plan to code it in python or in cython ?



---

archive/issue_comments_349339.json:
```json
{
    "body": "Replying to [comment:1 dcoudert]:\n> It's an interesting proposal. You plan to code it in python or in cython ?\nThanks, \\\\\nAs cython will give better performance than python. I will code it in cython. \\\\\nCould you please say is Dijkstra algorithm in sage, is available in cython?. \\\\\nIf a graph is unweighted, shall I replace Dijkstra's algorithm with BFS for calculating closeness centrality. This will give an advantage in terms of running time.",
    "created_at": "2018-04-09T14:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349339",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:1 dcoudert]:
> It's an interesting proposal. You plan to code it in python or in cython ?
Thanks, \\
As cython will give better performance than python. I will code it in cython. \\
Could you please say is Dijkstra algorithm in sage, is available in cython?. \\
If a graph is unweighted, shall I replace Dijkstra's algorithm with BFS for calculating closeness centrality. This will give an advantage in terms of running time.



---

archive/issue_comments_349340.json:
```json
{
    "body": "Before going to Cython, you have to learn more about the graphs module and it's various backends. Furthermore, you should have a look at the documentation of the `closeness_centrality` method. It clearly indicates that Dijkstra is used...\n\nThere is a Dijkstra implementation in the `SparseGraphBackend`. There is another one when you use the boost backend, plus the boost backend implements closeness centrality.",
    "created_at": "2018-04-11T09:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349340",
    "user": "https://github.com/dcoudert"
}
```

Before going to Cython, you have to learn more about the graphs module and it's various backends. Furthermore, you should have a look at the documentation of the `closeness_centrality` method. It clearly indicates that Dijkstra is used...

There is a Dijkstra implementation in the `SparseGraphBackend`. There is another one when you use the boost backend, plus the boost backend implements closeness centrality.



---

archive/issue_comments_349341.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-04-14T15:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_349342.json:
```json
{
    "body": "on which branch are you working ? it does not seems to be a clean one.\n\nYou should start a new branch on top of last develop branch for instance.",
    "created_at": "2018-04-14T15:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349342",
    "user": "https://github.com/dcoudert"
}
```

on which branch are you working ? it does not seems to be a clean one.

You should start a new branch on top of last develop branch for instance.



---

archive/issue_comments_349343.json:
```json
{
    "body": "I will update it as soon as possible.\nReplying to [comment:6 dcoudert]:\n> on which branch are you working ? it does not seems to be a clean one.\n> \n> You should start a new branch on top of last develop branch for instance.",
    "created_at": "2018-04-14T15:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349343",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

I will update it as soon as possible.
Replying to [comment:6 dcoudert]:
> on which branch are you working ? it does not seems to be a clean one.
> 
> You should start a new branch on top of last develop branch for instance.



---

archive/issue_comments_349344.json:
```json
{
    "body": "Just to be sure that I am doing right way.\\\\\nhttp://doc.sagemath.org/html/en/developer/manual_git.html \\\\\nDo I need to follow Checking Out Tickets and Pushing Your Changes to a Ticket from the above link?\nReplying to [comment:6 dcoudert]:\n> on which branch are you working ? it does not seems to be a clean one.\n> \n> You should start a new branch on top of last develop branch for instance.",
    "created_at": "2018-04-14T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349344",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Just to be sure that I am doing right way.\\
http://doc.sagemath.org/html/en/developer/manual_git.html \\
Do I need to follow Checking Out Tickets and Pushing Your Changes to a Ticket from the above link?
Replying to [comment:6 dcoudert]:
> on which branch are you working ? it does not seems to be a clean one.
> 
> You should start a new branch on top of last develop branch for instance.



---

archive/issue_comments_349345.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-04-14T18:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_349346.json:
```json
{
    "body": "Replying to [comment:10 git]:\n> Branch pushed to git repo; I updated commit sha1. Last 10 new commits:\n> ||[60cb3ed](https://git.sagemath.org/sage.git/commit/?id=60cb3ede92ad0f2fbc5dbc0b13f9967baa1857a9)||`dfs_order reset`||\n> ||[713062b](https://git.sagemath.org/sage.git/commit/?id=713062b0440319842c532f68fef26b42e9a19df9)||`Updated DFS, doctests passed, Reference and defination added`||\n> ||[e8a817c](https://git.sagemath.org/sage.git/commit/?id=e8a817cf5d84c68e920c0da3181301ada3752e29)||`Examples, definition and reference updated`||\n> ||[c5c8fca](https://git.sagemath.org/sage.git/commit/?id=c5c8fcab58e8c504cfc839e393ab28cb5bc40dc7)||`updated example, doctest passed.`||\n> ||[79b64d6](https://git.sagemath.org/sage.git/commit/?id=79b64d603dc7cb9c342c1aea73416e12bf224090)||`Updated`||\n> ||[e7ec5d6](https://git.sagemath.org/sage.git/commit/?id=e7ec5d6f4edb8ccc13b560572723adfb6d666b23)||`Extra spaces removed, minor updations`||\n> ||[618efe4](https://git.sagemath.org/sage.git/commit/?id=618efe406a65110bd991c1568f848f9f49fc4d7b)||`Minor comments updated`||\n> ||[ad71644](https://git.sagemath.org/sage.git/commit/?id=ad716448b924d312755abf2287fbb5b107d70624)||`Updated`||\n> ||[9b43b3e](https://git.sagemath.org/sage.git/commit/?id=9b43b3e65623545d549e0003887e36d73d72a00d)||`git-trac-command folder removed.`||\n> ||[f31e31c](https://git.sagemath.org/sage.git/commit/?id=f31e31c291ee587baa80b9f99c7e5dbc89fe251f)||`Closeness centrality added`||",
    "created_at": "2018-04-14T18:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349346",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:10 git]:
> Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
> ||[60cb3ed](https://git.sagemath.org/sage.git/commit/?id=60cb3ede92ad0f2fbc5dbc0b13f9967baa1857a9)||`dfs_order reset`||
> ||[713062b](https://git.sagemath.org/sage.git/commit/?id=713062b0440319842c532f68fef26b42e9a19df9)||`Updated DFS, doctests passed, Reference and defination added`||
> ||[e8a817c](https://git.sagemath.org/sage.git/commit/?id=e8a817cf5d84c68e920c0da3181301ada3752e29)||`Examples, definition and reference updated`||
> ||[c5c8fca](https://git.sagemath.org/sage.git/commit/?id=c5c8fcab58e8c504cfc839e393ab28cb5bc40dc7)||`updated example, doctest passed.`||
> ||[79b64d6](https://git.sagemath.org/sage.git/commit/?id=79b64d603dc7cb9c342c1aea73416e12bf224090)||`Updated`||
> ||[e7ec5d6](https://git.sagemath.org/sage.git/commit/?id=e7ec5d6f4edb8ccc13b560572723adfb6d666b23)||`Extra spaces removed, minor updations`||
> ||[618efe4](https://git.sagemath.org/sage.git/commit/?id=618efe406a65110bd991c1568f848f9f49fc4d7b)||`Minor comments updated`||
> ||[ad71644](https://git.sagemath.org/sage.git/commit/?id=ad716448b924d312755abf2287fbb5b107d70624)||`Updated`||
> ||[9b43b3e](https://git.sagemath.org/sage.git/commit/?id=9b43b3e65623545d549e0003887e36d73d72a00d)||`git-trac-command folder removed.`||
> ||[f31e31c](https://git.sagemath.org/sage.git/commit/?id=f31e31c291ee587baa80b9f99c7e5dbc89fe251f)||`Closeness centrality added`||



---

archive/issue_comments_349347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-14T18:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349348.json:
```json
{
    "body": "Solved the problem, I forgot to reset the master. \\\\\nThe current implementation uses BFS if a graph is unweighted and Dijkstra if a graph is weighted.\n\nAlgorithm: \\\\\n\n1. Choose k random vertices from n vertices of input graph G.\n2. Run k times BFS or Dijkstra and estimate closeness centrality for n-k vertices.\n\nInstead of using 2D array and store `k*n` distances, I used a 1D array(sum_array), sum_array[v] will give the sum of the distances from v to k random vertices. From this optimization, less memory will be used.\n\nPlease let me know what more I can do to improve the code performance.\n\n\n\nReplying to [comment:12 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[7ab7819](https://git.sagemath.org/sage.git/commit/?id=7ab7819982c339c84a22af4d0dd7b74e33ecac1f)||`Closeness centrality added`||",
    "created_at": "2018-04-14T19:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349348",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Solved the problem, I forgot to reset the master. \\
The current implementation uses BFS if a graph is unweighted and Dijkstra if a graph is weighted.

Algorithm: \\

1. Choose k random vertices from n vertices of input graph G.
2. Run k times BFS or Dijkstra and estimate closeness centrality for n-k vertices.

Instead of using 2D array and store `k*n` distances, I used a 1D array(sum_array), sum_array[v] will give the sum of the distances from v to k random vertices. From this optimization, less memory will be used.

Please let me know what more I can do to improve the code performance.



Replying to [comment:12 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7ab7819](https://git.sagemath.org/sage.git/commit/?id=7ab7819982c339c84a22af4d0dd7b74e33ecac1f)||`Closeness centrality added`||



---

archive/issue_comments_349349.json:
```json
{
    "body": "Please do never hesitate to remind definitions, and more importantly to explain what your algorithm is doing. I had to look for definitions to guess what you are doing.\n\nBefore `improve the code performance`, the most important, and first step, is to have a clear and robust code. \n\n- Please check for typos: `verices`, \n- Your method is for undirected graphs only, right ?\n- the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code\n- The method must start checking parameters before doing anything else\n- You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.\n- `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?\n- don't call a variable `sum`. It might conflict with builtin methods.\n- `for i in range(0,k)` -> `for i in range(k)`\n- In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ? \n- according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?\n\nI will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.\nSo we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.",
    "created_at": "2018-04-15T12:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349349",
    "user": "https://github.com/dcoudert"
}
```

Please do never hesitate to remind definitions, and more importantly to explain what your algorithm is doing. I had to look for definitions to guess what you are doing.

Before `improve the code performance`, the most important, and first step, is to have a clear and robust code. 

- Please check for typos: `verices`, 
- Your method is for undirected graphs only, right ?
- the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code
- The method must start checking parameters before doing anything else
- You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.
- `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?
- don't call a variable `sum`. It might conflict with builtin methods.
- `for i in range(0,k)` -> `for i in range(k)`
- In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ? 
- according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?

I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.
So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.



---

archive/issue_comments_349350.json:
```json
{
    "body": "Replying to [comment:14 dcoudert]:\n> Please do never hesitate to remind definitions, and more importantly to explain what your algorithm is doing. I had to look for definitions to guess what you are doing.\n> \nApologies, for not adding the proper explanation to the algorithm.\nI will try to add all the required definitions whenever required.\n\n> Before `improve the code performance`, the most important, and first step, is to have a clear and robust code. \n> \n> - Please check for typos: `verices`, \n> - Your method is for undirected graphs only, right ?\nIt's applicable to directed graph if it's connected.\n> - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code\nFarness says how far `u` is from `v`. \\\\\nsum_array says it's the sum of distances from `v` to `k random vertices`.\\\\\nPlease correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\\\\n> - The method must start checking parameters before doing anything else\n> - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.\nSure I will update it.\n> - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?\nYes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.\n\n> - don't call a variable `sum`. It might conflict with builtin methods.\nSure shall I replace it with `sum_of_all_distances`? \n\n> - `for i in range(0,k)` -> `for i in range(k)`\n> - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?\nIt should be Dijstra, I will update the defination that weighted graph should have only positive weights.\n \n> - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?\nYes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\\\\n   \nOther `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. \n> \n> I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.\n> So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.\nThat is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? \nIf I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. \n\nThank you, for taking your valuable time out for reviewing my code and giving feedback.",
    "created_at": "2018-04-15T14:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349350",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:14 dcoudert]:
> Please do never hesitate to remind definitions, and more importantly to explain what your algorithm is doing. I had to look for definitions to guess what you are doing.
> 
Apologies, for not adding the proper explanation to the algorithm.
I will try to add all the required definitions whenever required.

> Before `improve the code performance`, the most important, and first step, is to have a clear and robust code. 
> 
> - Please check for typos: `verices`, 
> - Your method is for undirected graphs only, right ?
It's applicable to directed graph if it's connected.
> - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code
Farness says how far `u` is from `v`. \\
sum_array says it's the sum of distances from `v` to `k random vertices`.\\
Please correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\
> - The method must start checking parameters before doing anything else
> - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.
Sure I will update it.
> - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?
Yes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.

> - don't call a variable `sum`. It might conflict with builtin methods.
Sure shall I replace it with `sum_of_all_distances`? 

> - `for i in range(0,k)` -> `for i in range(k)`
> - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?
It should be Dijstra, I will update the defination that weighted graph should have only positive weights.
 
> - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?
Yes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\
   
Other `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. 
> 
> I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.
> So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.
That is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? 
If I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. 

Thank you, for taking your valuable time out for reviewing my code and giving feedback.



---

archive/issue_comments_349351.json:
```json
{
    "body": "> > - Your method is for undirected graphs only, right ?\n> It's applicable to directed graph if it's connected.\n\nOK, but again I had to check carefully the definition. The closeness centrality of v is computed using distances from each other node to v. So it works because you select k source nodes and compute shortest path distances from these nodes. So for a node v, you know the distance from a source node to v. It remains to sum over the sources.\n\n> > - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code\n> Farness says how far `u` is from `v`. \\\\\n\nNO, it's not the distance from u to v, it's the sum of the distances from every nodes in the graph to u.\nSee https://en.wikipedia.org/wiki/Closeness_centrality where it is written: Closeness was defined by Bavelas (1950) as the reciprocal of the farness.\n\n> sum_array says it's the sum of distances from `v` to `k random vertices`.\\\\\n> Please correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\\\\n\nIn this algorithm, instead of the farness, you use a kind of partial farness, that is the sum of the distances between each of the k source nodes of shortest path trees to v.\n\n \n> > - The method must start checking parameters before doing anything else\n> > - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.\n> Sure I will update it.\n> > - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?\n> Yes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.\n\nbut for weighted graphs you use `double`, which make sense since weights can be int or float.\n\n \n> > - don't call a variable `sum`. It might conflict with builtin methods.\n> Sure shall I replace it with `sum_of_all_distances`? \n\nfor instance, yes.\n\nHowever, keep in mind that this sum of all distances is the sum of the farness of the vertices.\nSo instead of adding each distances, it should be faster to compute the sum of the farness.\n\n  \n> > - `for i in range(0,k)` -> `for i in range(k)`\n> > - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?\n> It should be Dijstra, I will update the defination that weighted graph should have only positive weights.\n>  \n> > - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?\n> Yes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\\\\n\nThis is true in undirected graphs only. In directed graph, you need distances to these k nodes to get exact closeness centrality.\n\n \n> Other `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. \n\nOK\n\n> > \n> > I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.\n> > So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.\n> That is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? \n> If I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. \n\nIn general it's better to have targeted tickets. So yes we need a new ticket, and yes, you will have to add a dependency between this ticket and the new one, plus rebase on it.\n\nIt's more time and more work, but we should get in the end a better solution for this ticket.",
    "created_at": "2018-04-15T16:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349351",
    "user": "https://github.com/dcoudert"
}
```

> > - Your method is for undirected graphs only, right ?
> It's applicable to directed graph if it's connected.

OK, but again I had to check carefully the definition. The closeness centrality of v is computed using distances from each other node to v. So it works because you select k source nodes and compute shortest path distances from these nodes. So for a node v, you know the distance from a source node to v. It remains to sum over the sources.

> > - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code
> Farness says how far `u` is from `v`. \\

NO, it's not the distance from u to v, it's the sum of the distances from every nodes in the graph to u.
See https://en.wikipedia.org/wiki/Closeness_centrality where it is written: Closeness was defined by Bavelas (1950) as the reciprocal of the farness.

> sum_array says it's the sum of distances from `v` to `k random vertices`.\\
> Please correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\

In this algorithm, instead of the farness, you use a kind of partial farness, that is the sum of the distances between each of the k source nodes of shortest path trees to v.

 
> > - The method must start checking parameters before doing anything else
> > - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.
> Sure I will update it.
> > - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?
> Yes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.

but for weighted graphs you use `double`, which make sense since weights can be int or float.

 
> > - don't call a variable `sum`. It might conflict with builtin methods.
> Sure shall I replace it with `sum_of_all_distances`? 

for instance, yes.

However, keep in mind that this sum of all distances is the sum of the farness of the vertices.
So instead of adding each distances, it should be faster to compute the sum of the farness.

  
> > - `for i in range(0,k)` -> `for i in range(k)`
> > - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?
> It should be Dijstra, I will update the defination that weighted graph should have only positive weights.
>  
> > - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?
> Yes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\

This is true in undirected graphs only. In directed graph, you need distances to these k nodes to get exact closeness centrality.

 
> Other `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. 

OK

> > 
> > I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.
> > So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.
> That is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? 
> If I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. 

In general it's better to have targeted tickets. So yes we need a new ticket, and yes, you will have to add a dependency between this ticket and the new one, plus rebase on it.

It's more time and more work, but we should get in the end a better solution for this ticket.



---

archive/issue_comments_349352.json:
```json
{
    "body": "Replying to [comment:16 dcoudert]:\n> > > - Your method is for undirected graphs only, right ?\n> > It's applicable to directed graph if it's connected.\n> \n> OK, but again I had to check carefully the definition. The closeness centrality of v is computed using distances from each other node to v. So it works because you select k source nodes and compute shortest path distances from these nodes. So for a node v, you know the distance from a source node to v. It remains to sum over the sources.\n> \nAs there is a confusion for a directed graph, let's fix that input graph can be undirected, weighted or unweighted.\n\n> > > - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code\n> > Farness says how far `u` is from `v`. \\\\\n> \n> NO, it's not the distance from u to v, it's the sum of the distances from every nodes in the graph to u.\n> See https://en.wikipedia.org/wiki/Closeness_centrality where it is written: Closeness was defined by Bavelas (1950) as the reciprocal of the farness.\n> \nYes, thanks for correcting me.\n> > sum_array says it's the sum of distances from `v` to `k random vertices`.\\\\\n> > Please correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\\\\n> \n> In this algorithm, instead of the farness, you use a kind of partial farness, that is the sum of the distances between each of the k source nodes of shortest path trees to v.\n> \nSure.\n>  \n> > > - The method must start checking parameters before doing anything else\n> > > - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.\n> > Sure I will update it.\n> > > - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?\n> > Yes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.\n> \n> but for weighted graphs you use `double`, which make sense since weights can be int or float.\n> \n>  \n> > > - don't call a variable `sum`. It might conflict with builtin methods.\n> > Sure shall I replace it with `sum_of_all_distances`? \n> \n> for instance, yes.\n> \n> However, keep in mind that this sum of all distances is the sum of the farness of the vertices.\n> So instead of adding each distances, it should be faster to compute the sum of the farness.\nThe sum is farness, `not sum of farness`. \\\\\n`sum`: it's the sum of the distances from every nodes in the graph to u(belong to k). \\\\\n`sum of array`: it's the sum of the distances from k nodes in the graph to u(doesn't belong to k). \\\\\n> \n>   \n> > > - `for i in range(0,k)` -> `for i in range(k)`\n> > > - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?\n> > It should be Dijstra, I will update the defination that weighted graph should have only positive weights.\n> >  \n> > > - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?\n> > Yes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\\\\n> \n> This is true in undirected graphs only. In directed graph, you need distances to these k nodes to get exact closeness centrality.\n> \n>  \n> > Other `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. \n> \n> OK\n> \n> > > \n> > > I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.\n> > > So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.\n> > That is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? \n> > If I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. \n> \n> In general it's better to have targeted tickets. So yes we need a new ticket, and yes, you will have to add a dependency between this ticket and the new one, plus rebase on it.\n> \n> It's more time and more work, but we should get in the end a better solution for this ticket.\nSure I will generate a new ticket for `cleaning of the usage of BFS`\n\nTo be double sure, the main motive of the new ticket is to shift `BFS` from `distances_all_pairs.pyx` to the `static_sparse_backend.pyx` and update the reference where ever required.",
    "created_at": "2018-04-15T17:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349352",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:16 dcoudert]:
> > > - Your method is for undirected graphs only, right ?
> > It's applicable to directed graph if it's connected.
> 
> OK, but again I had to check carefully the definition. The closeness centrality of v is computed using distances from each other node to v. So it works because you select k source nodes and compute shortest path distances from these nodes. So for a node v, you know the distance from a source node to v. It remains to sum over the sources.
> 
As there is a confusion for a directed graph, let's fix that input graph can be undirected, weighted or unweighted.

> > > - the notion of `farness`, used in other closeness centrality methods, is the sum of distances, `sum_array` in your code
> > Farness says how far `u` is from `v`. \\
> 
> NO, it's not the distance from u to v, it's the sum of the distances from every nodes in the graph to u.
> See https://en.wikipedia.org/wiki/Closeness_centrality where it is written: Closeness was defined by Bavelas (1950) as the reciprocal of the farness.
> 
Yes, thanks for correcting me.
> > sum_array says it's the sum of distances from `v` to `k random vertices`.\\
> > Please correct me if I am wrong, shall I replace `sum_array` will `sum_of_farness`. \\
> 
> In this algorithm, instead of the farness, you use a kind of partial farness, that is the sum of the distances between each of the k source nodes of shortest path trees to v.
> 
Sure.
>  
> > > - The method must start checking parameters before doing anything else
> > > - You should reorganize your code to separate weighted and unweighted cases. There is no need to call `init_short_digraph` if the graph is weighted.
> > Sure I will update it.
> > > - `cdef long long int *distance` why `long long int` ? The largest distance is the diameter of the graph, and so in unweighted graphs it is at most `n-1`. So `int` or `uint32_t` is more than enough, no ?
> > Yes, I will update it. I kept in mind that I will implement for weighted graph so I have taken long long int.
> 
> but for weighted graphs you use `double`, which make sense since weights can be int or float.
> 
>  
> > > - don't call a variable `sum`. It might conflict with builtin methods.
> > Sure shall I replace it with `sum_of_all_distances`? 
> 
> for instance, yes.
> 
> However, keep in mind that this sum of all distances is the sum of the farness of the vertices.
> So instead of adding each distances, it should be faster to compute the sum of the farness.
The sum is farness, `not sum of farness`. \\
`sum`: it's the sum of the distances from every nodes in the graph to u(belong to k). \\
`sum of array`: it's the sum of the distances from k nodes in the graph to u(doesn't belong to k). \\
> 
>   
> > > - `for i in range(0,k)` -> `for i in range(k)`
> > > - In `distances = shortest_paths(G,randomk[i], algorithm=None)`, which `shortest_paths` method are you calling ?
> > It should be Dijstra, I will update the defination that weighted graph should have only positive weights.
> >  
> > > - according your code for weighted case, the `k` randomly chosen vertices have different centralities since the `sum` increases. Is that right ?
> > Yes, those `k` will be having exact closeness centrality value. as all the remaining vertices will be contributing in calculating closeness value for them. \\
> 
> This is true in undirected graphs only. In directed graph, you need distances to these k nodes to get exact closeness centrality.
> 
>  
> > Other `n-k` vertices will be estimated and only k vertices are contributing there distances in the estimation of `n-k` vertices. 
> 
> OK
> 
> > > 
> > > I will consider the unweighted case later. I'm not confortable with coding again a BFS for short digraph. I think we should do something more clever, like moving method `simple_BFS` from `distances_all_pairs.pyx` to the `static_sparse_graph` backend, and then use it.
> > > So we could have a first ticket devoted to the cleaning of the usage of BFS for `short_digraph`.
> > That is a really good suggestion. So shall I create a new ticket `cleaning of the usage of BFS` or do I need to do it in this ticket? 
> > If I create a new ticket then do I need to wait for `cleaning of the usage of BFS` to be accepted. 
> 
> In general it's better to have targeted tickets. So yes we need a new ticket, and yes, you will have to add a dependency between this ticket and the new one, plus rebase on it.
> 
> It's more time and more work, but we should get in the end a better solution for this ticket.
Sure I will generate a new ticket for `cleaning of the usage of BFS`

To be double sure, the main motive of the new ticket is to shift `BFS` from `distances_all_pairs.pyx` to the `static_sparse_backend.pyx` and update the reference where ever required.



---

archive/issue_comments_349353.json:
```json
{
    "body": "> To be double sure, the main motive of the new ticket is to shift `BFS` from `distances_all_pairs.pyx` to the `static_sparse_backend.pyx` and update the reference where ever required. \n> \n\nYes. This BFS method is specific to `static_sparse_backend.pyx`, so it's better to have it in this file, and then cimport it when needed.",
    "created_at": "2018-04-15T17:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349353",
    "user": "https://github.com/dcoudert"
}
```

> To be double sure, the main motive of the new ticket is to shift `BFS` from `distances_all_pairs.pyx` to the `static_sparse_backend.pyx` and update the reference where ever required. 
> 

Yes. This BFS method is specific to `static_sparse_backend.pyx`, so it's better to have it in this file, and then cimport it when needed.



---

archive/issue_comments_349354.json:
```json
{
    "body": "Replying to [comment:18 dcoudert]:\n\n> Yes. This BFS method is specific to `static_sparse_backend.pyx`, so it's better to have it in this file, and then cimport it when needed.\n> \nThanks, I will create a new ticket and keep you in cc, as my final exams are coming I might not be able to complete it sooner, I will try to update you on or before 22nd.",
    "created_at": "2018-04-15T17:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349354",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:18 dcoudert]:

> Yes. This BFS method is specific to `static_sparse_backend.pyx`, so it's better to have it in this file, and then cimport it when needed.
> 
Thanks, I will create a new ticket and keep you in cc, as my final exams are coming I might not be able to complete it sooner, I will try to update you on or before 22nd.



---

archive/issue_comments_349355.json:
```json
{
    "body": "To indicate a dependency, the right way is to put ticket number #25223 in the `Dependencies` cell of ticket description. I let you do it when you have rebase this ticket on top of it and perform the changes.\n\nDon't forget to set the ticket to `needs review` when ready.",
    "created_at": "2018-05-01T08:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349355",
    "user": "https://github.com/dcoudert"
}
```

To indicate a dependency, the right way is to put ticket number #25223 in the `Dependencies` cell of ticket description. I let you do it when you have rebase this ticket on top of it and perform the changes.

Don't forget to set the ticket to `needs review` when ready.



---

archive/issue_comments_349356.json:
```json
{
    "body": "simple_BFS() will return a single value i.e the highest distance value found in graph G from source but I need complete distance array.\n\nCould you suggest what shall I do?\n1. Change the definition of simple_BFS i.e pass extra parameter i.e flag, if the flag value is 'eccentricity' return single value if the flag is 'distance_array' return distance array.\n\n2. Use own bfs function, a small advantage, it will take O(n) timeless, when comparing to step 1.",
    "created_at": "2018-05-01T17:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349356",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

simple_BFS() will return a single value i.e the highest distance value found in graph G from source but I need complete distance array.

Could you suggest what shall I do?
1. Change the definition of simple_BFS i.e pass extra parameter i.e flag, if the flag value is 'eccentricity' return single value if the flag is 'distance_array' return distance array.

2. Use own bfs function, a small advantage, it will take O(n) timeless, when comparing to step 1.



---

archive/issue_comments_349357.json:
```json
{
    "body": "You should reread the code of `simple_BFS`, that is not a function but a method/procedure, and revise the use of pointers in C ;)\n\nThe method `simple_BFS` takes as input an array `distances`. It fills that array. So you have access to all distances after the call.",
    "created_at": "2018-05-01T17:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349357",
    "user": "https://github.com/dcoudert"
}
```

You should reread the code of `simple_BFS`, that is not a function but a method/procedure, and revise the use of pointers in C ;)

The method `simple_BFS` takes as input an array `distances`. It fills that array. So you have access to all distances after the call.



---

archive/issue_comments_349358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-01T20:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349359.json:
```json
{
    "body": "Replying to [comment:24 dcoudert]:\n> You should reread the code of `simple_BFS`, that is not a function but a method/procedure, and revise the use of pointers in C ;)\n> \n> The method `simple_BFS` takes as input an array `distances`. It fills that array. So you have access to all distances after the call.\n\nYep, you are right, it's a pointer and it's updated.\nMade necessary changes.\n\nPlease have a look and let me know your feedback.",
    "created_at": "2018-05-01T20:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349359",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:24 dcoudert]:
> You should reread the code of `simple_BFS`, that is not a function but a method/procedure, and revise the use of pointers in C ;)
> 
> The method `simple_BFS` takes as input an array `distances`. It fills that array. So you have access to all distances after the call.

Yep, you are right, it's a pointer and it's updated.
Made necessary changes.

Please have a look and let me know your feedback.



---

archive/issue_comments_349360.json:
```json
{
    "body": "There is a mistake in your code with the labels of vertices in `Graph` and in `short_digraph`.\n\nIn `Graph`, the label of a vertex can be an integer, a tuple, a string, or any hashable data structure. In `short_digraph`, vertices are integers from 0 to `n-1`. If you check in methods using short digraph, you can see the use of a list `vertex_to_int` and a dictionary `int_to_vertex` used to use the right label. An important assumption in the graph module is that the list on vertices is always ordered the same way. So usually you can do `int_to_vertex = G.vertices()` and later `int_to_vertex[i]` to access the right vertex label. And `vertex_to_int = {u:i for i,u in enumerate(int_to_vertex)}` can be used when you need the inverse function (not sure you need it here).\n\nYou must correct you code to take that into account.",
    "created_at": "2018-05-01T20:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349360",
    "user": "https://github.com/dcoudert"
}
```

There is a mistake in your code with the labels of vertices in `Graph` and in `short_digraph`.

In `Graph`, the label of a vertex can be an integer, a tuple, a string, or any hashable data structure. In `short_digraph`, vertices are integers from 0 to `n-1`. If you check in methods using short digraph, you can see the use of a list `vertex_to_int` and a dictionary `int_to_vertex` used to use the right label. An important assumption in the graph module is that the list on vertices is always ordered the same way. So usually you can do `int_to_vertex = G.vertices()` and later `int_to_vertex[i]` to access the right vertex label. And `vertex_to_int = {u:i for i,u in enumerate(int_to_vertex)}` can be used when you need the inverse function (not sure you need it here).

You must correct you code to take that into account.



---

archive/issue_comments_349361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-02T10:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349362.json:
```json
{
    "body": "Replying to [comment:29 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[bc78e66](https://git.sagemath.org/sage.git/commit/?id=bc78e665b42a77cdc0025309cfc5c1bd14d339b9)||`Vertex label issue solved`||\n\nThanks for identifying the mistake, corrected the code, please let me know if any future changes are required.",
    "created_at": "2018-05-02T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349362",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:29 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[bc78e66](https://git.sagemath.org/sage.git/commit/?id=bc78e665b42a77cdc0025309cfc5c1bd14d339b9)||`Vertex label issue solved`||

Thanks for identifying the mistake, corrected the code, please let me know if any future changes are required.



---

archive/issue_comments_349363.json:
```json
{
    "body": "You have not adequately corrected the code. Have you tested it ?\n\nI give you a set of corrections to be done.\n\n\n- If the graph is directed, you must raise an error.\n\n```\n-    if G.is_directed():\n-        return \"G should be undirected Graph.\"\n+    if G.is_directed():\n+        raise ValueError(\"G should be undirected Graph.\")\n```\n\n- `cdef int i,j,u,qstart, qend, v` -> `cdef int i, j, u, qstart, qend, v`\n- `cdef uint32_t *p_tmp` not used, so remove\n- `cdef bint weighted = G.weighted()` not needed. You use this value only once\n\n- Check of input parameters must be performed before any malloc and raise an error !\n\n```\n-    if k > n:\n-        return \"k value need to be less than number of nodes\"\n+    if k > n:\n+        raise ValueError(\"k value need to be less than number of nodes\")\n```\n\n- `cdef list int_to_vertex = G.vertices()` must be put before the `if weighted` test. It will be used in the weighted case too\n- `if weighted:` -> `if G.weighted():`\n- `from sage.graphs.base.boost_graph import shortest_paths` you should use `cimport`, no ?\n\nWeighted part:\n- `distances = shortest_paths(G,randomk[i], algorithm='Dijstra')` the value `randomk[i]` is an integer in range `0..n-1`. This is not a valid vertex label. You must use `int_to_vertex[randomk[i]]`.\n- `partial_farness[vertex] = float(distances[vertex])`. Here, `vertex` is the label of a vertex of the graph and `partial_farness` is an array of order `n`. So you need to use a mapping `vertex_to_int`.\n\n\nUnweighted part:\n- `bitset_init` must be done before the for loop. Then, inside the loop you can do a `bitset_clear`.\n- `NULL,waiting_list,seen)` -> `NULL, waiting_list, seen)`",
    "created_at": "2018-05-02T12:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349363",
    "user": "https://github.com/dcoudert"
}
```

You have not adequately corrected the code. Have you tested it ?

I give you a set of corrections to be done.


- If the graph is directed, you must raise an error.

```
-    if G.is_directed():
-        return "G should be undirected Graph."
+    if G.is_directed():
+        raise ValueError("G should be undirected Graph.")
```

- `cdef int i,j,u,qstart, qend, v` -> `cdef int i, j, u, qstart, qend, v`
- `cdef uint32_t *p_tmp` not used, so remove
- `cdef bint weighted = G.weighted()` not needed. You use this value only once

- Check of input parameters must be performed before any malloc and raise an error !

```
-    if k > n:
-        return "k value need to be less than number of nodes"
+    if k > n:
+        raise ValueError("k value need to be less than number of nodes")
```

- `cdef list int_to_vertex = G.vertices()` must be put before the `if weighted` test. It will be used in the weighted case too
- `if weighted:` -> `if G.weighted():`
- `from sage.graphs.base.boost_graph import shortest_paths` you should use `cimport`, no ?

Weighted part:
- `distances = shortest_paths(G,randomk[i], algorithm='Dijstra')` the value `randomk[i]` is an integer in range `0..n-1`. This is not a valid vertex label. You must use `int_to_vertex[randomk[i]]`.
- `partial_farness[vertex] = float(distances[vertex])`. Here, `vertex` is the label of a vertex of the graph and `partial_farness` is an array of order `n`. So you need to use a mapping `vertex_to_int`.


Unweighted part:
- `bitset_init` must be done before the for loop. Then, inside the loop you can do a `bitset_clear`.
- `NULL,waiting_list,seen)` -> `NULL, waiting_list, seen)`



---

archive/issue_comments_349364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-03T14:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349365.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-03T15:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349365",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349366.json:
```json
{
    "body": "1. Added ValueError() instead of return message\n2. Removed all the unused variables\n3. Added test cases\n4. Fixed the gap in weighted part.\nCan't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\\\\n\nTested on both weighted and unweighted.\n\nweighted graph G = `Graph([['0', '1',1],['0', '7',1],['0', '3',1],['0', '11',1],['2', '3',1],['1', '2',1],['1', '12',1],['2', '12',1],['3', '4',1],['3', '6',1],['4', '5',1],['4', '7',1],['4', '6',1],['5', '6',1],['7', '10',1],['7', '8',1],['7', '11',1],['8', '9',1],['8', '10',1],['8', '11',1],['9', '11',1]], weighted = True)`\n\nweighted graph `G = Graph([['0', '1'],['0', '7'],['0', '3'],['0', '11'],['2', '3'],['1', '2'],['1', '12'],['2', '12'],['3', '4'],['3', '6'],['4', '5'],['4', '7'],['4', '6'],['5', '6'],['7', '10'],['7', '8'],['7', '11'],['8', '9'],['8', '10'],['8', '11'],['9', '11']])`\n\nPlease let me know if any more modifications needed.",
    "created_at": "2018-05-03T15:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349366",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

1. Added ValueError() instead of return message
2. Removed all the unused variables
3. Added test cases
4. Fixed the gap in weighted part.
Can't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\

Tested on both weighted and unweighted.

weighted graph G = `Graph([['0', '1',1],['0', '7',1],['0', '3',1],['0', '11',1],['2', '3',1],['1', '2',1],['1', '12',1],['2', '12',1],['3', '4',1],['3', '6',1],['4', '5',1],['4', '7',1],['4', '6',1],['5', '6',1],['7', '10',1],['7', '8',1],['7', '11',1],['8', '9',1],['8', '10',1],['8', '11',1],['9', '11',1]], weighted = True)`

weighted graph `G = Graph([['0', '1'],['0', '7'],['0', '3'],['0', '11'],['2', '3'],['1', '2'],['1', '12'],['2', '12'],['3', '4'],['3', '6'],['4', '5'],['4', '7'],['4', '6'],['5', '6'],['7', '10'],['7', '8'],['7', '11'],['8', '9'],['8', '10'],['8', '11'],['9', '11']])`

Please let me know if any more modifications needed.



---

archive/issue_comments_349367.json:
```json
{
    "body": "Good. I have few more comments.\n\n> Can't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\\\\n\nWell, I don't know if it is really interesting to cimport it.\n\nYou may however do something like that to clarify in your code that this method uses boost:\n\n```\nfrom sage.graphs.base.boost_graph import shortest_paths as boost_shortest_paths\n```\n\n\n\nYou must add\n- a one line description of the method at it's beginning (see other methods for examples).\n\n- a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains\n\nThen,\n- as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465\n\n- You have put a TESTS section. You could also add an EXAMPLES section.\n\n- ```G`` a undirected Graph` -> ```G`` -- a undirected Graph` and same modification for other input\n\n- OUTPUT block: the description is not exactly what you return. By the way, you could return a dictionary indexed by vertices.\n\n- `l = []`. You could directly do `l = list(range(n)`. \n\n- Instead of using `seen_random_vertices[i]`, may be you could only use the shuffled list `l` where the `k` first elements are those in `randomk` and elements `k..n-1` are those for which `seen_random_vertices[i]==0`. Think about it and see if you can simplify the code using this idea.\n\n- I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`\n\n- you will have to add a `bitset_free(seen)` somewhere ;)",
    "created_at": "2018-05-03T16:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349367",
    "user": "https://github.com/dcoudert"
}
```

Good. I have few more comments.

> Can't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\

Well, I don't know if it is really interesting to cimport it.

You may however do something like that to clarify in your code that this method uses boost:

```
from sage.graphs.base.boost_graph import shortest_paths as boost_shortest_paths
```



You must add
- a one line description of the method at it's beginning (see other methods for examples).

- a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains

Then,
- as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465

- You have put a TESTS section. You could also add an EXAMPLES section.

- ```G`` a undirected Graph` -> ```G`` -- a undirected Graph` and same modification for other input

- OUTPUT block: the description is not exactly what you return. By the way, you could return a dictionary indexed by vertices.

- `l = []`. You could directly do `l = list(range(n)`. 

- Instead of using `seen_random_vertices[i]`, may be you could only use the shuffled list `l` where the `k` first elements are those in `randomk` and elements `k..n-1` are those for which `seen_random_vertices[i]==0`. Think about it and see if you can simplify the code using this idea.

- I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`

- you will have to add a `bitset_free(seen)` somewhere ;)



---

archive/issue_comments_349368.json:
```json
{
    "body": "Replying to [comment:35 dcoudert]:\n> Good. I have few more comments.\n> \n> > Can't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\\\\n> \n> Well, I don't know if it is really interesting to cimport it.\n> \n> You may however do something like that to clarify in your code that this method uses boost:\n> {{{\n> from sage.graphs.base.boost_graph import shortest_paths as boost_shortest_paths\n> }}}\nUpdated\n> \n> \n> You must add\n> - a one line description of the method at it's beginning (see other methods for examples).\n> \n> - a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains\n> \nAdded\n> Then,\n> - as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465\n> \nAdded [EDI2014] to index.rst \\\\\nThere are few references like BCM15(centrality_closeness_top_k) which is not available at index.rst \\\\\n\n> - You have put a TESTS section. You could also add an EXAMPLES section.\nAs it's random answers will be keep on changing, any suggestion how I should design examples? \\\\\nWhich case I need to add in current test section?\n> \n> - ```G`` a undirected Graph` -> ```G`` -- a undirected Graph` and same modification for other input\n> \n> - OUTPUT block: the description is not exactly what you return. By the way, you could return a dictionary indexed by vertices.\n> \n> - `l = []`. You could directly do `l = list(range(n)`. \nUpdated\n> \n> - Instead of using `seen_random_vertices[i]`, may be you could only use the shuffled list `l` where the `k` first elements are those in `randomk` and elements `k..n-1` are those for which `seen_random_vertices[i]==0`. Think about it and see if you can simplify the code using this idea.\n> \nGood idea, thanks, as random vertices are stored in `l` there is no need to use `randomk` and `seen_random_vertices`.\n> - I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`\n> \n> - you will have to add a `bitset_free(seen)` somewhere ;)\nUpdated",
    "created_at": "2018-05-05T12:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349368",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:35 dcoudert]:
> Good. I have few more comments.
> 
> > Can't add cimport as `boost_graph.pxd` doesn't have defination of shortest_paths(), shall I go ahead and add necessary lines in `boost_graph.pxd` for cimport instead of import. \\
> 
> Well, I don't know if it is really interesting to cimport it.
> 
> You may however do something like that to clarify in your code that this method uses boost:
> {{{
> from sage.graphs.base.boost_graph import shortest_paths as boost_shortest_paths
> }}}
Updated
> 
> 
> You must add
> - a one line description of the method at it's beginning (see other methods for examples).
> 
> - a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains
> 
Added
> Then,
> - as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465
> 
Added [EDI2014] to index.rst \\
There are few references like BCM15(centrality_closeness_top_k) which is not available at index.rst \\

> - You have put a TESTS section. You could also add an EXAMPLES section.
As it's random answers will be keep on changing, any suggestion how I should design examples? \\
Which case I need to add in current test section?
> 
> - ```G`` a undirected Graph` -> ```G`` -- a undirected Graph` and same modification for other input
> 
> - OUTPUT block: the description is not exactly what you return. By the way, you could return a dictionary indexed by vertices.
> 
> - `l = []`. You could directly do `l = list(range(n)`. 
Updated
> 
> - Instead of using `seen_random_vertices[i]`, may be you could only use the shuffled list `l` where the `k` first elements are those in `randomk` and elements `k..n-1` are those for which `seen_random_vertices[i]==0`. Think about it and see if you can simplify the code using this idea.
> 
Good idea, thanks, as random vertices are stored in `l` there is no need to use `randomk` and `seen_random_vertices`.
> - I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`
> 
> - you will have to add a `bitset_free(seen)` somewhere ;)
Updated



---

archive/issue_comments_349369.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T12:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349370.json:
```json
{
    "body": "The code is becoming very simple and easy to read. I like that.\n\n> > You must add\n> > - a one line description of the method at it's beginning (see other methods for examples).\n\nyou forgot that one.\n\nI suggest `Return an estimation of the closeness centrality of ``G``.`\\\\ \\\\\n \n> > - a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains\n> > \n> Added\n\nshould be same as above\\\\ \\\\\n\n \n> > - as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465\n> > \n> Added [EDI2014] to index.rst \\\\\n> There are few references like BCM15(centrality_closeness_top_k) which is not available at index.rst \\\\\n\nTrue, you can move them since it's only few references.\\\\ \\\\\n \n\n> > - You have put a TESTS section. You could also add an EXAMPLES section.\n> As it's random answers will be keep on changing, any suggestion how I should design examples? \\\\\n> Which case I need to add in current test section?\n\nOne idea is to take a small distance regular graph like a cycle with 5 nodes or a PetersenGraph. Then, you can extract from the solution the list of values, and sort it. It should always be the same, no? \\\\\n\n\nWhat if `G.order() == 0` or `G.order() == 1` ?\nWhat if `G.size() == 0` ?\nIn both cases you can directly return the solution.\n\nAlso, the test `if k > n:` should at the very beginning, before any malloc.\\\\ \\\\\n\n\n\n> > - I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`\nTODO\\\\ \\\\\n\n\nOther corrections:\n\n\n```\n-    The algorithm is based on performing a breadth-first-search (BFS) for\n-    unweighted graph and Dijkstra for weighted graph from each vertex v\n-    from set S, set S: Randomly choose k nodes from n nodes, where k < n\n-    and n is no of nodes in input graph, by using this knowledge estimate\n-    closeness centrality for n - k vertices.\n+    The algorithm first randomly selects a set ``S`` of ``k`` vertices.\n+    Then it computes a the shortest path distances from each vertex in \n+    ``S`` (using breadth-first-search (BFS) for unweighted graph and \n+    Dijkstra for weighted graph) and uses this knowledge to estimate\n+    the closeness centrality of all vertices.\n```\n\n\n\n```\n-    A dictionary indexed by vertices and values as estimated closeness centrality.\n+    A dictionary indexed by vertices and values are estimated closeness centrality.\n```\n",
    "created_at": "2018-05-05T12:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349370",
    "user": "https://github.com/dcoudert"
}
```

The code is becoming very simple and easy to read. I like that.

> > You must add
> > - a one line description of the method at it's beginning (see other methods for examples).

you forgot that one.

I suggest `Return an estimation of the closeness centrality of ``G``.`\\ \\
 
> > - a line like `:func:`centrality_closeness_random_k` | copy-paste-of-the-one-line-description` at the top of the file. It's a table to show what the module contains
> > 
> Added

should be same as above\\ \\

 
> > - as for ticket #25002, references must be placed in `src/doc/en/reference/references/index.rst`. You could also actualize the ref https://dl.acm.org/citation.cfm?id=2660465
> > 
> Added [EDI2014] to index.rst \\
> There are few references like BCM15(centrality_closeness_top_k) which is not available at index.rst \\

True, you can move them since it's only few references.\\ \\
 

> > - You have put a TESTS section. You could also add an EXAMPLES section.
> As it's random answers will be keep on changing, any suggestion how I should design examples? \\
> Which case I need to add in current test section?

One idea is to take a small distance regular graph like a cycle with 5 nodes or a PetersenGraph. Then, you can extract from the solution the list of values, and sort it. It should always be the same, no? \\


What if `G.order() == 0` or `G.order() == 1` ?
What if `G.size() == 0` ?
In both cases you can directly return the solution.

Also, the test `if k > n:` should at the very beginning, before any malloc.\\ \\



> > - I realize that `simple_BFS` calls `bitset_clear`. So you don't need to do it in `centrality_closeness_random_k`
TODO\\ \\


Other corrections:


```
-    The algorithm is based on performing a breadth-first-search (BFS) for
-    unweighted graph and Dijkstra for weighted graph from each vertex v
-    from set S, set S: Randomly choose k nodes from n nodes, where k < n
-    and n is no of nodes in input graph, by using this knowledge estimate
-    closeness centrality for n - k vertices.
+    The algorithm first randomly selects a set ``S`` of ``k`` vertices.
+    Then it computes a the shortest path distances from each vertex in 
+    ``S`` (using breadth-first-search (BFS) for unweighted graph and 
+    Dijkstra for weighted graph) and uses this knowledge to estimate
+    the closeness centrality of all vertices.
```



```
-    A dictionary indexed by vertices and values as estimated closeness centrality.
+    A dictionary indexed by vertices and values are estimated closeness centrality.
```




---

archive/issue_comments_349371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T12:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349372.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-10T15:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349373.json:
```json
{
    "body": "Made necessary changes.\n1. Updated the reference list i.e index.rst and removed the reference block from the code.\n2. Added one example, if `k = n` we will get the same result every time as it's exact not estimated.\n3. Added one test case.\n\nIt's saying auto merge is failed, is it related to my recent commit or it will be taken care.\n\nLet me know your feedback.",
    "created_at": "2018-05-10T15:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349373",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Made necessary changes.
1. Updated the reference list i.e index.rst and removed the reference block from the code.
2. Added one example, if `k = n` we will get the same result every time as it's exact not estimated.
3. Added one test case.

It's saying auto merge is failed, is it related to my recent commit or it will be taken care.

Let me know your feedback.



---

archive/issue_comments_349374.json:
```json
{
    "body": "I also have a merge conflict when trying your branch.\n\nI suggest that you first make sure to use the most develop branch of sagemath (8.3.beta0), and then try to rebase your ticket on it. You will have to resolve the merge conflit.",
    "created_at": "2018-05-10T17:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349374",
    "user": "https://github.com/dcoudert"
}
```

I also have a merge conflict when trying your branch.

I suggest that you first make sure to use the most develop branch of sagemath (8.3.beta0), and then try to rebase your ticket on it. You will have to resolve the merge conflit.



---

archive/issue_comments_349375.json:
```json
{
    "body": "I'm adding Dima to the discussion since he has much more expertise than myself on git.\n\n`@`Dima: Sai Harsh did something wrong with its commits and I don't know how to help him resolving the issue. It might be simple to fix but beyond my ability to use git. Thanks.",
    "created_at": "2018-05-15T11:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349375",
    "user": "https://github.com/dcoudert"
}
```

I'm adding Dima to the discussion since he has much more expertise than myself on git.

`@`Dima: Sai Harsh did something wrong with its commits and I don't know how to help him resolving the issue. It might be simple to fix but beyond my ability to use git. Thanks.



---

archive/issue_comments_349376.json:
```json
{
    "body": "Replying to [comment:43 dcoudert]:\n> I'm adding Dima to the discussion since he has much more expertise than myself on git.\n> \n> `@`Dima: Sai Harsh did something wrong with its commits and I don't know how to help him resolving the issue. It might be simple to fix but beyond my ability to use git. Thanks. \n\nI committed the code on Sage 8.1beta0 and sage was updated to 8.3beta0 because of which automerge failed.\n\nI followed the below doc to update the master. \\\\\nhttp://doc.sagemath.org/html/en/developer/manual_git.html\n\nBut couldn't resolve the problem.\n\nPlease let me know what I should do to solve the problem.",
    "created_at": "2018-05-15T11:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349376",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:43 dcoudert]:
> I'm adding Dima to the discussion since he has much more expertise than myself on git.
> 
> `@`Dima: Sai Harsh did something wrong with its commits and I don't know how to help him resolving the issue. It might be simple to fix but beyond my ability to use git. Thanks. 

I committed the code on Sage 8.1beta0 and sage was updated to 8.3beta0 because of which automerge failed.

I followed the below doc to update the master. \\
http://doc.sagemath.org/html/en/developer/manual_git.html

But couldn't resolve the problem.

Please let me know what I should do to solve the problem.



---

archive/issue_comments_349377.json:
```json
{
    "body": "for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst\n\nSo I removed it from the former and pushed the result in a public branch.\n\nI started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.",
    "created_at": "2018-05-15T11:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349377",
    "user": "https://github.com/dimpase"
}
```

for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst

So I removed it from the former and pushed the result in a public branch.

I started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.



---

archive/issue_comments_349378.json:
```json
{
    "body": "Thank you very much ! I really need to follow a git training...",
    "created_at": "2018-05-15T12:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349378",
    "user": "https://github.com/dcoudert"
}
```

Thank you very much ! I really need to follow a git training...



---

archive/issue_comments_349379.json:
```json
{
    "body": "- `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please\n\n- I suspect that the method is not working for graphs with loops or multiple edges, right ? if it is the case, add `G._scream_if_not_simple()` as first instruction.\n\n- for the unweighted case, you must add `free_short_digraph` at the end of the block.\n\nalmost done ;)",
    "created_at": "2018-05-16T07:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349379",
    "user": "https://github.com/dcoudert"
}
```

- `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please

- I suspect that the method is not working for graphs with loops or multiple edges, right ? if it is the case, add `G._scream_if_not_simple()` as first instruction.

- for the unweighted case, you must add `free_short_digraph` at the end of the block.

almost done ;)



---

archive/issue_comments_349380.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst\n> \n> So I removed it from the former and pushed the result in a public branch.\n> \n> I started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.\n\n`@`dimpase\\\\\nThanks for solving the problem. \\\\\n1. Could you please say what are the commands I need to follow to solve the problem if I face it in future. (i.e auto merge failed)\n2. What is the right way to update the master and rebase it to the current branch?",
    "created_at": "2018-05-16T10:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349380",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:46 dimpase]:
> for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst
> 
> So I removed it from the former and pushed the result in a public branch.
> 
> I started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.

`@`dimpase\\
Thanks for solving the problem. \\
1. Could you please say what are the commands I need to follow to solve the problem if I face it in future. (i.e auto merge failed)
2. What is the right way to update the master and rebase it to the current branch?



---

archive/issue_comments_349381.json:
```json
{
    "body": "Replying to [comment:48 dcoudert]:\n> - `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please\n> \nYes I will update it.\n\n> - I suspect that the method is not working for graphs with loops or multiple edges, right ? if it is the case, add `G._scream_if_not_simple()` as first instruction.\nYes the method work only on simple graph.\n> \n> - for the unweighted case, you must add `free_short_digraph` at the end of the block.\nSure, I will.\n> \n> almost done ;)\nThanks.",
    "created_at": "2018-05-16T10:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349381",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:48 dcoudert]:
> - `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please
> 
Yes I will update it.

> - I suspect that the method is not working for graphs with loops or multiple edges, right ? if it is the case, add `G._scream_if_not_simple()` as first instruction.
Yes the method work only on simple graph.
> 
> - for the unweighted case, you must add `free_short_digraph` at the end of the block.
Sure, I will.
> 
> almost done ;)
Thanks.



---

archive/issue_comments_349382.json:
```json
{
    "body": "and do not forget to set this ticket to \"needs review\" when you think it is ready for review.",
    "created_at": "2018-05-16T10:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349382",
    "user": "https://github.com/dcoudert"
}
```

and do not forget to set this ticket to "needs review" when you think it is ready for review.



---

archive/issue_comments_349383.json:
```json
{
    "body": "Replying to [comment:49 saiharsh]:\n> Replying to [comment:46 dimpase]:\n> > for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst\n> > \n> > So I removed it from the former and pushed the result in a public branch.\n> > \n> > I started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.\n> \n> `@`dimpase\\\\\n> Thanks for solving the problem. \\\\\n> 1. Could you please say what are the commands I need to follow to solve the problem if I face it in future. (i.e auto merge failed)\n\n\nThere is no unique way to solve such issues. For starters, you need to understand the difference between merging and rebasing, see e.g. https://www.atlassian.com/git/tutorials/merging-vs-rebasing\n\n> 2. What is the right way to update the master and rebase it to the current branch?\n\nwhat I did: \n\n 1) make a fresh clone/branch of the master (more precisely, the `develop` branch on the git trac server). Say, if you already have a cloned repo, and assuming \n `trac` is the name of the git trac remote, as shown by `git remote -v`, this would be `git checkout -b my_new_version trac/develop` followed by `git pull trac develop`.\n\n 2) merge your changes; say, if they are already on the git trac in a branch foo, this could done by `git pull trac foo`. If it's merged automatically, done. Else, you need to resolve conflicts and commit the changes you've done. I simply use the command line, although there are various merging tools (they are needed in hard cases with a lot of changes, hopefully not what you have to deal with). This means, edit the files with conflicts marked by `>>>>`, `<<<<`, and `=====` markers, and commit the changes. Finally, don't forget to push your new branch to trac. \n\n 3) alternatively, instead of 1) and 2), you could have done `git pull trac develop` on your branch and resolved conflicts there, just as in 2).\n\nRebasing is less intuitive. I recommend doing `git pull trac develop` on the branch you are working as often as needed (approximately after each new beta/release candidate), but before doing this do a push to git trac server as a backup.\nThis way hopefully rebasing won't be needed.\n\nNeedless to say, make sure your branches are backed up often, say by pushing to a git server (trac or not).",
    "created_at": "2018-05-16T11:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349383",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:49 saiharsh]:
> Replying to [comment:46 dimpase]:
> > for some reason [BCM15] was in src/sage/graphs/centrality.pyx as well as in the index.rst
> > 
> > So I removed it from the former and pushed the result in a public branch.
> > 
> > I started by checking out the latest develop branch from trac, and then pulling the ticket's branch. This failed (as expected) with conflicts marked in centrality.pyx; and that conflict was exactly the spurrous reference to [BCM15], which I removed.
> 
> `@`dimpase\\
> Thanks for solving the problem. \\
> 1. Could you please say what are the commands I need to follow to solve the problem if I face it in future. (i.e auto merge failed)


There is no unique way to solve such issues. For starters, you need to understand the difference between merging and rebasing, see e.g. https://www.atlassian.com/git/tutorials/merging-vs-rebasing

> 2. What is the right way to update the master and rebase it to the current branch?

what I did: 

 1) make a fresh clone/branch of the master (more precisely, the `develop` branch on the git trac server). Say, if you already have a cloned repo, and assuming 
 `trac` is the name of the git trac remote, as shown by `git remote -v`, this would be `git checkout -b my_new_version trac/develop` followed by `git pull trac develop`.

 2) merge your changes; say, if they are already on the git trac in a branch foo, this could done by `git pull trac foo`. If it's merged automatically, done. Else, you need to resolve conflicts and commit the changes you've done. I simply use the command line, although there are various merging tools (they are needed in hard cases with a lot of changes, hopefully not what you have to deal with). This means, edit the files with conflicts marked by `>>>>`, `<<<<`, and `=====` markers, and commit the changes. Finally, don't forget to push your new branch to trac. 

 3) alternatively, instead of 1) and 2), you could have done `git pull trac develop` on your branch and resolved conflicts there, just as in 2).

Rebasing is less intuitive. I recommend doing `git pull trac develop` on the branch you are working as often as needed (approximately after each new beta/release candidate), but before doing this do a push to git trac server as a backup.
This way hopefully rebasing won't be needed.

Needless to say, make sure your branches are backed up often, say by pushing to a git server (trac or not).



---

archive/issue_comments_349384.json:
```json
{
    "body": "Replying to [comment:48 dcoudert]:\n> - `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please\nThere are few paragraphs, in which ```x``` used instead of ``x``. \\\\\nShall I replace for all ```x``` with ``x`` or only to centrality_closeness_random_k() paragraphs?",
    "created_at": "2018-05-17T06:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349384",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:48 dcoudert]:
> - `The algorithm first randomly selects a set ``S`` of ``k`` vertices.` -> `The algorithm first randomly selects a set `S` of `k` vertices.`. Both forms ```S``` and ``S`` are possible, but ``S`` will use latex and is more appropriate for math symbol. Update all the paragraph please
There are few paragraphs, in which ```x``` used instead of ``x``. \\
Shall I replace for all ```x``` with ``x`` or only to centrality_closeness_random_k() paragraphs?



---

archive/issue_comments_349385.json:
```json
{
    "body": "only in your method.",
    "created_at": "2018-05-17T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349385",
    "user": "https://github.com/dcoudert"
}
```

only in your method.



---

archive/issue_comments_349386.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-17T08:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349386",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349387.json:
```json
{
    "body": "Not in the Input block. Sorry for the confusion.",
    "created_at": "2018-05-17T08:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349387",
    "user": "https://github.com/dcoudert"
}
```

Not in the Input block. Sorry for the confusion.



---

archive/issue_comments_349388.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-17T08:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-17T08:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349390.json:
```json
{
    "body": "Replying to [comment:56 dcoudert]:\n> Not in the Input block. Sorry for the confusion.\nI have updated only on definition block.\nPlease have a look.",
    "created_at": "2018-05-17T08:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349390",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:56 dcoudert]:
> Not in the Input block. Sorry for the confusion.
I have updated only on definition block.
Please have a look.



---

archive/issue_comments_349391.json:
```json
{
    "body": "Set the ticket to needs review if you think it is ready for review = you are satisfied with the code, you did several trials with different graphs and it's working well, you have build the documentation and it displays well.",
    "created_at": "2018-05-17T09:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349391",
    "user": "https://github.com/dcoudert"
}
```

Set the ticket to needs review if you think it is ready for review = you are satisfied with the code, you did several trials with different graphs and it's working well, you have build the documentation and it displays well.



---

archive/issue_comments_349392.json:
```json
{
    "body": "Replying to [comment:60 dcoudert]:\n> Set the ticket to needs review if you think it is ready for review = you are satisfied with the code, you did several trials with different graphs and it's working well, you have build the documentation and it displays well.\n\nThanks, yes I feel it's ready.",
    "created_at": "2018-05-17T09:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349392",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:60 dcoudert]:
> Set the ticket to needs review if you think it is ready for review = you are satisfied with the code, you did several trials with different graphs and it's working well, you have build the documentation and it displays well.

Thanks, yes I feel it's ready.



---

archive/issue_comments_349393.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-17T09:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349393",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_349394.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-19T09:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349395.json:
```json
{
    "body": "I did some minor corrections in this ticket. Please check if it is OK for you.\n\nI have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?",
    "created_at": "2018-05-19T09:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349395",
    "user": "https://github.com/dcoudert"
}
```

I did some minor corrections in this ticket. Please check if it is OK for you.

I have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?



---

archive/issue_comments_349396.json:
```json
{
    "body": "Replying to [comment:64 dcoudert]:\n> I did some minor corrections in this ticket. Please check if it is OK for you.\nThanks, the current code is more readable than the previous version. \\\\\nOne doubt can't we use `l[i]` value directly instead of storing it in `u`? is it used for readability? \n\n> I have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?\nI feel raise error is better because the user will get to know more information when compared to returning an empty list. \\\\\nCorrect me if I am wrong.",
    "created_at": "2018-05-19T13:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349396",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:64 dcoudert]:
> I did some minor corrections in this ticket. Please check if it is OK for you.
Thanks, the current code is more readable than the previous version. \\
One doubt can't we use `l[i]` value directly instead of storing it in `u`? is it used for readability? 

> I have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?
I feel raise error is better because the user will get to know more information when compared to returning an empty list. \\
Correct me if I am wrong.



---

archive/issue_comments_349397.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-19T15:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349398.json:
```json
{
    "body": "> One doubt can't we use `l[i]` value directly instead of storing it in `u`? is it used for readability? \n\nI had in mind that it could be faster that way, but I agree that this is such a minor step that is it not interesting. I reverted this change.\n\n> \n> > I have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?\n> I feel raise error is better because the user will get to know more information when compared to returning an empty list. \\\\\n> Correct me if I am wrong.\n\nTo be consistent with the `centrality_closeness` method, we can just consider that this value is not defined for isolated vertices. Check the way I propose to do that, avoiding as much as possible to select isolated vertices.",
    "created_at": "2018-05-19T15:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349398",
    "user": "https://github.com/dcoudert"
}
```

> One doubt can't we use `l[i]` value directly instead of storing it in `u`? is it used for readability? 

I had in mind that it could be faster that way, but I agree that this is such a minor step that is it not interesting. I reverted this change.

> 
> > I have a question for graphs without edges. In method `centrality_closeness`, it is written that the closeness centrality of a vertex without (out)neighbors is not defined. So the method returns an empty dictionary. Here, we raise an error. I don't know which behavior is best. What do you think ?
> I feel raise error is better because the user will get to know more information when compared to returning an empty list. \\
> Correct me if I am wrong.

To be consistent with the `centrality_closeness` method, we can just consider that this value is not defined for isolated vertices. Check the way I propose to do that, avoiding as much as possible to select isolated vertices.



---

archive/issue_comments_349399.json:
```json
{
    "body": "Instead of throwing an error, there is also an option to return `None`. (Just saying :-))",
    "created_at": "2018-05-19T16:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349399",
    "user": "https://github.com/dimpase"
}
```

Instead of throwing an error, there is also an option to return `None`. (Just saying :-))



---

archive/issue_comments_349400.json:
```json
{
    "body": "You are right, but I prefer to have similar behavior than `closeness_centrality`.",
    "created_at": "2018-05-19T17:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349400",
    "user": "https://github.com/dcoudert"
}
```

You are right, but I prefer to have similar behavior than `closeness_centrality`.



---

archive/issue_comments_349401.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-19T20:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349402.json:
```json
{
    "body": "Replying to [comment:67 dcoudert]:\n> To be consistent with the `centrality_closeness` method, we can just consider that this value is not defined for isolated vertices. Check the way I propose to do that, avoiding as much as possible to select isolated vertices.\nI have forgotten about the isolated case, thanks for pointing it out.\nFor it `n` value need to be reduced as isolated vertices are not contributing anything in estimating the closeness centrality for other vertices. \\\\\n1. Remove all the isolated vertices from `G`.\n2. Find Closeness centrality on `G'`.\n3. Add all isolated vertices to `G'`.\nCloseness centrality for isolated vertices is zero.\n\nPlease have a look and let me know your feedback.\n----\nNew commits:",
    "created_at": "2018-05-19T21:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349402",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:67 dcoudert]:
> To be consistent with the `centrality_closeness` method, we can just consider that this value is not defined for isolated vertices. Check the way I propose to do that, avoiding as much as possible to select isolated vertices.
I have forgotten about the isolated case, thanks for pointing it out.
For it `n` value need to be reduced as isolated vertices are not contributing anything in estimating the closeness centrality for other vertices. \\
1. Remove all the isolated vertices from `G`.
2. Find Closeness centrality on `G'`.
3. Add all isolated vertices to `G'`.
Closeness centrality for isolated vertices is zero.

Please have a look and let me know your feedback.
----
New commits:



---

archive/issue_comments_349403.json:
```json
{
    "body": "It is very bad to modify the input graph. It is a typical source of errors, so you should not do it.\n\nA typical bug is when the graph is immutable:\n\n```\nsage: H = Graph([[0,1,2], [(0,1)]], immutable=True)\nsage: centrality_closeness_random_k(H, 1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: Thou shalt not remove a vertex from an immutable graph\n```\n\n\n\n\nAlso, I don't understand why the returned values are not the same in this example.\n\n```\nsage: from sage.graphs.centrality import centrality_closeness_random_k\nsage: G = Graph([(0,1), (2,3)])\nsage: centrality_closeness_random_k(G, 4)\n{0: 1.5, 1: 3.536366632952126e-08, 2: 1.5, 3: 1.5}\nsage: G.add_vertex(4)\nsage: centrality_closeness_random_k(G, 4)\n{0: 3.465914218230295e-08, 1: 3.465914218230295e-08, 2: 1.5, 3: 1.5, 4: 0.0}\n```\n\n\nFinally, as I already said, the behavior must be unified with the `centrality_closeness` method.",
    "created_at": "2018-05-20T08:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349403",
    "user": "https://github.com/dcoudert"
}
```

It is very bad to modify the input graph. It is a typical source of errors, so you should not do it.

A typical bug is when the graph is immutable:

```
sage: H = Graph([[0,1,2], [(0,1)]], immutable=True)
sage: centrality_closeness_random_k(H, 1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: Thou shalt not remove a vertex from an immutable graph
```




Also, I don't understand why the returned values are not the same in this example.

```
sage: from sage.graphs.centrality import centrality_closeness_random_k
sage: G = Graph([(0,1), (2,3)])
sage: centrality_closeness_random_k(G, 4)
{0: 1.5, 1: 3.536366632952126e-08, 2: 1.5, 3: 1.5}
sage: G.add_vertex(4)
sage: centrality_closeness_random_k(G, 4)
{0: 3.465914218230295e-08, 1: 3.465914218230295e-08, 2: 1.5, 3: 1.5, 4: 0.0}
```


Finally, as I already said, the behavior must be unified with the `centrality_closeness` method.



---

archive/issue_comments_349404.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-20T08:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349404",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_349405.json:
```json
{
    "body": "Replying to [comment:72 dcoudert]:\n> It is very bad to modify the input graph. It is a typical source of errors, so you should not do it.\n> \n> A typical bug is when the graph is immutable:\n> {{{\n> sage: H = Graph([[0,1,2], [(0,1)]], immutable=True)\n> sage: centrality_closeness_random_k(H, 1)\n> ---------------------------------------------------------------------------\n> ValueError                                Traceback (most recent call last)\n> ...\n> ValueError: Thou shalt not remove a vertex from an immutable graph\n> }}}\n> \nI will update it the code in which I won't remove the vertex from input graph `G`.\n> \n> \n> Also, I don't understand why the returned values are not the same in this example.\n> {{{\n> sage: from sage.graphs.centrality import centrality_closeness_random_k\n> sage: G = Graph([(0,1), (2,3)])\n> sage: centrality_closeness_random_k(G, 4)\n> {0: 1.5, 1: 3.536366632952126e-08, 2: 1.5, 3: 1.5}\n> sage: G.add_vertex(4)\n> sage: centrality_closeness_random_k(G, 4)\n> {0: 3.465914218230295e-08, 1: 3.465914218230295e-08, 2: 1.5, 3: 1.5, 4: 0.0}\n> }}}\n> \nIt's because the estimation is defined on connected Graph not on disconnected graph.\nShall I use `connected_components_subgraphs()` function and estimate on connected component? but shall I take `k` value for each connected component? for some connected component `k<n` and for other `k>n`. \\\\\nOne option could be `k=n` if `k>n` or we can update input should be connected. \\\\\nWhich one could be better?\n\n> Finally, as I already said, the behavior must be unified with the `centrality_closeness` method.\nYes, the method should be.",
    "created_at": "2018-05-20T09:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349405",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:72 dcoudert]:
> It is very bad to modify the input graph. It is a typical source of errors, so you should not do it.
> 
> A typical bug is when the graph is immutable:
> {{{
> sage: H = Graph([[0,1,2], [(0,1)]], immutable=True)
> sage: centrality_closeness_random_k(H, 1)
> ---------------------------------------------------------------------------
> ValueError                                Traceback (most recent call last)
> ...
> ValueError: Thou shalt not remove a vertex from an immutable graph
> }}}
> 
I will update it the code in which I won't remove the vertex from input graph `G`.
> 
> 
> Also, I don't understand why the returned values are not the same in this example.
> {{{
> sage: from sage.graphs.centrality import centrality_closeness_random_k
> sage: G = Graph([(0,1), (2,3)])
> sage: centrality_closeness_random_k(G, 4)
> {0: 1.5, 1: 3.536366632952126e-08, 2: 1.5, 3: 1.5}
> sage: G.add_vertex(4)
> sage: centrality_closeness_random_k(G, 4)
> {0: 3.465914218230295e-08, 1: 3.465914218230295e-08, 2: 1.5, 3: 1.5, 4: 0.0}
> }}}
> 
It's because the estimation is defined on connected Graph not on disconnected graph.
Shall I use `connected_components_subgraphs()` function and estimate on connected component? but shall I take `k` value for each connected component? for some connected component `k<n` and for other `k>n`. \\
One option could be `k=n` if `k>n` or we can update input should be connected. \\
Which one could be better?

> Finally, as I already said, the behavior must be unified with the `centrality_closeness` method.
Yes, the method should be.



---

archive/issue_comments_349406.json:
```json
{
    "body": "I don't see any suitable way to handle properly connected components and isolated vertices.\nAlso I propose a radical solution: make this method work only for connected graphs, and raise an error if the graph is not connected.\nOtherwise we will continue to discuss for ever without reaching a satisfactory solution.\n\nSo do the required modifications and mention it in the documentation of the method.",
    "created_at": "2018-05-20T10:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349406",
    "user": "https://github.com/dcoudert"
}
```

I don't see any suitable way to handle properly connected components and isolated vertices.
Also I propose a radical solution: make this method work only for connected graphs, and raise an error if the graph is not connected.
Otherwise we will continue to discuss for ever without reaching a satisfactory solution.

So do the required modifications and mention it in the documentation of the method.



---

archive/issue_comments_349407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-20T15:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349408.json:
```json
{
    "body": "Replying to [comment:74 dcoudert]:\n> I don't see any suitable way to handle properly connected components and isolated vertices.\n> Also I propose a radical solution: make this method work only for connected graphs, and raise an error if the graph is not connected.\n> Otherwise we will continue to discuss for ever without reaching a satisfactory solution.\n> \n> So do the required modifications and mention it in the documentation of the method.\nAs is_connected case is added. They won't be any Isolated vertices case. \\\\\nAs `closeness_centrality_top_k` make `k = n` if `k > n`, I updated same in random_k.",
    "created_at": "2018-05-20T15:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349408",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:74 dcoudert]:
> I don't see any suitable way to handle properly connected components and isolated vertices.
> Also I propose a radical solution: make this method work only for connected graphs, and raise an error if the graph is not connected.
> Otherwise we will continue to discuss for ever without reaching a satisfactory solution.
> 
> So do the required modifications and mention it in the documentation of the method.
As is_connected case is added. They won't be any Isolated vertices case. \\
As `closeness_centrality_top_k` make `k = n` if `k > n`, I updated same in random_k.



---

archive/issue_comments_349409.json:
```json
{
    "body": "OK. Make sense.\n\nDon't forget to set the ticket to \"needs review\" when you think it's ready.",
    "created_at": "2018-05-20T17:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349409",
    "user": "https://github.com/dcoudert"
}
```

OK. Make sense.

Don't forget to set the ticket to "needs review" when you think it's ready.



---

archive/issue_comments_349410.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-20T17:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349410",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_349411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-21T09:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349412.json:
```json
{
    "body": "I fixed a doctest error and did some minor corrections. In particular, check connectivity after other tests.\n\nDo you agree ?",
    "created_at": "2018-05-21T09:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349412",
    "user": "https://github.com/dcoudert"
}
```

I fixed a doctest error and did some minor corrections. In particular, check connectivity after other tests.

Do you agree ?



---

archive/issue_comments_349413.json:
```json
{
    "body": "Replying to [comment:80 dcoudert]:\n> I fixed a doctest error and did some minor corrections. In particular, check connectivity after other tests.\n> \n> Do you agree ?\nYes I agree.\nThanks for taking the case for a graph with zero vertices which is a connected graph.",
    "created_at": "2018-05-21T09:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349413",
    "user": "https://trac.sagemath.org/admin/accounts/users/saiharsh"
}
```

Replying to [comment:80 dcoudert]:
> I fixed a doctest error and did some minor corrections. In particular, check connectivity after other tests.
> 
> Do you agree ?
Yes I agree.
Thanks for taking the case for a graph with zero vertices which is a connected graph.



---

archive/issue_comments_349414.json:
```json
{
    "body": "> Thanks for taking the case for a graph with zero vertices which is a connected graph. \nIt was causing an error since a bitset cannot have size 0.",
    "created_at": "2018-05-21T09:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349414",
    "user": "https://github.com/dcoudert"
}
```

> Thanks for taking the case for a graph with zero vertices which is a connected graph. 
It was causing an error since a bitset cannot have size 0.



---

archive/issue_comments_349415.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-21T09:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349415",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_349416.json:
```json
{
    "body": "For me this patch is now good to go.",
    "created_at": "2018-05-21T09:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349416",
    "user": "https://github.com/dcoudert"
}
```

For me this patch is now good to go.



---

archive/issue_events_023206.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-24T07:10:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24886#event-23206"
}
```



---

archive/issue_comments_349417.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-24T07:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24886#issuecomment-349417",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
