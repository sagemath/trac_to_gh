# Issue 29913: Upgrade cmake to 3.17.3

archive/issues_029913.json:
```json
{
    "body": "CC:  @novoselt @kiwifb @videlec @orlitzky @antonio-rojas @isuruf\n\n3.18.0 also came out today, but let's avoid .0 releases\n\nhttps://cmake.org/cmake/help/v3.17/release/3.17.html\n\nIssue created by migration from https://trac.sagemath.org/ticket/30150\n\n",
    "created_at": "2020-07-15T16:47:54Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Upgrade cmake to 3.17.3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29913",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @novoselt @kiwifb @videlec @orlitzky @antonio-rojas @isuruf

3.18.0 also came out today, but let's avoid .0 releases

https://cmake.org/cmake/help/v3.17/release/3.17.html

Issue created by migration from https://trac.sagemath.org/ticket/30150





---

archive/issue_comments_424398.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424398",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424399.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424399",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_424400.json:
```json
{
    "body": "I would like to review this ticket. But I have few questions before.\n\nI had in mind to test if I can build cryptominisat using that updated version of cmake. But, I am surprised to see that I have cryptominisat installed, but not cmake in my recent build of sage:\n\n\n```\n$ sage -version\nSageMath version 9.2.beta9, Release Date: 2020-08-18\n$ sage -optional\n...\ncmake...................................3.11.0 (not_installed)\ncoxeter3................................8ac9c71723c8ca5...\ncryptominisat...........................5.6.8 (5.6.8)\n...\n```\n\n\nBut cmake is a dependency of cryptominisat:\n\n\n```\n$ cat build/pkgs/cryptominisat/dependencies \n$(PYTHON) m4ri zlib libpng | cmake sqlite boost_cropped\n\n----------\nAll lines of this file are ignored except the first.\nIt is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.\n```\n\n\nIs cmake really used/installed when I compile cryptominisat?\n\nIs it because I wrote `--enable-cryptominisat` but not `--enable-cmake` in my `./configure`? I thought that `cmake` would be automatically enabled?\n\n\n```\n$ head config.log \nThis file contains any messages produced by compilers while\nrunning configure, to aid debugging if configure makes a mistake.\n\nIt was created by Sage configure 9.2.beta9, which was\ngenerated by GNU Autoconf 2.69.  Invocation command line was\n\n  $ ./configure --enable-experimental-packages --enable-download-from-upstream-url --enable-ccache --enable-dot2tex --enable-rst2ipynb --enable-openssl --enable-cbc --enable-cryptominisat --enable-pycosat --enable-glucose --enable-sage_numerical_backends_coin --enable-pynormaliz --enable-latte_int --enable-awali --enable-fricas\n\n## --------- ##\n## Platform. ##\n```\n",
    "created_at": "2020-08-19T13:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424400",
    "user": "https://github.com/seblabbe"
}
```

I would like to review this ticket. But I have few questions before.

I had in mind to test if I can build cryptominisat using that updated version of cmake. But, I am surprised to see that I have cryptominisat installed, but not cmake in my recent build of sage:


```
$ sage -version
SageMath version 9.2.beta9, Release Date: 2020-08-18
$ sage -optional
...
cmake...................................3.11.0 (not_installed)
coxeter3................................8ac9c71723c8ca5...
cryptominisat...........................5.6.8 (5.6.8)
...
```


But cmake is a dependency of cryptominisat:


```
$ cat build/pkgs/cryptominisat/dependencies 
$(PYTHON) m4ri zlib libpng | cmake sqlite boost_cropped

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
```


Is cmake really used/installed when I compile cryptominisat?

Is it because I wrote `--enable-cryptominisat` but not `--enable-cmake` in my `./configure`? I thought that `cmake` would be automatically enabled?


```
$ head config.log 
This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.

It was created by Sage configure 9.2.beta9, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ ./configure --enable-experimental-packages --enable-download-from-upstream-url --enable-ccache --enable-dot2tex --enable-rst2ipynb --enable-openssl --enable-cbc --enable-cryptominisat --enable-pycosat --enable-glucose --enable-sage_numerical_backends_coin --enable-pynormaliz --enable-latte_int --enable-awali --enable-fricas

## --------- ##
## Platform. ##
```




---

archive/issue_comments_424401.json:
```json
{
    "body": "Further down in config.log you can see whether it accepted system cmake. In this case, it does not build its own copy.",
    "created_at": "2020-08-19T15:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424401",
    "user": "https://github.com/mkoeppe"
}
```

Further down in config.log you can see whether it accepted system cmake. In this case, it does not build its own copy.



---

archive/issue_comments_424402.json:
```json
{
    "body": "CMake 3.18.1 and CMake 3.17.4 were released.",
    "created_at": "2020-08-19T23:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424402",
    "user": "https://github.com/slel"
}
```

CMake 3.18.1 and CMake 3.17.4 were released.



---

archive/issue_comments_424403.json:
```json
{
    "body": "You are right:\n\n```\n$ grep -C2 cmake config.log\n...\n## ------------------------------------------------------ ##\n## Checking whether SageMath should install SPKG cmake... ##\n## ------------------------------------------------------ ##\nconfigure:15772: checking for cmake >= 3.4\nconfigure:15849: result: /usr/bin/cmake\nconfigure:15858: will use system package and not install SPKG cmake\n...\n```\n\n\nThen how can I make sure that the cmake from Sage is used when compiling cryptominisat? \nIs `.configure --enable-cmake` enough?",
    "created_at": "2020-08-20T07:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424403",
    "user": "https://github.com/seblabbe"
}
```

You are right:

```
$ grep -C2 cmake config.log
...
## ------------------------------------------------------ ##
## Checking whether SageMath should install SPKG cmake... ##
## ------------------------------------------------------ ##
configure:15772: checking for cmake >= 3.4
configure:15849: result: /usr/bin/cmake
configure:15858: will use system package and not install SPKG cmake
...
```


Then how can I make sure that the cmake from Sage is used when compiling cryptominisat? 
Is `.configure --enable-cmake` enough?



---

archive/issue_comments_424404.json:
```json
{
    "body": "I managed to install cmake 3.17.3 correctly. I tested that cryptominisat which depends on cmake installs correctly. The following part of the log of cryptominisat install confirms me that it used the version cmake 3.17.3 I just installed:\n\n\n```\nCMake Warning (dev) at /home/slabbe/GitBox/sage/local/share/cmake-3.17/Modules/FindPackageHandleStandardArgs.cmake:272 (message):\n  The package name passed to `find_package_handle_standard_args` (VALGRIND)\n  does not match the name of the calling package (Valgrind).  This can lead\n  to problems in calling code that expects `find_package` result variables\n  (e.g., `_FOUND`) to follow a certain pattern.\n```\n\n\nFor me it is a positive review. I let Matthias change the status of this ticket to positive review  OR update the branch to 3.17.4 and keep it as needs review.",
    "created_at": "2020-08-20T07:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424404",
    "user": "https://github.com/seblabbe"
}
```

I managed to install cmake 3.17.3 correctly. I tested that cryptominisat which depends on cmake installs correctly. The following part of the log of cryptominisat install confirms me that it used the version cmake 3.17.3 I just installed:


```
CMake Warning (dev) at /home/slabbe/GitBox/sage/local/share/cmake-3.17/Modules/FindPackageHandleStandardArgs.cmake:272 (message):
  The package name passed to `find_package_handle_standard_args` (VALGRIND)
  does not match the name of the calling package (Valgrind).  This can lead
  to problems in calling code that expects `find_package` result variables
  (e.g., `_FOUND`) to follow a certain pattern.
```


For me it is a positive review. I let Matthias change the status of this ticket to positive review  OR update the branch to 3.17.4 and keep it as needs review.



---

archive/issue_comments_424405.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-22T03:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424405",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_424406.json:
```json
{
    "body": "Let's go for 3.18.2 which seems to have an important fix for backward compatibility",
    "created_at": "2020-08-22T03:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424406",
    "user": "https://github.com/mkoeppe"
}
```

Let's go for 3.18.2 which seems to have an important fix for backward compatibility



---

archive/issue_comments_424407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-23T22:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424408.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-23T22:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424408",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424409.json:
```json
{
    "body": "On Ubuntu 16.04 (yes I know, I update to 20.04 soon:), I confirm that cmake 3.18 builds ok. I also tested that cryptominisat and awali optional packages which depend on cmake build ok.",
    "created_at": "2020-08-25T13:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424409",
    "user": "https://github.com/seblabbe"
}
```

On Ubuntu 16.04 (yes I know, I update to 20.04 soon:), I confirm that cmake 3.18 builds ok. I also tested that cryptominisat and awali optional packages which depend on cmake build ok.



---

archive/issue_comments_424410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-25T13:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424410",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424411.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-08-27T20:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424411",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_077724.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-30T08:39:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29913#event-77724"
}
```



---

archive/issue_comments_424412.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-30T08:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29913#issuecomment-424412",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
