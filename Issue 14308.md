# Issue 14308: Use ....: doctest continuations everywhere

Issue created by migration from https://trac.sagemath.org/ticket/14512

Original creator: jdemeyer

Original creation time: 2013-05-01 08:26:36

Assignee: mvngu

CC:  roed zimmerma kcrisman

Automatically replace

```
sage:
...
...
```

by

```
sage:
....:
....:
```



---

Comment by vbraun created at 2013-05-01 09:36:27

How about
  * spell out in the developer guide how to write line continuations
  * disallow the old notation

Otherwise people will just keep using the old-style line contiuations.


---

Comment by jdemeyer created at 2013-05-02 05:43:22

Replying to [comment:3 vbraun]:
> How about
>   * spell out in the developer guide how to write line continuations
This is already done (although not yet in the online documentation, which is for Sage 5.8).

>   * disallow the old notation
Maybe eventually we should do this (and then we could also allow doctests whose expected output starts with `...`). But I think it's better to allow for a period where `...` still works but `....:` is encouraged.


---

Comment by jdemeyer created at 2013-05-02 06:00:43

script to generate the patch


---

Attachment


---

Comment by jdemeyer created at 2013-05-02 06:24:24

Changing status from new to needs_review.


---

Comment by nthiery created at 2013-05-03 21:08:27

Ouch ... This is likely to be a pain and create lots of conflicts ... Is it really worth the trouble?

Well, luckily it should not be too hard to rebase the patches, and it might get less noticed in the middle of the change of workflow. But still ...


---

Comment by vbraun created at 2013-05-03 21:25:51

We should do it at the same time as the trailing-whitespace patch, I think. People won't know what hit them ;-)


---

Comment by jdemeyer created at 2013-05-04 06:20:24

Replying to [comment:6 nthiery]:
> Ouch ... This is likely to be a pain and create lots of conflicts ... Is it really worth the trouble?
I think it would be good to change these doctests. If we disallow the `...` syntax, then we could finally write doctests with expected output starting with ellipsis `...`.

> Well, luckily it should not be too hard to rebase the patches, and it might get less noticed in the middle of the change of workflow.
With some small modifications, the script on this ticket could be used to auto-rebase patches. I could run this script when merging patches and I could also run it on the sage-combinat queue for example. I think that should ease most of the pain.


---

Comment by nthiery created at 2013-05-05 14:25:27

Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 nthiery]:
> > Ouch ... This is likely to be a pain and create lots of conflicts ... Is it really worth the trouble?
> I think it would be good to change these doctests. If we disallow the `...` syntax, then we could finally write doctests with expected output starting with ellipsis `...`.

Well, I very much hope the "..." syntax won't be disallowed right
away: people have a *lot* of .sage files out there which include
doctests. Dropping backward compatibility will force them to update
them at once. Which means they won't be able to share them properly
with other people running older versions of Sage (ok, the files are
still usable, but one won't be able to run the tests; for example to
make sure that everything works fine with all versions in use).

There are also printed or about to be printed *books* that have been
written with this syntax and sagetex. It's useful to be able to test
the examples in those books on various versions of Sage over a non
trivial amount of time.

I appreciate the gain of tests starting with "...:. All our "Traceback
..." lines are kind of silly. But it's really not critical either. We
lived without it for years, we could wait a bit more.

> > Well, luckily it should not be too hard to rebase the patches, and it might get less noticed in the middle of the change of workflow.
> With some small modifications, the script on this ticket could be used to auto-rebase patches. I could run this script when merging patches and I could also run it on the sage-combinat queue for example. I think that should ease most of the pain.

I appreciate the offer! Please take into account that, once rebased,
the patch won't apply anymore on "older" versions of Sage. Well,
unless you duplicate the patch in the queue, with guards, and all the
usual pain of duplication for things that are still evolving.

So as much I could be ok with this change occurring right at the time
the Sage-Combinat queue gets reborn as a git tree (with e.g. the
patches being auto-rebased when they are imported into git). As much I
would oppose a change before that. I guess that means not in any 5.*.

There will be a lot of turmoil ahead for us to handle the
transition. Please don't add yet another hurdle!

Cheers,
                       Nicolas


---

Comment by jdemeyer created at 2013-05-05 19:56:39

Nicolas, I actually totally understood your point.

How do you feel about automatically converting all new/changed doctests to the new format (say, with one patch per beta to do that)?


---

Comment by nthiery created at 2013-05-06 01:35:35

Replying to [comment:10 jdemeyer]:
> Nicolas, I actually totally understood your point.
> 
> How do you feel about automatically converting all new/changed doctests to the new format (say, with one patch per beta to do that)?

Way to go! Or even requesting that any new/changed doctest should use the new syntax right away, like we have been doing for whitespaces and other things.

And hopefuly, once we have switched to the new workflow, merging/rebasing will be much smoother. In that case, large scale changes like the above could become reasonable (which would be good!).

Speaking of which: one interesting tool is http://coccinelle.lip6.fr/. It allow to describe such changes using "semantic" meta-patches, which are much more context free and could make merges much easier. I haven't tried it myself.


---

Comment by jdemeyer created at 2013-05-06 08:42:31

Replying to [comment:11 nthiery]:
> > How do you feel about automatically converting all new/changed doctests to the new format (say, with one patch per beta to do that)?
> 
> Way to go! Or even requesting that any new/changed doctest should use the new syntax right away, like we have been doing for whitespaces and other things.
Well, we're not forcing anything for whitespace, we're just _suggesting_...


---

Comment by jdemeyer created at 2013-05-06 12:23:02

Replying to [comment:11 nthiery]:
> Speaking of which: one interesting tool is http://coccinelle.lip6.fr/. It allow to describe such changes using "semantic" meta-patches, which are much more context free and could make merges much easier.
From what I have seen, it looks like a good tool to _generate_ a patch like on this ticket, but it doesn't seem to solve to problem of _rebasing_ other patches.


---

Comment by nthiery created at 2013-05-06 14:28:21

From the talk I had seen some time ago, there was some interesting "patch" arithmetic that could be done using the semantic. However I haven't followed up to see what's actually implemented / available.


---

Comment by ncohen created at 2013-05-12 09:08:31

sooooo what happens with this patch ? Does it still need a review ?

Nathann


---

Comment by kcrisman created at 2013-06-20 18:20:38

See [my recent message on sage-devel](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/Ez_KboQZTIA) about this;  as far as I can tell, this breaks the live documentation.  I haven't tried the patch here, this is from experimentation on #13381.


---

Comment by kcrisman created at 2013-06-20 19:16:14

This has been confirmed on the same thread.


---

Comment by kini created at 2013-06-22 03:16:03

It would be nice if you could also check if the indentation level % 4 = 2 and remove two spaces after the `:` if so.


---

Comment by kini created at 2013-06-22 03:20:52

Actually, a version of what I requested which is guaranteed not to break even weird looking doctests probably is nontrivial. Never mind, I guess. I guess it's not so terrible to have doctests that look like this:


```
sage: def f():
....:       if 0 == 0:
....:           return false
....:       return true
```



---

Comment by kcrisman created at 2013-06-24 20:31:20

> See [my recent message on sage-devel](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/Ez_KboQZTIA) about this;  as far as I can tell, this breaks the live documentation.  I haven't tried the patch here, this is from experimentation on #13381.
Okay, this seems to be fixed [here](https://github.com/sagemath/sagenb/pull/172), so I'm making this ticket depend on the sagenb upgrade.


---

Comment by pbruin created at 2014-04-26 13:24:33

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2014-04-26 13:24:33

The patch must be outdated by now, and the script is still based on Mercurial...


---

Comment by jdemeyer created at 2014-11-23 20:21:07

I propose to do this just for documentation.


---

Comment by jdemeyer created at 2014-11-23 20:21:07

Changing component from doctest coverage to documentation.


---

Comment by jdemeyer created at 2014-11-24 08:58:26

New commits:


---

Comment by jdemeyer created at 2014-11-24 08:58:26

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-11-24 09:01:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vbraun created at 2014-11-24 11:52:38

ready for review now?


---

Comment by jdemeyer created at 2014-11-24 18:02:34

Replying to [comment:30 vbraun]:
> ready for review now?
Yes.


---

Comment by vbraun created at 2014-11-24 18:37:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-11-25 11:25:57

Resolution: fixed
