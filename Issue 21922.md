# Issue 21922: Upgrade to latest libpng

archive/issues_021922.json:
```json
{
    "body": "CC:  jpflori frederichan\n\n**Tarball**: http://download.sourceforge.net/libpng/libpng-1.6.28.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/22159\n\n",
    "created_at": "2017-01-09T10:41:42Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade to latest libpng",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21922",
    "user": "jdemeyer"
}
```
CC:  jpflori frederichan

**Tarball**: http://download.sourceforge.net/libpng/libpng-1.6.28.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/22159





---

archive/issue_comments_304410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-09T13:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304410",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_304411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-09T14:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_304412.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-09T15:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304412",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_304413.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-10T09:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304413",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304414.json:
```json
{
    "body": "Looks good to me.\nLet the patchbots do their job.",
    "created_at": "2017-01-10T09:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304414",
    "user": "jpflori"
}
```

Looks good to me.
Let the patchbots do their job.



---

archive/issue_comments_304415.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-10T13:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304415",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_304416.json:
```json
{
    "body": "I have some doubts regarding `giac`. Setting this back to needs_work for now...",
    "created_at": "2017-01-10T13:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304416",
    "user": "jdemeyer"
}
```

I have some doubts regarding `giac`. Setting this back to needs_work for now...



---

archive/issue_comments_304417.json:
```json
{
    "body": "Changing keywords from \"\" to \"atelierpari2017\".",
    "created_at": "2017-01-11T08:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304417",
    "user": "jdemeyer"
}
```

Changing keywords from "" to "atelierpari2017".



---

archive/issue_comments_304418.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-01-12T13:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304418",
    "user": "jpflori"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_304419.json:
```json
{
    "body": "Fails in giac\n\n```\n[giac-1.2.2.103] /bin/bash ../libtool --tag=CXX   --mode=link g++  -g -O2 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS  -L/home/buildbot/slave/sage_git/build/local/lib -Wl,-rpath,/home/buildbot/slave/sage_git/build/local/lib  -o aide aide.o libxcas.la -lreadline  -ldl -lpng -lm -lmpfi -lmpfr -lgmp  -lgsl -lgslcblas  -lrt -lpthread -ldl -lpng -lm -lmpfi -lmpfr -lgmp \n25420[giac-1.2.2.103] libtool: link: g++ -g -O2 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -Wl,-rpath -Wl,/home/buildbot/slave/sage_git/build/local/lib -o .libs/aide aide.o  -L/home/buildbot/slave/sage_git/build/local/lib ./.libs/libxcas.a /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so -lntl -lpari -lreadline -lgsl -lgslcblas -lrt -lpthread -ldl -lpng -lm -lmpfi -lmpfr -lgmp -Wl,-rpath -Wl,/home/buildbot/slave/sage_git/build/local/lib\n25421[giac-1.2.2.103] /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so: undefined reference to `png_set_longjmp_fn'\n25422[giac-1.2.2.103] collect2: error: ld returned 1 exit status\n25423[giac-1.2.2.103] Makefile:574: recipe for target 'icas' failed\n25424[giac-1.2.2.103] make[5]: *** [icas] Error 1\n25425[giac-1.2.2.103] /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so: undefined reference to `png_set_longjmp_fn'\n25426[giac-1.2.2.103] collect2: error: ld returned 1 exit status\n25427[giac-1.2.2.103] Makefile:571: recipe for target 'aide' failed\n```\n",
    "created_at": "2017-01-22T10:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304419",
    "user": "vbraun"
}
```

Fails in giac

```
[giac-1.2.2.103] /bin/bash ../libtool --tag=CXX   --mode=link g++  -g -O2 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS  -L/home/buildbot/slave/sage_git/build/local/lib -Wl,-rpath,/home/buildbot/slave/sage_git/build/local/lib  -o aide aide.o libxcas.la -lreadline  -ldl -lpng -lm -lmpfi -lmpfr -lgmp  -lgsl -lgslcblas  -lrt -lpthread -ldl -lpng -lm -lmpfi -lmpfr -lgmp 
25420[giac-1.2.2.103] libtool: link: g++ -g -O2 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -Wl,-rpath -Wl,/home/buildbot/slave/sage_git/build/local/lib -o .libs/aide aide.o  -L/home/buildbot/slave/sage_git/build/local/lib ./.libs/libxcas.a /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so -lntl -lpari -lreadline -lgsl -lgslcblas -lrt -lpthread -ldl -lpng -lm -lmpfi -lmpfr -lgmp -Wl,-rpath -Wl,/home/buildbot/slave/sage_git/build/local/lib
25421[giac-1.2.2.103] /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so: undefined reference to `png_set_longjmp_fn'
25422[giac-1.2.2.103] collect2: error: ld returned 1 exit status
25423[giac-1.2.2.103] Makefile:574: recipe for target 'icas' failed
25424[giac-1.2.2.103] make[5]: *** [icas] Error 1
25425[giac-1.2.2.103] /home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/giac-1.2.2.103/src/src/.libs/libgiac.so: undefined reference to `png_set_longjmp_fn'
25426[giac-1.2.2.103] collect2: error: ld returned 1 exit status
25427[giac-1.2.2.103] Makefile:571: recipe for target 'aide' failed
```




---

archive/issue_comments_304420.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-22T10:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304420",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_304421.json:
```json
{
    "body": "Is this using `ccache`? I remember a similar error where it turned out to be a `ccache` bug. Just to be sure, could you try again with `CCACHE_DISABLE=1`?",
    "created_at": "2017-01-22T11:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304421",
    "user": "jdemeyer"
}
```

Is this using `ccache`? I remember a similar error where it turned out to be a `ccache` bug. Just to be sure, could you try again with `CCACHE_DISABLE=1`?



---

archive/issue_comments_304422.json:
```json
{
    "body": "Also happens on buildbot without ccache",
    "created_at": "2017-01-22T13:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304422",
    "user": "vbraun"
}
```

Also happens on buildbot without ccache



---

archive/issue_comments_304423.json:
```json
{
    "body": "OK, thanks for the info.",
    "created_at": "2017-01-23T07:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304423",
    "user": "jdemeyer"
}
```

OK, thanks for the info.



---

archive/issue_comments_304424.json:
```json
{
    "body": "On fedora 25 where my system libpng is 1.6.27 I was able to built giac with your libpng 1.6.28.\n\nOn a debian system with libpng12 installed I was able to reproduce the above error.\n\nBut cd in src/src/.libs and edit libgiac.la with -lpng16 instead of -lpng and I was able to end the built.\n\nDoes it worth a patch (do you have a similar pb elsewhere?) or should I ask parisse if it is possible to add a --disable-png in configure?",
    "created_at": "2017-01-25T17:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304424",
    "user": "frederichan"
}
```

On fedora 25 where my system libpng is 1.6.27 I was able to built giac with your libpng 1.6.28.

On a debian system with libpng12 installed I was able to reproduce the above error.

But cd in src/src/.libs and edit libgiac.la with -lpng16 instead of -lpng and I was able to end the built.

Does it worth a patch (do you have a similar pb elsewhere?) or should I ask parisse if it is possible to add a --disable-png in configure?



---

archive/issue_comments_304425.json:
```json
{
    "body": "Worth a patch.\nSee #22163#comment:4",
    "created_at": "2017-01-25T21:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304425",
    "user": "jpflori"
}
```

Worth a patch.
See #22163#comment:4



---

archive/issue_comments_304426.json:
```json
{
    "body": "I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg",
    "created_at": "2017-02-08T09:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304426",
    "user": "frederichan"
}
```

I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg



---

archive/issue_comments_304427.json:
```json
{
    "body": "Replying to [comment:17 frederichan]:\n> I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg\n\nI would be +1 for the patch as well, since i need to compile giac with png and fltk support for [Sage Debian Live](https://sagedebianlive.metelu.net/), since i provide xcas through Sage. So, if it is possible, it is better to fix the issue than to skip it.",
    "created_at": "2017-03-13T08:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304427",
    "user": "tmonteil"
}
```

Replying to [comment:17 frederichan]:
> I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg

I would be +1 for the patch as well, since i need to compile giac with png and fltk support for [Sage Debian Live](https://sagedebianlive.metelu.net/), since i provide xcas through Sage. So, if it is possible, it is better to fix the issue than to skip it.



---

archive/issue_comments_304428.json:
```json
{
    "body": "Replying to [comment:18 tmonteil]:\n> Replying to [comment:17 frederichan]:\n> > I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg\n> \n> I would be +1 for the patch as well, since i need to compile giac with png and fltk support for [Sage Debian Live](https://sagedebianlive.metelu.net/), since i provide xcas through Sage. So, if it is possible, it is better to fix the issue than to skip it.\n\nThe problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.\nAre you using 2 libpng in sage debian live?\nNow if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?",
    "created_at": "2017-03-13T10:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304428",
    "user": "frederichan"
}
```

Replying to [comment:18 tmonteil]:
> Replying to [comment:17 frederichan]:
> > I have configured giac with --disable-png in #22101 so this should not happen anymore with the 1.2.3.25 giac spkg
> 
> I would be +1 for the patch as well, since i need to compile giac with png and fltk support for [Sage Debian Live](https://sagedebianlive.metelu.net/), since i provide xcas through Sage. So, if it is possible, it is better to fix the issue than to skip it.

The problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.
Are you using 2 libpng in sage debian live?
Now if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?



---

archive/issue_comments_304429.json:
```json
{
    "body": "Replying to [comment:19 frederichan]:\n> The problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.\n> Are you using 2 libpng in sage debian live?\n> Now if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?\n\nIndeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.",
    "created_at": "2017-03-15T10:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304429",
    "user": "tmonteil"
}
```

Replying to [comment:19 frederichan]:
> The problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.
> Are you using 2 libpng in sage debian live?
> Now if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?

Indeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.



---

archive/issue_comments_304430.json:
```json
{
    "body": "Replying to [comment:20 tmonteil]:\n> Replying to [comment:19 frederichan]:\n> > The problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.\n> > Are you using 2 libpng in sage debian live?\n> > Now if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?\n> \n> Indeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.\nNB: giac/xcas has now an official package in debian unstable:\n\nhttps://packages.debian.org/source/unstable/giac\n\nso in next releases you may not need the spkg for xcas.",
    "created_at": "2017-03-15T14:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304430",
    "user": "frederichan"
}
```

Replying to [comment:20 tmonteil]:
> Replying to [comment:19 frederichan]:
> > The problem occurs when you have a libpng12 system wide installed and sage libpng1.6. If you built giac with the system wide libpng12 then I guess  that you will have the same error as in comment 10.
> > Are you using 2 libpng in sage debian live?
> > Now if you built giac with -lpng16 instead of -lpng I don't know if it will work with your fltk because I guess it is linked to the system libpng12?
> 
> Indeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.
NB: giac/xcas has now an official package in debian unstable:

https://packages.debian.org/source/unstable/giac

so in next releases you may not need the spkg for xcas.



---

archive/issue_comments_304431.json:
```json
{
    "body": "> Indeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.\n\nActually, i wonder whether giac from Sage could produce png with libpng16 (shipped with Sage once this ticket gets merged) and the xcas GUI could be displayed with fltk using system's libpng12 without any conflict. I will try such an option anyway (also, `libfltk1.3-dev` has no dependency on `libpng12-dev` so that i can remove it during giac compilation, so there should not be any problem there).\n\nReplying to [comment:21 frederichan]:\n> NB: giac/xcas has now an official package in debian unstable:\n> \n> https://packages.debian.org/source/unstable/giac\n> \n> so in next releases you may not need the spkg for xcas.\n\nWell, it did not enter stretch, which is now frozen, hence it will not be shipped with the next stable :(",
    "created_at": "2017-03-15T15:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304431",
    "user": "tmonteil"
}
```

> Indeed: `apt-rdepends libfltk1.3-dev | grep -E '^[a-zA-Z0-9]' | grep png` leads to `libpng12-0` Fortunately, the next Debian stable will ship libpng16.

Actually, i wonder whether giac from Sage could produce png with libpng16 (shipped with Sage once this ticket gets merged) and the xcas GUI could be displayed with fltk using system's libpng12 without any conflict. I will try such an option anyway (also, `libfltk1.3-dev` has no dependency on `libpng12-dev` so that i can remove it during giac compilation, so there should not be any problem there).

Replying to [comment:21 frederichan]:
> NB: giac/xcas has now an official package in debian unstable:
> 
> https://packages.debian.org/source/unstable/giac
> 
> so in next releases you may not need the spkg for xcas.

Well, it did not enter stretch, which is now frozen, hence it will not be shipped with the next stable :(



---

archive/issue_comments_304432.json:
```json
{
    "body": "I suspect that something is not perfect with libpng in Sage. In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see\n\n```\nsage: loads(dumps(B)) == B ## line 827 ##\nlibpng warning: Application was compiled with png.h from libpng-1.6.27+apng\nlibpng warning: Application  is  running with png.c from libpng-1.2.51\nGD Error: gd-png: fatal libpng error: Incompatible libpng version in application and library\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long src/sage/coding/binary_code.pyx  # Killed due to segmentation fault\n```\n\nso it looks as if somewhere wrong or absent `-I/...` is used for compilation.",
    "created_at": "2017-03-28T21:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304432",
    "user": "dimpase"
}
```

I suspect that something is not perfect with libpng in Sage. In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see

```
sage: loads(dumps(B)) == B ## line 827 ##
libpng warning: Application was compiled with png.h from libpng-1.6.27+apng
libpng warning: Application  is  running with png.c from libpng-1.2.51
GD Error: gd-png: fatal libpng error: Incompatible libpng version in application and library

**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/coding/binary_code.pyx  # Killed due to segmentation fault
```

so it looks as if somewhere wrong or absent `-I/...` is used for compilation.



---

archive/issue_comments_304433.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> I suspect that something is not perfect with libpng in Sage. In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see\n> {{{\n> sage: loads(dumps(B)) == B ## line 827 ##\n> libpng warning: Application was compiled with png.h from libpng-1.6.27+apng\n> libpng warning: Application  is  running with png.c from libpng-1.2.51\n> GD Error: gd-png: fatal libpng error: Incompatible libpng version in application and library\n> \n> **********************************************************************\n> ----------------------------------------------------------------------\n> sage -t --long src/sage/coding/binary_code.pyx  # Killed due to segmentation fault\n> }}}\n> so it looks as if somewhere wrong or absent `-I/...` is used for compilation.\n\nunsurprisingly, upgrading to the branch in this ticket makes this crash go away.",
    "created_at": "2017-03-28T23:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304433",
    "user": "dimpase"
}
```

Replying to [comment:23 dimpase]:
> I suspect that something is not perfect with libpng in Sage. In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see
> {{{
> sage: loads(dumps(B)) == B ## line 827 ##
> libpng warning: Application was compiled with png.h from libpng-1.6.27+apng
> libpng warning: Application  is  running with png.c from libpng-1.2.51
> GD Error: gd-png: fatal libpng error: Incompatible libpng version in application and library
> 
> **********************************************************************
> ----------------------------------------------------------------------
> sage -t --long src/sage/coding/binary_code.pyx  # Killed due to segmentation fault
> }}}
> so it looks as if somewhere wrong or absent `-I/...` is used for compilation.

unsurprisingly, upgrading to the branch in this ticket makes this crash go away.



---

archive/issue_comments_304434.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> I suspect that something is not perfect with libpng in Sage. \n> In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see\n\nsorry for noise, that was FreeBSD-specific leftover from an old port that caused this.\nNo problem, in fact.",
    "created_at": "2017-03-29T15:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304434",
    "user": "dimpase"
}
```

Replying to [comment:23 dimpase]:
> I suspect that something is not perfect with libpng in Sage. 
> In particular, on FreeBSD (#22679) with Sage's current libpng (1.2.51) I see

sorry for noise, that was FreeBSD-specific leftover from an old port that caused this.
No problem, in fact.



---

archive/issue_comments_304435.json:
```json
{
    "body": "Can we try to merge it in 8.0?\nThe giac issue is solved in a giac ticket isn't it?",
    "created_at": "2017-04-03T11:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304435",
    "user": "jpflori"
}
```

Can we try to merge it in 8.0?
The giac issue is solved in a giac ticket isn't it?



---

archive/issue_comments_304436.json:
```json
{
    "body": "Replying to [comment:26 jpflori]:\n> Can we try to merge it in 8.0?\n\nSure.\n\n> The giac issue is solved in a giac ticket isn't it?\n\nWell, the issue is *avoided* in #22101 (which disables png support), but i think we should not consider this as a permanent solution, and provide a full-featured giac (which can draw pictures).",
    "created_at": "2017-04-03T16:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304436",
    "user": "tmonteil"
}
```

Replying to [comment:26 jpflori]:
> Can we try to merge it in 8.0?

Sure.

> The giac issue is solved in a giac ticket isn't it?

Well, the issue is *avoided* in #22101 (which disables png support), but i think we should not consider this as a permanent solution, and provide a full-featured giac (which can draw pictures).



---

archive/issue_comments_304437.json:
```json
{
    "body": "I think we can live with a giac without png support.\nWe already live with a completely borken giac outside x86_64...",
    "created_at": "2017-04-25T17:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304437",
    "user": "jpflori"
}
```

I think we can live with a giac without png support.
We already live with a completely borken giac outside x86_64...



---

archive/issue_comments_304438.json:
```json
{
    "body": "And note that giac build system should be fixed to use proper -lpng1x rather than -lpng.\nNot libpng...",
    "created_at": "2017-04-28T15:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304438",
    "user": "jpflori"
}
```

And note that giac build system should be fixed to use proper -lpng1x rather than -lpng.
Not libpng...



---

archive/issue_comments_304439.json:
```json
{
    "body": "From my point of view it is enough to rebase this ticket, I'll do it.",
    "created_at": "2017-05-17T09:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304439",
    "user": "jpflori"
}
```

From my point of view it is enough to rebase this ticket, I'll do it.



---

archive/issue_comments_304440.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-17T12:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304440",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_304441.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-17T12:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304441",
    "user": "jpflori"
}
```

New commits:



---

archive/issue_comments_304442.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-21T02:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304442",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304443.json:
```json
{
    "body": "Built for me. Back to the buildbots.",
    "created_at": "2017-05-21T02:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304443",
    "user": "tscrim"
}
```

Built for me. Back to the buildbots.



---

archive/issue_comments_304444.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-21T21:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21922#issuecomment-304444",
    "user": "vbraun"
}
```

Resolution: fixed
