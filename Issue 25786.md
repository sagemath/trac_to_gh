# Issue 25786: Singular build with SAGE_DEBUG misses omalloc headers

Issue created by migration from https://trac.sagemath.org/ticket/26023

Original creator: vbraun

Original creation time: 2018-08-07 23:35:23

CC:  jpflori jakobkroeker

Building singular with SAGE_DEBUG fails to install omalloc headers into local/include/omalloc/, which later causes pynac to fail 

```
[...]
cc1plus: warning: unrecognized command line option '-Wno-parentheses-equality'
mv -f .deps/libpynac_la-inifcns_comb.Tpo .deps/libpynac_la-inifcns_comb.Plo
/usr/bin/bash ../libtool  --tag=CXX   --mode=compile g++ -std=c++11 -DHAVE_CONFIG_H -I. -I..  -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -DOM_NDEBUG  -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -Wno-unknown-pragmas -Wno-parentheses-equality   -O2 -g  -MT libpynac_la-mpoly-singular.lo -MD -MP -MF .deps/libpynac_la-mpoly-singular.Tpo -c -o libpynac_la-mpoly-singular.lo `test -f 'mpoly-singular.cpp' || echo './'`mpoly-singular.cpp
mv -f .deps/libpynac_la-inifcns_orthopoly.Tpo .deps/libpynac_la-inifcns_orthopoly.Plo
/usr/bin/bash ../libtool  --tag=CXX   --mode=compile g++ -std=c++11 -DHAVE_CONFIG_H -I. -I..  -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -DOM_NDEBUG  -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -Wno-unknown-pragmas -Wno-parentheses-equality   -O2 -g  -MT libpynac_la-mpoly.lo -MD -MP -MF .deps/libpynac_la-mpoly.Tpo -c -o libpynac_la-mpoly.lo `test -f 'mpoly.cpp' || echo './'`mpoly.cpp
libtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -DOM_NDEBUG -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -Wno-unknown-pragmas -Wno-parentheses-equality -O2 -g -MT libpynac_la-mpoly-singular.lo -MD -MP -MF .deps/libpynac_la-mpoly-singular.Tpo -c mpoly-singular.cpp  -fPIC -DPIC -o .libs/libpynac_la-mpoly-singular.o
libtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -DOM_NDEBUG -Wall -Wextra -Wshadow -Wnon-virtual-dtor -Wno-unused-parameter -Wno-unknown-pragmas -Wno-parentheses-equality -O2 -g -MT libpynac_la-mpoly.lo -MD -MP -MF .deps/libpynac_la-mpoly.Tpo -c mpoly.cpp  -fPIC -DPIC -o .libs/libpynac_la-mpoly.o
In file included from /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/factory/factory.h:29,
                 from mpoly-singular.cpp:27:
/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/omalloc/omalloc.h:14:10: fatal error: omalloc/omConfig.h: No such file or directory
 #include "omalloc/omConfig.h"
          ^~~~~~~~~~~~~~~~~~~~
compilation terminated.
```

Indeed:

```
[buildslave-sage@volker build]$ ll local/include/omalloc/
total 12
-rw-r--r--. 1 buildslave-sage buildslave-sage 10010 Aug  7 00:50 omalloc.h
```



---

Comment by jdemeyer created at 2018-08-08 09:05:01

This whole omalloc business is really confusing to me...

See also https://github.com/Singular/Sources/issues/534


---

Comment by jpflori created at 2018-08-08 09:08:31

IIRC Singular used to install stub headers when omalloc was disabled but that was a long time ago...


---

Comment by jdemeyer created at 2018-08-08 09:09:45

Maybe we should just stop trying to build Singular without omalloc?


---

Comment by jpflori created at 2018-08-08 09:18:47

Is there still an xalloc directory used when omalloc is not?
The omConfig part is reminiscent of #17254#comment:381


---

Comment by jdemeyer created at 2018-08-08 09:23:18

Replying to [comment:5 jpflori]:
> Is there still an xalloc directory used when omalloc is not?

Sorry, I don't understand your question.


---

Comment by jdemeyer created at 2018-08-08 09:24:14

In any case, if Singular wanted to make building with xalloc officially supported, they would have made a `configure` option for it. I don't think that we should be manually copying directories or whatever.


---

Comment by jdemeyer created at 2018-08-08 09:29:05

See also https://github.com/Singular/Sources/pull/795


---

Comment by jdemeyer created at 2018-08-08 09:30:12

By the way, simply using `--disable-omalloc` also doesn't work: https://github.com/Singular/Sources/issues/534#issuecomment-411336226


---

Comment by jdemeyer created at 2018-08-11 11:43:50

Resolution: duplicate
