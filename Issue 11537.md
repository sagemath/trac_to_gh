# Issue 11537: FareySymbol

archive/issues_011537.json:
```json
{
    "body": "Assignee: @craigcitro\n\nCC:  @vbraun\n\nKeywords: Farey symbol\n\nFareySymbol is a *fast* implementation of the *KFarey* package for sage.\nThe major changes done by me:\n\n- created an object oriented coherent class intereface\n- implemented c++ module with pyx interface\n\nFareySymbol allows the calculation of properties of a general arithmetic subgroup. \nThe use with the congruence subgroups Gamma0, Gamma1, GammaH is trivial.\nFor a group not implemented in sage the \"user\" has to define a class with a __contains__ (self, M) attribute which returns true or false depending on M being in the group or not.\n\nThe calculation of the generators, coset representation and genus of Gamma(32) \ntakes 62.5 seconds on my laptop. Try this with Magma ... . \n\nsage: time FareySymbol(Gamma(32))\nFareySymbol(Congruence Subgroup Gamma(32))\nTime: CPU 62.50 s, Wall: 62.52 s\n\nIssue created by migration from https://trac.sagemath.org/ticket/11709\n\n",
    "created_at": "2011-08-19T08:39:58Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "FareySymbol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11537",
    "user": "https://github.com/monien"
}
```
Assignee: @craigcitro

CC:  @vbraun

Keywords: Farey symbol

FareySymbol is a *fast* implementation of the *KFarey* package for sage.
The major changes done by me:

- created an object oriented coherent class intereface
- implemented c++ module with pyx interface

FareySymbol allows the calculation of properties of a general arithmetic subgroup. 
The use with the congruence subgroups Gamma0, Gamma1, GammaH is trivial.
For a group not implemented in sage the "user" has to define a class with a __contains__ (self, M) attribute which returns true or false depending on M being in the group or not.

The calculation of the generators, coset representation and genus of Gamma(32) 
takes 62.5 seconds on my laptop. Try this with Magma ... . 

sage: time FareySymbol(Gamma(32))
FareySymbol(Congruence Subgroup Gamma(32))
Time: CPU 62.50 s, Wall: 62.52 s

Issue created by migration from https://trac.sagemath.org/ticket/11709





---

archive/issue_comments_129448.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2011-08-19T10:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129448",
    "user": "https://github.com/monien"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_129449.json:
```json
{
    "body": "That is great work! Not so many issues that I found; And really this is code of awesome readability.\n\nThe first major issue is the missing GPL header farey.cpp.\n\nI will do the rest per line and file:\nfarey.cpp:\nl.13 missing #include <algorithm>   Did this really compile for you? That seems impossible.\nl.114 reverse the order of name and group (for consistency only).\nl.127 this is bad. Compare with l.114.  The easiest will be to change the latter.\nl.147 change to = a[i]/b[i] - a[i-1]/b[i-1], since operator/ already constructs a new instance and hence it would be a wast to call the copy constructor.\nl.150 this is asking for trouble on Sun and other platforms. It would hurt to use int i, will it?\nl.154 add break; hereafter to make it a tiny bit faster.\nl.187 and l.188 use A = ... and B = ..., since again the copy constructor is not needed.\nl.203 like l.187f\nl.225 why don't you use throw like in l.260?\nl.264 move this directly behind the alternate version of paring_matrix, that is, l.247, to improve readability.\nl.290 and l.291 define one_half(1,2) and use this here.\nl.297 use one_half(1,2), which is a bit faster.\nl.314 again this is calling for trouble on Sun. Use int k?\nl.324 missing initialization c(paring.size(), 0);.\nl.426 delete this assertion?\nl.428 it is a shame that the compiler doesn't catch this, but again Sun won't like this.\nl.512 I'm not sure at all, but should this be NO, because already 1 represents a paired fraction? In that case you can remove the FREE label from the enum.\n\nfarey_symbols.pyx:\nl.5 the syntax is:\n\n```\nAUTHORS:\n\n- Hartmut Monien (08 - 2011)\n```\n\nl.7 read C++.\nl.46 Why to use the underscore at the end of the line?\nl.50 Read `G`, because it is a mathematical symbol.\nl.61, l.191, l.214, and l.267 use Sequence(..., cr = True) to make the output more readable.\nl.103 use _repr_.\nl.109 sage: repr(FareySymbol(Gamma0(23)))\nl.128, l.139, l.151, l.187, l.224, and l.281 missing full stop.\n\nfarey_symbol.h: You don't need this, but I think it would be best to use it to replace l.21ff in farey.cpp.\n\nsl2z.hpp:\nl.25 and l.26 protected? otherwise it makes no sense to declare all the functions above as friend.\n\nTests:\nThe tests are currently not sufficient to cover all cases the code treats. This the difference occures in farey.cpp,l.189ff, it would be sufficient to add tests like FareySymbol(G). Please add tests for SL2Z, Gamma1(4) and GammaH(11, [2,7]) or any equivalent set of test cases.\n\nI need to double check this agains Magma, and I will do this tomorrow. It would also be good to see, whether everything works fine on the Sun test cluster. I hope the patch bot will pick this up soon.",
    "created_at": "2011-08-21T22:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129449",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

That is great work! Not so many issues that I found; And really this is code of awesome readability.

The first major issue is the missing GPL header farey.cpp.

I will do the rest per line and file:
farey.cpp:
l.13 missing #include <algorithm>   Did this really compile for you? That seems impossible.
l.114 reverse the order of name and group (for consistency only).
l.127 this is bad. Compare with l.114.  The easiest will be to change the latter.
l.147 change to = a[i]/b[i] - a[i-1]/b[i-1], since operator/ already constructs a new instance and hence it would be a wast to call the copy constructor.
l.150 this is asking for trouble on Sun and other platforms. It would hurt to use int i, will it?
l.154 add break; hereafter to make it a tiny bit faster.
l.187 and l.188 use A = ... and B = ..., since again the copy constructor is not needed.
l.203 like l.187f
l.225 why don't you use throw like in l.260?
l.264 move this directly behind the alternate version of paring_matrix, that is, l.247, to improve readability.
l.290 and l.291 define one_half(1,2) and use this here.
l.297 use one_half(1,2), which is a bit faster.
l.314 again this is calling for trouble on Sun. Use int k?
l.324 missing initialization c(paring.size(), 0);.
l.426 delete this assertion?
l.428 it is a shame that the compiler doesn't catch this, but again Sun won't like this.
l.512 I'm not sure at all, but should this be NO, because already 1 represents a paired fraction? In that case you can remove the FREE label from the enum.

farey_symbols.pyx:
l.5 the syntax is:

```
AUTHORS:

- Hartmut Monien (08 - 2011)
```

l.7 read C++.
l.46 Why to use the underscore at the end of the line?
l.50 Read `G`, because it is a mathematical symbol.
l.61, l.191, l.214, and l.267 use Sequence(..., cr = True) to make the output more readable.
l.103 use _repr_.
l.109 sage: repr(FareySymbol(Gamma0(23)))
l.128, l.139, l.151, l.187, l.224, and l.281 missing full stop.

farey_symbol.h: You don't need this, but I think it would be best to use it to replace l.21ff in farey.cpp.

sl2z.hpp:
l.25 and l.26 protected? otherwise it makes no sense to declare all the functions above as friend.

Tests:
The tests are currently not sufficient to cover all cases the code treats. This the difference occures in farey.cpp,l.189ff, it would be sufficient to add tests like FareySymbol(G). Please add tests for SL2Z, Gamma1(4) and GammaH(11, [2,7]) or any equivalent set of test cases.

I need to double check this agains Magma, and I will do this tomorrow. It would also be good to see, whether everything works fine on the Sun test cluster. I hope the patch bot will pick this up soon.



---

archive/issue_comments_129450.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-21T22:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129450",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129451.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-21T22:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129451",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129452.json:
```json
{
    "body": "I verified this against Magma and everything is OK. While doing so, I noticed that the documentation of coset_reps should mention that you compute the left transversal.\n\nI felt a bit pity that GammaH is currently not implemented in C++, and for this it is much slower. If you feel like it, please go ahead and implement it. Otherwise, we will open a follow up ticket, that describes this task.",
    "created_at": "2011-08-22T13:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129452",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I verified this against Magma and everything is OK. While doing so, I noticed that the documentation of coset_reps should mention that you compute the left transversal.

I felt a bit pity that GammaH is currently not implemented in C++, and for this it is much slower. If you feel like it, please go ahead and implement it. Otherwise, we will open a follow up ticket, that describes this task.



---

archive/issue_comments_129453.json:
```json
{
    "body": "Attachment [noncongruence_example.sage](tarball://root/attachments/some-uuid/ticket11709/noncongruence_example.sage) by @monien created at 2011-08-25 08:32:34",
    "created_at": "2011-08-25T08:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129453",
    "user": "https://github.com/monien"
}
```

Attachment [noncongruence_example.sage](tarball://root/attachments/some-uuid/ticket11709/noncongruence_example.sage) by @monien created at 2011-08-25 08:32:34



---

archive/issue_comments_129454.json:
```json
{
    "body": "I have implemented the changes by Martin Raum - including the C++ version of GammaH. \u00a0I have added a number of doctests for SL2Z, Gamma1 and GammaH.\u00a0\n\nThe only undocumented feature is the possibility to define arbitrary subgroups of SL2Z by a helper class. I include an example \"noncongruence_example.sage\". How can that be doctested?\n\nOtherwise the patch should be ready to go.",
    "created_at": "2011-08-25T08:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129454",
    "user": "https://github.com/monien"
}
```

I have implemented the changes by Martin Raum - including the C++ version of GammaH.  I have added a number of doctests for SL2Z, Gamma1 and GammaH. 

The only undocumented feature is the possibility to define arbitrary subgroups of SL2Z by a helper class. I include an example "noncongruence_example.sage". How can that be doctested?

Otherwise the patch should be ready to go.



---

archive/issue_comments_129455.json:
```json
{
    "body": "I will have a look at this soon.\n\nConcerning the example class, I would change the description to something like \"Simple example how to implement noncongruence groups for the FareySymbol class.\"\n\nTesting shouldn't be too difficult. In the class doc, test whether you can initialize the FareySymbols and whether you can, say, compute the coset representatives.  For all other methods just call it and verify the output. Definitely, by now, all functions that get into Sage need to be tested completely.",
    "created_at": "2011-08-25T09:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129455",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I will have a look at this soon.

Concerning the example class, I would change the description to something like "Simple example how to implement noncongruence groups for the FareySymbol class."

Testing shouldn't be too difficult. In the class doc, test whether you can initialize the FareySymbols and whether you can, say, compute the coset representatives.  For all other methods just call it and verify the output. Definitely, by now, all functions that get into Sage need to be tested completely.



---

archive/issue_comments_129456.json:
```json
{
    "body": "Added an example for noncongruence groups in \"noncongruence_example.py\" (including a reference to a paper investigating this example - published 2010). Added a doctest of the noncongruence generators.",
    "created_at": "2011-08-25T09:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129456",
    "user": "https://github.com/monien"
}
```

Added an example for noncongruence groups in "noncongruence_example.py" (including a reference to a paper investigating this example - published 2010). Added a doctest of the noncongruence generators.



---

archive/issue_comments_129457.json:
```json
{
    "body": "With very minor changes, which I have done myself, this can get a positive review. There is only one thing, that I am sceptical about. For sl2z you changed the definition for *= and /=. I wonder why, because the old definition was correct and the new one seems not.",
    "created_at": "2011-08-25T18:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129457",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

With very minor changes, which I have done myself, this can get a positive review. There is only one thing, that I am sceptical about. For sl2z you changed the definition for *= and /=. I wonder why, because the old definition was correct and the new one seems not.



---

archive/issue_comments_129458.json:
```json
{
    "body": "Added a few checks for user code. The user subgroup is now check for a !__contains!__ member and if this member returns bool. Removed some unnecessary code: the rep member of farey_symbol etc.. Cleaned up the code for the special case of SL2Z which now gives the correct coset and generators.\n\nRevised the SL2Z.hpp file: changed member function get_a(), get_b() ... to a(), b(), c(), ... . Is the definition of SL2Z *= and /= correct now?\n\nAdded two file sage/plot/hyperbolic_arc.py and sage/plot/hyperbolic_triangle.py for plots in the hyperbolic plane.\n\nAdded member fundamental_domain() to\u00a0FareySymbol\u00a0which plots the fundamental domain.",
    "created_at": "2011-08-28T10:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129458",
    "user": "https://github.com/monien"
}
```

Added a few checks for user code. The user subgroup is now check for a !__contains!__ member and if this member returns bool. Removed some unnecessary code: the rep member of farey_symbol etc.. Cleaned up the code for the special case of SL2Z which now gives the correct coset and generators.

Revised the SL2Z.hpp file: changed member function get_a(), get_b() ... to a(), b(), c(), ... . Is the definition of SL2Z *= and /= correct now?

Added two file sage/plot/hyperbolic_arc.py and sage/plot/hyperbolic_triangle.py for plots in the hyperbolic plane.

Added member fundamental_domain() to FareySymbol which plots the fundamental domain.



---

archive/issue_comments_129459.json:
```json
{
    "body": "Added hyperbolic_arc and hyperbolic_triangle to documentation in sage.plot. Fixed const in SL2Z.cpp. Pruned the documentation so that sage --docbuild --jsmath reference html actually works. I am still not happy with the treatment of linebreaks in the documentation ... . It would be nice to add at least one plot of a fundamental domain, i.e. Gamma0(23), \u00a0to the documentation.",
    "created_at": "2011-08-29T09:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129459",
    "user": "https://github.com/monien"
}
```

Added hyperbolic_arc and hyperbolic_triangle to documentation in sage.plot. Fixed const in SL2Z.cpp. Pruned the documentation so that sage --docbuild --jsmath reference html actually works. I am still not happy with the treatment of linebreaks in the documentation ... . It would be nice to add at least one plot of a fundamental domain, i.e. Gamma0(23),  to the documentation.



---

archive/issue_comments_129460.json:
```json
{
    "body": "Attachment [fun_gamma_3.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma_3.png) by @monien created at 2011-08-31 07:32:04",
    "created_at": "2011-08-31T07:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129460",
    "user": "https://github.com/monien"
}
```

Attachment [fun_gamma_3.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma_3.png) by @monien created at 2011-08-31 07:32:04



---

archive/issue_comments_129461.json:
```json
{
    "body": "Attachment [fun_gamma0_11.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma0_11.png) by @monien created at 2011-08-31 07:32:18",
    "created_at": "2011-08-31T07:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129461",
    "user": "https://github.com/monien"
}
```

Attachment [fun_gamma0_11.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma0_11.png) by @monien created at 2011-08-31 07:32:18



---

archive/issue_comments_129462.json:
```json
{
    "body": "Attachment [fun_gamma0_23.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma0_23.png) by @monien created at 2011-08-31 07:32:49",
    "created_at": "2011-08-31T07:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129462",
    "user": "https://github.com/monien"
}
```

Attachment [fun_gamma0_23.png](tarball://root/attachments/some-uuid/ticket11709/fun_gamma0_23.png) by @monien created at 2011-08-31 07:32:49



---

archive/issue_comments_129463.json:
```json
{
    "body": "Attachment [pairing.png](tarball://root/attachments/some-uuid/ticket11709/pairing.png) by @monien created at 2011-08-31 07:38:46\n\nThe documentation for\u00a0FareySymbol\u00a0is now seriously enhanced. It includes several figures which are not included in the patch (since it does not handle binary files) but included separately. The png files should go to the directory doc/en/reference/media/modular/arithgroup which of course has to be created.",
    "created_at": "2011-08-31T07:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129463",
    "user": "https://github.com/monien"
}
```

Attachment [pairing.png](tarball://root/attachments/some-uuid/ticket11709/pairing.png) by @monien created at 2011-08-31 07:38:46

The documentation for FareySymbol is now seriously enhanced. It includes several figures which are not included in the patch (since it does not handle binary files) but included separately. The png files should go to the directory doc/en/reference/media/modular/arithgroup which of course has to be created.



---

archive/issue_comments_129464.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol-v4.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-v4.patch) by mraum created at 2011-08-31 09:05:06\n\nI have created a patch that incorporates the pictures. Btw. to create such a patch simply type\n\n```\nhg add *.png\n```\n\nin the corresponding directory. Then commit. Don't be irritated by the v4. I internally relabelled different versions of the patch, and I cannot overwrite your uploads.\n\n\nI have changed some lines where you have put your name twice in the author section. It is common in Sage to put a list there, to provide the possibility to include further authors, which later might contribute.\n\nThe one thing that is irritating is the SL2Z case. Obviously, PSL is not a subgroup of SL, so it does not make sense to talk about indices. Also the index of SL2 in SL2, as a matter of fact, is 1. In the current implemntation generators() equals cosets(), which cannot be right.\nAm I missing anything, that you intent to implement?\n\nSince you know provide the SL2 generators explicitly, I wonder why you don't use [[0,1],[-1,0]] and [[1,1],[0,1]], which are the most common used generators. Clearly, your choice is perfectly possible; I just wonder.",
    "created_at": "2011-08-31T09:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129464",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Attachment [trac-11709_farey_symbol-v4.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-v4.patch) by mraum created at 2011-08-31 09:05:06

I have created a patch that incorporates the pictures. Btw. to create such a patch simply type

```
hg add *.png
```

in the corresponding directory. Then commit. Don't be irritated by the v4. I internally relabelled different versions of the patch, and I cannot overwrite your uploads.


I have changed some lines where you have put your name twice in the author section. It is common in Sage to put a list there, to provide the possibility to include further authors, which later might contribute.

The one thing that is irritating is the SL2Z case. Obviously, PSL is not a subgroup of SL, so it does not make sense to talk about indices. Also the index of SL2 in SL2, as a matter of fact, is 1. In the current implemntation generators() equals cosets(), which cannot be right.
Am I missing anything, that you intent to implement?

Since you know provide the SL2 generators explicitly, I wonder why you don't use [[0,1],[-1,0]] and [[1,1],[0,1]], which are the most common used generators. Clearly, your choice is perfectly possible; I just wonder.



---

archive/issue_comments_129465.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol.patch) by @monien created at 2011-09-01 20:08:20\n\nChanges as discussed. Hope for the best ... .",
    "created_at": "2011-09-01T20:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129465",
    "user": "https://github.com/monien"
}
```

Attachment [trac-11709_farey_symbol.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol.patch) by @monien created at 2011-09-01 20:08:20

Changes as discussed. Hope for the best ... .



---

archive/issue_comments_129466.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol-v6.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-v6.patch) by mraum created at 2011-09-01 22:01:22\n\nYes, finally this work gets a positive review. The only change I made is to adapt the commit message to comply with the standards.",
    "created_at": "2011-09-01T22:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129466",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Attachment [trac-11709_farey_symbol-v6.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-v6.patch) by mraum created at 2011-09-01 22:01:22

Yes, finally this work gets a positive review. The only change I made is to adapt the commit message to comply with the standards.



---

archive/issue_comments_129467.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2011-09-01T22:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129467",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_129468.json:
```json
{
    "body": "Please leave the *Dependencies* field empty if the ticket doesn't depend on any other.",
    "created_at": "2011-09-08T12:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129468",
    "user": "https://github.com/nexttime"
}
```

Please leave the *Dependencies* field empty if the ticket doesn't depend on any other.



---

archive/issue_comments_129469.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T05:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129469",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_comments_129470.json:
```json
{
    "body": "Attachment [trac_11709-add_hpp_files_to_manifest.reviewer.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-add_hpp_files_to_manifest.reviewer.patch) by @nexttime created at 2011-09-18 05:54:50\n\nCrucial six-character patch. Otherwise Sage won't build from scratch. Independent of the other patch; apply to the Sage library.",
    "created_at": "2011-09-18T05:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129470",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_11709-add_hpp_files_to_manifest.reviewer.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-add_hpp_files_to_manifest.reviewer.patch) by @nexttime created at 2011-09-18 05:54:50

Crucial six-character patch. Otherwise Sage won't build from scratch. Independent of the other patch; apply to the Sage library.



---

archive/issue_comments_129471.json:
```json
{
    "body": "Attached a reviewer patch such that building Sage from scratch will work.",
    "created_at": "2011-09-18T06:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129471",
    "user": "https://github.com/nexttime"
}
```

Attached a reviewer patch such that building Sage from scratch will work.



---

archive/issue_comments_129472.json:
```json
{
    "body": "Attachment [trac_11709-tag_file_containing_non-ascii_chars.reviewer.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-tag_file_containing_non-ascii_chars.reviewer.patch) by @nexttime created at 2011-09-19 15:30:16\n\nApply on top of the other patch(es), to the Sage library.",
    "created_at": "2011-09-19T15:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129472",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_11709-tag_file_containing_non-ascii_chars.reviewer.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-tag_file_containing_non-ascii_chars.reviewer.patch) by @nexttime created at 2011-09-19 15:30:16

Apply on top of the other patch(es), to the Sage library.



---

archive/issue_comments_129473.json:
```json
{
    "body": "Attached another patch adding \"`# -*- coding: UTF-8 -*-`\", because one file contains non-ASCII characters, which leads to:\n\n```\n...\nUpdating modification times for the documentation...\nsage -docbuild --update-mtimes reference html\n...\nTraceback (most recent call last):\n...\n    from farey_symbol import Farey as FareySymbol\n  File \"farey_symbol.pyx\", line 42, in init sage.modular.arithgroup.farey_symbol (sage/modular/arithgroup/farey_symbol.cpp:4918)\n  File \".../local/lib/python2.6/site-packages/sage/modular/arithgroup/noncongruence_example.py\", line 35\nSyntaxError: Non-ASCII character '\\xe2' in file .../local/lib/python2.6/site-packages/sage/modular/arithgroup/noncongruence_example.py on line 36, but no encoding declared; see http://www.python.org/peps/pep-0263.html for details\n...\n```\n",
    "created_at": "2011-09-19T15:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129473",
    "user": "https://github.com/nexttime"
}
```

Attached another patch adding "`# -*- coding: UTF-8 -*-`", because one file contains non-ASCII characters, which leads to:

```
...
Updating modification times for the documentation...
sage -docbuild --update-mtimes reference html
...
Traceback (most recent call last):
...
    from farey_symbol import Farey as FareySymbol
  File "farey_symbol.pyx", line 42, in init sage.modular.arithgroup.farey_symbol (sage/modular/arithgroup/farey_symbol.cpp:4918)
  File ".../local/lib/python2.6/site-packages/sage/modular/arithgroup/noncongruence_example.py", line 35
SyntaxError: Non-ASCII character '\xe2' in file .../local/lib/python2.6/site-packages/sage/modular/arithgroup/noncongruence_example.py on line 36, but no encoding declared; see http://www.python.org/peps/pep-0263.html for details
...
```




---

archive/issue_comments_129474.json:
```json
{
    "body": "Follow-up ticket: #11875",
    "created_at": "2011-09-30T19:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129474",
    "user": "https://github.com/nexttime"
}
```

Follow-up ticket: #11875



---

archive/issue_comments_129475.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-10-04T10:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129475",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_129476.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-10-04T10:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129476",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_comments_129477.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129477",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_129478.json:
```json
{
    "body": "Attachment [farey.patch](tarball://root/attachments/some-uuid/ticket11709/farey.patch) by @monien created at 2012-01-11 19:05:27\n\nThis patch replaces in one file all the previous patches",
    "created_at": "2012-01-11T19:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129478",
    "user": "https://github.com/monien"
}
```

Attachment [farey.patch](tarball://root/attachments/some-uuid/ticket11709/farey.patch) by @monien created at 2012-01-11 19:05:27

This patch replaces in one file all the previous patches



---

archive/issue_comments_129479.json:
```json
{
    "body": "Since many things have changed in 4.7.2 I have decided to lump everything in one new patch.\n\n**FareySymbol**\u00a0has been checked for special cases (not implemented in the KFarey package) including the unique index two subgroup. It now handles gracefully subgroups which contain SL2Z([-1, 1, -1, 0]).\u00a0\n\nThe drawing of the fundamental domain has been changed slightly. The coloring of the pairing has been changed to include the first and last side.\n\nThe current algorithm for calculating the\u00a0FareySymbol\u00a0is O(n!^2)\u00a0where n is the index of the subgroup\u00a0which is the general case. This could be improved to O(n) for Gamma0, Gamma1 and Gamma as Georg Weber pointed out. The current algorithm runs for about a second to calculate all properties of the\u00a0FareySymbol\u00a0for Gamma(16) with index 1536. This is probably satisfactory at the moment (and still much faster than Magma).\u00a0\n\nThe documentation has been corrected.",
    "created_at": "2012-01-11T19:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129479",
    "user": "https://github.com/monien"
}
```

Since many things have changed in 4.7.2 I have decided to lump everything in one new patch.

**FareySymbol** has been checked for special cases (not implemented in the KFarey package) including the unique index two subgroup. It now handles gracefully subgroups which contain SL2Z([-1, 1, -1, 0]). 

The drawing of the fundamental domain has been changed slightly. The coloring of the pairing has been changed to include the first and last side.

The current algorithm for calculating the FareySymbol is O(n!^2) where n is the index of the subgroup which is the general case. This could be improved to O(n) for Gamma0, Gamma1 and Gamma as Georg Weber pointed out. The current algorithm runs for about a second to calculate all properties of the FareySymbol for Gamma(16) with index 1536. This is probably satisfactory at the moment (and still much faster than Magma). 

The documentation has been corrected.



---

archive/issue_comments_129480.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-12T23:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129480",
    "user": "https://github.com/monien"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129481.json:
```json
{
    "body": "I tried installing `trac-11709_farey_symbol-sage-4.8.patch` this on the latest Sage beta (5.0.beta6), which brought up a couple of minor issues:\n\n(1) There was a conflict in sage/modular/all.py (easily fixable, caused by #11601 merged in 5.0.beta1). Other than that, the patch applies OK. \n\n(2) Building gave a curious warning:\n\n```\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nBuilding modified file sage/modular/arithgroup/farey_symbol.pyx.\nsetup.py:650: UserWarning: could not find dependency <string> included in /storage/masiao/sage-5.0.beta6/local/lib/python/site-packages/Cython/Includes/libcpp/string.pxd. I will assume it is a system C/C++ header.\n  warnings.warn(msg+' I will assume it is a system C/C++ header.')\nsetup.py:650: UserWarning: could not find dependency <vector> included in /storage/masiao/sage-5.0.beta6/local/lib/python/site-packages/Cython/Includes/libcpp/vector.pxd. I will assume it is a system C/C++ header.\n  warnings.warn(msg+' I will assume it is a system C/C++ header.')\nExecuting 1 command (using 1 thread)\npython `which cython` --cplus --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/storage/masiao/sage-5.0.beta6/devel/sage-main -o sage/modular/arithgroup/farey_symbol.cpp sage/modular/arithgroup/farey_symbol.pyx\nsage/modular/arithgroup/farey_symbol.pyx --> /storage/masiao/sage-5.0.beta6/local/lib/python2.7/site-packages//sage/modular/arithgroup/farey_symbol.pyx\nTime to execute 1 command: 3.33421301842 seconds\nFinished compiling Cython code (time = 5.61644482613 seconds)\n```\n\n\nOther than that, it looks pretty good -- thanks for your work on this! I'm running the test suite now. If everything goes OK I'll upload my rebase of the patch.",
    "created_at": "2012-03-02T14:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129481",
    "user": "https://github.com/loefflerd"
}
```

I tried installing `trac-11709_farey_symbol-sage-4.8.patch` this on the latest Sage beta (5.0.beta6), which brought up a couple of minor issues:

(1) There was a conflict in sage/modular/all.py (easily fixable, caused by #11601 merged in 5.0.beta1). Other than that, the patch applies OK. 

(2) Building gave a curious warning:

```
----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Building modified file sage/modular/arithgroup/farey_symbol.pyx.
setup.py:650: UserWarning: could not find dependency <string> included in /storage/masiao/sage-5.0.beta6/local/lib/python/site-packages/Cython/Includes/libcpp/string.pxd. I will assume it is a system C/C++ header.
  warnings.warn(msg+' I will assume it is a system C/C++ header.')
setup.py:650: UserWarning: could not find dependency <vector> included in /storage/masiao/sage-5.0.beta6/local/lib/python/site-packages/Cython/Includes/libcpp/vector.pxd. I will assume it is a system C/C++ header.
  warnings.warn(msg+' I will assume it is a system C/C++ header.')
Executing 1 command (using 1 thread)
python `which cython` --cplus --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/storage/masiao/sage-5.0.beta6/devel/sage-main -o sage/modular/arithgroup/farey_symbol.cpp sage/modular/arithgroup/farey_symbol.pyx
sage/modular/arithgroup/farey_symbol.pyx --> /storage/masiao/sage-5.0.beta6/local/lib/python2.7/site-packages//sage/modular/arithgroup/farey_symbol.pyx
Time to execute 1 command: 3.33421301842 seconds
Finished compiling Cython code (time = 5.61644482613 seconds)
```


Other than that, it looks pretty good -- thanks for your work on this! I'm running the test suite now. If everything goes OK I'll upload my rebase of the patch.



---

archive/issue_comments_129482.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-02T15:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129482",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129483.json:
```json
{
    "body": "This bothers me a bit:\n\n```\nsage: all([x in Gamma1(4) for x in FareySymbol(Gamma1(4)).generators()])\nFalse\n```\n\nIf G is odd, the generators that get returned are arbitrary liftings of generators of the projective image of G, so they won't generally be in G.\n\nAlso, I don't like this:\n\n```\nsage: FareySymbol(Gamma0(4)).generators()\n[[1 1]\n[0 1], [ 3 -1]\n[ 4 -1]]\n```\n\nThese elements do *not* generate Gamma0(4); they generate an index 2 odd subgroup of Gamma0(4) (which one can check is congruence of level 8, using the functions added by ticket #11601).\n\nI'd like to request the following changes:\n\n- Make sure the \"generators\" are really in G when G is odd.\n\n- If G is even and has no torsion, pad the list of generators with -1. Otherwise, make sure representatives of the torsion generators are chosen so the subgroup they generate contains -1. \n\n- I'd also suggest we rewire the \"generators\" method of the top-level arithmetic subgroup class to use Hartmut's new code by default, with the old code as an optional fall-back. \n\n- While we're at it, it would be nice to have a \"farey_symbol\" method of arithmetic subgroups as an alternative to the constructor function.",
    "created_at": "2012-03-02T15:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129483",
    "user": "https://github.com/loefflerd"
}
```

This bothers me a bit:

```
sage: all([x in Gamma1(4) for x in FareySymbol(Gamma1(4)).generators()])
False
```

If G is odd, the generators that get returned are arbitrary liftings of generators of the projective image of G, so they won't generally be in G.

Also, I don't like this:

```
sage: FareySymbol(Gamma0(4)).generators()
[[1 1]
[0 1], [ 3 -1]
[ 4 -1]]
```

These elements do *not* generate Gamma0(4); they generate an index 2 odd subgroup of Gamma0(4) (which one can check is congruence of level 8, using the functions added by ticket #11601).

I'd like to request the following changes:

- Make sure the "generators" are really in G when G is odd.

- If G is even and has no torsion, pad the list of generators with -1. Otherwise, make sure representatives of the torsion generators are chosen so the subgroup they generate contains -1. 

- I'd also suggest we rewire the "generators" method of the top-level arithmetic subgroup class to use Hartmut's new code by default, with the old code as an optional fall-back. 

- While we're at it, it would be nice to have a "farey_symbol" method of arithmetic subgroups as an alternative to the constructor function.



---

archive/issue_comments_129484.json:
```json
{
    "body": "Sorry, \"if G is even and has no torsion\" is nonsense -- I meant \"if G is even and has no elliptic points\", i.e.~if the projective image of G is torsionfree.",
    "created_at": "2012-03-02T15:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129484",
    "user": "https://github.com/loefflerd"
}
```

Sorry, "if G is even and has no torsion" is nonsense -- I meant "if G is even and has no elliptic points", i.e.~if the projective image of G is torsionfree.



---

archive/issue_comments_129485.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol-sage-4.8.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-4.8.patch) by @monien created at 2012-03-02 17:51:47\n\nI added some code to \"init_generators\" to fix both problems. I agree that it would be good to rewire the generators of the top-level arithmetic subgroup class. It would be even better to implement Webers O(n) algorithm for generators of the congruence subgroups to \"farey.cpp\" (requires some work).",
    "created_at": "2012-03-02T17:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129485",
    "user": "https://github.com/monien"
}
```

Attachment [trac-11709_farey_symbol-sage-4.8.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-4.8.patch) by @monien created at 2012-03-02 17:51:47

I added some code to "init_generators" to fix both problems. I agree that it would be good to rewire the generators of the top-level arithmetic subgroup class. It would be even better to implement Webers O(n) algorithm for generators of the congruence subgroups to "farey.cpp" (requires some work).



---

archive/issue_comments_129486.json:
```json
{
    "body": "My concern on the mailing list was that there are binary files (png images) in the patch. There should never be any binary files included ever. \nIncluding the plot commands itself would be nice, though.",
    "created_at": "2012-03-02T18:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129486",
    "user": "https://github.com/haraldschilly"
}
```

My concern on the mailing list was that there are binary files (png images) in the patch. There should never be any binary files included ever. 
Including the plot commands itself would be nice, though.



---

archive/issue_comments_129487.json:
```json
{
    "body": "Replying to [comment:29 schilly]:\n> My concern on the mailing list was that there are binary files (png images) in the patch. There should never be any binary files included ever. \n> Including the plot commands itself would be nice, though. \n\nIf there is a way to include svg's in the documentation let me know. I would be happy to change png -> svg.",
    "created_at": "2012-03-02T19:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129487",
    "user": "https://github.com/monien"
}
```

Replying to [comment:29 schilly]:
> My concern on the mailing list was that there are binary files (png images) in the patch. There should never be any binary files included ever. 
> Including the plot commands itself would be nice, though. 

If there is a way to include svg's in the documentation let me know. I would be happy to change png -> svg.



---

archive/issue_comments_129488.json:
```json
{
    "body": "Replying to [comment:30 hmonien]:\n> If there is a way to include svg's in the documentation let me know. I would be happy to change png -> svg.\n\nwell, i like the idea, but i don't think producing the latex/pdf output via sphinx is able to render this. apart from that you can start a new thread on sage-devel on that, curious what others think about this.",
    "created_at": "2012-03-02T19:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129488",
    "user": "https://github.com/haraldschilly"
}
```

Replying to [comment:30 hmonien]:
> If there is a way to include svg's in the documentation let me know. I would be happy to change png -> svg.

well, i like the idea, but i don't think producing the latex/pdf output via sphinx is able to render this. apart from that you can start a new thread on sage-devel on that, curious what others think about this.



---

archive/issue_comments_129489.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-06T15:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129489",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129490.json:
```json
{
    "body": "I've uploaded a new patch which is almost 100% identical to Hartmut's but with a tiny change so it applies to the current v5.0 beta; and a reviewer patch, which makes changes to the existing classes so `generators` calls Hartmut's code by default (while still falling back to the old code when necessary).\n\nThe only significant change I've made concerns the output of \"generators\" for even subgroups with elliptic points of order 3 but not of order 2. Rather than adding -1 on to the end of the generators list, I've modified the code so it returns generators of order 6 for the odd self-paired sides; so now the list of generators is genuinely minimal. I also had to tinker with the signal handling slightly to get rid of a tedious crash when doctesting.\n\nIf Hartmut or anyone else is willing to sign off on my patch, I think this is ready to go in.",
    "created_at": "2012-03-06T15:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129490",
    "user": "https://github.com/loefflerd"
}
```

I've uploaded a new patch which is almost 100% identical to Hartmut's but with a tiny change so it applies to the current v5.0 beta; and a reviewer patch, which makes changes to the existing classes so `generators` calls Hartmut's code by default (while still falling back to the old code when necessary).

The only significant change I've made concerns the output of "generators" for even subgroups with elliptic points of order 3 but not of order 2. Rather than adding -1 on to the end of the generators list, I've modified the code so it returns generators of order 6 for the odd self-paired sides; so now the list of generators is genuinely minimal. I also had to tinker with the signal handling slightly to get rid of a tedious crash when doctesting.

If Hartmut or anyone else is willing to sign off on my patch, I think this is ready to go in.



---

archive/issue_comments_129491.json:
```json
{
    "body": "Sorry, \"(while still falling back to the old code when necessary)\" should have been \"(while having an option to fall back to the old code)\" -- it's never necessary!",
    "created_at": "2012-03-06T15:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129491",
    "user": "https://github.com/loefflerd"
}
```

Sorry, "(while still falling back to the old code when necessary)" should have been "(while having an option to fall back to the old code)" -- it's never necessary!



---

archive/issue_comments_129492.json:
```json
{
    "body": "I can have a look at the patch on the week end or next week.\nAnyway I was going to make a comment on the generators, which I haven't done for lake of time: I am absolutely sure that the Farey symbols should correspond to PSL(2, ZZ). Any work on the generators, like the issues that you, David, pointed out before, should be dealt with in the class for arithmetic groups.\n\nI guess from your comment, that you did this in part. But in my opinion this should be a separate ticket. There is a lot of work to be done.\n\nBtw. if anybody has time to sign this off before the weekend: Go ahead!",
    "created_at": "2012-03-06T16:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129492",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I can have a look at the patch on the week end or next week.
Anyway I was going to make a comment on the generators, which I haven't done for lake of time: I am absolutely sure that the Farey symbols should correspond to PSL(2, ZZ). Any work on the generators, like the issues that you, David, pointed out before, should be dealt with in the class for arithmetic groups.

I guess from your comment, that you did this in part. But in my opinion this should be a separate ticket. There is a lot of work to be done.

Btw. if anybody has time to sign this off before the weekend: Go ahead!



---

archive/issue_comments_129493.json:
```json
{
    "body": "I just realised that the patch breaks a line in William's old 2008 Bordeaux slides which are included as part of the documentation. The slides complain about Farey symbols not being implemented, so I've added a comment explaining that they are now implemented and changed the doctest.",
    "created_at": "2012-03-06T16:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129493",
    "user": "https://github.com/loefflerd"
}
```

I just realised that the patch breaks a line in William's old 2008 Bordeaux slides which are included as part of the documentation. The slides complain about Farey symbols not being implemented, so I've added a comment explaining that they are now implemented and changed the doctest.



---

archive/issue_comments_129494.json:
```json
{
    "body": "Wait a minute, here's a bug.\n\n```\nsage: G = ArithmeticSubgroup_Permutation(S2=\"(1,2,3,4)\",S3=\"(1,3)(2,4)\")\nsage: gens = FareySymbol(G).generators(); [x.matrix() for x in gens]\n[\n[1 2]  [ 0 -1]  [ 1 -1]\n[0 1], [ 1 -1], [ 1  0]\n]\nsage: gens[0] in G\nFalse\n```\n\n\nThis has the disastrous consequence that ` G.is_congruence() ` returns False, even though G is actually congruence (of level 4).\n\nFor some reason, the mechanism that checks whether the potential generator is actually in the group, and if not flips its sign, doesn't seem to be working for this particular group G. It seems to work for all the other ones I've tried though. Hartmut: any thoughts?",
    "created_at": "2012-03-06T17:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129494",
    "user": "https://github.com/loefflerd"
}
```

Wait a minute, here's a bug.

```
sage: G = ArithmeticSubgroup_Permutation(S2="(1,2,3,4)",S3="(1,3)(2,4)")
sage: gens = FareySymbol(G).generators(); [x.matrix() for x in gens]
[
[1 2]  [ 0 -1]  [ 1 -1]
[0 1], [ 1 -1], [ 1  0]
]
sage: gens[0] in G
False
```


This has the disastrous consequence that ` G.is_congruence() ` returns False, even though G is actually congruence (of level 4).

For some reason, the mechanism that checks whether the potential generator is actually in the group, and if not flips its sign, doesn't seem to be working for this particular group G. It seems to work for all the other ones I've tried though. Hartmut: any thoughts?



---

archive/issue_comments_129495.json:
```json
{
    "body": "I found out what was wrong. This G is a lifting to SL2Z of the unique index 2 subgroup of PL2Z, which is handled separately as a special case in the code. The updated reviewer patch I've just uploaded fixes this, so these two special cases are both handled correctly.",
    "created_at": "2012-03-06T18:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129495",
    "user": "https://github.com/loefflerd"
}
```

I found out what was wrong. This G is a lifting to SL2Z of the unique index 2 subgroup of PL2Z, which is handled separately as a special case in the code. The updated reviewer patch I've just uploaded fixes this, so these two special cases are both handled correctly.



---

archive/issue_comments_129496.json:
```json
{
    "body": "Apply trac-11709_farey_symbol-sage-5.0.patch, trac_11709-review.patch\n\n(for the patchbot)",
    "created_at": "2012-03-07T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129496",
    "user": "https://github.com/loefflerd"
}
```

Apply trac-11709_farey_symbol-sage-5.0.patch, trac_11709-review.patch

(for the patchbot)



---

archive/issue_comments_129497.json:
```json
{
    "body": "Hartmut's patch but rebased to 5.0 and with trailing whitespace removed",
    "created_at": "2012-03-09T17:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129497",
    "user": "https://github.com/loefflerd"
}
```

Hartmut's patch but rebased to 5.0 and with trailing whitespace removed



---

archive/issue_comments_129498.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol-sage-5.0.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-5.0.patch) by @loefflerd created at 2012-03-09 17:33:34\n\nIGNORE THIS -- uploaded by mistake",
    "created_at": "2012-03-09T17:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129498",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac-11709_farey_symbol-sage-5.0.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-5.0.patch) by @loefflerd created at 2012-03-09 17:33:34

IGNORE THIS -- uploaded by mistake



---

archive/issue_comments_129499.json:
```json
{
    "body": "Attachment [trac_11709-review.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-review.patch) by @loefflerd created at 2012-03-09 17:33:58\n\nReviewer patch; apply over the rebased v5.0 patch",
    "created_at": "2012-03-09T17:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129499",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac_11709-review.patch](tarball://root/attachments/some-uuid/ticket11709/trac_11709-review.patch) by @loefflerd created at 2012-03-09 17:33:58

Reviewer patch; apply over the rebased v5.0 patch



---

archive/issue_comments_129500.json:
```json
{
    "body": "Apply trac-11709_farey_symbol-sage-5.0.patch, trac_11709-review.patch\n\n(for the patchbot).\n\nSorry for the noise, but a patchbot run highlighted a failure in `ell_rational_field.py` (a doctest that relied, for some absurd reason, on a specific matrix being the 5th generator of Gamma0(15)), and also it was complaining about trailing whitespace in the patch, so I dealt with that.",
    "created_at": "2012-03-09T17:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129500",
    "user": "https://github.com/loefflerd"
}
```

Apply trac-11709_farey_symbol-sage-5.0.patch, trac_11709-review.patch

(for the patchbot).

Sorry for the noise, but a patchbot run highlighted a failure in `ell_rational_field.py` (a doctest that relied, for some absurd reason, on a specific matrix being the 5th generator of Gamma0(15)), and also it was complaining about trailing whitespace in the patch, so I dealt with that.



---

archive/issue_comments_129501.json:
```json
{
    "body": "Everything is OK with the changes. I should remark that I am not so happy with including -I as a generator in case the SL(2,Z) subgroup passed to Farey symbols makes this necessary. To me Farey symbols have to to with SL(2, Z) as much as SL(2, Z) has to do with its metaplectic cover. But since -I in PSL is just I, it is not wrong. I just think it's not very clean.\n\nI made one single change. Following the discussion at sage-devel, I removed all fundamental domain pictures. I kept the one for pairings, though, because it seems necessary to understand what is meant by [(0,5), ...].\n\nIf you are OK with this, please give this a positive review.",
    "created_at": "2012-03-11T13:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129501",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Everything is OK with the changes. I should remark that I am not so happy with including -I as a generator in case the SL(2,Z) subgroup passed to Farey symbols makes this necessary. To me Farey symbols have to to with SL(2, Z) as much as SL(2, Z) has to do with its metaplectic cover. But since -I in PSL is just I, it is not wrong. I just think it's not very clean.

I made one single change. Following the discussion at sage-devel, I removed all fundamental domain pictures. I kept the one for pairings, though, because it seems necessary to understand what is meant by [(0,5), ...].

If you are OK with this, please give this a positive review.



---

archive/issue_comments_129502.json:
```json
{
    "body": "Attachment [trac-11709_farey_symbol-sage-5.0-without_png.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-5.0-without_png.patch) by mraum created at 2012-03-11 13:24:18",
    "created_at": "2012-03-11T13:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129502",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Attachment [trac-11709_farey_symbol-sage-5.0-without_png.patch](tarball://root/attachments/some-uuid/ticket11709/trac-11709_farey_symbol-sage-5.0-without_png.patch) by mraum created at 2012-03-11 13:24:18



---

archive/issue_comments_129503.json:
```json
{
    "body": "OK, I can live with that.\n\nApply trac-11709_farey_symbol-sage-5.0-without_png.patch, trac_11709-review.patch",
    "created_at": "2012-03-11T13:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129503",
    "user": "https://github.com/loefflerd"
}
```

OK, I can live with that.

Apply trac-11709_farey_symbol-sage-5.0-without_png.patch, trac_11709-review.patch



---

archive/issue_comments_129504.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-11T13:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129504",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129505.json:
```json
{
    "body": "The mess you get when you print a list of SL2Z elements, as in many of the doctests here, bothered me enough that I found a fix: see #12658. Any takers for a review?",
    "created_at": "2012-03-12T23:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129505",
    "user": "https://github.com/loefflerd"
}
```

The mess you get when you print a list of SL2Z elements, as in many of the doctests here, bothered me enough that I found a fix: see #12658. Any takers for a review?



---

archive/issue_comments_129506.json:
```json
{
    "body": "Replying to [comment:44 davidloeffler]:\n> The mess you get when you print a list of SL2Z elements, as in many of the doctests here, bothered me enough that I found a fix: see #12658. Any takers for a review?\n\nGood idea! \n\nJust a comment on removing the figures. Any of the png files took approximately 8k. If one wants to get rid of binary files then  one  simple way would be to have figures in svg which costs about 32k for each file + a pdf file (again binary and 8k) for creating the latex documentation. I think the additional storage needed for the figures is minimal and in fact I would like to see more of them in the documentation.",
    "created_at": "2012-03-13T17:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129506",
    "user": "https://github.com/monien"
}
```

Replying to [comment:44 davidloeffler]:
> The mess you get when you print a list of SL2Z elements, as in many of the doctests here, bothered me enough that I found a fix: see #12658. Any takers for a review?

Good idea! 

Just a comment on removing the figures. Any of the png files took approximately 8k. If one wants to get rid of binary files then  one  simple way would be to have figures in svg which costs about 32k for each file + a pdf file (again binary and 8k) for creating the latex documentation. I think the additional storage needed for the figures is minimal and in fact I would like to see more of them in the documentation.



---

archive/issue_comments_129507.json:
```json
{
    "body": "You may be right, but let's have a separate ticket for that: I don't want the code here to wait any longer before it goes in!",
    "created_at": "2012-03-13T17:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129507",
    "user": "https://github.com/loefflerd"
}
```

You may be right, but let's have a separate ticket for that: I don't want the code here to wait any longer before it goes in!



---

archive/issue_comments_129508.json:
```json
{
    "body": "Okay then - done!",
    "created_at": "2012-03-13T21:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129508",
    "user": "https://github.com/monien"
}
```

Okay then - done!



---

archive/issue_comments_129509.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11537#issuecomment-129509",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
