# Issue 24277: py3: Fix ntl_GF2X.__hex__

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-01-11 13:20:00

There's a class in `sage.libs.ntl` called `ntl_GF2X`, representing polynomials over GF(2) in NTL.

These have a hexadecimal representation obtained from viewing their coefficients as bits, so somewhat naturally this class implements `__hex__`.

However, it also implements `__int__` which is somewhat at odds with this--its `__int__` only works for degree 0 polynomials and returns 1 or 0.

In the Python 2 docs, it states about `hex()`: "Convert an integer number (of any size) to a lowercase hexadecimal string prefixed with “0x”, for example".

It later goes on to mention that if the input is not `int` or `long` the `__hex__` method is called.  Of course any class can then define `__hex__`, and the docs don't explicitly state any restrictions on what classes may define `__hex__`, but the implication of the earlier part of the docs is that the input to `hex()` should be _some kind of integer_.

Now, there is this bijection between elements of GF(2) and (non-negative) integers, but my sense is that if `__hex__` is defined in this way, then `__int__` should also return the same value as `__hex__` (as an `int`).

This comes up in particular on Python 3 because Python 3 no longer has `__hex__`, and a custom class should define `__index__` if you want it to be able to work with `hex()`.  But if `__index__` is defined it should return the same value as `__int__`.  So that would mean changing how this class treats `__int__`.

I think instead it would be better to change its `__hex__` method to just `.hex()` and deprecate `__hex__` (and thus use of the `hex()` built-in on this class).  That is, deprecate it in Python 2, and in Python 3 it just won't work at all.


---

Comment by jdemeyer created at 2018-01-11 13:51:20

Replying to [ticket:24514 embray]:
> I think instead it would be better to change its `__hex__` method to just `.hex()` and deprecate `__hex__` (and thus use of the `hex()` built-in on this class).  That is, deprecate it in Python 2, and in Python 3 it just won't work at all.

+1


---

Comment by chapoton created at 2018-01-16 07:59:12

New commits:


---

Comment by chapoton created at 2018-01-16 07:59:12

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-01-16 08:15:31

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-01-16 08:15:31

You should test the deprecation `hex(something)`.


---

Comment by git created at 2018-01-16 09:18:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-01-16 09:19:13

done


---

Comment by chapoton created at 2018-01-16 09:19:13

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-01-16 10:16:38

green bot


---

Comment by embray created at 2018-01-16 13:52:50

Thanks.


---

Comment by embray created at 2018-01-16 13:52:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-18 18:09:05

Resolution: fixed
