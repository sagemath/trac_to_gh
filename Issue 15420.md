# Issue 15420: Allow parsing of arguments for cached_function and cached_method

archive/issues_015420.json:
```json
{
    "body": "Assignee: tscrim\n\nCC:  simonking\n\nKeywords: cached method function\n\nBecause it will be handy to normalize and/or ignore arguments for these functions and method. See #1314 for an example.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15657\n\n",
    "created_at": "2014-01-09T16:43:23Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Allow parsing of arguments for cached_function and cached_method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15420",
    "user": "tscrim"
}
```
Assignee: tscrim

CC:  simonking

Keywords: cached method function

Because it will be handy to normalize and/or ignore arguments for these functions and method. See #1314 for an example.

Issue created by migration from https://trac.sagemath.org/ticket/15657





---

archive/issue_comments_199053.json:
```json
{
    "body": "(curious)",
    "created_at": "2014-01-09T17:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199053",
    "user": "ncohen"
}
```

(curious)



---

archive/issue_comments_199054.json:
```json
{
    "body": "I implemented this for `cached_function`. I am working on something similar for `cached_method`.\n----\nNew commits:",
    "created_at": "2014-03-19T23:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199054",
    "user": "saraedum"
}
```

I implemented this for `cached_function`. I am working on something similar for `cached_method`.
----
New commits:



---

archive/issue_comments_199055.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-20T01:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199055",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199056.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-20T01:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199056",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199057.json:
```json
{
    "body": "I've changed `create_key` into `key` to match with python's `sorted` (and it makes more sense to me). I've also moved a good part of the doc up to our current standards.\n\nHere are some timings:\n\nWith patch:\n\n```\nsage: @cached_function\n....: def foo():\n....:     return 5\n....: \nsage: %timeit foo()\n1000000 loops, best of 3: 343 ns per loop\n\nsage: class Foo:\n....:     @cached_method\n....:     def bar(self):\n....:         return 5\n....:     \nsage: F = Foo()\nsage: %timeit F.bar()\n1000000 loops, best of 3: 235 ns per loop\n\nsage: class FooArgs:\n....:     @cached_method\n....:     def bar(self, x):\n....:         return x\n....:     \nsage: FA = FooArgs()\nsage: %timeit FA.bar(5)\n1000000 loops, best of 3: 1.55 \u00b5s per loop\n```\n\nBefore:\n\n```\nsage: %timeit foo()\n1000000 loops, best of 3: 335 ns per loop\n\nsage: %timeit F.bar()\n1000000 loops, best of 3: 250 ns per loop\n\nsage: %timeit FA.bar(5)\n1000000 loops, best of 3: 1.47 \u00b5s per loop\n```\n\nSo there does not appear to be any (statistically) significant speed regression (I did multiple runs of each as well).\n\nIf you're happy with my changes, then positive review.\n\nPS - I also added the key option for the cache to file.\n----\nNew commits:",
    "created_at": "2014-03-26T02:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199057",
    "user": "tscrim"
}
```

I've changed `create_key` into `key` to match with python's `sorted` (and it makes more sense to me). I've also moved a good part of the doc up to our current standards.

Here are some timings:

With patch:

```
sage: @cached_function
....: def foo():
....:     return 5
....: 
sage: %timeit foo()
1000000 loops, best of 3: 343 ns per loop

sage: class Foo:
....:     @cached_method
....:     def bar(self):
....:         return 5
....:     
sage: F = Foo()
sage: %timeit F.bar()
1000000 loops, best of 3: 235 ns per loop

sage: class FooArgs:
....:     @cached_method
....:     def bar(self, x):
....:         return x
....:     
sage: FA = FooArgs()
sage: %timeit FA.bar(5)
1000000 loops, best of 3: 1.55 µs per loop
```

Before:

```
sage: %timeit foo()
1000000 loops, best of 3: 335 ns per loop

sage: %timeit F.bar()
1000000 loops, best of 3: 250 ns per loop

sage: %timeit FA.bar(5)
1000000 loops, best of 3: 1.47 µs per loop
```

So there does not appear to be any (statistically) significant speed regression (I did multiple runs of each as well).

If you're happy with my changes, then positive review.

PS - I also added the key option for the cache to file.
----
New commits:



---

archive/issue_comments_199058.json:
```json
{
    "body": "Sage does not start anymore for me:\n\n\n```\nImportError: No module named terminal.interactiveshell\n```\n\n\nSomehow your merge has really gone wrong. Do you want me to fix this for you?",
    "created_at": "2014-04-02T11:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199058",
    "user": "saraedum"
}
```

Sage does not start anymore for me:


```
ImportError: No module named terminal.interactiveshell
```


Somehow your merge has really gone wrong. Do you want me to fix this for you?



---

archive/issue_comments_199059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-02T14:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199059",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199060.json:
```json
{
    "body": "Started just fine for me with 6.2.beta5, and here's my current 6.2.beta6 version (which also starts up without error).",
    "created_at": "2014-04-02T14:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199060",
    "user": "tscrim"
}
```

Started just fine for me with 6.2.beta5, and here's my current 6.2.beta6 version (which also starts up without error).



---

archive/issue_comments_199061.json:
```json
{
    "body": "Ok. I had to `make`. Now it works again. I agree with your changes.",
    "created_at": "2014-04-10T15:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199061",
    "user": "saraedum"
}
```

Ok. I had to `make`. Now it works again. I agree with your changes.



---

archive/issue_comments_199062.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-10T15:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199062",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199063.json:
```json
{
    "body": "Thanks.",
    "created_at": "2014-04-10T15:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199063",
    "user": "tscrim"
}
```

Thanks.



---

archive/issue_comments_199064.json:
```json
{
    "body": "\n```\nsage -t --long src/doc/en/thematic_tutorials/coercion_and_categories.rst  # 2 doctests failed\nsage -t --long src/sage/misc/dev_tools.py  # 1 doctest failed\n```\n",
    "created_at": "2014-04-14T16:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199064",
    "user": "vbraun"
}
```


```
sage -t --long src/doc/en/thematic_tutorials/coercion_and_categories.rst  # 2 doctests failed
sage -t --long src/sage/misc/dev_tools.py  # 1 doctest failed
```




---

archive/issue_comments_199065.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-04-18T15:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199065",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_199066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-04-18T15:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199066",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_199067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-18T16:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199067",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199068.json:
```json
{
    "body": "Fixed.",
    "created_at": "2014-04-18T16:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199068",
    "user": "tscrim"
}
```

Fixed.



---

archive/issue_comments_199069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-20T23:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199069",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_199070.json:
```json
{
    "body": "Actually using the `key` parameter I found a few small bugs, this is #16337.",
    "created_at": "2014-05-12T16:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199070",
    "user": "saraedum"
}
```

Actually using the `key` parameter I found a few small bugs, this is #16337.



---

archive/issue_comments_199071.json:
```json
{
    "body": "Hello guys !!\n\nWith designs I would like to have some new parameter for cached methods, but I wonder if it would be a good idea of slow something that we want to be fast...\n\nHere is the thing : I would like to only cache the return values corresponding to \"some\" inputs of the cached function. More precisely, if some parameter is set to True I want to cache the result, otherwise I don't want to.\n\nDo you know if it can be useful to you, or if it can be obtained by a trick with the current features of cached methods ?\n\nThaaaaaaanks !\n\nNathann",
    "created_at": "2014-05-13T07:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15420#issuecomment-199071",
    "user": "ncohen"
}
```

Hello guys !!

With designs I would like to have some new parameter for cached methods, but I wonder if it would be a good idea of slow something that we want to be fast...

Here is the thing : I would like to only cache the return values corresponding to "some" inputs of the cached function. More precisely, if some parameter is set to True I want to cache the result, otherwise I don't want to.

Do you know if it can be useful to you, or if it can be obtained by a trick with the current features of cached methods ?

Thaaaaaaanks !

Nathann
