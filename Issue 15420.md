# Issue 15420: Allow parsing of arguments for cached_function and cached_method

Issue created by migration from https://trac.sagemath.org/ticket/15657

Original creator: tscrim

Original creation time: 2014-01-09 16:43:23

Assignee: tscrim

CC:  simonking

Keywords: cached method function

Because it will be handy to normalize and/or ignore arguments for these functions and method. See #1314 for an example.


---

Comment by ncohen created at 2014-01-09 17:46:47

(curious)


---

Comment by saraedum created at 2014-03-19 23:04:04

I implemented this for `cached_function`. I am working on something similar for `cached_method`.
----
New commits:


---

Comment by git created at 2014-03-20 01:15:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2014-03-20 01:19:12

Changing status from new to needs_review.


---

Comment by tscrim created at 2014-03-26 02:24:49

I've changed `create_key` into `key` to match with python's `sorted` (and it makes more sense to me). I've also moved a good part of the doc up to our current standards.

Here are some timings:

With patch:

```
sage: @cached_function
....: def foo():
....:     return 5
....: 
sage: %timeit foo()
1000000 loops, best of 3: 343 ns per loop

sage: class Foo:
....:     @cached_method
....:     def bar(self):
....:         return 5
....:     
sage: F = Foo()
sage: %timeit F.bar()
1000000 loops, best of 3: 235 ns per loop

sage: class FooArgs:
....:     @cached_method
....:     def bar(self, x):
....:         return x
....:     
sage: FA = FooArgs()
sage: %timeit FA.bar(5)
1000000 loops, best of 3: 1.55 µs per loop
```

Before:

```
sage: %timeit foo()
1000000 loops, best of 3: 335 ns per loop

sage: %timeit F.bar()
1000000 loops, best of 3: 250 ns per loop

sage: %timeit FA.bar(5)
1000000 loops, best of 3: 1.47 µs per loop
```

So there does not appear to be any (statistically) significant speed regression (I did multiple runs of each as well).

If you're happy with my changes, then positive review.

PS - I also added the key option for the cache to file.
----
New commits:


---

Comment by saraedum created at 2014-04-02 11:40:37

Sage does not start anymore for me:


```
ImportError: No module named terminal.interactiveshell
```


Somehow your merge has really gone wrong. Do you want me to fix this for you?


---

Comment by git created at 2014-04-02 14:29:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-04-02 14:30:35

Started just fine for me with 6.2.beta5, and here's my current 6.2.beta6 version (which also starts up without error).


---

Comment by saraedum created at 2014-04-10 15:21:13

Ok. I had to `make`. Now it works again. I agree with your changes.


---

Comment by saraedum created at 2014-04-10 15:21:13

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-04-10 15:34:32

Thanks.


---

Comment by vbraun created at 2014-04-14 16:54:59


```
sage -t --long src/doc/en/thematic_tutorials/coercion_and_categories.rst  # 2 doctests failed
sage -t --long src/sage/misc/dev_tools.py  # 1 doctest failed
```



---

Comment by git created at 2014-04-18 15:55:47

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-04-18 15:55:47

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by tscrim created at 2014-04-18 16:08:51

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-04-18 16:08:51

Fixed.


---

Comment by vbraun created at 2014-04-20 23:37:35

Resolution: fixed


---

Comment by saraedum created at 2014-05-12 16:59:36

Actually using the `key` parameter I found a few small bugs, this is #16337.


---

Comment by ncohen created at 2014-05-13 07:59:39

Hello guys !!

With designs I would like to have some new parameter for cached methods, but I wonder if it would be a good idea of slow something that we want to be fast...

Here is the thing : I would like to only cache the return values corresponding to "some" inputs of the cached function. More precisely, if some parameter is set to True I want to cache the result, otherwise I don't want to.

Do you know if it can be useful to you, or if it can be obtained by a trick with the current features of cached methods ?

Thaaaaaaanks !

Nathann
