# Issue 19288: Improve GLPK error handling

archive/issues_019288.json:
```json
{
    "body": "CC:  @nathanncohen\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19525\n\n",
    "created_at": "2015-11-04T16:37:46Z",
    "labels": [
        "cython",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Improve GLPK error handling",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19288",
    "user": "@jdemeyer"
}
```
CC:  @nathanncohen



Issue created by migration from https://trac.sagemath.org/ticket/19525





---

archive/issue_comments_264886.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-05T10:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264886",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_264887.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-05T10:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264887",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_264888.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T10:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264888",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264889.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-06T13:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264889",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264890.json:
```json
{
    "body": "Upstream claims we are mis-using the GLPK error hook. They are probably right. However, given that I'd like to keep \"upgrade GLPK\" separated from this ticket, I still propose to review this ticket as-is and then deal with the upgrade on a new ticket.",
    "created_at": "2015-11-09T16:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264890",
    "user": "@jdemeyer"
}
```

Upstream claims we are mis-using the GLPK error hook. They are probably right. However, given that I'd like to keep "upgrade GLPK" separated from this ticket, I still propose to review this ticket as-is and then deal with the upgrade on a new ticket.



---

archive/issue_comments_264891.json:
```json
{
    "body": "Does a reviewer need to create a patched GLPK tarball himself?",
    "created_at": "2015-11-11T08:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264891",
    "user": "@dimpase"
}
```

Does a reviewer need to create a patched GLPK tarball himself?



---

archive/issue_comments_264892.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> Does a reviewer need to create a patched GLPK tarball himself?\nNo. This isn't a GLPK upgrade.",
    "created_at": "2015-11-11T16:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264892",
    "user": "@jdemeyer"
}
```

Replying to [comment:15 dimpase]:
> Does a reviewer need to create a patched GLPK tarball himself?
No. This isn't a GLPK upgrade.



---

archive/issue_comments_264893.json:
```json
{
    "body": "Any news on the upstream situation?",
    "created_at": "2016-03-30T16:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264893",
    "user": "@mkoeppe"
}
```

Any news on the upstream situation?



---

archive/issue_comments_264894.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-30T17:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264894",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_264895.json:
```json
{
    "body": "does not apply on the latest beta",
    "created_at": "2016-03-30T17:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264895",
    "user": "@videlec"
}
```

does not apply on the latest beta



---

archive/issue_comments_264896.json:
```json
{
    "body": "> Any news on the upstream situation?\n\nSee [comment:14]",
    "created_at": "2016-03-30T17:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264896",
    "user": "@jdemeyer"
}
```

> Any news on the upstream situation?

See [comment:14]



---

archive/issue_comments_264897.json:
```json
{
    "body": "Replying to [comment:19 vdelecroix]:\n> does not apply on the latest beta\n\nAre you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).",
    "created_at": "2016-03-30T17:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264897",
    "user": "@jdemeyer"
}
```

Replying to [comment:19 vdelecroix]:
> does not apply on the latest beta

Are you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).



---

archive/issue_comments_264898.json:
```json
{
    "body": "Replying to [comment:21 jdemeyer]:\n> Replying to [comment:19 vdelecroix]:\n> > does not apply on the latest beta\n> \n> Are you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).\n\nI will not pronounce about a review. But of course, I was interested in looking at the code.",
    "created_at": "2016-03-30T17:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264898",
    "user": "@videlec"
}
```

Replying to [comment:21 jdemeyer]:
> Replying to [comment:19 vdelecroix]:
> > does not apply on the latest beta
> 
> Are you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).

I will not pronounce about a review. But of course, I was interested in looking at the code.



---

archive/issue_comments_264899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-30T17:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264899",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264900.json:
```json
{
    "body": "hmm\n\n```diff\n@@ -618,8 +634,14 @@ cdef class GLPKBackend(GenericBackend):\n             (2.0, 2.0)\n         \"\"\"\n         cdef int n = glp_get_num_cols(self.lp)\n+<<<<<<< HEAD\n+        cdef MemoryAllocator mem = MemoryAllocator()\n+        cdef int * c_indices = <int*>mem.allocarray(n+1, sizeof(int))\n+        cdef double * c_values = <double*>mem.allocarray(n+1, sizeof(double))\n+=======\n         cdef int * c_indices = <int*> sig_malloc((n+1)*sizeof(int))\n         cdef double * c_values = <double*> sig_malloc((n+1)*sizeof(double))\n+>>>>>>> 7.2.beta1\n         cdef list indices = []\n         cdef list values = []\n         cdef int i,j\n```\n",
    "created_at": "2016-03-30T17:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264900",
    "user": "@videlec"
}
```

hmm

```diff
@@ -618,8 +634,14 @@ cdef class GLPKBackend(GenericBackend):
             (2.0, 2.0)
         """
         cdef int n = glp_get_num_cols(self.lp)
+<<<<<<< HEAD
+        cdef MemoryAllocator mem = MemoryAllocator()
+        cdef int * c_indices = <int*>mem.allocarray(n+1, sizeof(int))
+        cdef double * c_values = <double*>mem.allocarray(n+1, sizeof(double))
+=======
         cdef int * c_indices = <int*> sig_malloc((n+1)*sizeof(int))
         cdef double * c_values = <double*> sig_malloc((n+1)*sizeof(double))
+>>>>>>> 7.2.beta1
         cdef list indices = []
         cdef list values = []
         cdef int i,j
```




---

archive/issue_comments_264901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-30T18:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264901",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_264902.json:
```json
{
    "body": "import \"cysignals/signals.pxi\" instead of \"sage/ext/interrupt.pxi\", see #20002 for details ;-)",
    "created_at": "2016-03-30T18:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264902",
    "user": "@videlec"
}
```

import "cysignals/signals.pxi" instead of "sage/ext/interrupt.pxi", see #20002 for details ;-)



---

archive/issue_comments_264903.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-30T20:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264903",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264904.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-30T20:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264904",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_264905.json:
```json
{
    "body": "A commit to fix changes in error messages.\n----\nNew commits:",
    "created_at": "2016-03-30T20:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264905",
    "user": "@videlec"
}
```

A commit to fix changes in error messages.
----
New commits:



---

archive/issue_comments_264906.json:
```json
{
    "body": "See also #10232",
    "created_at": "2016-03-30T21:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264906",
    "user": "@mkoeppe"
}
```

See also #10232



---

archive/issue_comments_264907.json:
```json
{
    "body": "Indeed, in order to fix #10232 there need to be the appropriate `sig_on` and `sig_off` around the GLPK calls.",
    "created_at": "2016-03-30T21:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264907",
    "user": "@videlec"
}
```

Indeed, in order to fix #10232 there need to be the appropriate `sig_on` and `sig_off` around the GLPK calls.



---

archive/issue_comments_264908.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-03-30T21:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264908",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_264909.json:
```json
{
    "body": "Jeroen, do you prefer another ticket to add the appropriate `sig_on/sig_off` around GLPK calls?",
    "created_at": "2016-03-30T21:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264909",
    "user": "@videlec"
}
```

Jeroen, do you prefer another ticket to add the appropriate `sig_on/sig_off` around GLPK calls?



---

archive/issue_comments_264910.json:
```json
{
    "body": "If yes, then the ticket is good to go from my point of view.",
    "created_at": "2016-03-30T21:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264910",
    "user": "@videlec"
}
```

If yes, then the ticket is good to go from my point of view.



---

archive/issue_comments_264911.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-03-31T06:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264911",
    "user": "@jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_264912.json:
```json
{
    "body": "Fails on 32-bit\n\n```\nsage -t --long src/sage/numerical/backends/glpk_backend.pyx\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 847, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\nFailed example:\n    lp.solve()\nExpected:\n    Traceback (most recent call last):\n    ...\n    GLPKError: Assertion failed: col->lb < col->ub\n    Error detected in file glpnpp05.c at line ...\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[24]>\", line 1, in <module>\n        lp.solve()\n      File \"sage/numerical/mip.pyx\", line 2115, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/mip.c:14757)\n        self._backend.solve()\n      File \"sage/numerical/backends/glpk_backend.pyx\", line 1005, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8406)\n        sig_on()\n    GLPKError: Assertion failed: q->lb < q->ub\n    Error detected in file glpnpp03.c at line 557\n**********************************************************************\n1 item had failures:\n   1 of  76 in sage.numerical.backends.glpk_backend.GLPKBackend.solve\n```\n",
    "created_at": "2016-03-31T15:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264912",
    "user": "@vbraun"
}
```

Fails on 32-bit

```
sage -t --long src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 847, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
Failed example:
    lp.solve()
Expected:
    Traceback (most recent call last):
    ...
    GLPKError: Assertion failed: col->lb < col->ub
    Error detected in file glpnpp05.c at line ...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[24]>", line 1, in <module>
        lp.solve()
      File "sage/numerical/mip.pyx", line 2115, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/mip.c:14757)
        self._backend.solve()
      File "sage/numerical/backends/glpk_backend.pyx", line 1005, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8406)
        sig_on()
    GLPKError: Assertion failed: q->lb < q->ub
    Error detected in file glpnpp03.c at line 557
**********************************************************************
1 item had failures:
   1 of  76 in sage.numerical.backends.glpk_backend.GLPKBackend.solve
```




---

archive/issue_comments_264913.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-03-31T15:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264913",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_264914.json:
```json
{
    "body": "This should do the trick...\n----\nNew commits:",
    "created_at": "2016-04-01T08:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264914",
    "user": "@jdemeyer"
}
```

This should do the trick...
----
New commits:



---

archive/issue_comments_264915.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-04-01T08:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264915",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_264916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-01T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19288#issuecomment-264916",
    "user": "@vbraun"
}
```

Resolution: fixed
