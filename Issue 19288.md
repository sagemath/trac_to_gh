# Issue 19288: Improve GLPK error handling

Issue created by migration from https://trac.sagemath.org/ticket/19525

Original creator: jdemeyer

Original creation time: 2015-11-04 16:37:46

CC:  ncohen




---

Comment by git created at 2015-11-05 10:10:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2015-11-05 10:11:26

Changing status from new to needs_review.


---

Comment by git created at 2015-11-05 10:35:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-06 13:26:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-11-09 16:54:38

Upstream claims we are mis-using the GLPK error hook. They are probably right. However, given that I'd like to keep "upgrade GLPK" separated from this ticket, I still propose to review this ticket as-is and then deal with the upgrade on a new ticket.


---

Comment by dimpase created at 2015-11-11 08:06:08

Does a reviewer need to create a patched GLPK tarball himself?


---

Comment by jdemeyer created at 2015-11-11 16:53:57

Replying to [comment:15 dimpase]:
> Does a reviewer need to create a patched GLPK tarball himself?
No. This isn't a GLPK upgrade.


---

Comment by mkoeppe created at 2016-03-30 16:54:45

Any news on the upstream situation?


---

Comment by vdelecroix created at 2016-03-30 17:20:19

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-03-30 17:20:19

does not apply on the latest beta


---

Comment by jdemeyer created at 2016-03-30 17:22:36

> Any news on the upstream situation?

See [comment:14]


---

Comment by jdemeyer created at 2016-03-30 17:26:06

Replying to [comment:19 vdelecroix]:
> does not apply on the latest beta

Are you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).


---

Comment by vdelecroix created at 2016-03-30 17:28:35

Replying to [comment:21 jdemeyer]:
> Replying to [comment:19 vdelecroix]:
> > does not apply on the latest beta
> 
> Are you actually interested in reviewing the ticket? (no offense, but I don't like people complaining that branches don't apply if they have absolutely no interest in reviewing the ticket).

I will not pronounce about a review. But of course, I was interested in looking at the code.


---

Comment by git created at 2016-03-30 17:36:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-30 17:55:08

hmm

```diff
@@ -618,8 +634,14 @@ cdef class GLPKBackend(GenericBackend):
             (2.0, 2.0)
         """
         cdef int n = glp_get_num_cols(self.lp)
+<<<<<<< HEAD
+        cdef MemoryAllocator mem = MemoryAllocator()
+        cdef int * c_indices = <int*>mem.allocarray(n+1, sizeof(int))
+        cdef double * c_values = <double*>mem.allocarray(n+1, sizeof(double))
+=======
         cdef int * c_indices = <int*> sig_malloc((n+1)*sizeof(int))
         cdef double * c_values = <double*> sig_malloc((n+1)*sizeof(double))
+>>>>>>> 7.2.beta1
         cdef list indices = []
         cdef list values = []
         cdef int i,j
```



---

Comment by git created at 2016-03-30 18:13:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-03-30 18:21:11

import "cysignals/signals.pxi" instead of "sage/ext/interrupt.pxi", see #20002 for details ;-)


---

Comment by git created at 2016-03-30 20:33:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-03-30 20:41:47

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-03-30 20:52:45

A commit to fix changes in error messages.
----
New commits:


---

Comment by mkoeppe created at 2016-03-30 21:01:42

See also #10232


---

Comment by vdelecroix created at 2016-03-30 21:08:02

Indeed, in order to fix #10232 there need to be the appropriate `sig_on` and `sig_off` around the GLPK calls.


---

Comment by vdelecroix created at 2016-03-30 21:14:37

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2016-03-30 21:14:37

Jeroen, do you prefer another ticket to add the appropriate `sig_on/sig_off` around GLPK calls?


---

Comment by vdelecroix created at 2016-03-30 21:14:55

If yes, then the ticket is good to go from my point of view.


---

Comment by jdemeyer created at 2016-03-31 06:58:07

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2016-03-31 15:04:13

Fails on 32-bit

```
sage -t --long src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 847, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
Failed example:
    lp.solve()
Expected:
    Traceback (most recent call last):
    ...
    GLPKError: Assertion failed: col->lb < col->ub
    Error detected in file glpnpp05.c at line ...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.glpk_backend.GLPKBackend.solve[24]>", line 1, in <module>
        lp.solve()
      File "sage/numerical/mip.pyx", line 2115, in sage.numerical.mip.MixedIntegerLinearProgram.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/mip.c:14757)
        self._backend.solve()
      File "sage/numerical/backends/glpk_backend.pyx", line 1005, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/numerical/backends/glpk_backend.cpp:8406)
        sig_on()
    GLPKError: Assertion failed: q->lb < q->ub
    Error detected in file glpnpp03.c at line 557
**********************************************************************
1 item had failures:
   1 of  76 in sage.numerical.backends.glpk_backend.GLPKBackend.solve
```



---

Comment by vbraun created at 2016-03-31 15:04:13

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-04-01 08:51:21

This should do the trick...
----
New commits:


---

Comment by jdemeyer created at 2016-04-01 08:51:21

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-04-01 15:10:57

Resolution: fixed
