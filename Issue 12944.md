# Issue 12944: The :trac: sphinx role does not work on the commandline

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-06-14 14:58:54

Assignee: mvngu

CC:  hivert kcrisman jhpalmieri

#12490 introduced a :trac:`12490` role to sphinx, which is typeset into "trac ticket #<hyperlink>". But it does not work on the command line:

```
sage: sage.rings.qqbar?
[...]
    TESTS:
    
    Verify that >>:trac:`10981`<< is fixed: 
```

It should also typeset into a trac link on the command line.

To shorten the urls as much as possible, it would be nice to be able to just say ``http://trac.sagemath.org/12490``. It would be easy to do with ``mod_rewrite``.


---

Comment by jhpalmieri created at 2012-06-14 18:49:52

Does this even work in the notebook? It doesn't for me: I only see it working successfully in the reference manual.


---

Comment by vbraun created at 2012-06-14 19:01:45

Indeed, I should have said that it works in the typeset manual only.

On a related note, it sucks that `sage.misc.sagedoc` calls into sagenb stuff to do the sphinxification. IHMO this should be pulled into the Sage library, the notebook can publish a hook for the documentation formatter of choice.


---

Comment by jhpalmieri created at 2012-06-14 20:13:05

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-06-14 20:13:05

Here's a patch which fixes the problem for me, dealt with along the lines of similar issues in sage.misc.sagedoc.


---

Comment by kcrisman created at 2012-06-15 01:56:54

My only fear is that this will make a lot of stuff look really long and crazy in the command line, wrapping etc.  What do the examples look like in the command line now?


---

Comment by jhpalmieri created at 2012-06-15 14:51:46

Here's a version using the shortened urls discussed [in sage-devel](https://groups.google.com/d/topic/sage-devel/axfWG5mBIKs/discussion).

Typing `sage.misc.sagedoc?` before the patch:

```
...

    TESTS:
    
    Check that argspecs of extension function/methods appear correctly,
    see >>:trac:`12849`<<:
```


After the patch:

```
...

    TESTS:
    
    Check that argspecs of extension function/methods appear correctly,
    see trac ticket #12849 <http://trac.sagemath.org/12849>:
```

So the docstring is longer, so some lines will end up being too long. I personally think that's okay, because of the added information.


---

Comment by vbraun created at 2012-06-15 14:58:31

How about just `see http://trac.sagemath.org/12849:`. if you know trac you understand that thats the ticket number, and if you don't know trac then the ticket number doesn't help you any more than the url.

Also, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.


---

Comment by jhpalmieri created at 2012-06-15 18:45:08

Replying to [comment:8 vbraun]:
> How about just `see http://trac.sagemath.org/12849:`.

Sure, that sounds fine.

> Also, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.

Okay, here's a better approach: turn on the "extlinks" Sphinx extension when doing introspection. Then in the notebook, docstrings look fine, but from the command line, `see :trac:`12849`` turns into `see trac ticket #12849`: it includes the text, but not the associated url. So I think we should still insert the url, so I still have a version of `process_trac`. This version should also handle any other roles defined in `extlinks`.


---

Comment by jhpalmieri created at 2012-06-15 23:14:51

Changing keywords from "" to "sd41".


---

Comment by vbraun created at 2012-06-16 11:47:51

Looks good. Two tiny nit picks, can we ellipsize the precise Python version (2.7.2) since that is conflicting with #13013 already. Also, the docstring would be perfect with 

```
- ``s`` -- string
```

(two minus signs before "string").


---

Comment by jhpalmieri created at 2012-06-16 16:00:09

Done.


---

Comment by jhpalmieri created at 2012-06-16 16:00:24

Sage library


---

Attachment

Looks good!


---

Comment by vbraun created at 2012-06-16 16:51:23

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-23 21:45:41

Resolution: fixed
