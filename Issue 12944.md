# Issue 12944: The :trac: sphinx role does not work on the commandline

archive/issues_012944.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  hivert kcrisman jhpalmieri\n\n#12490 introduced a :trac:`12490` role to sphinx, which is typeset into \"trac ticket #<hyperlink>\". But it does not work on the command line:\n\n```\nsage: sage.rings.qqbar?\n[...]\n    TESTS:\n    \n    Verify that >>:trac:`10981`<< is fixed: \n```\n\nIt should also typeset into a trac link on the command line.\n\nTo shorten the urls as much as possible, it would be nice to be able to just say ``http://trac.sagemath.org/12490``. It would be easy to do with ``mod_rewrite``.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13116\n\n",
    "created_at": "2012-06-14T14:58:54Z",
    "labels": [
        "documentation",
        "major",
        "bug"
    ],
    "title": "The :trac: sphinx role does not work on the commandline",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12944",
    "user": "vbraun"
}
```
Assignee: mvngu

CC:  hivert kcrisman jhpalmieri

#12490 introduced a :trac:`12490` role to sphinx, which is typeset into "trac ticket #<hyperlink>". But it does not work on the command line:

```
sage: sage.rings.qqbar?
[...]
    TESTS:
    
    Verify that >>:trac:`10981`<< is fixed: 
```

It should also typeset into a trac link on the command line.

To shorten the urls as much as possible, it would be nice to be able to just say ``http://trac.sagemath.org/12490``. It would be easy to do with ``mod_rewrite``.

Issue created by migration from https://trac.sagemath.org/ticket/13116





---

archive/issue_comments_155966.json:
```json
{
    "body": "Does this even work in the notebook? It doesn't for me: I only see it working successfully in the reference manual.",
    "created_at": "2012-06-14T18:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155966",
    "user": "jhpalmieri"
}
```

Does this even work in the notebook? It doesn't for me: I only see it working successfully in the reference manual.



---

archive/issue_comments_155967.json:
```json
{
    "body": "Indeed, I should have said that it works in the typeset manual only.\n\nOn a related note, it sucks that `sage.misc.sagedoc` calls into sagenb stuff to do the sphinxification. IHMO this should be pulled into the Sage library, the notebook can publish a hook for the documentation formatter of choice.",
    "created_at": "2012-06-14T19:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155967",
    "user": "vbraun"
}
```

Indeed, I should have said that it works in the typeset manual only.

On a related note, it sucks that `sage.misc.sagedoc` calls into sagenb stuff to do the sphinxification. IHMO this should be pulled into the Sage library, the notebook can publish a hook for the documentation formatter of choice.



---

archive/issue_comments_155968.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-14T20:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155968",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155969.json:
```json
{
    "body": "Here's a patch which fixes the problem for me, dealt with along the lines of similar issues in sage.misc.sagedoc.",
    "created_at": "2012-06-14T20:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155969",
    "user": "jhpalmieri"
}
```

Here's a patch which fixes the problem for me, dealt with along the lines of similar issues in sage.misc.sagedoc.



---

archive/issue_comments_155970.json:
```json
{
    "body": "My only fear is that this will make a lot of stuff look really long and crazy in the command line, wrapping etc.  What do the examples look like in the command line now?",
    "created_at": "2012-06-15T01:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155970",
    "user": "kcrisman"
}
```

My only fear is that this will make a lot of stuff look really long and crazy in the command line, wrapping etc.  What do the examples look like in the command line now?



---

archive/issue_comments_155971.json:
```json
{
    "body": "Here's a version using the shortened urls discussed [in sage-devel](https://groups.google.com/d/topic/sage-devel/axfWG5mBIKs/discussion).\n\nTyping `sage.misc.sagedoc?` before the patch:\n\n```\n...\n\n    TESTS:\n    \n    Check that argspecs of extension function/methods appear correctly,\n    see >>:trac:`12849`<<:\n```\n\n\nAfter the patch:\n\n```\n...\n\n    TESTS:\n    \n    Check that argspecs of extension function/methods appear correctly,\n    see trac ticket #12849 <http://trac.sagemath.org/12849>:\n```\n\nSo the docstring is longer, so some lines will end up being too long. I personally think that's okay, because of the added information.",
    "created_at": "2012-06-15T14:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155971",
    "user": "jhpalmieri"
}
```

Here's a version using the shortened urls discussed [in sage-devel](https://groups.google.com/d/topic/sage-devel/axfWG5mBIKs/discussion).

Typing `sage.misc.sagedoc?` before the patch:

```
...

    TESTS:
    
    Check that argspecs of extension function/methods appear correctly,
    see >>:trac:`12849`<<:
```


After the patch:

```
...

    TESTS:
    
    Check that argspecs of extension function/methods appear correctly,
    see trac ticket #12849 <http://trac.sagemath.org/12849>:
```

So the docstring is longer, so some lines will end up being too long. I personally think that's okay, because of the added information.



---

archive/issue_comments_155972.json:
```json
{
    "body": "How about just `see http://trac.sagemath.org/12849:`. if you know trac you understand that thats the ticket number, and if you don't know trac then the ticket number doesn't help you any more than the url.\n\nAlso, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.",
    "created_at": "2012-06-15T14:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155972",
    "user": "vbraun"
}
```

How about just `see http://trac.sagemath.org/12849:`. if you know trac you understand that thats the ticket number, and if you don't know trac then the ticket number doesn't help you any more than the url.

Also, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.



---

archive/issue_comments_155973.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> How about just `see http://trac.sagemath.org/12849:`.\n\nSure, that sounds fine.\n\n> Also, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.\n\nOkay, here's a better approach: turn on the \"extlinks\" Sphinx extension when doing introspection. Then in the notebook, docstrings look fine, but from the command line, `see :trac:`12849`` turns into `see trac ticket #12849`: it includes the text, but not the associated url. So I think we should still insert the url, so I still have a version of `process_trac`. This version should also handle any other roles defined in `extlinks`.",
    "created_at": "2012-06-15T18:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155973",
    "user": "jhpalmieri"
}
```

Replying to [comment:8 vbraun]:
> How about just `see http://trac.sagemath.org/12849:`.

Sure, that sounds fine.

> Also, I don't really understand why we are reimplementing sphinx here. Shouldn't we make `sphinxify()` spit out the correct urls instead of this bandaid? The `:wikipedia:` sphinx role would then also work, for example.

Okay, here's a better approach: turn on the "extlinks" Sphinx extension when doing introspection. Then in the notebook, docstrings look fine, but from the command line, `see :trac:`12849`` turns into `see trac ticket #12849`: it includes the text, but not the associated url. So I think we should still insert the url, so I still have a version of `process_trac`. This version should also handle any other roles defined in `extlinks`.



---

archive/issue_comments_155974.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd41\".",
    "created_at": "2012-06-15T23:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155974",
    "user": "jhpalmieri"
}
```

Changing keywords from "" to "sd41".



---

archive/issue_comments_155975.json:
```json
{
    "body": "Looks good. Two tiny nit picks, can we ellipsize the precise Python version (2.7.2) since that is conflicting with #13013 already. Also, the docstring would be perfect with \n\n```\n- ``s`` -- string\n```\n\n(two minus signs before \"string\").",
    "created_at": "2012-06-16T11:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155975",
    "user": "vbraun"
}
```

Looks good. Two tiny nit picks, can we ellipsize the precise Python version (2.7.2) since that is conflicting with #13013 already. Also, the docstring would be perfect with 

```
- ``s`` -- string
```

(two minus signs before "string").



---

archive/issue_comments_155976.json:
```json
{
    "body": "Done.",
    "created_at": "2012-06-16T16:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155976",
    "user": "jhpalmieri"
}
```

Done.



---

archive/issue_comments_155977.json:
```json
{
    "body": "Sage library",
    "created_at": "2012-06-16T16:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155977",
    "user": "jhpalmieri"
}
```

Sage library



---

archive/issue_comments_155978.json:
```json
{
    "body": "Attachment [trac_13116-trac-docstring.patch](tarball://root/attachments/some-uuid/ticket13116/trac_13116-trac-docstring.patch) by vbraun created at 2012-06-16 16:51:23\n\nLooks good!",
    "created_at": "2012-06-16T16:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155978",
    "user": "vbraun"
}
```

Attachment [trac_13116-trac-docstring.patch](tarball://root/attachments/some-uuid/ticket13116/trac_13116-trac-docstring.patch) by vbraun created at 2012-06-16 16:51:23

Looks good!



---

archive/issue_comments_155979.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-16T16:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155979",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_155980.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-23T21:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12944#issuecomment-155980",
    "user": "jdemeyer"
}
```

Resolution: fixed
