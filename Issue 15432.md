# Issue 15432: Errors with graph complement

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2014-01-13 16:18:55

Assignee: tscrim

CC:  ncohen

We can't take the complement of an immutable graph:

```
sage: Gamma = graphs.PathGraph(5).copy(immutable=True)
sage: Gamma.complement()
NotImplementedError
```

which is because `copy(Gamma)` doesn't return a mutable copy.

They are plotting their original graph.

```
sage: G = graphs.PathGraph(5)
sage: G.plot()
sage: GC = G.complement()
sage: GC.plot() # Same as G.plot()
```



---

Comment by ncohen created at 2014-01-13 16:32:02

Hello Travis !

Well, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method. Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout="spring"` to `plot()` to emphasize it.

Nathann


---

Comment by tscrim created at 2014-01-13 16:50:25

Replying to [comment:1 ncohen]:
> Well, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method.

Done and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.

> Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout="spring"` to `plot()` to emphasize it.

Ah, I see. I also understand why you want to keep the same layout as the original graph too.

Thanks,

Travis
----
New commits:


---

Comment by tscrim created at 2014-01-13 16:50:25

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-01-13 16:53:29

Hello !

> Done and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.

O_o

Destroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`

Besides : shouldn't the complement of an immutable graph be immutable ?

There are so many functions that will react oddly to immutable graphs....

> Ah, I see. I also understand why you want to keep the same layout as the original graph too.

Yep. It's just unfortunate for this graph `^^;`

Nathann


---

Comment by tscrim created at 2014-01-13 17:29:51

Replying to [comment:3 ncohen]:
> Destroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`

I agree that it is a bug:

```
sage: G = graphs.PathGraph(5)
sage: G
Path Graph: Graph on 5 vertices
sage: G.copy()
Path Graph: Graph on 5 vertices
sage: G.copy(immutable=True)
Graph on 5 vertices
```


> Besides : shouldn't the complement of an immutable graph be immutable ?

What's the "canonical" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?
 
> There are so many functions that will react oddly to immutable graphs....

We'll just keep fixing them as we come across them I guess.

Best,

Travis


---

Comment by ncohen created at 2014-01-13 17:34:56

Yoooooooo !

> What's the "canonical" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?

Hmmmmmmm.... Well, we have been using `if hasattr(G, '_immutable', False):` several times now, even if I don't like it. But my main reason for not liking it is that the Poset backend have this variable set while they are not immutable, and #15623 will fix it anyway... So perhaps we can do that indeed. Until there is a generic way to test if something is immutable `:-)`

> We'll just keep fixing them as we come across them I guess.

Yepyepyep `:-/`

But the graph products. The unions. The subgraphs. The orientations... pffffff `:-/`

Nathann


---

Comment by ncohen created at 2014-01-14 09:54:48

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2014-01-14 18:35:49

Okay, the names issue is actually something with the graph constructor:

```
sage: P = graphs.PetersenGraph()
sage: P
Petersen graph: Graph on 10 vertices
sage: Graph(P)
Petersen graph: Graph on 10 vertices
sage: Graph(P, immutable=False)
Petersen graph: Graph on 10 vertices
sage: Graph(P, immutable=True)
Graph on 10 vertices
sage: Graph(P, immutable=True, name="Petersen graph") # This is the bad one
Graph on 10 vertices
sage: Graph(_, immutable=False, name="Petersen graph")
Petersen graph: Graph on 10 vertices
```


Nathann, you're likely to know best how to fix that, do you think you could do it?


---

Comment by ncohen created at 2014-01-14 18:38:32

Yoooooooooo !

> Nathann, you're likely to know best how to fix that, do you think you could do it?

Oh sorry, I thought that you would only deal with this `copy()` function (returning an immutable graph when the input was immutable too) and leave this name thing to me. Do you think that this behaviour for `copy()` should not be implemented before this name thing is fixed ?

Nathann


---

Comment by tscrim created at 2014-01-14 20:58:42

The `copy()` not preserving the name is the problem above. This leads to a (somewhat) bad doctest output here. I will be changing `complement()` to return an immutable graph if given an immutable graph.


---

Comment by ncohen created at 2014-01-15 10:28:05

Okay, done in #15681 !

Nathann


---

Comment by git created at 2014-01-15 17:22:58

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tscrim created at 2014-01-15 17:24:14

Okay, immutable graph complements now return immutable graphs with the correct name.


---

Comment by tscrim created at 2014-01-15 17:24:14

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-01-15 17:25:05

I may have mentionned a couple of times that seeing the commits of the ticket's dependencies was a pain. So let's say it another time : it is a pain.

Nathann


---

Comment by ncohen created at 2014-01-15 17:32:25

Okay, good to go !

I set it to positive review and add the dependency with #15681. A request, though : could you add the ticket number to the commit message ? This helps a lot with tickets like that. If all the other commits did not contain the number, there would be no way to know what belong to this ticket easily `Y_Y`

Thaaaaaaaaaanks for this ticket ! `;-)`

Nathann


---

Comment by ncohen created at 2014-01-15 17:32:36

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-01-15 17:52:40

I thought I added the dependency...*shrugs* I'll take the commit message under advisement.  Thank you for doing the review.


---

Comment by git created at 2014-01-16 18:12:15

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-01-16 18:12:15

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by tscrim created at 2014-01-16 18:13:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-01-16 18:14:59

I just realized the ticket number is wrong... whoops `:p`


---

Comment by ncohen created at 2014-01-16 18:18:14

I don't get it `O_o`

Why did you change this hasattr line, and why did you add to the branch ? `O_o`

Nathann


---

Comment by ncohen created at 2014-01-16 18:21:31

Can't we just remove the last 3 commits ? They undo what they do `O_o`

Nathann


---

Comment by tscrim created at 2014-01-17 00:41:44

`hasattr(obj, attr_str)` is the format which only checks if the attribute is there, but we want to actually retrieve the attribute if possible and if not, then return `False` which would be `getattr(obj, attr_str, [default_value])` in the form of `getattr(self, "_immutable", False)`. The second to last is important because the latest of #15681 removed the conflict with `develop`, and the third to last comes along for the ride.


---

Comment by ncohen created at 2014-01-17 08:19:14

`O_o`

Okayokay `O_o`

Nathann


---

Comment by tscrim created at 2014-01-30 15:09:32

Rebased branch.
----
New commits:


---

Comment by vbraun created at 2014-02-01 19:39:11

Resolution: fixed


---

Comment by sage_snail created at 2019-02-22 02:09:37

The trac reference in the doctest added in this ticket had a typo.
See #27338 for a fix.
