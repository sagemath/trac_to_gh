# Issue 15432: Errors with graph complement

archive/issues_015432.json:
```json
{
    "body": "Assignee: @tscrim\n\nCC:  @nathanncohen\n\nWe can't take the complement of an immutable graph:\n\n```\nsage: Gamma = graphs.PathGraph(5).copy(immutable=True)\nsage: Gamma.complement()\nNotImplementedError\n```\nwhich is because `copy(Gamma)` doesn't return a mutable copy.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15669\n\n",
    "closed_at": "2014-02-01T19:39:11Z",
    "created_at": "2014-01-13T16:18:55Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Errors with graph complement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15432",
    "user": "https://github.com/tscrim"
}
```
Assignee: @tscrim

CC:  @nathanncohen

We can't take the complement of an immutable graph:

```
sage: Gamma = graphs.PathGraph(5).copy(immutable=True)
sage: Gamma.complement()
NotImplementedError
```
which is because `copy(Gamma)` doesn't return a mutable copy.


Issue created by migration from https://trac.sagemath.org/ticket/15669





---

archive/issue_comments_198939.json:
```json
{
    "body": "Hello Travis !\n\nWell, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method. Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout=\"spring\"` to `plot()` to emphasize it.\n\nNathann",
    "created_at": "2014-01-13T16:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198939",
    "user": "https://github.com/nathanncohen"
}
```

Hello Travis !

Well, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method. Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout="spring"` to `plot()` to emphasize it.

Nathann



---

archive/issue_comments_198940.json:
```json
{
    "body": "Replying to [comment:1 ncohen]:\n> Well, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method.\n\n\nDone and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.\n\n> Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout=\"spring\"` to `plot()` to emphasize it.\n\n\nAh, I see. I also understand why you want to keep the same layout as the original graph too.\n\nThanks,\n\nTravis\n\n---\nNew commits:",
    "created_at": "2014-01-13T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198940",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:1 ncohen]:
> Well, I guess you can fix this one yourself ! You should just add a `immutable=True` to the call of `copy` in this method.


Done and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.

> Besides, your second example of code is not really a bug. `GC` is what it should be, but if you plot the complement of a graph with the same layout as for the original graph, it so happens that the edges are all horizontal too. You can add a `layout="spring"` to `plot()` to emphasize it.


Ah, I see. I also understand why you want to keep the same layout as the original graph too.

Thanks,

Travis

---
New commits:



---

archive/issue_comments_198941.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-13T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198941",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_198942.json:
```json
{
    "body": "Hello !\n\n> Done and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.\n\n\nO_o\n\nDestroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`\n\nBesides : shouldn't the complement of an immutable graph be immutable ?\n\nThere are so many functions that will react oddly to immutable graphs....\n\n> Ah, I see. I also understand why you want to keep the same layout as the original graph too.\n\n\nYep. It's just unfortunate for this graph `^^;`\n\nNathann",
    "created_at": "2014-01-13T16:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198942",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

> Done and NR. Although making an immutable copy destroys the name of the graph, so a slightly different question is do we want that behavior.


O_o

Destroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`

Besides : shouldn't the complement of an immutable graph be immutable ?

There are so many functions that will react oddly to immutable graphs....

> Ah, I see. I also understand why you want to keep the same layout as the original graph too.


Yep. It's just unfortunate for this graph `^^;`

Nathann



---

archive/issue_comments_198943.json:
```json
{
    "body": "Replying to [comment:3 ncohen]:\n> Destroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`\n\n\nI agree that it is a bug:\n\n```\nsage: G = graphs.PathGraph(5)\nsage: G\nPath Graph: Graph on 5 vertices\nsage: G.copy()\nPath Graph: Graph on 5 vertices\nsage: G.copy(immutable=True)\nGraph on 5 vertices\n```\n\n> Besides : shouldn't the complement of an immutable graph be immutable ?\n\n\nWhat's the \"canonical\" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?\n \n> There are so many functions that will react oddly to immutable graphs....\n\n\nWe'll just keep fixing them as we come across them I guess.\n\nBest,\n\nTravis",
    "created_at": "2014-01-13T17:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198943",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:3 ncohen]:
> Destroys the name of the graph ? Why ? Well if it does I guess it's a bug, isn't it ? `O_o`


I agree that it is a bug:

```
sage: G = graphs.PathGraph(5)
sage: G
Path Graph: Graph on 5 vertices
sage: G.copy()
Path Graph: Graph on 5 vertices
sage: G.copy(immutable=True)
Graph on 5 vertices
```

> Besides : shouldn't the complement of an immutable graph be immutable ?


What's the "canonical" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?
 
> There are so many functions that will react oddly to immutable graphs....


We'll just keep fixing them as we come across them I guess.

Best,

Travis



---

archive/issue_comments_198944.json:
```json
{
    "body": "Yoooooooo !\n\n> What's the \"canonical\" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?\n\n\nHmmmmmmm.... Well, we have been using `if hasattr(G, '_immutable', False):` several times now, even if I don't like it. But my main reason for not liking it is that the Poset backend have this variable set while they are not immutable, and #15623 will fix it anyway... So perhaps we can do that indeed. Until there is a generic way to test if something is immutable `:-)`\n\n> We'll just keep fixing them as we come across them I guess.\n\n\nYepyepyep `:-/`\n\nBut the graph products. The unions. The subgraphs. The orientations... pffffff `:-/`\n\nNathann",
    "created_at": "2014-01-13T17:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198944",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooooo !

> What's the "canonical" way to check if a graph `G` is immutable? `hasattr(G, '_immutable') and G._immutable`?


Hmmmmmmm.... Well, we have been using `if hasattr(G, '_immutable', False):` several times now, even if I don't like it. But my main reason for not liking it is that the Poset backend have this variable set while they are not immutable, and #15623 will fix it anyway... So perhaps we can do that indeed. Until there is a generic way to test if something is immutable `:-)`

> We'll just keep fixing them as we come across them I guess.


Yepyepyep `:-/`

But the graph products. The unions. The subgraphs. The orientations... pffffff `:-/`

Nathann



---

archive/issue_comments_198945.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-14T09:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198945",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_198946.json:
```json
{
    "body": "Okay, the names issue is actually something with the graph constructor:\n\n```\nsage: P = graphs.PetersenGraph()\nsage: P\nPetersen graph: Graph on 10 vertices\nsage: Graph(P)\nPetersen graph: Graph on 10 vertices\nsage: Graph(P, immutable=False)\nPetersen graph: Graph on 10 vertices\nsage: Graph(P, immutable=True)\nGraph on 10 vertices\nsage: Graph(P, immutable=True, name=\"Petersen graph\") # This is the bad one\nGraph on 10 vertices\nsage: Graph(_, immutable=False, name=\"Petersen graph\")\nPetersen graph: Graph on 10 vertices\n```\n\nNathann, you're likely to know best how to fix that, do you think you could do it?",
    "created_at": "2014-01-14T18:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198946",
    "user": "https://github.com/tscrim"
}
```

Okay, the names issue is actually something with the graph constructor:

```
sage: P = graphs.PetersenGraph()
sage: P
Petersen graph: Graph on 10 vertices
sage: Graph(P)
Petersen graph: Graph on 10 vertices
sage: Graph(P, immutable=False)
Petersen graph: Graph on 10 vertices
sage: Graph(P, immutable=True)
Graph on 10 vertices
sage: Graph(P, immutable=True, name="Petersen graph") # This is the bad one
Graph on 10 vertices
sage: Graph(_, immutable=False, name="Petersen graph")
Petersen graph: Graph on 10 vertices
```

Nathann, you're likely to know best how to fix that, do you think you could do it?



---

archive/issue_comments_198947.json:
```json
{
    "body": "Yoooooooooo !\n\n> Nathann, you're likely to know best how to fix that, do you think you could do it?\n\n\nOh sorry, I thought that you would only deal with this `copy()` function (returning an immutable graph when the input was immutable too) and leave this name thing to me. Do you think that this behaviour for `copy()` should not be implemented before this name thing is fixed ?\n\nNathann",
    "created_at": "2014-01-14T18:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198947",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooooooo !

> Nathann, you're likely to know best how to fix that, do you think you could do it?


Oh sorry, I thought that you would only deal with this `copy()` function (returning an immutable graph when the input was immutable too) and leave this name thing to me. Do you think that this behaviour for `copy()` should not be implemented before this name thing is fixed ?

Nathann



---

archive/issue_comments_198948.json:
```json
{
    "body": "The `copy()` not preserving the name is the problem above. This leads to a (somewhat) bad doctest output here. I will be changing `complement()` to return an immutable graph if given an immutable graph.",
    "created_at": "2014-01-14T20:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198948",
    "user": "https://github.com/tscrim"
}
```

The `copy()` not preserving the name is the problem above. This leads to a (somewhat) bad doctest output here. I will be changing `complement()` to return an immutable graph if given an immutable graph.



---

archive/issue_comments_198949.json:
```json
{
    "body": "Okay, done in #15681 !\n\nNathann",
    "created_at": "2014-01-15T10:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198949",
    "user": "https://github.com/nathanncohen"
}
```

Okay, done in #15681 !

Nathann



---

archive/issue_comments_198950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-01-15T17:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_198951.json:
```json
{
    "body": "Okay, immutable graph complements now return immutable graphs with the correct name.",
    "created_at": "2014-01-15T17:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198951",
    "user": "https://github.com/tscrim"
}
```

Okay, immutable graph complements now return immutable graphs with the correct name.



---

archive/issue_comments_198952.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-15T17:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198952",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_198953.json:
```json
{
    "body": "I may have mentionned a couple of times that seeing the commits of the ticket's dependencies was a pain. So let's say it another time : it is a pain.\n\nNathann",
    "created_at": "2014-01-15T17:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198953",
    "user": "https://github.com/nathanncohen"
}
```

I may have mentionned a couple of times that seeing the commits of the ticket's dependencies was a pain. So let's say it another time : it is a pain.

Nathann



---

archive/issue_comments_198954.json:
```json
{
    "body": "Okay, good to go !\n\nI set it to positive review and add the dependency with #15681. A request, though : could you add the ticket number to the commit message ? This helps a lot with tickets like that. If all the other commits did not contain the number, there would be no way to know what belong to this ticket easily `Y_Y`\n\nThaaaaaaaaaanks for this ticket ! `;-)`\n\nNathann",
    "created_at": "2014-01-15T17:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198954",
    "user": "https://github.com/nathanncohen"
}
```

Okay, good to go !

I set it to positive review and add the dependency with #15681. A request, though : could you add the ticket number to the commit message ? This helps a lot with tickets like that. If all the other commits did not contain the number, there would be no way to know what belong to this ticket easily `Y_Y`

Thaaaaaaaaaanks for this ticket ! `;-)`

Nathann



---

archive/issue_comments_198955.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-15T17:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198955",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_198956.json:
```json
{
    "body": "I thought I added the dependency...*shrugs* I'll take the commit message under advisement.  Thank you for doing the review.",
    "created_at": "2014-01-15T17:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198956",
    "user": "https://github.com/tscrim"
}
```

I thought I added the dependency...*shrugs* I'll take the commit message under advisement.  Thank you for doing the review.



---

archive/issue_comments_198957.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-01-16T18:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_198958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-01-16T18:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_198959.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-16T18:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198959",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_198960.json:
```json
{
    "body": "I just realized the ticket number is wrong... whoops `:p`",
    "created_at": "2014-01-16T18:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198960",
    "user": "https://github.com/tscrim"
}
```

I just realized the ticket number is wrong... whoops `:p`



---

archive/issue_comments_198961.json:
```json
{
    "body": "I don't get it `O_o`\n\nWhy did you change this hasattr line, and why did you add to the branch ? `O_o`\n\nNathann",
    "created_at": "2014-01-16T18:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198961",
    "user": "https://github.com/nathanncohen"
}
```

I don't get it `O_o`

Why did you change this hasattr line, and why did you add to the branch ? `O_o`

Nathann



---

archive/issue_comments_198962.json:
```json
{
    "body": "Can't we just remove the last 3 commits ? They undo what they do `O_o`\n\nNathann",
    "created_at": "2014-01-16T18:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198962",
    "user": "https://github.com/nathanncohen"
}
```

Can't we just remove the last 3 commits ? They undo what they do `O_o`

Nathann



---

archive/issue_comments_198963.json:
```json
{
    "body": "`hasattr(obj, attr_str)` is the format which only checks if the attribute is there, but we want to actually retrieve the attribute if possible and if not, then return `False` which would be `getattr(obj, attr_str, [default_value])` in the form of `getattr(self, \"_immutable\", False)`. The second to last is important because the latest of #15681 removed the conflict with `develop`, and the third to last comes along for the ride.",
    "created_at": "2014-01-17T00:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198963",
    "user": "https://github.com/tscrim"
}
```

`hasattr(obj, attr_str)` is the format which only checks if the attribute is there, but we want to actually retrieve the attribute if possible and if not, then return `False` which would be `getattr(obj, attr_str, [default_value])` in the form of `getattr(self, "_immutable", False)`. The second to last is important because the latest of #15681 removed the conflict with `develop`, and the third to last comes along for the ride.



---

archive/issue_comments_198964.json:
```json
{
    "body": "`O_o`\n\nOkayokay `O_o`\n\nNathann",
    "created_at": "2014-01-17T08:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198964",
    "user": "https://github.com/nathanncohen"
}
```

`O_o`

Okayokay `O_o`

Nathann



---

archive/issue_comments_198965.json:
```json
{
    "body": "Rebased branch.\n\n---\nNew commits:",
    "created_at": "2014-01-30T15:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198965",
    "user": "https://github.com/tscrim"
}
```

Rebased branch.

---
New commits:



---

archive/issue_events_045948.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15432#event-45948"
}
```



---

archive/issue_events_045949.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-01T19:39:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15432#event-45949"
}
```



---

archive/issue_comments_198966.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-01T19:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198966",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_198967.json:
```json
{
    "body": "The trac reference in the doctest added in this ticket had a typo.\nSee #27338 for a fix.",
    "created_at": "2019-02-22T02:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15432#issuecomment-198967",
    "user": "https://trac.sagemath.org/admin/accounts/users/sage_snail"
}
```

The trac reference in the doctest added in this ticket had a typo.
See #27338 for a fix.
