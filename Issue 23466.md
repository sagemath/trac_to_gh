# Issue 23466: Homorphism of finitely generated module over PIDs not working

Issue created by migration from https://trac.sagemath.org/ticket/23703

Original creator: sbrandhorst

Original creation time: 2017-08-24 17:53:18

Keywords: abelian group, quotient, homomorphism

The following should work, but it does not.

```
sage: A=FreeModule(ZZ,1)
sage: a=A.gen()
sage: B=A.span([a/2])
sage: C=A.span([a])
sage: B/C
Finitely generated module V/W over Integer Ring with invariants (2)
sage: (B/C).Hom(B/C)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

....

/sage/local/lib/python2.7/site-packages/sage/modules/fg_pid/fgp_morphism.pyc in __init__(self, parent, phi, check)
    115             for x in MO.W().basis():
    116                 if phi(x) not in N.W():
--> 117                     raise ValueError("phi must send optimized submodule of M.W() into N.W()")
    118         self._phi = phi
    119 

ValueError: phi must send optimized submodule of M.W() into N.W()
```



---

Comment by sbrandhorst created at 2017-08-24 17:55:33

Changing keywords from "abelian group, quotient, homomorphism" to "sd91".


---

Comment by sbrandhorst created at 2017-08-24 22:03:13

The story continues ... maybe this is the real bug?

```
sage: A=FreeQuadraticModule(ZZ,1,matrix.identity(1))
sage: B=A.span([[1]])
sage: B==B.ambient_vector_space()
True
sage: B=A.span([[1/2]])
sage: B==B.ambient_vector_space()
False
```



---

Comment by chapoton created at 2017-08-25 08:37:05

beware of #23646


---

Comment by sbrandhorst created at 2017-09-19 20:03:24

New commits:


---

Comment by sbrandhorst created at 2017-09-19 20:03:24

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-09-20 06:17:46

You should keep all the doctests somewhere.


---

Comment by sbrandhorst created at 2017-09-20 06:53:02

I just checked: the old doctests did not even call the __richcmp__ methods defined.
So I will modify them old doctests.

Btw in any case (old&new) we get:

```
sage: FreeQuadraticModule(ZZ,1,matrix.identity(1))==FreeQuadraticModule(ZZ,1,matrix.identity(1)*2)
True
```

Is that a bug or a feature? I would consider two quadratic spaces with different inner products
very different and mathematically not equal. After all the inner product is the whole point of this class.


---

Comment by git created at 2017-09-20 08:11:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-09-20 11:20:49

wrong syntax for the new doc.. 

when a line end with ::, it must be followd by an empty line. And the next lines must be indented by 4 spaces.


---

Comment by git created at 2017-09-20 13:06:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-09-20 15:36:12

not fixed :

```
+    EXAMPLES::
+
+    We compare rank three free modules over the integers and
+    rationals::
+        sage: Q3 = FreeQuadraticModule(QQ,3,matrix.identity(3)) 
```



---

Comment by git created at 2017-09-20 18:40:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-20 18:50:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-20 19:11:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-09-20 19:12:35

Doctests pass and the html documentation builds (at least the free_quadratic_module part).


---

Comment by chapoton created at 2017-09-21 07:25:44

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-09-21 07:25:44

ok then.


---

Comment by vbraun created at 2017-09-22 20:26:37

Resolution: fixed
