# Issue 21109: Faster meet() for lattice

archive/issues_020872.json:
```json
{
    "body": "This trivial patch will speed up computation of meet matrix in lattices. Before:\n\n```\nsage: P = Posets.BooleanLattice(10)\nsage: timeit(\"_ = P._hasse_diagram._meet\", repeat=1, number=1)\n1 loops, best of 1: 2.24 s per loop\n```\n\nAfter:\n\n```\nsage: P = Posets.BooleanLattice(10)\nsage: timeit(\"_ = P._hasse_diagram._meet\", repeat=1, number=1)\n1 loops, best of 1: 917 ms per loop\n```\n\nAnd for small lattices:\n\n```\nsage: P10 = [P.with_bounds() for P in Posets(8)]\nsage: timeit(\"len([P for P in P10 if P.is_meet_semilattice()])\", repeat=1, number=1)\n```\n\nWithout this patch it took 5.46 seconds, after the patch 1.54 seconds.\n\n**CC:**  @fchapoton\n\n**Keywords:** lattice poset\n\n**Branch/Commit:** [965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Jori M\u00e4ntysalo\n\nIssue created by migration from https://trac.sagemath.org/ticket/21109\n\n",
    "closed_at": "2016-08-10T22:27:17Z",
    "created_at": "2016-07-28T08:06:16Z",
    "labels": [
        "component: combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Faster meet() for lattice",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21109",
    "user": "https://github.com/jm58660"
}
```
This trivial patch will speed up computation of meet matrix in lattices. Before:

```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 2.24 s per loop
```

After:

```
sage: P = Posets.BooleanLattice(10)
sage: timeit("_ = P._hasse_diagram._meet", repeat=1, number=1)
1 loops, best of 1: 917 ms per loop
```

And for small lattices:

```
sage: P10 = [P.with_bounds() for P in Posets(8)]
sage: timeit("len([P for P in P10 if P.is_meet_semilattice()])", repeat=1, number=1)
```

Without this patch it took 5.46 seconds, after the patch 1.54 seconds.

**CC:**  @fchapoton

**Keywords:** lattice poset

**Branch/Commit:** [965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)

**Reviewer:** Frédéric Chapoton

**Author:** Jori Mäntysalo

Issue created by migration from https://trac.sagemath.org/ticket/21109





---

archive/issue_comments_311602.json:
```json
{
    "body": "**Branch:** [u/jmantysalo/faster-meet](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster-meet)",
    "created_at": "2016-07-28T08:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311602",
    "user": "https://github.com/jm58660"
}
```

**Branch:** [u/jmantysalo/faster-meet](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster-meet)



---

archive/issue_events_192744.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-28T08:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192744"
}
```



---

archive/issue_comments_311603.json:
```json
{
    "body": "**Commit:** [b679b3ddc7f7e1552a098ee5b231d5e3eeff4249](https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249)",
    "created_at": "2016-07-28T08:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311603",
    "user": "https://github.com/jm58660"
}
```

**Commit:** [b679b3ddc7f7e1552a098ee5b231d5e3eeff4249](https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249)



---

archive/issue_comments_311604.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249\">b679b3d</a></td><td><code>Trivial speedup for meet().</code></td></tr></table>\n",
    "created_at": "2016-07-28T08:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311604",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249">b679b3d</a></td><td><code>Trivial speedup for meet().</code></td></tr></table>




---

archive/issue_comments_311605.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have some questions:\n\nI do not understand the comment `# T = {x_i \\wedge z : z>-x_k`}\nWhat is the meaning of `>-` ?\n\nDoes lc stands for \"lower covers\" ? if yes, that would be worth to say in a comment\n\nCould you take the opportunity to make the method fully pep8 compliant ? only the line\n\n```\nraise ValueError(\"No meet for x=%s y=%s\"%(x,y))\n```\nmust be changed to\n\n```\nraise ValueError(\"No meet for x=%s y=%s\" % (x, y))\n```",
    "created_at": "2016-07-28T16:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311605",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
I have some questions:

I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
What is the meaning of `>-` ?

Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment

Could you take the opportunity to make the method fully pep8 compliant ? only the line

```
raise ValueError("No meet for x=%s y=%s"%(x,y))
```
must be changed to

```
raise ValueError("No meet for x=%s y=%s" % (x, y))
```



---

archive/issue_comments_311606.json:
```json
{
    "body": "<a id='comment:4'></a>\nHave you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?",
    "created_at": "2016-07-28T19:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311606",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?



---

archive/issue_comments_311607.json:
```json
{
    "body": "**Changing keywords** from \"latticeposet\" to \"lattice poset\".",
    "created_at": "2016-07-29T01:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311607",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "latticeposet" to "lattice poset".



---

archive/issue_comments_311608.json:
```json
{
    "body": "<a id='comment:5'></a>\nIf you haven't, just let me know, and I can run the tests.",
    "created_at": "2016-07-29T01:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311608",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
If you haven't, just let me know, and I can run the tests.



---

archive/issue_comments_311609.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,4 +14,11 @@\n 1 loops, best of 1: 917 ms per loop\n ```\n \n+And for small lattices:\n \n+```\n+sage: P10 = [P.with_bounds() for P in Posets(8)]\n+sage: timeit(\"len([P for P in P10 if P.is_meet_semilattice()])\", repeat=1, number=1)\n+```\n+\n+Without this patch it took 5.46 seconds, after the patch 1.54 seconds.\n``````\n",
    "created_at": "2016-07-29T05:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311609",
    "user": "https://github.com/jm58660"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,4 +14,11 @@
 1 loops, best of 1: 917 ms per loop
 ```
 
+And for small lattices:
 
+```
+sage: P10 = [P.with_bounds() for P in Posets(8)]
+sage: timeit("len([P for P in P10 if P.is_meet_semilattice()])", repeat=1, number=1)
+```
+
+Without this patch it took 5.46 seconds, after the patch 1.54 seconds.
``````




---

archive/issue_events_192745.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T05:36:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192745"
}
```



---

archive/issue_events_192746.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T05:36:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192746"
}
```



---

archive/issue_comments_311610.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A4):\n> Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?\n\n\nIt is very hard to think an example where my code would be slower. This references to a python dict, whereas current code references to a matrix; referencing to matrix elements in a loop is slow. And that matrix must be precomputed first. You can test what happens if you compute le-matrix first (assuming that the user has, say, computed M\u00f6bius function matrix), but there will still be speedup.\n\nI added another example to description.",
    "created_at": "2016-07-29T05:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311610",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A4):
> Have you run tests on smaller and larger lattices? Does the about 2x speedup still hold in those cases?


It is very hard to think an example where my code would be slower. This references to a python dict, whereas current code references to a matrix; referencing to matrix elements in a loop is slow. And that matrix must be precomputed first. You can test what happens if you compute le-matrix first (assuming that the user has, say, computed Möbius function matrix), but there will still be speedup.

I added another example to description.



---

archive/issue_comments_311611.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662\">965b8ab</a></td><td><code>Reviewer's comments.</code></td></tr></table>\n",
    "created_at": "2016-07-29T05:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662">965b8ab</a></td><td><code>Reviewer's comments.</code></td></tr></table>




---

archive/issue_comments_311612.json:
```json
{
    "body": "**Changing commit** from \"[b679b3ddc7f7e1552a098ee5b231d5e3eeff4249](https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249)\" to \"[965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)\".",
    "created_at": "2016-07-29T05:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b679b3ddc7f7e1552a098ee5b231d5e3eeff4249](https://github.com/sagemath/sagetrac-mirror/commit/b679b3ddc7f7e1552a098ee5b231d5e3eeff4249)" to "[965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)".



---

archive/issue_comments_311613.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [chapoton](#comment%3A3):\n\n> Could you take the opportunity to make the method fully pep8 compliant ? only the line\n> \n> ```\n> raise ValueError(\"No meet for x=%s y=%s\"%(x,y))\n> ```\n> must be changed to\n> \n> ```\n> raise ValueError(\"No meet for x=%s y=%s\" % (x, y))\n> ```\n\n\nChanged. Then there is the error message formatting question... Python exceptions start with lowercase and do not end to a period. But this has been discussed in sage-devel without clear conclusion.\n\n> I do not understand the comment `# T = {x_i \\wedge z : z>-x_k`}\n> What is the meaning of `>-` ?\n\n\nI guess it has meant covering. I removed it.\n\n> Does lc stands for \"lower covers\" ? if yes, that would be worth to say in a comment\n\n\nDone.",
    "created_at": "2016-07-29T05:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311613",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>
Replying to [chapoton](#comment%3A3):

> Could you take the opportunity to make the method fully pep8 compliant ? only the line
> 
> ```
> raise ValueError("No meet for x=%s y=%s"%(x,y))
> ```
> must be changed to
> 
> ```
> raise ValueError("No meet for x=%s y=%s" % (x, y))
> ```


Changed. Then there is the error message formatting question... Python exceptions start with lowercase and do not end to a period. But this has been discussed in sage-devel without clear conclusion.

> I do not understand the comment `# T = {x_i \wedge z : z>-x_k`}
> What is the meaning of `>-` ?


I guess it has meant covering. I removed it.

> Does lc stands for "lower covers" ? if yes, that would be worth to say in a comment


Done.



---

archive/issue_events_192747.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T05:51:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192747"
}
```



---

archive/issue_events_192748.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T05:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192748"
}
```



---

archive/issue_events_192749.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T08:05:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192749"
}
```



---

archive/issue_events_192750.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-07-29T08:05:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192750"
}
```



---

archive/issue_comments_311614.json:
```json
{
    "body": "<a id='comment:10'></a>\nrc0 is out.",
    "created_at": "2016-07-29T08:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311614",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:10'></a>
rc0 is out.



---

archive/issue_events_192751.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T18:15:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192751"
}
```



---

archive/issue_events_192752.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T18:15:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192752"
}
```



---

archive/issue_comments_311615.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2016-07-29T18:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311615",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_311616.json:
```json
{
    "body": "<a id='comment:11'></a>\nok, looks good enough. Thanks",
    "created_at": "2016-07-29T18:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311616",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
ok, looks good enough. Thanks



---

archive/issue_comments_311617.json:
```json
{
    "body": "**Changing branch** from \"[u/jmantysalo/faster-meet](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster-meet)\" to \"[965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)\".",
    "created_at": "2016-08-10T22:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21109#issuecomment-311617",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jmantysalo/faster-meet](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/faster-meet)" to "[965b8ab193baca00cfd8af7b7d9ac17db5060662](https://github.com/sagemath/sagetrac-mirror/commit/965b8ab193baca00cfd8af7b7d9ac17db5060662)".



---

archive/issue_events_192753.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-10T22:27:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192753"
}
```



---

archive/issue_events_192754.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-10T22:27:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21109",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21109#event-192754"
}
```
