# Issue 21892: Memory leak in BooleanPolynomialRing

archive/issues_021655.json:
```json
{
    "assignees": [],
    "body": "From https://ask.sagemath.org/question/35623/memory-leak-when-doing-anf-of-boolean-functions/ :\n\n```\nsage: import gc\n....: BPR=sage.rings.polynomial.pbori.BooleanPolynomialRing\n....: print \"PBR objects:\",len([a for a in gc.get_objects() if type(a) is BPR])\n....: for i in range(1,51):\n....:   B=BooleanPolynomialRing(i,\"x\")\n....: del B\n....: _=gc.collect()\n....: print \"PBR objects:\",len([a for a in gc.get_objects() if type(a) is BPR])\nPBR objects: 0\nPBR objects: 50\n```\nThese objects leak.\n\nCC:  @simon-king-jena @jpflori @pfasante\n\nKeywords: **memory leak, BooleanFunction, days94**\n\nBranch/Commit: **[u/asante/memory_leak_in_booleanpolynomialring](https://github.com/sagemath/sagetrac-mirror/tree/u/asante/memory_leak_in_booleanpolynomialring) @ [16350a4](https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21892_\n\n",
    "created_at": "2016-11-17T23:06:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20memleak",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Memory leak in BooleanPolynomialRing",
    "type": "issue",
    "updated_at": "2022-12-29T01:42:26Z",
    "url": "https://github.com/sagemath/sage/issues/21892",
    "user": "https://github.com/nbruin"
}
```
From https://ask.sagemath.org/question/35623/memory-leak-when-doing-anf-of-boolean-functions/ :

```
sage: import gc
....: BPR=sage.rings.polynomial.pbori.BooleanPolynomialRing
....: print "PBR objects:",len([a for a in gc.get_objects() if type(a) is BPR])
....: for i in range(1,51):
....:   B=BooleanPolynomialRing(i,"x")
....: del B
....: _=gc.collect()
....: print "PBR objects:",len([a for a in gc.get_objects() if type(a) is BPR])
PBR objects: 0
PBR objects: 50
```
These objects leak.

CC:  @simon-king-jena @jpflori @pfasante

Keywords: **memory leak, BooleanFunction, days94**

Branch/Commit: **[u/asante/memory_leak_in_booleanpolynomialring](https://github.com/sagemath/sagetrac-mirror/tree/u/asante/memory_leak_in_booleanpolynomialring) @ [16350a4](https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f)**

_Issue created by migration from https://trac.sagemath.org/ticket/21892_





---

archive/issue_events_289035.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-17T23:06:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289035"
}
```



---

archive/issue_events_289036.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-17T23:06:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289036"
}
```



---

archive/issue_comments_325254.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThe problem is that upon creation:\n\n```\n    B=BooleanPolynomialRing(3,\"x\")\n```\nthe code\n\n```\n    self._monom_monoid = BooleanMonomialMonoid(self)\n```\nis executed. A `BooleanMonomialMonoid` is `UniqueRepresentation`, so `B` goes as a key into a global `WeakValueDictionary`, with value the monoid `M`. So `B` will not be garbage collected while `M` exists (the strong reference in the global dict will only be erased on the weakvalue callback upon M's deallocation)\n\nBut `B` stores a reference to `M` in `B._nomom_monoid`, so `M` will not be deallocated until `B` is deallocated. Hence, the memory leak.\n\nPossible strategies:\n- Remove `UniqueRepresentation` from `BooleanMonomialMonoid`. I don't think there are any drawback from this solution.\n- remove the strong reference `B._nomom_monoid` and instead rely on the `UniqueRepresention` property to reconstruct the thing every time. I suspect this will slow things down.\n- change the construction parameters of `BooleanMonomialMonoid` to be just strings etc. and not refer to `B` at all. This is easy to get wrong.\n\nBy the way, the code from the asksage question referred to unovers the following additional bug, which made the memory leak noticeable.\n\n`sage.rings.polynomial.pbori.BooleanPolynomialRing` is not `UniqueRepresentation` and instead relies on `sage.rings.polynomial.polynomial_ring_constructor.BooleanPolynomialRing_constructor` to get uniqueness. \n\nIn \n`sage.crypto.boolean_function.BooleanFunction.algebraic_normal_form`\nthe class is called directly, so we end up with many equal-but-not-identical rings (which is not a problem in its own right)",
    "created_at": "2016-11-17T23:24:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325254",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:1" align="right">Comment 1</div>

The problem is that upon creation:

```
    B=BooleanPolynomialRing(3,"x")
```
the code

```
    self._monom_monoid = BooleanMonomialMonoid(self)
```
is executed. A `BooleanMonomialMonoid` is `UniqueRepresentation`, so `B` goes as a key into a global `WeakValueDictionary`, with value the monoid `M`. So `B` will not be garbage collected while `M` exists (the strong reference in the global dict will only be erased on the weakvalue callback upon M's deallocation)

But `B` stores a reference to `M` in `B._nomom_monoid`, so `M` will not be deallocated until `B` is deallocated. Hence, the memory leak.

Possible strategies:
- Remove `UniqueRepresentation` from `BooleanMonomialMonoid`. I don't think there are any drawback from this solution.
- remove the strong reference `B._nomom_monoid` and instead rely on the `UniqueRepresention` property to reconstruct the thing every time. I suspect this will slow things down.
- change the construction parameters of `BooleanMonomialMonoid` to be just strings etc. and not refer to `B` at all. This is easy to get wrong.

By the way, the code from the asksage question referred to unovers the following additional bug, which made the memory leak noticeable.

`sage.rings.polynomial.pbori.BooleanPolynomialRing` is not `UniqueRepresentation` and instead relies on `sage.rings.polynomial.polynomial_ring_constructor.BooleanPolynomialRing_constructor` to get uniqueness. 

In 
`sage.crypto.boolean_function.BooleanFunction.algebraic_normal_form`
the class is called directly, so we end up with many equal-but-not-identical rings (which is not a problem in its own right)



---

archive/issue_events_289037.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-18T03:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289037"
}
```



---

archive/issue_comments_325255.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAs it turns out, the `UniqueRepresentation` was introduced to solve a pickling problem:\n\n[#9138 comment:46](https://github.com/sagemath/sage/issues/9138#comment:46)\n\nIt seems that removing the `UniqueRepresentation` only makes the pickling problems reappear, so if we can find a different solution for the pickling problem we might be good to go.\n\nCC-ing the author of #9138, Simon. Perhaps he remembers an alternative.",
    "created_at": "2016-11-18T03:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325255",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:2" align="right">Comment 2</div>

As it turns out, the `UniqueRepresentation` was introduced to solve a pickling problem:

[#9138 comment:46](https://github.com/sagemath/sage/issues/9138#comment:46)

It seems that removing the `UniqueRepresentation` only makes the pickling problems reappear, so if we can find a different solution for the pickling problem we might be good to go.

CC-ing the author of #9138, Simon. Perhaps he remembers an alternative.



---

archive/issue_events_289038.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-18T03:58:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20memleak",
    "label_color": "000080",
    "label_name": "component: memleak",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289038"
}
```



---

archive/issue_comments_325256.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nSo if we remove the `UniqueRepresentation` behavior from the `BooleanMonomialMonoid`, we would probably have to manually implement some form of pickling.\n\nActually, from a quick glance through the code, I don't see a point to having `BooleanMonomialMonoid`, we are not really using that it is a parent. We essentially just need the element class and we can mimic what we do for usual polynomials, have `monomials()` return elements in the polynomial ring. It's more work to fix, but I think the net result will be much cleaner and simpler code. It shouldn't result in a slowdown unless you are using `monomials` or iterating over polynomials, and even then, it shouldn't have a noticeable effect...",
    "created_at": "2016-11-18T15:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325256",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">Comment 3</div>

So if we remove the `UniqueRepresentation` behavior from the `BooleanMonomialMonoid`, we would probably have to manually implement some form of pickling.

Actually, from a quick glance through the code, I don't see a point to having `BooleanMonomialMonoid`, we are not really using that it is a parent. We essentially just need the element class and we can mimic what we do for usual polynomials, have `monomials()` return elements in the polynomial ring. It's more work to fix, but I think the net result will be much cleaner and simpler code. It shouldn't result in a slowdown unless you are using `monomials` or iterating over polynomials, and even then, it shouldn't have a noticeable effect...



---

archive/issue_events_289039.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:20:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289039"
}
```



---

archive/issue_comments_325257.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nDupe of #14549 ?\n\nPerhaps we should just merge the branch there and leave this ticket.",
    "created_at": "2017-05-17T13:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325257",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:5" align="right">Comment 5</div>

Dupe of #14549 ?

Perhaps we should just merge the branch there and leave this ticket.



---

archive/issue_events_289040.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:20:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289040"
}
```



---

archive/issue_events_289041.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:20:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289041"
}
```



---

archive/issue_events_289042.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:20:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289042"
}
```



---

archive/issue_events_289043.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:24:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289043"
}
```



---

archive/issue_events_289044.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:24:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289044"
}
```



---

archive/issue_events_289045.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2017-05-17T13:24:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289045"
}
```



---

archive/issue_comments_325258.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n+1 for merging that #14549 branch and leaving this ticket for the \"real\" fix.",
    "created_at": "2017-05-17T13:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325258",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:7" align="right">Comment 7</div>

+1 for merging that #14549 branch and leaving this ticket for the "real" fix.



---

archive/issue_comments_325259.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nSo just to make this clear:\n\nThe favorable solution is what tcsrim above writes:\nRemove `BooleanMonomialMonoid` and replace it with the default behavior of other Polynomial classes?",
    "created_at": "2018-02-16T11:17:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325259",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:8" align="right">Comment 8</div>

So just to make this clear:

The favorable solution is what tcsrim above writes:
Remove `BooleanMonomialMonoid` and replace it with the default behavior of other Polynomial classes?



---

archive/issue_events_289046.json:
```json
{
    "actor": "https://github.com/pfasante",
    "created_at": "2018-02-16T11:17:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289046"
}
```



---

archive/issue_events_289047.json:
```json
{
    "actor": "https://github.com/pfasante",
    "created_at": "2018-02-16T11:17:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289047"
}
```



---

archive/issue_comments_325260.json:
```json
{
    "body": "Branch: **[u/asante/memory_leak_in_booleanpolynomialring](https://github.com/sagemath/sagetrac-mirror/tree/u/asante/memory_leak_in_booleanpolynomialring)**",
    "created_at": "2018-06-29T08:54:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325260",
    "user": "https://github.com/pfasante"
}
```

Branch: **[u/asante/memory_leak_in_booleanpolynomialring](https://github.com/sagemath/sagetrac-mirror/tree/u/asante/memory_leak_in_booleanpolynomialring)**



---

archive/issue_comments_325261.json:
```json
{
    "body": "Author: **Friedrich Wiemer**",
    "created_at": "2018-06-29T08:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325261",
    "user": "https://github.com/pfasante"
}
```

Author: **Friedrich Wiemer**



---

archive/issue_events_289048.json:
```json
{
    "actor": "https://github.com/pfasante",
    "created_at": "2018-06-29T08:55:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289048"
}
```



---

archive/issue_events_289049.json:
```json
{
    "actor": "https://github.com/pfasante",
    "created_at": "2018-06-29T08:55:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289049"
}
```



---

archive/issue_comments_325262.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053\">f98d64f</a></td><td><code>start removing BooleanMonomialMonoid</code></td></tr></table>\n",
    "created_at": "2018-06-29T08:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325262",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:10" align="right">Comment 10</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053">f98d64f</a></td><td><code>start removing BooleanMonomialMonoid</code></td></tr></table>




---

archive/issue_comments_325263.json:
```json
{
    "body": "Assignee: **@pfasante**",
    "created_at": "2018-06-29T08:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325263",
    "user": "https://github.com/pfasante"
}
```

Assignee: **@pfasante**



---

archive/issue_comments_325264.json:
```json
{
    "body": "Commit: **[f98d64f](https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053)**",
    "created_at": "2018-06-29T08:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325264",
    "user": "https://github.com/pfasante"
}
```

Commit: **[f98d64f](https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053)**



---

archive/issue_comments_325265.json:
```json
{
    "body": "Changed keywords from none to **memory leak, BooleanFunction, days94**",
    "created_at": "2018-06-29T08:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325265",
    "user": "https://github.com/pfasante"
}
```

Changed keywords from none to **memory leak, BooleanFunction, days94**



---

archive/issue_comments_325266.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nSmall stylistic corrections in convert_to_pE:\n1. \"definig\" should be \"defining\".\n2. <code>\\`p = cE.get_pc()\\`</code> should be <code>\\`\\`p = cE.get_pc()\\`\\`</code>\n3. I think that English prefers \"vice versa\" over \"viceversa\", unlike Italian or Spanish.\n\nIn lift_to_polynomial() and lift_to_polynomial_rational_reconstruction() \"poly\" seems weird. Maybe just \"Compute a lift to a polynomial ring `R` using rational reconstruction.\"\nAlso \"recontruction\" should be \"reconstruction\", and <code>\\`self\\`</code> should be <code>\\`\\`self\\`\\`</code> in few places.\n\nIn both gcd() methods the default value for the algorithm keyword should come first:\n\n```\n    - ``pari`` - use pari routines.\n    - ``modular`` - (default) modular algorithm using NTL.\n```\n\nIn Polynomial_absolute_number_field_dense at\n\n```\nraise ValueError(\"unknown algorithm %s\" % (algorithm))\n```\nThe string format should be `(algorithm, )`.",
    "created_at": "2018-06-29T13:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325266",
    "user": "https://github.com/mathzeta"
}
```

<div id="comment:11" align="right">Comment 11</div>

Small stylistic corrections in convert_to_pE:
1. "definig" should be "defining".
2. <code>\`p = cE.get_pc()\`</code> should be <code>\`\`p = cE.get_pc()\`\`</code>
3. I think that English prefers "vice versa" over "viceversa", unlike Italian or Spanish.

In lift_to_polynomial() and lift_to_polynomial_rational_reconstruction() "poly" seems weird. Maybe just "Compute a lift to a polynomial ring `R` using rational reconstruction."
Also "recontruction" should be "reconstruction", and <code>\`self\`</code> should be <code>\`\`self\`\`</code> in few places.

In both gcd() methods the default value for the algorithm keyword should come first:

```
    - ``pari`` - use pari routines.
    - ``modular`` - (default) modular algorithm using NTL.
```

In Polynomial_absolute_number_field_dense at

```
raise ValueError("unknown algorithm %s" % (algorithm))
```
The string format should be `(algorithm, )`.



---

archive/issue_comments_325267.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@mathzeta](#comment%3A11):\n> Small stylistic corrections in convert_to_pE:\n> \n> [...]\n> \n> The string format should be `(algorithm, )`.\n\nErr.. does this ended up in a wrong ticket? I cannot find anything of the above mentioned in `src/sage/rings/polynomial/pbori.pyx`.",
    "created_at": "2018-06-29T15:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325267",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@mathzeta](#comment%3A11):
> Small stylistic corrections in convert_to_pE:
> 
> [...]
> 
> The string format should be `(algorithm, )`.

Err.. does this ended up in a wrong ticket? I cannot find anything of the above mentioned in `src/sage/rings/polynomial/pbori.pyx`.



---

archive/issue_comments_325268.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f\">16350a4</a></td><td><code>Revert \"start removing BooleanMonomialMonoid\"</code></td></tr></table>\n",
    "created_at": "2018-06-29T15:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325268",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f">16350a4</a></td><td><code>Revert "start removing BooleanMonomialMonoid"</code></td></tr></table>




---

archive/issue_comments_325269.json:
```json
{
    "body": "Changed commit from **[f98d64f](https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053)** to **[16350a4](https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f)**",
    "created_at": "2018-06-29T15:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325269",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f98d64f](https://github.com/sagemath/sagetrac-mirror/commit/f98d64fcd81838ef9fa9cdcc97e4b8c8c6505053)** to **[16350a4](https://github.com/sagemath/sagetrac-mirror/commit/16350a4013c5fbf1c19f2aa9ec17a3320cab5b4f)**



---

archive/issue_comments_325270.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nAfter discussing with Travis again, we decided that it's best not to remove `BooleanMonomialMonoid`, as it looks like its often used implicitly in the code.\n\nInstead we decided to do the following:\n* `BooleanPolynomialRing_constructor` should create the `BooleanMonomialMonoid` and pass a reference of this object to `BooleanPolynomialRing.__init__` (replacing the `n` and `names` arguments).\n* `BooleanPolynomialRing` stores this reference, instead of creating the `BooleanMonomialMonoid` itself.\n* Delete the reference to `BooleanPolynomialRing` from `BooleanMonomialMonoid` and thus rewrite all lines where this reference is used.\n* To clean things up, move the caching done in `BooleanPolynomialRing_constructor` to `BooleanPolynomialRing.__init__`.",
    "created_at": "2018-06-29T16:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325270",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:14" align="right">Comment 14</div>

After discussing with Travis again, we decided that it's best not to remove `BooleanMonomialMonoid`, as it looks like its often used implicitly in the code.

Instead we decided to do the following:
* `BooleanPolynomialRing_constructor` should create the `BooleanMonomialMonoid` and pass a reference of this object to `BooleanPolynomialRing.__init__` (replacing the `n` and `names` arguments).
* `BooleanPolynomialRing` stores this reference, instead of creating the `BooleanMonomialMonoid` itself.
* Delete the reference to `BooleanPolynomialRing` from `BooleanMonomialMonoid` and thus rewrite all lines where this reference is used.
* To clean things up, move the caching done in `BooleanPolynomialRing_constructor` to `BooleanPolynomialRing.__init__`.



---

archive/issue_comments_325271.json:
```json
{
    "body": "Removed assignee **@pfasante**",
    "created_at": "2018-07-26T10:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325271",
    "user": "https://github.com/pfasante"
}
```

Removed assignee **@pfasante**



---

archive/issue_comments_325272.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nAt the moment, this ticket is a bit above my head.",
    "created_at": "2018-07-26T10:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325272",
    "user": "https://github.com/pfasante"
}
```

<div id="comment:15" align="right">Comment 15</div>

At the moment, this ticket is a bit above my head.



---

archive/issue_comments_325273.json:
```json
{
    "body": "Changed author from **Friedrich Wiemer** to none",
    "created_at": "2018-07-26T10:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325273",
    "user": "https://github.com/pfasante"
}
```

Changed author from **Friedrich Wiemer** to none



---

archive/issue_events_289050.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289050"
}
```



---

archive/issue_events_289051.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289051"
}
```



---

archive/issue_comments_325274.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21892#issuecomment-325274",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">Comment 17</div>

update milestone 8.3 -> 8.4



---

archive/issue_events_289052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:42:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21892",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21892#event-289052"
}
```
