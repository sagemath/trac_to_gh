# Issue 21736: Offer openblas's lapack to programs run under Sage

archive/issues_021499.json:
```json
{
    "body": "Rationale : Openblas offers LAPACK, but there is no lapack.so file available in the current installation. Programs called by (something in) Sage can't use it.\n\nCase  in point : jags (an MCMC sampler of some use to Bayesian users of R) doesn't install under the Sage shell ; however, this is necessary : a system installation called from Sage (i. e. from Sage's R) will detect a conflict between system's LAPACK and Sage's Openblas.\n\nThe simple expedient of linking libopenblas.so to liblapack.so in $SAGE_ROOT is suffocient for installing and using JAGS.\n\nPlan : patch Openblas' spkg-install to create this link.\n\nTimetable : whenever I can recreate a distinct Sage installation for creation of a \"clean\" patch (i. e. not on the next few days...).\n\nCC:  @kiwifb @dimpase\n\nReviewer: Dima Pasechnik\n\nBranch: u/charpent/offer_openblas_s_lapack_to_programs_run_under_sage\n\nCommit: cb5df83339637bc894b3c328ee9dcc381daf3fe2\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/21736\n\n",
    "closed_at": "2020-03-16T10:43:41Z",
    "created_at": "2016-10-20T22:00:30Z",
    "labels": [
        "component: numerical",
        "trivial"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Offer openblas's lapack to programs run under Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21736",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Rationale : Openblas offers LAPACK, but there is no lapack.so file available in the current installation. Programs called by (something in) Sage can't use it.

Case  in point : jags (an MCMC sampler of some use to Bayesian users of R) doesn't install under the Sage shell ; however, this is necessary : a system installation called from Sage (i. e. from Sage's R) will detect a conflict between system's LAPACK and Sage's Openblas.

The simple expedient of linking libopenblas.so to liblapack.so in $SAGE_ROOT is suffocient for installing and using JAGS.

Plan : patch Openblas' spkg-install to create this link.

Timetable : whenever I can recreate a distinct Sage installation for creation of a "clean" patch (i. e. not on the next few days...).

CC:  @kiwifb @dimpase

Reviewer: Dima Pasechnik

Branch: u/charpent/offer_openblas_s_lapack_to_programs_run_under_sage

Commit: cb5df83339637bc894b3c328ee9dcc381daf3fe2

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/21736





---

archive/issue_comments_298099.json:
```json
{
    "body": "<a id='comment:2'></a>Builds OK. Passes ptestlong with two transient failures (both tests pass when run standalone) :\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed\nsage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)\n----------------------------------------------------------------------\nTotal time for all tests: 3819.2 seconds\n    cpu time: 17189.6 seconds\n    cumulative wall time: 20998.4 seconds\nMakefile:112\u00a0: la recette pour la cible \u00ab\u00a0ptestlong\u00a0\u00bb a \u00e9chou\u00e9e\nmake: *** [ptestlong] Erreur 5\n\nreal\t128m40,205s\nuser\t683m11,124s\nsys\t76m18,572s\ncharpent@asus16-ec:/usr/local/sage-exp$ sage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed\nRunning doctests with ID 2016-10-21-09-52-12-a6e288e2.\nGit branch: mabranche\nUsing --optional=database_gap,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py\n    [588 tests, 5.88 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 6.1 seconds\n    cpu time: 3.1 seconds\n    cumulative wall time: 5.9 seconds\ncharpent@asus16-ec:/usr/local/sage-exp$ sage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)\nRunning doctests with ID 2016-10-21-09-52-35-de03d437.\nGit branch: mabranche\nUsing --optional=database_gap,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx\n    [573 tests, 13.34 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 13.5 seconds\n    cpu time: 23.3 seconds\n    cumulative wall time: 13.3 seconds\n```\n\nForgot to add : the same patch in another private branch allows the normal use of LAPACK : jags buils and runs fine.\n\n==> `needs_review`\n\n---\nNew commits:",
    "created_at": "2016-10-21T08:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298099",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:2'></a>Builds OK. Passes ptestlong with two transient failures (both tests pass when run standalone) :

```
----------------------------------------------------------------------
sage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)
----------------------------------------------------------------------
Total time for all tests: 3819.2 seconds
    cpu time: 17189.6 seconds
    cumulative wall time: 20998.4 seconds
Makefile:112 : la recette pour la cible « ptestlong » a échouée
make: *** [ptestlong] Erreur 5

real	128m40,205s
user	683m11,124s
sys	76m18,572s
charpent@asus16-ec:/usr/local/sage-exp$ sage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py  # 1 doctest failed
Running doctests with ID 2016-10-21-09-52-12-a6e288e2.
Git branch: mabranche
Using --optional=database_gap,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 97.7 src/sage/homology/simplicial_complex.py
    [588 tests, 5.88 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.1 seconds
    cpu time: 3.1 seconds
    cumulative wall time: 5.9 seconds
charpent@asus16-ec:/usr/local/sage-exp$ sage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)
Running doctests with ID 2016-10-21-09-52-35-de03d437.
Git branch: mabranche
Using --optional=database_gap,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 97.7 src/sage/matrix/matrix_integer_dense.pyx
    [573 tests, 13.34 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 13.5 seconds
    cpu time: 23.3 seconds
    cumulative wall time: 13.3 seconds
```

Forgot to add : the same patch in another private branch allows the normal use of LAPACK : jags buils and runs fine.

==> `needs_review`

---
New commits:



---

archive/issue_comments_298100.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-21T08:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298100",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298101.json:
```json
{
    "body": "<a id='comment:3'></a>Is this ticket still relevant?",
    "created_at": "2020-03-11T22:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298101",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Is this ticket still relevant?



---

archive/issue_comments_298102.json:
```json
{
    "body": "<a id='comment:4'></a>I guess not, our (or system) lapack.pc should take care of this.",
    "created_at": "2020-03-12T00:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298102",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>I guess not, our (or system) lapack.pc should take care of this.



---

archive/issue_events_057554.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-12T00:30:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21736#event-57554"
}
```



---

archive/issue_comments_298103.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-12T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298103",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057555.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-03-16T10:43:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21736#event-57555"
}
```



---

archive/issue_comments_298104.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-03-16T10:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21736#issuecomment-298104",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate
