# Issue 21644: Bug in derivatives of some functions to the index var

archive/issues_021407.json:
```json
{
    "body": "```\nsage: gen_laguerre(n,a,x).diff(a)\n-gen_laguerre(n - 1, a + 1, x)\nsage: gen_laguerre(n,a,x).diff(x)\n-gen_laguerre(n - 1, a + 1, x)\n\nsage: derivative(hermite(n,x),x)\n2*n*hermite(n - 1, x)\nsage: derivative(hermite(n,x),n)\n2*n*hermite(n - 1, x)\n```\nso something is badly wrong with recognizing the diff. parameter. Note only `hermite` is implemented in Pynac.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21644\n\n",
    "closed_at": "2016-10-21T07:03:49Z",
    "created_at": "2016-10-05T06:36:36Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Bug in derivatives of some functions to the index var",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21644",
    "user": "https://github.com/rwst"
}
```
```
sage: gen_laguerre(n,a,x).diff(a)
-gen_laguerre(n - 1, a + 1, x)
sage: gen_laguerre(n,a,x).diff(x)
-gen_laguerre(n - 1, a + 1, x)

sage: derivative(hermite(n,x),x)
2*n*hermite(n - 1, x)
sage: derivative(hermite(n,x),n)
2*n*hermite(n - 1, x)
```
so something is badly wrong with recognizing the diff. parameter. Note only `hermite` is implemented in Pynac.

Issue created by migration from https://trac.sagemath.org/ticket/21644





---

archive/issue_comments_296884.json:
```json
{
    "body": "I have a patch for this issue (at least for gen_laguerre, my copy of sage doesn't have a derivative method for hermite).\n\nThe bug was in handling the diff_param choice, the 'else' branch had the return value for when diff_param was x, but that means that anything that didn't match\nthe ifs before would return the derivative wrt x from the 'else' branch.\n\nThe attached patch fixes this (and adds proper handling to laguerre as well)",
    "created_at": "2016-10-05T18:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296884",
    "user": "https://trac.sagemath.org/admin/accounts/users/mafra"
}
```

I have a patch for this issue (at least for gen_laguerre, my copy of sage doesn't have a derivative method for hermite).

The bug was in handling the diff_param choice, the 'else' branch had the return value for when diff_param was x, but that means that anything that didn't match
the ifs before would return the derivative wrt x from the 'else' branch.

The attached patch fixes this (and adds proper handling to laguerre as well)



---

archive/issue_comments_296885.json:
```json
{
    "body": "Patch to fix issue with gen_laguerre derivative",
    "created_at": "2016-10-05T18:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296885",
    "user": "https://trac.sagemath.org/admin/accounts/users/mafra"
}
```

Patch to fix issue with gen_laguerre derivative



---

archive/issue_comments_296886.json:
```json
{
    "body": "Attachment [0001-Fix-derivative-of-gen_laguerre.patch](tarball://root/attachments/some-uuid/ticket21644/0001-Fix-derivative-of-gen_laguerre.patch) by @tscrim created at 2016-10-05 21:32:16\n\n`@`mafra you should create and post a git branch of your patch to this ticket. Then one that is done, you can put your (real) name as the author and set it to needs review.",
    "created_at": "2016-10-05T21:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296886",
    "user": "https://github.com/tscrim"
}
```

Attachment [0001-Fix-derivative-of-gen_laguerre.patch](tarball://root/attachments/some-uuid/ticket21644/0001-Fix-derivative-of-gen_laguerre.patch) by @tscrim created at 2016-10-05 21:32:16

`@`mafra you should create and post a git branch of your patch to this ticket. Then one that is done, you can put your (real) name as the author and set it to needs review.



---

archive/issue_comments_296887.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-05T23:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296887",
    "user": "https://trac.sagemath.org/admin/accounts/users/mafra"
}
```

New commits:



---

archive/issue_comments_296888.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-05T23:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296888",
    "user": "https://trac.sagemath.org/admin/accounts/users/mafra"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296889.json:
```json
{
    "body": "That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.\n\nBTW Pynac fixes also get Python doctests, partly in the https://github.com/pynac/sage branches (which get merged with the Pynac upgrade ticket into Sage), and partly with separate Sage tickets.",
    "created_at": "2016-10-06T06:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296889",
    "user": "https://github.com/rwst"
}
```

That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.

BTW Pynac fixes also get Python doctests, partly in the https://github.com/pynac/sage branches (which get merged with the Pynac upgrade ticket into Sage), and partly with separate Sage tickets.



---

archive/issue_comments_296890.json:
```json
{
    "body": "The hermite fix is in https://github.com/pynac/pynac/commit/20222d00281b2ab30970a407a8fb3e8fee93e07a",
    "created_at": "2016-10-06T06:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296890",
    "user": "https://github.com/rwst"
}
```

The hermite fix is in https://github.com/pynac/pynac/commit/20222d00281b2ab30970a407a8fb3e8fee93e07a



---

archive/issue_comments_296891.json:
```json
{
    "body": "However, see #21655 for a later enhancement.",
    "created_at": "2016-10-06T06:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296891",
    "user": "https://github.com/rwst"
}
```

However, see #21655 for a later enhancement.



---

archive/issue_comments_296892.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-06T08:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296892",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296893.json:
```json
{
    "body": "Replying to [comment:6 rws]:\n> That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.\n\n\nOk, I did that now. But I was not sure if I should have rebased the new patch into the previous one or not, and when I decided to push I got an error message saying that I needed to 'pull'\nfirst. After pulling an automatic merge was done, so now there are three commits in this branch.\n\nShould I have rebased the doctest patch into the previous one? Would that require a 'forced' git push?",
    "created_at": "2016-10-06T08:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296893",
    "user": "https://trac.sagemath.org/admin/accounts/users/mafra"
}
```

Replying to [comment:6 rws]:
> That is fine, thanks. Can you please add a doctest for the fixed behaviour? We add tests for every branch of possible computation.


Ok, I did that now. But I was not sure if I should have rebased the new patch into the previous one or not, and when I decided to push I got an error message saying that I needed to 'pull'
first. After pulling an automatic merge was done, so now there are three commits in this branch.

Should I have rebased the doctest patch into the previous one? Would that require a 'forced' git push?



---

archive/issue_comments_296894.json:
```json
{
    "body": "The merge commit would not have been necessary if you had done `git co t/21644/bug_in_derivatives_of_some_functions_to_the_index_var` on your machine, added the doctest commt, and finally `git trac push`. But it's no heavy disaster.",
    "created_at": "2016-10-06T09:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296894",
    "user": "https://github.com/rwst"
}
```

The merge commit would not have been necessary if you had done `git co t/21644/bug_in_derivatives_of_some_functions_to_the_index_var` on your machine, added the doctest commt, and finally `git trac push`. But it's no heavy disaster.



---

archive/issue_comments_296895.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-06T09:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296895",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296896.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21644#issuecomment-296896",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057386.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-21T07:03:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21644",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21644#event-57386"
}
```
