# Issue 21543: Posets: with_bounds() and wrong category

archive/issues_021306.json:
```json
{
    "body": "\n```\nsage: L = Posets.PentagonPoset()\nsage: L_ = L.with_bounds()\n\nsage: L.meet(1, 2)\n0\nsage: L_.meet(1, 2)\n0\n\nsage: L.meet_irreducibles()\n[1, 2, 3]\nsage: L_.meet_irreducibles()\nAttributeError: 'FiniteLatticePoset_with_category' object has no attribute 'meet_irreducibles'\n```\n\n\nCC:  @tscrim @fchapoton\n\nBranch/Commit: 3fc685224b13cd3a915bc6a41f17f1e456681c06\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21543\n\n",
    "closed_at": "2016-10-03T17:41:51Z",
    "created_at": "2016-09-19T17:02:38Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Posets: with_bounds() and wrong category",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21543",
    "user": "https://github.com/jm58660"
}
```

```
sage: L = Posets.PentagonPoset()
sage: L_ = L.with_bounds()

sage: L.meet(1, 2)
0
sage: L_.meet(1, 2)
0

sage: L.meet_irreducibles()
[1, 2, 3]
sage: L_.meet_irreducibles()
AttributeError: 'FiniteLatticePoset_with_category' object has no attribute 'meet_irreducibles'
```


CC:  @tscrim @fchapoton

Branch/Commit: 3fc685224b13cd3a915bc6a41f17f1e456681c06

Reviewer: Frédéric Chapoton

Author: Jori Mäntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21543





---

archive/issue_comments_397133.json:
```json
{
    "body": "<a id='comment:1'></a>Travis, what I did wrong? `with_bounds` is my code.",
    "created_at": "2016-09-19T17:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397133",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:1'></a>Travis, what I did wrong? `with_bounds` is my code.



---

archive/issue_comments_397134.json:
```json
{
    "body": "<a id='comment:2'></a>Fr\u00e9d\u00e9ric, this works with `intervals_poset` written by you; it uses `constructor = LatticePoset`. Also `relabel` works, it uses `constructor = FiniteLatticePoset . . . return constructor(. . ., category=self.category(), . . .)`.\n\nWhat is the difference, and which one is better?\n\n(Sidenote: As I work with this, maybe the parameter could be also `('bottom', None)` to add only another bound.)",
    "created_at": "2016-09-20T04:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397134",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>Frédéric, this works with `intervals_poset` written by you; it uses `constructor = LatticePoset`. Also `relabel` works, it uses `constructor = FiniteLatticePoset . . . return constructor(. . ., category=self.category(), . . .)`.

What is the difference, and which one is better?

(Sidenote: As I work with this, maybe the parameter could be also `('bottom', None)` to add only another bound.)



---

archive/issue_comments_397135.json:
```json
{
    "body": "<a id='comment:3'></a>The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.",
    "created_at": "2016-09-20T04:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397135",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.



---

archive/issue_comments_397136.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [tscrim](#comment%3A3):\n> The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.\n\n\nOK. Now, let's suppose that we add classes for, say, atomic lattices and distributive lattices. A distributive lattice with bounds added is always distributive, whereas atomic lattice is not, except for the empty lattice. And so `category=self.category()` is safe only for something like `relabel` -- and even then only if there is no subclass expecting something about the elements. Is this correct?\n\nAnother question: Suppose that I don't like re-computing meets and joins. For something like `with_bounds` it is very easy to expand meet- and join-matrices directly. Would either of those ways allow this?",
    "created_at": "2016-09-20T05:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397136",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>Replying to [tscrim](#comment%3A3):
> The difference is that `LatticePoset` redirects to `Poset`, which does additional (pre)processing of the input. `FiniteLatticePoset` assumes the data is the correct format. So the latter is better for speed, the former is better for easier coding.


OK. Now, let's suppose that we add classes for, say, atomic lattices and distributive lattices. A distributive lattice with bounds added is always distributive, whereas atomic lattice is not, except for the empty lattice. And so `category=self.category()` is safe only for something like `relabel` -- and even then only if there is no subclass expecting something about the elements. Is this correct?

Another question: Suppose that I don't like re-computing meets and joins. For something like `with_bounds` it is very easy to expand meet- and join-matrices directly. Would either of those ways allow this?



---

archive/issue_comments_397137.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jmantysalo/posets__with_bounds___and_wrong_category\"",
    "created_at": "2016-09-20T06:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397137",
    "user": "https://github.com/jm58660"
}
```

Changing branch from "" to "u/jmantysalo/posets__with_bounds___and_wrong_category"



---

archive/issue_comments_397138.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-20T06:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397138",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397139.json:
```json
{
    "body": "Changing commit from \"\" to \"fa87e7fba9fc4ea642a0d2275b98825c3a5177fc\"",
    "created_at": "2016-09-20T06:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397139",
    "user": "https://github.com/jm58660"
}
```

Changing commit from "" to "fa87e7fba9fc4ea642a0d2275b98825c3a5177fc"



---

archive/issue_comments_397140.json:
```json
{
    "body": "<a id='comment:6'></a>Anyways, now it at least works. The test set is long and boring, sorry for that. On the plus side it should cover every line of the code.\n\n---\nNew commits:",
    "created_at": "2016-09-20T06:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397140",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'></a>Anyways, now it at least works. The test set is long and boring, sorry for that. On the plus side it should cover every line of the code.

---
New commits:



---

archive/issue_comments_397141.json:
```json
{
    "body": "Changing author from \"\" to \"Jori M\u00e4ntysalo\"",
    "created_at": "2016-09-20T07:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397141",
    "user": "https://github.com/jm58660"
}
```

Changing author from "" to "Jori Mäntysalo"



---

archive/issue_comments_397142.json:
```json
{
    "body": "<a id='comment:8'></a>Fr\u00e9d\u00e9ric, can you check this one? Basic logic should be clear: a meet-semilattice with top element is a lattice, and a join-semilattice with bottom element is a lattice.",
    "created_at": "2016-09-22T05:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397142",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>Frédéric, can you check this one? Basic logic should be clear: a meet-semilattice with top element is a lattice, and a join-semilattice with bottom element is a lattice.



---

archive/issue_comments_397143.json:
```json
{
    "body": "<a id='comment:9'></a>not coherent: \n\n* either allow (None, None) in the doc\n* or forbid (None, None) in the code\n\nI would prefer the second option, because (None,None) is useless.",
    "created_at": "2016-09-22T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397143",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>not coherent: 

* either allow (None, None) in the doc
* or forbid (None, None) in the code

I would prefer the second option, because (None,None) is useless.



---

archive/issue_comments_397144.json:
```json
{
    "body": "Changing commit from \"fa87e7fba9fc4ea642a0d2275b98825c3a5177fc\" to \"3fc685224b13cd3a915bc6a41f17f1e456681c06\"",
    "created_at": "2016-09-22T14:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fa87e7fba9fc4ea642a0d2275b98825c3a5177fc" to "3fc685224b13cd3a915bc6a41f17f1e456681c06"



---

archive/issue_comments_397145.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-22T14:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397146.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [chapoton](#comment%3A9):\n> not coherent: \n> \n> * either allow (None, None) in the doc\n> * or forbid (None, None) in the code\n> \n> I would prefer the second option, because (None,None) is useless.\n\n\nBut `+`-operator also accepts the zero as argument. Some user might use code like \"if that then newbot = 42 else newbot = None . . . P.with_bounds((newbot, newtop))\".",
    "created_at": "2016-09-22T14:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397146",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>Replying to [chapoton](#comment%3A9):
> not coherent: 
> 
> * either allow (None, None) in the doc
> * or forbid (None, None) in the code
> 
> I would prefer the second option, because (None,None) is useless.


But `+`-operator also accepts the zero as argument. Some user might use code like "if that then newbot = 42 else newbot = None . . . P.with_bounds((newbot, newtop))".



---

archive/issue_comments_397147.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-23T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397147",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397148.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2016-09-23T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397148",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_397149.json:
```json
{
    "body": "<a id='comment:12'></a>ok, good enough",
    "created_at": "2016-09-23T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397149",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>ok, good enough



---

archive/issue_comments_397150.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-03T17:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397150",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_397151.json:
```json
{
    "body": "Changing branch from \"u/jmantysalo/posets__with_bounds___and_wrong_category\" to \"3fc685224b13cd3a915bc6a41f17f1e456681c06\"",
    "created_at": "2016-10-03T17:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21543#issuecomment-397151",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jmantysalo/posets__with_bounds___and_wrong_category" to "3fc685224b13cd3a915bc6a41f17f1e456681c06"



---

archive/issue_events_057181.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T17:41:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21543",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21543#event-57181"
}
```
