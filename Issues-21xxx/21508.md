# Issue 21508: Meta-ticket: Clean up src/setup.py to bring it to standard setuptools behavior

archive/issues_021271.json:
```json
{
    "body": "Sub-tasks:\n\n- #21480: Make sagelib setup.py self-contained and independent of SAGE_ROOT\n- #21613: Make setup.py not depend on make\n- #21604: Cleaning up stale installed files in setup()\n  - See also #21654: Disentangle cleaning of stale installed files in build directory and in install directory\n- #21600: Use custom build_ext to compile Cython code\n\nIn particular, \n- `src/setup.py --help` should return immediately.\n- `src/setup.py clean` should not build anything but just clean (and everything that is now done by `make clean` in the `src` directory should be done by it; see #29411)\n\nAlso the following should be done:\n- #29702: Move all code from `src/setup.py`, `src/fpickle_setup.py` to `sage_setup`\n- #21516: Fix sagelib sdist (`src/setup.py sdist`)\n- #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`\n- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n- #21678 Testsuite for `src/setup.py`\n- #30580 `sage_setup`: Remove import-time dependency (`setup_requires`) on `pkgconfig`, `numpy`\n\nAlso see: \n- #20108: Use `package_data` instead of `data_files` in setup.py\n- #21682: Add a separate \"cythonize\" command to setup.py\n- #12659: build the sage library in place\n- #13190: make sage use setuptools instead of distutils\n- #29701: Meta-ticket: Replace use of OptionalExtension by namespace packages\n\n\nCC:  @jdemeyer @vbraun @embray @nexttime @kiwifb @williamstein @mezzarobba @dimpase @jhpalmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/21508\n\n",
    "created_at": "2016-09-16T17:55:02Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Clean up src/setup.py to bring it to standard setuptools behavior",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21508",
    "user": "https://github.com/mkoeppe"
}
```
Sub-tasks:

- #21480: Make sagelib setup.py self-contained and independent of SAGE_ROOT
- #21613: Make setup.py not depend on make
- #21604: Cleaning up stale installed files in setup()
  - See also #21654: Disentangle cleaning of stale installed files in build directory and in install directory
- #21600: Use custom build_ext to compile Cython code

In particular, 
- `src/setup.py --help` should return immediately.
- `src/setup.py clean` should not build anything but just clean (and everything that is now done by `make clean` in the `src` directory should be done by it; see #29411)

Also the following should be done:
- #29702: Move all code from `src/setup.py`, `src/fpickle_setup.py` to `sage_setup`
- #21516: Fix sagelib sdist (`src/setup.py sdist`)
- #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`
- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
- #21678 Testsuite for `src/setup.py`
- #30580 `sage_setup`: Remove import-time dependency (`setup_requires`) on `pkgconfig`, `numpy`

Also see: 
- #20108: Use `package_data` instead of `data_files` in setup.py
- #21682: Add a separate "cythonize" command to setup.py
- #12659: build the sage library in place
- #13190: make sage use setuptools instead of distutils
- #29701: Meta-ticket: Replace use of OptionalExtension by namespace packages


CC:  @jdemeyer @vbraun @embray @nexttime @kiwifb @williamstein @mezzarobba @dimpase @jhpalmieri

Issue created by migration from https://trac.sagemath.org/ticket/21508





---

archive/issue_comments_294837.json:
```json
{
    "body": "Changing type from defect to task.",
    "created_at": "2016-09-16T17:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294837",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from defect to task.



---

archive/issue_comments_294838.json:
```json
{
    "body": "<a id='comment:8'></a>> and everything that is now done by make clean should be done by it\n\n\nBy which you mean the makefile in `src/` right?",
    "created_at": "2016-09-26T10:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294838",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>> and everything that is now done by make clean should be done by it


By which you mean the makefile in `src/` right?



---

archive/issue_comments_294839.json:
```json
{
    "body": "<a id='comment:9'></a>Yes -- I've clarified it in the description.",
    "created_at": "2016-09-26T14:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294839",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Yes -- I've clarified it in the description.



---

archive/issue_comments_294840.json:
```json
{
    "body": "<a id='comment:13'></a>Definitely keep in touch with me as a point of contact on any work you do on this--I know distutils + setuptools from top to bottom.",
    "created_at": "2016-09-29T15:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294840",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Definitely keep in touch with me as a point of contact on any work you do on this--I know distutils + setuptools from top to bottom.



---

archive/issue_comments_294841.json:
```json
{
    "body": "<a id='comment:15'></a>Let me just say that I consider #21613 not an important step towards this task (\"... standard distutils behavior\"). The present task ticket (#21508) is concerned with getting the *behavior* of `setup.py` standard (how does it respond to standard commands and options), not necessarily its *implementation*. The fact that `setup.py` with #21480 invokes `make` is an implementation detail, which is not very relevant for the goal of #21507.",
    "created_at": "2016-09-29T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294841",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Let me just say that I consider #21613 not an important step towards this task ("... standard distutils behavior"). The present task ticket (#21508) is concerned with getting the *behavior* of `setup.py` standard (how does it respond to standard commands and options), not necessarily its *implementation*. The fact that `setup.py` with #21480 invokes `make` is an implementation detail, which is not very relevant for the goal of #21507.



---

archive/issue_comments_294842.json:
```json
{
    "body": "<a id='comment:16'></a>Except it is pretty non-standard for it to have non-trivial side-effects (e.g. running a subprocess that generates files) unconditionally.  Behavior-wise that should only happen when it's actually important for that to happen, such as during the build command.",
    "created_at": "2016-09-30T09:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294842",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>Except it is pretty non-standard for it to have non-trivial side-effects (e.g. running a subprocess that generates files) unconditionally.  Behavior-wise that should only happen when it's actually important for that to happen, such as during the build command.



---

archive/issue_comments_294843.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 embray]:\n> Except it is pretty non-standard for it to have non-trivial side-effects (e.g. running a subprocess that generates files) unconditionally.  Behavior-wise that should only happen when it's actually important for that to happen, such as during the build command.\n\n\nI agree that it should happen during the build command.",
    "created_at": "2016-09-30T19:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Replying to [comment:16 embray]:
> Except it is pretty non-standard for it to have non-trivial side-effects (e.g. running a subprocess that generates files) unconditionally.  Behavior-wise that should only happen when it's actually important for that to happen, such as during the build command.


I agree that it should happen during the build command.



---

archive/issue_comments_294844.json:
```json
{
    "body": "<a id='comment:18'></a>I will work on #21613, and you'll see it's not that big a deal.",
    "created_at": "2016-10-04T12:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294844",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>I will work on #21613, and you'll see it's not that big a deal.



---

archive/issue_comments_294845.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 embray]:\n> I will work on #21613, and you'll see it's not that big a deal.\n\n\nBeware of conflicts with other tickets, in particular #21600 and its dependencies.",
    "created_at": "2016-10-04T12:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294845",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:18 embray]:
> I will work on #21613, and you'll see it's not that big a deal.


Beware of conflicts with other tickets, in particular #21600 and its dependencies.



---

archive/issue_comments_294846.json:
```json
{
    "body": "<a id='comment:20'></a>Yep.  I don't think there will be significant conflicts, but I can make those tickets dependencies of #21613 and ensure any work I do there integrates well with the others before suggesting it to be merged.",
    "created_at": "2016-10-04T13:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294846",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>Yep.  I don't think there will be significant conflicts, but I can make those tickets dependencies of #21613 and ensure any work I do there integrates well with the others before suggesting it to be merged.



---

archive/issue_events_057086.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T17:40:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57086"
}
```



---

archive/issue_events_057087.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57087"
}
```



---

archive/issue_events_057088.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57088"
}
```



---

archive/issue_comments_294847.json:
```json
{
    "body": "<a id='comment:35'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21508#issuecomment-294847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_057089.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57089"
}
```



---

archive/issue_events_057090.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57090"
}
```



---

archive/issue_events_057091.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57091"
}
```



---

archive/issue_events_057092.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57092"
}
```



---

archive/issue_events_057093.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57093"
}
```



---

archive/issue_events_057094.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57094"
}
```



---

archive/issue_events_057095.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57095"
}
```



---

archive/issue_events_057096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57096"
}
```



---

archive/issue_events_057097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57097"
}
```



---

archive/issue_events_057098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21508",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21508#event-57098"
}
```
