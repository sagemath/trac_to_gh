# Issue 21121: Precision in doctest tolerance: x > x

archive/issues_020884.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n\n```\nFailed example:\n    A.exp()  # tol 1e-14\nExpected:\n    [-19.614602953804912 + 12.517743846762578*I   3.7949636449582176 + 28.88379930658099*I]\n    [ -32.383580980922254 + 21.88423595789845*I   2.269633004093535 + 44.901324827684824*I]\nGot:\n    [-19.614602953804923 + 12.517743846762574*I  3.7949636449582007 + 28.883799306580993*I]\n    [-32.383580980922275 + 21.884235957898447*I  2.2696330040935115 + 44.901324827684846*I]\nTolerance exceeded in 1 of 8:\n    2.269633004093535 vs 2.2696330040935115, tolerance 1e-14 > 1e-14\n```\n\nSage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid.\n\nThe attached branch fixes this by displaying `y > x` where:\n\n- `x` is the required tolerance (given in the doctest) with 15 digits, rounded to nearest.\n\n- `y` is the observed tolerance (computed by running the test) with 1 digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.\n\nAssuming that the tolerance in the doctest is given to at most 15 digits of precision (almost certainly the case), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n\nWe also refactor the implementation for printing tolerance errors somewhat.\n\nFinally, we use 1044 bits of precision to compute tolerances. This may seem overkill, but it is needed if we want to deal with tolerances on numbers computed with 1024 bits of precision.\n\nComponent: **doctest framework**\n\nKeywords: **doctest tolerance exceeded**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**\n\nReviewer: **Marc Mezzarobba**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21121_\n\n",
    "closed_at": "2019-01-27T10:50:34Z",
    "created_at": "2016-07-28T20:27:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/doctest%20coverage"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Precision in doctest tolerance: x > x",
    "type": "issue",
    "updated_at": "2019-01-27T10:50:34Z",
    "url": "https://github.com/sagemath/sage/issues/21121",
    "user": "https://github.com/nexttime"
}
```
<div id="comment:0"></div>


```
Failed example:
    A.exp()  # tol 1e-14
Expected:
    [-19.614602953804912 + 12.517743846762578*I   3.7949636449582176 + 28.88379930658099*I]
    [ -32.383580980922254 + 21.88423595789845*I   2.269633004093535 + 44.901324827684824*I]
Got:
    [-19.614602953804923 + 12.517743846762574*I  3.7949636449582007 + 28.883799306580993*I]
    [-32.383580980922275 + 21.884235957898447*I  2.2696330040935115 + 44.901324827684846*I]
Tolerance exceeded in 1 of 8:
    2.269633004093535 vs 2.2696330040935115, tolerance 1e-14 > 1e-14
```

Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid.

The attached branch fixes this by displaying `y > x` where:

- `x` is the required tolerance (given in the doctest) with 15 digits, rounded to nearest.

- `y` is the observed tolerance (computed by running the test) with 1 digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.

Assuming that the tolerance in the doctest is given to at most 15 digits of precision (almost certainly the case), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.

We also refactor the implementation for printing tolerance errors somewhat.

Finally, we use 1044 bits of precision to compute tolerances. This may seem overkill, but it is needed if we want to deal with tolerances on numbers computed with 1024 bits of precision.

Component: **doctest framework**

Keywords: **doctest tolerance exceeded**

Author: **Jeroen Demeyer**

Branch/Commit: **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**

Reviewer: **Marc Mezzarobba**

_Issue created by migration from https://trac.sagemath.org/ticket/21121_





---

archive/issue_events_294363.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-07-28T20:27:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294363"
}
```



---

archive/issue_events_294364.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-07-28T20:27:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294364"
}
```



---

archive/issue_events_294365.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-07-28T20:27:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294365"
}
```



---

archive/issue_events_294366.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-07-28T20:27:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294366"
}
```



---

archive/issue_events_294367.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-07-28T20:27:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294367"
}
```



---

archive/issue_comments_307627.json:
```json
{
    "body": "Dependencies: **#21124**",
    "created_at": "2016-07-29T10:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307627",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#21124**



---

archive/issue_comments_307628.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,3 +16,31 @@\n Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid; either the doctesting framework should be more tolerant here, or give better messages regarding the deviation.\n \n (Inspired by #21119.)\n+\n+---\n+\n+Just noticed there's even a doctest *expecting* this obviously wrong output in `src/sage/doctest/test.py`:\n+\n+```sh\n+Check handling of tolerances::\n+\n+    sage: subprocess.call([\"sage\", \"-t\", \"--warn-long\", \"0\", \"tolerance.rst\"], **kwds)  # long time\n+    Running doctests...\n+    Doctesting 1 file.\n+    sage -t --warn-long 0.0 tolerance.rst\n+    ...\n+    **********************************************************************\n+    File \"tolerance.rst\", line ..., in sage.doctest.tests.tolerance\n+    Failed example:\n+        print(\"Hello 1.0\")  # rel tol 1e-6\n+    Expected:\n+        Goodbye 0.999999\n+    Got:\n+        Hello 1.0\n+    Tolerance exceeded:\n+        0.999999 vs 1.0, tolerance 1e-06 > 1e-06\n+    **********************************************************************\n+    ...\n+```\n+(Note the `1e-06 > 1e-06` there.)\n+\n``````\n",
    "created_at": "2016-08-13T12:31:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307628",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,3 +16,31 @@
 Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid; either the doctesting framework should be more tolerant here, or give better messages regarding the deviation.
 
 (Inspired by #21119.)
+
+---
+
+Just noticed there's even a doctest *expecting* this obviously wrong output in `src/sage/doctest/test.py`:
+
+```sh
+Check handling of tolerances::
+
+    sage: subprocess.call(["sage", "-t", "--warn-long", "0", "tolerance.rst"], **kwds)  # long time
+    Running doctests...
+    Doctesting 1 file.
+    sage -t --warn-long 0.0 tolerance.rst
+    ...
+    **********************************************************************
+    File "tolerance.rst", line ..., in sage.doctest.tests.tolerance
+    Failed example:
+        print("Hello 1.0")  # rel tol 1e-6
+    Expected:
+        Goodbye 0.999999
+    Got:
+        Hello 1.0
+    Tolerance exceeded:
+        0.999999 vs 1.0, tolerance 1e-06 > 1e-06
+    **********************************************************************
+    ...
+```
+(Note the `1e-06 > 1e-06` there.)
+
``````




---

archive/issue_comments_307629.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe culprit (at least regarding the weird ouput) is here, namely in the local function `failstr()`:\n\n```python\n    def output_difference(self, example, got, optionflags):\n        r\"\"\" ... \"\"\"\n        got = self.human_readable_escape_sequences(got)\n        want = example.want\n        diff = doctest.OutputChecker.output_difference(self, example, got, optionflags)\n        if isinstance(want, MarkedOutput) and (want.tol or want.abs_tol or want.rel_tol):\n            if diff[-1] != \"\\n\":\n                diff += \"\\n\"\n            want_str = [g[0] for g in float_regex.findall(want)]\n            got_str = [g[0] for g in float_regex.findall(got)]\n            want_values = [RIFtol(g) for g in want_str]\n            want_intervals = [self.add_tolerance(v, want) for v in want_values]\n            got_values = [RIFtol(g) for g in got_str]\n            if len(want_values) == len(got_values):\n                def failstr(astr, bstr, actual, desired):\n                    return \"    %s vs %s, tolerance %.0e > %.0e\"%(astr, bstr, RIFtol(actual).center(), RIFtol(desired).center())\n\n                fails = []\n                for a, ainterval, b, astr, bstr in zip(want_values, want_intervals, got_values, want_str, got_str):\n                    if not ainterval.overlaps(b):\n                        if want.tol:\n                            if a == 0:\n                                fails.append(failstr(astr, bstr, abs(b), want.tol))\n                            else:\n                                fails.append(failstr(astr, bstr, abs(1 - b/a), want.tol))\n                        elif want.abs_tol:\n                            fails.append(failstr(astr, bstr, abs(a - b), want.abs_tol))\n                        else:\n                            fails.append(failstr(astr, bstr, abs(1 - b/a), want.rel_tol))\n\n                if fails:\n                    if len(want_values) == 1:\n                        diff += \"Tolerance exceeded:\\n\"\n                    else:\n                        diff += \"Tolerance exceeded in %s of %s:\\n\"%(len(fails), len(want_values))\n                    diff += \"\\n\".join(fails) + \"\\n\"\n        return diff\n```\n(A method of class `SageOutputChecker` in `src/sage/doctest/parsing.py`.)\n\nOne could also change the code below its definition rather than (just) `failstr()`.",
    "created_at": "2016-08-13T12:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307629",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

The culprit (at least regarding the weird ouput) is here, namely in the local function `failstr()`:

```python
    def output_difference(self, example, got, optionflags):
        r""" ... """
        got = self.human_readable_escape_sequences(got)
        want = example.want
        diff = doctest.OutputChecker.output_difference(self, example, got, optionflags)
        if isinstance(want, MarkedOutput) and (want.tol or want.abs_tol or want.rel_tol):
            if diff[-1] != "\n":
                diff += "\n"
            want_str = [g[0] for g in float_regex.findall(want)]
            got_str = [g[0] for g in float_regex.findall(got)]
            want_values = [RIFtol(g) for g in want_str]
            want_intervals = [self.add_tolerance(v, want) for v in want_values]
            got_values = [RIFtol(g) for g in got_str]
            if len(want_values) == len(got_values):
                def failstr(astr, bstr, actual, desired):
                    return "    %s vs %s, tolerance %.0e > %.0e"%(astr, bstr, RIFtol(actual).center(), RIFtol(desired).center())

                fails = []
                for a, ainterval, b, astr, bstr in zip(want_values, want_intervals, got_values, want_str, got_str):
                    if not ainterval.overlaps(b):
                        if want.tol:
                            if a == 0:
                                fails.append(failstr(astr, bstr, abs(b), want.tol))
                            else:
                                fails.append(failstr(astr, bstr, abs(1 - b/a), want.tol))
                        elif want.abs_tol:
                            fails.append(failstr(astr, bstr, abs(a - b), want.abs_tol))
                        else:
                            fails.append(failstr(astr, bstr, abs(1 - b/a), want.rel_tol))

                if fails:
                    if len(want_values) == 1:
                        diff += "Tolerance exceeded:\n"
                    else:
                        diff += "Tolerance exceeded in %s of %s:\n"%(len(fails), len(want_values))
                    diff += "\n".join(fails) + "\n"
        return diff
```
(A method of class `SageOutputChecker` in `src/sage/doctest/parsing.py`.)

One could also change the code below its definition rather than (just) `failstr()`.



---

archive/issue_comments_307630.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n(As is, `failstr()` truncates the mantissa to *just one digit*, i.e., the digit before the decimal point.)",
    "created_at": "2016-08-13T13:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307630",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

(As is, `failstr()` truncates the mantissa to *just one digit*, i.e., the digit before the decimal point.)



---

archive/issue_comments_307631.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI.e., we should **at least** make sure `\"%.0e\" % RIFtol(actual).center()` doesn't give the same as `\"%.0e\" % RIFtol(desired).center()`.  (Not sure whether using `.center()` here is at all the right thing, or whether we should at all use `RIF` for the *tolerance values* themselves; see also below.)\n\nIf it does, we may increase the number of (mantissa) digits in the former.  Or in both, until they differ.\n\nAnd that's orthogonal to improving hints regarding the actual deviation, i.e., if one wants to adjust the *expected figures* rather than (just) the tolerance.\n\nIf the intervals of *want* and *got* do not overlap (i.e., when the tolerance is exceeded), we could also give `.upper()` and `.lower()` (or vice versa, depending on whether *want* is smaller or larger than *got*).",
    "created_at": "2016-08-13T13:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307631",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

I.e., we should **at least** make sure `"%.0e" % RIFtol(actual).center()` doesn't give the same as `"%.0e" % RIFtol(desired).center()`.  (Not sure whether using `.center()` here is at all the right thing, or whether we should at all use `RIF` for the *tolerance values* themselves; see also below.)

If it does, we may increase the number of (mantissa) digits in the former.  Or in both, until they differ.

And that's orthogonal to improving hints regarding the actual deviation, i.e., if one wants to adjust the *expected figures* rather than (just) the tolerance.

If the intervals of *want* and *got* do not overlap (i.e., when the tolerance is exceeded), we could also give `.upper()` and `.lower()` (or vice versa, depending on whether *want* is smaller or larger than *got*).



---

archive/issue_comments_307632.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -42,5 +42,5 @@\n     **********************************************************************\n     ...\n ```\n-(Note the `1e-06 > 1e-06` there.)\n+(Note the `1e-06 > 1e-06` there.  And there are even more of this kind in `src/sage/doctest/parsing.py`.)\n \n``````\n",
    "created_at": "2016-08-13T14:03:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307632",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -42,5 +42,5 @@
     **********************************************************************
     ...
 ```
-(Note the `1e-06 > 1e-06` there.)
+(Note the `1e-06 > 1e-06` there.  And there are even more of this kind in `src/sage/doctest/parsing.py`.)
 
``````




---

archive/issue_comments_307633.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWith\n\n```diff\ndiff --git a/src/sage/doctest/parsing.py b/src/sage/doctest/parsing.py\nindex b297bb1..def1e31 100644\n--- a/src/sage/doctest/parsing.py\n+++ b/src/sage/doctest/parsing.py\n@@ -963,8 +963,19 @@ class SageOutputChecker(doctest.OutputChecker):\n             want_intervals = [self.add_tolerance(v, want) for v in want_values]\n             got_values = [RIFtol(g) for g in got_str]\n             if len(want_values) == len(got_values):\n+\n                 def failstr(astr, bstr, actual, desired):\n-                    return \"    %s vs %s, tolerance %.0e > %.0e\"%(astr, bstr, RIFtol(actual).center(), RIFtol(desired).\n+                    # Do not print 'x > x' (#21121):\n+                    dp = 0 # start with zero decimal places in output of tolerance\n+                    while True: # XXX kind of dangerous...\n+                        allowed_tol = \"%.*e\" % (dp, RIFtol(desired).center())\n+                        effective_tol = \"%.*e\" % (dp, RIFtol(actual).center())\n+                        if allowed_tol != effective_tol:\n+                            # we achieved meaningful output\n+                            break\n+                        dp += 1 # increase number of decimal places to be shown\n+\n+                    return \"    %s vs %s, tolerance %s > %s\"%(astr, bstr, effective_tol, allowed_tol)\n \n                 fails = []\n                 for a, ainterval, b, astr, bstr in zip(want_values, want_intervals, got_values, want_str, got_str):\n```\nI would for example get the following for the failing test from the ticket's description / #21119:\n\n```\nsage -t src/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix_double_dense.pyx\", line 3761, in sage.matrix.matrix_double_dense.Matrix_double_dense.exp\nFailed example:\n    A.exp()  # tol 1e-14\nExpected:\n    [-19.614602953804912 + 12.517743846762578*I   3.7949636449582176 + 28.88379930658099*I]\n    [ -32.383580980922254 + 21.88423595789845*I   2.269633004093535 + 44.901324827684824*I]\nGot:\n    [-19.614602953804923 + 12.517743846762574*I  3.7949636449582007 + 28.883799306580993*I]\n    [-32.383580980922275 + 21.884235957898447*I  2.2696330040935115 + 44.901324827684846*I]\nTolerance exceeded in 1 of 8:\n    2.269633004093535 vs 2.2696330040935115, tolerance 1.04e-14 > 1.00e-14\n**********************************************************************\n```\n\nAFAICT, we unfortunately *there* do not know whether `# tol 1e-14` or e.g. `# tol 1.0e-14` was specified in the failing doctest.",
    "created_at": "2016-08-13T14:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307633",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

With

```diff
diff --git a/src/sage/doctest/parsing.py b/src/sage/doctest/parsing.py
index b297bb1..def1e31 100644
--- a/src/sage/doctest/parsing.py
+++ b/src/sage/doctest/parsing.py
@@ -963,8 +963,19 @@ class SageOutputChecker(doctest.OutputChecker):
             want_intervals = [self.add_tolerance(v, want) for v in want_values]
             got_values = [RIFtol(g) for g in got_str]
             if len(want_values) == len(got_values):
+
                 def failstr(astr, bstr, actual, desired):
-                    return "    %s vs %s, tolerance %.0e > %.0e"%(astr, bstr, RIFtol(actual).center(), RIFtol(desired).
+                    # Do not print 'x > x' (#21121):
+                    dp = 0 # start with zero decimal places in output of tolerance
+                    while True: # XXX kind of dangerous...
+                        allowed_tol = "%.*e" % (dp, RIFtol(desired).center())
+                        effective_tol = "%.*e" % (dp, RIFtol(actual).center())
+                        if allowed_tol != effective_tol:
+                            # we achieved meaningful output
+                            break
+                        dp += 1 # increase number of decimal places to be shown
+
+                    return "    %s vs %s, tolerance %s > %s"%(astr, bstr, effective_tol, allowed_tol)
 
                 fails = []
                 for a, ainterval, b, astr, bstr in zip(want_values, want_intervals, got_values, want_str, got_str):
```
I would for example get the following for the failing test from the ticket's description / #21119:

```
sage -t src/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "src/sage/matrix/matrix_double_dense.pyx", line 3761, in sage.matrix.matrix_double_dense.Matrix_double_dense.exp
Failed example:
    A.exp()  # tol 1e-14
Expected:
    [-19.614602953804912 + 12.517743846762578*I   3.7949636449582176 + 28.88379930658099*I]
    [ -32.383580980922254 + 21.88423595789845*I   2.269633004093535 + 44.901324827684824*I]
Got:
    [-19.614602953804923 + 12.517743846762574*I  3.7949636449582007 + 28.883799306580993*I]
    [-32.383580980922275 + 21.884235957898447*I  2.2696330040935115 + 44.901324827684846*I]
Tolerance exceeded in 1 of 8:
    2.269633004093535 vs 2.2696330040935115, tolerance 1.04e-14 > 1.00e-14
**********************************************************************
```

AFAICT, we unfortunately *there* do not know whether `# tol 1e-14` or e.g. `# tol 1.0e-14` was specified in the failing doctest.



---

archive/issue_comments_307634.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nTo do:\n\nReplace `True` by `dp <= some_meaningful_number` and `break` by `return ...` (returning what's now returned below, after the loop).\n\nThen if we exit the `while` loop (giving up on too many decimal places), fall back to returning some other (meaningful) output, of course again other than `... x > x`.",
    "created_at": "2016-08-13T14:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307634",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

To do:

Replace `True` by `dp <= some_meaningful_number` and `break` by `return ...` (returning what's now returned below, after the loop).

Then if we exit the `while` loop (giving up on too many decimal places), fall back to returning some other (meaningful) output, of course again other than `... x > x`.



---

archive/issue_comments_307635.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n... and the mentioned doctests for the doctest framework itself of course need to get adjusted to the new output.",
    "created_at": "2016-08-13T14:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307635",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

... and the mentioned doctests for the doctest framework itself of course need to get adjusted to the new output.



---

archive/issue_comments_307636.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYou just need to print the numbers with directed roundings (up/down). But that needs #21124 to properly print the numbers.",
    "created_at": "2016-08-15T08:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307636",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

You just need to print the numbers with directed roundings (up/down). But that needs #21124 to properly print the numbers.



---

archive/issue_comments_307637.json:
```json
{
    "body": "Branch: **[u/jdemeyer/precision_in_doctest_tolerance__x___x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/precision_in_doctest_tolerance__x___x)**",
    "created_at": "2018-08-29T09:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307637",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/precision_in_doctest_tolerance__x___x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/precision_in_doctest_tolerance__x___x)**



---

archive/issue_comments_307638.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779\"><code>a9909ab</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307638",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779"><code>a9909ab</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307639.json:
```json
{
    "body": "Commit: **[`a9909ab`](https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779)**",
    "created_at": "2018-08-29T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307639",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`a9909ab`](https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779)**



---

archive/issue_comments_307640.json:
```json
{
    "body": "Changed dependencies from **#21124** to **#26154**",
    "created_at": "2018-08-29T10:36:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307640",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#21124** to **#26154**



---

archive/issue_comments_307641.json:
```json
{
    "body": "Changed commit from **[`a9909ab`](https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779)** to **[`e1ba5b7`](https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca)**",
    "created_at": "2018-08-29T10:43:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307641",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a9909ab`](https://github.com/sagemath/sagetrac-mirror/commit/a9909ab60eb35282534e545ee1e7ec633601c779)** to **[`e1ba5b7`](https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca)**



---

archive/issue_comments_307642.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7fcc109a4f931546011cbdae4f56e579d00d69d3\"><code>7fcc109</code></a></td><td><code>Omit point when printing real numbers in scientific notation with 1 digit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca\"><code>e1ba5b7</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T10:43:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307642",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7fcc109a4f931546011cbdae4f56e579d00d69d3"><code>7fcc109</code></a></td><td><code>Omit point when printing real numbers in scientific notation with 1 digit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca"><code>e1ba5b7</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307643.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2\"><code>a636d1e</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T11:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307643",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2"><code>a636d1e</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307644.json:
```json
{
    "body": "Changed commit from **[`e1ba5b7`](https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca)** to **[`a636d1e`](https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2)**",
    "created_at": "2018-08-29T11:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307644",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e1ba5b7`](https://github.com/sagemath/sagetrac-mirror/commit/e1ba5b73f39a47446d01581550ccf2a4259f14ca)** to **[`a636d1e`](https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2)**



---

archive/issue_events_294368.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-29T11:22:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294368"
}
```



---

archive/issue_events_294369.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-29T11:22:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294369"
}
```



---

archive/issue_comments_307645.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,36 +11,13 @@\n Tolerance exceeded in 1 of 8:\n     2.269633004093535 vs 2.2696330040935115, tolerance 1e-14 > 1e-14\n ```\n-\\\\\n \n-Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid; either the doctesting framework should be more tolerant here, or give better messages regarding the deviation.\n+Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid.\n \n-(Inspired by #21119.)\n+The attached branch fixes this by displaying `y > x` where:\n \n----\n+- `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.\n \n-Just noticed there's even a doctest *expecting* this obviously wrong output in `src/sage/doctest/test.py`:\n+- `y` is the observed tolerance (computed by running the test) with one digit, rounded up. This means that using `# tol y` is guaranteed to make the test pass.\n \n-```sh\n-Check handling of tolerances::\n-\n-    sage: subprocess.call([\"sage\", \"-t\", \"--warn-long\", \"0\", \"tolerance.rst\"], **kwds)  # long time\n-    Running doctests...\n-    Doctesting 1 file.\n-    sage -t --warn-long 0.0 tolerance.rst\n-    ...\n-    **********************************************************************\n-    File \"tolerance.rst\", line ..., in sage.doctest.tests.tolerance\n-    Failed example:\n-        print(\"Hello 1.0\")  # rel tol 1e-6\n-    Expected:\n-        Goodbye 0.999999\n-    Got:\n-        Hello 1.0\n-    Tolerance exceeded:\n-        0.999999 vs 1.0, tolerance 1e-06 > 1e-06\n-    **********************************************************************\n-    ...\n-```\n-(Note the `1e-06 > 1e-06` there.  And there are even more of this kind in `src/sage/doctest/parsing.py`.)\n-\n+Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n``````\n",
    "created_at": "2018-08-29T11:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307645",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,36 +11,13 @@
 Tolerance exceeded in 1 of 8:
     2.269633004093535 vs 2.2696330040935115, tolerance 1e-14 > 1e-14
 ```
-\\
 
-Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid; either the doctesting framework should be more tolerant here, or give better messages regarding the deviation.
+Sage saying that 10<sup>-14</sup> > 10<sup>-14</sup> appears a bit stupid.
 
-(Inspired by #21119.)
+The attached branch fixes this by displaying `y > x` where:
 
----
+- `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.
 
-Just noticed there's even a doctest *expecting* this obviously wrong output in `src/sage/doctest/test.py`:
+- `y` is the observed tolerance (computed by running the test) with one digit, rounded up. This means that using `# tol y` is guaranteed to make the test pass.
 
-```sh
-Check handling of tolerances::
-
-    sage: subprocess.call(["sage", "-t", "--warn-long", "0", "tolerance.rst"], **kwds)  # long time
-    Running doctests...
-    Doctesting 1 file.
-    sage -t --warn-long 0.0 tolerance.rst
-    ...
-    **********************************************************************
-    File "tolerance.rst", line ..., in sage.doctest.tests.tolerance
-    Failed example:
-        print("Hello 1.0")  # rel tol 1e-6
-    Expected:
-        Goodbye 0.999999
-    Got:
-        Hello 1.0
-    Tolerance exceeded:
-        0.999999 vs 1.0, tolerance 1e-06 > 1e-06
-    **********************************************************************
-    ...
-```
-(Note the `1e-06 > 1e-06` there.  And there are even more of this kind in `src/sage/doctest/parsing.py`.)
-
+Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.
``````




---

archive/issue_comments_307646.json:
```json
{
    "body": "Changed keywords from **doctest error exceeded** to **doctest tolerance exceeded**",
    "created_at": "2018-08-29T11:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307646",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **doctest error exceeded** to **doctest tolerance exceeded**



---

archive/issue_events_294370.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-29T11:22:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294370"
}
```



---

archive/issue_comments_307647.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2018-08-29T11:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307647",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_307648.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,6 @@\n \n - `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.\n \n-- `y` is the observed tolerance (computed by running the test) with one digit, rounded up. This means that using `# tol y` is guaranteed to make the test pass.\n+- `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.\n \n Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n``````\n",
    "created_at": "2018-08-29T11:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307648",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,6 @@
 
 - `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.
 
-- `y` is the observed tolerance (computed by running the test) with one digit, rounded up. This means that using `# tol y` is guaranteed to make the test pass.
+- `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.
 
 Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.
``````




---

archive/issue_comments_307649.json:
```json
{
    "body": "Changed commit from **[`a636d1e`](https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2)** to **[`cb74112`](https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1)**",
    "created_at": "2018-08-29T12:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307649",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a636d1e`](https://github.com/sagemath/sagetrac-mirror/commit/a636d1ee3c389f7270652db664e4b5ecfc388fd2)** to **[`cb74112`](https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1)**



---

archive/issue_comments_307650.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1\"><code>cb74112</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T12:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307650",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1"><code>cb74112</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307651.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,3 +21,7 @@\n - `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.\n \n Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n+\n+We also refactor the implementation for printing tolerance errors somewhat.\n+\n+Finally, we use 1044 bits of precision to compute tolerances. This may seem overkill, but it is needed if we want to deal with tolerances on numbers computed with 1024 bits of precision.\n``````\n",
    "created_at": "2018-08-29T12:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307651",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,3 +21,7 @@
 - `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.
 
 Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.
+
+We also refactor the implementation for printing tolerance errors somewhat.
+
+Finally, we use 1044 bits of precision to compute tolerances. This may seem overkill, but it is needed if we want to deal with tolerances on numbers computed with 1024 bits of precision.
``````




---

archive/issue_comments_307652.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,11 +16,11 @@\n \n The attached branch fixes this by displaying `y > x` where:\n \n-- `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.\n+- `x` is the required tolerance (given in the doctest) with 15 digits, rounded to nearest.\n \n-- `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.\n+- `y` is the observed tolerance (computed by running the test) with 1 digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.\n \n-Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n+Assuming that the tolerance in the doctest is given to at most 15 digits of precision (almost certainly the case), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.\n \n We also refactor the implementation for printing tolerance errors somewhat.\n \n``````\n",
    "created_at": "2018-08-29T12:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307652",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,11 +16,11 @@
 
 The attached branch fixes this by displaying `y > x` where:
 
-- `x` is the required tolerance (given in the doctest) with one digit, rounded to nearest.
+- `x` is the required tolerance (given in the doctest) with 15 digits, rounded to nearest.
 
-- `y` is the observed tolerance (computed by running the test) with one digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.
+- `y` is the observed tolerance (computed by running the test) with 1 digit, **rounded up**. This means that using `# tol y` is guaranteed to make the test pass.
 
-Assuming that the tolerance in the doctest is given to one digit of precision (which is very typical), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.
+Assuming that the tolerance in the doctest is given to at most 15 digits of precision (almost certainly the case), `x` should be exactly what was in the doctest. In that case, `y` cannot be equal to `x`.
 
 We also refactor the implementation for printing tolerance errors somewhat.
 
``````




---

archive/issue_comments_307653.json:
```json
{
    "body": "Changed commit from **[`cb74112`](https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1)** to **[`dd60a2e`](https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6)**",
    "created_at": "2018-08-29T12:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307653",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb74112`](https://github.com/sagemath/sagetrac-mirror/commit/cb741123f8dec1849052c88b47dbc50caf3f6ab1)** to **[`dd60a2e`](https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6)**



---

archive/issue_comments_307654.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6\"><code>dd60a2e</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T12:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307654",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6"><code>dd60a2e</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307655.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd\"><code>5535d2d</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2018-08-29T14:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307655",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd"><code>5535d2d</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307656.json:
```json
{
    "body": "Changed commit from **[`dd60a2e`](https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6)** to **[`5535d2d`](https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd)**",
    "created_at": "2018-08-29T14:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307656",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dd60a2e`](https://github.com/sagemath/sagetrac-mirror/commit/dd60a2e10199532a02bf591a41644df64d9ebef6)** to **[`5535d2d`](https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd)**



---

archive/issue_comments_307657.json:
```json
{
    "body": "Changed commit from **[`5535d2d`](https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd)** to **[`b76623d`](https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360)**",
    "created_at": "2019-01-11T13:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307657",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5535d2d`](https://github.com/sagemath/sagetrac-mirror/commit/5535d2de60d94021d0332369e9cbe9ddc9e32cfd)** to **[`b76623d`](https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360)**



---

archive/issue_comments_307658.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360\"><code>b76623d</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2019-01-11T13:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307658",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360"><code>b76623d</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307659.json:
```json
{
    "body": "Changed dependencies from **#26154** to none",
    "created_at": "2019-01-11T13:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307659",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#26154** to none



---

archive/issue_comments_307660.json:
```json
{
    "body": "Changed commit from **[`b76623d`](https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360)** to **[`e62891b`](https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e)**",
    "created_at": "2019-01-25T10:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307660",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b76623d`](https://github.com/sagemath/sagetrac-mirror/commit/b76623dc03e4d81ff303eac219ad5c907a4c2360)** to **[`e62891b`](https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e)**



---

archive/issue_comments_307661.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e\"><code>e62891b</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2019-01-25T10:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307661",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e"><code>e62891b</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307662.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2019-01-26T09:39:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307662",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_events_294371.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-26T09:39:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294371"
}
```



---

archive/issue_events_294372.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-26T09:39:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294372"
}
```



---

archive/issue_comments_307663.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nLGTM (except that \u201cit is carries\u201d in the comment should be \u201cit carries\u201d).",
    "created_at": "2019-01-26T09:39:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307663",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:25" align="right">comment:25</div>

LGTM (except that it is carries in the comment should be it carries).



---

archive/issue_events_294373.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-01-26T09:55:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294373"
}
```



---

archive/issue_events_294374.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-01-26T09:55:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294374"
}
```



---

archive/issue_comments_307664.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216\"><code>d7f0862</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>\n",
    "created_at": "2019-01-26T09:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307664",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216"><code>d7f0862</code></a></td><td><code>Improve output formatting for tolerances</code></td></tr></table>




---

archive/issue_comments_307665.json:
```json
{
    "body": "Changed commit from **[`e62891b`](https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e)** to **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**",
    "created_at": "2019-01-26T09:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307665",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e62891b`](https://github.com/sagemath/sagetrac-mirror/commit/e62891b0edc5754465df192ebb174938a7706e9e)** to **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**



---

archive/issue_events_294375.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-26T09:55:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294375"
}
```



---

archive/issue_events_294376.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-26T09:55:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294376"
}
```



---

archive/issue_comments_307666.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nFixed typo",
    "created_at": "2019-01-26T09:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307666",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Fixed typo



---

archive/issue_comments_307667.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/precision_in_doctest_tolerance__x___x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/precision_in_doctest_tolerance__x___x)** to **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**",
    "created_at": "2019-01-27T10:50:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21121#issuecomment-307667",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/precision_in_doctest_tolerance__x___x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/precision_in_doctest_tolerance__x___x)** to **[`d7f0862`](https://github.com/sagemath/sagetrac-mirror/commit/d7f08627df8903903f2b42ed461e4ba0b477b216)**



---

archive/issue_events_294377.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-27T10:50:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294377"
}
```



---

archive/issue_events_294378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2258aca437fc8399ee0cb7e8fbbf79d1adf0f3ed",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-27T10:50:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21121",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21121#event-294378"
}
```
