# Issue 21191: Improve support for warnings in doctester

archive/issues_020954.json:
```json
{
    "assignees": [],
    "body": "When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.\n\nSecond, we display a complete traceback instead of just the warning message for warnings raised while doctesting.\n\nCC:  @tscrim @fchapoton\n\nBranch/Commit: **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21191_\n\n",
    "closed_at": "2016-08-21T23:39:36Z",
    "created_at": "2016-08-08T13:13:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve support for warnings in doctester",
    "type": "issue",
    "updated_at": "2016-08-21T23:39:36Z",
    "url": "https://github.com/sagemath/sage/issues/21191",
    "user": "https://github.com/jdemeyer"
}
```
When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.

Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.

CC:  @tscrim @fchapoton

Branch/Commit: **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**

Reviewer: **Frédéric Chapoton**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/21191_





---

archive/issue_events_280041.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-08T13:13:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280041"
}
```



---

archive/issue_events_280042.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-08T13:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "component: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280042"
}
```



---

archive/issue_events_280043.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-08T13:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280043"
}
```



---

archive/issue_events_280044.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-08T13:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280044"
}
```



---

archive/issue_comments_311627.json:
```json
{
    "body": "Branch: **[u/jdemeyer/improve_support_for_warnings_in_doctester](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_support_for_warnings_in_doctester)**",
    "created_at": "2016-08-16T11:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311627",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/improve_support_for_warnings_in_doctester](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_support_for_warnings_in_doctester)**



---

archive/issue_comments_311628.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f\">7b77cad</a></td><td><code>Improve warnings in doctester</code></td></tr></table>\n",
    "created_at": "2016-08-16T12:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311628",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f">7b77cad</a></td><td><code>Improve warnings in doctester</code></td></tr></table>




---

archive/issue_comments_311629.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-When a warning happens in the doctester, the source filename is always replaced by `doctest`.\n+When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.\n \n-We should also investigate whether we can display a more complete traceback instead of just the warning message.\n+Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.\n``````\n",
    "created_at": "2016-08-16T12:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311629",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-When a warning happens in the doctester, the source filename is always replaced by `doctest`.
+When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.
 
-We should also investigate whether we can display a more complete traceback instead of just the warning message.
+Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.
``````




---

archive/issue_comments_311630.json:
```json
{
    "body": "Commit: **[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)**",
    "created_at": "2016-08-16T12:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311630",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)**



---

archive/issue_events_280045.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-16T12:17:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280045"
}
```



---

archive/issue_comments_311631.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThe link\n\n```\n+    INPUT: see :func:`warnings.showwarning`.\n```\nshould rather be to doctest_showwarning, no ?",
    "created_at": "2016-08-17T08:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311631",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">Comment 4</div>

The link

```
+    INPUT: see :func:`warnings.showwarning`.
```
should rather be to doctest_showwarning, no ?



---

archive/issue_comments_311632.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nIs it only for doctests? As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for \"regular\" use as well and perhaps that fix should be done in IPython if possible.",
    "created_at": "2016-08-18T03:40:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311632",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:5" align="right">Comment 5</div>

Is it only for doctests? As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for "regular" use as well and perhaps that fix should be done in IPython if possible.



---

archive/issue_comments_311633.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@fchapoton](#comment%3A4):\n> The link\n> \n> ```\n> +    INPUT: see :func:`warnings.showwarning`.\n> ```\n> should rather be to doctest_showwarning, no ?\n\nNo, it is supposed to be a link to https://docs.python.org/2/library/warnings.html#warnings.showwarning",
    "created_at": "2016-08-18T08:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311633",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@fchapoton](#comment%3A4):
> The link
> 
> ```
> +    INPUT: see :func:`warnings.showwarning`.
> ```
> should rather be to doctest_showwarning, no ?

No, it is supposed to be a link to https://docs.python.org/2/library/warnings.html#warnings.showwarning



---

archive/issue_comments_311634.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@novoselt](#comment%3A5):\n> Is it only for doctests?\n\nYes.\n\n> As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for \"regular\" use as well and perhaps that fix should be done in IPython if possible.\n\nWell, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...",
    "created_at": "2016-08-18T08:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311634",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@novoselt](#comment%3A5):
> Is it only for doctests?

Yes.

> As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for "regular" use as well and perhaps that fix should be done in IPython if possible.

Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...



---

archive/issue_comments_311635.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@jdemeyer](#comment%3A7):\n> Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...\n\nOh, I saw the beginning and it seemed objections were to long traceback for warnings. I didn't think anyone can object to displaying correct line over wrong one...",
    "created_at": "2016-08-19T02:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311635",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@jdemeyer](#comment%3A7):
> Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...

Oh, I saw the beginning and it seemed objections were to long traceback for warnings. I didn't think anyone can object to displaying correct line over wrong one...



---

archive/issue_comments_311636.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIn any case, this ticket only affects doctests. We can still deal with the command-line if we want, but in a different ticket.",
    "created_at": "2016-08-19T12:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311636",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

In any case, this ticket only affects doctests. We can still deal with the command-line if we want, but in a different ticket.



---

archive/issue_comments_311637.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThere seems to be a handful of failing doctests, see bot",
    "created_at": "2016-08-19T13:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311637",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">Comment 10</div>

There seems to be a handful of failing doctests, see bot



---

archive/issue_comments_311638.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a\">2c5dae8</a></td><td><code>Print warnings to stdout instead of stderr</code></td></tr></table>\n",
    "created_at": "2016-08-19T15:46:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311638",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11" align="right">Comment 11</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a">2c5dae8</a></td><td><code>Print warnings to stdout instead of stderr</code></td></tr></table>




---

archive/issue_comments_311639.json:
```json
{
    "body": "Changed commit from **[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)** to **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**",
    "created_at": "2016-08-19T15:46:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311639",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)** to **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**



---

archive/issue_comments_311640.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2016-08-20T12:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311640",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_280046.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-20T12:21:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280046"
}
```



---

archive/issue_events_280047.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-20T12:21:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280047"
}
```



---

archive/issue_comments_311641.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nlgtm",
    "created_at": "2016-08-20T12:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311641",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">Comment 12</div>

lgtm



---

archive/issue_events_280048.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-21T23:39:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280048"
}
```



---

archive/issue_events_280049.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "514bd1ae0c39dff0e6a54bef68d38194c44e6fe4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-21T23:39:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21191#event-280049"
}
```



---

archive/issue_comments_311642.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/improve_support_for_warnings_in_doctester](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_support_for_warnings_in_doctester)** to **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**",
    "created_at": "2016-08-21T23:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21191#issuecomment-311642",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/improve_support_for_warnings_in_doctester](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_support_for_warnings_in_doctester)** to **[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)**
