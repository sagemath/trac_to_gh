# Issue 21191: Improve support for warnings in doctester

archive/issues_020954.json:
```json
{
    "body": "When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.\n\nSecond, we display a complete traceback instead of just the warning message for warnings raised while doctesting.\n\nCC:  @tscrim @fchapoton\n\nBranch/Commit: 2c5dae819d7ec13774f4e7a19925e7b844f7285a\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21191\n\n",
    "closed_at": "2016-08-21T23:39:36Z",
    "created_at": "2016-08-08T13:13:56Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Improve support for warnings in doctester",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21191",
    "user": "https://github.com/jdemeyer"
}
```
When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.

Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.

CC:  @tscrim @fchapoton

Branch/Commit: 2c5dae819d7ec13774f4e7a19925e7b844f7285a

Reviewer: Frédéric Chapoton

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21191





---

archive/issue_comments_383210.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/improve_support_for_warnings_in_doctester\"",
    "created_at": "2016-08-16T11:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383210",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/improve_support_for_warnings_in_doctester"



---

archive/issue_comments_383211.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)|`Improve warnings in doctester`|",
    "created_at": "2016-08-16T12:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383211",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[7b77cad](https://github.com/sagemath/sagetrac-mirror/commit/7b77cada90c47df4301480a298fc2f95c7eaf79f)|`Improve warnings in doctester`|



---

archive/issue_comments_383212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-When a warning happens in the doctester, the source filename is always replaced by `doctest`.\n+When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.\n \n-We should also investigate whether we can display a more complete traceback instead of just the warning message.\n+Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.\n``````\n",
    "created_at": "2016-08-16T12:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383212",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-When a warning happens in the doctester, the source filename is always replaced by `doctest`.
+When a warning happens in the doctester, the source filename is always replaced by `doctest`. This should be fixed.
 
-We should also investigate whether we can display a more complete traceback instead of just the warning message.
+Second, we display a complete traceback instead of just the warning message for warnings raised while doctesting.
``````




---

archive/issue_comments_383213.json:
```json
{
    "body": "Changing commit from \"\" to \"7b77cada90c47df4301480a298fc2f95c7eaf79f\"",
    "created_at": "2016-08-16T12:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383213",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "7b77cada90c47df4301480a298fc2f95c7eaf79f"



---

archive/issue_comments_383214.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-16T12:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383214",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_383215.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe link\n\n```\n+    INPUT: see :func:`warnings.showwarning`.\n```\nshould rather be to doctest_showwarning, no ?",
    "created_at": "2016-08-17T08:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383215",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
The link

```
+    INPUT: see :func:`warnings.showwarning`.
```
should rather be to doctest_showwarning, no ?



---

archive/issue_comments_383216.json:
```json
{
    "body": "<a id='comment:5'></a>\nIs it only for doctests? As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for \"regular\" use as well and perhaps that fix should be done in IPython if possible.",
    "created_at": "2016-08-18T03:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383216",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
Is it only for doctests? As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for "regular" use as well and perhaps that fix should be done in IPython if possible.



---

archive/issue_comments_383217.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [chapoton](#comment%3A4):\n> The link\n> \n> ```\n> +    INPUT: see :func:`warnings.showwarning`.\n> ```\n> should rather be to doctest_showwarning, no ?\n\n\nNo, it is supposed to be a link to https://docs.python.org/2/library/warnings.html#warnings.showwarning",
    "created_at": "2016-08-18T08:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383217",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [chapoton](#comment%3A4):
> The link
> 
> ```
> +    INPUT: see :func:`warnings.showwarning`.
> ```
> should rather be to doctest_showwarning, no ?


No, it is supposed to be a link to https://docs.python.org/2/library/warnings.html#warnings.showwarning



---

archive/issue_comments_383218.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [novoselt](#comment%3A5):\n> Is it only for doctests?\n\n\nYes.\n\n> As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for \"regular\" use as well and perhaps that fix should be done in IPython if possible.\n\n\nWell, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...",
    "created_at": "2016-08-18T08:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383218",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [novoselt](#comment%3A5):
> Is it only for doctests?


Yes.

> As I have complained here https://groups.google.com/d/topic/sage-devel/-KiMrG--5x8/discussion it would be nice to have it for "regular" use as well and perhaps that fix should be done in IPython if possible.


Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...



---

archive/issue_comments_383219.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jdemeyer](#comment%3A7):\n> Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...\n\n\nOh, I saw the beginning and it seemed objections were to long traceback for warnings. I didn't think anyone can object to displaying correct line over wrong one...",
    "created_at": "2016-08-19T02:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383219",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:8'></a>
Replying to [jdemeyer](#comment%3A7):
> Well, there was some discussion on sage-devel and other people considered it a bad idea in interactive usage...


Oh, I saw the beginning and it seemed objections were to long traceback for warnings. I didn't think anyone can object to displaying correct line over wrong one...



---

archive/issue_comments_383220.json:
```json
{
    "body": "<a id='comment:9'></a>\nIn any case, this ticket only affects doctests. We can still deal with the command-line if we want, but in a different ticket.",
    "created_at": "2016-08-19T12:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383220",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
In any case, this ticket only affects doctests. We can still deal with the command-line if we want, but in a different ticket.



---

archive/issue_comments_383221.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere seems to be a handful of failing doctests, see bot",
    "created_at": "2016-08-19T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383221",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
There seems to be a handful of failing doctests, see bot



---

archive/issue_comments_383222.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)|`Print warnings to stdout instead of stderr`|",
    "created_at": "2016-08-19T15:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[2c5dae8](https://github.com/sagemath/sagetrac-mirror/commit/2c5dae819d7ec13774f4e7a19925e7b844f7285a)|`Print warnings to stdout instead of stderr`|



---

archive/issue_comments_383223.json:
```json
{
    "body": "Changing commit from \"7b77cada90c47df4301480a298fc2f95c7eaf79f\" to \"2c5dae819d7ec13774f4e7a19925e7b844f7285a\"",
    "created_at": "2016-08-19T15:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7b77cada90c47df4301480a298fc2f95c7eaf79f" to "2c5dae819d7ec13774f4e7a19925e7b844f7285a"



---

archive/issue_comments_383224.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2016-08-20T12:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383224",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_383225.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-20T12:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383225",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_383226.json:
```json
{
    "body": "<a id='comment:12'></a>\nlgtm",
    "created_at": "2016-08-20T12:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383226",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
lgtm



---

archive/issue_events_072064.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-21T23:39:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21191#event-72064"
}
```



---

archive/issue_comments_383227.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-21T23:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383227",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_383228.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/improve_support_for_warnings_in_doctester\" to \"2c5dae819d7ec13774f4e7a19925e7b844f7285a\"",
    "created_at": "2016-08-21T23:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21191#issuecomment-383228",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/improve_support_for_warnings_in_doctester" to "2c5dae819d7ec13774f4e7a19925e7b844f7285a"
