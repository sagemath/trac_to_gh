# Issue 21166: Improving speed of AffineGometryDesign

archive/issues_020929.json:
```json
{
    "body": "In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. We implement a direct construction instead of using GAP.\n\nCC:  @videlec @dimpase\n\nBranch/Commit: [3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)\n\nReviewer: Dima Pasechnik\n\nAuthor: Vincent Delecroix\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21166\n\n",
    "closed_at": "2016-09-04T00:13:30Z",
    "created_at": "2016-08-04T14:18:59Z",
    "labels": [
        "component: combinatorial designs",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Improving speed of AffineGometryDesign",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21166",
    "user": "https://trac.sagemath.org/admin/accounts/users/rschrecker"
}
```
In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. We implement a direct construction instead of using GAP.

CC:  @videlec @dimpase

Branch/Commit: [3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)

Reviewer: Dima Pasechnik

Author: Vincent Delecroix

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21166





---

archive/issue_comments_390778.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In sage.combinat.designs.block_designs, AffineGeometryDesign is far slower than ProjectiveGeometryDesign. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign\n+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign\n``````\n",
    "created_at": "2016-08-04T16:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390778",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-In sage.combinat.designs.block_designs, AffineGeometryDesign is far slower than ProjectiveGeometryDesign. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign
+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign
``````




---

archive/issue_comments_390779.json:
```json
{
    "body": "Branch: [u/dimpase/affgeom_speedup](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/affgeom_speedup)",
    "created_at": "2016-08-08T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390779",
    "user": "https://github.com/dimpase"
}
```

Branch: [u/dimpase/affgeom_speedup](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/affgeom_speedup)



---

archive/issue_comments_390780.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[49549f4](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)|`using Projective Geometry constructor and remove a hyperplane`|",
    "created_at": "2016-08-08T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390780",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[49549f4](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)|`using Projective Geometry constructor and remove a hyperplane`|



---

archive/issue_events_064199.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-08T11:04:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21166#event-64199"
}
```



---

archive/issue_comments_390781.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-08T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390781",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390782.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign\n+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, just construct the latter and remove a hyperplane.\n``````\n",
    "created_at": "2016-08-08T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390782",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, perhaps something like this: https://github.com/rschrecker/AffineGeometryDesign
+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, just construct the latter and remove a hyperplane.
``````




---

archive/issue_comments_390783.json:
```json
{
    "body": "Commit: [49549f481ea409f253b6a3df3925bd2c021c72cc](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)",
    "created_at": "2016-08-08T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390783",
    "user": "https://github.com/dimpase"
}
```

Commit: [49549f481ea409f253b6a3df3925bd2c021c72cc](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)



---

archive/issue_comments_390784.json:
```json
{
    "body": "<a id='comment:3'></a>\nVincent, could you have a look?",
    "created_at": "2016-08-08T11:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390784",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
Vincent, could you have a look?



---

archive/issue_comments_390785.json:
```json
{
    "body": "<a id='comment:4'></a>\nWould be better, as in the case of `ProjectiveGeometryDesign` to have a `algorithm` keyword.",
    "created_at": "2016-08-08T23:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390785",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Would be better, as in the case of `ProjectiveGeometryDesign` to have a `algorithm` keyword.



---

archive/issue_comments_390786.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [vdelecroix](#comment%3A4):\n> Would be better, as in the case of `ProjectiveGeometryDesign` to have a `algorithm` keyword.\n\n\nThe new code uses `point_coordinates` provided by `ProjectiveGeometryDesign`, and they are only available with the default algorithm. Needless to say, the current `AffineGeometryDesign` does not provide `algorithm` choice.",
    "created_at": "2016-08-09T10:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390786",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Replying to [vdelecroix](#comment%3A4):
> Would be better, as in the case of `ProjectiveGeometryDesign` to have a `algorithm` keyword.


The new code uses `point_coordinates` provided by `ProjectiveGeometryDesign`, and they are only available with the default algorithm. Needless to say, the current `AffineGeometryDesign` does not provide `algorithm` choice.



---

archive/issue_comments_390787.json:
```json
{
    "body": "<a id='comment:6'></a>\n- I implemented a more direct version\n- did some cleanup in `AffineGeometryDesign` and `ProjectiveGeometryDesign`\n- added a non-trivial check in case `check=True`\n\nPlease review.\n\n---\nNew commits:\n|                                                                                                                                          |                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[30bd575](https://github.com/sagemath/sagetrac-mirror/commit/30bd5752048a94256a5dd1930bc41d49d3153ef7)|`rewrite AffineGeometryDesign`|\n|[f82800f](https://github.com/sagemath/sagetrac-mirror/commit/f82800f1688c96bf013648da1eb8ebf672073e5d)|`cleanup ProjectiveGeometryDesign`|\n|[0395e76](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)|`fix q_analogues for Python integer q`|",
    "created_at": "2016-08-09T16:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390787",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
- I implemented a more direct version
- did some cleanup in `AffineGeometryDesign` and `ProjectiveGeometryDesign`
- added a non-trivial check in case `check=True`

Please review.

---
New commits:
|                                                                                                                                          |                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[30bd575](https://github.com/sagemath/sagetrac-mirror/commit/30bd5752048a94256a5dd1930bc41d49d3153ef7)|`rewrite AffineGeometryDesign`|
|[f82800f](https://github.com/sagemath/sagetrac-mirror/commit/f82800f1688c96bf013648da1eb8ebf672073e5d)|`cleanup ProjectiveGeometryDesign`|
|[0395e76](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)|`fix q_analogues for Python integer q`|



---

archive/issue_comments_390788.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, just construct the latter and remove a hyperplane.\n+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. We implement a direct construction instead of using GAP.\n``````\n",
    "created_at": "2016-08-09T16:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390788",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. This is easy to fix, just construct the latter and remove a hyperplane.
+In `sage.combinat.designs.block_designs`, `AffineGeometryDesign` is far slower than `ProjectiveGeometryDesign`. We implement a direct construction instead of using GAP.
``````




---

archive/issue_comments_390789.json:
```json
{
    "body": "Changing commit from \"[49549f481ea409f253b6a3df3925bd2c021c72cc](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)\" to \"[0395e764aefa124e3b8d20879ee31c656deed2ec](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)\"",
    "created_at": "2016-08-09T16:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390789",
    "user": "https://github.com/videlec"
}
```

Changing commit from "[49549f481ea409f253b6a3df3925bd2c021c72cc](https://github.com/sagemath/sagetrac-mirror/commit/49549f481ea409f253b6a3df3925bd2c021c72cc)" to "[0395e764aefa124e3b8d20879ee31c656deed2ec](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)"



---

archive/issue_comments_390790.json:
```json
{
    "body": "Changing branch from \"[u/dimpase/affgeom_speedup](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/affgeom_speedup)\" to \"[u/vdelecroix/21166](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/21166)\"",
    "created_at": "2016-08-09T16:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390790",
    "user": "https://github.com/videlec"
}
```

Changing branch from "[u/dimpase/affgeom_speedup](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/affgeom_speedup)" to "[u/vdelecroix/21166](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/21166)"



---

archive/issue_comments_390791.json:
```json
{
    "body": "Author: Vincent Delecroix",
    "created_at": "2016-08-09T16:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390791",
    "user": "https://github.com/videlec"
}
```

Author: Vincent Delecroix



---

archive/issue_comments_390792.json:
```json
{
    "body": "<a id='comment:7'></a>\nI weirdly did not receive an e-mail notification for [comment:6](#comment%3A6)... let us try with 7.",
    "created_at": "2016-08-09T16:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390792",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
I weirdly did not receive an e-mail notification for [comment:6](#comment%3A6)... let us try with 7.



---

archive/issue_comments_390793.json:
```json
{
    "body": "<a id='comment:9'></a>\nping!",
    "created_at": "2016-08-25T13:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390793",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
ping!



---

archive/issue_comments_390794.json:
```json
{
    "body": "<a id='comment:10'></a>\nOne question: your new code in `AffineGeometryDesign` uses `reduced_echelon_matrix_iterator` in a way that assumes a particular order the latter traverses matrices in question. This order is not documented, and can be changed, breaking your code in turn. I don't like this.\n(One way out would be to document the order produced by `reduced_echelon_matrix_iterator` and add the relevant tests there)",
    "created_at": "2016-08-26T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390794",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
One question: your new code in `AffineGeometryDesign` uses `reduced_echelon_matrix_iterator` in a way that assumes a particular order the latter traverses matrices in question. This order is not documented, and can be changed, breaking your code in turn. I don't like this.
(One way out would be to document the order produced by `reduced_echelon_matrix_iterator` and add the relevant tests there)



---

archive/issue_comments_390795.json:
```json
{
    "body": "<a id='comment:11'></a>\nAnyway, instead of `break` in loops use `itertools.islice` to take the needed number of items from `reduced_echelon_matrix_iterator`.",
    "created_at": "2016-08-26T08:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390795",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Anyway, instead of `break` in loops use `itertools.islice` to take the needed number of items from `reduced_echelon_matrix_iterator`.



---

archive/issue_comments_390796.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[e843f5d](https://github.com/sagemath/sagetrac-mirror/commit/e843f5dae027a3cfa35d7c8ff98e7ad053edfb29)|`merge Sage-7.4.beta2`|\n|[12215ea](https://github.com/sagemath/sagetrac-mirror/commit/12215ea1c06214cc9e26f1d2b8cc1ed3f02ddf11)|`21166: document order of echelon matrix iterator`|\n|[0a77681](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)|`21166: use islice`|",
    "created_at": "2016-08-28T00:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[e843f5d](https://github.com/sagemath/sagetrac-mirror/commit/e843f5dae027a3cfa35d7c8ff98e7ad053edfb29)|`merge Sage-7.4.beta2`|
|[12215ea](https://github.com/sagemath/sagetrac-mirror/commit/12215ea1c06214cc9e26f1d2b8cc1ed3f02ddf11)|`21166: document order of echelon matrix iterator`|
|[0a77681](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)|`21166: use islice`|



---

archive/issue_comments_390797.json:
```json
{
    "body": "Changing commit from \"[0395e764aefa124e3b8d20879ee31c656deed2ec](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)\" to \"[0a776818b881a231b8b82b8c1224375902e62666](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)\"",
    "created_at": "2016-08-28T00:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[0395e764aefa124e3b8d20879ee31c656deed2ec](https://github.com/sagemath/sagetrac-mirror/commit/0395e764aefa124e3b8d20879ee31c656deed2ec)" to "[0a776818b881a231b8b82b8c1224375902e62666](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)"



---

archive/issue_comments_390798.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [dimpase](#comment%3A10):\n> One question: your new code in `AffineGeometryDesign` uses `reduced_echelon_matrix_iterator` in a way that assumes a particular order the latter traverses matrices in question. This order is not documented, and can be changed, breaking your code in turn. I don't like this.\n> (One way out would be to document the order produced by `reduced_echelon_matrix_iterator` and add the relevant tests there)\n\n\nYou are right. The fact is now documented.",
    "created_at": "2016-08-28T00:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390798",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>
Replying to [dimpase](#comment%3A10):
> One question: your new code in `AffineGeometryDesign` uses `reduced_echelon_matrix_iterator` in a way that assumes a particular order the latter traverses matrices in question. This order is not documented, and can be changed, breaking your code in turn. I don't like this.
> (One way out would be to document the order produced by `reduced_echelon_matrix_iterator` and add the relevant tests there)


You are right. The fact is now documented.



---

archive/issue_comments_390799.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A11):\n> Anyway, instead of `break` in loops use `itertools.islice` to take the needed number of items from `reduced_echelon_matrix_iterator`.\n\n\nIndeed, it is a bit cleaner with `islice`.",
    "created_at": "2016-08-28T00:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390799",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A11):
> Anyway, instead of `break` in loops use `itertools.islice` to take the needed number of items from `reduced_echelon_matrix_iterator`.


Indeed, it is a bit cleaner with `islice`.



---

archive/issue_comments_390800.json:
```json
{
    "body": "<a id='comment:15'></a>\nNeeds review again!",
    "created_at": "2016-08-28T00:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390800",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Needs review again!



---

archive/issue_comments_390801.json:
```json
{
    "body": "<a id='comment:16'></a>\nsome English improvements:\n\n```\ndiff --git a/src/sage/matrix/echelon_matrix.pyx b/src/sage/matrix/echelon_matrix.pyx\nindex 7d294d2..b699d30 100644\n--- a/src/sage/matrix/echelon_matrix.pyx\n+++ b/src/sage/matrix/echelon_matrix.pyx\n@@ -39,12 +39,12 @@ def reduced_echelon_matrix_iterator(K, k, n, bint sparse=False, bint copy=True,\n \n         We ensure that the iteration order is so that all matrices with given\n         pivot columns are generated consecutively. Furthermore, the order in\n-        which appear the pivot columns is lexicographic.\n+        which the pivot columns appear is lexicographic.\n \n         It would be faster to generate the pivots columns following a Gray code.\n-        There would be only one pivot changing at a time and would avoid the\n-        possibly expensive ``m0.__copy__()``. However that we would modify\n-        the generation order that some functions depend on.\n+        There would be only one pivot changing at a time, avoiding the\n+        possibly expensive ``m0.__copy__()``. However that would modify\n+        the generation order some functions depend upon.\n \n     EXAMPLES::\n \n```",
    "created_at": "2016-08-28T16:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390801",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
some English improvements:

```
diff --git a/src/sage/matrix/echelon_matrix.pyx b/src/sage/matrix/echelon_matrix.pyx
index 7d294d2..b699d30 100644
--- a/src/sage/matrix/echelon_matrix.pyx
+++ b/src/sage/matrix/echelon_matrix.pyx
@@ -39,12 +39,12 @@ def reduced_echelon_matrix_iterator(K, k, n, bint sparse=False, bint copy=True,
 
         We ensure that the iteration order is so that all matrices with given
         pivot columns are generated consecutively. Furthermore, the order in
-        which appear the pivot columns is lexicographic.
+        which the pivot columns appear is lexicographic.
 
         It would be faster to generate the pivots columns following a Gray code.
-        There would be only one pivot changing at a time and would avoid the
-        possibly expensive ``m0.__copy__()``. However that we would modify
-        the generation order that some functions depend on.
+        There would be only one pivot changing at a time, avoiding the
+        possibly expensive ``m0.__copy__()``. However that would modify
+        the generation order some functions depend upon.
 
     EXAMPLES::
 
```



---

archive/issue_comments_390802.json:
```json
{
    "body": "<a id='comment:17'></a>\nas well, `l2 = q_binomial(d+1, 1, q) - q_binomial(d, 1, q) == q^d`, as this is just the number of points in an affine subspace of dimemsion `d`. Thus\n\n```\ndiff --git a/src/sage/combinat/designs/block_design.py b/src/sage/combinat/designs/block_design.py\nindex a097317..31b76c5 100644\n--- a/src/sage/combinat/designs/block_design.py\n+++ b/src/sage/combinat/designs/block_design.py\n@@ -857,7 +857,7 @@ def AffineGeometryDesign(n, d, F, point_coordinates=True, check=True):\n \n     blocks = []\n     l1 = q_binomial(n+1, d+1, q) - q_binomial(n, d+1, q)\n-    l2 = q_binomial(d+1, 1, q) - q_binomial(d, 1, q)\n+    l2 = q**d\n     for m1 in islice(reduced_echelon_matrix_iterator(F,d+1,n+1,copy=False), l1):\n         b = []\n         for m2 in islice(reduced_echelon_matrix_iterator(F,1,d+1,copy=False), l2):\n```",
    "created_at": "2016-08-28T17:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390802",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
as well, `l2 = q_binomial(d+1, 1, q) - q_binomial(d, 1, q) == q^d`, as this is just the number of points in an affine subspace of dimemsion `d`. Thus

```
diff --git a/src/sage/combinat/designs/block_design.py b/src/sage/combinat/designs/block_design.py
index a097317..31b76c5 100644
--- a/src/sage/combinat/designs/block_design.py
+++ b/src/sage/combinat/designs/block_design.py
@@ -857,7 +857,7 @@ def AffineGeometryDesign(n, d, F, point_coordinates=True, check=True):
 
     blocks = []
     l1 = q_binomial(n+1, d+1, q) - q_binomial(n, d+1, q)
-    l2 = q_binomial(d+1, 1, q) - q_binomial(d, 1, q)
+    l2 = q**d
     for m1 in islice(reduced_echelon_matrix_iterator(F,d+1,n+1,copy=False), l1):
         b = []
         for m2 in islice(reduced_echelon_matrix_iterator(F,1,d+1,copy=False), l2):
```



---

archive/issue_comments_390803.json:
```json
{
    "body": "<a id='comment:18'></a>\nOther than these two issues, it looks good to me.",
    "created_at": "2016-08-28T21:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390803",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Other than these two issues, it looks good to me.



---

archive/issue_comments_390804.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[3a94d93](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)|`21166: doc + one simplification`|",
    "created_at": "2016-08-30T13:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[3a94d93](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)|`21166: doc + one simplification`|



---

archive/issue_comments_390805.json:
```json
{
    "body": "Changing commit from \"[0a776818b881a231b8b82b8c1224375902e62666](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)\" to \"[3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)\"",
    "created_at": "2016-08-30T13:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[0a776818b881a231b8b82b8c1224375902e62666](https://github.com/sagemath/sagetrac-mirror/commit/0a776818b881a231b8b82b8c1224375902e62666)" to "[3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)"



---

archive/issue_comments_390806.json:
```json
{
    "body": "<a id='comment:20'></a>\ndone and done",
    "created_at": "2016-08-30T13:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390806",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>
done and done



---

archive/issue_comments_390807.json:
```json
{
    "body": "Reviewer: Dima Pasechnik",
    "created_at": "2016-08-30T15:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390807",
    "user": "https://github.com/dimpase"
}
```

Reviewer: Dima Pasechnik



---

archive/issue_comments_390808.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-30T15:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390808",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390809.json:
```json
{
    "body": "<a id='comment:21'></a>\nOK, great, thanks.",
    "created_at": "2016-08-30T15:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390809",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
OK, great, thanks.



---

archive/issue_events_064200.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-04T00:13:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21166#event-64200"
}
```



---

archive/issue_comments_390810.json:
```json
{
    "body": "Changing branch from \"[u/vdelecroix/21166](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/21166)\" to \"[3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)\"",
    "created_at": "2016-09-04T00:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390810",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/vdelecroix/21166](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/21166)" to "[3a94d935c9bdb617732436faf25dfb22f2623547](https://github.com/sagemath/sagetrac-mirror/commit/3a94d935c9bdb617732436faf25dfb22f2623547)"



---

archive/issue_comments_390811.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-04T00:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21166#issuecomment-390811",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
