# Issue 21449: CoinBackend: _test_solve fails on 32-bit

archive/issues_021212.json:
```json
{
    "body": "On `Linux arando 3.13.0-95-generic #142-Ubuntu SMP Fri Aug 12 17:05:16 UTC 2016 i686 i686 i686 GNU/Linux`:\n\n```\n**********************************************************************\nFile \"src/sage/numerical/backends/coin_backend.pyx\", line 39, in sage.numerical.backends.coin_backend.CoinBackend\nFailed example:\n    TestSuite(p).run(skip=\"_test_pickling\")               # optional - cbc\nExpected nothing\nGot:\n    Failure in _test_solve:\n    Traceback (most recent call last):\n      File \"/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 283, in run\n        test_method(tester = tester)\n      File \"sage/numerical/backends/generic_backend.pyx\", line 697, in sage.numerical.backends.generic_backend.GenericBackend._test_solve (build/cythonized/sage/numerical/backends/generic_backend.c:8748)\n        with tester.assertRaises(MIPSolverException) as cm:   # unbounded\n      File \"/home/jdemeyer/sage-git/local/lib/python/unittest/case.py\", line 116, in __exit__\n        \"{0} not raised\".format(exc_name))\n    AssertionError: MIPSolverException not raised\n    ------------------------------------------------------------\n    The following tests failed: _test_solve\n**********************************************************************\n```\n\nThis is what is happening on a 32-bit Linux:\n\n```\nsage: from sage.numerical.backends.coin_backend import CoinBackend\nsage: p = CoinBackend()\nsage: p.add_linear_constraints(5, 0, None)\nsage: p.add_col(range(5), range(5))\nsage: p.objective_coefficient(0,1)\nsage: p.solve()\n0\nsage: p.set_verbosity(3)\nsage: p.solve()\nCbc3007W No integer variables - nothing to do\nClp0006I 0  Obj 0 Dual inf 0.9999999 (1)\nClp0000I Optimal - objective value -1.7976931e+308\n0   ### Instead, an exception should have been raised.\nsage: p.get_variable_value(0)\n1.7976931348623157e+308  ### BAD\n```\n\n\n\n\nCC:  @mkoeppe\n\nKeywords: sdl\n\nReviewer: Thierry Monteil, Matthias Koeppe\n\nAuthor: Jeroen Demeyer\n\nBranch: 5eacf72e79d02bc30ce5701d86db4ce8a03a10f2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21449\n\n",
    "closed_at": "2016-09-24T14:32:10Z",
    "created_at": "2016-09-08T11:16:59Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "CoinBackend: _test_solve fails on 32-bit",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21449",
    "user": "https://github.com/jdemeyer"
}
```
On `Linux arando 3.13.0-95-generic #142-Ubuntu SMP Fri Aug 12 17:05:16 UTC 2016 i686 i686 i686 GNU/Linux`:

```
**********************************************************************
File "src/sage/numerical/backends/coin_backend.pyx", line 39, in sage.numerical.backends.coin_backend.CoinBackend
Failed example:
    TestSuite(p).run(skip="_test_pickling")               # optional - cbc
Expected nothing
Got:
    Failure in _test_solve:
    Traceback (most recent call last):
      File "/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "sage/numerical/backends/generic_backend.pyx", line 697, in sage.numerical.backends.generic_backend.GenericBackend._test_solve (build/cythonized/sage/numerical/backends/generic_backend.c:8748)
        with tester.assertRaises(MIPSolverException) as cm:   # unbounded
      File "/home/jdemeyer/sage-git/local/lib/python/unittest/case.py", line 116, in __exit__
        "{0} not raised".format(exc_name))
    AssertionError: MIPSolverException not raised
    ------------------------------------------------------------
    The following tests failed: _test_solve
**********************************************************************
```

This is what is happening on a 32-bit Linux:

```
sage: from sage.numerical.backends.coin_backend import CoinBackend
sage: p = CoinBackend()
sage: p.add_linear_constraints(5, 0, None)
sage: p.add_col(range(5), range(5))
sage: p.objective_coefficient(0,1)
sage: p.solve()
0
sage: p.set_verbosity(3)
sage: p.solve()
Cbc3007W No integer variables - nothing to do
Clp0006I 0  Obj 0 Dual inf 0.9999999 (1)
Clp0000I Optimal - objective value -1.7976931e+308
0   ### Instead, an exception should have been raised.
sage: p.get_variable_value(0)
1.7976931348623157e+308  ### BAD
```




CC:  @mkoeppe

Keywords: sdl

Reviewer: Thierry Monteil, Matthias Koeppe

Author: Jeroen Demeyer

Branch: 5eacf72e79d02bc30ce5701d86db4ce8a03a10f2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21449





---

archive/issue_comments_312919.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-08T11:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312919",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312920.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2016-09-08T11:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_312921.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-08T11:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_312922.json:
```json
{
    "body": "<a id='comment:4'></a>\"known bug on 32 bit\" -- to whom is this bug known?",
    "created_at": "2016-09-08T17:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>"known bug on 32 bit" -- to whom is this bug known?



---

archive/issue_comments_312923.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:\n> \"known bug on 32 bit\" -- to whom is this bug known? \n\n\nTo you now :-)",
    "created_at": "2016-09-08T17:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312923",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 mkoeppe]:
> "known bug on 32 bit" -- to whom is this bug known? 


To you now :-)



---

archive/issue_comments_312924.json:
```json
{
    "body": "<a id='comment:6'></a>I also fall on this problem. I see that the fix is to ignore the doctest for 32bit systems. How do you know that the doctest failure does not mean that there is a problem somewhere (that should be addressed) ?",
    "created_at": "2016-09-08T23:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312924",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:6'></a>I also fall on this problem. I see that the fix is to ignore the doctest for 32bit systems. How do you know that the doctest failure does not mean that there is a problem somewhere (that should be addressed) ?



---

archive/issue_comments_312925.json:
```json
{
    "body": "<a id='comment:7'></a>There definitely is a problem, and it should NOT be ignored.",
    "created_at": "2016-09-08T23:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312925",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>There definitely is a problem, and it should NOT be ignored.



---

archive/issue_comments_312926.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 tmonteil]:\n> How do you know that the doctest failure does not mean that there is a problem somewhere\n\n\nI am not claiming that. I am adding `# known bug`, which means that I agree that there is a problem somewhere.\n\nOf course, if the real bug can be fixed, that would be better. But in the mean time, just to have all doctests formally passing (and make a 32-bit patchbot useful), I propose to add the `# known bug`.",
    "created_at": "2016-09-09T06:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312926",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:6 tmonteil]:
> How do you know that the doctest failure does not mean that there is a problem somewhere


I am not claiming that. I am adding `# known bug`, which means that I agree that there is a problem somewhere.

Of course, if the real bug can be fixed, that would be better. But in the mean time, just to have all doctests formally passing (and make a 32-bit patchbot useful), I propose to add the `# known bug`.



---

archive/issue_comments_312927.json:
```json
{
    "body": "<a id='comment:9'></a>If Mathias is OK with that, i am also in favor to set this ticket to positive review (i confirm that the patch fixes the doctest on my 32bit VM).\n\nIf someone has an idea where the bug comes from and how to fix it, that would be great.",
    "created_at": "2016-09-13T16:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312927",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>If Mathias is OK with that, i am also in favor to set this ticket to positive review (i confirm that the patch fixes the doctest on my 32bit VM).

If someone has an idea where the bug comes from and how to fix it, that would be great.



---

archive/issue_comments_312928.json:
```json
{
    "body": "<a id='comment:10'></a>I am building a 32-bit environment at the moment to look at what's going on here.",
    "created_at": "2016-09-13T16:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312928",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>I am building a 32-bit environment at the moment to look at what's going on here.



---

archive/issue_comments_312929.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -21,6 +21,29 @@\n **********************************************************************\n ```\n \n+This is what is happening on a 32-bit Linux:\n+\n+```\n+sage: from sage.numerical.backends.coin_backend import CoinBackend\n+sage: p = CoinBackend()\n+sage: p.add_linear_constraints(5, 0, None)\n+sage: p.add_col(range(5), range(5))\n+sage: p.objective_coefficient(0,1)\n+sage: p.solve()\n+0\n+sage: p.set_verbosity(3)\n+sage: p.solve()\n+Cbc3007W No integer variables - nothing to do\n+Clp0006I 0  Obj 0 Dual inf 0.9999999 (1)\n+Clp0000I Optimal - objective value -1.7976931e+308\n+0   ### Instead, an exception should have been raised.\n+sage: p.get_variable_value(0)\n+1.7976931348623157e+308  ### BAD\n+```\n+\n+\n+\n+\n Author: Jeroen Demeyer\n \n Comment: 1\n```\n",
    "created_at": "2016-09-15T01:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312929",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -21,6 +21,29 @@
 **********************************************************************
 ```
 
+This is what is happening on a 32-bit Linux:
+
+```
+sage: from sage.numerical.backends.coin_backend import CoinBackend
+sage: p = CoinBackend()
+sage: p.add_linear_constraints(5, 0, None)
+sage: p.add_col(range(5), range(5))
+sage: p.objective_coefficient(0,1)
+sage: p.solve()
+0
+sage: p.set_verbosity(3)
+sage: p.solve()
+Cbc3007W No integer variables - nothing to do
+Clp0006I 0  Obj 0 Dual inf 0.9999999 (1)
+Clp0000I Optimal - objective value -1.7976931e+308
+0   ### Instead, an exception should have been raised.
+sage: p.get_variable_value(0)
+1.7976931348623157e+308  ### BAD
+```
+
+
+
+
 Author: Jeroen Demeyer
 
 Comment: 1
```




---

archive/issue_comments_312930.json:
```json
{
    "body": "<a id='comment:12'></a>Upgrading CBC to 2.9.8 (latest) does NOT fix this problem.",
    "created_at": "2016-09-15T01:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312930",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Upgrading CBC to 2.9.8 (latest) does NOT fix this problem.



---

archive/issue_comments_312931.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 mkoeppe]:\n> Upgrading CBC to 2.9.8 (latest) does NOT fix this problem.\n\n\nDo you have an idea about where the problem comes from ? Does upstream say something about this ?",
    "created_at": "2016-09-16T21:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312931",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>Replying to [comment:12 mkoeppe]:
> Upgrading CBC to 2.9.8 (latest) does NOT fix this problem.


Do you have an idea about where the problem comes from ? Does upstream say something about this ?



---

archive/issue_comments_312932.json:
```json
{
    "body": "<a id='comment:14'></a>I haven't checked with upstream yet.\nI am actually not sure yet if this a problem with the library or with our Cython wrapper.",
    "created_at": "2016-09-16T23:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312932",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>I haven't checked with upstream yet.
I am actually not sure yet if this a problem with the library or with our Cython wrapper.



---

archive/issue_comments_312933.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 mkoeppe]:\n> I haven't checked with upstream yet.\n> I am actually not sure yet if this a problem with the library or with our Cython wrapper.\n\n\nSo shall we accept the current fix and postpone a real fix for when we understant more the situation ?",
    "created_at": "2016-09-20T19:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312933",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:15'></a>Replying to [comment:14 mkoeppe]:
> I haven't checked with upstream yet.
> I am actually not sure yet if this a problem with the library or with our Cython wrapper.


So shall we accept the current fix and postpone a real fix for when we understant more the situation ?



---

archive/issue_comments_312934.json:
```json
{
    "body": "<a id='comment:16'></a>The patch at least needs to include reference to a ticket; and when this ticket is closed a follow-up tickets for an actual fix needs to be opened.",
    "created_at": "2016-09-20T21:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312934",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>The patch at least needs to include reference to a ticket; and when this ticket is closed a follow-up tickets for an actual fix needs to be opened.



---

archive/issue_comments_312935.json:
```json
{
    "body": "<a id='comment:17'></a>I created a new ticket at #21550 (details to be filled in) and added a reference to that ticket in the doctest.",
    "created_at": "2016-09-21T07:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312935",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>I created a new ticket at #21550 (details to be filled in) and added a reference to that ticket in the doctest.



---

archive/issue_comments_312936.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-21T07:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312937.json:
```json
{
    "body": "<a id='comment:19'></a>I am surprised to see that `sys.float_info` returns the same on 32-bit and on 64-bit Linux. On 32-bit:\n\n```\ndima@arando:~$ python\nPython 2.7.6 (default, Jun 22 2015, 18:00:18) \n[GCC 4.8.2] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> sys.float_info\nsys.float_info(max=1.7976931348623157e+308, max_exp=1024, max_10_exp=308, min=2.2250738585072014e-308, min_exp=-1021, min_10_exp=-307, dig=15, mant_dig=53, epsilon=2.220446049250313e-16, radix=2, rounds=1)\n```\nanyhow we might be hitting a classic like https://gcc.gnu.org/bugzilla/show_bug.cgi?id=323",
    "created_at": "2016-09-21T09:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312937",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>I am surprised to see that `sys.float_info` returns the same on 32-bit and on 64-bit Linux. On 32-bit:

```
dima@arando:~$ python
Python 2.7.6 (default, Jun 22 2015, 18:00:18) 
[GCC 4.8.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.float_info
sys.float_info(max=1.7976931348623157e+308, max_exp=1024, max_10_exp=308, min=2.2250738585072014e-308, min_exp=-1021, min_10_exp=-307, dig=15, mant_dig=53, epsilon=2.220446049250313e-16, radix=2, rounds=1)
```
anyhow we might be hitting a classic like https://gcc.gnu.org/bugzilla/show_bug.cgi?id=323



---

archive/issue_comments_312938.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 dimpase]:\n> I am surprised to see that `sys.float_info` returns the same on 32-bit and on 64-bit Linux. On 32-bit:\n\n\nWhy? The C type `double` is the same on 32-bit and 64-bit architectures.",
    "created_at": "2016-09-21T10:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312938",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 dimpase]:
> I am surprised to see that `sys.float_info` returns the same on 32-bit and on 64-bit Linux. On 32-bit:


Why? The C type `double` is the same on 32-bit and 64-bit architectures.



---

archive/issue_comments_312939.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-21T10:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312939",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312940.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-24T14:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312940",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056986.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-24T14:32:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21449#event-56986"
}
```



---

archive/issue_comments_312941.json:
```json
{
    "body": "Changing keywords from \"\" to \"sdl\".",
    "created_at": "2019-08-27T19:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21449#issuecomment-312941",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "" to "sdl".
