# Issue 21223: ECM segfaults in Cygwin64

archive/issues_020986.json:
```json
{
    "body": "Running ECM with almost any inputs results in a segfault on Cygwin64.\n\nThis is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n\nOne possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n\nSubmitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623\n\nCC:  jpflori @tscrim\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nBranch: a4adca5f24de505dfe56316ddc9bd47954746415\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21223\n\n",
    "closed_at": "2016-08-19T22:44:59Z",
    "created_at": "2016-08-11T12:09:08Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "ECM segfaults in Cygwin64",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21223",
    "user": "https://github.com/embray"
}
```
Running ECM with almost any inputs results in a segfault on Cygwin64.

This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.

One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.

Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623

CC:  jpflori @tscrim

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Jeroen Demeyer

Author: Erik Bray

Branch: a4adca5f24de505dfe56316ddc9bd47954746415

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21223





---

archive/issue_comments_389340.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389340",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389341.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389341",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_389342.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-21223\"",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389342",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-21223"



---

archive/issue_comments_389343.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389343",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_389344.json:
```json
{
    "body": "Changing commit from \"\" to \"c80277a2ea1663d4803e4974985f829d27d5259c\"",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389344",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "c80277a2ea1663d4803e4974985f829d27d5259c"



---

archive/issue_comments_389345.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n Running ECM with almost any inputs results in a segfault on Cygwin64.\n \n-More details soon.\n+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n+\n+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-11T12:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389345",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 Running ECM with almost any inputs results in a segfault on Cygwin64.
 
-More details soon.
+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.
+
+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.
 
 Comment: 1
 
``````




---

archive/issue_comments_389346.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2016-08-11T12:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389346",
    "user": "https://github.com/embray"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_comments_389347.json:
```json
{
    "body": "<a id='comment:3'></a>ECM 7.x got \"revived\", see #20385.  7.0.3 is still kind of beta/rc though I'd say.",
    "created_at": "2016-08-11T13:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389347",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>ECM 7.x got "revived", see #20385.  7.0.3 is still kind of beta/rc though I'd say.



---

archive/issue_comments_389348.json:
```json
{
    "body": "Changing commit from \"c80277a2ea1663d4803e4974985f829d27d5259c\" to \"6361e6cdac8484964b9e952f5b482b986113aaee\"",
    "created_at": "2016-08-11T13:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c80277a2ea1663d4803e4974985f829d27d5259c" to "6361e6cdac8484964b9e952f5b482b986113aaee"



---

archive/issue_comments_389349.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-11T13:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389350.json:
```json
{
    "body": "<a id='comment:5'></a>... as is the branch on #20385; i.e., not really \"needs review\" yet, but you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.",
    "created_at": "2016-08-11T13:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389350",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>... as is the branch on #20385; i.e., not really "needs review" yet, but you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.



---

archive/issue_comments_389351.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 leif]:\n> you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.\n\n\nNope, in 7.0.3 (now `configure.ac`) there's still:\n\n```sh\nif test \"x$enable_asm_redc\" = xyes; then\n# do the necessary definitions and includes\n  AC_DEFINE([USE_ASM_REDC],1,[Define to 1 to use asm redc])\n  test \"x$CCAS\" != x || CCAS=\"$CC -c\"\n  AC_SUBST([CCAS])\n  GMP_PROG_M4\n  GMP_ASM_UNDERSCORE\n  GMP_ASM_TEXT\n  GMP_ASM_GLOBL\n  GMP_ASM_TYPE\n\n  case $host in\n    *-*-mingw32) GMP_DEFINE([WINDOWS64_ABI], 1)\n                 AC_DEFINE([WINDOWS64_ABI], 1,[Define to 1 if x86_64 mulredc*() functions should be called with Windows ABI]);;\n    *) ;;\n  esac\n\n  case $host in\n    pentium3-*-*)\n      echo \"WARNING: Your processor is recognized as Pentium3.\"\n      echo \"         The asm code uses SSE2, and therefore it might\"\n      echo \"         fail if your proc is indeed a P3, and not a\"\n      echo \"         Pentium M. If you have compilation problems,\"\n      echo \"         consider using --disable-asm-redc.\" ;;\n    *)\n  esac\nfi\nAM_CONDITIONAL([ENABLE_ASM_REDC], [test \"x$enable_asm_redc\" = xyes])\n```",
    "created_at": "2016-08-11T13:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389351",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>Replying to [comment:5 leif]:
> you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.


Nope, in 7.0.3 (now `configure.ac`) there's still:

```sh
if test "x$enable_asm_redc" = xyes; then
# do the necessary definitions and includes
  AC_DEFINE([USE_ASM_REDC],1,[Define to 1 to use asm redc])
  test "x$CCAS" != x || CCAS="$CC -c"
  AC_SUBST([CCAS])
  GMP_PROG_M4
  GMP_ASM_UNDERSCORE
  GMP_ASM_TEXT
  GMP_ASM_GLOBL
  GMP_ASM_TYPE

  case $host in
    *-*-mingw32) GMP_DEFINE([WINDOWS64_ABI], 1)
                 AC_DEFINE([WINDOWS64_ABI], 1,[Define to 1 if x86_64 mulredc*() functions should be called with Windows ABI]);;
    *) ;;
  esac

  case $host in
    pentium3-*-*)
      echo "WARNING: Your processor is recognized as Pentium3."
      echo "         The asm code uses SSE2, and therefore it might"
      echo "         fail if your proc is indeed a P3, and not a"
      echo "         Pentium M. If you have compilation problems,"
      echo "         consider using --disable-asm-redc." ;;
    *)
  esac
fi
AM_CONDITIONAL([ENABLE_ASM_REDC], [test "x$enable_asm_redc" = xyes])
```



---

archive/issue_comments_389352.json:
```json
{
    "body": "<a id='comment:7'></a>I'll take care of including this patch on #20385 if upstream won't include it soon.",
    "created_at": "2016-08-11T13:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389352",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>I'll take care of including this patch on #20385 if upstream won't include it soon.



---

archive/issue_comments_389353.json:
```json
{
    "body": "<a id='comment:8'></a>Okay, thanks.",
    "created_at": "2016-08-11T14:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389353",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Okay, thanks.



---

archive/issue_comments_389354.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-15T07:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389354",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_056583.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-15T07:41:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21223#event-56583"
}
```



---

archive/issue_comments_389355.json:
```json
{
    "body": "<a id='comment:9'></a>1. This should be reported upstream.\n\n2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.\n\n3. I cannot test this, but the patch is clear. If you say this makes ECM work on Cygwin64, that's good enough for me.",
    "created_at": "2016-08-15T07:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389355",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>1. This should be reported upstream.

2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.

3. I cannot test this, but the patch is clear. If you say this makes ECM work on Cygwin64, that's good enough for me.



---

archive/issue_comments_389356.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 jdemeyer]:\n> 2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.\n\n\nOh right, `patch` doesn't *by default* take the modification time from the patch header (where `configure` is about a minute newer).\n\nWhile it would be safer to explicitly `touch configure` after patching in `spkg-install`, `make` *should<sup>TM</sup>* treat `configure` up-to-date if you just reverse the order in the patch.  (I'm not even sure it wouldn't as is; you'd probably need a *very slow* machine to cause it to not do so.)",
    "created_at": "2016-08-15T13:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389356",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>Replying to [comment:9 jdemeyer]:
> 2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.


Oh right, `patch` doesn't *by default* take the modification time from the patch header (where `configure` is about a minute newer).

While it would be safer to explicitly `touch configure` after patching in `spkg-install`, `make` *should<sup>TM</sup>* treat `configure` up-to-date if you just reverse the order in the patch.  (I'm not even sure it wouldn't as is; you'd probably need a *very slow* machine to cause it to not do so.)



---

archive/issue_comments_389357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+Running ECM with almost any inputs results in a segfault on Cygwin64.\n \n+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n+\n+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n+\n+Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-08-16T09:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389357",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+Running ECM with almost any inputs results in a segfault on Cygwin64.
 
+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.
+
+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.
+
+Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623
 
 Comment: 1
 
``````




---

archive/issue_comments_389358.json:
```json
{
    "body": "Changing upstream from \"Not yet reported upstream; Will do shortly.\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2016-08-16T09:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389358",
    "user": "https://github.com/embray"
}
```

Changing upstream from "Not yet reported upstream; Will do shortly." to "Reported upstream. No feedback yet."



---

archive/issue_comments_389359.json:
```json
{
    "body": "Changing commit from \"6361e6cdac8484964b9e952f5b482b986113aaee\" to \"a4adca5f24de505dfe56316ddc9bd47954746415\"",
    "created_at": "2016-08-16T09:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6361e6cdac8484964b9e952f5b482b986113aaee" to "a4adca5f24de505dfe56316ddc9bd47954746415"



---

archive/issue_comments_389360.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-16T09:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389361.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-16T13:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389361",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_389362.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-16T14:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389362",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389363.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2016-08-16T14:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389363",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_389364.json:
```json
{
    "body": "<a id='comment:15'></a>I assume you actually tested this on Cygwin64 :-)",
    "created_at": "2016-08-16T14:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389364",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>I assume you actually tested this on Cygwin64 :-)



---

archive/issue_comments_389365.json:
```json
{
    "body": "<a id='comment:16'></a>Jeroen was quicker, but I also didn't test this *on Cygwin[64]*...",
    "created_at": "2016-08-16T14:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389365",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>Jeroen was quicker, but I also didn't test this *on Cygwin[64]*...



---

archive/issue_comments_389366.json:
```json
{
    "body": "<a id='comment:17'></a>Yup. Before this patch, running ecm segfaults.  Without it, no segfaults (and all the tests that invoke it pass)",
    "created_at": "2016-08-16T14:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389366",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Yup. Before this patch, running ecm segfaults.  Without it, no segfaults (and all the tests that invoke it pass)



---

archive/issue_comments_389367.json:
```json
{
    "body": "<a id='comment:18'></a>FWIW, I guess similar would still happen on Cygwin**32** on some x86 CPUs at least (probably x86_64 in 32-bit mode as well), but only if one *explicitly* configures GMP-ECM with `--enable-asm-redc`, which we *don't* do in Sage.  (A user could still do that in *Sage's* environment variable `ECM_CONFIGURE` though.)  The relevant asm code is in `athlon/` and `pentium4/`.\n\nNot sure whether the NTT inline assembly code (which is only used on [some] x86 CPUs, and again probably also on x86_64 in 32-bit mode) is safe w.r.t. the Windows ABI.  (It *might* get used on Cygwin**32**, even by default, depending on the CPU, AFAICS.)\n\nBut both is IMHO beyond this ticket, since the ticket's title mentions just Cygwin**64**.  (Feel free to try and eventually open a follow-up ticket for that... :P -- I personally won't.)",
    "created_at": "2016-08-16T16:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389367",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>FWIW, I guess similar would still happen on Cygwin**32** on some x86 CPUs at least (probably x86_64 in 32-bit mode as well), but only if one *explicitly* configures GMP-ECM with `--enable-asm-redc`, which we *don't* do in Sage.  (A user could still do that in *Sage's* environment variable `ECM_CONFIGURE` though.)  The relevant asm code is in `athlon/` and `pentium4/`.

Not sure whether the NTT inline assembly code (which is only used on [some] x86 CPUs, and again probably also on x86_64 in 32-bit mode) is safe w.r.t. the Windows ABI.  (It *might* get used on Cygwin**32**, even by default, depending on the CPU, AFAICS.)

But both is IMHO beyond this ticket, since the ticket's title mentions just Cygwin**64**.  (Feel free to try and eventually open a follow-up ticket for that... :P -- I personally won't.)



---

archive/issue_comments_389368.json:
```json
{
    "body": "<a id='comment:19'></a>The solution in the ticket just targets \"cygwin\" so it's a moot point I think.\n\nAlso I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).",
    "created_at": "2016-08-16T16:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389368",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>The solution in the ticket just targets "cygwin" so it's a moot point I think.

Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).



---

archive/issue_comments_389369.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 embray]:\n> The solution in the ticket just targets \"cygwin\" so it's a moot point I think.\n\n\nNope, that doesn't fix the two issues I mentioned above, as on 32-bit systems the x86_64 code isn't used, and (of course) only in the latter `WINDOWS64_ABI` is used at all.  (There's no macro for Windows ABI in general, nor Win32 ABI, although native Microsoft Windows -- with MS Visual Foo -- is handled.)\n\n\\\\\n\n> Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).\n\n\nOk.\n\nOther Sage-on-Cygwin developers may try.  (You could still detail your upstream report though, as it effectively only addresses Cygwin**64**.)",
    "created_at": "2016-08-16T16:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389369",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>Replying to [comment:19 embray]:
> The solution in the ticket just targets "cygwin" so it's a moot point I think.


Nope, that doesn't fix the two issues I mentioned above, as on 32-bit systems the x86_64 code isn't used, and (of course) only in the latter `WINDOWS64_ABI` is used at all.  (There's no macro for Windows ABI in general, nor Win32 ABI, although native Microsoft Windows -- with MS Visual Foo -- is handled.)

\\

> Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).


Ok.

Other Sage-on-Cygwin developers may try.  (You could still detail your upstream report though, as it effectively only addresses Cygwin**64**.)



---

archive/issue_comments_389370.json:
```json
{
    "body": "<a id='comment:21'></a>I'm not really sure what you're trying to say here.",
    "created_at": "2016-08-17T07:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389370",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>I'm not really sure what you're trying to say here.



---

archive/issue_comments_389371.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 embray]:\n> I'm not really sure what you're trying to say here.\n\n\nOn **32-bit** systems (including Cygwin**32**), *other* assembly files are used, which may cause similar problems (because they at least don't care about Pascal calling convention).\n\nThere's also some *inline assembly* which is used on 32-bit (x86) systems only; there I'm not sure whether it complies also to the Win32 ABI w.r.t. register usage.",
    "created_at": "2016-08-17T09:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389371",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>Replying to [comment:21 embray]:
> I'm not really sure what you're trying to say here.


On **32-bit** systems (including Cygwin**32**), *other* assembly files are used, which may cause similar problems (because they at least don't care about Pascal calling convention).

There's also some *inline assembly* which is used on 32-bit (x86) systems only; there I'm not sure whether it complies also to the Win32 ABI w.r.t. register usage.



---

archive/issue_comments_389372.json:
```json
{
    "body": "<a id='comment:23'></a>Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.",
    "created_at": "2016-08-19T10:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389372",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.



---

archive/issue_comments_389373.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 embray]:\n> Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.\n\n\nSure.  In any case, it's easy to work around potential problems on Cygwin32 by simply setting `ECM_CONFIGURE=\"--disable-sse2 --disable-asm-redc\"` before or when (re)installing the package.\n\nWho is likely to test on Cygwin32?",
    "created_at": "2016-08-19T10:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389373",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>Replying to [comment:23 embray]:
> Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.


Sure.  In any case, it's easy to work around potential problems on Cygwin32 by simply setting `ECM_CONFIGURE="--disable-sse2 --disable-asm-redc"` before or when (re)installing the package.

Who is likely to test on Cygwin32?



---

archive/issue_comments_389374.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-21223\" to \"a4adca5f24de505dfe56316ddc9bd47954746415\"",
    "created_at": "2016-08-19T22:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389374",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-21223" to "a4adca5f24de505dfe56316ddc9bd47954746415"



---

archive/issue_comments_389375.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-19T22:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389375",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-19T22:44:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21223#event-56584"
}
```



---

archive/issue_comments_389376.json:
```json
{
    "body": "Changing commit from \"a4adca5f24de505dfe56316ddc9bd47954746415\" to \"\"",
    "created_at": "2016-08-23T06:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389376",
    "user": "https://github.com/zimmermann6"
}
```

Changing commit from "a4adca5f24de505dfe56316ddc9bd47954746415" to ""



---

archive/issue_comments_389377.json:
```json
{
    "body": "<a id='comment:27'></a>patch applied upstream. Are you sure this is fine under 32-bit cygwin too?\n\nPaul",
    "created_at": "2016-08-23T06:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389377",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:27'></a>patch applied upstream. Are you sure this is fine under 32-bit cygwin too?

Paul



---

archive/issue_comments_389378.json:
```json
{
    "body": "<a id='comment:28'></a>I should be able to test Cygwin32 this afternoon.",
    "created_at": "2016-08-23T08:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389378",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>I should be able to test Cygwin32 this afternoon.



---

archive/issue_comments_389379.json:
```json
{
    "body": "<a id='comment:29'></a>> I should be able to test Cygwin32 this afternoon.\n\n\ngreat! Please test revision 2976 (or later) of GMP-ECM:\n\n$ svn checkout svn://scm.gforge.inria.fr/svnroot/ecm/trunk ecm\n\nPaul",
    "created_at": "2016-08-23T09:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389379",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:29'></a>> I should be able to test Cygwin32 this afternoon.


great! Please test revision 2976 (or later) of GMP-ECM:

$ svn checkout svn://scm.gforge.inria.fr/svnroot/ecm/trunk ecm

Paul



---

archive/issue_comments_389380.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 jpflori]:\n> I should be able to test Cygwin32 this afternoon.\n\n\nI replied to Paul on the upstream bug report.  (The patch here won't *break* anything on Cygwin32, but it won't solve potential similar issues on 32-bit Cygwin either.)\n\nYou may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).",
    "created_at": "2016-08-23T11:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389380",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>Replying to [comment:28 jpflori]:
> I should be able to test Cygwin32 this afternoon.


I replied to Paul on the upstream bug report.  (The patch here won't *break* anything on Cygwin32, but it won't solve potential similar issues on 32-bit Cygwin either.)

You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).



---

archive/issue_comments_389381.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 leif]:\n> Replying to [comment:28 jpflori]:\n> > I should be able to test Cygwin32 this afternoon.\n\n> You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).\n\nAlso saving the `config.log`s and the build logs perhaps, to see what actually got used.  (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)",
    "created_at": "2016-08-23T12:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389381",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>Replying to [comment:30 leif]:
> Replying to [comment:28 jpflori]:
> > I should be able to test Cygwin32 this afternoon.

> You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).

Also saving the `config.log`s and the build logs perhaps, to see what actually got used.  (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)



---

archive/issue_comments_389382.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 leif]:\n> (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)\n\n\nOh, there's no *assembly code* in `x86/`, just `params.h`:\n\n```C\n#define MPZMOD_THRESHOLD 135\n#define REDC_THRESHOLD 200\n#define MPN_MUL_LO_THRESHOLD_TABLE {0, 0, 1, 1, 0, 0, 5, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 16, 1, 14, 14, 16, 16, 1}\n#define NTT_GFP_TWIDDLE_DIF_BREAKOVER 11\n#define NTT_GFP_TWIDDLE_DIT_BREAKOVER 11\n#define MUL_NTT_THRESHOLD 262144\n#define PREREVERTDIVISION_NTT_THRESHOLD 128\n#define POLYINVERT_NTT_THRESHOLD 65536\n#define POLYEVALT_NTT_THRESHOLD 16384\n#define MPZSPV_NORMALISE_STRIDE 512\n```\n\n(And there's of course also inline assembly in `longlong.h`; don't know what's used on Cygwin[32], but presumably less critical, too.)",
    "created_at": "2016-08-23T12:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389382",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>Replying to [comment:31 leif]:
> (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)


Oh, there's no *assembly code* in `x86/`, just `params.h`:

```C
#define MPZMOD_THRESHOLD 135
#define REDC_THRESHOLD 200
#define MPN_MUL_LO_THRESHOLD_TABLE {0, 0, 1, 1, 0, 0, 5, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 16, 1, 14, 14, 16, 16, 1}
#define NTT_GFP_TWIDDLE_DIF_BREAKOVER 11
#define NTT_GFP_TWIDDLE_DIT_BREAKOVER 11
#define MUL_NTT_THRESHOLD 262144
#define PREREVERTDIVISION_NTT_THRESHOLD 128
#define POLYINVERT_NTT_THRESHOLD 65536
#define POLYEVALT_NTT_THRESHOLD 16384
#define MPZSPV_NORMALISE_STRIDE 512
```

(And there's of course also inline assembly in `longlong.h`; don't know what's used on Cygwin[32], but presumably less critical, too.)



---

archive/issue_comments_389383.json:
```json
{
    "body": "<a id='comment:33'></a>Some reports using ECM trunk.\nOn a x86_64, with a Cygwin64 setup, outside of Sage, using my own GMP 6.1.1 (dll) and Cygwin's GCC:\n\n```\n./configure --prefix=$LOCAL --with-gmp=$LOCAL --enable-shared --disable-static\n```\nI get\n\n```\n...\nconfigure: Build for host type x86_64-unknown-cygwin\nconfigure: CC=gcc, CFLAGS=-W -Wall -Wundef -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge\nconfigure: Linking GMP with -lgmp\nconfigure: Using asm redc code from directory x86_64\nconfigure: Not using SSE2 instructions in NTT code\nconfigure: Using APRCL to prove factors prime/composite\nconfigure: Assertions enabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```\nand make fails with\n\n```\nm4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s\n/bin/sh ../libtool    --mode=compile gcc  -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c -o mulredc1.lo mulredc1.s\nlibtool: compile:  gcc -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c mulredc1.s  -DDLL_EXPORT -DPIC -o .libs/mulredc1.o\n/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/../../../../x86_64-pc-cygwin/bin/as: BFD assertion (GNU Binutils) 2.25.2 a \u00e9chou\u00e9 /cygdrive/i/szsz/tmpp/cygwin64/binutils/binutils-2.25-4.x86_64/src/binutils-gdb/bfd/coff-x86_64.c:695\nmulredc1.s: Messages de l'assembleur:\nmulredc1.s:59: Erreur: ne peut repr\u00e9senter le type de r\u00e9adressage BFD_RELOC_386_GOTPC\n```\nWindows does not like `$_GLOBAL_OFFSET_TABLE` I would say.\n\nUsing ECM 6.4.4 on my Cygwin64 setup with the patch to use Win64 ABI, I get a similar configuration and `make` is fine.\nSurely `WANT_ASSERT` gets set in one case and not in the other, leading to the invalid use of the GOT in the trunk version.\nBut then `make check` fails with\n\n```\n./test.pp1 ./ecm.exe\nCygwin runtime failure: /home/jp/ecm-6.4.4/.libs/ecm.exe: Invalid relocation.  Offset 0x3025f223a at address 0x100414542 doesn't fit into 32 bits\n############### ERROR ###############\nExpected return code 8 but got 127\nmake: *** [Makefile:1982: check] Error 1\n```\n\nGoing back to the trunk version and passing `--disable-assert`, `make` is fine.\nAnd `make check` runs but fail all tests.\n\n```\nFAIL: test.pp1\nFAIL: test.pm1\nFAIL: test.ecm\n```\nwith the same relocation errors as in 6.4.4 as the log files tell.\n\nOn the same x86_64 machine, with the trunk version, using a Cygwin32 setup with a similar configure command, I get:\n\n```\nconfigure: Build for host type i686-pc-cygwin\nconfigure: CC=gcc, CFLAGS=-W -Wall -Wundef -m32 -O2 -pedantic -fomit-frame-pointer -mtune=sandybridge -march=sandybridge\nconfigure: Linking GMP with -lgmp\nconfigure: Not using asm redc code\nconfigure: Using SSE2 instructions in NTT code\nconfigure: Using APRCL to prove factors prime/composite\nconfigure: Assertions enabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```\nand `make` and `make check` are ok.",
    "created_at": "2016-08-23T15:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389383",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:33'></a>Some reports using ECM trunk.
On a x86_64, with a Cygwin64 setup, outside of Sage, using my own GMP 6.1.1 (dll) and Cygwin's GCC:

```
./configure --prefix=$LOCAL --with-gmp=$LOCAL --enable-shared --disable-static
```
I get

```
...
configure: Build for host type x86_64-unknown-cygwin
configure: CC=gcc, CFLAGS=-W -Wall -Wundef -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge
configure: Linking GMP with -lgmp
configure: Using asm redc code from directory x86_64
configure: Not using SSE2 instructions in NTT code
configure: Using APRCL to prove factors prime/composite
configure: Assertions enabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```
and make fails with

```
m4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s
/bin/sh ../libtool    --mode=compile gcc  -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c -o mulredc1.lo mulredc1.s
libtool: compile:  gcc -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c mulredc1.s  -DDLL_EXPORT -DPIC -o .libs/mulredc1.o
/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/../../../../x86_64-pc-cygwin/bin/as: BFD assertion (GNU Binutils) 2.25.2 a échoué /cygdrive/i/szsz/tmpp/cygwin64/binutils/binutils-2.25-4.x86_64/src/binutils-gdb/bfd/coff-x86_64.c:695
mulredc1.s: Messages de l'assembleur:
mulredc1.s:59: Erreur: ne peut représenter le type de réadressage BFD_RELOC_386_GOTPC
```
Windows does not like `$_GLOBAL_OFFSET_TABLE` I would say.

Using ECM 6.4.4 on my Cygwin64 setup with the patch to use Win64 ABI, I get a similar configuration and `make` is fine.
Surely `WANT_ASSERT` gets set in one case and not in the other, leading to the invalid use of the GOT in the trunk version.
But then `make check` fails with

```
./test.pp1 ./ecm.exe
Cygwin runtime failure: /home/jp/ecm-6.4.4/.libs/ecm.exe: Invalid relocation.  Offset 0x3025f223a at address 0x100414542 doesn't fit into 32 bits
############### ERROR ###############
Expected return code 8 but got 127
make: *** [Makefile:1982: check] Error 1
```

Going back to the trunk version and passing `--disable-assert`, `make` is fine.
And `make check` runs but fail all tests.

```
FAIL: test.pp1
FAIL: test.pm1
FAIL: test.ecm
```
with the same relocation errors as in 6.4.4 as the log files tell.

On the same x86_64 machine, with the trunk version, using a Cygwin32 setup with a similar configure command, I get:

```
configure: Build for host type i686-pc-cygwin
configure: CC=gcc, CFLAGS=-W -Wall -Wundef -m32 -O2 -pedantic -fomit-frame-pointer -mtune=sandybridge -march=sandybridge
configure: Linking GMP with -lgmp
configure: Not using asm redc code
configure: Using SSE2 instructions in NTT code
configure: Using APRCL to prove factors prime/composite
configure: Assertions enabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```
and `make` and `make check` are ok.



---

archive/issue_comments_389384.json:
```json
{
    "body": "<a id='comment:34'></a>Just realized the \"relocation\" errors might just be rebasing issues...",
    "created_at": "2016-08-23T15:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389384",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:34'></a>Just realized the "relocation" errors might just be rebasing issues...



---

archive/issue_comments_389385.json:
```json
{
    "body": "<a id='comment:35'></a>Patch has been accepted upstream.",
    "created_at": "2016-08-23T16:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389385",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>Patch has been accepted upstream.



---

archive/issue_comments_389386.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, in a later stable release.\"",
    "created_at": "2016-08-23T16:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389386",
    "user": "https://github.com/embray"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Fixed upstream, in a later stable release."



---

archive/issue_comments_389387.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:34 jpflori]:\n> Just realized the \"relocation\" errors might just be rebasing issues...\n\nAnd I can confirm  they are.",
    "created_at": "2016-08-23T17:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389387",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:36'></a>Replying to [comment:34 jpflori]:
> Just realized the "relocation" errors might just be rebasing issues...

And I can confirm  they are.



---

archive/issue_comments_389388.json:
```json
{
    "body": "<a id='comment:37'></a>I'll post further experiments on #20385.",
    "created_at": "2016-08-23T17:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389388",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:37'></a>I'll post further experiments on #20385.



---

archive/issue_comments_389389.json:
```json
{
    "body": "Changing upstream from \"Fixed upstream, in a later stable release.\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2016-08-23T22:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389389",
    "user": "https://github.com/nexttime"
}
```

Changing upstream from "Fixed upstream, in a later stable release." to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_389390.json:
```json
{
    "body": "<a id='comment:38'></a>Or did I miss something?",
    "created_at": "2016-08-23T22:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389390",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>Or did I miss something?



---

archive/issue_comments_389391.json:
```json
{
    "body": "<a id='comment:39'></a>I'm not sure I understand the meaning--I took \"in a later stable release\" to mean there will eventually be a stable release that contains this fix.  \"Later\" to me implies that it doesn't exist yet, but will.",
    "created_at": "2016-08-24T08:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389391",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'></a>I'm not sure I understand the meaning--I took "in a later stable release" to mean there will eventually be a stable release that contains this fix.  "Later" to me implies that it doesn't exist yet, but will.



---

archive/issue_comments_389392.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:39 embray]:\n> I'm not sure I understand the meaning--I took \"in a later stable release\" to mean there will eventually be a stable release that contains this fix.  \"Later\" to me implies that it doesn't exist yet, but will.\n\n\nNo, \"later\" refers to what we currently have in Sage, so *\"fixed in a later [stable] upstream release\"* means there exists some upstream version without the issue, but Sage hasn't yet upgraded to it (which is quite often the case as some upgrades aren't straight-forward, for various reasons).",
    "created_at": "2016-08-24T10:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389392",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>Replying to [comment:39 embray]:
> I'm not sure I understand the meaning--I took "in a later stable release" to mean there will eventually be a stable release that contains this fix.  "Later" to me implies that it doesn't exist yet, but will.


No, "later" refers to what we currently have in Sage, so *"fixed in a later [stable] upstream release"* means there exists some upstream version without the issue, but Sage hasn't yet upgraded to it (which is quite often the case as some upgrades aren't straight-forward, for various reasons).



---

archive/issue_comments_389393.json:
```json
{
    "body": "<a id='comment:41'></a>So it's not as speculative as you thought... ;-)",
    "created_at": "2016-08-24T10:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389393",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'></a>So it's not as speculative as you thought... ;-)



---

archive/issue_comments_389394.json:
```json
{
    "body": "<a id='comment:42'></a>Okay, I've been misusing that then!  Indeed I thought it was mostly speculative (but generally likely to be accurate for active projects).   Anyways, fine by me.",
    "created_at": "2016-08-25T09:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389394",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>Okay, I've been misusing that then!  Indeed I thought it was mostly speculative (but generally likely to be accurate for active projects).   Anyways, fine by me.



---

archive/issue_comments_389395.json:
```json
{
    "body": "<a id='comment:43'></a>a new release candidate is now available at\n\nhttps://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz\n\nPaul",
    "created_at": "2016-08-26T13:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21223#issuecomment-389395",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:43'></a>a new release candidate is now available at

https://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz

Paul
