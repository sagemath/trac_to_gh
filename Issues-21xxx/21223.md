# Issue 21223: ECM segfaults in Cygwin64

archive/issues_020986.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nRunning ECM with almost any inputs results in a segfault on Cygwin64.\n\nThis is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n\nOne possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n\nSubmitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nCC:  @jpflori @tscrim\n\nComponent: **porting: Cygwin**\n\nAuthor: **Erik Bray**\n\nBranch: **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21223_\n\n",
    "closed_at": "2016-08-19T22:44:59Z",
    "created_at": "2016-08-11T12:09:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "ECM segfaults in Cygwin64",
    "type": "issue",
    "updated_at": "2016-08-26T13:21:30Z",
    "url": "https://github.com/sagemath/sage/issues/21223",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

Running ECM with almost any inputs results in a segfault on Cygwin64.

This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.

One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.

Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623

Upstream: **Fixed upstream, but not in a stable release.**

CC:  @jpflori @tscrim

Component: **porting: Cygwin**

Author: **Erik Bray**

Branch: **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/21223_





---

archive/issue_events_295731.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T12:09:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "0000b0",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295731"
}
```



---

archive/issue_events_295732.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T12:09:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295732"
}
```



---

archive/issue_events_295733.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T12:09:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295733"
}
```



---

archive/issue_events_295734.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T12:21:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295734"
}
```



---

archive/issue_comments_309781.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2016-08-11T12:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309781",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_309782.json:
```json
{
    "body": "Branch: **[u/embray/ticket-21223](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-21223)**",
    "created_at": "2016-08-11T12:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309782",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-21223](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-21223)**



---

archive/issue_comments_309783.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c\"><code>c80277a</code></a></td><td><code>Make sure the WINDOWS64_ABI flag is set on Cygwin as well, otherwise the assembly routines use the wrong calling convention.</code></td></tr></table>\n",
    "created_at": "2016-08-11T12:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309783",
    "user": "https://github.com/embray"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c"><code>c80277a</code></a></td><td><code>Make sure the WINDOWS64_ABI flag is set on Cygwin as well, otherwise the assembly routines use the wrong calling convention.</code></td></tr></table>




---

archive/issue_comments_309784.json:
```json
{
    "body": "Commit: **[`c80277a`](https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c)**",
    "created_at": "2016-08-11T12:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309784",
    "user": "https://github.com/embray"
}
```

Commit: **[`c80277a`](https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c)**



---

archive/issue_comments_309785.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Running ECM with almost any inputs results in a segfault on Cygwin64.\n \n-More details soon.\n+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n+\n+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n``````\n",
    "created_at": "2016-08-11T12:21:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309785",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Running ECM with almost any inputs results in a segfault on Cygwin64.
 
-More details soon.
+This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.
+
+One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.
``````




---

archive/issue_comments_309786.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2016-08-11T12:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309786",
    "user": "https://github.com/embray"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_309787.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nECM 7.x got \"revived\", see #20385.  7.0.3 is still kind of beta/rc though I'd say.",
    "created_at": "2016-08-11T13:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309787",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

ECM 7.x got "revived", see #20385.  7.0.3 is still kind of beta/rc though I'd say.



---

archive/issue_comments_309788.json:
```json
{
    "body": "Changed commit from **[`c80277a`](https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c)** to **[`6361e6c`](https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee)**",
    "created_at": "2016-08-11T13:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309788",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c80277a`](https://github.com/sagemath/sagetrac-mirror/commit/c80277a2ea1663d4803e4974985f829d27d5259c)** to **[`6361e6c`](https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee)**



---

archive/issue_comments_309789.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee\"><code>6361e6c</code></a></td><td><code>Bump patch level</code></td></tr></table>\n",
    "created_at": "2016-08-11T13:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309789",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee"><code>6361e6c</code></a></td><td><code>Bump patch level</code></td></tr></table>




---

archive/issue_comments_309790.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n... as is the branch on #20385; i.e., not really \"needs review\" yet, but you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.",
    "created_at": "2016-08-11T13:22:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309790",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

... as is the branch on #20385; i.e., not really "needs review" yet, but you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.



---

archive/issue_comments_309791.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@nexttime](#comment%3A5):\n> you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.\n\nNope, in 7.0.3 (now `configure.ac`) there's still:\n\n```sh\nif test \"x$enable_asm_redc\" = xyes; then\n# do the necessary definitions and includes\n  AC_DEFINE([USE_ASM_REDC],1,[Define to 1 to use asm redc])\n  test \"x$CCAS\" != x || CCAS=\"$CC -c\"\n  AC_SUBST([CCAS])\n  GMP_PROG_M4\n  GMP_ASM_UNDERSCORE\n  GMP_ASM_TEXT\n  GMP_ASM_GLOBL\n  GMP_ASM_TYPE\n\n  case $host in\n    *-*-mingw32) GMP_DEFINE([WINDOWS64_ABI], 1)\n                 AC_DEFINE([WINDOWS64_ABI], 1,[Define to 1 if x86_64 mulredc*() functions should be called with Windows ABI]);;\n    *) ;;\n  esac\n\n  case $host in\n    pentium3-*-*)\n      echo \"WARNING: Your processor is recognized as Pentium3.\"\n      echo \"         The asm code uses SSE2, and therefore it might\"\n      echo \"         fail if your proc is indeed a P3, and not a\"\n      echo \"         Pentium M. If you have compilation problems,\"\n      echo \"         consider using --disable-asm-redc.\" ;;\n    *)\n  esac\nfi\nAM_CONDITIONAL([ENABLE_ASM_REDC], [test \"x$enable_asm_redc\" = xyes])\n```",
    "created_at": "2016-08-11T13:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309791",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@nexttime](#comment%3A5):
> you could try whether that has been fixed upstream already, probably with vanilla 7.0.3.

Nope, in 7.0.3 (now `configure.ac`) there's still:

```sh
if test "x$enable_asm_redc" = xyes; then
# do the necessary definitions and includes
  AC_DEFINE([USE_ASM_REDC],1,[Define to 1 to use asm redc])
  test "x$CCAS" != x || CCAS="$CC -c"
  AC_SUBST([CCAS])
  GMP_PROG_M4
  GMP_ASM_UNDERSCORE
  GMP_ASM_TEXT
  GMP_ASM_GLOBL
  GMP_ASM_TYPE

  case $host in
    *-*-mingw32) GMP_DEFINE([WINDOWS64_ABI], 1)
                 AC_DEFINE([WINDOWS64_ABI], 1,[Define to 1 if x86_64 mulredc*() functions should be called with Windows ABI]);;
    *) ;;
  esac

  case $host in
    pentium3-*-*)
      echo "WARNING: Your processor is recognized as Pentium3."
      echo "         The asm code uses SSE2, and therefore it might"
      echo "         fail if your proc is indeed a P3, and not a"
      echo "         Pentium M. If you have compilation problems,"
      echo "         consider using --disable-asm-redc." ;;
    *)
  esac
fi
AM_CONDITIONAL([ENABLE_ASM_REDC], [test "x$enable_asm_redc" = xyes])
```



---

archive/issue_comments_309792.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'll take care of including this patch on #20385 if upstream won't include it soon.",
    "created_at": "2016-08-11T13:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309792",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

I'll take care of including this patch on #20385 if upstream won't include it soon.



---

archive/issue_comments_309793.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOkay, thanks.",
    "created_at": "2016-08-11T14:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309793",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Okay, thanks.



---

archive/issue_events_295735.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-15T07:41:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295735"
}
```



---

archive/issue_events_295736.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-15T07:41:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295736"
}
```



---

archive/issue_events_295737.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-15T07:41:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295737"
}
```



---

archive/issue_comments_309794.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n1. This should be reported upstream.\n\n2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.\n\n3. I cannot test this, but the patch is clear. If you say this makes ECM work on Cygwin64, that's good enough for me.",
    "created_at": "2016-08-15T07:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309794",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

1. This should be reported upstream.

2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.

3. I cannot test this, but the patch is clear. If you say this makes ECM work on Cygwin64, that's good enough for me.



---

archive/issue_comments_309795.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment%3A9):\n> 2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.\n\nOh right, `patch` doesn't *by default* take the modification time from the patch header (where `configure` is about a minute newer).\n\nWhile it would be safer to explicitly `touch configure` after patching in `spkg-install`, `make` *should<sup>TM</sup>* treat `configure` up-to-date if you just reverse the order in the patch.  (I'm not even sure it wouldn't as is; you'd probably need a *very slow* machine to cause it to not do so.)",
    "created_at": "2016-08-15T13:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309795",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment%3A9):
> 2. You need to patch `configure.in` *before* `configure` otherwise the build system will want to run `autoconf` to update `configure`.

Oh right, `patch` doesn't *by default* take the modification time from the patch header (where `configure` is about a minute newer).

While it would be safer to explicitly `touch configure` after patching in `spkg-install`, `make` *should<sup>TM</sup>* treat `configure` up-to-date if you just reverse the order in the patch.  (I'm not even sure it wouldn't as is; you'd probably need a *very slow* machine to cause it to not do so.)



---

archive/issue_comments_309796.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.\n \n One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.\n+\n+Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623\n``````\n",
    "created_at": "2016-08-16T09:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309796",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 This is because any time it enters one of its hand-written assembly routines it needs to use the appropriate calling convention (Microsoft x64 convention on Windows), but it is only picking the correct Windows calling convention when compiling with mingw.  It should do the same with Cygwin as well.
 
 One possible workaround without patching would be to configure ECM with `--disable-asm-redc` to disable the custom assembly code entirely.  But this is also overkill--the code works just fine as long as it's configured correctly for the platform.
+
+Submitted upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=20697&group_id=135&atid=623
``````




---

archive/issue_comments_309797.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**",
    "created_at": "2016-08-16T09:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309797",
    "user": "https://github.com/embray"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. No feedback yet.**



---

archive/issue_comments_309798.json:
```json
{
    "body": "Changed commit from **[`6361e6c`](https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee)** to **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**",
    "created_at": "2016-08-16T09:08:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309798",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6361e6c`](https://github.com/sagemath/sagetrac-mirror/commit/6361e6cdac8484964b9e952f5b482b986113aaee)** to **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**



---

archive/issue_comments_309799.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415\"><code>a4adca5</code></a></td><td><code>Change the patch order so that configure gets touched after configure.in</code></td></tr></table>\n",
    "created_at": "2016-08-16T09:08:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309799",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415"><code>a4adca5</code></a></td><td><code>Change the patch order so that configure gets touched after configure.in</code></td></tr></table>




---

archive/issue_events_295738.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-16T13:57:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295738"
}
```



---

archive/issue_events_295739.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-16T13:57:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295739"
}
```



---

archive/issue_events_295740.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-16T14:03:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295740"
}
```



---

archive/issue_events_295741.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-16T14:03:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295741"
}
```



---

archive/issue_comments_309800.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-08-16T14:03:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309800",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_309801.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI assume you actually tested this on Cygwin64 :-)",
    "created_at": "2016-08-16T14:03:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309801",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

I assume you actually tested this on Cygwin64 :-)



---

archive/issue_comments_309802.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nJeroen was quicker, but I also didn't test this *on Cygwin[64]*...",
    "created_at": "2016-08-16T14:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309802",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">comment:16</div>

Jeroen was quicker, but I also didn't test this *on Cygwin[64]*...



---

archive/issue_comments_309803.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYup. Before this patch, running ecm segfaults.  Without it, no segfaults (and all the tests that invoke it pass)",
    "created_at": "2016-08-16T14:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309803",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Yup. Before this patch, running ecm segfaults.  Without it, no segfaults (and all the tests that invoke it pass)



---

archive/issue_comments_309804.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nFWIW, I guess similar would still happen on Cygwin**32** on some x86 CPUs at least (probably x86_64 in 32-bit mode as well), but only if one *explicitly* configures GMP-ECM with `--enable-asm-redc`, which we *don't* do in Sage.  (A user could still do that in *Sage's* environment variable `ECM_CONFIGURE` though.)  The relevant asm code is in `athlon/` and `pentium4/`.\n\nNot sure whether the NTT inline assembly code (which is only used on [some] x86 CPUs, and again probably also on x86_64 in 32-bit mode) is safe w.r.t. the Windows ABI.  (It *might* get used on Cygwin**32**, even by default, depending on the CPU, AFAICS.)\n\nBut both is IMHO beyond this ticket, since the ticket's title mentions just Cygwin**64**.  (Feel free to try and eventually open a follow-up ticket for that... :P -- I personally won't.)",
    "created_at": "2016-08-16T16:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309804",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

FWIW, I guess similar would still happen on Cygwin**32** on some x86 CPUs at least (probably x86_64 in 32-bit mode as well), but only if one *explicitly* configures GMP-ECM with `--enable-asm-redc`, which we *don't* do in Sage.  (A user could still do that in *Sage's* environment variable `ECM_CONFIGURE` though.)  The relevant asm code is in `athlon/` and `pentium4/`.

Not sure whether the NTT inline assembly code (which is only used on [some] x86 CPUs, and again probably also on x86_64 in 32-bit mode) is safe w.r.t. the Windows ABI.  (It *might* get used on Cygwin**32**, even by default, depending on the CPU, AFAICS.)

But both is IMHO beyond this ticket, since the ticket's title mentions just Cygwin**64**.  (Feel free to try and eventually open a follow-up ticket for that... :P -- I personally won't.)



---

archive/issue_comments_309805.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe solution in the ticket just targets \"cygwin\" so it's a moot point I think.\n\nAlso I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).",
    "created_at": "2016-08-16T16:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309805",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

The solution in the ticket just targets "cygwin" so it's a moot point I think.

Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).



---

archive/issue_comments_309806.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@embray](#comment%3A19):\n> The solution in the ticket just targets \"cygwin\" so it's a moot point I think.\n\nNope, that doesn't fix the two issues I mentioned above, as on 32-bit systems the x86_64 code isn't used, and (of course) only in the latter `WINDOWS64_ABI` is used at all.  (There's no macro for Windows ABI in general, nor Win32 ABI, although native Microsoft Windows -- with MS Visual Foo -- is handled.)\n\n\\\\\n\n> Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).\n\nOk.\n\nOther Sage-on-Cygwin developers may try.  (You could still detail your upstream report though, as it effectively only addresses Cygwin**64**.)",
    "created_at": "2016-08-16T16:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309806",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@embray](#comment%3A19):
> The solution in the ticket just targets "cygwin" so it's a moot point I think.

Nope, that doesn't fix the two issues I mentioned above, as on 32-bit systems the x86_64 code isn't used, and (of course) only in the latter `WINDOWS64_ABI` is used at all.  (There's no macro for Windows ABI in general, nor Win32 ABI, although native Microsoft Windows -- with MS Visual Foo -- is handled.)

\\

> Also I'm personally *only* targeting Sage for Cygwin64.  Reason being I hope soon (once most of the issues are worked out) to release a Windows installer for Sage that includes cygwin as a DLL.  This is for users, less so developers, and I'm not interested in non-64-bit platforms (though willing to poke at them if absolutely necessary).

Ok.

Other Sage-on-Cygwin developers may try.  (You could still detail your upstream report though, as it effectively only addresses Cygwin**64**.)



---

archive/issue_comments_309807.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm not really sure what you're trying to say here.",
    "created_at": "2016-08-17T07:44:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309807",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm not really sure what you're trying to say here.



---

archive/issue_comments_309808.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@embray](#comment%3A21):\n> I'm not really sure what you're trying to say here.\n\nOn **32-bit** systems (including Cygwin**32**), *other* assembly files are used, which may cause similar problems (because they at least don't care about Pascal calling convention).\n\nThere's also some *inline assembly* which is used on 32-bit (x86) systems only; there I'm not sure whether it complies also to the Win32 ABI w.r.t. register usage.",
    "created_at": "2016-08-17T09:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309808",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@embray](#comment%3A21):
> I'm not really sure what you're trying to say here.

On **32-bit** systems (including Cygwin**32**), *other* assembly files are used, which may cause similar problems (because they at least don't care about Pascal calling convention).

There's also some *inline assembly* which is used on 32-bit (x86) systems only; there I'm not sure whether it complies also to the Win32 ABI w.r.t. register usage.



---

archive/issue_comments_309809.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAh, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.",
    "created_at": "2016-08-19T10:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309809",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.



---

archive/issue_comments_309810.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@embray](#comment%3A23):\n> Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.\n\nSure.  In any case, it's easy to work around potential problems on Cygwin32 by simply setting `ECM_CONFIGURE=\"--disable-sse2 --disable-asm-redc\"` before or when (re)installing the package.\n\nWho is likely to test on Cygwin32?",
    "created_at": "2016-08-19T10:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309810",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@embray](#comment%3A23):
> Ah, okay.  That I don't know.  If it is a problem it can be addressed in a new ticket.

Sure.  In any case, it's easy to work around potential problems on Cygwin32 by simply setting `ECM_CONFIGURE="--disable-sse2 --disable-asm-redc"` before or when (re)installing the package.

Who is likely to test on Cygwin32?



---

archive/issue_comments_309811.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-21223](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-21223)** to **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**",
    "created_at": "2016-08-19T22:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309811",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-21223](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-21223)** to **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)**



---

archive/issue_events_295742.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-19T22:44:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295742"
}
```



---

archive/issue_events_295743.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c4e95f7aad6fb33a6689312179608ca9599778e7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-19T22:44:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21223#event-295743"
}
```



---

archive/issue_comments_309812.json:
```json
{
    "body": "Changed commit from **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)** to none",
    "created_at": "2016-08-23T06:54:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309812",
    "user": "https://github.com/zimmermann6"
}
```

Changed commit from **[`a4adca5`](https://github.com/sagemath/sagetrac-mirror/commit/a4adca5f24de505dfe56316ddc9bd47954746415)** to none



---

archive/issue_comments_309813.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\npatch applied upstream. Are you sure this is fine under 32-bit cygwin too?\n\nPaul",
    "created_at": "2016-08-23T06:54:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309813",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:27" align="right">comment:27</div>

patch applied upstream. Are you sure this is fine under 32-bit cygwin too?

Paul



---

archive/issue_comments_309814.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI should be able to test Cygwin32 this afternoon.",
    "created_at": "2016-08-23T08:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309814",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:28" align="right">comment:28</div>

I should be able to test Cygwin32 this afternoon.



---

archive/issue_comments_309815.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n> I should be able to test Cygwin32 this afternoon.\n\ngreat! Please test revision 2976 (or later) of GMP-ECM:\n\n$ svn checkout svn://scm.gforge.inria.fr/svnroot/ecm/trunk ecm\n\nPaul",
    "created_at": "2016-08-23T09:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309815",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:29" align="right">comment:29</div>

> I should be able to test Cygwin32 this afternoon.

great! Please test revision 2976 (or later) of GMP-ECM:

$ svn checkout svn://scm.gforge.inria.fr/svnroot/ecm/trunk ecm

Paul



---

archive/issue_comments_309816.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jpflori](#comment%3A28):\n> I should be able to test Cygwin32 this afternoon.\n\nI replied to Paul on the upstream bug report.  (The patch here won't *break* anything on Cygwin32, but it won't solve potential similar issues on 32-bit Cygwin either.)\n\nYou may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).",
    "created_at": "2016-08-23T11:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309816",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jpflori](#comment%3A28):
> I should be able to test Cygwin32 this afternoon.

I replied to Paul on the upstream bug report.  (The patch here won't *break* anything on Cygwin32, but it won't solve potential similar issues on 32-bit Cygwin either.)

You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).



---

archive/issue_comments_309817.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@nexttime](#comment%3A30):\n> Replying to [@jpflori](#comment%3A28):\n> > I should be able to test Cygwin32 this afternoon.\n> \n> You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).\n\nAlso saving the `config.log`s and the build logs perhaps, to see what actually got used.  (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)",
    "created_at": "2016-08-23T12:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309817",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@nexttime](#comment%3A30):
> Replying to [@jpflori](#comment%3A28):
> > I should be able to test Cygwin32 this afternoon.
> 
> You may try trunk (outside of Sage) with `--enable-sse2` (but without `--enable-asm-redc`), perhaps running `make longcheck` instead of just `make check`, and afterwards with `--enable-asm-redc` (but without `--enable-sse2`).

Also saving the `config.log`s and the build logs perhaps, to see what actually got used.  (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)



---

archive/issue_comments_309818.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@nexttime](#comment%3A31):\n> (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)\n\nOh, there's no *assembly code* in `x86/`, just `params.h`:\n\n```C\n#define MPZMOD_THRESHOLD 135\n#define REDC_THRESHOLD 200\n#define MPN_MUL_LO_THRESHOLD_TABLE {0, 0, 1, 1, 0, 0, 5, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 16, 1, 14, 14, 16, 16, 1}\n#define NTT_GFP_TWIDDLE_DIF_BREAKOVER 11\n#define NTT_GFP_TWIDDLE_DIT_BREAKOVER 11\n#define MUL_NTT_THRESHOLD 262144\n#define PREREVERTDIVISION_NTT_THRESHOLD 128\n#define POLYINVERT_NTT_THRESHOLD 65536\n#define POLYEVALT_NTT_THRESHOLD 16384\n#define MPZSPV_NORMALISE_STRIDE 512\n```\n\n(And there's of course also inline assembly in `longlong.h`; don't know what's used on Cygwin[32], but presumably less critical, too.)",
    "created_at": "2016-08-23T12:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309818",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@nexttime](#comment%3A31):
> (In **6.4.4**, there's 32-bit asm code in `athlon/` and `pentium4/`, besides inline assembly in `{ntt_gfp,spv}.c`, which is less critical I think.  Just noticed ECM **7.x** now also has `x86/`, which I haven't at all looked at yet.)

Oh, there's no *assembly code* in `x86/`, just `params.h`:

```C
#define MPZMOD_THRESHOLD 135
#define REDC_THRESHOLD 200
#define MPN_MUL_LO_THRESHOLD_TABLE {0, 0, 1, 1, 0, 0, 5, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 16, 1, 14, 14, 16, 16, 1}
#define NTT_GFP_TWIDDLE_DIF_BREAKOVER 11
#define NTT_GFP_TWIDDLE_DIT_BREAKOVER 11
#define MUL_NTT_THRESHOLD 262144
#define PREREVERTDIVISION_NTT_THRESHOLD 128
#define POLYINVERT_NTT_THRESHOLD 65536
#define POLYEVALT_NTT_THRESHOLD 16384
#define MPZSPV_NORMALISE_STRIDE 512
```

(And there's of course also inline assembly in `longlong.h`; don't know what's used on Cygwin[32], but presumably less critical, too.)



---

archive/issue_comments_309819.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSome reports using ECM trunk.\nOn a x86_64, with a Cygwin64 setup, outside of Sage, using my own GMP 6.1.1 (dll) and Cygwin's GCC:\n\n```\n./configure --prefix=$LOCAL --with-gmp=$LOCAL --enable-shared --disable-static\n```\nI get\n\n```\n...\nconfigure: Build for host type x86_64-unknown-cygwin\nconfigure: CC=gcc, CFLAGS=-W -Wall -Wundef -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge\nconfigure: Linking GMP with -lgmp\nconfigure: Using asm redc code from directory x86_64\nconfigure: Not using SSE2 instructions in NTT code\nconfigure: Using APRCL to prove factors prime/composite\nconfigure: Assertions enabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```\nand make fails with\n\n```\nm4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s\n/bin/sh ../libtool    --mode=compile gcc  -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c -o mulredc1.lo mulredc1.s\nlibtool: compile:  gcc -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c mulredc1.s  -DDLL_EXPORT -DPIC -o .libs/mulredc1.o\n/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/../../../../x86_64-pc-cygwin/bin/as: BFD assertion (GNU Binutils) 2.25.2 a \u00e9chou\u00e9 /cygdrive/i/szsz/tmpp/cygwin64/binutils/binutils-2.25-4.x86_64/src/binutils-gdb/bfd/coff-x86_64.c:695\nmulredc1.s: Messages de l'assembleur:\nmulredc1.s:59: Erreur: ne peut repr\u00e9senter le type de r\u00e9adressage BFD_RELOC_386_GOTPC\n```\nWindows does not like `$_GLOBAL_OFFSET_TABLE` I would say.\n\nUsing ECM 6.4.4 on my Cygwin64 setup with the patch to use Win64 ABI, I get a similar configuration and `make` is fine.\nSurely `WANT_ASSERT` gets set in one case and not in the other, leading to the invalid use of the GOT in the trunk version.\nBut then `make check` fails with\n\n```\n./test.pp1 ./ecm.exe\nCygwin runtime failure: /home/jp/ecm-6.4.4/.libs/ecm.exe: Invalid relocation.  Offset 0x3025f223a at address 0x100414542 doesn't fit into 32 bits\n############### ERROR ###############\nExpected return code 8 but got 127\nmake: *** [Makefile:1982: check] Error 1\n```\n\nGoing back to the trunk version and passing `--disable-assert`, `make` is fine.\nAnd `make check` runs but fail all tests.\n\n```\nFAIL: test.pp1\nFAIL: test.pm1\nFAIL: test.ecm\n```\nwith the same relocation errors as in 6.4.4 as the log files tell.\n\nOn the same x86_64 machine, with the trunk version, using a Cygwin32 setup with a similar configure command, I get:\n\n```\nconfigure: Build for host type i686-pc-cygwin\nconfigure: CC=gcc, CFLAGS=-W -Wall -Wundef -m32 -O2 -pedantic -fomit-frame-pointer -mtune=sandybridge -march=sandybridge\nconfigure: Linking GMP with -lgmp\nconfigure: Not using asm redc code\nconfigure: Using SSE2 instructions in NTT code\nconfigure: Using APRCL to prove factors prime/composite\nconfigure: Assertions enabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```\nand `make` and `make check` are ok.",
    "created_at": "2016-08-23T15:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309819",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:33" align="right">comment:33</div>

Some reports using ECM trunk.
On a x86_64, with a Cygwin64 setup, outside of Sage, using my own GMP 6.1.1 (dll) and Cygwin's GCC:

```
./configure --prefix=$LOCAL --with-gmp=$LOCAL --enable-shared --disable-static
```
I get

```
...
configure: Build for host type x86_64-unknown-cygwin
configure: CC=gcc, CFLAGS=-W -Wall -Wundef -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge
configure: Linking GMP with -lgmp
configure: Using asm redc code from directory x86_64
configure: Not using SSE2 instructions in NTT code
configure: Using APRCL to prove factors prime/composite
configure: Assertions enabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```
and make fails with

```
m4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s
/bin/sh ../libtool    --mode=compile gcc  -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c -o mulredc1.lo mulredc1.s
libtool: compile:  gcc -O2 -pedantic -fomit-frame-pointer -m64 -mtune=sandybridge -march=sandybridge -c mulredc1.s  -DDLL_EXPORT -DPIC -o .libs/mulredc1.o
/usr/lib/gcc/x86_64-pc-cygwin/5.4.0/../../../../x86_64-pc-cygwin/bin/as: BFD assertion (GNU Binutils) 2.25.2 a chou /cygdrive/i/szsz/tmpp/cygwin64/binutils/binutils-2.25-4.x86_64/src/binutils-gdb/bfd/coff-x86_64.c:695
mulredc1.s: Messages de l'assembleur:
mulredc1.s:59: Erreur: ne peut reprsenter le type de radressage BFD_RELOC_386_GOTPC
```
Windows does not like `$_GLOBAL_OFFSET_TABLE` I would say.

Using ECM 6.4.4 on my Cygwin64 setup with the patch to use Win64 ABI, I get a similar configuration and `make` is fine.
Surely `WANT_ASSERT` gets set in one case and not in the other, leading to the invalid use of the GOT in the trunk version.
But then `make check` fails with

```
./test.pp1 ./ecm.exe
Cygwin runtime failure: /home/jp/ecm-6.4.4/.libs/ecm.exe: Invalid relocation.  Offset 0x3025f223a at address 0x100414542 doesn't fit into 32 bits
############### ERROR ###############
Expected return code 8 but got 127
make: *** [Makefile:1982: check] Error 1
```

Going back to the trunk version and passing `--disable-assert`, `make` is fine.
And `make check` runs but fail all tests.

```
FAIL: test.pp1
FAIL: test.pm1
FAIL: test.ecm
```
with the same relocation errors as in 6.4.4 as the log files tell.

On the same x86_64 machine, with the trunk version, using a Cygwin32 setup with a similar configure command, I get:

```
configure: Build for host type i686-pc-cygwin
configure: CC=gcc, CFLAGS=-W -Wall -Wundef -m32 -O2 -pedantic -fomit-frame-pointer -mtune=sandybridge -march=sandybridge
configure: Linking GMP with -lgmp
configure: Not using asm redc code
configure: Using SSE2 instructions in NTT code
configure: Using APRCL to prove factors prime/composite
configure: Assertions enabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```
and `make` and `make check` are ok.



---

archive/issue_comments_309820.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nJust realized the \"relocation\" errors might just be rebasing issues...",
    "created_at": "2016-08-23T15:42:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309820",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:34" align="right">comment:34</div>

Just realized the "relocation" errors might just be rebasing issues...



---

archive/issue_comments_309821.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nPatch has been accepted upstream.",
    "created_at": "2016-08-23T16:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309821",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Patch has been accepted upstream.



---

archive/issue_comments_309822.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2016-08-23T16:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309822",
    "user": "https://github.com/embray"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, in a later stable release.**



---

archive/issue_comments_309823.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jpflori](#comment%3A34):\n> Just realized the \"relocation\" errors might just be rebasing issues...\n\nAnd I can confirm  they are.",
    "created_at": "2016-08-23T17:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309823",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jpflori](#comment%3A34):
> Just realized the "relocation" errors might just be rebasing issues...

And I can confirm  they are.



---

archive/issue_comments_309824.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI'll post further experiments on #20385.",
    "created_at": "2016-08-23T17:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309824",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:37" align="right">comment:37</div>

I'll post further experiments on #20385.



---

archive/issue_comments_309825.json:
```json
{
    "body": "Changed upstream from **Fixed upstream, in a later stable release.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2016-08-23T22:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309825",
    "user": "https://github.com/nexttime"
}
```

Changed upstream from **Fixed upstream, in a later stable release.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_309826.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOr did I miss something?",
    "created_at": "2016-08-23T22:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309826",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:38" align="right">comment:38</div>

Or did I miss something?



---

archive/issue_comments_309827.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI'm not sure I understand the meaning--I took \"in a later stable release\" to mean there will eventually be a stable release that contains this fix.  \"Later\" to me implies that it doesn't exist yet, but will.",
    "created_at": "2016-08-24T08:47:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309827",
    "user": "https://github.com/embray"
}
```

<div id="comment:39" align="right">comment:39</div>

I'm not sure I understand the meaning--I took "in a later stable release" to mean there will eventually be a stable release that contains this fix.  "Later" to me implies that it doesn't exist yet, but will.



---

archive/issue_comments_309828.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@embray](#comment%3A39):\n> I'm not sure I understand the meaning--I took \"in a later stable release\" to mean there will eventually be a stable release that contains this fix.  \"Later\" to me implies that it doesn't exist yet, but will.\n\nNo, \"later\" refers to what we currently have in Sage, so *\"fixed in a later [stable] upstream release\"* means there exists some upstream version without the issue, but Sage hasn't yet upgraded to it (which is quite often the case as some upgrades aren't straight-forward, for various reasons).",
    "created_at": "2016-08-24T10:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309828",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@embray](#comment%3A39):
> I'm not sure I understand the meaning--I took "in a later stable release" to mean there will eventually be a stable release that contains this fix.  "Later" to me implies that it doesn't exist yet, but will.

No, "later" refers to what we currently have in Sage, so *"fixed in a later [stable] upstream release"* means there exists some upstream version without the issue, but Sage hasn't yet upgraded to it (which is quite often the case as some upgrades aren't straight-forward, for various reasons).



---

archive/issue_comments_309829.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nSo it's not as speculative as you thought... ;-)",
    "created_at": "2016-08-24T10:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309829",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:41" align="right">comment:41</div>

So it's not as speculative as you thought... ;-)



---

archive/issue_comments_309830.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOkay, I've been misusing that then!  Indeed I thought it was mostly speculative (but generally likely to be accurate for active projects).   Anyways, fine by me.",
    "created_at": "2016-08-25T09:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309830",
    "user": "https://github.com/embray"
}
```

<div id="comment:42" align="right">comment:42</div>

Okay, I've been misusing that then!  Indeed I thought it was mostly speculative (but generally likely to be accurate for active projects).   Anyways, fine by me.



---

archive/issue_comments_309831.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\na new release candidate is now available at\n\nhttps://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz\n\nPaul",
    "created_at": "2016-08-26T13:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21223#issuecomment-309831",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:43" align="right">comment:43</div>

a new release candidate is now available at

https://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz

Paul
