# Issue 21834: Faster minpoly and charpoly functions for finite field extensions

archive/issues_021597.json:
```json
{
    "body": "For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n\nAnd even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n\n\nBefore:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n100 loops, best of 3: 3.21 ms per loop\n```\n\nAfter:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n1000 loops, best of 3: 207 \u00b5s per loop\n```\n\n**CC:**  @defeo @jdemeyer\n\n**Keywords:** finite fields minpoly\n\n**Branch/Commit:** [42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)\n\n**Reviewer:** Luca De Feo\n\n**Author:** Jean-Pierre Flori\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21834\n\n",
    "closed_at": "2016-11-19T16:34:55Z",
    "created_at": "2016-11-07T15:33:26Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Faster minpoly and charpoly functions for finite field extensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21834",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.

And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.


Before:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
100 loops, best of 3: 3.21 ms per loop
```

After:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
1000 loops, best of 3: 207 Âµs per loop
```

**CC:**  @defeo @jdemeyer

**Keywords:** finite fields minpoly

**Branch/Commit:** [42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)

**Reviewer:** Luca De Feo

**Author:** Jean-Pierre Flori

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/21834





---

archive/issue_comments_406049.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,12 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n Before:\n+\n+```\n sage: K.<z> = GF(461**173)\n sage: %timeit K(55).minpoly()\n 100 loops, best of 3: 3.21 ms per loop\n-\n+```\n \n After:\n \n``````\n",
    "created_at": "2016-11-07T15:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406049",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,12 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
 Before:
+
+```
 sage: K.<z> = GF(461**173)
 sage: %timeit K(55).minpoly()
 100 loops, best of 3: 3.21 ms per loop
-
+```
 
 After:
 
``````




---

archive/issue_comments_406050.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-11-07T15:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406050",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_406051.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-07T16:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406051",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_406052.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+\n+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406052",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+
+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
 
 Before:
 
``````




---

archive/issue_comments_406053.json:
```json
{
    "body": "**Changing commit** from \"[24168c8b40ee9fc839e46433dadc10695acd8a8b](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)\" to \"[613c78249818205abbe6c4126814232fd2e76f05](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)\".",
    "created_at": "2016-11-07T16:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[24168c8b40ee9fc839e46433dadc10695acd8a8b](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)" to "[613c78249818205abbe6c4126814232fd2e76f05](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)".



---

archive/issue_comments_406054.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05\">613c782</a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>\n",
    "created_at": "2016-11-07T16:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05">613c782</a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>




---

archive/issue_comments_406055.json:
```json
{
    "body": "<a id='comment:4'></a>\nFYI:\n\n```\nsage: K.<z> = GF(461**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n10 loops, best of 3: 103 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n100 loops, best of 3: 5.28 ms per loop\n```",
    "created_at": "2016-11-07T16:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406055",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>
FYI:

```
sage: K.<z> = GF(461**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
10 loops, best of 3: 103 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
100 loops, best of 3: 5.28 ms per loop
```



---

archive/issue_comments_406056.json:
```json
{
    "body": "<a id='comment:5'></a>\nSome more timings:\n\n```\nsage: K.<z> = GF(next_prime(2**30)**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 205 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n10 loops, best of 3: 22.2 ms per loop\nsage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 19.6 s per loop\nsage: %timeit b.minpoly(algorithm='pari')\n1 loop, best of 3: 372 ms per loop\n```",
    "created_at": "2016-11-07T16:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406056",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
Some more timings:

```
sage: K.<z> = GF(next_prime(2**30)**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 205 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
10 loops, best of 3: 22.2 ms per loop
sage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 19.6 s per loop
sage: %timeit b.minpoly(algorithm='pari')
1 loop, best of 3: 372 ms per loop
```



---

archive/issue_comments_406057.json:
```json
{
    "body": "<a id='comment:6'></a>\nSomething should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).",
    "created_at": "2016-11-07T16:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406057",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>
Something should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).



---

archive/issue_comments_406058.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-07T16:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406058",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_065625.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "rename": {
        "from": "Faster minpoly function for constants in finite field extensions",
        "to": "Faster minpoly and charpoly functions for finite field extensions"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21834#event-65625"
}
```



---

archive/issue_comments_406059.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-07T16:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406059",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_406060.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n+\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406060",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.
+
 
 Before:
 
``````




---

archive/issue_comments_406061.json:
```json
{
    "body": "<a id='comment:8'></a>\nWith my changes the doc is wrong.\nE.g. for extensions using PARI, in the \"matrix\" case, it is actually PARI charpoly function which is used.\n\nWhile fixing this, I'll also fix the charpoly general case.",
    "created_at": "2016-11-07T16:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406061",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
With my changes the doc is wrong.
E.g. for extensions using PARI, in the "matrix" case, it is actually PARI charpoly function which is used.

While fixing this, I'll also fix the charpoly general case.



---

archive/issue_comments_406062.json:
```json
{
    "body": "**Changing commit** from \"[613c78249818205abbe6c4126814232fd2e76f05](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)\" to \"[d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)\".",
    "created_at": "2016-11-07T17:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406062",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[613c78249818205abbe6c4126814232fd2e76f05](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)" to "[d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)".



---

archive/issue_comments_406063.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1\">4174d3e</a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0\">d99cd71</a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>\n",
    "created_at": "2016-11-07T17:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1">4174d3e</a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0">d99cd71</a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>




---

archive/issue_comments_406064.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'm not quite satisfied by the current situation:\n* maybe we could have a \"matrix\" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix\n* the \"charpoly\" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.\n\nDoes anyone think anything?",
    "created_at": "2016-11-07T17:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406064",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:10'></a>
I'm not quite satisfied by the current situation:
* maybe we could have a "matrix" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix
* the "charpoly" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.

Does anyone think anything?



---

archive/issue_comments_406065.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-07T17:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406065",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_406066.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.\n\nThe name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.\n\nI would completely throw away the \"charpoly\" option, and have a dedicated generic minpoly implementation. Either \"matrix\", as you suggest, or something calling \"berlekamp_massey\".",
    "created_at": "2016-11-10T16:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406066",
    "user": "https://github.com/defeo"
}
```

<a id='comment:11'></a>
The original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.

The name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.

I would completely throw away the "charpoly" option, and have a dedicated generic minpoly implementation. Either "matrix", as you suggest, or something calling "berlekamp_massey".



---

archive/issue_comments_406067.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4\">bdc6af1</a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>\n",
    "created_at": "2016-11-15T07:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4">bdc6af1</a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>




---

archive/issue_comments_406068.json:
```json
{
    "body": "**Changing commit** from \"[d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)\" to \"[bdc6af176a407d5765e5f2562d774ea59d7e75b4](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)\".",
    "created_at": "2016-11-15T07:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)" to "[bdc6af176a407d5765e5f2562d774ea59d7e75b4](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)".



---

archive/issue_comments_406069.json:
```json
{
    "body": "<a id='comment:13'></a>\nAbout the class name, it seems it was meant to represent any finite extension of a finite ring.\nBut it also seems it is only used for finite fields extensions at the moment.\nAnd that some functions in there might be finite field specific...\n\nVoucl we deal with that in another ticket?\nAnd merge this one if you're happy with my latest changes?",
    "created_at": "2016-11-15T07:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406069",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:13'></a>
About the class name, it seems it was meant to represent any finite extension of a finite ring.
But it also seems it is only used for finite fields extensions at the moment.
And that some functions in there might be finite field specific...

Voucl we deal with that in another ticket?
And merge this one if you're happy with my latest changes?



---

archive/issue_comments_406070.json:
```json
{
    "body": "<a id='comment:14'></a>\nAlso note that \"most\" finite fields will use the \"libpari\" derived class which provides its own minpoly function and so won't call these methods at all...\nSame is true for finite fields using NTL.",
    "created_at": "2016-11-15T13:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406070",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:14'></a>
Also note that "most" finite fields will use the "libpari" derived class which provides its own minpoly function and so won't call these methods at all...
Same is true for finite fields using NTL.



---

archive/issue_comments_406071.json:
```json
{
    "body": "<a id='comment:15'></a>\n- Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n- The doctest for `charpoly()` should be changed: it tests PARI twice.\n- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n\nMore generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSimilarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n\nI have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?",
    "created_at": "2016-11-15T16:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406071",
    "user": "https://github.com/defeo"
}
```

<a id='comment:15'></a>
- Maybe add a doctest for the `"matrix"` option of `minpoly()`? 
- The doctest for `charpoly()` should be changed: it tests PARI twice.
- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.

More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?

I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?



---

archive/issue_comments_406072.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [defeo](#comment%3A15):\n> - Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n \nOk.\n> - The doctest for `charpoly()` should be changed: it tests PARI twice.\n \nOk.\n> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n \nYou're right I spotted taht one but wanted to exercice the reviewer :/\n> \n> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSure...\nWe could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.\nBut that sounds horrible and complicated, doesn't it?\n> \n> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n> \n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\nWe could force the super class method to be called.",
    "created_at": "2016-11-15T16:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406072",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:16'></a>
Replying to [defeo](#comment%3A15):
> - Maybe add a doctest for the `"matrix"` option of `minpoly()`? 
 
Ok.
> - The doctest for `charpoly()` should be changed: it tests PARI twice.
 
Ok.
> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.
 
You're right I spotted taht one but wanted to exercice the reviewer :/
> 
> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Sure...
We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.
But that sounds horrible and complicated, doesn't it?
> 
> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?
> 
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?

We could force the super class method to be called.



---

archive/issue_comments_406073.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplace\n\n```\ndef minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):\n```\nby\n\n```\ndef minpoly(self, var='x'):\n```\nBoth types are superfluous.",
    "created_at": "2016-11-15T16:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406073",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replace

```
def minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):
```
by

```
def minpoly(self, var='x'):
```
Both types are superfluous.



---

archive/issue_comments_406074.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-15T16:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406074",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_406075.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [defeo](#comment%3A15):\n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\n\nCreate the field using\n\n```\nsage: GF(19^2, impl=\"pari_ffelt\")\n```\nif you want that implementation.",
    "created_at": "2016-11-15T17:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406075",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [defeo](#comment%3A15):
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?


Create the field using

```
sage: GF(19^2, impl="pari_ffelt")
```
if you want that implementation.



---

archive/issue_comments_406076.json:
```json
{
    "body": "<a id='comment:19'></a>\nI guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.",
    "created_at": "2016-11-15T17:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406076",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>
I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.



---

archive/issue_comments_406077.json:
```json
{
    "body": "<a id='comment:20'></a>\n> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? \n\n\nIt does.\n\n> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.\n\n\nI think we do.",
    "created_at": "2016-11-15T18:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406077",
    "user": "https://github.com/defeo"
}
```

<a id='comment:20'></a>
> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? 


It does.

> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.


I think we do.



---

archive/issue_comments_406078.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4\">d5ef125</a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef\">eb4fe64</a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e\">42b174f</a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>\n",
    "created_at": "2016-11-17T13:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4">d5ef125</a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef">eb4fe64</a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e">42b174f</a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>




---

archive/issue_comments_406079.json:
```json
{
    "body": "**Changing commit** from \"[bdc6af176a407d5765e5f2562d774ea59d7e75b4](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)\" to \"[42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)\".",
    "created_at": "2016-11-17T13:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bdc6af176a407d5765e5f2562d774ea59d7e75b4](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)" to "[42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)".



---

archive/issue_comments_406080.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-17T13:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406080",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_406081.json:
```json
{
    "body": "**Reviewer:** Luca De Feo",
    "created_at": "2016-11-17T14:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406081",
    "user": "https://github.com/defeo"
}
```

**Reviewer:** Luca De Feo



---

archive/issue_comments_406082.json:
```json
{
    "body": "<a id='comment:23'></a>\nGood on the principle. I'm doctesting now, will give positive review when it's done.",
    "created_at": "2016-11-17T14:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406082",
    "user": "https://github.com/defeo"
}
```

<a id='comment:23'></a>
Good on the principle. I'm doctesting now, will give positive review when it's done.



---

archive/issue_comments_406083.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-11-17T16:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406083",
    "user": "https://github.com/defeo"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_406084.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-11-19T16:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406084",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_406085.json:
```json
{
    "body": "**Changing branch** from \"[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)\" to \"[42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)\".",
    "created_at": "2016-11-19T16:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21834#issuecomment-406085",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)" to "[42b174f0ff94b26aa38adffaf7d236de2a37632e](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)".



---

archive/issue_events_065626.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:34:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21834",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21834#event-65626"
}
```
