# Issue 21834: Faster minpoly and charpoly functions for finite field extensions

archive/issues_021597.json:
```json
{
    "assignees": [],
    "body": "For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n\nAnd even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n\n\nBefore:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n100 loops, best of 3: 3.21 ms per loop\n```\n\nAfter:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n1000 loops, best of 3: 207 \u00b5s per loop\n```\n\nCC:  @defeo @jdemeyer\n\nKeywords: **finite fields minpoly**\n\nBranch/Commit: **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**\n\nReviewer: **Luca De Feo**\n\nAuthor: **Jean-Pierre Flori**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21834_\n\n",
    "closed_at": "2016-11-19T16:34:55Z",
    "created_at": "2016-11-07T15:33:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster minpoly and charpoly functions for finite field extensions",
    "type": "issue",
    "updated_at": "2016-11-19T16:34:55Z",
    "url": "https://github.com/sagemath/sage/issues/21834",
    "user": "https://github.com/sagetrac-jpflori"
}
```
For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.

And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.


Before:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
100 loops, best of 3: 3.21 ms per loop
```

After:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
1000 loops, best of 3: 207 Âµs per loop
```

CC:  @defeo @jdemeyer

Keywords: **finite fields minpoly**

Branch/Commit: **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**

Reviewer: **Luca De Feo**

Author: **Jean-Pierre Flori**

_Issue created by migration from https://trac.sagemath.org/ticket/21834_





---

archive/issue_events_277924.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277924"
}
```



---

archive/issue_events_277925.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "component: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277925"
}
```



---

archive/issue_events_277926.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277926"
}
```



---

archive/issue_events_277927.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277927"
}
```



---

archive/issue_comments_323891.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,12 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n Before:\n+\n+```\n sage: K.<z> = GF(461**173)\n sage: %timeit K(55).minpoly()\n 100 loops, best of 3: 3.21 ms per loop\n-\n+```\n \n After:\n \n``````\n",
    "created_at": "2016-11-07T15:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323891",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,12 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
 Before:
+
+```
 sage: K.<z> = GF(461**173)
 sage: %timeit K(55).minpoly()
 100 loops, best of 3: 3.21 ms per loop
-
+```
 
 After:
 
``````




---

archive/issue_events_277928.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T15:33:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277928"
}
```



---

archive/issue_events_277929.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:03:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277929"
}
```



---

archive/issue_events_277930.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:03:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277930"
}
```



---

archive/issue_comments_323892.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+\n+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323892",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+
+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
 
 Before:
 
``````




---

archive/issue_comments_323893.json:
```json
{
    "body": "Changed commit from **[24168c8](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)** to **[613c782](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)**",
    "created_at": "2016-11-07T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323893",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[24168c8](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)** to **[613c782](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)**



---

archive/issue_comments_323894.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05\">613c782</a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>\n",
    "created_at": "2016-11-07T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323894",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05">613c782</a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>




---

archive/issue_comments_323895.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nFYI:\n\n```\nsage: K.<z> = GF(461**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n10 loops, best of 3: 103 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n100 loops, best of 3: 5.28 ms per loop\n```",
    "created_at": "2016-11-07T16:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323895",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:4'>Comment 4:</a>
FYI:

```
sage: K.<z> = GF(461**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
10 loops, best of 3: 103 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
100 loops, best of 3: 5.28 ms per loop
```



---

archive/issue_comments_323896.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nSome more timings:\n\n```\nsage: K.<z> = GF(next_prime(2**30)**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 205 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n10 loops, best of 3: 22.2 ms per loop\nsage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 19.6 s per loop\nsage: %timeit b.minpoly(algorithm='pari')\n1 loop, best of 3: 372 ms per loop\n```",
    "created_at": "2016-11-07T16:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323896",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:5'>Comment 5:</a>
Some more timings:

```
sage: K.<z> = GF(next_prime(2**30)**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 205 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
10 loops, best of 3: 22.2 ms per loop
sage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 19.6 s per loop
sage: %timeit b.minpoly(algorithm='pari')
1 loop, best of 3: 372 ms per loop
```



---

archive/issue_comments_323897.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nSomething should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).",
    "created_at": "2016-11-07T16:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323897",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:6'>Comment 6:</a>
Something should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).



---

archive/issue_events_277931.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:18:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277931"
}
```



---

archive/issue_events_277932.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:18:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277932"
}
```



---

archive/issue_events_277933.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "title_is": "Faster minpoly and charpoly functions for finite field extensions",
    "title_was": "Faster minpoly function for constants in finite field extensions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277933"
}
```



---

archive/issue_events_277934.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277934"
}
```



---

archive/issue_events_277935.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277935"
}
```



---

archive/issue_comments_323898.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n+\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323898",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.
+
 
 Before:
 
``````




---

archive/issue_comments_323899.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nWith my changes the doc is wrong.\nE.g. for extensions using PARI, in the \"matrix\" case, it is actually PARI charpoly function which is used.\n\nWhile fixing this, I'll also fix the charpoly general case.",
    "created_at": "2016-11-07T16:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323899",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:8'>Comment 8:</a>
With my changes the doc is wrong.
E.g. for extensions using PARI, in the "matrix" case, it is actually PARI charpoly function which is used.

While fixing this, I'll also fix the charpoly general case.



---

archive/issue_comments_323900.json:
```json
{
    "body": "Changed commit from **[613c782](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)** to **[d99cd71](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)**",
    "created_at": "2016-11-07T17:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323900",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[613c782](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)** to **[d99cd71](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)**



---

archive/issue_comments_323901.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1\">4174d3e</a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0\">d99cd71</a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>\n",
    "created_at": "2016-11-07T17:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323901",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1">4174d3e</a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0">d99cd71</a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>




---

archive/issue_comments_323902.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI'm not quite satisfied by the current situation:\n* maybe we could have a \"matrix\" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix\n* the \"charpoly\" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.\n\nDoes anyone think anything?",
    "created_at": "2016-11-07T17:26:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323902",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:10'>Comment 10:</a>
I'm not quite satisfied by the current situation:
* maybe we could have a "matrix" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix
* the "charpoly" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.

Does anyone think anything?



---

archive/issue_events_277936.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T17:26:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277936"
}
```



---

archive/issue_events_277937.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-07T17:26:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277937"
}
```



---

archive/issue_comments_323903.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThe original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.\n\nThe name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.\n\nI would completely throw away the \"charpoly\" option, and have a dedicated generic minpoly implementation. Either \"matrix\", as you suggest, or something calling \"berlekamp_massey\".",
    "created_at": "2016-11-10T16:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323903",
    "user": "https://github.com/defeo"
}
```

<a id='comment:11'>Comment 11:</a>
The original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.

The name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.

I would completely throw away the "charpoly" option, and have a dedicated generic minpoly implementation. Either "matrix", as you suggest, or something calling "berlekamp_massey".



---

archive/issue_comments_323904.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4\">bdc6af1</a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>\n",
    "created_at": "2016-11-15T07:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323904",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4">bdc6af1</a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>




---

archive/issue_comments_323905.json:
```json
{
    "body": "Changed commit from **[d99cd71](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)** to **[bdc6af1](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)**",
    "created_at": "2016-11-15T07:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323905",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d99cd71](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)** to **[bdc6af1](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)**



---

archive/issue_comments_323906.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nAbout the class name, it seems it was meant to represent any finite extension of a finite ring.\nBut it also seems it is only used for finite fields extensions at the moment.\nAnd that some functions in there might be finite field specific...\n\nVoucl we deal with that in another ticket?\nAnd merge this one if you're happy with my latest changes?",
    "created_at": "2016-11-15T07:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323906",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:13'>Comment 13:</a>
About the class name, it seems it was meant to represent any finite extension of a finite ring.
But it also seems it is only used for finite fields extensions at the moment.
And that some functions in there might be finite field specific...

Voucl we deal with that in another ticket?
And merge this one if you're happy with my latest changes?



---

archive/issue_comments_323907.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nAlso note that \"most\" finite fields will use the \"libpari\" derived class which provides its own minpoly function and so won't call these methods at all...\nSame is true for finite fields using NTL.",
    "created_at": "2016-11-15T13:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323907",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:14'>Comment 14:</a>
Also note that "most" finite fields will use the "libpari" derived class which provides its own minpoly function and so won't call these methods at all...
Same is true for finite fields using NTL.



---

archive/issue_comments_323908.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n- Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n- The doctest for `charpoly()` should be changed: it tests PARI twice.\n- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n\nMore generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSimilarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n\nI have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?",
    "created_at": "2016-11-15T16:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323908",
    "user": "https://github.com/defeo"
}
```

<a id='comment:15'>Comment 15:</a>
- Maybe add a doctest for the `"matrix"` option of `minpoly()`? 
- The doctest for `charpoly()` should be changed: it tests PARI twice.
- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.

More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?

I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?



---

archive/issue_comments_323909.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@defeo](#comment%3A15):\n> - Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n\nOk.\n> - The doctest for `charpoly()` should be changed: it tests PARI twice.\n\nOk.\n> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n\nYou're right I spotted taht one but wanted to exercice the reviewer :/\n> \n> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSure...\nWe could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.\nBut that sounds horrible and complicated, doesn't it?\n> \n> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n> \n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\nWe could force the super class method to be called.",
    "created_at": "2016-11-15T16:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323909",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@defeo](#comment%3A15):
> - Maybe add a doctest for the `"matrix"` option of `minpoly()`? 

Ok.
> - The doctest for `charpoly()` should be changed: it tests PARI twice.

Ok.
> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.

You're right I spotted taht one but wanted to exercice the reviewer :/
> 
> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Sure...
We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.
But that sounds horrible and complicated, doesn't it?
> 
> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?
> 
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?

We could force the super class method to be called.



---

archive/issue_comments_323910.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplace\n\n```\ndef minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):\n```\nby\n\n```\ndef minpoly(self, var='x'):\n```\nBoth types are superfluous.",
    "created_at": "2016-11-15T16:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323910",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
Replace

```
def minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):
```
by

```
def minpoly(self, var='x'):
```
Both types are superfluous.



---

archive/issue_events_277938.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-15T16:59:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277938"
}
```



---

archive/issue_events_277939.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-15T16:59:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277939"
}
```



---

archive/issue_comments_323911.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@defeo](#comment%3A15):\n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\nCreate the field using\n\n```\nsage: GF(19^2, impl=\"pari_ffelt\")\n```\nif you want that implementation.",
    "created_at": "2016-11-15T17:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323911",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@defeo](#comment%3A15):
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?

Create the field using

```
sage: GF(19^2, impl="pari_ffelt")
```
if you want that implementation.



---

archive/issue_comments_323912.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.",
    "created_at": "2016-11-15T17:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323912",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:19'>Comment 19:</a>
I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.



---

archive/issue_comments_323913.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\n> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? \n\nIt does.\n\n> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.\n\nI think we do.",
    "created_at": "2016-11-15T18:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323913",
    "user": "https://github.com/defeo"
}
```

<a id='comment:20'>Comment 20:</a>
> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? 

It does.

> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.

I think we do.



---

archive/issue_comments_323914.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4\">d5ef125</a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef\">eb4fe64</a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e\">42b174f</a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>\n",
    "created_at": "2016-11-17T13:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323914",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4">d5ef125</a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef">eb4fe64</a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e">42b174f</a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>




---

archive/issue_comments_323915.json:
```json
{
    "body": "Changed commit from **[bdc6af1](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)** to **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**",
    "created_at": "2016-11-17T13:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323915",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bdc6af1](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)** to **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**



---

archive/issue_events_277940.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-17T13:39:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277940"
}
```



---

archive/issue_events_277941.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2016-11-17T13:39:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277941"
}
```



---

archive/issue_comments_323916.json:
```json
{
    "body": "Reviewer: **Luca De Feo**",
    "created_at": "2016-11-17T14:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323916",
    "user": "https://github.com/defeo"
}
```

Reviewer: **Luca De Feo**



---

archive/issue_comments_323917.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nGood on the principle. I'm doctesting now, will give positive review when it's done.",
    "created_at": "2016-11-17T14:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323917",
    "user": "https://github.com/defeo"
}
```

<a id='comment:23'>Comment 23:</a>
Good on the principle. I'm doctesting now, will give positive review when it's done.



---

archive/issue_events_277942.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2016-11-17T16:17:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277942"
}
```



---

archive/issue_events_277943.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2016-11-17T16:17:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277943"
}
```



---

archive/issue_comments_323918.json:
```json
{
    "body": "Changed branch from **[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)** to **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**",
    "created_at": "2016-11-19T16:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-323918",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)** to **[42b174f](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**



---

archive/issue_events_277944.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:34:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277944"
}
```



---

archive/issue_events_277945.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "74cba346435436a3875694d0b8a1ff76b05547a7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-19T16:34:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-277945"
}
```
