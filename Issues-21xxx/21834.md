# Issue 21834: Faster minpoly and charpoly functions for finite field extensions

archive/issues_021597.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nFor minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n\nAnd even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n\n\nBefore:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n100 loops, best of 3: 3.21 ms per loop\n```\n\nAfter:\n\n```\nsage: K.<z> = GF(461**173)\nsage: %timeit K(55).minpoly()\n1000 loops, best of 3: 207 \u00b5s per loop\n```\n\nCC:  @defeo @jdemeyer\n\nComponent: **basic arithmetic**\n\nKeywords: **finite fields minpoly**\n\nAuthor: **Jean-Pierre Flori**\n\nBranch/Commit: **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**\n\nReviewer: **Luca De Feo**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21834_\n\n",
    "closed_at": "2016-11-19T16:34:55Z",
    "created_at": "2016-11-07T15:33:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster minpoly and charpoly functions for finite field extensions",
    "type": "issue",
    "updated_at": "2016-11-19T16:34:55Z",
    "url": "https://github.com/sagemath/sage/issues/21834",
    "user": "https://github.com/jpflori"
}
```
<div id="comment:0"></div>

For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.

And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.


Before:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
100 loops, best of 3: 3.21 ms per loop
```

After:

```
sage: K.<z> = GF(461**173)
sage: %timeit K(55).minpoly()
1000 loops, best of 3: 207 Âµs per loop
```

CC:  @defeo @jdemeyer

Component: **basic arithmetic**

Keywords: **finite fields minpoly**

Author: **Jean-Pierre Flori**

Branch/Commit: **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**

Reviewer: **Luca De Feo**

_Issue created by migration from https://trac.sagemath.org/ticket/21834_





---

archive/issue_events_303500.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303500"
}
```



---

archive/issue_events_303501.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303501"
}
```



---

archive/issue_events_303502.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303502"
}
```



---

archive/issue_events_303503.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T15:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303503"
}
```



---

archive/issue_comments_321223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,12 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n Before:\n+\n+```\n sage: K.<z> = GF(461**173)\n sage: %timeit K(55).minpoly()\n 100 loops, best of 3: 3.21 ms per loop\n-\n+```\n \n After:\n \n``````\n",
    "created_at": "2016-11-07T15:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321223",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,12 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
 Before:
+
+```
 sage: K.<z> = GF(461**173)
 sage: %timeit K(55).minpoly()
 100 loops, best of 3: 3.21 ms per loop
-
+```
 
 After:
 
``````




---

archive/issue_events_303504.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T15:33:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303504"
}
```



---

archive/issue_events_303505.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:03:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303505"
}
```



---

archive/issue_events_303506.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:03:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303506"
}
```



---

archive/issue_comments_321224.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+\n+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321224",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+
+And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
 
 Before:
 
``````




---

archive/issue_comments_321225.json:
```json
{
    "body": "Changed commit from **[`24168c8`](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)** to **[`613c782`](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)**",
    "created_at": "2016-11-07T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321225",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`24168c8`](https://github.com/sagemath/sagetrac-mirror/commit/24168c8b40ee9fc839e46433dadc10695acd8a8b)** to **[`613c782`](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)**



---

archive/issue_comments_321226.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05\"><code>613c782</code></a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>\n",
    "created_at": "2016-11-07T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321226",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05"><code>613c782</code></a></td><td><code>Use PARI for finite fields element minpoly computations.</code></td></tr></table>




---

archive/issue_comments_321227.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFYI:\n\n```\nsage: K.<z> = GF(461**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n10 loops, best of 3: 103 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n100 loops, best of 3: 5.28 ms per loop\n```",
    "created_at": "2016-11-07T16:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321227",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:4" align="right">comment:4</div>

FYI:

```
sage: K.<z> = GF(461**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
10 loops, best of 3: 103 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
100 loops, best of 3: 5.28 ms per loop
```



---

archive/issue_comments_321228.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSome more timings:\n\n```\nsage: K.<z> = GF(next_prime(2**30)**173)\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 205 ms per loop\nsage: %timeit b.minpoly(algorithm='pari')\n10 loops, best of 3: 22.2 ms per loop\nsage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))\nsage: b = K.random_element()\nsage: %timeit b.minpoly(algorithm='matrix')\n1 loop, best of 3: 19.6 s per loop\nsage: %timeit b.minpoly(algorithm='pari')\n1 loop, best of 3: 372 ms per loop\n```",
    "created_at": "2016-11-07T16:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321228",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:5" align="right">comment:5</div>

Some more timings:

```
sage: K.<z> = GF(next_prime(2**30)**173)
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 205 ms per loop
sage: %timeit b.minpoly(algorithm='pari')
10 loops, best of 3: 22.2 ms per loop
sage: K.<z> = GF(next_prime(2**30)**next_prime(2**10))
sage: b = K.random_element()
sage: %timeit b.minpoly(algorithm='matrix')
1 loop, best of 3: 19.6 s per loop
sage: %timeit b.minpoly(algorithm='pari')
1 loop, best of 3: 372 ms per loop
```



---

archive/issue_comments_321229.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSomething should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).",
    "created_at": "2016-11-07T16:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321229",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:6" align="right">comment:6</div>

Something should surely be done about charpoly as well (and maybe polynomial factorization and generation of irreducible polynomials :p).



---

archive/issue_events_303507.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:18:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303507"
}
```



---

archive/issue_events_303508.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:18:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303508"
}
```



---

archive/issue_events_303509.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "title_is": "Faster minpoly and charpoly functions for finite field extensions",
    "title_was": "Faster minpoly function for constants in finite field extensions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303509"
}
```



---

archive/issue_events_303510.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303510"
}
```



---

archive/issue_events_303511.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T16:37:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303511"
}
```



---

archive/issue_comments_321230.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.\n \n-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).\n+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.\n+\n \n Before:\n \n``````\n",
    "created_at": "2016-11-07T16:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321230",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-The current code constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
+For minpoly, the current code states that it constructs the multiplication matrix which is suboptimal in the trivial case where the element lies in the prime field.
 
-And in non-trivial cases we should use PARI which now has an efficient algorithm (Shoup's IIRC).
+And even in non-trivial cases we should not go this way but use Shoup's algorithm which is implemented in PARI.
+
 
 Before:
 
``````




---

archive/issue_comments_321231.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWith my changes the doc is wrong.\nE.g. for extensions using PARI, in the \"matrix\" case, it is actually PARI charpoly function which is used.\n\nWhile fixing this, I'll also fix the charpoly general case.",
    "created_at": "2016-11-07T16:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321231",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:8" align="right">comment:8</div>

With my changes the doc is wrong.
E.g. for extensions using PARI, in the "matrix" case, it is actually PARI charpoly function which is used.

While fixing this, I'll also fix the charpoly general case.



---

archive/issue_comments_321232.json:
```json
{
    "body": "Changed commit from **[`613c782`](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)** to **[`d99cd71`](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)**",
    "created_at": "2016-11-07T17:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321232",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`613c782`](https://github.com/sagemath/sagetrac-mirror/commit/613c78249818205abbe6c4126814232fd2e76f05)** to **[`d99cd71`](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)**



---

archive/issue_comments_321233.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1\"><code>4174d3e</code></a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0\"><code>d99cd71</code></a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>\n",
    "created_at": "2016-11-07T17:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321233",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4174d3e9e5b561a6c0baca61f2af97a9522c8ec1"><code>4174d3e</code></a></td><td><code>Let FF using PARI use PARI minpoly function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0"><code>d99cd71</code></a></td><td><code>Use PARI charpoly by default for finite fields elements.</code></td></tr></table>




---

archive/issue_comments_321234.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'm not quite satisfied by the current situation:\n* maybe we could have a \"matrix\" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix\n* the \"charpoly\" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.\n\nDoes anyone think anything?",
    "created_at": "2016-11-07T17:26:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321234",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:10" align="right">comment:10</div>

I'm not quite satisfied by the current situation:
* maybe we could have a "matrix" option for minpoly doing either the charpoly of the matrix and getting the right factor or just calling minpoly on the matrix
* the "charpoly" option for minpoly is not that useful :/ it would only be for a class implementing a very fast charpoly and no minpoly.

Does anyone think anything?



---

archive/issue_events_303512.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T17:26:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303512"
}
```



---

archive/issue_events_303513.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-07T17:26:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303513"
}
```



---

archive/issue_comments_321235.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.\n\nThe name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.\n\nI would completely throw away the \"charpoly\" option, and have a dedicated generic minpoly implementation. Either \"matrix\", as you suggest, or something calling \"berlekamp_massey\".",
    "created_at": "2016-11-10T16:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321235",
    "user": "https://github.com/defeo"
}
```

<div id="comment:11" align="right">comment:11</div>

The original code for `minpoly` is weird. What's a `FinitePolyExtElement` supposed to be, anyway? A superclass to any polynomial extension of a finite ring? In this case the algorithm is wrong, because it doesn't take multiplicities into account.

The name of the package is probably a misnomer, as it only seems to contain finite fields, and no more general rings. Extensions of GF(p) by non-irreducible polynomials are implemented elsewhere.

I would completely throw away the "charpoly" option, and have a dedicated generic minpoly implementation. Either "matrix", as you suggest, or something calling "berlekamp_massey".



---

archive/issue_comments_321236.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4\"><code>bdc6af1</code></a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>\n",
    "created_at": "2016-11-15T07:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4"><code>bdc6af1</code></a></td><td><code>Only pari and matrix options for minpoly and charpoly in FF.</code></td></tr></table>




---

archive/issue_comments_321237.json:
```json
{
    "body": "Changed commit from **[`d99cd71`](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)** to **[`bdc6af1`](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)**",
    "created_at": "2016-11-15T07:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321237",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d99cd71`](https://github.com/sagemath/sagetrac-mirror/commit/d99cd71f93904cb7e1cce8c85ada4ce402c9e5d0)** to **[`bdc6af1`](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)**



---

archive/issue_comments_321238.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAbout the class name, it seems it was meant to represent any finite extension of a finite ring.\nBut it also seems it is only used for finite fields extensions at the moment.\nAnd that some functions in there might be finite field specific...\n\nVoucl we deal with that in another ticket?\nAnd merge this one if you're happy with my latest changes?",
    "created_at": "2016-11-15T07:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321238",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:13" align="right">comment:13</div>

About the class name, it seems it was meant to represent any finite extension of a finite ring.
But it also seems it is only used for finite fields extensions at the moment.
And that some functions in there might be finite field specific...

Voucl we deal with that in another ticket?
And merge this one if you're happy with my latest changes?



---

archive/issue_comments_321239.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAlso note that \"most\" finite fields will use the \"libpari\" derived class which provides its own minpoly function and so won't call these methods at all...\nSame is true for finite fields using NTL.",
    "created_at": "2016-11-15T13:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321239",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:14" align="right">comment:14</div>

Also note that "most" finite fields will use the "libpari" derived class which provides its own minpoly function and so won't call these methods at all...
Same is true for finite fields using NTL.



---

archive/issue_comments_321240.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n- Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n- The doctest for `charpoly()` should be changed: it tests PARI twice.\n- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n\nMore generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSimilarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n\nI have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?",
    "created_at": "2016-11-15T16:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321240",
    "user": "https://github.com/defeo"
}
```

<div id="comment:15" align="right">comment:15</div>

- Maybe add a doctest for the `"matrix"` option of `minpoly()`? 
- The doctest for `charpoly()` should be changed: it tests PARI twice.
- Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.

More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?

I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?



---

archive/issue_comments_321241.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@defeo](#comment%3A15):\n> - Maybe add a doctest for the `\"matrix\"` option of `minpoly()`? \n\nOk.\n> - The doctest for `charpoly()` should be changed: it tests PARI twice.\n\nOk.\n> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.\n\nYou're right I spotted taht one but wanted to exercice the reviewer :/\n> \n> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.\n\nSure...\nWe could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.\nBut that sounds horrible and complicated, doesn't it?\n> \n> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?\n> \n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\nWe could force the super class method to be called.",
    "created_at": "2016-11-15T16:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321241",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@defeo](#comment%3A15):
> - Maybe add a doctest for the `"matrix"` option of `minpoly()`? 

Ok.
> - The doctest for `charpoly()` should be changed: it tests PARI twice.

Ok.
> - Are you sure the doctest of `FiniteFieldElement_pari_ffelt.minpoly()` tests the correct field? I have the impression that's a Givaro field.

You're right I spotted taht one but wanted to exercice the reviewer :/
> 
> More generally, I was wondering: some day Givaro may implement minimal polynomials, and we may override `minpoly()` in `FiniteField_givaro`. At that moment, the doctest in `element_base.pyx` may become stale without us noticing.

Sure...
We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm.
But that sounds horrible and complicated, doesn't it?
> 
> Similarly, what if someday we decide that `GF(19^2)` should be implemented by a different subsystem?
> 
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?

We could force the super class method to be called.



---

archive/issue_comments_321242.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplace\n\n```\ndef minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):\n```\nby\n\n```\ndef minpoly(self, var='x'):\n```\nBoth types are superfluous.",
    "created_at": "2016-11-15T16:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321242",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replace

```
def minpoly(FiniteFieldElement_pari_ffelt self, object var='x'):
```
by

```
def minpoly(self, var='x'):
```
Both types are superfluous.



---

archive/issue_events_303514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-15T16:59:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303514"
}
```



---

archive/issue_events_303515.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-15T16:59:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303515"
}
```



---

archive/issue_comments_321243.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@defeo](#comment%3A15):\n> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?\n\nCreate the field using\n\n```\nsage: GF(19^2, impl=\"pari_ffelt\")\n```\nif you want that implementation.",
    "created_at": "2016-11-15T17:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321243",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@defeo](#comment%3A15):
> I have the impression that doctests that rely on some mathematical object being implemented by some specific subclass are very brittle. Is there a better way to write these doctests so to be sure that they call the right method?

Create the field using

```
sage: GF(19^2, impl="pari_ffelt")
```
if you want that implementation.



---

archive/issue_comments_321244.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.",
    "created_at": "2016-11-15T17:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321244",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:19" align="right">comment:19</div>

I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.



---

archive/issue_comments_321245.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? \n\nIt does.\n\n> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.\n\nI think we do.",
    "created_at": "2016-11-15T18:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321245",
    "user": "https://github.com/defeo"
}
```

<div id="comment:20" align="right">comment:20</div>

> Sure... We could also decide to implement _minpoly in subclasses and let the minpoly in Finite... class use that by default if it exist or fallback when given an algorithm. But that sounds horrible and complicated, doesn't it? 

It does.

> I guess the other issue is do we want to test the base class methods even when they are always overloaded in sub classes.

I think we do.



---

archive/issue_comments_321246.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4\"><code>d5ef125</code></a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef\"><code>eb4fe64</code></a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e\"><code>42b174f</code></a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>\n",
    "created_at": "2016-11-17T13:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321246",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5ef1257a56a16e1b5185916a5f01cb7209950e4"><code>d5ef125</code></a></td><td><code>Make sure FF tests for pari FF implem use that implem.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb4fe64311d25c5eded558ade89c8930aba824ef"><code>eb4fe64</code></a></td><td><code>Remove superfluous type decl in FF implem using pari FF for two functions.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e"><code>42b174f</code></a></td><td><code>Doctest for class' methods (and not superclass') in FinitePolyExtElement.</code></td></tr></table>




---

archive/issue_comments_321247.json:
```json
{
    "body": "Changed commit from **[`bdc6af1`](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)** to **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**",
    "created_at": "2016-11-17T13:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321247",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bdc6af1`](https://github.com/sagemath/sagetrac-mirror/commit/bdc6af176a407d5765e5f2562d774ea59d7e75b4)** to **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**



---

archive/issue_events_303516.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-17T13:39:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303516"
}
```



---

archive/issue_events_303517.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-17T13:39:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303517"
}
```



---

archive/issue_comments_321248.json:
```json
{
    "body": "Reviewer: **Luca De Feo**",
    "created_at": "2016-11-17T14:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321248",
    "user": "https://github.com/defeo"
}
```

Reviewer: **Luca De Feo**



---

archive/issue_comments_321249.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nGood on the principle. I'm doctesting now, will give positive review when it's done.",
    "created_at": "2016-11-17T14:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321249",
    "user": "https://github.com/defeo"
}
```

<div id="comment:23" align="right">comment:23</div>

Good on the principle. I'm doctesting now, will give positive review when it's done.



---

archive/issue_events_303518.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2016-11-17T16:17:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303518"
}
```



---

archive/issue_events_303519.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2016-11-17T16:17:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303519"
}
```



---

archive/issue_comments_321250.json:
```json
{
    "body": "Changed branch from **[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)** to **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**",
    "created_at": "2016-11-19T16:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21834#issuecomment-321250",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ffminpoly](https://github.com/sagemath/sagetrac-mirror/tree/public/ffminpoly)** to **[`42b174f`](https://github.com/sagemath/sagetrac-mirror/commit/42b174f0ff94b26aa38adffaf7d236de2a37632e)**



---

archive/issue_events_303520.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:34:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303520"
}
```



---

archive/issue_events_303521.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "74cba346435436a3875694d0b8a1ff76b05547a7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-19T16:34:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21834",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21834#event-303521"
}
```
