# Issue 21507: Meta-ticket: Make sagelib a pip-installable Python source package, listed on PyPI

archive/issues_021270.json:
```json
{
    "assignees": [],
    "body": "**This task ticket, organizing the steps necessary to eventually provide sagelib via PyPI, has been superseded by Meta-ticket #29705: Modularize sagelib into separate distributions (distutils packages).**\n\n. . . . . . . . . . . . . . . . .\n\n\nIt would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.\nThen a simple\n\n```\npip install sagelib\n```\nwould install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.\n\n. . . . . . . . . . . . . . . . .\n\nHere are the first steps:\n- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior\n  - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n  - #21600: Use custom build_ext to compile Cython code\n  - #21604: Cleaning up stale installed files in setup()\n  - #21654: Disentangle cleaning of stale installed files in build directory and in install directory\n  - #21516: Fix sagelib sdist (`src/setup.py sdist`)\n  - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`\n  - #12659: build the sage library in place\n  - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n  - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)\n  - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)\n  - #25546: Install Jupyter kernel in the correct prefix\n  - #29041: at `./bootstrap` time, generate `src/requirements.txt`, `src/constraints.txt`, `src/setup.cfg` `[install_requires]` from `build/pkgs`\n- #21678: Testsuite `for src/setup.py`\n- #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n- #20108: Use package_data instead of data_files in setup.py\n- #21682: Add a separate \"cythonize\" command to setup.py\n- #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n- #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n- #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n- #21509: Install cython_debug somewhere in SAGE_LOCAL\n- #21732: Move runtime documentation python modules into `src/sage`\n- #29038: Python package `sage_conf`: Provides optional configuration information for `sagelib`\n\nThis defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n\n```\nexport SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\nexport SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs\n$SAGE_LOCAL/bin/python setup.py install   # or pip install . \n```\n\n. . . . . . . . . . . . . . . . .\n\nNext steps:\n- Remove the dependency on the environment variable SAGE_PKGS (#20382, ...)\n\nThis defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):\n\n```\nexport SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\n$SAGE_LOCAL/bin/python setup.py install   # or pip install . \n```\n\n. . . . . . . . . . . . . . . . .\n\nNext steps:\n\n- Remove the dependency on the SAGE_LOCAL environment variable\n  - #15105: hardwired paths in src/sage\n  - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR\n  - #29119: Add an autoconf configure script for sagelib\n  - ...\n\nThis defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. \n\n```\npython setup.py install   # or pip install . \n```\nAt this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.\n\nBinary packages (using wheels etc.) is beyond the scope of this ticket.\n\n. . . . . . . . . . . . . . . . .\n\nSee also:\n\n- **#29133 META-META-TICKET: Build, packaging, testing improvements**\n\n. . . . . . . . . . . . . . References . . . . . . . . . . . . . . .\n\n- https://docs.python.org/2/library/distutils.html \n- https://setuptools.readthedocs.io/en/latest/setuptools.html#command-reference\n- https://docs.python.org/2/distutils/sourcedist.html\n- https://docs.python.org/2/install/\n- https://pip.pypa.io/en/stable/reference/pip_install/#pip-install-examples\n- http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice\n- http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920\n- https://packaging.python.org/science/\n- https://packaging.python.org/current/\n- https://packaging.python.org/key_projects/#setuptools\n- https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode\n- https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips\n- https://blog.ionelmc.ro/2014/05/25/python-packaging/\n- http://stackoverflow.com/questions/7522250/how-to-include-package-data-with-setuptools-distribute\n\n\nCC:  @jdemeyer @williamstein @vbraun @videlec @dimpase @kiwifb @embray @nexttime @sagetrac-aenge @nthiery @miguelmarco @kwankyu @robertwb @infinity0 @tobihan @defeo @slel @timokau @kevinywlui @isuruf @jhpalmieri\n\nKeywords: **pip, PyPI**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21507_\n\n",
    "closed_at": "2021-06-13T06:40:58Z",
    "created_at": "2016-09-16T16:05:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Meta-ticket: Make sagelib a pip-installable Python source package, listed on PyPI",
    "type": "issue",
    "updated_at": "2021-06-13T06:40:58Z",
    "url": "https://github.com/sagemath/sage/issues/21507",
    "user": "https://github.com/mkoeppe"
}
```
**This task ticket, organizing the steps necessary to eventually provide sagelib via PyPI, has been superseded by Meta-ticket #29705: Modularize sagelib into separate distributions (distutils packages).**

. . . . . . . . . . . . . . . . .


It would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.
Then a simple

```
pip install sagelib
```
would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.

. . . . . . . . . . . . . . . . .

Here are the first steps:
- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior
  - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
  - #21600: Use custom build_ext to compile Cython code
  - #21604: Cleaning up stale installed files in setup()
  - #21654: Disentangle cleaning of stale installed files in build directory and in install directory
  - #21516: Fix sagelib sdist (`src/setup.py sdist`)
  - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`
  - #12659: build the sage library in place
  - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
  - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)
  - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)
  - #25546: Install Jupyter kernel in the correct prefix
  - #29041: at `./bootstrap` time, generate `src/requirements.txt`, `src/constraints.txt`, `src/setup.cfg` `[install_requires]` from `build/pkgs`
- #21678: Testsuite `for src/setup.py`
- #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
- #20108: Use package_data instead of data_files in setup.py
- #21682: Add a separate "cythonize" command to setup.py
- #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
- #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
- #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
- #21509: Install cython_debug somewhere in SAGE_LOCAL
- #21732: Move runtime documentation python modules into `src/sage`
- #29038: Python package `sage_conf`: Provides optional configuration information for `sagelib`

This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):

```
export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
export SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs
$SAGE_LOCAL/bin/python setup.py install   # or pip install . 
```

. . . . . . . . . . . . . . . . .

Next steps:
- Remove the dependency on the environment variable SAGE_PKGS (#20382, ...)

This defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):

```
export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
$SAGE_LOCAL/bin/python setup.py install   # or pip install . 
```

. . . . . . . . . . . . . . . . .

Next steps:

- Remove the dependency on the SAGE_LOCAL environment variable
  - #15105: hardwired paths in src/sage
  - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR
  - #29119: Add an autoconf configure script for sagelib
  - ...

This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. 

```
python setup.py install   # or pip install . 
```
At this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.

Binary packages (using wheels etc.) is beyond the scope of this ticket.

. . . . . . . . . . . . . . . . .

See also:

- **#29133 META-META-TICKET: Build, packaging, testing improvements**

. . . . . . . . . . . . . . References . . . . . . . . . . . . . . .

- https://docs.python.org/2/library/distutils.html 
- https://setuptools.readthedocs.io/en/latest/setuptools.html#command-reference
- https://docs.python.org/2/distutils/sourcedist.html
- https://docs.python.org/2/install/
- https://pip.pypa.io/en/stable/reference/pip_install/#pip-install-examples
- http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice
- http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920
- https://packaging.python.org/science/
- https://packaging.python.org/current/
- https://packaging.python.org/key_projects/#setuptools
- https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode
- https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips
- https://blog.ionelmc.ro/2014/05/25/python-packaging/
- http://stackoverflow.com/questions/7522250/how-to-include-package-data-with-setuptools-distribute


CC:  @jdemeyer @williamstein @vbraun @videlec @dimpase @kiwifb @embray @nexttime @sagetrac-aenge @nthiery @miguelmarco @kwankyu @robertwb @infinity0 @tobihan @defeo @slel @timokau @kevinywlui @isuruf @jhpalmieri

Keywords: **pip, PyPI**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/21507_





---

archive/issue_events_284147.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T16:05:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284147"
}
```



---

archive/issue_events_284148.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T16:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284148"
}
```



---

archive/issue_events_284149.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T16:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284149"
}
```



---

archive/issue_comments_318117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,27 @@\n Here are the steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n - Make `setup.py sdist` work\n+- Clean up `setup.py` so that `setup.py --help` always works etc.\n - ...\n \n+This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n+\n+```\n+export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\n+export SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs\n+python setup.py install   # or pip install . \n+```\n+\n+Next steps:\n+- Remove the dependency on SAGE_PKGS (#20382, ...)\n+\n+This defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):\n+\n+```\n+export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\n+python setup.py install   # or pip install . \n+```\n+\n+Next steps:\n+\n+- ...\n``````\n",
    "created_at": "2016-09-16T17:25:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318117",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,27 @@
 Here are the steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
 - Make `setup.py sdist` work
+- Clean up `setup.py` so that `setup.py --help` always works etc.
 - ...
 
+This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
+
+```
+export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
+export SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs
+python setup.py install   # or pip install . 
+```
+
+Next steps:
+- Remove the dependency on SAGE_PKGS (#20382, ...)
+
+This defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):
+
+```
+export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
+python setup.py install   # or pip install . 
+```
+
+Next steps:
+
+- ...
``````




---

archive/issue_comments_318118.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,9 @@\n ```\n would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.\n \n-Here are the steps:\n+. . . . . . . . . . . . . . . . .\n+\n+Here are the first steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n - Make `setup.py sdist` work\n - Clean up `setup.py` so that `setup.py --help` always works etc.\n@@ -22,8 +24,10 @@\n python setup.py install   # or pip install . \n ```\n \n+. . . . . . . . . . . . . . . . .\n+\n Next steps:\n-- Remove the dependency on SAGE_PKGS (#20382, ...)\n+- Remove the dependency on the environment variable SAGE_PKGS (#20382, ...)\n \n This defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):\n \n@@ -32,6 +36,8 @@\n python setup.py install   # or pip install . \n ```\n \n+. . . . . . . . . . . . . . . . .\n+\n Next steps:\n \n-- ...\n+- Remove the dependency on the SAGE_LOCAL environment variable. \n``````\n",
    "created_at": "2016-09-16T17:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318118",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,9 @@
 ```
 would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.
 
-Here are the steps:
+. . . . . . . . . . . . . . . . .
+
+Here are the first steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
 - Make `setup.py sdist` work
 - Clean up `setup.py` so that `setup.py --help` always works etc.
@@ -22,8 +24,10 @@
 python setup.py install   # or pip install . 
 ```
 
+. . . . . . . . . . . . . . . . .
+
 Next steps:
-- Remove the dependency on SAGE_PKGS (#20382, ...)
+- Remove the dependency on the environment variable SAGE_PKGS (#20382, ...)
 
 This defines **milestone 2**. `sagelib` can now be built and installed as follows (without invoking `sage -sh`):
 
@@ -32,6 +36,8 @@
 python setup.py install   # or pip install . 
 ```
 
+. . . . . . . . . . . . . . . . .
+
 Next steps:
 
-- ...
+- Remove the dependency on the SAGE_LOCAL environment variable. 
``````




---

archive/issue_comments_318119.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,9 +12,8 @@\n \n Here are the first steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n-- Make `setup.py sdist` work\n-- Clean up `setup.py` so that `setup.py --help` always works etc.\n-- ...\n+- #21508: Clean up src/setup.py, fix 'setup.py sdist'\n+- Handle `--build-base`\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2016-09-17T00:00:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318119",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,9 +12,8 @@
 
 Here are the first steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
-- Make `setup.py sdist` work
-- Clean up `setup.py` so that `setup.py --help` always works etc.
-- ...
+- #21508: Clean up src/setup.py, fix 'setup.py sdist'
+- Handle `--build-base`
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_events_284150.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T00:05:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284150"
}
```



---

archive/issue_events_284151.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T00:05:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284151"
}
```



---

archive/issue_comments_318120.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,8 @@\n \n Here are the first steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n-- #21508: Clean up src/setup.py, fix 'setup.py sdist'\n+- #21508: Clean up src/setup.py to bring it to standard distutils behavior\n+- #21516: Fix sagelib sdist (src/setup.py sdist)\n - Handle `--build-base`\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n@@ -40,3 +41,10 @@\n Next steps:\n \n - Remove the dependency on the SAGE_LOCAL environment variable. \n+\n+This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. \n+\n+```\n+python setup.py install   # or pip install . \n+```\n+At this point, sagelib will be ready for upload to PyPI.\n``````\n",
    "created_at": "2016-09-17T04:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318120",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,8 @@
 
 Here are the first steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
-- #21508: Clean up src/setup.py, fix 'setup.py sdist'
+- #21508: Clean up src/setup.py to bring it to standard distutils behavior
+- #21516: Fix sagelib sdist (src/setup.py sdist)
 - Handle `--build-base`
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
@@ -40,3 +41,10 @@
 Next steps:
 
 - Remove the dependency on the SAGE_LOCAL environment variable. 
+
+This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. 
+
+```
+python setup.py install   # or pip install . 
+```
+At this point, sagelib will be ready for upload to PyPI.
``````




---

archive/issue_comments_318121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,10 +11,11 @@\n . . . . . . . . . . . . . . . . .\n \n Here are the first steps:\n-- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n+- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n - #21508: Clean up src/setup.py to bring it to standard distutils behavior\n - #21516: Fix sagelib sdist (src/setup.py sdist)\n-- Handle `--build-base`\n+- #21535: Make src/setup.py independent of SAGE_CYTHONIZED\n+- #21527: Fix symbolic link to thebe.js\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2016-09-18T20:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318121",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,10 +11,11 @@
 . . . . . . . . . . . . . . . . .
 
 Here are the first steps:
-- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
+- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
 - #21508: Clean up src/setup.py to bring it to standard distutils behavior
 - #21516: Fix sagelib sdist (src/setup.py sdist)
-- Handle `--build-base`
+- #21535: Make src/setup.py independent of SAGE_CYTHONIZED
+- #21527: Fix symbolic link to thebe.js
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_comments_318122.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,7 +22,7 @@\n ```\n export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\n export SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs\n-python setup.py install   # or pip install . \n+$SAGE_LOCAL/bin/python setup.py install   # or pip install . \n ```\n \n . . . . . . . . . . . . . . . . .\n@@ -34,7 +34,7 @@\n \n ```\n export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution\n-python setup.py install   # or pip install . \n+$SAGE_LOCAL/bin/python setup.py install   # or pip install . \n ```\n \n . . . . . . . . . . . . . . . . .\n``````\n",
    "created_at": "2016-09-18T20:28:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318122",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,7 +22,7 @@
 ```
 export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
 export SAGE_PKGS=/path/to/sage/distribution/source/directory/build/pkgs
-python setup.py install   # or pip install . 
+$SAGE_LOCAL/bin/python setup.py install   # or pip install . 
 ```
 
 . . . . . . . . . . . . . . . . .
@@ -34,7 +34,7 @@
 
 ```
 export SAGE_LOCAL=/path/to/local/hierarchy/populated/by/sage/distribution
-python setup.py install   # or pip install . 
+$SAGE_LOCAL/bin/python setup.py install   # or pip install . 
 ```
 
 . . . . . . . . . . . . . . . . .
``````




---

archive/issue_comments_318123.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThanks for taking the lead on this.  There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).",
    "created_at": "2016-09-22T15:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318123",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">Comment 10</div>

Thanks for taking the lead on this.  There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).



---

archive/issue_comments_318124.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@embray](#comment%3A10):\n> There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  \n\nDefinitely. I'm hoping that we can use this ticket to organize it.\n\n> I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).\n\nI agree.",
    "created_at": "2016-09-22T17:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318124",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@embray](#comment%3A10):
> There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  

Definitely. I'm hoping that we can use this ticket to organize it.

> I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).

I agree.



---

archive/issue_comments_318125.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nHere's a question for the distutils experts. Is a Python package allowed to install things in `bin/`? Do any other Python packages do that? \nWhere would one install helper scripts? Is there a Python equivalent of `$prefix/libexec`?",
    "created_at": "2016-09-22T19:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318125",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">Comment 12</div>

Here's a question for the distutils experts. Is a Python package allowed to install things in `bin/`? Do any other Python packages do that? 
Where would one install helper scripts? Is there a Python equivalent of `$prefix/libexec`?



---

archive/issue_comments_318126.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -41,7 +41,9 @@\n \n Next steps:\n \n-- Remove the dependency on the SAGE_LOCAL environment variable. \n+- Remove the dependency on the SAGE_LOCAL environment variable\n+  - #15105: hardwired paths in src/sage\n+  - ...\n \n This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. \n \n``````\n",
    "created_at": "2016-09-22T19:32:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318126",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -41,7 +41,9 @@
 
 Next steps:
 
-- Remove the dependency on the SAGE_LOCAL environment variable. 
+- Remove the dependency on the SAGE_LOCAL environment variable
+  - #15105: hardwired paths in src/sage
+  - ...
 
 This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. 
 
``````




---

archive/issue_comments_318127.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThis Python package, which is part of SMC, installs many things to /usr/local/bin using completely standard approaches: https://github.com/sagemathinc/smc/tree/master/src/smc_pyutil.  See, in particular, the console_scripts section of setup.py: https://github.com/sagemathinc/smc/blob/master/src/smc_pyutil/setup.py#L58",
    "created_at": "2016-09-22T20:26:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318127",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:14" align="right">Comment 14</div>

This Python package, which is part of SMC, installs many things to /usr/local/bin using completely standard approaches: https://github.com/sagemathinc/smc/tree/master/src/smc_pyutil.  See, in particular, the console_scripts section of setup.py: https://github.com/sagemathinc/smc/blob/master/src/smc_pyutil/setup.py#L58



---

archive/issue_comments_318128.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nThanks a lot! Following your pointer, I've found this documentation: http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html, which I will refer to alongside the example that you pointed out.",
    "created_at": "2016-09-22T20:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318128",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">Comment 15</div>

Thanks a lot! Following your pointer, I've found this documentation: http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html, which I will refer to alongside the example that you pointed out.



---

archive/issue_comments_318129.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,6 +12,7 @@\n \n Here are the first steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n+- #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n - #21508: Clean up src/setup.py to bring it to standard distutils behavior\n - #21516: Fix sagelib sdist (src/setup.py sdist)\n - #21535: Make src/setup.py independent of SAGE_CYTHONIZED\n``````\n",
    "created_at": "2016-09-22T21:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318129",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,6 +12,7 @@
 
 Here are the first steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
+- #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
 - #21508: Clean up src/setup.py to bring it to standard distutils behavior
 - #21516: Fix sagelib sdist (src/setup.py sdist)
 - #21535: Make src/setup.py independent of SAGE_CYTHONIZED
``````




---

archive/issue_comments_318130.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThis now #21569.",
    "created_at": "2016-09-22T22:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318130",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">Comment 17</div>

This now #21569.



---

archive/issue_comments_318131.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,7 @@\n Here are the first steps:\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n+- #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n - #21508: Clean up src/setup.py to bring it to standard distutils behavior\n - #21516: Fix sagelib sdist (src/setup.py sdist)\n - #21535: Make src/setup.py independent of SAGE_CYTHONIZED\n``````\n",
    "created_at": "2016-09-22T22:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318131",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,7 @@
 Here are the first steps:
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
+- #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
 - #21508: Clean up src/setup.py to bring it to standard distutils behavior
 - #21516: Fix sagelib sdist (src/setup.py sdist)
 - #21535: Make src/setup.py independent of SAGE_CYTHONIZED
``````




---

archive/issue_comments_318132.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,7 @@\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n+- #21571: Install COPYING.txt in SAGE_LOCAL and use it from misc/copying.py\n - #21508: Clean up src/setup.py to bring it to standard distutils behavior\n - #21516: Fix sagelib sdist (src/setup.py sdist)\n - #21535: Make src/setup.py independent of SAGE_CYTHONIZED\n``````\n",
    "created_at": "2016-09-22T22:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318132",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,7 @@
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
 - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
+- #21571: Install COPYING.txt in SAGE_LOCAL and use it from misc/copying.py
 - #21508: Clean up src/setup.py to bring it to standard distutils behavior
 - #21516: Fix sagelib sdist (src/setup.py sdist)
 - #21535: Make src/setup.py independent of SAGE_CYTHONIZED
``````




---

archive/issue_comments_318133.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,11 +14,12 @@\n - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n-- #21571: Install COPYING.txt in SAGE_LOCAL and use it from misc/copying.py\n-- #21508: Clean up src/setup.py to bring it to standard distutils behavior\n-- #21516: Fix sagelib sdist (src/setup.py sdist)\n-- #21535: Make src/setup.py independent of SAGE_CYTHONIZED\n-- #21527: Fix symbolic link to thebe.js\n+- #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n+- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior\n+- #21516: Fix sagelib sdist (`src/setup.py sdist`)\n+- #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`\n+- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n+- #21527: Fix symbolic link to `thebe.js`\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2016-09-23T04:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318133",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,11 +14,12 @@
 - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
 - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
-- #21571: Install COPYING.txt in SAGE_LOCAL and use it from misc/copying.py
-- #21508: Clean up src/setup.py to bring it to standard distutils behavior
-- #21516: Fix sagelib sdist (src/setup.py sdist)
-- #21535: Make src/setup.py independent of SAGE_CYTHONIZED
-- #21527: Fix symbolic link to thebe.js
+- #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
+- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior
+- #21516: Fix sagelib sdist (`src/setup.py sdist`)
+- #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`
+- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
+- #21527: Fix symbolic link to `thebe.js`
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_comments_318134.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI don't like the phrasing \"PyPI package\".  There's no such thing as a \"PyPI package\" per se.  \nLet's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?",
    "created_at": "2016-09-23T11:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318134",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">Comment 21</div>

I don't like the phrasing "PyPI package".  There's no such thing as a "PyPI package" per se.  
Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?



---

archive/issue_comments_318135.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  I don't think it would necessarily be appropriate to use directly--although there's nothing very \"astropy\" specific in astropy-helpers, a lot of it does assume one is using the astropy project template, or something close to it.  But large swaths of it are very generic, and I put a lot of work into developing tools for build sanity of large Python projects.\n\nSome key features that I think might benefit sage include:\n\n* per-subpackage `setup_package.py` modules, which can contain any number of a [(mostly) well-documented](http://docs.astropy.org/en/stable/development/building.html#customizing-setup-build-for-subpackages) hooks for building compiled modules in that sub-package.  This provides a clear and explicit alternative to a monolithic module_list.py (see the discussion [here](https://github.com/cython/cython/pull/466#issuecomment-249185195)), and would also make it easier to break off some of Sage's subpackages into standalone packages should the time ever come for that.\n* one of the less-well-documented features is also that `setup_package.py` can contain hooks for setup.py commands.  For example, if a module contains some generated code (a la `sage_setup.autogen`), it can include a `pre_build_ext` hook to make sure the generated code is up to date before running the `./setup.py build_ext` command (either explicitly, or implicitly as a sub-command).  This makes it relatively easy for individual submodules to put hooks into the build process without having to write complicated command subclasses cluttered with subpackage-specific crud.\n* smarter handling of Cython modules--for example, when creating a source tarball it will make sure all Cython modules have been Cythonized, and it will include the resulting C/C++ sources in the source tarball.  This ensures that the user does not need Cython to be installed in order to build from source (which is good, because even if they do have Cython it will often be the wrong version--and in Sage's case missing important patches as well).\n\nThose are the main ones for now but I could probably think of more.",
    "created_at": "2016-09-23T13:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318135",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">Comment 22</div>

I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  I don't think it would necessarily be appropriate to use directly--although there's nothing very "astropy" specific in astropy-helpers, a lot of it does assume one is using the astropy project template, or something close to it.  But large swaths of it are very generic, and I put a lot of work into developing tools for build sanity of large Python projects.

Some key features that I think might benefit sage include:

* per-subpackage `setup_package.py` modules, which can contain any number of a [(mostly) well-documented](http://docs.astropy.org/en/stable/development/building.html#customizing-setup-build-for-subpackages) hooks for building compiled modules in that sub-package.  This provides a clear and explicit alternative to a monolithic module_list.py (see the discussion [here](https://github.com/cython/cython/pull/466#issuecomment-249185195)), and would also make it easier to break off some of Sage's subpackages into standalone packages should the time ever come for that.
* one of the less-well-documented features is also that `setup_package.py` can contain hooks for setup.py commands.  For example, if a module contains some generated code (a la `sage_setup.autogen`), it can include a `pre_build_ext` hook to make sure the generated code is up to date before running the `./setup.py build_ext` command (either explicitly, or implicitly as a sub-command).  This makes it relatively easy for individual submodules to put hooks into the build process without having to write complicated command subclasses cluttered with subpackage-specific crud.
* smarter handling of Cython modules--for example, when creating a source tarball it will make sure all Cython modules have been Cythonized, and it will include the resulting C/C++ sources in the source tarball.  This ensures that the user does not need Cython to be installed in order to build from source (which is good, because even if they do have Cython it will often be the wrong version--and in Sage's case missing important patches as well).

Those are the main ones for now but I could probably think of more.



---

archive/issue_comments_318136.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@embray](#comment%3A21):\n> I don't like the phrasing \"PyPI package\".  There's no such thing as a \"PyPI package\" per se.  \n> Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?\n\nThe scope of this ticket is a source package that is pip-installable and would be listed as such on PyPI.\n\nBinary packaging (about which I don't know anything at the moment) is beyond the scope of this ticket.",
    "created_at": "2016-09-23T15:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318136",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@embray](#comment%3A21):
> I don't like the phrasing "PyPI package".  There's no such thing as a "PyPI package" per se.  
> Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?

The scope of this ticket is a source package that is pip-installable and would be listed as such on PyPI.

Binary packaging (about which I don't know anything at the moment) is beyond the scope of this ticket.



---

archive/issue_comments_318137.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@embray](#comment%3A22):\n> I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  \n\nThis all sounds great and seems like it could be part of #21508 or be a follow up to it.",
    "created_at": "2016-09-23T15:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318137",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@embray](#comment%3A22):
> I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  

This all sounds great and seems like it could be part of #21508 or be a follow up to it.



---

archive/issue_comments_318138.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nI've updated the description to explain the scope of the ticket better.",
    "created_at": "2016-09-23T17:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318138",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">Comment 25</div>

I've updated the description to explain the scope of the ticket better.



---

archive/issue_comments_318139.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -54,4 +54,6 @@\n ```\n python setup.py install   # or pip install . \n ```\n-At this point, sagelib will be ready for upload to PyPI.\n+At this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.\n+\n+Binary packages (using wheels etc.) is beyond the scope of this ticket.\n``````\n",
    "created_at": "2016-09-23T17:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318139",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -54,4 +54,6 @@
 ```
 python setup.py install   # or pip install . 
 ```
-At this point, sagelib will be ready for upload to PyPI.
+At this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.
+
+Binary packages (using wheels etc.) is beyond the scope of this ticket.
``````




---

archive/issue_events_284152.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-23T17:39:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "title_is": "Make sagelib a pip-installable Python source package, listed on PyPI",
    "title_was": "Make sagelib a PyPI package",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284152"
}
```



---

archive/issue_events_284153.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-11T18:15:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "title_is": "Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI",
    "title_was": "Make sagelib a pip-installable Python source package, listed on PyPI",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284153"
}
```



---

archive/issue_comments_318140.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,15 +11,23 @@\n . . . . . . . . . . . . . . . . .\n \n Here are the first steps:\n-- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n+- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior\n+  - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`\n+  - #21600: Use custom build_ext to compile Cython code\n+  - #21604: Cleaning up stale installed files in setup()\n+  - #21654: Disentangle cleaning of stale installed files in build directory and in install directory\n+  - #21613: Make setup.py not depend on make\n+- #21527: Fix symbolic link to `thebe.js`\n+- #21678: Testsuite `for src/setup.py`\n+- #20108: Use package_data instead of data_files in setup.py\n+- #21682: Add a separate \"cythonize\" command to setup.py\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n-- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior\n - #21516: Fix sagelib sdist (`src/setup.py sdist`)\n - #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`\n - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n-- #21527: Fix symbolic link to `thebe.js`\n+- #21509: Install cython_debug somewhere in SAGE_LOCAL\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2016-10-11T18:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318140",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,15 +11,23 @@
 . . . . . . . . . . . . . . . . .
 
 Here are the first steps:
-- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
+- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior
+  - #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`
+  - #21600: Use custom build_ext to compile Cython code
+  - #21604: Cleaning up stale installed files in setup()
+  - #21654: Disentangle cleaning of stale installed files in build directory and in install directory
+  - #21613: Make setup.py not depend on make
+- #21527: Fix symbolic link to `thebe.js`
+- #21678: Testsuite `for src/setup.py`
+- #20108: Use package_data instead of data_files in setup.py
+- #21682: Add a separate "cythonize" command to setup.py
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
 - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
 - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
-- #21508: Clean up `src/setup.py` to bring it to standard distutils behavior
 - #21516: Fix sagelib sdist (`src/setup.py sdist`)
 - #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`
 - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
-- #21527: Fix symbolic link to `thebe.js`
+- #21509: Install cython_debug somewhere in SAGE_LOCAL
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_comments_318141.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,6 +16,9 @@\n   - #21600: Use custom build_ext to compile Cython code\n   - #21604: Cleaning up stale installed files in setup()\n   - #21654: Disentangle cleaning of stale installed files in build directory and in install directory\n+  - #21516: Fix sagelib sdist (`src/setup.py sdist`)\n+  - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`\n+  - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n   - #21613: Make setup.py not depend on make\n - #21527: Fix symbolic link to `thebe.js`\n - #21678: Testsuite `for src/setup.py`\n@@ -24,9 +27,6 @@\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n-- #21516: Fix sagelib sdist (`src/setup.py sdist`)\n-- #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`\n-- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n - #21509: Install cython_debug somewhere in SAGE_LOCAL\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n``````\n",
    "created_at": "2016-10-11T18:22:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318141",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,6 +16,9 @@
   - #21600: Use custom build_ext to compile Cython code
   - #21604: Cleaning up stale installed files in setup()
   - #21654: Disentangle cleaning of stale installed files in build directory and in install directory
+  - #21516: Fix sagelib sdist (`src/setup.py sdist`)
+  - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`
+  - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
   - #21613: Make setup.py not depend on make
 - #21527: Fix symbolic link to `thebe.js`
 - #21678: Testsuite `for src/setup.py`
@@ -24,9 +27,6 @@
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
 - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
 - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
-- #21516: Fix sagelib sdist (`src/setup.py sdist`)
-- #21535: Make `src/setup.py` independent of `SAGE_CYTHONIZED`
-- #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
 - #21509: Install cython_debug somewhere in SAGE_LOCAL
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
``````




---

archive/issue_comments_318142.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -65,3 +65,14 @@\n At this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.\n \n Binary packages (using wheels etc.) is beyond the scope of this ticket.\n+\n+. . . . . . . . . . . . . . References . . . . . . . . . . . . . . .\n+\n+- https://docs.python.org/2/library/distutils.html \n+- https://setuptools.readthedocs.io/en/latest/setuptools.html#command-reference\n+- https://docs.python.org/2/distutils/sourcedist.html\n+- https://docs.python.org/2/install/\n+- https://pip.pypa.io/en/stable/reference/pip_install/#pip-install-examples\n+- http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice\n+- http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920\n+- https://packaging.python.org/science/\n``````\n",
    "created_at": "2016-10-15T18:15:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318142",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -65,3 +65,14 @@
 At this point, sagelib will be a standard pip-installable Python source package, ready for upload to PyPI.
 
 Binary packages (using wheels etc.) is beyond the scope of this ticket.
+
+. . . . . . . . . . . . . . References . . . . . . . . . . . . . . .
+
+- https://docs.python.org/2/library/distutils.html 
+- https://setuptools.readthedocs.io/en/latest/setuptools.html#command-reference
+- https://docs.python.org/2/distutils/sourcedist.html
+- https://docs.python.org/2/install/
+- https://pip.pypa.io/en/stable/reference/pip_install/#pip-install-examples
+- http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice
+- http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920
+- https://packaging.python.org/science/
``````




---

archive/issue_comments_318143.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -76,3 +76,7 @@\n - http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice\n - http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920\n - https://packaging.python.org/science/\n+- https://packaging.python.org/current/\n+- https://packaging.python.org/key_projects/#setuptools\n+- https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode\n+- https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips\n``````\n",
    "created_at": "2016-10-15T18:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318143",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -76,3 +76,7 @@
 - http://askubuntu.com/questions/802544/is-sudo-pip-install-still-a-broken-practice
 - http://stackoverflow.com/questions/33004708/osx-el-capitan-sudo-pip-install-oserror-errno-1-operation-not-permitted/33004920#33004920
 - https://packaging.python.org/science/
+- https://packaging.python.org/current/
+- https://packaging.python.org/key_projects/#setuptools
+- https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode
+- https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips
``````




---

archive/issue_comments_318144.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,6 +28,7 @@\n - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n - #21509: Install cython_debug somewhere in SAGE_LOCAL\n+- #21732: Move runtime documentation python modules into `src/sage`\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2016-10-23T07:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318144",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,6 +28,7 @@
 - #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
 - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
 - #21509: Install cython_debug somewhere in SAGE_LOCAL
+- #21732: Move runtime documentation python modules into `src/sage`
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_comments_318145.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nI have a request: currently the sage kernel for `jupyter` is created directly in place on the file system rather than being \"installed\". Similarly there are 3 links created by the `jupyter` kernel installation. That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.",
    "created_at": "2016-10-23T07:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318145",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">Comment 31</div>

I have a request: currently the sage kernel for `jupyter` is created directly in place on the file system rather than being "installed". Similarly there are 3 links created by the `jupyter` kernel installation. That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.



---

archive/issue_comments_318146.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@kiwifb](#comment%3A31):\n> That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.\n\nCan you elaborate why that is an issue?",
    "created_at": "2016-10-23T09:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318146",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@kiwifb](#comment%3A31):
> That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.

Can you elaborate why that is an issue?



---

archive/issue_comments_318147.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nVery simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the \"merge\", moving the staged install to the live file system.\n\nI know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.\n\nPrior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.",
    "created_at": "2016-10-23T09:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318147",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">Comment 33</div>

Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the "merge", moving the staged install to the live file system.

I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.

Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.



---

archive/issue_comments_318148.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@kiwifb](#comment%3A33):\n> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the \"merge\", moving the staged install to the live file system.\n> \n> I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.\n> \n> Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.\n\nSorry, but I don't see how the above is an answer to my question.",
    "created_at": "2016-10-23T09:54:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318148",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@kiwifb](#comment%3A33):
> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the "merge", moving the staged install to the live file system.
> 
> I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.
> 
> Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.

Sorry, but I don't see how the above is an answer to my question.



---

archive/issue_comments_318149.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\n...or maybe the problem is that the kernel spec is generated during the *install* phase.\n\nThen the problem is not the fact that it is generated, but *when* it is generated.",
    "created_at": "2016-10-23T09:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318149",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">Comment 35</div>

...or maybe the problem is that the kernel spec is generated during the *install* phase.

Then the problem is not the fact that it is generated, but *when* it is generated.



---

archive/issue_comments_318150.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nReplying to [@kiwifb](#comment%3A33):\n> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root.\n\nJust to make me understand better, what are the commands that you would typically run to install a Python package this way?",
    "created_at": "2016-10-23T09:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318150",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">Comment 36</div>

Replying to [@kiwifb](#comment%3A33):
> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root.

Just to make me understand better, what are the commands that you would typically run to install a Python package this way?



---

archive/issue_comments_318151.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nWould be worse during the build phase\n\n```\n        self.kernel_dir = os.path.join(JUPYTER_PATH, \"kernels\", self.identifier())\n```\nthat's straight on the file system.\n\nFor the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`. It's supposed to do the same thing than using `DESTDIR` in autotool, everything will be installed as it normally should except that all the paths will be prefixed with DESTDIR.",
    "created_at": "2016-10-23T10:02:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318151",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:37" align="right">Comment 37</div>

Would be worse during the build phase

```
        self.kernel_dir = os.path.join(JUPYTER_PATH, "kernels", self.identifier())
```
that's straight on the file system.

For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`. It's supposed to do the same thing than using `DESTDIR` in autotool, everything will be installed as it normally should except that all the paths will be prefixed with DESTDIR.



---

archive/issue_comments_318152.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@kiwifb](#comment%3A37):\n> For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`.\n\nAnd why does it make a difference then whether the kernel spec files are generated or copied during that `install` step? I am a bit lost here...",
    "created_at": "2016-10-23T10:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318152",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@kiwifb](#comment%3A37):
> For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`.

And why does it make a difference then whether the kernel spec files are generated or copied during that `install` step? I am a bit lost here...



---

archive/issue_comments_318153.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nThe problem is that it created directly on the file system rather than in `DESTDIR`, not a problem for sage the distribution but a pain in the ass for the other people\n\n```\n>>> Install sage-9999 into /scratch2/portage/sci-mathematics/sage-9999/image/ category sci-mathematics\n * python2_7: running distutils-r1_run_phase distutils-r1_python_install\n/usr/bin/python2.7 setup.py install --root=/scratch2/portage/sci-mathematics/sage-9999/image/_python2.7\nmake: Nothing to be done for 'all'.\n....\n....\nbyte-compiling /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage/structure/all.py to all.pyc\nwriting byte-compilation script '/scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py'\n/usr/bin/python2.7 -OO /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py\nremoving /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py\nrunning install_egg_info\nWriting /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage-9999-py2.7.egg-info\nerror: [Errno 13] Permission denied: '/usr/share/jupyter/kernels/sagemath/kernel.json'\n```\nThe correct jargon for this is \"sandbox violation\", the build process is not supposed to write on the live file system at this stage.",
    "created_at": "2016-10-23T10:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318153",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">Comment 39</div>

The problem is that it created directly on the file system rather than in `DESTDIR`, not a problem for sage the distribution but a pain in the ass for the other people

```
>>> Install sage-9999 into /scratch2/portage/sci-mathematics/sage-9999/image/ category sci-mathematics
 * python2_7: running distutils-r1_run_phase distutils-r1_python_install
/usr/bin/python2.7 setup.py install --root=/scratch2/portage/sci-mathematics/sage-9999/image/_python2.7
make: Nothing to be done for 'all'.
....
....
byte-compiling /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage/structure/all.py to all.pyc
writing byte-compilation script '/scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py'
/usr/bin/python2.7 -OO /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py
removing /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py
running install_egg_info
Writing /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage-9999-py2.7.egg-info
error: [Errno 13] Permission denied: '/usr/share/jupyter/kernels/sagemath/kernel.json'
```
The correct jargon for this is "sandbox violation", the build process is not supposed to write on the live file system at this stage.



---

archive/issue_comments_318154.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nIn that case, I would prefer to fix the problem by *generating* the files in the correct place. That should not be so hard, feel free to create a ticket for that.",
    "created_at": "2016-10-23T10:31:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318154",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">Comment 40</div>

In that case, I would prefer to fix the problem by *generating* the files in the correct place. That should not be so hard, feel free to create a ticket for that.



---

archive/issue_comments_318155.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nI wish, `--root` is not very well documented as far as I can see. `DESTDIR` is quite easy we know the variable name. I am not sure there is a real equivalent variable for `setup.py`, otherwise I would have filled a trivial ticket long ago. I'll look again.",
    "created_at": "2016-10-23T10:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318155",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">Comment 41</div>

I wish, `--root` is not very well documented as far as I can see. `DESTDIR` is quite easy we know the variable name. I am not sure there is a real equivalent variable for `setup.py`, otherwise I would have filled a trivial ticket long ago. I'll look again.



---

archive/issue_comments_318156.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,6 +22,7 @@\n   - #21613: Make setup.py not depend on make\n - #21527: Fix symbolic link to `thebe.js`\n - #21678: Testsuite `for src/setup.py`\n+- #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n - #20108: Use package_data instead of data_files in setup.py\n - #21682: Add a separate \"cythonize\" command to setup.py\n - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n``````\n",
    "created_at": "2016-10-30T06:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318156",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,6 +22,7 @@
   - #21613: Make setup.py not depend on make
 - #21527: Fix symbolic link to `thebe.js`
 - #21678: Testsuite `for src/setup.py`
+- #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
 - #20108: Use package_data instead of data_files in setup.py
 - #21682: Add a separate "cythonize" command to setup.py
 - #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
``````




---

archive/issue_comments_318157.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,7 @@\n   - #21654: Disentangle cleaning of stale installed files in build directory and in install directory\n   - #21516: Fix sagelib sdist (`src/setup.py sdist`)\n   - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`\n+  - #12659: build the sage library in place\n   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n   - #21613: Make setup.py not depend on make\n - #21527: Fix symbolic link to `thebe.js`\n``````\n",
    "created_at": "2016-10-30T18:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318157",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,7 @@
   - #21654: Disentangle cleaning of stale installed files in build directory and in install directory
   - #21516: Fix sagelib sdist (`src/setup.py sdist`)
   - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`
+  - #12659: build the sage library in place
   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
   - #21613: Make setup.py not depend on make
 - #21527: Fix symbolic link to `thebe.js`
``````




---

archive/issue_comments_318158.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -58,6 +58,7 @@\n \n - Remove the dependency on the SAGE_LOCAL environment variable\n   - #15105: hardwired paths in src/sage\n+  - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR\n   - ...\n \n This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. \n``````\n",
    "created_at": "2016-11-03T03:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318158",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -58,6 +58,7 @@
 
 - Remove the dependency on the SAGE_LOCAL environment variable
   - #15105: hardwired paths in src/sage
+  - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR
   - ...
 
 This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. 
``````




---

archive/issue_comments_318159.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nI think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.",
    "created_at": "2016-11-07T13:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318159",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">Comment 45</div>

I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.



---

archive/issue_comments_318160.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@embray](#comment%3A45):\n> I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.\n\nThat would be OK if it was done relative to the argument of `--root`, you wouldn't know how to get to that Erik? I meant to look it up deeper but stuff is piling on me.",
    "created_at": "2016-11-07T19:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318160",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@embray](#comment%3A45):
> I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.

That would be OK if it was done relative to the argument of `--root`, you wouldn't know how to get to that Erik? I meant to look it up deeper but stuff is piling on me.



---

archive/issue_comments_318161.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nYeah, I'd be willing to look into it.  There should maybe be yet another ticket opened specifically for this issue.",
    "created_at": "2016-11-08T11:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318161",
    "user": "https://github.com/embray"
}
```

<div id="comment:47" align="right">Comment 47</div>

Yeah, I'd be willing to look into it.  There should maybe be yet another ticket opened specifically for this issue.



---

archive/issue_comments_318162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,7 +20,7 @@\n   - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`\n   - #12659: build the sage library in place\n   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n-  - #21613: Make setup.py not depend on make\n+  - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)\n - #21527: Fix symbolic link to `thebe.js`\n - #21678: Testsuite `for src/setup.py`\n - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n``````\n",
    "created_at": "2016-12-29T05:06:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318162",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,7 +20,7 @@
   - #21535: Make `src/setup.py` respect `--build-base` and `--inplace`, independent of `SAGE_CYTHONIZED`
   - #12659: build the sage library in place
   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
-  - #21613: Make setup.py not depend on make
+  - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)
 - #21527: Fix symbolic link to `thebe.js`
 - #21678: Testsuite `for src/setup.py`
 - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
``````




---

archive/issue_events_284154.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-12-29T05:06:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284154"
}
```



---

archive/issue_events_284155.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-12-29T05:06:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284155"
}
```



---

archive/issue_comments_318163.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,7 +21,7 @@\n   - #12659: build the sage library in place\n   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)\n-- #21527: Fix symbolic link to `thebe.js`\n+  - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)\n - #21678: Testsuite `for src/setup.py`\n - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n - #20108: Use package_data instead of data_files in setup.py\n``````\n",
    "created_at": "2016-12-29T17:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318163",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,7 +21,7 @@
   - #12659: build the sage library in place
   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)
-- #21527: Fix symbolic link to `thebe.js`
+  - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)
 - #21678: Testsuite `for src/setup.py`
 - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
 - #20108: Use package_data instead of data_files in setup.py
``````




---

archive/issue_comments_318164.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -84,3 +84,6 @@\n - https://packaging.python.org/key_projects/#setuptools\n - https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode\n - https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips\n+- https://blog.ionelmc.ro/2014/05/25/python-packaging/\n+- http://stackoverflow.com/questions/7522250/how-to-include-package-data-with-setuptools-distribute\n+\n``````\n",
    "created_at": "2017-02-04T17:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318164",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -84,3 +84,6 @@
 - https://packaging.python.org/key_projects/#setuptools
 - https://setuptools.readthedocs.io/en/latest/setuptools.html#development-mode
 - https://www.cac.cornell.edu/wiki/index.php?title=Python_Distutils_Tips
+- https://blog.ionelmc.ro/2014/05/25/python-packaging/
+- http://stackoverflow.com/questions/7522250/how-to-include-package-data-with-setuptools-distribute
+
``````




---

archive/issue_comments_318165.json:
```json
{
    "body": "Changed keywords from **** to **pip, PyPI**",
    "created_at": "2018-02-14T10:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318165",
    "user": "https://github.com/slel"
}
```

Changed keywords from **** to **pip, PyPI**



---

archive/issue_comments_318166.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nThere is interest in this process, see\n[Ask Sage #40947: SageMath as a regular python package](https://ask.sagemath.org/question/40947/sagemath-as-a-regular-python-package/).",
    "created_at": "2018-02-14T10:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318166",
    "user": "https://github.com/slel"
}
```

<div id="comment:53" align="right">Comment 53</div>

There is interest in this process, see
[Ask Sage #40947: SageMath as a regular python package](https://ask.sagemath.org/question/40947/sagemath-as-a-regular-python-package/).



---

archive/issue_comments_318167.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n Then a simple\n \n ```\n-  pip install sagelib\n+pip install sagelib\n ```\n would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.\n \n``````\n",
    "created_at": "2018-02-14T10:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318167",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 Then a simple
 
 ```
-  pip install sagelib
+pip install sagelib
 ```
 would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.
 
``````




---

archive/issue_comments_318168.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nAdded #25546",
    "created_at": "2018-06-08T18:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318168",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">Comment 54</div>

Added #25546



---

archive/issue_comments_318169.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,6 +22,7 @@\n   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`\n   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)\n   - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)\n+  - #25546: Install Jupyter kernel in the correct prefix\n - #21678: Testsuite `for src/setup.py`\n - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n - #20108: Use package_data instead of data_files in setup.py\n``````\n",
    "created_at": "2018-06-08T18:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318169",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,6 +22,7 @@
   - #21573: Make sure `src/setup.py` respects `--install-base` and `--root`
   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)
   - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)
+  - #25546: Install Jupyter kernel in the correct prefix
 - #21678: Testsuite `for src/setup.py`
 - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
 - #20108: Use package_data instead of data_files in setup.py
``````




---

archive/issue_comments_318170.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,6 +32,7 @@\n - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`\n - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21732: Move runtime documentation python modules into `src/sage`\n+- #29038: Python package `sage_conf`: Provides optional configuration information for `sagelib`\n \n This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):\n \n``````\n",
    "created_at": "2020-01-18T18:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318170",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,6 +32,7 @@
 - #21571: Install `COPYING.txt` in `SAGE_LOCAL` and use it from `misc/copying.py`
 - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21732: Move runtime documentation python modules into `src/sage`
+- #29038: Python package `sage_conf`: Provides optional configuration information for `sagelib`
 
 This defines **milestone 1**. `sagelib` is now a well-behaved Python package. It can be built and installed as follows (without invoking `sage -sh`):
 
``````




---

archive/issue_events_284156.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T18:14:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284156"
}
```



---

archive/issue_events_284157.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-18T18:14:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284157"
}
```



---

archive/issue_comments_318171.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nI propose that we get this task ticket done in 2020.",
    "created_at": "2020-01-18T18:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318171",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">Comment 58</div>

I propose that we get this task ticket done in 2020.



---

archive/issue_comments_318172.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,6 +23,7 @@\n   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)\n   - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)\n   - #25546: Install Jupyter kernel in the correct prefix\n+  - #29041: at `./bootstrap` time, generate `src/requirements.txt`, `src/constraints.txt`, `src/setup.cfg` `[install_requires]` from `build/pkgs`\n - #21678: Testsuite `for src/setup.py`\n - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n - #20108: Use package_data instead of data_files in setup.py\n``````\n",
    "created_at": "2020-01-18T21:52:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318172",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,6 +23,7 @@
   - #21613: Make setup.py not depend on make (follow-up: #22044, #22094, #22106)
   - #22061: Don't hard-code the path to thebe.js (dup: #21527: Fix symbolic link to `thebe.js`)
   - #25546: Install Jupyter kernel in the correct prefix
+  - #29041: at `./bootstrap` time, generate `src/requirements.txt`, `src/constraints.txt`, `src/setup.cfg` `[install_requires]` from `build/pkgs`
 - #21678: Testsuite `for src/setup.py`
 - #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`
 - #20108: Use package_data instead of data_files in setup.py
``````




---

archive/issue_comments_318173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -62,6 +62,7 @@\n - Remove the dependency on the SAGE_LOCAL environment variable\n   - #15105: hardwired paths in src/sage\n   - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR\n+  - #29119: Add an autoconf configure script for sagelib\n   - ...\n \n This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. \n``````\n",
    "created_at": "2020-02-01T14:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318173",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -62,6 +62,7 @@
 - Remove the dependency on the SAGE_LOCAL environment variable
   - #15105: hardwired paths in src/sage
   - #21803: env.py, misc/cython.py: Define and use FLINT_INCLUDE_DIR
+  - #29119: Add an autoconf configure script for sagelib
   - ...
 
 This defines **milestone 3**. If SAGE_LOCAL is not set, then sagelib will discover system packages and Python packages installed in standard places. 
``````




---

archive/issue_comments_318174.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nThe major problem I feel with making something like Sage into a python package is owing to the enormous complexity of Sagemath, the application itself has such major features , and I am not sure how much would we need to modify the application in order to help the proper incorporation of Sage into ordinary python code.",
    "created_at": "2020-03-21T05:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318174",
    "user": "https://github.com/Shlokatadistance"
}
```

<div id="comment:61" align="right">Comment 61</div>

The major problem I feel with making something like Sage into a python package is owing to the enormous complexity of Sagemath, the application itself has such major features , and I am not sure how much would we need to modify the application in order to help the proper incorporation of Sage into ordinary python code.



---

archive/issue_comments_318175.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nYes, the complexity is why we use a meta-ticket to organize the necessary steps.\n\nIf you want to help, you can work on a well-defined ticket such as #21516.",
    "created_at": "2020-03-21T13:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318175",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:62" align="right">Comment 62</div>

Yes, the complexity is why we use a meta-ticket to organize the necessary steps.

If you want to help, you can work on a well-defined ticket such as #21516.



---

archive/issue_comments_318176.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nHi sorry for the delay, I'll start working on this right away\nReplying to [@mkoeppe](#comment%3A62):\n> Yes, the complexity is why we use a meta-ticket to organize the necessary steps.\n> \n> If you want to help, you can work on a well-defined ticket such as #21516.",
    "created_at": "2020-03-30T05:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318176",
    "user": "https://github.com/Shlokatadistance"
}
```

<div id="comment:63" align="right">Comment 63</div>

Hi sorry for the delay, I'll start working on this right away
Replying to [@mkoeppe](#comment%3A62):
> Yes, the complexity is why we use a meta-ticket to organize the necessary steps.
> 
> If you want to help, you can work on a well-defined ticket such as #21516.



---

archive/issue_events_284158.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:08:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284158"
}
```



---

archive/issue_events_284159.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:08:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284159"
}
```



---

archive/issue_events_284160.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-19T16:24:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "title_is": "Meta-ticket: Make sagelib a pip-installable Python source package, listed on PyPI",
    "title_was": "Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284160"
}
```



---

archive/issue_comments_318177.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -74,6 +74,12 @@\n \n Binary packages (using wheels etc.) is beyond the scope of this ticket.\n \n+. . . . . . . . . . . . . . . . .\n+\n+See also:\n+\n+- **#29133 META-META-TICKET: Build, packaging, testing improvements**\n+\n . . . . . . . . . . . . . . References . . . . . . . . . . . . . . .\n \n - https://docs.python.org/2/library/distutils.html \n``````\n",
    "created_at": "2020-05-01T17:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318177",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -74,6 +74,12 @@
 
 Binary packages (using wheels etc.) is beyond the scope of this ticket.
 
+. . . . . . . . . . . . . . . . .
+
+See also:
+
+- **#29133 META-META-TICKET: Build, packaging, testing improvements**
+
 . . . . . . . . . . . . . . References . . . . . . . . . . . . . . .
 
 - https://docs.python.org/2/library/distutils.html 
``````




---

archive/issue_events_284161.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284161"
}
```



---

archive/issue_events_284162.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284162"
}
```



---

archive/issue_events_284163.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T21:29:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284163"
}
```



---

archive/issue_events_284164.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T21:29:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284164"
}
```



---

archive/issue_events_284165.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T21:29:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284165"
}
```



---

archive/issue_comments_318178.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n-This is a task ticket organizing the steps necessary to eventually provide sagelib via PyPI.\n+**This task ticket, organizing the steps necessary to eventually provide sagelib via PyPI, has been superseded by Meta-ticket #29705: Modularize sagelib into separate distributions (distutils packages).**\n+\n+. . . . . . . . . . . . . . . . .\n+\n \n It would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.\n Then a simple\n``````\n",
    "created_at": "2020-10-26T21:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318178",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
-This is a task ticket organizing the steps necessary to eventually provide sagelib via PyPI.
+**This task ticket, organizing the steps necessary to eventually provide sagelib via PyPI, has been superseded by Meta-ticket #29705: Modularize sagelib into separate distributions (distutils packages).**
+
+. . . . . . . . . . . . . . . . .
+
 
 It would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.
 Then a simple
``````




---

archive/issue_events_284166.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T21:29:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284166"
}
```



---

archive/issue_comments_318179.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nLet's close this ticket. Meta-ticket #29705 describes the updated plan.",
    "created_at": "2020-10-26T21:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318179",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">Comment 69</div>

Let's close this ticket. Meta-ticket #29705 describes the updated plan.



---

archive/issue_events_284167.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-27T07:57:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284167"
}
```



---

archive/issue_events_284168.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-27T07:57:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284168"
}
```



---

archive/issue_comments_318180.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-10-27T07:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21507#issuecomment-318180",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_284169.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-13T06:40:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284169"
}
```



---

archive/issue_events_284170.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-13T06:40:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21507",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21507#event-284170"
}
```
