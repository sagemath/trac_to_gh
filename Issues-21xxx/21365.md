# Issue 21365: doctest fix for: cot(float) returns complex

archive/issues_021128.json:
```json
{
    "body": "```\nsage: cot(float(.1))\n(9.966644423259224+0j)\n```\n\nThis causes a plot of cot() on the real axis to fail. Sample output:\n\n```\nsage: set_verbose(1)\nsage: plot(cot(x),(x,.1,.5),plot_points=5)\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.1) (time = 1.604825)\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.199629500548) (time = 1.615858)\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.263010079144) (time = 1.616164)\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.373209060982) (time = 1.616497)\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.5) (time = 1.616673)\nverbose 0 (3743: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 5 points.\nverbose 0 (3743: plot.py, generate_plot_points) Last error message: 'can't convert complex to float'\nLaunched png viewer for Graphics object consisting of 0 graphics primitives\n```\n\nThere is no problem plotting 1/tan().\n\nIssue created by migration from https://trac.sagemath.org/ticket/21365\n\n",
    "closed_at": "2016-11-08T23:42:25Z",
    "created_at": "2016-08-29T20:33:42Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "doctest fix for: cot(float) returns complex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21365",
    "user": "https://github.com/paulmasson"
}
```
```
sage: cot(float(.1))
(9.966644423259224+0j)
```

This causes a plot of cot() on the real axis to fail. Sample output:

```
sage: set_verbose(1)
sage: plot(cot(x),(x,.1,.5),plot_points=5)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.1) (time = 1.604825)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.199629500548) (time = 1.615858)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.263010079144) (time = 1.616164)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.373209060982) (time = 1.616497)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.5) (time = 1.616673)
verbose 0 (3743: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 5 points.
verbose 0 (3743: plot.py, generate_plot_points) Last error message: 'can't convert complex to float'
Launched png viewer for Graphics object consisting of 0 graphics primitives
```

There is no problem plotting 1/tan().

Issue created by migration from https://trac.sagemath.org/ticket/21365





---

archive/issue_comments_292417.json:
```json
{
    "body": "Changing component from symbolics to graphics.",
    "created_at": "2016-09-02T13:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292417",
    "user": "https://github.com/rwst"
}
```

Changing component from symbolics to graphics.



---

archive/issue_comments_292418.json:
```json
{
    "body": "`real(cot(x))` works too.",
    "created_at": "2016-09-02T13:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292418",
    "user": "https://github.com/rwst"
}
```

`real(cot(x))` works too.



---

archive/issue_comments_292419.json:
```json
{
    "body": "When inserting a print at this line:\nhttps://github.com/pynac/pynac/blob/master/ginac/inifcns_trig.cpp#L777\nin order to print what is returned there I get:\n\n```\n9.96664442325922\nverbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float\nUnable to compute f(0.1) (time = 0.176)\n...\n```\nwhich is exactly `cot(0.1)` and does not look complex. So Pynac does not seem the direct cause of it.",
    "created_at": "2016-09-02T13:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292419",
    "user": "https://github.com/rwst"
}
```

When inserting a print at this line:
https://github.com/pynac/pynac/blob/master/ginac/inifcns_trig.cpp#L777
in order to print what is returned there I get:

```
9.96664442325922
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.1) (time = 0.176)
...
```
which is exactly `cot(0.1)` and does not look complex. So Pynac does not seem the direct cause of it.



---

archive/issue_comments_292420.json:
```json
{
    "body": "I downloaded older binaries to determine the version in which this error first occurs. The cotangent plots just fine in 7.1 and fails in 7.2.\n\nSage 7.2.rc1 included Pynac 0.6.5, which is precisely the last time the cotangent function was modified in Pynac. That is unlikely to be a coincidence.\n\nThis is not a graphics issue. The plotting method returning the error hasn't been modified in years. And this is not the first time in my experience a change in Pynac has had consequences for plotting (#20818).",
    "created_at": "2016-09-06T21:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292420",
    "user": "https://github.com/paulmasson"
}
```

I downloaded older binaries to determine the version in which this error first occurs. The cotangent plots just fine in 7.1 and fails in 7.2.

Sage 7.2.rc1 included Pynac 0.6.5, which is precisely the last time the cotangent function was modified in Pynac. That is unlikely to be a coincidence.

This is not a graphics issue. The plotting method returning the error hasn't been modified in years. And this is not the first time in my experience a change in Pynac has had consequences for plotting (#20818).



---

archive/issue_comments_292421.json:
```json
{
    "body": "Changing component from graphics to symbolics.",
    "created_at": "2016-09-06T21:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292421",
    "user": "https://github.com/paulmasson"
}
```

Changing component from graphics to symbolics.



---

archive/issue_comments_292422.json:
```json
{
    "body": "The issue is when you pass a floating point, not a `sage.rings.real_mpfr.RealLiteral`:\n\n```sage\nsage: cot(float(0.5))\n(1.8304877217124513+0j)\n```\nin contrast with:\n\n```sage\nsage: type(sin(float(1.1)))\n<type 'float'>\n```\nThus the bug is likely coming from that the internal plot functions use python/machine floating points as they are Python (i.e., not run through the Sage preparser).",
    "created_at": "2016-09-06T21:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292422",
    "user": "https://github.com/tscrim"
}
```

The issue is when you pass a floating point, not a `sage.rings.real_mpfr.RealLiteral`:

```sage
sage: cot(float(0.5))
(1.8304877217124513+0j)
```
in contrast with:

```sage
sage: type(sin(float(1.1)))
<type 'float'>
```
Thus the bug is likely coming from that the internal plot functions use python/machine floating points as they are Python (i.e., not run through the Sage preparser).



---

archive/issue_comments_292423.json:
```json
{
    "body": "Tracing slightly further, the python `math` (which is the first place the code checks) does not have a `cot` function. Looking into it more now.",
    "created_at": "2016-09-06T21:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292423",
    "user": "https://github.com/tscrim"
}
```

Tracing slightly further, the python `math` (which is the first place the code checks) does not have a `cot` function. Looking into it more now.



---

archive/issue_comments_292424.json:
```json
{
    "body": "Okay, I'm not quite sure what happens. It seems to fall into the generic `Function.__call__`, but I'm just tracing through the logical output at this point.",
    "created_at": "2016-09-06T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292424",
    "user": "https://github.com/tscrim"
}
```

Okay, I'm not quite sure what happens. It seems to fall into the generic `Function.__call__`, but I'm just tracing through the logical output at this point.



---

archive/issue_comments_292425.json:
```json
{
    "body": "Will be fixed in the next release of Pynac.",
    "created_at": "2016-09-16T21:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292425",
    "user": "https://github.com/paulmasson"
}
```

Will be fixed in the next release of Pynac.



---

archive/issue_comments_292426.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-09-16T21:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292426",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_info.



---

archive/issue_events_056831.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-10-06T12:54:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56831"
}
```



---

archive/issue_comments_292427.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-10-06T12:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292427",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_292428.json:
```json
{
    "body": "I confirm this is fixed in #21623 so this ticked is duplicate.",
    "created_at": "2016-10-06T12:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292428",
    "user": "https://github.com/rwst"
}
```

I confirm this is fixed in #21623 so this ticked is duplicate.



---

archive/issue_comments_292429.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-06T13:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292429",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_292430.json:
```json
{
    "body": "Confirmed as well.",
    "created_at": "2016-10-06T13:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292430",
    "user": "https://github.com/tscrim"
}
```

Confirmed as well.



---

archive/issue_events_056832.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-11-05T16:24:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56832"
}
```



---

archive/issue_events_056833.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-11-05T16:24:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56833"
}
```



---

archive/issue_comments_292431.json:
```json
{
    "body": "I'll reuse this ticket for the doctests.",
    "created_at": "2016-11-05T16:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292431",
    "user": "https://github.com/rwst"
}
```

I'll reuse this ticket for the doctests.



---

archive/issue_comments_292432.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-11-05T16:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292432",
    "user": "https://github.com/rwst"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_292433.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-05T16:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292433",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_292434.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-05T16:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292434",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_292435.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-05T16:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292435",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_056834.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-11-05T16:35:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56834"
}
```



---

archive/issue_events_056835.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-11-05T16:35:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56835"
}
```



---

archive/issue_comments_292436.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-08T23:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21365#issuecomment-292436",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056836.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-08T23:42:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21365",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21365#event-56836"
}
```
