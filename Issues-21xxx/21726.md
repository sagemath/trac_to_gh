# Issue 21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)

archive/issues_021489.json:
```json
{
    "body": "Here's a new attempt toward #21537 that is perhaps more elegant.\n\nLet's change `build/bin/sage-spkg` as follows:\n\n- If `spkg-build` exists, call that, followed by `$SAGE_SUDO spkg-install`. \n- Otherwise, just call `spkg-install` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)\n\n\nThe patch changes two example packages, to demonstrate this: `4ti2` and `lcalc`.\n\nBefore the patch:\n\n```\n$ rm -Rf local/share/4ti2\n$ mkdir local/share/4ti2\n$ sudo chown root local/share/4ti2\n$ ./sage -f 4ti2\n[...]\n[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied\n[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1\n[...]\n$ sudo chown root local/bin/ local/bin/lcalc\n$ ./sage -f lcalc \n[...]\n[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.\n[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied\n[...] \n```\n\nThen, after the patch:\n\n```\n$ export SAGE_SUDO=\"sudo -E\"\n$ ./sage -f 4ti2 lcalc  # succeeds\n```\n\nOther packages will be handled in follow-up tickets.\n\nSee also: \n- #21844: Update developer manual regarding spkg-build, spkg-install, SAGE_SUDO\n- Task ticket: #21537 \n\nCC:  @jdemeyer @kiwifb @embray @vbraun @dimpase @tscrim\n\nReviewer: Erik Bray\n\nAuthor: Matthias Koeppe\n\nBranch: 48053d0af7bef79e41a581aa492e58a285c9feb6\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21726\n\n",
    "closed_at": "2016-11-09T18:16:17Z",
    "created_at": "2016-10-19T01:25:18Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21726",
    "user": "https://github.com/mkoeppe"
}
```
Here's a new attempt toward #21537 that is perhaps more elegant.

Let's change `build/bin/sage-spkg` as follows:

- If `spkg-build` exists, call that, followed by `$SAGE_SUDO spkg-install`. 
- Otherwise, just call `spkg-install` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)


The patch changes two example packages, to demonstrate this: `4ti2` and `lcalc`.

Before the patch:

```
$ rm -Rf local/share/4ti2
$ mkdir local/share/4ti2
$ sudo chown root local/share/4ti2
$ ./sage -f 4ti2
[...]
[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied
[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1
[...]
$ sudo chown root local/bin/ local/bin/lcalc
$ ./sage -f lcalc 
[...]
[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.
[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied
[...] 
```

Then, after the patch:

```
$ export SAGE_SUDO="sudo -E"
$ ./sage -f 4ti2 lcalc  # succeeds
```

Other packages will be handled in follow-up tickets.

See also: 
- #21844: Update developer manual regarding spkg-build, spkg-install, SAGE_SUDO
- Task ticket: #21537 

CC:  @jdemeyer @kiwifb @embray @vbraun @dimpase @tscrim

Reviewer: Erik Bray

Author: Matthias Koeppe

Branch: 48053d0af7bef79e41a581aa492e58a285c9feb6

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21726





---

archive/issue_comments_317449.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -3,7 +3,9 @@\n Let's change \\`build/bin/sage-spkg\\` as follows:\n \n - If \\`spkg-build\\` exists, call that, followed by \\`$SAGE_SUDO spkg-install\\`. \n-- Otherwise, just call \\`spkg-install\\` (with $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable.)\n+- Otherwise, just call \\`spkg-install\\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable.)\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2016-10-19T01:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317449",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -3,7 +3,9 @@
 Let's change \`build/bin/sage-spkg\` as follows:
 
 - If \`spkg-build\` exists, call that, followed by \`$SAGE_SUDO spkg-install\`. 
-- Otherwise, just call \`spkg-install\` (with $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable.)
+- Otherwise, just call \`spkg-install\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable.)
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_317450.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+Here's a new attempt toward #21537 that is perhaps more elegant.\n+\n+Let's change \\`build/bin/sage-spkg\\` as follows:\n+\n+- If \\`spkg-build\\` exists, call that, followed by \\`$SAGE_SUDO spkg-install\\`. \n+- Otherwise, just call \\`spkg-install\\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)\n+\n \n \n Comment: 1\n```\n",
    "created_at": "2016-10-19T01:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317450",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,10 @@
+Here's a new attempt toward #21537 that is perhaps more elegant.
+
+Let's change \`build/bin/sage-spkg\` as follows:
+
+- If \`spkg-build\` exists, call that, followed by \`$SAGE_SUDO spkg-install\`. 
+- Otherwise, just call \`spkg-install\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)
+
 
 
 Comment: 1
```




---

archive/issue_comments_317451.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2016-10-19T03:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317451",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_317452.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,40 @@\n+Here's a new attempt toward #21537 that is perhaps more elegant.\n \n+Let's change \\`build/bin/sage-spkg\\` as follows:\n+\n+- If \\`spkg-build\\` exists, call that, followed by \\`$SAGE_SUDO spkg-install\\`. \n+- Otherwise, just call \\`spkg-install\\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)\n+\n+\n+The patch changes two example packages, to demonstrate this: \\`4ti2\\` and \\`lcalc\\`.\n+\n+Before the patch:\n+\n+\\`\\`\\`\n+$ rm -Rf local/share/4ti2\n+$ mkdir local/share/4ti2\n+$ sudo chown root local/\n+$ ./sage -f 4ti2\n+[...]\n+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied\n+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1\n+[...]\n+$ sudo chown root local/bin/ local/bin/lcalc\n+$ ./sage -f lcalc \n+[...]\n+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.\n+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied\n+[...] \n+\\`\\`\\`\n+\n+Then, after the patch:\n+\n+\\`\\`\\`\n+$ export SAGE_SUDO=\"sudo -E\"\n+$ ./sage -f 4ti2 lcalc  # succeeds\n+\\`\\`\\`\n+\n+Other packages will be handled in follow-up tickets.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-10-19T03:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317452",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,40 @@
+Here's a new attempt toward #21537 that is perhaps more elegant.
 
+Let's change \`build/bin/sage-spkg\` as follows:
+
+- If \`spkg-build\` exists, call that, followed by \`$SAGE_SUDO spkg-install\`. 
+- Otherwise, just call \`spkg-install\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)
+
+
+The patch changes two example packages, to demonstrate this: \`4ti2\` and \`lcalc\`.
+
+Before the patch:
+
+\`\`\`
+$ rm -Rf local/share/4ti2
+$ mkdir local/share/4ti2
+$ sudo chown root local/
+$ ./sage -f 4ti2
+[...]
+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied
+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1
+[...]
+$ sudo chown root local/bin/ local/bin/lcalc
+$ ./sage -f lcalc 
+[...]
+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.
+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied
+[...] 
+\`\`\`
+
+Then, after the patch:
+
+\`\`\`
+$ export SAGE_SUDO="sudo -E"
+$ ./sage -f 4ti2 lcalc  # succeeds
+\`\`\`
+
+Other packages will be handled in follow-up tickets.
 
 Comment: 1
 
```




---

archive/issue_comments_317453.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-19T03:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317453",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_317454.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,40 @@\n+Here's a new attempt toward #21537 that is perhaps more elegant.\n \n+Let's change \\`build/bin/sage-spkg\\` as follows:\n+\n+- If \\`spkg-build\\` exists, call that, followed by \\`$SAGE_SUDO spkg-install\\`. \n+- Otherwise, just call \\`spkg-install\\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)\n+\n+\n+The patch changes two example packages, to demonstrate this: \\`4ti2\\` and \\`lcalc\\`.\n+\n+Before the patch:\n+\n+\\`\\`\\`\n+$ rm -Rf local/share/4ti2\n+$ mkdir local/share/4ti2\n+$ sudo chown root local/share/4ti2\n+$ ./sage -f 4ti2\n+[...]\n+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied\n+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1\n+[...]\n+$ sudo chown root local/bin/ local/bin/lcalc\n+$ ./sage -f lcalc \n+[...]\n+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.\n+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied\n+[...] \n+\\`\\`\\`\n+\n+Then, after the patch:\n+\n+\\`\\`\\`\n+$ export SAGE_SUDO=\"sudo -E\"\n+$ ./sage -f 4ti2 lcalc  # succeeds\n+\\`\\`\\`\n+\n+Other packages will be handled in follow-up tickets.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-10-19T03:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317454",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,40 @@
+Here's a new attempt toward #21537 that is perhaps more elegant.
 
+Let's change \`build/bin/sage-spkg\` as follows:
+
+- If \`spkg-build\` exists, call that, followed by \`$SAGE_SUDO spkg-install\`. 
+- Otherwise, just call \`spkg-install\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)
+
+
+The patch changes two example packages, to demonstrate this: \`4ti2\` and \`lcalc\`.
+
+Before the patch:
+
+\`\`\`
+$ rm -Rf local/share/4ti2
+$ mkdir local/share/4ti2
+$ sudo chown root local/share/4ti2
+$ ./sage -f 4ti2
+[...]
+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied
+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1
+[...]
+$ sudo chown root local/bin/ local/bin/lcalc
+$ ./sage -f lcalc 
+[...]
+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.
+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied
+[...] 
+\`\`\`
+
+Then, after the patch:
+
+\`\`\`
+$ export SAGE_SUDO="sudo -E"
+$ ./sage -f 4ti2 lcalc  # succeeds
+\`\`\`
+
+Other packages will be handled in follow-up tickets.
 
 Comment: 1
 
```




---

archive/issue_comments_317455.json:
```json
{
    "body": "<a id='comment:8'></a>So, if I understand correctly, the point of calling `spkg-install` *without* `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be \"special\" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?",
    "created_at": "2016-11-07T11:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317455",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>So, if I understand correctly, the point of calling `spkg-install` *without* `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be "special" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?



---

archive/issue_comments_317456.json:
```json
{
    "body": "<a id='comment:9'></a>What is this about?\n\n```\n+    if [ ! -x spkg-build ]; then\n+\techo >&2 \"WARNING: spkg-build is not executable, making it executable\"\n+\tchmod +x spkg-build\n+    fi\n```\n\nWhy not just require it to be executable in the first place?",
    "created_at": "2016-11-07T11:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317456",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>What is this about?

```
+    if [ ! -x spkg-build ]; then
+	echo >&2 "WARNING: spkg-build is not executable, making it executable"
+	chmod +x spkg-build
+    fi
```

Why not just require it to be executable in the first place?



---

archive/issue_comments_317457.json:
```json
{
    "body": "<a id='comment:10'></a>LGTM otherwise.  This looks like what I had in mind in #21537.",
    "created_at": "2016-11-07T11:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317457",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>LGTM otherwise.  This looks like what I had in mind in #21537.



---

archive/issue_comments_317458.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:8 embray]:\n> So, if I understand correctly, the point of calling `spkg-install` *without* `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be \"special\" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?\n\n\nThat's right.",
    "created_at": "2016-11-08T12:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317458",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:8 embray]:
> So, if I understand correctly, the point of calling `spkg-install` *without* `$SAGE_SUDO` if no `spkg-build` exists, is that for backwards-compatibility such packages should be assumed to be "special" in some way, and have to handle `$SAGE_SUDO` on their own.  Is that correct?


That's right.



---

archive/issue_comments_317459.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 embray]:\n> What is this about?\n> \n> \n> ```\n> +    if [ ! -x spkg-build ]; then\n> +\techo >&2 \"WARNING: spkg-build is not executable, making it executable\"\n> +\tchmod +x spkg-build\n> +    fi\n> ```\n> \n> Why not just require it to be executable in the first place?\n\n\nIt's imitating existing code that does the same for `spkg-install`. I don't know why it does that. Hysterical raisins?",
    "created_at": "2016-11-08T12:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317459",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Replying to [comment:9 embray]:
> What is this about?
> 
> 
> ```
> +    if [ ! -x spkg-build ]; then
> +	echo >&2 "WARNING: spkg-build is not executable, making it executable"
> +	chmod +x spkg-build
> +    fi
> ```
> 
> Why not just require it to be executable in the first place?


It's imitating existing code that does the same for `spkg-install`. I don't know why it does that. Hysterical raisins?



---

archive/issue_comments_317460.json:
```json
{
    "body": "<a id='comment:13'></a>I see that now.  Might as well keep it for now then :(",
    "created_at": "2016-11-08T12:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317460",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>I see that now.  Might as well keep it for now then :(



---

archive/issue_comments_317461.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-08T12:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317461",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317462.json:
```json
{
    "body": "<a id='comment:16'></a>Thanks!",
    "created_at": "2016-11-08T18:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317462",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Thanks!



---

archive/issue_comments_317463.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,44 @@\n+Here's a new attempt toward #21537 that is perhaps more elegant.\n \n+Let's change \\`build/bin/sage-spkg\\` as follows:\n+\n+- If \\`spkg-build\\` exists, call that, followed by \\`$SAGE_SUDO spkg-install\\`. \n+- Otherwise, just call \\`spkg-install\\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)\n+\n+\n+The patch changes two example packages, to demonstrate this: \\`4ti2\\` and \\`lcalc\\`.\n+\n+Before the patch:\n+\n+\\`\\`\\`\n+$ rm -Rf local/share/4ti2\n+$ mkdir local/share/4ti2\n+$ sudo chown root local/share/4ti2\n+$ ./sage -f 4ti2\n+[...]\n+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied\n+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1\n+[...]\n+$ sudo chown root local/bin/ local/bin/lcalc\n+$ ./sage -f lcalc \n+[...]\n+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.\n+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied\n+[...] \n+\\`\\`\\`\n+\n+Then, after the patch:\n+\n+\\`\\`\\`\n+$ export SAGE_SUDO=\"sudo -E\"\n+$ ./sage -f 4ti2 lcalc  # succeeds\n+\\`\\`\\`\n+\n+Other packages will be handled in follow-up tickets.\n+\n+See also: \n+- #21844: Update developer manual regarding spkg-build, spkg-install, SAGE_SUDO\n+- Task ticket: #21537 \n \n Comment: 1\n \n```\n",
    "created_at": "2016-11-08T18:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317463",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,44 @@
+Here's a new attempt toward #21537 that is perhaps more elegant.
 
+Let's change \`build/bin/sage-spkg\` as follows:
+
+- If \`spkg-build\` exists, call that, followed by \`$SAGE_SUDO spkg-install\`. 
+- Otherwise, just call \`spkg-install\` (withOUT $SAGE_SUDO). (Such packages cannot be installed into a SAGE_ROOT that is only root-writable, unless they use $SAGE_SUDO themselves.)
+
+
+The patch changes two example packages, to demonstrate this: \`4ti2\` and \`lcalc\`.
+
+Before the patch:
+
+\`\`\`
+$ rm -Rf local/share/4ti2
+$ mkdir local/share/4ti2
+$ sudo chown root local/share/4ti2
+$ ./sage -f 4ti2
+[...]
+[4ti2-1.6.7] mkdir: /Users/mkoeppe/s/sage/sage-rebasing/local/share/4ti2/doc: Permission denied
+[4ti2-1.6.7] make[4]: *** [install-docDATA] Error 1
+[...]
+$ sudo chown root local/bin/ local/bin/lcalc
+$ ./sage -f lcalc 
+[...]
+[lcalc-1.23.p14] cp -f lcalc /Users/mkoeppe/s/sage/sage-rebasing/local//bin/.
+[lcalc-1.23.p14] cp: /Users/mkoeppe/s/sage/sage-rebasing/local//bin/./lcalc: Permission denied
+[...] 
+\`\`\`
+
+Then, after the patch:
+
+\`\`\`
+$ export SAGE_SUDO="sudo -E"
+$ ./sage -f 4ti2 lcalc  # succeeds
+\`\`\`
+
+Other packages will be handled in follow-up tickets.
+
+See also: 
+- #21844: Update developer manual regarding spkg-build, spkg-install, SAGE_SUDO
+- Task ticket: #21537 
 
 Comment: 1
 
```




---

archive/issue_events_057542.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-09T18:16:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21726#event-57542"
}
```



---

archive/issue_comments_317464.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-09T18:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317464",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_317465.json:
```json
{
    "body": "<a id='comment:19'></a>Semi-related, see #22510.",
    "created_at": "2017-03-03T13:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21726#issuecomment-317465",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>Semi-related, see #22510.
