# Issue 21995: Fix comparison operators of PoorManMap

archive/issues_021758.json:
```json
{
    "body": "PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.\n\nThis ticket implements `__eq__`, `__ne__`, and `__hash__` and makes these not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n\nBranch/Commit: 7776c1644f1fef5c35a8cf6dd76dd45711692e51\n\nReviewer: David Roe\n\nAuthor: Julian R\u00fcth\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21995\n\n",
    "closed_at": "2016-12-14T23:15:49Z",
    "created_at": "2016-11-29T23:29:19Z",
    "labels": [
        "component: categories",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Fix comparison operators of PoorManMap",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21995",
    "user": "https://github.com/saraedum"
}
```
PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.

This ticket implements `__eq__`, `__ne__`, and `__hash__` and makes these not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.

Branch/Commit: 7776c1644f1fef5c35a8cf6dd76dd45711692e51

Reviewer: David Roe

Author: Julian Rüth

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21995





---

archive/issue_comments_321326.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2016-11-29T23:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321326",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_321327.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n PoorManMap currently only implements `__eq__` but not `__hash__` nor `__neq__`.\n \n-This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `__eq__` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n+This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `_richcmp_` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n \n Author: Julian R\u00fcth\n \n``````\n",
    "created_at": "2016-11-29T23:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321327",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 PoorManMap currently only implements `__eq__` but not `__hash__` nor `__neq__`.
 
-This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `__eq__` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.
+This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `_richcmp_` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.
 
 Author: Julian Rüth
 
``````




---

archive/issue_comments_321328.json:
```json
{
    "body": "<a id='comment:3'></a>I still have to wait for my sage to build to check that this actually works.",
    "created_at": "2016-11-29T23:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321328",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>I still have to wait for my sage to build to check that this actually works.



---

archive/issue_comments_321329.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-29T23:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321329",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321330.json:
```json
{
    "body": "<a id='comment:4'></a>I just realized that PoorManMap is inherited from PoorManMapCompose. Got to fix that one as well.",
    "created_at": "2016-11-29T23:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321330",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>I just realized that PoorManMap is inherited from PoorManMapCompose. Got to fix that one as well.



---

archive/issue_comments_321331.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-29T23:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321331",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321332.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-29T23:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321333.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T00:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321333",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321334.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-30T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321334",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321335.json:
```json
{
    "body": "<a id='comment:7'></a>Xavier Caruso proposed to simplify this by integrating the compose map logic into `PoorManMap`.",
    "created_at": "2016-11-30T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321335",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>Xavier Caruso proposed to simplify this by integrating the compose map logic into `PoorManMap`.



---

archive/issue_comments_321336.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T02:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321337.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T02:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321337",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321338.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.\n \n+This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `_richcmp_` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n \n Author: Julian R\u00fcth\n \n``````\n",
    "created_at": "2016-11-30T02:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321338",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.
 
+This ticket implements `_richcmp_` and `__hash__` instead of `__eq__` and makes `_richcmp_` not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.
 
 Author: Julian Rüth
 
``````




---

archive/issue_comments_321339.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.\n \n+This ticket implements `__eq__`, `__ne__`, and `__hash__` and makes these not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.\n \n Author: Julian R\u00fcth\n \n``````\n",
    "created_at": "2016-11-30T02:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321339",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+PoorManMap currently only implements `__eq__` but not `__hash__` nor `__ne__`.
 
+This ticket implements `__eq__`, `__ne__`, and `__hash__` and makes these not rely on comparison of `__dict__` which does not work anymore when introducing ``@`cached_method`s in PoorManMap, see #21894.
 
 Author: Julian Rüth
 
``````




---

archive/issue_comments_321340.json:
```json
{
    "body": "<a id='comment:12'></a>Looks good to me.",
    "created_at": "2016-11-30T03:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321340",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'></a>Looks good to me.



---

archive/issue_comments_321341.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T03:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321341",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321342.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-11-30T03:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_321343.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-11-30T03:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_321344.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T03:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321344",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321345.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2016-11-30T05:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321345",
    "user": "https://github.com/xcaruso"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_321346.json:
```json
{
    "body": "<a id='comment:16'></a>(Sorry, I got troubles with my Internet connexion yesterday.)\n\nI've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)",
    "created_at": "2016-11-30T05:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321346",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:16'></a>(Sorry, I got troubles with my Internet connexion yesterday.)

I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)



---

archive/issue_comments_321347.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-11-30T05:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321347",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_321348.json:
```json
{
    "body": "<a id='comment:18'></a>Mostly to cc myself, but there should not be periods at the ends of each of the `INPUT:`s.",
    "created_at": "2016-11-30T17:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321348",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Mostly to cc myself, but there should not be periods at the ends of each of the `INPUT:`s.



---

archive/issue_comments_321349.json:
```json
{
    "body": "<a id='comment:19'></a>tscrim: I agree. But there's actually an example for that here http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content",
    "created_at": "2016-11-30T17:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321349",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>tscrim: I agree. But there's actually an example for that here http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content



---

archive/issue_comments_321350.json:
```json
{
    "body": "<a id='comment:20'></a>*grumbles as bangs head into desk* That explains the uptake in (grammatically incorrect) periods. Looking further, there are a couple of other things to fix there too. I will fix all of that on a separate ticket.",
    "created_at": "2016-11-30T17:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321350",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>*grumbles as bangs head into desk* That explains the uptake in (grammatically incorrect) periods. Looking further, there are a couple of other things to fix there too. I will fix all of that on a separate ticket.



---

archive/issue_comments_321351.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T19:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321352.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:16 caruso]:\n> I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)\n\n\nOops. I fixed that doctest. And I also added some checks when the domains and codomains are parents. But if they are just iterables, I am not sure what to do? Checking for equality seems to restrictive: for `f*g`, the codomain of `g` should be contained in the domain of `f` but they do not have to be equal I think. In any case, comparing them (whether for equality or containment) is quite costly, i.e., O(cardinality) at best. And I would need to special case if the (co)domain is an iterable because then it could well be infinite.\nWhat do you think?",
    "created_at": "2016-11-30T19:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321352",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:22'></a>Replying to [comment:16 caruso]:
> I've just a remark: shouldn't we check that self.domain() == other.codomain() (if the are both defined) in the composition? Besides, the example you give in the doctest is a kind of weird since the composite f*g does not take {2,3,4} to itself. (I suppose you wanted to write g*f... this proves that an additional checking is not unnecessary.)


Oops. I fixed that doctest. And I also added some checks when the domains and codomains are parents. But if they are just iterables, I am not sure what to do? Checking for equality seems to restrictive: for `f*g`, the codomain of `g` should be contained in the domain of `f` but they do not have to be equal I think. In any case, comparing them (whether for equality or containment) is quite costly, i.e., O(cardinality) at best. And I would need to special case if the (co)domain is an iterable because then it could well be infinite.
What do you think?



---

archive/issue_comments_321353.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-30T19:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321354.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T19:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321354",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321355.json:
```json
{
    "body": "<a id='comment:25'></a>Looks fine to me.\n\nJust a small remark: in the doctest of `__call__`, it's better to use g*f than f*g.",
    "created_at": "2016-12-03T19:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321355",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:25'></a>Looks fine to me.

Just a small remark: in the doctest of `__call__`, it's better to use g*f than f*g.



---

archive/issue_comments_321356.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T21:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321357.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-13T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321357",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321358.json:
```json
{
    "body": "<a id='comment:27'></a>Ok, thanks. That's nice.",
    "created_at": "2016-12-13T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321358",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:27'></a>Ok, thanks. That's nice.



---

archive/issue_events_057933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-14T23:15:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21995#event-57933"
}
```



---

archive/issue_comments_321359.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-14T23:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21995#issuecomment-321359",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
