# Issue 21242: ./configure --prefix=SAGE_LOCAL

archive/issues_021242.json:
```json
{
    "body": "CC:  @jdemeyer @embray @kiwifb @nexttime @dimpase\n\nI propose to support choosing a location for the SAGE_LOCAL tree, using \n\n```\n./configure --prefix=SAGE_LOCAL\n```\n(the default would be, as before, the `local` subdirectory of SAGE_ROOT - see patch on the ticket).\n\nI am fully aware that Sage's build system does not have a separation between 'make' and 'make install'; see #21495 for that. \n\nNevertheless, SAGE_LOCAL should be considered the same as the `prefix` in the sense of the autotools.\n\nThis ticket is a step towards #21566.\n\n**Release manager configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-214.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/21479\n\n",
    "closed_at": "2017-04-03T20:59:51Z",
    "created_at": "2016-09-12T18:14:49Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "./configure --prefix=SAGE_LOCAL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21242",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jdemeyer @embray @kiwifb @nexttime @dimpase

I propose to support choosing a location for the SAGE_LOCAL tree, using 

```
./configure --prefix=SAGE_LOCAL
```
(the default would be, as before, the `local` subdirectory of SAGE_ROOT - see patch on the ticket).

I am fully aware that Sage's build system does not have a separation between 'make' and 'make install'; see #21495 for that. 

Nevertheless, SAGE_LOCAL should be considered the same as the `prefix` in the sense of the autotools.

This ticket is a step towards #21566.

**Release manager configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-214.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/21479





---

archive/issue_comments_294244.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-12T18:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294244",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_294245.json:
```json
{
    "body": "(i completely agree with this)\n\na main obstacle is: the build system writes to $prefix during the build...\n\ni suggest to do the transition one-package-at-a-time, and after `--disable-$package` is in place.\n\nwith `--disable-all`, it will be easiest to avoid writing to $prefix.",
    "created_at": "2016-09-15T07:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294245",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

(i completely agree with this)

a main obstacle is: the build system writes to $prefix during the build...

i suggest to do the transition one-package-at-a-time, and after `--disable-$package` is in place.

with `--disable-all`, it will be easiest to avoid writing to $prefix.



---

archive/issue_comments_294246.json:
```json
{
    "body": "On this *short term* ticket, we do allow \"make\" to write into $prefix; and \"make install\" will be a no-op.\n\nMore ambitious plans are to be discussed on the *long term* ticket #21495, not on this ticket. Thanks.",
    "created_at": "2016-09-15T07:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294246",
    "user": "https://github.com/mkoeppe"
}
```

On this *short term* ticket, we do allow "make" to write into $prefix; and "make install" will be a no-op.

More ambitious plans are to be discussed on the *long term* ticket #21495, not on this ticket. Thanks.



---

archive/issue_comments_294247.json:
```json
{
    "body": "i agree that there are intermediate steps to take. but i don't yet fully understand this approach.\n\ni think the behaviour of just \"make\" should not change, regardless of `--prefix`. it works perfectly well and *as intended* right now. clearly it should do something different under the hood, but that's not on this ticket.\n\n> we do allow \"make\" to write into $prefix\n\n\nwhy would you need/want that? can you please give an example?\n\nmy feeling is, that entangling prefix and SAGE_LOCAL further complicates the transition considerably. there will be no way to tell whether \"this part still uses SAGE_LOCAL\" vs. \"this has already been cleaned\". newcomers tend to grep a variable from the code, see how it is used and use it the same way. for a looong time to come.",
    "created_at": "2016-09-15T09:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294247",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

i agree that there are intermediate steps to take. but i don't yet fully understand this approach.

i think the behaviour of just "make" should not change, regardless of `--prefix`. it works perfectly well and *as intended* right now. clearly it should do something different under the hood, but that's not on this ticket.

> we do allow "make" to write into $prefix


why would you need/want that? can you please give an example?

my feeling is, that entangling prefix and SAGE_LOCAL further complicates the transition considerably. there will be no way to tell whether "this part still uses SAGE_LOCAL" vs. "this has already been cleaned". newcomers tend to grep a variable from the code, see how it is used and use it the same way. for a looong time to come.



---

archive/issue_events_057039.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-15T10:55:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57039"
}
```



---

archive/issue_comments_294248.json:
```json
{
    "body": "I made a new ticket (#21501) to allow `$SAGE_LOCAL` to be changed.",
    "created_at": "2016-09-15T11:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294248",
    "user": "https://github.com/jdemeyer"
}
```

I made a new ticket (#21501) to allow `$SAGE_LOCAL` to be changed.



---

archive/issue_comments_294249.json:
```json
{
    "body": "i wrote\n> entangling prefix and SAGE_LOCAL further complicates the transition considerably.\n\n\n`@`mkoeppe i've thought about it. it seems, the alternatives are much worse (#21501) or much more ambitious.\n\nplease go ahead with prefix==SAGE_LOCAL.\n\nplease consider to add a remark in some documentation (better place: `configure --help`?) on this temporary sort of prefix, such as \n\n\"currently, `make install` is a no-op, that will change (hopefully). you should not expect a fully functional installation in $prefix before `make install` has finished.\"",
    "created_at": "2016-09-15T13:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294249",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

i wrote
> entangling prefix and SAGE_LOCAL further complicates the transition considerably.


`@`mkoeppe i've thought about it. it seems, the alternatives are much worse (#21501) or much more ambitious.

please go ahead with prefix==SAGE_LOCAL.

please consider to add a remark in some documentation (better place: `configure --help`?) on this temporary sort of prefix, such as 

"currently, `make install` is a no-op, that will change (hopefully). you should not expect a fully functional installation in $prefix before `make install` has finished."



---

archive/issue_comments_294250.json:
```json
{
    "body": "Thanks Felix for the discussion. \n\nIf you want to help, could you work on rebasing #15105.",
    "created_at": "2016-09-15T16:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294250",
    "user": "https://github.com/mkoeppe"
}
```

Thanks Felix for the discussion. 

If you want to help, could you work on rebasing #15105.



---

archive/issue_comments_294251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-18T05:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-18T05:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294253.json:
```json
{
    "body": "Here's a first version of what I have in mind.\n\nSome concerns:\n- bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?\n- sage-location.",
    "created_at": "2016-09-18T05:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294253",
    "user": "https://github.com/mkoeppe"
}
```

Here's a first version of what I have in mind.

Some concerns:
- bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?
- sage-location.



---

archive/issue_comments_294254.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-18T05:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294254",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_294255.json:
```json
{
    "body": "I don't like the duplication in `build/make/install` and `src/bin/sage-env`.\n\nHere is a suggestion: add a new file, say `src/bin/sage-config` (or whatever you want to call it) to deal with configurable things like `SAGE_LOCAL`. You can also define the other `SAGE_*` directories (except `SAGE_ROOT`) there.\n\nThen you can source this file in both `src/bin/sage-env` and `build/make/install`, which can then be independent of `configure`.\n\nAnd I don't see the point of changing `$SAGE_ROOT/sage` because that is additional duplication.",
    "created_at": "2016-09-18T11:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294255",
    "user": "https://github.com/jdemeyer"
}
```

I don't like the duplication in `build/make/install` and `src/bin/sage-env`.

Here is a suggestion: add a new file, say `src/bin/sage-config` (or whatever you want to call it) to deal with configurable things like `SAGE_LOCAL`. You can also define the other `SAGE_*` directories (except `SAGE_ROOT`) there.

Then you can source this file in both `src/bin/sage-env` and `build/make/install`, which can then be independent of `configure`.

And I don't see the point of changing `$SAGE_ROOT/sage` because that is additional duplication.



---

archive/issue_comments_294256.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> Some concerns:\n> - bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?\n> - sage-location.\n\n\nIn both cases, I don't get what the problem is.",
    "created_at": "2016-09-18T13:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294256",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 mkoeppe]:
> Some concerns:
> - bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?
> - sage-location.


In both cases, I don't get what the problem is.



---

archive/issue_comments_294257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-18T19:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294258.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Here is a suggestion: add a new file, say `src/bin/sage-config` (or whatever you want to call it) to deal with configurable things like `SAGE_LOCAL`. You can also define the other `SAGE_*` directories (except `SAGE_ROOT`) there.\n\n\nThanks for the suggestion. \nThe ticket is indeed simpler that way.\nPlease take a look.",
    "created_at": "2016-09-18T19:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294258",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:16 jdemeyer]:
> Here is a suggestion: add a new file, say `src/bin/sage-config` (or whatever you want to call it) to deal with configurable things like `SAGE_LOCAL`. You can also define the other `SAGE_*` directories (except `SAGE_ROOT`) there.


Thanks for the suggestion. 
The ticket is indeed simpler that way.
Please take a look.



---

archive/issue_comments_294259.json:
```json
{
    "body": "For easier testing, I plan to review this after #21501 and #21480 are in a beta release. You can remind me when that happens.",
    "created_at": "2016-09-18T19:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294259",
    "user": "https://github.com/jdemeyer"
}
```

For easier testing, I plan to review this after #21501 and #21480 are in a beta release. You can remind me when that happens.



---

archive/issue_comments_294260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-24T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-09-25T02:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294261",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_294262.json:
```json
{
    "body": "Branch is now on top of 7.4.beta6 (which has #21501) + #21480.",
    "created_at": "2016-09-25T02:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294262",
    "user": "https://github.com/mkoeppe"
}
```

Branch is now on top of 7.4.beta6 (which has #21501) + #21480.



---

archive/issue_comments_294263.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> Here's a first version of what I have in mind.\n> \n> Some concerns:\n> - bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?\n\n\nJust to answer this question: the `bootstrap` package is intended to use the system Python (after all, it's needed well before Sage's Python is ever built).",
    "created_at": "2016-09-26T12:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294263",
    "user": "https://github.com/embray"
}
```

Replying to [comment:15 mkoeppe]:
> Here's a first version of what I have in mind.
> 
> Some concerns:
> - bootstrap. It's somewhat unclear what to do here. By the way, is it supposed to use the distribution's Python or ours?


Just to answer this question: the `bootstrap` package is intended to use the system Python (after all, it's needed well before Sage's Python is ever built).



---

archive/issue_comments_294264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-13T05:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294265.json:
```json
{
    "body": "Branch is now on top of 7.4.rc1.\n\nJeroen - ready for review.",
    "created_at": "2016-10-13T05:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294265",
    "user": "https://github.com/mkoeppe"
}
```

Branch is now on top of 7.4.rc1.

Jeroen - ready for review.



---

archive/issue_comments_294266.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-19T00:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294267.json:
```json
{
    "body": "Now on top of 7.4.",
    "created_at": "2016-10-19T00:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294267",
    "user": "https://github.com/mkoeppe"
}
```

Now on top of 7.4.



---

archive/issue_comments_294268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-25T19:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294269.json:
```json
{
    "body": "What does this comment mean:\n\n```\n## The first test does not actually work (see above).\n```\n(\"see above\" can be really confusing because you don't know where to look.\n\nComments like these don't belong in the sources but in a Trac ticket:\n\n```\n\t# TODO: Making directories in $prefix\n\t# should be done by 'make', not configure.\n```\n\n```\n# TODO: Should the install hierarchy (local) really be deleted by make distclean?\n```\n\n```\n#SAGE_ENV_DIR=`dirname $0`    ### Does not work. $0 is /bin/bash\n```\n\n```\n## Note this is a bashism, not sure if this is allowed in this file.\n```",
    "created_at": "2016-10-26T21:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294269",
    "user": "https://github.com/jdemeyer"
}
```

What does this comment mean:

```
## The first test does not actually work (see above).
```
("see above" can be really confusing because you don't know where to look.

Comments like these don't belong in the sources but in a Trac ticket:

```
	# TODO: Making directories in $prefix
	# should be done by 'make', not configure.
```

```
# TODO: Should the install hierarchy (local) really be deleted by make distclean?
```

```
#SAGE_ENV_DIR=`dirname $0`    ### Does not work. $0 is /bin/bash
```

```
## Note this is a bashism, not sure if this is allowed in this file.
```



---

archive/issue_comments_294270.json:
```json
{
    "body": "Then a more serious remark: I doubt that you are using `BASH_SOURCE` correctly. From the `bash` man page:\n\n```\n       BASH_SOURCE\n              An array variable whose members are the source filenames where the corresponding shell function names in the FUNCNAME array variable  are\n              defined.  The shell function ${FUNCNAME[$i]} is defined in the file ${BASH_SOURCE[$i]} and called from ${BASH_SOURCE[$i+1]}.\n```\n\nAt the very least, I need more explanation of why your code does the right thing.",
    "created_at": "2016-10-26T22:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294270",
    "user": "https://github.com/jdemeyer"
}
```

Then a more serious remark: I doubt that you are using `BASH_SOURCE` correctly. From the `bash` man page:

```
       BASH_SOURCE
              An array variable whose members are the source filenames where the corresponding shell function names in the FUNCNAME array variable  are
              defined.  The shell function ${FUNCNAME[$i]} is defined in the file ${BASH_SOURCE[$i]} and called from ${BASH_SOURCE[$i+1]}.
```

At the very least, I need more explanation of why your code does the right thing.



---

archive/issue_comments_294271.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-26T22:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294271",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_294272.json:
```json
{
    "body": "Replying to [comment:32 jdemeyer]:\n> What does this comment mean:\n> \n> ```\n> ## The first test does not actually work (see above).\n> ```\n> (\"see above\" can be really confusing because you don't know where to look.\n\n\nIt's referring to `dirname $0` -- which does not give the location of sage-env but rather /bin/bash. This is because sage-env is sourced (.) rather than executed.\n\nNote this is existing code in `sage-env` which simply never worked.\n\n> Comments like these don't belong in the sources but in a Trac ticket:\n\n\nI know, these comments are for the reviewer. I'll be happy remove them *after* we had a discussion about them... So do you have a comment on these?\n\n> {{{\n> \t# TODO: Making directories in $prefix\n> \t# should be done by 'make', not configure.\n> }}}\n> \n> ```\n> # TODO: Should the install hierarchy (local) really be deleted by make distclean?\n> ```\n> \n> ```\n> #SAGE_ENV_DIR=`dirname $0`    ### Does not work. $0 is /bin/bash\n> ```\n> \n> ```\n> ## Note this is a bashism, not sure if this is allowed in this file.\n> ```",
    "created_at": "2016-10-27T00:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294272",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:32 jdemeyer]:
> What does this comment mean:
> 
> ```
> ## The first test does not actually work (see above).
> ```
> ("see above" can be really confusing because you don't know where to look.


It's referring to `dirname $0` -- which does not give the location of sage-env but rather /bin/bash. This is because sage-env is sourced (.) rather than executed.

Note this is existing code in `sage-env` which simply never worked.

> Comments like these don't belong in the sources but in a Trac ticket:


I know, these comments are for the reviewer. I'll be happy remove them *after* we had a discussion about them... So do you have a comment on these?

> {{{
> 	# TODO: Making directories in $prefix
> 	# should be done by 'make', not configure.
> }}}
> 
> ```
> # TODO: Should the install hierarchy (local) really be deleted by make distclean?
> ```
> 
> ```
> #SAGE_ENV_DIR=`dirname $0`    ### Does not work. $0 is /bin/bash
> ```
> 
> ```
> ## Note this is a bashism, not sure if this is allowed in this file.
> ```



---

archive/issue_comments_294273.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> Then a more serious remark: I doubt that you are using `BASH_SOURCE` correctly. From the `bash` man page:\n> \n> ```\n>        BASH_SOURCE\n>               An array variable whose members are the source filenames where the corresponding shell function names in the FUNCNAME array variable  are\n>               defined.  The shell function ${FUNCNAME[$i]} is defined in the file ${BASH_SOURCE[$i]} and called from ${BASH_SOURCE[$i+1]}.\n> ```\n> \n> At the very least, I need more explanation of why your code does the right thing.\n\n\nBASH_SOURCE[0] gives the source of the \"currently running function\". See https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html (you need to read the entries for FUNCNAME and BASH_SOURCE).",
    "created_at": "2016-10-27T00:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294273",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:33 jdemeyer]:
> Then a more serious remark: I doubt that you are using `BASH_SOURCE` correctly. From the `bash` man page:
> 
> ```
>        BASH_SOURCE
>               An array variable whose members are the source filenames where the corresponding shell function names in the FUNCNAME array variable  are
>               defined.  The shell function ${FUNCNAME[$i]} is defined in the file ${BASH_SOURCE[$i]} and called from ${BASH_SOURCE[$i+1]}.
> ```
> 
> At the very least, I need more explanation of why your code does the right thing.


BASH_SOURCE[0] gives the source of the "currently running function". See https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html (you need to read the entries for FUNCNAME and BASH_SOURCE).



---

archive/issue_comments_294274.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> Replying to [comment:32 jdemeyer]:\n> > What does this comment mean:\n> > \n> > ```\n> > ## The first test does not actually work (see above).\n> > ```\n> > (\"see above\" can be really confusing because you don't know where to look.\n\n> \n> It's referring to `dirname $0` -- which does not give the location of sage-env but rather /bin/bash. This is because sage-env is sourced (.) rather than executed.\n\n\nDon't tell **me** but tell the person reading `sage-env` (i.e. clarify the comment in the file).\n\n> I know, these comments are for the reviewer. I'll be happy remove them *after* we had a discussion about them... So do you have a comment on these?\n\n\nComments for the reviewer can go on Trac.",
    "created_at": "2016-10-27T06:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294274",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:35 mkoeppe]:
> Replying to [comment:32 jdemeyer]:
> > What does this comment mean:
> > 
> > ```
> > ## The first test does not actually work (see above).
> > ```
> > ("see above" can be really confusing because you don't know where to look.

> 
> It's referring to `dirname $0` -- which does not give the location of sage-env but rather /bin/bash. This is because sage-env is sourced (.) rather than executed.


Don't tell **me** but tell the person reading `sage-env` (i.e. clarify the comment in the file).

> I know, these comments are for the reviewer. I'll be happy remove them *after* we had a discussion about them... So do you have a comment on these?


Comments for the reviewer can go on Trac.



---

archive/issue_comments_294275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-27T15:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294276.json:
```json
{
    "body": "OK, done; please take a look",
    "created_at": "2016-10-27T16:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294276",
    "user": "https://github.com/mkoeppe"
}
```

OK, done; please take a look



---

archive/issue_comments_294277.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-27T16:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294277",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-30T06:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294279.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-01T21:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294280.json:
```json
{
    "body": "ping?",
    "created_at": "2016-11-03T03:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294280",
    "user": "https://github.com/mkoeppe"
}
```

ping?



---

archive/issue_comments_294281.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-04T13:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294281",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_294282.json:
```json
{
    "body": "Running `./configure` without arguments:\n\n```\n[...]\nconfig.status: creating build/make/Makefile-auto\nconfig.status: creating src/Makefile\nconfig.status: creating src/bin/sage-env-config\nconfig.status: executing depfiles commands\nconfig.status: executing mkdirs commands\nconfig.status: creating directory /usr/local/src/sage-config/logs/pkgs\nconfig.status: creating directory NONE\nconfig.status: creating directory NONE/bin\nconfig.status: creating directory NONE/etc\nconfig.status: creating directory NONE/include\nconfig.status: creating directory NONE/lib\nconfig.status: creating directory NONE/share\nconfig.status: creating directory NONE/var/lib/sage/installed\nconfig.status: creating symbolic link lib64 -> lib\n```",
    "created_at": "2016-11-04T13:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294282",
    "user": "https://github.com/jdemeyer"
}
```

Running `./configure` without arguments:

```
[...]
config.status: creating build/make/Makefile-auto
config.status: creating src/Makefile
config.status: creating src/bin/sage-env-config
config.status: executing depfiles commands
config.status: executing mkdirs commands
config.status: creating directory /usr/local/src/sage-config/logs/pkgs
config.status: creating directory NONE
config.status: creating directory NONE/bin
config.status: creating directory NONE/etc
config.status: creating directory NONE/include
config.status: creating directory NONE/lib
config.status: creating directory NONE/share
config.status: creating directory NONE/var/lib/sage/installed
config.status: creating symbolic link lib64 -> lib
```



---

archive/issue_comments_294283.json:
```json
{
    "body": "This is just because you write `SAGE_LOCAL` instead of `\"$SAGE_LOCAL\"`.\n\nWhen you fix this, I suggest to squash the commits to one commit and rebase to `7.5.beta1`.",
    "created_at": "2016-11-04T13:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294283",
    "user": "https://github.com/jdemeyer"
}
```

This is just because you write `SAGE_LOCAL` instead of `"$SAGE_LOCAL"`.

When you fix this, I suggest to squash the commits to one commit and rebase to `7.5.beta1`.



---

archive/issue_comments_294284.json:
```json
{
    "body": "The file `sage-env-config` needs to be ignored by `.gitignore` and deleted when running `make distclean`.",
    "created_at": "2016-11-04T13:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294284",
    "user": "https://github.com/jdemeyer"
}
```

The file `sage-env-config` needs to be ignored by `.gitignore` and deleted when running `make distclean`.



---

archive/issue_comments_294285.json:
```json
{
    "body": "This line in `sage` needs quoting:\n\n```\n. $SAGE_ROOT/src/bin/sage-env-config\n```\nAnd since you're running `bash` anyway, you might as well use `source` instead of `.` which is more visible.",
    "created_at": "2016-11-04T13:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294285",
    "user": "https://github.com/jdemeyer"
}
```

This line in `sage` needs quoting:

```
. $SAGE_ROOT/src/bin/sage-env-config
```
And since you're running `bash` anyway, you might as well use `source` instead of `.` which is more visible.



---

archive/issue_comments_294286.json:
```json
{
    "body": "And do you really need this:\n\n```\nif [ $? -ne 0 ]; then\n    echo >&2 \"Error: $SAGE_ROOT/src/bin/sage-env-config could not be read\"\nfi\n```\nThe shell will already write an error message, no need for an additional message.",
    "created_at": "2016-11-04T13:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294286",
    "user": "https://github.com/jdemeyer"
}
```

And do you really need this:

```
if [ $? -ne 0 ]; then
    echo >&2 "Error: $SAGE_ROOT/src/bin/sage-env-config could not be read"
fi
```
The shell will already write an error message, no need for an additional message.



---

archive/issue_comments_294287.json:
```json
{
    "body": "I also think that determining `$SAGE_LOCAL` should be done *after*\n\n```\n# If this is a freshly-unpacked binary tarball then run the installer\n# Note: relocate-once.py deletes itself upon successful completion\nif [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n    \"$SAGE_ROOT/relocate-once.py\"\nfi\n```",
    "created_at": "2016-11-04T13:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294287",
    "user": "https://github.com/jdemeyer"
}
```

I also think that determining `$SAGE_LOCAL` should be done *after*

```
# If this is a freshly-unpacked binary tarball then run the installer
# Note: relocate-once.py deletes itself upon successful completion
if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
    "$SAGE_ROOT/relocate-once.py"
fi
```



---

archive/issue_comments_294288.json:
```json
{
    "body": "Can you explain under which circumstances it is needed to read `sage-env-config` from `sage-env`? It seems to me that `sage-env-config` would already be read, either by the top-level `sage` script or by `build/make/install`.",
    "created_at": "2016-11-04T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294288",
    "user": "https://github.com/jdemeyer"
}
```

Can you explain under which circumstances it is needed to read `sage-env-config` from `sage-env`? It seems to me that `sage-env-config` would already be read, either by the top-level `sage` script or by `build/make/install`.



---

archive/issue_comments_294289.json:
```json
{
    "body": "It is good style to start all error messages with `Error:` and write them to stderr. `build/make/install` doesn't do that.",
    "created_at": "2016-11-04T14:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294289",
    "user": "https://github.com/jdemeyer"
}
```

It is good style to start all error messages with `Error:` and write them to stderr. `build/make/install` doesn't do that.



---

archive/issue_comments_294290.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-06T22:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294291.json:
```json
{
    "body": "Squashed and rebased on 7.5.beta1",
    "created_at": "2016-11-06T22:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294291",
    "user": "https://github.com/mkoeppe"
}
```

Squashed and rebased on 7.5.beta1



---

archive/issue_comments_294292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-06T22:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294292",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294293.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-06T22:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-06T22:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294295.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> Can you explain under which circumstances it is needed to read `sage-env-config` from `sage-env`? It seems to me that `sage-env-config` would already be read, either by the top-level `sage` script or by `build/make/install`.\n\n\n`$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.",
    "created_at": "2016-11-06T23:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294295",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:49 jdemeyer]:
> Can you explain under which circumstances it is needed to read `sage-env-config` from `sage-env`? It seems to me that `sage-env-config` would already be read, either by the top-level `sage` script or by `build/make/install`.


`$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.



---

archive/issue_comments_294296.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> since you're running `bash` anyway, you might as well use `source` instead of `.` which is more visible.\n\n\nI'm not sure, I like `.` more than `source`.",
    "created_at": "2016-11-06T23:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294296",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:46 jdemeyer]:
> since you're running `bash` anyway, you might as well use `source` instead of `.` which is more visible.


I'm not sure, I like `.` more than `source`.



---

archive/issue_comments_294297.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-06T23:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294297",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294298.json:
```json
{
    "body": "Replying to [comment:56 mkoeppe]:\n> `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.\n\n\nThen let me turn the question around: why do you need to change `$SAGE_ROOT/sage`?",
    "created_at": "2016-11-07T11:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294298",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:56 mkoeppe]:
> `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.


Then let me turn the question around: why do you need to change `$SAGE_ROOT/sage`?



---

archive/issue_comments_294299.json:
```json
{
    "body": "I'm still not entirely convinced that `BASH_SOURCE[0]` really does what we want. Why not use `$SAGE_ROOT/src/bin/sage-env-config`?\n\nOr maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?",
    "created_at": "2016-11-07T11:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294299",
    "user": "https://github.com/jdemeyer"
}
```

I'm still not entirely convinced that `BASH_SOURCE[0]` really does what we want. Why not use `$SAGE_ROOT/src/bin/sage-env-config`?

Or maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?



---

archive/issue_comments_294300.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-07T11:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294300",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_294301.json:
```json
{
    "body": "Replying to [comment:60 jdemeyer]:\n> Why not use `$SAGE_ROOT/src/bin/sage-env-config`?\n\n\nThings installed in SAGE_LOCAL definitely should not depend on the source directory.\n\n> Or maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?\n\n\nThat would be possible. There might be a few more places though that need to source the extra file.",
    "created_at": "2016-11-08T12:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294301",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:60 jdemeyer]:
> Why not use `$SAGE_ROOT/src/bin/sage-env-config`?


Things installed in SAGE_LOCAL definitely should not depend on the source directory.

> Or maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?


That would be possible. There might be a few more places though that need to source the extra file.



---

archive/issue_comments_294302.json:
```json
{
    "body": "Replying to [comment:59 jdemeyer]:\n> Replying to [comment:56 mkoeppe]:\n> > `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.\n\n> \n> Then let me turn the question around: why do you need to change `$SAGE_ROOT/sage`?\n\n\n`$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.",
    "created_at": "2016-11-08T12:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294302",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:59 jdemeyer]:
> Replying to [comment:56 mkoeppe]:
> > `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.

> 
> Then let me turn the question around: why do you need to change `$SAGE_ROOT/sage`?


`$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.



---

archive/issue_comments_294303.json:
```json
{
    "body": "Replying to [comment:63 mkoeppe]:\n> `$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.\n\n\nSorry, I don't follow. What is the \"it\" in the sentence above? In other words, what would not work?",
    "created_at": "2016-11-08T13:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294303",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 mkoeppe]:
> `$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.


Sorry, I don't follow. What is the "it" in the sentence above? In other words, what would not work?



---

archive/issue_comments_294304.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-20T03:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294305.json:
```json
{
    "body": "Replying to [comment:64 jdemeyer]:\n> Replying to [comment:63 mkoeppe]:\n> > `$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.\n\n> \n> Sorry, I don't follow. What is the \"it\" in the sentence above? In other words, what would not work?\n\n\nI retract my comment.\n\nI have removed this code from `$SAGE_ROOT/sage`.\n(Also rebased on latest beta.)",
    "created_at": "2016-11-20T08:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294305",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:64 jdemeyer]:
> Replying to [comment:63 mkoeppe]:
> > `$SAGE_ROOT/sage` sources `$SAGE_ROOT/src/bin/sage-env-config` so that it works when nothing has been installed so far.

> 
> Sorry, I don't follow. What is the "it" in the sentence above? In other words, what would not work?


I retract my comment.

I have removed this code from `$SAGE_ROOT/sage`.
(Also rebased on latest beta.)



---

archive/issue_comments_294306.json:
```json
{
    "body": "Replying to [comment:62 mkoeppe]:\n> > Or maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?\n\n> \n> That would be possible. There might be a few more places though that need to source the extra file.\n\n\nI think I wouldn't like to change this on this ticket. There are indeed a few places that source sage-env: `build/bin/sage-spkg`, `build/make/deps`, `src/bin/sage-update-src`. Probably not so nice if we have to change all of them.",
    "created_at": "2016-11-23T07:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294306",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:62 mkoeppe]:
> > Or maybe we should just source both `sage-env-config` and `sage-env` from `src/bin/sage`?

> 
> That would be possible. There might be a few more places though that need to source the extra file.


I think I wouldn't like to change this on this ticket. There are indeed a few places that source sage-env: `build/bin/sage-spkg`, `build/make/deps`, `src/bin/sage-update-src`. Probably not so nice if we have to change all of them.



---

archive/issue_comments_294307.json:
```json
{
    "body": "Replying to [comment:56 mkoeppe]:\n> `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.\n\n\nI realized that this is not entirely true. `sage-env` contains some code for discovering SAGE_ROOT when it is not set, but that code fails if $SAGE_LOCAL is not a direct subdirectory of $SAGE_ROOT. \nI suppose I could add the definition of SAGE_ROOT to sage-env-config. \nBut that could go on a follow-up ticket as well.",
    "created_at": "2016-11-23T08:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294307",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:56 mkoeppe]:
> `$SAGE_LOCAL/bin/sage` becomes directly executable; one does not have to go through that top-level script.


I realized that this is not entirely true. `sage-env` contains some code for discovering SAGE_ROOT when it is not set, but that code fails if $SAGE_LOCAL is not a direct subdirectory of $SAGE_ROOT. 
I suppose I could add the definition of SAGE_ROOT to sage-env-config. 
But that could go on a follow-up ticket as well.



---

archive/issue_comments_294308.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-23T08:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294308",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294309.json:
```json
{
    "body": "*ping*",
    "created_at": "2016-12-29T17:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294309",
    "user": "https://github.com/mkoeppe"
}
```

*ping*



---

archive/issue_comments_294310.json:
```json
{
    "body": "Looks good to me at least, but I don't have a complete view of the implications.  I also still think #21495 has merit, but that shouldn't hold this up, as it's a step in the right direction I think regardless of what anyone thinks about #21495 or if anything is done about it.",
    "created_at": "2016-12-29T20:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294310",
    "user": "https://github.com/embray"
}
```

Looks good to me at least, but I don't have a complete view of the implications.  I also still think #21495 has merit, but that shouldn't hold this up, as it's a step in the right direction I think regardless of what anyone thinks about #21495 or if anything is done about it.



---

archive/issue_comments_294311.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-29T20:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294311",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-01-09T19:43:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57040"
}
```



---

archive/issue_events_057041.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-01-09T19:43:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57041"
}
```



---

archive/issue_comments_294312.json:
```json
{
    "body": "Doesn't work if you dont have autotools\n\n```\n19make -j2 build/make/Makefile\n20make[1]: Entering directory `/home/buildbot/slave/sage_git/build'\n21make[1]: warning: -jN forced in submake: disabling jobserver mode.\n22./bootstrap -d\n23make[2]: Entering directory `/home/buildbot/slave/sage_git/build'\n24rm -rf config configure build/make/Makefile-auto.in\n25make[2]: Leaving directory `/home/buildbot/slave/sage_git/build'\n26src/bin/sage-env: line 206: /home/buildbot/slave/sage_git/build/src/bin/sage-env-config: No such file or directory\n27sage-env: Error: /home/buildbot/slave/sage_git/build/src/bin/sage-env-config could not be read.\n28./bootstrap: line 31: aclocal: command not found\n29Bootstrap failed, downloading required files instead.\n30./bootstrap: line 61: sage-download-file: command not found\n31Error: downloading configure-200.tar.gz failed\n32make[1]: *** [configure] Error 1\n33make[1]: Target `build/make/Makefile' not remade because of errors.\n34make[1]: Leaving directory `/home/buildbot/slave/sage_git/build'\n35make: *** [start] Error 2\n36program finished with exit code 2\n```",
    "created_at": "2017-01-13T07:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294312",
    "user": "https://github.com/vbraun"
}
```

Doesn't work if you dont have autotools

```
19make -j2 build/make/Makefile
20make[1]: Entering directory `/home/buildbot/slave/sage_git/build'
21make[1]: warning: -jN forced in submake: disabling jobserver mode.
22./bootstrap -d
23make[2]: Entering directory `/home/buildbot/slave/sage_git/build'
24rm -rf config configure build/make/Makefile-auto.in
25make[2]: Leaving directory `/home/buildbot/slave/sage_git/build'
26src/bin/sage-env: line 206: /home/buildbot/slave/sage_git/build/src/bin/sage-env-config: No such file or directory
27sage-env: Error: /home/buildbot/slave/sage_git/build/src/bin/sage-env-config could not be read.
28./bootstrap: line 31: aclocal: command not found
29Bootstrap failed, downloading required files instead.
30./bootstrap: line 61: sage-download-file: command not found
31Error: downloading configure-200.tar.gz failed
32make[1]: *** [configure] Error 1
33make[1]: Target `build/make/Makefile' not remade because of errors.
34make[1]: Leaving directory `/home/buildbot/slave/sage_git/build'
35make: *** [start] Error 2
36program finished with exit code 2
```



---

archive/issue_comments_294313.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-13T07:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294313",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-21T23:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_294315.json:
```json
{
    "body": "Replying to [comment:73 vbraun]:\n> Doesn't work if you dont have autotools\n\nThanks for catching this.\nFixed. Needs review.",
    "created_at": "2017-01-21T23:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294315",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:73 vbraun]:
> Doesn't work if you dont have autotools

Thanks for catching this.
Fixed. Needs review.



---

archive/issue_comments_294316.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-21T23:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294316",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294317.json:
```json
{
    "body": "Erik, if you could take another look...",
    "created_at": "2017-01-27T02:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294317",
    "user": "https://github.com/mkoeppe"
}
```

Erik, if you could take another look...



---

archive/issue_comments_294318.json:
```json
{
    "body": "I'm not really clear about what changed. I don't understand what the issue with autotools was or how this was fixed.  I see that you did do something to address that but I don't understand the original issue in the first place--would be better if Volker commented since  he pointed it out.",
    "created_at": "2017-01-27T14:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294318",
    "user": "https://github.com/embray"
}
```

I'm not really clear about what changed. I don't understand what the issue with autotools was or how this was fixed.  I see that you did do something to address that but I don't understand the original issue in the first place--would be better if Volker commented since  he pointed it out.



---

archive/issue_comments_294319.json:
```json
{
    "body": "Jeroen, could you take another look?",
    "created_at": "2017-02-04T16:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294319",
    "user": "https://github.com/mkoeppe"
}
```

Jeroen, could you take another look?



---

archive/issue_comments_294320.json:
```json
{
    "body": "This ticket needs review.",
    "created_at": "2017-03-01T11:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294320",
    "user": "https://github.com/mkoeppe"
}
```

This ticket needs review.



---

archive/issue_comments_294321.json:
```json
{
    "body": "*pong*",
    "created_at": "2017-03-09T08:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294321",
    "user": "https://github.com/mkoeppe"
}
```

*pong*



---

archive/issue_comments_294322.json:
```json
{
    "body": "Why does this require changes to `bootstrap` anyway?",
    "created_at": "2017-03-09T14:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294322",
    "user": "https://github.com/jdemeyer"
}
```

Why does this require changes to `bootstrap` anyway?



---

archive/issue_comments_294323.json:
```json
{
    "body": "Replying to [comment:82 jdemeyer]:\n> Why does this require changes to `bootstrap` anyway?\n\n\nI gather it's to resolve some chicken vs egg problem with autotools hosted by Sage itself.",
    "created_at": "2017-03-09T15:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294323",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:82 jdemeyer]:
> Why does this require changes to `bootstrap` anyway?


I gather it's to resolve some chicken vs egg problem with autotools hosted by Sage itself.



---

archive/issue_comments_294324.json:
```json
{
    "body": "That's right. As the comment in `setup_bootstrap_env` explains, bootstrap needs to work both pre-build and post-build.",
    "created_at": "2017-03-09T15:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294324",
    "user": "https://github.com/mkoeppe"
}
```

That's right. As the comment in `setup_bootstrap_env` explains, bootstrap needs to work both pre-build and post-build.



---

archive/issue_comments_294325.json:
```json
{
    "body": "Rebased to 7.6.rc0\n\n---\nNew commits:",
    "created_at": "2017-03-14T10:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294325",
    "user": "https://github.com/jdemeyer"
}
```

Rebased to 7.6.rc0

---
New commits:



---

archive/issue_comments_294326.json:
```json
{
    "body": "Two details:\n\n1. Why remove this comment: `# Assume current directory is SAGE_ROOT`\n\n2. Use 4 spaces indentation: ` SAGE_LOCAL=local`",
    "created_at": "2017-03-14T10:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294326",
    "user": "https://github.com/jdemeyer"
}
```

Two details:

1. Why remove this comment: `# Assume current directory is SAGE_ROOT`

2. Use 4 spaces indentation: ` SAGE_LOCAL=local`



---

archive/issue_comments_294327.json:
```json
{
    "body": "Do you expect `sage-env-config` to be installed in `$SAGE_LOCAL/bin`? Currently, that's a bit random, depending on whether or not `src/bin/sage-env-config` exists when running `./configure`.\n\nPersonally, I think that it should *not* be installed for an obvious reason: in order to find `sage-env-config`, you need to know `SAGE_LOCAL`, for which you need to source `sage-env-config`, for which you need to find `sage-env-config`...\n\nGiven that it should not be installed, a better place might be `build/bin/sage-env-config` instead of `src/bin/sage-env-config`.\n\nAnd then you might as well drop the whole complicated stuff to figure out the directory of `sage-env` and just use `$SAGE_ROOT/build/bin/sage-env-config`.\n\nIf you agree, I could implement this.",
    "created_at": "2017-03-14T11:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294327",
    "user": "https://github.com/jdemeyer"
}
```

Do you expect `sage-env-config` to be installed in `$SAGE_LOCAL/bin`? Currently, that's a bit random, depending on whether or not `src/bin/sage-env-config` exists when running `./configure`.

Personally, I think that it should *not* be installed for an obvious reason: in order to find `sage-env-config`, you need to know `SAGE_LOCAL`, for which you need to source `sage-env-config`, for which you need to find `sage-env-config`...

Given that it should not be installed, a better place might be `build/bin/sage-env-config` instead of `src/bin/sage-env-config`.

And then you might as well drop the whole complicated stuff to figure out the directory of `sage-env` and just use `$SAGE_ROOT/build/bin/sage-env-config`.

If you agree, I could implement this.



---

archive/issue_comments_294328.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-03-14T11:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294328",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_294329.json:
```json
{
    "body": "Replying to [comment:88 jdemeyer]:\n> Do you expect `sage-env-config` to be installed in `$SAGE_LOCAL/bin`? Currently, that's a bit random, depending on whether or not `src/bin/sage-env-config` exists when running `./configure`.\n\n\nYes, it should be installed.\n\n> Personally, I think that it should *not* be installed for an obvious reason: in order to find `sage-env-config`, you need to know `SAGE_LOCAL`, for which you need to source `sage-env-config`, for which you need to find `sage-env-config`...\n\n\n`sage-env-config` is intended as a place for more variables defined by `configure`, to be used by $SAGE_LOCAL/bin/sage. ($SAGE_LOCAL is just the first one that uses this file.) This is why it should be installed. \n\nThe idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set). As I realized in comment 68 above, it does not quite work yet -- because `sage-env` still tries to discover SAGE_ROOT. \nA complete solution would be to add a line that sets `SAGE_ROOT` to `sage-bin-config` as well.\nIf this sounds agreeable, I could do this.\n\n> Given that it should not be installed, a better place might be `build/bin/sage-env-config` instead of `src/bin/sage-env-config`.\n\n\nSee #21707 for a discussion regarding a distinction between build-time and run-time config variables; but I think SAGE_LOCAL (and SAGE_ROOT) should be defined in src/bin/sage-env-config (and installed in SAGE_LOCAL/bin/sage-env-config).\n\n> And then you might as well drop the whole complicated stuff to figure out the directory of `sage-env` and just use `$SAGE_ROOT/build/bin/sage-env-config`.\n> \n> If you agree, I could implement this.\n\n\nIn the end, anything that moves this ticket forward is fine with me. But note there is more work planned that depends on this -- in particular #21469 (Enable VPATH builds).\n\n---\nNew commits:",
    "created_at": "2017-03-14T15:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294329",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:88 jdemeyer]:
> Do you expect `sage-env-config` to be installed in `$SAGE_LOCAL/bin`? Currently, that's a bit random, depending on whether or not `src/bin/sage-env-config` exists when running `./configure`.


Yes, it should be installed.

> Personally, I think that it should *not* be installed for an obvious reason: in order to find `sage-env-config`, you need to know `SAGE_LOCAL`, for which you need to source `sage-env-config`, for which you need to find `sage-env-config`...


`sage-env-config` is intended as a place for more variables defined by `configure`, to be used by $SAGE_LOCAL/bin/sage. ($SAGE_LOCAL is just the first one that uses this file.) This is why it should be installed. 

The idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set). As I realized in comment 68 above, it does not quite work yet -- because `sage-env` still tries to discover SAGE_ROOT. 
A complete solution would be to add a line that sets `SAGE_ROOT` to `sage-bin-config` as well.
If this sounds agreeable, I could do this.

> Given that it should not be installed, a better place might be `build/bin/sage-env-config` instead of `src/bin/sage-env-config`.


See #21707 for a discussion regarding a distinction between build-time and run-time config variables; but I think SAGE_LOCAL (and SAGE_ROOT) should be defined in src/bin/sage-env-config (and installed in SAGE_LOCAL/bin/sage-env-config).

> And then you might as well drop the whole complicated stuff to figure out the directory of `sage-env` and just use `$SAGE_ROOT/build/bin/sage-env-config`.
> 
> If you agree, I could implement this.


In the end, anything that moves this ticket forward is fine with me. But note there is more work planned that depends on this -- in particular #21469 (Enable VPATH builds).

---
New commits:



---

archive/issue_comments_294330.json:
```json
{
    "body": "Replying to [comment:91 mkoeppe]:\n> The idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set).\n\n\nPersonally, I think it's reasonable to ask for either `SAGE_ROOT` or `SAGE_LOCAL` to be defined.",
    "created_at": "2017-03-14T17:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294330",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:91 mkoeppe]:
> The idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set).


Personally, I think it's reasonable to ask for either `SAGE_ROOT` or `SAGE_LOCAL` to be defined.



---

archive/issue_comments_294331.json:
```json
{
    "body": "Replying to [comment:92 jdemeyer]:\n> Replying to [comment:91 mkoeppe]:\n> > The idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set).\n\n> \n> Personally, I think it's reasonable to ask for either `SAGE_ROOT` or `SAGE_LOCAL` to be defined.\n\n\nI disagree; a main goal of this ticket is so that one can install into a prefix hierarchy that can just be used normally (in particular without depending on some environment variables).",
    "created_at": "2017-03-14T18:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294331",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:92 jdemeyer]:
> Replying to [comment:91 mkoeppe]:
> > The idea is that `$SAGE_LOCAL/bin/sage` would be able to work without having to go through the script `$SAGE_ROOT/sage` (and without depending on `$SAGE_ROOT` being set).

> 
> Personally, I think it's reasonable to ask for either `SAGE_ROOT` or `SAGE_LOCAL` to be defined.


I disagree; a main goal of this ticket is so that one can install into a prefix hierarchy that can just be used normally (in particular without depending on some environment variables).



---

archive/issue_comments_294332.json:
```json
{
    "body": "Replying to [comment:93 mkoeppe]:\n> I disagree; a main goal of this ticket is so that one can install into a prefix hierarchy that can just be used normally (in particular without depending on some environment variables).\n\n\nLet me clarify: `$SAGE_LOCAL/bin/sage` should not require `SAGE_ROOT` or `SAGE_LOCAL` to be set because `sage-env` can determine it. I'm mainly talking about the logic to determine `sage-env-config`: I think there we already know either `SAGE_ROOT` or `SAGE_LOCAL` so we can simplify that.",
    "created_at": "2017-03-14T19:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294332",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:93 mkoeppe]:
> I disagree; a main goal of this ticket is so that one can install into a prefix hierarchy that can just be used normally (in particular without depending on some environment variables).


Let me clarify: `$SAGE_LOCAL/bin/sage` should not require `SAGE_ROOT` or `SAGE_LOCAL` to be set because `sage-env` can determine it. I'm mainly talking about the logic to determine `sage-env-config`: I think there we already know either `SAGE_ROOT` or `SAGE_LOCAL` so we can simplify that.



---

archive/issue_comments_294333.json:
```json
{
    "body": "Thanks for the clarification; I agree that the installed `$SAGE_LOCAL/bin/sage` would be able to determine `SAGE_LOCAL`. But it would have to read `$SAGE_ROOT` from `$SAGE_LOCAL/bin/sage-env-config`.\nAnd the non-installed `$SAGE_ROOT/sage` would be able to determine SAGE_ROOT, but would have to read SAGE_LOCAL from somewhere (currently `$SAGE_ROOT/src/bin/sage-env-config`).\nIf you'd like to implement something like this, please go ahead.",
    "created_at": "2017-03-14T20:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294333",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the clarification; I agree that the installed `$SAGE_LOCAL/bin/sage` would be able to determine `SAGE_LOCAL`. But it would have to read `$SAGE_ROOT` from `$SAGE_LOCAL/bin/sage-env-config`.
And the non-installed `$SAGE_ROOT/sage` would be able to determine SAGE_ROOT, but would have to read SAGE_LOCAL from somewhere (currently `$SAGE_ROOT/src/bin/sage-env-config`).
If you'd like to implement something like this, please go ahead.



---

archive/issue_comments_294334.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-03-15T12:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294334",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_events_057042.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T12:27:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57042"
}
```



---

archive/issue_events_057043.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T12:27:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57043"
}
```



---

archive/issue_comments_294335.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-15T12:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294335",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_294336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-15T16:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294337.json:
```json
{
    "body": "What do you think of these changes?\n\nI still have to look at the bootstrap script.",
    "created_at": "2017-03-15T16:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294337",
    "user": "https://github.com/jdemeyer"
}
```

What do you think of these changes?

I still have to look at the bootstrap script.



---

archive/issue_comments_294338.json:
```json
{
    "body": "Replying to [comment:84 mkoeppe]:\n> That's right. As the comment in `setup_bootstrap_env` explains, bootstrap needs to work both pre-build and post-build.\n\n\nFor bootstrap, why not just try to source `sage-env` and ignore any errors? I feel like the current solution is over-engineered: in the case where you want to use autotools from `$SAGE_LOCAL`, the file `sage-env-config` will exist. So the current code in `bootstrap` is a complicated work-around for a non-existing problen.",
    "created_at": "2017-03-15T16:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294338",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:84 mkoeppe]:
> That's right. As the comment in `setup_bootstrap_env` explains, bootstrap needs to work both pre-build and post-build.


For bootstrap, why not just try to source `sage-env` and ignore any errors? I feel like the current solution is over-engineered: in the case where you want to use autotools from `$SAGE_LOCAL`, the file `sage-env-config` will exist. So the current code in `bootstrap` is a complicated work-around for a non-existing problen.



---

archive/issue_comments_294339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-15T16:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294340.json:
```json
{
    "body": "I agree that this is a simpler solution for the purposes of this ticket.\n(`setup_bootstrap_env` was unnecessarily ambitious -- it set up a cleaner build environment without all the settings that `sage-env` does)",
    "created_at": "2017-03-15T16:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294340",
    "user": "https://github.com/mkoeppe"
}
```

I agree that this is a simpler solution for the purposes of this ticket.
(`setup_bootstrap_env` was unnecessarily ambitious -- it set up a cleaner build environment without all the settings that `sage-env` does)



---

archive/issue_comments_294341.json:
```json
{
    "body": "Replying to [comment:99 jdemeyer]:\n> What do you think of these changes?\n\n\nFine with me from looking at it (didn't check that it works).",
    "created_at": "2017-03-15T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294341",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:99 jdemeyer]:
> What do you think of these changes?


Fine with me from looking at it (didn't check that it works).



---

archive/issue_comments_294342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-15T16:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294343.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-15T16:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294343",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294344.json:
```json
{
    "body": "I've had a look and it looks good to me.  It might be nice in the future to properly support other standard `configure` options like `--bindir` and `--libdir`, but that's a separate issue.",
    "created_at": "2017-03-15T23:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294344",
    "user": "https://github.com/embray"
}
```

I've had a look and it looks good to me.  It might be nice in the future to properly support other standard `configure` options like `--bindir` and `--libdir`, but that's a separate issue.



---

archive/issue_comments_294345.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-15T23:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294345",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_294346.json:
```json
{
    "body": "Replying to [comment:106 embray]:\n> It might be nice in the future to properly support other standard `configure` options like `--bindir` and `--libdir`, but that's a separate issue.\n\n\nI agree. Could you open a ticket for it? Note that it would require more invasive patching (or autotoolization) of many spkgs that are not autotools-based.",
    "created_at": "2017-03-15T23:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294346",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:106 embray]:
> It might be nice in the future to properly support other standard `configure` options like `--bindir` and `--libdir`, but that's a separate issue.


I agree. Could you open a ticket for it? Note that it would require more invasive patching (or autotoolization) of many spkgs that are not autotools-based.



---

archive/issue_comments_294347.json:
```json
{
    "body": "Jeroen, I've built a version with your changes, and it all looks good. I've added my name to the list of reviewers.",
    "created_at": "2017-03-16T01:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294347",
    "user": "https://github.com/mkoeppe"
}
```

Jeroen, I've built a version with your changes, and it all looks good. I've added my name to the list of reviewers.



---

archive/issue_comments_294348.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-26T14:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294348",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294349.json:
```json
{
    "body": "Doesnt work if autotools aren't installed:\n\n```\nmake -j2 -k start\n in dir /home/buildbot/slave/sage_git/build (timeout 86400 secs)\n watching logfiles {'symmetrica': 'logs/buildbot/symmetrica.log', 'sage': 'logs/buildbot/sage.log', 'gd': 'logs/buildbot/gd.log', 'networkx': 'logs/buildbot/networkx.log', 'libgap': 'logs/buildbot/libgap.log', 'csage': 'logs/buildbot/csage.log', 'cython': 'logs/buildbot/cython.log', 'iconv': 'logs/buildbot/iconv.log', 'iml': 'logs/buildbot/iml.log', 'flintqs': 'logs/buildbot/flintqs.log', 'sympy': 'logs/buildbot/sympy.log', 'freetype': 'logs/buildbot/freetype.log', 'mpc': 'logs/buildbot/mpc.log', 'g2red': 'logs/buildbot/genus2reduction.log', 'scipy': 'logs/buildbot/scipy.log', 'flint': 'logs/buildbot/flint.log', 'polytopes': 'logs/buildbot/polytopes_db.log', 'givaro': 'logs/buildbot/givaro.log', 'python3': 'logs/buildbot/python3.log', 'python2': 'logs/buildbot/python2.log', 'patch': 'logs/buildbot/patch.log', 'mpmath': 'logs/buildbot/mpmath.log', 'cephes': 'logs/buildbot/cephes.log', 'pynac': 'logs/buildbot/pynac.log', 'pkgconf': 'logs/buildbot/pkgconf.log', 'sagenb': 'logs/buildbot/sagenb.log', 'palp': 'logs/buildbot/palp.log', 'seadata': 'logs/buildbot/pari_seadata_small.log', 'sympow': 'logs/buildbot/sympow.log', 'docutils': 'logs/buildbot/docutils.log', 'ell_curves': 'logs/buildbot/elliptic_curves.log', 'eclib': 'logs/buildbot/eclib.log', 'libpng': 'logs/buildbot/libpng.log', 'boost': 'logs/buildbot/boost_cropped.log', 'cliquer': 'logs/buildbot/cliquer.log', 'ecm': 'logs/buildbot/ecm.log', 'ecl': 'logs/buildbot/ecl.log', 'cvxopt': 'logs/buildbot/cvxopt.log', 'matplotlib': 'logs/buildbot/matplotlib.log', 'galdata': 'logs/buildbot/pari_galdata.log', 'ntl': 'logs/buildbot/ntl.log', 'lcalc': 'logs/buildbot/lcalc.log', 'ipython': 'logs/buildbot/ipython.log', 'sagetex': 'logs/buildbot/sagetex.log', 'libfplll': 'logs/buildbot/libfplll.log', 'pillow': 'logs/buildbot/pillow.log', 'conway': 'logs/buildbot/conway_polynomials.log', 'polybori': 'logs/buildbot/polybori.log', 'tachyon': 'logs/buildbot/tachyon.log', 'ppl': 'logs/buildbot/ppl.log', 'linbox': 'logs/buildbot/linbox.log', 'pygments': 'logs/buildbot/pygments.log', 'm4rie': 'logs/buildbot/m4rie.log', 'git': 'logs/buildbot/git.log', 'pexpect': 'logs/buildbot/pexpect.log', 'r-project': 'logs/buildbot/r.log', 'm4ri': 'logs/buildbot/m4ri.log', 'pkgconfig': 'logs/buildbot/pkgconfig.log', 'cddlib': 'logs/buildbot/cddlib.log', 'zeromq': 'logs/buildbot/zeromq.log', 'numpy': 'logs/buildbot/numpy.log', 'pyzmq': 'logs/buildbot/pyzmq.log', 'sqlalchemy': 'logs/buildbot/sqlalchemy.log', 'ncurses': 'logs/buildbot/ncurses.log', 'gdmodule': 'logs/buildbot/gdmodule.log', 'pari': 'logs/buildbot/pari.log', 'gap': 'logs/buildbot/gap.log', 'mpfi': 'logs/buildbot/mpfi.log', 'gf2x': 'logs/buildbot/gf2x.log', 'zlib': 'logs/buildbot/zlib.log', 'setuptools': 'logs/buildbot/setuptools.log', 'sqlite': 'logs/buildbot/sqlite.log', 'mpir': 'logs/buildbot/mpir.log', 'bzip2': 'logs/buildbot/bzip2.log', 'six': 'logs/buildbot/six.log', 'rubiks': 'logs/buildbot/rubiks.log', 'scons': 'logs/buildbot/scons.log', 'openblas': 'logs/buildbot/openblas.log', 'zn_poly': 'logs/buildbot/zn_poly.log', 'singular': 'logs/buildbot/singular.log', 'tornado': 'logs/buildbot/tornado.log', 'boehm_gc': 'logs/buildbot/boehm_gc.log', 'gfan': 'logs/buildbot/gfan.log', 'gcc': 'logs/buildbot/gcc.log', 'readline': 'logs/buildbot/readline.log', 'glpk': 'logs/buildbot/glpk.log', 'ratpoints': 'logs/buildbot/ratpoints.log', 'sphinx': 'logs/buildbot/sphinx.log', 'pycrypto': 'logs/buildbot/pycrypto.log', 'jmol': 'logs/buildbot/jmol.log', 'graphs': 'logs/buildbot/graphs.log', 'jinja2': 'logs/buildbot/jinja2.log', 'mpfr': 'logs/buildbot/mpfr.log', 'gsl': 'logs/buildbot/gsl.log', 'maxima': 'logs/buildbot/maxima.log'}\n argv: ['make', '-j2', '-k', 'start']\n environment:\n  DOT_SAGE=/home/buildbot/slave/sage_git/dot_sage\n  HOME=/var/lib/buildbot\n  LANG=en_US.UTF-8\n  LOGNAME=buildbot\n  MAIL=/var/mail/buildbot\n  MAKE=make -j2\n  PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\n  PWD=/home/buildbot/slave/sage_git/build\n  SAGE_CRASH_LOGS=/home/buildbot/slave/sage_git/crashlogs\n  SAGE_PARALLEL_SPKG_BUILD=yes\n  SAGE_SERVER=http://sagepad.org/\n  SHELL=/bin/sh\n  USER=buildbot\n using PTY: False\nmake -j2 build/make/Makefile\nmake[1]: Entering directory `/home/buildbot/slave/sage_git/build'\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\n./bootstrap -d\nmake[2]: Entering directory `/home/buildbot/slave/sage_git/build'\nrm -rf config configure build/make/Makefile-auto.in\nmake[2]: Leaving directory `/home/buildbot/slave/sage_git/build'\n./bootstrap: line 30: aclocal: command not found\nBootstrap failed, downloading required files instead.\n./bootstrap: line 59: sage-download-file: command not found\nError: downloading configure-212.tar.gz failed\nmake[1]: *** [configure] Error 1\nmake[1]: Target `build/make/Makefile' not remade because of errors.\nmake[1]: Leaving directory `/home/buildbot/slave/sage_git/build'\nmake: *** [start] Error 2\nprogram finished with exit code 2\n```",
    "created_at": "2017-03-26T14:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294349",
    "user": "https://github.com/vbraun"
}
```

Doesnt work if autotools aren't installed:

```
make -j2 -k start
 in dir /home/buildbot/slave/sage_git/build (timeout 86400 secs)
 watching logfiles {'symmetrica': 'logs/buildbot/symmetrica.log', 'sage': 'logs/buildbot/sage.log', 'gd': 'logs/buildbot/gd.log', 'networkx': 'logs/buildbot/networkx.log', 'libgap': 'logs/buildbot/libgap.log', 'csage': 'logs/buildbot/csage.log', 'cython': 'logs/buildbot/cython.log', 'iconv': 'logs/buildbot/iconv.log', 'iml': 'logs/buildbot/iml.log', 'flintqs': 'logs/buildbot/flintqs.log', 'sympy': 'logs/buildbot/sympy.log', 'freetype': 'logs/buildbot/freetype.log', 'mpc': 'logs/buildbot/mpc.log', 'g2red': 'logs/buildbot/genus2reduction.log', 'scipy': 'logs/buildbot/scipy.log', 'flint': 'logs/buildbot/flint.log', 'polytopes': 'logs/buildbot/polytopes_db.log', 'givaro': 'logs/buildbot/givaro.log', 'python3': 'logs/buildbot/python3.log', 'python2': 'logs/buildbot/python2.log', 'patch': 'logs/buildbot/patch.log', 'mpmath': 'logs/buildbot/mpmath.log', 'cephes': 'logs/buildbot/cephes.log', 'pynac': 'logs/buildbot/pynac.log', 'pkgconf': 'logs/buildbot/pkgconf.log', 'sagenb': 'logs/buildbot/sagenb.log', 'palp': 'logs/buildbot/palp.log', 'seadata': 'logs/buildbot/pari_seadata_small.log', 'sympow': 'logs/buildbot/sympow.log', 'docutils': 'logs/buildbot/docutils.log', 'ell_curves': 'logs/buildbot/elliptic_curves.log', 'eclib': 'logs/buildbot/eclib.log', 'libpng': 'logs/buildbot/libpng.log', 'boost': 'logs/buildbot/boost_cropped.log', 'cliquer': 'logs/buildbot/cliquer.log', 'ecm': 'logs/buildbot/ecm.log', 'ecl': 'logs/buildbot/ecl.log', 'cvxopt': 'logs/buildbot/cvxopt.log', 'matplotlib': 'logs/buildbot/matplotlib.log', 'galdata': 'logs/buildbot/pari_galdata.log', 'ntl': 'logs/buildbot/ntl.log', 'lcalc': 'logs/buildbot/lcalc.log', 'ipython': 'logs/buildbot/ipython.log', 'sagetex': 'logs/buildbot/sagetex.log', 'libfplll': 'logs/buildbot/libfplll.log', 'pillow': 'logs/buildbot/pillow.log', 'conway': 'logs/buildbot/conway_polynomials.log', 'polybori': 'logs/buildbot/polybori.log', 'tachyon': 'logs/buildbot/tachyon.log', 'ppl': 'logs/buildbot/ppl.log', 'linbox': 'logs/buildbot/linbox.log', 'pygments': 'logs/buildbot/pygments.log', 'm4rie': 'logs/buildbot/m4rie.log', 'git': 'logs/buildbot/git.log', 'pexpect': 'logs/buildbot/pexpect.log', 'r-project': 'logs/buildbot/r.log', 'm4ri': 'logs/buildbot/m4ri.log', 'pkgconfig': 'logs/buildbot/pkgconfig.log', 'cddlib': 'logs/buildbot/cddlib.log', 'zeromq': 'logs/buildbot/zeromq.log', 'numpy': 'logs/buildbot/numpy.log', 'pyzmq': 'logs/buildbot/pyzmq.log', 'sqlalchemy': 'logs/buildbot/sqlalchemy.log', 'ncurses': 'logs/buildbot/ncurses.log', 'gdmodule': 'logs/buildbot/gdmodule.log', 'pari': 'logs/buildbot/pari.log', 'gap': 'logs/buildbot/gap.log', 'mpfi': 'logs/buildbot/mpfi.log', 'gf2x': 'logs/buildbot/gf2x.log', 'zlib': 'logs/buildbot/zlib.log', 'setuptools': 'logs/buildbot/setuptools.log', 'sqlite': 'logs/buildbot/sqlite.log', 'mpir': 'logs/buildbot/mpir.log', 'bzip2': 'logs/buildbot/bzip2.log', 'six': 'logs/buildbot/six.log', 'rubiks': 'logs/buildbot/rubiks.log', 'scons': 'logs/buildbot/scons.log', 'openblas': 'logs/buildbot/openblas.log', 'zn_poly': 'logs/buildbot/zn_poly.log', 'singular': 'logs/buildbot/singular.log', 'tornado': 'logs/buildbot/tornado.log', 'boehm_gc': 'logs/buildbot/boehm_gc.log', 'gfan': 'logs/buildbot/gfan.log', 'gcc': 'logs/buildbot/gcc.log', 'readline': 'logs/buildbot/readline.log', 'glpk': 'logs/buildbot/glpk.log', 'ratpoints': 'logs/buildbot/ratpoints.log', 'sphinx': 'logs/buildbot/sphinx.log', 'pycrypto': 'logs/buildbot/pycrypto.log', 'jmol': 'logs/buildbot/jmol.log', 'graphs': 'logs/buildbot/graphs.log', 'jinja2': 'logs/buildbot/jinja2.log', 'mpfr': 'logs/buildbot/mpfr.log', 'gsl': 'logs/buildbot/gsl.log', 'maxima': 'logs/buildbot/maxima.log'}
 argv: ['make', '-j2', '-k', 'start']
 environment:
  DOT_SAGE=/home/buildbot/slave/sage_git/dot_sage
  HOME=/var/lib/buildbot
  LANG=en_US.UTF-8
  LOGNAME=buildbot
  MAIL=/var/mail/buildbot
  MAKE=make -j2
  PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
  PWD=/home/buildbot/slave/sage_git/build
  SAGE_CRASH_LOGS=/home/buildbot/slave/sage_git/crashlogs
  SAGE_PARALLEL_SPKG_BUILD=yes
  SAGE_SERVER=http://sagepad.org/
  SHELL=/bin/sh
  USER=buildbot
 using PTY: False
make -j2 build/make/Makefile
make[1]: Entering directory `/home/buildbot/slave/sage_git/build'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
./bootstrap -d
make[2]: Entering directory `/home/buildbot/slave/sage_git/build'
rm -rf config configure build/make/Makefile-auto.in
make[2]: Leaving directory `/home/buildbot/slave/sage_git/build'
./bootstrap: line 30: aclocal: command not found
Bootstrap failed, downloading required files instead.
./bootstrap: line 59: sage-download-file: command not found
Error: downloading configure-212.tar.gz failed
make[1]: *** [configure] Error 1
make[1]: Target `build/make/Makefile' not remade because of errors.
make[1]: Leaving directory `/home/buildbot/slave/sage_git/build'
make: *** [start] Error 2
program finished with exit code 2
```



---

archive/issue_comments_294350.json:
```json
{
    "body": "Jeroen, since you did not like my solution to this problem in https://git.sagemath.org/sage.git/commit?id=acd688dd6e42f932f0c100cf8acac28e35e3c029, would you like to fix it?",
    "created_at": "2017-03-26T17:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294350",
    "user": "https://github.com/mkoeppe"
}
```

Jeroen, since you did not like my solution to this problem in https://git.sagemath.org/sage.git/commit?id=acd688dd6e42f932f0c100cf8acac28e35e3c029, would you like to fix it?



---

archive/issue_comments_294351.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-03-27T07:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_294352.json:
```json
{
    "body": "Rebased to 7.6, nothing changed yet.",
    "created_at": "2017-03-27T07:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294352",
    "user": "https://github.com/jdemeyer"
}
```

Rebased to 7.6, nothing changed yet.



---

archive/issue_comments_294353.json:
```json
{
    "body": "Replying to [comment:111 mkoeppe]:\n> Jeroen, since you did not like my solution to this problem in https://git.sagemath.org/sage.git/commit?id=acd688dd6e42f932f0c100cf8acac28e35e3c029, would you like to fix it?\n\n\nThe problem is that this comment is wrong:\n\n```\n    # Try to get autotools from our own package into PATH (Trac #21214)\n    # This will fail for initial bootstrap, when sage-env-config has\n    # not been created yet.\n```\nIt's not just about autotools, it's also about getting `sage-download-file` in the `$PATH`.",
    "created_at": "2017-03-27T07:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294353",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:111 mkoeppe]:
> Jeroen, since you did not like my solution to this problem in https://git.sagemath.org/sage.git/commit?id=acd688dd6e42f932f0c100cf8acac28e35e3c029, would you like to fix it?


The problem is that this comment is wrong:

```
    # Try to get autotools from our own package into PATH (Trac #21214)
    # This will fail for initial bootstrap, when sage-env-config has
    # not been created yet.
```
It's not just about autotools, it's also about getting `sage-download-file` in the `$PATH`.



---

archive/issue_comments_294354.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-27T07:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294355.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-27T07:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294355",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294356.json:
```json
{
    "body": "This should work...",
    "created_at": "2017-03-27T07:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294356",
    "user": "https://github.com/jdemeyer"
}
```

This should work...



---

archive/issue_comments_294357.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-28T02:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294357",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_294358.json:
```json
{
    "body": "```\nconfig.status: creating directory /Users/buildslave-sage/slave/sage_git/build/local/share\nconfig.status: creating directory /Users/buildslave-sage/slave/sage_git/build/local/var/lib/sage/installed\nbuild/bin/sage-logger \\\n\t\t\"cd build/make && ./install 'start'\" logs/install.log\n./install: line 12: /Users/buildslave-sage/slave/sage_git/build/src/bin/sage-env-config: No such file or directory\nError: Failed to read sage-env-config.  Did you run configure?\n```",
    "created_at": "2017-03-29T21:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294358",
    "user": "https://github.com/vbraun"
}
```

```
config.status: creating directory /Users/buildslave-sage/slave/sage_git/build/local/share
config.status: creating directory /Users/buildslave-sage/slave/sage_git/build/local/var/lib/sage/installed
build/bin/sage-logger \
		"cd build/make && ./install 'start'" logs/install.log
./install: line 12: /Users/buildslave-sage/slave/sage_git/build/src/bin/sage-env-config: No such file or directory
Error: Failed to read sage-env-config.  Did you run configure?
```



---

archive/issue_comments_294359.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-29T21:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294359",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294360.json:
```json
{
    "body": "No, this error disappears if you run `autoreconf` - and regenerate the configure package for the release using your scripts.",
    "created_at": "2017-03-30T00:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294360",
    "user": "https://github.com/mkoeppe"
}
```

No, this error disappears if you run `autoreconf` - and regenerate the configure package for the release using your scripts.



---

archive/issue_comments_294361.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-03-30T00:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294361",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_294362.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-30T10:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294362",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294363.json:
```json
{
    "body": "Replying to [comment:119 mkoeppe]:\n> regenerate the configure package for the release using your scripts.\n\n\nIf only the release manager would do this when testing a ticket...",
    "created_at": "2017-03-30T10:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294363",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:119 mkoeppe]:
> regenerate the configure package for the release using your scripts.


If only the release manager would do this when testing a ticket...



---

archive/issue_comments_294364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-30T10:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294365.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-03-30T10:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294365",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_294366.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-30T22:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294366",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294367.json:
```json
{
    "body": "merge failure",
    "created_at": "2017-03-30T22:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294367",
    "user": "https://github.com/vbraun"
}
```

merge failure



---

archive/issue_comments_294368.json:
```json
{
    "body": "... with the configure tarball version",
    "created_at": "2017-03-31T04:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294368",
    "user": "https://github.com/mkoeppe"
}
```

... with the configure tarball version



---

archive/issue_comments_294369.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-03-31T08:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_294370.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-03-31T08:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294370",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_294371.json:
```json
{
    "body": "Hopefully this is the final thing needed for this ticket...",
    "created_at": "2017-03-31T08:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294371",
    "user": "https://github.com/jdemeyer"
}
```

Hopefully this is the final thing needed for this ticket...



---

archive/issue_events_057044.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-03T20:59:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21242#event-57044"
}
```



---

archive/issue_comments_294372.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-03T20:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294372",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_294373.json:
```json
{
    "body": "As a consequence of this ticket, with a fresh tarball or after running `make distclean`, `./sage -i PKG` fails, as does `./sage --sh`. The error message says\n\n```\nError: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this\nError setting environment variables by sourcing '/Users/palmieri/Desktop/TEMP/sage-8.0.beta1/src/bin/sage-env';\npossibly contact sage-devel (see http://groups.google.com/group/sage-devel).\n```\nShould these commands work out of the box? Running `./configure` fixes this, I think, so should the error message be changed, at least?",
    "created_at": "2017-04-13T18:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294373",
    "user": "https://github.com/jhpalmieri"
}
```

As a consequence of this ticket, with a fresh tarball or after running `make distclean`, `./sage -i PKG` fails, as does `./sage --sh`. The error message says

```
Error: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this
Error setting environment variables by sourcing '/Users/palmieri/Desktop/TEMP/sage-8.0.beta1/src/bin/sage-env';
possibly contact sage-devel (see http://groups.google.com/group/sage-devel).
```
Should these commands work out of the box? Running `./configure` fixes this, I think, so should the error message be changed, at least?



---

archive/issue_comments_294374.json:
```json
{
    "body": "I think its reasonable to ask that one runs at least configure once before trying to launch any scripts in the source tarball. So +1 for changing the error message...",
    "created_at": "2017-04-13T20:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21242#issuecomment-294374",
    "user": "https://github.com/vbraun"
}
```

I think its reasonable to ask that one runs at least configure once before trying to launch any scripts in the source tarball. So +1 for changing the error message...
