# Issue 21805: Use psutil instead of various hacks

archive/issues_021568.json:
```json
{
    "body": "The following modules can mostly replaced by simple calls to `psutil`:\n\n* `sage.misc.getusage`\n* `sage.misc.memory_info`\n* `sage.misc.darwin_utilities`\n\nAll usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21805\n\n",
    "closed_at": "2016-12-01T22:32:44Z",
    "created_at": "2016-11-03T14:10:11Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Use psutil instead of various hacks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21805",
    "user": "https://github.com/jdemeyer"
}
```
The following modules can mostly replaced by simple calls to `psutil`:

* `sage.misc.getusage`
* `sage.misc.memory_info`
* `sage.misc.darwin_utilities`

All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.

Issue created by migration from https://trac.sagemath.org/ticket/21805





---

archive/issue_comments_299058.json:
```json
{
    "body": "Changing component from interfaces to misc.",
    "created_at": "2016-11-14T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299058",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from interfaces to misc.



---

archive/issue_comments_299059.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299059",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_299060.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299060",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_299061.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299061",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_299062.json:
```json
{
    "body": "Looks goot to me.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299062",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Looks goot to me.



---

archive/issue_comments_299063.json:
```json
{
    "body": "on OSX:\n\n``` \n30617Traceback (most recent call last):\n30618  File \"/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval\", line 4, in <module>\n30619    from sage.all import *\n30620  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py\", line 92, in <module>\n30621    from sage.misc.all       import *         # takes a while\n30622  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py\", line 89, in <module>\n30623    from .functional import (additive_order,\n30624  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 32, in <module>\n30625    from sage.rings.complex_double import CDF\n30626  File \"sage/rings/integer.pxd\", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)\n30627  File \"sage/rings/rational.pxd\", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)\n30628  File \"sage/rings/fast_arith.pxd\", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)\n30629  File \"sage/libs/cypari2/gen.pxd\", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)\n30630  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py\", line 1, in <module>\n30631    from .pari_instance import pari\n30632  File \"sage/libs/cypari2/pari_instance.pyx\", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)\n30633  File \"sage/libs/cypari2/pari_instance.pyx\", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)\n30634  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py\", line 74, in virtual_memory_limit\n30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]\n30636AttributeError: 'Process' object has no attribute 'rlimit'\n30637Sage failed to start up.\n30638Please email sage-devel (http://groups.google.com/group/sage-devel)\n30639explaining the problem and send the log file\n30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log\n30641Describe your computer, operating system, etc.\n30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1\n30643make[1]: *** [start] Error 2\n```",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299063",
    "user": "https://github.com/vbraun"
}
```

on OSX:

``` 
30617Traceback (most recent call last):
30618  File "/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval", line 4, in <module>
30619    from sage.all import *
30620  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py", line 92, in <module>
30621    from sage.misc.all       import *         # takes a while
30622  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py", line 89, in <module>
30623    from .functional import (additive_order,
30624  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py", line 32, in <module>
30625    from sage.rings.complex_double import CDF
30626  File "sage/rings/integer.pxd", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)
30627  File "sage/rings/rational.pxd", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)
30628  File "sage/rings/fast_arith.pxd", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)
30629  File "sage/libs/cypari2/gen.pxd", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)
30630  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py", line 1, in <module>
30631    from .pari_instance import pari
30632  File "sage/libs/cypari2/pari_instance.pyx", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)
30633  File "sage/libs/cypari2/pari_instance.pyx", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)
30634  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py", line 74, in virtual_memory_limit
30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]
30636AttributeError: 'Process' object has no attribute 'rlimit'
30637Sage failed to start up.
30638Please email sage-devel (http://groups.google.com/group/sage-devel)
30639explaining the problem and send the log file
30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log
30641Describe your computer, operating system, etc.
30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1
30643make[1]: *** [start] Error 2
```



---

archive/issue_comments_299064.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299064",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_299065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-30T18:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_299066.json:
```json
{
    "body": "I reverted this to using `resource.getrlimit` instead of `psutil`.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299066",
    "user": "https://github.com/jdemeyer"
}
```

I reverted this to using `resource.getrlimit` instead of `psutil`.



---

archive/issue_comments_299067.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299067",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_299068.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299068",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-01T22:32:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21805#event-57652"
}
```



---

archive/issue_comments_299069.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-01T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-299069",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
