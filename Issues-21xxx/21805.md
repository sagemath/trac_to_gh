# Issue 21805: Use psutil instead of various hacks

archive/issues_021568.json:
```json
{
    "body": "The following modules can mostly replaced by simple calls to `psutil`:\n\n* `sage.misc.getusage`\n* `sage.misc.memory_info`\n* `sage.misc.darwin_utilities`\n\nAll usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.\n\nBranch/Commit: 9f629df4f3057f9b784959eb5d5e9e5b1fee3c93\n\nReviewer: Jean-Pierre Flori\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21805\n\n",
    "closed_at": "2016-12-01T22:32:44Z",
    "created_at": "2016-11-03T14:10:11Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Use psutil instead of various hacks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21805",
    "user": "https://github.com/jdemeyer"
}
```
The following modules can mostly replaced by simple calls to `psutil`:

* `sage.misc.getusage`
* `sage.misc.memory_info`
* `sage.misc.darwin_utilities`

All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.

Branch/Commit: 9f629df4f3057f9b784959eb5d5e9e5b1fee3c93

Reviewer: Jean-Pierre Flori

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21805





---

archive/issue_comments_318615.json:
```json
{
    "body": "Changing component from interfaces to misc.",
    "created_at": "2016-11-14T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318615",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from interfaces to misc.



---

archive/issue_comments_318616.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Replace uses of `sage.misc.memory_info` by the `psutil` package.\n+Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-11-14T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318616",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Replace uses of `sage.misc.memory_info` by the `psutil` package.
+Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.
 
 Comment: 1
 
```




---

archive/issue_comments_318617.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The following modules can mostly replaced by simple calls to `psutil`:\n \n+* `sage.misc.getusage`\n+* `sage.misc.memory_info`\n+* `sage.misc.darwin_utilities`\n+\n+All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-11-14T15:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318617",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The following modules can mostly replaced by simple calls to `psutil`:
 
+* `sage.misc.getusage`
+* `sage.misc.memory_info`
+* `sage.misc.darwin_utilities`
+
+All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.
 
 Comment: 1
 
```




---

archive/issue_comments_318618.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318618",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_318619.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318619",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318620.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318620",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318621.json:
```json
{
    "body": "<a id='comment:5'></a>Looks goot to me.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318621",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Looks goot to me.



---

archive/issue_comments_318622.json:
```json
{
    "body": "<a id='comment:6'></a>on OSX:\n\n``` \n30617Traceback (most recent call last):\n30618  File \"/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval\", line 4, in <module>\n30619    from sage.all import *\n30620  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py\", line 92, in <module>\n30621    from sage.misc.all       import *         # takes a while\n30622  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py\", line 89, in <module>\n30623    from .functional import (additive_order,\n30624  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 32, in <module>\n30625    from sage.rings.complex_double import CDF\n30626  File \"sage/rings/integer.pxd\", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)\n30627  File \"sage/rings/rational.pxd\", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)\n30628  File \"sage/rings/fast_arith.pxd\", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)\n30629  File \"sage/libs/cypari2/gen.pxd\", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)\n30630  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py\", line 1, in <module>\n30631    from .pari_instance import pari\n30632  File \"sage/libs/cypari2/pari_instance.pyx\", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)\n30633  File \"sage/libs/cypari2/pari_instance.pyx\", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)\n30634  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py\", line 74, in virtual_memory_limit\n30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]\n30636AttributeError: 'Process' object has no attribute 'rlimit'\n30637Sage failed to start up.\n30638Please email sage-devel (http://groups.google.com/group/sage-devel)\n30639explaining the problem and send the log file\n30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log\n30641Describe your computer, operating system, etc.\n30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1\n30643make[1]: *** [start] Error 2\n```",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318622",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>on OSX:

``` 
30617Traceback (most recent call last):
30618  File "/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval", line 4, in <module>
30619    from sage.all import *
30620  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py", line 92, in <module>
30621    from sage.misc.all       import *         # takes a while
30622  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py", line 89, in <module>
30623    from .functional import (additive_order,
30624  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py", line 32, in <module>
30625    from sage.rings.complex_double import CDF
30626  File "sage/rings/integer.pxd", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)
30627  File "sage/rings/rational.pxd", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)
30628  File "sage/rings/fast_arith.pxd", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)
30629  File "sage/libs/cypari2/gen.pxd", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)
30630  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py", line 1, in <module>
30631    from .pari_instance import pari
30632  File "sage/libs/cypari2/pari_instance.pyx", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)
30633  File "sage/libs/cypari2/pari_instance.pyx", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)
30634  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py", line 74, in virtual_memory_limit
30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]
30636AttributeError: 'Process' object has no attribute 'rlimit'
30637Sage failed to start up.
30638Please email sage-devel (http://groups.google.com/group/sage-devel)
30639explaining the problem and send the log file
30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log
30641Describe your computer, operating system, etc.
30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1
30643make[1]: *** [start] Error 2
```



---

archive/issue_comments_318623.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318623",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318624.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-30T18:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318624",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318625.json:
```json
{
    "body": "<a id='comment:8'></a>I reverted this to using `resource.getrlimit` instead of `psutil`.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318625",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I reverted this to using `resource.getrlimit` instead of `psutil`.



---

archive/issue_comments_318626.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318626",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318627.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-30T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318627",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-01T22:32:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21805#event-57652"
}
```



---

archive/issue_comments_318628.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-01T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-318628",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
