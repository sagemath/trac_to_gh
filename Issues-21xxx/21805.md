# Issue 21805: Use psutil instead of various hacks

archive/issues_021568.json:
```json
{
    "body": "The following modules can mostly replaced by simple calls to `psutil`:\n\n* `sage.misc.getusage`\n* `sage.misc.memory_info`\n* `sage.misc.darwin_utilities`\n\nAll usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.\n\n**Branch/Commit:** [9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)\n\n**Reviewer:** Jean-Pierre Flori\n\n**Author:** Jeroen Demeyer\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21805\n\n",
    "closed_at": "2016-12-01T22:32:44Z",
    "created_at": "2016-11-03T14:10:11Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Use psutil instead of various hacks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21805",
    "user": "https://github.com/jdemeyer"
}
```
The following modules can mostly replaced by simple calls to `psutil`:

* `sage.misc.getusage`
* `sage.misc.memory_info`
* `sage.misc.darwin_utilities`

All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.

**Branch/Commit:** [9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)

**Reviewer:** Jean-Pierre Flori

**Author:** Jeroen Demeyer

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/21805





---

archive/issue_comments_405358.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Replace uses of `sage.misc.memory_info` by the `psutil` package.\n+Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.\n``````\n",
    "created_at": "2016-11-14T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405358",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Replace uses of `sage.misc.memory_info` by the `psutil` package.
+Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.
``````




---

archive/issue_comments_405359.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n-Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.\n+The following modules can mostly replaced by simple calls to `psutil`:\n+\n+* `sage.misc.getusage`\n+* `sage.misc.memory_info`\n+* `sage.misc.darwin_utilities`\n+\n+All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.\n``````\n",
    "created_at": "2016-11-14T15:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405359",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,7 @@
-Replace uses of `sage.misc.memory_info` and `sage.misc.darwin_utilities` by the `psutil` package.
+The following modules can mostly replaced by simple calls to `psutil`:
+
+* `sage.misc.getusage`
+* `sage.misc.memory_info`
+* `sage.misc.darwin_utilities`
+
+All usage of these modules is replaced by some simple wrappers around `psutil`. These wrappers are implemented in `sage.misc.getusage`.
``````




---

archive/issue_events_065568.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "rename": {
        "from": "Use psutil instead of sage.misc.memory_info",
        "to": "Use psutil instead of various hacks"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21805#event-65568"
}
```



---

archive/issue_comments_405360.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info)",
    "created_at": "2016-11-16T15:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405360",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info)



---

archive/issue_comments_405361.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405361",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_405362.json:
```json
{
    "body": "**Commit:** [46832bc1f68346268a93f5ff249dd0fdde4dc387](https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387)",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405362",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [46832bc1f68346268a93f5ff249dd0fdde4dc387](https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387)



---

archive/issue_comments_405363.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387\">46832bc</a></td><td><code>Use psutil instead of various hacks</code></td></tr></table>\n",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405363",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387">46832bc</a></td><td><code>Use psutil instead of various hacks</code></td></tr></table>




---

archive/issue_comments_405364.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-11-16T15:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405364",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_405365.json:
```json
{
    "body": "**Reviewer:** Jean-Pierre Flori",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405365",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Reviewer:** Jean-Pierre Flori



---

archive/issue_comments_405366.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405366",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_405367.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks goot to me.",
    "created_at": "2016-11-17T15:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405367",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
Looks goot to me.



---

archive/issue_comments_405368.json:
```json
{
    "body": "<a id='comment:6'></a>\non OSX:\n\n``` \n30617Traceback (most recent call last):\n30618  File \"/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval\", line 4, in <module>\n30619    from sage.all import *\n30620  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py\", line 92, in <module>\n30621    from sage.misc.all       import *         # takes a while\n30622  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py\", line 89, in <module>\n30623    from .functional import (additive_order,\n30624  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 32, in <module>\n30625    from sage.rings.complex_double import CDF\n30626  File \"sage/rings/integer.pxd\", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)\n30627  File \"sage/rings/rational.pxd\", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)\n30628  File \"sage/rings/fast_arith.pxd\", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)\n30629  File \"sage/libs/cypari2/gen.pxd\", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)\n30630  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py\", line 1, in <module>\n30631    from .pari_instance import pari\n30632  File \"sage/libs/cypari2/pari_instance.pyx\", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)\n30633  File \"sage/libs/cypari2/pari_instance.pyx\", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)\n30634  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py\", line 74, in virtual_memory_limit\n30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]\n30636AttributeError: 'Process' object has no attribute 'rlimit'\n30637Sage failed to start up.\n30638Please email sage-devel (http://groups.google.com/group/sage-devel)\n30639explaining the problem and send the log file\n30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log\n30641Describe your computer, operating system, etc.\n30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1\n30643make[1]: *** [start] Error 2\n```",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405368",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
on OSX:

``` 
30617Traceback (most recent call last):
30618  File "/Users/buildslave-sage/slave/sage_git/build/src/bin/sage-eval", line 4, in <module>
30619    from sage.all import *
30620  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/all.py", line 92, in <module>
30621    from sage.misc.all       import *         # takes a while
30622  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/all.py", line 89, in <module>
30623    from .functional import (additive_order,
30624  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/functional.py", line 32, in <module>
30625    from sage.rings.complex_double import CDF
30626  File "sage/rings/integer.pxd", line 7, in init sage.rings.complex_double (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/complex_double.c:23953)
30627  File "sage/rings/rational.pxd", line 8, in init sage.rings.integer (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:50744)
30628  File "sage/rings/fast_arith.pxd", line 3, in init sage.rings.rational (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/rational.c:38499)
30629  File "sage/libs/cypari2/gen.pxd", line 5, in init sage.rings.fast_arith (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/fast_arith.c:8557)
30630  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/__init__.py", line 1, in <module>
30631    from .pari_instance import pari
30632  File "sage/libs/cypari2/pari_instance.pyx", line 453, in init sage.libs.cypari2.pari_instance (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:17929)
30633  File "sage/libs/cypari2/pari_instance.pyx", line 517, in sage.libs.cypari2.pari_instance.PariInstance.__init__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/libs/cypari2/pari_instance.c:11439)
30634  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/getusage.py", line 74, in virtual_memory_limit
30635    vmax = psutil.Process().rlimit(psutil.RLIMIT_AS)[0]
30636AttributeError: 'Process' object has no attribute 'rlimit'
30637Sage failed to start up.
30638Please email sage-devel (http://groups.google.com/group/sage-devel)
30639explaining the problem and send the log file
30640  /Users/buildslave-sage/slave/sage_git/build/logs/start.log
30641Describe your computer, operating system, etc.
30642make[2]: *** [/Users/buildslave-sage/slave/sage_git/build/local/etc/sage-started.txt] Error 1
30643make[1]: *** [start] Error 2
```



---

archive/issue_comments_405369.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-11-17T23:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405369",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_405370.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffb12726cb3b009f0a32d19a666fd7693d36588\">3ffb127</a></td><td><code>Use psutil instead of various hacks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93\">9f629df</a></td><td><code>Use resource instead of psutil to determine RLIMIT_AS</code></td></tr></table>\n",
    "created_at": "2016-11-30T18:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffb12726cb3b009f0a32d19a666fd7693d36588">3ffb127</a></td><td><code>Use psutil instead of various hacks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93">9f629df</a></td><td><code>Use resource instead of psutil to determine RLIMIT_AS</code></td></tr></table>




---

archive/issue_comments_405371.json:
```json
{
    "body": "**Changing commit** from \"[46832bc1f68346268a93f5ff249dd0fdde4dc387](https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387)\" to \"[9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)\".",
    "created_at": "2016-11-30T18:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[46832bc1f68346268a93f5ff249dd0fdde4dc387](https://github.com/sagemath/sagetrac-mirror/commit/46832bc1f68346268a93f5ff249dd0fdde4dc387)" to "[9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)".



---

archive/issue_comments_405372.json:
```json
{
    "body": "<a id='comment:8'></a>\nI reverted this to using `resource.getrlimit` instead of `psutil`.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405372",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
I reverted this to using `resource.getrlimit` instead of `psutil`.



---

archive/issue_comments_405373.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-30T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405373",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_405374.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-11-30T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405374",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_065569.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-01T22:32:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21805#event-65569"
}
```



---

archive/issue_comments_405375.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info)\" to \"[9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)\".",
    "created_at": "2016-12-01T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405375",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_psutil_instead_of_sage_misc_memory_info)" to "[9f629df4f3057f9b784959eb5d5e9e5b1fee3c93](https://github.com/sagemath/sagetrac-mirror/commit/9f629df4f3057f9b784959eb5d5e9e5b1fee3c93)".



---

archive/issue_comments_405376.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-12-01T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21805#issuecomment-405376",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
