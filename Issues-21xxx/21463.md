# Issue 21463: Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)

archive/issues_021463.json:
```json
{
    "body": "CC:  @tscrim @dimpase @videlec @jhpalmieri @slel\n\nVarious packages can be built with or without the presence of some other packages.\n\nFor example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)\n\nGNU make's \"order-only dependencies\" \"sound\" as if they can do this, but as Jeroen explains, they can't.\n\nOf course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. \n\n\nThis feature can be implemented by Makefile trickery, of course. See #30560.\n\n\nTickets:\n\n- #30560: `openssl` an optional dependency of `python3`\n\n- `giac` detects `cocoa` (which we have added as an experimental package)\n\n- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)\n\n- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency\n\n- `polymake` has lots of optional dependencies\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21700\n\n",
    "created_at": "2016-10-13T17:01:39Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21463",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim @dimpase @videlec @jhpalmieri @slel

Various packages can be built with or without the presence of some other packages.

For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)

GNU make's "order-only dependencies" "sound" as if they can do this, but as Jeroen explains, they can't.

Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. 


This feature can be implemented by Makefile trickery, of course. See #30560.


Tickets:

- #30560: `openssl` an optional dependency of `python3`

- `giac` detects `cocoa` (which we have added as an experimental package)

- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)

- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency

- `polymake` has lots of optional dependencies




Issue created by migration from https://trac.sagemath.org/ticket/21700





---

archive/issue_comments_297563.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297563",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_297564.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297564",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297565.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-13T17:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297565",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_297566.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-13T17:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297566",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_297567.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-14T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297567",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_297568.json:
```json
{
    "body": "Given that `lrslib` and `lidia` are libraries, they should be real dependencies.",
    "created_at": "2016-10-14T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297568",
    "user": "https://github.com/jdemeyer"
}
```

Given that `lrslib` and `lidia` are libraries, they should be real dependencies.



---

archive/issue_comments_297569.json:
```json
{
    "body": "They are optional for latte_int. This means that one can build latte_int with or without them.",
    "created_at": "2016-10-14T07:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297569",
    "user": "https://github.com/mkoeppe"
}
```

They are optional for latte_int. This means that one can build latte_int with or without them.



---

archive/issue_comments_297570.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> They are optional for latte_int. This means that one can build latte_int with or without them.\n\n\nThat is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.",
    "created_at": "2016-10-14T07:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297570",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 mkoeppe]:
> They are optional for latte_int. This means that one can build latte_int with or without them.


That is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.



---

archive/issue_comments_297571.json:
```json
{
    "body": "If the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.",
    "created_at": "2016-10-14T07:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297571",
    "user": "https://github.com/mkoeppe"
}
```

If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.



---

archive/issue_comments_297572.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> If the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.\n\n\nThat works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.",
    "created_at": "2016-10-14T07:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297572",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 mkoeppe]:
> If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.


That works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.



---

archive/issue_comments_297573.json:
```json
{
    "body": "I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.",
    "created_at": "2016-10-14T07:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297573",
    "user": "https://github.com/jdemeyer"
}
```

I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.



---

archive/issue_comments_297574.json:
```json
{
    "body": "If the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\nHence an order only dependency, not a real dependency.",
    "created_at": "2016-10-14T07:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297574",
    "user": "https://github.com/mkoeppe"
}
```

If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
Hence an order only dependency, not a real dependency.



---

archive/issue_comments_297575.json:
```json
{
    "body": "I think you may be right, but it's past midnight here, so I can't be sure.",
    "created_at": "2016-10-14T07:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297575",
    "user": "https://github.com/mkoeppe"
}
```

I think you may be right, but it's past midnight here, so I can't be sure.



---

archive/issue_comments_297576.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> If the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\n> Hence an order only dependency, not a real dependency.\n\n\nLike I said in [comment:10], order-only dependencies don't work that way.",
    "created_at": "2016-10-14T08:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297576",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 mkoeppe]:
> If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
> Hence an order only dependency, not a real dependency.


Like I said in [comment:10], order-only dependencies don't work that way.



---

archive/issue_comments_297577.json:
```json
{
    "body": "Thanks. You are right. I was confused about order-only dependencies. \n\nI'll update the ticket description",
    "created_at": "2016-10-15T01:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297577",
    "user": "https://github.com/mkoeppe"
}
```

Thanks. You are right. I was confused about order-only dependencies. 

I'll update the ticket description



---

archive/issue_events_057457.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-15T01:58:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57457"
}
```



---

archive/issue_comments_297578.json:
```json
{
    "body": "I suppose a simple solution could be to have two packages:\n- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).\n- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).",
    "created_at": "2016-10-15T02:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297578",
    "user": "https://github.com/mkoeppe"
}
```

I suppose a simple solution could be to have two packages:
- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).
- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).



---

archive/issue_comments_297579.json:
```json
{
    "body": "Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?",
    "created_at": "2016-10-15T07:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297579",
    "user": "https://github.com/jdemeyer"
}
```

Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?



---

archive/issue_comments_297580.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?\n\n\nSee #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).\n\nAccording to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.",
    "created_at": "2017-03-02T10:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297580",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:17 jdemeyer]:
> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?


See #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).

According to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.



---

archive/issue_events_057458.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57458"
}
```



---

archive/issue_events_057459.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57459"
}
```



---

archive/issue_comments_297581.json:
```json
{
    "body": "Changing component from packages: experimental to build: configure.",
    "created_at": "2020-09-13T19:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297581",
    "user": "https://github.com/mkoeppe"
}
```

Changing component from packages: experimental to build: configure.



---

archive/issue_comments_297582.json:
```json
{
    "body": "Regarding this part of the ticket description:\n\nReplying to [ticket:21700 mkoeppe]:\n> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n\n\nIt is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.\n\n(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)",
    "created_at": "2020-09-14T16:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297582",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding this part of the ticket description:

Replying to [ticket:21700 mkoeppe]:
> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.


It is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.

(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)



---

archive/issue_comments_297583.json:
```json
{
    "body": "Thanks, I have updated the ticket description",
    "created_at": "2020-09-14T19:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297583",
    "user": "https://github.com/mkoeppe"
}
```

Thanks, I have updated the ticket description



---

archive/issue_comments_297584.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297584",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_057460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57460"
}
```



---

archive/issue_events_057461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57461"
}
```



---

archive/issue_comments_297585.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297585",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_057462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57462"
}
```



---

archive/issue_events_057463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57463"
}
```



---

archive/issue_events_057464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57464"
}
```



---

archive/issue_events_057465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57465"
}
```



---

archive/issue_events_057466.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57466"
}
```



---

archive/issue_events_057467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57467"
}
```



---

archive/issue_events_057468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57468"
}
```



---

archive/issue_events_057469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21463#event-57469"
}
```
