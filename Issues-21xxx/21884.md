# Issue 21884: giacpy_sage doctest failure and new libsingular cf.type == n_unknown ring test

archive/issues_021647.json:
```json
{
    "body": "Related to #21860 : one failure in ptestlong :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py\nRunning doctests with ID 2016-11-17-09-17-43-cce569e2.\nGit branch: t/21860/giacblas\nUsing --optional=database_gap,giac,giacpy_sage,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_ideal.py\", line 3533, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis\nFailed example:\n    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage\nExpected:\n    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\nGot:\n    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]\n**********************************************************************\n1 item had failures:\n   1 of  67 in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis\n    [723 tests, 1 failure, 9.10 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 9.2 seconds\n    cpu time: 15.5 seconds\n    cumulative wall time: 9.1 seconds\n```\n\nin fact it is related to the singular update #17254 where all the \n\n```\nif r.ringtype == 0:\n```\nwere replaced by \n\n```\nif r.cf.type == n_unknown:\n```\nbut it seems not equivalent with QQ coefficients.\n\nRemarks: The interred_libsingular function of multi_polynomial_ideal_libsingular.pyx\nends with an explicit:\n\n```\n# divide head by coeffi\n...\n```\nand the groebner_basis function doc have still five examples giving:\n\n```\n[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\n```\nso what is the best thing for the interreduced_basis command to output?\n\nCC:  parisse @frederichan-IMJPRG jpflori\n\nBranch/Commit: fd60c06465050a1117e2ef9d93dd6ab8ed2e2550\n\nReviewer: Emmanuel Charpentier\n\nAuthor: Frederic Han\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21884\n\n",
    "closed_at": "2017-03-19T16:25:40Z",
    "created_at": "2016-11-17T08:31:57Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "giacpy_sage doctest failure and new libsingular cf.type == n_unknown ring test",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21884",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Related to #21860 : one failure in ptestlong :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py
Running doctests with ID 2016-11-17-09-17-43-cce569e2.
Git branch: t/21860/giacblas
Using --optional=database_gap,giac,giacpy_sage,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 3533, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
Failed example:
    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage
Expected:
    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
Got:
    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]
**********************************************************************
1 item had failures:
   1 of  67 in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
    [723 tests, 1 failure, 9.10 s]
----------------------------------------------------------------------
sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 9.2 seconds
    cpu time: 15.5 seconds
    cumulative wall time: 9.1 seconds
```

in fact it is related to the singular update #17254 where all the 

```
if r.ringtype == 0:
```
were replaced by 

```
if r.cf.type == n_unknown:
```
but it seems not equivalent with QQ coefficients.

Remarks: The interred_libsingular function of multi_polynomial_ideal_libsingular.pyx
ends with an explicit:

```
# divide head by coeffi
...
```
and the groebner_basis function doc have still five examples giving:

```
[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
```
so what is the best thing for the interreduced_basis command to output?

CC:  parisse @frederichan-IMJPRG jpflori

Branch/Commit: fd60c06465050a1117e2ef9d93dd6ab8ed2e2550

Reviewer: Emmanuel Charpentier

Author: Frederic Han

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21884





---

archive/issue_comments_404706.json:
```json
{
    "body": "<a id='comment:1'></a>I don't think that it is related to #21860 (giac update), but it is related to the singular upgrade:\n\nwith sage 7.5beta2 (singular4)\n\n```\nsage: P.<a,b,c> = PolynomialRing(QQ,3, order='lex') \nsage: toto=ideal([7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c])\n....: \nsage: toto.interreduced_basis()\n[7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]\nsage: \n```\nbut with older versions with singular3 it gives\n\n```\n[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\n```",
    "created_at": "2016-11-17T17:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404706",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:1'></a>I don't think that it is related to #21860 (giac update), but it is related to the singular upgrade:

with sage 7.5beta2 (singular4)

```
sage: P.<a,b,c> = PolynomialRing(QQ,3, order='lex') 
sage: toto=ideal([7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c])
....: 
sage: toto.interreduced_basis()
[7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]
sage: 
```
but with older versions with singular3 it gives

```
[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
```



---

archive/issue_comments_404707.json:
```json
{
    "body": "<a id='comment:2'></a>In fact the doctest was not using the result computed by giac but was recomputing everything with singular so I have changed this.\n\nI have not yet changed the output doc string because it seems not coherent with the documentation of\ninterreduced_basis:\n\n```\n   If this ideal is spanned by (f_1, ..., f_n) this method returns\n   (g_1, ..., g_s) such that:\n\n   * (f_1,...,f_n) = (g_1,...,g_s)\n\n   * LT(g_i) != LT(g_j) for all i != j\n\n   * LT(g_i) does not divide m for all monomials m of\n\n        {g_1,...,g_{i-1},g_{i+1},...,g_s}\n\n   * LC(g_i) == 1 for all i if the coefficient ring is a field.\n\n```\nbut\n\n```\nsage: P.<a,b,c> = PolynomialRing(QQ,3, order='lex')\nsage: toto=ideal([7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c])\n....: \nsage: g=toto.interreduced_basis()\nsage: g[0].lc()\n7\nsage: toto.base_ring()\nRational Field\n```\n\n---\nLast 10 new commits:",
    "created_at": "2016-11-17T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404707",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:2'></a>In fact the doctest was not using the result computed by giac but was recomputing everything with singular so I have changed this.

I have not yet changed the output doc string because it seems not coherent with the documentation of
interreduced_basis:

```
   If this ideal is spanned by (f_1, ..., f_n) this method returns
   (g_1, ..., g_s) such that:

   * (f_1,...,f_n) = (g_1,...,g_s)

   * LT(g_i) != LT(g_j) for all i != j

   * LT(g_i) does not divide m for all monomials m of

        {g_1,...,g_{i-1},g_{i+1},...,g_s}

   * LC(g_i) == 1 for all i if the coefficient ring is a field.

```
but

```
sage: P.<a,b,c> = PolynomialRing(QQ,3, order='lex')
sage: toto=ideal([7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c])
....: 
sage: g=toto.interreduced_basis()
sage: g[0].lc()
7
sage: toto.base_ring()
Rational Field
```

---
Last 10 new commits:



---

archive/issue_comments_404708.json:
```json
{
    "body": "Changing dependencies from \"#21860\" to \"\"",
    "created_at": "2016-11-17T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404708",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing dependencies from "#21860" to ""



---

archive/issue_comments_404709.json:
```json
{
    "body": "Changing commit from \"\" to \"7accb23f1cdc56138d12e8145fc4d378f0fdf077\"",
    "created_at": "2016-11-17T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404709",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing commit from "" to "7accb23f1cdc56138d12e8145fc4d378f0fdf077"



---

archive/issue_comments_404710.json:
```json
{
    "body": "Changing branch from \"\" to \"public/giacpy21884\"",
    "created_at": "2016-11-17T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404710",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing branch from "" to "public/giacpy21884"



---

archive/issue_comments_404711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,3 +26,29 @@\n     cpu time: 15.5 seconds\n     cumulative wall time: 9.1 seconds\n ```\n+\n+in fact it is related to the singular update #17254 where all the \n+\n+```\n+if r.ringtype == 0:\n+```\n+were replaced by \n+\n+```\n+if r.cf.type == n_unknown:\n+```\n+but it seems not equivalent with QQ coefficients.\n+\n+Remarks: The interred_libsingular function of multi_polynomial_ideal_libsingular.pyx\n+ends with an explicit:\n+\n+```\n+# divide head by coeffi\n+...\n+```\n+and the groebner_basis function doc have still five examples giving:\n+\n+```\n+[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\n+```\n+so what is the best thing for the interreduced_basis command to output?\n``````\n",
    "created_at": "2016-11-19T08:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404711",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,3 +26,29 @@
     cpu time: 15.5 seconds
     cumulative wall time: 9.1 seconds
 ```
+
+in fact it is related to the singular update #17254 where all the 
+
+```
+if r.ringtype == 0:
+```
+were replaced by 
+
+```
+if r.cf.type == n_unknown:
+```
+but it seems not equivalent with QQ coefficients.
+
+Remarks: The interred_libsingular function of multi_polynomial_ideal_libsingular.pyx
+ends with an explicit:
+
+```
+# divide head by coeffi
+...
+```
+and the groebner_basis function doc have still five examples giving:
+
+```
+[a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
+```
+so what is the best thing for the interreduced_basis command to output?
``````




---

archive/issue_comments_404712.json:
```json
{
    "body": "<a id='comment:4'></a>15 commits to change just one line of code? Please squash this to one commit :-)",
    "created_at": "2016-11-19T08:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404712",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>15 commits to change just one line of code? Please squash this to one commit :-)



---

archive/issue_comments_404713.json:
```json
{
    "body": "Changing component from packages: optional to doctest coverage.",
    "created_at": "2016-11-19T08:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404713",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from packages: optional to doctest coverage.



---

archive/issue_comments_404714.json:
```json
{
    "body": "<a id='comment:5'></a>And change the title to something which refers to Singular.",
    "created_at": "2016-11-19T08:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404714",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>And change the title to something which refers to Singular.



---

archive/issue_comments_404715.json:
```json
{
    "body": "<a id='comment:6'></a>sorry for the messy branch, here is a new one\n\n---\nNew commits:",
    "created_at": "2016-11-19T11:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404715",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:6'></a>sorry for the messy branch, here is a new one

---
New commits:



---

archive/issue_comments_404716.json:
```json
{
    "body": "Changing commit from \"7accb23f1cdc56138d12e8145fc4d378f0fdf077\" to \"226744dcf00938804e5de4fa692f9ea6c43db39f\"",
    "created_at": "2016-11-19T11:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404716",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing commit from "7accb23f1cdc56138d12e8145fc4d378f0fdf077" to "226744dcf00938804e5de4fa692f9ea6c43db39f"



---

archive/issue_comments_404717.json:
```json
{
    "body": "Changing branch from \"public/giacpy21884\" to \"public/trac21884\"",
    "created_at": "2016-11-19T11:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404717",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing branch from "public/giacpy21884" to "public/trac21884"



---

archive/issue_comments_404718.json:
```json
{
    "body": "<a id='comment:7'></a>how about changing the doc of `interreduced_basis` where it says that LCs will be 1 if working over a field, i.e.\n\n```\n* LC(g_i) == 1 for all i if the coefficient ring is a field.\n```\nis no longer true.",
    "created_at": "2016-11-19T18:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>how about changing the doc of `interreduced_basis` where it says that LCs will be 1 if working over a field, i.e.

```
* LC(g_i) == 1 for all i if the coefficient ring is a field.
```
is no longer true.



---

archive/issue_comments_404719.json:
```json
{
    "body": "<a id='comment:8'></a>Before doing just that, my question is also about how QQ was detected in the old code and does the new condition detect any ring, because if I grep the old test I already have:\n\n```\nmacbookito(fred)$ grep -r \"ringtype == 0\" src/sage\nsrc/sage/rings/polynomial/multi_polynomial_libsingular.pyx:            if r.ringtype == 0 or r.cf.nDivBy(p_GetCoeff(f._poly, r), p_GetCoeff(g._poly, r)):\nsrc/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx:    if r.ringtype == 0:\nsrc/sage/rings/polynomial/plural.pyx:            if r.ringtype == 0 or r.cf.nDivBy(p_GetCoeff(f._poly, r), p_GetCoeff(g._poly, r)):\nsrc/sage/libs/singular/singular.pyx:        if _ring.ringtype == 0:\nsrc/sage/libs/singular/singular.pyx:        if _ring.ringtype == 0:\nmacbookito(fred)$ grep -r \"ringtype != 0\" src/sage\nsrc/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if r.ringtype != 0:\nsrc/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if _ring.ringtype != 0:\nsrc/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if _ring.ringtype != 0:\nsrc/sage/libs/singular/ring.pyx:    if ringtype != 0:\n```",
    "created_at": "2016-11-20T10:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404719",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:8'></a>Before doing just that, my question is also about how QQ was detected in the old code and does the new condition detect any ring, because if I grep the old test I already have:

```
macbookito(fred)$ grep -r "ringtype == 0" src/sage
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:            if r.ringtype == 0 or r.cf.nDivBy(p_GetCoeff(f._poly, r), p_GetCoeff(g._poly, r)):
src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx:    if r.ringtype == 0:
src/sage/rings/polynomial/plural.pyx:            if r.ringtype == 0 or r.cf.nDivBy(p_GetCoeff(f._poly, r), p_GetCoeff(g._poly, r)):
src/sage/libs/singular/singular.pyx:        if _ring.ringtype == 0:
src/sage/libs/singular/singular.pyx:        if _ring.ringtype == 0:
macbookito(fred)$ grep -r "ringtype != 0" src/sage
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if r.ringtype != 0:
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if _ring.ringtype != 0:
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:        if _ring.ringtype != 0:
src/sage/libs/singular/ring.pyx:    if ringtype != 0:
```



---

archive/issue_comments_404720.json:
```json
{
    "body": "<a id='comment:9'></a>So if I am right it seems that the old test ringtype != 0 was used as a trick to detect if the  ring of coefficient was not a field, and seems equivalent to \n\n   cf.type ==  one of n_Z, n_Zm, n_Zmn, n_Z2n\n\nin src/sage/rings/polynomial/multi_polynomial_libsingular.pyx\nin the gcd and lcm a test has been added so the code is equivalent to the old one.\n            if r.cf.type == n_Znm or r.cf.type == n_Zn or r.cf.type == n_Z2m :\n                raise NotImplementedError(\"Division of multivariate polynomials over non fields by n\n\nin interreduced the normalisation of the head coefficient may be never executed and is not equivalent to the old code. So I suggest 2 modification.\neither:\n   1)  change the doc a dima suggest to do the same as singular and delete the normalisation code\nor\n   2)  replace the cf.type == n_unknown by  \n            if r.cf.type != n_Znm and r.cf.type != n_Zn and r.cf.type != n_Z2m \n       and keep the doc as is\n\nfor plural.pyx it should be OK because of the or\n\nBut in src/sage/libs/singular/singular.pyx the 2 substitutions gives  strange code:\n\n```\n\n    elif isinstance(base, IntegerModRing_generic):\n        if _ring.cf.type == n_unknown:\n            return base(_ring.cf.cfInt(n, _ring.cf))\n        return si2sa_ZZmod(n, _ring, base)\n\n```\n\n```\n    elif isinstance(elem._parent, IntegerModRing_generic):\n        if _ring.cf.type == n_unknown:\n            return n_Init(int(elem),_ring)\n        return sa2si_ZZmod(elem, _ring)\n\n``` \nfor instance n_Zp had ringtype == 0",
    "created_at": "2016-11-23T11:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404720",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:9'></a>So if I am right it seems that the old test ringtype != 0 was used as a trick to detect if the  ring of coefficient was not a field, and seems equivalent to 

   cf.type ==  one of n_Z, n_Zm, n_Zmn, n_Z2n

in src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
in the gcd and lcm a test has been added so the code is equivalent to the old one.
            if r.cf.type == n_Znm or r.cf.type == n_Zn or r.cf.type == n_Z2m :
                raise NotImplementedError("Division of multivariate polynomials over non fields by n

in interreduced the normalisation of the head coefficient may be never executed and is not equivalent to the old code. So I suggest 2 modification.
either:
   1)  change the doc a dima suggest to do the same as singular and delete the normalisation code
or
   2)  replace the cf.type == n_unknown by  
            if r.cf.type != n_Znm and r.cf.type != n_Zn and r.cf.type != n_Z2m 
       and keep the doc as is

for plural.pyx it should be OK because of the or

But in src/sage/libs/singular/singular.pyx the 2 substitutions gives  strange code:

```

    elif isinstance(base, IntegerModRing_generic):
        if _ring.cf.type == n_unknown:
            return base(_ring.cf.cfInt(n, _ring.cf))
        return si2sa_ZZmod(n, _ring, base)

```

```
    elif isinstance(elem._parent, IntegerModRing_generic):
        if _ring.cf.type == n_unknown:
            return n_Init(int(elem),_ring)
        return sa2si_ZZmod(elem, _ring)

``` 
for instance n_Zp had ringtype == 0



---

archive/issue_comments_404721.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-24T11:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404722.json:
```json
{
    "body": "Changing commit from \"226744dcf00938804e5de4fa692f9ea6c43db39f\" to \"bde7be034769b603ffadbe827d8db2b801847a4b\"",
    "created_at": "2016-11-24T11:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "226744dcf00938804e5de4fa692f9ea6c43db39f" to "bde7be034769b603ffadbe827d8db2b801847a4b"



---

archive/issue_comments_404723.json:
```json
{
    "body": "<a id='comment:11'></a>NB: I chose solution 2 because the reduced command of  multi_polynomial_sequence.py also talk of normalized polynomials and use the libgiac interred:\n\n```\n        if isinstance(R,MPolynomialRing_libsingular):\n            return PolynomialSequence(R, interred_libsingular(self), immutable=True)\n```",
    "created_at": "2016-11-24T11:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404723",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:11'></a>NB: I chose solution 2 because the reduced command of  multi_polynomial_sequence.py also talk of normalized polynomials and use the libgiac interred:

```
        if isinstance(R,MPolynomialRing_libsingular):
            return PolynomialSequence(R, interred_libsingular(self), immutable=True)
```



---

archive/issue_comments_404724.json:
```json
{
    "body": "<a id='comment:12'></a>NB: I am not confortable enough with sage and singular to modify the == n_unkown in:\nsrc/sage/libs/singular/singular.pyx\n\nDoes anyone plan to change it or can I switch to need review?",
    "created_at": "2016-11-24T12:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404724",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:12'></a>NB: I am not confortable enough with sage and singular to modify the == n_unkown in:
src/sage/libs/singular/singular.pyx

Does anyone plan to change it or can I switch to need review?



---

archive/issue_comments_404725.json:
```json
{
    "body": "Changing author from \"\" to \"Frederic Han\"",
    "created_at": "2016-11-24T12:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404725",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing author from "" to "Frederic Han"



---

archive/issue_comments_404726.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-25T12:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404726",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

Changing status from new to needs_review.



---

archive/issue_events_057765.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-10T21:54:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21884#event-57765"
}
```



---

archive/issue_comments_404727.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2017-03-10T21:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404727",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_404728.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-11T09:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404729.json:
```json
{
    "body": "Changing commit from \"bde7be034769b603ffadbe827d8db2b801847a4b\" to \"fd60c06465050a1117e2ef9d93dd6ab8ed2e2550\"",
    "created_at": "2017-03-11T09:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bde7be034769b603ffadbe827d8db2b801847a4b" to "fd60c06465050a1117e2ef9d93dd6ab8ed2e2550"



---

archive/issue_comments_404730.json:
```json
{
    "body": "<a id='comment:16'></a>Rebased to 7.6.beta6",
    "created_at": "2017-03-11T09:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404730",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Rebased to 7.6.beta6



---

archive/issue_comments_404731.json:
```json
{
    "body": "<a id='comment:17'></a>Is it good to go ?",
    "created_at": "2017-03-17T14:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404731",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:17'></a>Is it good to go ?



---

archive/issue_comments_404732.json:
```json
{
    "body": "<a id='comment:18'></a>I have not run the test suite for while but we should try if other doctests have been added in between",
    "created_at": "2017-03-17T14:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404732",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:18'></a>I have not run the test suite for while but we should try if other doctests have been added in between



---

archive/issue_comments_404733.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-18T11:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404733",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404734.json:
```json
{
    "body": "<a id='comment:19'></a>In 7.6.rc1 + #20523 + #21884 (present ticket) :\n* `giacpy_sage` passes its own test suite (237 tests pased, 0 failed, 5 items with no test)\n* Sage pass `ptestlong` with one failure :\n\n```\n----------------------------------------------------------------------\nsage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nwhich is transient (i. e. pass without failure when ran standalone).\n\n==> `positive review`.",
    "created_at": "2017-03-18T11:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404734",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:19'></a>In 7.6.rc1 + #20523 + #21884 (present ticket) :
* `giacpy_sage` passes its own test suite (237 tests pased, 0 failed, 5 items with no test)
* Sage pass `ptestlong` with one failure :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```
which is transient (i. e. pass without failure when ran standalone).

==> `positive review`.



---

archive/issue_comments_404735.json:
```json
{
    "body": "<a id='comment:20'></a>Forgot to sign the review...",
    "created_at": "2017-03-18T11:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404735",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:20'></a>Forgot to sign the review...



---

archive/issue_comments_404736.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Emmanuel Charpentier\"",
    "created_at": "2017-03-18T11:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404736",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing reviewer from "" to "Emmanuel Charpentier"



---

archive/issue_comments_404737.json:
```json
{
    "body": "<a id='comment:21'></a>Note : I do not understand the patchbot failure. Someone with a better understanding of the patchbot system should investigate the issue...",
    "created_at": "2017-03-18T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404737",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:21'></a>Note : I do not understand the patchbot failure. Someone with a better understanding of the patchbot system should investigate the issue...



---

archive/issue_events_057766.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-19T16:25:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21884#event-57766"
}
```



---

archive/issue_comments_404738.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-19T16:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404738",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_404739.json:
```json
{
    "body": "Changing branch from \"public/trac21884\" to \"fd60c06465050a1117e2ef9d93dd6ab8ed2e2550\"",
    "created_at": "2017-03-19T16:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21884#issuecomment-404739",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/trac21884" to "fd60c06465050a1117e2ef9d93dd6ab8ed2e2550"
