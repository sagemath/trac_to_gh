# Issue 21442: Add a function to check if a given subset is convex in a poset

archive/issues_021205.json:
```json
{
    "body": "CC:  @tscrim\n\nThis patch will add a helper function to `hasse_diagram.py` to check that a subset of elements is convex in a poset.\n\nWill be needed to check user input for Alan Day's doubling construction.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21442\n\n",
    "closed_at": "2016-09-19T23:12:13Z",
    "created_at": "2016-09-07T07:23:24Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Add a function to check if a given subset is convex in a poset",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21442",
    "user": "https://github.com/jm58660"
}
```
CC:  @tscrim

This patch will add a helper function to `hasse_diagram.py` to check that a subset of elements is convex in a poset.

Will be needed to check user input for Alan Day's doubling construction.


Issue created by migration from https://trac.sagemath.org/ticket/21442





---

archive/issue_comments_293734.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-07T07:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293734",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_293735.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-07T07:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293735",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_293736.json:
```json
{
    "body": "What is `x` here:\n\n```python\nlambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]\n```\nI don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.",
    "created_at": "2016-09-07T14:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293736",
    "user": "https://github.com/tscrim"
}
```

What is `x` here:

```python
lambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]
```
I don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.



---

archive/issue_comments_293737.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-07T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_293738.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-07T17:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293738",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_293739.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> What is `x` here:\n> \n> ```python\n> lambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]\n> ```\n\n\nWhat the hell I did? Should be `b`, but I do not know how this happened and was not catch by doctest. Now compiling and re-checking.\n\n> I don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.\n\n\nI don't understand. The idea is to (try to) found an element `a` in S covered by element `b` not in S and then check if some directed path from `b` goes to some element `c` in S.",
    "created_at": "2016-09-07T17:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293739",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:3 tscrim]:
> What is `x` here:
> 
> ```python
> lambda v: [v for v in self.neighbor_out_iterator(x) if v < s_max and s not in ok]
> ```


What the hell I did? Should be `b`, but I do not know how this happened and was not catch by doctest. Now compiling and re-checking.

> I don't see it in the code. Also, at present it seems like that function could be pulled out of the `for` loop.


I don't understand. The idea is to (try to) found an element `a` in S covered by element `b` not in S and then check if some directed path from `b` goes to some element `c` in S.



---

archive/issue_comments_293740.json:
```json
{
    "body": "Well, since there is a dependence on `b`, my second sentence is moot/invalid. I would just like to see the following to get it ~80 chars per line:\n\n```diff\n--- a/src/sage/combinat/posets/hasse_diagram.py\n+++ b/src/sage/combinat/posets/hasse_diagram.py\n@@ -2100,7 +2100,7 @@ class HasseDiagram(DiGraph):\n                 if b >= s_max or b in S:\n                     continue\n                 # Now b not in S, b > a and a in S.\n-                for c in self.depth_first_search(a, neighbors=lambda v: [v for v in self.neighbor_out_iterator(b) if v < s_max and s not in ok]):\n+                neighbors = lambda v: [v for v in self.neighbor_out_iterator(b)\n+                                       if v < s_max and s not in ok]\n+                for c in self.depth_first_search(a, neighbors=neighbors):\n                     if c in S:  # Now c in S, b not in S, a in S, a < b < c.\n                         return False\n                     ok.add(c)  # Do not re-check this for being our b.\n```\nThen if all tests pass, positive review.",
    "created_at": "2016-09-07T21:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293740",
    "user": "https://github.com/tscrim"
}
```

Well, since there is a dependence on `b`, my second sentence is moot/invalid. I would just like to see the following to get it ~80 chars per line:

```diff
--- a/src/sage/combinat/posets/hasse_diagram.py
+++ b/src/sage/combinat/posets/hasse_diagram.py
@@ -2100,7 +2100,7 @@ class HasseDiagram(DiGraph):
                 if b >= s_max or b in S:
                     continue
                 # Now b not in S, b > a and a in S.
-                for c in self.depth_first_search(a, neighbors=lambda v: [v for v in self.neighbor_out_iterator(b) if v < s_max and s not in ok]):
+                neighbors = lambda v: [v for v in self.neighbor_out_iterator(b)
+                                       if v < s_max and s not in ok]
+                for c in self.depth_first_search(a, neighbors=neighbors):
                     if c in S:  # Now c in S, b not in S, a in S, a < b < c.
                         return False
                     ok.add(c)  # Do not re-check this for being our b.
```
Then if all tests pass, positive review.



---

archive/issue_comments_293741.json:
```json
{
    "body": "This was an interesting case. Basic \"bug\" is just a feature, and can be seen with\n\n```\nsage: g = Graph(42)\nsage: for x in g.depth_first_search(0, neighbors=lambda v: junk(v)):\n....:     print(x)\n```\n\nwhich will output `0` and only after that gives error message. So I really must re-check my code and make a doctest that will catch error like this one.",
    "created_at": "2016-09-08T05:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293741",
    "user": "https://github.com/jm58660"
}
```

This was an interesting case. Basic "bug" is just a feature, and can be seen with

```
sage: g = Graph(42)
sage: for x in g.depth_first_search(0, neighbors=lambda v: junk(v)):
....:     print(x)
```

which will output `0` and only after that gives error message. So I really must re-check my code and make a doctest that will catch error like this one.



---

archive/issue_comments_293742.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-08T15:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_293743.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-08T15:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293743",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_293744.json:
```json
{
    "body": "Now at last. Coded when sick, hope that works still...",
    "created_at": "2016-09-08T15:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293744",
    "user": "https://github.com/jm58660"
}
```

Now at last. Coded when sick, hope that works still...



---

archive/issue_comments_293745.json:
```json
{
    "body": "Just pinging.",
    "created_at": "2016-09-17T10:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293745",
    "user": "https://github.com/jm58660"
}
```

Just pinging.



---

archive/issue_comments_293746.json:
```json
{
    "body": "Looks good. Two trivial things:\n\n- I'm paranoid, but anytime there is latex, I like to use raw strings: `r\"\"\"`\n- Could you break this line:\n  {{{#!diff\n-neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_) if v <= s_max and v not in ok]\n+neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_)\n+if v <= s_max and v not in ok]\n  }}}\n\nYou can set a positive review on my behalf.",
    "created_at": "2016-09-17T15:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293746",
    "user": "https://github.com/tscrim"
}
```

Looks good. Two trivial things:

- I'm paranoid, but anytime there is latex, I like to use raw strings: `r"""`
- Could you break this line:
  {{{#!diff
-neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_) if v <= s_max and v not in ok]
+neighbors = lambda v_: [v for v in self.neighbor_out_iterator(v_)
+if v <= s_max and v not in ok]
  }}}

You can set a positive review on my behalf.



---

archive/issue_comments_293747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-18T08:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_293748.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-18T08:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293748",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_293749.json:
```json
{
    "body": "Suggested minor changes done.",
    "created_at": "2016-09-18T08:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293749",
    "user": "https://github.com/jm58660"
}
```

Suggested minor changes done.



---

archive/issue_comments_293750.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-19T23:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21442#issuecomment-293750",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056978.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-19T23:12:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21442",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21442#event-56978"
}
```
