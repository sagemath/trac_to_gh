# Issue 21917: Binomial Random Uniform Hypergraph

archive/issues_021680.json:
```json
{
    "body": "I have implemented binomial random hypergraph. This is my first time writing code in sage, and I would appreciate any feedback.\n\nAssignee: @pelegm\n\nKeywords: hypergraph,random,days79,days94\n\nBranch/Commit: 5a7b76ad7490524f1ec4c55c4fdd657eb962adcd\n\nReviewer: David Coudert\n\nAuthor: Peleg Michaeli\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21917\n\n",
    "closed_at": "2018-07-03T23:40:23Z",
    "created_at": "2016-11-21T19:22:07Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Binomial Random Uniform Hypergraph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21917",
    "user": "https://github.com/pelegm"
}
```
I have implemented binomial random hypergraph. This is my first time writing code in sage, and I would appreciate any feedback.

Assignee: @pelegm

Keywords: hypergraph,random,days79,days94

Branch/Commit: 5a7b76ad7490524f1ec4c55c4fdd657eb962adcd

Reviewer: David Coudert

Author: Peleg Michaeli

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21917





---

archive/issue_comments_320387.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T19:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320388.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-21T19:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320388",
    "user": "https://github.com/pelegm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_320389.json:
```json
{
    "body": "Changing keywords from \"hypergraph,random\" to \"hypergraph,random,days79\".",
    "created_at": "2016-11-22T09:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320389",
    "user": "https://github.com/pelegm"
}
```

Changing keywords from "hypergraph,random" to "hypergraph,random,days79".



---

archive/issue_comments_320390.json:
```json
{
    "body": "<a id='comment:6'></a>Here are some comments:\n\n1. `INPUT:` is missing\n\n2. No empty line is needed between input items.\n\n3. You should describe the type of the input:\n\n```\n- ``n`` -- integer, number of nodes of the graph\n```\n\n4. There *must* be `EXAMPLES::`. There can be also some `TESTS::`. I suggest to keep the limit cases inside a TEST block:\n\n```\n            sage: hypergraphs.RandomBinomialUniform(50, 3, 1).num_blocks()\n            19600\n            sage: hypergraphs.RandomBinomialUniform(50, 3, 0).num_blocks()\n            0\n```\n\nand the one with `p=0.2` inside the `EXAMPLE` block without the call to that other `numblock` method.\n\n```\nsage: hypergraphs.RandomBinomialUniform(50, 3, 0.2)\nIncidence structure with 50 points and 3915 blocks \n```\n\n5. I think that the line `sage: set_random_seed(0)` is not necessary because the doctest framework already set the random seed so that random doctest always return the same thing...\n\n6. Is the `seed` input only there for doctests reason? Or do you expect a human user to need this? If not, I would suggest to remove this input to the function. Also not that you can add `# random` at the end of a `sage:` line in doctests so that it only tests that no error are produced. See http://doc.sagemath.org/html/en/developer/coding_basics.html#section-further-conventions\n\n7. In fact, I would remove `num_blocks()` everywhere in the examples. When we quickly look, we think that this methods return a integer...\n\n8. I would suggest that you read the section http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings. Normally, everything that I said is explained there.\n\n9. `(default=None)` -> `(default: `None`)`, in case you keep the seed input",
    "created_at": "2016-11-23T22:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320390",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>Here are some comments:

1. `INPUT:` is missing

2. No empty line is needed between input items.

3. You should describe the type of the input:

```
- ``n`` -- integer, number of nodes of the graph
```

4. There *must* be `EXAMPLES::`. There can be also some `TESTS::`. I suggest to keep the limit cases inside a TEST block:

```
            sage: hypergraphs.RandomBinomialUniform(50, 3, 1).num_blocks()
            19600
            sage: hypergraphs.RandomBinomialUniform(50, 3, 0).num_blocks()
            0
```

and the one with `p=0.2` inside the `EXAMPLE` block without the call to that other `numblock` method.

```
sage: hypergraphs.RandomBinomialUniform(50, 3, 0.2)
Incidence structure with 50 points and 3915 blocks 
```

5. I think that the line `sage: set_random_seed(0)` is not necessary because the doctest framework already set the random seed so that random doctest always return the same thing...

6. Is the `seed` input only there for doctests reason? Or do you expect a human user to need this? If not, I would suggest to remove this input to the function. Also not that you can add `# random` at the end of a `sage:` line in doctests so that it only tests that no error are produced. See http://doc.sagemath.org/html/en/developer/coding_basics.html#section-further-conventions

7. In fact, I would remove `num_blocks()` everywhere in the examples. When we quickly look, we think that this methods return a integer...

8. I would suggest that you read the section http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings. Normally, everything that I said is explained there.

9. `(default=None)` -> `(default: `None`)`, in case you keep the seed input



---

archive/issue_comments_320391.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-23T22:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320391",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320392.json:
```json
{
    "body": "<a id='comment:7'></a>Hello,\n\nI do not understand what you are doing with the `seed` variable in your code... it is set but never used! Manipulating the random state should not be part of your function. There are Sage functions for that purpose.\n\nVincent",
    "created_at": "2016-11-24T09:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320392",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Hello,

I do not understand what you are doing with the `seed` variable in your code... it is set but never used! Manipulating the random state should not be part of your function. There are Sage functions for that purpose.

Vincent



---

archive/issue_comments_320393.json:
```json
{
    "body": "<a id='comment:8'></a>This is very inefficient if p is small\n\n```\nedges = [e for e in combinations(range(n), k) if random() < p]\n```\nYou need to use another approach...\n\nThe cardinality of your \"edge space\" is binomial(n,k). What you want to do is basically pick a binomial random variable B(binomial(n,k), p) and then pick that number of sets. This can be done as follows\n\n```\nsage: S = Subsets(range(50), 5)\nsage: sample(S, 10)\n[{34, 38, 5, 30, 21},\n {16, 1, 35, 5, 45},\n {34, 3, 4, 5, 15},\n {9, 2, 5, 6, 47},\n {35, 20, 37, 22, 15},\n {0, 17, 42, 12, 45},\n {8, 24, 19, 13, 22},\n {36, 42, 28, 5, 29},\n {48, 17, 49, 33, 7},\n {1, 39, 29, 43, 9}]\n```\nHence you just need to generate a random number distributed with binomial distribution.",
    "created_at": "2016-11-24T10:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320393",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>This is very inefficient if p is small

```
edges = [e for e in combinations(range(n), k) if random() < p]
```
You need to use another approach...

The cardinality of your "edge space" is binomial(n,k). What you want to do is basically pick a binomial random variable B(binomial(n,k), p) and then pick that number of sets. This can be done as follows

```
sage: S = Subsets(range(50), 5)
sage: sample(S, 10)
[{34, 38, 5, 30, 21},
 {16, 1, 35, 5, 45},
 {34, 3, 4, 5, 15},
 {9, 2, 5, 6, 47},
 {35, 20, 37, 22, 15},
 {0, 17, 42, 12, 45},
 {8, 24, 19, 13, 22},
 {36, 42, 28, 5, 29},
 {48, 17, 49, 33, 7},
 {1, 39, 29, 43, 9}]
```
Hence you just need to generate a random number distributed with binomial distribution.



---

archive/issue_comments_320394.json:
```json
{
    "body": "<a id='comment:9'></a>And for generating binomial distribution there is at least\n\n    https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.binomial.html",
    "created_at": "2016-11-24T10:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320394",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>And for generating binomial distribution there is at least

    https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.binomial.html



---

archive/issue_comments_320395.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 vdelecroix]:\n\n> I do not understand what you are doing with the `seed` variable in your code... it is set but never used! Manipulating the random state should not be part of your function. There are Sage functions for that purpose.\n\n\nThis is probably right. I do want to get `seed` as a parameter, though, to be consistent with `graphs/generators/random.py`, though. I'm just not sure what exactly to do with it.",
    "created_at": "2016-11-24T12:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320395",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:10'></a>Replying to [comment:7 vdelecroix]:

> I do not understand what you are doing with the `seed` variable in your code... it is set but never used! Manipulating the random state should not be part of your function. There are Sage functions for that purpose.


This is probably right. I do want to get `seed` as a parameter, though, to be consistent with `graphs/generators/random.py`, though. I'm just not sure what exactly to do with it.



---

archive/issue_comments_320396.json:
```json
{
    "body": "<a id='comment:11'></a>`sample` yields an `OverflowError`:\n\n```python\nsage: n = 10000\nsage: p = 1/n\nsage: k = 17\nsage: sample(Subsets(range(n), k), binomial(n, p))\nTraceback (most recent call last):\n  File \"<ipython-input-57-6d20b3bde428>\", line 1, in <module>\n    sample(Subsets(range(n), k), binomial(n, p))\n  File \"/usr/lib/sagemath/local/lib/python2.7/site-packages/sage/misc/prandom.py\", line 178, in sample\n    return _pyrand().sample(population, k)\n  File \"/usr/lib/sagemath/local/lib/python/random.py\", line 321, in sample\n    n = len(population)\nOverflowError: Python int too large to convert to C long\n```\n\nI am also quite worried about the fact that `numpy` probably converts `p` into a float. Not sure it should matter much, but still...\n\n(this was tested in Sage 7.3... until I'll build 7.5beta3 properly)",
    "created_at": "2016-11-24T13:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320396",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:11'></a>`sample` yields an `OverflowError`:

```python
sage: n = 10000
sage: p = 1/n
sage: k = 17
sage: sample(Subsets(range(n), k), binomial(n, p))
Traceback (most recent call last):
  File "<ipython-input-57-6d20b3bde428>", line 1, in <module>
    sample(Subsets(range(n), k), binomial(n, p))
  File "/usr/lib/sagemath/local/lib/python2.7/site-packages/sage/misc/prandom.py", line 178, in sample
    return _pyrand().sample(population, k)
  File "/usr/lib/sagemath/local/lib/python/random.py", line 321, in sample
    n = len(population)
OverflowError: Python int too large to convert to C long
```

I am also quite worried about the fact that `numpy` probably converts `p` into a float. Not sure it should matter much, but still...

(this was tested in Sage 7.3... until I'll build 7.5beta3 properly)



---

archive/issue_comments_320397.json:
```json
{
    "body": "<a id='comment:12'></a>I think the maximum number of edges in the complete uniform hypergraph that this can handle via the proposed method is roughly `1e18` (check that `xrange`, for example, fails for `1e19`).",
    "created_at": "2016-11-24T13:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320397",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:12'></a>I think the maximum number of edges in the complete uniform hypergraph that this can handle via the proposed method is roughly `1e18` (check that `xrange`, for example, fails for `1e19`).



---

archive/issue_comments_320398.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 pelegm]:\n> `sample` yields an `OverflowError`:\n> \n> \n> ```python\n> sage: n = 10000\n> sage: p = 1/n\n> sage: k = 17\n> sage: sample(Subsets(range(n), k), binomial(n, p))\n> Traceback (most recent call last):\n>   File \"<ipython-input-57-6d20b3bde428>\", line 1, in <module>\n>     sample(Subsets(range(n), k), binomial(n, p))\n>   File \"/usr/lib/sagemath/local/lib/python2.7/site-packages/sage/misc/prandom.py\", line 178, in sample\n>     return _pyrand().sample(population, k)\n>   File \"/usr/lib/sagemath/local/lib/python/random.py\", line 321, in sample\n>     n = len(population)\n> OverflowError: Python int too large to convert to C long\n> ```\n> \n> I am also quite worried about the fact that `numpy` probably converts `p` into a float. Not sure it should matter much, but still...\n\n\nI confirm the behavior on the latest beta (7.5.beta4). I don't think the conversion to float by numpy matters.\n\nOn the other hand, as we discussed in Jerusalem it would actually be simpler to have two methods:\n* one for GNM (not needing binomial)\n* one for GNP (that calls GNM with appropriate parameters)",
    "created_at": "2016-11-25T12:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320398",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Replying to [comment:11 pelegm]:
> `sample` yields an `OverflowError`:
> 
> 
> ```python
> sage: n = 10000
> sage: p = 1/n
> sage: k = 17
> sage: sample(Subsets(range(n), k), binomial(n, p))
> Traceback (most recent call last):
>   File "<ipython-input-57-6d20b3bde428>", line 1, in <module>
>     sample(Subsets(range(n), k), binomial(n, p))
>   File "/usr/lib/sagemath/local/lib/python2.7/site-packages/sage/misc/prandom.py", line 178, in sample
>     return _pyrand().sample(population, k)
>   File "/usr/lib/sagemath/local/lib/python/random.py", line 321, in sample
>     n = len(population)
> OverflowError: Python int too large to convert to C long
> ```
> 
> I am also quite worried about the fact that `numpy` probably converts `p` into a float. Not sure it should matter much, but still...


I confirm the behavior on the latest beta (7.5.beta4). I don't think the conversion to float by numpy matters.

On the other hand, as we discussed in Jerusalem it would actually be simpler to have two methods:
* one for GNM (not needing binomial)
* one for GNP (that calls GNM with appropriate parameters)



---

archive/issue_comments_320399.json:
```json
{
    "body": "<a id='comment:14'></a>I'm also in favor of having GNM and GNP like methods.\n\nIn above example, you use `binomial(n, p)` with `p=1/k`. If p is a float, then `binomial` will raise `TypeError: either m or x-m must be an integer`.\nYou may try this instead `sample(Subsets(range(n), k), randint(0,binomial(n, k)))`.\n\n\nObviously, the main limitation for the maximum size of a random uniform hypergraph is not what `range` can handle but the memory of your computer. `1e9` should already be beyond what you can do.\n\nDavid.",
    "created_at": "2016-11-26T09:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320399",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>I'm also in favor of having GNM and GNP like methods.

In above example, you use `binomial(n, p)` with `p=1/k`. If p is a float, then `binomial` will raise `TypeError: either m or x-m must be an integer`.
You may try this instead `sample(Subsets(range(n), k), randint(0,binomial(n, k)))`.


Obviously, the main limitation for the maximum size of a random uniform hypergraph is not what `range` can handle but the memory of your computer. `1e9` should already be beyond what you can do.

David.



---

archive/issue_comments_320400.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-26T12:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_320401.json:
```json
{
    "body": "<a id='comment:16'></a>Rebased to `develop`.",
    "created_at": "2016-11-26T12:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320401",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:16'></a>Rebased to `develop`.



---

archive/issue_comments_320402.json:
```json
{
    "body": "<a id='comment:17'></a>OK, so this is my plan for the uniform model:\n\n```python\n        if m < 0:\n            raise ValueError(\"Number of edges must be nonnegative.\")\n\n        from sage.combinat.subset import Subsets\n        all_edges = Subsets(n, k)\n        max_points = len(all_edges)\n        if m > max_points:\n            raise ValueError(\"Number of edges may not exceed {}\".format(\n                max_points))\n\n        from sage.misc.prandom import sample\n\n        try:\n            edges = sample(all_edges, m)\n\n        except OverflowError:\n            from sys import maxint\n            from sage.functions.other import binomial\n\n            if binomial(n, k) > maxint:\n                raise OverflowError(\"binomial(n, k) may not exceed {}\".format(\n                    maxint))\n\n            raise\n\n        from sage.combinat.designs.incidence_structures import IncidenceStructure\n        return IncidenceStructure(edges)\n```\n\nNow, for the binomial model, which function do you think I should use?\n\n1. Import `numpy.random.binomial`, or\n2. Implement `binomial` in `sage.misc.prandom` (either as a call to numpy, or copying code from numpy? I think it is implemented in C in numpy...)",
    "created_at": "2016-11-26T13:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320402",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:17'></a>OK, so this is my plan for the uniform model:

```python
        if m < 0:
            raise ValueError("Number of edges must be nonnegative.")

        from sage.combinat.subset import Subsets
        all_edges = Subsets(n, k)
        max_points = len(all_edges)
        if m > max_points:
            raise ValueError("Number of edges may not exceed {}".format(
                max_points))

        from sage.misc.prandom import sample

        try:
            edges = sample(all_edges, m)

        except OverflowError:
            from sys import maxint
            from sage.functions.other import binomial

            if binomial(n, k) > maxint:
                raise OverflowError("binomial(n, k) may not exceed {}".format(
                    maxint))

            raise

        from sage.combinat.designs.incidence_structures import IncidenceStructure
        return IncidenceStructure(edges)
```

Now, for the binomial model, which function do you think I should use?

1. Import `numpy.random.binomial`, or
2. Implement `binomial` in `sage.misc.prandom` (either as a call to numpy, or copying code from numpy? I think it is implemented in C in numpy...)



---

archive/issue_comments_320403.json:
```json
{
    "body": "<a id='comment:18'></a>You have only 1 call, so this should be sufficient\n\n```\nsage: from sage.misc.prandom import randint\nsage: m = randint(0, binomial(1000,17))\n```",
    "created_at": "2016-11-26T13:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320403",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>You have only 1 call, so this should be sufficient

```
sage: from sage.misc.prandom import randint
sage: m = randint(0, binomial(1000,17))
```



---

archive/issue_comments_320404.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 dcoudert]:\n> You have only 1 call, so this should be sufficient\n> \n> ```\n> sage: from sage.misc.prandom import randint\n> sage: m = randint(0, binomial(1000,17))\n> ```\n\n\nThis will not yield the current distribution. `randint` is uniform, rather than binomial.",
    "created_at": "2016-11-26T16:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320404",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:19'></a>Replying to [comment:18 dcoudert]:
> You have only 1 call, so this should be sufficient
> 
> ```
> sage: from sage.misc.prandom import randint
> sage: m = randint(0, binomial(1000,17))
> ```


This will not yield the current distribution. `randint` is uniform, rather than binomial.



---

archive/issue_comments_320405.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 pelegm]:\n> OK, so this is my plan for the uniform model:\n> [SNIP CODE]\n\n\nI would actually regroup and simplify the errors (and please in the error message start with lower case and no ponctuation at the end)\n\n```python\nfrom sage.combinat.subset import Subsets\nfrom sage.misc.prandom import sample\nall_edges = Subsets(n, k)\ntry:\n    edges = sample(all_edges, m)\nexcept OverflowError:\n    raise OverflowError(\"binomial({},{}) too large to be treated\".format(n,k))\nexcept ValueError:\n    raise ValueError(\"number of edges m must between 0 and binomial({},{})\".format(n,k))\n\nfrom sage.combinat.designs.incidence_structures import IncidenceStructure\nreturn IncidenceStructure(edges)\n```\nI don't think that the overflow in `sample` has to do with the second argument... It is raised (indirectly) in your example by\n\n```\nsage: len(Subsets(range(10000), 17))\nTraceback (most recent call last):\n...\nOverflowError: Python int too large to convert to C long\n```",
    "created_at": "2016-11-26T16:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320405",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Replying to [comment:17 pelegm]:
> OK, so this is my plan for the uniform model:
> [SNIP CODE]


I would actually regroup and simplify the errors (and please in the error message start with lower case and no ponctuation at the end)

```python
from sage.combinat.subset import Subsets
from sage.misc.prandom import sample
all_edges = Subsets(n, k)
try:
    edges = sample(all_edges, m)
except OverflowError:
    raise OverflowError("binomial({},{}) too large to be treated".format(n,k))
except ValueError:
    raise ValueError("number of edges m must between 0 and binomial({},{})".format(n,k))

from sage.combinat.designs.incidence_structures import IncidenceStructure
return IncidenceStructure(edges)
```
I don't think that the overflow in `sample` has to do with the second argument... It is raised (indirectly) in your example by

```
sage: len(Subsets(range(10000), 17))
Traceback (most recent call last):
...
OverflowError: Python int too large to convert to C long
```



---

archive/issue_comments_320406.json:
```json
{
    "body": "<a id='comment:21'></a>Great, thanks. In the meanwhile I implement the binomial random hypergraph using NumPy's `binomial` function.  If there will be any negative comments, I'll think of a new solution.",
    "created_at": "2016-11-26T17:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320406",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:21'></a>Great, thanks. In the meanwhile I implement the binomial random hypergraph using NumPy's `binomial` function.  If there will be any negative comments, I'll think of a new solution.



---

archive/issue_comments_320407.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 pelegm]:\n> Great, thanks. In the meanwhile I implement the binomial random hypergraph using NumPy's `binomial` function. If there will be any negative comments, I'll think of a new solution.\n\n\nI am good with it!",
    "created_at": "2016-11-26T17:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320407",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>Replying to [comment:21 pelegm]:
> Great, thanks. In the meanwhile I implement the binomial random hypergraph using NumPy's `binomial` function. If there will be any negative comments, I'll think of a new solution.


I am good with it!



---

archive/issue_comments_320408.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:20 vdelecroix]:\n> I would actually regroup and simplify the errors (and please in the error message start with lower case and no ponctuation at the end)\n> \n> ```python\n> from sage.combinat.subset import Subsets\n> from sage.misc.prandom import sample\n> all_edges = Subsets(n, k)\n> try:\n>     edges = sample(all_edges, m)\n> except OverflowError:\n>     raise OverflowError(\"binomial({},{}) too large to be treated\".format(n,k))\n> except ValueError:\n>     raise ValueError(\"number of edges m must between 0 and binomial({},{})\".format(n,k))\n> \n> from sage.combinat.designs.incidence_structures import IncidenceStructure\n> return IncidenceStructure(edges)\n> ```\n\n\nThe problem by this implementation is that it creates a hypergraph without the isolated vertices.  This is easy to fix, I'm on it.",
    "created_at": "2018-06-28T15:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320408",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:23'></a>Replying to [comment:20 vdelecroix]:
> I would actually regroup and simplify the errors (and please in the error message start with lower case and no ponctuation at the end)
> 
> ```python
> from sage.combinat.subset import Subsets
> from sage.misc.prandom import sample
> all_edges = Subsets(n, k)
> try:
>     edges = sample(all_edges, m)
> except OverflowError:
>     raise OverflowError("binomial({},{}) too large to be treated".format(n,k))
> except ValueError:
>     raise ValueError("number of edges m must between 0 and binomial({},{})".format(n,k))
> 
> from sage.combinat.designs.incidence_structures import IncidenceStructure
> return IncidenceStructure(edges)
> ```


The problem by this implementation is that it creates a hypergraph without the isolated vertices.  This is easy to fix, I'm on it.



---

archive/issue_comments_320409.json:
```json
{
    "body": "Set assignee to @pelegm.",
    "created_at": "2018-06-28T15:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320409",
    "user": "https://github.com/pelegm"
}
```

Set assignee to @pelegm.



---

archive/issue_comments_320410.json:
```json
{
    "body": "Changing keywords from \"hypergraph,random,days79\" to \"hypergraph,random,days79,days94\".",
    "created_at": "2018-06-28T15:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320410",
    "user": "https://github.com/pelegm"
}
```

Changing keywords from "hypergraph,random,days79" to "hypergraph,random,days79,days94".



---

archive/issue_comments_320411.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-28T15:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320411",
    "user": "https://github.com/pelegm"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320412.json:
```json
{
    "body": "<a id='comment:25'></a>New commits:",
    "created_at": "2018-06-28T15:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320412",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:25'></a>New commits:



---

archive/issue_comments_320413.json:
```json
{
    "body": "<a id='comment:26'></a>I avoided using seed since randomness is currently using numpy's, and working with two random states seems wrong.  Wasn't sure what other tests I should add.",
    "created_at": "2018-06-28T15:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320413",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:26'></a>I avoided using seed since randomness is currently using numpy's, and working with two random states seems wrong.  Wasn't sure what other tests I should add.



---

archive/issue_events_057820.json:
```json
{
    "actor": "https://github.com/pelegm",
    "created_at": "2018-06-28T15:56:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21917#event-57820"
}
```



---

archive/issue_comments_320414.json:
```json
{
    "body": "<a id='comment:28'></a>`Retrun` -> `Return`\n\nin method, `BinomialRandomUniform`, shouldn't you ensure that `m = nrn.binomial(binomial(n, k), p)` can be done / that it's not too large? or is it handled in `UniformRandomUniform` ?\n\nThe `TESTS` block is in fact a `EXAMPLES` block.\n\nWhat if `n` or `k` or `n` are values `<= 0`? You may need specific tests for theses cases.",
    "created_at": "2018-06-28T16:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320414",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:28'></a>`Retrun` -> `Return`

in method, `BinomialRandomUniform`, shouldn't you ensure that `m = nrn.binomial(binomial(n, k), p)` can be done / that it's not too large? or is it handled in `UniformRandomUniform` ?

The `TESTS` block is in fact a `EXAMPLES` block.

What if `n` or `k` or `n` are values `<= 0`? You may need specific tests for theses cases.



---

archive/issue_comments_320415.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-29T06:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320415",
    "user": "https://github.com/pelegm"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_320416.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 dcoudert]:\n> `Retrun` -> `Return`\n\n\nThanks, will fix.\n \n> in method, `BinomialRandomUniform`, shouldn't you ensure that `m = nrn.binomial(binomial(n, k), p)` can be done / that it's not too large? or is it handled in `UniformRandomUniform` ?\n\n\nIndeed, for large inputs there's some weird issue in numpy I can't really understand at the moment:\n\n```\nsage: nrn.binomial(binomial(10000, 7), 0.1)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-6-d91f2b509dee> in <module>()\n----> 1 nrn.binomial(binomial(Integer(10000), Integer(7)), RealNumber('0.1'))\n\nmtrand.pyx in mtrand.RandomState.binomial()\n\nTypeError: Cannot cast array data from dtype('O') to dtype('int64') according to the rule 'safe'\n```\n\n> The `TESTS` block is in fact a `EXAMPLES` block.\n\nOk.\n\n> What if `n` or `k` or `n` are values `<= 0`? You may need specific tests for theses cases.\n\nWill do.",
    "created_at": "2018-06-29T09:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320416",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:30'></a>Replying to [comment:28 dcoudert]:
> `Retrun` -> `Return`


Thanks, will fix.
 
> in method, `BinomialRandomUniform`, shouldn't you ensure that `m = nrn.binomial(binomial(n, k), p)` can be done / that it's not too large? or is it handled in `UniformRandomUniform` ?


Indeed, for large inputs there's some weird issue in numpy I can't really understand at the moment:

```
sage: nrn.binomial(binomial(10000, 7), 0.1)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-6-d91f2b509dee> in <module>()
----> 1 nrn.binomial(binomial(Integer(10000), Integer(7)), RealNumber('0.1'))

mtrand.pyx in mtrand.RandomState.binomial()

TypeError: Cannot cast array data from dtype('O') to dtype('int64') according to the rule 'safe'
```

> The `TESTS` block is in fact a `EXAMPLES` block.

Ok.

> What if `n` or `k` or `n` are values `<= 0`? You may need specific tests for theses cases.

Will do.



---

archive/issue_comments_320417.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-29T11:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320418.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-29T11:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320418",
    "user": "https://github.com/pelegm"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_320419.json:
```json
{
    "body": "<a id='comment:33'></a>Shouldn't we put an empty line after `TESTS::` ?\n\nOnce done (or not done if not necessary), you can set this ticket to positive review for me.",
    "created_at": "2018-06-29T21:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320419",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:33'></a>Shouldn't we put an empty line after `TESTS::` ?

Once done (or not done if not necessary), you can set this ticket to positive review for me.



---

archive/issue_comments_320420.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-30T07:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_320421.json:
```json
{
    "body": "<a id='comment:35'></a>Thanks!",
    "created_at": "2018-06-30T07:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320421",
    "user": "https://github.com/pelegm"
}
```

<a id='comment:35'></a>Thanks!



---

archive/issue_comments_320422.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-30T07:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320422",
    "user": "https://github.com/pelegm"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057821.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-03T23:40:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21917#event-57821"
}
```



---

archive/issue_comments_320423.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-03T23:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21917#issuecomment-320423",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
