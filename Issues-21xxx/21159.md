# Issue 21159: Cached generator matrices and parity check matrices should be immutable

archive/issues_020922.json:
```json
{
    "body": "In all linear code classes, constructed generator matrices and parity check matrices are cached for efficiency. However, they are often not immutable, leading to incorrect behaviour if the user inadvertently changes them.\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)\nsage: C.generator_matrix()[0,0] = 0\nsage: C.generator_matrix().row(0) in C\nFalse\n```\n\nAll such cached matrices should be made immutable by `G.set_immutable(True)`.\n\nCC:  dlucas\n\nKeywords: linear code, beginner, rd3\n\nBranch/Commit: ac0e4f91f1f964492d6c8732d3d1de80593d59da\n\nReviewer: David Lucas\n\nAuthor: Cl\u00e9ment Pernet\n\nDependencies: #21328\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21159\n\n",
    "closed_at": "2017-02-14T18:58:57Z",
    "created_at": "2016-08-03T14:04:53Z",
    "labels": [
        "component: coding theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Cached generator matrices and parity check matrices should be immutable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21159",
    "user": "https://github.com/johanrosenkilde"
}
```
In all linear code classes, constructed generator matrices and parity check matrices are cached for efficiency. However, they are often not immutable, leading to incorrect behaviour if the user inadvertently changes them.

```
sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)
sage: C.generator_matrix()[0,0] = 0
sage: C.generator_matrix().row(0) in C
False
```

All such cached matrices should be made immutable by `G.set_immutable(True)`.

CC:  dlucas

Keywords: linear code, beginner, rd3

Branch/Commit: ac0e4f91f1f964492d6c8732d3d1de80593d59da

Reviewer: David Lucas

Author: Clément Pernet

Dependencies: #21328

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21159





---

archive/issue_comments_387562.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,8 @@\n \n ```\n sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)\n-sage: M = C.generator_matrix()\n-sage: M[0,0] = 0\n-sage: M.row(0) in C\n+sage: C.generator_matrix()[0,0] = 0\n+sage: C.generator_matrix().row(0) in C\n False\n ```\n \n``````\n",
    "created_at": "2016-08-03T14:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387562",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,8 @@
 
 ```
 sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)
-sage: M = C.generator_matrix()
-sage: M[0,0] = 0
-sage: M.row(0) in C
+sage: C.generator_matrix()[0,0] = 0
+sage: C.generator_matrix().row(0) in C
 False
 ```
 
``````




---

archive/issue_comments_387563.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cpernet/immutable_generator_matrix\"",
    "created_at": "2017-02-07T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387563",
    "user": "https://github.com/ClementPernet"
}
```

Changing branch from "" to "u/cpernet/immutable_generator_matrix"



---

archive/issue_events_056447.json:
```json
{
    "actor": "https://github.com/ClementPernet",
    "created_at": "2017-02-07T16:02:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21159#event-56447"
}
```



---

archive/issue_comments_387564.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to coding theory.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387564",
    "user": "https://github.com/ClementPernet"
}
```

Changing component from PLEASE CHANGE to coding theory.



---

archive/issue_comments_387565.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387565",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_387566.json:
```json
{
    "body": "<a id='comment:3'></a>\nI processed all code classes with the following update:\n* add some ``@`cached_method` decorator when it was missing to a `generator_matrix` or a `parity_check` method\n* systematically set immutable these cached matrices\nBranch attached ready for review.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387566",
    "user": "https://github.com/ClementPernet"
}
```

<a id='comment:3'></a>
I processed all code classes with the following update:
* add some ``@`cached_method` decorator when it was missing to a `generator_matrix` or a `parity_check` method
* systematically set immutable these cached matrices
Branch attached ready for review.



---

archive/issue_comments_387567.json:
```json
{
    "body": "Changing commit from \"\" to \"d07341b9e50608753929ef79dd538cc73823f358\"",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387567",
    "user": "https://github.com/ClementPernet"
}
```

Changing commit from "" to "d07341b9e50608753929ef79dd538cc73823f358"



---

archive/issue_comments_387568.json:
```json
{
    "body": "Changing author from \"\" to \"Cl\u00e9ment Pernet\"",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387568",
    "user": "https://github.com/ClementPernet"
}
```

Changing author from "" to "Clément Pernet"



---

archive/issue_comments_387569.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-07T16:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387569",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_387570.json:
```json
{
    "body": "Changing commit from \"d07341b9e50608753929ef79dd538cc73823f358\" to \"84090767d241f9e6cd9c5f0df779b05ce746ac64\"",
    "created_at": "2017-02-07T16:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d07341b9e50608753929ef79dd538cc73823f358" to "84090767d241f9e6cd9c5f0df779b05ce746ac64"



---

archive/issue_comments_387571.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[8409076](https://git.sagemath.org/sage.git/commit/?id=84090767d241f9e6cd9c5f0df779b05ce746ac64)|`fix mistake: make the matrix immutable, not the tuple`|",
    "created_at": "2017-02-07T16:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[8409076](https://git.sagemath.org/sage.git/commit/?id=84090767d241f9e6cd9c5f0df779b05ce746ac64)|`fix mistake: make the matrix immutable, not the tuple`|



---

archive/issue_comments_387572.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-07T16:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387572",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387573.json:
```json
{
    "body": "<a id='comment:7'></a>\nTests pass and doc builds, I agree with your changes, setting to positive review.\n\nDavid",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387573",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:7'></a>
Tests pass and doc builds, I agree with your changes, setting to positive review.

David



---

archive/issue_comments_387574.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Lucas\"",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387574",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing reviewer from "" to "David Lucas"



---

archive/issue_comments_387575.json:
```json
{
    "body": "Changing keywords from \"linear code, beginner\" to \"linear code, beginner, rd3\".",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387575",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing keywords from "linear code, beginner" to "linear code, beginner, rd3".



---

archive/issue_comments_387576.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387576",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387577.json:
```json
{
    "body": "Changing branch from \"u/cpernet/immutable_generator_matrix\" to \"u/dlucas/immutable_generator_matrix\"",
    "created_at": "2017-02-07T16:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387577",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing branch from "u/cpernet/immutable_generator_matrix" to "u/dlucas/immutable_generator_matrix"



---

archive/issue_comments_387578.json:
```json
{
    "body": "Changing commit from \"84090767d241f9e6cd9c5f0df779b05ce746ac64\" to \"ac0e4f91f1f964492d6c8732d3d1de80593d59da\"",
    "created_at": "2017-02-07T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387578",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing commit from "84090767d241f9e6cd9c5f0df779b05ce746ac64" to "ac0e4f91f1f964492d6c8732d3d1de80593d59da"



---

archive/issue_comments_387579.json:
```json
{
    "body": "<a id='comment:9'></a>\nWell, reopenig this ticket to include parity check codes (#21328) in it.\nWaiting for review...\n\nDavid\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                                                                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[b77de0f](https://git.sagemath.org/sage.git/commit?id=b77de0ff1050b206b78e8b127f8dce32c0ff6c68)|`Added new file that introduces the new parity-check code class. Initializes code class, generator matrix encoder class, straightforward encoder class and minimum distance method.`|\n|[0b0d2f8](https://git.sagemath.org/sage.git/commit?id=0b0d2f82b033532d2084219b1ee1d6f0c63f45e0)|`Correcting mistakes. Two errors are still waiting for correction: ParityCheckCodeStraightforwardEncoder.unencode_nocheck and ParityCheckCodeGeneratorMatrixEncoder.__init__`|\n|[62abcd7](https://git.sagemath.org/sage.git/commit?id=62abcd791a0e09fc3c7b526b4c2c5fd3d547a9d9)|`Fixed merge conflict.`|\n|[1aa4b4e](https://git.sagemath.org/sage.git/commit?id=1aa4b4e7333d96fc39836bee509fee97cfe28dfc)|`Fixed doctests. Shorter output. Generator matrix encoder inherits from the generic one. Fixed encoders. Cleaned the code.`|\n|[64ee227](https://git.sagemath.org/sage.git/commit?id=64ee2275cae89d7712e295b44048ae619f313bbd)|`Merged ticket #21328 in`|\n|[ac0e4f9](https://git.sagemath.org/sage.git/commit?id=ac0e4f91f1f964492d6c8732d3d1de80593d59da)|`Immutable generator matrix for parity codes`|",
    "created_at": "2017-02-07T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387579",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:9'></a>
Well, reopenig this ticket to include parity check codes (#21328) in it.
Waiting for review...

David

---
New commits:
|                                                                                                                                          |                                                                                                                                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[b77de0f](https://git.sagemath.org/sage.git/commit?id=b77de0ff1050b206b78e8b127f8dce32c0ff6c68)|`Added new file that introduces the new parity-check code class. Initializes code class, generator matrix encoder class, straightforward encoder class and minimum distance method.`|
|[0b0d2f8](https://git.sagemath.org/sage.git/commit?id=0b0d2f82b033532d2084219b1ee1d6f0c63f45e0)|`Correcting mistakes. Two errors are still waiting for correction: ParityCheckCodeStraightforwardEncoder.unencode_nocheck and ParityCheckCodeGeneratorMatrixEncoder.__init__`|
|[62abcd7](https://git.sagemath.org/sage.git/commit?id=62abcd791a0e09fc3c7b526b4c2c5fd3d547a9d9)|`Fixed merge conflict.`|
|[1aa4b4e](https://git.sagemath.org/sage.git/commit?id=1aa4b4e7333d96fc39836bee509fee97cfe28dfc)|`Fixed doctests. Shorter output. Generator matrix encoder inherits from the generic one. Fixed encoders. Cleaned the code.`|
|[64ee227](https://git.sagemath.org/sage.git/commit?id=64ee2275cae89d7712e295b44048ae619f313bbd)|`Merged ticket #21328 in`|
|[ac0e4f9](https://git.sagemath.org/sage.git/commit?id=ac0e4f91f1f964492d6c8732d3d1de80593d59da)|`Immutable generator matrix for parity codes`|



---

archive/issue_comments_387580.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-02-07T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387580",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_387581.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21328\"",
    "created_at": "2017-02-07T16:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387581",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing dependencies from "" to "#21328"



---

archive/issue_comments_387582.json:
```json
{
    "body": "<a id='comment:11'></a>\nPositive review to the merge and last commit by dlucas.",
    "created_at": "2017-02-07T16:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387582",
    "user": "https://github.com/ClementPernet"
}
```

<a id='comment:11'></a>
Positive review to the merge and last commit by dlucas.



---

archive/issue_comments_387583.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-07T16:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387583",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387584.json:
```json
{
    "body": "Changing branch from \"u/dlucas/immutable_generator_matrix\" to \"ac0e4f91f1f964492d6c8732d3d1de80593d59da\"",
    "created_at": "2017-02-14T18:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387584",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dlucas/immutable_generator_matrix" to "ac0e4f91f1f964492d6c8732d3d1de80593d59da"



---

archive/issue_events_056448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-14T18:58:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21159#event-56448"
}
```



---

archive/issue_comments_387585.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-14T18:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-387585",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
