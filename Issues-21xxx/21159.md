# Issue 21159: Cached generator matrices and parity check matrices should be immutable

archive/issues_020922.json:
```json
{
    "body": "In all linear code classes, constructed generator matrices and parity check matrices are cached for efficiency. However, they are often not immutable, leading to incorrect behaviour if the user inadvertently changes them.\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)\nsage: C.generator_matrix()[0,0] = 0\nsage: C.generator_matrix().row(0) in C\nFalse\n```\n\nAll such cached matrices should be made immutable by `G.set_immutable(True)`.\n\nCC:  dlucas\n\nKeywords: linear code, beginner, rd3\n\nBranch/Commit: ac0e4f91f1f964492d6c8732d3d1de80593d59da\n\nReviewer: David Lucas\n\nAuthor: Cl\u00e9ment Pernet\n\nDependencies: #21328\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21159\n\n",
    "closed_at": "2017-02-14T18:58:57Z",
    "created_at": "2016-08-03T14:04:53Z",
    "labels": [
        "component: coding theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Cached generator matrices and parity check matrices should be immutable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21159",
    "user": "https://github.com/johanrosenkilde"
}
```
In all linear code classes, constructed generator matrices and parity check matrices are cached for efficiency. However, they are often not immutable, leading to incorrect behaviour if the user inadvertently changes them.

```
sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)
sage: C.generator_matrix()[0,0] = 0
sage: C.generator_matrix().row(0) in C
False
```

All such cached matrices should be made immutable by `G.set_immutable(True)`.

CC:  dlucas

Keywords: linear code, beginner, rd3

Branch/Commit: ac0e4f91f1f964492d6c8732d3d1de80593d59da

Reviewer: David Lucas

Author: Cl√©ment Pernet

Dependencies: #21328

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21159





---

archive/issue_comments_307790.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -2,15 +2,12 @@\n \n \\`\\`\\`\n sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)\n-sage: M = C.generator_matrix()\n-sage: M[0,0] = 0\n-sage: M.row(0) in C\n+sage: C.generator_matrix()[0,0] = 0\n+sage: C.generator_matrix().row(0) in C\n False\n \\`\\`\\`\n \n All such cached matrices should be made immutable by \\`G.set_immutable(True)\\`.\n-\n-Keywords: linear code, beginner\n \n Comment: 1\n \n```\n",
    "created_at": "2016-08-03T14:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307790",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
```diff
--- 
+++ 
@@ -2,15 +2,12 @@
 
 \`\`\`
 sage: C = codes.GeneralizedReedSolomonCode(GF(7).list(), 3)
-sage: M = C.generator_matrix()
-sage: M[0,0] = 0
-sage: M.row(0) in C
+sage: C.generator_matrix()[0,0] = 0
+sage: C.generator_matrix().row(0) in C
 False
 \`\`\`
 
 All such cached matrices should be made immutable by \`G.set_immutable(True)\`.
-
-Keywords: linear code, beginner
 
 Comment: 1
 
```




---

archive/issue_events_056447.json:
```json
{
    "actor": "https://github.com/ClementPernet",
    "created_at": "2017-02-07T16:02:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21159#event-56447"
}
```



---

archive/issue_comments_307791.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to coding theory.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307791",
    "user": "https://github.com/ClementPernet"
}
```

Changing component from PLEASE CHANGE to coding theory.



---

archive/issue_comments_307792.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307792",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_307793.json:
```json
{
    "body": "<a id='comment:3'></a>I processed all code classes with the following update:\n* add some ``@`cached_method` decorator when it was missing to a `generator_matrix` or a `parity_check` method\n* systematically set immutable these cached matrices\nBranch attached ready for review.",
    "created_at": "2017-02-07T16:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307793",
    "user": "https://github.com/ClementPernet"
}
```

<a id='comment:3'></a>I processed all code classes with the following update:
* add some ``@`cached_method` decorator when it was missing to a `generator_matrix` or a `parity_check` method
* systematically set immutable these cached matrices
Branch attached ready for review.



---

archive/issue_comments_307794.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-07T16:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307794",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_307795.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-07T16:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_307796.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-07T16:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307796",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_307797.json:
```json
{
    "body": "<a id='comment:7'></a>Tests pass and doc builds, I agree with your changes, setting to positive review.\n\nDavid",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307797",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:7'></a>Tests pass and doc builds, I agree with your changes, setting to positive review.

David



---

archive/issue_comments_307798.json:
```json
{
    "body": "Changing keywords from \"linear code, beginner\" to \"linear code, beginner, rd3\".",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307798",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing keywords from "linear code, beginner" to "linear code, beginner, rd3".



---

archive/issue_comments_307799.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-07T16:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307799",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_307800.json:
```json
{
    "body": "<a id='comment:9'></a>Well, reopenig this ticket to include parity check codes (#21328) in it.\nWaiting for review...\n\nDavid\n\n---\nNew commits:",
    "created_at": "2017-02-07T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307800",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:9'></a>Well, reopenig this ticket to include parity check codes (#21328) in it.
Waiting for review...

David

---
New commits:



---

archive/issue_comments_307801.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-02-07T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307801",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_307802.json:
```json
{
    "body": "<a id='comment:11'></a>Positive review to the merge and last commit by dlucas.",
    "created_at": "2017-02-07T16:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307802",
    "user": "https://github.com/ClementPernet"
}
```

<a id='comment:11'></a>Positive review to the merge and last commit by dlucas.



---

archive/issue_comments_307803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-07T16:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307803",
    "user": "https://github.com/ClementPernet"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_056448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-14T18:58:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21159#event-56448"
}
```



---

archive/issue_comments_307804.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-14T18:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21159#issuecomment-307804",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
