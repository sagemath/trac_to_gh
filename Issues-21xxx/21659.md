# Issue 21659: AsymptoticRing.coefficients_of_generating_function: hardcoded exponents in QQ

archive/issues_021422.json:
```json
{
    "body": "The method `AsymptoticRing.coefficients_of_generating_function` enforces exponents to be in `QQ`:\n\n```\nsage: R.<n> = AsymptoticRing('n^QQbar', QQbar)\nsage: R.coefficients_of_generating_function(lambda z: (1-z)^(1/2), [1], 1)\n-1/2/sqrt(pi)*n^(-3/2) + O(n^(-5/2))\nsage: R.coefficients_of_generating_function(lambda z: (1-z)^QQbar(sqrt(2)), [1], 1)\nTraceback (most recent call last):\n...\nValueError: Cannot include T^(-1.414213562373095?) with parent Exact Term Monoid\nT^(Algebraic Field) * log(T)^(Algebraic Field) with coefficients in Symbolic\nRing in Asymptotic Ring <T^QQ * log(T)^QQ> over Symbolic Ring\n> *previous* ValueError: T^(-1.414213562373095?) is not in Growth Group T^QQ * log(T)^QQ\n```\n\nThe problem is that the singular expansion is always constructed in\n\n```\nA = AsymptoticRing('T^QQ * log(T)^QQ', coefficient_ring=SR,\n                   default_prec=precision)\n```\n\n**CC:**  @behackl @dkrenn\n\n**Keywords:** singularity analysis\n\n**Branch:** [u/dkrenn/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/21659/singularity-analysis-qqbar)\n\n**Commit:** [71af37801a7ec5ababcbb54e2b24f6bc8321e80b](https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b)\n\n**Work Issues:** remove fix for QQbar(1/2)\n\n**Author:** Clemens Heuberger\n\n**Status:** needs_work\n\n**Dependencies:** #21963\n\nIssue created by migration from https://trac.sagemath.org/ticket/21659\n\n",
    "created_at": "2016-10-07T09:51:33Z",
    "labels": [
        "component: asymptotic expansions",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "AsymptoticRing.coefficients_of_generating_function: hardcoded exponents in QQ",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21659",
    "user": "https://github.com/cheuberg"
}
```
The method `AsymptoticRing.coefficients_of_generating_function` enforces exponents to be in `QQ`:

```
sage: R.<n> = AsymptoticRing('n^QQbar', QQbar)
sage: R.coefficients_of_generating_function(lambda z: (1-z)^(1/2), [1], 1)
-1/2/sqrt(pi)*n^(-3/2) + O(n^(-5/2))
sage: R.coefficients_of_generating_function(lambda z: (1-z)^QQbar(sqrt(2)), [1], 1)
Traceback (most recent call last):
...
ValueError: Cannot include T^(-1.414213562373095?) with parent Exact Term Monoid
T^(Algebraic Field) * log(T)^(Algebraic Field) with coefficients in Symbolic
Ring in Asymptotic Ring <T^QQ * log(T)^QQ> over Symbolic Ring
> *previous* ValueError: T^(-1.414213562373095?) is not in Growth Group T^QQ * log(T)^QQ
```

The problem is that the singular expansion is always constructed in

```
A = AsymptoticRing('T^QQ * log(T)^QQ', coefficient_ring=SR,
                   default_prec=precision)
```

**CC:**  @behackl @dkrenn

**Keywords:** singularity analysis

**Branch:** [u/dkrenn/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/21659/singularity-analysis-qqbar)

**Commit:** [71af37801a7ec5ababcbb54e2b24f6bc8321e80b](https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b)

**Work Issues:** remove fix for QQbar(1/2)

**Author:** Clemens Heuberger

**Status:** needs_work

**Dependencies:** #21963

Issue created by migration from https://trac.sagemath.org/ticket/21659





---

archive/issue_comments_382068.json:
```json
{
    "body": "**Branch:** [u/cheuberg/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/21659/singularity-analysis-qqbar)",
    "created_at": "2016-10-07T11:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382068",
    "user": "https://github.com/cheuberg"
}
```

**Branch:** [u/cheuberg/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/21659/singularity-analysis-qqbar)



---

archive/issue_comments_382069.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382069",
    "user": "https://github.com/cheuberg"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_382070.json:
```json
{
    "body": "**Commit:** [382abb8973956a6816e199d20016966959f37c6c](https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c)",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382070",
    "user": "https://github.com/cheuberg"
}
```

**Commit:** [382abb8973956a6816e199d20016966959f37c6c](https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c)



---

archive/issue_comments_382071.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere is a first version of a fix. Unfortunately, some workaround is needed due to the fact that `gamma(QQbar(1/2))` does not work, see [post on sage-devel](https://groups.google.com/d/msg/sage-devel/jqs3LNeKq5M/v24xFt1zAgAJ).\n\nWhat I do not understand is that\n\n```\nsage: B.<n> = AsymptoticRing('n^QQbar', SR)\nsage: B.coefficients_of_generating_function(\n....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))\n```\nworks but\n\n```\nsage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)\nsage: B.coefficients_of_generating_function(\n....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\nTraceback (most recent call last)\n...\nTypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n>> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.\n>>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).\n>>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.\n>>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field\n```\ndoes not.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c\">382abb8</a></td><td><code>Trac #21659: Singularity Analysis with exponents from QQbar</code></td></tr></table>\n",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382071",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:2'></a>
Here is a first version of a fix. Unfortunately, some workaround is needed due to the fact that `gamma(QQbar(1/2))` does not work, see [post on sage-devel](https://groups.google.com/d/msg/sage-devel/jqs3LNeKq5M/v24xFt1zAgAJ).

What I do not understand is that

```
sage: B.<n> = AsymptoticRing('n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
```
works but

```
sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
Traceback (most recent call last)
...
TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
>> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
>>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
>>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
>>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
```
does not.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c">382abb8</a></td><td><code>Trac #21659: Singularity Analysis with exponents from QQbar</code></td></tr></table>




---

archive/issue_comments_382072.json:
```json
{
    "body": "**Author:** Clemens Heuberger",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382072",
    "user": "https://github.com/cheuberg"
}
```

**Author:** Clemens Heuberger



---

archive/issue_comments_382073.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [cheuberg](#comment%3A2):\n> What I do not understand is that\n> \n> ```\n> sage: B.<n> = AsymptoticRing('n^QQbar', SR)\n> sage: B.coefficients_of_generating_function(\n> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n> 0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))\n> ```\n> works but\n> \n> ```\n> sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)\n> sage: B.coefficients_of_generating_function(\n> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n> Traceback (most recent call last)\n> ...\n> TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> > *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> >> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.\n> >>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).\n> >>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.\n> >>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field\n> ```\n> does not.\n\n\nThis is independent of singularity analysis; see #21665.",
    "created_at": "2016-10-08T05:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382073",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:3'></a>
Replying to [cheuberg](#comment%3A2):
> What I do not understand is that
> 
> ```
> sage: B.<n> = AsymptoticRing('n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> 0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
> ```
> works but
> 
> ```
> sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> Traceback (most recent call last)
> ...
> TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> > *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> >> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
> >>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
> >>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
> >>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
> ```
> does not.


This is independent of singularity analysis; see #21665.



---

archive/issue_comments_382074.json:
```json
{
    "body": "**Work_Issues:** remove fix for QQbar(1/2)",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382074",
    "user": "https://github.com/cheuberg"
}
```

**Work_Issues:** remove fix for QQbar(1/2)



---

archive/issue_comments_382075.json:
```json
{
    "body": "**Dependencies:** #21963",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382075",
    "user": "https://github.com/cheuberg"
}
```

**Dependencies:** #21963



---

archive/issue_comments_382076.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382076",
    "user": "https://github.com/cheuberg"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_382077.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe problem with QQbar(1/2) seems to be fixed in https://github.com/pynac/pynac/issues/201 ,\nso wait for #21963.",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382077",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:4'></a>
The problem with QQbar(1/2) seems to be fixed in https://github.com/pynac/pynac/issues/201 ,
so wait for #21963.



---

archive/issue_comments_382078.json:
```json
{
    "body": "**Changing branch** from \"[u/cheuberg/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/21659/singularity-analysis-qqbar)\" to \"[u/dkrenn/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/21659/singularity-analysis-qqbar)\".",
    "created_at": "2019-06-07T16:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382078",
    "user": "https://github.com/dkrenn"
}
```

**Changing branch** from "[u/cheuberg/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/21659/singularity-analysis-qqbar)" to "[u/dkrenn/21659/singularity-analysis-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/21659/singularity-analysis-qqbar)".



---

archive/issue_comments_382079.json:
```json
{
    "body": "**Changing commit** from \"[382abb8973956a6816e199d20016966959f37c6c](https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c)\" to \"[71af37801a7ec5ababcbb54e2b24f6bc8321e80b](https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b)\".",
    "created_at": "2019-06-07T16:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382079",
    "user": "https://github.com/dkrenn"
}
```

**Changing commit** from "[382abb8973956a6816e199d20016966959f37c6c](https://github.com/sagemath/sagetrac-mirror/commit/382abb8973956a6816e199d20016966959f37c6c)" to "[71af37801a7ec5ababcbb54e2b24f6bc8321e80b](https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b)".



---

archive/issue_comments_382080.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged in [SageMath](SageMath) 8.6\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b\">71af378</a></td><td><code>Merge tag '8.6' into u/cheuberg/21659/singularity-analysis-qqbar</code></td></tr></table>\n",
    "created_at": "2019-06-07T16:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21659#issuecomment-382080",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:6'></a>
Merged in [SageMath](SageMath) 8.6

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71af37801a7ec5ababcbb54e2b24f6bc8321e80b">71af378</a></td><td><code>Merge tag '8.6' into u/cheuberg/21659/singularity-analysis-qqbar</code></td></tr></table>

