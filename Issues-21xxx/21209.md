# Issue 21209: Update FriCAS to 1.2.7 (current)

archive/issues_020972.json:
```json
{
    "assignees": [],
    "body": "subject says it all, see http://fricas.sourceforge.net/\n\nThe current version in Sage, 1.2.4, does no longer build with our version of ECL.  But 1.2.7 still has the same problem, so needs to get patched for it, replacing `uffi:` by `ffi:` in `src/lisp/fricas-lisp.lisp`.\n\n---\n\n**Upstream source tarball:** \\\\ [https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2](https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2)\n\n(with ads, but automatic download after a few seconds)\n\nCC:  @dkrenn @mantepse @hemmecke\n\nKeywords: **uffi ECL**\n\nBranch: **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Martin Rubey, Leif Leonhardy**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **packages: experimental**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21209_\n\n",
    "closed_at": "2016-08-15T18:27:13Z",
    "created_at": "2016-08-10T16:52:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20experimental",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update FriCAS to 1.2.7 (current)",
    "type": "issue",
    "updated_at": "2016-09-08T20:31:09Z",
    "url": "https://github.com/sagemath/sage/issues/21209",
    "user": "https://github.com/dimpase"
}
```
subject says it all, see http://fricas.sourceforge.net/

The current version in Sage, 1.2.4, does no longer build with our version of ECL.  But 1.2.7 still has the same problem, so needs to get patched for it, replacing `uffi:` by `ffi:` in `src/lisp/fricas-lisp.lisp`.

---

**Upstream source tarball:** \\ [https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2](https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2)

(with ads, but automatic download after a few seconds)

CC:  @dkrenn @mantepse @hemmecke

Keywords: **uffi ECL**

Branch: **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Martin Rubey, Leif Leonhardy**

Author: **Dima Pasechnik**

Component: **packages: experimental**

_Issue created by migration from https://trac.sagemath.org/ticket/21209_





---

archive/issue_events_298228.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-10T16:52:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298228"
}
```



---

archive/issue_events_298229.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-10T16:52:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20experimental",
    "label_color": "000080",
    "label_name": "c: packages: experimental",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298229"
}
```



---

archive/issue_events_298230.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-10T16:52:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298230"
}
```



---

archive/issue_events_298231.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-10T16:52:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298231"
}
```



---

archive/issue_comments_309574.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n subject says it all, see http://fricas.sourceforge.net/\n+\n+The current version in Sage, 1.2.4, does no longer build with our version of ECL.\n+\n+---\n+\n+**Upstream source tarball:** \\\\ [https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2](https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2)\n+\n+(with ads, but automatic download after a few seconds)\n``````\n",
    "created_at": "2016-08-11T18:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309574",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,9 @@
 subject says it all, see http://fricas.sourceforge.net/
+
+The current version in Sage, 1.2.4, does no longer build with our version of ECL.
+
+---
+
+**Upstream source tarball:** \\ [https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2](https://sourceforge.net/projects/fricas/files/fricas/1.2.7/fricas-1.2.7-full.tar.bz2)
+
+(with ads, but automatic download after a few seconds)
``````




---

archive/issue_events_298232.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-11T18:52:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "title_is": "Update FriCAS to 1.2.7 (current)",
    "title_was": "update fricas to 1.2.7 (current)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298232"
}
```



---

archive/issue_comments_309575.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI am currently rebuilding sage-develop...\n\nDo I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?",
    "created_at": "2016-08-11T19:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309575",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">comment:4</div>

I am currently rebuilding sage-develop...

Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?



---

archive/issue_comments_309576.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@mantepse](#comment:4):\n> Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?\n\nWould make sense.\n\nNot sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.\n\nIf you do, you could create an `spkg-src` script, or at least document what you did in *\"Special !Update/Build Instructions\"* in `SPKG.txt`.",
    "created_at": "2016-08-11T19:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309576",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@mantepse](#comment:4):
> Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?

Would make sense.

Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.

If you do, you could create an `spkg-src` script, or at least document what you did in *"Special !Update/Build Instructions"* in `SPKG.txt`.



---

archive/issue_comments_309577.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nMore precisely, `fricas-VERSION-full.tar.bz2` in `checksums.ini` is supposed to work as well.",
    "created_at": "2016-08-11T19:34:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309577",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

More precisely, `fricas-VERSION-full.tar.bz2` in `checksums.ini` is supposed to work as well.



---

archive/issue_comments_309578.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nexttime](#comment:5):\n> Replying to [@mantepse](#comment:4):\n> > Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?\n\n> \n> Would make sense.\n\n>\n> Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.\n\nAs far as I know: no, the things included in the \"full\" tarball are precisely those needed.\n\nUnfortunately, build with ecl fails for the same reason as reported.",
    "created_at": "2016-08-11T19:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309578",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nexttime](#comment:5):
> Replying to [@mantepse](#comment:4):
> > Do I understand correctly that I should rename ```fricas-1.2.7-full.tar.bz2``` to ```fricas-1.2.7.tar.bz2``` before putting it into the ```upstream``` directory?

> 
> Would make sense.

>
> Not sure if we can/should strip (=repackage) the tarball anyway; the description at least sounds as if there were things included we don't need for Sage / to ship.  But it isn't huge either.

As far as I know: no, the things included in the "full" tarball are precisely those needed.

Unfortunately, build with ecl fails for the same reason as reported.



---

archive/issue_comments_309579.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFrom Dima via sage-devel:\n\nECL does not use uffi: prefix any more, it's ffi: instead, according to their docs.\nReplacing all the  uffi: with ffi: in src/lisp/fricas-lisp.lisp makes compiler happy.\n\nCurrently running the build, takes a while...",
    "created_at": "2016-08-11T19:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309579",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:8" align="right">comment:8</div>

From Dima via sage-devel:

ECL does not use uffi: prefix any more, it's ffi: instead, according to their docs.
Replacing all the  uffi: with ffi: in src/lisp/fricas-lisp.lisp makes compiler happy.

Currently running the build, takes a while...



---

archive/issue_comments_309580.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nDima said the following works:\n\n```diff\ndiff -Naur fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp fricas-1.2.7/src/lisp/fricas-lisp.lisp\n--- fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp\t2015-09-25 02:06:15.000000000 +0200\n+++ fricas-1.2.7/src/lisp/fricas-lisp.lisp\t2016-08-11 21:57:25.840863287 +0200\n@@ -556,10 +556,10 @@\n                     (dolist (el strs)\n                         (setf wrapper `(FFI:WITH-CSTRING ,el ,wrapper)))\n                     (setf wrapper `(defun ,name ,largs ,wrapper))\n-                    `(progn (uffi:def-function (,c-name ,sym)\n+                    `(progn (ffi:def-function (,c-name ,sym)\n                                 ,fargs :returning ,l-ret)\n                             ,wrapper))\n-                `(uffi:def-function (,c-name ,name)\n+                `(ffi:def-function (,c-name ,name)\n                      ,fargs :returning ,l-ret)))))\n \n (defmacro fricas-foreign-call (name c-name return-type &rest arguments)\n@@ -788,14 +788,14 @@\n #+:ecl\n (progn\n \n-(uffi:def-function (\"sock_get_string_buf\" sock_get_string_buf_wrapper)\n+(ffi:def-function (\"sock_get_string_buf\" sock_get_string_buf_wrapper)\n                    ((purpose :int) (buf (:array :unsigned-char 10000)) (len :int))\n                    :returning :void)\n \n (defun |sockGetStringFrom| (purpose)\n-    (uffi:with-foreign-object (buf '(:array :unsigned-char 10000))\n+    (ffi:with-foreign-object (buf '(:array :unsigned-char 10000))\n         (sock_get_string_buf_wrapper purpose buf 10000)\n-        (uffi:convert-from-foreign-string buf)))\n+        (ffi:convert-from-foreign-string buf)))\n \n )\n \n@@ -825,7 +825,7 @@\n   (LISP::defentry |makedir| (LISP::string)         (LISP::int \"makedir\")))\n \n #+:ecl\n-(uffi:def-function (\"directoryp\" raw_file_kind)\n+(ffi:def-function (\"directoryp\" raw_file_kind)\n                    ((arg :cstring))\n                    :returning :int)\n #+:ecl\n@@ -834,7 +834,7 @@\n            (raw_file_kind cname)))\n \n #+:ecl\n-(uffi:def-function (\"makedir\" raw_makedir)\n+(ffi:def-function (\"makedir\" raw_makedir)\n                    ((arg :cstring))\n                    :returning :int)\n \n```\n\n(`sed -i 's/uffi:/ffi:/' fricas-1.2.7/src/lisp/fricas-lisp.lisp`)",
    "created_at": "2016-08-11T19:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309580",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

Dima said the following works:

```diff
diff -Naur fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp fricas-1.2.7/src/lisp/fricas-lisp.lisp
--- fricas-1.2.7.orig/src/lisp/fricas-lisp.lisp	2015-09-25 02:06:15.000000000 +0200
+++ fricas-1.2.7/src/lisp/fricas-lisp.lisp	2016-08-11 21:57:25.840863287 +0200
@@ -556,10 +556,10 @@
                     (dolist (el strs)
                         (setf wrapper `(FFI:WITH-CSTRING ,el ,wrapper)))
                     (setf wrapper `(defun ,name ,largs ,wrapper))
-                    `(progn (uffi:def-function (,c-name ,sym)
+                    `(progn (ffi:def-function (,c-name ,sym)
                                 ,fargs :returning ,l-ret)
                             ,wrapper))
-                `(uffi:def-function (,c-name ,name)
+                `(ffi:def-function (,c-name ,name)
                      ,fargs :returning ,l-ret)))))
 
 (defmacro fricas-foreign-call (name c-name return-type &rest arguments)
@@ -788,14 +788,14 @@
 #+:ecl
 (progn
 
-(uffi:def-function ("sock_get_string_buf" sock_get_string_buf_wrapper)
+(ffi:def-function ("sock_get_string_buf" sock_get_string_buf_wrapper)
                    ((purpose :int) (buf (:array :unsigned-char 10000)) (len :int))
                    :returning :void)
 
 (defun |sockGetStringFrom| (purpose)
-    (uffi:with-foreign-object (buf '(:array :unsigned-char 10000))
+    (ffi:with-foreign-object (buf '(:array :unsigned-char 10000))
         (sock_get_string_buf_wrapper purpose buf 10000)
-        (uffi:convert-from-foreign-string buf)))
+        (ffi:convert-from-foreign-string buf)))
 
 )
 
@@ -825,7 +825,7 @@
   (LISP::defentry |makedir| (LISP::string)         (LISP::int "makedir")))
 
 #+:ecl
-(uffi:def-function ("directoryp" raw_file_kind)
+(ffi:def-function ("directoryp" raw_file_kind)
                    ((arg :cstring))
                    :returning :int)
 #+:ecl
@@ -834,7 +834,7 @@
            (raw_file_kind cname)))
 
 #+:ecl
-(uffi:def-function ("makedir" raw_makedir)
+(ffi:def-function ("makedir" raw_makedir)
                    ((arg :cstring))
                    :returning :int)
 
```

(`sed -i 's/uffi:/ffi:/' fricas-1.2.7/src/lisp/fricas-lisp.lisp`)



---

archive/issue_comments_309581.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n subject says it all, see http://fricas.sourceforge.net/\n \n-The current version in Sage, 1.2.4, does no longer build with our version of ECL.\n+The current version in Sage, 1.2.4, does no longer build with our version of ECL.  But 1.2.7 still has the same problem, so needs to get patched for it, replacing `uffi:` by `ffi:` in `src/lisp/fricas-lisp.lisp`.\n \n ---\n \n``````\n",
    "created_at": "2016-08-11T20:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309581",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 subject says it all, see http://fricas.sourceforge.net/
 
-The current version in Sage, 1.2.4, does no longer build with our version of ECL.
+The current version in Sage, 1.2.4, does no longer build with our version of ECL.  But 1.2.7 still has the same problem, so needs to get patched for it, replacing `uffi:` by `ffi:` in `src/lisp/fricas-lisp.lisp`.
 
 ---
 
``````




---

archive/issue_comments_309582.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI can confirm this, the build just finished.  I am now looking for tests.",
    "created_at": "2016-08-11T20:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309582",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:11" align="right">comment:11</div>

I can confirm this, the build just finished.  I am now looking for tests.



---

archive/issue_comments_309583.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2016-08-11T20:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309583",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_309584.json:
```json
{
    "body": "Commit: **[`68bbc30`](https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c)**",
    "created_at": "2016-08-11T20:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309584",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`68bbc30`](https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c)**



---

archive/issue_comments_309585.json:
```json
{
    "body": "Branch: **[u/dimpase/fricas127](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fricas127)**",
    "created_at": "2016-08-11T20:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309585",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/fricas127](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fricas127)**



---

archive/issue_comments_309586.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c\">68bbc30</a></td><td><code>updated version and added patch</code></td></tr></table>\n",
    "created_at": "2016-08-11T20:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309586",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c">68bbc30</a></td><td><code>updated version and added patch</code></td></tr></table>




---

archive/issue_comments_309587.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2016-08-11T20:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309587",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_events_298233.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-08-11T20:41:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298233"
}
```



---

archive/issue_comments_309588.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHere is a discussion on [FriCAS list](https://groups.google.com/d/msg/fricas-devel/tko6MdXgFNM/fRb_JgGhCAAJ).\nI take it that they see this as a bug. Perhaps there is a more intelligent way to fix this, more CL-y one...",
    "created_at": "2016-08-11T20:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309588",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Here is a discussion on [FriCAS list](https://groups.google.com/d/msg/fricas-devel/tko6MdXgFNM/fRb_JgGhCAAJ).
I take it that they see this as a bug. Perhaps there is a more intelligent way to fix this, more CL-y one...



---

archive/issue_comments_309589.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2016-08-11T20:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309589",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_309590.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAs far as I can see fix is CL-y, because it is fixing precisely the ecl-dependend functions...\n\nI am still looking into the tests, but I suppose fixing them belongs to a different ticket.\n\nCan I give this positive review?  (It works on my computer...)",
    "created_at": "2016-08-11T20:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309590",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:14" align="right">comment:14</div>

As far as I can see fix is CL-y, because it is fixing precisely the ecl-dependend functions...

I am still looking into the tests, but I suppose fixing them belongs to a different ticket.

Can I give this positive review?  (It works on my computer...)



---

archive/issue_comments_309591.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n`SPKG.txt` should get fixed and updated (as the patch has no header)... ;-)\n\nI'd also add `[ -r \"$patch\" ] && ...` as usual.\n\nIs there a test suite?\n\nDoes `make install` install the docs as well?  Do we otherwise want to install them, and if so, how, where?",
    "created_at": "2016-08-11T20:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309591",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

`SPKG.txt` should get fixed and updated (as the patch has no header)... ;-)

I'd also add `[ -r "$patch" ] && ...` as usual.

Is there a test suite?

Does `make install` install the docs as well?  Do we otherwise want to install them, and if so, how, where?



---

archive/issue_comments_309592.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nP.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.",
    "created_at": "2016-08-11T20:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309592",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">comment:16</div>

P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.



---

archive/issue_comments_309593.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@nexttime](#comment:16):\n> P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.\n\nNeedless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)",
    "created_at": "2016-08-11T21:01:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309593",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@nexttime](#comment:16):
> P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.

Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)



---

archive/issue_comments_309594.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment:17):\n> Replying to [@nexttime](#comment:16):\n> > P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.\n\n> \n> Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)\n\nThere are more elsewhere.\n\n(I assume you **did** specify `--optional=fricas`... ;-) )",
    "created_at": "2016-08-11T21:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309594",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment:17):
> Replying to [@nexttime](#comment:16):
> > P.S.:  I'd also say fixing (now?) broken doctests belongs to updating the package.

> 
> Needless to say, all the 44 tests from `src/sage/interfaces/fricas.py` pass for me :-)

There are more elsewhere.

(I assume you **did** specify `--optional=fricas`... ;-) )



---

archive/issue_comments_309595.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThere is one trivial fix in ```axiom.py``` (line 686 should not be \"\\leqno(11)\" but rather \"...\"), but the conversion of even basic fricas types to sage types is broken.\n\nCan anybody tell me where the method ``variables`` comes from (is implemented):\n\n```\nsage: a = fricas(1/2)\nsage: a.variables()\n[]\n```\n?",
    "created_at": "2016-08-11T21:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309595",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:19" align="right">comment:19</div>

There is one trivial fix in ```axiom.py``` (line 686 should not be "\leqno(11)" but rather "..."), but the conversion of even basic fricas types to sage types is broken.

Can anybody tell me where the method ``variables`` comes from (is implemented):

```
sage: a = fricas(1/2)
sage: a.variables()
[]
```
?



---

archive/issue_comments_309596.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nJust found out, it's provided by FriCAS.  But it's use is very likely abuse.",
    "created_at": "2016-08-11T21:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309596",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:20" align="right">comment:20</div>

Just found out, it's provided by FriCAS.  But it's use is very likely abuse.



---

archive/issue_comments_309597.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d\">2ee5bbf</a></td><td><code>doctests fixes, except fricas(1/2).sage() in axiom.py</code></td></tr></table>\n",
    "created_at": "2016-08-11T22:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309597",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d">2ee5bbf</a></td><td><code>doctests fixes, except fricas(1/2).sage() in axiom.py</code></td></tr></table>




---

archive/issue_comments_309598.json:
```json
{
    "body": "Changed commit from **[`68bbc30`](https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c)** to **[`2ee5bbf`](https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d)**",
    "created_at": "2016-08-11T22:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309598",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`68bbc30`](https://github.com/sagemath/sagetrac-mirror/commit/68bbc3049d54d012b079ca15bef896b771bf7c1c)** to **[`2ee5bbf`](https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d)**



---

archive/issue_comments_309599.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nFor `fricas(1/2).sage()`, the fix looks doable, one needs to deal with `FriCAS`'s type Fraction. But the following is a bit weird:\n\n```\nsage: fricas(1/x).type()\nFraction(Polynomial(Integer))\nsage: fricas(1/x).denominator()\nx\nsage: fricas(1/x).numerator()\n1\nsage: fricas(1/x).numerator().type()\nFraction(Polynomial(Integer))\nsage: fricas(1/x).denominator().type()\nFraction(Polynomial(Integer))\n```\nWhy do types of numerators and denominator are still `Fraction(...)`? This does not look right.",
    "created_at": "2016-08-11T22:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309599",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

For `fricas(1/2).sage()`, the fix looks doable, one needs to deal with `FriCAS`'s type Fraction. But the following is a bit weird:

```
sage: fricas(1/x).type()
Fraction(Polynomial(Integer))
sage: fricas(1/x).denominator()
x
sage: fricas(1/x).numerator()
1
sage: fricas(1/x).numerator().type()
Fraction(Polynomial(Integer))
sage: fricas(1/x).denominator().type()
Fraction(Polynomial(Integer))
```
Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.



---

archive/issue_comments_309600.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dimpase](#comment:22):\n\n> Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.\n\nThis is actually correct.  You want `denom` and `numer`.",
    "created_at": "2016-08-11T22:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309600",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dimpase](#comment:22):

> Why do types of numerators and denominator are still `Fraction(...)`? This does not look right.

This is actually correct.  You want `denom` and `numer`.



---

archive/issue_comments_309601.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46\">5796a95</a></td><td><code>.sage() for Fraction and (Positive)Integer</code></td></tr></table>\n",
    "created_at": "2016-08-12T15:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309601",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46">5796a95</a></td><td><code>.sage() for Fraction and (Positive)Integer</code></td></tr></table>




---

archive/issue_comments_309602.json:
```json
{
    "body": "Changed commit from **[`2ee5bbf`](https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d)** to **[`5796a95`](https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46)**",
    "created_at": "2016-08-12T15:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309602",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ee5bbf`](https://github.com/sagemath/sagetrac-mirror/commit/2ee5bbf468ee90c0b5b6d7b5cdef7919ebbc3d5d)** to **[`5796a95`](https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46)**



---

archive/issue_comments_309603.json:
```json
{
    "body": "Changed commit from **[`5796a95`](https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46)** to **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**",
    "created_at": "2016-08-12T16:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309603",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5796a95`](https://github.com/sagemath/sagetrac-mirror/commit/5796a950d022c48e0ddb0757d9c2aa08f29b1f46)** to **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**



---

archive/issue_comments_309604.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c\">6d91694</a></td><td><code>info on the patch into SPKG.txt</code></td></tr></table>\n",
    "created_at": "2016-08-12T16:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309604",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c">6d91694</a></td><td><code>info on the patch into SPKG.txt</code></td></tr></table>




---

archive/issue_comments_309605.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, all done. Please have another look.\nBy the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n\nStarting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.",
    "created_at": "2016-08-12T16:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309605",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, all done. Please have another look.
By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.

Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.



---

archive/issue_comments_309606.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2016-08-12T16:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309606",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, in a later stable release.**



---

archive/issue_comments_309607.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@dimpase](#comment:26):\n> By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n\nHmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)\n\n\\\\\n \n> Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.\n\nIs this a problem on MacOS X?",
    "created_at": "2016-08-12T16:27:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309607",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@dimpase](#comment:26):
> By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.

Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)

\\
 
> Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.

Is this a problem on MacOS X?



---

archive/issue_comments_309608.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk, looks better.  (Haven't pulled nor run tests though yet.)\n\n\\\\\n\nAre the (upload) scripts smart enough to remove the old version if we keep the `-full`?  (I'm not sure, but don't care much either.  I guess the mirrors will only delete if we do so as well.)",
    "created_at": "2016-08-12T16:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309608",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok, looks better.  (Haven't pulled nor run tests though yet.)

\\

Are the (upload) scripts smart enough to remove the old version if we keep the `-full`?  (I'm not sure, but don't care much either.  I guess the mirrors will only delete if we do so as well.)



---

archive/issue_comments_309609.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOh, forgot:\n\nA note in the patch (probably a link to the upstream report) would be good as well.",
    "created_at": "2016-08-12T16:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309609",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

Oh, forgot:

A note in the patch (probably a link to the upstream report) would be good as well.



---

archive/issue_comments_309610.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@nexttime](#comment:27):\n> Replying to [@dimpase](#comment:26):\n> > By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.\n\n> \n> Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)\n> \n> \\\\\n>  \n> > Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs \"HyperText\" menu, which uses some X11 stuff for displaying.\n\n> \n> Is this a problem on MacOS X?\n> \n\nIt's not a problem on SMC - it just prints a warning, and carries on regardless (probably the same on OSX). Anyhow, there is an option to disable GUI at startup completely.",
    "created_at": "2016-08-12T16:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309610",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@nexttime](#comment:27):
> Replying to [@dimpase](#comment:26):
> > By the way, docs are installed in `SAGE_LOCAL/lib/fricas/target/x86_64-unknown-linux/share/`, at least if I do ` SAGE_SPKG_INSTALL_DOCS=yes sage -i fricas`.

> 
> Hmmm, nice folder name.  Is that configurable?  (It presumably has to find its own documentation, so we cannot manually copy it elsewhere; a link from `SAGE_LOCAL/share/...` may also help otherwise.)
> 
> \\
>  
> > Starting FriCAS at the `sage -sh` prompt then automatically pops up a docs "HyperText" menu, which uses some X11 stuff for displaying.

> 
> Is this a problem on MacOS X?
> 

It's not a problem on SMC - it just prints a warning, and carries on regardless (probably the same on OSX). Anyhow, there is an option to disable GUI at startup completely.



---

archive/issue_comments_309611.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@nexttime](#comment:29):\n> Oh, forgot:\n> \n> A note in the patch (probably a link to the upstream report) would be good as well.\n>  \n\nThis patch shall go as soon as new FriCAS is released. They already [have it](https://github.com/fricas/fricas/commit/9146dcb84a6f671cf0699d8df568c20a0a95553f) in their repos.",
    "created_at": "2016-08-12T16:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309611",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@nexttime](#comment:29):
> Oh, forgot:
> 
> A note in the patch (probably a link to the upstream report) would be good as well.
>  

This patch shall go as soon as new FriCAS is released. They already [have it](https://github.com/fricas/fricas/commit/9146dcb84a6f671cf0699d8df568c20a0a95553f) in their repos.



---

archive/issue_comments_309612.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nOK.",
    "created_at": "2016-08-12T16:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309612",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

OK.



---

archive/issue_comments_309613.json:
```json
{
    "body": "Changed keywords from none to **uffi ECL**",
    "created_at": "2016-08-12T16:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309613",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from none to **uffi ECL**



---

archive/issue_comments_309614.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nping?",
    "created_at": "2016-08-14T10:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309614",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

ping?



---

archive/issue_comments_309615.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSince the interface has its own ticket #21231 I vote for merging this as soon as possible.\n\nMartin",
    "created_at": "2016-08-14T15:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309615",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:35" align="right">comment:35</div>

Since the interface has its own ticket #21231 I vote for merging this as soon as possible.

Martin



---

archive/issue_comments_309616.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI'll trigger a final test...\n\nDoes #21231 logically depend on this (apart from the UFFI patch)?",
    "created_at": "2016-08-14T15:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309616",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:36" align="right">comment:36</div>

I'll trigger a final test...

Does #21231 logically depend on this (apart from the UFFI patch)?



---

archive/issue_comments_309617.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@nexttime](#comment:36):\n> I'll trigger a final test...\n> \n> Does #21231 logically depend on this (apart from the UFFI patch)?\n\nthis ticket updates the FriCAS version too, you know... :-)",
    "created_at": "2016-08-14T15:19:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309617",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@nexttime](#comment:36):
> I'll trigger a final test...
> 
> Does #21231 logically depend on this (apart from the UFFI patch)?

this ticket updates the FriCAS version too, you know... :-)



---

archive/issue_comments_309618.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@dimpase](#comment:37):\n> Replying to [@nexttime](#comment:36):\n> > I'll trigger a final test...\n> > \n> > Does #21231 logically depend on this (apart from the UFFI patch)?\n\n> \n> this ticket updates the FriCAS version too, you know... :-) \n\n1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).\n\n2) The *Dependencies* field of #21231 is empty.\n\nSo I was asking mainly because of 2).",
    "created_at": "2016-08-14T15:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309618",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@dimpase](#comment:37):
> Replying to [@nexttime](#comment:36):
> > I'll trigger a final test...
> > 
> > Does #21231 logically depend on this (apart from the UFFI patch)?

> 
> this ticket updates the FriCAS version too, you know... :-) 

1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).

2) The *Dependencies* field of #21231 is empty.

So I was asking mainly because of 2).



---

archive/issue_comments_309619.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nAs I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.",
    "created_at": "2016-08-14T15:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309619",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:39" align="right">comment:39</div>

As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.



---

archive/issue_comments_309620.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@mantepse](#comment:39):\n> As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.\n\nIMHO it is better to stick with a version provided by Sage, to make sure that all doctests pass (for the output might depend on FriCAS version).",
    "created_at": "2016-08-14T15:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309620",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@mantepse](#comment:39):
> As I wrote on the #21231, strictly speaking #21231 does NOT depend on this ticket, because the interface will work just fine with a system install of FriCAS.

IMHO it is better to stick with a version provided by Sage, to make sure that all doctests pass (for the output might depend on FriCAS version).



---

archive/issue_comments_309621.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nexttime](#comment:38):\n> Replying to [@dimpase](#comment:37):\n> > Replying to [@nexttime](#comment:36):\n> > > I'll trigger a final test...\n> > > \n> > > Does #21231 logically depend on this (apart from the UFFI patch)?\n\n> > \n> > this ticket updates the FriCAS version too, you know... :-) \n\n> \n> 1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).\n> \n\nto my non-musical ear, minor does not differ much from major...\n\n> 2) The *Dependencies* field of #21231 is empty.\n\n#21231 is about a different, new interface.\n\n> \n> So I was asking mainly because of 2).\n\n>",
    "created_at": "2016-08-14T15:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309621",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nexttime](#comment:38):
> Replying to [@dimpase](#comment:37):
> > Replying to [@nexttime](#comment:36):
> > > I'll trigger a final test...
> > > 
> > > Does #21231 logically depend on this (apart from the UFFI patch)?

> > 
> > this ticket updates the FriCAS version too, you know... :-) 

> 
> 1) It's smells like a *minor* update (1.2.**4** to 1.2.**7**).
> 

to my non-musical ear, minor does not differ much from major...

> 2) The *Dependencies* field of #21231 is empty.

#21231 is about a different, new interface.

> 
> So I was asking mainly because of 2).

>



---

archive/issue_comments_309622.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@nexttime](#comment:38):\n> 2) The *Dependencies* field of #21231 is empty.\n\nwell, no, it is not.",
    "created_at": "2016-08-14T15:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309622",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@nexttime](#comment:38):
> 2) The *Dependencies* field of #21231 is empty.

well, no, it is not.



---

archive/issue_comments_309623.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@dimpase](#comment:42):\n> Replying to [@nexttime](#comment:38):\n> > 2) The *Dependencies* field of #21231 is empty.\n\n> well, no, it is not.\n\nRace condition. ;-)",
    "created_at": "2016-08-14T16:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309623",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@dimpase](#comment:42):
> Replying to [@nexttime](#comment:38):
> > 2) The *Dependencies* field of #21231 is empty.

> well, no, it is not.

Race condition. ;-)



---

archive/issue_events_298234.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-14T16:54:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298234"
}
```



---

archive/issue_events_298235.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-14T16:54:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298235"
}
```



---

archive/issue_comments_309624.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI won't comment on the 5043 style warnings... XD",
    "created_at": "2016-08-14T16:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309624",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:44" align="right">comment:44</div>

I won't comment on the 5043 style warnings... XD



---

archive/issue_comments_309625.json:
```json
{
    "body": "Reviewer: **Martin Rubey, Leif Leonhardy**",
    "created_at": "2016-08-14T16:54:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309625",
    "user": "https://github.com/nexttime"
}
```

Reviewer: **Martin Rubey, Leif Leonhardy**



---

archive/issue_comments_309626.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@nexttime](#comment:44):\n> I won't comment on the 5043 style warnings... XD\n\n[Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...",
    "created_at": "2016-08-14T20:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309626",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@nexttime](#comment:44):
> I won't comment on the 5043 style warnings... XD

[Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...



---

archive/issue_comments_309627.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@dimpase](#comment:45):\n> Replying to [@nexttime](#comment:44):\n> > I won't comment on the 5043 style warnings... XD\n\n> [Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...\n\nWell, [unfortunately due to popular demand this product is currently out of stock.](http://indiarush.com/velvet-zari-work-green-semi-stiitched-lehenga-style-saree-5043/)",
    "created_at": "2016-08-14T20:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309627",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@dimpase](#comment:45):
> Replying to [@nexttime](#comment:44):
> > I won't comment on the 5043 style warnings... XD

> [Style 5043](https://www.vxintimate.com/style/5043/)? No,please don't, indeed...

Well, [unfortunately due to popular demand this product is currently out of stock.](http://indiarush.com/velvet-zari-work-green-semi-stiitched-lehenga-style-saree-5043/)



---

archive/issue_events_298236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-15T18:27:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298236"
}
```



---

archive/issue_events_298237.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "582bcbe93ab42d14775a2d1d1151c3f410368bd6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-15T18:27:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21209#event-298237"
}
```



---

archive/issue_comments_309628.json:
```json
{
    "body": "Changed branch from **[u/dimpase/fricas127](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fricas127)** to **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**",
    "created_at": "2016-08-15T18:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309628",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dimpase/fricas127](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/fricas127)** to **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)**



---

archive/issue_comments_309629.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nLooks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...",
    "created_at": "2016-08-27T21:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309629",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:48" align="right">comment:48</div>

Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...



---

archive/issue_comments_309630.json:
```json
{
    "body": "Changed commit from **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)** to none",
    "created_at": "2016-08-27T21:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309630",
    "user": "https://github.com/nexttime"
}
```

Changed commit from **[`6d91694`](https://github.com/sagemath/sagetrac-mirror/commit/6d91694f7df7594fb724c72961d1406cb5013a9c)** to none



---

archive/issue_comments_309631.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@nexttime](#comment:48):\n> Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n\nCould you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?",
    "created_at": "2016-08-28T06:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309631",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@nexttime](#comment:48):
> Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...

Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?



---

archive/issue_comments_309632.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@mantepse](#comment:49):\n> Replying to [@nexttime](#comment:48):\n> > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n\n> \n> Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n\nJust with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n\nSo when reviewing #21231, one should look whether there's still a problem.",
    "created_at": "2016-08-28T12:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309632",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@mantepse](#comment:49):
> Replying to [@nexttime](#comment:48):
> > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...

> 
> Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?

Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)

So when reviewing #21231, one should look whether there's still a problem.



---

archive/issue_comments_309633.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@nexttime](#comment:50):\n> Replying to [@mantepse](#comment:49):\n> > Replying to [@nexttime](#comment:48):\n> > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n\n> > \n> > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n\n> \n> Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n> \n> So when reviewing #21231, one should look whether there's still a problem.\n\nCould you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...",
    "created_at": "2016-08-28T12:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309633",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@nexttime](#comment:50):
> Replying to [@mantepse](#comment:49):
> > Replying to [@nexttime](#comment:48):
> > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...

> > 
> > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?

> 
> Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)
> 
> So when reviewing #21231, one should look whether there's still a problem.

Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...



---

archive/issue_comments_309634.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nTo see if there are orphans on Linux, look at the output of\n\n```\n$ ps -def | grep fricas\n```\nI see a couple of these just after one run of\n\n```\n./sage -tp --optional=fricas,sage src/sage/interfaces/fricas.py \n```",
    "created_at": "2016-08-28T22:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309634",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

To see if there are orphans on Linux, look at the output of

```
$ ps -def | grep fricas
```
I see a couple of these just after one run of

```
./sage -tp --optional=fricas,sage src/sage/interfaces/fricas.py 
```



---

archive/issue_comments_309635.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@mantepse](#comment:51):\n> Replying to [@nexttime](#comment:50):\n> > Replying to [@mantepse](#comment:49):\n> > > Replying to [@nexttime](#comment:48):\n> > > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...\n\n> > > \n> > > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?\n\n> > \n> > Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)\n> > \n> > So when reviewing #21231, one should look whether there's still a problem.\n\n> \n> Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...\n\nAh, sorry, forgot to answer.\n\nYou can also use e.g. `ps x | grep AXIOMsys | grep -v grep`.\n\n(And `kill $(ps x | grep AXIOMsys | grep -v grep | awk '{ print $1 }')` ;-) )",
    "created_at": "2016-08-28T23:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309635",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@mantepse](#comment:51):
> Replying to [@nexttime](#comment:50):
> > Replying to [@mantepse](#comment:49):
> > > Replying to [@nexttime](#comment:48):
> > > > Looks like I'm having more than a dozen `AXIOMsys` orphans from (testing) this...

> > > 
> > > Could you please expand?  Is there a problem?  If so, did you test with the new interface  #21231 , or the old one?

> > 
> > Just with the old interface, hence I reported it here.  (There were 27 orphans from perhaps testing `src/sage/interfaces/*` once or twice and one `ptestlong` I think.  I only incidentally noticed them after weeks because they weren't very active either.)
> > 
> > So when reviewing #21231, one should look whether there's still a problem.

> 
> Could you provide a testcase, or some instructions how to see the orphans?  That would make things much easier for me - because I have no idea how to do this...

Ah, sorry, forgot to answer.

You can also use e.g. `ps x | grep AXIOMsys | grep -v grep`.

(And `kill $(ps x | grep AXIOMsys | grep -v grep | awk '{ print $1 }')` ;-) )



---

archive/issue_comments_309636.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nNote that you should look a while *after* you've left Sage, as normally the Sage Cleaner should kill them (but that only works if the interfaces are properly written / their PIDs properly recorded).",
    "created_at": "2016-08-28T23:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309636",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:54" align="right">comment:54</div>

Note that you should look a while *after* you've left Sage, as normally the Sage Cleaner should kill them (but that only works if the interfaces are properly written / their PIDs properly recorded).



---

archive/issue_comments_309637.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)",
    "created_at": "2016-08-29T06:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309637",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:55" align="right">comment:55</div>

Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)



---

archive/issue_comments_309638.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@mantepse](#comment:55):\n> Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)\n\nI think the problem is that more child processes of FriCAS are launched than `sage-cleaner` (a script that cleans up after Sage ends) is able to deal with.\nIn fact, you see that\n\n```\nsage: fricas._quit_string()\n')lisp (quit)'\n```\nwhich is as it should be, as `FriCAS` inherits from `PanAxiom` class (in `sage/interfaces/axiom.py`), where `_quit_string` is defined.\nAnd you see that `fricas.quit()` does kill the instance corresponding to `fricas.pid()`, as it should, by looking at the output of `ps -def...`.\n\nHere is how it goes: I start Sage and execute `fricas.pid()` at the prompt; I see that this results in launching of a bunch of things:\n\n```\ndima     30739 30652  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\ndima     30745 30739  1 10:21 pts/5    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/\ndima     30746 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/session\ndima     30747 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/spadclient\ndima     30748 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n```\nof which the 1st one corresponds to PID reported by `fricas.pid()`. \n\nIf I issue `fricas.quit()` and then quit Sage then no zombies live on. But if I just quit Sage then I get a zombie, one of these\n\n```\n/home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/\n```\n\nProbably, the information on these extra processes' PIDs has to be registered somewhere for `sage-cleaner` to succeed.",
    "created_at": "2016-08-29T09:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309638",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@mantepse](#comment:55):
> Thank you.  Indeed, there is a bug.  However, I don't know yet how to fix it, I thought that `fricas.quit()` would send `fricas._quit_string()` to fricas, but apparently it doesn't.  So, what should I do?  (I couldn't find anything but `_quit_string` in other interfaces...)

I think the problem is that more child processes of FriCAS are launched than `sage-cleaner` (a script that cleans up after Sage ends) is able to deal with.
In fact, you see that

```
sage: fricas._quit_string()
')lisp (quit)'
```
which is as it should be, as `FriCAS` inherits from `PanAxiom` class (in `sage/interfaces/axiom.py`), where `_quit_string` is defined.
And you see that `fricas.quit()` does kill the instance corresponding to `fricas.pid()`, as it should, by looking at the output of `ps -def...`.

Here is how it goes: I start Sage and execute `fricas.pid()` at the prompt; I see that this results in launching of a bunch of things:

```
dima     30739 30652  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
dima     30745 30739  1 10:21 pts/5    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/
dima     30746 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/session
dima     30747 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/lib/spadclient
dima     30748 30739  0 10:21 pts/4    00:00:00 /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
```
of which the 1st one corresponds to PID reported by `fricas.pid()`. 

If I issue `fricas.quit()` and then quit Sage then no zombies live on. But if I just quit Sage then I get a zombie, one of these

```
/home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /home/dima/Sage/sage/local/lib/fricas/target/x86_64-unknown-linux/bin/
```

Probably, the information on these extra processes' PIDs has to be registered somewhere for `sage-cleaner` to succeed.



---

archive/issue_comments_309639.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAre you sure that `_quit_string` is used at all?  Because, if it is sent to fricas, then fricas should quit (and it does so on my machine).\n\nSimply killing a few processes is error prone, I'd say.",
    "created_at": "2016-08-29T10:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309639",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:57" align="right">comment:57</div>

Are you sure that `_quit_string` is used at all?  Because, if it is sent to fricas, then fricas should quit (and it does so on my machine).

Simply killing a few processes is error prone, I'd say.



---

archive/issue_comments_309640.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\n`_quit_string` is used when you explicitly call `fricas.quit()`. But it is not used by `sage-cleaner`, AFAICS (although this is fixable, I guess). `sage-cleaner` would kill all sub-processed spawned by a process launched by a process with the PID it knows. But it seems that that zombie suprocesses of FriCAS don't have parent's PID equal to FriCAS, they are parented by the same PID as the main FriCAS process, if I read this correctly from the output of `ps -def`. \n\nDo you know how FriCAS launches these (sub?)processes?",
    "created_at": "2016-08-29T11:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309640",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:58" align="right">comment:58</div>

`_quit_string` is used when you explicitly call `fricas.quit()`. But it is not used by `sage-cleaner`, AFAICS (although this is fixable, I guess). `sage-cleaner` would kill all sub-processed spawned by a process launched by a process with the PID it knows. But it seems that that zombie suprocesses of FriCAS don't have parent's PID equal to FriCAS, they are parented by the same PID as the main FriCAS process, if I read this correctly from the output of `ps -def`. 

Do you know how FriCAS launches these (sub?)processes?



---

archive/issue_comments_309641.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThe purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.\n\nThe Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.",
    "created_at": "2016-08-29T11:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309641",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:59" align="right">comment:59</div>

The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.

The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.



---

archive/issue_comments_309642.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@dimpase](#comment:58):\n\n> `_quit_string' is used when you explicitly call `fricas.quit()`.\n\nI cannot see this in the code. However, I do see it when tracing.  Possibly a newline is missing?\n\n> Do you know how FriCAS launches these (sub?)processes?\n\nNo.",
    "created_at": "2016-08-29T12:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309642",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@dimpase](#comment:58):

> `_quit_string' is used when you explicitly call `fricas.quit()`.

I cannot see this in the code. However, I do see it when tracing.  Possibly a newline is missing?

> Do you know how FriCAS launches these (sub?)processes?

No.



---

archive/issue_comments_309643.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@nexttime](#comment:59):\n> The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.\n> \n> The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.\n\nOK, what happens is more subtle: if `fricas.quit()` is not invoked before exiting Sage, then zombie arises with parent's ID of `systemd`. Before exit, however, the (pre)zombie parent's ID is good, it's the same as shown by `fricas.pid()`. \n\nIMHO this means that `sage-cleaner` fails to kill it; when it did get `fricas.quit()` it flips to a ready to die state, but not otherwise.",
    "created_at": "2016-08-29T14:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309643",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@nexttime](#comment:59):
> The purpose of the Sage Cleaner is not to shut down pexpect interfaces, that is supposed to be done by Sage when exiting.
> 
> The Sage Cleaner is just there to afterwards (after a while) kill spawned processes if something went wrong.  And he doesn't know child processes spawned by these foreign ones, they have to belong to the same process group to make killing them work.

OK, what happens is more subtle: if `fricas.quit()` is not invoked before exiting Sage, then zombie arises with parent's ID of `systemd`. Before exit, however, the (pre)zombie parent's ID is good, it's the same as shown by `fricas.pid()`. 

IMHO this means that `sage-cleaner` fails to kill it; when it did get `fricas.quit()` it flips to a ready to die state, but not otherwise.



---

archive/issue_comments_309644.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:\n\n```\nsage: def doit():\n....:     F = fricas(1+1).parent(); a = time.time(); F.quit()\n....:     result = [\"testing\"]\n....:     while result != []:\n....:         result = !ps x | grep AXIOMsys | grep -v grep\n....:         sleep(1)\n....:     print time.time() - a\n....:     \nsage: doit()\n16.3083839417\n```\n\nIt shouldn't.  If I use `fricas._expect.write(\")quit\\r\")`, fricas quits immediately.  So, indeed, `\"\\r\"` is missing.  Should I simply modify the quitstring?",
    "created_at": "2016-08-29T18:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309644",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:62" align="right">comment:62</div>

I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:

```
sage: def doit():
....:     F = fricas(1+1).parent(); a = time.time(); F.quit()
....:     result = ["testing"]
....:     while result != []:
....:         result = !ps x | grep AXIOMsys | grep -v grep
....:         sleep(1)
....:     print time.time() - a
....:     
sage: doit()
16.3083839417
```

It shouldn't.  If I use `fricas._expect.write(")quit\r")`, fricas quits immediately.  So, indeed, `"\r"` is missing.  Should I simply modify the quitstring?



---

archive/issue_comments_309645.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@mantepse](#comment:62):\n> I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:\n> \n> ```\n> sage: def doit():\n> ....:     F = fricas(1+1).parent(); a = time.time(); F.quit()\n> ....:     result = [\"testing\"]\n> ....:     while result != []:\n> ....:         result = !ps x | grep AXIOMsys | grep -v grep\n> ....:         sleep(1)\n> ....:     print time.time() - a\n> ....:     \n> sage: doit()\n> 16.3083839417\n> ```\n> \n> It shouldn't.  If I use `fricas._expect.write(\")quit\\r\")`, fricas quits immediately.  So, indeed, `\"\\r\"` is missing.  Should I simply modify the quitstring?\n\nwell, IMHO if `\\r` was missing in _quit_string then `fricas.quit()` would not be working at all... (well, perhaps it is slow as it is because it invokes lisp.)\n\nHere your command has no effect:\n\n```\nsage: fricas.pid()\n6130\nsage: fricas._expect.write(\")quit\\r\")\nsage: fricas.pid()\n6130\nsage: fricas.quit()\nsage: fricas.pid() # right, now we get a new instance!\n6507\n```\nPlease check that you don't see the same picture with your new interface.",
    "created_at": "2016-08-29T19:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309645",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@mantepse](#comment:62):
> I just noticed that `fricas.quit()` does work (at least with the new interface).  However, it takes a very long time:
> 
> ```
> sage: def doit():
> ....:     F = fricas(1+1).parent(); a = time.time(); F.quit()
> ....:     result = ["testing"]
> ....:     while result != []:
> ....:         result = !ps x | grep AXIOMsys | grep -v grep
> ....:         sleep(1)
> ....:     print time.time() - a
> ....:     
> sage: doit()
> 16.3083839417
> ```
> 
> It shouldn't.  If I use `fricas._expect.write(")quit\r")`, fricas quits immediately.  So, indeed, `"\r"` is missing.  Should I simply modify the quitstring?

well, IMHO if `\r` was missing in _quit_string then `fricas.quit()` would not be working at all... (well, perhaps it is slow as it is because it invokes lisp.)

Here your command has no effect:

```
sage: fricas.pid()
6130
sage: fricas._expect.write(")quit\r")
sage: fricas.pid()
6130
sage: fricas.quit()
sage: fricas.pid() # right, now we get a new instance!
6507
```
Please check that you don't see the same picture with your new interface.



---

archive/issue_comments_309646.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nOn my computer, `fricas.pid()` cannot be used to see whether fricas is running:\n\n```\nsage: fricas.pid()\n10923\nsage: !ps x | grep AXIOMsys | grep -v grep\n10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/\n10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\nsage: fricas._expect.write(\")quit\\r\")\nsage: !ps x | grep AXIOMsys | grep -v grep\nsage: fricas.pid()\n10923\n```",
    "created_at": "2016-08-29T20:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309646",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:64" align="right">comment:64</div>

On my computer, `fricas.pid()` cannot be used to see whether fricas is running:

```
sage: fricas.pid()
10923
sage: !ps x | grep AXIOMsys | grep -v grep
10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/
10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
sage: fricas._expect.write(")quit\r")
sage: !ps x | grep AXIOMsys | grep -v grep
sage: fricas.pid()
10923
```



---

archive/issue_comments_309647.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@mantepse](#comment:64):\n> On my computer, `fricas.pid()` cannot be used to see whether fricas is running:\n> \n> ```\n> sage: fricas.pid()\n> 10923\n> sage: !ps x | grep AXIOMsys | grep -v grep\n> 10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n> 10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/\n> 10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys\n> sage: fricas._expect.write(\")quit\\r\")\n> sage: !ps x | grep AXIOMsys | grep -v grep\n> sage: fricas.pid()\n> 10923\n> ```\n\nno, what you see is that fricas is running, with pid 10923, and that `fricas._expect.write(\")quit\\r\")` is ignored by it. If you implemented `_quit_string` properly you would also be able to stop it as is possible with the old interface.",
    "created_at": "2016-08-30T04:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309647",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@mantepse](#comment:64):
> On my computer, `fricas.pid()` cannot be used to see whether fricas is running:
> 
> ```
> sage: fricas.pid()
> 10923
> sage: !ps x | grep AXIOMsys | grep -v grep
> 10923 pts/3    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
> 10929 pts/4    Ss+    0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys -- /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/
> 10932 pts/3    S+     0:00 /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/sman -nox -noclef -ws /usr/local/lib/fricas/target/x86_64-unknown-linux/bin/AXIOMsys
> sage: fricas._expect.write(")quit\r")
> sage: !ps x | grep AXIOMsys | grep -v grep
> sage: fricas.pid()
> 10923
> ```

no, what you see is that fricas is running, with pid 10923, and that `fricas._expect.write(")quit\r")` is ignored by it. If you implemented `_quit_string` properly you would also be able to stop it as is possible with the old interface.



---

archive/issue_comments_309648.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nDima, I don't understand your reasoning.  I would think that the first line below quits the fricas process on my machine, as the output of the second line shows.\n\n```\nsage: fricas._expect.write(\")quit\\r\")\nsage: !ps x | grep AXIOMsys | grep -v grep\nsage: fricas.pid()\n10923\n```\nThe third line is in accordance with the doc of `.pid()`:\n\n```\n   Return the PID of the underlying sub-process.\n\n   REMARK:\n\n   If the interface terminates unexpectedly, the original PID will\n   still be used. But if it was terminated using \"quit()\", a new sub-\n   process with a new PID is automatically started.\n\n   EXAMPLE:\n\n      sage: pid = gap.pid()\n      sage: gap.eval('quit;')\n      ''\n      sage: pid == gap.pid()\n      True\n      sage: gap.quit()\n      sage: pid == gap.pid()\n      False\n```\n\nSo, in my opinion a possible fix is to append a `\\r` to the quitstring - and of course, this should work with the old interface, too, although I did not test.\n\nNo idea though why fricas needs it, and, for example, gap, doesn't.",
    "created_at": "2016-08-30T06:19:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309648",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:66" align="right">comment:66</div>

Dima, I don't understand your reasoning.  I would think that the first line below quits the fricas process on my machine, as the output of the second line shows.

```
sage: fricas._expect.write(")quit\r")
sage: !ps x | grep AXIOMsys | grep -v grep
sage: fricas.pid()
10923
```
The third line is in accordance with the doc of `.pid()`:

```
   Return the PID of the underlying sub-process.

   REMARK:

   If the interface terminates unexpectedly, the original PID will
   still be used. But if it was terminated using "quit()", a new sub-
   process with a new PID is automatically started.

   EXAMPLE:

      sage: pid = gap.pid()
      sage: gap.eval('quit;')
      ''
      sage: pid == gap.pid()
      True
      sage: gap.quit()
      sage: pid == gap.pid()
      False
```

So, in my opinion a possible fix is to append a `\r` to the quitstring - and of course, this should work with the old interface, too, although I did not test.

No idea though why fricas needs it, and, for example, gap, doesn't.



---

archive/issue_comments_309649.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nSorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it. Are there any git-related issues you need to fix?",
    "created_at": "2016-09-02T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309649",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:67" align="right">comment:67</div>

Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it. Are there any git-related issues you need to fix?



---

archive/issue_comments_309650.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@dimpase](#comment:67):\n> Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it.\n\nThank you!\n\n> Are there any git-related issues you need to fix?\n\nIndeed - I made a mess with the commits and found no time to correct them.  It would be of great help if you could, for example, create a \"clean\" branch from my branch, deleting all the commits which obviously don't belong (I made a list at the ticket).\n\nI think the only work that remains to be done there is to add that \"\\r\" to the quitstring, add a test to the `quit()` method, and probably some others to make the patchbot happy.\n\nIf the following an acceptable test for `quit()`?\n\n```\nsage: p = fricas.pid();\nsage: l = !ps x | grep AXIOMsys | grep -v grep\nsage: any(s.strip().startswith(str(p)) for s in l)\nTrue\nsage: fricas.quit()\nsage: any(s.strip().startswith(str(p)) for s in l)\nFalse\n```",
    "created_at": "2016-09-02T13:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309650",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@dimpase](#comment:67):
> Sorry, indeed, I didn't quite parse what you wrote. Anyhow, as soon as your new interface is ready, I'd be glad to have a look at it.

Thank you!

> Are there any git-related issues you need to fix?

Indeed - I made a mess with the commits and found no time to correct them.  It would be of great help if you could, for example, create a "clean" branch from my branch, deleting all the commits which obviously don't belong (I made a list at the ticket).

I think the only work that remains to be done there is to add that "\r" to the quitstring, add a test to the `quit()` method, and probably some others to make the patchbot happy.

If the following an acceptable test for `quit()`?

```
sage: p = fricas.pid();
sage: l = !ps x | grep AXIOMsys | grep -v grep
sage: any(s.strip().startswith(str(p)) for s in l)
True
sage: fricas.quit()
sage: any(s.strip().startswith(str(p)) for s in l)
False
```



---

archive/issue_comments_309651.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@mantepse](#comment:68):\n> Is the following an acceptable test for `quit()`?\n> \n> ```\n> sage: p = fricas.pid();\n> sage: l = !ps x | grep AXIOMsys | grep -v grep\n> sage: any(s.strip().startswith(str(p)) for s in l)\n> True\n> sage: fricas.quit()\n> sage: any(s.strip().startswith(str(p)) for s in l)\n> False\n> ```\n\nUnfortunately no.  Neither `ps`, nor `x`, nor the output format are really portable *I think<sup>TM</sup>*.  So you'd presumably have to use some Python stuff instead.  Not to mention you shouldn't use `!` (but `os.system()` or one of its replacements instead).\n\nRather orthogonal to that, you must not use `.startswith()`, but rather `.split()[0]==str(p)`.",
    "created_at": "2016-09-02T19:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309651",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@mantepse](#comment:68):
> Is the following an acceptable test for `quit()`?
> 
> ```
> sage: p = fricas.pid();
> sage: l = !ps x | grep AXIOMsys | grep -v grep
> sage: any(s.strip().startswith(str(p)) for s in l)
> True
> sage: fricas.quit()
> sage: any(s.strip().startswith(str(p)) for s in l)
> False
> ```

Unfortunately no.  Neither `ps`, nor `x`, nor the output format are really portable *I think<sup>TM</sup>*.  So you'd presumably have to use some Python stuff instead.  Not to mention you shouldn't use `!` (but `os.system()` or one of its replacements instead).

Rather orthogonal to that, you must not use `.startswith()`, but rather `.split()[0]==str(p)`.



---

archive/issue_comments_309652.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nJeroen just suggested on sage-devel to make the Python package `psutil` standard.\n\nYou could look into that for retrieving process information in a portable way.",
    "created_at": "2016-09-07T13:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309652",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:70" align="right">comment:70</div>

Jeroen just suggested on sage-devel to make the Python package `psutil` standard.

You could look into that for retrieving process information in a portable way.



---

archive/issue_comments_309653.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI just managed to install `psutil`, and found out:\n\n```\nsage: import psutil\nsage: p = fricas.pid(); p\n22184\nsage: pr = psutil.Process(p); pr\n<psutil.Process(pid=22184, name='sman') at 140240479360400>\nsage: pr.children()\n[<psutil.Process(pid=22190, name='AXIOMsys') at 140240479356752>,\n <psutil.Process(pid=22191, name='session') at 140240479356816>,\n <psutil.Process(pid=22192, name='spadclient') at 140240479356880>,\n <psutil.Process(pid=22193, name='sman') at 140240479356944>]\nsage: fricas._expect.write(\")quit\\r\")\nsage: pr.children()\n[]\nsage: pr\n<psutil.Process(pid=22184, name='sman') at 140240479360400>\n```\nThis remaining job is killed when exiting sage.  However:\n\n```\nsage: p = gap.pid(); p\n22582\nsage: pr = psutil.Process(p); pr\n<psutil.Process(pid=22582, name='gap') at 140240479291088>\nsage: pr.children()\n[]\nsage: gap.quit()\nsage: pr\n<psutil.Process(pid=22582 (terminated)) at 140240479291088>\n```\nSo it's better, but not perfect.  Is it good enough?",
    "created_at": "2016-09-08T20:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21209",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21209#issuecomment-309653",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:71" align="right">comment:71</div>

I just managed to install `psutil`, and found out:

```
sage: import psutil
sage: p = fricas.pid(); p
22184
sage: pr = psutil.Process(p); pr
<psutil.Process(pid=22184, name='sman') at 140240479360400>
sage: pr.children()
[<psutil.Process(pid=22190, name='AXIOMsys') at 140240479356752>,
 <psutil.Process(pid=22191, name='session') at 140240479356816>,
 <psutil.Process(pid=22192, name='spadclient') at 140240479356880>,
 <psutil.Process(pid=22193, name='sman') at 140240479356944>]
sage: fricas._expect.write(")quit\r")
sage: pr.children()
[]
sage: pr
<psutil.Process(pid=22184, name='sman') at 140240479360400>
```
This remaining job is killed when exiting sage.  However:

```
sage: p = gap.pid(); p
22582
sage: pr = psutil.Process(p); pr
<psutil.Process(pid=22582, name='gap') at 140240479291088>
sage: pr.children()
[]
sage: gap.quit()
sage: pr
<psutil.Process(pid=22582 (terminated)) at 140240479291088>
```
So it's better, but not perfect.  Is it good enough?
