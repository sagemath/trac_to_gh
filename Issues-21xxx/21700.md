# Issue 21700: Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)

archive/issues_021463.json:
```json
{
    "body": "Various packages can be built with or without the presence of some other packages.\n\nFor example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)\n\nGNU make's \"order-only dependencies\" \"sound\" as if they can do this, but as Jeroen explains, they can't.\n\nOf course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. \n\n\nThis feature can be implemented by Makefile trickery, of course. See #30560.\n\n\nTickets:\n\n- #30560: `openssl` an optional dependency of `python3`\n\n- `giac` detects `cocoa` (which we have added as an experimental package)\n\n- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)\n\n- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency\n\n- `polymake` has lots of optional dependencies\n\n\n\n\nDepends on #31017\n\n**CC:**  @tscrim @dimpase @videlec @jhpalmieri @slel\n\nIssue created by migration from https://trac.sagemath.org/ticket/21700\n\n",
    "created_at": "2016-10-13T17:01:39Z",
    "labels": [
        "component: build: configure",
        "enhancement",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/21700",
    "user": "https://github.com/mkoeppe"
}
```
Various packages can be built with or without the presence of some other packages.

For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)

GNU make's "order-only dependencies" "sound" as if they can do this, but as Jeroen explains, they can't.

Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. 


This feature can be implemented by Makefile trickery, of course. See #30560.


Tickets:

- #30560: `openssl` an optional dependency of `python3`

- `giac` detects `cocoa` (which we have added as an experimental package)

- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)

- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency

- `polymake` has lots of optional dependencies




Depends on #31017

**CC:**  @tscrim @dimpase @videlec @jhpalmieri @slel

Issue created by migration from https://trac.sagemath.org/ticket/21700





---

archive/issue_comments_321475.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/latte_int__add_order_only_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/latte_int__add_order_only_dependencies)",
    "created_at": "2016-10-13T17:09:34Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321475",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/latte_int__add_order_only_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/latte_int__add_order_only_dependencies)



---

archive/issue_comments_321476.json:
```json
{
    "body": "**Commit:** [cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c](https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c)",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321476",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c](https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c)



---

archive/issue_comments_321477.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321477",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_321478.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c\">cb50fb4</a></td><td><code>latte_int: Add order-only dependencies</code></td></tr></table>\n",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321478",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c">cb50fb4</a></td><td><code>latte_int: Add order-only dependencies</code></td></tr></table>




---

archive/issue_events_194326.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-13T17:10:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194326"
}
```



---

archive/issue_comments_321479.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda\">0480c34</a></td><td><code>latte_int: Update SPKG.txt</code></td></tr></table>\n",
    "created_at": "2016-10-13T17:12:39Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda">0480c34</a></td><td><code>latte_int: Update SPKG.txt</code></td></tr></table>




---

archive/issue_comments_321480.json:
```json
{
    "body": "**Changing commit** from \"[cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c](https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c)\" to \"[0480c3486f12f76f2bf7200799676774a3f07fda](https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda)\".",
    "created_at": "2016-10-13T17:12:39Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c](https://github.com/sagemath/sagetrac-mirror/commit/cb50fb43ad0a2481489ac42bc0fcc1b5ebf7462c)" to "[0480c3486f12f76f2bf7200799676774a3f07fda](https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda)".



---

archive/issue_comments_321481.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2016-10-13T17:30:13Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321481",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_194327.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-10-13T17:30:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194327"
}
```



---

archive/issue_events_194328.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-10-13T17:30:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194328"
}
```



---

archive/issue_events_194329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-14T07:11:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194329"
}
```



---

archive/issue_events_194330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-14T07:11:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194330"
}
```



---

archive/issue_comments_321482.json:
```json
{
    "body": "<a id='comment:5'></a>\nGiven that `lrslib` and `lidia` are libraries, they should be real dependencies.",
    "created_at": "2016-10-14T07:11:06Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321482",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Given that `lrslib` and `lidia` are libraries, they should be real dependencies.



---

archive/issue_events_194331.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-14T07:11:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "rename": {
        "from": "latte_int: Add order-only dependencies",
        "to": "latte_int: Add dependencies"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194331"
}
```



---

archive/issue_comments_321483.json:
```json
{
    "body": "<a id='comment:6'></a>\nThey are optional for latte_int. This means that one can build latte_int with or without them.",
    "created_at": "2016-10-14T07:14:58Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321483",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
They are optional for latte_int. This means that one can build latte_int with or without them.



---

archive/issue_comments_321484.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A6):\n> They are optional for latte_int. This means that one can build latte_int with or without them.\n\nThat is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.",
    "created_at": "2016-10-14T07:20:58Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321484",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A6):
> They are optional for latte_int. This means that one can build latte_int with or without them.

That is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.



---

archive/issue_comments_321485.json:
```json
{
    "body": "<a id='comment:8'></a>\nIf the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.",
    "created_at": "2016-10-14T07:24:28Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321485",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.



---

archive/issue_comments_321486.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mkoeppe](#comment%3A8):\n> If the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.\n\nThat works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.",
    "created_at": "2016-10-14T07:26:44Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321486",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [mkoeppe](#comment%3A8):
> If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.

That works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.



---

archive/issue_comments_321487.json:
```json
{
    "body": "<a id='comment:10'></a>\nI see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.",
    "created_at": "2016-10-14T07:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321487",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.



---

archive/issue_comments_321488.json:
```json
{
    "body": "<a id='comment:11'></a>\nIf the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\nHence an order only dependency, not a real dependency.",
    "created_at": "2016-10-14T07:32:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321488",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
Hence an order only dependency, not a real dependency.



---

archive/issue_comments_321489.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think you may be right, but it's past midnight here, so I can't be sure.",
    "created_at": "2016-10-14T07:40:34Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321489",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
I think you may be right, but it's past midnight here, so I can't be sure.



---

archive/issue_comments_321490.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mkoeppe](#comment%3A11):\n> If the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\n> Hence an order only dependency, not a real dependency.\n\nLike I said in [comment:10], order-only dependencies don't work that way.",
    "created_at": "2016-10-14T08:43:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321490",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [mkoeppe](#comment%3A11):
> If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
> Hence an order only dependency, not a real dependency.

Like I said in [comment:10], order-only dependencies don't work that way.



---

archive/issue_comments_321491.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks. You are right. I was confused about order-only dependencies. \n\nI'll update the ticket description",
    "created_at": "2016-10-15T01:38:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321491",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Thanks. You are right. I was confused about order-only dependencies. 

I'll update the ticket description



---

archive/issue_events_194332.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-15T01:58:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194332"
}
```



---

archive/issue_events_194333.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-15T01:58:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194333"
}
```



---

archive/issue_comments_321492.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"\".",
    "created_at": "2016-10-15T01:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321492",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "".



---

archive/issue_comments_321493.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,17 @@\n-The `latte_int` configure script detects lrslib and lidia if they are installed, so these packages should be order-only dependencies.\n+At least two of our optional/experimental packages, `latte_int` and `polymake` can be built with or without the presence of some other packages.\n \n+For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.\n+\n+Linux package managers have the notion of suggested or recommended packages for this situation.\n+\n+In any case, it would be good if whenever the user does `sage -i latte_int lidia` or `make latte_int lidia`, then `lidia` is treated as a dependency, so that the `latte_int` build is started only when the `lidia` build is completed.\n+\n+GNU make's \"order-only dependencies\" sound as if they can do this, but as Jeroen explains, they can't.\n+\n+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we should find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n+\n+In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. \n+\n+\n+\n+\n``````\n",
    "created_at": "2016-10-15T01:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321493",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,17 @@
-The `latte_int` configure script detects lrslib and lidia if they are installed, so these packages should be order-only dependencies.
+At least two of our optional/experimental packages, `latte_int` and `polymake` can be built with or without the presence of some other packages.
 
+For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.
+
+Linux package managers have the notion of suggested or recommended packages for this situation.
+
+In any case, it would be good if whenever the user does `sage -i latte_int lidia` or `make latte_int lidia`, then `lidia` is treated as a dependency, so that the `latte_int` build is started only when the `lidia` build is completed.
+
+GNU make's "order-only dependencies" sound as if they can do this, but as Jeroen explains, they can't.
+
+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we should find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.
+
+In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. 
+
+
+
+
``````




---

archive/issue_events_194334.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-15T01:58:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "rename": {
        "from": "latte_int: Add dependencies",
        "to": "Packages with \"optional\" dependencies (a package manager's suggested/recommended packages)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194334"
}
```



---

archive/issue_comments_321494.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/latte_int__add_order_only_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/latte_int__add_order_only_dependencies)\" to \"\".",
    "created_at": "2016-10-15T01:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321494",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/mkoeppe/latte_int__add_order_only_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/latte_int__add_order_only_dependencies)" to "".



---

archive/issue_comments_321495.json:
```json
{
    "body": "**Changing reviewer** from \"Dima Pasechnik\" to \"\".",
    "created_at": "2016-10-15T01:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321495",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Dima Pasechnik" to "".



---

archive/issue_comments_321496.json:
```json
{
    "body": "**Changing commit** from \"[0480c3486f12f76f2bf7200799676774a3f07fda](https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda)\" to \"\".",
    "created_at": "2016-10-15T01:58:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321496",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[0480c3486f12f76f2bf7200799676774a3f07fda](https://github.com/sagemath/sagetrac-mirror/commit/0480c3486f12f76f2bf7200799676774a3f07fda)" to "".



---

archive/issue_comments_321497.json:
```json
{
    "body": "<a id='comment:16'></a>\nI suppose a simple solution could be to have two packages:\n- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).\n- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).",
    "created_at": "2016-10-15T02:05:28Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321497",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I suppose a simple solution could be to have two packages:
- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).
- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).



---

archive/issue_comments_321498.json:
```json
{
    "body": "<a id='comment:17'></a>\nWhy not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?",
    "created_at": "2016-10-15T07:29:18Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?



---

archive/issue_comments_321499.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A17):\n> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?\n\nSee #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).\n\nAccording to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.",
    "created_at": "2017-03-02T10:36:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321499",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A17):
> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?

See #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).

According to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.



---

archive/issue_comments_321500.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,5 +13,8 @@\n In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. \n \n \n+This feature can be implemented by Makefile trickery, of course. See\n+- #30560: `openssl` an optional dependency of `python3`\n \n \n+\n``````\n",
    "created_at": "2020-09-13T19:37:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321500",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,5 +13,8 @@
 In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. 
 
 
+This feature can be implemented by Makefile trickery, of course. See
+- #30560: `openssl` an optional dependency of `python3`
 
 
+
``````




---

archive/issue_events_194335.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194335"
}
```



---

archive/issue_events_194336.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194336"
}
```



---

archive/issue_events_194337.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "component: packages: experimental",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194337"
}
```



---

archive/issue_events_194338.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "label": "component: build: configure",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194338"
}
```



---

archive/issue_events_194339.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:45:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "rename": {
        "from": "Packages with \"optional\" dependencies (a package manager's suggested/recommended packages)",
        "to": "Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194339"
}
```



---

archive/issue_comments_321501.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-At least two of our optional/experimental packages, `latte_int` and `polymake` can be built with or without the presence of some other packages.\n+Various packages can be built with or without the presence of some other packages.\n \n For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.\n \n@@ -8,13 +8,25 @@\n \n GNU make's \"order-only dependencies\" sound as if they can do this, but as Jeroen explains, they can't.\n \n-Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we should find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n \n-In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. \n+In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. \n \n \n-This feature can be implemented by Makefile trickery, of course. See\n+This feature can be implemented by Makefile trickery, of course. See #30560.\n+\n+\n+Tickets:\n+\n - #30560: `openssl` an optional dependency of `python3`\n+\n+- `giac` detects `cocoa` (which we have added as an experimental package)\n+\n+- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)\n+\n+- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency\n+\n+- `polymake` has lots of optional dependencies\n \n \n \n``````\n",
    "created_at": "2020-09-13T19:45:36Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321501",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-At least two of our optional/experimental packages, `latte_int` and `polymake` can be built with or without the presence of some other packages.
+Various packages can be built with or without the presence of some other packages.
 
 For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.
 
@@ -8,13 +8,25 @@
 
 GNU make's "order-only dependencies" sound as if they can do this, but as Jeroen explains, they can't.
 
-Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we should find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.
+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.
 
-In particular, this will be relevant in the context of #21538, which provides `./configure --with-packages=lidia,latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. 
+In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. 
 
 
-This feature can be implemented by Makefile trickery, of course. See
+This feature can be implemented by Makefile trickery, of course. See #30560.
+
+
+Tickets:
+
 - #30560: `openssl` an optional dependency of `python3`
+
+- `giac` detects `cocoa` (which we have added as an experimental package)
+
+- `pynac` is able to use `giac` if present (but we currently explicitly disable its use)
+
+- `latte_int` is able to use `lidia` for one subroutine -- a huge and unmaintained package; currently it is a normal dependency
+
+- `polymake` has lots of optional dependencies
 
 
 
``````




---

archive/issue_comments_321502.json:
```json
{
    "body": "Regarding this part of the ticket description:\n\nReplying to [ticket:21700 mkoeppe]:\n> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n\nIt is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.\n\n(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)",
    "created_at": "2020-09-14T16:31:40Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321502",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding this part of the ticket description:

Replying to [ticket:21700 mkoeppe]:
> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.

It is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.

(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)



---

archive/issue_comments_321503.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,9 +8,7 @@\n \n GNU make's \"order-only dependencies\" sound as if they can do this, but as Jeroen explains, they can't.\n \n-Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n-\n-In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. \n+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. \n \n \n This feature can be implemented by Makefile trickery, of course. See #30560.\n``````\n",
    "created_at": "2020-09-14T19:00:44Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321503",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,9 +8,7 @@
 
 GNU make's "order-only dependencies" sound as if they can do this, but as Jeroen explains, they can't.
 
-Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.
-
-In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int`, for which the sequential workaround (`sage -i lidia && sage -i latte_int`) is not available. 
+Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. 
 
 
 This feature can be implemented by Makefile trickery, of course. See #30560.
``````




---

archive/issue_comments_321504.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks, I have updated the ticket description",
    "created_at": "2020-09-14T19:00:44Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321504",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Thanks, I have updated the ticket description



---

archive/issue_comments_321505.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,12 +1,8 @@\n Various packages can be built with or without the presence of some other packages.\n \n-For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.\n+For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)\n \n-Linux package managers have the notion of suggested or recommended packages for this situation.\n-\n-In any case, it would be good if whenever the user does `sage -i latte_int lidia` or `make latte_int lidia`, then `lidia` is treated as a dependency, so that the `latte_int` build is started only when the `lidia` build is completed.\n-\n-GNU make's \"order-only dependencies\" sound as if they can do this, but as Jeroen explains, they can't.\n+GNU make's \"order-only dependencies\" \"sound\" as if they can do this, but as Jeroen explains, they can't.\n \n Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. \n \n``````\n",
    "created_at": "2020-09-14T19:03:24Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321505",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,12 +1,8 @@
 Various packages can be built with or without the presence of some other packages.
 
-For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency.
+For example, the `latte_int` configure script detects `lrslib` and `lidia` if they are installed, and they provide additional features. `lidia` is quite a big package, and so it is not clear whether it should be a dependency. (Linux package managers have the notion of suggested or recommended packages for this situation.)
 
-Linux package managers have the notion of suggested or recommended packages for this situation.
-
-In any case, it would be good if whenever the user does `sage -i latte_int lidia` or `make latte_int lidia`, then `lidia` is treated as a dependency, so that the `latte_int` build is started only when the `lidia` build is completed.
-
-GNU make's "order-only dependencies" sound as if they can do this, but as Jeroen explains, they can't.
+GNU make's "order-only dependencies" "sound" as if they can do this, but as Jeroen explains, they can't.
 
 Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int` (or similar invocations such as `make lidia latte_int`, which are sequential from left to right thanks to our top-level Makefile), but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.  In particular, this is relevant after #21538, which provides `./configure --enable-lidia --enable-latte_int && MAKE=-j12 make`, for which the sequential workaround is not available. 
 
``````




---

archive/issue_comments_321506.json:
```json
{
    "body": "<a id='comment:24'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321506",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_194340.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194340"
}
```



---

archive/issue_events_194341.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194341"
}
```



---

archive/issue_comments_321507.json:
```json
{
    "body": "<a id='comment:25'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321507",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_194342.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194342"
}
```



---

archive/issue_events_194343.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194343"
}
```



---

archive/issue_events_194344.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194344"
}
```



---

archive/issue_events_194345.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194345"
}
```



---

archive/issue_events_194346.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194346"
}
```



---

archive/issue_events_194347.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194347"
}
```



---

archive/issue_comments_321508.json:
```json
{
    "body": "**Dependencies:** #31017",
    "created_at": "2022-05-24T16:14:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21700#issuecomment-321508",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31017



---

archive/issue_events_194348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194348"
}
```



---

archive/issue_events_194349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21700",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21700#event-194349"
}
```
