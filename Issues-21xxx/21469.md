# Issue 21469: Enable VPATH builds (several independent build trees connected to one source tree)

archive/issues_021232.json:
```json
{
    "assignees": [],
    "body": "**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.\n\nThe `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.\n\n\n---\n\n\n[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n\nThis is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n\nFor Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n\nThis is how it is used.\n\n```\n cd SAGE_ROOT\n autoreconf\n```\nand then\n\n```\n mkdir BUILDDIR\n cd BUILDDIR\n SRCDIR/configure --srcdir=SRCDIR\n make\n```\n\nThe present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n\nThe present patch changes the various places where $SAGE_ROOT is used.\nWhen \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n\nWith the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n\n\n\nCC:  @sagetrac-felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri\n\nBranch/Commit: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build) @ [`05f3a91`](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**\n\nWork Issues: **merge conflicts**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21469_\n\n",
    "created_at": "2016-09-11T03:59:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Enable VPATH builds (several independent build trees connected to one source tree)",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/21469",
    "user": "https://github.com/mkoeppe"
}
```
**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.

The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.


---


[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 

This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).

For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.

This is how it is used.

```
 cd SAGE_ROOT
 autoreconf
```
and then

```
 mkdir BUILDDIR
 cd BUILDDIR
 SRCDIR/configure --srcdir=SRCDIR
 make
```

The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.

The present patch changes the various places where $SAGE_ROOT is used.
When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 

With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.



CC:  @sagetrac-felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri

Branch/Commit: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build) @ [`05f3a91`](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**

Work Issues: **merge conflicts**

Author: **Matthias Koeppe**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/21469_





---

archive/issue_events_298876.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298876"
}
```



---

archive/issue_events_298877.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298877"
}
```



---

archive/issue_events_298878.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298878"
}
```



---

archive/issue_events_298879.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298879"
}
```



---

archive/issue_comments_314569.json:
```json
{
    "body": "Branch: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build)**",
    "created_at": "2016-09-11T04:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314569",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build)**



---

archive/issue_comments_314570.json:
```json
{
    "body": "Commit: **[`ac27cdc`](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)**",
    "created_at": "2016-09-11T18:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314570",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`ac27cdc`](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)**



---

archive/issue_comments_314571.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af\"><code>ac27cdc</code></a></td><td><code>configure.ac: VPATH fixes</code></td></tr></table>\n",
    "created_at": "2016-09-11T18:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314571",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af"><code>ac27cdc</code></a></td><td><code>configure.ac: VPATH fixes</code></td></tr></table>




---

archive/issue_comments_314572.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5698f8e2dba49f3f4eaa3058b73512c403719d84\"><code>5698f8e</code></a></td><td><code>Distinguish SAGE_ROOT and SAGE_SRC_ROOT for VPATH build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a98cfa2e9461af5d48809319dc862e1e738cdd11\"><code>a98cfa2</code></a></td><td><code>Use AC_CONFIG_COMMANDS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f\"><code>e9b1c0f</code></a></td><td><code>Symlink build/pkgs (temporary solution)</code></td></tr></table>\n",
    "created_at": "2016-09-11T21:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314572",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5698f8e2dba49f3f4eaa3058b73512c403719d84"><code>5698f8e</code></a></td><td><code>Distinguish SAGE_ROOT and SAGE_SRC_ROOT for VPATH build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a98cfa2e9461af5d48809319dc862e1e738cdd11"><code>a98cfa2</code></a></td><td><code>Use AC_CONFIG_COMMANDS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f"><code>e9b1c0f</code></a></td><td><code>Symlink build/pkgs (temporary solution)</code></td></tr></table>




---

archive/issue_comments_314573.json:
```json
{
    "body": "Changed commit from **[`ac27cdc`](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)** to **[`e9b1c0f`](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)**",
    "created_at": "2016-09-11T21:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314573",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ac27cdc`](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)** to **[`e9b1c0f`](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)**



---

archive/issue_events_298880.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T21:39:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298880"
}
```



---

archive/issue_comments_314574.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993\"><code>e15ada6</code></a></td><td><code>Define SAGE_SRC_ROOT for VPATH build</code></td></tr></table>\n",
    "created_at": "2016-09-11T22:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314574",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993"><code>e15ada6</code></a></td><td><code>Define SAGE_SRC_ROOT for VPATH build</code></td></tr></table>




---

archive/issue_comments_314575.json:
```json
{
    "body": "Changed commit from **[`e9b1c0f`](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)** to **[`e15ada6`](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)**",
    "created_at": "2016-09-11T22:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314575",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e9b1c0f`](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)** to **[`e15ada6`](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)**



---

archive/issue_comments_314576.json:
```json
{
    "body": "Changed commit from **[`e15ada6`](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)** to **[`9323c01`](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)**",
    "created_at": "2016-09-12T00:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314576",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e15ada6`](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)** to **[`9323c01`](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)**



---

archive/issue_comments_314577.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7\"><code>9323c01</code></a></td><td><code>Use SAGE_SRC_ROOT in package scripts</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314577",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7"><code>9323c01</code></a></td><td><code>Use SAGE_SRC_ROOT in package scripts</code></td></tr></table>




---

archive/issue_comments_314578.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f\"><code>7a3913a</code></a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314578",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f"><code>7a3913a</code></a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>




---

archive/issue_comments_314579.json:
```json
{
    "body": "Changed commit from **[`9323c01`](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)** to **[`7a3913a`](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)**",
    "created_at": "2016-09-12T00:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314579",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9323c01`](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)** to **[`7a3913a`](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)**



---

archive/issue_comments_314580.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258\"><code>4cc3954</code></a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>\n",
    "created_at": "2016-09-12T05:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314580",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258"><code>4cc3954</code></a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>




---

archive/issue_comments_314581.json:
```json
{
    "body": "Changed commit from **[`7a3913a`](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)** to **[`4cc3954`](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)**",
    "created_at": "2016-09-12T05:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314581",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7a3913a`](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)** to **[`4cc3954`](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)**



---

archive/issue_comments_314582.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe current patch makes some high-level preparations for a VPATH build, in particular the package system.\n\n\"make\" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).\n\nI've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.",
    "created_at": "2016-09-12T05:32:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314582",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

The current patch makes some high-level preparations for a VPATH build, in particular the package system.

"make" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).

I've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.



---

archive/issue_comments_314583.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nThis is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nOther people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.",
    "created_at": "2016-09-12T05:49:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314583",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

This is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Other people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.



---

archive/issue_comments_314584.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@kiwifb](#comment:10):\n> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nA VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.",
    "created_at": "2016-09-12T05:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314584",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@kiwifb](#comment:10):
> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

A VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.



---

archive/issue_comments_314585.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775\"><code>7bb8718</code></a></td><td><code>Make sage script in build dir executable</code></td></tr></table>\n",
    "created_at": "2016-09-12T06:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314585",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775"><code>7bb8718</code></a></td><td><code>Make sage script in build dir executable</code></td></tr></table>




---

archive/issue_comments_314586.json:
```json
{
    "body": "Changed commit from **[`4cc3954`](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)** to **[`7bb8718`](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)**",
    "created_at": "2016-09-12T06:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314586",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4cc3954`](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)** to **[`7bb8718`](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)**



---

archive/issue_comments_314587.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@kiwifb](#comment:10):\n> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nYes, this ticket does not address any of the issues that would arise in distribution packaging. \n\nInstead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.",
    "created_at": "2016-09-12T06:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314587",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@kiwifb](#comment:10):
> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Yes, this ticket does not address any of the issues that would arise in distribution packaging. 

Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.



---

archive/issue_comments_314588.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\n\nSeriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n\nI guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.",
    "created_at": "2016-09-12T07:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314588",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">comment:14</div>

I should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)

Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.

I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.



---

archive/issue_comments_314589.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kiwifb](#comment:14):\n> I should apologize for being so negative. \n\nNo worries.\n> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\n\nThat already works with this patch.\n> \n> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n> \n> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.\n\nSounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.",
    "created_at": "2016-09-12T07:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314589",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kiwifb](#comment:14):
> I should apologize for being so negative. 

No worries.
> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)

That already works with this patch.
> 
> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.
> 
> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.

Sounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.



---

archive/issue_comments_314590.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@mkoeppe](#comment:13):\n> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.\n\nI sort of agree with Fran\u00e7ois.\n\nPart of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nFor the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nFor the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.",
    "created_at": "2016-09-12T11:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314590",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@mkoeppe](#comment:13):
> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.

I sort of agree with François.

Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.



---

archive/issue_events_298881.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-12T12:00:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298881"
}
```



---

archive/issue_events_298882.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-12T12:00:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298882"
}
```



---

archive/issue_comments_314591.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think the ticket description should have a *lot* more information about\n\n1. which problem that this ticket is trying to solve (the **why**).\n\n2. what the branch actually does (the **what**).\n\nNote that this are 2 independent things (which are unfortunately often confused).",
    "created_at": "2016-09-12T12:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314591",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

I think the ticket description should have a *lot* more information about

1. which problem that this ticket is trying to solve (the **why**).

2. what the branch actually does (the **what**).

Note that this are 2 independent things (which are unfortunately often confused).



---

archive/issue_comments_314592.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI've updated the description.",
    "created_at": "2016-09-12T17:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314592",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

I've updated the description.



---

archive/issue_comments_314593.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n-It would be convenient for VPATH builds to work.\n+VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n+\n+This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n+\n+For Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n+\n+This is how it is used.\n \n ```\n  mkdir BUILDDIR\n@@ -7,6 +13,13 @@\n  make\n ```\n \n-Probably #14796 has work into this direction, but it seems to be an abandoned effort.\n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. \n+The present patch changes the various places where $SAGE_ROOT is used.\n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n+\n+With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.\n+(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)\n \n \n+\n+\n``````\n",
    "created_at": "2016-09-12T17:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314593",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
-It would be convenient for VPATH builds to work.
+VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
+
+This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
+
+For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.
+
+This is how it is used.
 
 ```
  mkdir BUILDDIR
@@ -7,6 +13,13 @@
  make
 ```
 
-Probably #14796 has work into this direction, but it seems to be an abandoned effort.
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. 
+The present patch changes the various places where $SAGE_ROOT is used.
+When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
+
+With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.
+(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)
 
 
+
+
``````




---

archive/issue_events_298883.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T17:47:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298883"
}
```



---

archive/issue_events_298884.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T17:47:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298884"
}
```



---

archive/issue_comments_314594.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:16):\n> Replying to [@mkoeppe](#comment:13):\n> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nI've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.\n\n> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nRight, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.\n\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nCertainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).",
    "created_at": "2016-09-12T17:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314594",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:16):
> Replying to [@mkoeppe](#comment:13):
> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

I've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.

> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

Right, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.

> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Certainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).



---

archive/issue_comments_314595.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n+[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n \n This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n \n``````\n",
    "created_at": "2016-09-12T18:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314595",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
+[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
 
 This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
 
``````




---

archive/issue_comments_314596.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. \n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). \n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n``````\n",
    "created_at": "2016-09-12T18:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314596",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. 
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). 
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
``````




---

archive/issue_comments_314597.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:16):\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nIt seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).",
    "created_at": "2016-09-12T18:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314597",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:16):
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).



---

archive/issue_comments_314598.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment:22):\n> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).\n\nHowever, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804",
    "created_at": "2016-09-12T19:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314598",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment:22):
> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).

However, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804



---

archive/issue_comments_314599.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n> Replying to [@jdemeyer](#comment:16):\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nAlso, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.\n\n```\npython setup.py build --build-base=BUILDDIR\n```",
    "created_at": "2016-09-12T19:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314599",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

> Replying to [@jdemeyer](#comment:16):
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Also, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.

```
python setup.py build --build-base=BUILDDIR
```



---

archive/issue_comments_314600.json:
```json
{
    "body": "Dependencies: **#21480**",
    "created_at": "2016-09-12T22:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314600",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#21480**



---

archive/issue_comments_314601.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis is now #21480.",
    "created_at": "2016-09-12T22:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314601",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

This is now #21480.



---

archive/issue_comments_314602.json:
```json
{
    "body": "Changed commit from **[`7bb8718`](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)** to **[`81f4306`](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)**",
    "created_at": "2016-09-13T00:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314602",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7bb8718`](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)** to **[`81f4306`](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)**



---

archive/issue_comments_314603.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01\"><code>81f4306</code></a></td><td><code>Fix for unconfigured non-VPATH build</code></td></tr></table>\n",
    "created_at": "2016-09-13T00:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314603",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01"><code>81f4306</code></a></td><td><code>Fix for unconfigured non-VPATH build</code></td></tr></table>




---

archive/issue_events_298885.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T04:57:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298885"
}
```



---

archive/issue_events_298886.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T04:57:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298886"
}
```



---

archive/issue_events_298887.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T21:19:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298887"
}
```



---

archive/issue_events_298888.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T21:19:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298888"
}
```



---

archive/issue_comments_314604.json:
```json
{
    "body": "Changed commit from **[`81f4306`](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)** to **[`7e11d55`](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)**",
    "created_at": "2017-08-27T04:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314604",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`81f4306`](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)** to **[`7e11d55`](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)**



---

archive/issue_comments_314605.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9\"><code>7e11d55</code></a></td><td><code>VPATH build</code></td></tr></table>\n",
    "created_at": "2017-08-27T04:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314605",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9"><code>7e11d55</code></a></td><td><code>VPATH build</code></td></tr></table>




---

archive/issue_comments_314606.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nsquashed into 1 commit to simplify rebasing.",
    "created_at": "2017-08-27T04:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314606",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

squashed into 1 commit to simplify rebasing.



---

archive/issue_events_298889.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298889"
}
```



---

archive/issue_events_298890.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298890"
}
```



---

archive/issue_comments_314607.json:
```json
{
    "body": "Changed dependencies from **#21480** to **#21535**",
    "created_at": "2017-08-27T05:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314607",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#21480** to **#21535**



---

archive/issue_comments_314608.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThe next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded \"build\").",
    "created_at": "2017-08-27T05:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314608",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

The next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded "build").



---

archive/issue_comments_314609.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca281d2f62d294c79a3b952787e4ed311ad6deba\"><code>ca281d2</code></a></td><td><code>VPATH build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae7bdf7426461a0ec255a6456c339da35f3d058a\"><code>ae7bdf7</code></a></td><td><code>configure.ac: Quoting fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c\"><code>23cc689</code></a></td><td><code>src/Makefile.in: Use setup.py --build-base</code></td></tr></table>\n",
    "created_at": "2017-08-28T02:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314609",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca281d2f62d294c79a3b952787e4ed311ad6deba"><code>ca281d2</code></a></td><td><code>VPATH build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae7bdf7426461a0ec255a6456c339da35f3d058a"><code>ae7bdf7</code></a></td><td><code>configure.ac: Quoting fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c"><code>23cc689</code></a></td><td><code>src/Makefile.in: Use setup.py --build-base</code></td></tr></table>




---

archive/issue_comments_314610.json:
```json
{
    "body": "Changed commit from **[`7e11d55`](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)** to **[`23cc689`](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)**",
    "created_at": "2017-08-28T02:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314610",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7e11d55`](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)** to **[`23cc689`](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)**



---

archive/issue_comments_314611.json:
```json
{
    "body": "Changed commit from **[`23cc689`](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)** to **[`72818e5`](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)**",
    "created_at": "2017-08-28T05:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314611",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`23cc689`](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)** to **[`72818e5`](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)**



---

archive/issue_comments_314612.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11\"><code>72818e5</code></a></td><td><code>Some path fixes for VPATH</code></td></tr></table>\n",
    "created_at": "2017-08-28T05:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314612",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11"><code>72818e5</code></a></td><td><code>Some path fixes for VPATH</code></td></tr></table>




---

archive/issue_comments_314613.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffb0040550a8c2cd9248299ac342e5e58451c96\"><code>3ffb004</code></a></td><td><code>VPATH fixes for src/bin and src/ext installs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365\"><code>d0366b0</code></a></td><td><code>build/make/deps: Fix sage-env path</code></td></tr></table>\n",
    "created_at": "2017-08-28T15:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314613",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffb0040550a8c2cd9248299ac342e5e58451c96"><code>3ffb004</code></a></td><td><code>VPATH fixes for src/bin and src/ext installs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365"><code>d0366b0</code></a></td><td><code>build/make/deps: Fix sage-env path</code></td></tr></table>




---

archive/issue_comments_314614.json:
```json
{
    "body": "Changed commit from **[`72818e5`](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)** to **[`d0366b0`](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)**",
    "created_at": "2017-08-28T15:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314614",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`72818e5`](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)** to **[`d0366b0`](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)**



---

archive/issue_comments_314615.json:
```json
{
    "body": "Changed dependencies from **#21535** to none",
    "created_at": "2017-08-28T15:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314615",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#21535** to none



---

archive/issue_comments_314616.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nRemoved #21535 dependency. `setup.py --build-base` actually works already.\n\nWith the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.",
    "created_at": "2017-08-28T15:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314616",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Removed #21535 dependency. `setup.py --build-base` actually works already.

With the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.



---

archive/issue_comments_314617.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,8 +17,7 @@\n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.\n-(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)\n+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n \n``````\n",
    "created_at": "2017-08-28T15:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314617",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,8 +17,7 @@
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.
-(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)
+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
 
``````




---

archive/issue_comments_314618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,12 +13,11 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). \n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n+\n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n-\n-\n``````\n",
    "created_at": "2017-08-28T15:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314618",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,12 +13,11 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). 
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
+
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
 With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
-
-
``````




---

archive/issue_events_298891.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-28T15:53:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "title_is": "Enable VPATH builds (several independent build trees connected to one source tree)",
    "title_was": "Enable VPATH builds",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298891"
}
```



---

archive/issue_comments_314619.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOn OS X, some directories are not being created:\n\n```\n$ mkdir BUILD\n$ cd BUILD\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\n/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory\n```\nIf I create that directory, `configure` finishes but with warning messages like this\n\n```\n$ mkdir -p build/make\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\ntouch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory\nfind: /path/to/BUILD/src/ext: No such file or directory\ncat: /path/to/BUILD/build/make/deps: No such file or directory\n...\n$ make\nmake: *** No targets specified and no makefile found.  Stop.\n```",
    "created_at": "2017-08-28T16:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314619",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

On OS X, some directories are not being created:

```
$ mkdir BUILD
$ cd BUILD
$ /path/to/sage/configure --srcdir=/path/to/sage
...
/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory
```
If I create that directory, `configure` finishes but with warning messages like this

```
$ mkdir -p build/make
$ /path/to/sage/configure --srcdir=/path/to/sage
...
touch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory
find: /path/to/BUILD/src/ext: No such file or directory
cat: /path/to/BUILD/build/make/deps: No such file or directory
...
$ make
make: *** No targets specified and no makefile found.  Stop.
```



---

archive/issue_comments_314620.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nDid you autoreconf?",
    "created_at": "2017-08-28T20:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314620",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Did you autoreconf?



---

archive/issue_comments_314621.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,12 @@\n For Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n \n This is how it is used.\n+\n+```\n+ cd SAGE_ROOT\n+ autoreconf\n+```\n+and then\n \n ```\n  mkdir BUILDDIR\n``````\n",
    "created_at": "2017-08-28T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314621",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,12 @@
 For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.
 
 This is how it is used.
+
+```
+ cd SAGE_ROOT
+ autoreconf
+```
+and then
 
 ```
  mkdir BUILDDIR
``````




---

archive/issue_comments_314622.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nNo, that fixed it.",
    "created_at": "2017-08-28T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314622",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

No, that fixed it.



---

archive/issue_comments_314623.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nWith the changes\n\n```diff\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex dc2bd34cc0..8aa523d7ea 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -313,7 +313,7 @@ export SAGE_EXTCODE=\"$SAGE_SHARE/sage/ext\"\n export SAGE_SPKG_INST=\"$SAGE_LOCAL/var/lib/sage/installed\"\n export SAGE_LOGS=\"$SAGE_ROOT/logs/pkgs\"\n export SAGE_SRC=\"$SAGE_ROOT/src\"\n-export SAGE_DOC_SRC=\"$SAGE_SRC/doc\"\n+export SAGE_DOC_SRC=\"$SAGE_SRC_ROOT/src/doc\"\n export SAGE_DOC=\"$SAGE_SHARE/doc/sage\"\n \n if [ -z \"${SAGE_ORIG_PATH_SET}\" ]; then\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 2e115fab88..88f3fdfa4a 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -1,10 +1,10 @@\n import sys, os, sphinx\n-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR\n+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR\n from datetime import date\n from six import iteritems\n \n # If your extensions are in another directory, add it here.\n-sys.path.append(os.path.join(SAGE_SRC, \"sage_setup\", \"docbuild\", \"ext\"))\n+sys.path.append(os.path.join(SAGE_SRC_ROOT, \"src\", \"sage_setup\", \"docbuild\", \"ext\"))\n \n # General configuration\n # ---------------------\n```\nthe documentation starts to build, but I eventually get an error:\n\n```\n[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n```\nI can't figure out where this is coming from.",
    "created_at": "2017-08-29T03:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314623",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

With the changes

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index dc2bd34cc0..8aa523d7ea 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -313,7 +313,7 @@ export SAGE_EXTCODE="$SAGE_SHARE/sage/ext"
 export SAGE_SPKG_INST="$SAGE_LOCAL/var/lib/sage/installed"
 export SAGE_LOGS="$SAGE_ROOT/logs/pkgs"
 export SAGE_SRC="$SAGE_ROOT/src"
-export SAGE_DOC_SRC="$SAGE_SRC/doc"
+export SAGE_DOC_SRC="$SAGE_SRC_ROOT/src/doc"
 export SAGE_DOC="$SAGE_SHARE/doc/sage"
 
 if [ -z "${SAGE_ORIG_PATH_SET}" ]; then
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 2e115fab88..88f3fdfa4a 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -1,10 +1,10 @@
 import sys, os, sphinx
-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR
+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR
 from datetime import date
 from six import iteritems
 
 # If your extensions are in another directory, add it here.
-sys.path.append(os.path.join(SAGE_SRC, "sage_setup", "docbuild", "ext"))
+sys.path.append(os.path.join(SAGE_SRC_ROOT, "src", "sage_setup", "docbuild", "ext"))
 
 # General configuration
 # ---------------------
```
the documentation starts to build, but I eventually get an error:

```
[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
```
I can't figure out where this is coming from.



---

archive/issue_comments_314624.json:
```json
{
    "body": "Changed commit from **[`d0366b0`](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)** to **[`e7a78e0`](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)**",
    "created_at": "2017-08-29T17:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314624",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d0366b0`](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)** to **[`e7a78e0`](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)**



---

archive/issue_comments_314625.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db34265bc602f68c7ae1e20c4c2b1a4f2906b5e3\"><code>db34265</code></a></td><td><code>Merge tag '8.1.beta3' into t/21469/vpath_build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d\"><code>e7a78e0</code></a></td><td><code>VPATH fix for docbuild</code></td></tr></table>\n",
    "created_at": "2017-08-29T17:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314625",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db34265bc602f68c7ae1e20c4c2b1a4f2906b5e3"><code>db34265</code></a></td><td><code>Merge tag '8.1.beta3' into t/21469/vpath_build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d"><code>e7a78e0</code></a></td><td><code>VPATH fix for docbuild</code></td></tr></table>




---

archive/issue_comments_314626.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThanks, I've added your changes as a commit.",
    "created_at": "2017-08-29T17:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314626",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Thanks, I've added your changes as a commit.



---

archive/issue_comments_314627.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jhpalmieri](#comment:42):\n> the documentation starts to build, but I eventually get an error:\n> \n> ```\n> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n> ```\n\nI get the same error",
    "created_at": "2017-08-29T17:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314627",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jhpalmieri](#comment:42):
> the documentation starts to build, but I eventually get an error:
> 
> ```
> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
> ```

I get the same error



---

archive/issue_comments_314628.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nOne more change, to help `make distclean` work:\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex 3128f4c656..03f2c8fff1 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)\n doc-clean: doc-src-clean doc-output-clean\n \n doc-src-clean:\n-       cd \"$(SAGE_SRC)/doc\" && $(MAKE) clean\n+       cd \"$(SAGE_SRC_ROOT)/src/doc\" && $(MAKE) clean\n \n doc-output-clean:\n        rm -rf \"$(SAGE_SHARE)/doc/sage\"\n```",
    "created_at": "2017-08-29T18:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314628",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:46" align="right">comment:46</div>

One more change, to help `make distclean` work:

```diff
diff --git a/build/make/deps b/build/make/deps
index 3128f4c656..03f2c8fff1 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)
 doc-clean: doc-src-clean doc-output-clean
 
 doc-src-clean:
-       cd "$(SAGE_SRC)/doc" && $(MAKE) clean
+       cd "$(SAGE_SRC_ROOT)/src/doc" && $(MAKE) clean
 
 doc-output-clean:
        rm -rf "$(SAGE_SHARE)/doc/sage"
```



---

archive/issue_comments_314629.json:
```json
{
    "body": "Changed commit from **[`e7a78e0`](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)** to **[`734fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)**",
    "created_at": "2017-08-29T18:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314629",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e7a78e0`](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)** to **[`734fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)**



---

archive/issue_comments_314630.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0\"><code>734fb4b</code></a></td><td><code>VPATH fix for doc-src-clean</code></td></tr></table>\n",
    "created_at": "2017-08-29T18:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314630",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0"><code>734fb4b</code></a></td><td><code>VPATH fix for doc-src-clean</code></td></tr></table>




---

archive/issue_comments_314631.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nPerhaps the sphinx problem is related to failing source discovery for Cython modules:\n\n```\nsage: sage.rings.number_field.number_field_element_quadratic??\nError getting source: s must be a string\nType:            module\n...\n```",
    "created_at": "2017-08-29T18:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314631",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

Perhaps the sphinx problem is related to failing source discovery for Cython modules:

```
sage: sage.rings.number_field.number_field_element_quadratic??
Error getting source: s must be a string
Type:            module
...
```



---

archive/issue_comments_314632.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nYes, that looks like it.",
    "created_at": "2017-08-29T18:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314632",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:49" align="right">comment:49</div>

Yes, that looks like it.



---

archive/issue_comments_314633.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nOkay, how about this:\n\n```diff\ndiff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\nindex f9dffc1ce3..3a286c7934 100644\n--- a/src/sage/misc/sageinspect.py\n+++ b/src/sage/misc/sageinspect.py\n@@ -125,7 +125,7 @@ import tokenize\n import types\n import re\n EMBEDDED_MODE = False\n-from sage.env import SAGE_SRC\n+from sage.env import SAGE_SRC_ROOT\n \n def loadable_module_extension():\n     r\"\"\"\n@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):\n         return None\n \n     raw_filename = res.group('FILENAME')\n-    filename = os.path.join(SAGE_SRC, raw_filename)\n+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n     if not os.path.isfile(filename):\n         from sage.misc.misc import SPYX_TMP\n         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n@@ -2308,7 +2308,7 @@ def __internal_tests():\n \n     Test _extract_embedded_position:\n \n-    We cannot test the filename since it depends on SAGE_SRC.\n+    We cannot test the filename since it depends on SAGE_SRC_ROOT.\n \n     Make sure things work with no trailing newline::\n \n```",
    "created_at": "2017-08-29T19:07:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314633",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:50" align="right">comment:50</div>

Okay, how about this:

```diff
diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index f9dffc1ce3..3a286c7934 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -125,7 +125,7 @@ import tokenize
 import types
 import re
 EMBEDDED_MODE = False
-from sage.env import SAGE_SRC
+from sage.env import SAGE_SRC_ROOT
 
 def loadable_module_extension():
     r"""
@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):
         return None
 
     raw_filename = res.group('FILENAME')
-    filename = os.path.join(SAGE_SRC, raw_filename)
+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
     if not os.path.isfile(filename):
         from sage.misc.misc import SPYX_TMP
         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
@@ -2308,7 +2308,7 @@ def __internal_tests():
 
     Test _extract_embedded_position:
 
-    We cannot test the filename since it depends on SAGE_SRC.
+    We cannot test the filename since it depends on SAGE_SRC_ROOT.
 
     Make sure things work with no trailing newline::
 
```



---

archive/issue_comments_314634.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nNow the cross-references are wrong or missing:\n\n```\n[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```",
    "created_at": "2017-08-29T20:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314634",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:51" align="right">comment:51</div>

Now the cross-references are wrong or missing:

```
[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```



---

archive/issue_comments_314635.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAlso, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.",
    "created_at": "2017-08-29T20:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314635",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

Also, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.



---

archive/issue_comments_314636.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d\"><code>8c801f7</code></a></td><td><code>VPATH: Set SAGE_SRC to actual source tree throughout</code></td></tr></table>\n",
    "created_at": "2017-08-29T21:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314636",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d"><code>8c801f7</code></a></td><td><code>VPATH: Set SAGE_SRC to actual source tree throughout</code></td></tr></table>




---

archive/issue_comments_314637.json:
```json
{
    "body": "Changed commit from **[`734fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)** to **[`8c801f7`](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)**",
    "created_at": "2017-08-29T21:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314637",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`734fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)** to **[`8c801f7`](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)**



---

archive/issue_comments_314638.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jhpalmieri](#comment:50):\n> Okay, how about this:\n> \n> ```diff\n> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\n> index f9dffc1ce3..3a286c7934 100644\n> --- a/src/sage/misc/sageinspect.py\n> +++ b/src/sage/misc/sageinspect.py\n> @@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):\n>          return None\n>  \n>      raw_filename = res.group('FILENAME')\n> -    filename = os.path.join(SAGE_SRC, raw_filename)\n> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n>      if not os.path.isfile(filename):\n>          from sage.misc.misc import SPYX_TMP\n>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n> ```\n\nInstead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.",
    "created_at": "2017-08-29T21:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314638",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jhpalmieri](#comment:50):
> Okay, how about this:
> 
> ```diff
> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
> index f9dffc1ce3..3a286c7934 100644
> --- a/src/sage/misc/sageinspect.py
> +++ b/src/sage/misc/sageinspect.py
> @@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):
>          return None
>  
>      raw_filename = res.group('FILENAME')
> -    filename = os.path.join(SAGE_SRC, raw_filename)
> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
>      if not os.path.isfile(filename):
>          from sage.misc.misc import SPYX_TMP
>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
> ```

Instead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.



---

archive/issue_comments_314639.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nI'm now testing the VPATH build using a separate user account that cannot write into the source tree. \nMore changes to the docbuild are necessary to separate sources from built files:\n\n```\n[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'\n```",
    "created_at": "2017-08-29T21:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314639",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

I'm now testing the VPATH build using a separate user account that cannot write into the source tree. 
More changes to the docbuild are necessary to separate sources from built files:

```
[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'
```



---

archive/issue_comments_314640.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nBy the way, I get warnings like\n\n```\ntouch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory\n```\nI assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.",
    "created_at": "2017-08-29T22:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314640",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">comment:56</div>

By the way, I get warnings like

```
touch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory
```
I assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.



---

archive/issue_comments_314641.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?",
    "created_at": "2017-08-29T22:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314641",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

I don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?



---

archive/issue_comments_314642.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nSorry, yes, that's what I meant, and that's what most of the warnings have been about.",
    "created_at": "2017-08-29T22:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314642",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:58" align="right">comment:58</div>

Sorry, yes, that's what I meant, and that's what most of the warnings have been about.



---

archive/issue_comments_314643.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThe `sage-arch-env` message is harmless.\nBut there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.",
    "created_at": "2017-08-29T22:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314643",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

The `sage-arch-env` message is harmless.
But there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.



---

archive/issue_comments_314644.json:
```json
{
    "body": "Changed commit from **[`8c801f7`](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)** to **[`5530827`](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)**",
    "created_at": "2017-08-29T22:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314644",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8c801f7`](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)** to **[`5530827`](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)**



---

archive/issue_comments_314645.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d\"><code>5530827</code></a></td><td><code>sage-env-config: Handle special case in build/make/deps, rather than configure.ac</code></td></tr></table>\n",
    "created_at": "2017-08-29T22:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314645",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d"><code>5530827</code></a></td><td><code>sage-env-config: Handle special case in build/make/deps, rather than configure.ac</code></td></tr></table>




---

archive/issue_comments_314646.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI'm getting this build error:\n\n```\nmake[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.\n```",
    "created_at": "2017-08-30T01:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314646",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:61" align="right">comment:61</div>

I'm getting this build error:

```
make[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.
```



---

archive/issue_comments_314647.json:
```json
{
    "body": "Changed commit from **[`5530827`](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)** to **[`64515c1`](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)**",
    "created_at": "2017-08-30T03:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314647",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5530827`](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)** to **[`64515c1`](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)**



---

archive/issue_comments_314648.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6\"><code>64515c1</code></a></td><td><code>Fix last change</code></td></tr></table>\n",
    "created_at": "2017-08-30T03:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314648",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6"><code>64515c1</code></a></td><td><code>Fix last change</code></td></tr></table>




---

archive/issue_comments_314649.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nThe make target \"sage-starts\" fails for me. This fixes it; is it the right way to fix it?\n\n```diff\ndiff --git a/src/bin/sage-starts b/src/bin/sage-starts\nindex 85cbae67e5..498c930810 100755\n--- a/src/bin/sage-starts\n+++ b/src/bin/sage-starts\n@@ -14,7 +14,7 @@ echo \"[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`\" | tee -a logs\n # sysadmin.  We use --nodotsage so we don't force a .sage directory\n # in the sysadmin's HOME directory.\n cmd='sage.all._write_started_file(); print \"Yes, Sage starts.\"'\n-build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n+\"$SAGE_SRC_ROOT\"/build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n \n if [ $? -ne 0 ]; then\n     echo >&2 \"Sage failed to start up.\"\n```",
    "created_at": "2017-08-30T15:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314649",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:63" align="right">comment:63</div>

The make target "sage-starts" fails for me. This fixes it; is it the right way to fix it?

```diff
diff --git a/src/bin/sage-starts b/src/bin/sage-starts
index 85cbae67e5..498c930810 100755
--- a/src/bin/sage-starts
+++ b/src/bin/sage-starts
@@ -14,7 +14,7 @@ echo "[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`" | tee -a logs
 # sysadmin.  We use --nodotsage so we don't force a .sage directory
 # in the sysadmin's HOME directory.
 cmd='sage.all._write_started_file(); print "Yes, Sage starts."'
-build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
+"$SAGE_SRC_ROOT"/build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
 
 if [ $? -ne 0 ]; then
     echo >&2 "Sage failed to start up."
```



---

archive/issue_comments_314650.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nWith that change, `make ptestlong` fails:\n\n```\nTesting that Sage starts...\n[2017-08-30 09:19:29] \nThis looks like the first time you are running Sage.\nCleaning up, do not interrupt this.\nDone cleaning.\nYes, Sage starts.\n\nreal\t52m33.269s\nuser\t191m2.435s\nsys\t19m38.034s\nSage build/upgrade complete!\n\nTo install small scripts to directly run Sage's versions of GAP,\nthe PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.\njust 'gap' or 'gp') into a standard 'bin' directory, start Sage\nby typing 'sage' (or './sage') and enter something like\n\n    install_scripts('/usr/local/bin')\n\nat the Sage command prompt ('sage:').\n\n/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\nmake: *** [ptestlong] Error 1\n```\nI think that the make target\n\n```\nTESTALL = $(top_srcdir)/sage -t --all\n```\nneeds to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.\n\n`./sage -t -all` also fails:\n\n```\n$ ./sage -t --all\n/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory\nTraceback (most recent call last):\n  File \"/.../SAGE_SRC_ROOT/src/bin/sage-runtests\", line 97, in <module>\n    DC = DocTestController(options, args)\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 334, in __init__\n    for pkg in list_packages('optional', local=True).values():\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py\", line 230, in list_packages\n    for p in os.listdir(SAGE_PKGS):\nOSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'\n```\nThis can almost be fixed by\n\n```diff\ndiff --git a/src/sage/env.py b/src/sage/env.py\nindex 33cd754a06..f91c70ba7d 100644\n--- a/src/sage/env.py\n+++ b/src/sage/env.py\n@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])\n _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))\n \n # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.\n-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))\n+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))\n \n \n _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))\n```\nbut there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.",
    "created_at": "2017-08-30T18:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314650",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:64" align="right">comment:64</div>

With that change, `make ptestlong` fails:

```
Testing that Sage starts...
[2017-08-30 09:19:29] 
This looks like the first time you are running Sage.
Cleaning up, do not interrupt this.
Done cleaning.
Yes, Sage starts.

real	52m33.269s
user	191m2.435s
sys	19m38.034s
Sage build/upgrade complete!

To install small scripts to directly run Sage's versions of GAP,
the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.
just 'gap' or 'gp') into a standard 'bin' directory, start Sage
by typing 'sage' (or './sage') and enter something like

    install_scripts('/usr/local/bin')

at the Sage command prompt ('sage:').

/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
make: *** [ptestlong] Error 1
```
I think that the make target

```
TESTALL = $(top_srcdir)/sage -t --all
```
needs to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.

`./sage -t -all` also fails:

```
$ ./sage -t --all
/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory
Traceback (most recent call last):
  File "/.../SAGE_SRC_ROOT/src/bin/sage-runtests", line 97, in <module>
    DC = DocTestController(options, args)
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py", line 334, in __init__
    for pkg in list_packages('optional', local=True).values():
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py", line 230, in list_packages
    for p in os.listdir(SAGE_PKGS):
OSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'
```
This can almost be fixed by

```diff
diff --git a/src/sage/env.py b/src/sage/env.py
index 33cd754a06..f91c70ba7d 100644
--- a/src/sage/env.py
+++ b/src/sage/env.py
@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])
 _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))
 
 # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.
-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))
+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))
 
 
 _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))
```
but there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.



---

archive/issue_comments_314651.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nIf I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.",
    "created_at": "2017-08-30T20:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314651",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:65" align="right">comment:65</div>

If I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.



---

archive/issue_comments_314652.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@jhpalmieri](#comment:64):\n> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.\n\nSee #23758.",
    "created_at": "2017-08-30T20:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314652",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@jhpalmieri](#comment:64):
> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.

See #23758.



---

archive/issue_comments_314653.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc6263c9cebb1da0320beeb5240e56477112c2cb\"><code>bc6263c</code></a></td><td><code>VPATH fix for SAGE_PKGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9c25bc06d357c348e2dbcf8ffb21306afcef750\"><code>f9c25bc</code></a></td><td><code>VPATH fix for test makefile targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecd2f9d0896fd7f78e2b97cd64ad8fc6a7e2da23\"><code>ecd2f9d</code></a></td><td><code>doc-src-clean: Clean in source directory until docbuild is fully VPATHified</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60927e52bd991cce1467ce0488ad29a4915b1986\"><code>60927e5</code></a></td><td><code>trac 23758: in env.py, _add_variable_or_fallback should depend less</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c23cc1cb041c57d364edd3b39389af7e1945ff44\"><code>c23cc1c</code></a></td><td><code>trac 23758: restore \"import os\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/343d685800f3c4018724cbea795e79d64c9adeca\"><code>343d685</code></a></td><td><code>trac 23758: add a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822\"><code>3e36b75</code></a></td><td><code>Merge remote-tracking branch 'trac/u/jhpalmieri/variable_replacement' into t/21469/vpath_build</code></td></tr></table>\n",
    "created_at": "2017-08-31T05:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314653",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc6263c9cebb1da0320beeb5240e56477112c2cb"><code>bc6263c</code></a></td><td><code>VPATH fix for SAGE_PKGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9c25bc06d357c348e2dbcf8ffb21306afcef750"><code>f9c25bc</code></a></td><td><code>VPATH fix for test makefile targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecd2f9d0896fd7f78e2b97cd64ad8fc6a7e2da23"><code>ecd2f9d</code></a></td><td><code>doc-src-clean: Clean in source directory until docbuild is fully VPATHified</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60927e52bd991cce1467ce0488ad29a4915b1986"><code>60927e5</code></a></td><td><code>trac 23758: in env.py, _add_variable_or_fallback should depend less</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c23cc1cb041c57d364edd3b39389af7e1945ff44"><code>c23cc1c</code></a></td><td><code>trac 23758: restore "import os"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/343d685800f3c4018724cbea795e79d64c9adeca"><code>343d685</code></a></td><td><code>trac 23758: add a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822"><code>3e36b75</code></a></td><td><code>Merge remote-tracking branch 'trac/u/jhpalmieri/variable_replacement' into t/21469/vpath_build</code></td></tr></table>




---

archive/issue_comments_314654.json:
```json
{
    "body": "Changed commit from **[`64515c1`](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)** to **[`3e36b75`](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)**",
    "created_at": "2017-08-31T05:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314654",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`64515c1`](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)** to **[`3e36b75`](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)**



---

archive/issue_comments_314655.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`",
    "created_at": "2017-08-31T05:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314655",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`



---

archive/issue_comments_314656.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@mkoeppe](#comment:68):\n> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`\n\nThis is a general problem, nothing to worry in the context of this ticket.\n\nBy the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.",
    "created_at": "2017-08-31T09:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314656",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@mkoeppe](#comment:68):
> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`

This is a general problem, nothing to worry in the context of this ticket.

By the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.



---

archive/issue_comments_314657.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nI agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nI am still having the problem in [comment:63](#comment:63) with `sage-starts`.",
    "created_at": "2017-08-31T17:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314657",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:70" align="right">comment:70</div>

I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

I am still having the problem in [comment:63](#comment:63) with `sage-starts`.



---

archive/issue_comments_314658.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@jhpalmieri](#comment:70):\n> I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nUnfortunately these warnings get upgraded to errors like this:\n\n```\n[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```\nwhich stops this build for me.\n\nI'll try with  #23023 as suggested by Dima.",
    "created_at": "2017-08-31T21:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314658",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@jhpalmieri](#comment:70):
> I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

Unfortunately these warnings get upgraded to errors like this:

```
[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```
which stops this build for me.

I'll try with  #23023 as suggested by Dima.



---

archive/issue_comments_314659.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@mkoeppe](#comment:71):\n> Replying to [@jhpalmieri](#comment:70):\n> > I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\n> \n> Unfortunately these warnings get upgraded to errors like this:\n> \n> ```\n> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n> ```\n> which stops this build for me.\n\nYour change in [comment:53](#comment:53) fixed that issue for me. (At least I think that's what fixed it.)",
    "created_at": "2017-08-31T22:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314659",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@mkoeppe](#comment:71):
> Replying to [@jhpalmieri](#comment:70):
> > I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment:51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

> 
> Unfortunately these warnings get upgraded to errors like this:
> 
> ```
> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
> ```
> which stops this build for me.

Your change in [comment:53](#comment:53) fixed that issue for me. (At least I think that's what fixed it.)



---

archive/issue_comments_314660.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff\"><code>754ec81</code></a></td><td><code>sage-starts: Fix sage-logger invocation for VPATH build</code></td></tr></table>\n",
    "created_at": "2017-08-31T23:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314660",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff"><code>754ec81</code></a></td><td><code>sage-starts: Fix sage-logger invocation for VPATH build</code></td></tr></table>




---

archive/issue_comments_314661.json:
```json
{
    "body": "Changed commit from **[`3e36b75`](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)** to **[`754ec81`](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)**",
    "created_at": "2017-08-31T23:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314661",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3e36b75`](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)** to **[`754ec81`](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)**



---

archive/issue_comments_314662.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@jhpalmieri](#comment:70):\n> I am still having the problem in [comment:63](#comment:63) with `sage-starts`.\n\nI agree with your patch and have added a commit; but see #23769.",
    "created_at": "2017-08-31T23:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314662",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@jhpalmieri](#comment:70):
> I am still having the problem in [comment:63](#comment:63) with `sage-starts`.

I agree with your patch and have added a commit; but see #23769.



---

archive/issue_comments_314663.json:
```json
{
    "body": "Changed commit from **[`754ec81`](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)** to **[`0c357dd`](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)**",
    "created_at": "2017-09-01T04:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314663",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`754ec81`](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)** to **[`0c357dd`](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)**



---

archive/issue_comments_314664.json:
```json
{
    "body": "<div id=\"comment:75\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307\"><code>0c357dd</code></a></td><td><code>Simplify VPATH patch</code></td></tr></table>\n",
    "created_at": "2017-09-01T04:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314664",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307"><code>0c357dd</code></a></td><td><code>Simplify VPATH patch</code></td></tr></table>




---

archive/issue_comments_314665.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,8 +22,10 @@\n The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n-When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n+With the current set of patches, the compilation goes through and gives a working `sage`.\n+However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.\n \n \n+\n``````\n",
    "created_at": "2017-09-01T04:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314665",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,8 +22,10 @@
 The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
-When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
+When "./configure" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
+With the current set of patches, the compilation goes through and gives a working `sage`.
+However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.
 
 
+
``````




---

archive/issue_comments_314666.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, John H. Palmieri**",
    "created_at": "2017-09-01T04:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314666",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, John H. Palmieri**



---

archive/issue_events_298892.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T04:49:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298892"
}
```



---

archive/issue_events_298893.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T04:49:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298893"
}
```



---

archive/issue_comments_314667.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nI think this ticket is ready for broader review.",
    "created_at": "2017-09-01T04:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314667",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:77" align="right">comment:77</div>

I think this ticket is ready for broader review.



---

archive/issue_comments_314668.json:
```json
{
    "body": "Changed author from **Matthias Koeppe, John H. Palmieri** to **Matthias Koeppe**",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314668",
    "user": "https://github.com/jhpalmieri"
}
```

Changed author from **Matthias Koeppe, John H. Palmieri** to **Matthias Koeppe**



---

archive/issue_comments_314669.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\n`make distclean` fails because `make sagelib-clean` fails:\n\n```\ncd \"/.../SAGE_SRC_ROOT/src\" && make -j6 clean\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: *** No rule to make target `clean'.  Stop.\nmake[1]: *** [sagelib-clean] Error 2\n```\nI guess it should cd to `/.../BUILDDIR/src` instead.",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314669",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:78" align="right">comment:78</div>

`make distclean` fails because `make sagelib-clean` fails:

```
cd "/.../SAGE_SRC_ROOT/src" && make -j6 clean
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: *** No rule to make target `clean'.  Stop.
make[1]: *** [sagelib-clean] Error 2
```
I guess it should cd to `/.../BUILDDIR/src` instead.



---

archive/issue_comments_314670.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,10 +22,8 @@\n The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n-When \"./configure\" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. \n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through and gives a working `sage`.\n-However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.\n+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n-\n``````\n",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314670",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,10 +22,8 @@
 The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
-When "./configure" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. 
+When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through and gives a working `sage`.
-However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.
+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
-
``````




---

archive/issue_comments_314671.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319\"><code>d32598e</code></a></td><td><code>VPATH fix for sagelib-clean</code></td></tr></table>\n",
    "created_at": "2017-09-01T05:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314671",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319"><code>d32598e</code></a></td><td><code>VPATH fix for sagelib-clean</code></td></tr></table>




---

archive/issue_comments_314672.json:
```json
{
    "body": "Changed commit from **[`0c357dd`](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)** to **[`d32598e`](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)**",
    "created_at": "2017-09-01T05:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314672",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0c357dd`](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)** to **[`d32598e`](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)**



---

archive/issue_comments_314673.json:
```json
{
    "body": "<div id=\"comment:80\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc\"><code>06f7d1d</code></a></td><td><code>Fix build/make/install change</code></td></tr></table>\n",
    "created_at": "2017-09-01T05:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314673",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:80"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc"><code>06f7d1d</code></a></td><td><code>Fix build/make/install change</code></td></tr></table>




---

archive/issue_comments_314674.json:
```json
{
    "body": "Changed commit from **[`d32598e`](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)** to **[`06f7d1d`](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)**",
    "created_at": "2017-09-01T05:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314674",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d32598e`](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)** to **[`06f7d1d`](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)**



---

archive/issue_comments_314675.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI tried again from a distcleaned tree. Now I'm running into:\n\n```\n[sagelib-8.1.beta3] Generating auto-generated sources\n[sagelib-8.1.beta3] Building interpreters for fast_callable\n[sagelib-8.1.beta3] -> First build of interpreters\n[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'\n```",
    "created_at": "2017-09-01T17:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314675",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">comment:81</div>

I tried again from a distcleaned tree. Now I'm running into:

```
[sagelib-8.1.beta3] Generating auto-generated sources
[sagelib-8.1.beta3] Building interpreters for fast_callable
[sagelib-8.1.beta3] -> First build of interpreters
[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'
```



---

archive/issue_comments_314676.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nI haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?",
    "created_at": "2017-09-01T20:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314676",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:82" align="right">comment:82</div>

I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?



---

archive/issue_comments_314677.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@jhpalmieri](#comment:82):\n> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n\nYes, this is how I am testing it (except I made `src/doc` writable).\n\nSomething in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\n> Where should those files be created?\n\nThey should be created in `SAGE_ROOT/src/sage/ext`.",
    "created_at": "2017-09-01T20:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314677",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@jhpalmieri](#comment:82):
> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 

Yes, this is how I am testing it (except I made `src/doc` writable).

Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

> Where should those files be created?

They should be created in `SAGE_ROOT/src/sage/ext`.



---

archive/issue_comments_314678.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nI think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?",
    "created_at": "2017-09-01T20:47:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314678",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

I think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?



---

archive/issue_comments_314679.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nPerhaps should:\n- rename SAGE_SRC_ROOT to SAGE_VPATH\n- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)\n- create SAGE_SRC = SAGE_ROOT/src\n- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n- create SAGE_SRC_DOC = SAGE_ROOT/src/doc",
    "created_at": "2017-09-01T20:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314679",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:85" align="right">comment:85</div>

Perhaps should:
- rename SAGE_SRC_ROOT to SAGE_VPATH
- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)
- create SAGE_SRC = SAGE_ROOT/src
- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
- create SAGE_SRC_DOC = SAGE_ROOT/src/doc



---

archive/issue_comments_314680.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nReplying to [@mkoeppe](#comment:85):\n> - create SAGE_SRC = SAGE_ROOT/src\n\nHow about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)\n\n> - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n> - create SAGE_SRC_DOC = SAGE_ROOT/src/doc \n\nOr `SAGE_ROOT_SRC_DOC`?",
    "created_at": "2017-09-01T21:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314680",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:86" align="right">comment:86</div>

Replying to [@mkoeppe](#comment:85):
> - create SAGE_SRC = SAGE_ROOT/src

How about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)

> - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
> - create SAGE_SRC_DOC = SAGE_ROOT/src/doc 

Or `SAGE_ROOT_SRC_DOC`?



---

archive/issue_comments_314681.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nThanks, these are good suggestions.",
    "created_at": "2017-09-01T21:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314681",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:87" align="right">comment:87</div>

Thanks, these are good suggestions.



---

archive/issue_comments_314682.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c\"><code>05f3a91</code></a></td><td><code>Rename SAGE_SRC_ROOT -> SAGE_VPATH</code></td></tr></table>\n",
    "created_at": "2017-09-01T21:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314682",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c"><code>05f3a91</code></a></td><td><code>Rename SAGE_SRC_ROOT -> SAGE_VPATH</code></td></tr></table>




---

archive/issue_comments_314683.json:
```json
{
    "body": "Changed commit from **[`06f7d1d`](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)** to **[`05f3a91`](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**",
    "created_at": "2017-09-01T21:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314683",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`06f7d1d`](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)** to **[`05f3a91`](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**



---

archive/issue_comments_314684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n``````\n",
    "created_at": "2017-09-01T21:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314684",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
``````




---

archive/issue_comments_314685.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@mkoeppe](#comment:83):\n> Replying to [@jhpalmieri](#comment:82):\n> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n\n> \n> Yes, this is how I am testing it (except I made `src/doc` writable).\n> \n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n> \n> > Where should those files be created?\n\n> \n> They should be created in `SAGE_ROOT/src/sage/ext`.\n\nIt looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.",
    "created_at": "2017-09-01T22:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314685",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@mkoeppe](#comment:83):
> Replying to [@jhpalmieri](#comment:82):
> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 

> 
> Yes, this is how I am testing it (except I made `src/doc` writable).
> 
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.
> 
> > Where should those files be created?

> 
> They should be created in `SAGE_ROOT/src/sage/ext`.

It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.



---

archive/issue_comments_314686.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nReplying to [@mkoeppe](#comment:83):\n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\nSee #23774.",
    "created_at": "2017-09-01T22:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314686",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:91" align="right">comment:91</div>

Replying to [@mkoeppe](#comment:83):
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

See #23774.



---

archive/issue_comments_314687.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@jhpalmieri](#comment:90):\n> > > Where should those files be created?\n\n> > \n> > They should be created in `SAGE_ROOT/src/sage/ext`.\n\n> \n> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...\n\nYes, see `src/sage_setup/autogen/interpreters/__main__.py`.\n\nBut I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.",
    "created_at": "2017-09-01T22:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314687",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@jhpalmieri](#comment:90):
> > > Where should those files be created?

> > 
> > They should be created in `SAGE_ROOT/src/sage/ext`.

> 
> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...

Yes, see `src/sage_setup/autogen/interpreters/__main__.py`.

But I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.



---

archive/issue_comments_314688.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nI wonder if instead of\n\n```\n+dnl Set up files for VPATH build\n+AS_IF([test x$srcdir != x.],\n+    [AC_CONFIG_COMMANDS([vpath],\n+\t[\n+\t    SAGE_ROOT=${ac_abs_top_builddir}\n+\t    SAGE_VPATH=${ac_abs_top_srcdir}\n+\t    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream\n+\t    # If new packages are downloaded, they end up in the build directory upstream.\n+\t    mkdir -p upstream\n+\t    for a in $SAGE_VPATH/upstream/* ; do\n+\t\tif test -f \"$a\" -a ! -f \"upstream/`basename $a`\" ; then\n+\t\t    ln -s \"$a\" upstream/\n+\t\tfi\n+\t    done\n+\t    cat > sage <<EOF\n```\n\nwe could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.",
    "created_at": "2017-09-05T09:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314688",
    "user": "https://github.com/embray"
}
```

<div id="comment:93" align="right">comment:93</div>

I wonder if instead of

```
+dnl Set up files for VPATH build
+AS_IF([test x$srcdir != x.],
+    [AC_CONFIG_COMMANDS([vpath],
+	[
+	    SAGE_ROOT=${ac_abs_top_builddir}
+	    SAGE_VPATH=${ac_abs_top_srcdir}
+	    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream
+	    # If new packages are downloaded, they end up in the build directory upstream.
+	    mkdir -p upstream
+	    for a in $SAGE_VPATH/upstream/* ; do
+		if test -f "$a" -a ! -f "upstream/`basename $a`" ; then
+		    ln -s "$a" upstream/
+		fi
+	    done
+	    cat > sage <<EOF
```

we could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.



---

archive/issue_comments_314689.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nI'm seeing a lot of activity on this ticket that I haven't followed.\n\nAnyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`",
    "created_at": "2017-09-05T15:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314689",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:94" align="right">comment:94</div>

I'm seeing a lot of activity on this ticket that I haven't followed.

Anyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`



---

archive/issue_comments_314690.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\n--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n\nThe vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...",
    "created_at": "2017-09-05T15:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314690",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:95" align="right">comment:95</div>

--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.

The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...



---

archive/issue_comments_314691.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nReplying to [@mkoeppe](#comment:95):\n> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n> \n> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...\n\nThis short reply is much better than the long explanation in the ticket description. It's all totally clear now.",
    "created_at": "2017-09-06T08:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314691",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:96" align="right">comment:96</div>

Replying to [@mkoeppe](#comment:95):
> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.
> 
> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...

This short reply is much better than the long explanation in the ticket description. It's all totally clear now.



---

archive/issue_comments_314692.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.\n+\n+The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.\n+\n+\n+---\n+\n+\n [VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n \n This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n``````\n",
    "created_at": "2017-09-08T08:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314692",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.
+
+The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.
+
+
+---
+
+
 [VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
 
 This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
``````




---

archive/issue_comments_314693.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nWould the old way to build still work unamended, or `BUILDDIR` will need to be created separately?",
    "created_at": "2017-09-08T08:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314693",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:97" align="right">comment:97</div>

Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?



---

archive/issue_comments_314694.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nI wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).",
    "created_at": "2017-09-08T08:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314694",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:98" align="right">comment:98</div>

I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).



---

archive/issue_comments_314695.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nReplying to [@dimpase](#comment:98):\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nWhen making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314695",
    "user": "https://github.com/embray"
}
```

<div id="comment:99" align="right">comment:99</div>

Replying to [@dimpase](#comment:98):
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_314696.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@embray](#comment:99):\n> Replying to [@dimpase](#comment:98):\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nMaybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...\n\n> \n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314696",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@embray](#comment:99):
> Replying to [@dimpase](#comment:98):
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

Maybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...

> 
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_314697.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nReplying to [@dimpase](#comment:98):\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nIt would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\nBut this is entirely unrelated to the present ticket.",
    "created_at": "2017-09-08T19:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314697",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:101" align="right">comment:101</div>

Replying to [@dimpase](#comment:98):
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
But this is entirely unrelated to the present ticket.



---

archive/issue_comments_314698.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nReplying to [@embray](#comment:99):\n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  \n\nJust a quick note. When one says \"VPATH\", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html",
    "created_at": "2017-09-08T19:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314698",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:102" align="right">comment:102</div>

Replying to [@embray](#comment:99):
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  

Just a quick note. When one says "VPATH", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html



---

archive/issue_comments_314699.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nReplying to [@dimpase](#comment:97):\n> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?\n\nYes, with this patch one can still do non-VPATH builds, without any change.",
    "created_at": "2017-09-08T19:37:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314699",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:103" align="right">comment:103</div>

Replying to [@dimpase](#comment:97):
> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?

Yes, with this patch one can still do non-VPATH builds, without any change.



---

archive/issue_comments_314700.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nReplying to [@mkoeppe](#comment:101):\n> Replying to [@dimpase](#comment:98):\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\n> \n> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\n> But this is entirely unrelated to the present ticket.\n\nI suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?",
    "created_at": "2017-09-08T20:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314700",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:104" align="right">comment:104</div>

Replying to [@mkoeppe](#comment:101):
> Replying to [@dimpase](#comment:98):
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

> 
> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
> But this is entirely unrelated to the present ticket.

I suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?



---

archive/issue_comments_314701.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAre there any immediate issues left here beside [comment:93](#comment:93)?",
    "created_at": "2017-09-28T18:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314701",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Are there any immediate issues left here beside [comment:93](#comment:93)?



---

archive/issue_comments_314702.json:
```json
{
    "body": "Work Issues: **merge conflicts**",
    "created_at": "2018-01-14T01:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314702",
    "user": "https://github.com/saraedum"
}
```

Work Issues: **merge conflicts**



---

archive/issue_events_298894.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-01-14T01:57:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298894"
}
```



---

archive/issue_events_298895.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-01-14T01:57:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298895"
}
```



---

archive/issue_comments_314703.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI actually could really use this feature right now :)\n\nmkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix [comment:93](#comment:93)?",
    "created_at": "2020-02-28T00:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314703",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:7" align="right">comment:7</div>

I actually could really use this feature right now :)

mkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix [comment:93](#comment:93)?



---

archive/issue_comments_314704.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...\n\nIf you need this earlier, please feel free to work on it.\n\nI don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.",
    "created_at": "2020-02-28T00:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314704",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

I hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...

If you need this earlier, please feel free to work on it.

I don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.



---

archive/issue_events_298896.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298896"
}
```



---

archive/issue_events_298897.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298897"
}
```



---

archive/issue_events_298898.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298898"
}
```



---

archive/issue_events_298899.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298899"
}
```



---

archive/issue_comments_314705.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314705",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_298900.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298900"
}
```



---

archive/issue_events_298901.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298901"
}
```



---

archive/issue_events_298902.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298902"
}
```



---

archive/issue_events_298903.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298903"
}
```



---

archive/issue_comments_314706.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-314706",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_298904.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298904"
}
```



---

archive/issue_events_298905.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298905"
}
```



---

archive/issue_events_298906.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298906"
}
```



---

archive/issue_events_298907.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298907"
}
```



---

archive/issue_events_298908.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298908"
}
```



---

archive/issue_events_298909.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298909"
}
```



---

archive/issue_events_298910.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298910"
}
```



---

archive/issue_events_298911.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-298911"
}
```
