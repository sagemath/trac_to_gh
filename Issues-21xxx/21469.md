# Issue 21469: Enable VPATH builds (several independent build trees connected to one source tree)

archive/issues_021232.json:
```json
{
    "assignees": [],
    "body": "**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.\n\nThe `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.\n\n\n---\n\n\n[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n\nThis is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n\nFor Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n\nThis is how it is used.\n\n```\n cd SAGE_ROOT\n autoreconf\n```\nand then\n\n```\n mkdir BUILDDIR\n cd BUILDDIR\n SRCDIR/configure --srcdir=SRCDIR\n make\n```\n\nThe present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n\nThe present patch changes the various places where $SAGE_ROOT is used.\nWhen \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n\nWith the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n\n\n\nCC:  felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri\n\nBranch/Commit: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build) @ [05f3a91](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**\n\nWork Issues: **merge conflicts**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21469_\n\n",
    "created_at": "2016-09-11T03:59:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Enable VPATH builds (several independent build trees connected to one source tree)",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/21469",
    "user": "https://github.com/mkoeppe"
}
```
**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.

The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.


---


[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 

This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).

For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.

This is how it is used.

```
 cd SAGE_ROOT
 autoreconf
```
and then

```
 mkdir BUILDDIR
 cd BUILDDIR
 SRCDIR/configure --srcdir=SRCDIR
 make
```

The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.

The present patch changes the various places where $SAGE_ROOT is used.
When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 

With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.



CC:  felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @fchapoton @jhpalmieri

Branch/Commit: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build) @ [05f3a91](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**

Work Issues: **merge conflicts**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/21469_





---

archive/issue_events_273456.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273456"
}
```



---

archive/issue_events_273457.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273457"
}
```



---

archive/issue_events_273458.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273458"
}
```



---

archive/issue_events_273459.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T03:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273459"
}
```



---

archive/issue_comments_317225.json:
```json
{
    "body": "Branch: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build)**",
    "created_at": "2016-09-11T04:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317225",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/vpath_build](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/vpath_build)**



---

archive/issue_comments_317226.json:
```json
{
    "body": "Commit: **[ac27cdc](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)**",
    "created_at": "2016-09-11T18:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317226",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[ac27cdc](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)**



---

archive/issue_comments_317227.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af\">ac27cdc</a></td><td><code>configure.ac: VPATH fixes</code></td></tr></table>\n",
    "created_at": "2016-09-11T18:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317227",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af">ac27cdc</a></td><td><code>configure.ac: VPATH fixes</code></td></tr></table>




---

archive/issue_comments_317228.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5698f8e2dba49f3f4eaa3058b73512c403719d84\">5698f8e</a></td><td><code>Distinguish SAGE_ROOT and SAGE_SRC_ROOT for VPATH build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a98cfa2e9461af5d48809319dc862e1e738cdd11\">a98cfa2</a></td><td><code>Use AC_CONFIG_COMMANDS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f\">e9b1c0f</a></td><td><code>Symlink build/pkgs (temporary solution)</code></td></tr></table>\n",
    "created_at": "2016-09-11T21:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317228",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5698f8e2dba49f3f4eaa3058b73512c403719d84">5698f8e</a></td><td><code>Distinguish SAGE_ROOT and SAGE_SRC_ROOT for VPATH build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a98cfa2e9461af5d48809319dc862e1e738cdd11">a98cfa2</a></td><td><code>Use AC_CONFIG_COMMANDS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f">e9b1c0f</a></td><td><code>Symlink build/pkgs (temporary solution)</code></td></tr></table>




---

archive/issue_comments_317229.json:
```json
{
    "body": "Changed commit from **[ac27cdc](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)** to **[e9b1c0f](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)**",
    "created_at": "2016-09-11T21:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317229",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ac27cdc](https://github.com/sagemath/sagetrac-mirror/commit/ac27cdc02f685d79d817c71ebdcc1ee79196b4af)** to **[e9b1c0f](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)**



---

archive/issue_events_273460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-11T21:39:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273460"
}
```



---

archive/issue_comments_317230.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993\">e15ada6</a></td><td><code>Define SAGE_SRC_ROOT for VPATH build</code></td></tr></table>\n",
    "created_at": "2016-09-11T22:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317230",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993">e15ada6</a></td><td><code>Define SAGE_SRC_ROOT for VPATH build</code></td></tr></table>




---

archive/issue_comments_317231.json:
```json
{
    "body": "Changed commit from **[e9b1c0f](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)** to **[e15ada6](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)**",
    "created_at": "2016-09-11T22:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317231",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e9b1c0f](https://github.com/sagemath/sagetrac-mirror/commit/e9b1c0fb2a378370b454757e397d20349323434f)** to **[e15ada6](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)**



---

archive/issue_comments_317232.json:
```json
{
    "body": "Changed commit from **[e15ada6](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)** to **[9323c01](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)**",
    "created_at": "2016-09-12T00:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317232",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e15ada6](https://github.com/sagemath/sagetrac-mirror/commit/e15ada69bb22124f463820e9dab5cc16348b3993)** to **[9323c01](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)**



---

archive/issue_comments_317233.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7\">9323c01</a></td><td><code>Use SAGE_SRC_ROOT in package scripts</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317233",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7">9323c01</a></td><td><code>Use SAGE_SRC_ROOT in package scripts</code></td></tr></table>




---

archive/issue_comments_317234.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f\">7a3913a</a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317234",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f">7a3913a</a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>




---

archive/issue_comments_317235.json:
```json
{
    "body": "Changed commit from **[9323c01](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)** to **[7a3913a](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)**",
    "created_at": "2016-09-12T00:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9323c01](https://github.com/sagemath/sagetrac-mirror/commit/9323c011da3005c0beb46ba0da5a6d3dba13c9e7)** to **[7a3913a](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)**



---

archive/issue_comments_317236.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258\">4cc3954</a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>\n",
    "created_at": "2016-09-12T05:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317236",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258">4cc3954</a></td><td><code>More SAGE_SRC_ROOT</code></td></tr></table>




---

archive/issue_comments_317237.json:
```json
{
    "body": "Changed commit from **[7a3913a](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)** to **[4cc3954](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)**",
    "created_at": "2016-09-12T05:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317237",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7a3913a](https://github.com/sagemath/sagetrac-mirror/commit/7a3913a64aa1d4310f741a3e5f898635187eb38f)** to **[4cc3954](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)**



---

archive/issue_comments_317238.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nThe current patch makes some high-level preparations for a VPATH build, in particular the package system.\n\n\"make\" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).\n\nI've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.",
    "created_at": "2016-09-12T05:32:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317238",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
The current patch makes some high-level preparations for a VPATH build, in particular the package system.

"make" runs through until it gets to sagelib, which needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails).

I've set this to 'needs review' in the hope of receiving some feedback regarding the approach of this patch.



---

archive/issue_comments_317239.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nThis is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nOther people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.",
    "created_at": "2016-09-12T05:49:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317239",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'>Comment 10:</a>
I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

This is most evident in the latest commit. As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Other people may have a different opinion but there is no value in this for me so far. Possibly more work in fact.



---

archive/issue_comments_317240.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@kiwifb](#comment%3A10):\n> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.\n\nA VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.",
    "created_at": "2016-09-12T05:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317240",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@kiwifb](#comment%3A10):
> I am not sure what the objective of this ticket is. Considering the nature of sage's build system I am not sure what `VPATH` brings me.

A VPATH build makes it easy to build from the same source in many different configurations. Concretely, I've started to run some VMs (with Linux 64 bit, 32 bit) via Docker, which mount the Sage source directory from the host.



---

archive/issue_comments_317241.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775\">7bb8718</a></td><td><code>Make sage script in build dir executable</code></td></tr></table>\n",
    "created_at": "2016-09-12T06:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317241",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775">7bb8718</a></td><td><code>Make sage script in build dir executable</code></td></tr></table>




---

archive/issue_comments_317242.json:
```json
{
    "body": "Changed commit from **[4cc3954](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)** to **[7bb8718](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)**",
    "created_at": "2016-09-12T06:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317242",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4cc3954](https://github.com/sagemath/sagetrac-mirror/commit/4cc3954f1ae666aa0148d69256e59d9e17ee4258)** to **[7bb8718](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)**



---

archive/issue_comments_317243.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@kiwifb](#comment%3A10):\n> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.\n\nYes, this ticket does not address any of the issues that would arise in distribution packaging. \n\nInstead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.",
    "created_at": "2016-09-12T06:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317243",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@kiwifb](#comment%3A10):
> As a distro maintainer of sage there are already build time things in `env.py` that are not needed at runtime and in a way are superfluous. You have just added one. Here the problem that I am forced to consider, is that going by the separation rules that I try to follow, there should be stuff in `sage/env.py` and some in a new file `sage_setup/build_env.py` but that's marginal to what you are doing.

Yes, this ticket does not address any of the issues that would arise in distribution packaging. 

Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.



---

archive/issue_comments_317244.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nI should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\n\nSeriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n\nI guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.",
    "created_at": "2016-09-12T07:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317244",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'>Comment 14:</a>
I should apologize for being so negative. Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)

Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.

I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.



---

archive/issue_comments_317245.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@kiwifb](#comment%3A14):\n> I should apologize for being so negative. \n\nNo worries.\n> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)\n\nThat already works with this patch.\n> \n> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.\n> \n> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.\n\nSounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.",
    "created_at": "2016-09-12T07:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317245",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@kiwifb](#comment%3A14):
> I should apologize for being so negative. 

No worries.
> Currently `configure` is run by the initial call to make, it would be nice to get to the stage where we run `configure` first :)

That already works with this patch.
> 
> Seriously, yes `VPATH` as lots of advantages, since most people run sage from where they build it, being able to do several builds from the same source without `make distclean` or `git clone` is a good thing.
> 
> I guess, it mostly started my brain on the fact that the separation build and runtime is not clean in vanilla sage. Your `VPATH` work may help to clarify it in some areas. Let's try to minimise where it would mix things further.

Sounds good. Yes, I'm hoping too that it helps clarify some things as a side-effect.



---

archive/issue_comments_317246.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@mkoeppe](#comment%3A13):\n> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.\n\nI sort of agree with Fran\u00e7ois.\n\nPart of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nFor the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nFor the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.",
    "created_at": "2016-09-12T11:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317246",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@mkoeppe](#comment%3A13):
> Instead it adds a standard feature expected from autotools build system, for those who use sage as a distribution.

I sort of agree with Fran√ßois.

Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.



---

archive/issue_events_273461.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-12T12:00:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273461"
}
```



---

archive/issue_events_273462.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-12T12:00:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273462"
}
```



---

archive/issue_comments_317247.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI think the ticket description should have a *lot* more information about\n\n1. which problem that this ticket is trying to solve (the **why**).\n\n2. what the branch actually does (the **what**).\n\nNote that this are 2 independent things (which are unfortunately often confused).",
    "created_at": "2016-09-12T12:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317247",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
I think the ticket description should have a *lot* more information about

1. which problem that this ticket is trying to solve (the **why**).

2. what the branch actually does (the **what**).

Note that this are 2 independent things (which are unfortunately often confused).



---

archive/issue_comments_317248.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nI've updated the description.",
    "created_at": "2016-09-12T17:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317248",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
I've updated the description.



---

archive/issue_comments_317249.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n-It would be convenient for VPATH builds to work.\n+VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n+\n+This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n+\n+For Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n+\n+This is how it is used.\n \n ```\n  mkdir BUILDDIR\n@@ -7,6 +13,13 @@\n  make\n ```\n \n-Probably #14796 has work into this direction, but it seems to be an abandoned effort.\n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. \n+The present patch changes the various places where $SAGE_ROOT is used.\n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n+\n+With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.\n+(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)\n \n \n+\n+\n``````\n",
    "created_at": "2016-09-12T17:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317249",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
-It would be convenient for VPATH builds to work.
+VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
+
+This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
+
+For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.
+
+This is how it is used.
 
 ```
  mkdir BUILDDIR
@@ -7,6 +13,13 @@
  make
 ```
 
-Probably #14796 has work into this direction, but it seems to be an abandoned effort.
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. 
+The present patch changes the various places where $SAGE_ROOT is used.
+When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
+
+With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.
+(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)
 
 
+
+
``````




---

archive/issue_events_273463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T17:47:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273463"
}
```



---

archive/issue_events_273464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T17:47:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273464"
}
```



---

archive/issue_comments_317250.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@jdemeyer](#comment%3A16):\n> Replying to [@mkoeppe](#comment%3A13):\n> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.\n\nI've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.\n\n> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.\n\nRight, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.\n\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nCertainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).",
    "created_at": "2016-09-12T17:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317250",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@jdemeyer](#comment%3A16):
> Replying to [@mkoeppe](#comment%3A13):
> Part of the problem is that Sage is a distribution (a collection of packages) as well as a Python library. The fact this this is currently mixed up in the sources (the sources of the distribution-part and the library-part are in one repo) makes it more difficult to understand what this ticket is about.

I've now clarified the goal in the description. I have not touched `sagelib` yet; but without VPATH work on sagelib, the distribution VPATH changes won't work. I could use help with the work on `sagelib`.

> For the distribution part, there really is no such thing as a build directory. There is a a temporary directory in `local/var/tmp/sage/build` but I would not consider that a build directory in the usual sense.

Right, `local/var/tmp/sage/build` falls short of being a real build directory. because for example `src/build/` has a lot of more generated stuff.

> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Certainly there `src/build/lib.macosx-10.9-x86_64-2.7` includes the platform name, but it does not account for other configuration differences that a VPATH build can take care of (neither does `src/build/cythonized`).



---

archive/issue_comments_317251.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n+[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n \n This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n \n``````\n",
    "created_at": "2016-09-12T18:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317251",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-VPATH builds are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
+[VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
 
 This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
 
``````




---

archive/issue_comments_317252.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. \n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). \n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n``````\n",
    "created_at": "2016-09-12T18:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317252",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT. 
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). 
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
``````




---

archive/issue_comments_317253.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@jdemeyer](#comment%3A16):\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nIt seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).",
    "created_at": "2016-09-12T18:58:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317253",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@jdemeyer](#comment%3A16):
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
`pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).



---

archive/issue_comments_317254.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@mkoeppe](#comment%3A22):\n> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. \n> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).\n\nHowever, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804",
    "created_at": "2016-09-12T19:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317254",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@mkoeppe](#comment%3A22):
> It seems that `pip install` keeps the source directory clean, building instead in a temporary directory. 
> `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages).

However, there are some pip issues: https://github.com/pypa/pip/issues/2060 https://github.com/pypa/pip/issues/2053 https://github.com/pypa/pip/issues/804



---

archive/issue_comments_317255.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n> Replying to [@jdemeyer](#comment%3A16):\n> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.\n\nAlso, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.\n\n```\npython setup.py build --build-base=BUILDDIR\n```",
    "created_at": "2016-09-12T19:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317255",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
> Replying to [@jdemeyer](#comment%3A16):
> For the library part, a `VPATH` build is meaningful. Although, I think that `VPATH` builds are unusual in the Python world. Luckily, the default build directories are platform-dependendent. Anyway, it seems like this ticket isn't about that.

Also, in the traditional distutils ways (https://docs.python.org/2/install/), it appears that one can use `--build-base` to do VPATH builds.

```
python setup.py build --build-base=BUILDDIR
```



---

archive/issue_comments_317256.json:
```json
{
    "body": "Dependencies: **#21480**",
    "created_at": "2016-09-12T22:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317256",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#21480**



---

archive/issue_comments_317257.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nThis is now #21480.",
    "created_at": "2016-09-12T22:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317257",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>Comment 25:</a>
This is now #21480.



---

archive/issue_comments_317258.json:
```json
{
    "body": "Changed commit from **[7bb8718](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)** to **[81f4306](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)**",
    "created_at": "2016-09-13T00:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317258",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7bb8718](https://github.com/sagemath/sagetrac-mirror/commit/7bb87184fcd1a5a39914af65e12ce4d6ed30e775)** to **[81f4306](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)**



---

archive/issue_comments_317259.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01\">81f4306</a></td><td><code>Fix for unconfigured non-VPATH build</code></td></tr></table>\n",
    "created_at": "2016-09-13T00:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317259",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01">81f4306</a></td><td><code>Fix for unconfigured non-VPATH build</code></td></tr></table>




---

archive/issue_events_273465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T04:57:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273465"
}
```



---

archive/issue_events_273466.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-17T04:57:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273466"
}
```



---

archive/issue_events_273467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T21:19:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273467"
}
```



---

archive/issue_events_273468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T21:19:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273468"
}
```



---

archive/issue_comments_317260.json:
```json
{
    "body": "Changed commit from **[81f4306](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)** to **[7e11d55](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)**",
    "created_at": "2017-08-27T04:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317260",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[81f4306](https://github.com/sagemath/sagetrac-mirror/commit/81f4306be63d6097c98c29301c6b21bc3a1f1e01)** to **[7e11d55](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)**



---

archive/issue_comments_317261.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9\">7e11d55</a></td><td><code>VPATH build</code></td></tr></table>\n",
    "created_at": "2017-08-27T04:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317261",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9">7e11d55</a></td><td><code>VPATH build</code></td></tr></table>




---

archive/issue_comments_317262.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nsquashed into 1 commit to simplify rebasing.",
    "created_at": "2017-08-27T04:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317262",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'>Comment 30:</a>
squashed into 1 commit to simplify rebasing.



---

archive/issue_events_273469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273469"
}
```



---

archive/issue_events_273470.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-27T05:12:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273470"
}
```



---

archive/issue_comments_317263.json:
```json
{
    "body": "Changed dependencies from **#21480** to **#21535**",
    "created_at": "2017-08-27T05:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317263",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#21480** to **#21535**



---

archive/issue_comments_317264.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nThe next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded \"build\").",
    "created_at": "2017-08-27T05:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317264",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>Comment 31:</a>
The next step towards VPATH builds should probably be #21535 (enabling `src/setup.py build --build-base`, to replace the hard-coded "build").



---

archive/issue_comments_317265.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca281d2f62d294c79a3b952787e4ed311ad6deba\">ca281d2</a></td><td><code>VPATH build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae7bdf7426461a0ec255a6456c339da35f3d058a\">ae7bdf7</a></td><td><code>configure.ac: Quoting fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c\">23cc689</a></td><td><code>src/Makefile.in: Use setup.py --build-base</code></td></tr></table>\n",
    "created_at": "2017-08-28T02:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317265",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca281d2f62d294c79a3b952787e4ed311ad6deba">ca281d2</a></td><td><code>VPATH build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae7bdf7426461a0ec255a6456c339da35f3d058a">ae7bdf7</a></td><td><code>configure.ac: Quoting fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c">23cc689</a></td><td><code>src/Makefile.in: Use setup.py --build-base</code></td></tr></table>




---

archive/issue_comments_317266.json:
```json
{
    "body": "Changed commit from **[7e11d55](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)** to **[23cc689](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)**",
    "created_at": "2017-08-28T02:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317266",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7e11d55](https://github.com/sagemath/sagetrac-mirror/commit/7e11d55e6549a678bc5a538d64353426a8b8a4b9)** to **[23cc689](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)**



---

archive/issue_comments_317267.json:
```json
{
    "body": "Changed commit from **[23cc689](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)** to **[72818e5](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)**",
    "created_at": "2017-08-28T05:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317267",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[23cc689](https://github.com/sagemath/sagetrac-mirror/commit/23cc689ccfd33fff4eeb05ee5dc6ebf76ff2db9c)** to **[72818e5](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)**



---

archive/issue_comments_317268.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11\">72818e5</a></td><td><code>Some path fixes for VPATH</code></td></tr></table>\n",
    "created_at": "2017-08-28T05:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317268",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>Comment 33:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11">72818e5</a></td><td><code>Some path fixes for VPATH</code></td></tr></table>




---

archive/issue_comments_317269.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffb0040550a8c2cd9248299ac342e5e58451c96\">3ffb004</a></td><td><code>VPATH fixes for src/bin and src/ext installs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365\">d0366b0</a></td><td><code>build/make/deps: Fix sage-env path</code></td></tr></table>\n",
    "created_at": "2017-08-28T15:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317269",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>Comment 34:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffb0040550a8c2cd9248299ac342e5e58451c96">3ffb004</a></td><td><code>VPATH fixes for src/bin and src/ext installs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365">d0366b0</a></td><td><code>build/make/deps: Fix sage-env path</code></td></tr></table>




---

archive/issue_comments_317270.json:
```json
{
    "body": "Changed commit from **[72818e5](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)** to **[d0366b0](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)**",
    "created_at": "2017-08-28T15:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317270",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[72818e5](https://github.com/sagemath/sagetrac-mirror/commit/72818e5229b573b625e4b9b181828ff7dcd22a11)** to **[d0366b0](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)**



---

archive/issue_comments_317271.json:
```json
{
    "body": "Changed dependencies from **#21535** to none",
    "created_at": "2017-08-28T15:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317271",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#21535** to none



---

archive/issue_comments_317272.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nRemoved #21535 dependency. `setup.py --build-base` actually works already.\n\nWith the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.",
    "created_at": "2017-08-28T15:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317272",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>Comment 35:</a>
Removed #21535 dependency. `setup.py --build-base` actually works already.

With the current status of the branch, `make` builds a working sage, only the docbuild does not go through yet.



---

archive/issue_comments_317273.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,8 +17,7 @@\n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.\n-(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)\n+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n \n``````\n",
    "created_at": "2017-08-28T15:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317273",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,8 +17,7 @@
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through until `sagelib` is reached. This needs some more VPATH work (the current patch tries to get away by just making a symlink from $SAGE_SRC_ROOT/src to $SAGE_ROOT/src, which of course fails). For example, `src/build/cythonized` needs to be created in BUILDDIR, and include paths etc. need to be set up accordingly.
-(Probably #14796, what seems to be an abandoned effort, has work into this direction; I haven't used changes from there yet.)
+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
 
``````




---

archive/issue_comments_317274.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,12 +13,11 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). \n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n+\n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n-\n-\n``````\n",
    "created_at": "2017-08-28T15:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317274",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,12 +13,11 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. `local` is still a fixed subdirectory of $SAGE_ROOT (but see #21479). 
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
+
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
 With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
-
-
``````




---

archive/issue_events_273471.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-28T15:53:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "title_is": "Enable VPATH builds (several independent build trees connected to one source tree)",
    "title_was": "Enable VPATH builds",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273471"
}
```



---

archive/issue_comments_317275.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nOn OS X, some directories are not being created:\n\n```\n$ mkdir BUILD\n$ cd BUILD\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\n/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory\n```\nIf I create that directory, `configure` finishes but with warning messages like this\n\n```\n$ mkdir -p build/make\n$ /path/to/sage/configure --srcdir=/path/to/sage\n...\ntouch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory\nfind: /path/to/BUILD/src/ext: No such file or directory\ncat: /path/to/BUILD/build/make/deps: No such file or directory\n...\n$ make\nmake: *** No targets specified and no makefile found.  Stop.\n```",
    "created_at": "2017-08-28T16:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317275",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'>Comment 39:</a>
On OS X, some directories are not being created:

```
$ mkdir BUILD
$ cd BUILD
$ /path/to/sage/configure --srcdir=/path/to/sage
...
/path/to/sage/configure: line 7017: build/make/Makefile: No such file or directory
```
If I create that directory, `configure` finishes but with warning messages like this

```
$ mkdir -p build/make
$ /path/to/sage/configure --srcdir=/path/to/sage
...
touch: /path/to/BUILD/src/bin/sage-env-config: No such file or directory
find: /path/to/BUILD/src/ext: No such file or directory
cat: /path/to/BUILD/build/make/deps: No such file or directory
...
$ make
make: *** No targets specified and no makefile found.  Stop.
```



---

archive/issue_comments_317276.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nDid you autoreconf?",
    "created_at": "2017-08-28T20:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317276",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>Comment 40:</a>
Did you autoreconf?



---

archive/issue_comments_317277.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,12 @@\n For Sage, \"different configurations\" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.\n \n This is how it is used.\n+\n+```\n+ cd SAGE_ROOT\n+ autoreconf\n+```\n+and then\n \n ```\n  mkdir BUILDDIR\n``````\n",
    "created_at": "2017-08-28T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317277",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,12 @@
 For Sage, "different configurations" could mean different architectures (via VMs), different sets of installed packages, Py2 vs Py3, etc.
 
 This is how it is used.
+
+```
+ cd SAGE_ROOT
+ autoreconf
+```
+and then
 
 ```
  mkdir BUILDDIR
``````




---

archive/issue_comments_317278.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nNo, that fixed it.",
    "created_at": "2017-08-28T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317278",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'>Comment 41:</a>
No, that fixed it.



---

archive/issue_comments_317279.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nWith the changes\n\n```diff\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex dc2bd34cc0..8aa523d7ea 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -313,7 +313,7 @@ export SAGE_EXTCODE=\"$SAGE_SHARE/sage/ext\"\n export SAGE_SPKG_INST=\"$SAGE_LOCAL/var/lib/sage/installed\"\n export SAGE_LOGS=\"$SAGE_ROOT/logs/pkgs\"\n export SAGE_SRC=\"$SAGE_ROOT/src\"\n-export SAGE_DOC_SRC=\"$SAGE_SRC/doc\"\n+export SAGE_DOC_SRC=\"$SAGE_SRC_ROOT/src/doc\"\n export SAGE_DOC=\"$SAGE_SHARE/doc/sage\"\n \n if [ -z \"${SAGE_ORIG_PATH_SET}\" ]; then\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 2e115fab88..88f3fdfa4a 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -1,10 +1,10 @@\n import sys, os, sphinx\n-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR\n+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR\n from datetime import date\n from six import iteritems\n \n # If your extensions are in another directory, add it here.\n-sys.path.append(os.path.join(SAGE_SRC, \"sage_setup\", \"docbuild\", \"ext\"))\n+sys.path.append(os.path.join(SAGE_SRC_ROOT, \"src\", \"sage_setup\", \"docbuild\", \"ext\"))\n \n # General configuration\n # ---------------------\n```\nthe documentation starts to build, but I eventually get an error:\n\n```\n[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n```\nI can't figure out where this is coming from.",
    "created_at": "2017-08-29T03:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317279",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'>Comment 42:</a>
With the changes

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index dc2bd34cc0..8aa523d7ea 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -313,7 +313,7 @@ export SAGE_EXTCODE="$SAGE_SHARE/sage/ext"
 export SAGE_SPKG_INST="$SAGE_LOCAL/var/lib/sage/installed"
 export SAGE_LOGS="$SAGE_ROOT/logs/pkgs"
 export SAGE_SRC="$SAGE_ROOT/src"
-export SAGE_DOC_SRC="$SAGE_SRC/doc"
+export SAGE_DOC_SRC="$SAGE_SRC_ROOT/src/doc"
 export SAGE_DOC="$SAGE_SHARE/doc/sage"
 
 if [ -z "${SAGE_ORIG_PATH_SET}" ]; then
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 2e115fab88..88f3fdfa4a 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -1,10 +1,10 @@
 import sys, os, sphinx
-from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC, THEBE_DIR
+from sage.env import SAGE_DOC_SRC, SAGE_DOC, SAGE_SRC_ROOT, THEBE_DIR
 from datetime import date
 from six import iteritems
 
 # If your extensions are in another directory, add it here.
-sys.path.append(os.path.join(SAGE_SRC, "sage_setup", "docbuild", "ext"))
+sys.path.append(os.path.join(SAGE_SRC_ROOT, "src", "sage_setup", "docbuild", "ext"))
 
 # General configuration
 # ---------------------
```
the documentation starts to build, but I eventually get an error:

```
[dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
```
I can't figure out where this is coming from.



---

archive/issue_comments_317280.json:
```json
{
    "body": "Changed commit from **[d0366b0](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)** to **[e7a78e0](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)**",
    "created_at": "2017-08-29T17:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317280",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d0366b0](https://github.com/sagemath/sagetrac-mirror/commit/d0366b0bd4506fe3e3378fc752f7df487f783365)** to **[e7a78e0](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)**



---

archive/issue_comments_317281.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db34265bc602f68c7ae1e20c4c2b1a4f2906b5e3\">db34265</a></td><td><code>Merge tag '8.1.beta3' into t/21469/vpath_build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d\">e7a78e0</a></td><td><code>VPATH fix for docbuild</code></td></tr></table>\n",
    "created_at": "2017-08-29T17:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317281",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:43'>Comment 43:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db34265bc602f68c7ae1e20c4c2b1a4f2906b5e3">db34265</a></td><td><code>Merge tag '8.1.beta3' into t/21469/vpath_build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d">e7a78e0</a></td><td><code>VPATH fix for docbuild</code></td></tr></table>




---

archive/issue_comments_317282.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nThanks, I've added your changes as a commit.",
    "created_at": "2017-08-29T17:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317282",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>Comment 44:</a>
Thanks, I've added your changes as a commit.



---

archive/issue_comments_317283.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nReplying to [@jhpalmieri](#comment%3A42):\n> the documentation starts to build, but I eventually get an error:\n> \n> ```\n> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'\n> ```\n\nI get the same error",
    "created_at": "2017-08-29T17:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317283",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'>Comment 45:</a>
Replying to [@jhpalmieri](#comment%3A42):
> the documentation starts to build, but I eventually get an error:
> 
> ```
> [dochtml] [arithgrou] /path/to/SAGE_ROOT/src/doc/en/reference/arithgroup/sage/modular/arithgroup/arithgroup_element.rst:11: WARNING: error while formatting arguments for sage.modular.arithgroup.arithgroup_element.ArithmeticSubgroupElement.b: 'NoneType' object has no attribute 'find'
> ```

I get the same error



---

archive/issue_comments_317284.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nOne more change, to help `make distclean` work:\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex 3128f4c656..03f2c8fff1 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)\n doc-clean: doc-src-clean doc-output-clean\n \n doc-src-clean:\n-       cd \"$(SAGE_SRC)/doc\" && $(MAKE) clean\n+       cd \"$(SAGE_SRC_ROOT)/src/doc\" && $(MAKE) clean\n \n doc-output-clean:\n        rm -rf \"$(SAGE_SHARE)/doc/sage\"\n```",
    "created_at": "2017-08-29T18:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317284",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'>Comment 46:</a>
One more change, to help `make distclean` work:

```diff
diff --git a/build/make/deps b/build/make/deps
index 3128f4c656..03f2c8fff1 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -235,7 +235,7 @@ doc-pdf: $(DOC_DEPENDENCIES)
 doc-clean: doc-src-clean doc-output-clean
 
 doc-src-clean:
-       cd "$(SAGE_SRC)/doc" && $(MAKE) clean
+       cd "$(SAGE_SRC_ROOT)/src/doc" && $(MAKE) clean
 
 doc-output-clean:
        rm -rf "$(SAGE_SHARE)/doc/sage"
```



---

archive/issue_comments_317285.json:
```json
{
    "body": "Changed commit from **[e7a78e0](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)** to **[734fb4b](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)**",
    "created_at": "2017-08-29T18:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317285",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e7a78e0](https://github.com/sagemath/sagetrac-mirror/commit/e7a78e038548b6a0d34cea75432379c61759875d)** to **[734fb4b](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)**



---

archive/issue_comments_317286.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0\">734fb4b</a></td><td><code>VPATH fix for doc-src-clean</code></td></tr></table>\n",
    "created_at": "2017-08-29T18:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317286",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'>Comment 47:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0">734fb4b</a></td><td><code>VPATH fix for doc-src-clean</code></td></tr></table>




---

archive/issue_comments_317287.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nPerhaps the sphinx problem is related to failing source discovery for Cython modules:\n\n```\nsage: sage.rings.number_field.number_field_element_quadratic??\nError getting source: s must be a string\nType:            module\n...\n```",
    "created_at": "2017-08-29T18:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317287",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'>Comment 48:</a>
Perhaps the sphinx problem is related to failing source discovery for Cython modules:

```
sage: sage.rings.number_field.number_field_element_quadratic??
Error getting source: s must be a string
Type:            module
...
```



---

archive/issue_comments_317288.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nYes, that looks like it.",
    "created_at": "2017-08-29T18:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317288",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:49'>Comment 49:</a>
Yes, that looks like it.



---

archive/issue_comments_317289.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nOkay, how about this:\n\n```diff\ndiff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\nindex f9dffc1ce3..3a286c7934 100644\n--- a/src/sage/misc/sageinspect.py\n+++ b/src/sage/misc/sageinspect.py\n@@ -125,7 +125,7 @@ import tokenize\n import types\n import re\n EMBEDDED_MODE = False\n-from sage.env import SAGE_SRC\n+from sage.env import SAGE_SRC_ROOT\n \n def loadable_module_extension():\n     r\"\"\"\n@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):\n         return None\n \n     raw_filename = res.group('FILENAME')\n-    filename = os.path.join(SAGE_SRC, raw_filename)\n+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n     if not os.path.isfile(filename):\n         from sage.misc.misc import SPYX_TMP\n         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n@@ -2308,7 +2308,7 @@ def __internal_tests():\n \n     Test _extract_embedded_position:\n \n-    We cannot test the filename since it depends on SAGE_SRC.\n+    We cannot test the filename since it depends on SAGE_SRC_ROOT.\n \n     Make sure things work with no trailing newline::\n \n```",
    "created_at": "2017-08-29T19:07:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317289",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'>Comment 50:</a>
Okay, how about this:

```diff
diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index f9dffc1ce3..3a286c7934 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -125,7 +125,7 @@ import tokenize
 import types
 import re
 EMBEDDED_MODE = False
-from sage.env import SAGE_SRC
+from sage.env import SAGE_SRC_ROOT
 
 def loadable_module_extension():
     r"""
@@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):
         return None
 
     raw_filename = res.group('FILENAME')
-    filename = os.path.join(SAGE_SRC, raw_filename)
+    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
     if not os.path.isfile(filename):
         from sage.misc.misc import SPYX_TMP
         filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
@@ -2308,7 +2308,7 @@ def __internal_tests():
 
     Test _extract_embedded_position:
 
-    We cannot test the filename since it depends on SAGE_SRC.
+    We cannot test the filename since it depends on SAGE_SRC_ROOT.
 
     Make sure things work with no trailing newline::
 
```



---

archive/issue_comments_317290.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nNow the cross-references are wrong or missing:\n\n```\n[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```",
    "created_at": "2017-08-29T20:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317290",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:51'>Comment 51:</a>
Now the cross-references are wrong or missing:

```
[dochtml] OSError: [parallel ] /.../sage-8.1.beta3/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```



---

archive/issue_comments_317291.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nAlso, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.",
    "created_at": "2017-08-29T20:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317291",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'>Comment 52:</a>
Also, it seems that the docbuilding doesn't recognize when a document has been built already, so everything is rebuilt every time.



---

archive/issue_comments_317292.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d\">8c801f7</a></td><td><code>VPATH: Set SAGE_SRC to actual source tree throughout</code></td></tr></table>\n",
    "created_at": "2017-08-29T21:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317292",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:53'>Comment 53:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d">8c801f7</a></td><td><code>VPATH: Set SAGE_SRC to actual source tree throughout</code></td></tr></table>




---

archive/issue_comments_317293.json:
```json
{
    "body": "Changed commit from **[734fb4b](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)** to **[8c801f7](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)**",
    "created_at": "2017-08-29T21:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317293",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[734fb4b](https://github.com/sagemath/sagetrac-mirror/commit/734fb4ba95dc62a7f6f10c30b6252fa309c6b7b0)** to **[8c801f7](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)**



---

archive/issue_comments_317294.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nReplying to [@jhpalmieri](#comment%3A50):\n> Okay, how about this:\n> \n> ```diff\n> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\n> index f9dffc1ce3..3a286c7934 100644\n> --- a/src/sage/misc/sageinspect.py\n> +++ b/src/sage/misc/sageinspect.py\n> @@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):\n>          return None\n>  \n>      raw_filename = res.group('FILENAME')\n> -    filename = os.path.join(SAGE_SRC, raw_filename)\n> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)\n>      if not os.path.isfile(filename):\n>          from sage.misc.misc import SPYX_TMP\n>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n> ```\n\nInstead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.",
    "created_at": "2017-08-29T21:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317294",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'>Comment 54:</a>
Replying to [@jhpalmieri](#comment%3A50):
> Okay, how about this:
> 
> ```diff
> diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
> index f9dffc1ce3..3a286c7934 100644
> --- a/src/sage/misc/sageinspect.py
> +++ b/src/sage/misc/sageinspect.py
> @@ -222,7 +222,7 @@ def _extract_embedded_position(docstring):
>          return None
>  
>      raw_filename = res.group('FILENAME')
> -    filename = os.path.join(SAGE_SRC, raw_filename)
> +    filename = os.path.join(SAGE_SRC_ROOT, 'src', raw_filename)
>      if not os.path.isfile(filename):
>          from sage.misc.misc import SPYX_TMP
>          filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
> ```

Instead, I have changed `SAGE_SRC` to point to the actual source tree. This was inconsistent before.



---

archive/issue_comments_317295.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nI'm now testing the VPATH build using a separate user account that cannot write into the source tree. \nMore changes to the docbuild are necessary to separate sources from built files:\n\n```\n[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'\n```",
    "created_at": "2017-08-29T21:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317295",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'>Comment 55:</a>
I'm now testing the VPATH build using a separate user account that cannot write into the source tree. 
More changes to the docbuild are necessary to separate sources from built files:

```
[dochtml] IOError: [Errno 13] Permission denied: '/Users/mkoeppe/s/sage/sage-rebasing/vpath/B/../src/doc/en/reference/repl/sage/misc/trace.rst'
```



---

archive/issue_comments_317296.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nBy the way, I get warnings like\n\n```\ntouch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory\n```\nI assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.",
    "created_at": "2017-08-29T22:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317296",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:56'>Comment 56:</a>
By the way, I get warnings like

```
touch: /.../BUILDDIR/src/bin/sage-env-config: No such file or directory
```
I assume this isn't a big deal since you're planning on getting rid of this file. It also doesn't seem to interfere with the build or running Sage.



---

archive/issue_comments_317297.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nI don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?",
    "created_at": "2017-08-29T22:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317297",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'>Comment 57:</a>
I don't plan to eliminate `sage-env-config` (perhaps you mean `sage-arch-env`, #23733)?



---

archive/issue_comments_317298.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nSorry, yes, that's what I meant, and that's what most of the warnings have been about.",
    "created_at": "2017-08-29T22:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317298",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:58'>Comment 58:</a>
Sorry, yes, that's what I meant, and that's what most of the warnings have been about.



---

archive/issue_comments_317299.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nThe `sage-arch-env` message is harmless.\nBut there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.",
    "created_at": "2017-08-29T22:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317299",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'>Comment 59:</a>
The `sage-arch-env` message is harmless.
But there's indeed also something wrong with `sage-env-config` too. Fix will come shortly.



---

archive/issue_comments_317300.json:
```json
{
    "body": "Changed commit from **[8c801f7](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)** to **[5530827](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)**",
    "created_at": "2017-08-29T22:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317300",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8c801f7](https://github.com/sagemath/sagetrac-mirror/commit/8c801f7e36d7d1d680ee175f8a5eac40e118568d)** to **[5530827](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)**



---

archive/issue_comments_317301.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d\">5530827</a></td><td><code>sage-env-config: Handle special case in build/make/deps, rather than configure.ac</code></td></tr></table>\n",
    "created_at": "2017-08-29T22:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317301",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:60'>Comment 60:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d">5530827</a></td><td><code>sage-env-config: Handle special case in build/make/deps, rather than configure.ac</code></td></tr></table>




---

archive/issue_comments_317302.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nI'm getting this build error:\n\n```\nmake[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.\n```",
    "created_at": "2017-08-30T01:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317302",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:61'>Comment 61:</a>
I'm getting this build error:

```
make[2]: *** No rule to make target `/.../BUILDDIR/local/share/sage/ext/doctest/invalid/syntax_error.tachyon', needed by `sagelib'.  Stop.
```



---

archive/issue_comments_317303.json:
```json
{
    "body": "Changed commit from **[5530827](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)** to **[64515c1](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)**",
    "created_at": "2017-08-30T03:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317303",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5530827](https://github.com/sagemath/sagetrac-mirror/commit/5530827f3266b9d43326ddba619bd3a757e0569d)** to **[64515c1](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)**



---

archive/issue_comments_317304.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6\">64515c1</a></td><td><code>Fix last change</code></td></tr></table>\n",
    "created_at": "2017-08-30T03:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317304",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:62'>Comment 62:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6">64515c1</a></td><td><code>Fix last change</code></td></tr></table>




---

archive/issue_comments_317305.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nThe make target \"sage-starts\" fails for me. This fixes it; is it the right way to fix it?\n\n```diff\ndiff --git a/src/bin/sage-starts b/src/bin/sage-starts\nindex 85cbae67e5..498c930810 100755\n--- a/src/bin/sage-starts\n+++ b/src/bin/sage-starts\n@@ -14,7 +14,7 @@ echo \"[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`\" | tee -a logs\n # sysadmin.  We use --nodotsage so we don't force a .sage directory\n # in the sysadmin's HOME directory.\n cmd='sage.all._write_started_file(); print \"Yes, Sage starts.\"'\n-build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n+\"$SAGE_SRC_ROOT\"/build/bin/sage-logger \"./sage --nodotsage -c '$cmd'\" logs/start.log\n \n if [ $? -ne 0 ]; then\n     echo >&2 \"Sage failed to start up.\"\n```",
    "created_at": "2017-08-30T15:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317305",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:63'>Comment 63:</a>
The make target "sage-starts" fails for me. This fixes it; is it the right way to fix it?

```diff
diff --git a/src/bin/sage-starts b/src/bin/sage-starts
index 85cbae67e5..498c930810 100755
--- a/src/bin/sage-starts
+++ b/src/bin/sage-starts
@@ -14,7 +14,7 @@ echo "[`date +'%Y-%m-%d %H:%M:%S'`] `cat VERSION.txt 2>/dev/null`" | tee -a logs
 # sysadmin.  We use --nodotsage so we don't force a .sage directory
 # in the sysadmin's HOME directory.
 cmd='sage.all._write_started_file(); print "Yes, Sage starts."'
-build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
+"$SAGE_SRC_ROOT"/build/bin/sage-logger "./sage --nodotsage -c '$cmd'" logs/start.log
 
 if [ $? -ne 0 ]; then
     echo >&2 "Sage failed to start up."
```



---

archive/issue_comments_317306.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nWith that change, `make ptestlong` fails:\n\n```\nTesting that Sage starts...\n[2017-08-30 09:19:29] \nThis looks like the first time you are running Sage.\nCleaning up, do not interrupt this.\nDone cleaning.\nYes, Sage starts.\n\nreal\t52m33.269s\nuser\t191m2.435s\nsys\t19m38.034s\nSage build/upgrade complete!\n\nTo install small scripts to directly run Sage's versions of GAP,\nthe PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.\njust 'gap' or 'gp') into a standard 'bin' directory, start Sage\nby typing 'sage' (or './sage') and enter something like\n\n    install_scripts('/usr/local/bin')\n\nat the Sage command prompt ('sage:').\n\n/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\nmake: *** [ptestlong] Error 1\n```\nI think that the make target\n\n```\nTESTALL = $(top_srcdir)/sage -t --all\n```\nneeds to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.\n\n`./sage -t -all` also fails:\n\n```\n$ ./sage -t --all\n/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory\nTraceback (most recent call last):\n  File \"/.../SAGE_SRC_ROOT/src/bin/sage-runtests\", line 97, in <module>\n    DC = DocTestController(options, args)\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 334, in __init__\n    for pkg in list_packages('optional', local=True).values():\n  File \"/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py\", line 230, in list_packages\n    for p in os.listdir(SAGE_PKGS):\nOSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'\n```\nThis can almost be fixed by\n\n```diff\ndiff --git a/src/sage/env.py b/src/sage/env.py\nindex 33cd754a06..f91c70ba7d 100644\n--- a/src/sage/env.py\n+++ b/src/sage/env.py\n@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])\n _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))\n \n # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.\n-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))\n+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))\n \n \n _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))\n```\nbut there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.",
    "created_at": "2017-08-30T18:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317306",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:64'>Comment 64:</a>
With that change, `make ptestlong` fails:

```
Testing that Sage starts...
[2017-08-30 09:19:29] 
This looks like the first time you are running Sage.
Cleaning up, do not interrupt this.
Done cleaning.
Yes, Sage starts.

real	52m33.269s
user	191m2.435s
sys	19m38.034s
Sage build/upgrade complete!

To install small scripts to directly run Sage's versions of GAP,
the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.
just 'gap' or 'gp') into a standard 'bin' directory, start Sage
by typing 'sage' (or './sage') and enter something like

    install_scripts('/usr/local/bin')

at the Sage command prompt ('sage:').

/.../SAGE_SRC_ROOT/sage -t -p --all --long --logfile=logs/ptestlong.log
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
make: *** [ptestlong] Error 1
```
I think that the make target

```
TESTALL = $(top_srcdir)/sage -t --all
```
needs to be changed so that it runs `SAGE_ROOT/sage` instead of `SAGE_SRC_ROOT/sage`.

`./sage -t -all` also fails:

```
$ ./sage -t --all
/.../SAGE_SRC_ROOT/src/bin/sage-env: line 527: /.../BUILDDIR/src/bin/sage-arch-env: No such file or directory
Traceback (most recent call last):
  File "/.../SAGE_SRC_ROOT/src/bin/sage-runtests", line 97, in <module>
    DC = DocTestController(options, args)
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/doctest/control.py", line 334, in __init__
    for pkg in list_packages('optional', local=True).values():
  File "/.../BUILDDIR/local/lib/python2.7/site-packages/sage/misc/package.py", line 230, in list_packages
    for p in os.listdir(SAGE_PKGS):
OSError: [Errno 2] No such file or directory: '/.../BUILDDIR/build/pkgs'
```
This can almost be fixed by

```diff
diff --git a/src/sage/env.py b/src/sage/env.py
index 33cd754a06..f91c70ba7d 100644
--- a/src/sage/env.py
+++ b/src/sage/env.py
@@ -111,7 +111,7 @@ _add_variable_or_fallback('SAGE_LIB',        SITE_PACKAGES[0])
 _add_variable_or_fallback('SAGE_CYTHONIZED', opj('$SAGE_ROOT', 'src', 'build', 'cythonized'))
 
 # Used by sage/misc/package.py.  Should be SAGE_SRC_ROOT in VPATH.
-_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_ROOT', 'build', 'pkgs'))
+_add_variable_or_fallback('SAGE_PKGS', opj('$SAGE_SRC_ROOT', 'build', 'pkgs'))
 
 
 _add_variable_or_fallback('SAGE_EXTCODE',    opj('$SAGE_SHARE', 'sage', 'ext'))
```
but there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.



---

archive/issue_comments_317307.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nIf I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.",
    "created_at": "2017-08-30T20:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317307",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:65'>Comment 65:</a>
If I hack the top-level Makefile so that `make ptestlong` works, then I only get test failures in `sage/tests/cmdline.py`.



---

archive/issue_comments_317308.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nReplying to [@jhpalmieri](#comment%3A64):\n> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.\n\nSee #23758.",
    "created_at": "2017-08-30T20:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317308",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:66'>Comment 66:</a>
Replying to [@jhpalmieri](#comment%3A64):
> there is a bug in the function `_add_variable_or_fallback` in how it parses variable names prefixed with dollar signs. I'll open a new ticket for that.

See #23758.



---

archive/issue_comments_317309.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc6263c9cebb1da0320beeb5240e56477112c2cb\">bc6263c</a></td><td><code>VPATH fix for SAGE_PKGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9c25bc06d357c348e2dbcf8ffb21306afcef750\">f9c25bc</a></td><td><code>VPATH fix for test makefile targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecd2f9d0896fd7f78e2b97cd64ad8fc6a7e2da23\">ecd2f9d</a></td><td><code>doc-src-clean: Clean in source directory until docbuild is fully VPATHified</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60927e52bd991cce1467ce0488ad29a4915b1986\">60927e5</a></td><td><code>trac 23758: in env.py, _add_variable_or_fallback should depend less</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c23cc1cb041c57d364edd3b39389af7e1945ff44\">c23cc1c</a></td><td><code>trac 23758: restore \"import os\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/343d685800f3c4018724cbea795e79d64c9adeca\">343d685</a></td><td><code>trac 23758: add a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822\">3e36b75</a></td><td><code>Merge remote-tracking branch 'trac/u/jhpalmieri/variable_replacement' into t/21469/vpath_build</code></td></tr></table>\n",
    "created_at": "2017-08-31T05:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317309",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:67'>Comment 67:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc6263c9cebb1da0320beeb5240e56477112c2cb">bc6263c</a></td><td><code>VPATH fix for SAGE_PKGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9c25bc06d357c348e2dbcf8ffb21306afcef750">f9c25bc</a></td><td><code>VPATH fix for test makefile targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecd2f9d0896fd7f78e2b97cd64ad8fc6a7e2da23">ecd2f9d</a></td><td><code>doc-src-clean: Clean in source directory until docbuild is fully VPATHified</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60927e52bd991cce1467ce0488ad29a4915b1986">60927e5</a></td><td><code>trac 23758: in env.py, _add_variable_or_fallback should depend less</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c23cc1cb041c57d364edd3b39389af7e1945ff44">c23cc1c</a></td><td><code>trac 23758: restore "import os"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/343d685800f3c4018724cbea795e79d64c9adeca">343d685</a></td><td><code>trac 23758: add a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822">3e36b75</a></td><td><code>Merge remote-tracking branch 'trac/u/jhpalmieri/variable_replacement' into t/21469/vpath_build</code></td></tr></table>




---

archive/issue_comments_317310.json:
```json
{
    "body": "Changed commit from **[64515c1](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)** to **[3e36b75](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)**",
    "created_at": "2017-08-31T05:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317310",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[64515c1](https://github.com/sagemath/sagetrac-mirror/commit/64515c1bc26cf7d4cb6ac1665431afa4b87092f6)** to **[3e36b75](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)**



---

archive/issue_comments_317311.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\nI'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`",
    "created_at": "2017-08-31T05:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317311",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'>Comment 68:</a>
I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`



---

archive/issue_comments_317312.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nReplying to [@mkoeppe](#comment%3A68):\n> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`\n\nThis is a general problem, nothing to worry in the context of this ticket.\n\nBy the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.",
    "created_at": "2017-08-31T09:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317312",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:69'>Comment 69:</a>
Replying to [@mkoeppe](#comment%3A68):
> I'm still getting docbuild errors of the type ` WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)`

This is a general problem, nothing to worry in the context of this ticket.

By the way you might like to use here the upgraded sphinx on #23023, which will most probably be in the next beta.



---

archive/issue_comments_317313.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\nI agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nI am still having the problem in [comment:63](#comment%3A63) with `sage-starts`.",
    "created_at": "2017-08-31T17:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317313",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:70'>Comment 70:</a>
I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

I am still having the problem in [comment:63](#comment%3A63) with `sage-starts`.



---

archive/issue_comments_317314.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nReplying to [@jhpalmieri](#comment%3A70):\n> I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\nUnfortunately these warnings get upgraded to errors like this:\n\n```\n[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n```\nwhich stops this build for me.\n\nI'll try with  #23023 as suggested by Dima.",
    "created_at": "2017-08-31T21:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317314",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'>Comment 71:</a>
Replying to [@jhpalmieri](#comment%3A70):
> I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

Unfortunately these warnings get upgraded to errors like this:

```
[dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
```
which stops this build for me.

I'll try with  #23023 as suggested by Dima.



---

archive/issue_comments_317315.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nReplying to [@mkoeppe](#comment%3A71):\n> Replying to [@jhpalmieri](#comment%3A70):\n> > I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)\n\n> \n> Unfortunately these warnings get upgraded to errors like this:\n> \n> ```\n> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)\n> ```\n> which stops this build for me.\n\nYour change in [comment:53](#comment%3A53) fixed that issue for me. (At least I think that's what fixed it.)",
    "created_at": "2017-08-31T22:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317315",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:72'>Comment 72:</a>
Replying to [@mkoeppe](#comment%3A71):
> Replying to [@jhpalmieri](#comment%3A70):
> > I agree that the docbuild warnings are not new. (My issue in [comment:51](#comment%3A51) was that these were errors, causing docbuilding to actually fail. I am now able to build the docs successfully.)

> 
> Unfortunately these warnings get upgraded to errors like this:
> 
> ```
> [dochtml] OSError: [parallel ] /Users/mkoeppe/s/sage/sage-rebasing/vpath/src/doc/en/reference/parallel/index.rst:17: WARNING: undefined label: sage.interfaces.psage (if the link has no caption the label must precede a section header)
> ```
> which stops this build for me.

Your change in [comment:53](#comment%3A53) fixed that issue for me. (At least I think that's what fixed it.)



---

archive/issue_comments_317316.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff\">754ec81</a></td><td><code>sage-starts: Fix sage-logger invocation for VPATH build</code></td></tr></table>\n",
    "created_at": "2017-08-31T23:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317316",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:73'>Comment 73:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff">754ec81</a></td><td><code>sage-starts: Fix sage-logger invocation for VPATH build</code></td></tr></table>




---

archive/issue_comments_317317.json:
```json
{
    "body": "Changed commit from **[3e36b75](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)** to **[754ec81](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)**",
    "created_at": "2017-08-31T23:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317317",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3e36b75](https://github.com/sagemath/sagetrac-mirror/commit/3e36b75f51413973d847994aed067dbe7bfef822)** to **[754ec81](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)**



---

archive/issue_comments_317318.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nReplying to [@jhpalmieri](#comment%3A70):\n> I am still having the problem in [comment:63](#comment%3A63) with `sage-starts`.\n\nI agree with your patch and have added a commit; but see #23769.",
    "created_at": "2017-08-31T23:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317318",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'>Comment 74:</a>
Replying to [@jhpalmieri](#comment%3A70):
> I am still having the problem in [comment:63](#comment%3A63) with `sage-starts`.

I agree with your patch and have added a commit; but see #23769.



---

archive/issue_comments_317319.json:
```json
{
    "body": "Changed commit from **[754ec81](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)** to **[0c357dd](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)**",
    "created_at": "2017-09-01T04:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317319",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[754ec81](https://github.com/sagemath/sagetrac-mirror/commit/754ec81627aa01a9bfa5646e946bdea02fe220ff)** to **[0c357dd](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)**



---

archive/issue_comments_317320.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307\">0c357dd</a></td><td><code>Simplify VPATH patch</code></td></tr></table>\n",
    "created_at": "2017-09-01T04:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317320",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:75'>Comment 75:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307">0c357dd</a></td><td><code>Simplify VPATH patch</code></td></tr></table>




---

archive/issue_comments_317321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,8 +22,10 @@\n The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n-When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n+With the current set of patches, the compilation goes through and gives a working `sage`.\n+However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.\n \n \n+\n``````\n",
    "created_at": "2017-09-01T04:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317321",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,8 +22,10 @@
 The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
-When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
+When "./configure" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
+With the current set of patches, the compilation goes through and gives a working `sage`.
+However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.
 
 
+
``````




---

archive/issue_comments_317322.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, John H. Palmieri**",
    "created_at": "2017-09-01T04:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317322",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, John H. Palmieri**



---

archive/issue_events_273472.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T04:49:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273472"
}
```



---

archive/issue_events_273473.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T04:49:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273473"
}
```



---

archive/issue_comments_317323.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nI think this ticket is ready for broader review.",
    "created_at": "2017-09-01T04:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317323",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'>Comment 77:</a>
I think this ticket is ready for broader review.



---

archive/issue_comments_317324.json:
```json
{
    "body": "Changed author from **Matthias Koeppe, John H. Palmieri** to **Matthias Koeppe**",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317324",
    "user": "https://github.com/jhpalmieri"
}
```

Changed author from **Matthias Koeppe, John H. Palmieri** to **Matthias Koeppe**



---

archive/issue_comments_317325.json:
```json
{
    "body": "<a id='comment:78'>Comment 78:</a>\n`make distclean` fails because `make sagelib-clean` fails:\n\n```\ncd \"/.../SAGE_SRC_ROOT/src\" && make -j6 clean\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nmake[2]: *** No rule to make target `clean'.  Stop.\nmake[1]: *** [sagelib-clean] Error 2\n```\nI guess it should cd to `/.../BUILDDIR/src` instead.",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317325",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:78'>Comment 78:</a>
`make distclean` fails because `make sagelib-clean` fails:

```
cd "/.../SAGE_SRC_ROOT/src" && make -j6 clean
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: *** No rule to make target `clean'.  Stop.
make[1]: *** [sagelib-clean] Error 2
```
I guess it should cd to `/.../BUILDDIR/src` instead.



---

archive/issue_comments_317326.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,10 +22,8 @@\n The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n-When \"./configure\" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. \n+When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n \n-With the current set of patches, the compilation goes through and gives a working `sage`.\n-However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.\n+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.\n \n \n-\n``````\n",
    "created_at": "2017-09-01T04:56:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317326",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,10 +22,8 @@
 The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
-When "./configure" detects a VPATH build, it installs patched copies of `sage` and `Makefile` in BUILDDIR. 
+When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
 
-With the current set of patches, the compilation goes through and gives a working `sage`.
-However, the source tree is not kept quite clean yet. Some generated sources and files generated by the docbuild are put in the source tree. This should be fixed in follow-up tickets.
+With the current set of patches, the compilation goes through and gives a working `sage`, except for the docbuild.
 
 
-
``````




---

archive/issue_comments_317327.json:
```json
{
    "body": "<a id='comment:79'>Comment 79:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319\">d32598e</a></td><td><code>VPATH fix for sagelib-clean</code></td></tr></table>\n",
    "created_at": "2017-09-01T05:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317327",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:79'>Comment 79:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319">d32598e</a></td><td><code>VPATH fix for sagelib-clean</code></td></tr></table>




---

archive/issue_comments_317328.json:
```json
{
    "body": "Changed commit from **[0c357dd](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)** to **[d32598e](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)**",
    "created_at": "2017-09-01T05:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317328",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0c357dd](https://github.com/sagemath/sagetrac-mirror/commit/0c357dd5da4d70a8a3f3ca96984359a563686307)** to **[d32598e](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)**



---

archive/issue_comments_317329.json:
```json
{
    "body": "<a id='comment:80'>Comment 80:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc\">06f7d1d</a></td><td><code>Fix build/make/install change</code></td></tr></table>\n",
    "created_at": "2017-09-01T05:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317329",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:80'>Comment 80:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc">06f7d1d</a></td><td><code>Fix build/make/install change</code></td></tr></table>




---

archive/issue_comments_317330.json:
```json
{
    "body": "Changed commit from **[d32598e](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)** to **[06f7d1d](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)**",
    "created_at": "2017-09-01T05:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317330",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d32598e](https://github.com/sagemath/sagetrac-mirror/commit/d32598ee2cf41e37af931b0842e520eac43b9319)** to **[06f7d1d](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)**



---

archive/issue_comments_317331.json:
```json
{
    "body": "<a id='comment:81'>Comment 81:</a>\nI tried again from a distcleaned tree. Now I'm running into:\n\n```\n[sagelib-8.1.beta3] Generating auto-generated sources\n[sagelib-8.1.beta3] Building interpreters for fast_callable\n[sagelib-8.1.beta3] -> First build of interpreters\n[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'\n```",
    "created_at": "2017-09-01T17:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317331",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'>Comment 81:</a>
I tried again from a distcleaned tree. Now I'm running into:

```
[sagelib-8.1.beta3] Generating auto-generated sources
[sagelib-8.1.beta3] Building interpreters for fast_callable
[sagelib-8.1.beta3] -> First build of interpreters
[sagelib-8.1.beta3] error: [Errno 2] No such file or directory: 'sage/ext/interpreters/interp_cc.c'
```



---

archive/issue_comments_317332.json:
```json
{
    "body": "<a id='comment:82'>Comment 82:</a>\nI haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?",
    "created_at": "2017-09-01T20:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317332",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:82'>Comment 82:</a>
I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). Where should those files be created?



---

archive/issue_comments_317333.json:
```json
{
    "body": "<a id='comment:83'>Comment 83:</a>\nReplying to [@jhpalmieri](#comment%3A82):\n> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n\nYes, this is how I am testing it (except I made `src/doc` writable).\n\nSomething in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\n> Where should those files be created?\n\nThey should be created in `SAGE_ROOT/src/sage/ext`.",
    "created_at": "2017-09-01T20:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317333",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:83'>Comment 83:</a>
Replying to [@jhpalmieri](#comment%3A82):
> I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 

Yes, this is how I am testing it (except I made `src/doc` writable).

Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

> Where should those files be created?

They should be created in `SAGE_ROOT/src/sage/ext`.



---

archive/issue_comments_317334.json:
```json
{
    "body": "<a id='comment:84'>Comment 84:</a>\nI think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?",
    "created_at": "2017-09-01T20:47:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317334",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:84'>Comment 84:</a>
I think we need a variable for `SAGE_ROOT/src` to make this patch cleaner. Suggestions for the variable name?



---

archive/issue_comments_317335.json:
```json
{
    "body": "<a id='comment:85'>Comment 85:</a>\nPerhaps should:\n- rename SAGE_SRC_ROOT to SAGE_VPATH\n- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)\n- create SAGE_SRC = SAGE_ROOT/src\n- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n- create SAGE_SRC_DOC = SAGE_ROOT/src/doc",
    "created_at": "2017-09-01T20:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317335",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'>Comment 85:</a>
Perhaps should:
- rename SAGE_SRC_ROOT to SAGE_VPATH
- rename SAGE_SRC to SAGE_VPATH_SRC = SAGE_VPATH/src (and change many places that now use SAGE_SRC)
- create SAGE_SRC = SAGE_ROOT/src
- rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
- create SAGE_SRC_DOC = SAGE_ROOT/src/doc



---

archive/issue_comments_317336.json:
```json
{
    "body": "<a id='comment:86'>Comment 86:</a>\nReplying to [@mkoeppe](#comment%3A85):\n> - create SAGE_SRC = SAGE_ROOT/src\n\nHow about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)\n\n> - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc\n> - create SAGE_SRC_DOC = SAGE_ROOT/src/doc \n\nOr `SAGE_ROOT_SRC_DOC`?",
    "created_at": "2017-09-01T21:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317336",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:86'>Comment 86:</a>
Replying to [@mkoeppe](#comment%3A85):
> - create SAGE_SRC = SAGE_ROOT/src

How about `SAGE_ROOT_SRC`? (only if you're changing `SAGE_SRC_ROOT`)

> - rename SAGE_DOC_SRC to SAGE_VPATH_SRC_DOC = SAGE_VPATH/src/doc
> - create SAGE_SRC_DOC = SAGE_ROOT/src/doc 

Or `SAGE_ROOT_SRC_DOC`?



---

archive/issue_comments_317337.json:
```json
{
    "body": "<a id='comment:87'>Comment 87:</a>\nThanks, these are good suggestions.",
    "created_at": "2017-09-01T21:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317337",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:87'>Comment 87:</a>
Thanks, these are good suggestions.



---

archive/issue_comments_317338.json:
```json
{
    "body": "<a id='comment:88'>Comment 88:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c\">05f3a91</a></td><td><code>Rename SAGE_SRC_ROOT -> SAGE_VPATH</code></td></tr></table>\n",
    "created_at": "2017-09-01T21:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317338",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:88'>Comment 88:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c">05f3a91</a></td><td><code>Rename SAGE_SRC_ROOT -> SAGE_VPATH</code></td></tr></table>




---

archive/issue_comments_317339.json:
```json
{
    "body": "Changed commit from **[06f7d1d](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)** to **[05f3a91](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**",
    "created_at": "2017-09-01T21:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317339",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[06f7d1d](https://github.com/sagemath/sagetrac-mirror/commit/06f7d1d6914fe55bf1d3eedab04a9aa13f260dfc)** to **[05f3a91](https://github.com/sagemath/sagetrac-mirror/commit/05f3a9107a55a6c308196c85a995f867b452fb9c)**



---

archive/issue_comments_317340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,7 @@\n  make\n ```\n \n-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.\n \n The present patch changes the various places where $SAGE_ROOT is used.\n When \"./configure\" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. \n``````\n",
    "created_at": "2017-09-01T21:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317340",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,7 @@
  make
 ```
 
-The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_SRC_ROOT. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
+The present patch implements this. BUILDDIR from the above example is reflected in the old environment variable $SAGE_ROOT; this is now to be distinguished from SRCDIR, which is reflected in the new environment variable $SAGE_VPATH. $SAGE_LOCAL defaults to BUILDDIR/local, but can of course be changed using `configure --prefix`.
 
 The present patch changes the various places where $SAGE_ROOT is used.
 When "./configure" detects a VPATH build, it installs patched copies of `sage`, `Makefile` and `build/make/install` in BUILDDIR. 
``````




---

archive/issue_comments_317341.json:
```json
{
    "body": "<a id='comment:90'>Comment 90:</a>\nReplying to [@mkoeppe](#comment%3A83):\n> Replying to [@jhpalmieri](#comment%3A82):\n> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). \n\n> \n> Yes, this is how I am testing it (except I made `src/doc` writable).\n> \n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n> \n> > Where should those files be created?\n\n> \n> They should be created in `SAGE_ROOT/src/sage/ext`.\n\nIt looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.",
    "created_at": "2017-09-01T22:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317341",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:90'>Comment 90:</a>
Replying to [@mkoeppe](#comment%3A83):
> Replying to [@jhpalmieri](#comment%3A82):
> > I haven't seen that after running `make distclean` in both the original source directory and the build directory, but I could imagine it would happen if you don't have write access to the original source directory, since the interpreters directory and its contents are autogenerated (see `src/sage_setup/autogen`). 

> 
> Yes, this is how I am testing it (except I made `src/doc` writable).
> 
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.
> 
> > Where should those files be created?

> 
> They should be created in `SAGE_ROOT/src/sage/ext`.

It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`, then copied to `SAGE_ROOT/...`.



---

archive/issue_comments_317342.json:
```json
{
    "body": "<a id='comment:91'>Comment 91:</a>\nReplying to [@mkoeppe](#comment%3A83):\n> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.\n\nSee #23774.",
    "created_at": "2017-09-01T22:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317342",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:91'>Comment 91:</a>
Replying to [@mkoeppe](#comment%3A83):
> Something in the code generator is missing error checking. I suspect it's coming from`src/sage_setup/autogen/interpreters/__init__.py`, which has some complicated exception handling.

See #23774.



---

archive/issue_comments_317343.json:
```json
{
    "body": "<a id='comment:92'>Comment 92:</a>\nReplying to [@jhpalmieri](#comment%3A90):\n> > > Where should those files be created?\n\n> > \n> > They should be created in `SAGE_ROOT/src/sage/ext`.\n\n> \n> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...\n\nYes, see `src/sage_setup/autogen/interpreters/__main__.py`.\n\nBut I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.",
    "created_at": "2017-09-01T22:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317343",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:92'>Comment 92:</a>
Replying to [@jhpalmieri](#comment%3A90):
> > > Where should those files be created?

> > 
> > They should be created in `SAGE_ROOT/src/sage/ext`.

> 
> It looks like they are actually created in `SAGE_SRC_ROOT=SAGE_VPATH`...

Yes, see `src/sage_setup/autogen/interpreters/__main__.py`.

But I think I will defer full VPATHification of this and of the docbuild to follow-up tickets.



---

archive/issue_comments_317344.json:
```json
{
    "body": "<a id='comment:93'>Comment 93:</a>\nI wonder if instead of\n\n```\n+dnl Set up files for VPATH build\n+AS_IF([test x$srcdir != x.],\n+    [AC_CONFIG_COMMANDS([vpath],\n+\t[\n+\t    SAGE_ROOT=${ac_abs_top_builddir}\n+\t    SAGE_VPATH=${ac_abs_top_srcdir}\n+\t    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream\n+\t    # If new packages are downloaded, they end up in the build directory upstream.\n+\t    mkdir -p upstream\n+\t    for a in $SAGE_VPATH/upstream/* ; do\n+\t\tif test -f \"$a\" -a ! -f \"upstream/`basename $a`\" ; then\n+\t\t    ln -s \"$a\" upstream/\n+\t\tfi\n+\t    done\n+\t    cat > sage <<EOF\n```\n\nwe could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.",
    "created_at": "2017-09-05T09:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317344",
    "user": "https://github.com/embray"
}
```

<a id='comment:93'>Comment 93:</a>
I wonder if instead of

```
+dnl Set up files for VPATH build
+AS_IF([test x$srcdir != x.],
+    [AC_CONFIG_COMMANDS([vpath],
+	[
+	    SAGE_ROOT=${ac_abs_top_builddir}
+	    SAGE_VPATH=${ac_abs_top_srcdir}
+	    # Assume that $srcdir is readonly, so symlink existing upstream files into build directory upstream
+	    # If new packages are downloaded, they end up in the build directory upstream.
+	    mkdir -p upstream
+	    for a in $SAGE_VPATH/upstream/* ; do
+		if test -f "$a" -a ! -f "upstream/`basename $a`" ; then
+		    ln -s "$a" upstream/
+		fi
+	    done
+	    cat > sage <<EOF
```

we could simply modify whatever code looks for the `upstream/` directory (presumably mostly in `sage-spkg`) to explicitly look for it under `$SAGE_ROOT`.  In other words I don't see why making symlinks in the VPATH sources are necessary if we already *know* where to find the `upstream/` directory.



---

archive/issue_comments_317345.json:
```json
{
    "body": "<a id='comment:94'>Comment 94:</a>\nI'm seeing a lot of activity on this ticket that I haven't followed.\n\nAnyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`",
    "created_at": "2017-09-05T15:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317345",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:94'>Comment 94:</a>
I'm seeing a lot of activity on this ticket that I haven't followed.

Anyway, I still don't quite understand what a `VPATH` build even means in the context of Sage. I really think that this should be explained better, and how this differs from `./configure --prefix=...`



---

archive/issue_comments_317346.json:
```json
{
    "body": "<a id='comment:95'>Comment 95:</a>\n--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n\nThe vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...",
    "created_at": "2017-09-05T15:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317346",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:95'>Comment 95:</a>
--prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.

The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...



---

archive/issue_comments_317347.json:
```json
{
    "body": "<a id='comment:96'>Comment 96:</a>\nReplying to [@mkoeppe](#comment%3A95):\n> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.\n> \n> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...\n\nThis short reply is much better than the long explanation in the ticket description. It's all totally clear now.",
    "created_at": "2017-09-06T08:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:96'>Comment 96:</a>
Replying to [@mkoeppe](#comment%3A95):
> --prefix selects the install tree (SAGE_LOCAL) of sage-the-distribution.
> 
> The vpath mechanism selects the build tree (SAGE_ROOT) of sage-the-distribution. This includes the configuration and build artifacts such as src/build/...

This short reply is much better than the long explanation in the ticket description. It's all totally clear now.



---

archive/issue_comments_317348.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.\n+\n+The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.\n+\n+\n+---\n+\n+\n [VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. \n \n This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through \"make distclean\" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).\n``````\n",
    "created_at": "2017-09-08T08:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317348",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+**Executive summary** Currently, `--prefix` selects the install tree (`SAGE_LOCAL`) of sage-the-distribution. But often we want several builds out of (almost) the same source tree.
+
+The `vpath` mechanism proposed here selects the build tree (`SAGE_ROOT`) of sage-the-distribution. This includes the configuration and build artefacts such as `src/build/...`.
+
+
+---
+
+
 [VPATH builds](https://www.gnu.org/software/automake/manual/html_node/VPATH-Builds.html) are a powerful feature of autotools (and other) build systems. This feature allows the developer to build a package in a separate (initially empty) build directory tree. The source directory tree is only read from (and could even be mounted read-only) and is therefore always clean. 
 
 This is a powerful feature for the developer because from the same source tree many different configurations can be built and tested, without having to go through "make distclean" and reconfiguration. The source tree can also be shared, for example using a networked file system between different hosts, running different architectures. Another modern use case involves VMs. For example, Docker allows to mount the source directory from the host in the VM (see #21474).
``````




---

archive/issue_comments_317349.json:
```json
{
    "body": "<a id='comment:97'>Comment 97:</a>\nWould the old way to build still work unamended, or `BUILDDIR` will need to be created separately?",
    "created_at": "2017-09-08T08:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317349",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:97'>Comment 97:</a>
Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?



---

archive/issue_comments_317350.json:
```json
{
    "body": "<a id='comment:98'>Comment 98:</a>\nI wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).",
    "created_at": "2017-09-08T08:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317350",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:98'>Comment 98:</a>
I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).



---

archive/issue_comments_317351.json:
```json
{
    "body": "<a id='comment:99'>Comment 99:</a>\nReplying to [@dimpase](#comment%3A98):\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nWhen making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317351",
    "user": "https://github.com/embray"
}
```

<a id='comment:99'>Comment 99:</a>
Replying to [@dimpase](#comment%3A98):
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_317352.json:
```json
{
    "body": "<a id='comment:100'>Comment 100:</a>\nReplying to [@embray](#comment%3A99):\n> Replying to [@dimpase](#comment%3A98):\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nMaybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...\n\n> \n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).",
    "created_at": "2017-09-08T09:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317352",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:100'>Comment 100:</a>
Replying to [@embray](#comment%3A99):
> Replying to [@dimpase](#comment%3A98):
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

Maybe [git-worktree](https://git-scm.com/docs/git-worktree) is the right git functionality to use...

> 
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  But indeed it might be nice to have a way to automate that (or even enable by default).



---

archive/issue_comments_317353.json:
```json
{
    "body": "<a id='comment:101'>Comment 101:</a>\nReplying to [@dimpase](#comment%3A98):\n> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\nIt would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\nBut this is entirely unrelated to the present ticket.",
    "created_at": "2017-09-08T19:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317353",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:101'>Comment 101:</a>
Replying to [@dimpase](#comment%3A98):
> I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
But this is entirely unrelated to the present ticket.



---

archive/issue_comments_317354.json:
```json
{
    "body": "<a id='comment:102'>Comment 102:</a>\nReplying to [@embray](#comment%3A99):\n> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  \n\nJust a quick note. When one says \"VPATH\", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html",
    "created_at": "2017-09-08T19:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317354",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:102'>Comment 102:</a>
Replying to [@embray](#comment%3A99):
> When making a VPATH build you typically specify the path to the build tree yourself, so you could do something like `VPATH=builds/$(git symbolic-ref --short HEAD)`.  

Just a quick note. When one says "VPATH", it refers to the source directory, not to the build directory. https://www.gnu.org/software/make/manual/html_node/General-Search.html



---

archive/issue_comments_317355.json:
```json
{
    "body": "<a id='comment:103'>Comment 103:</a>\nReplying to [@dimpase](#comment%3A97):\n> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?\n\nYes, with this patch one can still do non-VPATH builds, without any change.",
    "created_at": "2017-09-08T19:37:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317355",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:103'>Comment 103:</a>
Replying to [@dimpase](#comment%3A97):
> Would the old way to build still work unamended, or `BUILDDIR` will need to be created separately?

Yes, with this patch one can still do non-VPATH builds, without any change.



---

archive/issue_comments_317356.json:
```json
{
    "body": "<a id='comment:104'>Comment 104:</a>\nReplying to [@mkoeppe](#comment%3A101):\n> Replying to [@dimpase](#comment%3A98):\n> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).\n\n> \n> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.\n> But this is entirely unrelated to the present ticket.\n\nI suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?",
    "created_at": "2017-09-08T20:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317356",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:104'>Comment 104:</a>
Replying to [@mkoeppe](#comment%3A101):
> Replying to [@dimpase](#comment%3A98):
> > I wonder how this can be syncronised with git branches. Namely, it would be nice if a build is tagged by the source commit, so that it is known at which source state the build was done (I gather there could even be a git feature for this...).

> 
> It would be nice if the Sage version number that it displays at startup would show the git commit from which it is built.
> But this is entirely unrelated to the present ticket.

I suppose I just don't understand what happens to a VPATH build after the source tree it is built from is changed. Will it become broken, or not?



---

archive/issue_comments_317357.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nAre there any immediate issues left here beside [comment:93](#comment%3A93)?",
    "created_at": "2017-09-28T18:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317357",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'>Comment 5:</a>
Are there any immediate issues left here beside [comment:93](#comment%3A93)?



---

archive/issue_comments_317358.json:
```json
{
    "body": "Work Issues: **merge conflicts**",
    "created_at": "2018-01-14T01:57:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317358",
    "user": "https://github.com/saraedum"
}
```

Work Issues: **merge conflicts**



---

archive/issue_events_273474.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-01-14T01:57:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273474"
}
```



---

archive/issue_events_273475.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-01-14T01:57:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273475"
}
```



---

archive/issue_comments_317359.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI actually could really use this feature right now :)\n\nmkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix [comment:93](#comment%3A93)?",
    "created_at": "2020-02-28T00:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317359",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'>Comment 7:</a>
I actually could really use this feature right now :)

mkoeppe, should I try to resolve conflicts here? Or do you have time to do so, so I can review afterwards and maybe fix [comment:93](#comment%3A93)?



---

archive/issue_comments_317360.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...\n\nIf you need this earlier, please feel free to work on it.\n\nI don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.",
    "created_at": "2020-02-28T00:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317360",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
I hope to get back to it within the next month, but not right now. It will likely interact with some of my build-related tickets that are waiting for review...

If you need this earlier, please feel free to work on it.

I don't think comment 93 should hold up this ticket. Improvements could always be done in a follow-up ticket.



---

archive/issue_events_273476.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273476"
}
```



---

archive/issue_events_273477.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-09T23:04:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273477"
}
```



---

archive/issue_events_273478.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273478"
}
```



---

archive/issue_events_273479.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273479"
}
```



---

archive/issue_comments_317361.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317361",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>Comment 1:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_273480.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273480"
}
```



---

archive/issue_events_273481.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273481"
}
```



---

archive/issue_events_273482.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273482"
}
```



---

archive/issue_events_273483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273483"
}
```



---

archive/issue_comments_317362.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21469#issuecomment-317362",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_273484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273484"
}
```



---

archive/issue_events_273485.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273485"
}
```



---

archive/issue_events_273486.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273486"
}
```



---

archive/issue_events_273487.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273487"
}
```



---

archive/issue_events_273488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273488"
}
```



---

archive/issue_events_273489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273489"
}
```



---

archive/issue_events_273490.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273490"
}
```



---

archive/issue_events_273491.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21469",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21469#event-273491"
}
```
