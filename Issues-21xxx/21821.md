# Issue 21821: Avoid Sage-specific variables in autogen/pari

archive/issues_021584.json:
```json
{
    "body": "In `src/sage_setup/autogen/pari`: do not hardcode the path of `pari.desc` and don't use `SAGE_SRC`.\n\nCC:  @defeo\n\nReviewer: Erik Bray\n\nAuthor: Jeroen Demeyer\n\nBranch: bc8a3233c86fea1cb4ee11e7a6a71a12fd9d9e77\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21821\n\n",
    "closed_at": "2016-11-09T18:16:10Z",
    "created_at": "2016-11-04T15:01:08Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Avoid Sage-specific variables in autogen/pari",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21821",
    "user": "https://github.com/jdemeyer"
}
```
In `src/sage_setup/autogen/pari`: do not hardcode the path of `pari.desc` and don't use `SAGE_SRC`.

CC:  @defeo

Reviewer: Erik Bray

Author: Jeroen Demeyer

Branch: bc8a3233c86fea1cb4ee11e7a6a71a12fd9d9e77

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21821





---

archive/issue_comments_318908.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-04T18:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318908",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318909.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2016-11-04T18:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318909",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_318910.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-07T16:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318911.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-07T18:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318911",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318912.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-07T18:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318913.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+In `src/sage_setup/autogen/pari`: do not hardcode the path of `pari.desc` and don't use `SAGE_SRC`.\n \n Dependencies: #21820\n \n``````\n",
    "created_at": "2016-11-07T18:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318913",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+In `src/sage_setup/autogen/pari`: do not hardcode the path of `pari.desc` and don't use `SAGE_SRC`.
 
 Dependencies: #21820
 
``````




---

archive/issue_comments_318914.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-07T18:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318915.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-07T18:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318915",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318916.json:
```json
{
    "body": "<a id='comment:13'></a>I think the `pari_share()` makes sense--I like that it uses whatever the appropriate `gp` is to get the right path.  Though I think this would make sense to have somewhere in sage itself, and be stored as a variable in `sage.env`, not just as a one-off in this code.\n\nI don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.  Of course, that's the typical case. But the code is not otherwise designed in such a way that that *must* be the case, nor do I think it necessarily should be.  I like the way it was done better.",
    "created_at": "2016-11-08T11:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318916",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>I think the `pari_share()` makes sense--I like that it uses whatever the appropriate `gp` is to get the right path.  Though I think this would make sense to have somewhere in sage itself, and be stored as a variable in `sage.env`, not just as a one-off in this code.

I don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.  Of course, that's the typical case. But the code is not otherwise designed in such a way that that *must* be the case, nor do I think it necessarily should be.  I like the way it was done better.



---

archive/issue_comments_318917.json:
```json
{
    "body": "<a id='comment:14'></a>So, what is your solution for `sage_src_pari()` which would be compatible with #21613?",
    "created_at": "2016-11-08T13:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318917",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>So, what is your solution for `sage_src_pari()` which would be compatible with #21613?



---

archive/issue_comments_318918.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 embray]:\n> I don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.\n\n\nLet me clarify: that code is only meant to be run during the *build* of Sage. And I do think it is a reasonable assumption that the current working directory at build time is the  source directory (*). Most `setup.py` files make that assumption, so if you see this `sage_setup` stuff as an extension of `setup.py`, it makes perfect sense.\n\n(*) To be very precise, let's define the source directory as the directory containing `setup.py`, which is `$SAGE_SRC = $SAGE_ROOT/src` in Sage.",
    "created_at": "2016-11-08T13:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:13 embray]:
> I don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.


Let me clarify: that code is only meant to be run during the *build* of Sage. And I do think it is a reasonable assumption that the current working directory at build time is the  source directory (*). Most `setup.py` files make that assumption, so if you see this `sage_setup` stuff as an extension of `setup.py`, it makes perfect sense.

(*) To be very precise, let's define the source directory as the directory containing `setup.py`, which is `$SAGE_SRC = $SAGE_ROOT/src` in Sage.



---

archive/issue_comments_318919.json:
```json
{
    "body": "<a id='comment:16'></a>Hmm, I agree with you, but what bothers me then is that `sage_setup` is *installed* at all, if it's only meant as a supplement to `setup.py` (and that being the case, we could also vastly simplify the `setup.py` by moving things like distutils commands into `sage_setup` as well, which wouldn't be a bad idea anyways).\n\nTo follow up, I feel like if `sage_setup` can be installed, then it should also in principle work outside a build context.  I think it would be better if it simply weren't installed at all, but I think there are reasons it is--especially for `sage_setup.docbuild` (but then maybe that should be moved either into the `sage` package itself, or into its own package).",
    "created_at": "2016-11-08T14:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318919",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>Hmm, I agree with you, but what bothers me then is that `sage_setup` is *installed* at all, if it's only meant as a supplement to `setup.py` (and that being the case, we could also vastly simplify the `setup.py` by moving things like distutils commands into `sage_setup` as well, which wouldn't be a bad idea anyways).

To follow up, I feel like if `sage_setup` can be installed, then it should also in principle work outside a build context.  I think it would be better if it simply weren't installed at all, but I think there are reasons it is--especially for `sage_setup.docbuild` (but then maybe that should be moved either into the `sage` package itself, or into its own package).



---

archive/issue_comments_318920.json:
```json
{
    "body": "<a id='comment:17'></a>Put another way, I'm not sure what the advantage is to *not* using `SAGE_SRC` here unless everything in `sage_setup` is consistently designed to only be used at build time.",
    "created_at": "2016-11-08T14:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318920",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Put another way, I'm not sure what the advantage is to *not* using `SAGE_SRC` here unless everything in `sage_setup` is consistently designed to only be used at build time.



---

archive/issue_comments_318921.json:
```json
{
    "body": "<a id='comment:18'></a>Maybe `sage_setup` is installed just for testing, such that it can be imported in doctests?",
    "created_at": "2016-11-08T14:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318921",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Maybe `sage_setup` is installed just for testing, such that it can be imported in doctests?



---

archive/issue_comments_318922.json:
```json
{
    "body": "<a id='comment:19'></a>`sage_setup` was created in #16431. Already there, it was installed.",
    "created_at": "2016-11-08T14:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318922",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>`sage_setup` was created in #16431. Already there, it was installed.



---

archive/issue_comments_318923.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 embray]:\n> Put another way, I'm not sure what the advantage is to *not* using `SAGE_SRC` here\n\n\nI see it as part of push towards less Sage-specific things in the Sage build system, see also #15105 and #21507 in general.",
    "created_at": "2016-11-08T14:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318923",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:17 embray]:
> Put another way, I'm not sure what the advantage is to *not* using `SAGE_SRC` here


I see it as part of push towards less Sage-specific things in the Sage build system, see also #15105 and #21507 in general.



---

archive/issue_comments_318924.json:
```json
{
    "body": "<a id='comment:21'></a>Ok, I think I agree in general.  I *don't* think `sage_setup` should be installed at all, at least not by default.  I'll open a new issue for that.",
    "created_at": "2016-11-08T14:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318924",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>Ok, I think I agree in general.  I *don't* think `sage_setup` should be installed at all, at least not by default.  I'll open a new issue for that.



---

archive/issue_comments_318925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-08T14:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318925",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318926.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-09T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318926",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057678.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-09T18:16:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21821#event-57678"
}
```



---

archive/issue_comments_318927.json:
```json
{
    "body": "<a id='comment:23'></a>The following line that was added here is apparently not compatible with python 3:\n\n```\nout = gp.communicate(\"print(default(datadir))\")[0]\n```\nSee https://groups.google.com/forum/#!topic/sage-devel/eSYPSfZOb9k",
    "created_at": "2016-11-13T18:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318927",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>The following line that was added here is apparently not compatible with python 3:

```
out = gp.communicate("print(default(datadir))")[0]
```
See https://groups.google.com/forum/#!topic/sage-devel/eSYPSfZOb9k



---

archive/issue_comments_318928.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 chapoton]:\n\nyes, it should be bytes, not string, i.e. try this:\n\n```\nout = gp.communicate(b'print(default(datadir))')[0]\n```\n\n(don't know how to make this version-agnostic...)",
    "created_at": "2016-11-13T20:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318928",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>Replying to [comment:23 chapoton]:

yes, it should be bytes, not string, i.e. try this:

```
out = gp.communicate(b'print(default(datadir))')[0]
```

(don't know how to make this version-agnostic...)



---

archive/issue_comments_318929.json:
```json
{
    "body": "<a id='comment:25'></a>The `b\"\"` syntax is supported in Python 2.7.",
    "created_at": "2016-11-13T21:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318929",
    "user": "https://github.com/defeo"
}
```

<a id='comment:25'></a>The `b""` syntax is supported in Python 2.7.



---

archive/issue_comments_318930.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 defeo]:\n> The `b\"\"` syntax is supported in Python 2.7.\n\nAh, OK, it has no effect in Python2. Yes, this would be the good fix then.",
    "created_at": "2016-11-13T21:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318930",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>Replying to [comment:25 defeo]:
> The `b""` syntax is supported in Python 2.7.

Ah, OK, it has no effect in Python2. Yes, this would be the good fix then.



---

archive/issue_comments_318931.json:
```json
{
    "body": "<a id='comment:27'></a>I created #21874.",
    "created_at": "2016-11-13T22:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21821#issuecomment-318931",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>I created #21874.
