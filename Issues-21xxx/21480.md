# Issue 21480: Make sagelib setup.py self-contained and independent of SAGE_ROOT

archive/issues_021243.json:
```json
{
    "assignees": [],
    "body": "This ticket changes the build process of sagelib in the following way:\n- `src/Makefile` delegates ALL building to `src/setup.py`\n- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n\nThis ticket is meant as:\n- preparation for VPATH builds of sage-the-distribution (#21469)\n- working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI\n- making the flow of directory information at build time clearer for developers\n\n More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS and SAGE_CYTHONIZED to be set. The hope is that #20382 and other future tickets will develop better mechanisms to communicate package and directory information to the build.)\n\n. . . . . . . \n\nSome possibly useful information:\n- Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n- `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n\n**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-185.tar.gz\n\nCC:  @sagetrac-felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @jhpalmieri @videlec @saraedum @seblabbe @nthiery @mezzarobba\n\nBranch/Commit: **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21480_\n\n",
    "closed_at": "2016-10-12T06:53:25Z",
    "created_at": "2016-09-12T22:00:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make sagelib setup.py self-contained and independent of SAGE_ROOT",
    "type": "issue",
    "updated_at": "2016-10-12T06:53:25Z",
    "url": "https://github.com/sagemath/sage/issues/21480",
    "user": "https://github.com/mkoeppe"
}
```
This ticket changes the build process of sagelib in the following way:
- `src/Makefile` delegates ALL building to `src/setup.py`
- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.

This ticket is meant as:
- preparation for VPATH builds of sage-the-distribution (#21469)
- working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI
- making the flow of directory information at build time clearer for developers

 More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS and SAGE_CYTHONIZED to be set. The hope is that #20382 and other future tickets will develop better mechanisms to communicate package and directory information to the build.)

. . . . . . . 

Some possibly useful information:
- Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
- `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
 `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.

**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-185.tar.gz

CC:  @sagetrac-felixs @jdemeyer @kiwifb @embray @nexttime @vbraun @dimpase @jhpalmieri @videlec @saraedum @seblabbe @nthiery @mezzarobba

Branch/Commit: **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**

Reviewer: **Jeroen Demeyer**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/21480_





---

archive/issue_events_299082.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T22:00:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299082"
}
```



---

archive/issue_events_299083.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T22:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299083"
}
```



---

archive/issue_events_299084.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T22:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299084"
}
```



---

archive/issue_events_299085.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-12T22:00:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299085"
}
```



---

archive/issue_comments_314969.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAm interesting issue is that technically `cython_debug` has to be installed somewhere (preferably somewhere standard) to be accessible at runtime separately from the source. \n\nI do something in sage-on-gentoo but that's not really satisfactory.",
    "created_at": "2016-09-12T22:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314969",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">comment:1</div>

Am interesting issue is that technically `cython_debug` has to be installed somewhere (preferably somewhere standard) to be accessible at runtime separately from the source. 

I do something in sage-on-gentoo but that's not really satisfactory.



---

archive/issue_comments_314970.json:
```json
{
    "body": "Replying to [ticket:21480 mkoeppe]:\n> In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`\n\nPlease use `--build-base=$SAGE_BUILD_DIR/sagelib`.",
    "created_at": "2016-09-12T22:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314970",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:21480 mkoeppe]:
> In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`

Please use `--build-base=$SAGE_BUILD_DIR/sagelib`.



---

archive/issue_comments_314971.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n... and `sagelib` perhaps with a version suffix.",
    "created_at": "2016-09-12T22:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314971",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

... and `sagelib` perhaps with a version suffix.



---

archive/issue_comments_314972.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@nexttime](#comment:2):\n> Replying to [ticket:21480 mkoeppe]:\n> > In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`\n\n> \n> Please use `--build-base=$SAGE_BUILD_DIR/sagelib`.\n\nYes, the plan *after* #21469 is to use the Sage builddir -- not just for sagelib, but also for other packages.\n\n*Before* #21469 is merged, I want to use `$SAGE_ROOT/var/tmp/sage/build/sagelib` to match what other packages do.",
    "created_at": "2016-09-12T22:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314972",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@nexttime](#comment:2):
> Replying to [ticket:21480 mkoeppe]:
> > In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`

> 
> Please use `--build-base=$SAGE_BUILD_DIR/sagelib`.

Yes, the plan *after* #21469 is to use the Sage builddir -- not just for sagelib, but also for other packages.

*Before* #21469 is merged, I want to use `$SAGE_ROOT/var/tmp/sage/build/sagelib` to match what other packages do.



---

archive/issue_comments_314973.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAh, I see what you meant, now I've found $SAGE_BUILD_DIR. Changed description accordingly.",
    "created_at": "2016-09-12T22:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314973",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Ah, I see what you meant, now I've found $SAGE_BUILD_DIR. Changed description accordingly.



---

archive/issue_comments_314974.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. \n \n-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`\n+In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib-VERSION`\n \n+(`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)\n+\n``````\n",
    "created_at": "2016-09-12T22:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314974",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. 
 
-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`
+In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib-VERSION`
 
+(`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)
+
``````




---

archive/issue_comments_314975.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mkoeppe](#comment:4):\n> Replying to [@nexttime](#comment:2):\n> > Replying to [ticket:21480 mkoeppe]:\n> > > In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`\n\n> > \n> > Please use `--build-base=$SAGE_BUILD_DIR/sagelib`.\n\n> \n> Yes, the plan *after* #21469 is to use the Sage builddir -- not just for sagelib, but also for other packages.\n\n??? `SAGE_BUILD_DIR` exists since years already...  (Its *default* is `$SAGE_ROOT/var/tmp/sage/build/`.)\n\n\\\\\n\n> *Before* #21469 is merged, I want to use `$SAGE_ROOT/var/tmp/sage/build/sagelib` to match what other packages do.",
    "created_at": "2016-09-12T22:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314975",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mkoeppe](#comment:4):
> Replying to [@nexttime](#comment:2):
> > Replying to [ticket:21480 mkoeppe]:
> > > In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_ROOT/var/tmp/sage/build/sagelib`

> > 
> > Please use `--build-base=$SAGE_BUILD_DIR/sagelib`.

> 
> Yes, the plan *after* #21469 is to use the Sage builddir -- not just for sagelib, but also for other packages.

??? `SAGE_BUILD_DIR` exists since years already...  (Its *default* is `$SAGE_ROOT/var/tmp/sage/build/`.)

\\

> *Before* #21469 is merged, I want to use `$SAGE_ROOT/var/tmp/sage/build/sagelib` to match what other packages do.



---

archive/issue_comments_314976.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nexttime](#comment:6):\n> ??? `SAGE_BUILD_DIR` exists since years already...  (Its *default* is `$SAGE_ROOT/var/tmp/sage/build/`.)\n\nYes, thanks, see my other comment.",
    "created_at": "2016-09-12T22:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314976",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nexttime](#comment:6):
> ??? `SAGE_BUILD_DIR` exists since years already...  (Its *default* is `$SAGE_ROOT/var/tmp/sage/build/`.)

Yes, thanks, see my other comment.



---

archive/issue_comments_314977.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAh ok, race condition.",
    "created_at": "2016-09-12T22:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314977",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Ah ok, race condition.



---

archive/issue_comments_314978.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nBy the way, help with implementing this change would be appreciated. I haven't looked at the sagelib build system at all so far.",
    "created_at": "2016-09-12T22:21:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314978",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

By the way, help with implementing this change would be appreciated. I haven't looked at the sagelib build system at all so far.



---

archive/issue_comments_314979.json:
```json
{
    "body": "Branch: **[u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib)**",
    "created_at": "2016-09-13T16:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314979",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib)**



---

archive/issue_comments_314980.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2016-09-13T16:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314980",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_314981.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5\"><code>e399bf4</code></a></td><td><code>First, wishful step</code></td></tr></table>\n",
    "created_at": "2016-09-13T16:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314981",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5"><code>e399bf4</code></a></td><td><code>First, wishful step</code></td></tr></table>




---

archive/issue_comments_314982.json:
```json
{
    "body": "Commit: **[`e399bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5)**",
    "created_at": "2016-09-13T16:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314982",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`e399bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5)**



---

archive/issue_comments_314983.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,8 @@\n \n (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)\n \n+Some possibly useful information:\n+- Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n+- `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n+ `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages). However, there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n``````\n",
    "created_at": "2016-09-13T19:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314983",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,8 @@
 
 (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)
 
+Some possibly useful information:
+- Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
+- `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
+ `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages). However, there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
``````




---

archive/issue_comments_314984.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReally `sagelib-$SAGE_VERSION`? Do you want to fill up everybody's hard disks with Sage build directories? Not to mention that this would require to rebuild everything whenever the Sage version changes.",
    "created_at": "2016-09-13T20:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314984",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Really `sagelib-$SAGE_VERSION`? Do you want to fill up everybody's hard disks with Sage build directories? Not to mention that this would require to rebuild everything whenever the Sage version changes.



---

archive/issue_comments_314985.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. \n \n-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib-VERSION`\n+In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib`\n \n (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)\n \n``````\n",
    "created_at": "2016-09-13T20:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314985",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. 
 
-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib-VERSION`
+In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib`
 
 (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)
 
``````




---

archive/issue_comments_314986.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nFine with me without $SAGE_VERSION; I was just following leif's suggestion in comment 3.",
    "created_at": "2016-09-13T20:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314986",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Fine with me without $SAGE_VERSION; I was just following leif's suggestion in comment 3.



---

archive/issue_comments_314987.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\ni understand that SAGE_BUILD_DIR is the srcdir for toplevel configure.\n\nas long as sagelib is rooted in $(toplevel)/src, it might be less confusing to choose $SAGE_BUILD_DIR/src (not $SAGE_BUILD_DIR/sagelib) as the builddir for sagelib.\n\n(future: replace src by sagelib, but on both ends)\n\ni dont know exactly how the approach using setup.py will emulate VPATH builds. i think it should imitate \"what automake would do\", where applicable.",
    "created_at": "2016-09-13T20:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314987",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:16" align="right">comment:16</div>

i understand that SAGE_BUILD_DIR is the srcdir for toplevel configure.

as long as sagelib is rooted in $(toplevel)/src, it might be less confusing to choose $SAGE_BUILD_DIR/src (not $SAGE_BUILD_DIR/sagelib) as the builddir for sagelib.

(future: replace src by sagelib, but on both ends)

i dont know exactly how the approach using setup.py will emulate VPATH builds. i think it should imitate "what automake would do", where applicable.



---

archive/issue_comments_314988.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@sagetrac-felixs](#comment:16):\n> i understand that SAGE_BUILD_DIR is the srcdir for toplevel configure.\n\nNo, it's $SAGE_ROOT/var/tmp/sage/build/",
    "created_at": "2016-09-13T20:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314988",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@sagetrac-felixs](#comment:16):
> i understand that SAGE_BUILD_DIR is the srcdir for toplevel configure.

No, it's $SAGE_ROOT/var/tmp/sage/build/



---

archive/issue_comments_314989.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nok, nevermind (i meant to write \"SAGE_BUILD_DIR is the *builddir* for toplevel\"). that does not seem to be the case either.\n\nstill i am wondering why \"src\" does not (simply) translate to \"src\". (sure, i am slightly autotools biased).",
    "created_at": "2016-09-13T22:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314989",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:18" align="right">comment:18</div>

ok, nevermind (i meant to write "SAGE_BUILD_DIR is the *builddir* for toplevel"). that does not seem to be the case either.

still i am wondering why "src" does not (simply) translate to "src". (sure, i am slightly autotools biased).



---

archive/issue_comments_314990.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3f275e22fd3e434a14821fdadfde382813a0e90\"><code>f3f275e</code></a></td><td><code>Put .cython_version next to cythonized files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94a58f1a5a6d8b98dc012c966d9e91a897ec1f63\"><code>94a58f1</code></a></td><td><code>Make SAGE_BUILD_DIR variable available in sage-env, not just in sage-spkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f\"><code>a73fa06</code></a></td><td><code>Use SAGE_BUILD_DIR</code></td></tr></table>\n",
    "created_at": "2016-09-14T01:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314990",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3f275e22fd3e434a14821fdadfde382813a0e90"><code>f3f275e</code></a></td><td><code>Put .cython_version next to cythonized files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94a58f1a5a6d8b98dc012c966d9e91a897ec1f63"><code>94a58f1</code></a></td><td><code>Make SAGE_BUILD_DIR variable available in sage-env, not just in sage-spkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f"><code>a73fa06</code></a></td><td><code>Use SAGE_BUILD_DIR</code></td></tr></table>




---

archive/issue_comments_314991.json:
```json
{
    "body": "Changed commit from **[`e399bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5)** to **[`a73fa06`](https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f)**",
    "created_at": "2016-09-14T01:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314991",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e399bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e399bf41d805da7ea602daa5b554e0c7ecf2e7b5)** to **[`a73fa06`](https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f)**



---

archive/issue_comments_314992.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHere's a first version for review. It seems to work for me.\n\nThere are still some to-do items (see comments in `src/Makefile`):\n\n- I am now using `--build-base`, but setup.sh also depends on `SAGE_CYTHONIZED`, defined in `src/sage/env.py`.\n\n I think it would be better if `setup.sh` instead inferred that location from the build-base that was passed to it. \n\n However, setup.sh already does a lot of stuff depending on `SAGE_CYTHONIZED` before `distutils.core.setup` is even called.\n Can this be fixed?\n\n I think I could use some help from the Python experts in the cc list of this ticket on this.\n\n- `sage/libs/pari/auto_gen.pxi` and `sage/ext/interpreters/__init__.py` still need to be taken care of in preparation for the VPATH build.",
    "created_at": "2016-09-14T02:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314992",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Here's a first version for review. It seems to work for me.

There are still some to-do items (see comments in `src/Makefile`):

- I am now using `--build-base`, but setup.sh also depends on `SAGE_CYTHONIZED`, defined in `src/sage/env.py`.

 I think it would be better if `setup.sh` instead inferred that location from the build-base that was passed to it. 

 However, setup.sh already does a lot of stuff depending on `SAGE_CYTHONIZED` before `distutils.core.setup` is even called.
 Can this be fixed?

 I think I could use some help from the Python experts in the cc list of this ticket on this.

- `sage/libs/pari/auto_gen.pxi` and `sage/ext/interpreters/__init__.py` still need to be taken care of in preparation for the VPATH build.



---

archive/issue_events_299086.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-14T02:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299086"
}
```



---

archive/issue_comments_314993.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n Some possibly useful information:\n - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n- `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages). However, there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n+ `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n``````\n",
    "created_at": "2016-09-14T02:18:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314993",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 Some possibly useful information:
 - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
 - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
- `pip install` also offers options `--build` to select a build directory (though it seems as if it does not work with all packages). However, there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
+ `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
 - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
``````




---

archive/issue_events_299087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-14T10:14:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299087"
}
```



---

archive/issue_events_299088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-14T10:14:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299088"
}
```



---

archive/issue_comments_314994.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThinking about it more, I disagree with building in `$SAGE_BUILD_DIR/sagelib` by default.\n\n`$SAGE_LOCAL` (which contains `$SAGE_BUILD_DIR`) is meant as *install* directory, not as *build* directory.\n\nLet's keep `$SAGE_LOCAL` to be exactly the install directory and nothing else (*).\n\nI *do* agree with making the build directory configurable for `VPATH` builds. For typical packages however, if you do not do a `VPATH` build, the build directory is the same as the source directory. Sage should follow the same model. This means that the build directory should be `$SAGE_SRC` *by default*.\n\n\n (*) One could argue that `$SAGE_BUILD_DIR` is currently used as build directory for packages. That is true, but they are only used temporarily, they are not meant to actually store stuff. So this isn't so bad.",
    "created_at": "2016-09-14T10:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314994",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Thinking about it more, I disagree with building in `$SAGE_BUILD_DIR/sagelib` by default.

`$SAGE_LOCAL` (which contains `$SAGE_BUILD_DIR`) is meant as *install* directory, not as *build* directory.

Let's keep `$SAGE_LOCAL` to be exactly the install directory and nothing else (*).

I *do* agree with making the build directory configurable for `VPATH` builds. For typical packages however, if you do not do a `VPATH` build, the build directory is the same as the source directory. Sage should follow the same model. This means that the build directory should be `$SAGE_SRC` *by default*.


 (*) One could argue that `$SAGE_BUILD_DIR` is currently used as build directory for packages. That is true, but they are only used temporarily, they are not meant to actually store stuff. So this isn't so bad.



---

archive/issue_comments_314995.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> Let's keep $SAGE_LOCAL to be exactly the install directory and nothing else (*). \n\nthis is part of the problem with the current \"build system\". SAGE_LOCAL is *not* the install directory. it is where stuff ends up during the build process.\n\noutside sage, an install directory is typically what you pass to --prefix, and where stuff is put into by \"make install\". you do that (if you are a sysadmin), after assuring that \"make check\" passes...\n\nyes i know why SAGE_LOCAL exists, but it should be clear that it's not necessary and that it only has \"evolved\" that way. having simplified things in the past, now it is falling on your feet.\n\nnote how i tried to fix/work\\ around that in my attempt to autotoolize sage (both the library and the distribution)... my point: the best approach will be to *not use SAGE_LOCAL* at all. here's the chance to cleanup sagelib, as a start.\n\nthat said: keep up the good and interesting work @mkoeppe. i hope i will have some more time later this year ...",
    "created_at": "2016-09-14T10:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314995",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:23" align="right">comment:23</div>

> Let's keep $SAGE_LOCAL to be exactly the install directory and nothing else (*). 

this is part of the problem with the current "build system". SAGE_LOCAL is *not* the install directory. it is where stuff ends up during the build process.

outside sage, an install directory is typically what you pass to --prefix, and where stuff is put into by "make install". you do that (if you are a sysadmin), after assuring that "make check" passes...

yes i know why SAGE_LOCAL exists, but it should be clear that it's not necessary and that it only has "evolved" that way. having simplified things in the past, now it is falling on your feet.

note how i tried to fix/work\ around that in my attempt to autotoolize sage (both the library and the distribution)... my point: the best approach will be to *not use SAGE_LOCAL* at all. here's the chance to cleanup sagelib, as a start.

that said: keep up the good and interesting work @mkoeppe. i hope i will have some more time later this year ...



---

archive/issue_comments_314996.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@sagetrac-felixs](#comment:23):\n> this is part of the problem with the current \"build system\". SAGE_LOCAL is *not* the install directory.\n\nWhy do you think that `$SAGE_LOCAL` is **not** the install directory? It is the directory where everything is installed, which by definition makes it the install directory. The fact that Sage does not (yet) support `--prefix` doesn't change this fact.\n\n> the best approach will be to *not use SAGE_LOCAL* at all.\n\nI like to know why you think that.\n\n> that said: keep up the good and interesting work @mkoeppe. i hope i will have some more time later this year ...\n\nTo be clear: I didn't say that this branch needs to be thrown out. I am just saying: keep the build directory configurable but keep the default what it currently is.",
    "created_at": "2016-09-14T11:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314996",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@sagetrac-felixs](#comment:23):
> this is part of the problem with the current "build system". SAGE_LOCAL is *not* the install directory.

Why do you think that `$SAGE_LOCAL` is **not** the install directory? It is the directory where everything is installed, which by definition makes it the install directory. The fact that Sage does not (yet) support `--prefix` doesn't change this fact.

> the best approach will be to *not use SAGE_LOCAL* at all.

I like to know why you think that.

> that said: keep up the good and interesting work @mkoeppe. i hope i will have some more time later this year ...

To be clear: I didn't say that this branch needs to be thrown out. I am just saying: keep the build directory configurable but keep the default what it currently is.



---

archive/issue_comments_314997.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n> Why do you think that $SAGE_LOCAL is not the install directory?\n\nyou wrote it. \"--prefix\" is not implemented/supported. (but it should be). there's no way to really \"install\" stuff in the usual sense. e.g., there is no way to *install stuff after make check has passed*. (i don't know if toplevel make check is currently implemented at all, just a thought).\n\n> where everything is installed, which by definition makes it the install directory\n\nactually nothing gets installed. what is done is mostly overhead. working around the fact that some packages don't work right after the build alone. when i was done with the \"package content lists\" for spkg-install, i noticed that it was a huge waste of time... don't repeat that, better just skip the \"install\" step.\n\n> I like to know why you think that [SAGE_LOCAL should not be used].\n\nevery instance/use of SAGE_LOCAL breaks sagelib on (lets call it) foreign distros a bit. that's not helpful. it will as well interfere with any attempt on rewriting sage-the-distribution (be it autotools based, or pip or ebuild). the autotools approach (not a necessary step, but an example) provides a transition path to anything...\n\nsage-the-distribution is a platform for sage (core) development. no more, no less. other platforms will come and go. what is needed is sagelib without the dependency on this (and on SAGE_LOCAL). why: because developers should be able to use sagelib and develop sage extensions on *their own platforms*, with *their own* tools and *their own* review policies.\n\nso: please embrace contributions that reduce the use of SAGE_LOCAL.\n\n(yes, its getting off-topic. but i hope, this answers the question.)",
    "created_at": "2016-09-14T12:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314997",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:25" align="right">comment:25</div>

> Why do you think that $SAGE_LOCAL is not the install directory?

you wrote it. "--prefix" is not implemented/supported. (but it should be). there's no way to really "install" stuff in the usual sense. e.g., there is no way to *install stuff after make check has passed*. (i don't know if toplevel make check is currently implemented at all, just a thought).

> where everything is installed, which by definition makes it the install directory

actually nothing gets installed. what is done is mostly overhead. working around the fact that some packages don't work right after the build alone. when i was done with the "package content lists" for spkg-install, i noticed that it was a huge waste of time... don't repeat that, better just skip the "install" step.

> I like to know why you think that [SAGE_LOCAL should not be used].

every instance/use of SAGE_LOCAL breaks sagelib on (lets call it) foreign distros a bit. that's not helpful. it will as well interfere with any attempt on rewriting sage-the-distribution (be it autotools based, or pip or ebuild). the autotools approach (not a necessary step, but an example) provides a transition path to anything...

sage-the-distribution is a platform for sage (core) development. no more, no less. other platforms will come and go. what is needed is sagelib without the dependency on this (and on SAGE_LOCAL). why: because developers should be able to use sagelib and develop sage extensions on *their own platforms*, with *their own* tools and *their own* review policies.

so: please embrace contributions that reduce the use of SAGE_LOCAL.

(yes, its getting off-topic. but i hope, this answers the question.)



---

archive/issue_comments_314998.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment:22):\n> Thinking about it more, I disagree with building in `$SAGE_BUILD_DIR/sagelib` by default.\n> \n> `$SAGE_LOCAL` (which contains `$SAGE_BUILD_DIR`) is meant as *install* directory, not as *build* directory.\n> \n> Let's keep `$SAGE_LOCAL` to be exactly the install directory and nothing else (*).\n\nI agree with you; see #21479.",
    "created_at": "2016-09-14T15:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314998",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment:22):
> Thinking about it more, I disagree with building in `$SAGE_BUILD_DIR/sagelib` by default.
> 
> `$SAGE_LOCAL` (which contains `$SAGE_BUILD_DIR`) is meant as *install* directory, not as *build* directory.
> 
> Let's keep `$SAGE_LOCAL` to be exactly the install directory and nothing else (*).

I agree with you; see #21479.



---

archive/issue_comments_314999.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@sagetrac-felixs](#comment:23):\n> outside sage, an install directory is typically what you pass to --prefix, and where stuff is put into by \"make install\". you do that (if you are a sysadmin), after assuring that \"make check\" passes...\n\nSee #21479 for a discussion of `--prefix` and `make` vs. `make install`.\n\nBut let's keep the discussion of the present ticket focused on the task at hand.",
    "created_at": "2016-09-14T15:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-314999",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@sagetrac-felixs](#comment:23):
> outside sage, an install directory is typically what you pass to --prefix, and where stuff is put into by "make install". you do that (if you are a sysadmin), after assuring that "make check" passes...

See #21479 for a discussion of `--prefix` and `make` vs. `make install`.

But let's keep the discussion of the present ticket focused on the task at hand.



---

archive/issue_comments_315000.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment:22):\n> I *do* agree with making the build directory configurable for `VPATH` builds. For typical packages however, if you do not do a `VPATH` build, the build directory is the same as the source directory. Sage should follow the same model. This means that the build directory should be `$SAGE_SRC` *by default*.\n\nI agree on this as well. #21469 (VPATH for distro) will do that.\n\nIn this ticket, I first want to make the `--build-base` work. In particular, get rid of SAGE_CYTHONIZED.\n\nThis also works towards the eventual goal of making 'sagelib' pip-installable.\n\nThe actual location used is a detail that will be easy to change later.\n\n>  (*) One could argue that `$SAGE_BUILD_DIR` is currently used as build directory for packages. That is true, but they are only used temporarily, they are not meant to actually store stuff. So this isn't so bad.\n\nYes, the current patch follows this practice. But this is temporary until #21469 is done.",
    "created_at": "2016-09-14T15:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315000",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment:22):
> I *do* agree with making the build directory configurable for `VPATH` builds. For typical packages however, if you do not do a `VPATH` build, the build directory is the same as the source directory. Sage should follow the same model. This means that the build directory should be `$SAGE_SRC` *by default*.

I agree on this as well. #21469 (VPATH for distro) will do that.

In this ticket, I first want to make the `--build-base` work. In particular, get rid of SAGE_CYTHONIZED.

This also works towards the eventual goal of making 'sagelib' pip-installable.

The actual location used is a detail that will be easy to change later.

>  (*) One could argue that `$SAGE_BUILD_DIR` is currently used as build directory for packages. That is true, but they are only used temporarily, they are not meant to actually store stuff. So this isn't so bad.

Yes, the current patch follows this practice. But this is temporary until #21469 is done.



---

archive/issue_comments_315001.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@sagetrac-felixs](#comment:25):\n> > Why do you think that $SAGE_LOCAL is not the install directory?\n\n> \n> you wrote it. \"--prefix\" is not implemented/supported.\n\nThe fact that the installation process does not implement `./configure --prefix` does not mean that it's not an installation process...\n\n> every instance/use of SAGE_LOCAL breaks sagelib\n\nBut why? \n\nOf course, it's all a matter of definition. I consider the process of copying files to `$SAGE_LOCAL` an \"installation\" and you do not (for reasons which are still unclear to me). I think things will become much simpler for you if you accept the fact that `$SAGE_LOCAL` is the installation directory and that copying files to `$SAGE_LOCAL` is an installation.\n\n> but i hope, this answers the question\n\nI absolutely does not. You are just saying \"it breaks stuff\" but not explaining *why*.",
    "created_at": "2016-09-14T17:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315001",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@sagetrac-felixs](#comment:25):
> > Why do you think that $SAGE_LOCAL is not the install directory?

> 
> you wrote it. "--prefix" is not implemented/supported.

The fact that the installation process does not implement `./configure --prefix` does not mean that it's not an installation process...

> every instance/use of SAGE_LOCAL breaks sagelib

But why? 

Of course, it's all a matter of definition. I consider the process of copying files to `$SAGE_LOCAL` an "installation" and you do not (for reasons which are still unclear to me). I think things will become much simpler for you if you accept the fact that `$SAGE_LOCAL` is the installation directory and that copying files to `$SAGE_LOCAL` is an installation.

> but i hope, this answers the question

I absolutely does not. You are just saying "it breaks stuff" but not explaining *why*.



---

archive/issue_comments_315002.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:29):\n> Replying to [@sagetrac-felixs](#comment:25):\n\n[...] \n> > but i hope, this answers the question\n\n> \n> I absolutely does not. You are just saying \"it breaks stuff\" but not explaining *why*.\n\nOne reason *why* is that in many deployment scenarios  you will want to test what you have built before installing it. And Sage does not support this.",
    "created_at": "2016-09-14T19:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315002",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:29):
> Replying to [@sagetrac-felixs](#comment:25):

[...] 
> > but i hope, this answers the question

> 
> I absolutely does not. You are just saying "it breaks stuff" but not explaining *why*.

One reason *why* is that in many deployment scenarios  you will want to test what you have built before installing it. And Sage does not support this.



---

archive/issue_comments_315003.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nindeed. in \"build\"-\"check\"-\"install\" there is not much room for definitions of \"build\" and \"install\".\n\nthis is drifting towards the question of whether or not sage should stick to common practices and terminology. you know i think it should.\n\napologies for being off-topic again, this may be more related to #15105 -- there is no ticket for just \"practices and terminology\".",
    "created_at": "2016-09-14T20:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315003",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:31" align="right">comment:31</div>

indeed. in "build"-"check"-"install" there is not much room for definitions of "build" and "install".

this is drifting towards the question of whether or not sage should stick to common practices and terminology. you know i think it should.

apologies for being off-topic again, this may be more related to #15105 -- there is no ticket for just "practices and terminology".



---

archive/issue_comments_315004.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@dimpase](#comment:30):\n> One reason why is that in many deployment scenarios you will want to test what you have built before installing it. And Sage does not support this.\n\nHow does this relate to the existence of `$SAGE_LOCAL`?",
    "created_at": "2016-09-14T20:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315004",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@dimpase](#comment:30):
> One reason why is that in many deployment scenarios you will want to test what you have built before installing it. And Sage does not support this.

How does this relate to the existence of `$SAGE_LOCAL`?



---

archive/issue_comments_315005.json:
```json
{
    "body": "Changed commit from **[`a73fa06`](https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f)** to **[`a854831`](https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391)**",
    "created_at": "2016-09-14T21:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a73fa06`](https://github.com/sagemath/sagetrac-mirror/commit/a73fa065f5030c3b260c04a7e36867fd7f89362f)** to **[`a854831`](https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391)**



---

archive/issue_comments_315006.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391\"><code>a854831</code></a></td><td><code>Put setup.sh in charge of all sagelib building</code></td></tr></table>\n",
    "created_at": "2016-09-14T21:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315006",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391"><code>a854831</code></a></td><td><code>Put setup.sh in charge of all sagelib building</code></td></tr></table>




---

archive/issue_comments_315007.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@sagetrac-felixs](#comment:31):\n> this is drifting towards the question of whether or not sage should stick to common practices and terminology. you know i think it should.\n\nIf those \"common\" practices and terminology make sense, of course it should.\n\nAnyway, I am completely not following what you are trying to say. I feel that you are always wandering around my questions instead of answering them.",
    "created_at": "2016-09-14T21:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315007",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@sagetrac-felixs](#comment:31):
> this is drifting towards the question of whether or not sage should stick to common practices and terminology. you know i think it should.

If those "common" practices and terminology make sense, of course it should.

Anyway, I am completely not following what you are trying to say. I feel that you are always wandering around my questions instead of answering them.



---

archive/issue_comments_315008.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI have created #21495 as a place for such discussions.",
    "created_at": "2016-09-14T21:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315008",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

I have created #21495 as a place for such discussions.



---

archive/issue_comments_315009.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n \n (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)\n \n+As a second goal of this ticket, `setup.sh` is put in charge of ALL sagelib building. \n+\n Some possibly useful information:\n - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n``````\n",
    "created_at": "2016-09-14T21:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315009",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,8 @@
 
 (`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)
 
+As a second goal of this ticket, `setup.sh` is put in charge of ALL sagelib building. 
+
 Some possibly useful information:
 - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
 - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
``````




---

archive/issue_comments_315010.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment:32):\n> Replying to [@dimpase](#comment:30):\n> > One reason why is that in many deployment scenarios you will want to test what you have built before installing it. And Sage does not support this.\n\n> \n> How does this relate to the existence of `$SAGE_LOCAL`?\n\n`$SAGE_LOCAL` is fine as long as you can also install things from there somewhere else. Currently you cannot do this in a proper way (yes, you can certainly create symbolic links etc, but this is often not enough).",
    "created_at": "2016-09-14T21:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315010",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment:32):
> Replying to [@dimpase](#comment:30):
> > One reason why is that in many deployment scenarios you will want to test what you have built before installing it. And Sage does not support this.

> 
> How does this relate to the existence of `$SAGE_LOCAL`?

`$SAGE_LOCAL` is fine as long as you can also install things from there somewhere else. Currently you cannot do this in a proper way (yes, you can certainly create symbolic links etc, but this is often not enough).



---

archive/issue_comments_315011.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@dimpase](#comment:37):\n> `$SAGE_LOCAL` is fine as long as you can also install things from there somewhere else. Currently you cannot do this in a proper way\n\nOf course you can:\n\n```\n$ cd $package_source\n$ sage --sh\n$ ./configure --prefix=\"$SAGE_LOCAL\"\n$ make install\n```\n\nI have done this many times as first step of testing a new package or a package upgrade.",
    "created_at": "2016-09-15T05:19:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315011",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@dimpase](#comment:37):
> `$SAGE_LOCAL` is fine as long as you can also install things from there somewhere else. Currently you cannot do this in a proper way

Of course you can:

```
$ cd $package_source
$ sage --sh
$ ./configure --prefix="$SAGE_LOCAL"
$ make install
```

I have done this many times as first step of testing a new package or a package upgrade.



---

archive/issue_comments_315012.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nIf I understand Dima correctly, he wants to install \"from\" $SAGE_LOCAL, not \"to\" $SAGE_LOCAL.\n\nBut really this discussion should go to #21495. \nThanks!",
    "created_at": "2016-09-15T05:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315012",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

If I understand Dima correctly, he wants to install "from" $SAGE_LOCAL, not "to" $SAGE_LOCAL.

But really this discussion should go to #21495. 
Thanks!



---

archive/issue_comments_315013.json:
```json
{
    "body": "Changed commit from **[`a854831`](https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391)** to **[`1a027d5`](https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca)**",
    "created_at": "2016-09-15T05:36:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315013",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a854831`](https://github.com/sagemath/sagetrac-mirror/commit/a854831e3274b69eadc52eb4642b8c0bd221a391)** to **[`1a027d5`](https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca)**



---

archive/issue_comments_315014.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca\"><code>1a027d5</code></a></td><td><code>Have setup.sh derive SAGE_CYTHONIZED from --build-base</code></td></tr></table>\n",
    "created_at": "2016-09-15T05:36:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315014",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca"><code>1a027d5</code></a></td><td><code>Have setup.sh derive SAGE_CYTHONIZED from --build-base</code></td></tr></table>




---

archive/issue_events_299089.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-15T05:37:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299089"
}
```



---

archive/issue_events_299090.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-15T05:37:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299090"
}
```



---

archive/issue_comments_315015.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nJeroen, how does this look to you now?\n(I haven't changed $SAGE_BUILD_DIR yet, but will in a moment.)",
    "created_at": "2016-09-15T05:37:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315015",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

Jeroen, how does this look to you now?
(I haven't changed $SAGE_BUILD_DIR yet, but will in a moment.)



---

archive/issue_comments_315016.json:
```json
{
    "body": "Changed commit from **[`1a027d5`](https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca)** to **[`f6555ce`](https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc)**",
    "created_at": "2016-09-15T06:04:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315016",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1a027d5`](https://github.com/sagemath/sagetrac-mirror/commit/1a027d5d535f4dbf7314479e8c6905ad8af34bca)** to **[`f6555ce`](https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc)**



---

archive/issue_comments_315017.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc\"><code>f6555ce</code></a></td><td><code>Fix last change - handle --build-base earlier</code></td></tr></table>\n",
    "created_at": "2016-09-15T06:04:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc"><code>f6555ce</code></a></td><td><code>Fix last change - handle --build-base earlier</code></td></tr></table>




---

archive/issue_comments_315018.json:
```json
{
    "body": "Changed commit from **[`f6555ce`](https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc)** to **[`d829eb4`](https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52)**",
    "created_at": "2016-09-15T18:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315018",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6555ce`](https://github.com/sagemath/sagetrac-mirror/commit/f6555cea1f1695c99a9011ba13bd64c6995d17fc)** to **[`d829eb4`](https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52)**



---

archive/issue_comments_315019.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/853a1aa4ae8a8e4882ddeb047fa7686b8ae84326\"><code>853a1aa</code></a></td><td><code>Make src/Makefile a generated file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1931b43c27e0b536eb2c4bf7f075b32b56fa3604\"><code>1931b43</code></a></td><td><code>Define SAGE_PKGS in sage.env, not sage.misc.package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1dc4f8273a4083f7ee28b14aeccb94d385b9a4c\"><code>c1dc4f8</code></a></td><td><code>Set SAGE_CYTHONIZED earlier</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52\"><code>d829eb4</code></a></td><td><code>Build in $(abs_builddir)/build-sagelib. Poison directory env variables</code></td></tr></table>\n",
    "created_at": "2016-09-15T18:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315019",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/853a1aa4ae8a8e4882ddeb047fa7686b8ae84326"><code>853a1aa</code></a></td><td><code>Make src/Makefile a generated file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1931b43c27e0b536eb2c4bf7f075b32b56fa3604"><code>1931b43</code></a></td><td><code>Define SAGE_PKGS in sage.env, not sage.misc.package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1dc4f8273a4083f7ee28b14aeccb94d385b9a4c"><code>c1dc4f8</code></a></td><td><code>Set SAGE_CYTHONIZED earlier</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52"><code>d829eb4</code></a></td><td><code>Build in $(abs_builddir)/build-sagelib. Poison directory env variables</code></td></tr></table>




---

archive/issue_events_299091.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-15T18:44:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "title_is": "Make sagelib setup.sh self-contained, independent of SAGE_ROOT, and handle --build-base",
    "title_was": "Keep src/ clean by using --build-base when building sagelib",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299091"
}
```



---

archive/issue_comments_315020.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI've changed the description of this ticket, as it has changed its focus. \nReady for review.",
    "created_at": "2016-09-15T18:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315020",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

I've changed the description of this ticket, as it has changed its focus. 
Ready for review.



---

archive/issue_comments_315021.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,14 @@\n-Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. \n+This ticket changes the build process of sagelib in the following way:\n+- `src/Makefile` delegates ALL building to `src/setup.sh`\n+- `src/setup.sh` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n+- `src/setup.sh` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).\n+- `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).\n \n-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib`\n+This ticket is meant as:\n+- preparation for VPATH builds of sage-the-distribution (#21469)\n+- working towards the goal of making `sagelib` pip-installable \n \n-(`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)\n-\n-As a second goal of this ticket, `setup.sh` is put in charge of ALL sagelib building. \n+. . . . . . . \n \n Some possibly useful information:\n - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n``````\n",
    "created_at": "2016-09-15T18:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315021",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,14 @@
-Currently, building sagelib creates the `src/build` directory, with subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME`. 
+This ticket changes the build process of sagelib in the following way:
+- `src/Makefile` delegates ALL building to `src/setup.sh`
+- `src/setup.sh` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
+- `src/setup.sh` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).
+- `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).
 
-In preparation for VPATH builds of sage-the-distribution (#21469), let's keep `src/` clean by using `setup.py --build-base=$SAGE_BUILD_DIR/sagelib`
+This ticket is meant as:
+- preparation for VPATH builds of sage-the-distribution (#21469)
+- working towards the goal of making `sagelib` pip-installable 
 
-(`$SAGE_BUILD_DIR` defaults to `$SAGE_ROOT/var/tmp/sage/build/`)
-
-As a second goal of this ticket, `setup.sh` is put in charge of ALL sagelib building. 
+. . . . . . . 
 
 Some possibly useful information:
 - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
``````




---

archive/issue_comments_315022.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57db699e6f7880e0bf1ead47c1ac4e5f9677f10d\"><code>57db699</code></a></td><td><code>Revert \"Make SAGE_BUILD_DIR variable available in sage-env, not just in sage-spkg\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34\"><code>ef0919c</code></a></td><td><code>Fixup for SAGE_CYTHONIZED</code></td></tr></table>\n",
    "created_at": "2016-09-15T18:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315022",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57db699e6f7880e0bf1ead47c1ac4e5f9677f10d"><code>57db699</code></a></td><td><code>Revert "Make SAGE_BUILD_DIR variable available in sage-env, not just in sage-spkg"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34"><code>ef0919c</code></a></td><td><code>Fixup for SAGE_CYTHONIZED</code></td></tr></table>




---

archive/issue_comments_315023.json:
```json
{
    "body": "Changed commit from **[`d829eb4`](https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52)** to **[`ef0919c`](https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34)**",
    "created_at": "2016-09-15T18:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315023",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d829eb4`](https://github.com/sagemath/sagetrac-mirror/commit/d829eb435729cf3280a5206d005bffef8e1dfd52)** to **[`ef0919c`](https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34)**



---

archive/issue_comments_315024.json:
```json
{
    "body": "Changed commit from **[`ef0919c`](https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34)** to **[`bd670af`](https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc)**",
    "created_at": "2016-09-15T19:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315024",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ef0919c`](https://github.com/sagemath/sagetrac-mirror/commit/ef0919c1bc7d7182d79ae725c97ce057b8336d34)** to **[`bd670af`](https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc)**



---

archive/issue_comments_315025.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ccd4404feb6a610bc0b2f816ae74f38178d065d\"><code>8ccd440</code></a></td><td><code>Add src/generate_py_source.mk</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc\"><code>bd670af</code></a></td><td><code>Ignore generated files</code></td></tr></table>\n",
    "created_at": "2016-09-15T19:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ccd4404feb6a610bc0b2f816ae74f38178d065d"><code>8ccd440</code></a></td><td><code>Add src/generate_py_source.mk</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc"><code>bd670af</code></a></td><td><code>Ignore generated files</code></td></tr></table>




---

archive/issue_comments_315026.json:
```json
{
    "body": "Changed commit from **[`bd670af`](https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc)** to **[`751bd0f`](https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba)**",
    "created_at": "2016-09-15T19:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315026",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bd670af`](https://github.com/sagemath/sagetrac-mirror/commit/bd670afd3c7510113b686a9b1545873bda5165dc)** to **[`751bd0f`](https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba)**



---

archive/issue_comments_315027.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba\"><code>751bd0f</code></a></td><td><code>Reword TODO item</code></td></tr></table>\n",
    "created_at": "2016-09-15T19:06:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315027",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba"><code>751bd0f</code></a></td><td><code>Reword TODO item</code></td></tr></table>




---

archive/issue_events_299092.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-16T08:19:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "title_is": "Make sagelib setup.py self-contained, independent of SAGE_ROOT, and handle --build-base",
    "title_was": "Make sagelib setup.sh self-contained, independent of SAGE_ROOT, and handle --build-base",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299092"
}
```



---

archive/issue_comments_315028.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n This ticket changes the build process of sagelib in the following way:\n-- `src/Makefile` delegates ALL building to `src/setup.sh`\n-- `src/setup.sh` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n-- `src/setup.sh` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).\n+- `src/Makefile` delegates ALL building to `src/setup.py`\n+- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n+- `src/setup.py` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).\n - `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).\n \n This ticket is meant as:\n``````\n",
    "created_at": "2016-09-16T08:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315028",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 This ticket changes the build process of sagelib in the following way:
-- `src/Makefile` delegates ALL building to `src/setup.sh`
-- `src/setup.sh` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
-- `src/setup.sh` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).
+- `src/Makefile` delegates ALL building to `src/setup.py`
+- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
+- `src/setup.py` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).
 - `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).
 
 This ticket is meant as:
``````




---

archive/issue_comments_315029.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI would prefer to do this ticket after #21479 because there might be non-trivial interactions.",
    "created_at": "2016-09-16T08:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315029",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

I would prefer to do this ticket after #21479 because there might be non-trivial interactions.



---

archive/issue_comments_315030.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAlso in the code `setup.sh` -> `setup.py`",
    "created_at": "2016-09-16T08:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315030",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Also in the code `setup.sh` -> `setup.py`



---

archive/issue_events_299093.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-16T08:21:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299093"
}
```



---

archive/issue_events_299094.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-16T08:21:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299094"
}
```



---

archive/issue_comments_315031.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nRegarding\n\n```\n(cd $(srcdir) && export SAGE_ROOT=/doesnotexist SAGE_SRC=/doesnotexist SAGE_SRC_ROOT=/doesnotexist SAGE_DOC_SRC=/doesnotexist SAGE_SCRIPTS_DIR=/doesnotexist SAGE_BUILD_DIR=/doesnotexist SAGE_CYTHONIZED=/doesnotexist SAGE_PKGS=$(abs_top_srcdir)/build/pkgs && python -u setup.py build --build-base=$(abs_builddir)/build-sagelib install)\n```\n\nDid you know that `make` supports backslash-continued lines? :-)",
    "created_at": "2016-09-16T08:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315031",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

Regarding

```
(cd $(srcdir) && export SAGE_ROOT=/doesnotexist SAGE_SRC=/doesnotexist SAGE_SRC_ROOT=/doesnotexist SAGE_DOC_SRC=/doesnotexist SAGE_SCRIPTS_DIR=/doesnotexist SAGE_BUILD_DIR=/doesnotexist SAGE_CYTHONIZED=/doesnotexist SAGE_PKGS=$(abs_top_srcdir)/build/pkgs && python -u setup.py build --build-base=$(abs_builddir)/build-sagelib install)
```

Did you know that `make` supports backslash-continued lines? :-)



---

archive/issue_comments_315032.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nFor backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?",
    "created_at": "2016-09-16T08:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315032",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

For backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?



---

archive/issue_comments_315033.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nWhat is the rationale for splitting the `Makefile` in two (`Makefile` and `generate_py_source.mk`)? That seems like additional complication without reason.\n\nIn any case, using `make` is wrong. You need to use `os.environ[\"MAKE\"]`.",
    "created_at": "2016-09-16T08:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

What is the rationale for splitting the `Makefile` in two (`Makefile` and `generate_py_source.mk`)? That seems like additional complication without reason.

In any case, using `make` is wrong. You need to use `os.environ["MAKE"]`.



---

archive/issue_comments_315034.json:
```json
{
    "body": "Changed commit from **[`751bd0f`](https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba)** to **[`3a8cc0e`](https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28)**",
    "created_at": "2016-09-16T08:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315034",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`751bd0f`](https://github.com/sagemath/sagetrac-mirror/commit/751bd0fbde10aa234867122308c7bb76673cbaba)** to **[`3a8cc0e`](https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28)**



---

archive/issue_comments_315035.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28\"><code>3a8cc0e</code></a></td><td><code>Fix typo in comment</code></td></tr></table>\n",
    "created_at": "2016-09-16T08:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315035",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28"><code>3a8cc0e</code></a></td><td><code>Fix typo in comment</code></td></tr></table>




---

archive/issue_comments_315036.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@jdemeyer](#comment:54):\n> For backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?\n\nIf I keep the default, it's hard to demonstrate that \"--build-base\" actually works.\n\nMoreover, there are too many things already called \"build\" -- better be specific.",
    "created_at": "2016-09-16T08:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315036",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@jdemeyer](#comment:54):
> For backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?

If I keep the default, it's hard to demonstrate that "--build-base" actually works.

Moreover, there are too many things already called "build" -- better be specific.



---

archive/issue_comments_315037.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@jdemeyer](#comment:55):\n> What is the rationale for splitting the `Makefile` in two (`Makefile` and `generate_py_source.mk`)? That seems like additional complication without reason.\n\n`setup.sh` needs to be in charge of building everything, if sagelib is to become a well-behaved Python package.",
    "created_at": "2016-09-16T08:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315037",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@jdemeyer](#comment:55):
> What is the rationale for splitting the `Makefile` in two (`Makefile` and `generate_py_source.mk`)? That seems like additional complication without reason.

`setup.sh` needs to be in charge of building everything, if sagelib is to become a well-behaved Python package.



---

archive/issue_comments_315038.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\n`generate_py_source.mk` could certainly be implemented in pure Python and could become a part of `setup.py`. But I don't want to work on this.",
    "created_at": "2016-09-16T08:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315038",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

`generate_py_source.mk` could certainly be implemented in pure Python and could become a part of `setup.py`. But I don't want to work on this.



---

archive/issue_comments_315039.json:
```json
{
    "body": "Changed commit from **[`3a8cc0e`](https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28)** to **[`0dd9c50`](https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97)**",
    "created_at": "2016-09-16T09:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315039",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3a8cc0e`](https://github.com/sagemath/sagetrac-mirror/commit/3a8cc0e1bc0c09142275a7ea6b03775e83d73e28)** to **[`0dd9c50`](https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97)**



---

archive/issue_comments_315040.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97\"><code>0dd9c50</code></a></td><td><code>Respect environment variable MAKE</code></td></tr></table>\n",
    "created_at": "2016-09-16T09:02:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315040",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97"><code>0dd9c50</code></a></td><td><code>Respect environment variable MAKE</code></td></tr></table>




---

archive/issue_comments_315041.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824\"><code>17f90d8</code></a></td><td><code>beautification</code></td></tr></table>\n",
    "created_at": "2016-09-16T09:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315041",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824"><code>17f90d8</code></a></td><td><code>beautification</code></td></tr></table>




---

archive/issue_comments_315042.json:
```json
{
    "body": "Changed commit from **[`0dd9c50`](https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97)** to **[`17f90d8`](https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824)**",
    "created_at": "2016-09-16T09:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315042",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0dd9c50`](https://github.com/sagemath/sagetrac-mirror/commit/0dd9c50021302e4d8cfc6f95e8bbdea232c60b97)** to **[`17f90d8`](https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824)**



---

archive/issue_comments_315043.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@mkoeppe](#comment:57):\n> Replying to [@jdemeyer](#comment:54):\n> > For backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?\n\n> \n> If I keep the default, it's hard to demonstrate that \"--build-base\" actually works.\n\nWell, it's easy for the reviewer to test a different value of `--build-base`.\n\n> Moreover, there are too many things already called \"build\" -- better be specific.\n\nBut `src/build` is pretty clear: it is the build directory corresponding to `src`, which is the Sage library. I don't like to change it just for the sake of changing it.",
    "created_at": "2016-09-16T09:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315043",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@mkoeppe](#comment:57):
> Replying to [@jdemeyer](#comment:54):
> > For backwards compatibility, can we please keep the name `build` instead of changing it to `build-sagelib`?

> 
> If I keep the default, it's hard to demonstrate that "--build-base" actually works.

Well, it's easy for the reviewer to test a different value of `--build-base`.

> Moreover, there are too many things already called "build" -- better be specific.

But `src/build` is pretty clear: it is the build directory corresponding to `src`, which is the Sage library. I don't like to change it just for the sake of changing it.



---

archive/issue_comments_315044.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@mkoeppe](#comment:59):\n> `generate_py_source.mk` could certainly be implemented in pure Python and could become a part of `setup.py`\n\nThat doesn't answer my question. Why do you not keep this in `src/Makefile`?",
    "created_at": "2016-09-16T09:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315044",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@mkoeppe](#comment:59):
> `generate_py_source.mk` could certainly be implemented in pure Python and could become a part of `setup.py`

That doesn't answer my question. Why do you not keep this in `src/Makefile`?



---

archive/issue_comments_315045.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@mkoeppe](#comment:58):\n> `setup.sh` needs to be in charge of building everything, if sagelib is to become a well-behaved Python package.\n\nSorry, I didn't see this comment. Okay, that makes sense but it wasn't clear to me,\n\nI guess you should add some comments to `src/Makefile` to explain this better than just\n\n```\n## All sagelib-building is done by setup.py.\n## DON'T ADD ADDITIONAL STEPS TO THIS MAKEFILE.\n```",
    "created_at": "2016-09-16T09:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315045",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@mkoeppe](#comment:58):
> `setup.sh` needs to be in charge of building everything, if sagelib is to become a well-behaved Python package.

Sorry, I didn't see this comment. Okay, that makes sense but it wasn't clear to me,

I guess you should add some comments to `src/Makefile` to explain this better than just

```
## All sagelib-building is done by setup.py.
## DON'T ADD ADDITIONAL STEPS TO THIS MAKEFILE.
```



---

archive/issue_comments_315046.json:
```json
{
    "body": "Changed commit from **[`17f90d8`](https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824)** to **[`e5f9065`](https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5)**",
    "created_at": "2016-09-16T09:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315046",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17f90d8`](https://github.com/sagemath/sagetrac-mirror/commit/17f90d8d1e8b35f9ae08bb98bb876083ba968824)** to **[`e5f9065`](https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5)**



---

archive/issue_comments_315047.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5\"><code>e5f9065</code></a></td><td><code>More comments</code></td></tr></table>\n",
    "created_at": "2016-09-16T09:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315047",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5"><code>e5f9065</code></a></td><td><code>More comments</code></td></tr></table>




---

archive/issue_comments_315048.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@jdemeyer](#comment:51):\n> I would prefer to do this ticket after #21479 because there might be non-trivial interactions.\n\nOr at least I will test it with #21501 applied.",
    "created_at": "2016-09-16T09:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315048",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@jdemeyer](#comment:51):
> I would prefer to do this ticket after #21479 because there might be non-trivial interactions.

Or at least I will test it with #21501 applied.



---

archive/issue_comments_315049.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nOK, I'll have #21479 ready in a few days.",
    "created_at": "2016-09-16T10:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315049",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

OK, I'll have #21479 ready in a few days.



---

archive/issue_comments_315050.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI just tested this with #21501. It mostly works but there are these two doctest failures:\n\n```\nsage -t src/sage_setup/find.py\n**********************************************************************\nFile \"src/sage_setup/find.py\", line 107, in sage_setup.find.find_extra_files\nFailed example:\n    find_extra_files([\"sage.modular.arithgroup\"], SAGE_SRC, SAGE_CYTHONIZED, \".\")\nExpected:\n    [('./sage/modular/arithgroup',\n      ['.../src/sage/modular/arithgroup/farey.pxd', ...farey_symbol.h...])]\nGot:\n    [('./sage/modular/arithgroup',\n      ['/usr/local/src/sage-config/src/sage/modular/arithgroup/farey.pxd'])]\n**********************************************************************\nFile \"src/sage_setup/clean.py\", line 87, in sage_setup.clean._find_stale_files\nFailed example:\n    for f in stale_iter:\n        if f.endswith(skip_extensions): continue\n        print('Found stale file: ' + f)\nExpected nothing\nGot:\n    Found stale file: sage/stats/distributions/dgs_gauss.h\n    Found stale file: sage/libs/lcalc/lcalc_sage.h\n    Found stale file: sage/geometry/triangulation/data.h\n    Found stale file: sage/misc/cython_metaclass.h\n    Found stale file: sage/rings/finite_rings/stdint.h\n    Found stale file: sage/stats/distributions/dgs_misc.h\n    Found stale file: sage/misc/darwin_memory_usage.h\n    Found stale file: sage/stats/distributions/dgs.h\n    Found stale file: sage/ext/python_debug.h\n    Found stale file: sage/libs/eclsig.h\n    Found stale file: sage/ext/solaris_fixes.h\n    Found stale file: sage/ext/pyx_visit.h\n    Found stale file: sage/matroids/minorfix.h\n    Found stale file: sage/modular/arithgroup/farey_symbol.h\n    Found stale file: sage/ext/mod_int.h\n    Found stale file: sage/combinat/matrices/dancing_links_c.h\n    Found stale file: sage/ext/interpreters/wrapper_rr.h\n    Found stale file: sage/symbolic/ginac_wrap.h\n    Found stale file: sage/ext/interpreters/wrapper_cdf.h\n    Found stale file: sage/ext/interpreters/wrapper_el.h\n    Found stale file: sage/groups/perm_gps/partn_ref2/refinement_generic.h\n    Found stale file: sage/libs/polybori/pb_wrap.h\n    Found stale file: sage/sat/solvers/cryptominisat/solverconf_helper.h\n    Found stale file: sage/combinat/partitions_c.h\n    Found stale file: sage/ext/ccobject.h\n    Found stale file: sage/geometry/triangulation/triangulations.h\n    Found stale file: sage/libs/ntl/ntlwrap.h\n    Found stale file: sage/stats/distributions/dgs_bern.h\n    Found stale file: sage/sat/solvers/cryptominisat/cryptominisat_helper.h\n    Found stale file: sage/libs/pari/parisage.h\n    Found stale file: sage/geometry/triangulation/functions.h\n**********************************************************************\n```",
    "created_at": "2016-09-16T11:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315050",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

I just tested this with #21501. It mostly works but there are these two doctest failures:

```
sage -t src/sage_setup/find.py
**********************************************************************
File "src/sage_setup/find.py", line 107, in sage_setup.find.find_extra_files
Failed example:
    find_extra_files(["sage.modular.arithgroup"], SAGE_SRC, SAGE_CYTHONIZED, ".")
Expected:
    [('./sage/modular/arithgroup',
      ['.../src/sage/modular/arithgroup/farey.pxd', ...farey_symbol.h...])]
Got:
    [('./sage/modular/arithgroup',
      ['/usr/local/src/sage-config/src/sage/modular/arithgroup/farey.pxd'])]
**********************************************************************
File "src/sage_setup/clean.py", line 87, in sage_setup.clean._find_stale_files
Failed example:
    for f in stale_iter:
        if f.endswith(skip_extensions): continue
        print('Found stale file: ' + f)
Expected nothing
Got:
    Found stale file: sage/stats/distributions/dgs_gauss.h
    Found stale file: sage/libs/lcalc/lcalc_sage.h
    Found stale file: sage/geometry/triangulation/data.h
    Found stale file: sage/misc/cython_metaclass.h
    Found stale file: sage/rings/finite_rings/stdint.h
    Found stale file: sage/stats/distributions/dgs_misc.h
    Found stale file: sage/misc/darwin_memory_usage.h
    Found stale file: sage/stats/distributions/dgs.h
    Found stale file: sage/ext/python_debug.h
    Found stale file: sage/libs/eclsig.h
    Found stale file: sage/ext/solaris_fixes.h
    Found stale file: sage/ext/pyx_visit.h
    Found stale file: sage/matroids/minorfix.h
    Found stale file: sage/modular/arithgroup/farey_symbol.h
    Found stale file: sage/ext/mod_int.h
    Found stale file: sage/combinat/matrices/dancing_links_c.h
    Found stale file: sage/ext/interpreters/wrapper_rr.h
    Found stale file: sage/symbolic/ginac_wrap.h
    Found stale file: sage/ext/interpreters/wrapper_cdf.h
    Found stale file: sage/ext/interpreters/wrapper_el.h
    Found stale file: sage/groups/perm_gps/partn_ref2/refinement_generic.h
    Found stale file: sage/libs/polybori/pb_wrap.h
    Found stale file: sage/sat/solvers/cryptominisat/solverconf_helper.h
    Found stale file: sage/combinat/partitions_c.h
    Found stale file: sage/ext/ccobject.h
    Found stale file: sage/geometry/triangulation/triangulations.h
    Found stale file: sage/libs/ntl/ntlwrap.h
    Found stale file: sage/stats/distributions/dgs_bern.h
    Found stale file: sage/sat/solvers/cryptominisat/cryptominisat_helper.h
    Found stale file: sage/libs/pari/parisage.h
    Found stale file: sage/geometry/triangulation/functions.h
**********************************************************************
```



---

archive/issue_comments_315051.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nOne thing I don't like about the approach of this ticket is that `SAGE_CYTHONIZED` is set by the value of `--build-base`. I would much rather have it the other way around: that some environment variable is set by `configure` which is then used to define the value for `--build-base` and for the environment variable `SAGE_CYTHONIZED`.\n\nThis would be more analogous to #21501 where I want to set `$SAGE_LOCAL` just once and then derive everything from that.",
    "created_at": "2016-09-16T12:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315051",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:69" align="right">comment:69</div>

One thing I don't like about the approach of this ticket is that `SAGE_CYTHONIZED` is set by the value of `--build-base`. I would much rather have it the other way around: that some environment variable is set by `configure` which is then used to define the value for `--build-base` and for the environment variable `SAGE_CYTHONIZED`.

This would be more analogous to #21501 where I want to set `$SAGE_LOCAL` just once and then derive everything from that.



---

archive/issue_comments_315052.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,9 @@\n \n This ticket is meant as:\n - preparation for VPATH builds of sage-the-distribution (#21469)\n-- working towards the goal of making `sagelib` pip-installable \n+- working towards the goal of making `sagelib` pip-installable.\n+\n+ More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)\n \n . . . . . . . \n \n``````\n",
    "created_at": "2016-09-16T15:29:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315052",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,9 @@
 
 This ticket is meant as:
 - preparation for VPATH builds of sage-the-distribution (#21469)
-- working towards the goal of making `sagelib` pip-installable 
+- working towards the goal of making `sagelib` pip-installable.
+
+ More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)
 
 . . . . . . . 
 
``````




---

archive/issue_comments_315053.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@jdemeyer](#comment:69):\n> One thing I don't like about the approach of this ticket is that `SAGE_CYTHONIZED` is set by the value of `--build-base`. I would much rather have it the other way around: that some environment variable is set by `configure` which is then used to define the value for `--build-base` and for the environment variable `SAGE_CYTHONIZED`.\n> \n> This would be more analogous to #21501 where I want to set `$SAGE_LOCAL` just once and then derive everything from that.\n\nI've updated the description to explain better why --build-base needs to be in charge of setting all build directories.",
    "created_at": "2016-09-16T15:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315053",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@jdemeyer](#comment:69):
> One thing I don't like about the approach of this ticket is that `SAGE_CYTHONIZED` is set by the value of `--build-base`. I would much rather have it the other way around: that some environment variable is set by `configure` which is then used to define the value for `--build-base` and for the environment variable `SAGE_CYTHONIZED`.
> 
> This would be more analogous to #21501 where I want to set `$SAGE_LOCAL` just once and then derive everything from that.

I've updated the description to explain better why --build-base needs to be in charge of setting all build directories.



---

archive/issue_comments_315054.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nBut yes, I'll introduce something like `SAGE_SRC_BUILDBASE` that can be used in `src/Makefile.in` and to define `SAGE_CYTHONIZED` for that doctest.",
    "created_at": "2016-09-16T15:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315054",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:72" align="right">comment:72</div>

But yes, I'll introduce something like `SAGE_SRC_BUILDBASE` that can be used in `src/Makefile.in` and to define `SAGE_CYTHONIZED` for that doctest.



---

archive/issue_comments_315055.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@mkoeppe](#comment:71):\n> I've updated the description to explain better why --build-base needs to be in charge of setting all build directories.\n\nSorry, but the paragraph you added does not explain this. It explains better the **what** but not the **why**. This reminds me of what I recently said at [[#21469 comment:17](https://github.com/sagemath/sage/issues/21469#comment:17)]",
    "created_at": "2016-09-16T15:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315055",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@mkoeppe](#comment:71):
> I've updated the description to explain better why --build-base needs to be in charge of setting all build directories.

Sorry, but the paragraph you added does not explain this. It explains better the **what** but not the **why**. This reminds me of what I recently said at [[#21469 comment:17](https://github.com/sagemath/sage/issues/21469#comment:17)]



---

archive/issue_comments_315056.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@mkoeppe](#comment:72):\n> But yes, I'll introduce something like `SAGE_SRC_BUILDBASE` that can be used in `src/Makefile.in` and to define `SAGE_CYTHONIZED` for that doctest.\n\nNow I am even more lost...\n\nFirst you say that `--build-base` should determine everything but this comment seems to contradict that.",
    "created_at": "2016-09-16T15:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315056",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@mkoeppe](#comment:72):
> But yes, I'll introduce something like `SAGE_SRC_BUILDBASE` that can be used in `src/Makefile.in` and to define `SAGE_CYTHONIZED` for that doctest.

Now I am even more lost...

First you say that `--build-base` should determine everything but this comment seems to contradict that.



---

archive/issue_comments_315057.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n \n This ticket is meant as:\n - preparation for VPATH builds of sage-the-distribution (#21469)\n-- working towards the goal of making `sagelib` pip-installable.\n+- working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI\n \n  More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)\n \n``````\n",
    "created_at": "2016-09-16T16:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315057",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 
 This ticket is meant as:
 - preparation for VPATH builds of sage-the-distribution (#21469)
-- working towards the goal of making `sagelib` pip-installable.
+- working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI
 
  More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)
 
``````




---

archive/issue_comments_315058.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@jdemeyer](#comment:73):\n> Replying to [@mkoeppe](#comment:71):\n> > I've updated the description to explain better why --build-base needs to be in charge of setting all build directories.\n\n> \n> Sorry, but the paragraph you added does not explain this. It explains better the **what** but not the **why**. \n\nI've created ticket #21507 to put the technical goals of the present ticket in the context of a bigger goal. Please take a look.",
    "created_at": "2016-09-16T16:09:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315058",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@jdemeyer](#comment:73):
> Replying to [@mkoeppe](#comment:71):
> > I've updated the description to explain better why --build-base needs to be in charge of setting all build directories.

> 
> Sorry, but the paragraph you added does not explain this. It explains better the **what** but not the **why**. 

I've created ticket #21507 to put the technical goals of the present ticket in the context of a bigger goal. Please take a look.



---

archive/issue_comments_315059.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nFor this ticket, can you please keep `SAGE_CYTHONIZED` independent of `--build-base` (and set them both from the common environment variable you mention in [comment:72]). That will also solve the doctest failures from [comment:68].\n\nThe current code which figures out `SAGE_CYTHONIZED` from the command line is quite ugly and fragile. I think that we can do a bigger reorganization of `setup.py` which will make things simpler. Also Cython 0.25 (not released yet) has some potential to simplify cythonization.\n\nPS: I like the fact that you are splitting this up over many tickets, it gets things moving more quickly.",
    "created_at": "2016-09-16T17:13:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315059",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:77" align="right">comment:77</div>

For this ticket, can you please keep `SAGE_CYTHONIZED` independent of `--build-base` (and set them both from the common environment variable you mention in [comment:72]). That will also solve the doctest failures from [comment:68].

The current code which figures out `SAGE_CYTHONIZED` from the command line is quite ugly and fragile. I think that we can do a bigger reorganization of `setup.py` which will make things simpler. Also Cython 0.25 (not released yet) has some potential to simplify cythonization.

PS: I like the fact that you are splitting this up over many tickets, it gets things moving more quickly.



---

archive/issue_comments_315060.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@mkoeppe](#comment:67):\n> OK, I'll have #21479 ready in a few days.\n\nActually, maybe this doesn't really need to depend on #21479, since it doesn't involve `./configure`. If you address the points I made, then this might be good to go.",
    "created_at": "2016-09-16T17:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315060",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@mkoeppe](#comment:67):
> OK, I'll have #21479 ready in a few days.

Actually, maybe this doesn't really need to depend on #21479, since it doesn't involve `./configure`. If you address the points I made, then this might be good to go.



---

archive/issue_comments_315061.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [@jdemeyer](#comment:77):\n> For this ticket, can you please keep `SAGE_CYTHONIZED` independent of `--build-base` (and set them both from the common environment variable you mention in [comment:72]). That will also solve the doctest failures from [comment:68].\n\nI disagree. I consider setup.py deriving `SAGE_CYTHONIZED` from `--build-base` a crucial feature of this patch.\nWhat I meant above is simply that `setup.py` will set an intermediate variable, rather than SAGE_CYTHONIZED, and SAGE_CYTHONIZED would be determined by env.py.\n\n> The current code which figures out `SAGE_CYTHONIZED` from the command line is quite ugly and fragile. I think that we can do a bigger reorganization of `setup.py` which will make things simpler. Also Cython 0.25 (not released yet) has some potential to simplify cythonization.\n\nI am aware that the arg parsing code is ad hoc, but it's easy to understand code. \n\nI do not want to defer getting `--build-base` working to some distant future, when someone finds the time to clean up `setup.py`.",
    "created_at": "2016-09-16T17:24:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315061",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [@jdemeyer](#comment:77):
> For this ticket, can you please keep `SAGE_CYTHONIZED` independent of `--build-base` (and set them both from the common environment variable you mention in [comment:72]). That will also solve the doctest failures from [comment:68].

I disagree. I consider setup.py deriving `SAGE_CYTHONIZED` from `--build-base` a crucial feature of this patch.
What I meant above is simply that `setup.py` will set an intermediate variable, rather than SAGE_CYTHONIZED, and SAGE_CYTHONIZED would be determined by env.py.

> The current code which figures out `SAGE_CYTHONIZED` from the command line is quite ugly and fragile. I think that we can do a bigger reorganization of `setup.py` which will make things simpler. Also Cython 0.25 (not released yet) has some potential to simplify cythonization.

I am aware that the arg parsing code is ad hoc, but it's easy to understand code. 

I do not want to defer getting `--build-base` working to some distant future, when someone finds the time to clean up `setup.py`.



---

archive/issue_comments_315062.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@mkoeppe](#comment:79):\n> I do not want to defer getting `--build-base` working to some distant future, when someone finds the time to clean up `setup.py`.\n\nAt least you shouldn't determine the directory from the command line. That's too fragile to work correctly. You should find a way to get the directory from `distutils` which is going to require some refactoring anyway.",
    "created_at": "2016-09-16T17:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315062",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@mkoeppe](#comment:79):
> I do not want to defer getting `--build-base` working to some distant future, when someone finds the time to clean up `setup.py`.

At least you shouldn't determine the directory from the command line. That's too fragile to work correctly. You should find a way to get the directory from `distutils` which is going to require some refactoring anyway.



---

archive/issue_comments_315063.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nReplying to [@jdemeyer](#comment:80):\n> At least you shouldn't determine the directory from the command line. That's too fragile to work correctly. You should find a way to get the directory from `distutils` which is going to require some refactoring anyway.\n\nThe current structure of `setup.py` does not make this easy. SAGE_CYTHONIZED is used before `setup` is even invoked.\nIt can't be the job of this ticket to bring `setup.py` to standard distutils behavior.",
    "created_at": "2016-09-16T17:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315063",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:81" align="right">comment:81</div>

Replying to [@jdemeyer](#comment:80):
> At least you shouldn't determine the directory from the command line. That's too fragile to work correctly. You should find a way to get the directory from `distutils` which is going to require some refactoring anyway.

The current structure of `setup.py` does not make this easy. SAGE_CYTHONIZED is used before `setup` is even invoked.
It can't be the job of this ticket to bring `setup.py` to standard distutils behavior.



---

archive/issue_comments_315064.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nI've created a ticket #21508 for setup.py cleanup issues.",
    "created_at": "2016-09-16T17:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315064",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

I've created a ticket #21508 for setup.py cleanup issues.



---

archive/issue_comments_315065.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@mkoeppe](#comment:81):\n> The current structure of `setup.py` does not make this easy.\n\nI know! That exactly why I proposed in [comment:77] to postpone this piece of your patch.\n\nIf you really want to go for #21507, you will need a lot of changes to `setup.py` anyway. So the cleanup will need to happen sooner or later.",
    "created_at": "2016-09-16T17:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315065",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@mkoeppe](#comment:81):
> The current structure of `setup.py` does not make this easy.

I know! That exactly why I proposed in [comment:77] to postpone this piece of your patch.

If you really want to go for #21507, you will need a lot of changes to `setup.py` anyway. So the cleanup will need to happen sooner or later.



---

archive/issue_comments_315066.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@jdemeyer](#comment:83):\n> Replying to [@mkoeppe](#comment:81):\n> > The current structure of `setup.py` does not make this easy.\n\n> \n> I know! That exactly why I proposed in [comment:77] to postpone this piece of your patch.\n\nI want the feature of `--build-base` now, not in the distant future. It is easily achieved with this patch. \nThe arg parsing is ad hoc; but given the current state of `setup.py`, which does not take care at all about standard distutils behavior, it is an improvement.\n\n> If you really want to go for #21507, you will need a lot of changes to `setup.py` anyway. So the cleanup will need to happen sooner or later.\n\nI prefer to do one concrete step (technical goal) at a time. Let's get `--build-base` working right now.",
    "created_at": "2016-09-16T18:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315066",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@jdemeyer](#comment:83):
> Replying to [@mkoeppe](#comment:81):
> > The current structure of `setup.py` does not make this easy.

> 
> I know! That exactly why I proposed in [comment:77] to postpone this piece of your patch.

I want the feature of `--build-base` now, not in the distant future. It is easily achieved with this patch. 
The arg parsing is ad hoc; but given the current state of `setup.py`, which does not take care at all about standard distutils behavior, it is an improvement.

> If you really want to go for #21507, you will need a lot of changes to `setup.py` anyway. So the cleanup will need to happen sooner or later.

I prefer to do one concrete step (technical goal) at a time. Let's get `--build-base` working right now.



---

archive/issue_comments_315067.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nReplying to [@mkoeppe](#comment:84):\n> Let's get `--build-base` working right now.\n\nIn my opinion, this branch is *not* making `--build-base` work. This branch is adding hacks to pretend like `--build-base` is working.\n\nIn general, hacks can have their place, but only if there is a clear reason for them. In this case, I see no reason. This ticket has no reason to exist except for going towards #21507. And this hack that you added will get us no closer to #21507 since we will need to refactor the `SAGE_CYTHONIZED` code anyway.",
    "created_at": "2016-09-16T19:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315067",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

Replying to [@mkoeppe](#comment:84):
> Let's get `--build-base` working right now.

In my opinion, this branch is *not* making `--build-base` work. This branch is adding hacks to pretend like `--build-base` is working.

In general, hacks can have their place, but only if there is a clear reason for them. In this case, I see no reason. This ticket has no reason to exist except for going towards #21507. And this hack that you added will get us no closer to #21507 since we will need to refactor the `SAGE_CYTHONIZED` code anyway.



---

archive/issue_comments_315068.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nAnyway, I will leave this issue for other people to comment, since we probably won't come to an agreement.",
    "created_at": "2016-09-16T19:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315068",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:86" align="right">comment:86</div>

Anyway, I will leave this issue for other people to comment, since we probably won't come to an agreement.



---

archive/issue_comments_315069.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@jdemeyer](#comment:85):\n> Replying to [@mkoeppe](#comment:84):\n> > Let's get `--build-base` working right now.\n\n> \n> In my opinion, this branch is *not* making `--build-base` work. This branch is adding hacks to pretend like `--build-base` is working.\n\nIt does implement --build-base correctly. \n\n> \n> In general, hacks can have their place, but only if there is a clear reason for them. In this case, I see no reason. This ticket has no reason to exist except for going towards #21507. And this hack that you added will get us no closer to #21507 since we will need to refactor the `SAGE_CYTHONIZED` code anyway.\n\nApart from #21507, it is also needed for the VPATH build, as explained in the description.",
    "created_at": "2016-09-16T19:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315069",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@jdemeyer](#comment:85):
> Replying to [@mkoeppe](#comment:84):
> > Let's get `--build-base` working right now.

> 
> In my opinion, this branch is *not* making `--build-base` work. This branch is adding hacks to pretend like `--build-base` is working.

It does implement --build-base correctly. 

> 
> In general, hacks can have their place, but only if there is a clear reason for them. In this case, I see no reason. This ticket has no reason to exist except for going towards #21507. And this hack that you added will get us no closer to #21507 since we will need to refactor the `SAGE_CYTHONIZED` code anyway.

Apart from #21507, it is also needed for the VPATH build, as explained in the description.



---

archive/issue_comments_315070.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nHum. I am not sure myself. I install sagelib in sage-on-gentoo like a normal package (I just don't install sage_setup and do not clean before hand since this is done by the package manager) with `python setup.py build` and then `python setup.py install --root=...`. I guess `pip` may have extra requirements. Of course I patch a lot of the sagelib code itself to help with various issues, and this ticket does nothing for them. But given your goals, I'd say you'll have to deal with most of them.\n\nThere are definitely things to do and getting setup.py to control the autogenerated files may help me. I will have to see it in action before forming a definitive opinion.\n\nMy other concerns while they could influence design here are separate issues:\n* separation of build time, doctest time and runtime variables. `SAGE_SRC` shouldn't be found in runtime code for example, neither does `package.py` belong there.\n* Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`.",
    "created_at": "2016-09-16T20:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315070",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:88" align="right">comment:88</div>

Hum. I am not sure myself. I install sagelib in sage-on-gentoo like a normal package (I just don't install sage_setup and do not clean before hand since this is done by the package manager) with `python setup.py build` and then `python setup.py install --root=...`. I guess `pip` may have extra requirements. Of course I patch a lot of the sagelib code itself to help with various issues, and this ticket does nothing for them. But given your goals, I'd say you'll have to deal with most of them.

There are definitely things to do and getting setup.py to control the autogenerated files may help me. I will have to see it in action before forming a definitive opinion.

My other concerns while they could influence design here are separate issues:
* separation of build time, doctest time and runtime variables. `SAGE_SRC` shouldn't be found in runtime code for example, neither does `package.py` belong there.
* Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`.



---

archive/issue_events_299095.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T20:34:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299095"
}
```



---

archive/issue_events_299096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T20:34:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299096"
}
```



---

archive/issue_comments_315071.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@kiwifb](#comment:88):\n>\n>* Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. \n\nAre you saying that it should be installed under SAGE_LOCAL?\nThis should be a separate ticket.",
    "created_at": "2016-09-16T20:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315071",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@kiwifb](#comment:88):
>
>* Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. 

Are you saying that it should be installed under SAGE_LOCAL?
This should be a separate ticket.



---

archive/issue_comments_315072.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nAgreed on a separate ticket. But I mention `cython_debug` because it is mentioned in the summary. I am pointing to the fact that it should be installable when it is currently not. I am on an awareness campaign :)",
    "created_at": "2016-09-16T20:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315072",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:91" align="right">comment:91</div>

Agreed on a separate ticket. But I mention `cython_debug` because it is mentioned in the summary. I am pointing to the fact that it should be installable when it is currently not. I am on an awareness campaign :)



---

archive/issue_comments_315073.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nReplying to [@mkoeppe](#comment:87):\n> Apart from #21507, it is also needed for the VPATH build, as explained in the description.\n\nYou don't need the `--build-base` hack for VPATH builds to work. You could just set `SAGE_CYTHONIZED` correctly from the `Makefile`.",
    "created_at": "2016-09-16T21:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315073",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:92" align="right">comment:92</div>

Replying to [@mkoeppe](#comment:87):
> Apart from #21507, it is also needed for the VPATH build, as explained in the description.

You don't need the `--build-base` hack for VPATH builds to work. You could just set `SAGE_CYTHONIZED` correctly from the `Makefile`.



---

archive/issue_comments_315074.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@kiwifb](#comment:91):\n> Agreed on a separate ticket. But I mention `cython_debug` because it is mentioned in the summary. I am pointing to the fact that it should be installable when it is currently not. I am on an awareness campaign :)\n\nI've created #21509 for this; but I guess you should explain more on that ticket.",
    "created_at": "2016-09-16T22:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315074",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@kiwifb](#comment:91):
> Agreed on a separate ticket. But I mention `cython_debug` because it is mentioned in the summary. I am pointing to the fact that it should be installable when it is currently not. I am on an awareness campaign :)

I've created #21509 for this; but I guess you should explain more on that ticket.



---

archive/issue_comments_315075.json:
```json
{
    "body": "<div id=\"comment:94\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7791cd987347dfe253e3ed3ce74214f4527485d8\"><code>7791cd9</code></a></td><td><code>Remove --buildbase code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa\"><code>74169e7</code></a></td><td><code>Pass SAGE_SRC to generate_py_source.mk</code></td></tr></table>\n",
    "created_at": "2016-09-16T23:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315075",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:94"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7791cd987347dfe253e3ed3ce74214f4527485d8"><code>7791cd9</code></a></td><td><code>Remove --buildbase code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa"><code>74169e7</code></a></td><td><code>Pass SAGE_SRC to generate_py_source.mk</code></td></tr></table>




---

archive/issue_comments_315076.json:
```json
{
    "body": "Changed commit from **[`e5f9065`](https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5)** to **[`74169e7`](https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa)**",
    "created_at": "2016-09-16T23:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315076",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e5f9065`](https://github.com/sagemath/sagetrac-mirror/commit/e5f90659f21cc7ac1e39cdcf7974dba2ba223da5)** to **[`74169e7`](https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa)**



---

archive/issue_comments_315077.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,13 @@\n This ticket changes the build process of sagelib in the following way:\n - `src/Makefile` delegates ALL building to `src/setup.py`\n - `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n-- `src/setup.py` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).\n-- `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).\n \n This ticket is meant as:\n - preparation for VPATH builds of sage-the-distribution (#21469)\n - working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI\n+- making the flow of directory information at build time clearer for developers\n \n- More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)\n+ More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS and SAGE_CYTHONIZED to be set. The hope is that #20382 and other future tickets will develop better mechanisms to communicate package and directory information to the build.)\n \n . . . . . . . \n \n``````\n",
    "created_at": "2016-09-16T23:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315077",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,13 @@
 This ticket changes the build process of sagelib in the following way:
 - `src/Makefile` delegates ALL building to `src/setup.py`
 - `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
-- `src/setup.py` accepts `build --build-base=BUILD-BASE`. This is where building takes place (where subdirectories `cython_debug`, `cythonized`, `lib.UNAME`, `temp.UNAME` are created). The default is the `build` subdirectory (of `src`).
-- `src/Makefile` sets `--build-base` to the `build-sagelib` subdirectory (of `src`).
 
 This ticket is meant as:
 - preparation for VPATH builds of sage-the-distribution (#21469)
 - working towards the goal of making `sagelib` pip-installable -- see #21507 for the eventual goal of having sagelib on PyPI
+- making the flow of directory information at build time clearer for developers
 
- More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS to be set. The hope is that #20382 or a future ticket will develop a better mechanism to communicate package information to the build.)
+ More specifically, the goal of this ticket is that only SAGE_LOCAL needs to be set when the user does 'pip install' of the sagelib. (This ticket almost achieves this, except it also needs SAGE_PKGS and SAGE_CYTHONIZED to be set. The hope is that #20382 and other future tickets will develop better mechanisms to communicate package and directory information to the build.)
 
 . . . . . . . 
 
``````




---

archive/issue_events_299097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-16T23:47:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "title_is": "Make sagelib setup.py self-contained and independent of SAGE_ROOT",
    "title_was": "Make sagelib setup.py self-contained, independent of SAGE_ROOT, and handle --build-base",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299097"
}
```



---

archive/issue_comments_315078.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nI have simplified this ticket to facilitate easier review.\nJeroen, please take a look.",
    "created_at": "2016-09-16T23:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315078",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:96" align="right">comment:96</div>

I have simplified this ticket to facilitate easier review.
Jeroen, please take a look.



---

archive/issue_comments_315079.json:
```json
{
    "body": "<div id=\"comment:97\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e\"><code>0394333</code></a></td><td><code>Add new file to MANIFEST.in</code></td></tr></table>\n",
    "created_at": "2016-09-17T04:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315079",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:97"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e"><code>0394333</code></a></td><td><code>Add new file to MANIFEST.in</code></td></tr></table>




---

archive/issue_comments_315080.json:
```json
{
    "body": "Changed commit from **[`74169e7`](https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa)** to **[`0394333`](https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e)**",
    "created_at": "2016-09-17T04:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315080",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`74169e7`](https://github.com/sagemath/sagetrac-mirror/commit/74169e75b0c650e6b1070c6beca231422cf62eaa)** to **[`0394333`](https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e)**



---

archive/issue_comments_315081.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nLooks good on first sight, but I need to test it.",
    "created_at": "2016-09-17T07:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315081",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:98" align="right">comment:98</div>

Looks good on first sight, but I need to test it.



---

archive/issue_events_299098.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-18T19:50:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299098"
}
```



---

archive/issue_events_299099.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-18T19:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299099"
}
```



---

archive/issue_comments_315082.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-09-18T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315082",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_315083.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nThanks!",
    "created_at": "2016-09-18T19:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315083",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:100" align="right">comment:100</div>

Thanks!



---

archive/issue_comments_315084.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nTrouble with Jupyter...",
    "created_at": "2016-09-19T07:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315084",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:101" align="right">comment:101</div>

Trouble with Jupyter...



---

archive/issue_events_299100.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-19T07:48:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299100"
}
```



---

archive/issue_events_299101.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-19T07:48:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299101"
}
```



---

archive/issue_comments_315085.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\n`src/setup.py` runs code from `src/sage/repl/ipython_kernel/install.py` which still uses some of the directories that you blacklist.",
    "created_at": "2016-09-19T07:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315085",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:102" align="right">comment:102</div>

`src/setup.py` runs code from `src/sage/repl/ipython_kernel/install.py` which still uses some of the directories that you blacklist.



---

archive/issue_comments_315086.json:
```json
{
    "body": "Changed commit from **[`0394333`](https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e)** to **[`fdedb02`](https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217)**",
    "created_at": "2016-09-21T04:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315086",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0394333`](https://github.com/sagemath/sagetrac-mirror/commit/0394333a54e51c53b9404f248220a412cf13e00e)** to **[`fdedb02`](https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217)**



---

archive/issue_comments_315087.json:
```json
{
    "body": "<div id=\"comment:103\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217\"><code>fdedb02</code></a></td><td><code>Install SAGE_LOCAL/bin/sage instead of SAGE_ROOT/sage as Jupyter kernel</code></td></tr></table>\n",
    "created_at": "2016-09-21T04:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315087",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:103"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217"><code>fdedb02</code></a></td><td><code>Install SAGE_LOCAL/bin/sage instead of SAGE_ROOT/sage as Jupyter kernel</code></td></tr></table>




---

archive/issue_comments_315088.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nWith this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook. \n`SAGE_LOCAL/bin/sage` picks up its environment variables from the server that runs it, so everything works.\nDoes it have to work in other settings that I'm unaware of as well?",
    "created_at": "2016-09-21T04:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315088",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:104" align="right">comment:104</div>

With this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook. 
`SAGE_LOCAL/bin/sage` picks up its environment variables from the server that runs it, so everything works.
Does it have to work in other settings that I'm unaware of as well?



---

archive/issue_events_299102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-21T04:27:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299102"
}
```



---

archive/issue_events_299103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-21T04:27:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299103"
}
```



---

archive/issue_comments_315089.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nWhat about the use of `SAGE_DOC` and `SAGE_EXTCODE` in that file?",
    "created_at": "2016-09-21T07:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315089",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:106" align="right">comment:106</div>

What about the use of `SAGE_DOC` and `SAGE_EXTCODE` in that file?



---

archive/issue_comments_315090.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This ticket changes the build process of sagelib in the following way:\n - `src/Makefile` delegates ALL building to `src/setup.py`\n-- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n+- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.\n \n This ticket is meant as:\n - preparation for VPATH builds of sage-the-distribution (#21469)\n``````\n",
    "created_at": "2016-09-21T21:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315090",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This ticket changes the build process of sagelib in the following way:
 - `src/Makefile` delegates ALL building to `src/setup.py`
-- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC`, `$SAGE_CYTHONIZED` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
+- `src/setup.py` no longer depends on environment variables `$SAGE_ROOT`, `$SAGE_SRC`, `$SAGE_DOC_SRC` etc. (to demonstrate this, `Makefile` poisons these environment variables). It still depends on `$SAGE_LOCAL` and environment variables that point below it.
 
 This ticket is meant as:
 - preparation for VPATH builds of sage-the-distribution (#21469)
``````




---

archive/issue_comments_315091.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\n`SAGE_DOC` and `SAGE_EXTCODE` are fine as they are subdirectories of `SAGE_LOCAL`.\nThe patch does not poison any environment variables that are subdirectories of `SAGE_LOCAL`.",
    "created_at": "2016-09-21T21:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315091",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:108" align="right">comment:108</div>

`SAGE_DOC` and `SAGE_EXTCODE` are fine as they are subdirectories of `SAGE_LOCAL`.
The patch does not poison any environment variables that are subdirectories of `SAGE_LOCAL`.



---

archive/issue_comments_315092.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nVery interesting--I'd like to take some time to review this and all the comments on it.  I probably won't get to it in detail until next week but I'd really like a chance to look it over.",
    "created_at": "2016-09-22T15:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315092",
    "user": "https://github.com/embray"
}
```

<div id="comment:109" align="right">comment:109</div>

Very interesting--I'd like to take some time to review this and all the comments on it.  I probably won't get to it in detail until next week but I'd really like a chance to look it over.



---

archive/issue_comments_315093.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nReplying to [@mkoeppe](#comment:104):\n> With this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook.\n\nDid you test with a custom value for `SAGE_LOCAL` (#21501)? Because that should be done (I could do that, but not right now).",
    "created_at": "2016-09-22T15:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315093",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:110" align="right">comment:110</div>

Replying to [@mkoeppe](#comment:104):
> With this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook.

Did you test with a custom value for `SAGE_LOCAL` (#21501)? Because that should be done (I could do that, but not right now).



---

archive/issue_comments_315094.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nI would probably rather test with `--prefix` (#21479).",
    "created_at": "2016-09-22T22:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315094",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:111" align="right">comment:111</div>

I would probably rather test with `--prefix` (#21479).



---

archive/issue_comments_315095.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nReplying to [@mkoeppe](#comment:111):\n> I would probably rather test with `--prefix` (#21479).\n\nFrom a distro point of view, I would also want it to be tested with the underdocumented `--root`.",
    "created_at": "2016-09-22T23:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315095",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:112" align="right">comment:112</div>

Replying to [@mkoeppe](#comment:111):
> I would probably rather test with `--prefix` (#21479).

From a distro point of view, I would also want it to be tested with the underdocumented `--root`.



---

archive/issue_comments_315096.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nReplying to [@kiwifb](#comment:112):\n> Replying to [@mkoeppe](#comment:111):\n> > I would probably rather test with `--prefix` (#21479).\n\n> \n> From a distro point of view, I would also want it to be tested with the underdocumented `--root`.\n\nIs `--root` an option of `setup.sh`? (I was referring to `./configure --prefix`)",
    "created_at": "2016-09-22T23:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315096",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:113" align="right">comment:113</div>

Replying to [@kiwifb](#comment:112):
> Replying to [@mkoeppe](#comment:111):
> > I would probably rather test with `--prefix` (#21479).

> 
> From a distro point of view, I would also want it to be tested with the underdocumented `--root`.

Is `--root` an option of `setup.sh`? (I was referring to `./configure --prefix`)



---

archive/issue_comments_315097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,4 +15,4 @@\n - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n-- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.py; we will not do this in our ticket.\n``````\n",
    "created_at": "2016-09-22T23:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315097",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,4 +15,4 @@
 - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
 - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
-- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.py; we will not do this in our ticket.
``````




---

archive/issue_comments_315098.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\n(I meant `setup.py` of course -- I keep making the typo \"`setup.sh`\")",
    "created_at": "2016-09-22T23:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315098",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:115" align="right">comment:115</div>

(I meant `setup.py` of course -- I keep making the typo "`setup.sh`")



---

archive/issue_comments_315099.json:
```json
{
    "body": "<div id=\"comment:116\" align=\"right\">comment:116</div>\n\nYes, `setup.py` I should abstain from commenting until my fever goes down :(",
    "created_at": "2016-09-22T23:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315099",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:116" align="right">comment:116</div>

Yes, `setup.py` I should abstain from commenting until my fever goes down :(



---

archive/issue_comments_315100.json:
```json
{
    "body": "<div id=\"comment:117\" align=\"right\">comment:117</div>\n\nReplying to [@kiwifb](#comment:112):\n> From a distro point of view, I would also want it to be tested with the underdocumented `--root`.\n\nThis is now #21573: Make sure `src/setup.py` respects `--install-base` and `--root`.",
    "created_at": "2016-09-23T04:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315100",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:117" align="right">comment:117</div>

Replying to [@kiwifb](#comment:112):
> From a distro point of view, I would also want it to be tested with the underdocumented `--root`.

This is now #21573: Make sure `src/setup.py` respects `--install-base` and `--root`.



---

archive/issue_comments_315101.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nReplying to [@jdemeyer](#comment:110):\n> Replying to [@mkoeppe](#comment:104):\n> > With this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook.\n\n> \n> Did you test with a custom value for `SAGE_LOCAL` (#21501)? Because that should be done (I could do that, but not right now).\n\nI've now tested with #21501 and a fresh build with `SAGE_LOCAL` set to `$SAGE_ROOT/very/far/away/but/still/local`. The Jupyter notebook works.",
    "created_at": "2016-09-23T15:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315101",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:118" align="right">comment:118</div>

Replying to [@jdemeyer](#comment:110):
> Replying to [@mkoeppe](#comment:104):
> > With this change I've tested that I can do `sage -n jupyter` and then run a kernel from the Jupyter notebook.

> 
> Did you test with a custom value for `SAGE_LOCAL` (#21501)? Because that should be done (I could do that, but not right now).

I've now tested with #21501 and a fresh build with `SAGE_LOCAL` set to `$SAGE_ROOT/very/far/away/but/still/local`. The Jupyter notebook works.



---

archive/issue_events_299104.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-24T13:30:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299104"
}
```



---

archive/issue_events_299105.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-24T13:30:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299105"
}
```



---

archive/issue_comments_315102.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">comment:119</div>\n\nGood enough for me.",
    "created_at": "2016-09-24T13:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315102",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:119" align="right">comment:119</div>

Good enough for me.



---

archive/issue_comments_315103.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\nNot that it really matters, but `python -u setup.py build install` is superfluous--the `install` command always runs `build` as a sub-command.",
    "created_at": "2016-09-26T11:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315103",
    "user": "https://github.com/embray"
}
```

<div id="comment:120" align="right">comment:120</div>

Not that it really matters, but `python -u setup.py build install` is superfluous--the `install` command always runs `build` as a sub-command.



---

archive/issue_comments_315104.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nFor the sake of keeping this ticket focused I think it's fine for now, but something definitely needs to be done about using make for the autogenerated sources.  My [comment](https://github.com/sagemath/sage/issues/21507#comment:22) in #21507 has some suggestions toward that.  Is there already a separate ticket for dealing with that?  If so I can work on it.",
    "created_at": "2016-09-26T11:29:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315104",
    "user": "https://github.com/embray"
}
```

<div id="comment:121" align="right">comment:121</div>

For the sake of keeping this ticket focused I think it's fine for now, but something definitely needs to be done about using make for the autogenerated sources.  My [comment](https://github.com/sagemath/sage/issues/21507#comment:22) in #21507 has some suggestions toward that.  Is there already a separate ticket for dealing with that?  If so I can work on it.



---

archive/issue_comments_315105.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nAlso, if you'd like, I can suggest a much less \"hacky\" way of handling `--build-base`, is there already a separate ticket for that?",
    "created_at": "2016-09-26T11:33:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315105",
    "user": "https://github.com/embray"
}
```

<div id="comment:122" align="right">comment:122</div>

Also, if you'd like, I can suggest a much less "hacky" way of handling `--build-base`, is there already a separate ticket for that?



---

archive/issue_comments_315106.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nReplying to [@embray](#comment:122):\n> Also, if you'd like, I can suggest a much less \"hacky\" way of handling `--build-base`, is there already a separate ticket for that?\n\n#21573 I guess.",
    "created_at": "2016-09-26T13:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315106",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:123" align="right">comment:123</div>

Replying to [@embray](#comment:122):
> Also, if you'd like, I can suggest a much less "hacky" way of handling `--build-base`, is there already a separate ticket for that?

#21573 I guess.



---

archive/issue_comments_315107.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">comment:124</div>\n\n#21573 is for `--install-base` and `--root`.\n\n`--build-base` work should go on either one of the following two:\n- #21508: Clean up src/setup.py to bring it to standard distutils behavior\n- #21535: Make src/setup.py independent of SAGE_CYTHONIZED",
    "created_at": "2016-09-26T14:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315107",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:124" align="right">comment:124</div>

#21573 is for `--install-base` and `--root`.

`--build-base` work should go on either one of the following two:
- #21508: Clean up src/setup.py to bring it to standard distutils behavior
- #21535: Make src/setup.py independent of SAGE_CYTHONIZED



---

archive/issue_comments_315108.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nReplying to [@embray](#comment:120):\n> Not that it really matters, but `python -u setup.py build install` is superfluous--the `install` command always runs `build` as a sub-command.\n\nI've left it like this as a little reminder that `--build-base` can go in between.",
    "created_at": "2016-09-26T14:59:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315108",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:125" align="right">comment:125</div>

Replying to [@embray](#comment:120):
> Not that it really matters, but `python -u setup.py build install` is superfluous--the `install` command always runs `build` as a sub-command.

I've left it like this as a little reminder that `--build-base` can go in between.



---

archive/issue_comments_315109.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,4 +15,4 @@\n - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.\n - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n-- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.py; we will not do this in our ticket.\n+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n``````\n",
    "created_at": "2016-09-29T15:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315109",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,4 +15,4 @@
 - Documentation on distutils (https://docs.python.org/2/install/), describing use of `--build-base` to do VPATH builds.
 - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
-- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.py; we will not do this in our ticket.
+- #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
``````




---

archive/issue_comments_315110.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nFor `generate_py_source.mk`, we could even get rid of that and not invoke `make` at all.  For simplicity's sake I could do that as a separate ticket with this one as a dependency.\n\nTo add, I especially don't like what this branch currently does as far as unconditionally invoking `make` every time `setup.py` is run.  But I'm happy to ignore it for now as long as we follow up with further work--I'm opening a new ticket now.",
    "created_at": "2016-09-29T15:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315110",
    "user": "https://github.com/embray"
}
```

<div id="comment:126" align="right">comment:126</div>

For `generate_py_source.mk`, we could even get rid of that and not invoke `make` at all.  For simplicity's sake I could do that as a separate ticket with this one as a dependency.

To add, I especially don't like what this branch currently does as far as unconditionally invoking `make` every time `setup.py` is run.  But I'm happy to ignore it for now as long as we follow up with further work--I'm opening a new ticket now.



---

archive/issue_comments_315111.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nReplying to [@kiwifb](#comment:88):\n> * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. \n\nOn the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.\n\nMaybe the location for `cython_debug` can be improved, but I think you should only install it in `SAGE_LOCAL` if you also install the sources somewhere in `SAGE_LOCAL`.",
    "created_at": "2016-09-29T15:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315111",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:127" align="right">comment:127</div>

Replying to [@kiwifb](#comment:88):
> * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. 

On the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.

Maybe the location for `cython_debug` can be improved, but I think you should only install it in `SAGE_LOCAL` if you also install the sources somewhere in `SAGE_LOCAL`.



---

archive/issue_comments_315112.json:
```json
{
    "body": "<div id=\"comment:128\" align=\"right\">comment:128</div>\n\nReplying to [@embray](#comment:126):\n> For `generate_py_source.mk`, we could even get rid of that and not invoke `make` at all.\n\nBut `make` does automatic dependency checking for you. Whatever Python alternative you come up with will be more complex than a simple makefile.",
    "created_at": "2016-09-29T15:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315112",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:128" align="right">comment:128</div>

Replying to [@embray](#comment:126):
> For `generate_py_source.mk`, we could even get rid of that and not invoke `make` at all.

But `make` does automatic dependency checking for you. Whatever Python alternative you come up with will be more complex than a simple makefile.



---

archive/issue_comments_315113.json:
```json
{
    "body": "<div id=\"comment:129\" align=\"right\">comment:129</div>\n\nI would disagree.  In fact as the discussion in #20730 demonstrates that writing a technically correct makefile for this case results in a makefile that's \"too complicated to understand\".  I can do this correctly in Python with about the same amount of code it takes to invoke make as a subprocess (which is also pretty non-standard to do anything in a Python setup). Not to mention the contents of the Makefile itself (no matter how \"correct\" it is).\n\nPart of the idea is also not to make non-Sage developers blanche when they look inside of sage's setup.py.",
    "created_at": "2016-09-29T15:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315113",
    "user": "https://github.com/embray"
}
```

<div id="comment:129" align="right">comment:129</div>

I would disagree.  In fact as the discussion in #20730 demonstrates that writing a technically correct makefile for this case results in a makefile that's "too complicated to understand".  I can do this correctly in Python with about the same amount of code it takes to invoke make as a subprocess (which is also pretty non-standard to do anything in a Python setup). Not to mention the contents of the Makefile itself (no matter how "correct" it is).

Part of the idea is also not to make non-Sage developers blanche when they look inside of sage's setup.py.



---

archive/issue_comments_315114.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">comment:130</div>\n\nReplying to [@jdemeyer](#comment:127):\n> Replying to [@kiwifb](#comment:88):\n> > * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. \n\n> \n> On the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.\n\nThis is why I also like to output the C(++) sources themselves to be close to the cython sources but you said you don't like :)",
    "created_at": "2016-09-29T16:03:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315114",
    "user": "https://github.com/embray"
}
```

<div id="comment:130" align="right">comment:130</div>

Replying to [@jdemeyer](#comment:127):
> Replying to [@kiwifb](#comment:88):
> > * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. 

> 
> On the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.

This is why I also like to output the C(++) sources themselves to be close to the cython sources but you said you don't like :)



---

archive/issue_comments_315115.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nReplying to [@jdemeyer](#comment:128):\n> But `make` does automatic dependency checking for you. Whatever Python alternative you come up with will be more complex than a simple makefile.\n\ntrue.\n\nthere is a python alternative that is no more complex than a simple makefile *plus* make. it's the simple makefile + a *subset* of make implemented in python. (yes, you could use GNU make as an intermediate solution...)\n\nbut seriously: what's all the fuss about reinventing and replacing make? it should obviously be the other way round: python is not the right tool for the job, it's make. unlike python, make is *designed* for this. no matter which language you implement it in.\n\nif there's a need for a make replacement (completely different[tm]), is sage the right community or the right project to invent it in?",
    "created_at": "2016-09-29T16:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315115",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:131" align="right">comment:131</div>

Replying to [@jdemeyer](#comment:128):
> But `make` does automatic dependency checking for you. Whatever Python alternative you come up with will be more complex than a simple makefile.

true.

there is a python alternative that is no more complex than a simple makefile *plus* make. it's the simple makefile + a *subset* of make implemented in python. (yes, you could use GNU make as an intermediate solution...)

but seriously: what's all the fuss about reinventing and replacing make? it should obviously be the other way round: python is not the right tool for the job, it's make. unlike python, make is *designed* for this. no matter which language you implement it in.

if there's a need for a make replacement (completely different[tm]), is sage the right community or the right project to invent it in?



---

archive/issue_comments_315116.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nReplying to [@embray](#comment:130):\n> Replying to [@jdemeyer](#comment:127):\n> > Replying to [@kiwifb](#comment:88):\n> > > * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. \n\n> > \n> > On the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.\n\n> \n> This is why I also like to output the C(++) sources themselves to be close to the cython sources but you said you don't like :)\n\n\nFor the record: in sage-on-gentoo I ship the `.pyx` files next to the matching `.so` files. In any case distro ship debugging symbols without the sources. Of course at some point you may need the source code but this is trivial to get and unfold separately in most cases.",
    "created_at": "2016-09-29T20:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315116",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:132" align="right">comment:132</div>

Replying to [@embray](#comment:130):
> Replying to [@jdemeyer](#comment:127):
> > Replying to [@kiwifb](#comment:88):
> > > * Is there a standard place where `cython_debug` can be installed? It is needed for debugging and shouldn't live under `SAGE_SRC`. 

> > 
> > On the other hand, debugging also requires the *sources* to be available. So it is not a crazy idea to keep the debug info close to the sources.

> 
> This is why I also like to output the C(++) sources themselves to be close to the cython sources but you said you don't like :)


For the record: in sage-on-gentoo I ship the `.pyx` files next to the matching `.so` files. In any case distro ship debugging symbols without the sources. Of course at some point you may need the source code but this is trivial to get and unfold separately in most cases.



---

archive/issue_comments_315117.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\nThis ticket introduces an autotools dependency (src/Makefile.in) and fails on OSX",
    "created_at": "2016-10-03T10:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315117",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:133" align="right">comment:133</div>

This ticket introduces an autotools dependency (src/Makefile.in) and fails on OSX



---

archive/issue_events_299106.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T10:01:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299106"
}
```



---

archive/issue_events_299107.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T10:01:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299107"
}
```



---

archive/issue_comments_315118.json:
```json
{
    "body": "<div id=\"comment:134\" align=\"right\">comment:134</div>\n\nThe is the usual breakage of your release management scripts in case of changes to `configure`.",
    "created_at": "2016-10-03T13:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315118",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:134" align="right">comment:134</div>

The is the usual breakage of your release management scripts in case of changes to `configure`.



---

archive/issue_comments_315119.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib)** to **[u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib)**",
    "created_at": "2016-10-03T13:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315119",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/keep_src__clean_by_using___build_base_when_building_sagelib)** to **[u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib)**



---

archive/issue_comments_315120.json:
```json
{
    "body": "Changed commit from **[`fdedb02`](https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217)** to **[`78ab5d7`](https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b)**",
    "created_at": "2016-10-03T13:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315120",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`fdedb02`](https://github.com/sagemath/sagetrac-mirror/commit/fdedb029434cba49db4249c5511af8c8efc08217)** to **[`78ab5d7`](https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b)**



---

archive/issue_comments_315121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,3 +16,5 @@\n - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. \n  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n+\n+**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-183.tar.gz\n``````\n",
    "created_at": "2016-10-03T13:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315121",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,3 +16,5 @@
 - `pip install` keeps the source directory clean, building instead in a temporary directory, by copying the sources. 
  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
 - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
+
+**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-183.tar.gz
``````




---

archive/issue_events_299108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-03T13:30:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299108"
}
```



---

archive/issue_events_299109.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-03T13:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299109"
}
```



---

archive/issue_comments_315122.json:
```json
{
    "body": "<div id=\"comment:136\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2cf73520f0efdee72c3af76ee6c90229fc398ca7\"><code>2cf7352</code></a></td><td><code>Merge tag '7.4.beta6' into t/21480/keep_src__clean_by_using___build_base_when_building_sagelib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b\"><code>78ab5d7</code></a></td><td><code>Bump configure version</code></td></tr></table>\n",
    "created_at": "2016-10-03T13:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315122",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:136"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2cf73520f0efdee72c3af76ee6c90229fc398ca7"><code>2cf7352</code></a></td><td><code>Merge tag '7.4.beta6' into t/21480/keep_src__clean_by_using___build_base_when_building_sagelib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b"><code>78ab5d7</code></a></td><td><code>Bump configure version</code></td></tr></table>




---

archive/issue_comments_315123.json:
```json
{
    "body": "<div id=\"comment:137\" align=\"right\">comment:137</div>\n\nThis now conflicts with the configure spkg version change in 7.4.rc0.\nSeems to me incrementing configure spkg versions is something that should be done by the release manager.",
    "created_at": "2016-10-08T19:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315123",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:137" align="right">comment:137</div>

This now conflicts with the configure spkg version change in 7.4.rc0.
Seems to me incrementing configure spkg versions is something that should be done by the release manager.



---

archive/issue_comments_315124.json:
```json
{
    "body": "<div id=\"comment:138\" align=\"right\">comment:138</div>\n\nReplying to [@mkoeppe](#comment:137):\n> This now conflicts with the configure spkg version change in 7.4.rc0.\n> Seems to me incrementing configure spkg versions is something that should be done by the release manager.\n\nI know, it is really annoying.",
    "created_at": "2016-10-09T07:42:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315124",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:138" align="right">comment:138</div>

Replying to [@mkoeppe](#comment:137):
> This now conflicts with the configure spkg version change in 7.4.rc0.
> Seems to me incrementing configure spkg versions is something that should be done by the release manager.

I know, it is really annoying.



---

archive/issue_comments_315125.json:
```json
{
    "body": "<div id=\"comment:139\" align=\"right\">comment:139</div>\n\nThis problem happens every time that you make non-trivial changes to `configure.ac`",
    "created_at": "2016-10-09T07:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315125",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:139" align="right">comment:139</div>

This problem happens every time that you make non-trivial changes to `configure.ac`



---

archive/issue_comments_315126.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,4 +17,4 @@\n  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this\n - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.\n \n-**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-183.tar.gz\n+**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-185.tar.gz\n``````\n",
    "created_at": "2016-10-09T07:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315126",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,4 +17,4 @@
  `pip install` also offers options `--build` to select a build directory, but there are some pip issues: [2060](https://github.com/pypa/pip/issues/2060), [2053](https://github.com/pypa/pip/issues/2053), [804](https://github.com/pypa/pip/issues/804) that affect this
 - #14807 has some tricks to making VPATH builds work without copying all python source files. But it uses automake instead of setup.sh; we will not do this in our ticket.
 
-**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-183.tar.gz
+**configure tarball**: http://sage.ugent.be/www/jdemeyer/sage/configure-185.tar.gz
``````




---

archive/issue_comments_315127.json:
```json
{
    "body": "Changed commit from **[`78ab5d7`](https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b)** to **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**",
    "created_at": "2016-10-09T07:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315127",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`78ab5d7`](https://github.com/sagemath/sagetrac-mirror/commit/78ab5d7f5a8b6f1b89ba3be59eda6ff9ce77a91b)** to **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**



---

archive/issue_comments_315128.json:
```json
{
    "body": "<div id=\"comment:141\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2871769ba09fd676f0267e8943b75360da6261d7\"><code>2871769</code></a></td><td><code>Merge tag '7.4.rc0' into t/21480/keep_src__clean_by_using___build_base_when_building_sagelib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162\"><code>0c2ac95</code></a></td><td><code>Bump configure version</code></td></tr></table>\n",
    "created_at": "2016-10-09T07:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315128",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:141"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2871769ba09fd676f0267e8943b75360da6261d7"><code>2871769</code></a></td><td><code>Merge tag '7.4.rc0' into t/21480/keep_src__clean_by_using___build_base_when_building_sagelib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162"><code>0c2ac95</code></a></td><td><code>Bump configure version</code></td></tr></table>




---

archive/issue_events_299110.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2016-10-09T07:49:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299110"
}
```



---

archive/issue_events_299111.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2016-10-09T07:49:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299111"
}
```



---

archive/issue_events_299112.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-09T07:50:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299112"
}
```



---

archive/issue_events_299113.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-09T07:50:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299113"
}
```



---

archive/issue_comments_315129.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nThis should be merged as soon as possible to avoid further problems with `configure`.",
    "created_at": "2016-10-09T08:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315129",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:143" align="right">comment:143</div>

This should be merged as soon as possible to avoid further problems with `configure`.



---

archive/issue_events_299114.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-09T08:42:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299114"
}
```



---

archive/issue_events_299115.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-09T08:42:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299115"
}
```



---

archive/issue_comments_315130.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib)** to **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**",
    "created_at": "2016-10-12T06:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21480#issuecomment-315130",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/keep_src__clean_by_using___build_base_when_building_sagelib)** to **[`0c2ac95`](https://github.com/sagemath/sagetrac-mirror/commit/0c2ac9583ed97ffc74e99c876a8cf4506f5b0162)**



---

archive/issue_events_299116.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-12T06:53:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299116"
}
```



---

archive/issue_events_299117.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d20859bd3089a6c4642fe2f9cac15cf43920368e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-10-12T06:53:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21480",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21480#event-299117"
}
```
