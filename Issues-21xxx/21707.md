# Issue 21707: Meta-ticket: Split sage-env into 5 to clean up sage configuration

archive/issues_021470.json:
```json
{
    "body": "`src/bin/sage-env` (with generated configuration in `src/bin/sage-env-config`; installed in `$SAGE_LOCAL/bin`) is used in all of the following contexts: \n1. Sage-the-distribution while building spkgs,\n2. Sage-the-distribution for building sagelib,\n3. for environment variables needed to start Sage,\n4. as variables by Sage at runtime (through `sage.env`), and\n5. for environment variables affecting subprocesses of Python invoked by sagelib modules. \n\nThis ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.\n\n1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n   b. In `build/make/Makefile.in` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.\n   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! \n   d. Eventually, we will remove the call to `src/bin/sage-env` from the build scripts.\n\n2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n   a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.\n   - #29411: make sagelib a script package\n   - #29779: `pkg-config` installed from SPKG `pkgconf` should not depend on environment variable `SAGE_LOCAL`\n   b. Pass `SAGE_PKGS` (if still needed at all - see #28815 or #29705) via `sage-config` instead of from `src/Makefile`.\n\n3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).\na. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.\n   - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`\n   - #29825: Clean-up for src/bin/sage-env\nb. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n   - #34236 `sage.env`: Give values from `sage_conf` precedence over environment variables\nc. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n   - #30563: Use configuration variable `MAXIMA` instead of hardcoding \"maxima\" \n   - #30818 Set environment for subprocesses invoked by Sage\nd. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n\n**Aspects of downstream sage packaging:**\n\n- The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.\n   - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036\t(pip-installable sage)\n- Downstream packagers could provide their own \"implementation\" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.\n\n**Binary packages:**\n\n- #31417 version of package `sage_conf` for relocatable binary distributions\n\n**pip-installable Sage**\n\n- #29039 pip-installable version of package `sage_conf` - installs non-Python bits of the Sage distribution in `~/.sage/`\n- #31396 relocatable wheel version of package `sage_conf`\n\n**More related tickets:**\n- cleaning of `src/bin` as described in #21570, #21559.\n- #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`\n- #30724: `src/bin/sage-env`, `src/bin/sage-env-config.in`: Remove PYTHON_FOR_VENV\n- #29133 META-META-TICKET: Build, packaging, testing improvements\n\nDepends on #29038\n\nDepends on #29052\n\n**CC:**  @embray @jdemeyer @nexttime @kiwifb @dimpase @isuruf @antonio-rojas @infinity0 @timokau @orlitzky @jhpalmieri @tobiasdiez\n\n**Keywords:** sd109\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/21707\n\n",
    "created_at": "2016-10-15T06:08:58Z",
    "labels": [
        "component: build",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Meta-ticket: Split sage-env into 5 to clean up sage configuration",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/21707",
    "user": "https://github.com/mkoeppe"
}
```
`src/bin/sage-env` (with generated configuration in `src/bin/sage-env-config`; installed in `$SAGE_LOCAL/bin`) is used in all of the following contexts: 
1. Sage-the-distribution while building spkgs,
2. Sage-the-distribution for building sagelib,
3. for environment variables needed to start Sage,
4. as variables by Sage at runtime (through `sage.env`), and
5. for environment variables affecting subprocesses of Python invoked by sagelib modules. 

This ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.

1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
   b. In `build/make/Makefile.in` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.
   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! 
   d. Eventually, we will remove the call to `src/bin/sage-env` from the build scripts.

2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
   a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.
   - #29411: make sagelib a script package
   - #29779: `pkg-config` installed from SPKG `pkgconf` should not depend on environment variable `SAGE_LOCAL`
   b. Pass `SAGE_PKGS` (if still needed at all - see #28815 or #29705) via `sage-config` instead of from `src/Makefile`.

3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).
a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.
   - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`
   - #29825: Clean-up for src/bin/sage-env
b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
   - #34236 `sage.env`: Give values from `sage_conf` precedence over environment variables
c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
   - #30563: Use configuration variable `MAXIMA` instead of hardcoding "maxima" 
   - #30818 Set environment for subprocesses invoked by Sage
d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.

**Aspects of downstream sage packaging:**

- The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.
   - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036	(pip-installable sage)
- Downstream packagers could provide their own "implementation" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.

**Binary packages:**

- #31417 version of package `sage_conf` for relocatable binary distributions

**pip-installable Sage**

- #29039 pip-installable version of package `sage_conf` - installs non-Python bits of the Sage distribution in `~/.sage/`
- #31396 relocatable wheel version of package `sage_conf`

**More related tickets:**
- cleaning of `src/bin` as described in #21570, #21559.
- #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`
- #30724: `src/bin/sage-env`, `src/bin/sage-env-config.in`: Remove PYTHON_FOR_VENV
- #29133 META-META-TICKET: Build, packaging, testing improvements

Depends on #29038

Depends on #29052

**CC:**  @embray @jdemeyer @nexttime @kiwifb @dimpase @isuruf @antonio-rojas @infinity0 @timokau @orlitzky @jhpalmieri @tobiasdiez

**Keywords:** sd109

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/21707





---

archive/issue_comments_321671.json:
```json
{
    "body": "<a id='comment:1'></a>\nOne comment. Currently `sage_setup` is installed because it needs to be installed to be doctested - like the rest of sage. But nothing in `sage_setup` is really needed at runtime and distro can choose not to install it. I don't in sage-on-gentoo. I tend to push for thing not needed at runtime to be moved in there. And that's where I would have put `sage-build-env` but I am not going to fight it going into `build/bin` although I'd like everything used by `setup.py` to be neatly under `src`.",
    "created_at": "2016-10-15T08:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321671",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
One comment. Currently `sage_setup` is installed because it needs to be installed to be doctested - like the rest of sage. But nothing in `sage_setup` is really needed at runtime and distro can choose not to install it. I don't in sage-on-gentoo. I tend to push for thing not needed at runtime to be moved in there. And that's where I would have put `sage-build-env` but I am not going to fight it going into `build/bin` although I'd like everything used by `setup.py` to be neatly under `src`.



---

archive/issue_comments_321672.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks - I've updated the description",
    "created_at": "2016-10-15T18:53:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321672",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Thanks - I've updated the description



---

archive/issue_comments_321673.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,10 @@\n `sage-env` is used by both Sage-the-distribution while building packages,\n and by Sage at runtime.\n \n-It should be split into two separate scripts.\n-- `sage-build-env` should go into `build/bin` and not be installed.\n-- `sage-env` should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. \n-\n-(`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n+It should be split into two or three separate scripts.\n+- `sage-build-env` is for the *'build-time environment variables for sage-the-distribution*, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`\n+- `sagelib-build-env` is for the **build-time environment variables for sagelib** \n+- `sage-env` is for the '''run-time environment variables of sage``` and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n \n This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.\n \n``````\n",
    "created_at": "2016-10-15T18:53:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321673",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,10 @@
 `sage-env` is used by both Sage-the-distribution while building packages,
 and by Sage at runtime.
 
-It should be split into two separate scripts.
-- `sage-build-env` should go into `build/bin` and not be installed.
-- `sage-env` should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. 
-
-(`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)
+It should be split into two or three separate scripts.
+- `sage-build-env` is for the *'build-time environment variables for sage-the-distribution*, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`
+- `sagelib-build-env` is for the **build-time environment variables for sagelib** 
+- `sage-env` is for the '''run-time environment variables of sage``` and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)
 
 This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.
 
``````




---

archive/issue_comments_321674.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,9 +2,9 @@\n and by Sage at runtime.\n \n It should be split into two or three separate scripts.\n-- `sage-build-env` is for the *'build-time environment variables for sage-the-distribution*, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`\n+- `sage-build-env` is for the **build-time environment variables for sage-the-distribution**, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`\n - `sagelib-build-env` is for the **build-time environment variables for sagelib** \n-- `sage-env` is for the '''run-time environment variables of sage``` and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n+- `sage-env` is for the **run-time environment variables of sage** and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n \n This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.\n \n``````\n",
    "created_at": "2016-10-15T18:54:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321674",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,9 +2,9 @@
 and by Sage at runtime.
 
 It should be split into two or three separate scripts.
-- `sage-build-env` is for the *'build-time environment variables for sage-the-distribution*, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`
+- `sage-build-env` is for the **build-time environment variables for sage-the-distribution**, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`
 - `sagelib-build-env` is for the **build-time environment variables for sagelib** 
-- `sage-env` is for the '''run-time environment variables of sage``` and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)
+- `sage-env` is for the **run-time environment variables of sage** and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)
 
 This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.
 
``````




---

archive/issue_comments_321675.json:
```json
{
    "body": "<a id='comment:4'></a>\nI agree.\n\nConsider a slight alternative: Rewrite sage-env as a Python script.  This would give it much more flexibility and probably more legibility, including some command-line options for different environments (`--build`, especially).\n\nThe output would of course be the shell commands to actually set the variables. So rather than `source sage-env` one would `eval $(sage-env)`.  My one concern is that it would be slower, but ideally it's something that shouldn't happen frequently anyways, but rather only when not already in sage-env.",
    "created_at": "2016-10-17T09:25:04Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321675",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
I agree.

Consider a slight alternative: Rewrite sage-env as a Python script.  This would give it much more flexibility and probably more legibility, including some command-line options for different environments (`--build`, especially).

The output would of course be the shell commands to actually set the variables. So rather than `source sage-env` one would `eval $(sage-env)`.  My one concern is that it would be slower, but ideally it's something that shouldn't happen frequently anyways, but rather only when not already in sage-env.



---

archive/issue_comments_321676.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have a tendency to mix up `sage-env` the script and `sage.env.py`, my comment is really an example of that. However a lot is common between the two.",
    "created_at": "2016-10-17T09:30:20Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321676",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I have a tendency to mix up `sage-env` the script and `sage.env.py`, my comment is really an example of that. However a lot is common between the two.



---

archive/issue_comments_321677.json:
```json
{
    "body": "<a id='comment:6'></a>\nRight--they could be one in the same.",
    "created_at": "2016-10-17T09:39:48Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321677",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Right--they could be one in the same.



---

archive/issue_comments_321678.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [embray](#comment%3A6):\n> Right--they could be one in the same.\n\n I have thought about it often. Of course that really means that you'll have to removing all the build time stuff. But in sage-on-gentoo where I ship a very simplified sage-env (in /etc as well) they are virtually doing the same thing, one in shell, the other in python.",
    "created_at": "2016-10-17T09:46:17Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321678",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Replying to [embray](#comment%3A6):
> Right--they could be one in the same.

 I have thought about it often. Of course that really means that you'll have to removing all the build time stuff. But in sage-on-gentoo where I ship a very simplified sage-env (in /etc as well) they are virtually doing the same thing, one in shell, the other in python.



---

archive/issue_comments_321679.json:
```json
{
    "body": "<a id='comment:8'></a>\nIn either case--whether making a single script, or two separate shell scripts, this would be useful for gentoo (and probably other distros as well) then right?",
    "created_at": "2016-10-17T09:55:32Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321679",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
In either case--whether making a single script, or two separate shell scripts, this would be useful for gentoo (and probably other distros as well) then right?



---

archive/issue_comments_321680.json:
```json
{
    "body": "<a id='comment:9'></a>\nProbably, the current `sage-env` is a forest mostly dedicated to the build system. I just discard it and bring my own, it takes less space and maintenance than a mega patch.",
    "created_at": "2016-10-17T09:59:20Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321680",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Probably, the current `sage-env` is a forest mostly dedicated to the build system. I just discard it and bring my own, it takes less space and maintenance than a mega patch.



---

archive/issue_comments_321681.json:
```json
{
    "body": "<a id='comment:10'></a>\nIdeally, the configuration for sagelib runtime should take place in a generated Python file and not involve environment variables at all.",
    "created_at": "2016-10-17T14:34:14Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321681",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Ideally, the configuration for sagelib runtime should take place in a generated Python file and not involve environment variables at all.



---

archive/issue_comments_321682.json:
```json
{
    "body": "<a id='comment:11'></a>\nMore likely parts of it would be static, and other parts could be generated, but yes, what I meant above in terms of rewriting `sage-env` in Python was that it would not (by default) involve environment variables at all.\n\nBut it's still useful for interacting with other tools, especially for build purposes, as well as dropping into `./sage -sh` to be able to set environment variables, which is why I suggest a mode to output a list of variables that can be read from the shell.",
    "created_at": "2016-10-17T14:40:26Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321682",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
More likely parts of it would be static, and other parts could be generated, but yes, what I meant above in terms of rewriting `sage-env` in Python was that it would not (by default) involve environment variables at all.

But it's still useful for interacting with other tools, especially for build purposes, as well as dropping into `./sage -sh` to be able to set environment variables, which is why I suggest a mode to output a list of variables that can be read from the shell.



---

archive/issue_comments_321683.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env)",
    "created_at": "2019-05-20T00:29:22Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321683",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env)



---

archive/issue_events_194407.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-20T00:31:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194407"
}
```



---

archive/issue_comments_321684.json:
```json
{
    "body": "**Dependencies:** #25130",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321684",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #25130



---

archive/issue_events_194408.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-20T00:31:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194408"
}
```



---

archive/issue_events_194409.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-20T00:31:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194409"
}
```



---

archive/issue_comments_321685.json:
```json
{
    "body": "<a id='comment:13'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7405dd5b05259028e4dadc981b5bd309a124fbfb\">7405dd5</a></td><td><code>Move sage-dist-helpers from src/bin to build/bin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e\">9189d60</a></td><td><code>Split out build/bin/sage-build-env-config from sage-env-config</code></td></tr></table>\n",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321685",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7405dd5b05259028e4dadc981b5bd309a124fbfb">7405dd5</a></td><td><code>Move sage-dist-helpers from src/bin to build/bin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e">9189d60</a></td><td><code>Split out build/bin/sage-build-env-config from sage-env-config</code></td></tr></table>




---

archive/issue_comments_321686.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321686",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_321687.json:
```json
{
    "body": "**Commit:** [9189d609fa8cc90d616cb7ea05be405ce196295e](https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e)",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321687",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [9189d609fa8cc90d616cb7ea05be405ce196295e](https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e)



---

archive/issue_comments_321688.json:
```json
{
    "body": "<a id='comment:14'></a>\nAs-is this is going to conflict with tickets like #27825 that are adding still more environment variables needed at build-time to sage-env-config.\n\nI'm completely in favor of this separation in principle though.  The question is whether we should do this first and then update tickets like #27825 on top of it, or the other way around?",
    "created_at": "2019-05-21T15:19:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321688",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
As-is this is going to conflict with tickets like #27825 that are adding still more environment variables needed at build-time to sage-env-config.

I'm completely in favor of this separation in principle though.  The question is whether we should do this first and then update tickets like #27825 on top of it, or the other way around?



---

archive/issue_comments_321689.json:
```json
{
    "body": "<a id='comment:15'></a>\nI really would like to first get our existing tickets (#27825, #27822) touching sage-env-config in.",
    "created_at": "2019-05-21T15:25:29Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321689",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
I really would like to first get our existing tickets (#27825, #27822) touching sage-env-config in.



---

archive/issue_comments_321690.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe tickets would be trivial to rebase on top of this one.",
    "created_at": "2019-05-22T20:34:34Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321690",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
The tickets would be trivial to rebase on top of this one.



---

archive/issue_comments_321691.json:
```json
{
    "body": "<a id='comment:17'></a>\nProbably one should introduce a command `sage --buildsh`, which would provide the larger environment.",
    "created_at": "2019-05-23T15:08:52Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321691",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.



---

archive/issue_comments_321692.json:
```json
{
    "body": "<a id='comment:18'></a>\nFor the sake of a bit more terseness I wonder if we could call it just `sage-env-build.in` and `sage-env-build`.  The only reason for the `-config` in the other one is to distinguish it from plain `sage-env`.\n\nNow that I look I'm not even entirely sure we need to separate `sage-env-config` from `sage-env`.\n\nI think we could probably have a `sage-env.in` produce `sage-env` and get rid of the separate `sage-env-config` entirely, though it's possible there's some subtlety to that that I'm missing.",
    "created_at": "2019-07-01T12:44:57Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321692",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
For the sake of a bit more terseness I wonder if we could call it just `sage-env-build.in` and `sage-env-build`.  The only reason for the `-config` in the other one is to distinguish it from plain `sage-env`.

Now that I look I'm not even entirely sure we need to separate `sage-env-config` from `sage-env`.

I think we could probably have a `sage-env.in` produce `sage-env` and get rid of the separate `sage-env-config` entirely, though it's possible there's some subtlety to that that I'm missing.



---

archive/issue_comments_321693.json:
```json
{
    "body": "<a id='comment:19'></a>\nWent ahead and rebased on current develop so it could incorporate all the additional variables we've since added.\n\nI didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a34a9f1c60297944ef119faafe65342cb9cc6ca2\">a34a9f1</a></td><td><code>Move sage-dist-helpers from src/bin to build/bin</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794\">ff07121</a></td><td><code>Split out build/bin/sage-build-env-config from sage-env-config</code></td></tr></table>\n",
    "created_at": "2019-07-01T12:57:45Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321693",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
Went ahead and rebased on current develop so it could incorporate all the additional variables we've since added.

I didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a34a9f1c60297944ef119faafe65342cb9cc6ca2">a34a9f1</a></td><td><code>Move sage-dist-helpers from src/bin to build/bin</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794">ff07121</a></td><td><code>Split out build/bin/sage-build-env-config from sage-env-config</code></td></tr></table>




---

archive/issue_comments_321694.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env)\" to \"[public/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/public/split_sage_env_into_sage_build_env_and_sage_env)\".",
    "created_at": "2019-07-01T12:57:45Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321694",
    "user": "https://github.com/embray"
}
```

**Changing branch** from "[u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/split_sage_env_into_sage_build_env_and_sage_env)" to "[public/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/public/split_sage_env_into_sage_build_env_and_sage_env)".



---

archive/issue_comments_321695.json:
```json
{
    "body": "**Changing commit** from \"[9189d609fa8cc90d616cb7ea05be405ce196295e](https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e)\" to \"[ff0712125a3d05500a1f77e62c371d695d1a9794](https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794)\".",
    "created_at": "2019-07-01T12:57:45Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321695",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[9189d609fa8cc90d616cb7ea05be405ce196295e](https://github.com/sagemath/sagetrac-mirror/commit/9189d609fa8cc90d616cb7ea05be405ce196295e)" to "[ff0712125a3d05500a1f77e62c371d695d1a9794](https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794)".



---

archive/issue_comments_321696.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe only subtility to `sage-env-config` in my mind, is that you can touch it or even regenerate it without touching `sage-env`. But I am sure you don't need a separate file to achieve your objectives in either case.",
    "created_at": "2019-07-01T20:45:04Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321696",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
The only subtility to `sage-env-config` in my mind, is that you can touch it or even regenerate it without touching `sage-env`. But I am sure you don't need a separate file to achieve your objectives in either case.



---

archive/issue_comments_321697.json:
```json
{
    "body": "<a id='comment:21'></a>\nNo, probably not.  I might try it, though we'll leave that as a separate exercise from this ticket.",
    "created_at": "2019-07-02T12:02:33Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321697",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
No, probably not.  I might try it, though we'll leave that as a separate exercise from this ticket.



---

archive/issue_events_194410.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194410"
}
```



---

archive/issue_events_194411.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194411"
}
```



---

archive/issue_comments_321698.json:
```json
{
    "body": "<a id='comment:22'></a>\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321698",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_321699.json:
```json
{
    "body": "<a id='comment:23'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321699",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_194412.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194412"
}
```



---

archive/issue_events_194413.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194413"
}
```



---

archive/issue_events_194414.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:55:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194414"
}
```



---

archive/issue_events_194415.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T22:55:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194415"
}
```



---

archive/issue_comments_321700.json:
```json
{
    "body": "<a id='comment:25'></a>\nThe run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.",
    "created_at": "2020-01-15T23:36:44Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321700",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.



---

archive/issue_comments_321701.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [mkoeppe](#comment%3A17):\n> Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.\n\n\nAs an extension of this, there could be `sage --buildsh SPKG`, which would set up the environment in which `spkg-install` runs. This could be useful for testing new versions of packages.",
    "created_at": "2020-01-15T23:55:47Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321701",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Replying to [mkoeppe](#comment%3A17):
> Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.


As an extension of this, there could be `sage --buildsh SPKG`, which would set up the environment in which `spkg-install` runs. This could be useful for testing new versions of packages.



---

archive/issue_comments_321702.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [mkoeppe](#comment%3A25):\n> The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.\n\nOr #29038 - Python package sage_conf: Provides optional configuration information for sagelib",
    "created_at": "2020-01-18T19:20:14Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321702",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Replying to [mkoeppe](#comment%3A25):
> The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.

Or #29038 - Python package sage_conf: Provides optional configuration information for sagelib



---

archive/issue_events_194416.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T17:12:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194416"
}
```



---

archive/issue_events_194417.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T17:12:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194417"
}
```



---

archive/issue_events_194418.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T17:12:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194418"
}
```



---

archive/issue_comments_321703.json:
```json
{
    "body": "**Changing dependencies** from \"#25130\" to \"#29038\".",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321703",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#25130" to "#29038".



---

archive/issue_comments_321704.json:
```json
{
    "body": "**Changing branch** from \"[public/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/public/split_sage_env_into_sage_build_env_and_sage_env)\" to \"\".",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321704",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[public/split_sage_env_into_sage_build_env_and_sage_env](https://github.com/sagemath/sagetrac-mirror/tree/public/split_sage_env_into_sage_build_env_and_sage_env)" to "".



---

archive/issue_comments_321705.json:
```json
{
    "body": "**Changing commit** from \"[ff0712125a3d05500a1f77e62c371d695d1a9794](https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794)\" to \"\".",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321705",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[ff0712125a3d05500a1f77e62c371d695d1a9794](https://github.com/sagemath/sagetrac-mirror/commit/ff0712125a3d05500a1f77e62c371d695d1a9794)" to "".



---

archive/issue_events_194419.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-19T17:12:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "rename": {
        "from": "Split sage-env into sage-build-env and sage-env",
        "to": "Split sage-env into 5"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194419"
}
```



---

archive/issue_comments_321706.json:
```json
{
    "body": "<a id='comment:28'></a>\nHoping for input from people involved in packaging.",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321706",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Hoping for input from people involved in packaging.



---

archive/issue_comments_321707.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,28 @@\n-`sage-env` is used by both Sage-the-distribution while building packages,\n-and by Sage at runtime.\n+`src/bin/sage-env` (with generated configuration in `src/bin/sage-env-config`; installed in `$SAGE_LOCAL/bin`) is used in all of the following contexts: \n+1. Sage-the-distribution while building spkgs,\n+2. Sage-the-distribution for building sagelib,\n+3. for environment variables needed to start Sage,\n+4. as variables by Sage at runtime (through `sage.env`), and\n+5. for environment variables affecting subprocesses of Python invoked by sagelib modules. \n \n-It should be split into two or three separate scripts.\n-- `sage-build-env` is for the **build-time environment variables for sage-the-distribution**, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`\n-- `sagelib-build-env` is for the **build-time environment variables for sagelib** \n-- `sage-env` is for the **run-time environment variables of sage** and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n+This ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.\n \n-This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.\n+1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n+   a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.\n+   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`.\n+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1. (Note that not all compiler-related environment variables can be moved exclusively to 1 \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)\n+   d. Eventually, we will remove the call to `src/bin/sage-env`.\n \n+2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n+   a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.\n+   b. Pass `SAGE_PKGS` (if still needed at all - see #28815) via `sage-config` instead of from `src/Makefile`.\n+\n+3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).\n+a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.\n+b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n+c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n+d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n+\n+Related: \n+- cleaning of `src/bin` as described in #21569, #21570, #21559.\n+- sagelib as a standalone Python library - #21507)\n``````\n",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321707",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,28 @@
-`sage-env` is used by both Sage-the-distribution while building packages,
-and by Sage at runtime.
+`src/bin/sage-env` (with generated configuration in `src/bin/sage-env-config`; installed in `$SAGE_LOCAL/bin`) is used in all of the following contexts: 
+1. Sage-the-distribution while building spkgs,
+2. Sage-the-distribution for building sagelib,
+3. for environment variables needed to start Sage,
+4. as variables by Sage at runtime (through `sage.env`), and
+5. for environment variables affecting subprocesses of Python invoked by sagelib modules. 
 
-It should be split into two or three separate scripts.
-- `sage-build-env` is for the **build-time environment variables for sage-the-distribution**, should go into `build/bin` and not be installed. Or perhaps more stuff should be put into `build/make/install`
-- `sagelib-build-env` is for the **build-time environment variables for sagelib** 
-- `sage-env` is for the **run-time environment variables of sage** and should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. (`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)
+This ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.
 
-This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.
+1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
+   a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.
+   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`.
+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1. (Note that not all compiler-related environment variables can be moved exclusively to 1 â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)
+   d. Eventually, we will remove the call to `src/bin/sage-env`.
 
+2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
+   a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.
+   b. Pass `SAGE_PKGS` (if still needed at all - see #28815) via `sage-config` instead of from `src/Makefile`.
+
+3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).
+a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.
+b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
+c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
+d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.
+
+Related: 
+- cleaning of `src/bin` as described in #21569, #21570, #21559.
+- sagelib as a standalone Python library - #21507)
``````




---

archive/issue_events_194420.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:20:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194420"
}
```



---

archive/issue_events_194421.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-20T14:20:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194421"
}
```



---

archive/issue_comments_321708.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,8 +9,8 @@\n \n 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.\n-   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`.\n-   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1. (Note that not all compiler-related environment variables can be moved exclusively to 1 \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)\n+   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`. This is #29052.\n+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)\n    d. Eventually, we will remove the call to `src/bin/sage-env`.\n \n 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n``````\n",
    "created_at": "2020-01-20T14:51:35Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321708",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,8 +9,8 @@
 
 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.
-   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`.
-   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1. (Note that not all compiler-related environment variables can be moved exclusively to 1 â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)
+   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`. This is #29052.
+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)
    d. Eventually, we will remove the call to `src/bin/sage-env`.
 
 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
``````




---

archive/issue_comments_321709.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n \n 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.\n-   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`. This is #29052.\n+   b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.\n    c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)\n    d. Eventually, we will remove the call to `src/bin/sage-env`.\n \n``````\n",
    "created_at": "2020-01-20T15:15:55Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321709",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 
 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.
-   b. In `build/make/deps`, call `build/bin/sage-build-env` instead of `src/bin/sage-env`. This is #29052.
+   b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.
    c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)
    d. Eventually, we will remove the call to `src/bin/sage-env`.
 
``````




---

archive/issue_comments_321710.json:
```json
{
    "body": "**Changing dependencies** from \"#29038\" to \"#29038, #29052\".",
    "created_at": "2020-01-20T17:30:54Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321710",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#29038" to "#29038, #29052".



---

archive/issue_events_194422.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-31T14:05:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "rename": {
        "from": "Split sage-env into 5",
        "to": "Meta-ticket: Split sage-env into 5 to clean up sage configuration"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194422"
}
```



---

archive/issue_comments_321711.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,6 +23,15 @@\n c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n \n-Related: \n+**Aspects of downstream sage packaging:**\n+\n+- The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.\n+- Downstream packagers would provide their own \"implementation\" (one Python module `sage_conf.py`) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.\n+\n+**Relation to the goal of sagelib as a standalone Python library** (#21507)\n+\n+- An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.\n+\n+**More related tickets:**\n - cleaning of `src/bin` as described in #21569, #21570, #21559.\n-- sagelib as a standalone Python library - #21507)\n+\n``````\n",
    "created_at": "2020-01-31T21:02:59Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321711",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,6 +23,15 @@
 c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
 d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.
 
-Related: 
+**Aspects of downstream sage packaging:**
+
+- The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.
+- Downstream packagers would provide their own "implementation" (one Python module `sage_conf.py`) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.
+
+**Relation to the goal of sagelib as a standalone Python library** (#21507)
+
+- An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.
+
+**More related tickets:**
 - cleaning of `src/bin` as described in #21569, #21570, #21559.
-- sagelib as a standalone Python library - #21507)
+
``````




---

archive/issue_comments_321712.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,7 +26,7 @@\n **Aspects of downstream sage packaging:**\n \n - The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.\n-- Downstream packagers would provide their own \"implementation\" (one Python module `sage_conf.py`) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.\n+- Downstream packagers would provide their own \"implementation\" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.\n \n **Relation to the goal of sagelib as a standalone Python library** (#21507)\n \n``````\n",
    "created_at": "2020-01-31T23:49:09Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321712",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,7 +26,7 @@
 **Aspects of downstream sage packaging:**
 
 - The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.
-- Downstream packagers would provide their own "implementation" (one Python module `sage_conf.py`) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.
+- Downstream packagers would provide their own "implementation" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.
 
 **Relation to the goal of sagelib as a standalone Python library** (#21507)
 
``````




---

archive/issue_comments_321713.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.\n    b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.\n-   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)\n+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! \n    d. Eventually, we will remove the call to `src/bin/sage-env`.\n \n 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n``````\n",
    "created_at": "2020-03-29T00:49:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321713",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
    a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.
    b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.
-   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.)
+   c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! 
    d. Eventually, we will remove the call to `src/bin/sage-env`.
 
 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
``````




---

archive/issue_events_194423.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T00:49:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194423"
}
```



---

archive/issue_events_194424.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-29T00:49:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194424"
}
```



---

archive/issue_comments_321714.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,6 +19,7 @@\n \n 3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).\n a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.\n+   - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`\n b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n``````\n",
    "created_at": "2020-04-10T22:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321714",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,6 +19,7 @@
 
 3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).
 a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.
+   - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`
 b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
 c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
 d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.
``````




---

archive/issue_events_194425.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:54:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194425"
}
```



---

archive/issue_events_194426.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:54:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194426"
}
```



---

archive/issue_comments_321715.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,4 +35,4 @@\n \n **More related tickets:**\n - cleaning of `src/bin` as described in #21569, #21570, #21559.\n-\n+- #29133 META-META-TICKET: Build, packaging, testing improvements\n``````\n",
    "created_at": "2020-05-01T17:44:03Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321715",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,4 +35,4 @@
 
 **More related tickets:**
 - cleaning of `src/bin` as described in #21569, #21570, #21559.
-
+- #29133 META-META-TICKET: Build, packaging, testing improvements
``````




---

archive/issue_comments_321716.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd109\".",
    "created_at": "2020-05-27T15:55:55Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321716",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "" to "sd109".



---

archive/issue_comments_321717.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,4 +35,5 @@\n \n **More related tickets:**\n - cleaning of `src/bin` as described in #21569, #21570, #21559.\n+- #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`\n - #29133 META-META-TICKET: Build, packaging, testing improvements\n``````\n",
    "created_at": "2020-06-07T21:58:42Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321717",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,4 +35,5 @@
 
 **More related tickets:**
 - cleaning of `src/bin` as described in #21569, #21570, #21559.
+- #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`
 - #29133 META-META-TICKET: Build, packaging, testing improvements
``````




---

archive/issue_comments_321718.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,11 +15,14 @@\n \n 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n    a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.\n-   b. Pass `SAGE_PKGS` (if still needed at all - see #28815) via `sage-config` instead of from `src/Makefile`.\n+   - #29411: make sagelib a script package\n+   - #29779: `pkg-config` installed from SPKG `pkgconf` should not depend on environment variable `SAGE_LOCAL`\n+   b. Pass `SAGE_PKGS` (if still needed at all - see #28815 or #29705) via `sage-config` instead of from `src/Makefile`.\n \n 3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).\n a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.\n    - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`\n+   - #29825: Clean-up for src/bin/sage-env\n b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n``````\n",
    "created_at": "2020-06-09T05:52:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321718",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,11 +15,14 @@
 
 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
    a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.
-   b. Pass `SAGE_PKGS` (if still needed at all - see #28815) via `sage-config` instead of from `src/Makefile`.
+   - #29411: make sagelib a script package
+   - #29779: `pkg-config` installed from SPKG `pkgconf` should not depend on environment variable `SAGE_LOCAL`
+   b. Pass `SAGE_PKGS` (if still needed at all - see #28815 or #29705) via `sage-config` instead of from `src/Makefile`.
 
 3./4./5. Using `sage_conf` (Python module and script `sage-config`, #29038), make `sage.all` fully functional when imported from a Python, without setting any environment variables (`sage-env`).
 a. Initially, phase out `src/bin/sage-env-config` by using `sage-config` instead.
    - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`
+   - #29825: Clean-up for src/bin/sage-env
 b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
 c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
 d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.
``````




---

archive/issue_comments_321719.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,11 +30,13 @@\n **Aspects of downstream sage packaging:**\n \n - The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.\n-- Downstream packagers would provide their own \"implementation\" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.\n+   - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036\t(pip-installable sage)\n+- Downstream packagers could provide their own \"implementation\" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.\n \n **Relation to the goal of sagelib as a standalone Python library** (#21507)\n \n - An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.\n+  - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)\n \n **More related tickets:**\n - cleaning of `src/bin` as described in #21569, #21570, #21559.\n``````\n",
    "created_at": "2020-07-13T18:48:35Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321719",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,11 +30,13 @@
 **Aspects of downstream sage packaging:**
 
 - The goal is to enable downstream sage packagers to use a whole unmodified `src` directory to build and install sagelib.
-- Downstream packagers would provide their own "implementation" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would *not* use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution only.
+   - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036	(pip-installable sage)
+- Downstream packagers could provide their own "implementation" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.
 
 **Relation to the goal of sagelib as a standalone Python library** (#21507)
 
 - An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.
+  - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)
 
 **More related tickets:**
 - cleaning of `src/bin` as described in #21569, #21570, #21559.
``````




---

archive/issue_comments_321720.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -39,6 +39,6 @@\n   - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)\n \n **More related tickets:**\n-- cleaning of `src/bin` as described in #21569, #21570, #21559.\n+- cleaning of `src/bin` as described in #21570, #21559.\n - #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`\n - #29133 META-META-TICKET: Build, packaging, testing improvements\n``````\n",
    "created_at": "2020-07-13T19:21:26Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321720",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -39,6 +39,6 @@
   - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)
 
 **More related tickets:**
-- cleaning of `src/bin` as described in #21569, #21570, #21559.
+- cleaning of `src/bin` as described in #21570, #21559.
 - #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`
 - #29133 META-META-TICKET: Build, packaging, testing improvements
``````




---

archive/issue_comments_321721.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -41,4 +41,5 @@\n **More related tickets:**\n - cleaning of `src/bin` as described in #21570, #21559.\n - #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`\n+- #30724: `src/bin/sage-env`, `src/bin/sage-env-config.in`: Remove PYTHON_FOR_VENV\n - #29133 META-META-TICKET: Build, packaging, testing improvements\n``````\n",
    "created_at": "2020-10-06T18:35:33Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321721",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -41,4 +41,5 @@
 **More related tickets:**
 - cleaning of `src/bin` as described in #21570, #21559.
 - #25486: Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables - this adds a `SAGE_ROOT` variable to `sage-env-config`
+- #30724: `src/bin/sage-env`, `src/bin/sage-env-config.in`: Remove PYTHON_FOR_VENV
 - #29133 META-META-TICKET: Build, packaging, testing improvements
``````




---

archive/issue_comments_321722.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,6 +25,8 @@\n    - #29825: Clean-up for src/bin/sage-env\n b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n+   - #30563: Use configuration variable `MAXIMA` instead of hardcoding \"maxima\" \n+   - #30818 Set environment for subprocesses invoked by Sage\n d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.\n \n **Aspects of downstream sage packaging:**\n``````\n",
    "created_at": "2020-10-23T21:15:55Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321722",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,6 +25,8 @@
    - #29825: Clean-up for src/bin/sage-env
 b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
 c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
+   - #30563: Use configuration variable `MAXIMA` instead of hardcoding "maxima" 
+   - #30818 Set environment for subprocesses invoked by Sage
 d. Finally, remove use of `sage-env` for all purposes except for `sage -sh`.
 
 **Aspects of downstream sage packaging:**
``````




---

archive/issue_comments_321723.json:
```json
{
    "body": "<a id='comment:49'></a>\nNot sure if this is the right place, but I would suggest to use the refactoring process to also convert the environment variables to configuration files. \n\nThe idea would be to have a `toml` file (or `yaml` or whatever you prefer) in some predefined folder (say `src` for the start). This file could be generated e.g by the `configure` script. This config file is then parsed and wrapped by a python class (natural candidate would be the current `sage_conf.py`). The python class also provides reasonable default values in case the config file doesn't exist. \n\nThis has several advantages in my opinion:\n- More transparent, as one sees on one glance which variables influence sage.\n- Easily editable by the user/developer.\n- Local (e.g. think about multiple virtual environments with different configs).\n- Type-safe, i.e, it is ensured when parsing the toml file that the types of the config variables is correct.\n- Easier for downstream package managers, since they only need to provide a proper config file.\n- (Higher security as one cannot inject arbitrary python code, which would be the case if `sage_conf.py` should be edited.)\n\nWhat do you think?",
    "created_at": "2020-10-23T22:22:07Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321723",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:49'></a>
Not sure if this is the right place, but I would suggest to use the refactoring process to also convert the environment variables to configuration files. 

The idea would be to have a `toml` file (or `yaml` or whatever you prefer) in some predefined folder (say `src` for the start). This file could be generated e.g by the `configure` script. This config file is then parsed and wrapped by a python class (natural candidate would be the current `sage_conf.py`). The python class also provides reasonable default values in case the config file doesn't exist. 

This has several advantages in my opinion:
- More transparent, as one sees on one glance which variables influence sage.
- Easily editable by the user/developer.
- Local (e.g. think about multiple virtual environments with different configs).
- Type-safe, i.e, it is ensured when parsing the toml file that the types of the config variables is correct.
- Easier for downstream package managers, since they only need to provide a proper config file.
- (Higher security as one cannot inject arbitrary python code, which would be the case if `sage_conf.py` should be edited.)

What do you think?



---

archive/issue_comments_321724.json:
```json
{
    "body": "<a id='comment:50'></a>\n`sage_conf` defines an interface already - and the plan is indeed to get rid of dependencies on environment variables using this interface.\n\nHow `sage_conf` obtains the configuration is orthogonal to the defined interface.\n\nI am not interested in defining configuration files at the moment.  There is just too much potential on wasting energy on discussions regarding the \"best\" config file format.",
    "created_at": "2020-10-23T22:37:07Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321724",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
`sage_conf` defines an interface already - and the plan is indeed to get rid of dependencies on environment variables using this interface.

How `sage_conf` obtains the configuration is orthogonal to the defined interface.

I am not interested in defining configuration files at the moment.  There is just too much potential on wasting energy on discussions regarding the "best" config file format.



---

archive/issue_events_194427.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194427"
}
```



---

archive/issue_events_194428.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194428"
}
```



---

archive/issue_comments_321725.json:
```json
{
    "body": "<a id='comment:52'></a>\nWell, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`). One could easily bypass an extensive discussion and follow the arguments of https://www.python.org/dev/peps/pep-0518/#overview-of-file-formats-considered.\n\nBut I agree that my suggestion concerning a config file is somewhat out of line with the goal of this ticket. I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing.",
    "created_at": "2020-10-25T10:37:39Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321725",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:52'></a>
Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`). One could easily bypass an extensive discussion and follow the arguments of https://www.python.org/dev/peps/pep-0518/#overview-of-file-formats-considered.

But I agree that my suggestion concerning a config file is somewhat out of line with the goal of this ticket. I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing.



---

archive/issue_comments_321726.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [gh-tobiasdiez](#comment%3A52):\n> Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`).\n\n\nNote that `sage_conf.py` is already in use since Sage 9.1",
    "created_at": "2020-10-25T15:15:54Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321726",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
Replying to [gh-tobiasdiez](#comment%3A52):
> Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`).


Note that `sage_conf.py` is already in use since Sage 9.1



---

archive/issue_comments_321727.json:
```json
{
    "body": "<a id='comment:54'></a>\nReplying to [gh-tobiasdiez](#comment%3A52):\n> I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing. \n\n\nAll of this discussion is certainly valid and I am sure that you (and others) have valuable insights there, but now is simply not the right time for it. To get the design right, one needs to know about objectives and constraints. We are in the process of expanding the ways of Sage installation/deployment into several directions, including pip-installability and modularization; and also binary packaging will need an overhaul.",
    "created_at": "2020-10-25T15:22:39Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321727",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
Replying to [gh-tobiasdiez](#comment%3A52):
> I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing. 


All of this discussion is certainly valid and I am sure that you (and others) have valuable insights there, but now is simply not the right time for it. To get the design right, one needs to know about objectives and constraints. We are in the process of expanding the ways of Sage installation/deployment into several directions, including pip-installability and modularization; and also binary packaging will need an overhaul.



---

archive/issue_comments_321728.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,10 +8,9 @@\n This ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.\n \n 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. \n-   a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.\n-   b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.\n+   b. In `build/make/Makefile.in` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.\n    c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. \u2013 some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! \n-   d. Eventually, we will remove the call to `src/bin/sage-env`.\n+   d. Eventually, we will remove the call to `src/bin/sage-env` from the build scripts.\n \n 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). \n    a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.\n``````\n",
    "created_at": "2020-12-15T01:41:59Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321728",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,10 +8,9 @@
 This ticket proposes to split the configuration according to these 5 contexts. This will make the installation of Sage more modular and flexible.
 
 1./2. Create `build/bin/sage-build-env`(with generated configuration in `build/bin/sage-build-env-config`) for the build-time environment variables for sage-the-distribution (spkg and sagelib). It is not installed in $SAGE_LOCAL. 
-   a. Initially, `build/bin/sage-env` will call `src/bin/sage-env`.
-   b. In `build/make/deps` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.
+   b. In `build/make/Makefile.in` and the scripts generated by `build/bin/sage-spkg`, source `build/bin/sage-build-env` in addition to `src/bin/sage-env`. This is #29052.
    c. Gradually, we will move settings from `src/bin/sage-env[-config]` to `build/bin/sage-build-env[-config]` that are known to be only needed for 1./2. (Note that not all compiler-related environment variables can be moved exclusively to 1./2. â€“ some need to be added to 5 as well for some some calls to compilers needed at runtime to support things like `%cython` (?) and `sage.calculus.desolvers.desolve_mintides`.) As well as users' use of `pip` to install additional Python packages! 
-   d. Eventually, we will remove the call to `src/bin/sage-env`.
+   d. Eventually, we will remove the call to `src/bin/sage-env` from the build scripts.
 
 2./3. Obtain sagelib's build-time configuration such as `src/setup.py`'s `library_dirs` and runtime information (`sage.env`) from `sage-config` (introduced in #29038). 
    a. In `src/Makefile`, poison the `SAGE_LOCAL` variable.
``````




---

archive/issue_comments_321729.json:
```json
{
    "body": "<a id='comment:56'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321729",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_194429.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194429"
}
```



---

archive/issue_events_194430.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194430"
}
```



---

archive/issue_comments_321730.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -34,10 +34,14 @@\n    - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036\t(pip-installable sage)\n - Downstream packagers could provide their own \"implementation\" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.\n \n-**Relation to the goal of sagelib as a standalone Python library** (#21507)\n+**Binary packages:**\n \n-- An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.\n-  - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)\n+- #31417 version of package `sage_conf` for relocatable binary distributions\n+\n+**pip-installable Sage**\n+\n+- #29039 pip-installable version of package `sage_conf` - installs non-Python bits of the Sage distribution in `~/.sage/`\n+- #31396 relocatable wheel version of package `sage_conf`\n \n **More related tickets:**\n - cleaning of `src/bin` as described in #21570, #21559.\n``````\n",
    "created_at": "2021-02-20T03:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321730",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -34,10 +34,14 @@
    - more precisely, to use the pip-installable source package created by `build/pkgs/sagelib/spkg-src` (#29950); see also #30036	(pip-installable sage)
 - Downstream packagers could provide their own "implementation" (one Python module [sage_conf.py](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/sage_conf/src/sage_conf.py.in?id=1c5d011b5f05a954dd2ea810635c9d59cc48e7b5)) of the configuration module defined by #29038, instead of patching sources. They would not necessarily use the reference implementation in `build/pkgs/sage_conf`, which is intended for use with sage-the-distribution.
 
-**Relation to the goal of sagelib as a standalone Python library** (#21507)
+**Binary packages:**
 
-- An sdist of sagelib, intended to be installed from source from PyPI, could package or depend on another implementation of `sage_conf` that calls an autoconf-generated configure script (which reuses parts of the build/pkgs/SPKG/spkg-configure.m4 infrastructure); see #29119.
-  - for example, by delegating this behavior to a pip-installable package `sage_bootstrap` (#29039)
+- #31417 version of package `sage_conf` for relocatable binary distributions
+
+**pip-installable Sage**
+
+- #29039 pip-installable version of package `sage_conf` - installs non-Python bits of the Sage distribution in `~/.sage/`
+- #31396 relocatable wheel version of package `sage_conf`
 
 **More related tickets:**
 - cleaning of `src/bin` as described in #21570, #21559.
``````




---

archive/issue_events_194431.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194431"
}
```



---

archive/issue_events_194432.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194432"
}
```



---

archive/issue_comments_321731.json:
```json
{
    "body": "<a id='comment:58'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321731",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_321732.json:
```json
{
    "body": "<a id='comment:59'></a>\nFrom the discussion in #32904 regarding `sage_conf` at build time (with pip's build isolation) vs. runtime:\n- pip specifies \"ignore-installed\" while constructing the build environment and thus will build sage-conf twice. https://github.com/pypa/pip/blob/main/src/pip/_internal/build_env.py#L221\n- The PyPI version `sage_conf` (from #29039) keys the `SAGE_ROOT`/`SAGE_LOCAL` that it creates in `~/.sage` to the version of `sage_conf`\n- So if the `sage_conf` version is not completely pinned in the `sagemath-standard` build and install requirements, then different versions (and thus `SAGE_ROOT`s) may end up being used at build and install of `sagemath-standard`",
    "created_at": "2021-12-05T20:10:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321732",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
From the discussion in #32904 regarding `sage_conf` at build time (with pip's build isolation) vs. runtime:
- pip specifies "ignore-installed" while constructing the build environment and thus will build sage-conf twice. https://github.com/pypa/pip/blob/main/src/pip/_internal/build_env.py#L221
- The PyPI version `sage_conf` (from #29039) keys the `SAGE_ROOT`/`SAGE_LOCAL` that it creates in `~/.sage` to the version of `sage_conf`
- So if the `sage_conf` version is not completely pinned in the `sagemath-standard` build and install requirements, then different versions (and thus `SAGE_ROOT`s) may end up being used at build and install of `sagemath-standard`



---

archive/issue_comments_321733.json:
```json
{
    "body": "<a id='comment:60'></a>\nFrom [#32904 comment:24](https://github.com/sagemath/sage/issues/32904#comment:24):\n- Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at built time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.",
    "created_at": "2021-12-05T20:17:54Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
From [#32904 comment:24](https://github.com/sagemath/sage/issues/32904#comment:24):
- Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at built time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.



---

archive/issue_comments_321734.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [mkoeppe](#comment%3A60):\n> From gh-tobiasdiez in [#32904 comment:24](https://github.com/sagemath/sage/issues/32904#comment:24):\n> - Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at build time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.\n\n\nI think this is an interesting direction",
    "created_at": "2021-12-05T20:19:52Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321734",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>
Replying to [mkoeppe](#comment%3A60):
> From gh-tobiasdiez in [#32904 comment:24](https://github.com/sagemath/sage/issues/32904#comment:24):
> - Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at build time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.


I think this is an interesting direction



---

archive/issue_events_194433.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194433"
}
```



---

archive/issue_events_194434.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194434"
}
```



---

archive/issue_events_194435.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194435"
}
```



---

archive/issue_events_194436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194436"
}
```



---

archive/issue_comments_321735.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,6 +23,7 @@\n    - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`\n    - #29825: Clean-up for src/bin/sage-env\n b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`\n+   - #34236 `sage.env`: Give values from `sage_conf` precedence over environment variables\n c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`\n    - #30563: Use configuration variable `MAXIMA` instead of hardcoding \"maxima\" \n    - #30818 Set environment for subprocesses invoked by Sage\n``````\n",
    "created_at": "2022-07-28T22:05:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21707#issuecomment-321735",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,6 +23,7 @@
    - #29384: Clean up `src/bin/sage-env-config.in`: Move logic to `src/bin/sage-env`, move non-environment configuration variables to `sage_conf.py`
    - #29825: Clean-up for src/bin/sage-env
 b. Set `sage.env` variables via the Python module `sage_conf` instead of relying on information from environment variables. Example: `CYSIGNALS_CRASH_DAYS`
+   - #34236 `sage.env`: Give values from `sage_conf` precedence over environment variables
 c. Set environment variables that are needed only by subprocesses invoked by sagelib in the environment of these subprocesses, rather than relying on them begin set in `sage-env`. This environment could be provided by a variable `sage_conf.SAGE_SUBPROCESS_ENV` and/or more invidual variables. Example: `R_PROFILE`
    - #30563: Use configuration variable `MAXIMA` instead of hardcoding "maxima" 
    - #30818 Set environment for subprocesses invoked by Sage
``````




---

archive/issue_events_194437.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194437"
}
```



---

archive/issue_events_194438.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21707",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21707#event-194438"
}
```
