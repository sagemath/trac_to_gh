# Issue 21393: Partial bindings for Arb polynomials with complex coefficients

archive/issues_021156.json:
```json
{
    "body": "(with plenty of opportunities for optimization, but already much better than the generic code)\n\nCC:  @cheuberg @fredrik-johansson @dkrenn\n\nBranch/Commit: 70599cc29d18444b215254c1c540a5d86b3b2e2e\n\nReviewer: Travis Scrimshaw\n\nAuthor: Marc Mezzarobba\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21393\n\n",
    "closed_at": "2016-12-05T00:44:29Z",
    "created_at": "2016-09-01T16:00:07Z",
    "labels": [
        "component: commutative algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Partial bindings for Arb polynomials with complex coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21393",
    "user": "https://github.com/mezzarobba"
}
```
(with plenty of opportunities for optimization, but already much better than the generic code)

CC:  @cheuberg @fredrik-johansson @dkrenn

Branch/Commit: 70599cc29d18444b215254c1c540a5d86b3b2e2e

Reviewer: Travis Scrimshaw

Author: Marc Mezzarobba

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21393





---

archive/issue_comments_292761.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-04T08:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292762.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-04T09:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292762",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_292763.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-05T12:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292764.json:
```json
{
    "body": "<a id='comment:5'></a>What is the point of all these methods raising `NotImplementedError`?",
    "created_at": "2016-09-13T21:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292764",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>What is the point of all these methods raising `NotImplementedError`?



---

archive/issue_comments_292765.json:
```json
{
    "body": "<a id='comment:6'></a>You could check that `power_trunc` does work where `_power_trunc` has some overflow.",
    "created_at": "2016-09-13T21:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292765",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>You could check that `power_trunc` does work where `_power_trunc` has some overflow.



---

archive/issue_comments_292766.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-13T21:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292766",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_292767.json:
```json
{
    "body": "<a id='comment:8'></a>Hi Vincent,\n\nThanks for your comments.\n\nReplying to [comment:5 vdelecroix]:\n> What is the point of all these methods raising `NotImplementedError`?\n\n\nDocumentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.\n\nReplying to [comment:6 vdelecroix]:\n> You could check that `power_trunc` does work where `_power_trunc` has some overflow.\n\n\nGuessing you're thinking of `pol.power_trunc(very_large, small)`: no, it doesn't, because `polynomial_element.Polynomial` calls `_cmp_` on the coefficients calls `_cmp_` to check for equality, and that doesn't work with balls. There's a general problem here that goes well beyond the scope of this ticket. I could perhaps redefine comparison methods for polynomials with ball coefficients as a workaround, but I'd prefer to keep that for a separate ticket if you don't mind.",
    "created_at": "2016-09-14T07:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292767",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:8'></a>Hi Vincent,

Thanks for your comments.

Replying to [comment:5 vdelecroix]:
> What is the point of all these methods raising `NotImplementedError`?


Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.

Replying to [comment:6 vdelecroix]:
> You could check that `power_trunc` does work where `_power_trunc` has some overflow.


Guessing you're thinking of `pol.power_trunc(very_large, small)`: no, it doesn't, because `polynomial_element.Polynomial` calls `_cmp_` on the coefficients calls `_cmp_` to check for equality, and that doesn't work with balls. There's a general problem here that goes well beyond the scope of this ticket. I could perhaps redefine comparison methods for polynomials with ball coefficients as a workaround, but I'd prefer to keep that for a separate ticket if you don't mind.



---

archive/issue_comments_292768.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-14T07:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292768",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_292769.json:
```json
{
    "body": "<a id='comment:9'></a>Hi Marc,\n\nReplying to [comment:8 mmezzarobba]:\n> Hi Vincent,\n> \n> Thanks for your comments.\n> \n> Replying to [comment:5 vdelecroix]:\n> > What is the point of all these methods raising `NotImplementedError`?\n\n> \n> Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.\n\n\nThe problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.\n\n> Replying to [comment:6 vdelecroix]:\n> > You could check that `power_trunc` does work where `_power_trunc` has some overflow.\n\n> \n> Guessing you're thinking of `pol.power_trunc(very_large, small)`: no, it doesn't, because `polynomial_element.Polynomial` calls `_cmp_` on the coefficients calls `_cmp_` to check for equality, and that doesn't work with balls. There's a general problem here that goes well beyond the scope of this ticket. I could perhaps redefine comparison methods for polynomials with ball coefficients as a workaround, but I'd prefer to keep that for a separate ticket if you don't mind.\n\n\nWhere in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.",
    "created_at": "2016-09-14T07:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292769",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Hi Marc,

Replying to [comment:8 mmezzarobba]:
> Hi Vincent,
> 
> Thanks for your comments.
> 
> Replying to [comment:5 vdelecroix]:
> > What is the point of all these methods raising `NotImplementedError`?

> 
> Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.


The problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.

> Replying to [comment:6 vdelecroix]:
> > You could check that `power_trunc` does work where `_power_trunc` has some overflow.

> 
> Guessing you're thinking of `pol.power_trunc(very_large, small)`: no, it doesn't, because `polynomial_element.Polynomial` calls `_cmp_` on the coefficients calls `_cmp_` to check for equality, and that doesn't work with balls. There's a general problem here that goes well beyond the scope of this ticket. I could perhaps redefine comparison methods for polynomials with ball coefficients as a workaround, but I'd prefer to keep that for a separate ticket if you don't mind.


Where in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.



---

archive/issue_comments_292770.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-14T08:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292771.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 vdelecroix]:\n> > Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.\n\n> \n> The problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.\n\n\nI disagree: on the contrary, methods like `compose_trunc` are methods *of polynomials*, not of polynomials over whatever specific ring. They should ideally be implemented by all subclasses\u2014they just aren't yet. It is much, much better IMO to have a method that doesn't work in all cases but has a docstring specifying what it is supposed to do *whenever* it works (allowing in particular to write generic code) than to have methods that make sense in all cases come and go (or exist but be inconsistent with each other) depending, e.g., what ring you are working on!\n\nBesides, most of the stubs I added are for underscore methods, which the casual user isn't supposed to see in any case. That being said, I tried to improve the docstring of the public one to address your concern. What do you think?\n\n> Where in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.\n\n\nWell, `generic_power_trunc` (which you wrote `:-)`) compares polynomials using `==`, which doesn't work over all coefficient rings, due to the way polynomial comparison is implemented\u2014and to the general mess with comparisons. That's an issue that affects lots of operations with objects with interval or ball coefficients, I don't think it makes much sense to try to document it every time...\n\n---\nNew commits:",
    "created_at": "2016-09-14T08:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292771",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>Replying to [comment:9 vdelecroix]:
> > Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.

> 
> The problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.


I disagree: on the contrary, methods like `compose_trunc` are methods *of polynomials*, not of polynomials over whatever specific ring. They should ideally be implemented by all subclasses—they just aren't yet. It is much, much better IMO to have a method that doesn't work in all cases but has a docstring specifying what it is supposed to do *whenever* it works (allowing in particular to write generic code) than to have methods that make sense in all cases come and go (or exist but be inconsistent with each other) depending, e.g., what ring you are working on!

Besides, most of the stubs I added are for underscore methods, which the casual user isn't supposed to see in any case. That being said, I tried to improve the docstring of the public one to address your concern. What do you think?

> Where in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.


Well, `generic_power_trunc` (which you wrote `:-)`) compares polynomials using `==`, which doesn't work over all coefficient rings, due to the way polynomial comparison is implemented—and to the general mess with comparisons. That's an issue that affects lots of operations with objects with interval or ball coefficients, I don't think it makes much sense to try to document it every time...

---
New commits:



---

archive/issue_comments_292772.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 mmezzarobba]:\n> Replying to [comment:9 vdelecroix]:\n> > > Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.\n\n> > \n> > The problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.\n\n> \n> I disagree: on the contrary, methods like `compose_trunc` are methods *of polynomials*, not of polynomials over whatever specific ring. They should ideally be implemented by all subclasses\u2014they just aren't yet. It is much, much better IMO to have a method that doesn't work in all cases but has a docstring specifying what it is supposed to do *whenever* it works (allowing in particular to write generic code) than to have methods that make sense in all cases come and go (or exist but be inconsistent with each other) depending, e.g., what ring you are working on!\n> \n> Besides, most of the stubs I added are for underscore methods, which the casual user isn't supposed to see in any case. That being said, I tried to improve the docstring of the public one to address your concern. What do you think?\n\n\nAt the end, the difference is\n\n```\nsage: my_object.my_method()  # current version\nAttributeError\nsage: my_object.my_method()  # your version\nNotImplementedError\n```\nI do not see the real plus of what you did. The only reasonable way is to actually implement the generic version.\n\nThat being said, it is good that the base class defines the API for all the subclasses. But Python is not very suited for that purpose. I do not like methods that pretend to exist\n\n```\ndef is_riemann_conjecture_true(self):\n   r\"\"\"\n   Answers whether the Riemann conjecture is valid\n   \"\"\"\n   raise NotImplementedError\n```\n\n> > Where in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.\n\n> \n> Well, `generic_power_trunc` (which you wrote `:-)`) compares polynomials using `==`, which doesn't work over all coefficient rings, due to the way polynomial comparison is implemented\u2014and to the general mess with comparisons. That's an issue that affects lots of operations with objects with interval or ball coefficients, I don't think it makes much sense to try to document it every time...\n\n\nThere is only one comparison of polynomials at\n\n```\n# check for idempotence, and store the result otherwise\ncdef Polynomial a = p.truncate(prec)\ncdef Polynomial aa = a._mul_trunc_(a, prec)\nif aa == a:\n    return a\n```\nIf the answer is `False` for the comparison it does not matter at all.",
    "created_at": "2016-09-14T09:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292772",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>Replying to [comment:11 mmezzarobba]:
> Replying to [comment:9 vdelecroix]:
> > > Documentation, mostly: I believe that every time a method can be implemented by several implementation variants of objects of some kind, there should be either a generic implementation or at least a stub raising `NotImplementedError` to specify the method name, arguments and semantics.

> > 
> > The problem with this approach is that you let these methods appear in the tab completion. With a well defined documentation. But these methods just not work. Not very user friendly.

> 
> I disagree: on the contrary, methods like `compose_trunc` are methods *of polynomials*, not of polynomials over whatever specific ring. They should ideally be implemented by all subclasses—they just aren't yet. It is much, much better IMO to have a method that doesn't work in all cases but has a docstring specifying what it is supposed to do *whenever* it works (allowing in particular to write generic code) than to have methods that make sense in all cases come and go (or exist but be inconsistent with each other) depending, e.g., what ring you are working on!
> 
> Besides, most of the stubs I added are for underscore methods, which the casual user isn't supposed to see in any case. That being said, I tried to improve the docstring of the public one to address your concern. What do you think?


At the end, the difference is

```
sage: my_object.my_method()  # current version
AttributeError
sage: my_object.my_method()  # your version
NotImplementedError
```
I do not see the real plus of what you did. The only reasonable way is to actually implement the generic version.

That being said, it is good that the base class defines the API for all the subclasses. But Python is not very suited for that purpose. I do not like methods that pretend to exist

```
def is_riemann_conjecture_true(self):
   r"""
   Answers whether the Riemann conjecture is valid
   """
   raise NotImplementedError
```

> > Where in `power_trunc` you need to perform a call to `_cmp_`!? If some generic methods are broken, it should be mentioned somewhere. Or even overriden with `NotImplementedError`.

> 
> Well, `generic_power_trunc` (which you wrote `:-)`) compares polynomials using `==`, which doesn't work over all coefficient rings, due to the way polynomial comparison is implemented—and to the general mess with comparisons. That's an issue that affects lots of operations with objects with interval or ball coefficients, I don't think it makes much sense to try to document it every time...


There is only one comparison of polynomials at

```
# check for idempotence, and store the result otherwise
cdef Polynomial a = p.truncate(prec)
cdef Polynomial aa = a._mul_trunc_(a, prec)
if aa == a:
    return a
```
If the answer is `False` for the comparison it does not matter at all.



---

archive/issue_comments_292773.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 vdelecroix]:\n> At the end, the difference is\n> \n> ```\n> sage: my_object.my_method()  # current version\n> AttributeError\n> sage: my_object.my_method()  # your version\n> NotImplementedError\n> ```\n> I do not see the real plus of what you did.\n\n\nThe main point is to define the API\u2014both for the user and for implementers of subclasses, as you say yourself. Besides, to me, the first exception means \u201cthere's no such method\u201d, period, while the second one means \u201cthe method makes sense, but doesn't work yet in the case you asked for\u201d. It's no different from having a single generic implementation with several cases, only some of which are implemented.\n\n> That being said, it is good that the base class defines the API for all the subclasses. But Python is not very suited for that purpose.\n\n\nI agree with that `:-(`. And I'm not arguing that one should create such stub methods for things that are not implemented anywhere, only that, when one does implement something in one subclass with the intention that it could be generalized to other subclasses, it is a good idea to add a stub method in the common parent class where it makes sense (assuming there is one).",
    "created_at": "2016-09-14T11:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292773",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:13'></a>Replying to [comment:12 vdelecroix]:
> At the end, the difference is
> 
> ```
> sage: my_object.my_method()  # current version
> AttributeError
> sage: my_object.my_method()  # your version
> NotImplementedError
> ```
> I do not see the real plus of what you did.


The main point is to define the API—both for the user and for implementers of subclasses, as you say yourself. Besides, to me, the first exception means “there's no such method”, period, while the second one means “the method makes sense, but doesn't work yet in the case you asked for”. It's no different from having a single generic implementation with several cases, only some of which are implemented.

> That being said, it is good that the base class defines the API for all the subclasses. But Python is not very suited for that purpose.


I agree with that `:-(`. And I'm not arguing that one should create such stub methods for things that are not implemented anywhere, only that, when one does implement something in one subclass with the intention that it could be generalized to other subclasses, it is a good idea to add a stub method in the common parent class where it makes sense (assuming there is one).



---

archive/issue_comments_292774.json:
```json
{
    "body": "<a id='comment:14'></a>Continuing my reply to [comment:12 vdelecroix]:\n> There is only one comparison of polynomials at\n> \n> ```\n> # check for idempotence, and store the result otherwise\n> cdef Polynomial a = p.truncate(prec)\n> cdef Polynomial aa = a._mul_trunc_(a, prec)\n> if aa == a:\n>     return a\n> ```\n> If the answer is `False` for the comparison it does not matter at all.\n\n\nSure, but that's not the problem. What happens is the following.\n\n```\n/home/marc/co/sage/src/sage/structure/element.pyx in sage.structure.element.Element._richcmp_ (build/cythonized/sage/structure/element.c:9542)()\n    962         cdef int c\n    963         try:\n--> 964             c = left._cmp_(right)\n    965         except NotImplementedError:\n    966             # Check equality by id(), knowing that left is not right\n\n/home/marc/co/sage/src/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial._cmp_ (build/cythonized/sage/rings/polynomial/polynomial_element.c:10924)()\n    948         cdef int c\n    949         for i in reversed(range(d1+1)):\n--> 950             c = cmp(self[i], other[i])\n    951             if c: return c\n    952         return 0\n\n/home/marc/co/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__cmp__ (build/cythonized/sage/structure/element.c:9084)()\n    871             if (<Element>left)._richcmp_(right, Py_EQ):\n    872                 return 0\n--> 873             if (<Element>left)._richcmp_(right, Py_LT):\n    874                 return -1\n    875             if (<Element>left)._richcmp_(right, Py_GT):\n\n/home/marc/co/sage/src/sage/rings/complex_arb.pyx in sage.rings.complex_arb.ComplexBall._richcmp_ (build/cythonized/sage/rings/complex_arb.cpp:13232)()\n   1567 \n   1568         elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:\n-> 1569             raise TypeError(\"No order is defined for ComplexBalls.\")\n   1570 \n   1571     def identical(self, ComplexBall other):\n\nTypeError: No order is defined for ComplexBalls.\n```\n\nI'd say the main issue is that `Polynomial` implements `_cmp_()` rather than `_eq_()`, and does so by calling `cmp()` on the coefficients, even though the coefficient ring may not be totally ordered. But I don't think that's easy to fix, and in any case that's out of scope for this ticket.",
    "created_at": "2016-09-14T12:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292774",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:14'></a>Continuing my reply to [comment:12 vdelecroix]:
> There is only one comparison of polynomials at
> 
> ```
> # check for idempotence, and store the result otherwise
> cdef Polynomial a = p.truncate(prec)
> cdef Polynomial aa = a._mul_trunc_(a, prec)
> if aa == a:
>     return a
> ```
> If the answer is `False` for the comparison it does not matter at all.


Sure, but that's not the problem. What happens is the following.

```
/home/marc/co/sage/src/sage/structure/element.pyx in sage.structure.element.Element._richcmp_ (build/cythonized/sage/structure/element.c:9542)()
    962         cdef int c
    963         try:
--> 964             c = left._cmp_(right)
    965         except NotImplementedError:
    966             # Check equality by id(), knowing that left is not right

/home/marc/co/sage/src/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial._cmp_ (build/cythonized/sage/rings/polynomial/polynomial_element.c:10924)()
    948         cdef int c
    949         for i in reversed(range(d1+1)):
--> 950             c = cmp(self[i], other[i])
    951             if c: return c
    952         return 0

/home/marc/co/sage/src/sage/structure/element.pyx in sage.structure.element.Element.__cmp__ (build/cythonized/sage/structure/element.c:9084)()
    871             if (<Element>left)._richcmp_(right, Py_EQ):
    872                 return 0
--> 873             if (<Element>left)._richcmp_(right, Py_LT):
    874                 return -1
    875             if (<Element>left)._richcmp_(right, Py_GT):

/home/marc/co/sage/src/sage/rings/complex_arb.pyx in sage.rings.complex_arb.ComplexBall._richcmp_ (build/cythonized/sage/rings/complex_arb.cpp:13232)()
   1567 
   1568         elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
-> 1569             raise TypeError("No order is defined for ComplexBalls.")
   1570 
   1571     def identical(self, ComplexBall other):

TypeError: No order is defined for ComplexBalls.
```

I'd say the main issue is that `Polynomial` implements `_cmp_()` rather than `_eq_()`, and does so by calling `cmp()` on the coefficients, even though the coefficient ring may not be totally ordered. But I don't think that's easy to fix, and in any case that's out of scope for this ticket.



---

archive/issue_comments_292775.json:
```json
{
    "body": "<a id='comment:15'></a>Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.",
    "created_at": "2016-09-14T15:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292775",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.



---

archive/issue_comments_292776.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 tscrim]:\n> Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.\n\n\nI'm not sure I understand: the documentation for ``@`abstract_method` says that (i) it is for methods that should be implemented by *all* concrete derived classes (ii) it prevents from using `obj.method?` to access the documentation, while what I think I want is a method (i) that may be implemented by some derived classes only, and (ii) whose docstring can be accessed in the most standard possible way.",
    "created_at": "2016-09-14T15:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292776",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>Replying to [comment:15 tscrim]:
> Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.


I'm not sure I understand: the documentation for ``@`abstract_method` says that (i) it is for methods that should be implemented by *all* concrete derived classes (ii) it prevents from using `obj.method?` to access the documentation, while what I think I want is a method (i) that may be implemented by some derived classes only, and (ii) whose docstring can be accessed in the most standard possible way.



---

archive/issue_comments_292777.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-11T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292778.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 mmezzarobba]:\n> Replying to [comment:15 tscrim]:\n> > Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.\n\n> \n> I'm not sure I understand: the documentation for ``@`abstract_method` says that (i) it is for methods that should be implemented by *all* concrete derived classes (ii) it prevents from using `obj.method?` to access the documentation, while what I think I want is a method (i) that may be implemented by some derived classes only, and (ii) whose docstring can be accessed in the most standard possible way.\n\n\nSorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory. Doing this gives you a way to check if it is implemented (`obj.method == NotImplemented`), which is distinct from if something further down throws a `NotImplementedError`. For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).\n\nHowever, all of those methods, implemented or not, do require at least one doctest.\n\nI also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.\n\nSimilarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).",
    "created_at": "2016-10-12T14:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292778",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>Replying to [comment:16 mmezzarobba]:
> Replying to [comment:15 tscrim]:
> > Some quick comments. Instead of just returning a `NotImplementedError`, you should mark them with the ``@`abstract_method` decorator. That way `TestSuite(foo).run()` will fail saying not all methods are implemented. The doctests would then give a quick example of the working implementation. It at least is somewhat of a way to help get Python to have useful ABCs defining the API.

> 
> I'm not sure I understand: the documentation for ``@`abstract_method` says that (i) it is for methods that should be implemented by *all* concrete derived classes (ii) it prevents from using `obj.method?` to access the documentation, while what I think I want is a method (i) that may be implemented by some derived classes only, and (ii) whose docstring can be accessed in the most standard possible way.


Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory. Doing this gives you a way to check if it is implemented (`obj.method == NotImplemented`), which is distinct from if something further down throws a `NotImplementedError`. For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).

However, all of those methods, implemented or not, do require at least one doctest.

I also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.

Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).



---

archive/issue_comments_292779.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-12T17:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292780.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:19 tscrim]:\n> Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.\n\n\nOh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.\n\n> For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).\n\n\nI still disagree (because even in interactive use, I find it very important to know how general the methods you are calling are, what the siblings of the particular implementation you are calling are supposed to do, etc., so basically anything that makes this information more prominent is good to have from my point of view), but whatever.\n\n> However, all of those methods, implemented or not, do require at least one doctest.\n\n\nAdded. I sometimes wonder how sage survives with such policies `:-/`...\n\n> I also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.\n\n\nI'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).\n\n> Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).\n\n\nI just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).\n\nIMO the only thing that matters in the end are commits\u2014tickets are just there to organize the review. But if you or anyone is willing to review some (reasonably consistent!) subset of the commits on this ticket, please say so, and I'll split the ticket (or just drop the remaining commits).\n\n---\nNew commits:",
    "created_at": "2016-10-12T18:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292780",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:21'></a>Replying to [comment:19 tscrim]:
> Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.


Oh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.

> For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).


I still disagree (because even in interactive use, I find it very important to know how general the methods you are calling are, what the siblings of the particular implementation you are calling are supposed to do, etc., so basically anything that makes this information more prominent is good to have from my point of view), but whatever.

> However, all of those methods, implemented or not, do require at least one doctest.


Added. I sometimes wonder how sage survives with such policies `:-/`...

> I also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.


I'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).

> Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).


I just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).

IMO the only thing that matters in the end are commits—tickets are just there to organize the review. But if you or anyone is willing to review some (reasonably consistent!) subset of the commits on this ticket, please say so, and I'll split the ticket (or just drop the remaining commits).

---
New commits:



---

archive/issue_comments_292781.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-13T15:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292782.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 mmezzarobba]:\n> Replying to [comment:19 tscrim]:\n> > Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.\n\n> \n> Oh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.\n\n\nAh, crap, that's right. You can simply remove them because they (currently) don't work.\n\n> > For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).\n\n> \n> I still disagree (because even in interactive use, I find it very important to know how general the methods you are calling are, what the siblings of the particular implementation you are calling are supposed to do, etc., so basically anything that makes this information more prominent is good to have from my point of view), but whatever.\n\n\nWell, it's moot for this ticket anyways.\n\n> > However, all of those methods, implemented or not, do require at least one doctest.\n\n> \n> Added. I sometimes wonder how sage survives with such policies `:-/`...\n\n\nWell, it usually is a simple thing to do at least, but I can relate.\n\n> > I also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.\n\n> \n> I'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).\n\n\nYou only need to add things that you use into the `pxd` file since the library can handle its own internal calls. I think it makes it harder to maintain (more likely to get conflicts) and understand (more to sift through and confusing about what function to use).\n\n> > Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).\n\n> \n> I just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).\n\n\nIt's not clear that these should be included as part of the API of all polynomials, especially since they are hidden methods. Are they called indirectly by some (public) method of the base polynomial class?\n\n> IMO the only thing that matters in the end are commits\u2014tickets are just there to organize the review. But if you or anyone is willing to review some (reasonably consistent!) subset of the commits on this ticket, please say so, and I'll split the ticket (or just drop the remaining commits).\n\n\nIt's a matter of locality of searching trac tickets, but it's not that big of a deal.",
    "created_at": "2016-10-13T18:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292782",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>Replying to [comment:21 mmezzarobba]:
> Replying to [comment:19 tscrim]:
> > Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.

> 
> Oh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.


Ah, crap, that's right. You can simply remove them because they (currently) don't work.

> > For (ii), that is only when `obj.method` is not implemented by a concrete class, but otherwise it prevents `?` from getting the doc (which, because it is not implemented, it should not IMO).

> 
> I still disagree (because even in interactive use, I find it very important to know how general the methods you are calling are, what the siblings of the particular implementation you are calling are supposed to do, etc., so basically anything that makes this information more prominent is good to have from my point of view), but whatever.


Well, it's moot for this ticket anyways.

> > However, all of those methods, implemented or not, do require at least one doctest.

> 
> Added. I sometimes wonder how sage survives with such policies `:-/`...


Well, it usually is a simple thing to do at least, but I can relate.

> > I also don't see why you need the `_acb_poly_*` methods in the `.pxd` file, you don't call them anywhere in the code.

> 
> I'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).


You only need to add things that you use into the `pxd` file since the library can handle its own internal calls. I think it makes it harder to maintain (more likely to get conflicts) and understand (more to sift through and confusing about what function to use).

> > Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).

> 
> I just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).


It's not clear that these should be included as part of the API of all polynomials, especially since they are hidden methods. Are they called indirectly by some (public) method of the base polynomial class?

> IMO the only thing that matters in the end are commits—tickets are just there to organize the review. But if you or anyone is willing to review some (reasonably consistent!) subset of the commits on this ticket, please say so, and I'll split the ticket (or just drop the remaining commits).


It's a matter of locality of searching trac tickets, but it's not that big of a deal.



---

archive/issue_comments_292783.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-14T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292784.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 tscrim]:\n> > > Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.\n\n> > \n> > Oh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.\n\n> \n> Ah, crap, that's right. You can simply remove them because they (currently) don't work.\n\n\nAs you prefer.\n\n> > I'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).\n\n> \n> You only need to add things that you use into the `pxd` file since the library can handle its own internal calls. I think it makes it harder to maintain (more likely to get conflicts) and understand (more to sift through and confusing about what function to use).\n\n\nSorry, but I disagree again. We're talking about `.pxd` files *under `sage.libs`*: I believe these should reflect the API of the corresponding libraries or sub-libraries. I'm certainly planning to add more code using arb polynomials in the future, and I don't see the point of adding declarations from `acb_poly.h` one by one as I start to use them. Besides, users or external packages based on sage may very well want to call arb functions from cython too.\n\nIn fact, it would likely be a good idea to cut off these cython bindings from sage (once they are complete) and turn them into separate packages on which sage would depend (or work with the library developers to make them part of the upstream package), a bit like people seem to be doing with pari these days.\n\n> > > Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).\n\n> > \n> > I just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).\n\n> \n> It's not clear that these should be included as part of the API of all polynomials, especially since they are hidden methods. Are they called indirectly by some (public) method of the base polynomial class?\n\n\nNot exactly, but they are called (or at least intended to be callable, I don't know how things are standing now) by power series classes. So they certainly are part of the (sage-internal) API of polynomials.\n\nThanks again for your comments!",
    "created_at": "2016-10-14T08:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292784",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:25'></a>Replying to [comment:23 tscrim]:
> > > Sorry for not responding, I seem to have missed your post. In regards to (i), you can do ``@`abstract_method(optional=True)` to make it not mandatory.

> > 
> > Oh, I didn't notice, thanks! However, ``@`abstract_method` doesn't seem to work on Cython code.

> 
> Ah, crap, that's right. You can simply remove them because they (currently) don't work.


As you prefer.

> > I'm not sure I understand. If you're talking about the `.pwd` file under `libs/`, I put the complete API of `acb_poly` there (with some stuff commented e.g. when it depended on types I didn't want to import for no reason).

> 
> You only need to add things that you use into the `pxd` file since the library can handle its own internal calls. I think it makes it harder to maintain (more likely to get conflicts) and understand (more to sift through and confusing about what function to use).


Sorry, but I disagree again. We're talking about `.pxd` files *under `sage.libs`*: I believe these should reflect the API of the corresponding libraries or sub-libraries. I'm certainly planning to add more code using arb polynomials in the future, and I don't see the point of adding declarations from `acb_poly.h` one by one as I start to use them. Besides, users or external packages based on sage may very well want to call arb functions from cython too.

In fact, it would likely be a good idea to cut off these cython bindings from sage (once they are complete) and turn them into separate packages on which sage would depend (or work with the library developers to make them part of the upstream package), a bit like people seem to be doing with pari these days.

> > > Similarly, you don't have any of the `_*_series` methods implemented. If you're trying to set the API for polynomials, I think that is better done on a separate ticket (since you aren't adding those methods here).

> > 
> > I just took the opportunity to take care of the `_*_series` methods that already were implemented in other subclasses of `Polynomial` (cf. the commit message).

> 
> It's not clear that these should be included as part of the API of all polynomials, especially since they are hidden methods. Are they called indirectly by some (public) method of the base polynomial class?


Not exactly, but they are called (or at least intended to be callable, I don't know how things are standing now) by power series classes. So they certainly are part of the (sage-internal) API of polynomials.

Thanks again for your comments!



---

archive/issue_comments_292785.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-17T09:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292786.json:
```json
{
    "body": "<a id='comment:27'></a>(Rebased on top of 7.5\u03b22, no other change.)",
    "created_at": "2016-11-17T09:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292786",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:27'></a>(Rebased on top of 7.5β2, no other change.)



---

archive/issue_comments_292787.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-23T09:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292788.json:
```json
{
    "body": "<a id='comment:29'></a>The py3 plugin complains about `dict.iteritems()`, but I don't think it is appropriate to replace it, since it appears in a context where Cython can optimize it (while it apparently doesn't optimize `items()` or `six.iteritems()`). Any advice?",
    "created_at": "2016-11-23T09:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292788",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:29'></a>The py3 plugin complains about `dict.iteritems()`, but I don't think it is appropriate to replace it, since it appears in a context where Cython can optimize it (while it apparently doesn't optimize `items()` or `six.iteritems()`). Any advice?



---

archive/issue_comments_292789.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-12-02T13:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_292790.json:
```json
{
    "body": "<a id='comment:31'></a>IIRC, `iteritems` is okay in Cython files with Python3. So I believe you can ignore that.\n\nI can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.",
    "created_at": "2016-12-02T15:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292790",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>IIRC, `iteritems` is okay in Cython files with Python3. So I believe you can ignore that.

I can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.



---

archive/issue_comments_292791.json:
```json
{
    "body": "<a id='comment:32'></a>PS - Sorry for letting this drop off my radar.",
    "created_at": "2016-12-02T15:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292791",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>PS - Sorry for letting this drop off my radar.



---

archive/issue_events_056896.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-12-02T15:02:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21393#event-56896"
}
```



---

archive/issue_comments_292792.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:31 tscrim]:\n> I can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.\n\n\nUncommenting them would require additional imports (that's why they were commented out), so I removed them. (This is inconsistent with what we did elsewhere under `sage/libs/arb`, however.)\n\nReplying to [comment:32 tscrim]:\n> PS - Sorry for letting this drop off my radar.\n\n\nNo problem! And thanks a lot for the review.",
    "created_at": "2016-12-02T15:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292792",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:33'></a>Replying to [comment:31 tscrim]:
> I can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.


Uncommenting them would require additional imports (that's why they were commented out), so I removed them. (This is inconsistent with what we did elsewhere under `sage/libs/arb`, however.)

Replying to [comment:32 tscrim]:
> PS - Sorry for letting this drop off my radar.


No problem! And thanks a lot for the review.



---

archive/issue_comments_292793.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-02T15:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292794.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:33 mmezzarobba]:\n> Replying to [comment:31 tscrim]:\n> > I can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.\n\n> \n> Uncommenting them would require additional imports (that's why they were commented out), so I removed them. (This is inconsistent with what we did elsewhere under `sage/libs/arb`, however.)\n\n\nI should have grep'ed rather than look by hand, and I see it in a few other places as well, e.g., `mpfr.pxd`. So you can revert that change and leave them in commented, sorry!",
    "created_at": "2016-12-02T15:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292794",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>Replying to [comment:33 mmezzarobba]:
> Replying to [comment:31 tscrim]:
> > I can accept the `_*_series` in that case. From looking at other files in `sage/libs`, I am okay with the `.pxd` file modulo the commented out lines: Either remove them or uncomment them.

> 
> Uncommenting them would require additional imports (that's why they were commented out), so I removed them. (This is inconsistent with what we did elsewhere under `sage/libs/arb`, however.)


I should have grep'ed rather than look by hand, and I see it in a few other places as well, e.g., `mpfr.pxd`. So you can revert that change and leave them in commented, sorry!



---

archive/issue_comments_292795.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-12-02T15:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_292796.json:
```json
{
    "body": "<a id='comment:37'></a>Done.",
    "created_at": "2016-12-02T15:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292796",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:37'></a>Done.



---

archive/issue_comments_292797.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-02T16:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292797",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_292798.json:
```json
{
    "body": "<a id='comment:38'></a>Thank you.",
    "created_at": "2016-12-02T16:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292798",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>Thank you.



---

archive/issue_comments_292799.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-12-03T08:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292799",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_292800.json:
```json
{
    "body": "<a id='comment:39'></a>On 32-bit:\n\n```\n7019sage -t --long src/sage/rings/polynomial/polynomial_complex_arb.pyx\n7020**********************************************************************\n7021File \"src/sage/rings/polynomial/polynomial_complex_arb.pyx\", line 545, in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc\n7022Failed example:\n7023    (x^2 + 1)._power_trunc(10^10, 3)\n7024Exception raised:\n7025    Traceback (most recent call last):\n7026      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n7027        self.compile_and_execute(example, compiler, test.globs)\n7028      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n7029        exec(compiled, globs)\n7030      File \"<doctest sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc[1]>\", line 1, in <module>\n7031        (x**Integer(2) + Integer(1))._power_trunc(Integer(10)**Integer(10), Integer(3))\n7032      File \"sage/rings/polynomial/polynomial_complex_arb.pyx\", line 533, in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/rings/polynomial/polynomial_complex_arb.cpp:8624)\n7033        cpdef Polynomial _power_trunc(self, unsigned long expo, long n):\n7034    OverflowError: long int too large to convert\n7035**********************************************************************\n70361 item had failures:\n7037   1 of   6 in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc\n7038    [113 tests, 1 failure, 0.31 s]\n```",
    "created_at": "2016-12-03T08:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292800",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>On 32-bit:

```
7019sage -t --long src/sage/rings/polynomial/polynomial_complex_arb.pyx
7020**********************************************************************
7021File "src/sage/rings/polynomial/polynomial_complex_arb.pyx", line 545, in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc
7022Failed example:
7023    (x^2 + 1)._power_trunc(10^10, 3)
7024Exception raised:
7025    Traceback (most recent call last):
7026      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
7027        self.compile_and_execute(example, compiler, test.globs)
7028      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
7029        exec(compiled, globs)
7030      File "<doctest sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc[1]>", line 1, in <module>
7031        (x**Integer(2) + Integer(1))._power_trunc(Integer(10)**Integer(10), Integer(3))
7032      File "sage/rings/polynomial/polynomial_complex_arb.pyx", line 533, in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc (/home/buildbot/slave/sage_git/build/src/build/cythonized/sage/rings/polynomial/polynomial_complex_arb.cpp:8624)
7033        cpdef Polynomial _power_trunc(self, unsigned long expo, long n):
7034    OverflowError: long int too large to convert
7035**********************************************************************
70361 item had failures:
7037   1 of   6 in sage.rings.polynomial.polynomial_complex_arb.Polynomial_complex_arb._power_trunc
7038    [113 tests, 1 failure, 0.31 s]
```



---

archive/issue_comments_292801.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-03T09:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292802.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:39 vbraun]:\n> On 32-bit:\n\n\nOoops! Thank you for the notice. I think this can go back to `positive_review`, but please complain if you disagree.",
    "created_at": "2016-12-03T10:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292802",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:41'></a>Replying to [comment:39 vbraun]:
> On 32-bit:


Ooops! Thank you for the notice. I think this can go back to `positive_review`, but please complain if you disagree.



---

archive/issue_comments_292803.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-12-03T10:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292803",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_056897.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-05T00:44:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21393#event-56897"
}
```



---

archive/issue_comments_292804.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-05T00:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21393#issuecomment-292804",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
