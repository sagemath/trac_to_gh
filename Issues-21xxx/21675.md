# Issue 21675: Revert the renaming libfplll -> fplll

archive/issues_021438.json:
```json
{
    "body": "In #21221, the package `libfplll` was renamed to `fplll`.\n\nWhen building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n\nThis causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n\nSolution:\n\n1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).\n\n2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.\n\nSince `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other \"installed\" file, both downgrades and upgrades will work as expected.\n\nCC:  tmonteil jpflori @ClementPernet @malb\n\nReviewer: Jean-Pierre Flori\n\nAuthor: Jeroen Demeyer\n\nBranch: 618a581220339d4af6985080be5d7a2172de49a8\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21675\n\n",
    "closed_at": "2016-10-12T06:53:22Z",
    "created_at": "2016-10-10T08:52:55Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Revert the renaming libfplll -> fplll",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21675",
    "user": "https://github.com/jdemeyer"
}
```
In #21221, the package `libfplll` was renamed to `fplll`.

When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.

This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.

Solution:

1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).

2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.

Since `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other "installed" file, both downgrades and upgrades will work as expected.

CC:  tmonteil jpflori @ClementPernet @malb

Reviewer: Jean-Pierre Flori

Author: Jeroen Demeyer

Branch: 618a581220339d4af6985080be5d7a2172de49a8

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21675





---

archive/issue_comments_316632.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n-The renaming of `libfplll` -> `fplll` causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n+In #21221, the package `libfplll` was renamed to `fplll`.\n+\n+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n+\n+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-10-10T08:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316632",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
-The renaming of `libfplll` -> `fplll` causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
+In #21221, the package `libfplll` was renamed to `fplll`.
+
+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.
+
+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
 
 Comment: 1
 
``````




---

archive/issue_comments_316633.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+In #21221, the package `libfplll` was renamed to `fplll`.\n \n+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n+\n+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n+\n+We should either fix the build system or undo the renaming.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-10-10T08:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316633",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+In #21221, the package `libfplll` was renamed to `fplll`.
 
+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.
+
+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
+
+We should either fix the build system or undo the renaming.
 
 Comment: 1
 
``````




---

archive/issue_comments_316634.json:
```json
{
    "body": "<a id='comment:4'></a>Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?",
    "created_at": "2016-10-10T09:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316634",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?



---

archive/issue_comments_316635.json:
```json
{
    "body": "<a id='comment:5'></a>Here is something.\nI have to go now so I did not have time to test it correctly, fplll is still compiling.\n\n---\nNew commits:",
    "created_at": "2016-10-10T11:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316635",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Here is something.
I have to go now so I did not have time to test it correctly, fplll is still compiling.

---
New commits:



---

archive/issue_comments_316636.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 jpflori]:\n> Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?\n\n\nThat only solves the problem in one direction and will break a downgrade followed by an upgrade (`fplll` -> `libfplll` -> `fplll`).",
    "created_at": "2016-10-10T12:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316636",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:4 jpflori]:
> Can't we just remove the `installed/libfplll` file from `fplll`'s `spkg-install`?


That only solves the problem in one direction and will break a downgrade followed by an upgrade (`fplll` -> `libfplll` -> `fplll`).



---

archive/issue_comments_316637.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+In #21221, the package `libfplll` was renamed to `fplll`.\n \n+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n+\n+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n+\n+Solution:\n+\n+1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).\n+\n+2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.\n+\n+Since `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other \"installed\" file, both downgrades and upgrades will work as expected.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-10-10T12:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316637",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,16 @@
+In #21221, the package `libfplll` was renamed to `fplll`.
 
+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.
+
+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
+
+Solution:
+
+1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).
+
+2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.
+
+Since `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other "installed" file, both downgrades and upgrades will work as expected.
 
 Comment: 1
 
``````




---

archive/issue_comments_316638.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+In #21221, the package `libfplll` was renamed to `fplll`.\n \n+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n+\n+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n+\n+We should either fix the build system or undo the renaming.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-10-10T13:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316638",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+In #21221, the package `libfplll` was renamed to `fplll`.
 
+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.
+
+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
+
+We should either fix the build system or undo the renaming.
 
 Comment: 1
 
``````




---

archive/issue_comments_316639.json:
```json
{
    "body": "<a id='comment:8'></a>You mean that `fplll` (and cython files depending on the lib) won't get rebuilt the second time?",
    "created_at": "2016-10-10T13:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316639",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>You mean that `fplll` (and cython files depending on the lib) won't get rebuilt the second time?



---

archive/issue_comments_316640.json:
```json
{
    "body": "<a id='comment:10'></a>Oops, I was doing two things at the same time and did not pay attention to the warning...\n\n---\nNew commits:",
    "created_at": "2016-10-10T13:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316640",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:10'></a>Oops, I was doing two things at the same time and did not pay attention to the warning...

---
New commits:



---

archive/issue_comments_316641.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:8 jpflori]:\n> You mean that `fplll` won't get rebuilt the second time?\n\n\nExactly, because the build system will think that `fplll` is still installed.\n\nThe only way to get this working is to delete the files from `SAGE_SPKG_INST` in **both** directions (the old package should delete the new installed files and the new package should delete the old installed files).\n\nLuckily, we can use the MPFR upgrade as an extra way to force a rebuild of `libfplll` when downgrading to sage-7.4.beta6 or earlier.",
    "created_at": "2016-10-10T13:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316641",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:8 jpflori]:
> You mean that `fplll` won't get rebuilt the second time?


Exactly, because the build system will think that `fplll` is still installed.

The only way to get this working is to delete the files from `SAGE_SPKG_INST` in **both** directions (the old package should delete the new installed files and the new package should delete the old installed files).

Luckily, we can use the MPFR upgrade as an extra way to force a rebuild of `libfplll` when downgrading to sage-7.4.beta6 or earlier.



---

archive/issue_comments_316642.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-10T14:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316642",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_316643.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+In #21221, the package `libfplll` was renamed to `fplll`.\n \n+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.\n+\n+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.\n+\n+Solution:\n+\n+1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).\n+\n+2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.\n+\n+Since `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other \"installed\" file, both downgrades and upgrades will work as expected.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-10-10T14:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316643",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,16 @@
+In #21221, the package `libfplll` was renamed to `fplll`.
 
+When building `fplll`, the old `libfplll` from sage-7.4.beta6 and earlier is still marked as installed.
+
+This causes downgrades sage-7.4.rc0 -> sage-7.4.beta6 to fail since the build system does not know that `libfplll` was replaced by `fplll`. Therefore, after such a downgrade, the `libfplll` package is not reinstalled.
+
+Solution:
+
+1. Revert the renaming and remove `installed/fplll*` when installing `libfplll` (this ticket).
+
+2. After the MPFR upgrade (#21660), rename `libfplll` -> `fplll` and remove `installed/libfplll*` when installing `fplll`.
+
+Since `(lib)fplll` depends on MPFR, the changing of MPFR version will force a reinstallation of `(lib)fplll`. If both the `spkg-install` of `libfplll` and of `fplll` delete the other "installed" file, both downgrades and upgrades will work as expected.
 
 Comment: 1
 
``````




---

archive/issue_comments_316644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-11T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316644",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_316645.json:
```json
{
    "body": "<a id='comment:14'></a>Ok, let's hack this in.",
    "created_at": "2016-10-11T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316645",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:14'></a>Ok, let's hack this in.



---

archive/issue_events_057419.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-12T06:53:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21675#event-57419"
}
```



---

archive/issue_comments_316646.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-12T06:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316646",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_316647.json:
```json
{
    "body": "<a id='comment:16'></a>Just mentioning that I have been hit by this issue several times since the release of Sage 7.4.rc0 while working on different tickets.",
    "created_at": "2016-10-12T09:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316647",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Just mentioning that I have been hit by this issue several times since the release of Sage 7.4.rc0 while working on different tickets.



---

archive/issue_comments_316648.json:
```json
{
    "body": "<a id='comment:17'></a>Volker: this was closed *before* the release of Sage 7.4.rc1 but still isn't contained in Sage 7.4.rc1. And I don't see it appearing in https://github.com/vbraun/sage/commits/develop\n\nWas this intentional or did something go wrong?",
    "created_at": "2016-10-13T14:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316648",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Volker: this was closed *before* the release of Sage 7.4.rc1 but still isn't contained in Sage 7.4.rc1. And I don't see it appearing in https://github.com/vbraun/sage/commits/develop

Was this intentional or did something go wrong?



---

archive/issue_comments_316649.json:
```json
{
    "body": "<a id='comment:18'></a>it'll be in rc2",
    "created_at": "2016-10-13T14:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316649",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>it'll be in rc2



---

archive/issue_comments_316650.json:
```json
{
    "body": "<a id='comment:19'></a>Should we rerevert this now?",
    "created_at": "2016-11-15T09:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316650",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>Should we rerevert this now?



---

archive/issue_comments_316651.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 jpflori]:\n> Should we rerevert this now?\n\n\nWe could.",
    "created_at": "2016-11-15T09:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316651",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 jpflori]:
> Should we rerevert this now?


We could.



---

archive/issue_comments_316652.json:
```json
{
    "body": "<a id='comment:21'></a>I guess 5.1.0 is coming, that would be a good opportunity.",
    "created_at": "2016-11-15T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21675#issuecomment-316652",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:21'></a>I guess 5.1.0 is coming, that would be a good opportunity.
