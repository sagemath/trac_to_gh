# Issue 21496: Merge of GSoC modabvar project

archive/issues_021259.json:
```json
{
    "body": "This is a merge of this project: https://github.com/williamstein/sage_modabvar\n\nMost of the code is checked against Magma. Here's a SMC worksheet checking most of the doctest examples: https://cloud.sagemath.com/projects/0d310a14-a099-47d9-87c7-df6b63af54a6/files/worksheets/magma_test_examples.sagews\n\nThe methods that aren't covered in the worksheet are:\n* `is_J0`, `is_J1`: they're really short\n* `elliptic_curve`: this checks that the newforms agree for conductor up to 50: `all([S.newform(names='a') == S.elliptic_curve().newform() for N in [1..50] for S in J0(N) if S.dimension() == 1])`\n* An algorithm for computing the divisor of order of the rational torsion subgroup is known in the J1(p) case. It is also conjecturally the order of the rational torsion subgroup. This is cover in this paper: http://math.stanford.edu/~conrad/papers/j1p.pdf and the code has been checked against the table in pg. 393.\n* `newform_decomposition`: This checks it against another way of computing it:\n\n  `all([J0(N).newform_decomposition('a') == [S.newform('a') for S in J0(N)] for N in [1..50]])`\n\n  `all([J1(N).newform_decomposition('a') == [S.newform('a') for S in J1(N)] for N in [1..30]])`\n\nCC:  @williamstein\n\nKeywords: modular abelian variety\n\nBranch/Commit: 950049159ea8676065b5c39152acde0a85c585e9\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Kevin Lui\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21496\n\n",
    "closed_at": "2017-01-21T21:21:52Z",
    "created_at": "2016-09-14T22:27:00Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Merge of GSoC modabvar project",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21496",
    "user": "https://github.com/kevinywlui"
}
```
This is a merge of this project: https://github.com/williamstein/sage_modabvar

Most of the code is checked against Magma. Here's a SMC worksheet checking most of the doctest examples: https://cloud.sagemath.com/projects/0d310a14-a099-47d9-87c7-df6b63af54a6/files/worksheets/magma_test_examples.sagews

The methods that aren't covered in the worksheet are:
* `is_J0`, `is_J1`: they're really short
* `elliptic_curve`: this checks that the newforms agree for conductor up to 50: `all([S.newform(names='a') == S.elliptic_curve().newform() for N in [1..50] for S in J0(N) if S.dimension() == 1])`
* An algorithm for computing the divisor of order of the rational torsion subgroup is known in the J1(p) case. It is also conjecturally the order of the rational torsion subgroup. This is cover in this paper: http://math.stanford.edu/~conrad/papers/j1p.pdf and the code has been checked against the table in pg. 393.
* `newform_decomposition`: This checks it against another way of computing it:

  `all([J0(N).newform_decomposition('a') == [S.newform('a') for S in J0(N)] for N in [1..50]])`

  `all([J1(N).newform_decomposition('a') == [S.newform('a') for S in J1(N)] for N in [1..30]])`

CC:  @williamstein

Keywords: modular abelian variety

Branch/Commit: 950049159ea8676065b5c39152acde0a85c585e9

Reviewer: Frédéric Chapoton

Author: Kevin Lui

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21496





---

archive/issue_comments_294669.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2016-09-19T03:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294669",
    "user": "https://github.com/kevinywlui"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_294670.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-19T03:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294670",
    "user": "https://github.com/kevinywlui"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_294671.json:
```json
{
    "body": "<a id='comment:3'></a>Quick comment: i pretty carefully refereed all the original code as it was being written, and had many (many!) comments on it, which Kevin addressed.   So this is likely to be in pretty good shape.",
    "created_at": "2016-09-20T01:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294671",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>Quick comment: i pretty carefully refereed all the original code as it was being written, and had many (many!) comments on it, which Kevin addressed.   So this is likely to be in pretty good shape.



---

archive/issue_comments_294672.json:
```json
{
    "body": "<a id='comment:4'></a>\n```\nFile \"src/sage/modular/abvar/torsion_subgroup.py\", line 421, in sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order\nFailed example:\n    from sage_modabvar import J0, J1\nException raised:\n    Traceback (most recent call last):\n      File \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order[0]>\", line 1, in <module>\n        from sage_modabvar import J0, J1\n    ImportError: No module named sage_modabvar\n**********************************************************************\nFile \"src/sage/modular/abvar/torsion_subgroup.py\", line 559, in sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order_using_frobp\nFailed example:\n    from sage_modabvar import JH\nException raised:\n    Traceback (most recent call last):\n      File \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order_using_frobp[20]>\", line 1, in <module>\n        from sage_modabvar import JH\n    ImportError: No module named sage_modabvar\n```",
    "created_at": "2016-09-28T09:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294672",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
```
File "src/sage/modular/abvar/torsion_subgroup.py", line 421, in sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order
Failed example:
    from sage_modabvar import J0, J1
Exception raised:
    Traceback (most recent call last):
      File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order[0]>", line 1, in <module>
        from sage_modabvar import J0, J1
    ImportError: No module named sage_modabvar
**********************************************************************
File "src/sage/modular/abvar/torsion_subgroup.py", line 559, in sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order_using_frobp
Failed example:
    from sage_modabvar import JH
Exception raised:
    Traceback (most recent call last):
      File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.abvar.torsion_subgroup.RationalTorsionSubgroup.multiple_of_order_using_frobp[20]>", line 1, in <module>
        from sage_modabvar import JH
    ImportError: No module named sage_modabvar
```



---

archive/issue_comments_294673.json:
```json
{
    "body": "<a id='comment:5'></a>I made a public branch (based on u/klui/merge_of_gsoc_modabvar_project)\nremoving the 3 problematic imports.\n\n---\nNew commits:",
    "created_at": "2016-09-29T08:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294673",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>I made a public branch (based on u/klui/merge_of_gsoc_modabvar_project)
removing the 3 problematic imports.

---
New commits:



---

archive/issue_comments_294674.json:
```json
{
    "body": "<a id='comment:6'></a>one failing doctest:\n\n```\nFile \"src/sage/modular/abvar/abvar.py\", line 4363, in sage.modular.abvar.abvar.ModularAbelianVariety_modsym_abstract.new_subvariety\nFailed example:\n    J0(33).new_subvariety()\nExpected:\n    Abelian subvariety of dimension 1 of J0(33)\nGot:\n    Simple abelian subvariety 33a(1,33) of dimension 1 of J0(33)\n```",
    "created_at": "2016-09-29T08:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294674",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>one failing doctest:

```
File "src/sage/modular/abvar/abvar.py", line 4363, in sage.modular.abvar.abvar.ModularAbelianVariety_modsym_abstract.new_subvariety
Failed example:
    J0(33).new_subvariety()
Expected:
    Abelian subvariety of dimension 1 of J0(33)
Got:
    Simple abelian subvariety 33a(1,33) of dimension 1 of J0(33)
```



---

archive/issue_comments_294675.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-29T11:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294676.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-30T04:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294677.json:
```json
{
    "body": "<a id='comment:9'></a>`@`chapoton Thanks for the fixes. I should have caught the bad imports earlier.\n\nI think the doctest in new_subvariety fails because J0(33).is_simple() is called elsewhere in the file. There's a warning about this situation in L3203 in abvar.py . So I changed it to J0(34) since that isn't used anywhere in the file.",
    "created_at": "2016-09-30T04:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294677",
    "user": "https://github.com/kevinywlui"
}
```

<a id='comment:9'></a>`@`chapoton Thanks for the fixes. I should have caught the bad imports earlier.

I think the doctest in new_subvariety fails because J0(33).is_simple() is called elsewhere in the file. There's a warning about this situation in L3203 in abvar.py . So I changed it to J0(34) since that isn't used anywhere in the file.



---

archive/issue_comments_294678.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T17:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294679.json:
```json
{
    "body": "<a id='comment:11'></a>I have made a cosmetic commit, mainly about formatting the OUTPUT blocks.\n\nIf you do not object to these tiny changes, you can set a positive review on my behalf.",
    "created_at": "2016-12-13T17:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294679",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I have made a cosmetic commit, mainly about formatting the OUTPUT blocks.

If you do not object to these tiny changes, you can set a positive review on my behalf.



---

archive/issue_comments_294680.json:
```json
{
    "body": "<a id='comment:12'></a>oops, it seems that I broke the doc, let me fix that",
    "created_at": "2016-12-14T08:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294680",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>oops, it seems that I broke the doc, let me fix that



---

archive/issue_comments_294681.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-14T09:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294682.json:
```json
{
    "body": "<a id='comment:14'></a>ok, doc is good again.\n\nOnce again, if you agree with my small schanges, this can be set to positive.",
    "created_at": "2016-12-14T11:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294682",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>ok, doc is good again.

Once again, if you agree with my small schanges, this can be set to positive.



---

archive/issue_comments_294683.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 chapoton]:\n> ok, doc is good again.\n> \n> Once again, if you agree with my small schanges, this can be set to positive.\n\n\nLooks good to me. Thanks. I'll set it on your behalf.",
    "created_at": "2016-12-16T07:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294683",
    "user": "https://github.com/kevinywlui"
}
```

<a id='comment:15'></a>Replying to [comment:14 chapoton]:
> ok, doc is good again.
> 
> Once again, if you agree with my small schanges, this can be set to positive.


Looks good to me. Thanks. I'll set it on your behalf.



---

archive/issue_comments_294684.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-16T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294684",
    "user": "https://github.com/kevinywlui"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057060.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-05T16:15:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21496#event-57060"
}
```



---

archive/issue_comments_294685.json:
```json
{
    "body": "<a id='comment:19'></a>on 32-bit:\n\n```\nsage -t --long src/sage/modular/abvar/lseries.py\n**********************************************************************\nFile \"src/sage/modular/abvar/lseries.py\", line 102, in sage.modular.abvar.lseries.Lseries_complex.__call__\nFailed example:\n    L(1) # long time (2s)\nExpected:\n    -1.33139759782370e-19\nGot:\n    -1.04128413920120e-19\n**********************************************************************\nFile \"src/sage/modular/abvar/lseries.py\", line 201, in sage.modular.abvar.lseries.Lseries_complex.vanishes_at_1\nFailed example:\n    L(1) # long time (2s)\nExpected:\n    -1.33139759782370e-19\nGot:\n    -1.04128413920120e-19\n^CKilling test src/sage/modular/abvar/lseries.py\n----------------------------------------------------------------------\nDoctests interrupted: 0/1 files tested\n----------------------------------------------------------------------\nTotal time for all tests: 6.6 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\nNeeds some # abs tol apparently",
    "created_at": "2017-01-17T23:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294685",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>on 32-bit:

```
sage -t --long src/sage/modular/abvar/lseries.py
**********************************************************************
File "src/sage/modular/abvar/lseries.py", line 102, in sage.modular.abvar.lseries.Lseries_complex.__call__
Failed example:
    L(1) # long time (2s)
Expected:
    -1.33139759782370e-19
Got:
    -1.04128413920120e-19
**********************************************************************
File "src/sage/modular/abvar/lseries.py", line 201, in sage.modular.abvar.lseries.Lseries_complex.vanishes_at_1
Failed example:
    L(1) # long time (2s)
Expected:
    -1.33139759782370e-19
Got:
    -1.04128413920120e-19
^CKilling test src/sage/modular/abvar/lseries.py
----------------------------------------------------------------------
Doctests interrupted: 0/1 files tested
----------------------------------------------------------------------
Total time for all tests: 6.6 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```
Needs some # abs tol apparently



---

archive/issue_comments_294686.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-17T23:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294686",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_294687.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-21T06:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_294688.json:
```json
{
    "body": "<a id='comment:21'></a>Thanks for the catch. It should work now.",
    "created_at": "2017-01-21T06:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294688",
    "user": "https://github.com/kevinywlui"
}
```

<a id='comment:21'></a>Thanks for the catch. It should work now.



---

archive/issue_comments_294689.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-21T06:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294689",
    "user": "https://github.com/kevinywlui"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_294690.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-21T08:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294690",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057061.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T21:21:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21496#event-57061"
}
```



---

archive/issue_comments_294691.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T21:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21496#issuecomment-294691",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
