# Issue 21175: Set ARCHFLAGS environment variable - for Perl modules

archive/issues_020938.json:
```json
{
    "body": "To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of `perl -MExtUtils::Embed -e ldopts` and `perl -MExtUtils::Embed -e ccflags` (picked up from system `perl`) do not contain `-arch` flags incompatible with our gcc.\n\nThis simplifies `perl_term_readline_gnu` (#20894), `polymake` (#20892), and makes installing `pypolymake` (#21170) as a pip package possible.\n\nCC:  @videlec @jdemeyer @embray @vbraun tmonteil @dimpase @kcrisman\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nBranch: 78f2cfacf1eefc11f60871f2874e6cfd08a1671e\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21175\n\n",
    "closed_at": "2016-08-30T06:46:29Z",
    "created_at": "2016-08-05T15:16:55Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Set ARCHFLAGS environment variable - for Perl modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21175",
    "user": "https://github.com/mkoeppe"
}
```
To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of `perl -MExtUtils::Embed -e ldopts` and `perl -MExtUtils::Embed -e ccflags` (picked up from system `perl`) do not contain `-arch` flags incompatible with our gcc.

This simplifies `perl_term_readline_gnu` (#20894), `polymake` (#20892), and makes installing `pypolymake` (#21170) as a pip package possible.

CC:  @videlec @jdemeyer @embray @vbraun tmonteil @dimpase @kcrisman

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Branch: 78f2cfacf1eefc11f60871f2874e6cfd08a1671e

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21175





---

archive/issue_comments_382892.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of \"perl -MExtUtils::Embed -e ldopts\" and \"perl -MExtUtils::Embed -e ccflags\" (picked up from system perl) do not contain -arch flags incompatible with our gcc.\n+To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of `perl -MExtUtils::Embed -e ldopts` and `perl -MExtUtils::Embed -e ccflags` (picked up from system `perl`) do not contain `-arch` flags incompatible with our gcc.\n \n This simplifies `perl_term_readline_gnu` (#20894), `polymake` (#20892), and makes installing `pypolymake` (#21170) as a pip package possible.\n``````\n",
    "created_at": "2016-08-05T15:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382892",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of "perl -MExtUtils::Embed -e ldopts" and "perl -MExtUtils::Embed -e ccflags" (picked up from system perl) do not contain -arch flags incompatible with our gcc.
+To make installing Perl modules easier on Mac OS X, we should set the ARCHFLAGS environment variable. This is to make sure that the output of `perl -MExtUtils::Embed -e ldopts` and `perl -MExtUtils::Embed -e ccflags` (picked up from system `perl`) do not contain `-arch` flags incompatible with our gcc.
 
 This simplifies `perl_term_readline_gnu` (#20894), `polymake` (#20892), and makes installing `pypolymake` (#21170) as a pip package possible.
``````




---

archive/issue_comments_382893.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/set_archflags_environment_variable___for_perl_modules\"",
    "created_at": "2016-08-05T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382893",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/set_archflags_environment_variable___for_perl_modules"



---

archive/issue_comments_382894.json:
```json
{
    "body": "Changing commit from \"\" to \"4c23c4e687ecfd7aea462583be25f82993fa52b8\"",
    "created_at": "2016-08-05T15:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382894",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "4c23c4e687ecfd7aea462583be25f82993fa52b8"



---

archive/issue_comments_382895.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[01abf17](https://github.com/sagemath/sagetrac-mirror/commit/01abf173fae401f28825f68f3933232a04a4633e)|`Set ARCHFLAGS on Darwin`|\n|[4c23c4e](https://github.com/sagemath/sagetrac-mirror/commit/4c23c4e687ecfd7aea462583be25f82993fa52b8)|`perl_term_readline_gnu: Don't set ARCHFLAGS, use global setting`|",
    "created_at": "2016-08-05T15:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382895",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[01abf17](https://github.com/sagemath/sagetrac-mirror/commit/01abf173fae401f28825f68f3933232a04a4633e)|`Set ARCHFLAGS on Darwin`|
|[4c23c4e](https://github.com/sagemath/sagetrac-mirror/commit/4c23c4e687ecfd7aea462583be25f82993fa52b8)|`perl_term_readline_gnu: Don't set ARCHFLAGS, use global setting`|



---

archive/issue_comments_382896.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-05T15:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382896",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_382897.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2016-08-05T18:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382897",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_382898.json:
```json
{
    "body": "Changing commit from \"4c23c4e687ecfd7aea462583be25f82993fa52b8\" to \"4fce479f79408c96e3cbbaa815c9239ff833abce\"",
    "created_at": "2016-08-18T23:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4c23c4e687ecfd7aea462583be25f82993fa52b8" to "4fce479f79408c96e3cbbaa815c9239ff833abce"



---

archive/issue_comments_382899.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|\n|[af44810](https://github.com/sagemath/sagetrac-mirror/commit/af448109fe95372d08e9f5f8ac171984e161a8a4)|`Merge tag '7.4.beta1' into t/21175/set_archflags_environment_variable___for_perl_modules`|\n|[4fce479](https://github.com/sagemath/sagetrac-mirror/commit/4fce479f79408c96e3cbbaa815c9239ff833abce)|`polymake: Don't set ARCHFLAGS, use global setting`|",
    "created_at": "2016-08-18T23:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
|[af44810](https://github.com/sagemath/sagetrac-mirror/commit/af448109fe95372d08e9f5f8ac171984e161a8a4)|`Merge tag '7.4.beta1' into t/21175/set_archflags_environment_variable___for_perl_modules`|
|[4fce479](https://github.com/sagemath/sagetrac-mirror/commit/4fce479f79408c96e3cbbaa815c9239ff833abce)|`polymake: Don't set ARCHFLAGS, use global setting`|



---

archive/issue_comments_382900.json:
```json
{
    "body": "<a id='comment:7'></a>\nNeeds review.",
    "created_at": "2016-08-18T23:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382900",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Needs review.



---

archive/issue_comments_382901.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt looks OK on Linux; must it be tested on OSX too?",
    "created_at": "2016-08-26T12:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382901",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
It looks OK on Linux; must it be tested on OSX too?



---

archive/issue_comments_382902.json:
```json
{
    "body": "<a id='comment:9'></a>\nI have tested it on both platforms.",
    "created_at": "2016-08-26T13:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
I have tested it on both platforms.



---

archive/issue_comments_382903.json:
```json
{
    "body": "<a id='comment:10'></a>\nput in this, and then tried to install polymake on OSX, and got\n\n```\n[polymake-3.0r2] checking fink installation ... The Fink package system is a mandatory prerequisite to build and use polymake under MacOS.\n[polymake-3.0r2] Please refer to http://www.polymake.org/doku.php/mac for details and installation instructions.\n[polymake-3.0r2] If you already have Fink installed at a non-standard location, please specify it using option --with-fink\n[polymake-3.0r2] Error configuring Polymake\n```\nReally? Fink?",
    "created_at": "2016-08-26T16:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382903",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
put in this, and then tried to install polymake on OSX, and got

```
[polymake-3.0r2] checking fink installation ... The Fink package system is a mandatory prerequisite to build and use polymake under MacOS.
[polymake-3.0r2] Please refer to http://www.polymake.org/doku.php/mac for details and installation instructions.
[polymake-3.0r2] If you already have Fink installed at a non-standard location, please specify it using option --with-fink
[polymake-3.0r2] Error configuring Polymake
```
Really? Fink?



---

archive/issue_comments_382904.json:
```json
{
    "body": "Changing commit from \"4fce479f79408c96e3cbbaa815c9239ff833abce\" to \"78f2cfacf1eefc11f60871f2874e6cfd08a1671e\"",
    "created_at": "2016-08-26T19:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4fce479f79408c96e3cbbaa815c9239ff833abce" to "78f2cfacf1eefc11f60871f2874e6cfd08a1671e"



---

archive/issue_comments_382905.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[78f2cfa](https://github.com/sagemath/sagetrac-mirror/commit/78f2cfacf1eefc11f60871f2874e6cfd08a1671e)|`Restore --without-fink that was lost`|",
    "created_at": "2016-08-26T19:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[78f2cfa](https://github.com/sagemath/sagetrac-mirror/commit/78f2cfacf1eefc11f60871f2874e6cfd08a1671e)|`Restore --without-fink that was lost`|



---

archive/issue_comments_382906.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks for catching this -- I killed the `--without-fink` by accident. Should work now.",
    "created_at": "2016-08-26T19:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382906",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Thanks for catching this -- I killed the `--without-fink` by accident. Should work now.



---

archive/issue_comments_382907.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-27T12:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382907",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_382908.json:
```json
{
    "body": "<a id='comment:13'></a>\nOK, looks good now.",
    "created_at": "2016-08-27T12:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382908",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
OK, looks good now.



---

archive/issue_comments_382909.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-27T22:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382909",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_382910.json:
```json
{
    "body": "<a id='comment:14'></a>\nReviewer name",
    "created_at": "2016-08-27T22:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382910",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>
Reviewer name



---

archive/issue_comments_382911.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2016-08-28T05:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382911",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_382912.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-08-28T05:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382912",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_382913.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/set_archflags_environment_variable___for_perl_modules\" to \"78f2cfacf1eefc11f60871f2874e6cfd08a1671e\"",
    "created_at": "2016-08-30T06:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382913",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/set_archflags_environment_variable___for_perl_modules" to "78f2cfacf1eefc11f60871f2874e6cfd08a1671e"



---

archive/issue_comments_382914.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-30T06:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382914",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072041.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-30T06:46:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21175#event-72041"
}
```



---

archive/issue_comments_382915.json:
```json
{
    "body": "<a id='comment:17'></a>\nFollow-up in #29408",
    "created_at": "2020-04-09T03:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382915",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Follow-up in #29408



---

archive/issue_comments_382916.json:
```json
{
    "body": "Changing commit from \"78f2cfacf1eefc11f60871f2874e6cfd08a1671e\" to \"\"",
    "created_at": "2020-04-09T03:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21175",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21175#issuecomment-382916",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "78f2cfacf1eefc11f60871f2874e6cfd08a1671e" to ""
