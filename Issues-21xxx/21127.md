# Issue 21127: py3: turn some divisions in compatible format

archive/issues_020890.json:
```json
{
    "assignees": [],
    "body": "as part of #15995 and a step towards python3\n\nCC:  @tscrim @jdemeyer @dimpase @darijgr @jm58660\n\nKeywords: **division**\n\nBranch: **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**\n\nReviewer: **Jori M\u00e4ntysalo**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21127_\n\n",
    "closed_at": "2016-08-19T22:45:05Z",
    "created_at": "2016-07-29T13:38:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: turn some divisions in compatible format",
    "type": "issue",
    "updated_at": "2018-02-23T13:35:04Z",
    "url": "https://github.com/sagemath/sage/issues/21127",
    "user": "https://github.com/fchapoton"
}
```
as part of #15995 and a step towards python3

CC:  @tscrim @jdemeyer @dimpase @darijgr @jm58660

Keywords: **division**

Branch: **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**

Reviewer: **Jori Mäntysalo**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/21127_





---

archive/issue_events_297077.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T13:38:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297077"
}
```



---

archive/issue_events_297078.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T13:38:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297078"
}
```



---

archive/issue_events_297079.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T13:38:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297079"
}
```



---

archive/issue_events_297080.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T13:38:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297080"
}
```



---

archive/issue_comments_307831.json:
```json
{
    "body": "Branch: **[public/21127](https://github.com/sagemath/sagetrac-mirror/tree/public/21127)**",
    "created_at": "2016-07-29T13:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307831",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/21127](https://github.com/sagemath/sagetrac-mirror/tree/public/21127)**



---

archive/issue_comments_307832.json:
```json
{
    "body": "Commit: **[`3f53143`](https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180)**",
    "created_at": "2016-07-29T13:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307832",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`3f53143`](https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180)**



---

archive/issue_comments_307833.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180\"><code>3f53143</code></a></td><td><code>more cases of python3-compatible divisions</code></td></tr></table>\n",
    "created_at": "2016-07-29T13:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307833",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180"><code>3f53143</code></a></td><td><code>more cases of python3-compatible divisions</code></td></tr></table>




---

archive/issue_events_297081.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-29T13:39:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297081"
}
```



---

archive/issue_comments_307834.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt would be nice if you would add `from `__future__` import division` to those modules.\n\nThis might actually fix the doctest in `delsarte_bounds.py` with `check=False`.",
    "created_at": "2016-07-29T14:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307834",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

It would be nice if you would add `from `__future__` import division` to those modules.

This might actually fix the doctest in `delsarte_bounds.py` with `check=False`.



---

archive/issue_comments_307835.json:
```json
{
    "body": "Changed commit from **[`3f53143`](https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180)** to **[`700ec78`](https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308)**",
    "created_at": "2016-07-29T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307835",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3f53143`](https://github.com/sagemath/sagetrac-mirror/commit/3f53143b4786213c0f8b1983f0b8f0f80b69f180)** to **[`700ec78`](https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308)**



---

archive/issue_comments_307836.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308\"><code>700ec78</code></a></td><td><code>adding future imports of division</code></td></tr></table>\n",
    "created_at": "2016-07-29T14:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307836",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308"><code>700ec78</code></a></td><td><code>adding future imports of division</code></td></tr></table>




---

archive/issue_comments_307837.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI added import except in the 2 files in misc, because that was changing the behavior\nand causing doctest failures.",
    "created_at": "2016-07-29T14:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307837",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

I added import except in the 2 files in misc, because that was changing the behavior
and causing doctest failures.



---

archive/issue_comments_307838.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nping ?",
    "created_at": "2016-08-01T10:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307838",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

ping ?



---

archive/issue_comments_307839.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis is not very fun to review because it is not something which can be done \"mechanically\". I actually have to read and understand the code to check whether the change is good. And when I see 15 files changed like this, it seems like a lot of work.",
    "created_at": "2016-08-02T13:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307839",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

This is not very fun to review because it is not something which can be done "mechanically". I actually have to read and understand the code to check whether the change is good. And when I see 15 files changed like this, it seems like a lot of work.



---

archive/issue_comments_307840.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nyes, I agree that this is not an easy review. But at least 4 of the files are\njust modified by adding `optional - python2`.\n\nAnd two other ones are just adding `...divide` so that the doctest can contain either `divide`or `true_divide`\n\nIn the coding file, we just get a correct result instead of an incorrect (but doctested) one.\n\nIn the two combinat files, the divisions are exact by congruence imposed on the parameters.\n\nFor the graph one, we divide by two an even quantity\n\nFor the logic one, we divide by 2 to perform a bit shift\n\nfor the knots one, I am not very sure of my change, but the doctests pass.\n\nThe crypto and hyperbolic are probably the more subtle ones.",
    "created_at": "2016-08-02T16:42:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307840",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

yes, I agree that this is not an easy review. But at least 4 of the files are
just modified by adding `optional - python2`.

And two other ones are just adding `...divide` so that the doctest can contain either `divide`or `true_divide`

In the coding file, we just get a correct result instead of an incorrect (but doctested) one.

In the two combinat files, the divisions are exact by congruence imposed on the parameters.

For the graph one, we divide by two an even quantity

For the logic one, we divide by 2 to perform a bit shift

for the knots one, I am not very sure of my change, but the doctests pass.

The crypto and hyperbolic are probably the more subtle ones.



---

archive/issue_comments_307841.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHow did you come up with this patch actually? Your branch seems to contain a random selection of files within Sage. Probably there are a lot of files which needs divisions fixed, so why this selection of files to fix?",
    "created_at": "2016-08-03T12:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307841",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

How did you come up with this patch actually? Your branch seems to contain a random selection of files within Sage. Probably there are a lot of files which needs divisions fixed, so why this selection of files to fix?



---

archive/issue_comments_307842.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSee the bottom of the description of #15995:\n\n```\nexport PYTHONIOENCODING=\"utf-8\"\nsource ./local/bin/sage-env\npython -Qnew ./local/bin/sage-runtests --all\n```\nThis runs all the tests with the new division behaviour. I have corrected here most of the failing doctests. There remains a few more difficult cases, where I have not been able to locate the problem.",
    "created_at": "2016-08-03T12:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307842",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

See the bottom of the description of #15995:

```
export PYTHONIOENCODING="utf-8"
source ./local/bin/sage-env
python -Qnew ./local/bin/sage-runtests --all
```
This runs all the tests with the new division behaviour. I have corrected here most of the failing doctests. There remains a few more difficult cases, where I have not been able to locate the problem.



---

archive/issue_comments_307843.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think we need a better strategy to deal with divisions.\n\nIdeally, I would like to have a record of every single division operation in Sage. Then, for every division in the Sage sources:\n1. If that division sometimes has a Sage `Element` as one of the arguments, it should be replaced by a true division.\n2. If that division is always an `int`/`int` division, it should be replaced by a floor division.\n\nI think this would take care of most divisions correctly.",
    "created_at": "2016-08-08T05:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307843",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

I think we need a better strategy to deal with divisions.

Ideally, I would like to have a record of every single division operation in Sage. Then, for every division in the Sage sources:
1. If that division sometimes has a Sage `Element` as one of the arguments, it should be replaced by a true division.
2. If that division is always an `int`/`int` division, it should be replaced by a floor division.

I think this would take care of most divisions correctly.



---

archive/issue_comments_307844.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPython actually has a script [fixdiv.py](http://svn.python.org/projects/python/trunk/Tools/scripts/fixdiv.py) which more-or-less does this.",
    "created_at": "2016-08-08T06:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307844",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Python actually has a script [fixdiv.py](http://svn.python.org/projects/python/trunk/Tools/scripts/fixdiv.py) which more-or-less does this.



---

archive/issue_comments_307845.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHmm.. the `-Qxxx` command-line options only affect warnings for Python standard types. There is no way to get a warning for *every* division, regardless of type.",
    "created_at": "2016-08-08T07:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307845",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Hmm.. the `-Qxxx` command-line options only affect warnings for Python standard types. There is no way to get a warning for *every* division, regardless of type.



---

archive/issue_comments_307846.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe need to find a better strategy should not prevent this ticket to be validated.\n\nAnyway, I think our main problem now is `cmp` and all its friends.",
    "created_at": "2016-08-08T07:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307846",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

The need to find a better strategy should not prevent this ticket to be validated.

Anyway, I think our main problem now is `cmp` and all its friends.



---

archive/issue_comments_307847.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@fchapoton](#comment:13):\n> Anyway, I think our main problem now is `cmp` and all its friends.\n\nHmm, it depends how you look at it. I think that divisions are still harder, mainly because decisions need to be made on a case-by-case basis. For `__cmp__`, things are simple: we need to fix everything and we can do that in a pretty uniform way. It is surely a lot of work but at least relatively easy work.",
    "created_at": "2016-08-08T07:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307847",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@fchapoton](#comment:13):
> Anyway, I think our main problem now is `cmp` and all its friends.

Hmm, it depends how you look at it. I think that divisions are still harder, mainly because decisions need to be made on a case-by-case basis. For `__cmp__`, things are simple: we need to fix everything and we can do that in a pretty uniform way. It is surely a lot of work but at least relatively easy work.



---

archive/issue_comments_307848.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@fchapoton](#comment:13):\n> The need to find a better strategy should not prevent this ticket to be validated.\n\nIdeally, that better strategy would make this ticket obsolete.",
    "created_at": "2016-08-08T07:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307848",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@fchapoton](#comment:13):
> The need to find a better strategy should not prevent this ticket to be validated.

Ideally, that better strategy would make this ticket obsolete.



---

archive/issue_comments_307849.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI would nevertheless like to have this ticket reviewed. Any volunteer ?",
    "created_at": "2016-08-10T16:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307849",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

I would nevertheless like to have this ticket reviewed. Any volunteer ?



---

archive/issue_events_297082.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-10T16:05:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297082"
}
```



---

archive/issue_events_297083.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-10T16:05:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297083"
}
```



---

archive/issue_comments_307850.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n*ping* !",
    "created_at": "2016-08-15T07:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307850",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

*ping* !



---

archive/issue_comments_307851.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI guess I can look these.\n\n(At the same time this is a test message. It seems that \"Active tickets I participated in\" do not contain ticket I have been CC'ed any more.)",
    "created_at": "2016-08-15T08:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307851",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:19" align="right">comment:19</div>

I guess I can look these.

(At the same time this is a test message. It seems that "Active tickets I participated in" do not contain ticket I have been CC'ed any more.)



---

archive/issue_comments_307852.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYou did\n\n```\n-        s = RR(1/(RR(n).sqrt() * log(n, 2)**2) * q)\n+        s = q / (RR(n).sqrt() * log(n, 2)**2)\n```\n\nand now if we have, say, `n=42`, we got numerical `9.43000415102671` from current version and symbolic `274.197052882637*log(2)<sup>2/log(42)</sup>2` from the new version. This should be asked before the change.\n\nE: I don't think I can be sure about changes to `src/sage/crypto/lwe.py` and hope someone else will review this one.",
    "created_at": "2016-08-15T09:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307852",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:20" align="right">comment:20</div>

You did

```
-        s = RR(1/(RR(n).sqrt() * log(n, 2)**2) * q)
+        s = q / (RR(n).sqrt() * log(n, 2)**2)
```

and now if we have, say, `n=42`, we got numerical `9.43000415102671` from current version and symbolic `274.197052882637*log(2)<sup>2/log(42)</sup>2` from the new version. This should be asked before the change.

E: I don't think I can be sure about changes to `src/sage/crypto/lwe.py` and hope someone else will review this one.



---

archive/issue_comments_307853.json:
```json
{
    "body": "Changed commit from **[`700ec78`](https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308)** to **[`59ed9c4`](https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105)**",
    "created_at": "2016-08-15T12:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307853",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`700ec78`](https://github.com/sagemath/sagetrac-mirror/commit/700ec78c1a7e79f8bdef78376883f18060673308)** to **[`59ed9c4`](https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105)**



---

archive/issue_comments_307854.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8353018e33fb97249658bc6897118983ff08cbc7\"><code>8353018</code></a></td><td><code>Merge branch 'public/21127' in 7.4.b0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105\"><code>59ed9c4</code></a></td><td><code>trac 21127 one detail</code></td></tr></table>\n",
    "created_at": "2016-08-15T12:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307854",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8353018e33fb97249658bc6897118983ff08cbc7"><code>8353018</code></a></td><td><code>Merge branch 'public/21127' in 7.4.b0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105"><code>59ed9c4</code></a></td><td><code>trac 21127 one detail</code></td></tr></table>




---

archive/issue_comments_307855.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI have taken your remark into account. Do you see something else ?",
    "created_at": "2016-08-16T16:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307855",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

I have taken your remark into account. Do you see something else ?



---

archive/issue_comments_307856.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@fchapoton](#comment:22):\n> I have taken your remark into account. Do you see something else ?\n\nHmm... There was\n\n`sk = ceil((C*(n1+n2))**(3/2))`\n\nand in python2 for example `100**(3/2)` is `100`, whereas in python3 it is `1000.0`. But this seems to be a clear bug in current implementation. Maybe your change actually corrects this!\n\nBut I can not review this, as I do not know what `lwe.py` should do.",
    "created_at": "2016-08-16T16:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307856",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@fchapoton](#comment:22):
> I have taken your remark into account. Do you see something else ?

Hmm... There was

`sk = ceil((C*(n1+n2))**(3/2))`

and in python2 for example `100**(3/2)` is `100`, whereas in python3 it is `1000.0`. But this seems to be a clear bug in current implementation. Maybe your change actually corrects this!

But I can not review this, as I do not know what `lwe.py` should do.



---

archive/issue_comments_307857.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI do not understand what lwe should do either.\n\nWould you give a positive rev. if I revert the changes to lwe ?",
    "created_at": "2016-08-16T16:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307857",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

I do not understand what lwe should do either.

Would you give a positive rev. if I revert the changes to lwe ?



---

archive/issue_comments_307858.json:
```json
{
    "body": "Reviewer: **Jori M\u00e4ntysalo**",
    "created_at": "2016-08-16T18:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307858",
    "user": "https://github.com/jm58660"
}
```

Reviewer: **Jori Mäntysalo**



---

archive/issue_comments_307859.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@fchapoton](#comment:24):\n\n> Would you give a positive rev. if I revert the changes to lwe ?\n\nI guess so, but haven't read every line yet.",
    "created_at": "2016-08-16T18:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307859",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@fchapoton](#comment:24):

> Would you give a positive rev. if I revert the changes to lwe ?

I guess so, but haven't read every line yet.



---

archive/issue_comments_307860.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nhere is a clean branch with no changes to the file crypto/lwe.py\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d\"><code>272179c</code></a></td><td><code>more cases of python3-compatible divisions</code></td></tr></table>\n",
    "created_at": "2016-08-16T18:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307860",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">comment:26</div>

here is a clean branch with no changes to the file crypto/lwe.py

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d"><code>272179c</code></a></td><td><code>more cases of python3-compatible divisions</code></td></tr></table>




---

archive/issue_comments_307861.json:
```json
{
    "body": "Changed branch from **[public/21127](https://github.com/sagemath/sagetrac-mirror/tree/public/21127)** to **[u/chapoton/21127](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21127)**",
    "created_at": "2016-08-16T18:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307861",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[public/21127](https://github.com/sagemath/sagetrac-mirror/tree/public/21127)** to **[u/chapoton/21127](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21127)**



---

archive/issue_comments_307862.json:
```json
{
    "body": "Changed commit from **[`59ed9c4`](https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105)** to **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**",
    "created_at": "2016-08-16T18:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307862",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`59ed9c4`](https://github.com/sagemath/sagetrac-mirror/commit/59ed9c40d948d0dc3221671033fa410563116105)** to **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**



---

archive/issue_events_297084.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-17T06:33:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297084"
}
```



---

archive/issue_events_297085.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-17T06:33:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297085"
}
```



---

archive/issue_comments_307863.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOK, I checked the rest.",
    "created_at": "2016-08-17T06:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307863",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:27" align="right">comment:27</div>

OK, I checked the rest.



---

archive/issue_events_297086.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-19T22:45:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297086"
}
```



---

archive/issue_events_297087.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "59738ba6d7f843086b2189f753123e7dc0881da7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-19T22:45:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21127#event-297087"
}
```



---

archive/issue_comments_307864.json:
```json
{
    "body": "Changed branch from **[u/chapoton/21127](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21127)** to **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**",
    "created_at": "2016-08-19T22:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307864",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/21127](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21127)** to **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)**



---

archive/issue_comments_307865.json:
```json
{
    "body": "Changed keywords from none to **division**",
    "created_at": "2018-02-23T13:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307865",
    "user": "https://github.com/embray"
}
```

Changed keywords from none to **division**



---

archive/issue_comments_307866.json:
```json
{
    "body": "Changed commit from **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)** to none",
    "created_at": "2018-02-23T13:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21127#issuecomment-307866",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`272179c`](https://github.com/sagemath/sagetrac-mirror/commit/272179c1188c531d7a3a5a8aad64002cb4472c5d)** to none
