# Issue 21944: OpenSSL for Sierra

archive/issues_021707.json:
```json
{
    "body": "CC:  @jdemeyer kosta @jhpalmieri\n\nKeywords: days79,osx\n\nSage 7.4 and above (at the very least) builds without the OpenSSL bindings for python. The path from #19626 has changed and needs to be updated on newer versions of OS X to:\n\n`\"${xcode}/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdks/MacOSX.sdk/usr/include/\"`\n\n(/sdk/ ->/sdks/)\n\nIssue created by migration from https://trac.sagemath.org/ticket/21944\n\n",
    "closed_at": "2017-10-01T00:19:09Z",
    "created_at": "2016-11-23T11:47:57Z",
    "labels": [
        "component: build: configure",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "OpenSSL for Sierra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21944",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```
CC:  @jdemeyer kosta @jhpalmieri

Keywords: days79,osx

Sage 7.4 and above (at the very least) builds without the OpenSSL bindings for python. The path from #19626 has changed and needs to be updated on newer versions of OS X to:

`"${xcode}/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdks/MacOSX.sdk/usr/include/"`

(/sdk/ ->/sdks/)

Issue created by migration from https://trac.sagemath.org/ticket/21944





---

archive/issue_comments_301029.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-23T12:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301029",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_301030.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-23T12:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301030",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

New commits:



---

archive/issue_comments_301031.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-23T12:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301031",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

New commits:



---

archive/issue_comments_301032.json:
```json
{
    "body": "This hack is getting a little out of hand. It might be reasonable to start including openssl manually in OS X.",
    "created_at": "2016-11-23T12:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301032",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

This hack is getting a little out of hand. It might be reasonable to start including openssl manually in OS X.



---

archive/issue_comments_301033.json:
```json
{
    "body": "1. The indentation in the script is inconsistent.\n\n2. Why check for `.../usr/include` and not `.../usr/include/openssl`?",
    "created_at": "2016-11-23T13:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301033",
    "user": "https://github.com/jdemeyer"
}
```

1. The indentation in the script is inconsistent.

2. Why check for `.../usr/include` and not `.../usr/include/openssl`?



---

archive/issue_comments_301034.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-23T13:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301034",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_301035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-23T15:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301036.json:
```json
{
    "body": "Thanks for the comment!\n\nPlease see the latest commit - my editor indented now the whole file (and I reverted the couple of places where it wanted to indent differently than how it was indented by previous people). Hopefully now will be better.\n\nRegarding the checks, I fixed the tested dirs.\n\nReplying to [comment:9 jdemeyer]:\n> 1. The indentation in the script is inconsistent.\n> \n> 2. Why check for `.../usr/include` and not `.../usr/include/openssl`?",
    "created_at": "2016-11-23T15:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301036",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Thanks for the comment!

Please see the latest commit - my editor indented now the whole file (and I reverted the couple of places where it wanted to indent differently than how it was indented by previous people). Hopefully now will be better.

Regarding the checks, I fixed the tested dirs.

Replying to [comment:9 jdemeyer]:
> 1. The indentation in the script is inconsistent.
> 
> 2. Why check for `.../usr/include` and not `.../usr/include/openssl`?



---

archive/issue_comments_301037.json:
```json
{
    "body": "The `elif`/`else` is still indented inconsistently.",
    "created_at": "2016-11-23T15:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301037",
    "user": "https://github.com/jdemeyer"
}
```

The `elif`/`else` is still indented inconsistently.



---

archive/issue_comments_301038.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-23T19:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301039.json:
```json
{
    "body": "Thanks! I completely forgot you have elif in bash.\n\nReplying to [comment:13 jdemeyer]:\n> The `elif`/`else` is still indented inconsistently.",
    "created_at": "2016-11-23T19:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301039",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Thanks! I completely forgot you have elif in bash.

Replying to [comment:13 jdemeyer]:
> The `elif`/`else` is still indented inconsistently.



---

archive/issue_comments_301040.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-23T19:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301040",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301041.json:
```json
{
    "body": "It looks like beyond Sierra this will not be enough (I am running a beta version on one of my computers and here the new path does not exist. I will add an additional check for where homebrew installs openssl.",
    "created_at": "2016-11-29T18:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301041",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

It looks like beyond Sierra this will not be enough (I am running a beta version on one of my computers and here the new path does not exist. I will add an additional check for where homebrew installs openssl.



---

archive/issue_comments_301042.json:
```json
{
    "body": "Changing keywords from \"days79\" to \"days79,osx\".",
    "created_at": "2016-11-29T18:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301042",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Changing keywords from "days79" to "days79,osx".



---

archive/issue_comments_301043.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-29T18:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301043",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_301044.json:
```json
{
    "body": "On my Sierra machine, the directory\n\n```\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdks/MacOSX.sdk/usr/include/\n```\ndoes not include an `openssl` subdirectory. `/usr/lib` contains `libssl.dylib`, but I'm not sure about the header files. What would they be called? (I also can't find them on an El Capitan machine.)",
    "created_at": "2016-11-30T02:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301044",
    "user": "https://github.com/jhpalmieri"
}
```

On my Sierra machine, the directory

```
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdks/MacOSX.sdk/usr/include/
```
does not include an `openssl` subdirectory. `/usr/lib` contains `libssl.dylib`, but I'm not sure about the header files. What would they be called? (I also can't find them on an El Capitan machine.)



---

archive/issue_comments_301045.json:
```json
{
    "body": "Having updated to 10.12.2 I do not have this directory either, anymore. Therefore, I think the most reasonable way of proceeding is either to require users to roll their own openssl (or perhaps some compatible alternative) via e.g. homebrew, or to bundle it in the install (since even gcc is bundled, I think adding openssl would make a small difference). \n\nWhat do you think?\n\nHere is how the headers look on my end, with a homebrew openssl (note that the text scrolls to the right):\n\n```\n% ls /usr/local/opt/openssl/include/openssl\naes.h         bio.h         camellia.h    comp.h        des.h         dso.h         ec.h          err.h         krb5_asn.h    md5.h         objects.h     ossl_typ.h    pkcs7.h       rc4.h         seed.h        ssl.h         stack.h       txt_db.h      x509.h\nasn1.h        blowfish.h    cast.h        conf.h        des_old.h     dtls1.h       ecdh.h        evp.h         kssl.h        mdc2.h        ocsp.h        pem.h         pqueue.h      ripemd.h      sha.h         ssl2.h        symhacks.h    ui.h          x509_vfy.h\nasn1_mac.h    bn.h          cmac.h        conf_api.h    dh.h          e_os2.h       ecdsa.h       hmac.h        lhash.h       modes.h       opensslconf.h pem2.h        rand.h        rsa.h         srp.h         ssl23.h       tls1.h        ui_compat.h   x509v3.h\nasn1t.h       buffer.h      cms.h         crypto.h      dsa.h         ebcdic.h      engine.h      idea.h        md4.h         obj_mac.h     opensslv.h    pkcs12.h      rc2.h         safestack.h   srtp.h        ssl3.h        ts.h          whrlpool.h\n```",
    "created_at": "2016-12-24T09:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301045",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Having updated to 10.12.2 I do not have this directory either, anymore. Therefore, I think the most reasonable way of proceeding is either to require users to roll their own openssl (or perhaps some compatible alternative) via e.g. homebrew, or to bundle it in the install (since even gcc is bundled, I think adding openssl would make a small difference). 

What do you think?

Here is how the headers look on my end, with a homebrew openssl (note that the text scrolls to the right):

```
% ls /usr/local/opt/openssl/include/openssl
aes.h         bio.h         camellia.h    comp.h        des.h         dso.h         ec.h          err.h         krb5_asn.h    md5.h         objects.h     ossl_typ.h    pkcs7.h       rc4.h         seed.h        ssl.h         stack.h       txt_db.h      x509.h
asn1.h        blowfish.h    cast.h        conf.h        des_old.h     dtls1.h       ecdh.h        evp.h         kssl.h        mdc2.h        ocsp.h        pem.h         pqueue.h      ripemd.h      sha.h         ssl2.h        symhacks.h    ui.h          x509_vfy.h
asn1_mac.h    bn.h          cmac.h        conf_api.h    dh.h          e_os2.h       ecdsa.h       hmac.h        lhash.h       modes.h       opensslconf.h pem2.h        rand.h        rsa.h         srp.h         ssl23.h       tls1.h        ui_compat.h   x509v3.h
asn1t.h       buffer.h      cms.h         crypto.h      dsa.h         ebcdic.h      engine.h      idea.h        md4.h         obj_mac.h     opensslv.h    pkcs12.h      rc2.h         safestack.h   srtp.h        ssl3.h        ts.h          whrlpool.h
```



---

archive/issue_comments_301046.json:
```json
{
    "body": "I removed the code that takes the openssl libraries from the swift framework as apparently this is a very short-lived solution (already disappeared on 10.12.1).\n\nInstead, I am now allowing the user to specify directly via OPENSSL_INCLUDE environment variable, and if it is not defined, I test the directory homebrew installs openssl to. If someone knows where fink/macports install the headers, I can add those as well. Finally, where would be a good place to put the documentation regarding the new environment variable?\n\n---\nNew commits:",
    "created_at": "2017-01-08T10:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301046",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

I removed the code that takes the openssl libraries from the swift framework as apparently this is a very short-lived solution (already disappeared on 10.12.1).

Instead, I am now allowing the user to specify directly via OPENSSL_INCLUDE environment variable, and if it is not defined, I test the directory homebrew installs openssl to. If someone knows where fink/macports install the headers, I can add those as well. Finally, where would be a good place to put the documentation regarding the new environment variable?

---
New commits:



---

archive/issue_comments_301047.json:
```json
{
    "body": "According to the top level configure file, Sage is not likely to build if either fink or MacPorts is installed:\n\n```\n###########################################################################\n# (OS X only)\n# Sage will probably not build at all if either Fink or MacPorts can be\n# found, and the error messages can be extremely confusing.  Even if it does\n# build, the product will probably be wrong.  This runs a basic check to\n# find them. Once the Sage build process is perfected, this won't be necessary.\n# dphilp 15/9/2008\n###########################################################################\n    PORTS_PATH=`which port`\n    if test -f \"$PORTS_PATH\"; then\nas_fn_error $? \"\\\"found MacPorts in $PORTS_PATH. Either:\n(1) rename /opt/local and /sw, or\n(2) change PATH and DYLD_LIBRARY_PATH\n(Once Sage is built, you can restore them.)\" \"$LINENO\" 5\n    fi\n\n    FINK_PATH=`which fink`\n    if test -f \"$FINK_PATH\"; then\nas_fn_error $? \"\\\"found Fink in $FINK_PATH. Either:\n(1) rename /opt/local and /sw, or\n(2) change PATH and DYLD_LIBRARY_PATH\n(Once Sage is built, you can restore them.)\" \"$LINENO\" 5\n    fi\nfi\n\n```\nSo we shouldn't use them for headers. I don't know if the same is true of homebrew.",
    "created_at": "2017-01-08T16:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301047",
    "user": "https://github.com/jhpalmieri"
}
```

According to the top level configure file, Sage is not likely to build if either fink or MacPorts is installed:

```
###########################################################################
# (OS X only)
# Sage will probably not build at all if either Fink or MacPorts can be
# found, and the error messages can be extremely confusing.  Even if it does
# build, the product will probably be wrong.  This runs a basic check to
# find them. Once the Sage build process is perfected, this won't be necessary.
# dphilp 15/9/2008
###########################################################################
    PORTS_PATH=`which port`
    if test -f "$PORTS_PATH"; then
as_fn_error $? "\"found MacPorts in $PORTS_PATH. Either:
(1) rename /opt/local and /sw, or
(2) change PATH and DYLD_LIBRARY_PATH
(Once Sage is built, you can restore them.)" "$LINENO" 5
    fi

    FINK_PATH=`which fink`
    if test -f "$FINK_PATH"; then
as_fn_error $? "\"found Fink in $FINK_PATH. Either:
(1) rename /opt/local and /sw, or
(2) change PATH and DYLD_LIBRARY_PATH
(Once Sage is built, you can restore them.)" "$LINENO" 5
    fi
fi

```
So we shouldn't use them for headers. I don't know if the same is true of homebrew.



---

archive/issue_comments_301048.json:
```json
{
    "body": "Ah, good to know!\n\nWell, I successfully built it while having homebrew installed and it worked fine AFAICT, but still, I can't exclude \"the product will probably be wrong\". If you don't like it, I can just remove the test for the homebrew headers and just rely on the user to input the appropriate environment variable.",
    "created_at": "2017-01-08T16:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301048",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Ah, good to know!

Well, I successfully built it while having homebrew installed and it worked fine AFAICT, but still, I can't exclude "the product will probably be wrong". If you don't like it, I can just remove the test for the homebrew headers and just rely on the user to input the appropriate environment variable.



---

archive/issue_comments_301049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-09T09:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-12T22:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301051.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-12T22:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301051",
    "user": "https://trac.sagemath.org/admin/accounts/users/Kosta"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-12T22:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_301053.json:
```json
{
    "body": "i run this on my macbook with \"El Capitan\", and it solves the TLS/SSL issue successfully. i think this is very helpful for mac users.\n\nunless some of you disagree, i'd suggest to accept it (in a week or so). thanks.",
    "created_at": "2017-09-17T19:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301053",
    "user": "https://github.com/mforets"
}
```

i run this on my macbook with "El Capitan", and it solves the TLS/SSL issue successfully. i think this is very helpful for mac users.

unless some of you disagree, i'd suggest to accept it (in a week or so). thanks.



---

archive/issue_events_057868.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-09-17T19:03:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21944#event-57868"
}
```



---

archive/issue_comments_301054.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-26T16:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301054",
    "user": "https://github.com/mforets"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301055.json:
```json
{
    "body": "The branch may be obtained here: https://github.com/dimpase/sagetrac-mirror/tree/u/Kosta/21944/osx_openssl",
    "created_at": "2017-09-27T08:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301055",
    "user": "https://github.com/dimpase"
}
```

The branch may be obtained here: https://github.com/dimpase/sagetrac-mirror/tree/u/Kosta/21944/osx_openssl



---

archive/issue_events_057869.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-01T00:19:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21944#event-57869"
}
```



---

archive/issue_comments_301056.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-01T00:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21944#issuecomment-301056",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
