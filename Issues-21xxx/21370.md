# Issue 21370: Multigraph plot and error with edge_colors

archive/issues_021133.json:
```json
{
    "assignees": [],
    "body": "There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n\n```\n# Third edge\ng = Graph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(0, 1)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# Direction of arrow\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\n```\n# This must work even without multiedges=True\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# An example to check, failed at some point:\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```\n\n```\n# Labels in non-multigraph should also work in color settings:\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nAfter this patch all of those works.\n\nCC:  @paulmasson\n\nBranch/Commit: **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**\n\nReviewer: **Jori M\u00e4ntysalo**\n\nAuthor: **Paul Masson**\n\nComponent: **graphics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21370_\n\n",
    "closed_at": "2016-09-16T06:55:19Z",
    "created_at": "2016-08-30T09:25:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Multigraph plot and error with edge_colors",
    "type": "issue",
    "updated_at": "2016-09-16T06:55:19Z",
    "url": "https://github.com/sagemath/sage/issues/21370",
    "user": "https://github.com/jm58660"
}
```
There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:

```
# Third edge
g = Graph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(0, 1)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# Direction of arrow
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

```
# This must work even without multiedges=True
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# An example to check, failed at some point:
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```

```
# Labels in non-multigraph should also work in color settings:
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

After this patch all of those works.

CC:  @paulmasson

Branch/Commit: **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**

Reviewer: **Jori Mäntysalo**

Author: **Paul Masson**

Component: **graphics**

_Issue created by migration from https://trac.sagemath.org/ticket/21370_





---

archive/issue_events_300248.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300248"
}
```



---

archive/issue_events_300249.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300249"
}
```



---

archive/issue_events_300250.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300250"
}
```



---

archive/issue_events_300251.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300251"
}
```



---

archive/issue_comments_312785.json:
```json
{
    "body": "Branch: **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)**",
    "created_at": "2016-08-30T23:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312785",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)**



---

archive/issue_comments_312786.json:
```json
{
    "body": "Commit: **[`81621d3`](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)**",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312786",
    "user": "https://github.com/paulmasson"
}
```

Commit: **[`81621d3`](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)**



---

archive/issue_comments_312787.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is propably my error in some former ticket.\n+It is probably my error in some former ticket.\n \n``````\n",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312787",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is propably my error in some former ticket.
+It is probably my error in some former ticket.
 
``````




---

archive/issue_comments_312788.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nJori, it wasn't your doing: bad indentation from 2009. This should fix the problem.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b\">81621d3</a></td><td><code>Fix indentation</code></td></tr></table>\n",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312788",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:2" align="right">comment:2</div>

Jori, it wasn't your doing: bad indentation from 2009. This should fix the problem.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b">81621d3</a></td><td><code>Fix indentation</code></td></tr></table>




---

archive/issue_events_300252.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-08-30T23:24:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300252"
}
```



---

archive/issue_comments_312789.json:
```json
{
    "body": "Author: **Paul Masson**",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312789",
    "user": "https://github.com/paulmasson"
}
```

Author: **Paul Masson**



---

archive/issue_comments_312790.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@paulmasson](#comment:2):\n>This should fix the problem.\n\nIt does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:\n\n```\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\nAfter your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?",
    "created_at": "2016-08-31T05:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312790",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@paulmasson](#comment:2):
>This should fix the problem.

It does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:

```
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

After your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?



---

archive/issue_comments_312791.json:
```json
{
    "body": "Reviewer: **Jori M\u00e4ntysalo**",
    "created_at": "2016-08-31T05:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312791",
    "user": "https://github.com/jm58660"
}
```

Reviewer: **Jori Mäntysalo**



---

archive/issue_comments_312792.json:
```json
{
    "body": "Changed commit from **[`81621d3`](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)** to **[`203259b`](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)**",
    "created_at": "2016-08-31T21:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312792",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`81621d3`](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)** to **[`203259b`](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)**



---

archive/issue_comments_312793.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe\">0db4ef9</a></td><td><code>Remove unnecessary default_edge_color</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a\">203259b</a></td><td><code>Replace test by label with explicit list of edges</code></td></tr></table>\n",
    "created_at": "2016-08-31T21:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312793",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe">0db4ef9</a></td><td><code>Remove unnecessary default_edge_color</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a">203259b</a></td><td><code>Replace test by label with explicit list of edges</code></td></tr></table>




---

archive/issue_comments_312794.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.\n\nI replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.\n\nI've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.",
    "created_at": "2016-08-31T22:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312794",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:5" align="right">comment:5</div>

The additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.

I replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.

I've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.



---

archive/issue_comments_312795.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNow this fails:\n\n```\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\nIt works with `g.allow_multiple_edges(True)`.\n\nI can try to get more failing examples today.",
    "created_at": "2016-09-01T03:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312795",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:6" align="right">comment:6</div>

Now this fails:

```
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

It works with `g.allow_multiple_edges(True)`.

I can try to get more failing examples today.



---

archive/issue_comments_312796.json:
```json
{
    "body": "Changed commit from **[`203259b`](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)** to **[`2d4fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)**",
    "created_at": "2016-09-04T00:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312796",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`203259b`](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)** to **[`2d4fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)**



---

archive/issue_comments_312797.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da\">2d4fb4b</a></td><td><code>Add append_or_set() and catch another case</code></td></tr></table>\n",
    "created_at": "2016-09-04T00:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312797",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da">2d4fb4b</a></td><td><code>Add append_or_set() and catch another case</code></td></tr></table>




---

archive/issue_comments_312798.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nJori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.\n\nTo clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.",
    "created_at": "2016-09-04T00:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312798",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:8" align="right">comment:8</div>

Jori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.

To clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.



---

archive/issue_comments_312799.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106\">12c9be3</a></td><td><code>Track labels in edges_drawn</code></td></tr></table>\n",
    "created_at": "2016-09-04T01:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312799",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106">12c9be3</a></td><td><code>Track labels in edges_drawn</code></td></tr></table>




---

archive/issue_comments_312800.json:
```json
{
    "body": "Changed commit from **[`2d4fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)** to **[`12c9be3`](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)**",
    "created_at": "2016-09-04T01:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312800",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d4fb4b`](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)** to **[`12c9be3`](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)**



---

archive/issue_comments_312801.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThere is an example in #21368 that was not covered by the last commit. It should be covered now.",
    "created_at": "2016-09-04T01:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312801",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:10" align="right">comment:10</div>

There is an example in #21368 that was not covered by the last commit. It should be covered now.



---

archive/issue_comments_312802.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFails with\n\n```\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```",
    "created_at": "2016-09-05T08:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312802",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:11" align="right">comment:11</div>

Fails with

```
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```



---

archive/issue_comments_312803.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHowever, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.",
    "created_at": "2016-09-05T09:10:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312803",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:12" align="right">comment:12</div>

However, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.



---

archive/issue_comments_312804.json:
```json
{
    "body": "Changed commit from **[`12c9be3`](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)** to **[`294b5b8`](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)**",
    "created_at": "2016-09-09T01:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312804",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`12c9be3`](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)** to **[`294b5b8`](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)**



---

archive/issue_comments_312805.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff\">294b5b8</a></td><td><code>Handle multiple instances of label</code></td></tr></table>\n",
    "created_at": "2016-09-09T01:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312805",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff">294b5b8</a></td><td><code>Handle multiple instances of label</code></td></tr></table>




---

archive/issue_comments_312806.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThat should cover the latest failing case. Any others?",
    "created_at": "2016-09-09T01:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312806",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:14" align="right">comment:14</div>

That should cover the latest failing case. Any others?



---

archive/issue_comments_312807.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIt gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:\n\n```\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nIt kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.\n\nBut as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!",
    "created_at": "2016-09-09T07:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312807",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:15" align="right">comment:15</div>

It gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:

```
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

It kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.

But as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!



---

archive/issue_comments_312808.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e\">3011720</a></td><td><code>Check for exact label</code></td></tr></table>\n",
    "created_at": "2016-09-09T21:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312808",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e">3011720</a></td><td><code>Check for exact label</code></td></tr></table>




---

archive/issue_comments_312809.json:
```json
{
    "body": "Changed commit from **[`294b5b8`](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)** to **[`3011720`](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)**",
    "created_at": "2016-09-09T21:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312809",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`294b5b8`](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)** to **[`3011720`](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)**



---

archive/issue_comments_312810.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFixed! Anything else?",
    "created_at": "2016-09-09T21:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312810",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:17" align="right">comment:17</div>

Fixed! Anything else?



---

archive/issue_comments_312811.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@paulmasson](#comment:17):\n> Fixed! Anything else?\n\nI tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.\n\nSo I suppose this if perfect now. Next I'll try to understand the code. Thanks!",
    "created_at": "2016-09-10T06:22:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312811",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@paulmasson](#comment:17):
> Fixed! Anything else?

I tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.

So I suppose this if perfect now. Next I'll try to understand the code. Thanks!



---

archive/issue_comments_312812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,40 @@\n-This shows third edge:\n+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n \n ```\n+# Third edge\n g = Graph(); g.allow_multiple_edges(True)\n g.add_edge(0, 1); g.add_edge(0, 1)\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is probably my error in some former ticket.\n+```\n+# Direction of arrow\n+g = DiGraph(); g.allow_multiple_edges(True)\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+g.show()\n+```\n \n+```\n+# This must work even without multiedges=True\n+g = DiGraph();\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+```\n+\n+```\n+# An example to check, failed at some point:\n+x = 101; y = 102\n+g = DiGraph(multiedges=True)\n+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \n+g.show(edge_colors={'red': [(0, 1, x)]})\n+```\n+\n+```\n+# Labels in non-multigraph should also work in color settings:\n+g = DiGraph(loops=True)\n+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\n+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n+```\n+\n+After this patch all of those works.\n``````\n",
    "created_at": "2016-09-11T05:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312812",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,40 @@
-This shows third edge:
+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:
 
 ```
+# Third edge
 g = Graph(); g.allow_multiple_edges(True)
 g.add_edge(0, 1); g.add_edge(0, 1)
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is probably my error in some former ticket.
+```
+# Direction of arrow
+g = DiGraph(); g.allow_multiple_edges(True)
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+g.show()
+```
 
+```
+# This must work even without multiedges=True
+g = DiGraph();
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+```
+
+```
+# An example to check, failed at some point:
+x = 101; y = 102
+g = DiGraph(multiedges=True)
+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
+g.show(edge_colors={'red': [(0, 1, x)]})
+```
+
+```
+# Labels in non-multigraph should also work in color settings:
+g = DiGraph(loops=True)
+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
+```
+
+After this patch all of those works.
``````




---

archive/issue_comments_312813.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOK, I mark this as positive review.\n\nI can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.",
    "created_at": "2016-09-11T05:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312813",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:19" align="right">comment:19</div>

OK, I mark this as positive review.

I can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.



---

archive/issue_events_300253.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-11T05:37:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300253"
}
```



---

archive/issue_events_300254.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-11T05:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300254"
}
```



---

archive/issue_comments_312814.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\npatchbot is not happy at all..",
    "created_at": "2016-09-11T20:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312814",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

patchbot is not happy at all..



---

archive/issue_events_300255.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-11T20:37:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300255"
}
```



---

archive/issue_events_300256.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-11T20:37:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300256"
}
```



---

archive/issue_comments_312815.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?",
    "created_at": "2016-09-11T20:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312815",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?



---

archive/issue_comments_312816.json:
```json
{
    "body": "Changed commit from **[`3011720`](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)** to **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**",
    "created_at": "2016-09-12T00:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312816",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3011720`](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)** to **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**



---

archive/issue_comments_312817.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786\">99c193e</a></td><td><code>Fix doctests</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312817",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786">99c193e</a></td><td><code>Fix doctests</code></td></tr></table>




---

archive/issue_events_300257.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-12T00:28:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300257"
}
```



---

archive/issue_events_300258.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-12T00:28:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300258"
}
```



---

archive/issue_comments_312818.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nDoctests should all be fixed. Jori, please test the examples in the previously failing doctests.",
    "created_at": "2016-09-12T00:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312818",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:23" align="right">comment:23</div>

Doctests should all be fixed. Jori, please test the examples in the previously failing doctests.



---

archive/issue_events_300259.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-12T05:32:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300259"
}
```



---

archive/issue_events_300260.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-12T05:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300260"
}
```



---

archive/issue_comments_312819.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nDoctests passed.",
    "created_at": "2016-09-12T05:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312819",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:24" align="right">comment:24</div>

Doctests passed.



---

archive/issue_events_300261.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300261"
}
```



---

archive/issue_events_300262.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "26e7d0a12ed70782a26c42d8fad62b7ba0d649ac",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-300262"
}
```



---

archive/issue_comments_312820.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)** to **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**",
    "created_at": "2016-09-16T06:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-312820",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)** to **[`99c193e`](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**
