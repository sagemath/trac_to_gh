# Issue 21370: Multigraph plot and error with edge_colors

archive/issues_021133.json:
```json
{
    "body": "There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n\n```\n# Third edge\ng = Graph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(0, 1)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# Direction of arrow\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\n```\n# This must work even without multiedges=True\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# An example to check, failed at some point:\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```\n\n```\n# Labels in non-multigraph should also work in color settings:\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nAfter this patch all of those works.\n\nCC:  @paulmasson\n\nBranch/Commit: [99c193e03e68b5e67d1de586d885071cecdb6786](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)\n\nReviewer: Jori M\u00e4ntysalo\n\nAuthor: Paul Masson\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21370\n\n",
    "closed_at": "2016-09-16T06:55:19Z",
    "created_at": "2016-08-30T09:25:07Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Multigraph plot and error with edge_colors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21370",
    "user": "https://github.com/jm58660"
}
```
There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:

```
# Third edge
g = Graph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(0, 1)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# Direction of arrow
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

```
# This must work even without multiedges=True
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# An example to check, failed at some point:
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```

```
# Labels in non-multigraph should also work in color settings:
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

After this patch all of those works.

CC:  @paulmasson

Branch/Commit: [99c193e03e68b5e67d1de586d885071cecdb6786](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)

Reviewer: Jori Mäntysalo

Author: Paul Masson

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21370





---

archive/issue_comments_395756.json:
```json
{
    "body": "Changing branch from \"\" to \"u/paulmasson/21370\"",
    "created_at": "2016-08-30T23:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395756",
    "user": "https://github.com/paulmasson"
}
```

Changing branch from "" to "u/paulmasson/21370"



---

archive/issue_comments_395757.json:
```json
{
    "body": "Changing commit from \"\" to \"81621d339bf66d41a33b4c370cd025b23658d85b\"",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395757",
    "user": "https://github.com/paulmasson"
}
```

Changing commit from "" to "81621d339bf66d41a33b4c370cd025b23658d85b"



---

archive/issue_comments_395758.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is propably my error in some former ticket.\n+It is probably my error in some former ticket.\n \n``````\n",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395758",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is propably my error in some former ticket.
+It is probably my error in some former ticket.
 
``````




---

archive/issue_comments_395759.json:
```json
{
    "body": "<a id='comment:2'></a>\nJori, it wasn't your doing: bad indentation from 2009. This should fix the problem.\n\n---\nNew commits:\n|                                                                                                                                          |                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)|`Fix indentation`|",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395759",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'></a>
Jori, it wasn't your doing: bad indentation from 2009. This should fix the problem.

---
New commits:
|                                                                                                                                          |                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)|`Fix indentation`|



---

archive/issue_comments_395760.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395760",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_395761.json:
```json
{
    "body": "Changing author from \"\" to \"Paul Masson\"",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395761",
    "user": "https://github.com/paulmasson"
}
```

Changing author from "" to "Paul Masson"



---

archive/issue_comments_395762.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [paulmasson](#comment%3A2):\n>This should fix the problem.\n\n\nIt does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:\n\n```\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\nAfter your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?",
    "created_at": "2016-08-31T05:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395762",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>
Replying to [paulmasson](#comment%3A2):
>This should fix the problem.


It does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:

```
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

After your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?



---

archive/issue_comments_395763.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jori M\u00e4ntysalo\"",
    "created_at": "2016-08-31T05:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395763",
    "user": "https://github.com/jm58660"
}
```

Changing reviewer from "" to "Jori Mäntysalo"



---

archive/issue_comments_395764.json:
```json
{
    "body": "Changing commit from \"81621d339bf66d41a33b4c370cd025b23658d85b\" to \"203259b3d4dcfcec3b9ea4cfb72606161206537a\"",
    "created_at": "2016-08-31T21:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "81621d339bf66d41a33b4c370cd025b23658d85b" to "203259b3d4dcfcec3b9ea4cfb72606161206537a"



---

archive/issue_comments_395765.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[0db4ef9](https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe)|`Remove unnecessary default_edge_color`|\n|[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)|`Replace test by label with explicit list of edges`|",
    "created_at": "2016-08-31T21:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[0db4ef9](https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe)|`Remove unnecessary default_edge_color`|
|[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)|`Replace test by label with explicit list of edges`|



---

archive/issue_comments_395766.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.\n\nI replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.\n\nI've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.",
    "created_at": "2016-08-31T22:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395766",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:5'></a>
The additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.

I replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.

I've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.



---

archive/issue_comments_395767.json:
```json
{
    "body": "<a id='comment:6'></a>\nNow this fails:\n\n```\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\nIt works with `g.allow_multiple_edges(True)`.\n\nI can try to get more failing examples today.",
    "created_at": "2016-09-01T03:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395767",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'></a>
Now this fails:

```
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

It works with `g.allow_multiple_edges(True)`.

I can try to get more failing examples today.



---

archive/issue_comments_395768.json:
```json
{
    "body": "Changing commit from \"203259b3d4dcfcec3b9ea4cfb72606161206537a\" to \"2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da\"",
    "created_at": "2016-09-04T00:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "203259b3d4dcfcec3b9ea4cfb72606161206537a" to "2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da"



---

archive/issue_comments_395769.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)|`Add append_or_set() and catch another case`|",
    "created_at": "2016-09-04T00:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)|`Add append_or_set() and catch another case`|



---

archive/issue_comments_395770.json:
```json
{
    "body": "<a id='comment:8'></a>\nJori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.\n\nTo clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.",
    "created_at": "2016-09-04T00:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395770",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:8'></a>
Jori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.

To clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.



---

archive/issue_comments_395771.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)|`Track labels in edges_drawn`|",
    "created_at": "2016-09-04T01:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)|`Track labels in edges_drawn`|



---

archive/issue_comments_395772.json:
```json
{
    "body": "Changing commit from \"2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da\" to \"12c9be374de2b804a37d5bd564fa7889b4498106\"",
    "created_at": "2016-09-04T01:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da" to "12c9be374de2b804a37d5bd564fa7889b4498106"



---

archive/issue_comments_395773.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is an example in #21368 that was not covered by the last commit. It should be covered now.",
    "created_at": "2016-09-04T01:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395773",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:10'></a>
There is an example in #21368 that was not covered by the last commit. It should be covered now.



---

archive/issue_comments_395774.json:
```json
{
    "body": "<a id='comment:11'></a>\nFails with\n\n```\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```",
    "created_at": "2016-09-05T08:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395774",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>
Fails with

```
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```



---

archive/issue_comments_395775.json:
```json
{
    "body": "<a id='comment:12'></a>\nHowever, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.",
    "created_at": "2016-09-05T09:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395775",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>
However, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.



---

archive/issue_comments_395776.json:
```json
{
    "body": "Changing commit from \"12c9be374de2b804a37d5bd564fa7889b4498106\" to \"294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff\"",
    "created_at": "2016-09-09T01:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "12c9be374de2b804a37d5bd564fa7889b4498106" to "294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff"



---

archive/issue_comments_395777.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)|`Handle multiple instances of label`|",
    "created_at": "2016-09-09T01:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)|`Handle multiple instances of label`|



---

archive/issue_comments_395778.json:
```json
{
    "body": "<a id='comment:14'></a>\nThat should cover the latest failing case. Any others?",
    "created_at": "2016-09-09T01:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395778",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:14'></a>
That should cover the latest failing case. Any others?



---

archive/issue_comments_395779.json:
```json
{
    "body": "<a id='comment:15'></a>\nIt gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:\n\n```\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nIt kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.\n\nBut as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!",
    "created_at": "2016-09-09T07:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395779",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:15'></a>
It gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:

```
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

It kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.

But as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!



---

archive/issue_comments_395780.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)|`Check for exact label`|",
    "created_at": "2016-09-09T21:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)|`Check for exact label`|



---

archive/issue_comments_395781.json:
```json
{
    "body": "Changing commit from \"294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff\" to \"3011720815f75c5af66b6a789b32ece76051b92e\"",
    "created_at": "2016-09-09T21:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff" to "3011720815f75c5af66b6a789b32ece76051b92e"



---

archive/issue_comments_395782.json:
```json
{
    "body": "<a id='comment:17'></a>\nFixed! Anything else?",
    "created_at": "2016-09-09T21:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395782",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:17'></a>
Fixed! Anything else?



---

archive/issue_comments_395783.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [paulmasson](#comment%3A17):\n> Fixed! Anything else?\n\n\nI tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.\n\nSo I suppose this if perfect now. Next I'll try to understand the code. Thanks!",
    "created_at": "2016-09-10T06:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395783",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:18'></a>
Replying to [paulmasson](#comment%3A17):
> Fixed! Anything else?


I tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.

So I suppose this if perfect now. Next I'll try to understand the code. Thanks!



---

archive/issue_comments_395784.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,40 @@\n-This shows third edge:\n+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n \n ```\n+# Third edge\n g = Graph(); g.allow_multiple_edges(True)\n g.add_edge(0, 1); g.add_edge(0, 1)\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is probably my error in some former ticket.\n+```\n+# Direction of arrow\n+g = DiGraph(); g.allow_multiple_edges(True)\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+g.show()\n+```\n \n+```\n+# This must work even without multiedges=True\n+g = DiGraph();\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+```\n+\n+```\n+# An example to check, failed at some point:\n+x = 101; y = 102\n+g = DiGraph(multiedges=True)\n+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \n+g.show(edge_colors={'red': [(0, 1, x)]})\n+```\n+\n+```\n+# Labels in non-multigraph should also work in color settings:\n+g = DiGraph(loops=True)\n+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\n+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n+```\n+\n+After this patch all of those works.\n``````\n",
    "created_at": "2016-09-11T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395784",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,40 @@
-This shows third edge:
+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:
 
 ```
+# Third edge
 g = Graph(); g.allow_multiple_edges(True)
 g.add_edge(0, 1); g.add_edge(0, 1)
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is probably my error in some former ticket.
+```
+# Direction of arrow
+g = DiGraph(); g.allow_multiple_edges(True)
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+g.show()
+```
 
+```
+# This must work even without multiedges=True
+g = DiGraph();
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+```
+
+```
+# An example to check, failed at some point:
+x = 101; y = 102
+g = DiGraph(multiedges=True)
+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
+g.show(edge_colors={'red': [(0, 1, x)]})
+```
+
+```
+# Labels in non-multigraph should also work in color settings:
+g = DiGraph(loops=True)
+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
+```
+
+After this patch all of those works.
``````




---

archive/issue_comments_395785.json:
```json
{
    "body": "<a id='comment:19'></a>\nOK, I mark this as positive review.\n\nI can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.",
    "created_at": "2016-09-11T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395785",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:19'></a>
OK, I mark this as positive review.

I can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.



---

archive/issue_comments_395786.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-11T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395786",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_395787.json:
```json
{
    "body": "<a id='comment:20'></a>\npatchbot is not happy at all..",
    "created_at": "2016-09-11T20:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395787",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
patchbot is not happy at all..



---

archive/issue_comments_395788.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-11T20:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395788",
    "user": "https://github.com/paulmasson"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_395789.json:
```json
{
    "body": "<a id='comment:21'></a>\nI'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?",
    "created_at": "2016-09-11T20:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395789",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:21'></a>
I'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?



---

archive/issue_comments_395790.json:
```json
{
    "body": "Changing commit from \"3011720815f75c5af66b6a789b32ece76051b92e\" to \"99c193e03e68b5e67d1de586d885071cecdb6786\"",
    "created_at": "2016-09-12T00:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3011720815f75c5af66b6a789b32ece76051b92e" to "99c193e03e68b5e67d1de586d885071cecdb6786"



---

archive/issue_comments_395791.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)|`Fix doctests`|",
    "created_at": "2016-09-12T00:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)|`Fix doctests`|



---

archive/issue_comments_395792.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-12T00:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395792",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_395793.json:
```json
{
    "body": "<a id='comment:23'></a>\nDoctests should all be fixed. Jori, please test the examples in the previously failing doctests.",
    "created_at": "2016-09-12T00:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395793",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:23'></a>
Doctests should all be fixed. Jori, please test the examples in the previously failing doctests.



---

archive/issue_comments_395794.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-12T05:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395794",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_395795.json:
```json
{
    "body": "<a id='comment:24'></a>\nDoctests passed.",
    "created_at": "2016-09-12T05:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395795",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:24'></a>
Doctests passed.



---

archive/issue_comments_395796.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-16T06:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395796",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_064619.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21370#event-64619"
}
```



---

archive/issue_comments_395797.json:
```json
{
    "body": "Changing branch from \"u/paulmasson/21370\" to \"99c193e03e68b5e67d1de586d885071cecdb6786\"",
    "created_at": "2016-09-16T06:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21370#issuecomment-395797",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/paulmasson/21370" to "99c193e03e68b5e67d1de586d885071cecdb6786"
