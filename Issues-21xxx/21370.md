# Issue 21370: Multigraph plot and error with edge_colors

archive/issues_021133.json:
```json
{
    "assignees": [],
    "body": "There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n\n```\n# Third edge\ng = Graph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(0, 1)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# Direction of arrow\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\n```\n# This must work even without multiedges=True\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n```\n# An example to check, failed at some point:\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```\n\n```\n# Labels in non-multigraph should also work in color settings:\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nAfter this patch all of those works.\n\nCC:  @paulmasson\n\nBranch/Commit: **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**\n\nReviewer: **Jori M\u00e4ntysalo**\n\nAuthor: **Paul Masson**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21370_\n\n",
    "closed_at": "2016-09-16T06:55:19Z",
    "created_at": "2016-08-30T09:25:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Multigraph plot and error with edge_colors",
    "type": "issue",
    "updated_at": "2016-09-16T06:55:19Z",
    "url": "https://github.com/sagemath/sage/issues/21370",
    "user": "https://github.com/jm58660"
}
```
There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:

```
# Third edge
g = Graph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(0, 1)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# Direction of arrow
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

```
# This must work even without multiedges=True
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

```
# An example to check, failed at some point:
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```

```
# Labels in non-multigraph should also work in color settings:
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

After this patch all of those works.

CC:  @paulmasson

Branch/Commit: **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**

Reviewer: **Jori MÃ¤ntysalo**

Author: **Paul Masson**

_Issue created by migration from https://trac.sagemath.org/ticket/21370_





---

archive/issue_events_282317.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282317"
}
```



---

archive/issue_events_282318.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "component: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282318"
}
```



---

archive/issue_events_282319.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282319"
}
```



---

archive/issue_events_282320.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-30T09:25:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282320"
}
```



---

archive/issue_comments_315351.json:
```json
{
    "body": "Branch: **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)**",
    "created_at": "2016-08-30T23:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315351",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)**



---

archive/issue_comments_315352.json:
```json
{
    "body": "Commit: **[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)**",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315352",
    "user": "https://github.com/paulmasson"
}
```

Commit: **[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)**



---

archive/issue_comments_315353.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is propably my error in some former ticket.\n+It is probably my error in some former ticket.\n \n``````\n",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315353",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is propably my error in some former ticket.
+It is probably my error in some former ticket.
 
``````




---

archive/issue_comments_315354.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nJori, it wasn't your doing: bad indentation from 2009. This should fix the problem.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b\">81621d3</a></td><td><code>Fix indentation</code></td></tr></table>\n",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315354",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'>Comment 2:</a>
Jori, it wasn't your doing: bad indentation from 2009. This should fix the problem.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b">81621d3</a></td><td><code>Fix indentation</code></td></tr></table>




---

archive/issue_events_282321.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-08-30T23:24:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282321"
}
```



---

archive/issue_comments_315355.json:
```json
{
    "body": "Author: **Paul Masson**",
    "created_at": "2016-08-30T23:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315355",
    "user": "https://github.com/paulmasson"
}
```

Author: **Paul Masson**



---

archive/issue_comments_315356.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nReplying to [@paulmasson](#comment%3A2):\n>This should fix the problem.\n\nIt does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:\n\n```\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\nAfter your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?",
    "created_at": "2016-08-31T05:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315356",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'>Comment 3:</a>
Replying to [@paulmasson](#comment%3A2):
>This should fix the problem.

It does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:

```
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```

After your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?



---

archive/issue_comments_315357.json:
```json
{
    "body": "Reviewer: **Jori M\u00e4ntysalo**",
    "created_at": "2016-08-31T05:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315357",
    "user": "https://github.com/jm58660"
}
```

Reviewer: **Jori MÃ¤ntysalo**



---

archive/issue_comments_315358.json:
```json
{
    "body": "Changed commit from **[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)** to **[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)**",
    "created_at": "2016-08-31T21:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315358",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[81621d3](https://github.com/sagemath/sagetrac-mirror/commit/81621d339bf66d41a33b4c370cd025b23658d85b)** to **[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)**



---

archive/issue_comments_315359.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe\">0db4ef9</a></td><td><code>Remove unnecessary default_edge_color</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a\">203259b</a></td><td><code>Replace test by label with explicit list of edges</code></td></tr></table>\n",
    "created_at": "2016-08-31T21:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315359",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0db4ef92aa8edec69969821b62e2cd3609ec9dbe">0db4ef9</a></td><td><code>Remove unnecessary default_edge_color</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a">203259b</a></td><td><code>Replace test by label with explicit list of edges</code></td></tr></table>




---

archive/issue_comments_315360.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThe additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.\n\nI replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.\n\nI've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.",
    "created_at": "2016-08-31T22:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315360",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:5'>Comment 5:</a>
The additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.

I replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.

I've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.



---

archive/issue_comments_315361.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nNow this fails:\n\n```\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\nIt works with `g.allow_multiple_edges(True)`.\n\nI can try to get more failing examples today.",
    "created_at": "2016-09-01T03:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315361",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'>Comment 6:</a>
Now this fails:

```
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```

It works with `g.allow_multiple_edges(True)`.

I can try to get more failing examples today.



---

archive/issue_comments_315362.json:
```json
{
    "body": "Changed commit from **[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)** to **[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)**",
    "created_at": "2016-09-04T00:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[203259b](https://github.com/sagemath/sagetrac-mirror/commit/203259b3d4dcfcec3b9ea4cfb72606161206537a)** to **[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)**



---

archive/issue_comments_315363.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da\">2d4fb4b</a></td><td><code>Add append_or_set() and catch another case</code></td></tr></table>\n",
    "created_at": "2016-09-04T00:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315363",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da">2d4fb4b</a></td><td><code>Add append_or_set() and catch another case</code></td></tr></table>




---

archive/issue_comments_315364.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nJori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.\n\nTo clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.",
    "created_at": "2016-09-04T00:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315364",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:8'>Comment 8:</a>
Jori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.

To clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.



---

archive/issue_comments_315365.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106\">12c9be3</a></td><td><code>Track labels in edges_drawn</code></td></tr></table>\n",
    "created_at": "2016-09-04T01:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315365",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106">12c9be3</a></td><td><code>Track labels in edges_drawn</code></td></tr></table>




---

archive/issue_comments_315366.json:
```json
{
    "body": "Changed commit from **[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)** to **[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)**",
    "created_at": "2016-09-04T01:13:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2d4fb4b](https://github.com/sagemath/sagetrac-mirror/commit/2d4fb4b9de2b42cdf2bc5aa2f978c1d03ef1f4da)** to **[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)**



---

archive/issue_comments_315367.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThere is an example in #21368 that was not covered by the last commit. It should be covered now.",
    "created_at": "2016-09-04T01:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315367",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:10'>Comment 10:</a>
There is an example in #21368 that was not covered by the last commit. It should be covered now.



---

archive/issue_comments_315368.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nFails with\n\n```\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```",
    "created_at": "2016-09-05T08:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315368",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'>Comment 11:</a>
Fails with

```
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```



---

archive/issue_comments_315369.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nHowever, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.",
    "created_at": "2016-09-05T09:10:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315369",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'>Comment 12:</a>
However, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.



---

archive/issue_comments_315370.json:
```json
{
    "body": "Changed commit from **[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)** to **[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)**",
    "created_at": "2016-09-09T01:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315370",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[12c9be3](https://github.com/sagemath/sagetrac-mirror/commit/12c9be374de2b804a37d5bd564fa7889b4498106)** to **[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)**



---

archive/issue_comments_315371.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff\">294b5b8</a></td><td><code>Handle multiple instances of label</code></td></tr></table>\n",
    "created_at": "2016-09-09T01:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315371",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff">294b5b8</a></td><td><code>Handle multiple instances of label</code></td></tr></table>




---

archive/issue_comments_315372.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nThat should cover the latest failing case. Any others?",
    "created_at": "2016-09-09T01:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315372",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:14'>Comment 14:</a>
That should cover the latest failing case. Any others?



---

archive/issue_comments_315373.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nIt gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:\n\n```\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\nIt kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.\n\nBut as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!",
    "created_at": "2016-09-09T07:14:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315373",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:15'>Comment 15:</a>
It gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:

```
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```

It kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.

But as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!



---

archive/issue_comments_315374.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e\">3011720</a></td><td><code>Check for exact label</code></td></tr></table>\n",
    "created_at": "2016-09-09T21:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315374",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e">3011720</a></td><td><code>Check for exact label</code></td></tr></table>




---

archive/issue_comments_315375.json:
```json
{
    "body": "Changed commit from **[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)** to **[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)**",
    "created_at": "2016-09-09T21:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315375",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[294b5b8](https://github.com/sagemath/sagetrac-mirror/commit/294b5b8247f803b14e4c4aec55cbdfbbb5e0a8ff)** to **[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)**



---

archive/issue_comments_315376.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nFixed! Anything else?",
    "created_at": "2016-09-09T21:43:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315376",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:17'>Comment 17:</a>
Fixed! Anything else?



---

archive/issue_comments_315377.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@paulmasson](#comment%3A17):\n> Fixed! Anything else?\n\nI tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.\n\nSo I suppose this if perfect now. Next I'll try to understand the code. Thanks!",
    "created_at": "2016-09-10T06:22:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315377",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@paulmasson](#comment%3A17):
> Fixed! Anything else?

I tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.

So I suppose this if perfect now. Next I'll try to understand the code. Thanks!



---

archive/issue_comments_315378.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,40 @@\n-This shows third edge:\n+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:\n \n ```\n+# Third edge\n g = Graph(); g.allow_multiple_edges(True)\n g.add_edge(0, 1); g.add_edge(0, 1)\n g.show(edge_colors={'red': [(0, 1)]})\n ```\n \n-It is probably my error in some former ticket.\n+```\n+# Direction of arrow\n+g = DiGraph(); g.allow_multiple_edges(True)\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+g.show()\n+```\n \n+```\n+# This must work even without multiedges=True\n+g = DiGraph();\n+g.add_edge(0, 1); g.add_edge(1, 0)\n+g.show(edge_colors={'red': [(0, 1)]})\n+```\n+\n+```\n+# An example to check, failed at some point:\n+x = 101; y = 102\n+g = DiGraph(multiedges=True)\n+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \n+g.show(edge_colors={'red': [(0, 1, x)]})\n+```\n+\n+```\n+# Labels in non-multigraph should also work in color settings:\n+g = DiGraph(loops=True)\n+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\n+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n+```\n+\n+After this patch all of those works.\n``````\n",
    "created_at": "2016-09-11T05:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315378",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,40 @@
-This shows third edge:
+There are several errors in color handling of graph edges when the graph has multiedges and/or loops. Here are some blocks to show those:
 
 ```
+# Third edge
 g = Graph(); g.allow_multiple_edges(True)
 g.add_edge(0, 1); g.add_edge(0, 1)
 g.show(edge_colors={'red': [(0, 1)]})
 ```
 
-It is probably my error in some former ticket.
+```
+# Direction of arrow
+g = DiGraph(); g.allow_multiple_edges(True)
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+g.show()
+```
 
+```
+# This must work even without multiedges=True
+g = DiGraph();
+g.add_edge(0, 1); g.add_edge(1, 0)
+g.show(edge_colors={'red': [(0, 1)]})
+```
+
+```
+# An example to check, failed at some point:
+x = 101; y = 102
+g = DiGraph(multiedges=True)
+g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
+g.show(edge_colors={'red': [(0, 1, x)]})
+```
+
+```
+# Labels in non-multigraph should also work in color settings:
+g = DiGraph(loops=True)
+g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
+g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
+```
+
+After this patch all of those works.
``````




---

archive/issue_comments_315379.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nOK, I mark this as positive review.\n\nI can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.",
    "created_at": "2016-09-11T05:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315379",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:19'>Comment 19:</a>
OK, I mark this as positive review.

I can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.



---

archive/issue_events_282322.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-11T05:37:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282322"
}
```



---

archive/issue_events_282323.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-11T05:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282323"
}
```



---

archive/issue_comments_315380.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\npatchbot is not happy at all..",
    "created_at": "2016-09-11T20:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315380",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'>Comment 20:</a>
patchbot is not happy at all..



---

archive/issue_events_282324.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-11T20:37:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282324"
}
```



---

archive/issue_events_282325.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-11T20:37:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282325"
}
```



---

archive/issue_comments_315381.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nI'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?",
    "created_at": "2016-09-11T20:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315381",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:21'>Comment 21:</a>
I'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?



---

archive/issue_comments_315382.json:
```json
{
    "body": "Changed commit from **[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)** to **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**",
    "created_at": "2016-09-12T00:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315382",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3011720](https://github.com/sagemath/sagetrac-mirror/commit/3011720815f75c5af66b6a789b32ece76051b92e)** to **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**



---

archive/issue_comments_315383.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786\">99c193e</a></td><td><code>Fix doctests</code></td></tr></table>\n",
    "created_at": "2016-09-12T00:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315383",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>Comment 22:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786">99c193e</a></td><td><code>Fix doctests</code></td></tr></table>




---

archive/issue_events_282326.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-12T00:28:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282326"
}
```



---

archive/issue_events_282327.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-09-12T00:28:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282327"
}
```



---

archive/issue_comments_315384.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nDoctests should all be fixed. Jori, please test the examples in the previously failing doctests.",
    "created_at": "2016-09-12T00:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315384",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:23'>Comment 23:</a>
Doctests should all be fixed. Jori, please test the examples in the previously failing doctests.



---

archive/issue_events_282328.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-12T05:32:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282328"
}
```



---

archive/issue_events_282329.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-12T05:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282329"
}
```



---

archive/issue_comments_315385.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nDoctests passed.",
    "created_at": "2016-09-12T05:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315385",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:24'>Comment 24:</a>
Doctests passed.



---

archive/issue_events_282330.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282330"
}
```



---

archive/issue_events_282331.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "26e7d0a12ed70782a26c42d8fad62b7ba0d649ac",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21370#event-282331"
}
```



---

archive/issue_comments_315386.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)** to **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**",
    "created_at": "2016-09-16T06:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21370#issuecomment-315386",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/21370](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/21370)** to **[99c193e](https://github.com/sagemath/sagetrac-mirror/commit/99c193e03e68b5e67d1de586d885071cecdb6786)**
