# Issue 21874: Make autogen/pari Python 3 compatible

archive/issues_021637.json:
```json
{
    "assignees": [],
    "body": "\n\nCC:  @defeo @fchapoton\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21874_\n\n",
    "closed_at": "2016-11-19T16:34:52Z",
    "created_at": "2016-11-13T22:49:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make autogen/pari Python 3 compatible",
    "type": "issue",
    "updated_at": "2016-11-19T16:34:52Z",
    "url": "https://github.com/sagemath/sage/issues/21874",
    "user": "https://github.com/jdemeyer"
}
```


CC:  @defeo @fchapoton

Component: **python3**

Author: **Frédéric Chapoton**

Branch/Commit: **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/21874_





---

archive/issue_events_304026.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304026"
}
```



---

archive/issue_events_304027.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304027"
}
```



---

archive/issue_events_304028.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304028"
}
```



---

archive/issue_events_304029.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304029"
}
```



---

archive/issue_comments_322337.json:
```json
{
    "body": "Branch: **[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)**",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322337",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)**



---

archive/issue_comments_322338.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4\"><code>c36156e</code></a></td><td><code>21874 py3 compatible autogen/pari (bytes for communicate)</code></td></tr></table>\n",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322338",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4"><code>c36156e</code></a></td><td><code>21874 py3 compatible autogen/pari (bytes for communicate)</code></td></tr></table>




---

archive/issue_events_304030.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-14T18:52:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304030"
}
```



---

archive/issue_comments_322339.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322339",
    "user": "https://github.com/fchapoton"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_comments_322340.json:
```json
{
    "body": "Commit: **[`c36156e`](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)**",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322340",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`c36156e`](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)**



---

archive/issue_comments_322341.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5\"><code>6d3d2c7</code></a></td><td><code>trac 21874 fixing</code></td></tr></table>\n",
    "created_at": "2016-11-14T19:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322341",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5"><code>6d3d2c7</code></a></td><td><code>trac 21874 fixing</code></td></tr></table>




---

archive/issue_comments_322342.json:
```json
{
    "body": "Changed commit from **[`c36156e`](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)** to **[`6d3d2c7`](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)**",
    "created_at": "2016-11-14T19:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322342",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c36156e`](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)** to **[`6d3d2c7`](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)**



---

archive/issue_comments_322343.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nshould be good now. Works for python3, not checked for python2.",
    "created_at": "2016-11-14T19:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322343",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

should be good now. Works for python3, not checked for python2.



---

archive/issue_comments_322344.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDoctest failure, see patchbot.",
    "created_at": "2016-11-16T12:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322344",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Doctest failure, see patchbot.



---

archive/issue_events_304031.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T12:56:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304031"
}
```



---

archive/issue_events_304032.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T12:56:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304032"
}
```



---

archive/issue_comments_322345.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe \"native\" format for filenames is `bytes`. So it seems silly to convert `bytes` to `unicode` and then let Python convert it back to `bytes`. Just drop the `.decode()`.",
    "created_at": "2016-11-16T13:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322345",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

The "native" format for filenames is `bytes`. So it seems silly to convert `bytes` to `unicode` and then let Python convert it back to `bytes`. Just drop the `.decode()`.



---

archive/issue_comments_322346.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nelsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()",
    "created_at": "2016-11-16T14:16:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322346",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()



---

archive/issue_comments_322347.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7\"><code>169eb21</code></a></td><td><code>trac 21874 correct doctest</code></td></tr></table>\n",
    "created_at": "2016-11-16T14:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322347",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7"><code>169eb21</code></a></td><td><code>trac 21874 correct doctest</code></td></tr></table>




---

archive/issue_comments_322348.json:
```json
{
    "body": "Changed commit from **[`6d3d2c7`](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)** to **[`169eb21`](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)**",
    "created_at": "2016-11-16T14:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322348",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d3d2c7`](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)** to **[`169eb21`](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)**



---

archive/issue_events_304033.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T14:20:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304033"
}
```



---

archive/issue_events_304034.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T14:20:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304034"
}
```



---

archive/issue_comments_322349.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@fchapoton](#comment%3A6):\n> elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()\n\nThat string should then also be `bytes`.",
    "created_at": "2016-11-16T14:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322349",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@fchapoton](#comment%3A6):
> elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()

That string should then also be `bytes`.



---

archive/issue_events_304035.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T14:21:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304035"
}
```



---

archive/issue_events_304036.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T14:21:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304036"
}
```



---

archive/issue_comments_322350.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> The \"native\" format for filenames is `bytes`.\n\nAre you sure about this? In Python 3.5\n\n```\n>>> import os\n>>> type(os.listdir('.')[0])\nstr\n```",
    "created_at": "2016-11-16T14:41:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322350",
    "user": "https://github.com/defeo"
}
```

<div id="comment:10" align="right">comment:10</div>

> The "native" format for filenames is `bytes`.

Are you sure about this? In Python 3.5

```
>>> import os
>>> type(os.listdir('.')[0])
str
```



---

archive/issue_comments_322351.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n`listdir` outputs `str` when given `str` and `bytes` when given `bytes`:\n\n```\n>>> import os\n>>> type(os.listdir(b'.')[0])\n<class 'bytes'>\n```\n\n```\n>>> import os\n>>> type(os.listdir('.')[0])\n<class 'str'>\n```",
    "created_at": "2016-11-16T14:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322351",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

`listdir` outputs `str` when given `str` and `bytes` when given `bytes`:

```
>>> import os
>>> type(os.listdir(b'.')[0])
<class 'bytes'>
```

```
>>> import os
>>> type(os.listdir('.')[0])
<class 'str'>
```



---

archive/issue_comments_322352.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSee https://docs.python.org/3/howto/unicode.html#unicode-filenames\n\nNote the sentence \"When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you\". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.",
    "created_at": "2016-11-16T14:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322352",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

See https://docs.python.org/3/howto/unicode.html#unicode-filenames

Note the sentence "When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.



---

archive/issue_comments_322353.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> See https://docs.python.org/3/howto/unicode.html#unicode-filenames\n> \n> Note the sentence \"When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you\". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.\n\nBut handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\nI do not even dare imagine what would happen with a WIN-1252-encoded fat filesystem mounted inside a ISO-8859 locale (these things can happen with usb keys...).",
    "created_at": "2016-11-16T15:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322353",
    "user": "https://github.com/defeo"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment%3A12):
> See https://docs.python.org/3/howto/unicode.html#unicode-filenames
> 
> Note the sentence "When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.

But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

I do not even dare imagine what would happen with a WIN-1252-encoded fat filesystem mounted inside a ISO-8859 locale (these things can happen with usb keys...).



---

archive/issue_comments_322354.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@defeo](#comment%3A13):\n> But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\nIf `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.",
    "created_at": "2016-11-16T15:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322354",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@defeo](#comment%3A13):
> But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.



---

archive/issue_comments_322355.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment%3A14):\n> Replying to [@defeo](#comment%3A13):\n> > But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\n> \n> If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.\n\nSame goes for `datastring.decode()`, then. I was obviously thinking of the case where they contain non-ASCII characters.",
    "created_at": "2016-11-16T15:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322355",
    "user": "https://github.com/defeo"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment%3A14):
> Replying to [@defeo](#comment%3A13):
> > But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

> 
> If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.

Same goes for `datastring.decode()`, then. I was obviously thinking of the case where they contain non-ASCII characters.



---

archive/issue_comments_322356.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@defeo](#comment%3A15):\n> Same goes for `datastring.decode()`, then.\n\nNot if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.",
    "created_at": "2016-11-16T15:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322356",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@defeo](#comment%3A15):
> Same goes for `datastring.decode()`, then.

Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.



---

archive/issue_comments_322357.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment%3A16):\n> Replying to [@defeo](#comment%3A15):\n> > Same goes for `datastring.decode()`, then.\n\n> \n> Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.\n\nRight. I thought it was the other way around. So where are these `datadir` + `string`? I see one on line 83 of `parser.py`, and there `string` is `pari.desc`, so I agree with you (assuming that gp correctly handles locale encodings). Any other places?",
    "created_at": "2016-11-16T15:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322357",
    "user": "https://github.com/defeo"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment%3A16):
> Replying to [@defeo](#comment%3A15):
> > Same goes for `datastring.decode()`, then.

> 
> Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.

Right. I thought it was the other way around. So where are these `datadir` + `string`? I see one on line 83 of `parser.py`, and there `string` is `pari.desc`, so I agree with you (assuming that gp correctly handles locale encodings). Any other places?



---

archive/issue_comments_322358.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI think this is the only place. Could you please handle all this without me ?",
    "created_at": "2016-11-16T16:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322358",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

I think this is the only place. Could you please handle all this without me ?



---

archive/issue_comments_322359.json:
```json
{
    "body": "Changed commit from **[`169eb21`](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)** to **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**",
    "created_at": "2016-11-16T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322359",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`169eb21`](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)** to **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**



---

archive/issue_comments_322360.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0\"><code>07d262a</code></a></td><td><code>trac 21874 using bytes everywhere</code></td></tr></table>\n",
    "created_at": "2016-11-16T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322360",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0"><code>07d262a</code></a></td><td><code>trac 21874 using bytes everywhere</code></td></tr></table>




---

archive/issue_events_304037.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T19:58:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304037"
}
```



---

archive/issue_events_304038.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T19:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304038"
}
```



---

archive/issue_comments_322361.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nok, here is another try, following Jeroen's suggestion",
    "created_at": "2016-11-16T19:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322361",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

ok, here is another try, following Jeroen's suggestion



---

archive/issue_comments_322362.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\npatchbot now gives a green light",
    "created_at": "2016-11-17T10:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322362",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

patchbot now gives a green light



---

archive/issue_comments_322363.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-11-17T10:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322363",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_322364.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nGood for me then.",
    "created_at": "2016-11-17T10:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322364",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Good for me then.



---

archive/issue_events_304039.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-17T10:07:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304039"
}
```



---

archive/issue_events_304040.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-17T10:07:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304040"
}
```



---

archive/issue_events_304041.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:34:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304041"
}
```



---

archive/issue_events_304042.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e88669b901ca2ff5f540f5d7b1bb74c98c1df6e1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-19T16:34:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-304042"
}
```



---

archive/issue_comments_322365.json:
```json
{
    "body": "Changed branch from **[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)** to **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**",
    "created_at": "2016-11-19T16:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-322365",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)** to **[`07d262a`](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)**
