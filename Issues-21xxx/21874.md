# Issue 21874: Make autogen/pari Python 3 compatible

archive/issues_021637.json:
```json
{
    "assignees": [],
    "body": "\n\n**CC:**  @defeo @fchapoton\n\n**Branch/Commit:** [07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/21874\n\n",
    "closed_at": "2016-11-19T16:34:52Z",
    "created_at": "2016-11-13T22:49:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make autogen/pari Python 3 compatible",
    "type": "issue",
    "updated_at": "2016-11-19T16:34:52Z",
    "url": "https://github.com/sagemath/sage/issues/21874",
    "user": "https://github.com/jdemeyer"
}
```


**CC:**  @defeo @fchapoton

**Branch/Commit:** [07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/21874





---

archive/issue_events_265868.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265868"
}
```



---

archive/issue_events_265869.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265869"
}
```



---

archive/issue_events_265870.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-13T22:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265870"
}
```



---

archive/issue_comments_324903.json:
```json
{
    "body": "**Branch:** [u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324903",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)



---

archive/issue_comments_324904.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4\">c36156e</a></td><td><code>21874 py3 compatible autogen/pari (bytes for communicate)</code></td></tr></table>\n",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324904",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4">c36156e</a></td><td><code>21874 py3 compatible autogen/pari (bytes for communicate)</code></td></tr></table>




---

archive/issue_events_265871.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-14T18:52:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265871"
}
```



---

archive/issue_comments_324905.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324905",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_324906.json:
```json
{
    "body": "**Commit:** [c36156ebea1662aad4584f9d954e0fa20b22a0b4](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)",
    "created_at": "2016-11-14T18:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324906",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [c36156ebea1662aad4584f9d954e0fa20b22a0b4](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)



---

archive/issue_comments_324907.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5\">6d3d2c7</a></td><td><code>trac 21874 fixing</code></td></tr></table>\n",
    "created_at": "2016-11-14T19:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324907",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5">6d3d2c7</a></td><td><code>trac 21874 fixing</code></td></tr></table>




---

archive/issue_comments_324908.json:
```json
{
    "body": "**Changing commit** from \"[c36156ebea1662aad4584f9d954e0fa20b22a0b4](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)\" to \"[6d3d2c7468e783b737736180045a2898644f9ea5](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)\".",
    "created_at": "2016-11-14T19:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324908",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c36156ebea1662aad4584f9d954e0fa20b22a0b4](https://github.com/sagemath/sagetrac-mirror/commit/c36156ebea1662aad4584f9d954e0fa20b22a0b4)" to "[6d3d2c7468e783b737736180045a2898644f9ea5](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)".



---

archive/issue_comments_324909.json:
```json
{
    "body": "<a id='comment:3'></a>\nshould be good now. Works for python3, not checked for python2.",
    "created_at": "2016-11-14T19:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324909",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
should be good now. Works for python3, not checked for python2.



---

archive/issue_comments_324910.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoctest failure, see patchbot.",
    "created_at": "2016-11-16T12:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324910",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Doctest failure, see patchbot.



---

archive/issue_events_265872.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T12:56:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265872"
}
```



---

archive/issue_events_265873.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T12:56:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265873"
}
```



---

archive/issue_comments_324911.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe \"native\" format for filenames is `bytes`. So it seems silly to convert `bytes` to `unicode` and then let Python convert it back to `bytes`. Just drop the `.decode()`.",
    "created_at": "2016-11-16T13:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324911",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
The "native" format for filenames is `bytes`. So it seems silly to convert `bytes` to `unicode` and then let Python convert it back to `bytes`. Just drop the `.decode()`.



---

archive/issue_comments_324912.json:
```json
{
    "body": "<a id='comment:6'></a>\nelsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()",
    "created_at": "2016-11-16T14:16:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324912",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()



---

archive/issue_comments_324913.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7\">169eb21</a></td><td><code>trac 21874 correct doctest</code></td></tr></table>\n",
    "created_at": "2016-11-16T14:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324913",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7">169eb21</a></td><td><code>trac 21874 correct doctest</code></td></tr></table>




---

archive/issue_comments_324914.json:
```json
{
    "body": "**Changing commit** from \"[6d3d2c7468e783b737736180045a2898644f9ea5](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)\" to \"[169eb2107367e9ddd1a8bdee43c434d71abc08f7](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)\".",
    "created_at": "2016-11-16T14:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324914",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6d3d2c7468e783b737736180045a2898644f9ea5](https://github.com/sagemath/sagetrac-mirror/commit/6d3d2c7468e783b737736180045a2898644f9ea5)" to "[169eb2107367e9ddd1a8bdee43c434d71abc08f7](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)".



---

archive/issue_events_265874.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T14:20:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265874"
}
```



---

archive/issue_events_265875.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T14:20:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265875"
}
```



---

archive/issue_comments_324915.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@fchapoton](#comment%3A6):\n> elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()\n\nThat string should then also be `bytes`.",
    "created_at": "2016-11-16T14:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324915",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [@fchapoton](#comment%3A6):
> elsewhere in the code, one takes the sum (+) of datadir and a string, so one needs the decode()

That string should then also be `bytes`.



---

archive/issue_events_265876.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T14:21:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265876"
}
```



---

archive/issue_events_265877.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-16T14:21:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265877"
}
```



---

archive/issue_comments_324916.json:
```json
{
    "body": "<a id='comment:10'></a>\n> The \"native\" format for filenames is `bytes`.\n\nAre you sure about this? In Python 3.5\n\n```\n>>> import os\n>>> type(os.listdir('.')[0])\nstr\n```",
    "created_at": "2016-11-16T14:41:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324916",
    "user": "https://github.com/defeo"
}
```

<a id='comment:10'></a>
> The "native" format for filenames is `bytes`.

Are you sure about this? In Python 3.5

```
>>> import os
>>> type(os.listdir('.')[0])
str
```



---

archive/issue_comments_324917.json:
```json
{
    "body": "<a id='comment:11'></a>\n`listdir` outputs `str` when given `str` and `bytes` when given `bytes`:\n\n```\n>>> import os\n>>> type(os.listdir(b'.')[0])\n<class 'bytes'>\n```\n\n```\n>>> import os\n>>> type(os.listdir('.')[0])\n<class 'str'>\n```",
    "created_at": "2016-11-16T14:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324917",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
`listdir` outputs `str` when given `str` and `bytes` when given `bytes`:

```
>>> import os
>>> type(os.listdir(b'.')[0])
<class 'bytes'>
```

```
>>> import os
>>> type(os.listdir('.')[0])
<class 'str'>
```



---

archive/issue_comments_324918.json:
```json
{
    "body": "<a id='comment:12'></a>\nSee https://docs.python.org/3/howto/unicode.html#unicode-filenames\n\nNote the sentence \"When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you\". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.",
    "created_at": "2016-11-16T14:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
See https://docs.python.org/3/howto/unicode.html#unicode-filenames

Note the sentence "When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.



---

archive/issue_comments_324919.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@jdemeyer](#comment%3A12):\n> See https://docs.python.org/3/howto/unicode.html#unicode-filenames\n> \n> Note the sentence \"When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you\". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.\n\nBut handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\nI do not even dare imagine what would happen with a WIN-1252-encoded fat filesystem mounted inside a ISO-8859 locale (these things can happen with usb keys...).",
    "created_at": "2016-11-16T15:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324919",
    "user": "https://github.com/defeo"
}
```

<a id='comment:13'></a>
Replying to [@jdemeyer](#comment%3A12):
> See https://docs.python.org/3/howto/unicode.html#unicode-filenames
> 
> Note the sentence "When opening a file for reading or writing, you can usually just provide the Unicode string as the filename, and it will be automatically converted to the right encoding for you". This means that Python does a conversion of encoding, so it makes sense to use `bytes` for filenames to avoid conversions.

But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

I do not even dare imagine what would happen with a WIN-1252-encoded fat filesystem mounted inside a ISO-8859 locale (these things can happen with usb keys...).



---

archive/issue_comments_324920.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@defeo](#comment%3A13):\n> But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\nIf `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.",
    "created_at": "2016-11-16T15:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [@defeo](#comment%3A13):
> But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.



---

archive/issue_comments_324921.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@jdemeyer](#comment%3A14):\n> Replying to [@defeo](#comment%3A13):\n> > But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.\n\n> \n> If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.\n\nSame goes for `datastring.decode()`, then. I was obviously thinking of the case where they contain non-ASCII characters.",
    "created_at": "2016-11-16T15:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324921",
    "user": "https://github.com/defeo"
}
```

<a id='comment:15'></a>
Replying to [@jdemeyer](#comment%3A14):
> Replying to [@defeo](#comment%3A13):
> > But handling the locale/filesystem encoding seems best left to Python. What if `datastring` is `bytes`, `string` is python's utf-8, and the user's locale is ISO-8859? What is safest among `open(datastring.decode() + string)` and `open(datastring + string.encode())`? Probably neither.

> 
> If `string` is ASCII, then `string.encode()` should be pretty safe since most encodings map ASCII to ASCII bytes.

Same goes for `datastring.decode()`, then. I was obviously thinking of the case where they contain non-ASCII characters.



---

archive/issue_comments_324922.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@defeo](#comment%3A15):\n> Same goes for `datastring.decode()`, then.\n\nNot if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.",
    "created_at": "2016-11-16T15:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324922",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [@defeo](#comment%3A15):
> Same goes for `datastring.decode()`, then.

Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.



---

archive/issue_comments_324923.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@jdemeyer](#comment%3A16):\n> Replying to [@defeo](#comment%3A15):\n> > Same goes for `datastring.decode()`, then.\n\n> \n> Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.\n\nRight. I thought it was the other way around. So where are these `datadir` + `string`? I see one on line 83 of `parser.py`, and there `string` is `pari.desc`, so I agree with you (assuming that gp correctly handles locale encodings). Any other places?",
    "created_at": "2016-11-16T15:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324923",
    "user": "https://github.com/defeo"
}
```

<a id='comment:17'></a>
Replying to [@jdemeyer](#comment%3A16):
> Replying to [@defeo](#comment%3A15):
> > Same goes for `datastring.decode()`, then.

> 
> Not if `datastring` refers to a user-chosen path. Then we shouldn't make too many assumptions.

Right. I thought it was the other way around. So where are these `datadir` + `string`? I see one on line 83 of `parser.py`, and there `string` is `pari.desc`, so I agree with you (assuming that gp correctly handles locale encodings). Any other places?



---

archive/issue_comments_324924.json:
```json
{
    "body": "<a id='comment:18'></a>\nI think this is the only place. Could you please handle all this without me ?",
    "created_at": "2016-11-16T16:04:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324924",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
I think this is the only place. Could you please handle all this without me ?



---

archive/issue_comments_324925.json:
```json
{
    "body": "**Changing commit** from \"[169eb2107367e9ddd1a8bdee43c434d71abc08f7](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)\" to \"[07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)\".",
    "created_at": "2016-11-16T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324925",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[169eb2107367e9ddd1a8bdee43c434d71abc08f7](https://github.com/sagemath/sagetrac-mirror/commit/169eb2107367e9ddd1a8bdee43c434d71abc08f7)" to "[07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)".



---

archive/issue_comments_324926.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0\">07d262a</a></td><td><code>trac 21874 using bytes everywhere</code></td></tr></table>\n",
    "created_at": "2016-11-16T19:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324926",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0">07d262a</a></td><td><code>trac 21874 using bytes everywhere</code></td></tr></table>




---

archive/issue_events_265878.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T19:58:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265878"
}
```



---

archive/issue_events_265879.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-16T19:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265879"
}
```



---

archive/issue_comments_324927.json:
```json
{
    "body": "<a id='comment:20'></a>\nok, here is another try, following Jeroen's suggestion",
    "created_at": "2016-11-16T19:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324927",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
ok, here is another try, following Jeroen's suggestion



---

archive/issue_comments_324928.json:
```json
{
    "body": "<a id='comment:21'></a>\npatchbot now gives a green light",
    "created_at": "2016-11-17T10:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324928",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
patchbot now gives a green light



---

archive/issue_comments_324929.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2016-11-17T10:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324929",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_324930.json:
```json
{
    "body": "<a id='comment:22'></a>\nGood for me then.",
    "created_at": "2016-11-17T10:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324930",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Good for me then.



---

archive/issue_events_265880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-17T10:07:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265880"
}
```



---

archive/issue_events_265881.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-17T10:07:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265881"
}
```



---

archive/issue_events_265882.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:34:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265882"
}
```



---

archive/issue_events_265883.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e88669b901ca2ff5f540f5d7b1bb74c98c1df6e1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-19T16:34:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21874#event-265883"
}
```



---

archive/issue_comments_324931.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)\" to \"[07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)\".",
    "created_at": "2016-11-19T16:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21874#issuecomment-324931",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/21874](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21874)" to "[07d262ad2bef1bfe9387ebb885ff773bcab219a0](https://github.com/sagemath/sagetrac-mirror/commit/07d262ad2bef1bfe9387ebb885ff773bcab219a0)".
