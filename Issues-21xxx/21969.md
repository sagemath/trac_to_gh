# Issue 21969: py3 get rid of cmp() in two pyx files in libs/singular

archive/issues_021732.json:
```json
{
    "body": "step to py3\n\nCC:  @tscrim @jdemeyer @a-andre\n\nBranch/Commit: ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21969\n\n",
    "closed_at": "2016-12-10T12:38:11Z",
    "created_at": "2016-11-25T09:57:44Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "py3 get rid of cmp() in two pyx files in libs/singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21969",
    "user": "https://github.com/fchapoton"
}
```
step to py3

CC:  @tscrim @jdemeyer @a-andre

Branch/Commit: ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7

Reviewer: Jeroen Demeyer

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21969





---

archive/issue_comments_321062.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-11-25T09:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321062",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_321063.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-27T13:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321064.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-02T19:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321064",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321065.json:
```json
{
    "body": "<a id='comment:3'></a>this seems to work, if the doctest failure in trace is not related.",
    "created_at": "2016-12-02T19:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321065",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>this seems to work, if the doctest failure in trace is not related.



---

archive/issue_comments_321066.json:
```json
{
    "body": "<a id='comment:4'></a>I would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.",
    "created_at": "2016-12-03T03:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321066",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.



---

archive/issue_comments_321067.json:
```json
{
    "body": "<a id='comment:5'></a>I think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.",
    "created_at": "2016-12-03T09:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321067",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>I think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.



---

archive/issue_comments_321068.json:
```json
{
    "body": "<a id='comment:6'></a>I thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.",
    "created_at": "2016-12-03T16:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321068",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.



---

archive/issue_comments_321069.json:
```json
{
    "body": "<a id='comment:7'></a>I would say that the current code works correctly.\n\nNote that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.",
    "created_at": "2016-12-03T17:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321069",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>I would say that the current code works correctly.

Note that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.



---

archive/issue_comments_321070.json:
```json
{
    "body": "<a id='comment:8'></a>However, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.",
    "created_at": "2016-12-03T18:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321070",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>However, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.



---

archive/issue_comments_321071.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-04T08:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321071",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321072.json:
```json
{
    "body": "<a id='comment:10'></a>This is very wrong:\n\n```\n            lx = <SingularFunction>self\n            rx = <SingularFunction>other\n```            \nsince those casts don't check that they make sense. You need a *checking* cast\n\n```\n            lx = <SingularFunction?>self\n            rx = <SingularFunction?>other\n```\nAlso please add this doctest:\n\n```\nsage: groebner == None\n```\nWith this current branch, this segfaults (because of the reason above).",
    "created_at": "2016-12-04T08:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321072",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>This is very wrong:

```
            lx = <SingularFunction>self
            rx = <SingularFunction>other
```            
since those casts don't check that they make sense. You need a *checking* cast

```
            lx = <SingularFunction?>self
            rx = <SingularFunction?>other
```
Also please add this doctest:

```
sage: groebner == None
```
With this current branch, this segfaults (because of the reason above).



---

archive/issue_comments_321073.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-04T09:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321074.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-04T10:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321074",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321075.json:
```json
{
    "body": "<a id='comment:12'></a>I have made Jeroen's suggested change.",
    "created_at": "2016-12-04T10:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321075",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>I have made Jeroen's suggested change.



---

archive/issue_comments_321076.json:
```json
{
    "body": "<a id='comment:13'></a>*ping*",
    "created_at": "2016-12-06T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321076",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>*ping*



---

archive/issue_comments_321077.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-08T11:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321077",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057901.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-10T12:38:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-57901"
}
```



---

archive/issue_comments_321078.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-10T12:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-321078",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
