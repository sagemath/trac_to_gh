# Issue 21969: py3 get rid of cmp() in two pyx files in libs/singular

archive/issues_021732.json:
```json
{
    "body": "step to py3\n\n**CC:**  @tscrim @jdemeyer @a-andre\n\n**Branch/Commit:** [ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/21969\n\n",
    "closed_at": "2016-12-10T12:38:11Z",
    "created_at": "2016-11-25T09:57:44Z",
    "labels": [
        "component: python3",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "py3 get rid of cmp() in two pyx files in libs/singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21969",
    "user": "https://github.com/fchapoton"
}
```
step to py3

**CC:**  @tscrim @jdemeyer @a-andre

**Branch/Commit:** [ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/21969





---

archive/issue_comments_327777.json:
```json
{
    "body": "**Branch:** [u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)",
    "created_at": "2016-11-25T09:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327777",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)



---

archive/issue_comments_327778.json:
```json
{
    "body": "**Commit:** [0eae5928c1a9f7a7f2398aa3d9b51a85d3199125](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)",
    "created_at": "2016-11-25T09:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327778",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [0eae5928c1a9f7a7f2398aa3d9b51a85d3199125](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)



---

archive/issue_comments_327779.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7acfe9b9c2f3262697b8141d0b22213e52531c3\">c7acfe9</a></td><td><code>py3 richcmp in two pyx files in libs/singular</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125\">0eae592</a></td><td><code>typo</code></td></tr></table>\n",
    "created_at": "2016-11-25T09:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327779",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7acfe9b9c2f3262697b8141d0b22213e52531c3">c7acfe9</a></td><td><code>py3 richcmp in two pyx files in libs/singular</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125">0eae592</a></td><td><code>typo</code></td></tr></table>




---

archive/issue_comments_327780.json:
```json
{
    "body": "**Changing commit** from \"[0eae5928c1a9f7a7f2398aa3d9b51a85d3199125](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)\" to \"[4998233e362ed75565d5d570e4ea41ae0923c404](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)\".",
    "created_at": "2016-11-27T13:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0eae5928c1a9f7a7f2398aa3d9b51a85d3199125](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)" to "[4998233e362ed75565d5d570e4ea41ae0923c404](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)".



---

archive/issue_comments_327781.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404\">4998233</a></td><td><code>trac 21969 tentative fix of richcmp in singular pyx</code></td></tr></table>\n",
    "created_at": "2016-11-27T13:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404">4998233</a></td><td><code>trac 21969 tentative fix of richcmp in singular pyx</code></td></tr></table>




---

archive/issue_events_200212.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-02T19:27:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200212"
}
```



---

archive/issue_comments_327782.json:
```json
{
    "body": "<a id='comment:3'></a>\nthis seems to work, if the doctest failure in trace is not related.",
    "created_at": "2016-12-02T19:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327782",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
this seems to work, if the doctest failure in trace is not related.



---

archive/issue_comments_327783.json:
```json
{
    "body": "<a id='comment:4'></a>\nI would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.",
    "created_at": "2016-12-03T03:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327783",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
I would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.



---

archive/issue_comments_327784.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.",
    "created_at": "2016-12-03T09:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327784",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
I think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.



---

archive/issue_comments_327785.json:
```json
{
    "body": "<a id='comment:6'></a>\nI thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.",
    "created_at": "2016-12-03T16:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327785",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
I thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.



---

archive/issue_comments_327786.json:
```json
{
    "body": "<a id='comment:7'></a>\nI would say that the current code works correctly.\n\nNote that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.",
    "created_at": "2016-12-03T17:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327786",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
I would say that the current code works correctly.

Note that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.



---

archive/issue_comments_327787.json:
```json
{
    "body": "<a id='comment:8'></a>\nHowever, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.",
    "created_at": "2016-12-03T18:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327787",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
However, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.



---

archive/issue_events_200213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T08:37:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200213"
}
```



---

archive/issue_events_200214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T08:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200214"
}
```



---

archive/issue_comments_327788.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2016-12-04T08:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327788",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_327789.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is very wrong:\n\n```\n            lx = <SingularFunction>self\n            rx = <SingularFunction>other\n```            \nsince those casts don't check that they make sense. You need a *checking* cast\n\n```\n            lx = <SingularFunction?>self\n            rx = <SingularFunction?>other\n```\nAlso please add this doctest:\n\n```\nsage: groebner == None\n```\nWith this current branch, this segfaults (because of the reason above).",
    "created_at": "2016-12-04T08:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327789",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
This is very wrong:

```
            lx = <SingularFunction>self
            rx = <SingularFunction>other
```            
since those casts don't check that they make sense. You need a *checking* cast

```
            lx = <SingularFunction?>self
            rx = <SingularFunction?>other
```
Also please add this doctest:

```
sage: groebner == None
```
With this current branch, this segfaults (because of the reason above).



---

archive/issue_comments_327790.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6539ebbd8231a342dfb63b47f933006ff16aa859\">6539ebb</a></td><td><code>Merge branch 'u/chapoton/21969' in 7.5.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7\">ac4d6b1</a></td><td><code>trac 21969 checking cast</code></td></tr></table>\n",
    "created_at": "2016-12-04T09:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6539ebbd8231a342dfb63b47f933006ff16aa859">6539ebb</a></td><td><code>Merge branch 'u/chapoton/21969' in 7.5.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7">ac4d6b1</a></td><td><code>trac 21969 checking cast</code></td></tr></table>




---

archive/issue_comments_327791.json:
```json
{
    "body": "**Changing commit** from \"[4998233e362ed75565d5d570e4ea41ae0923c404](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)\" to \"[ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)\".",
    "created_at": "2016-12-04T09:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4998233e362ed75565d5d570e4ea41ae0923c404](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)" to "[ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)".



---

archive/issue_events_200215.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-04T10:34:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200215"
}
```



---

archive/issue_events_200216.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-04T10:34:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200216"
}
```



---

archive/issue_comments_327792.json:
```json
{
    "body": "<a id='comment:12'></a>\nI have made Jeroen's suggested change.",
    "created_at": "2016-12-04T10:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327792",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
I have made Jeroen's suggested change.



---

archive/issue_comments_327793.json:
```json
{
    "body": "<a id='comment:13'></a>\n*ping*",
    "created_at": "2016-12-06T16:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327793",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
*ping*



---

archive/issue_events_200217.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-08T11:27:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200217"
}
```



---

archive/issue_events_200218.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-08T11:27:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200218"
}
```



---

archive/issue_events_200219.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-10T12:38:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200219"
}
```



---

archive/issue_events_200220.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-10T12:38:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21969#event-200220"
}
```



---

archive/issue_comments_327794.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)\" to \"[ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)\".",
    "created_at": "2016-12-10T12:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21969#issuecomment-327794",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)" to "[ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)".
