# Issue 21969: py3 get rid of cmp() in two pyx files in libs/singular

archive/issues_021732.json:
```json
{
    "assignees": [],
    "body": "step to py3\n\nCC:  @tscrim @jdemeyer @a-andre\n\nBranch/Commit: **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21969_\n\n",
    "closed_at": "2016-12-10T12:38:11Z",
    "created_at": "2016-11-25T09:57:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3 get rid of cmp() in two pyx files in libs/singular",
    "type": "issue",
    "updated_at": "2016-12-10T12:38:11Z",
    "url": "https://github.com/sagemath/sage/issues/21969",
    "user": "https://github.com/fchapoton"
}
```
step to py3

CC:  @tscrim @jdemeyer @a-andre

Branch/Commit: **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**

Reviewer: **Jeroen Demeyer**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/21969_





---

archive/issue_events_279479.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-25T09:57:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279479"
}
```



---

archive/issue_events_279480.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-25T09:57:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "000080",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279480"
}
```



---

archive/issue_events_279481.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-25T09:57:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279481"
}
```



---

archive/issue_events_279482.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-11-25T09:57:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279482"
}
```



---

archive/issue_comments_326295.json:
```json
{
    "body": "Branch: **[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)**",
    "created_at": "2016-11-25T09:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326295",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)**



---

archive/issue_comments_326296.json:
```json
{
    "body": "Commit: **[0eae592](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)**",
    "created_at": "2016-11-25T09:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326296",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[0eae592](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)**



---

archive/issue_comments_326297.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7acfe9b9c2f3262697b8141d0b22213e52531c3\">c7acfe9</a></td><td><code>py3 richcmp in two pyx files in libs/singular</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125\">0eae592</a></td><td><code>typo</code></td></tr></table>\n",
    "created_at": "2016-11-25T09:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326297",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7acfe9b9c2f3262697b8141d0b22213e52531c3">c7acfe9</a></td><td><code>py3 richcmp in two pyx files in libs/singular</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125">0eae592</a></td><td><code>typo</code></td></tr></table>




---

archive/issue_comments_326298.json:
```json
{
    "body": "Changed commit from **[0eae592](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)** to **[4998233](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)**",
    "created_at": "2016-11-27T13:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326298",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0eae592](https://github.com/sagemath/sagetrac-mirror/commit/0eae5928c1a9f7a7f2398aa3d9b51a85d3199125)** to **[4998233](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)**



---

archive/issue_comments_326299.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404\">4998233</a></td><td><code>trac 21969 tentative fix of richcmp in singular pyx</code></td></tr></table>\n",
    "created_at": "2016-11-27T13:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326299",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404">4998233</a></td><td><code>trac 21969 tentative fix of richcmp in singular pyx</code></td></tr></table>




---

archive/issue_events_279483.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-02T19:27:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279483"
}
```



---

archive/issue_comments_326300.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nthis seems to work, if the doctest failure in trace is not related.",
    "created_at": "2016-12-02T19:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326300",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'>Comment 3:</a>
this seems to work, if the doctest failure in trace is not related.



---

archive/issue_comments_326301.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.",
    "created_at": "2016-12-03T03:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326301",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>Comment 4:</a>
I would expect this to have a problem with `!=` as it returns `NotImplemented` when they are different classes. In that case, I would expect it to return `False`.



---

archive/issue_comments_326302.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.",
    "created_at": "2016-12-03T09:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326302",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
I think that there is a general Python code that implies that two objects whose comparison returns NotImplemented are not equal. I may be wrong.



---

archive/issue_comments_326303.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.",
    "created_at": "2016-12-03T16:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326303",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'>Comment 6:</a>
I thought what happens is that is tries to switch the arguments. What I suspect is that if both return `NotImplemented`, it falls back upon identity comparison. Yet, I think explicit is better than implicit and relying on (subtle) Python behavior is not good. We know they are not equal at that point, so let's return that.



---

archive/issue_comments_326304.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI would say that the current code works correctly.\n\nNote that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.",
    "created_at": "2016-12-03T17:57:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326304",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'>Comment 7:</a>
I would say that the current code works correctly.

Note that richcmp is not only about equality or unequality, but also about comparison. And the only solution is to refuse to compare things when this is meaningless. If I have understood correctly, Python3 is much more restrictive on what it is allowed to compare.



---

archive/issue_comments_326305.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nHowever, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.",
    "created_at": "2016-12-03T18:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326305",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'>Comment 8:</a>
However, for the case of inequality, we can do a valid comparison as we know at that point they are unequal. Python3 is more restrictive on inequalities, but this is not an inequality check.



---

archive/issue_events_279484.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T08:37:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279484"
}
```



---

archive/issue_events_279485.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T08:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279485"
}
```



---

archive/issue_comments_326306.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-12-04T08:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326306",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_326307.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThis is very wrong:\n\n```\n            lx = <SingularFunction>self\n            rx = <SingularFunction>other\n```            \nsince those casts don't check that they make sense. You need a *checking* cast\n\n```\n            lx = <SingularFunction?>self\n            rx = <SingularFunction?>other\n```\nAlso please add this doctest:\n\n```\nsage: groebner == None\n```\nWith this current branch, this segfaults (because of the reason above).",
    "created_at": "2016-12-04T08:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326307",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
This is very wrong:

```
            lx = <SingularFunction>self
            rx = <SingularFunction>other
```            
since those casts don't check that they make sense. You need a *checking* cast

```
            lx = <SingularFunction?>self
            rx = <SingularFunction?>other
```
Also please add this doctest:

```
sage: groebner == None
```
With this current branch, this segfaults (because of the reason above).



---

archive/issue_comments_326308.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6539ebbd8231a342dfb63b47f933006ff16aa859\">6539ebb</a></td><td><code>Merge branch 'u/chapoton/21969' in 7.5.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7\">ac4d6b1</a></td><td><code>trac 21969 checking cast</code></td></tr></table>\n",
    "created_at": "2016-12-04T09:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326308",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6539ebbd8231a342dfb63b47f933006ff16aa859">6539ebb</a></td><td><code>Merge branch 'u/chapoton/21969' in 7.5.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7">ac4d6b1</a></td><td><code>trac 21969 checking cast</code></td></tr></table>




---

archive/issue_comments_326309.json:
```json
{
    "body": "Changed commit from **[4998233](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)** to **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**",
    "created_at": "2016-12-04T09:26:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326309",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4998233](https://github.com/sagemath/sagetrac-mirror/commit/4998233e362ed75565d5d570e4ea41ae0923c404)** to **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**



---

archive/issue_events_279486.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-04T10:34:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279486"
}
```



---

archive/issue_events_279487.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-12-04T10:34:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279487"
}
```



---

archive/issue_comments_326310.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nI have made Jeroen's suggested change.",
    "created_at": "2016-12-04T10:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326310",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'>Comment 12:</a>
I have made Jeroen's suggested change.



---

archive/issue_comments_326311.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\n*ping*",
    "created_at": "2016-12-06T16:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326311",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>Comment 13:</a>
*ping*



---

archive/issue_events_279488.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-08T11:27:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279488"
}
```



---

archive/issue_events_279489.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-08T11:27:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279489"
}
```



---

archive/issue_events_279490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-10T12:38:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279490"
}
```



---

archive/issue_events_279491.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3236d40f995ef711a7b0d3eba3031c3414a65e26",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-12-10T12:38:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21969#event-279491"
}
```



---

archive/issue_comments_326312.json:
```json
{
    "body": "Changed branch from **[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)** to **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**",
    "created_at": "2016-12-10T12:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21969#issuecomment-326312",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/21969](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21969)** to **[ac4d6b1](https://github.com/sagemath/sagetrac-mirror/commit/ac4d6b15f7ff9fbd2d9070789fd5fdd4b91d89a7)**
