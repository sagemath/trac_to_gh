# Issue 21567: Allow Sage to build on OS X 10.12 (Sierra)

archive/issues_021330.json:
```json
{
    "body": "Trying to build Sage from scratch on OS X 10.12 results in a broken Python:\n\n```\n    Failed to build these modules:\n    _scproxy    \n```\nWe've seen this before -- see #17174 and #17169.\n\nCC:  @mstreng\n\nBranch/Commit: 2d85bc965d3f751ff0175a2d2fd09a737250de74\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21567\n\n",
    "closed_at": "2016-10-15T10:25:12Z",
    "created_at": "2016-09-22T18:51:39Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Allow Sage to build on OS X 10.12 (Sierra)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21567",
    "user": "https://github.com/jhpalmieri"
}
```
Trying to build Sage from scratch on OS X 10.12 results in a broken Python:

```
    Failed to build these modules:
    _scproxy    
```
We've seen this before -- see #17174 and #17169.

CC:  @mstreng

Branch/Commit: 2d85bc965d3f751ff0175a2d2fd09a737250de74

Reviewer: Fran√ßois Bissey

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21567





---

archive/issue_comments_295619.json:
```json
{
    "body": "<a id='comment:2'></a>On Macbook Pro with macOS Sierra, making the latest Sage beta I got this:\n\n```\n[gcc-4.9.3.p1] The directory that should contain system headers does not exist:\n[gcc-4.9.3.p1]   /usr/include\n[gcc-4.9.3.p1] make[6]: *** [stmp-fixinc] Error 1\n[gcc-4.9.3.p1] make[5]: *** [all-stage1-gcc] Error 2\n[gcc-4.9.3.p1] make[4]: *** [stage1-bubble] Error 2\n[gcc-4.9.3.p1] make[3]: *** [all] Error 2\n[gcc-4.9.3.p1] \n[gcc-4.9.3.p1] real\t5m10.515s\n[gcc-4.9.3.p1] user\t4m4.134s\n[gcc-4.9.3.p1] sys\t0m59.514s\n[gcc-4.9.3.p1] ************************************************************************\n[gcc-4.9.3.p1] Error installing package gcc-4.9.3.p1\n[gcc-4.9.3.p1] ************************************************************************\n```\n\nI have no idea how to fix this.",
    "created_at": "2016-09-27T13:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295619",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:2'></a>On Macbook Pro with macOS Sierra, making the latest Sage beta I got this:

```
[gcc-4.9.3.p1] The directory that should contain system headers does not exist:
[gcc-4.9.3.p1]   /usr/include
[gcc-4.9.3.p1] make[6]: *** [stmp-fixinc] Error 1
[gcc-4.9.3.p1] make[5]: *** [all-stage1-gcc] Error 2
[gcc-4.9.3.p1] make[4]: *** [stage1-bubble] Error 2
[gcc-4.9.3.p1] make[3]: *** [all] Error 2
[gcc-4.9.3.p1] 
[gcc-4.9.3.p1] real	5m10.515s
[gcc-4.9.3.p1] user	4m4.134s
[gcc-4.9.3.p1] sys	0m59.514s
[gcc-4.9.3.p1] ************************************************************************
[gcc-4.9.3.p1] Error installing package gcc-4.9.3.p1
[gcc-4.9.3.p1] ************************************************************************
```

I have no idea how to fix this.



---

archive/issue_comments_295620.json:
```json
{
    "body": "<a id='comment:3'></a>I am retrying after installing Xcode commandline tools.",
    "created_at": "2016-09-27T13:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295620",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:3'></a>I am retrying after installing Xcode commandline tools.



---

archive/issue_comments_295621.json:
```json
{
    "body": "<a id='comment:4'></a>It does not finish building gcc-4.9.3.p1. It seems to have fallen in an infinite loop.",
    "created_at": "2016-09-27T16:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295621",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:4'></a>It does not finish building gcc-4.9.3.p1. It seems to have fallen in an infinite loop.



---

archive/issue_comments_295622.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 klee]:\n> It seems to have fallen in an infinite loop.\n\n\nAre you sure? Maybe it just needs more time.",
    "created_at": "2016-09-27T18:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295622",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 klee]:
> It seems to have fallen in an infinite loop.


Are you sure? Maybe it just needs more time.



---

archive/issue_comments_295623.json:
```json
{
    "body": "<a id='comment:6'></a>It built on my machine, for what that's worth. I ran into problems later, as noted above. You could also try reinstalling Xcode in addition to the command line tools.",
    "created_at": "2016-09-27T18:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295623",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>It built on my machine, for what that's worth. I ran into problems later, as noted above. You could also try reinstalling Xcode in addition to the command line tools.



---

archive/issue_comments_295624.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 jdemeyer]:\n> Replying to [comment:4 klee]:\n> > It seems to have fallen in an infinite loop.\n\n> \n> Are you sure? Maybe it just needs more time.\n\n\nYou are right. It is not compiling the same file again and again.",
    "created_at": "2016-09-27T23:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295624",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>Replying to [comment:5 jdemeyer]:
> Replying to [comment:4 klee]:
> > It seems to have fallen in an infinite loop.

> 
> Are you sure? Maybe it just needs more time.


You are right. It is not compiling the same file again and again.



---

archive/issue_comments_295625.json:
```json
{
    "body": "<a id='comment:8'></a>After long compilation, `make` finally failed with\n\n```\n[setuptools-24.0.2] ImportError: No module named _scproxy\n```\nI could not find a message in the log about the failure of building `_scproxy` itself.",
    "created_at": "2016-09-28T04:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295625",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>After long compilation, `make` finally failed with

```
[setuptools-24.0.2] ImportError: No module named _scproxy
```
I could not find a message in the log about the failure of building `_scproxy` itself.



---

archive/issue_comments_295626.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 klee]:\n> I could not find a message in the log about the failure of building `_scproxy` itself.\n\n\nDid you look in the python build log?",
    "created_at": "2016-09-28T15:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295626",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>Replying to [comment:8 klee]:
> I could not find a message in the log about the failure of building `_scproxy` itself.


Did you look in the python build log?



---

archive/issue_comments_295627.json:
```json
{
    "body": "<a id='comment:10'></a>Yes, it is there\n\n```\nFailed to build these modules:\n_scproxy \n```\nSorry for the noise. I didn't help you :-) I have never inspected deep into the build process before.",
    "created_at": "2016-09-28T16:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295627",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'></a>Yes, it is there

```
Failed to build these modules:
_scproxy 
```
Sorry for the noise. I didn't help you :-) I have never inspected deep into the build process before.



---

archive/issue_comments_295628.json:
```json
{
    "body": "<a id='comment:11'></a>I hope that this issue was solved in the latest Python 2.7.12. The relevant ticket is #19735.",
    "created_at": "2016-10-06T07:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295628",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:11'></a>I hope that this issue was solved in the latest Python 2.7.12. The relevant ticket is #19735.



---

archive/issue_comments_295629.json:
```json
{
    "body": "<a id='comment:12'></a>I must say I haven't tried yet a straight build on Sierra. I'll have to look in my logs for python, because I did a clang build (failing building sagelib but completely different problems).",
    "created_at": "2016-10-06T09:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295629",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>I must say I haven't tried yet a straight build on Sierra. I'll have to look in my logs for python, because I did a clang build (failing building sagelib but completely different problems).



---

archive/issue_comments_295630.json:
```json
{
    "body": "<a id='comment:13'></a>Is there any reason to believe that the new Python will help to build Sage on OS X 10.12? I can build Python 2.7.10 on OS X 10.12 outside of Sage's environment and `_scproxy` builds fine; it's only with Sage's `gcc` (etc.) that Python has problems.",
    "created_at": "2016-10-06T15:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295630",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Is there any reason to believe that the new Python will help to build Sage on OS X 10.12? I can build Python 2.7.10 on OS X 10.12 outside of Sage's environment and `_scproxy` builds fine; it's only with Sage's `gcc` (etc.) that Python has problems.



---

archive/issue_comments_295631.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 jhpalmieri]:\n> Is there any reason to believe that the new Python will help to build Sage on OS X 10.12? \n\n\nA reason not so well grounded... By unguided internet search, I learned that `_scproxy` is Mac-specific and related with other problems. So I expected somehow new Python did something about that.",
    "created_at": "2016-10-06T18:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295631",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>Replying to [comment:13 jhpalmieri]:
> Is there any reason to believe that the new Python will help to build Sage on OS X 10.12? 


A reason not so well grounded... By unguided internet search, I learned that `_scproxy` is Mac-specific and related with other problems. So I expected somehow new Python did something about that.



---

archive/issue_comments_295632.json:
```json
{
    "body": "<a id='comment:15'></a>To be clear: I have no idea how to fix this. I don't understand why the fixes worked when this sort of problem occurred before (as mentioned in the summary). But if people make suggestions, I am happy to try them out. Or if you want to see some log files or other information, I can post it. It's important that we fix this fast, since Mac OS X is one of our supported platforms and Sage doesn't build on the newest OS X release.",
    "created_at": "2016-10-06T19:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295632",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>To be clear: I have no idea how to fix this. I don't understand why the fixes worked when this sort of problem occurred before (as mentioned in the summary). But if people make suggestions, I am happy to try them out. Or if you want to see some log files or other information, I can post it. It's important that we fix this fast, since Mac OS X is one of our supported platforms and Sage doesn't build on the newest OS X release.



---

archive/issue_comments_295633.json:
```json
{
    "body": "<a id='comment:16'></a>The last time it was fixed by a gcc upgrade. Why not try #21603?",
    "created_at": "2016-10-06T20:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295633",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>The last time it was fixed by a gcc upgrade. Why not try #21603?



---

archive/issue_comments_295634.json:
```json
{
    "body": "<a id='comment:17'></a>It was fixed by a gcc upgrade plus what looks like a hack -- from the gcc `spkg-install` script:\n\n```\n\n# On OS X 10.10 there is random ObjC stuff in a C header\nif { uname -sr | grep 'Darwin 14\\.' ;} &>/dev/null; then\n    if [ -f /usr/include/dispatch/object.h ]; then\n        mkdir -p \"$SAGE_LOCAL/include/dispatch\"\n        sed 's+typedef void (\\^dispatch_block_t)(void)+typedef void* dispatch_block_t+' \\\n            /usr/include/dispatch/object.h > \"$SAGE_LOCAL/include/dispatch/object.h\"\n    else\n        echo \"Warning: header /usr/include/dispatch/object.h not found, not applying fix.\"\n    fi\nfi\n```\nI tried changing this so it would also apply if it matched `Darwin 16.`, but it didn't help. I'm a little wary of #21603 because of #20350, but I'll give it a try later today.",
    "created_at": "2016-10-06T20:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295634",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>It was fixed by a gcc upgrade plus what looks like a hack -- from the gcc `spkg-install` script:

```

# On OS X 10.10 there is random ObjC stuff in a C header
if { uname -sr | grep 'Darwin 14\.' ;} &>/dev/null; then
    if [ -f /usr/include/dispatch/object.h ]; then
        mkdir -p "$SAGE_LOCAL/include/dispatch"
        sed 's+typedef void (\^dispatch_block_t)(void)+typedef void* dispatch_block_t+' \
            /usr/include/dispatch/object.h > "$SAGE_LOCAL/include/dispatch/object.h"
    else
        echo "Warning: header /usr/include/dispatch/object.h not found, not applying fix."
    fi
fi
```
I tried changing this so it would also apply if it matched `Darwin 16.`, but it didn't help. I'm a little wary of #21603 because of #20350, but I'll give it a try later today.



---

archive/issue_comments_295635.json:
```json
{
    "body": "<a id='comment:18'></a>Yes that hack is partly because the headers in OS X have objective C bits mixed in (and not properly screened by define) and apple doesn't see it as a problem. I do remember the stuff we found when doing that upgrade.\n\nThe ABI problem is, let's say inconvenient. However compiling everything with the same c++ compiler should work, so long as we don't involve c++ libraries from the host system.\n\nOne thing I found in my first attempt at building sage with clang on OS X (10.11 at the time) was that clang++ and g++ (for 4.9.3) do not use the same ABI. So I couldn't compile linbox with g++ while givaro had been compiled with clang++. g++ offered me an option to change ABI but that lead to another issue where object code was not recognized as x86_64 arch. #21603 may improve on that (cross fingers).",
    "created_at": "2016-10-06T20:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295635",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>Yes that hack is partly because the headers in OS X have objective C bits mixed in (and not properly screened by define) and apple doesn't see it as a problem. I do remember the stuff we found when doing that upgrade.

The ABI problem is, let's say inconvenient. However compiling everything with the same c++ compiler should work, so long as we don't involve c++ libraries from the host system.

One thing I found in my first attempt at building sage with clang on OS X (10.11 at the time) was that clang++ and g++ (for 4.9.3) do not use the same ABI. So I couldn't compile linbox with g++ while givaro had been compiled with clang++. g++ offered me an option to change ABI but that lead to another issue where object code was not recognized as x86_64 arch. #21603 may improve on that (cross fingers).



---

archive/issue_comments_295636.json:
```json
{
    "body": "<a id='comment:19'></a>More cruft I am guessing\n\n```\n[python2-2.7.10.p2] gcc -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/src/Include -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/src -c ./Mac/Modules/_scproxy.c -o build/temp.macosx-10.9-x86_64-2.7/./Mac/Modules/_scproxy.o\n[python2-2.7.10.p2] In file included from /usr/include/Availability.h:176:0,\n[python2-2.7.10.p2]                  from /usr/include/stdio.h:65,\n[python2-2.7.10.p2]                  from Include/Python.h:33,\n[python2-2.7.10.p2]                  from ./Mac/Modules/_scproxy.c:5:\n[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:53:34: error: expected ',' or '}' before '__attribute__'\n[python2-2.7.10.p2]      kCFISO8601DateFormatWithYear API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0)) = (1UL << 0),\n[python2-2.7.10.p2]                                   ^\n[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:80:126: error: 'introduced' undeclared here (not in a function)\n[python2-2.7.10.p2]  CFDateFormatterRef CFDateFormatterCreateISO8601Formatter(CFAllocatorRef allocator, CFISO8601DateFormatOptions formatOptions) API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));\n[python2-2.7.10.p2]                                                                                                                               ^\n[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'deprecated' undeclared here (not in a function)\n[python2-2.7.10.p2]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n[python2-2.7.10.p2]                                        ^\n[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'message' undeclared here (not in a function)\n[python2-2.7.10.p2]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n[python2-2.7.10.p2]                                        ^\n[python2-2.7.10.p2] In file included from /System/Library/Frameworks/Security.framework/Headers/Security.h:81:0,\n[python2-2.7.10.p2]                  from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SCPreferences.h:35,\n[python2-2.7.10.p2]                  from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:124,\n[python2-2.7.10.p2]                  from ./Mac/Modules/_scproxy.c:6:\n[python2-2.7.10.p2] /System/Library/Frameworks/Security.framework/Headers/Authorization.h:194:7: error: variably modified 'bytes' at file scope\n[python2-2.7.10.p2]   char bytes[kAuthorizationExternalFormLength];\n[python2-2.7.10.p2]        ^\n[python2-2.7.10.p2] ./Mac/Modules/_scproxy.c: In function 'get_proxy_settings':\n[python2-2.7.10.p2] ./Mac/Modules/_scproxy.c:67:50: warning: the comparison will always evaluate as 'true' for the address of 'kSCPropNetProxiesExcludeSimpleHostnames' will never be NULL [-Waddress]\n[python2-2.7.10.p2]      if (&kSCPropNetProxiesExcludeSimpleHostnames != NULL) {\n[python2-2.7.10.p2]                                                   ^\n[python2-2.7.10.p2] building '_tkinter' extension\n```\nNot sure #21603 will help in the end. Diving in that header file.",
    "created_at": "2016-10-07T00:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295636",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>More cruft I am guessing

```
[python2-2.7.10.p2] gcc -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/include -I. -IInclude -I./Include -I/usr/local/include -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/src/Include -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p2/src -c ./Mac/Modules/_scproxy.c -o build/temp.macosx-10.9-x86_64-2.7/./Mac/Modules/_scproxy.o
[python2-2.7.10.p2] In file included from /usr/include/Availability.h:176:0,
[python2-2.7.10.p2]                  from /usr/include/stdio.h:65,
[python2-2.7.10.p2]                  from Include/Python.h:33,
[python2-2.7.10.p2]                  from ./Mac/Modules/_scproxy.c:5:
[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:53:34: error: expected ',' or '}' before '__attribute__'
[python2-2.7.10.p2]      kCFISO8601DateFormatWithYear API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0)) = (1UL << 0),
[python2-2.7.10.p2]                                   ^
[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:80:126: error: 'introduced' undeclared here (not in a function)
[python2-2.7.10.p2]  CFDateFormatterRef CFDateFormatterCreateISO8601Formatter(CFAllocatorRef allocator, CFISO8601DateFormatOptions formatOptions) API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));
[python2-2.7.10.p2]                                                                                                                               ^
[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'deprecated' undeclared here (not in a function)
[python2-2.7.10.p2]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
[python2-2.7.10.p2]                                        ^
[python2-2.7.10.p2] /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:39: error: 'message' undeclared here (not in a function)
[python2-2.7.10.p2]  const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
[python2-2.7.10.p2]                                        ^
[python2-2.7.10.p2] In file included from /System/Library/Frameworks/Security.framework/Headers/Security.h:81:0,
[python2-2.7.10.p2]                  from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SCPreferences.h:35,
[python2-2.7.10.p2]                  from /System/Library/Frameworks/SystemConfiguration.framework/Headers/SystemConfiguration.h:124,
[python2-2.7.10.p2]                  from ./Mac/Modules/_scproxy.c:6:
[python2-2.7.10.p2] /System/Library/Frameworks/Security.framework/Headers/Authorization.h:194:7: error: variably modified 'bytes' at file scope
[python2-2.7.10.p2]   char bytes[kAuthorizationExternalFormLength];
[python2-2.7.10.p2]        ^
[python2-2.7.10.p2] ./Mac/Modules/_scproxy.c: In function 'get_proxy_settings':
[python2-2.7.10.p2] ./Mac/Modules/_scproxy.c:67:50: warning: the comparison will always evaluate as 'true' for the address of 'kSCPropNetProxiesExcludeSimpleHostnames' will never be NULL [-Waddress]
[python2-2.7.10.p2]      if (&kSCPropNetProxiesExcludeSimpleHostnames != NULL) {
[python2-2.7.10.p2]                                                   ^
[python2-2.7.10.p2] building '_tkinter' extension
```
Not sure #21603 will help in the end. Diving in that header file.



---

archive/issue_comments_295637.json:
```json
{
    "body": "<a id='comment:20'></a>The mixing of objective C with C in system headers is deep with that one. I am almost ready to suggest we just compile `python` with clang on OS X. Should work.",
    "created_at": "2016-10-07T02:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295637",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>The mixing of objective C with C in system headers is deep with that one. I am almost ready to suggest we just compile `python` with clang on OS X. Should work.



---

archive/issue_comments_295638.json:
```json
{
    "body": "<a id='comment:21'></a>I tried #21603 and got the same issue with Python: `Failed to build these modules: _scproxy`.",
    "created_at": "2016-10-07T03:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295638",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>I tried #21603 and got the same issue with Python: `Failed to build these modules: _scproxy`.



---

archive/issue_comments_295639.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 fbissey]:\n> The mixing of objective C with C in system headers is deep with that one. I am almost ready to suggest we just compile `python` with clang on OS X. Should work.\n\n\nInteresting idea. I built python with clang and things mostly worked. `r` and `psutil` failed to build. I got around that by building `r` with clang and basically ignoring `psutil`. I two some doctest failures, but they were not repeatable. I'm going to run doctests again to see what happens.\n\nThe `r` failure:\n\n```\ngcc -std=gnu99 -I. -I../../../src/include -I../../../src/include -I.  -DLOCALEDIR=\\\"\\\" -DLOCALEALIAS_PATH=\\\"\\\" -DIN_LIBINTL -DHAVE_CONFIG_H -I/System/Library/Frameworks/CoreFoundation.framework/Headers  -fPIC  -g -O2    -c langprefs.c -o langprefs.o\nIn file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:11:0,\n                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n                 from langprefs.c:30:\n/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:74: error: 'introduced' undeclared here (not in a function)\n const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n                                                                          ^\n/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:90: error: 'deprecated' undeclared here (not in a function)\n const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n                                                                                          ^\n/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:107: error: 'message' undeclared here (not in a function)\n const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n                                                                                                           ^\nmake[7]: *** [langprefs.o] Error 1\nmake[6]: *** [all-yes] Error 2\nmake[5]: *** [make.intl] Error 2\nmake[5]: *** Waiting for unfinished jobs....\n```\nThe `psutil` failure:\n\n```\n    gcc -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/python2-2.7.10.p2/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DPSUTIL_VERSION=431 -I/Users/palmieri/Desktop/Sage_stuff/git/sage/local/include/python2.7 -c psutil/_psutil_osx.c -o build/temp.macosx-10.9-x86_64-2.7/psutil/_psutil_osx.o\n    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:53:0,\n                     from psutil/_psutil_osx.c:36:\n    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:53:34: error: expected ',' or '}' before '__attribute__'\n         kCFISO8601DateFormatWithYear API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0)) = (1UL << 0),\n                                      ^\n    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:53:0,\n                     from psutil/_psutil_osx.c:36:\n    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:80:161: error: 'introduced' undeclared here (not in a function)\n     CFDateFormatterRef CFDateFormatterCreateISO8601Formatter(CFAllocatorRef allocator, CFISO8601DateFormatOptions formatOptions) API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));\n                                                                                                                                                                     ^\n    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:11:0,\n                     from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,\n                     from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:60,\n                     from psutil/_psutil_osx.c:36:\n    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:90: error: 'deprecated' undeclared here (not in a function)\n     const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n                                                                                              ^\n    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:107: error: 'message' undeclared here (not in a function)\n     const CFStringRef kCFURLLabelColorKey API_DEPRECATED(\"Use NSURLLabelColorKey\", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));\n                                                                                                               ^\n    error: command 'gcc' failed with exit status 1\n    Running setup.py install for psutil: finished with status 'error'\nCleaning up...\n  Removing source in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build\nCommand \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/python -u -c \"import setuptools, tokenize;__file__='/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\\r\\n', '\\n'), __file__, 'exec'))\" install --record /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-zZTY0f-record/install-record.txt --single-version-externally-managed --compile\" failed with error code 1 in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/\nException information:\nTraceback (most recent call last):\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/basecommand.py\", line 215, in main\n    status = self.run(options, args)\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/commands/install.py\", line 317, in run\n    prefix=options.prefix_path,\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/req/req_set.py\", line 742, in install\n    **kwargs\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/req/req_install.py\", line 880, in install\n    spinner=spinner,\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/utils/__init__.py\", line 718, in call_subprocess\n    % (command_desc, proc.returncode, cwd))\nInstallationError: Command \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/python -u -c \"import setuptools, tokenize;__file__='/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\\r\\n', '\\n'), __file__, 'exec'))\" install --record /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-zZTY0f-record/install-record.txt --single-version-externally-managed --compile\" failed with error code 1 in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/\n```\nNow I see that if I build that with `clang`, it works too. (In all of these cases, I just put `CC=clang` some appropriate place in `spkg-install`.)",
    "created_at": "2016-10-07T14:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295639",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>Replying to [comment:20 fbissey]:
> The mixing of objective C with C in system headers is deep with that one. I am almost ready to suggest we just compile `python` with clang on OS X. Should work.


Interesting idea. I built python with clang and things mostly worked. `r` and `psutil` failed to build. I got around that by building `r` with clang and basically ignoring `psutil`. I two some doctest failures, but they were not repeatable. I'm going to run doctests again to see what happens.

The `r` failure:

```
gcc -std=gnu99 -I. -I../../../src/include -I../../../src/include -I.  -DLOCALEDIR=\"\" -DLOCALEALIAS_PATH=\"\" -DIN_LIBINTL -DHAVE_CONFIG_H -I/System/Library/Frameworks/CoreFoundation.framework/Headers  -fPIC  -g -O2    -c langprefs.c -o langprefs.o
In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:11:0,
                 from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
                 from langprefs.c:30:
/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:74: error: 'introduced' undeclared here (not in a function)
 const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
                                                                          ^
/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:90: error: 'deprecated' undeclared here (not in a function)
 const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
                                                                                          ^
/System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:107: error: 'message' undeclared here (not in a function)
 const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
                                                                                                           ^
make[7]: *** [langprefs.o] Error 1
make[6]: *** [all-yes] Error 2
make[5]: *** [make.intl] Error 2
make[5]: *** Waiting for unfinished jobs....
```
The `psutil` failure:

```
    gcc -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/python2-2.7.10.p2/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -DPSUTIL_VERSION=431 -I/Users/palmieri/Desktop/Sage_stuff/git/sage/local/include/python2.7 -c psutil/_psutil_osx.c -o build/temp.macosx-10.9-x86_64-2.7/psutil/_psutil_osx.o
    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:53:0,
                     from psutil/_psutil_osx.c:36:
    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:53:34: error: expected ',' or '}' before '__attribute__'
         kCFISO8601DateFormatWithYear API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0)) = (1UL << 0),
                                      ^
    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:53:0,
                     from psutil/_psutil_osx.c:36:
    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFDateFormatter.h:80:161: error: 'introduced' undeclared here (not in a function)
     CFDateFormatterRef CFDateFormatterCreateISO8601Formatter(CFAllocatorRef allocator, CFISO8601DateFormatOptions formatOptions) API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));
                                                                                                                                                                     ^
    In file included from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFStream.h:11:0,
                     from /System/Library/Frameworks/CoreFoundation.framework/Headers/CFPropertyList.h:13,
                     from /System/Library/Frameworks/CoreFoundation.framework/Headers/CoreFoundation.h:60,
                     from psutil/_psutil_osx.c:36:
    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:90: error: 'deprecated' undeclared here (not in a function)
     const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
                                                                                              ^
    /System/Library/Frameworks/CoreFoundation.framework/Headers/CFURL.h:777:107: error: 'message' undeclared here (not in a function)
     const CFStringRef kCFURLLabelColorKey API_DEPRECATED("Use NSURLLabelColorKey", macosx(10.6, 10.12), ios(4.0, 10.0), watchos(2.0, 3.0), tvos(9.0, 10.0));
                                                                                                               ^
    error: command 'gcc' failed with exit status 1
    Running setup.py install for psutil: finished with status 'error'
Cleaning up...
  Removing source in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build
Command "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/python -u -c "import setuptools, tokenize;__file__='/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\r\n', '\n'), __file__, 'exec'))" install --record /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-zZTY0f-record/install-record.txt --single-version-externally-managed --compile" failed with error code 1 in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/
Exception information:
Traceback (most recent call last):
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/basecommand.py", line 215, in main
    status = self.run(options, args)
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/commands/install.py", line 317, in run
    prefix=options.prefix_path,
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/req/req_set.py", line 742, in install
    **kwargs
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/req/req_install.py", line 880, in install
    spinner=spinner,
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pip/utils/__init__.py", line 718, in call_subprocess
    % (command_desc, proc.returncode, cwd))
InstallationError: Command "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/python -u -c "import setuptools, tokenize;__file__='/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\r\n', '\n'), __file__, 'exec'))" install --record /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-zZTY0f-record/install-record.txt --single-version-externally-managed --compile" failed with error code 1 in /var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-d3w_bP-build/
```
Now I see that if I build that with `clang`, it works too. (In all of these cases, I just put `CC=clang` some appropriate place in `spkg-install`.)



---

archive/issue_comments_295640.json:
```json
{
    "body": "<a id='comment:23'></a>This basically works for me:\n\n```diff\ndiff --git a/build/pkgs/psutil/spkg-install b/build/pkgs/psutil/spkg-install\nindex c1a2289..6134562 100755\n--- a/build/pkgs/psutil/spkg-install\n+++ b/build/pkgs/psutil/spkg-install\n@@ -1,3 +1,8 @@\n #!/usr/bin/env bash\n \n+if [ \"$UNAME\" = \"Darwin\" ] && [ $MACOSX_VERSION -ge 16 ]; then\n+    echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n+    CC=clang\n+fi\n+\n cd src && $PIP_INSTALL .\ndiff --git a/build/pkgs/python2/spkg-install b/build/pkgs/python2/spkg-install\nindex e679291..683d5b8 100755\n--- a/build/pkgs/python2/spkg-install\n+++ b/build/pkgs/python2/spkg-install\n@@ -56,6 +56,10 @@ if [ \"$UNAME\" = Darwin ]; then\n     mkdir \"$CUR\"/include\n     cp -rp \"${xcode}\"/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdk/MacOSX.sdk/usr/include/openssl \"$CUR\"/include\n     export CFLAGS=\"-I$CUR/include\"\n+    if [ $MACOSX_VERSION -ge 16 ]; then\n+        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n+        CC=clang\n+    fi\n elif [ \"$UNAME\" = SunOS ]; then\n     # Enable some C99 features on Solaris. This in particular enables\n     # the isinf() and isfinite() functions. It works both for C and\ndiff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install\nindex 8601108..5b984fb 100755\n--- a/build/pkgs/r/spkg-install\n+++ b/build/pkgs/r/spkg-install\n@@ -80,7 +80,11 @@ if [ \"$UNAME\" = \"Darwin\" ]; then\n     if [ $MACOSX_VERSION -ge 14 ]; then\n         echo \"OS X 10.$[$MACOSX_VERSION-4] Configuring R without aqua support.\"\n         R_CONFIGURE=\"--with-aqua=no $R_CONFIGURE\"\n-    fi \n+    fi\n+    if [ $MACOSX_VERSION -ge 16 ]; then\n+        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n+        CC=clang\n+    fi\n fi\n \n if [ \"$UNAME\" = \"CYGWIN\" ]; then\n```\nWith this change, Sage builds and doctests almost pass. The one exception is that I occasionally get a \"bad exit\" for a seemingly random file. On two different attempts at `make ptestlong` I've seen\n\n```\nsage -t --long --warn-long 61.3 src/doc/ru/tutorial/tour_groups.rst  # Bad exit: 2\nsage -t --long --warn-long 61.3 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)\n```\nand\n\n```\nsage -t --long --warn-long 67.6 src/sage/rings/infinity.py  # Bad exit: 2\n```\nA third time I didn't see any of these problems.",
    "created_at": "2016-10-07T18:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295640",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>This basically works for me:

```diff
diff --git a/build/pkgs/psutil/spkg-install b/build/pkgs/psutil/spkg-install
index c1a2289..6134562 100755
--- a/build/pkgs/psutil/spkg-install
+++ b/build/pkgs/psutil/spkg-install
@@ -1,3 +1,8 @@
 #!/usr/bin/env bash
 
+if [ "$UNAME" = "Darwin" ] && [ $MACOSX_VERSION -ge 16 ]; then
+    echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
+    CC=clang
+fi
+
 cd src && $PIP_INSTALL .
diff --git a/build/pkgs/python2/spkg-install b/build/pkgs/python2/spkg-install
index e679291..683d5b8 100755
--- a/build/pkgs/python2/spkg-install
+++ b/build/pkgs/python2/spkg-install
@@ -56,6 +56,10 @@ if [ "$UNAME" = Darwin ]; then
     mkdir "$CUR"/include
     cp -rp "${xcode}"/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdk/MacOSX.sdk/usr/include/openssl "$CUR"/include
     export CFLAGS="-I$CUR/include"
+    if [ $MACOSX_VERSION -ge 16 ]; then
+        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
+        CC=clang
+    fi
 elif [ "$UNAME" = SunOS ]; then
     # Enable some C99 features on Solaris. This in particular enables
     # the isinf() and isfinite() functions. It works both for C and
diff --git a/build/pkgs/r/spkg-install b/build/pkgs/r/spkg-install
index 8601108..5b984fb 100755
--- a/build/pkgs/r/spkg-install
+++ b/build/pkgs/r/spkg-install
@@ -80,7 +80,11 @@ if [ "$UNAME" = "Darwin" ]; then
     if [ $MACOSX_VERSION -ge 14 ]; then
         echo "OS X 10.$[$MACOSX_VERSION-4] Configuring R without aqua support."
         R_CONFIGURE="--with-aqua=no $R_CONFIGURE"
-    fi 
+    fi
+    if [ $MACOSX_VERSION -ge 16 ]; then
+        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
+        CC=clang
+    fi
 fi
 
 if [ "$UNAME" = "CYGWIN" ]; then
```
With this change, Sage builds and doctests almost pass. The one exception is that I occasionally get a "bad exit" for a seemingly random file. On two different attempts at `make ptestlong` I've seen

```
sage -t --long --warn-long 61.3 src/doc/ru/tutorial/tour_groups.rst  # Bad exit: 2
sage -t --long --warn-long 61.3 src/sage/matrix/matrix_integer_dense.pyx  # Timed out (and interrupt failed)
```
and

```
sage -t --long --warn-long 67.6 src/sage/rings/infinity.py  # Bad exit: 2
```
A third time I didn't see any of these problems.



---

archive/issue_comments_295641.json:
```json
{
    "body": "<a id='comment:24'></a>Actually something I haven't look into. Since the last beta we build openblas on OS X but I haven't checked if we are using it or still use Accelerate. Could you check? I'd rather stick with Accelerate personally.",
    "created_at": "2016-10-07T19:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295641",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>Actually something I haven't look into. Since the last beta we build openblas on OS X but I haven't checked if we are using it or still use Accelerate. Could you check? I'd rather stick with Accelerate personally.



---

archive/issue_comments_295642.json:
```json
{
    "body": "<a id='comment:25'></a>`openblas` is being built on OS X. What should I check to figure out if it's actually being used?",
    "created_at": "2016-10-07T19:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295642",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>`openblas` is being built on OS X. What should I check to figure out if it's actually being used?



---

archive/issue_comments_295643.json:
```json
{
    "body": "<a id='comment:26'></a>Try\n\n```\notool -L local/lib/libiml.dylib\n```",
    "created_at": "2016-10-07T19:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295643",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>Try

```
otool -L local/lib/libiml.dylib
```



---

archive/issue_comments_295644.json:
```json
{
    "body": "<a id='comment:27'></a>\n```\n$ otool -L local/lib/libiml.dylib\nlocal/lib/libiml.dylib:\n\t/Users/palmieri/Desktop/TESTING/sage/local/lib/libiml.0.dylib (compatibility version 2.0.0, current version 2.1.0)\n\t/Users/palmieri/Desktop/TESTING/sage/local/lib/libgmp.16.dylib (compatibility version 23.0.0, current version 23.2.0)\n\t/Users/palmieri/Desktop/TESTING/sage/local/lib/libopenblas_haswellp-r0.2.15.dylib (compatibility version 0.0.0, current version 0.0.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1238.0.0)\n\t/Users/palmieri/Desktop/TESTING/sage/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n```",
    "created_at": "2016-10-07T19:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295644",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>
```
$ otool -L local/lib/libiml.dylib
local/lib/libiml.dylib:
	/Users/palmieri/Desktop/TESTING/sage/local/lib/libiml.0.dylib (compatibility version 2.0.0, current version 2.1.0)
	/Users/palmieri/Desktop/TESTING/sage/local/lib/libgmp.16.dylib (compatibility version 23.0.0, current version 23.2.0)
	/Users/palmieri/Desktop/TESTING/sage/local/lib/libopenblas_haswellp-r0.2.15.dylib (compatibility version 0.0.0, current version 0.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1238.0.0)
	/Users/palmieri/Desktop/TESTING/sage/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```



---

archive/issue_comments_295645.json:
```json
{
    "body": "<a id='comment:28'></a>Openblas in use then - minor detail, we should get a switch to use Accelerate but that's low priority. \n\nSierra makes Yosemite look like a picnic. Now the ants have arrived. Unless someone bundles some nice libc headers for OS X (I think intel may be doing this, I think they have their own libc) we are being pushed to clang.\n\nsage is in no condition to be compiled with clang/clang++/gfortran right now, I don't think we can rely clang/g++/gfortran either at the moment. Using clang (not clang++) in a few key package is acceptable but in the long term, unless something happen in the GNU camp, we should prepare the move to clang/clang++/gfortran (or available fortran compiler coming along).",
    "created_at": "2016-10-07T21:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295645",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:28'></a>Openblas in use then - minor detail, we should get a switch to use Accelerate but that's low priority. 

Sierra makes Yosemite look like a picnic. Now the ants have arrived. Unless someone bundles some nice libc headers for OS X (I think intel may be doing this, I think they have their own libc) we are being pushed to clang.

sage is in no condition to be compiled with clang/clang++/gfortran right now, I don't think we can rely clang/g++/gfortran either at the moment. Using clang (not clang++) in a few key package is acceptable but in the long term, unless something happen in the GNU camp, we should prepare the move to clang/clang++/gfortran (or available fortran compiler coming along).



---

archive/issue_comments_295646.json:
```json
{
    "body": "<a id='comment:29'></a>I can push my current branch with the changes in comment:23 if you think that's a good idea.",
    "created_at": "2016-10-07T21:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295646",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>I can push my current branch with the changes in comment:23 if you think that's a good idea.



---

archive/issue_comments_295647.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 jhpalmieri]:\n> I can push my current branch with the changes in comment:23 if you think that's a good idea.\n\n\nYes, that would allow people on Sierra to build sage even if we don't push it in this form to release.\n\nI think we should aim for something like clang/g++/gfortran for packages and gcc/g++/gfortran for sagelib. clang/clang++/gfortran for package and gcc/clang++/gfortran for sagelib would be even better but I don't believe we can pull it off. But I should give it a go to be sure since I have already done the package side.",
    "created_at": "2016-10-08T03:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295647",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>Replying to [comment:29 jhpalmieri]:
> I can push my current branch with the changes in comment:23 if you think that's a good idea.


Yes, that would allow people on Sierra to build sage even if we don't push it in this form to release.

I think we should aim for something like clang/g++/gfortran for packages and gcc/g++/gfortran for sagelib. clang/clang++/gfortran for package and gcc/clang++/gfortran for sagelib would be even better but I don't believe we can pull it off. But I should give it a go to be sure since I have already done the package side.



---

archive/issue_comments_295648.json:
```json
{
    "body": "<a id='comment:32'></a>Okay, here it is. I won't mark it ready for review in case you want to do something different, but this does work for me.\n\n---\nNew commits:",
    "created_at": "2016-10-08T04:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295648",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>Okay, here it is. I won't mark it ready for review in case you want to do something different, but this does work for me.

---
New commits:



---

archive/issue_comments_295649.json:
```json
{
    "body": "<a id='comment:33'></a>Gone back to my clang build. After the first error with clang in sage/finance/time_series.pyx I switched to `CC=gcc CXX=clang++`.  I got, first the same error as with the `_scproxy` compilation, followed by 10 to 20 __thousands__ lines of error messages and warnings (I am serious, I don't think I ever got so many from a single compilation with any compilers on any systems) I am glad that mac terminal is set to \"infinite\" scrollback.\n\nI think for now, limiting the usage of `clang` [and strictly no `clang++`] to a few packages will be ok.",
    "created_at": "2016-10-08T08:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295649",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>Gone back to my clang build. After the first error with clang in sage/finance/time_series.pyx I switched to `CC=gcc CXX=clang++`.  I got, first the same error as with the `_scproxy` compilation, followed by 10 to 20 __thousands__ lines of error messages and warnings (I am serious, I don't think I ever got so many from a single compilation with any compilers on any systems) I am glad that mac terminal is set to "infinite" scrollback.

I think for now, limiting the usage of `clang` [and strictly no `clang++`] to a few packages will be ok.



---

archive/issue_comments_295650.json:
```json
{
    "body": "<a id='comment:34'></a>Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.",
    "created_at": "2016-10-08T08:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295650",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.



---

archive/issue_comments_295651.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:\n> Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.\n\n\nThat's worth a shot, I guess.",
    "created_at": "2016-10-08T08:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295651",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:
> Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.


That's worth a shot, I guess.



---

archive/issue_comments_295652.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 fbissey]:\n> Replying to [comment:34 jdemeyer]:\n> > Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.\n\n> \n> That's worth a shot, I guess.\n\n\nTo do that, you need to change the `--enable-languages` option in `build/pkgs/gcc/spkg-install`.",
    "created_at": "2016-10-08T08:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295652",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Replying to [comment:35 fbissey]:
> Replying to [comment:34 jdemeyer]:
> > Just mentioning another option (without claiming that it will work): you could build the Objective-C and Objective-C++ compilers of GCC and use those. Those will probably be ABI-compatible with the other GCC compilers.

> 
> That's worth a shot, I guess.


To do that, you need to change the `--enable-languages` option in `build/pkgs/gcc/spkg-install`.



---

archive/issue_comments_295653.json:
```json
{
    "body": "<a id='comment:37'></a>Yes. I am familiar with the option, thank you (and the option are objc and obj-c++). My little laptop takes a bit of time to do a full compile of gcc and sage for that matter, so it will take a little bit of time on my side once I am ready.",
    "created_at": "2016-10-08T08:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295653",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>Yes. I am familiar with the option, thank you (and the option are objc and obj-c++). My little laptop takes a bit of time to do a full compile of gcc and sage for that matter, so it will take a little bit of time on my side once I am ready.



---

archive/issue_comments_295654.json:
```json
{
    "body": "<a id='comment:38'></a>So if I want to try this, should I use `--enable-languages=objc,obj-c++,fortran` ?",
    "created_at": "2016-10-08T15:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295654",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:38'></a>So if I want to try this, should I use `--enable-languages=objc,obj-c++,fortran` ?



---

archive/issue_comments_295655.json:
```json
{
    "body": "<a id='comment:39'></a>I don't believe you can skip `c` and `c++`. So it would have to be `--enable-languages=c,c++,objc,obj-c++,fortran`.",
    "created_at": "2016-10-08T18:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295655",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>I don't believe you can skip `c` and `c++`. So it would have to be `--enable-languages=c,c++,objc,obj-c++,fortran`.



---

archive/issue_comments_295656.json:
```json
{
    "body": "<a id='comment:40'></a>Okay, and then do I have to tell certain packages to use `objc` instead of `gcc`? Or set `CC=objc` somewhere, or something like that?",
    "created_at": "2016-10-08T18:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295656",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>Okay, and then do I have to tell certain packages to use `objc` instead of `gcc`? Or set `CC=objc` somewhere, or something like that?



---

archive/issue_comments_295657.json:
```json
{
    "body": "<a id='comment:41'></a>I guess. It is exploratory at this stage, I don't know if the objective c compiler will take kindly to c option for example. One thing I tried yesterday was `CC=clang++` which errored on `-std=c99` - it stopped right there. g++ would probably have told me \"not a valid option\" and go on anyway, not `clang++`, it just stopped.",
    "created_at": "2016-10-08T18:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295657",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>I guess. It is exploratory at this stage, I don't know if the objective c compiler will take kindly to c option for example. One thing I tried yesterday was `CC=clang++` which errored on `-std=c99` - it stopped right there. g++ would probably have told me "not a valid option" and go on anyway, not `clang++`, it just stopped.



---

archive/issue_comments_295658.json:
```json
{
    "body": "<a id='comment:42'></a>I can't even get `gcc` 4.9.3 to build with `--enable-languages=c,c++,objc,obj-c++,fortran`",
    "created_at": "2016-10-08T20:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295658",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>I can't even get `gcc` 4.9.3 to build with `--enable-languages=c,c++,objc,obj-c++,fortran`



---

archive/issue_comments_295659.json:
```json
{
    "body": "<a id='comment:43'></a>What's the problem?",
    "created_at": "2016-10-08T20:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295659",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>What's the problem?



---

archive/issue_comments_295660.json:
```json
{
    "body": "<a id='comment:44'></a>Here is the last bit of the log file (in a serial build):\n\n```\nchecking if /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    supports -c -o file.o... (cached) yes\nchecking whether the /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    linker (/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/collect-ld) supports shared libraries... yes\nchecking dynamic linker characteristics... darwin16.0.0 dyld\nchecking how to hardcode library paths into programs... immediate\nchecking whether stripping libraries is possible... yes\nchecking if libtool supports shared libraries... yes\nchecking whether to build shared libraries... yes\nchecking whether to build static libraries... yes\nchecking whether /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    and cc understand -c and -o together... yes\nchecking whether make sets $(MAKE)... yes\nchecking stdio.h usability... yes\nchecking stdio.h presence... yes\nchecking for stdio.h... yes\nchecking for ANSI C header files... (cached) yes\nchecking sched.h usability... yes\nchecking sched.h presence... no\nconfigure: WARNING: sched.h: accepted by the compiler, rejected by the preprocessor!\nconfigure: WARNING: sched.h: proceeding with the compiler's result\nchecking for sched.h... yes\nchecking whether the target supports thread-local storage... no\nchecking for exception model to use... call frame\nconfigure: updating cache ./config.cache\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating config.h\nconfig.status: executing default-1 commands\nconfig.status: executing libtool commands\n/bin/sh ./libtool  --mode=compile /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/NXConstStr.m -c \\\n\t   -I. -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc   -g -O2 -W -Wall -Wwrite-strings -Wstrict-prototypes -DIN_GCC -DIN_TARGET_LIBS -fno-strict-aliasing -fexceptions -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc/config -I../.././gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../libgcc -I../libgcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../include  -fgnu-runtime \\\n\t   -o NXConstStr.lo\nlibtool: compile:  /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/NXConstStr.m -c -I. -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc -g -O2 -W -Wall -Wwrite-strings -Wstrict-prototypes -DIN_GCC -DIN_TARGET_LIBS -fno-strict-aliasing -fexceptions -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc/config -I../.././gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../libgcc -I../libgcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../include -fgnu-runtime  -fno-common -DPIC -o .libs/NXConstStr.o\n/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T//ccC1ir79.s:95:17: error: non-local symbol required in directive\n        .no_dead_strip L_OBJC_Module\n                       ^\nmake[5]: *** [NXConstStr.lo] Error 1\nmake[4]: *** [all-target-libobjc] Error 2\nmake[3]: *** [all] Error 2\n```",
    "created_at": "2016-10-08T21:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295660",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>Here is the last bit of the log file (in a serial build):

```
checking if /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    supports -c -o file.o... (cached) yes
checking whether the /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    linker (/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/collect-ld) supports shared libraries... yes
checking dynamic linker characteristics... darwin16.0.0 dyld
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... yes
checking whether /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    and cc understand -c and -o together... yes
checking whether make sets $(MAKE)... yes
checking stdio.h usability... yes
checking stdio.h presence... yes
checking for stdio.h... yes
checking for ANSI C header files... (cached) yes
checking sched.h usability... yes
checking sched.h presence... no
configure: WARNING: sched.h: accepted by the compiler, rejected by the preprocessor!
configure: WARNING: sched.h: proceeding with the compiler's result
checking for sched.h... yes
checking whether the target supports thread-local storage... no
checking for exception model to use... call frame
configure: updating cache ./config.cache
configure: creating ./config.status
config.status: creating Makefile
config.status: creating config.h
config.status: executing default-1 commands
config.status: executing libtool commands
/bin/sh ./libtool  --mode=compile /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include    /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/NXConstStr.m -c \
	   -I. -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc   -g -O2 -W -Wall -Wwrite-strings -Wstrict-prototypes -DIN_GCC -DIN_TARGET_LIBS -fno-strict-aliasing -fexceptions -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc/config -I../.././gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../libgcc -I../libgcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../include  -fgnu-runtime \
	   -o NXConstStr.lo
libtool: compile:  /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/xgcc -B/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/gcc-build/./gcc/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/bin/ -B/Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/lib/ -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/include -isystem /Users/palmieri/Desktop/TESTING/sage/local/x86_64-apple-darwin16.0.0/sys-include /Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/NXConstStr.m -c -I. -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc -g -O2 -W -Wall -Wwrite-strings -Wstrict-prototypes -DIN_GCC -DIN_TARGET_LIBS -fno-strict-aliasing -fexceptions -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../gcc/config -I../.././gcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../libgcc -I../libgcc -I/Users/palmieri/Desktop/TESTING/sage/local/var/tmp/sage/build/gcc-4.9.3.p1/src/libobjc/../include -fgnu-runtime  -fno-common -DPIC -o .libs/NXConstStr.o
/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T//ccC1ir79.s:95:17: error: non-local symbol required in directive
        .no_dead_strip L_OBJC_Module
                       ^
make[5]: *** [NXConstStr.lo] Error 1
make[4]: *** [all-target-libobjc] Error 2
make[3]: *** [all] Error 2
```



---

archive/issue_comments_295661.json:
```json
{
    "body": "<a id='comment:45'></a>OK not good. Could be better with 6.2.0 but that's a long shot.",
    "created_at": "2016-10-08T22:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295661",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>OK not good. Could be better with 6.2.0 but that's a long shot.



---

archive/issue_comments_295662.json:
```json
{
    "body": "<a id='comment:46'></a>It built with 6.2.0, but I don't see a binary for `objc` or anything similar in `local/bin`. How do I use objective c?",
    "created_at": "2016-10-09T00:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295662",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'></a>It built with 6.2.0, but I don't see a binary for `objc` or anything similar in `local/bin`. How do I use objective c?



---

archive/issue_comments_295663.json:
```json
{
    "body": "<a id='comment:47'></a>Apparently `gcc` for objective c :) https://gcc.gnu.org/onlinedocs/gcc-4.5.3/gcc/Objective_002dC-and-Objective_002dC_002b_002b-Dialect-Options.html so that should give parity with `clang` in terms of language feature. Cross fingers that it work.",
    "created_at": "2016-10-09T01:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295663",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>Apparently `gcc` for objective c :) https://gcc.gnu.org/onlinedocs/gcc-4.5.3/gcc/Objective_002dC-and-Objective_002dC_002b_002b-Dialect-Options.html so that should give parity with `clang` in terms of language feature. Cross fingers that it work.



---

archive/issue_comments_295664.json:
```json
{
    "body": "<a id='comment:48'></a>No luck for me getting Python to build correctly, but I'm probably getting the `CFLAGS` wrong.",
    "created_at": "2016-10-09T02:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295664",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'></a>No luck for me getting Python to build correctly, but I'm probably getting the `CFLAGS` wrong.



---

archive/issue_comments_295665.json:
```json
{
    "body": "<a id='comment:49'></a>Same errors or different ones?",
    "created_at": "2016-10-09T03:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295665",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:49'></a>Same errors or different ones?



---

archive/issue_comments_295666.json:
```json
{
    "body": "<a id='comment:50'></a>If I use (at the end of an `if [ \"$UNAME\" = Darwin ]` block)\n\n```\nexport CFLAGS=\"-I$CUR/include -fgnu-runtime \"\n```\nthen Python builds but I get\n\n```\nFailed to build these modules:\n_scproxy\n```\nSame if I use \n\n```\nexport CFLAGS=\"-I$CUR/include -fnext-runtime \"\n```",
    "created_at": "2016-10-09T05:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295666",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'></a>If I use (at the end of an `if [ "$UNAME" = Darwin ]` block)

```
export CFLAGS="-I$CUR/include -fgnu-runtime "
```
then Python builds but I get

```
Failed to build these modules:
_scproxy
```
Same if I use 

```
export CFLAGS="-I$CUR/include -fnext-runtime "
```



---

archive/issue_comments_295667.json:
```json
{
    "body": "<a id='comment:51'></a>I think we may be on the wrong track, remember #18254? I will play around with `MACOSX_DEPLOYMENT_TARGET` currently stuck on 10.9 as the maximum. Somehow something gone \"boing\" in my install, so `make distclean` before restarting `gcc` then takes some time...",
    "created_at": "2016-10-09T08:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295667",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>I think we may be on the wrong track, remember #18254? I will play around with `MACOSX_DEPLOYMENT_TARGET` currently stuck on 10.9 as the maximum. Somehow something gone "boing" in my install, so `make distclean` before restarting `gcc` then takes some time...



---

archive/issue_comments_295668.json:
```json
{
    "body": "<a id='comment:52'></a>I think this is #18254 all over again except that setting `MACOSX_DEPLOYMENT_TARGET` to 10.9 (or 10.12) doesn't fix the problem. Unsetting failed me too.",
    "created_at": "2016-10-09T20:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295668",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'></a>I think this is #18254 all over again except that setting `MACOSX_DEPLOYMENT_TARGET` to 10.9 (or 10.12) doesn't fix the problem. Unsetting failed me too.



---

archive/issue_comments_295669.json:
```json
{
    "body": "<a id='comment:53'></a>And because we are using `rpath` we need to set it at 10.5 minimum - not unset it. I think we are cornered into going `clang`. Any of the other people in brew, macports and al using gcc have suggestions? Couldn't find any on google.",
    "created_at": "2016-10-09T21:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295669",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>And because we are using `rpath` we need to set it at 10.5 minimum - not unset it. I think we are cornered into going `clang`. Any of the other people in brew, macports and al using gcc have suggestions? Couldn't find any on google.



---

archive/issue_comments_295670.json:
```json
{
    "body": "<a id='comment:54'></a>The failure in matrix_integer_dense.pyx is also very common on OSX 10.11 right now (possibly related to openblas, not sure). Why not go with comment:23, its definitely an improvement over not building.",
    "created_at": "2016-10-13T22:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295670",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:54'></a>The failure in matrix_integer_dense.pyx is also very common on OSX 10.11 right now (possibly related to openblas, not sure). Why not go with comment:23, its definitely an improvement over not building.



---

archive/issue_comments_295671.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:54 vbraun]:\n> The failure in matrix_integer_dense.pyx is also very common on OSX 10.11 right now (possibly related to openblas, not sure). Why not go with comment:23, its definitely an improvement over not building.\n\n\n`matrix_integer_dense.pyx` needs its own ticket. It wants to be compiled as both a `c` and a `c++` file at the same time. `module_list.py` gives it `-std=c99`, `linbox` is pulled in its dependencies from somewhere and bring `-std=gnu++11` and the cythonized file ends up in `.cpp`. Removing the `-std=c99` from `module_list.py` and adding `language =c++` doesn't make a difference. Something else puts back the `std=c99` (`multi_modular.pxd`?). This is my current obstacle in porting to clang at #12426.",
    "created_at": "2016-10-13T23:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295671",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>Replying to [comment:54 vbraun]:
> The failure in matrix_integer_dense.pyx is also very common on OSX 10.11 right now (possibly related to openblas, not sure). Why not go with comment:23, its definitely an improvement over not building.


`matrix_integer_dense.pyx` needs its own ticket. It wants to be compiled as both a `c` and a `c++` file at the same time. `module_list.py` gives it `-std=c99`, `linbox` is pulled in its dependencies from somewhere and bring `-std=gnu++11` and the cythonized file ends up in `.cpp`. Removing the `-std=c99` from `module_list.py` and adding `language =c++` doesn't make a difference. Something else puts back the `std=c99` (`multi_modular.pxd`?). This is my current obstacle in porting to clang at #12426.



---

archive/issue_comments_295672.json:
```json
{
    "body": "<a id='comment:56'></a>I am otherwise OK to go with the branch rather than not building.",
    "created_at": "2016-10-14T00:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295672",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>I am otherwise OK to go with the branch rather than not building.



---

archive/issue_comments_295673.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-14T00:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295673",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_295674.json:
```json
{
    "body": "<a id='comment:58'></a>Making it positive if you want to include it.",
    "created_at": "2016-10-14T00:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295674",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>Making it positive if you want to include it.



---

archive/issue_comments_295675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-14T00:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295675",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_295676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-15T10:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21567#issuecomment-295676",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-15T10:25:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21567#event-57223"
}
```
