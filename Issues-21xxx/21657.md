# Issue 21657: Import abs in functions/all.py

archive/issues_021420.json:
```json
{
    "body": "Since `abs` is an explicit alias of `abs_symbolic` it should be explicitly imported from `functions/other.py`\n\n**Branch:** [u/paulmasson/import_abs_in_functions_all_py](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/import_abs_in_functions_all_py)\n\n**Commit:** [b36e1c415161ffaa93db4975fd8b69b4374a7a5a](https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a)\n\n**Author:** Paul Masson\n\nIssue created by migration from https://trac.sagemath.org/ticket/21657\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2016-10-06T21:53:50Z",
    "labels": [
        "component: symbolics",
        "minor",
        "bug",
        "invalid"
    ],
    "title": "Import abs in functions/all.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/21657",
    "user": "https://github.com/paulmasson"
}
```
Since `abs` is an explicit alias of `abs_symbolic` it should be explicitly imported from `functions/other.py`

**Branch:** [u/paulmasson/import_abs_in_functions_all_py](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/import_abs_in_functions_all_py)

**Commit:** [b36e1c415161ffaa93db4975fd8b69b4374a7a5a](https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a)

**Author:** Paul Masson

Issue created by migration from https://trac.sagemath.org/ticket/21657





---

archive/issue_comments_320771.json:
```json
{
    "body": "**Branch:** [u/paulmasson/import_abs_in_functions_all_py](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/import_abs_in_functions_all_py)",
    "created_at": "2016-10-06T21:54:55Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320771",
    "user": "https://github.com/paulmasson"
}
```

**Branch:** [u/paulmasson/import_abs_in_functions_all_py](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/import_abs_in_functions_all_py)



---

archive/issue_events_194010.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-10-06T21:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "component: symbolics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194010"
}
```



---

archive/issue_comments_320772.json:
```json
{
    "body": "**Commit:** [b36e1c415161ffaa93db4975fd8b69b4374a7a5a](https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a)",
    "created_at": "2016-10-06T21:57:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320772",
    "user": "https://github.com/paulmasson"
}
```

**Commit:** [b36e1c415161ffaa93db4975fd8b69b4374a7a5a](https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a)



---

archive/issue_comments_320773.json:
```json
{
    "body": "**Author:** Paul Masson",
    "created_at": "2016-10-06T21:57:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320773",
    "user": "https://github.com/paulmasson"
}
```

**Author:** Paul Masson



---

archive/issue_events_194011.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-10-06T21:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194011"
}
```



---

archive/issue_comments_320774.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a\">b36e1c4</a></td><td><code>Import abs</code></td></tr></table>\n",
    "created_at": "2016-10-06T21:57:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320774",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b36e1c415161ffaa93db4975fd8b69b4374a7a5a">b36e1c4</a></td><td><code>Import abs</code></td></tr></table>




---

archive/issue_events_194012.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-10-06T21:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194012"
}
```



---

archive/issue_comments_320775.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Since `abs` is an explicit alias of `abs_symbolic` it should be explicitly imported from `functions/other.py`\n``````\n",
    "created_at": "2016-10-06T21:57:19Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320775",
    "user": "https://github.com/paulmasson"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Since `abs` is an explicit alias of `abs_symbolic` it should be explicitly imported from `functions/other.py`
``````




---

archive/issue_events_194013.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-10-06T21:57:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194013"
}
```



---

archive/issue_comments_320776.json:
```json
{
    "body": "<a id='comment:3'></a>\nPatchbot:\n\n```\nsage -t --long src/sage/matrix/matrix2.pyx  # 5 doctests failed\nsage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t --long src/sage/rings/continued_fraction.py  # 2 doctests failed\nsage -t --long src/sage/rings/number_field/number_field_element_quadratic.pyx  # 1 doctest failed\nsage -t --long src/sage/modules/free_module_element.pyx  # 2 doctests failed\nsage -t --long src/sage/stats/distributions/discrete_gaussian_lattice.py  # 2 doctests failed\nsage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 2 doctests failed\nsage -t --long src/sage/matrix/matrix_double_dense.pyx  # 2 doctests failed\nsage -t --long src/sage/misc/sage_input.py  # 1 doctest failed\nsage -t --long src/sage/libs/mpmath/ext_main.pyx  # 1 doctest failed\n\n```",
    "created_at": "2016-10-29T08:20:23Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320776",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
Patchbot:

```
sage -t --long src/sage/matrix/matrix2.pyx  # 5 doctests failed
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/rings/continued_fraction.py  # 2 doctests failed
sage -t --long src/sage/rings/number_field/number_field_element_quadratic.pyx  # 1 doctest failed
sage -t --long src/sage/modules/free_module_element.pyx  # 2 doctests failed
sage -t --long src/sage/stats/distributions/discrete_gaussian_lattice.py  # 2 doctests failed
sage -t --long src/sage/matrix/matrix_symbolic_dense.pyx  # 2 doctests failed
sage -t --long src/sage/matrix/matrix_double_dense.pyx  # 2 doctests failed
sage -t --long src/sage/misc/sage_input.py  # 1 doctest failed
sage -t --long src/sage/libs/mpmath/ext_main.pyx  # 1 doctest failed

```



---

archive/issue_comments_320777.json:
```json
{
    "body": "<a id='comment:4'></a>\nCommenting on some of the doctest failures...\n\n```\nsage -t --long --warn-long 35.3 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 6868, in sage.symbolic.expression.Expression.__abs__\nFailed example:\n    abs(SR(-5),hold=True)\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: abs() takes no keyword arguments\nGot:\n    abs(-5)\n```\nThis looks like the correct answer so just adapt the doctest.\n\n```\nFile \"src/sage/rings/continued_fraction.py\", line 500, in sage.rings.continued_fraction.ContinuedFraction_base.__abs__\nFailed example:\n    abs(a)\nException raised:\n...\n    TypeError: cannot coerce arguments: no canonical coercion from <class 'sage.rings.continued_fraction.ContinuedFraction_periodic'> to Symbolic Ring\n```\nMost fails are of this type. I think this is related to #17790.\n\n```\nsage -t --long src/sage/libs/mpmath/ext_main.pyx\n...\n      File \"sage/symbolic/function.pyx\", line 766, in sage.symbolic.function.Function._eval_mpmath_ (build/cythonized/sage/symbolic/function.cpp:8582)\n        res = self(*args)\n      File \"sage/symbolic/function.pyx\", line 979, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11061)\n        return custom(*args)\n      File \"sage/symbolic/function.pyx\", line 766, in sage.symbolic.function.Function._eval_mpmath_ (build/cythonized/sage/symbolic/function.cpp:8582)\n        res = self(*args)\n      File \"sage/symbolic/function.pyx\", line 979, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11061)\n        return custom(*args)\n...\n    RuntimeError: maximum recursion depth exceeded while calling a Python object\n```\nThis one is different, it looks like a bug in `BuiltinFunction._eval_mpmath_()`.",
    "created_at": "2016-11-15T07:27:11Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320777",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
Commenting on some of the doctest failures...

```
sage -t --long --warn-long 35.3 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 6868, in sage.symbolic.expression.Expression.__abs__
Failed example:
    abs(SR(-5),hold=True)
Expected:
    Traceback (most recent call last):
    ...
    TypeError: abs() takes no keyword arguments
Got:
    abs(-5)
```
This looks like the correct answer so just adapt the doctest.

```
File "src/sage/rings/continued_fraction.py", line 500, in sage.rings.continued_fraction.ContinuedFraction_base.__abs__
Failed example:
    abs(a)
Exception raised:
...
    TypeError: cannot coerce arguments: no canonical coercion from <class 'sage.rings.continued_fraction.ContinuedFraction_periodic'> to Symbolic Ring
```
Most fails are of this type. I think this is related to #17790.

```
sage -t --long src/sage/libs/mpmath/ext_main.pyx
...
      File "sage/symbolic/function.pyx", line 766, in sage.symbolic.function.Function._eval_mpmath_ (build/cythonized/sage/symbolic/function.cpp:8582)
        res = self(*args)
      File "sage/symbolic/function.pyx", line 979, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11061)
        return custom(*args)
      File "sage/symbolic/function.pyx", line 766, in sage.symbolic.function.Function._eval_mpmath_ (build/cythonized/sage/symbolic/function.cpp:8582)
        res = self(*args)
      File "sage/symbolic/function.pyx", line 979, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11061)
        return custom(*args)
...
    RuntimeError: maximum recursion depth exceeded while calling a Python object
```
This one is different, it looks like a bug in `BuiltinFunction._eval_mpmath_()`.



---

archive/issue_comments_320778.json:
```json
{
    "body": "<a id='comment:5'></a>\nCan we not merge this ticket and close it as invalid?\n\nI think the alias should be interpreted the other way around: `sage.functions.other.abs` is bound because there's no name clash and this is the most logical name. In addition, there's `sage.functions.other.abs_symbolic` which avoids the nameclash with python's builtin `abs` and is therefore suitable for importing into the global namespace (does it need to be there, though?).",
    "created_at": "2016-11-16T08:07:22Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320778",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'></a>
Can we not merge this ticket and close it as invalid?

I think the alias should be interpreted the other way around: `sage.functions.other.abs` is bound because there's no name clash and this is the most logical name. In addition, there's `sage.functions.other.abs_symbolic` which avoids the nameclash with python's builtin `abs` and is therefore suitable for importing into the global namespace (does it need to be there, though?).



---

archive/issue_comments_320779.json:
```json
{
    "body": "<a id='comment:6'></a>\nMy sage-devel post repeated here:\n`Expression.__abs__()` directly calls Pynac's `abs_eval` while `abs_symbolic` goes through `GinacFunction`'s Python code first, e.g.:\n\n```\nsage: abs_symbolic(x,x)\n...\nTypeError: Symbolic function abs takes exactly 1 arguments (2 given)\n\nsage: abs(x,x)\n...\nTypeError: abs() takes exactly one argument (2 given)\n```\nso there is a difference that might show with other usages too.",
    "created_at": "2016-11-16T08:24:11Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320779",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
My sage-devel post repeated here:
`Expression.__abs__()` directly calls Pynac's `abs_eval` while `abs_symbolic` goes through `GinacFunction`'s Python code first, e.g.:

```
sage: abs_symbolic(x,x)
...
TypeError: Symbolic function abs takes exactly 1 arguments (2 given)

sage: abs(x,x)
...
TypeError: abs() takes exactly one argument (2 given)
```
so there is a difference that might show with other usages too.



---

archive/issue_comments_320780.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [rws](#comment%3A6):\n> My sage-devel post repeated here:\n> `Expression.__abs__()` directly calls Pynac's `abs_eval` while `abs_symbolic` goes through `GinacFunction`'s Python code first\n\n\nYou can change that if you want to, but I'm not sure if one or the other has an advantage.\n\n> e.g.:\n> \n> ```\n> sage: abs_symbolic(x,x)\n> ...\n> TypeError: Symbolic function abs takes exactly 1 arguments (2 given)\n> \n> sage: abs(x,x)\n> ...\n> TypeError: abs() takes exactly one argument (2 given)\n> ```\n\nThat doesn't confirm the statement you made above. Python's `abs` does a check on the number of parameters before dispatching. It has to because it dispatches through a slot in `PyNumberMethods`, going to a c-function that accepts only one argument (meaning that for instance on cython types, `abs(c)` can work just as fast as `len(c)` etc: these methods are resolved via a pointer on the type; no method resolution required)\n\nSo the error traceback of `abs(x,x)` and `abs_symbolic(x,x)` will be different even if you chance `Expression.__abs__`.\n\n> so there is a difference that might show with other usages too.\n\n\nThese difference have a good reason, though, and are evidence of an efficiency in `builtin.abs` that we do not want to lose (e.g., people doing numerical work are going to be quite upset if they don't get the usual `abs` in sage anymore and have to pay the price of full method resolution and a `GinacFunction`).\n\nDifferences between toplevel functions and symbolic functions happen more often, even for things that are in control of sage:\n\n```\nsage: F=integrate(function('f')(x),x,0,1); F\nintegrate(f(x), x, 0, 1)\nsage: integrate is F.operator()\nFalse\nsage: type(integrate)\n<type 'function'>\nsage: type(F.operator())\n<class 'sage.symbolic.integration.integral.DefiniteIntegral'>\nsage: integrate is sage.symbolic.integration.integral.integrate\nFalse\n```",
    "created_at": "2016-11-16T16:17:52Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320780",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>
Replying to [rws](#comment%3A6):
> My sage-devel post repeated here:
> `Expression.__abs__()` directly calls Pynac's `abs_eval` while `abs_symbolic` goes through `GinacFunction`'s Python code first


You can change that if you want to, but I'm not sure if one or the other has an advantage.

> e.g.:
> 
> ```
> sage: abs_symbolic(x,x)
> ...
> TypeError: Symbolic function abs takes exactly 1 arguments (2 given)
> 
> sage: abs(x,x)
> ...
> TypeError: abs() takes exactly one argument (2 given)
> ```

That doesn't confirm the statement you made above. Python's `abs` does a check on the number of parameters before dispatching. It has to because it dispatches through a slot in `PyNumberMethods`, going to a c-function that accepts only one argument (meaning that for instance on cython types, `abs(c)` can work just as fast as `len(c)` etc: these methods are resolved via a pointer on the type; no method resolution required)

So the error traceback of `abs(x,x)` and `abs_symbolic(x,x)` will be different even if you chance `Expression.__abs__`.

> so there is a difference that might show with other usages too.


These difference have a good reason, though, and are evidence of an efficiency in `builtin.abs` that we do not want to lose (e.g., people doing numerical work are going to be quite upset if they don't get the usual `abs` in sage anymore and have to pay the price of full method resolution and a `GinacFunction`).

Differences between toplevel functions and symbolic functions happen more often, even for things that are in control of sage:

```
sage: F=integrate(function('f')(x),x,0,1); F
integrate(f(x), x, 0, 1)
sage: integrate is F.operator()
False
sage: type(integrate)
<type 'function'>
sage: type(F.operator())
<class 'sage.symbolic.integration.integral.DefiniteIntegral'>
sage: integrate is sage.symbolic.integration.integral.integrate
False
```



---

archive/issue_comments_320781.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [nbruin](#comment%3A5):\n> Can we not merge this ticket and close it as invalid?\n\nI really didn't expect this simple change to cause so much trouble, so yes let's close it. Thanks for the feedback.",
    "created_at": "2016-11-16T21:41:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320781",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:8'></a>
Replying to [nbruin](#comment%3A5):
> Can we not merge this ticket and close it as invalid?

I really didn't expect this simple change to cause so much trouble, so yes let's close it. Thanks for the feedback.



---

archive/issue_events_194014.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-11-16T21:42:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194014"
}
```



---

archive/issue_events_194015.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-17T02:55:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194015"
}
```



---

archive/issue_events_194016.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-11-17T02:55:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194016"
}
```



---

archive/issue_comments_320782.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [paulmasson](#comment%3A8):\n> I really didn't expect this simple change to cause so much trouble, so yes let's close it. Thanks for the feedback.\n\n:-) Hopefully you enjoyed learning something about python and sage in the process.",
    "created_at": "2016-11-17T02:55:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21657#issuecomment-320782",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:10'></a>
Replying to [paulmasson](#comment%3A8):
> I really didn't expect this simple change to cause so much trouble, so yes let's close it. Thanks for the feedback.

:-) Hopefully you enjoyed learning something about python and sage in the process.



---

archive/issue_events_194017.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194017"
}
```



---

archive/issue_events_194018.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21657#event-194018"
}
```
