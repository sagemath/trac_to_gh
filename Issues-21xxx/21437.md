# Issue 21437: Proper initialisation for the optional MeatAxe library

archive/issues_021200.json:
```json
{
    "assignees": [],
    "body": "Modules using the optional MeatAxe package need the following initialisation:\n\n- MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.\n- Each module that links against the MeatAxe library, which is a static library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.\n\nI suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module `sage.libs.meataxe` is created.\n\nDepends on #23411\nDepends on #23352\n\nKeywords: **MeatAxe, matrix backend**\n\nBranch/Commit: **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Simon King**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21437_\n\n",
    "closed_at": "2017-09-15T07:30:59Z",
    "created_at": "2016-09-06T12:44:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Proper initialisation for the optional MeatAxe library",
    "type": "issue",
    "updated_at": "2017-09-15T07:30:59Z",
    "url": "https://github.com/sagemath/sage/issues/21437",
    "user": "https://github.com/simon-king-jena"
}
```
Modules using the optional MeatAxe package need the following initialisation:

- MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.
- Each module that links against the MeatAxe library, which is a static library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.

I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module `sage.libs.meataxe` is created.

Depends on #23411
Depends on #23352

Keywords: **MeatAxe, matrix backend**

Branch/Commit: **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**

Reviewer: **Jeroen Demeyer**

Author: **Simon King**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/21437_





---

archive/issue_events_301149.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-06T12:44:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301149"
}
```



---

archive/issue_events_301150.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-06T12:44:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301150"
}
```



---

archive/issue_comments_314054.json:
```json
{
    "body": "Branch: **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)**",
    "created_at": "2016-09-06T12:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314054",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)**



---

archive/issue_comments_314055.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e0f5d4f255e4a1b9e041947c806015572a036d9\">9e0f5d4</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/778df7dea910cb458e6426df82edc375180d32e5\">778df7d</a></td><td><code>Help using MeatAxe executables in Sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02fa8a2083b359d1ab760cd972ad9f44236217ea\">02fa8a2</a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d\">e861781</a></td><td><code>Add c(p)def functions to get/set horizontal matrix slices</code></td></tr></table>\n",
    "created_at": "2016-09-06T12:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314055",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e0f5d4f255e4a1b9e041947c806015572a036d9">9e0f5d4</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/778df7dea910cb458e6426df82edc375180d32e5">778df7d</a></td><td><code>Help using MeatAxe executables in Sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02fa8a2083b359d1ab760cd972ad9f44236217ea">02fa8a2</a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d">e861781</a></td><td><code>Add c(p)def functions to get/set horizontal matrix slices</code></td></tr></table>




---

archive/issue_events_301151.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-06T12:56:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301151"
}
```



---

archive/issue_comments_314056.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2016-09-06T12:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314056",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_events_301152.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-06T12:56:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301152"
}
```



---

archive/issue_comments_314057.json:
```json
{
    "body": "Commit: **[`e861781`](https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d)**",
    "created_at": "2016-09-06T12:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314057",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`e861781`](https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d)**



---

archive/issue_comments_314058.json:
```json
{
    "body": "Changed keywords from none to **MeatAxe, matrix backend**",
    "created_at": "2016-09-06T12:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314058",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from none to **MeatAxe, matrix backend**



---

archive/issue_events_301153.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-06T12:56:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301153"
}
```



---

archive/issue_comments_314059.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n+While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper:\n \n+- Things used to crash when reading a matrix from an empty/non-existent file. Rather, it should return an empty matrix.\n+- MeatAxe executable rely on an environment variable declaring where to find multiplication tables. This variable is now defined upon importing `sage.matrix.matrix_gfpn_dense`.\n+- An important fix: Previously, for pickling a matrix, I was simply dumping the contents of a memory block. By MeatAxe's design, one row occupies a multiple of `sizeof(long)` in memory, but there may be trailing empty bytes, whose number will generally depend on `sizeof(long)`. Hence, pickling must not dump the whole memory block, as it is machine dependent. Instead, only the parts of memory that are actually used to store data have to be dumped.\n+- There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).\n``````\n",
    "created_at": "2016-09-06T12:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314059",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
+While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper:
 
+- Things used to crash when reading a matrix from an empty/non-existent file. Rather, it should return an empty matrix.
+- MeatAxe executable rely on an environment variable declaring where to find multiplication tables. This variable is now defined upon importing `sage.matrix.matrix_gfpn_dense`.
+- An important fix: Previously, for pickling a matrix, I was simply dumping the contents of a memory block. By MeatAxe's design, one row occupies a multiple of `sizeof(long)` in memory, but there may be trailing empty bytes, whose number will generally depend on `sizeof(long)`. Hence, pickling must not dump the whole memory block, as it is machine dependent. Instead, only the parts of memory that are actually used to store data have to be dumped.
+- There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).
``````




---

archive/issue_comments_314060.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a\">4f3d56c</a></td><td><code>Fix index check in get_slice</code></td></tr></table>\n",
    "created_at": "2016-09-06T15:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314060",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a">4f3d56c</a></td><td><code>Fix index check in get_slice</code></td></tr></table>




---

archive/issue_comments_314061.json:
```json
{
    "body": "Changed commit from **[`e861781`](https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d)** to **[`4f3d56c`](https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a)**",
    "created_at": "2016-09-06T15:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314061",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e861781`](https://github.com/sagemath/sagetrac-mirror/commit/e861781fcdd710864b01db832a700b13af20218d)** to **[`4f3d56c`](https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a)**



---

archive/issue_comments_314062.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI guess you forgot some `# optional` in the doctests \n\n```\n**********************************************************************\nFile \"src/sage/matrix/matrix_gfpn_dense.pyx\", line 657, in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.get_slice\nFailed example:\n    from sage.matrix.matrix_gfpn_dense import Matrix_gfpn_dense as MTX\nException raised:\n    Traceback (most recent call last):\n    ...\n    ImportError: No module named matrix_gfpn_dense\n**********************************************************************\n```",
    "created_at": "2016-09-08T09:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314062",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

I guess you forgot some `# optional` in the doctests 

```
**********************************************************************
File "src/sage/matrix/matrix_gfpn_dense.pyx", line 657, in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.get_slice
Failed example:
    from sage.matrix.matrix_gfpn_dense import Matrix_gfpn_dense as MTX
Exception raised:
    Traceback (most recent call last):
    ...
    ImportError: No module named matrix_gfpn_dense
**********************************************************************
```



---

archive/issue_comments_314063.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a\">a4dded9</a></td><td><code>Make new tests optional</code></td></tr></table>\n",
    "created_at": "2016-09-08T11:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314063",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a">a4dded9</a></td><td><code>Make new tests optional</code></td></tr></table>




---

archive/issue_comments_314064.json:
```json
{
    "body": "Changed commit from **[`4f3d56c`](https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a)** to **[`a4dded9`](https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a)**",
    "created_at": "2016-09-08T11:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314064",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4f3d56c`](https://github.com/sagemath/sagetrac-mirror/commit/4f3d56c9eef371fa62bc0e1cb8a2a93251f9150a)** to **[`a4dded9`](https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a)**



---

archive/issue_comments_314065.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@videlec](#comment:4):\n> I guess you forgot some `# optional` in the doctests \n\nDone!",
    "created_at": "2016-09-08T11:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314065",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@videlec](#comment:4):
> I guess you forgot some `# optional` in the doctests 

Done!



---

archive/issue_comments_314066.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe patchbot reports a timout. Is that reproducible?\n\nAlso, according to the coverage plugin, it seems that one function lacks testing. \n\nAnd I found that the function FfTrueRowSize is uselessly called in a couple of places: It always holds true that `FfCurrentRowSizeIo == FfTrueRowSize(FfNoc)`,  where FfCurrentRowSizeIo and FfNoc are both some global variables. Nevertheless, there are calls to `FfTrueRowSize(FfNoc)` in various places. When profiling my cohomology computations, a measurable amount of time was spent on FfTrueRowSize; therefore I want to create another patch.",
    "created_at": "2016-09-12T10:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314066",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

The patchbot reports a timout. Is that reproducible?

Also, according to the coverage plugin, it seems that one function lacks testing. 

And I found that the function FfTrueRowSize is uselessly called in a couple of places: It always holds true that `FfCurrentRowSizeIo == FfTrueRowSize(FfNoc)`,  where FfCurrentRowSizeIo and FfNoc are both some global variables. Nevertheless, there are calls to `FfTrueRowSize(FfNoc)` in various places. When profiling my cohomology computations, a measurable amount of time was spent on FfTrueRowSize; therefore I want to create another patch.



---

archive/issue_events_301154.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-12T10:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301154"
}
```



---

archive/issue_events_301155.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-12T10:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301155"
}
```



---

archive/issue_comments_314067.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e17e4df587c92db2dd2df76f05f48b041383678e\">e17e4df</a></td><td><code>Document and test _rowlist_()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3\">291f4dc</a></td><td><code>Some minor tweaks for performance</code></td></tr></table>\n",
    "created_at": "2016-09-12T16:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314067",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e17e4df587c92db2dd2df76f05f48b041383678e">e17e4df</a></td><td><code>Document and test _rowlist_()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3">291f4dc</a></td><td><code>Some minor tweaks for performance</code></td></tr></table>




---

archive/issue_comments_314068.json:
```json
{
    "body": "Changed commit from **[`a4dded9`](https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a)** to **[`291f4dc`](https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3)**",
    "created_at": "2016-09-12T16:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314068",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a4dded9`](https://github.com/sagemath/sagetrac-mirror/commit/a4dded952bba2f5f2ba57022d0817dbb34e81a5a)** to **[`291f4dc`](https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3)**



---

archive/issue_events_301156.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-12T16:07:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301156"
}
```



---

archive/issue_events_301157.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-12T16:07:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301157"
}
```



---

archive/issue_comments_314069.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThere are strange doctest errors on arando. Could you have a look?",
    "created_at": "2016-09-13T21:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314069",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

There are strange doctest errors on arando. Could you have a look?



---

archive/issue_events_301158.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-13T21:48:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301158"
}
```



---

archive/issue_events_301159.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-13T21:48:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301159"
}
```



---

archive/issue_comments_314070.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44\">03ce5c0</a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr></table>\n",
    "created_at": "2016-09-14T11:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314070",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44">03ce5c0</a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr></table>




---

archive/issue_comments_314071.json:
```json
{
    "body": "Changed commit from **[`291f4dc`](https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3)** to **[`03ce5c0`](https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44)**",
    "created_at": "2016-09-14T11:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314071",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`291f4dc`](https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3)** to **[`03ce5c0`](https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44)**



---

archive/issue_comments_314072.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI have pushed another commit, since I made a typo in doc formatting.\n\nReplying to [@videlec](#comment:10):\n> There are strange doctest errors on arando. Could you have a look?\n\nMaybe it isn't strange after all. It is about a random test. The values I provide in the test are what I get when I start a fresh Sage session, but probably I forgot that the random seed in doctests is different.\n\nSo, easy to fix...",
    "created_at": "2016-09-14T11:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314072",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

I have pushed another commit, since I made a typo in doc formatting.

Replying to [@videlec](#comment:10):
> There are strange doctest errors on arando. Could you have a look?

Maybe it isn't strange after all. It is about a random test. The values I provide in the test are what I get when I start a fresh Sage session, but probably I forgot that the random seed in doctests is different.

So, easy to fix...



---

archive/issue_comments_314073.json:
```json
{
    "body": "Changed commit from **[`03ce5c0`](https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44)** to **[`5ed2269`](https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0)**",
    "created_at": "2016-09-14T11:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314073",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`03ce5c0`](https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44)** to **[`5ed2269`](https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0)**



---

archive/issue_comments_314074.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0\">5ed2269</a></td><td><code>Fix one doctest</code></td></tr></table>\n",
    "created_at": "2016-09-14T11:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314074",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0">5ed2269</a></td><td><code>Fix one doctest</code></td></tr></table>




---

archive/issue_comments_314075.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nFixed!",
    "created_at": "2016-09-14T11:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314075",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Fixed!



---

archive/issue_events_301160.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-14T11:12:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301160"
}
```



---

archive/issue_events_301161.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-09-14T11:12:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301161"
}
```



---

archive/issue_comments_314076.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAdmittedly, the bugs fixed here only concern users of the optional meataxe package. However, I'd appreciate a review. At least the patchbot seems happy about it.",
    "created_at": "2017-01-09T12:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314076",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

Admittedly, the bugs fixed here only concern users of the optional meataxe package. However, I'd appreciate a review. At least the patchbot seems happy about it.



---

archive/issue_events_301162.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-22T10:04:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301162"
}
```



---

archive/issue_events_301163.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-22T10:04:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301163"
}
```



---

archive/issue_comments_314077.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor Python 3 compatibility, you should use `bytes` instead of `str` for pickling.\n\nThis means changing the `PyString_...` functions to `PyBytes_...` and this:\n\n```diff\n-def mtx_unpickle(f, int nr, int nc, str Data, bint m):\n+def mtx_unpickle(f, int nr, int nc, bytes Data, bint m):\n```",
    "created_at": "2017-02-22T10:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314077",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

For Python 3 compatibility, you should use `bytes` instead of `str` for pickling.

This means changing the `PyString_...` functions to `PyBytes_...` and this:

```diff
-def mtx_unpickle(f, int nr, int nc, str Data, bint m):
+def mtx_unpickle(f, int nr, int nc, bytes Data, bint m):
```



---

archive/issue_events_301164.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-22T10:04:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301164"
}
```



---

archive/issue_events_301165.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-22T10:04:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301165"
}
```



---

archive/issue_comments_314078.json:
```json
{
    "body": "Replying to [ticket:21437 SimonKing]:\n> - MeatAxe executable rely on an environment variable declaring where to find multiplication tables.\n\nAre you sure? I thought this was handled by the `MtxLibDir` array?",
    "created_at": "2017-02-22T10:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314078",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:21437 SimonKing]:
> - MeatAxe executable rely on an environment variable declaring where to find multiplication tables.

Are you sure? I thought this was handled by the `MtxLibDir` array?



---

archive/issue_comments_314079.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is deprecated syntax:\n\n```\nfor i from 0<=i<self.Data.Nor:\n```\nCython understands `range()`.",
    "created_at": "2017-02-22T10:14:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314079",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

This is deprecated syntax:

```
for i from 0<=i<self.Data.Nor:
```
Cython understands `range()`.



---

archive/issue_comments_314080.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYou're not checking the result of this call:\n\n```\nd = <char*>sig_malloc(pickle_size)\n```\nyou can use instead\n\n```\nd = check_malloc(pickle_size)\n```",
    "created_at": "2017-02-22T10:15:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314080",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

You're not checking the result of this call:

```
d = <char*>sig_malloc(pickle_size)
```
you can use instead

```
d = check_malloc(pickle_size)
```



---

archive/issue_comments_314081.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWrong ticket:\n\n```\ndeprecation(12345, \"Reading this pickle may be machine dependent\")\n```",
    "created_at": "2017-02-22T10:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314081",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Wrong ticket:

```
deprecation(12345, "Reading this pickle may be machine dependent")
```



---

archive/issue_comments_314082.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThis function is not used nor tested anywhere:\n\n```\ncdef Matrix_t *rawMatrix(int Field, list entries) except NULL\n```",
    "created_at": "2017-02-22T10:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314082",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

This function is not used nor tested anywhere:

```
cdef Matrix_t *rawMatrix(int Field, list entries) except NULL
```



---

archive/issue_comments_314083.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplace\n\n```\n cdef extern from \"Python.h\":\n     object PyString_FromStringAndSize(char *s, Py_ssize_t len)\n     char* PyString_AsString(object string)\n```\nby\n\n```\nfrom cpython.bytes cimport PyBytes_FromStringAndSize, PyBytes_AsString\n```",
    "created_at": "2017-02-22T10:20:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314083",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replace

```
 cdef extern from "Python.h":
     object PyString_FromStringAndSize(char *s, Py_ssize_t len)
     char* PyString_AsString(object string)
```
by

```
from cpython.bytes cimport PyBytes_FromStringAndSize, PyBytes_AsString
```



---

archive/issue_comments_314084.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment:17):\n> Replying to [ticket:21437 SimonKing]:\n> > - MeatAxe executable rely on an environment variable declaring where to find multiplication tables.\n\n> \n> Are you sure? I thought this was handled by the `MtxLibDir` array?\n\nYes, I am sure. Setting the MtxLibDir variable in your programs works if your program calls mtx library functions. It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable. That's what the envirionment variable is for.",
    "created_at": "2017-02-22T10:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314084",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment:17):
> Replying to [ticket:21437 SimonKing]:
> > - MeatAxe executable rely on an environment variable declaring where to find multiplication tables.

> 
> Are you sure? I thought this was handled by the `MtxLibDir` array?

Yes, I am sure. Setting the MtxLibDir variable in your programs works if your program calls mtx library functions. It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable. That's what the envirionment variable is for.



---

archive/issue_comments_314085.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@simon-king-jena](#comment:23):\n> It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.\n\nAnd which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?\n\nYou could set them in `sage-env` where many similar variables are handled.",
    "created_at": "2017-02-22T10:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314085",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@simon-king-jena](#comment:23):
> It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.

And which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?

You could set them in `sage-env` where many similar variables are handled.



---

archive/issue_comments_314086.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment:24):\n> Replying to [@simon-king-jena](#comment:23):\n> > It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.\n\n> \n> And which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?\n\nMy modular group cohomology package does. It was made dysfunctional by changes in Sage, and my long-standing plan is to turn it into a new style package.",
    "created_at": "2017-02-22T10:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314086",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment:24):
> Replying to [@simon-king-jena](#comment:23):
> > It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.

> 
> And which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?

My modular group cohomology package does. It was made dysfunctional by changes in Sage, and my long-standing plan is to turn it into a new style package.



---

archive/issue_comments_314087.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@simon-king-jena](#comment:25):\n> My modular group cohomology package does.\n\nThen I think you should either deal with those environment variables in your package or in `sage-env`. But not in `src/sage/matrix/matrix_gfpn_dense.pyx` which has absolutely nothing to do with running meataxe executables.",
    "created_at": "2017-02-22T10:34:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314087",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@simon-king-jena](#comment:25):
> My modular group cohomology package does.

Then I think you should either deal with those environment variables in your package or in `sage-env`. But not in `src/sage/matrix/matrix_gfpn_dense.pyx` which has absolutely nothing to do with running meataxe executables.



---

archive/issue_comments_314088.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThere are also some very dubious uses of `sig_on()` in `src/sage/matrix/matrix_gfpn_dense.pyx`, but let's keep that for a different ticket.",
    "created_at": "2017-02-22T10:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314088",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

There are also some very dubious uses of `sig_on()` in `src/sage/matrix/matrix_gfpn_dense.pyx`, but let's keep that for a different ticket.



---

archive/issue_comments_314089.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIt seems that I forgot to import a couple of things: sig_malloc, sig_free.\n\nCurrently I am using sig_malloc and sig_free, but check_realloc.\nI wonder whether I use these functions correctly. Reading the code in cysignals: Do I see correctly that sig_* functions would not raise an error (so that I have to test whether they return NULL, in which case I have to raise my own error), whereas check_* would raise an error?",
    "created_at": "2017-07-08T12:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314089",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">comment:28</div>

It seems that I forgot to import a couple of things: sig_malloc, sig_free.

Currently I am using sig_malloc and sig_free, but check_realloc.
I wonder whether I use these functions correctly. Reading the code in cysignals: Do I see correctly that sig_* functions would not raise an error (so that I have to test whether they return NULL, in which case I have to raise my own error), whereas check_* would raise an error?



---

archive/issue_comments_314090.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@simon-king-jena](#comment:28):\n> Reading the code in cysignals: Do I see correctly that sig_* functions would not raise an error (so that I have to test whether they return NULL, in which case I have to raise my own error), whereas check_* would raise an error?\n\nYes: `sig_malloc` would just return `NULL` when an allocation failed while `check_allocarray` would `raise MemoryError`.",
    "created_at": "2017-07-08T12:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314090",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@simon-king-jena](#comment:28):
> Reading the code in cysignals: Do I see correctly that sig_* functions would not raise an error (so that I have to test whether they return NULL, in which case I have to raise my own error), whereas check_* would raise an error?

Yes: `sig_malloc` would just return `NULL` when an allocation failed while `check_allocarray` would `raise MemoryError`.



---

archive/issue_comments_314091.json:
```json
{
    "body": "Changed commit from **[`5ed2269`](https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0)** to **[`c929fcc`](https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff)**",
    "created_at": "2017-07-08T12:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314091",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5ed2269`](https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0)** to **[`c929fcc`](https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff)**



---

archive/issue_comments_314092.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6\">d4dc794</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce\">413e4a9</a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e\">d943f93</a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff\">c929fcc</a></td><td><code>Remove unused MTX* environment variables</code></td></tr></table>\n",
    "created_at": "2017-07-08T12:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314092",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6">d4dc794</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce">413e4a9</a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e">d943f93</a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff">c929fcc</a></td><td><code>Remove unused MTX* environment variables</code></td></tr></table>




---

archive/issue_comments_314093.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI think I have now addressed all your remarks, so, I put it back to \"needs review\".\n\nOne question, though. While building the code, I see one warning:\n\n```\n[sagelib-8.0.rc1] /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c: In function 'initmatrix_gfpn_dense':\n[sagelib-8.0.rc1] /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:19604:22: warning: passing argument 1 of 'MtxSetErrorHandler' from incompatible pointer type [-Wincompatible-pointer-types]\n[sagelib-8.0.rc1]    MtxSetErrorHandler(__pyx_f_4sage_6matrix_17matrix_gfpn_dense_ErrorHandler);\n[sagelib-8.0.rc1]                       ^\n[sagelib-8.0.rc1] In file included from /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:479:0:\n[sagelib-8.0.rc1] /home/king/Sage/git/sage/local/include/meataxe.h:371:20: note: expected 'void (*)(const MtxErrorRecord_t *) {aka void (*)(const struct <anonymous> *)}' but argument is of type 'void (*)(MtxErrorRecord_t *) {aka void (*)(struct <anonymous> *)}'\n[sagelib-8.0.rc1]  MtxErrorHandler_t *MtxSetErrorHandler(MtxErrorHandler_t *h);\n[sagelib-8.0.rc1]                     ^\n```\nHow could I fix that?",
    "created_at": "2017-07-08T12:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314093",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">comment:31</div>

I think I have now addressed all your remarks, so, I put it back to "needs review".

One question, though. While building the code, I see one warning:

```
[sagelib-8.0.rc1] /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c: In function 'initmatrix_gfpn_dense':
[sagelib-8.0.rc1] /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:19604:22: warning: passing argument 1 of 'MtxSetErrorHandler' from incompatible pointer type [-Wincompatible-pointer-types]
[sagelib-8.0.rc1]    MtxSetErrorHandler(__pyx_f_4sage_6matrix_17matrix_gfpn_dense_ErrorHandler);
[sagelib-8.0.rc1]                       ^
[sagelib-8.0.rc1] In file included from /home/king/Sage/git/sage/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:479:0:
[sagelib-8.0.rc1] /home/king/Sage/git/sage/local/include/meataxe.h:371:20: note: expected 'void (*)(const MtxErrorRecord_t *) {aka void (*)(const struct <anonymous> *)}' but argument is of type 'void (*)(MtxErrorRecord_t *) {aka void (*)(struct <anonymous> *)}'
[sagelib-8.0.rc1]  MtxErrorHandler_t *MtxSetErrorHandler(MtxErrorHandler_t *h);
[sagelib-8.0.rc1]                     ^
```
How could I fix that?



---

archive/issue_events_301166.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T12:57:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301166"
}
```



---

archive/issue_events_301167.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T12:57:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301167"
}
```



---

archive/issue_comments_314094.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment:27):\n> There are also some very dubious uses of `sig_on()` in `src/sage/matrix/matrix_gfpn_dense.pyx`, but let's keep that for a different ticket.\n\nWould you insist on a different ticket, or could I try to fix it here?",
    "created_at": "2017-07-08T13:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314094",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment:27):
> There are also some very dubious uses of `sig_on()` in `src/sage/matrix/matrix_gfpn_dense.pyx`, but let's keep that for a different ticket.

Would you insist on a different ticket, or could I try to fix it here?



---

archive/issue_comments_314095.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI guess in some places I also have to replace `cdef str` by `cdef bytes`...",
    "created_at": "2017-07-08T13:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314095",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">comment:33</div>

I guess in some places I also have to replace `cdef str` by `cdef bytes`...



---

archive/issue_events_301168.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T13:27:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301168"
}
```



---

archive/issue_events_301169.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T13:27:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301169"
}
```



---

archive/issue_comments_314096.json:
```json
{
    "body": "Changed commit from **[`c929fcc`](https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff)** to **[`b70bc5f`](https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681)**",
    "created_at": "2017-07-08T14:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314096",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c929fcc`](https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff)** to **[`b70bc5f`](https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681)**



---

archive/issue_comments_314097.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681\">b70bc5f</a></td><td><code>Change some str into bytes</code></td></tr></table>\n",
    "created_at": "2017-07-08T14:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314097",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681">b70bc5f</a></td><td><code>Change some str into bytes</code></td></tr></table>




---

archive/issue_comments_314098.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@simon-king-jena](#comment:33):\n> I guess in some places I also have to replace `cdef str` by `cdef bytes`...\n\nDone. But I think I should also have a look at the `sig_on()` thingy...",
    "created_at": "2017-07-08T14:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314098",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@simon-king-jena](#comment:33):
> I guess in some places I also have to replace `cdef str` by `cdef bytes`...

Done. But I think I should also have a look at the `sig_on()` thingy...



---

archive/issue_comments_314099.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nQuestion: By \"dubious use of sig_on\", do you mean stuff like the following?\n\n```\n                sig_on()\n                if nc%MPB:\n                    for i in range(nr):\n                        y = <unsigned char*>x\n                        for j in range(FfCurrentRowSizeIo-1):\n                            y[j] = randint()%O\n                        y[FfCurrentRowSizeIo-1] = randint()%(fl**(nc%MPB))\n                        FfStepPtr(&(x))\n                else:\n                    for i in range(nr):\n                        y = <unsigned char*>x\n                        for j in range(FfCurrentRowSizeIo):\n                            y[j] = randint()%O\n                        FfStepPtr(&(x))\n                sig_off()\n```\nSomewhere I was reading that sig_on/sig_off should be used if there are potentially long c commands, whereas in the code above (only very short commands are executed in tight loops) one should use sig_check.\n\nDid I describe the intended use of sig_* correctly?",
    "created_at": "2017-07-08T14:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314099",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:36" align="right">comment:36</div>

Question: By "dubious use of sig_on", do you mean stuff like the following?

```
                sig_on()
                if nc%MPB:
                    for i in range(nr):
                        y = <unsigned char*>x
                        for j in range(FfCurrentRowSizeIo-1):
                            y[j] = randint()%O
                        y[FfCurrentRowSizeIo-1] = randint()%(fl**(nc%MPB))
                        FfStepPtr(&(x))
                else:
                    for i in range(nr):
                        y = <unsigned char*>x
                        for j in range(FfCurrentRowSizeIo):
                            y[j] = randint()%O
                        FfStepPtr(&(x))
                sig_off()
```
Somewhere I was reading that sig_on/sig_off should be used if there are potentially long c commands, whereas in the code above (only very short commands are executed in tight loops) one should use sig_check.

Did I describe the intended use of sig_* correctly?



---

archive/issue_comments_314100.json:
```json
{
    "body": "Changed commit from **[`b70bc5f`](https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681)** to **[`04e7986`](https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa)**",
    "created_at": "2017-07-08T15:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314100",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b70bc5f`](https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681)** to **[`04e7986`](https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa)**



---

archive/issue_comments_314101.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa\">04e7986</a></td><td><code>Improve use of sig_on/off/check</code></td></tr></table>\n",
    "created_at": "2017-07-08T15:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314101",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa">04e7986</a></td><td><code>Improve use of sig_on/off/check</code></td></tr></table>




---

archive/issue_events_301170.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T15:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301170"
}
```



---

archive/issue_events_301171.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T15:41:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301171"
}
```



---

archive/issue_comments_314102.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@simon-king-jena](#comment:36):\n> Did I describe the intended use of sig_* correctly?\n\nI hope that the last commit did improve the situation.",
    "created_at": "2017-07-08T15:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314102",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@simon-king-jena](#comment:36):
> Did I describe the intended use of sig_* correctly?

I hope that the last commit did improve the situation.



---

archive/issue_comments_314103.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI hate git.\n\nMy plan was to merge this ticket with #23352 (from my point of view it doesn't matter what is merged into what).\n\nBut there is a merge conflict. Although #23352 only has a very small diff, git apparently reports conflicts all over the place. WTF? In #23352, we just have\n\n```diff\ndiff --git a/src/sage/matrix/matrix_gfpn_dense.pyx b/src/sage/matrix/matrix_gfpn_dense.pyx\nindex 7b5fac9..a5b4ecb 100644\n--- a/src/sage/matrix/matrix_gfpn_dense.pyx\n+++ b/src/sage/matrix/matrix_gfpn_dense.pyx\n@@ -703,6 +703,12 @@ cdef class Matrix_gfpn_dense(Matrix_dense):\n             [2*z^2 + 2*z + 2               0               0   2*z^2 + z + 2               0         2*z + 1]\n             [              0       2*z^2 + z               0               1               0   2*z^2 + z + 1]\n \n+        The following tests against a bug that was fixed in :trac:`23352`::\n+\n+            sage: MS = MatrixSpace(GF(9,'x'),1,5)\n+            sage: MS.random_element()     # optional: meataxe\n+            [x + 1     x     2 x + 2 x + 2]\n+\n         \"\"\"\n         self.check_mutability()\n         cdef int fl = self.Data.Field\n@@ -741,7 +747,8 @@ cdef class Matrix_gfpn_dense(Matrix_dense):\n                         y = <unsigned char*>x\n                         for j from 0 <= j < FfCurrentRowSizeIo-1:\n                             y[j] = randint()%O\n-                        y[FfCurrentRowSizeIo-1] = randint()%(fl**(nc%MPB))\n+                        for j from nc-(nc%MPB) <= j < nc:\n+                            FfInsert(x, j, FfFromInt( (randint()%fl) ))\n                         FfStepPtr(&(x))\n                 else:\n                     for i from 0 <= i < nr:\n```\nBy definition, we don't have conflicts in parts of the file that are untouched by the above diff!\n\nReally, I hate git.",
    "created_at": "2017-07-08T16:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314103",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:39" align="right">comment:39</div>

I hate git.

My plan was to merge this ticket with #23352 (from my point of view it doesn't matter what is merged into what).

But there is a merge conflict. Although #23352 only has a very small diff, git apparently reports conflicts all over the place. WTF? In #23352, we just have

```diff
diff --git a/src/sage/matrix/matrix_gfpn_dense.pyx b/src/sage/matrix/matrix_gfpn_dense.pyx
index 7b5fac9..a5b4ecb 100644
--- a/src/sage/matrix/matrix_gfpn_dense.pyx
+++ b/src/sage/matrix/matrix_gfpn_dense.pyx
@@ -703,6 +703,12 @@ cdef class Matrix_gfpn_dense(Matrix_dense):
             [2*z^2 + 2*z + 2               0               0   2*z^2 + z + 2               0         2*z + 1]
             [              0       2*z^2 + z               0               1               0   2*z^2 + z + 1]
 
+        The following tests against a bug that was fixed in :trac:`23352`::
+
+            sage: MS = MatrixSpace(GF(9,'x'),1,5)
+            sage: MS.random_element()     # optional: meataxe
+            [x + 1     x     2 x + 2 x + 2]
+
         """
         self.check_mutability()
         cdef int fl = self.Data.Field
@@ -741,7 +747,8 @@ cdef class Matrix_gfpn_dense(Matrix_dense):
                         y = <unsigned char*>x
                         for j from 0 <= j < FfCurrentRowSizeIo-1:
                             y[j] = randint()%O
-                        y[FfCurrentRowSizeIo-1] = randint()%(fl**(nc%MPB))
+                        for j from nc-(nc%MPB) <= j < nc:
+                            FfInsert(x, j, FfFromInt( (randint()%fl) ))
                         FfStepPtr(&(x))
                 else:
                     for i from 0 <= i < nr:
```
By definition, we don't have conflicts in parts of the file that are untouched by the above diff!

Really, I hate git.



---

archive/issue_comments_314104.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jdemeyer](#comment:24):\n> Replying to [@simon-king-jena](#comment:23):\n> > It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.\n\n> \n> And which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?\n> \n> You could set them in `sage-env` where many similar variables are handled.\n\nWorking on #18514, I found that the situation is confusing for me.\n\nMy plan was:\n\n- With the current code from here and #23352, `sage.matrix.matrix_gfpn_dense` overrides the MtxLibDir variable that is declared in `sage.libs.meataxe`, but it doesn't touch the environment variables.\n- The cohomology code cimports MtxLibDir from `sage.matrix.matrix_gfpn_dense` and reads its content. It is then also written into an environment variable, so that the MTX-executables can find the multiplication tables.\n\nThe reality is:\n\n- When the cohomology code cimports MtxLibDir, its content is a certain location in `/usr/local/`, which is where the multiplication tables can NOT be found. Thus, any computation crashes.\n\nIf I recall correctly, the reason for the bad behaviour is the fact that the meataxe library is a dynamic, not a static, library. Hence, any Cython module and any C program using meataxe has to define MtxLibDir explicitly: Cimporting it won't suffice.",
    "created_at": "2017-07-08T21:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314104",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jdemeyer](#comment:24):
> Replying to [@simon-king-jena](#comment:23):
> > It will not work when you call a meataxe executable that does *not* set the MtxLibDir variable.

> 
> And which part of `src/sage/matrix/matrix_gfpn_dense.pyx` calls a meataxe executable?
> 
> You could set them in `sage-env` where many similar variables are handled.

Working on #18514, I found that the situation is confusing for me.

My plan was:

- With the current code from here and #23352, `sage.matrix.matrix_gfpn_dense` overrides the MtxLibDir variable that is declared in `sage.libs.meataxe`, but it doesn't touch the environment variables.
- The cohomology code cimports MtxLibDir from `sage.matrix.matrix_gfpn_dense` and reads its content. It is then also written into an environment variable, so that the MTX-executables can find the multiplication tables.

The reality is:

- When the cohomology code cimports MtxLibDir, its content is a certain location in `/usr/local/`, which is where the multiplication tables can NOT be found. Thus, any computation crashes.

If I recall correctly, the reason for the bad behaviour is the fact that the meataxe library is a dynamic, not a static, library. Hence, any Cython module and any C program using meataxe has to define MtxLibDir explicitly: Cimporting it won't suffice.



---

archive/issue_comments_314105.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThe following would work:\n\n- Define MtxLibDir in sage.matrix.matrix_gfpn_dense.\n- Use a copy, say, `_MtxLibDr`\n- As it turns out, when cimporting `_MtxLibDir`, one gets the correct value. Hence, one uses `_MtxLibDir` to override MtxLibDir in any module that uses the meataxe library.\n\nDo you agree to add `_MtxLibDir` in this ticket, although I will only need it in #18514?",
    "created_at": "2017-07-08T22:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314105",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:41" align="right">comment:41</div>

The following would work:

- Define MtxLibDir in sage.matrix.matrix_gfpn_dense.
- Use a copy, say, `_MtxLibDr`
- As it turns out, when cimporting `_MtxLibDir`, one gets the correct value. Hence, one uses `_MtxLibDir` to override MtxLibDir in any module that uses the meataxe library.

Do you agree to add `_MtxLibDir` in this ticket, although I will only need it in #18514?



---

archive/issue_comments_314106.json:
```json
{
    "body": "Changed commit from **[`04e7986`](https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa)** to **[`6a65600`](https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4)**",
    "created_at": "2017-07-08T22:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314106",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04e7986`](https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa)** to **[`6a65600`](https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4)**



---

archive/issue_comments_314107.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4\">6a65600</a></td><td><code>Use a fixed copy of MtxLibDir</code></td></tr></table>\n",
    "created_at": "2017-07-08T22:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314107",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4">6a65600</a></td><td><code>Use a fixed copy of MtxLibDir</code></td></tr></table>




---

archive/issue_comments_314108.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@simon-king-jena](#comment:41):\n> Do you agree to add `_MtxLibDir` in this ticket, although I will only need it in #18514?\n\n... as in the latest commit.",
    "created_at": "2017-07-08T22:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314108",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@simon-king-jena](#comment:41):
> Do you agree to add `_MtxLibDir` in this ticket, although I will only need it in #18514?

... as in the latest commit.



---

archive/issue_comments_314109.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@simon-king-jena](#comment:36):\n> Question: By \"dubious use of sig_on\", do you mean stuff like the following?\n\nNot quite, that example is acceptable, although you certainly could `sig_check()` there. I meant cases where *Python* code is inside `sig_on()` blocks, which shouldn't be done.",
    "created_at": "2017-07-10T07:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314109",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@simon-king-jena](#comment:36):
> Question: By "dubious use of sig_on", do you mean stuff like the following?

Not quite, that example is acceptable, although you certainly could `sig_check()` there. I meant cases where *Python* code is inside `sig_on()` blocks, which shouldn't be done.



---

archive/issue_comments_314110.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nConcerning `MtxLibDir`: I think that part of the problem comes from insufficient separation between (1) the MeatAxe library and (2) the implementation of matrices using MeatAxe.\n\nThings like dealing with the `MtxLibDir` and also the error handler really have nothing to do with matrices and should be moved to `src/sage/libs/meataxe.pyx`. If you set `MtxLibDir` in `src/sage/libs/meataxe.pyx` and you `import sage.libs.meataxe`, then that should work too and it's a much cleaner solution.",
    "created_at": "2017-07-10T07:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314110",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Concerning `MtxLibDir`: I think that part of the problem comes from insufficient separation between (1) the MeatAxe library and (2) the implementation of matrices using MeatAxe.

Things like dealing with the `MtxLibDir` and also the error handler really have nothing to do with matrices and should be moved to `src/sage/libs/meataxe.pyx`. If you set `MtxLibDir` in `src/sage/libs/meataxe.pyx` and you `import sage.libs.meataxe`, then that should work too and it's a much cleaner solution.



---

archive/issue_comments_314111.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@jdemeyer](#comment:45):\n> Concerning `MtxLibDir`: I think that part of the problem comes from insufficient separation between (1) the MeatAxe library and (2) the implementation of matrices using MeatAxe.\n> \n> Things like dealing with the `MtxLibDir` and also the error handler really have nothing to do with matrices and should be moved to `src/sage/libs/meataxe.pyx`. If you set `MtxLibDir` in `src/sage/libs/meataxe.pyx` and you `import sage.libs.meataxe`, then that should work too and it's a much cleaner solution.\n\nOK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`), and it also means that I need to import, right? \"cimport\" wouldn't suffice?",
    "created_at": "2017-07-10T08:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314111",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@jdemeyer](#comment:45):
> Concerning `MtxLibDir`: I think that part of the problem comes from insufficient separation between (1) the MeatAxe library and (2) the implementation of matrices using MeatAxe.
> 
> Things like dealing with the `MtxLibDir` and also the error handler really have nothing to do with matrices and should be moved to `src/sage/libs/meataxe.pyx`. If you set `MtxLibDir` in `src/sage/libs/meataxe.pyx` and you `import sage.libs.meataxe`, then that should work too and it's a much cleaner solution.

OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`), and it also means that I need to import, right? "cimport" wouldn't suffice?



---

archive/issue_comments_314112.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@jdemeyer](#comment:44):\n> Replying to [@simon-king-jena](#comment:36):\n> > Question: By \"dubious use of sig_on\", do you mean stuff like the following?\n\n> \n> Not quite, that example is acceptable, although you certainly could `sig_check()` there. I meant cases where *Python* code is inside `sig_on()` blocks, which shouldn't be done.\n\nI think I have removed all such cases. `sig_on()` now only appears three times in the code, namely\n\n```python\n        sig_on()\n        OUT.Data = MatDup(self.Data)\n        MatMul(OUT.Data,right.Data)\n        sig_off()\n```\n\n```python\n        sig_on()\n        MatMulStrassen(OUT.Data, self.Data, right.Data)\n        sig_off()\n```\n\n```python\n        sig_on()\n        try:\n            OUT.Data = MatInverse(self.Data)\n        except ZeroDivisionError:\n            sig_off()\n            raise\n        sig_off()\n```\nIt doesn't involve python code, right?",
    "created_at": "2017-07-10T08:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314112",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@jdemeyer](#comment:44):
> Replying to [@simon-king-jena](#comment:36):
> > Question: By "dubious use of sig_on", do you mean stuff like the following?

> 
> Not quite, that example is acceptable, although you certainly could `sig_check()` there. I meant cases where *Python* code is inside `sig_on()` blocks, which shouldn't be done.

I think I have removed all such cases. `sig_on()` now only appears three times in the code, namely

```python
        sig_on()
        OUT.Data = MatDup(self.Data)
        MatMul(OUT.Data,right.Data)
        sig_off()
```

```python
        sig_on()
        MatMulStrassen(OUT.Data, self.Data, right.Data)
        sig_off()
```

```python
        sig_on()
        try:
            OUT.Data = MatInverse(self.Data)
        except ZeroDivisionError:
            sig_off()
            raise
        sig_off()
```
It doesn't involve python code, right?



---

archive/issue_comments_314113.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThe error handler involves Python code. So to be extra-safe, it would be better to surround the call to `PyErr_SetObject` with `sig_block()`/`sig_unblock()`.\n\nPS: 12437 is still not the correct Trac ticket.",
    "created_at": "2017-07-10T09:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314113",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

The error handler involves Python code. So to be extra-safe, it would be better to surround the call to `PyErr_SetObject` with `sig_block()`/`sig_unblock()`.

PS: 12437 is still not the correct Trac ticket.



---

archive/issue_comments_314114.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@simon-king-jena](#comment:46):\n> OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)\n\nYes, that is what I meant.\n\n> and it also means that I need to import, right? \"cimport\" wouldn't suffice?\n\nYes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).",
    "created_at": "2017-07-10T09:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314114",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@simon-king-jena](#comment:46):
> OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)

Yes, that is what I meant.

> and it also means that I need to import, right? "cimport" wouldn't suffice?

Yes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).



---

archive/issue_comments_314115.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\n[comment:22] has not been addressed",
    "created_at": "2017-07-10T09:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314115",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

[comment:22] has not been addressed



---

archive/issue_comments_314116.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@jdemeyer](#comment:49):\n> Replying to [@simon-king-jena](#comment:46):\n> > OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)\n\n> \n> Yes, that is what I meant.\n> \n> > and it also means that I need to import, right? \"cimport\" wouldn't suffice?\n\n> \n> Yes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).\n\nNo, it doesn't work. Apparently each cython module that is linked against the dynamic meataxe library needs to do the assignment of MtxLibDir and also needs to fix the error handler.\n\nAnd [comment:22](#comment:22) *has* been addressed. There is no `PyString` in the files.",
    "created_at": "2017-07-10T10:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314116",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@jdemeyer](#comment:49):
> Replying to [@simon-king-jena](#comment:46):
> > OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)

> 
> Yes, that is what I meant.
> 
> > and it also means that I need to import, right? "cimport" wouldn't suffice?

> 
> Yes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).

No, it doesn't work. Apparently each cython module that is linked against the dynamic meataxe library needs to do the assignment of MtxLibDir and also needs to fix the error handler.

And [comment:22](#comment:22) *has* been addressed. There is no `PyString` in the files.



---

archive/issue_comments_314117.json:
```json
{
    "body": "<div id=\"comment:52\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2\">67a85ca</a></td><td><code>Move meataxe definitions from sage.matrix to sage.libs</code></td></tr></table>\n",
    "created_at": "2017-07-10T10:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314117",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:52"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2">67a85ca</a></td><td><code>Move meataxe definitions from sage.matrix to sage.libs</code></td></tr></table>




---

archive/issue_comments_314118.json:
```json
{
    "body": "Changed commit from **[`6a65600`](https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4)** to **[`67a85ca`](https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2)**",
    "created_at": "2017-07-10T10:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314118",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6a65600`](https://github.com/sagemath/sagetrac-mirror/commit/6a656002aa7d09470707becdb73df00721024fb4)** to **[`67a85ca`](https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2)**



---

archive/issue_comments_314119.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nSorry, I meant replacing\n\n```\ncdef extern from \"Python.h\":\n    char* PyBytes_AsString(object string)\n```\nby\n\n```\nfrom cpython.bytes cimport PyBytes_AsString\n```\nNote also that Cython can auto-convert between `bytes` and `char*`, so this function might not be needed at all.",
    "created_at": "2017-07-10T10:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314119",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

Sorry, I meant replacing

```
cdef extern from "Python.h":
    char* PyBytes_AsString(object string)
```
by

```
from cpython.bytes cimport PyBytes_AsString
```
Note also that Cython can auto-convert between `bytes` and `char*`, so this function might not be needed at all.



---

archive/issue_comments_314120.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@simon-king-jena](#comment:51):\n> Replying to [@jdemeyer](#comment:49):\n> > Replying to [@simon-king-jena](#comment:46):\n> > > OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)\n\n> > \n> > Yes, that is what I meant.\n> > \n> > > and it also means that I need to import, right? \"cimport\" wouldn't suffice?\n\n> > \n> > Yes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).\n\n> \n> No, it doesn't work. Apparently each cython module that is linked against the dynamic meataxe library needs to do the assignment of MtxLibDir and also needs to fix the error handler.\n\nExample, with the latest commit:\n\n```\nsage: M = random_matrix(GF(81,'x'),1000)\nMTX location /usr/local/mtx/lib\nos.c(254):p081.zzz: No such file or directory\n```\nwhich is an unhandled crash. So, both MtxLibDir is not visible for `sage.matrix.matrix_gfpn_dense` (otherwise meataxe would find the multiplication table) and the error handler is not defined (otherwise it would raise an error rather than crash).\n\nHow can this be overcome?",
    "created_at": "2017-07-10T10:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314120",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@simon-king-jena](#comment:51):
> Replying to [@jdemeyer](#comment:49):
> > Replying to [@simon-king-jena](#comment:46):
> > > OK, but it means that I need to add a new module (currently, there is only the pxd file `src/sage/libs/meataxe.pxd`)

> > 
> > Yes, that is what I meant.
> > 
> > > and it also means that I need to import, right? "cimport" wouldn't suffice?

> > 
> > Yes, I think so. You need `import sage.libs.meataxe` (there is nothing you need to import from that, but you need to ensure that the module is loaded).

> 
> No, it doesn't work. Apparently each cython module that is linked against the dynamic meataxe library needs to do the assignment of MtxLibDir and also needs to fix the error handler.

Example, with the latest commit:

```
sage: M = random_matrix(GF(81,'x'),1000)
MTX location /usr/local/mtx/lib
os.c(254):p081.zzz: No such file or directory
```
which is an unhandled crash. So, both MtxLibDir is not visible for `sage.matrix.matrix_gfpn_dense` (otherwise meataxe would find the multiplication table) and the error handler is not defined (otherwise it would raise an error rather than crash).

How can this be overcome?



---

archive/issue_events_301172.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T10:26:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301172"
}
```



---

archive/issue_events_301173.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T10:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301173"
}
```



---

archive/issue_comments_314121.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@simon-king-jena](#comment:54):\n> ... So, both MtxLibDir is not visible for `sage.matrix.matrix_gfpn_dense` (otherwise meataxe would find the multiplication table) and the error handler is not defined (otherwise it would raise an error rather than crash).\n> \n> How can this be overcome?\n\nBy this, I mean: We have modules A,B,C, and A is supposed to do some initialisation to a dynamic library that A, B and C link against. Is it possible to make it so that \"import A\" in B and C automatically executes code that will do the initialisation in B resp. in C rather than only in A?\n\nHere, we have A=sage.libs.meataxe, B=sage.matrix.matrix_gfpn_dense and C=the cohomology code from #18514",
    "created_at": "2017-07-10T10:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314121",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@simon-king-jena](#comment:54):
> ... So, both MtxLibDir is not visible for `sage.matrix.matrix_gfpn_dense` (otherwise meataxe would find the multiplication table) and the error handler is not defined (otherwise it would raise an error rather than crash).
> 
> How can this be overcome?

By this, I mean: We have modules A,B,C, and A is supposed to do some initialisation to a dynamic library that A, B and C link against. Is it possible to make it so that "import A" in B and C automatically executes code that will do the initialisation in B resp. in C rather than only in A?

Here, we have A=sage.libs.meataxe, B=sage.matrix.matrix_gfpn_dense and C=the cohomology code from #18514



---

archive/issue_comments_314122.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nA potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.\n\nHowever, that sounds like an ugly hack.",
    "created_at": "2017-07-10T11:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314122",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:57" align="right">comment:57</div>

A potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.

However, that sounds like an ugly hack.



---

archive/issue_comments_314123.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@simon-king-jena](#comment:40):\n> If I recall correctly, the reason for the bad behaviour is the fact that the meataxe library is a dynamic, not a static, library.\n\nYou're swapping \"static\" and \"dynamic\" but otherwise you are right: the problem with static libraries is that each Cython module gets its own \"copy\" of the static library.",
    "created_at": "2017-07-10T11:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314123",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@simon-king-jena](#comment:40):
> If I recall correctly, the reason for the bad behaviour is the fact that the meataxe library is a dynamic, not a static, library.

You're swapping "static" and "dynamic" but otherwise you are right: the problem with static libraries is that each Cython module gets its own "copy" of the static library.



---

archive/issue_comments_314124.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nLooking at the MeatAxe `Makefile`, there is no support for building as dynamic library.",
    "created_at": "2017-07-10T11:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314124",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

Looking at the MeatAxe `Makefile`, there is no support for building as dynamic library.



---

archive/issue_comments_314125.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jdemeyer](#comment:59):\n> Looking at the MeatAxe `Makefile`, there is no support for building as dynamic library.\n\nWould it be difficult to add support? After all, we are patching meataxe anyway.",
    "created_at": "2017-07-10T11:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314125",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jdemeyer](#comment:59):
> Looking at the MeatAxe `Makefile`, there is no support for building as dynamic library.

Would it be difficult to add support? After all, we are patching meataxe anyway.



---

archive/issue_comments_314126.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@simon-king-jena](#comment:60):\n> Would it be difficult to add support? After all, we are patching meataxe anyway.\n\nInstead of \"adding support\", I would prefer to rewrite the build system to use autotools. Probably not hard, but not fun either.",
    "created_at": "2017-07-10T11:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314126",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@simon-king-jena](#comment:60):
> Would it be difficult to add support? After all, we are patching meataxe anyway.

Instead of "adding support", I would prefer to rewrite the build system to use autotools. Probably not hard, but not fun either.



---

archive/issue_comments_314127.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@simon-king-jena](#comment:57):\n> A potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.\n\nHere is a better idea: in `meataxe.pxd`, define an inline function\n\n```\ncdef inline init_meataxe():\n    # set up MtxLibDir and error handler\n```\nThen you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.",
    "created_at": "2017-07-10T11:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314127",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@simon-king-jena](#comment:57):
> A potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.

Here is a better idea: in `meataxe.pxd`, define an inline function

```
cdef inline init_meataxe():
    # set up MtxLibDir and error handler
```
Then you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.



---

archive/issue_comments_314128.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jdemeyer](#comment:62):\n> Replying to [@simon-king-jena](#comment:57):\n> > A potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.\n\n> \n> Here is a better idea: in `meataxe.pxd`, define an inline function\n> \n> ```\n> cdef inline init_meataxe():\n>     # set up MtxLibDir and error handler\n> ```\n> Then you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.\n\nLet's see if it works. I did the same with a function defined in sage.libs.meataxe.pyx (that I added only for that purpose), and it did not work.",
    "created_at": "2017-07-10T11:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314128",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jdemeyer](#comment:62):
> Replying to [@simon-king-jena](#comment:57):
> > A potential solution would be to write `sage.libs.meataxe.pxi`, and then include the .pxi file rather than cimport.

> 
> Here is a better idea: in `meataxe.pxd`, define an inline function
> 
> ```
> cdef inline init_meataxe():
>     # set up MtxLibDir and error handler
> ```
> Then you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.

Let's see if it works. I did the same with a function defined in sage.libs.meataxe.pyx (that I added only for that purpose), and it did not work.



---

archive/issue_comments_314129.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@simon-king-jena](#comment:63):\n> Let's see if it works. I did the same with a function defined in sage.libs.meataxe.pyx (that I added only for that purpose), and it did not work.\n\nThe difference between an *inline* function and a regular function is crucial here.",
    "created_at": "2017-07-10T11:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314129",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@simon-king-jena](#comment:63):
> Let's see if it works. I did the same with a function defined in sage.libs.meataxe.pyx (that I added only for that purpose), and it did not work.

The difference between an *inline* function and a regular function is crucial here.



---

archive/issue_comments_314130.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@simon-king-jena](#comment:63):\n> > Here is a better idea: in `meataxe.pxd`, define an inline function\n> > \n> > ```\n> > cdef inline init_meataxe():\n> >     # set up MtxLibDir and error handler\n> > ```\n> > Then you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.\n\nDoesn't work. At least not when I do the following:\n\nIn sage/libs/meataxe.pxd\n\n```python\ncdef inline meataxe_init():\n    ## Define an environment variable that enables MeatAxe to find\n    ## its multiplication tables.\n    from sage.env import DOT_SAGE\n    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))\n```\nIn sage/matrix/matrix_gfpn_dense.pyx:\n\n```python\nprint(\"MTX location\", MtxLibDir)\nmeataxe_init()\nprint(\"New location\", MtxLibDir)\n```\nBefore and after calling meataxe_init() I get the same wrong location.",
    "created_at": "2017-07-10T12:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314130",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@simon-king-jena](#comment:63):
> > Here is a better idea: in `meataxe.pxd`, define an inline function
> > 
> > ```
> > cdef inline init_meataxe():
> >     # set up MtxLibDir and error handler
> > ```
> > Then you just need to call `init_meataxe()` in the module(s) where you want to use MeatAxe.

Doesn't work. At least not when I do the following:

In sage/libs/meataxe.pxd

```python
cdef inline meataxe_init():
    ## Define an environment variable that enables MeatAxe to find
    ## its multiplication tables.
    from sage.env import DOT_SAGE
    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))
```
In sage/matrix/matrix_gfpn_dense.pyx:

```python
print("MTX location", MtxLibDir)
meataxe_init()
print("New location", MtxLibDir)
```
Before and after calling meataxe_init() I get the same wrong location.



---

archive/issue_comments_314131.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI guess the problem is the import statement in the \"cdef inline\" function. IIRC, \"inline\" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.",
    "created_at": "2017-07-10T12:09:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314131",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:66" align="right">comment:66</div>

I guess the problem is the import statement in the "cdef inline" function. IIRC, "inline" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.



---

archive/issue_comments_314132.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@simon-king-jena](#comment:65):\n> \n> ```python\n> cdef inline meataxe_init():\n>     ## Define an environment variable that enables MeatAxe to find\n>     ## its multiplication tables.\n>     from sage.env import DOT_SAGE\n>     MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))\n> ```\n\nThat's a beginner Python bug :-)\n\nYou need `global MtxLibDir` otherwise `MtxLibDir` will be treated as local variable.",
    "created_at": "2017-07-10T12:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314132",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@simon-king-jena](#comment:65):
> 
> ```python
> cdef inline meataxe_init():
>     ## Define an environment variable that enables MeatAxe to find
>     ## its multiplication tables.
>     from sage.env import DOT_SAGE
>     MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))
> ```

That's a beginner Python bug :-)

You need `global MtxLibDir` otherwise `MtxLibDir` will be treated as local variable.



---

archive/issue_comments_314133.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@simon-king-jena](#comment:66):\n> I guess the problem is the import statement in the \"cdef inline\" function. IIRC, \"inline\" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.\n\nNo, this is about the **Cython** interpretation of `inline`. Whether the **C** compiler inlines it or not is irrelevant.",
    "created_at": "2017-07-10T12:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314133",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@simon-king-jena](#comment:66):
> I guess the problem is the import statement in the "cdef inline" function. IIRC, "inline" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.

No, this is about the **Cython** interpretation of `inline`. Whether the **C** compiler inlines it or not is irrelevant.



---

archive/issue_comments_314134.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@jdemeyer](#comment:68):\n> Replying to [@simon-king-jena](#comment:66):\n> > I guess the problem is the import statement in the \"cdef inline\" function. IIRC, \"inline\" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.\n\n> \n> No, this is about the **Cython** interpretation of `inline`. Whether the **C** compiler inlines it or not is irrelevant.\n\nAnyway, it doesn't work.",
    "created_at": "2017-07-10T12:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314134",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@jdemeyer](#comment:68):
> Replying to [@simon-king-jena](#comment:66):
> > I guess the problem is the import statement in the "cdef inline" function. IIRC, "inline" is only a hint for the compiler, not a strict order. And apparently the compiler decided to not inline it.

> 
> No, this is about the **Cython** interpretation of `inline`. Whether the **C** compiler inlines it or not is irrelevant.

Anyway, it doesn't work.



---

archive/issue_comments_314135.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@jdemeyer](#comment:67):\n> Replying to [@simon-king-jena](#comment:65):\n> > \n> > ```python\n> > cdef inline meataxe_init():\n> >     ## Define an environment variable that enables MeatAxe to find\n> >     ## its multiplication tables.\n> >     from sage.env import DOT_SAGE\n> >     MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))\n> > ```\n\nIn the same pxd file:\n\n```\n    cdef extern char MtxLibDir[1024]    # Where to search/create multiplication tables\n```\nIs \"global\" needed, then?\n> That's a beginner Python bug :-)\n> \n> You need `global MtxLibDir` otherwise `MtxLibDir` will be treated as local variable.",
    "created_at": "2017-07-10T12:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314135",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@jdemeyer](#comment:67):
> Replying to [@simon-king-jena](#comment:65):
> > 
> > ```python
> > cdef inline meataxe_init():
> >     ## Define an environment variable that enables MeatAxe to find
> >     ## its multiplication tables.
> >     from sage.env import DOT_SAGE
> >     MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))
> > ```

In the same pxd file:

```
    cdef extern char MtxLibDir[1024]    # Where to search/create multiplication tables
```
Is "global" needed, then?
> That's a beginner Python bug :-)
> 
> You need `global MtxLibDir` otherwise `MtxLibDir` will be treated as local variable.



---

archive/issue_comments_314136.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@simon-king-jena](#comment:70):\n> Is \"global\" needed, then?\n\nYes. The rules for global/local variables in Cython are exactly the same as for Python.",
    "created_at": "2017-07-10T12:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314136",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@simon-king-jena](#comment:70):
> Is "global" needed, then?

Yes. The rules for global/local variables in Cython are exactly the same as for Python.



---

archive/issue_comments_314137.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nThe following doesn't work either:\n\n```\ncdef inline meataxe_init():\n    ## Define an environment variable that enables MeatAxe to find\n    ## its multiplication tables.\n    global MtxLibDir\n    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))\n    ## Error handling for MeatAxe, to prevent immediate exit of the program\n    MtxSetErrorHandler(ErrorHandler)\n```\n\nHere, I have moved the definition into a pyx file, where I do all the python imports and also the definition of a the dictionary that is used in the ErrorHandler --- am I right that it would be problematic to define the dictionary in a pxd file?",
    "created_at": "2017-07-10T12:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314137",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:72" align="right">comment:72</div>

The following doesn't work either:

```
cdef inline meataxe_init():
    ## Define an environment variable that enables MeatAxe to find
    ## its multiplication tables.
    global MtxLibDir
    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))
    ## Error handling for MeatAxe, to prevent immediate exit of the program
    MtxSetErrorHandler(ErrorHandler)
```

Here, I have moved the definition into a pyx file, where I do all the python imports and also the definition of a the dictionary that is used in the ErrorHandler --- am I right that it would be problematic to define the dictionary in a pxd file?



---

archive/issue_comments_314138.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@simon-king-jena](#comment:72):\n> Here, I have moved the definition into a pyx file\n\nDon't! This **MUST** be inline and it **MUST** be in the `.pxd` file.",
    "created_at": "2017-07-10T12:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314138",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@simon-king-jena](#comment:72):
> Here, I have moved the definition into a pyx file

Don't! This **MUST** be inline and it **MUST** be in the `.pxd` file.



---

archive/issue_comments_314139.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@simon-king-jena](#comment:72):\n> am I right that it would be problematic to define the dictionary in a pxd file?\n\nProbably yes. You can move the error handler itself to the `.pyx` file but the call `MtxSetErrorHandler` in `init_meataxe()` in the `.pxd` file. Something like:\n\n```\ncdef void ErrorHandler(...)\n\ncdef inline meataxe_init():\n    ## Define an environment variable that enables MeatAxe to find\n    ## its multiplication tables.\n    global MtxLibDir\n    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))\n    ## Error handling for MeatAxe, to prevent immediate exit of the program\n    MtxSetErrorHandler(ErrorHandler)\n```",
    "created_at": "2017-07-10T12:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314139",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@simon-king-jena](#comment:72):
> am I right that it would be problematic to define the dictionary in a pxd file?

Probably yes. You can move the error handler itself to the `.pyx` file but the call `MtxSetErrorHandler` in `init_meataxe()` in the `.pxd` file. Something like:

```
cdef void ErrorHandler(...)

cdef inline meataxe_init():
    ## Define an environment variable that enables MeatAxe to find
    ## its multiplication tables.
    global MtxLibDir
    MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE,'meataxe'))
    ## Error handling for MeatAxe, to prevent immediate exit of the program
    MtxSetErrorHandler(ErrorHandler)
```



---

archive/issue_comments_314140.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nReplying to [@jdemeyer](#comment:74):\n> Replying to [@simon-king-jena](#comment:72):\n> > am I right that it would be problematic to define the dictionary in a pxd file?\n\n> \n> Probably yes. You can move the error handler itself to the `.pyx` file but the call `MtxSetErrorHandler` in `init_meataxe()` in the `.pxd` file.\n\nHooray, that seems to work!",
    "created_at": "2017-07-10T12:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314140",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:75" align="right">comment:75</div>

Replying to [@jdemeyer](#comment:74):
> Replying to [@simon-king-jena](#comment:72):
> > am I right that it would be problematic to define the dictionary in a pxd file?

> 
> Probably yes. You can move the error handler itself to the `.pyx` file but the call `MtxSetErrorHandler` in `init_meataxe()` in the `.pxd` file.

Hooray, that seems to work!



---

archive/issue_comments_314141.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nBTW: I would change the name `ErrorHandler` to something more descriptive, like `sage_meataxe_error_handler` or something.",
    "created_at": "2017-07-10T12:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314141",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:76" align="right">comment:76</div>

BTW: I would change the name `ErrorHandler` to something more descriptive, like `sage_meataxe_error_handler` or something.



---

archive/issue_comments_314142.json:
```json
{
    "body": "Changed commit from **[`67a85ca`](https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2)** to **[`353a8b9`](https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39)**",
    "created_at": "2017-07-10T12:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`67a85ca`](https://github.com/sagemath/sagetrac-mirror/commit/67a85cac583d788617b45f5765e0b21498d8b3c2)** to **[`353a8b9`](https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39)**



---

archive/issue_comments_314143.json:
```json
{
    "body": "<div id=\"comment:77\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39\">353a8b9</a></td><td><code>meataxe_init() inline function</code></td></tr></table>\n",
    "created_at": "2017-07-10T12:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:77"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39">353a8b9</a></td><td><code>meataxe_init() inline function</code></td></tr></table>




---

archive/issue_comments_314144.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nAm I right in guessing that I shouldn't simplify the git history of this ticket? After all, there are commits that just revert what previous commits have done.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39\">353a8b9</a></td><td><code>meataxe_init() inline function</code></td></tr></table>\n",
    "created_at": "2017-07-10T12:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314144",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:78" align="right">comment:78</div>

Am I right in guessing that I shouldn't simplify the git history of this ticket? After all, there are commits that just revert what previous commits have done.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39">353a8b9</a></td><td><code>meataxe_init() inline function</code></td></tr></table>




---

archive/issue_comments_314145.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821\">08e03c2</a></td><td><code>Change ErrorHandler into sage_meataxe_error_handler</code></td></tr></table>\n",
    "created_at": "2017-07-10T13:01:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314145",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821">08e03c2</a></td><td><code>Change ErrorHandler into sage_meataxe_error_handler</code></td></tr></table>




---

archive/issue_comments_314146.json:
```json
{
    "body": "Changed commit from **[`353a8b9`](https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39)** to **[`08e03c2`](https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821)**",
    "created_at": "2017-07-10T13:01:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314146",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`353a8b9`](https://github.com/sagemath/sagetrac-mirror/commit/353a8b9630ba675342297d9058a38acb1879df39)** to **[`08e03c2`](https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821)**



---

archive/issue_events_301174.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T13:01:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301174"
}
```



---

archive/issue_events_301175.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T13:01:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301175"
}
```



---

archive/issue_comments_314147.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nReplying to [@simon-king-jena](#comment:78):\n> Am I right in guessing that I shouldn't simplify the git history of this ticket?\n\nIt depends mainly on whether you think that somebody else is building on top of your branch here. I guess chances are very small , so you could simplify the git history. Just keep in mind #23352.",
    "created_at": "2017-07-10T13:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314147",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:81" align="right">comment:81</div>

Replying to [@simon-king-jena](#comment:78):
> Am I right in guessing that I shouldn't simplify the git history of this ticket?

It depends mainly on whether you think that somebody else is building on top of your branch here. I guess chances are very small , so you could simplify the git history. Just keep in mind #23352.



---

archive/issue_comments_314148.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nFor Python 3 compatibility, it would be good to add\n\n```\nfrom __future__ import absolute_import, division\n```\nin `src/sage/matrix/matrix_gfpn_dense.pyx`\n\nThen you should also use floor division if that's what you want, for example here:\n\n```\ncdef size_t pickled_rowsize = len(Data)/nr\n```\nThere might be other such places too, I have not checked.",
    "created_at": "2017-07-10T13:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314148",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:82" align="right">comment:82</div>

For Python 3 compatibility, it would be good to add

```
from __future__ import absolute_import, division
```
in `src/sage/matrix/matrix_gfpn_dense.pyx`

Then you should also use floor division if that's what you want, for example here:

```
cdef size_t pickled_rowsize = len(Data)/nr
```
There might be other such places too, I have not checked.



---

archive/issue_comments_314149.json:
```json
{
    "body": "Replying to [ticket:21437 SimonKing]:\n> - There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).\n\nSince this patch is getting rather big, would it be possible to separate this part? Then we could keep this ticket just to fix things, not adding new functionality.\n\nIf you feel up to it, I would actually suggest to split it up even further. For example, the pickling fixes alone deserve a separate ticket.\n\nNOTE: I'm not saying this just out of principle. My experience is that it's a lot easier to get multiple small tickets reviewed than one big ticket.",
    "created_at": "2017-07-10T13:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314149",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:21437 SimonKing]:
> - There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).

Since this patch is getting rather big, would it be possible to separate this part? Then we could keep this ticket just to fix things, not adding new functionality.

If you feel up to it, I would actually suggest to split it up even further. For example, the pickling fixes alone deserve a separate ticket.

NOTE: I'm not saying this just out of principle. My experience is that it's a lot easier to get multiple small tickets reviewed than one big ticket.



---

archive/issue_events_301176.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-10T13:15:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301176"
}
```



---

archive/issue_events_301177.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-10T13:15:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301177"
}
```



---

archive/issue_comments_314150.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nThe deprecation ticket number is still wrong.",
    "created_at": "2017-07-10T13:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314150",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">comment:84</div>

The deprecation ticket number is still wrong.



---

archive/issue_comments_314151.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nAbout this comment:\n\n```\n###############################################################\n## It is needed to do some initialisation. Since meataxe is\n## a dynamic library, it is needed to do this initialisation\n## in all modules cimporting sage.libs.meataxe. So, you HAVE\n## to call the meataxe_init() function when you cimport sage.libs.meataxe!\n```\n\n1. Replace \"dynamic\" by \"static\"\n\n2. It's not really correct that `meataxe_init()` must be called whenever `sage.libs.meataxe` is cimported. It's more correct to say that `meataxe_init()` must be called whenever the MeatAxe library is used. This may seem like a silly difference, but it is possible that some module needs access to some MeatAxe type (say, to pass around pointers or for simple conversions) without actually using anything from the MeatAxe static library.",
    "created_at": "2017-07-10T13:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314151",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

About this comment:

```
###############################################################
## It is needed to do some initialisation. Since meataxe is
## a dynamic library, it is needed to do this initialisation
## in all modules cimporting sage.libs.meataxe. So, you HAVE
## to call the meataxe_init() function when you cimport sage.libs.meataxe!
```

1. Replace "dynamic" by "static"

2. It's not really correct that `meataxe_init()` must be called whenever `sage.libs.meataxe` is cimported. It's more correct to say that `meataxe_init()` must be called whenever the MeatAxe library is used. This may seem like a silly difference, but it is possible that some module needs access to some MeatAxe type (say, to pass around pointers or for simple conversions) without actually using anything from the MeatAxe static library.



---

archive/issue_comments_314152.json:
```json
{
    "body": "Changed commit from **[`08e03c2`](https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821)** to **[`b6c8114`](https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402)**",
    "created_at": "2017-07-10T13:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314152",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`08e03c2`](https://github.com/sagemath/sagetrac-mirror/commit/08e03c2e6c12ea711d23677dbaad13a6c1971821)** to **[`b6c8114`](https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402)**



---

archive/issue_comments_314153.json:
```json
{
    "body": "<div id=\"comment:86\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402\">b6c8114</a></td><td><code>Make matrix_gfpn_dense python 3 compliant; fix a deprecation</code></td></tr></table>\n",
    "created_at": "2017-07-10T13:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:86"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402">b6c8114</a></td><td><code>Make matrix_gfpn_dense python 3 compliant; fix a deprecation</code></td></tr></table>




---

archive/issue_comments_314154.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nIf I see that correctly, the following git commits belong to this ticket:\n\n* b6c8114 - (HEAD -> t/21437/fix-mtx-matrices) Make matrix_gfpn_dense python 3 compliant; fix a deprecation (20 seconds ago) <Simon King>\n* 08e03c2 - Change ErrorHandler into sage_meataxe_error_handler (48 minutes ago) <Simon King>\n* 353a8b9 - meataxe_init() inline function (49 minutes ago) <Simon King>\n* 67a85ca - Move meataxe definitions from sage.matrix to sage.libs (4 hours ago) <Simon King>\n* 6a65600 - Use a fixed copy of MtxLibDir (2 days ago) <Simon King>\n* 04e7986 - Improve use of sig_on/off/check (2 days ago) <Simon King>\n* b70bc5f - Change some str into bytes (2 days ago) <Simon King>\n* c929fcc - Remove unused MTX* environment variables (2 days ago) <Simon King>\n* d943f93 - Remove rawMatrix function (2 days ago) <Simon King>\n* 413e4a9 - Remove deprecated Cython syntax, use check_malloc (2 days ago) <Simon King>\n* 5ed2269 - Fix one doctest (10 months ago) <Simon King>\n* 03ce5c0 - Fix bad INPUT::/OUTPUT:: blocks (10 months ago) <Simon King>\n* 291f4dc - Some minor tweaks for performance (10 months ago) <Simon King>\n* e17e4df - Document and test _rowlist_() (10 months ago) <Simon King>\n* a4dded9 - Make new tests optional (10 months ago) <Simon King>\n* 4f3d56c - Fix index check in get_slice (10 months ago) <Simon King>\n* e861781 - Add c(p)def functions to get/set horizontal matrix slices (10 months ago) <Simon King>\n* 02fa8a2 - Make pickling machine independent (10 months ago) <Simon King>\n* 778df7d - Help using MeatAxe executables in Sage (10 months ago) <Simon King>\n* 9e0f5d4 - Fix reading mtx-matrix from non-existent file (10 months ago) <Simon King>\n\nOn top of that, #23352 adds one more commit:\n* 6e33226 - (t/23352/fix_random_matrix_gfpn_dense) Properly fill the last few columns of random meataxe matrices (2 days ago) <Simon King>\n\nOK, quite a lot...\n\nHow to split that into smaller chunks? I see the following four topics:\n\n1. Bug fixes, for example:\n   * 6e33226 - Properly fill the last few columns of random meataxe matrices\n   * 02fa8a2 - Make pickling machine independent\n   * 9e0f5d4 - Fix reading mtx-matrix from non-existent file\n2. Code style/cleanliness, for example:\n   * b6c8114 - Make matrix_gfpn_dense python 3 compliant\n   * 04e7986 - Improve use of sig_on/off/check\n   * b70bc5f - Change some str into bytes\n   * 413e4a9 - Remove deprecated Cython syntax, use check_malloc\n   * d943f93 - Remove rawMatrix function \n3. Proper MeatAxe initialisation, for example\n   * 08e03c2 - Change ErrorHandler? into sage_meataxe_error_handler\n   * 353a8b9 - meataxe_init() inline function\n   * 67a85ca - Move meataxe definitions from sage.matrix to sage.libs\n   * c929fcc - Remove unused MTX* environment variables\n4. Additions, for example\n   * e17e4df - Document and test _rowlist_()\n   * e861781 - Add c(p)def functions to get/set horizontal matrix slices\n\nSince this ticket's name is about \"addition\", I suggest to deal with 4. *here*.\n\nSince #23352 is about fixing something, I suggest to deal with 1. *there*, and make it a dependency of everything else.\n\nAnd then there should be two new tickets for 2. and 3. Probably I will not cherry-pick commits, but will go through the whole diff and manually move stuff to the different topics.\nDoes that sound reasonable to you?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402\">b6c8114</a></td><td><code>Make matrix_gfpn_dense python 3 compliant; fix a deprecation</code></td></tr></table>\n",
    "created_at": "2017-07-10T14:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314154",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:87" align="right">comment:87</div>

If I see that correctly, the following git commits belong to this ticket:

* b6c8114 - (HEAD -> t/21437/fix-mtx-matrices) Make matrix_gfpn_dense python 3 compliant; fix a deprecation (20 seconds ago) <Simon King>
* 08e03c2 - Change ErrorHandler into sage_meataxe_error_handler (48 minutes ago) <Simon King>
* 353a8b9 - meataxe_init() inline function (49 minutes ago) <Simon King>
* 67a85ca - Move meataxe definitions from sage.matrix to sage.libs (4 hours ago) <Simon King>
* 6a65600 - Use a fixed copy of MtxLibDir (2 days ago) <Simon King>
* 04e7986 - Improve use of sig_on/off/check (2 days ago) <Simon King>
* b70bc5f - Change some str into bytes (2 days ago) <Simon King>
* c929fcc - Remove unused MTX* environment variables (2 days ago) <Simon King>
* d943f93 - Remove rawMatrix function (2 days ago) <Simon King>
* 413e4a9 - Remove deprecated Cython syntax, use check_malloc (2 days ago) <Simon King>
* 5ed2269 - Fix one doctest (10 months ago) <Simon King>
* 03ce5c0 - Fix bad INPUT::/OUTPUT:: blocks (10 months ago) <Simon King>
* 291f4dc - Some minor tweaks for performance (10 months ago) <Simon King>
* e17e4df - Document and test _rowlist_() (10 months ago) <Simon King>
* a4dded9 - Make new tests optional (10 months ago) <Simon King>
* 4f3d56c - Fix index check in get_slice (10 months ago) <Simon King>
* e861781 - Add c(p)def functions to get/set horizontal matrix slices (10 months ago) <Simon King>
* 02fa8a2 - Make pickling machine independent (10 months ago) <Simon King>
* 778df7d - Help using MeatAxe executables in Sage (10 months ago) <Simon King>
* 9e0f5d4 - Fix reading mtx-matrix from non-existent file (10 months ago) <Simon King>

On top of that, #23352 adds one more commit:
* 6e33226 - (t/23352/fix_random_matrix_gfpn_dense) Properly fill the last few columns of random meataxe matrices (2 days ago) <Simon King>

OK, quite a lot...

How to split that into smaller chunks? I see the following four topics:

1. Bug fixes, for example:
   * 6e33226 - Properly fill the last few columns of random meataxe matrices
   * 02fa8a2 - Make pickling machine independent
   * 9e0f5d4 - Fix reading mtx-matrix from non-existent file
2. Code style/cleanliness, for example:
   * b6c8114 - Make matrix_gfpn_dense python 3 compliant
   * 04e7986 - Improve use of sig_on/off/check
   * b70bc5f - Change some str into bytes
   * 413e4a9 - Remove deprecated Cython syntax, use check_malloc
   * d943f93 - Remove rawMatrix function 
3. Proper MeatAxe initialisation, for example
   * 08e03c2 - Change ErrorHandler? into sage_meataxe_error_handler
   * 353a8b9 - meataxe_init() inline function
   * 67a85ca - Move meataxe definitions from sage.matrix to sage.libs
   * c929fcc - Remove unused MTX* environment variables
4. Additions, for example
   * e17e4df - Document and test _rowlist_()
   * e861781 - Add c(p)def functions to get/set horizontal matrix slices

Since this ticket's name is about "addition", I suggest to deal with 4. *here*.

Since #23352 is about fixing something, I suggest to deal with 1. *there*, and make it a dependency of everything else.

And then there should be two new tickets for 2. and 3. Probably I will not cherry-pick commits, but will go through the whole diff and manually move stuff to the different topics.
Does that sound reasonable to you?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402">b6c8114</a></td><td><code>Make matrix_gfpn_dense python 3 compliant; fix a deprecation</code></td></tr></table>




---

archive/issue_comments_314155.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper:\n+While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper. At some point (see comments), it was suggested to separate these things. So, we now have the tickets #23352, #23399 and #23400. What is left: \n \n-- Things used to crash when reading a matrix from an empty/non-existent file. Rather, it should return an empty matrix.\n-- MeatAxe executable rely on an environment variable declaring where to find multiplication tables. This variable is now defined upon importing `sage.matrix.matrix_gfpn_dense`.\n-- An important fix: Previously, for pickling a matrix, I was simply dumping the contents of a memory block. By MeatAxe's design, one row occupies a multiple of `sizeof(long)` in memory, but there may be trailing empty bytes, whose number will generally depend on `sizeof(long)`. Hence, pickling must not dump the whole memory block, as it is machine dependent. Instead, only the parts of memory that are actually used to store data have to be dumped.\n-- There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).\n+- MeatAxe executables rely on an environment variable declaring where to find multiplication tables.\n+- Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.\n+\n+I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.\n``````\n",
    "created_at": "2017-07-11T08:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314155",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper:
+While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper. At some point (see comments), it was suggested to separate these things. So, we now have the tickets #23352, #23399 and #23400. What is left: 
 
-- Things used to crash when reading a matrix from an empty/non-existent file. Rather, it should return an empty matrix.
-- MeatAxe executable rely on an environment variable declaring where to find multiplication tables. This variable is now defined upon importing `sage.matrix.matrix_gfpn_dense`.
-- An important fix: Previously, for pickling a matrix, I was simply dumping the contents of a memory block. By MeatAxe's design, one row occupies a multiple of `sizeof(long)` in memory, but there may be trailing empty bytes, whose number will generally depend on `sizeof(long)`. Hence, pickling must not dump the whole memory block, as it is machine dependent. Instead, only the parts of memory that are actually used to store data have to be dumped.
-- There are some auxiliary functions that I would like to use in my group cohomology package (related with slicing).
+- MeatAxe executables rely on an environment variable declaring where to find multiplication tables.
+- Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.
+
+I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.
``````




---

archive/issue_events_301178.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-11T08:14:10Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "title_is": "Proper initialisation for the optional MeatAxe library",
    "title_was": "Some additions to the optional MeatAxe wrapper",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301178"
}
```



---

archive/issue_comments_314156.json:
```json
{
    "body": "Dependencies: **#23352 #23399 #23400**",
    "created_at": "2017-07-11T08:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314156",
    "user": "https://github.com/simon-king-jena"
}
```

Dependencies: **#23352 #23399 #23400**



---

archive/issue_comments_314157.json:
```json
{
    "body": "Changed commit from **[`b6c8114`](https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402)** to **[`1d86d5a`](https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f)**",
    "created_at": "2017-07-11T11:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314157",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6c8114`](https://github.com/sagemath/sagetrac-mirror/commit/b6c8114f9c1480929a9bac9671d9c7b9fa689402)** to **[`1d86d5a`](https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f)**



---

archive/issue_comments_314158.json:
```json
{
    "body": "<div id=\"comment:89\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0\">225afe1</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6722bef6c52dba8c4c23c610f4ca423bdbca6ed\">f6722be</a></td><td><code>Add c(p)def functions to get/set horizontal matrix slices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f7caf9ced1e3afdcf316b557b5ed9dc3388c464\">6f7caf9</a></td><td><code>Document and test _rowlist_()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9\">bd1f3f1</a></td><td><code>Fix ticket number in deprecation warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35b4ee7648f0c100ba0766ecc124713edc883ca7\">35b4ee7</a></td><td><code>Merge branch 't/23352/meataxe_fixes' into t/23399/some_additions_to_matrix_mod_gfpn_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dac9f373db657dfd4265c7756b0689ba8f2039a9\">dac9f37</a></td><td><code>Replace 'for...from' by '...in range()'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b97839c7b564aea9378767157a2f5a5eba695f9e\">b97839c</a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b6642ce167f028492720d58a0f91e581d5aaadd\">6b6642c</a></td><td><code>Improve use of sig_check/on/off</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fb429bfed28cb510aa51376f44fd634e52bbe33\">0fb429b</a></td><td><code>Make matrix_gfpn_dense Python 3 compliant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f\">1d86d5a</a></td><td><code>Remove MTX* environment variables, move MeatAxe code to sage.libs</code></td></tr></table>\n",
    "created_at": "2017-07-11T11:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314158",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:89"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0">225afe1</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6722bef6c52dba8c4c23c610f4ca423bdbca6ed">f6722be</a></td><td><code>Add c(p)def functions to get/set horizontal matrix slices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f7caf9ced1e3afdcf316b557b5ed9dc3388c464">6f7caf9</a></td><td><code>Document and test _rowlist_()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9">bd1f3f1</a></td><td><code>Fix ticket number in deprecation warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35b4ee7648f0c100ba0766ecc124713edc883ca7">35b4ee7</a></td><td><code>Merge branch 't/23352/meataxe_fixes' into t/23399/some_additions_to_matrix_mod_gfpn_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dac9f373db657dfd4265c7756b0689ba8f2039a9">dac9f37</a></td><td><code>Replace 'for...from' by '...in range()'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b97839c7b564aea9378767157a2f5a5eba695f9e">b97839c</a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b6642ce167f028492720d58a0f91e581d5aaadd">6b6642c</a></td><td><code>Improve use of sig_check/on/off</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fb429bfed28cb510aa51376f44fd634e52bbe33">0fb429b</a></td><td><code>Make matrix_gfpn_dense Python 3 compliant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f">1d86d5a</a></td><td><code>Remove MTX* environment variables, move MeatAxe code to sage.libs</code></td></tr></table>




---

archive/issue_events_301179.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-11T11:10:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301179"
}
```



---

archive/issue_events_301180.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-11T11:10:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301180"
}
```



---

archive/issue_comments_314159.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nFrom my perspective, the work is done. Thus, together with #23352, #23399 and #23400, it needs review!",
    "created_at": "2017-07-11T11:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314159",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:90" align="right">comment:90</div>

From my perspective, the work is done. Thus, together with #23352, #23399 and #23400, it needs review!



---

archive/issue_comments_314160.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper. At some point (see comments), it was suggested to separate these things. So, we now have the tickets #23352, #23399 and #23400. What is left: \n+Modules using the optional MeatAxe package need the following initialisation:\n \n-- MeatAxe executables rely on an environment variable declaring where to find multiplication tables.\n+- MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.\n - Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.\n \n I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.\n``````\n",
    "created_at": "2017-07-12T18:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314160",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-While working at #18514, I found a couple of things to be fixed in the MeatAxe wrapper. At some point (see comments), it was suggested to separate these things. So, we now have the tickets #23352, #23399 and #23400. What is left: 
+Modules using the optional MeatAxe package need the following initialisation:
 
-- MeatAxe executables rely on an environment variable declaring where to find multiplication tables.
+- MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.
 - Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.
 
 I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.
``````




---

archive/issue_events_301181.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T18:51:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301181"
}
```



---

archive/issue_events_301182.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T18:51:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301182"
}
```



---

archive/issue_comments_314161.json:
```json
{
    "body": "Changed commit from **[`1d86d5a`](https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f)** to **[`23ebebd`](https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7)**",
    "created_at": "2017-07-13T00:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314161",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1d86d5a`](https://github.com/sagemath/sagetrac-mirror/commit/1d86d5aebd2b2427a76b91084f7b857c233e163f)** to **[`23ebebd`](https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7)**



---

archive/issue_comments_314162.json:
```json
{
    "body": "<div id=\"comment:92\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4960a8166debbb446e7da6f26586d742e9f12f0d\">4960a81</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891\">4e85fca</a></td><td><code>Make pickling of matrix_gfpn_dense machine independent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7\">f9d878a</a></td><td><code>Add test for reading from non-existing file; add cimports</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdfb799ca6b653312dc1c022a0c1f93d965bd2b6\">bdfb799</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/21437/meataxe_initialisation_merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879\">bbd6a61</a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bc9168e3f3339591ee01944bb3561b2a140191c\">6bc9168</a></td><td><code>Merge branch 't/23352/fix_random_matrix_gfpn_dense' into t/21437/meataxe_initialisation_merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7\">23ebebd</a></td><td><code>Add MeatAxe initialisation function</code></td></tr></table>\n",
    "created_at": "2017-07-13T00:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314162",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4960a8166debbb446e7da6f26586d742e9f12f0d">4960a81</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891">4e85fca</a></td><td><code>Make pickling of matrix_gfpn_dense machine independent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7">f9d878a</a></td><td><code>Add test for reading from non-existing file; add cimports</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdfb799ca6b653312dc1c022a0c1f93d965bd2b6">bdfb799</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/21437/meataxe_initialisation_merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879">bbd6a61</a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bc9168e3f3339591ee01944bb3561b2a140191c">6bc9168</a></td><td><code>Merge branch 't/23352/fix_random_matrix_gfpn_dense' into t/21437/meataxe_initialisation_merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7">23ebebd</a></td><td><code>Add MeatAxe initialisation function</code></td></tr></table>




---

archive/issue_events_301183.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T00:22:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301183"
}
```



---

archive/issue_events_301184.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T00:22:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301184"
}
```



---

archive/issue_comments_314163.json:
```json
{
    "body": "Changed dependencies from **#23352 #23399 #23400** to **#23410 #23411 #23352**",
    "created_at": "2017-07-13T00:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314163",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#23352 #23399 #23400** to **#23410 #23411 #23352**



---

archive/issue_comments_314164.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nI hope it is ok that this now has three dependencies...",
    "created_at": "2017-07-13T00:22:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314164",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:93" align="right">comment:93</div>

I hope it is ok that this now has three dependencies...



---

archive/issue_comments_314165.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\n#23410 is not a dependency (and merges cleanly). So, let's simplify the list of dependencies.",
    "created_at": "2017-07-16T13:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314165",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:94" align="right">comment:94</div>

#23410 is not a dependency (and merges cleanly). So, let's simplify the list of dependencies.



---

archive/issue_comments_314166.json:
```json
{
    "body": "Changed dependencies from **#23410 #23411 #23352** to **#23411 #23352**",
    "created_at": "2017-07-16T13:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314166",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#23410 #23411 #23352** to **#23411 #23352**



---

archive/issue_comments_314167.json:
```json
{
    "body": "Changed commit from **[`23ebebd`](https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7)** to **[`82394bc`](https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6)**",
    "created_at": "2017-07-16T13:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`23ebebd`](https://github.com/sagemath/sagetrac-mirror/commit/23ebebdf492125dfb289c6efdf32bf240e6b52e7)** to **[`82394bc`](https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6)**



---

archive/issue_comments_314168.json:
```json
{
    "body": "<div id=\"comment:95\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa\">e477948</a></td><td><code>Test meataxe unpickling being machine independent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a\">01e2c0d</a></td><td><code>Mark new meataxe test 'optional'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea\">d174835</a></td><td><code>Check bounds when unpickling meataxe matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd\">8873330</a></td><td><code>Mark further meataxe tests optional; fix potential zero division</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766\">7a1ed5a</a></td><td><code>Meataxe unpickling: Further consistency checks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c0dcd52f7169847287141c17c15dc1cc91a42d3\">1c0dcd5</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/23400/cleanup_of_matrix_gfpn_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264\">71abd44</a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6\">e68140e</a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6\">82394bc</a></td><td><code>Merge branch 't/23352/fix_random_matrix_gfpn_dense' into t/23400/cleanup_of_matrix_gfpn_dense</code></td></tr></table>\n",
    "created_at": "2017-07-16T13:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314168",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:95"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa">e477948</a></td><td><code>Test meataxe unpickling being machine independent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a">01e2c0d</a></td><td><code>Mark new meataxe test 'optional'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea">d174835</a></td><td><code>Check bounds when unpickling meataxe matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd">8873330</a></td><td><code>Mark further meataxe tests optional; fix potential zero division</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766">7a1ed5a</a></td><td><code>Meataxe unpickling: Further consistency checks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c0dcd52f7169847287141c17c15dc1cc91a42d3">1c0dcd5</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/23400/cleanup_of_matrix_gfpn_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264">71abd44</a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6">e68140e</a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6">82394bc</a></td><td><code>Merge branch 't/23352/fix_random_matrix_gfpn_dense' into t/23400/cleanup_of_matrix_gfpn_dense</code></td></tr></table>




---

archive/issue_comments_314169.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nManual merging of the last few commits of #23352 was needed.",
    "created_at": "2017-07-16T13:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314169",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:96" align="right">comment:96</div>

Manual merging of the last few commits of #23352 was needed.



---

archive/issue_comments_314170.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Modules using the optional MeatAxe package need the following initialisation:\n \n - MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.\n-- Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.\n+- Each module that links against the MeatAxe library, which is a static library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.\n \n-I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.\n+I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module `sage.libs.meataxe` is created.\n``````\n",
    "created_at": "2017-07-17T12:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314170",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Modules using the optional MeatAxe package need the following initialisation:
 
 - MeatAxe executables rely on an environment variable declaring where to find multiplication tables. Of course, this needs to be done only once.
-- Each module that links against the MeatAxe library, which is a dynamic C library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.
+- Each module that links against the MeatAxe library, which is a static library, has to define a certain C variable, which serves the same purpose as the aforementioned environment variable.
 
-I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module sage.libs.meataxe is created.
+I suggest to add here a function that does the initialisation and must be called be each module using MeatAxe functions. For that purpose, a new module `sage.libs.meataxe` is created.
``````




---

archive/issue_comments_314171.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nBetter use `RuntimeError` instead of `SystemError` for unknown error messages.",
    "created_at": "2017-07-17T12:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314171",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:98" align="right">comment:98</div>

Better use `RuntimeError` instead of `SystemError` for unknown error messages.



---

archive/issue_comments_314172.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nReplying to [@jdemeyer](#comment:98):\n> Better use `RuntimeError` instead of `SystemError` for unknown error messages.\n\nOK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).",
    "created_at": "2017-07-17T12:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314172",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:99" align="right">comment:99</div>

Replying to [@jdemeyer](#comment:98):
> Better use `RuntimeError` instead of `SystemError` for unknown error messages.

OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).



---

archive/issue_comments_314173.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@simon-king-jena](#comment:99):\n> Replying to [@jdemeyer](#comment:98):\n> > Better use `RuntimeError` instead of `SystemError` for unknown error messages.\n\n> \n> OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).\n\n`OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.",
    "created_at": "2017-07-17T13:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314173",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@simon-king-jena](#comment:99):
> Replying to [@jdemeyer](#comment:98):
> > Better use `RuntimeError` instead of `SystemError` for unknown error messages.

> 
> OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).

`OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.



---

archive/issue_comments_314174.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nReplying to [@jdemeyer](#comment:100):\n> > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).\n\n> \n> `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.\n\nIn that case I should change the current IOError as well. And since #23411 introduces another test with a SystemError that should better be an OSError, I'll merge #23411.",
    "created_at": "2017-07-17T14:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314174",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:101" align="right">comment:101</div>

Replying to [@jdemeyer](#comment:100):
> > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).

> 
> `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.

In that case I should change the current IOError as well. And since #23411 introduces another test with a SystemError that should better be an OSError, I'll merge #23411.



---

archive/issue_comments_314175.json:
```json
{
    "body": "Changed commit from **[`82394bc`](https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6)** to **[`6cba43e`](https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a)**",
    "created_at": "2017-07-17T15:12:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314175",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`82394bc`](https://github.com/sagemath/sagetrac-mirror/commit/82394bcc093175df3c08e155513fc205a2aa24b6)** to **[`6cba43e`](https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a)**



---

archive/issue_comments_314176.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b\">f274beb</a></td><td><code>Meataxe unpickling: Further corner cases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc\">6586e97</a></td><td><code>Sanitise meataxe matrix initialisation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2\">77bc58b</a></td><td><code>Fix indentation in meataxe matrix `__init__` doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c\">5106ebb</a></td><td><code>Simplified code path for uninitialised meataxe matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272\">3d94133</a></td><td><code>Remove codepath for creating uninitialised meataxe matrix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/564104e5c3c09769b921c10a10788063c9c39096\">564104e</a></td><td><code>Don't use six.string_types, but basestring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a\">982755f</a></td><td><code>Workaround: MeatAxe's MatLoad returns NULL on empty filename without setting error</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75ab906d28cee4fe5bd184700eba25537593aaf1\">75ab906</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/21437/meataxe_initialisation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a\">6cba43e</a></td><td><code>Improve handling of different meataxe error types</code></td></tr></table>\n",
    "created_at": "2017-07-17T15:12:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314176",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b">f274beb</a></td><td><code>Meataxe unpickling: Further corner cases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc">6586e97</a></td><td><code>Sanitise meataxe matrix initialisation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2">77bc58b</a></td><td><code>Fix indentation in meataxe matrix `__init__` doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c">5106ebb</a></td><td><code>Simplified code path for uninitialised meataxe matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272">3d94133</a></td><td><code>Remove codepath for creating uninitialised meataxe matrix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/564104e5c3c09769b921c10a10788063c9c39096">564104e</a></td><td><code>Don't use six.string_types, but basestring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a">982755f</a></td><td><code>Workaround: MeatAxe's MatLoad returns NULL on empty filename without setting error</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75ab906d28cee4fe5bd184700eba25537593aaf1">75ab906</a></td><td><code>Merge branch 't/23411/fix_pickling_of_matrix_gfpn_dense' into t/21437/meataxe_initialisation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a">6cba43e</a></td><td><code>Improve handling of different meataxe error types</code></td></tr></table>




---

archive/issue_comments_314177.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nReplying to [@jdemeyer](#comment:100):\n> Replying to [@simon-king-jena](#comment:99):\n> > Replying to [@jdemeyer](#comment:98):\n> > > Better use `RuntimeError` instead of `SystemError` for unknown error messages.\n\n> > \n> > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).\n\n> \n> `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.\n\nDone and done!",
    "created_at": "2017-07-17T15:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314177",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:103" align="right">comment:103</div>

Replying to [@jdemeyer](#comment:100):
> Replying to [@simon-king-jena](#comment:99):
> > Replying to [@jdemeyer](#comment:98):
> > > Better use `RuntimeError` instead of `SystemError` for unknown error messages.

> > 
> > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).

> 
> `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.

Done and done!



---

archive/issue_comments_314178.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nReplying to [@simon-king-jena](#comment:103):\n> Replying to [@jdemeyer](#comment:100):\n> > Replying to [@simon-king-jena](#comment:99):\n> > > Replying to [@jdemeyer](#comment:98):\n> > > > Better use `RuntimeError` instead of `SystemError` for unknown error messages.\n\n> > > \n> > > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).\n\n> > \n> > `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.\n\n> \n> Done and done!\n\nI think I have addressed all objections...",
    "created_at": "2017-08-18T14:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314178",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:104" align="right">comment:104</div>

Replying to [@simon-king-jena](#comment:103):
> Replying to [@jdemeyer](#comment:100):
> > Replying to [@simon-king-jena](#comment:99):
> > > Replying to [@jdemeyer](#comment:98):
> > > > Better use `RuntimeError` instead of `SystemError` for unknown error messages.

> > > 
> > > OK. Also, I found another case where I could be more specific (namely: If a file of a given name doesn't exist, which I guess should result in an !IOError).

> > 
> > `OSError` instead of `IOError` because `IOError` is just an alias of `OSError` in Python 3.

> 
> Done and done!

I think I have addressed all objections...



---

archive/issue_comments_314179.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nJeroen, do you plan on finishing the review on this ticket? You already have been through this code and are more of a Cython expert than I am. However, I can probably finishing reviewing this ticket if you'd prefer.",
    "created_at": "2017-08-25T22:42:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314179",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Jeroen, do you plan on finishing the review on this ticket? You already have been through this code and are more of a Cython expert than I am. However, I can probably finishing reviewing this ticket if you'd prefer.



---

archive/issue_comments_314180.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nViewing the diff of this ticket fails with HTTP error 500. I just sent an email to `sagemath-admins` for this.",
    "created_at": "2017-08-30T15:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314180",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Viewing the diff of this ticket fails with HTTP error 500. I just sent an email to `sagemath-admins` for this.



---

archive/issue_comments_314181.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nFor now the best thing to do might be to rebase this on the latest develop branch and then `git push -f`.  SimonKing: Let me know if you need any help with the git-fu.",
    "created_at": "2017-08-31T12:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314181",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

For now the best thing to do might be to rebase this on the latest develop branch and then `git push -f`.  SimonKing: Let me know if you need any help with the git-fu.



---

archive/issue_comments_314182.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)** to **[u/jdemeyer/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix-mtx-matrices)**",
    "created_at": "2017-08-31T12:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314182",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)** to **[u/jdemeyer/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix-mtx-matrices)**



---

archive/issue_comments_314183.json:
```json
{
    "body": "Changed commit from **[`6cba43e`](https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a)** to **[`656dc9c`](https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5)**",
    "created_at": "2017-08-31T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314183",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`6cba43e`](https://github.com/sagemath/sagetrac-mirror/commit/6cba43e0d93249ae33efb8284b53d9b7d1f1539a)** to **[`656dc9c`](https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5)**



---

archive/issue_comments_314184.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI just did that.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5\">656dc9c</a></td><td><code>Merge tag '8.1.beta3' into t/21437/fix-mtx-matrices</code></td></tr></table>\n",
    "created_at": "2017-08-31T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314184",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I just did that.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5">656dc9c</a></td><td><code>Merge tag '8.1.beta3' into t/21437/fix-mtx-matrices</code></td></tr></table>




---

archive/issue_comments_314185.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nThis is not going to work on Python 3:\n\n```\nMtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE, 'meataxe'))\n```\n(the reason is that `os.path.join(DOT_SAGE, 'meataxe')` is `unicode`, not `bytes`.\n\nI'm not sure if this should hold back this ticket, there are probably many issues like this in Sage.",
    "created_at": "2017-08-31T12:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314185",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:0" align="right">comment:0</div>

This is not going to work on Python 3:

```
MtxLibDir = PyBytes_AsString(os.path.join(DOT_SAGE, 'meataxe'))
```
(the reason is that `os.path.join(DOT_SAGE, 'meataxe')` is `unicode`, not `bytes`.

I'm not sure if this should hold back this ticket, there are probably many issues like this in Sage.



---

archive/issue_events_301185.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T13:04:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301185"
}
```



---

archive/issue_events_301186.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T13:04:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301186"
}
```



---

archive/issue_comments_314186.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSome imports can be cleaned up.\n\nYou can remove\n\n```\ncdef extern from \"Python.h\":\n    object PyString_FromStringAndSize(char *s, Py_ssize_t len)\n    char* PyString_AsString(object string)\n```\nand\n\n```\n####################\n#\n# auxiliary functions\n#\n####################\nimport sys\nfrom libc.string cimport memcpy\n```\n\nI would also remove\n\n```\nfrom libc.stdlib cimport free\n```\nand replace `free()` by `sig_free()` in `free(old)`.",
    "created_at": "2017-08-31T13:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314186",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Some imports can be cleaned up.

You can remove

```
cdef extern from "Python.h":
    object PyString_FromStringAndSize(char *s, Py_ssize_t len)
    char* PyString_AsString(object string)
```
and

```
####################
#
# auxiliary functions
#
####################
import sys
from libc.string cimport memcpy
```

I would also remove

```
from libc.stdlib cimport free
```
and replace `free()` by `sig_free()` in `free(old)`.



---

archive/issue_comments_314187.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLet me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Fr\u00e9d\u00e9ric) pull their hair out later.\n\nFor one, why is it unicode (on Python 2) in the first place?",
    "created_at": "2017-08-31T13:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314187",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Let me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Frdric) pull their hair out later.

For one, why is it unicode (on Python 2) in the first place?



---

archive/issue_comments_314188.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nReplying to [@embray](#comment:112):\n> For one, why is it unicode (on Python 2) in the first place?\n\nIt's really `str` which is `bytes` on Python 2 but `unicode` (a.k.a. `str`) on Python 3.",
    "created_at": "2017-08-31T13:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314188",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:113" align="right">comment:113</div>

Replying to [@embray](#comment:112):
> For one, why is it unicode (on Python 2) in the first place?

It's really `str` which is `bytes` on Python 2 but `unicode` (a.k.a. `str`) on Python 3.



---

archive/issue_comments_314189.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nReplying to [@embray](#comment:112):\n> Let me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Fr\u00e9d\u00e9ric) pull their hair out later.\n\nRight, but we might want to consider implementing/using a general solution to the problem of converting filenames (or strings in general) from `unicode` to `bytes`. Something along the lines of https://github.com/defeo/cypari2/blob/master/cypari2/string_utils.pyx",
    "created_at": "2017-08-31T13:12:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314189",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:114" align="right">comment:114</div>

Replying to [@embray](#comment:112):
> Let me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Frdric) pull their hair out later.

Right, but we might want to consider implementing/using a general solution to the problem of converting filenames (or strings in general) from `unicode` to `bytes`. Something along the lines of https://github.com/defeo/cypari2/blob/master/cypari2/string_utils.pyx



---

archive/issue_comments_314190.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhat should `os.path.join(DOT_SAGE, 'meataxe')` be replaced with? Shouldn't both Python2 and Python3 just do the right thing, given whatever type DOT_SAGE and 'meataxe' are in the respective Python version?",
    "created_at": "2017-08-31T13:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314190",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

What should `os.path.join(DOT_SAGE, 'meataxe')` be replaced with? Shouldn't both Python2 and Python3 just do the right thing, given whatever type DOT_SAGE and 'meataxe' are in the respective Python version?



---

archive/issue_comments_314191.json:
```json
{
    "body": "<div id=\"comment:116\" align=\"right\">comment:116</div>\n\nReplying to [@simon-king-jena](#comment:115):\n> What should `os.path.join(DOT_SAGE, 'meataxe')` be replaced with? Shouldn't both Python2 and Python3 just do the right thing, given whatever type DOT_SAGE and 'meataxe' are in the respective Python version?\n\nSorry, I just realise that `PyBytes_AsString` is the probable culprit.\n\nIn any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?",
    "created_at": "2017-08-31T13:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314191",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:116" align="right">comment:116</div>

Replying to [@simon-king-jena](#comment:115):
> What should `os.path.join(DOT_SAGE, 'meataxe')` be replaced with? Shouldn't both Python2 and Python3 just do the right thing, given whatever type DOT_SAGE and 'meataxe' are in the respective Python version?

Sorry, I just realise that `PyBytes_AsString` is the probable culprit.

In any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?



---

archive/issue_comments_314192.json:
```json
{
    "body": "<div id=\"comment:117\" align=\"right\">comment:117</div>\n\nReplying to [@simon-king-jena](#comment:116):\n> In any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?\n\nIt's not so easy, see [comment:114]",
    "created_at": "2017-08-31T14:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314192",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:117" align="right">comment:117</div>

Replying to [@simon-king-jena](#comment:116):
> In any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?

It's not so easy, see [comment:114]



---

archive/issue_comments_314193.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nReplying to [@jdemeyer](#comment:117):\n> Replying to [@simon-king-jena](#comment:116):\n> > In any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?\n\n> \n> It's not so easy, see [comment:114]\n\nIf I understand correctly, it currently has to stay as it is and needs to be addressed as soon as Sage really moves on.\n\nSo, for now, I will change the code only according to your other objections.",
    "created_at": "2017-09-01T09:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314193",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:118" align="right">comment:118</div>

Replying to [@jdemeyer](#comment:117):
> Replying to [@simon-king-jena](#comment:116):
> > In any case, can you tell me precisely what the line should be replaced with, so that it works both in Python2 and Python3?

> 
> It's not so easy, see [comment:114]

If I understand correctly, it currently has to stay as it is and needs to be addressed as soon as Sage really moves on.

So, for now, I will change the code only according to your other objections.



---

archive/issue_comments_314194.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix-mtx-matrices)** to **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)**",
    "created_at": "2017-09-01T09:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314194",
    "user": "https://github.com/simon-king-jena"
}
```

Changed branch from **[u/jdemeyer/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix-mtx-matrices)** to **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)**



---

archive/issue_comments_314195.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\nReplying to [@simon-king-jena](#comment:118):\n> If I understand correctly, it currently has to stay as it is and needs to be addressed as soon as Sage really moves on.\n> \n> So, for now, I will change the code only according to your other objections.\n\nDone. Why did `sage -git trac push` not change the commit field but only the branch field? I changed the commit field manually.",
    "created_at": "2017-09-01T09:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314195",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:120" align="right">comment:120</div>

Replying to [@simon-king-jena](#comment:118):
> If I understand correctly, it currently has to stay as it is and needs to be addressed as soon as Sage really moves on.
> 
> So, for now, I will change the code only according to your other objections.

Done. Why did `sage -git trac push` not change the commit field but only the branch field? I changed the commit field manually.



---

archive/issue_events_301187.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-01T09:37:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301187"
}
```



---

archive/issue_events_301188.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-01T09:37:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301188"
}
```



---

archive/issue_comments_314196.json:
```json
{
    "body": "Changed commit from **[`656dc9c`](https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5)** to **[`063ad71`](https://github.com/sagemath/sagetrac-mirror/commit/063ad71f3d1e49171e821440dbcb2af226499cfd)**",
    "created_at": "2017-09-01T09:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314196",
    "user": "https://github.com/simon-king-jena"
}
```

Changed commit from **[`656dc9c`](https://github.com/sagemath/sagetrac-mirror/commit/656dc9c926b02ea776fe63f6c88e77f8c85569c5)** to **[`063ad71`](https://github.com/sagemath/sagetrac-mirror/commit/063ad71f3d1e49171e821440dbcb2af226499cfd)**



---

archive/issue_comments_314197.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nReplying to [@jdemeyer](#comment:114):\n> Replying to [@embray](#comment:112):\n> > Let me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Fr\u00e9d\u00e9ric) pull their hair out later.\n\n> \n> Right, but we might want to consider implementing/using a general solution to the problem of converting filenames (or strings in general) from `unicode` to `bytes`. Something along the lines of https://github.com/defeo/cypari2/blob/master/cypari2/string_utils.pyx\n\nI see. I didn't realize that wasn't already the case.  Is there any reason these have to be written in Cython? I don't see functions like these getting much speedup from it.  In any case , maybe I can just copy these directly into Sage and sprinkle them around the appropriate places.",
    "created_at": "2017-09-01T09:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314197",
    "user": "https://github.com/embray"
}
```

<div id="comment:121" align="right">comment:121</div>

Replying to [@jdemeyer](#comment:114):
> Replying to [@embray](#comment:112):
> > Let me think about this for a sec.  While it's true there are many issues like this in Sage, if we're aware of one now it would be better to address it now rather than make people working on the Python 3 port (i.e. Frdric) pull their hair out later.

> 
> Right, but we might want to consider implementing/using a general solution to the problem of converting filenames (or strings in general) from `unicode` to `bytes`. Something along the lines of https://github.com/defeo/cypari2/blob/master/cypari2/string_utils.pyx

I see. I didn't realize that wasn't already the case.  Is there any reason these have to be written in Cython? I don't see functions like these getting much speedup from it.  In any case , maybe I can just copy these directly into Sage and sprinkle them around the appropriate places.



---

archive/issue_comments_314198.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nReplying to [@embray](#comment:121):\n> I don't see functions like these getting much speedup from it.\n\nYou do get the speedup from *calling* those functions (calling a `cdef` function vs. calling a Python function).\n\nAnd for `cypari2`, Cython was an obvious choice since `cypari2` is completely implemented in Cython.",
    "created_at": "2017-09-01T12:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314198",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:122" align="right">comment:122</div>

Replying to [@embray](#comment:121):
> I don't see functions like these getting much speedup from it.

You do get the speedup from *calling* those functions (calling a `cdef` function vs. calling a Python function).

And for `cypari2`, Cython was an obvious choice since `cypari2` is completely implemented in Cython.



---

archive/issue_comments_314199.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nReplying to [@simon-king-jena](#comment:120):\n> Why did `sage -git trac push` not change the commit field but only the branch field? I changed the commit field manually.\n\nKnown bug: https://github.com/sagemath/sage_trac_plugin/issues/10",
    "created_at": "2017-09-04T10:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314199",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:123" align="right">comment:123</div>

Replying to [@simon-king-jena](#comment:120):
> Why did `sage -git trac push` not change the commit field but only the branch field? I changed the commit field manually.

Known bug: https://github.com/sagemath/sage_trac_plugin/issues/10



---

archive/issue_events_301189.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-06T08:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301189"
}
```



---

archive/issue_events_301190.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-06T08:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301190"
}
```



---

archive/issue_comments_314200.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n[comment:85]",
    "created_at": "2017-09-06T08:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314200",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

[comment:85]



---

archive/issue_comments_314201.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-09-06T08:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314201",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_314202.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAlso: please merge 8.1.beta4",
    "created_at": "2017-09-06T08:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314202",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Also: please merge 8.1.beta4



---

archive/issue_comments_314203.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/900b33cfcea98e42c8a2c9345c31deed1091b296\">900b33c</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da\">f6bb5bd</a></td><td><code>Fix wrong comment: libmeataxe is static</code></td></tr></table>\n",
    "created_at": "2017-09-11T12:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314203",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/900b33cfcea98e42c8a2c9345c31deed1091b296">900b33c</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da">f6bb5bd</a></td><td><code>Fix wrong comment: libmeataxe is static</code></td></tr></table>




---

archive/issue_comments_314204.json:
```json
{
    "body": "Changed commit from **[`063ad71`](https://github.com/sagemath/sagetrac-mirror/commit/063ad71f3d1e49171e821440dbcb2af226499cfd)** to **[`f6bb5bd`](https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da)**",
    "created_at": "2017-09-11T12:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314204",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`063ad71`](https://github.com/sagemath/sagetrac-mirror/commit/063ad71f3d1e49171e821440dbcb2af226499cfd)** to **[`f6bb5bd`](https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da)**



---

archive/issue_events_301191.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-11T12:24:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301191"
}
```



---

archive/issue_events_301192.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-11T12:24:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301192"
}
```



---

archive/issue_comments_314205.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nDone, so \"needs review\", with the caveat that I didn't run tests again.",
    "created_at": "2017-09-11T12:24:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314205",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Done, so "needs review", with the caveat that I didn't run tests again.



---

archive/issue_comments_314206.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOne detail:\n\n```\n    ## Define an environment variable that enables MeatAxe to find\n    ## its multiplication tables.\n```\nIt's not an environment variable, it's a string inside the meataxe library.\n\nIf you fix this comment, you can set this ticket to positive review.",
    "created_at": "2017-09-14T11:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

One detail:

```
    ## Define an environment variable that enables MeatAxe to find
    ## its multiplication tables.
```
It's not an environment variable, it's a string inside the meataxe library.

If you fix this comment, you can set this ticket to positive review.



---

archive/issue_comments_314207.json:
```json
{
    "body": "Changed commit from **[`f6bb5bd`](https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da)** to **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**",
    "created_at": "2017-09-14T12:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314207",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6bb5bd`](https://github.com/sagemath/sagetrac-mirror/commit/f6bb5bd4127ec07e5d315105d68cf70c0f4612da)** to **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**



---

archive/issue_comments_314208.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263\">3401f04</a></td><td><code>Fix misleading comment on a global MeatAxe variable</code></td></tr></table>\n",
    "created_at": "2017-09-14T12:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314208",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263">3401f04</a></td><td><code>Fix misleading comment on a global MeatAxe variable</code></td></tr></table>




---

archive/issue_comments_314209.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nThank you! I hope the comment is fine now.",
    "created_at": "2017-09-14T12:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314209",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:0" align="right">comment:0</div>

Thank you! I hope the comment is fine now.



---

archive/issue_events_301193.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-14T12:25:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301193"
}
```



---

archive/issue_events_301194.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-09-14T12:25:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301194"
}
```



---

archive/issue_events_301195.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-15T07:30:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301195"
}
```



---

archive/issue_events_301196.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9d73bf844dbb1403df36639362586faf07569f40",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-15T07:30:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21437#event-301196"
}
```



---

archive/issue_comments_314210.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)** to **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**",
    "created_at": "2017-09-15T07:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21437#issuecomment-314210",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/fix-mtx-matrices](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix-mtx-matrices)** to **[`3401f04`](https://github.com/sagemath/sagetrac-mirror/commit/3401f04ebf9f89700b24930967e9af8033c24263)**
