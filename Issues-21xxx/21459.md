# Issue 21459: Fix building of sage_setup.autogen.interpreters output on Cygwin/Windows

archive/issues_021222.json:
```json
{
    "assignees": [],
    "body": "This adds a new file generated for each interpreter, called `interp_<name>.h`.  Its purpose is to provide the correct `__declspec(dllexport/import)` on exported function definitions, so that they have the correct link-time behavior when building the interpreter wrappers themselves.\n\nThis is a workaround to #19868.  Ideally this would be fixed directly in Cython so that such a workaround is not needed, but after exploring the issue it seems that for now providing such a workaround is easier than fixing Cython.\n\nExplicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` attribute) are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.\n\nThis currently depends on #20730 but doesn't strictly have to.  It was just easier to understand the code and see what needed to be changed where *after* it was refactored.  \n\nDepends on #20730\n\nCC:  @tscrim @sagetrac-gouezel @jpflori\n\nComponent: **porting: Cygwin**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**\n\nReviewer: **Jean-Pierre Flori, Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21459_\n\n",
    "closed_at": "2017-06-17T10:29:06Z",
    "created_at": "2016-09-09T12:06:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix building of sage_setup.autogen.interpreters output on Cygwin/Windows",
    "type": "issue",
    "updated_at": "2017-06-17T10:29:06Z",
    "url": "https://github.com/sagemath/sage/issues/21459",
    "user": "https://github.com/embray"
}
```
This adds a new file generated for each interpreter, called `interp_<name>.h`.  Its purpose is to provide the correct `__declspec(dllexport/import)` on exported function definitions, so that they have the correct link-time behavior when building the interpreter wrappers themselves.

This is a workaround to #19868.  Ideally this would be fixed directly in Cython so that such a workaround is not needed, but after exploring the issue it seems that for now providing such a workaround is easier than fixing Cython.

Explicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` attribute) are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.

This currently depends on #20730 but doesn't strictly have to.  It was just easier to understand the code and see what needed to be changed where *after* it was refactored.  

Depends on #20730

CC:  @tscrim @sagetrac-gouezel @jpflori

Component: **porting: Cygwin**

Author: **Jeroen Demeyer**

Branch/Commit: **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**

Reviewer: **Jean-Pierre Flori, Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/21459_





---

archive/issue_events_298757.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-09T12:06:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298757"
}
```



---

archive/issue_events_298758.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-09T12:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "0000b0",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298758"
}
```



---

archive/issue_events_298759.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-09T12:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298759"
}
```



---

archive/issue_events_298760.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-09T12:06:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298760"
}
```



---

archive/issue_events_298761.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-09T12:07:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298761"
}
```



---

archive/issue_comments_314446.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n This is a workaround to #19868.  Ideally this would be fixed directly in Cython so that such a workaround is not needed, but after exploring the issue it seems that for now providing such a workaround is easier than fixing Cython.\n \n-Explicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.\n+Explicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` attribute) are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.\n \n This currently depends on #20730 but doesn't strictly have to.  It was just easier to understand the code and see what needed to be changed where *after* it was refactored.  \n``````\n",
    "created_at": "2016-09-09T12:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314446",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 This is a workaround to #19868.  Ideally this would be fixed directly in Cython so that such a workaround is not needed, but after exploring the issue it seems that for now providing such a workaround is easier than fixing Cython.
 
-Explicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.
+Explicit use of the `interp_<name>.h` headers replaces the implicit `cdef extern:` statements in the `wrapper_<name>.pxd` definition files.  This ensures that the function declarations (with the correct `__declspec` attribute) are included from the .h files, instead of being written directly into Cython-generated C files.  The end result has no visible differences for users of the library.
 
 This currently depends on #20730 but doesn't strictly have to.  It was just easier to understand the code and see what needed to be changed where *after* it was refactored.  
``````




---

archive/issue_comments_314447.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nDoes not merge with 7.5.rc2",
    "created_at": "2017-01-08T06:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314447",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:3" align="right">comment:3</div>

Does not merge with 7.5.rc2



---

archive/issue_events_298762.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-08T06:35:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298762"
}
```



---

archive/issue_events_298763.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-08T06:35:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298763"
}
```



---

archive/issue_comments_314448.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9eb811f093013373e6afe223e19d68f5fcafbaeb\"><code>9eb811f</code></a></td><td><code>One more whitespae fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b48bec1a665bbe5586e41765b519f1ce4c9384\"><code>89b48be</code></a></td><td><code>Add some `__main__` modules for ease of testing.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55853a74189befbe78c8bfa6d374708fb639696b\"><code>55853a7</code></a></td><td><code>Just import everything into the top-level `__init__` to rebuild the original sage_setup.autogen.interpreters namespace.  This enures that all the tests pass.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e5cf7546de425e11aea790b899c6193163d4f49\"><code>9e5cf75</code></a></td><td><code>Add from `__future__` import print_function, absolute_import to all (non-empty) modules for forward compatibility.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45b2847a5e80c4e4642804107dfa3a95037e8d94\"><code>45b2847</code></a></td><td><code>Change the name attributes of the interpreter implementations to class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35300469c908556501b697067fdcb84ee4be0b44\"><code>3530046</code></a></td><td><code>Deduplicate code in anticipation of adding more generated file(s) for interpreters.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04c22e9aba7758da14974d5a3ba53f09349ab628\"><code>04c22e9</code></a></td><td><code>More programmatic discovery of interpreter types rather than manually listing them</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e44d5b00e44792dc94b36693d8e7bd33ca9ea0e7\"><code>e44d5b0</code></a></td><td><code>Write internally used interp_ header files and use them appropriately in the generated wrapper_.pyx files.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/160a13c1e3fb9acf9ac8d7760f6b0d182c3c0085\"><code>160a13c</code></a></td><td><code>Fix bugs in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74\"><code>7945191</code></a></td><td><code>Expected change in test</code></td></tr></table>\n",
    "created_at": "2017-04-11T12:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314448",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9eb811f093013373e6afe223e19d68f5fcafbaeb"><code>9eb811f</code></a></td><td><code>One more whitespae fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b48bec1a665bbe5586e41765b519f1ce4c9384"><code>89b48be</code></a></td><td><code>Add some `__main__` modules for ease of testing.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55853a74189befbe78c8bfa6d374708fb639696b"><code>55853a7</code></a></td><td><code>Just import everything into the top-level `__init__` to rebuild the original sage_setup.autogen.interpreters namespace.  This enures that all the tests pass.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e5cf7546de425e11aea790b899c6193163d4f49"><code>9e5cf75</code></a></td><td><code>Add from `__future__` import print_function, absolute_import to all (non-empty) modules for forward compatibility.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45b2847a5e80c4e4642804107dfa3a95037e8d94"><code>45b2847</code></a></td><td><code>Change the name attributes of the interpreter implementations to class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35300469c908556501b697067fdcb84ee4be0b44"><code>3530046</code></a></td><td><code>Deduplicate code in anticipation of adding more generated file(s) for interpreters.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04c22e9aba7758da14974d5a3ba53f09349ab628"><code>04c22e9</code></a></td><td><code>More programmatic discovery of interpreter types rather than manually listing them</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e44d5b00e44792dc94b36693d8e7bd33ca9ea0e7"><code>e44d5b0</code></a></td><td><code>Write internally used interp_ header files and use them appropriately in the generated wrapper_.pyx files.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/160a13c1e3fb9acf9ac8d7760f6b0d182c3c0085"><code>160a13c</code></a></td><td><code>Fix bugs in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74"><code>7945191</code></a></td><td><code>Expected change in test</code></td></tr></table>




---

archive/issue_comments_314449.json:
```json
{
    "body": "Changed commit from **[`df25c5c`](https://github.com/sagemath/sagetrac-mirror/commit/df25c5c1cd5b0fe2540480469e8a138ea6a1ba6d)** to **[`7945191`](https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74)**",
    "created_at": "2017-04-11T12:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314449",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`df25c5c`](https://github.com/sagemath/sagetrac-mirror/commit/df25c5c1cd5b0fe2540480469e8a138ea6a1ba6d)** to **[`7945191`](https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74)**



---

archive/issue_comments_314450.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRebased--would be nice to get this fixed finally.  This workaround is still perhaps not an ideal solution to the problem, but it's been working well for quite some time now on my Cygwin branch.",
    "created_at": "2017-04-11T13:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314450",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Rebased--would be nice to get this fixed finally.  This workaround is still perhaps not an ideal solution to the problem, but it's been working well for quite some time now on my Cygwin branch.



---

archive/issue_events_298764.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T13:36:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298764"
}
```



---

archive/issue_events_298765.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T13:36:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298765"
}
```



---

archive/issue_events_298766.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T13:36:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298766"
}
```



---

archive/issue_events_298767.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T13:36:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298767"
}
```



---

archive/issue_comments_314451.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIf anyone wants to review this it's really only the last 3 commits on this branch that matter.  The rest is from #20730",
    "created_at": "2017-04-11T13:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314451",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

If anyone wants to review this it's really only the last 3 commits on this branch that matter.  The rest is from #20730



---

archive/issue_events_298768.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-21T12:23:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298768"
}
```



---

archive/issue_events_298769.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-21T12:23:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298769"
}
```



---

archive/issue_comments_314452.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis issue keeps coming up, can't we just fix it in Cython? This is at least the third time that Sage needs a workaround for the same Cython on Cygwin bug (the one which causes the `module_api` test in Cython to fail, which may or may not be fixed by https://github.com/cython/cython/pull/360).",
    "created_at": "2017-04-21T14:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314452",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

This issue keeps coming up, can't we just fix it in Cython? This is at least the third time that Sage needs a workaround for the same Cython on Cygwin bug (the one which causes the `module_api` test in Cython to fail, which may or may not be fixed by https://github.com/cython/cython/pull/360).



---

archive/issue_comments_314453.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI've already explained multiple times here and there (I thought on this ticket but apparently not?) it's easier to fix this here, now, than to fix it properly in Cython.  The PR you referenced does not fix this issue.",
    "created_at": "2017-04-21T16:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314453",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I've already explained multiple times here and there (I thought on this ticket but apparently not?) it's easier to fix this here, now, than to fix it properly in Cython.  The PR you referenced does not fix this issue.



---

archive/issue_comments_314454.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, but fixing the same issue independently in Sage *N* times takes *O(N)* time while fixing it in Cython takes *O(1)* time. Although I'm not making any claim about the constants...\n\nAnyway, let me look at the Cython issue, maybe I see something that you don't.",
    "created_at": "2017-04-21T16:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314454",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, but fixing the same issue independently in Sage *N* times takes *O(N)* time while fixing it in Cython takes *O(1)* time. Although I'm not making any claim about the constants...

Anyway, let me look at the Cython issue, maybe I see something that you don't.



---

archive/issue_comments_314455.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI don't think it's worth your time.  AFAIK this is the only place in Sage now or any time soon this needs to be addressed again.  I'm sure it can be fixed in Cython and am sure I could do it too, it was just annoying last I tried and this is much simpler.  Please, this ticket has been open for 7 months and I'm tired of rebasing it.  Just let it be...",
    "created_at": "2017-04-21T16:46:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314455",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

I don't think it's worth your time.  AFAIK this is the only place in Sage now or any time soon this needs to be addressed again.  I'm sure it can be fixed in Cython and am sure I could do it too, it was just annoying last I tried and this is much simpler.  Please, this ticket has been open for 7 months and I'm tired of rebasing it.  Just let it be...



---

archive/issue_comments_314456.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYou can open a separate issue for the general problem and assign it to me if you want, but I really don't think it's a high priority.",
    "created_at": "2017-04-21T16:59:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314456",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

You can open a separate issue for the general problem and assign it to me if you want, but I really don't think it's a high priority.



---

archive/issue_comments_314457.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI don't want to be annoying, but this ticket depends on #20730 which depends on #20238, so it might not be merged soon anyway.",
    "created_at": "2017-04-21T17:02:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314457",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

I don't want to be annoying, but this ticket depends on #20730 which depends on #20238, so it might not be merged soon anyway.



---

archive/issue_comments_314458.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhat is holding up #20238?  We could also invert that dependency considering that #20730 is much simpler.",
    "created_at": "2017-04-21T17:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314458",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

What is holding up #20238?  We could also invert that dependency considering that #20730 is much simpler.



---

archive/issue_comments_314459.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe only reason that dependency exists in the first place is due to a minor merge conflict that can be resolved in either direction.  I know you have good intentions in wanted to solve the problem generally and I agree, but it's not worth holding up any longer...",
    "created_at": "2017-04-21T17:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314459",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

The only reason that dependency exists in the first place is due to a minor merge conflict that can be resolved in either direction.  I know you have good intentions in wanted to solve the problem generally and I agree, but it's not worth holding up any longer...



---

archive/issue_comments_314460.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment%3A14):\n> What is holding up #20238?\n\nLack of reviewers.",
    "created_at": "2017-04-21T18:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314460",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment%3A14):
> What is holding up #20238?

Lack of reviewers.



---

archive/issue_comments_314461.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nPerhaps what we should ask is: Erik, are you willing to review #20238, and Jeroen, are you willing to review #20730? (Both in the near future.) Otherwise, I would say we should invert the dependency.",
    "created_at": "2017-04-23T02:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314461",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Perhaps what we should ask is: Erik, are you willing to review #20238, and Jeroen, are you willing to review #20730? (Both in the near future.) Otherwise, I would say we should invert the dependency.



---

archive/issue_comments_314462.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIt is still my opinion that it would be better to fix this ticket in Cython instead of adding yet another workaround in Sage. So in this view, it doesn't actually depend on #20730 and #20238.",
    "created_at": "2017-04-23T06:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314462",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

It is still my opinion that it would be better to fix this ticket in Cython instead of adding yet another workaround in Sage. So in this view, it doesn't actually depend on #20730 and #20238.



---

archive/issue_comments_314463.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThis is such a minor fix though--it took me like an hour to make at the most.  Seven months ago.  I feel like I've spent more time arguing about this than I spent working on the fix in the first place--that's why I'm frustrated.  It would be easy to just merge this fix and then work on the \"general\" problem as time permits (the \"general\" problem, which I'll remind, currently does not affect any other code that I know of--as you suggested the constants here are not such that O(1) < O(N)).",
    "created_at": "2017-04-24T11:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314463",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

This is such a minor fix though--it took me like an hour to make at the most.  Seven months ago.  I feel like I've spent more time arguing about this than I spent working on the fix in the first place--that's why I'm frustrated.  It would be easy to just merge this fix and then work on the "general" problem as time permits (the "general" problem, which I'll remind, currently does not affect any other code that I know of--as you suggested the constants here are not such that O(1) < O(N)).



---

archive/issue_comments_314464.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI mean, Jeroen, if you think you can fix the issue in Cython obviously that's your prerogative and I'd welcome such a fix if it can be done in time for Sage 8.0.  Otherwise I'm happy to help with that too but not until after Sage 8.0 is out.  My main issue here is just getting all open Cygwin blockers fixed for 8.0, including this one, and I don't care *how* it's fixed.  I just don't want to spend time on chasing a general fix right now when I already have this one.  It's not like I actually care about merging this code for its own sake.",
    "created_at": "2017-04-24T13:34:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314464",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

I mean, Jeroen, if you think you can fix the issue in Cython obviously that's your prerogative and I'd welcome such a fix if it can be done in time for Sage 8.0.  Otherwise I'm happy to help with that too but not until after Sage 8.0 is out.  My main issue here is just getting all open Cygwin blockers fixed for 8.0, including this one, and I don't care *how* it's fixed.  I just don't want to spend time on chasing a general fix right now when I already have this one.  It's not like I actually care about merging this code for its own sake.



---

archive/issue_comments_314465.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nLet's get this in as a temporary but simple workaround.",
    "created_at": "2017-04-27T11:51:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314465",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:21" align="right">comment:21</div>

Let's get this in as a temporary but simple workaround.



---

archive/issue_comments_314466.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2017-04-27T11:51:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314466",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_events_298770.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2017-04-27T11:51:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298770"
}
```



---

archive/issue_events_298771.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2017-04-27T11:51:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298771"
}
```



---

archive/issue_comments_314467.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIt seems that this needs to be rebased.\n\nFor the record, I *guess* I can fix the problem using https://github.com/cython/cython/pull/1650 and https://github.com/cython/cython/pull/1687 and with the following trivial patch:\n\n```diff\ndiff --git a/src/sage_setup/autogen/interpreters.py b/src/sage_setup/autogen/interpreters.py\nindex 31526e6..4f8774f 100644\n--- a/src/sage_setup/autogen/interpreters.py\n+++ b/src/sage_setup/autogen/interpreters.py\n@@ -3267,7 +3267,6 @@ interp_{{ s.name }}(args\n \n         w(je(\"\"\"\n # {{ warn }}\n-# distutils: sources = sage/ext/interpreters/interp_{{ s.name }}.c\n {{ s.pyx_header }}\n \n include \"cysignals/memory.pxi\"\n@@ -3286,7 +3285,7 @@ cdef extern from \"Python.h\":\n \n from sage.ext.fast_callable cimport Wrapper\n \n-cdef extern:\n+cdef extern from \"|interp_{{ s.name }}.c\":\n     {{ myself.func_header(cython=true) -}}\n {% if s.err_return != 'NULL' %}\n  except? {{ s.err_return }}\n```\n\n(Only tested on Linux)",
    "created_at": "2017-04-28T10:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314467",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

It seems that this needs to be rebased.

For the record, I *guess* I can fix the problem using https://github.com/cython/cython/pull/1650 and https://github.com/cython/cython/pull/1687 and with the following trivial patch:

```diff
diff --git a/src/sage_setup/autogen/interpreters.py b/src/sage_setup/autogen/interpreters.py
index 31526e6..4f8774f 100644
--- a/src/sage_setup/autogen/interpreters.py
+++ b/src/sage_setup/autogen/interpreters.py
@@ -3267,7 +3267,6 @@ interp_{{ s.name }}(args
 
         w(je("""
 # {{ warn }}
-# distutils: sources = sage/ext/interpreters/interp_{{ s.name }}.c
 {{ s.pyx_header }}
 
 include "cysignals/memory.pxi"
@@ -3286,7 +3285,7 @@ cdef extern from "Python.h":
 
 from sage.ext.fast_callable cimport Wrapper
 
-cdef extern:
+cdef extern from "|interp_{{ s.name }}.c":
     {{ myself.func_header(cython=true) -}}
 {% if s.err_return != 'NULL' %}
  except? {{ s.err_return }}
```

(Only tested on Linux)



---

archive/issue_events_298772.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-28T10:44:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298772"
}
```



---

archive/issue_events_298773.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-28T10:44:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298773"
}
```



---

archive/issue_comments_314468.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nWhat does the pipe symbol mean in `cdef extern from \"|interp_{{ s.name }}.c\":`?  I don't recall seeing that syntax before.",
    "created_at": "2017-04-28T10:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314468",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

What does the pipe symbol mean in `cdef extern from "|interp_{{ s.name }}.c":`?  I don't recall seeing that syntax before.



---

archive/issue_comments_314469.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nNevermind; answered my own question by actually reading your links.",
    "created_at": "2017-04-28T10:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314469",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

Nevermind; answered my own question by actually reading your links.



---

archive/issue_comments_314470.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNeeds rebasing.",
    "created_at": "2017-05-03T03:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314470",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

Needs rebasing.



---

archive/issue_comments_314471.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI know--I still want to test out Jeroen's idea for fixing this.  In the short term I think taking this patch as-is is more likely, since his fix involves bikeshedding in Cython.  But who knows--maybe we can come to a conclusion on that quickly.",
    "created_at": "2017-05-03T09:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314471",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

I know--I still want to test out Jeroen's idea for fixing this.  In the short term I think taking this patch as-is is more likely, since his fix involves bikeshedding in Cython.  But who knows--maybe we can come to a conclusion on that quickly.



---

archive/issue_comments_314472.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI tried building with a Cython with Jeroen's two patches applied, and with his suggested patch above, and early signs are good for this solving the problem.\n\nI'm still running full `ptestlong` just to be sure, but it compiled with no problems--bravo!\n\nAssuming this works, the question remains what to do in the short term.  There's still not a consensus on accepting [Cython-1650](https://github.com/cython/cython/pull/1650).  And even if it were accepted there's no consensus yet on the syntax.  \n\n1) We could accept my fix in the short term, if needed, and back it out later.  But that's slightly annoying, especially since it adds new generated files.\n\n2) Alternatively, we could patch Cython for now assuming that Jeroen's patch will be accepted *at some point*, but that's problematic for downstream support, especially considering the syntax uncertainties.\n\nI prefer 1) for now because I don't like relying on patches, especially when it means building is impossible downstream *without* those patches, and further still given that it's a not completely insignificant patch (it's a new feature to Cython, not just a bug fix).\n\nThat said, I'm okay with either way.",
    "created_at": "2017-05-11T13:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314472",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

I tried building with a Cython with Jeroen's two patches applied, and with his suggested patch above, and early signs are good for this solving the problem.

I'm still running full `ptestlong` just to be sure, but it compiled with no problems--bravo!

Assuming this works, the question remains what to do in the short term.  There's still not a consensus on accepting [Cython-1650](https://github.com/cython/cython/pull/1650).  And even if it were accepted there's no consensus yet on the syntax.  

1) We could accept my fix in the short term, if needed, and back it out later.  But that's slightly annoying, especially since it adds new generated files.

2) Alternatively, we could patch Cython for now assuming that Jeroen's patch will be accepted *at some point*, but that's problematic for downstream support, especially considering the syntax uncertainties.

I prefer 1) for now because I don't like relying on patches, especially when it means building is impossible downstream *without* those patches, and further still given that it's a not completely insignificant patch (it's a new feature to Cython, not just a bug fix).

That said, I'm okay with either way.



---

archive/issue_comments_314473.json:
```json
{
    "body": "Changed commit from **[`7945191`](https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74)** to **[`954772a`](https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf)**",
    "created_at": "2017-05-11T13:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314473",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7945191`](https://github.com/sagemath/sagetrac-mirror/commit/794519185206abd03356077eb9d6c39919c6ae74)** to **[`954772a`](https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf)**



---

archive/issue_comments_314474.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20299014129f1aad8f8392475eafa69214854670\"><code>2029901</code></a></td><td><code>Write internally used interp_ header files and use them appropriately in the generated wrapper_.pyx files.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2f26fd3ed35675554cca1e373d6c46fe4cd084b\"><code>d2f26fd</code></a></td><td><code>Fix bugs in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf\"><code>954772a</code></a></td><td><code>Expected change in test</code></td></tr></table>\n",
    "created_at": "2017-05-11T13:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314474",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20299014129f1aad8f8392475eafa69214854670"><code>2029901</code></a></td><td><code>Write internally used interp_ header files and use them appropriately in the generated wrapper_.pyx files.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2f26fd3ed35675554cca1e373d6c46fe4cd084b"><code>d2f26fd</code></a></td><td><code>Fix bugs in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf"><code>954772a</code></a></td><td><code>Expected change in test</code></td></tr></table>




---

archive/issue_events_298774.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-11T13:44:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298774"
}
```



---

archive/issue_events_298775.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-11T13:44:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298775"
}
```



---

archive/issue_comments_314475.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWent ahead and rebased my existing branch, so that it's good to go if need be. But I'll await further feedback on how to move forward with this...",
    "created_at": "2017-05-11T13:44:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314475",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Went ahead and rebased my existing branch, so that it's good to go if need be. But I'll await further feedback on how to move forward with this...



---

archive/issue_comments_314476.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI agree with you that 1) is not very satisfactory but is the way to go before the discussion about cython settles down.\n\nCould you use the :trac: syntax for http://trac.sagemath.org/ticket/19868\nAnd mention the way 2) should fix the wrongly generated headers in the docstrings, including ticket numbers on cython tracker?",
    "created_at": "2017-05-11T13:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314476",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:31" align="right">comment:31</div>

I agree with you that 1) is not very satisfactory but is the way to go before the discussion about cython settles down.

Could you use the :trac: syntax for http://trac.sagemath.org/ticket/19868
And mention the way 2) should fix the wrongly generated headers in the docstrings, including ticket numbers on cython tracker?



---

archive/issue_comments_314477.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSure, I'll fix that.",
    "created_at": "2017-05-11T15:04:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314477",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

Sure, I'll fix that.



---

archive/issue_comments_314478.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThere are various changes on this patch which seem unrelated to Cygwin support: are those really needed? For example\n\n```diff\ndiff --git a/src/sage_setup/autogen/interpreters/specs/rr.py b/src/sage_setup/autogen/interpreters/specs/rr.py\nindex f4d3dc5..fe7a5cb 100644\n--- a/src/sage_setup/autogen/interpreters/specs/rr.py\n+++ b/src/sage_setup/autogen/interpreters/specs/rr.py\n@@ -184,9 +183,9 @@ class RRInterpreter(StackInterpreter):\n                         S=self.mc_stack,\n                         P=self.mc_py_constants)\n         self.pg = pg\n+        self.h_header = '#include <mpfr.h>'\n         self.c_header = ri(0,\n             '''\n-            #include <mpfr.h>\n             #include \"interpreters/wrapper_rr.h\"\n             ''')\n```\n\nFor the record: I prefer the solution of patching Cython and hoping that upstream Cython will fix it. Especially because the Sage patch here is quite invasive (adding new auto-generated files).\n\nI might be able to get my branch working without https://github.com/cython/cython/pull/1650 if that turns out to be problematic. But https://github.com/cython/cython/pull/1687 is really crucial for my approach to work.",
    "created_at": "2017-05-14T13:59:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314478",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

There are various changes on this patch which seem unrelated to Cygwin support: are those really needed? For example

```diff
diff --git a/src/sage_setup/autogen/interpreters/specs/rr.py b/src/sage_setup/autogen/interpreters/specs/rr.py
index f4d3dc5..fe7a5cb 100644
--- a/src/sage_setup/autogen/interpreters/specs/rr.py
+++ b/src/sage_setup/autogen/interpreters/specs/rr.py
@@ -184,9 +183,9 @@ class RRInterpreter(StackInterpreter):
                         S=self.mc_stack,
                         P=self.mc_py_constants)
         self.pg = pg
+        self.h_header = '#include <mpfr.h>'
         self.c_header = ri(0,
             '''
-            #include <mpfr.h>
             #include "interpreters/wrapper_rr.h"
             ''')
```

For the record: I prefer the solution of patching Cython and hoping that upstream Cython will fix it. Especially because the Sage patch here is quite invasive (adding new auto-generated files).

I might be able to get my branch working without https://github.com/cython/cython/pull/1650 if that turns out to be problematic. But https://github.com/cython/cython/pull/1687 is really crucial for my approach to work.



---

archive/issue_comments_314479.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI don't think you can get it working without PR 1650 either.  I mean all power to you if you can, but I tried and failed some time ago.  You know Cython's inner workings better than I do though.\n\nThe change you mention, however, was necessary for some reason. I just don't remember what it was because I worked on it, oh, 8 months ago.  But I'm fine with dumping it if you can put together an alternative branch including the necessary patches to Cython.  I'm still not super happy about the `|` syntax though, or the possibility of needing to change it later.  Another problem is that it's being put in unconditionally, which really this is only a problem on Windows, and yet you'd force downstream packagers (e.g. on Debian) to accept this patch to Cython in order for Sage to build *at all*.  So I don't think it's a good idea unless you can find some other workaround.",
    "created_at": "2017-05-15T12:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314479",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

I don't think you can get it working without PR 1650 either.  I mean all power to you if you can, but I tried and failed some time ago.  You know Cython's inner workings better than I do though.

The change you mention, however, was necessary for some reason. I just don't remember what it was because I worked on it, oh, 8 months ago.  But I'm fine with dumping it if you can put together an alternative branch including the necessary patches to Cython.  I'm still not super happy about the `|` syntax though, or the possibility of needing to change it later.  Another problem is that it's being put in unconditionally, which really this is only a problem on Windows, and yet you'd force downstream packagers (e.g. on Debian) to accept this patch to Cython in order for Sage to build *at all*.  So I don't think it's a good idea unless you can find some other workaround.



---

archive/issue_comments_314480.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\n`@`Eric: could you try moving back the headers include and check it still work?\n\nI would be very happy if Sage 8.0 could support Cygwin...",
    "created_at": "2017-05-16T08:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314480",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:35" align="right">comment:35</div>

`@`Eric: could you try moving back the headers include and check it still work?

I would be very happy if Sage 8.0 could support Cygwin...



---

archive/issue_comments_314481.json:
```json
{
    "body": "Changed branch from **[u/embray/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/interpreters)** to **[u/jdemeyer/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cygwin/interpreters)**",
    "created_at": "2017-06-09T10:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314481",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin/interpreters)** to **[u/jdemeyer/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cygwin/interpreters)**



---

archive/issue_comments_314482.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThis seems to work without needing any additional Cython patches...\n\nIt's still a slight hack, but at least a simple hack.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86\"><code>f6cfbfc</code></a></td><td><code>Fix build of interpreters on Cygwin</code></td></tr></table>\n",
    "created_at": "2017-06-09T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314482",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

This seems to work without needing any additional Cython patches...

It's still a slight hack, but at least a simple hack.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86"><code>f6cfbfc</code></a></td><td><code>Fix build of interpreters on Cygwin</code></td></tr></table>




---

archive/issue_comments_314483.json:
```json
{
    "body": "Changed commit from **[`954772a`](https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf)** to **[`f6cfbfc`](https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86)**",
    "created_at": "2017-06-09T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314483",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`954772a`](https://github.com/sagemath/sagetrac-mirror/commit/954772aa3f9f69ba5b986f64d7feed5a99a189cf)** to **[`f6cfbfc`](https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86)**



---

archive/issue_comments_314484.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOkay, I can see why this works.  But while you call it simple (and it is, in terms of impact), it's not very explicit what it's doing or why.  I don't mind that, if it works, for now, but it definitely needs more explanation about why it's needed and what it's doing (and under what circumstances it could eventually be removed).",
    "created_at": "2017-06-09T11:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314484",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

Okay, I can see why this works.  But while you call it simple (and it is, in terms of impact), it's not very explicit what it's doing or why.  I don't mind that, if it works, for now, but it definitely needs more explanation about why it's needed and what it's doing (and under what circumstances it could eventually be removed).



---

archive/issue_comments_314485.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI am correct when interpreting your comment as \"I accept Jeroen's patch, provided that some documentation is added\"?",
    "created_at": "2017-06-09T12:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314485",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

I am correct when interpreting your comment as "I accept Jeroen's patch, provided that some documentation is added"?



---

archive/issue_comments_314486.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nYes.",
    "created_at": "2017-06-09T12:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314486",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Yes.



---

archive/issue_comments_314487.json:
```json
{
    "body": "Changed commit from **[`f6cfbfc`](https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86)** to **[`3ed8029`](https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04)**",
    "created_at": "2017-06-09T20:48:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314487",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6cfbfc`](https://github.com/sagemath/sagetrac-mirror/commit/f6cfbfc4f2f25aba8b8f405c1b383d975a25af86)** to **[`3ed8029`](https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04)**



---

archive/issue_comments_314488.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04\"><code>3ed8029</code></a></td><td><code>Expand comment</code></td></tr></table>\n",
    "created_at": "2017-06-09T20:48:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314488",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04"><code>3ed8029</code></a></td><td><code>Expand comment</code></td></tr></table>




---

archive/issue_comments_314489.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nPing?",
    "created_at": "2017-06-14T08:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314489",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Ping?



---

archive/issue_comments_314490.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nShouldn't it at least have a link back to this ticket?  Or if nothing else, we should open a new ticket to not forget to implement a \"better\" fix if/when the needed capabilities are in Cython.",
    "created_at": "2017-06-14T09:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314490",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

Shouldn't it at least have a link back to this ticket?  Or if nothing else, we should open a new ticket to not forget to implement a "better" fix if/when the needed capabilities are in Cython.



---

archive/issue_comments_314491.json:
```json
{
    "body": "Changed commit from **[`3ed8029`](https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04)** to **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**",
    "created_at": "2017-06-14T10:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314491",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3ed8029`](https://github.com/sagemath/sagetrac-mirror/commit/3ed8029dd68701b38be6623d9a2556d9a8d24c04)** to **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**



---

archive/issue_comments_314492.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28\"><code>18348bf</code></a></td><td><code>Expand expanded comment</code></td></tr></table>\n",
    "created_at": "2017-06-14T10:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314492",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28"><code>18348bf</code></a></td><td><code>Expand expanded comment</code></td></tr></table>




---

archive/issue_comments_314493.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nJust doing commit pushes don't send trac e-mails unless you are in cc I've found.",
    "created_at": "2017-06-14T12:07:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314493",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Just doing commit pushes don't send trac e-mails unless you are in cc I've found.



---

archive/issue_comments_314494.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n(That was meant as a ping for Erik to note that Jeroen pushed another commit.)",
    "created_at": "2017-06-16T13:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314494",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

(That was meant as a ping for Erik to note that Jeroen pushed another commit.)



---

archive/issue_events_298776.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-06-16T16:01:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298776"
}
```



---

archive/issue_events_298777.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-06-16T16:01:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298777"
}
```



---

archive/issue_comments_314495.json:
```json
{
    "body": "Changed reviewer from **Jean-Pierre Flori** to **Jean-Pierre Flori, Erik Bray**",
    "created_at": "2017-06-16T16:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314495",
    "user": "https://github.com/embray"
}
```

Changed reviewer from **Jean-Pierre Flori** to **Jean-Pierre Flori, Erik Bray**



---

archive/issue_comments_314496.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Jeroen Demeyer**",
    "created_at": "2017-06-16T16:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314496",
    "user": "https://github.com/embray"
}
```

Changed author from **Erik Bray** to **Jeroen Demeyer**



---

archive/issue_comments_314497.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nDashed off a ticket to remind to fix this later: #23258",
    "created_at": "2017-06-16T16:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314497",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

Dashed off a ticket to remind to fix this later: #23258



---

archive/issue_comments_314498.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cygwin/interpreters)** to **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**",
    "created_at": "2017-06-17T10:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21459#issuecomment-314498",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/cygwin/interpreters](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/cygwin/interpreters)** to **[`18348bf`](https://github.com/sagemath/sagetrac-mirror/commit/18348bf417a6e05284e25803b28f394da2e90f28)**



---

archive/issue_events_298778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-17T10:29:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298778"
}
```



---

archive/issue_events_298779.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6a1420e8da933c53ce35d9cf2cf607867fee1d54",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-17T10:29:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21459",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21459#event-298779"
}
```
