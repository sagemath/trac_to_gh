# Issue 21566: Meta-ticket: Make sage (the distribution) behave like a standard autotools package, to the extent possible

archive/issues_021329.json:
```json
{
    "body": "The goal of this ticket is to be able to explain to experienced Unix users what sage-the-distribution is, as follows:\n\n If you download sage-the-distribution and do\n\n ```\n ./configure --prefix=/SOMEWHERE && make \n ```\n then that's the same as doing a sequence of about 100 times: \n\n ```\nwget SOMEPACKAGE.tar.gz && tar xf SOMEPACKAGE.tar.gz && (cd SOMEPACKAGE \\\n&& ./configure --prefix=/SOMEWHERE && make && make install)\n ```\n (and about a 50 times `pip install SOMEPACKAGE`).\n sage-the-distribution has figured out the right order of installing these packages, tricky configure options so that everything works, and on top has fixes for various outdated/handwritten/missing build systems of various packages.\n\nThus it is beyond the scope of this ticket:\n- to separate `make` and `make install`. Our `make install` is a no-op. ANY discussion of this needs to go to ticket #21495, not here.\n\nWe will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages; and that `./configure` is an *optional* step of the installation process).\n\nWe have a separate task ticket for the following:\n- #21507: Make sagelib (sage-the-Python-library) a normal Python package, installable by `setup.py`, `pip`, etc. and eventually even via PyPI.  We will NOT turn sagelib to an automake package (which was proposed in #14807). \n(There will be some interaction with some of the steps of that ticket.)\n\nIncluded on this ticket are the following steps.\n\nImplement standard features expected of an autotools build system.\n\n- Choosing the installation hierarchy (`configure --prefix=SAGE_LOCAL`). Right now it is the subdirectory `local` of `SAGE_ROOT`. \n  - #21501: Allow SAGE_LOCAL to be customized\n  - #21534: Allow SAGE_LOCAL to be customized - follow-up\n  - #21479: ./configure --prefix=SAGE_LOCAL\n- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to the environment variables `SAGE_LOCAL`, or `SAGE_ROOT` (or `SAGE_SRC_ROOT`). An exception could perhaps be made for the latter for \"debugging\" or \"source inspection\" facilities:\n  - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`\n  - #21509: Install cython_debug somewhere in SAGE_LOCAL\n- #21539: `make V=0` should silence the build\n- #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)\n- #21591: Replace use of `SAGE_ROOT` by more specific environment variables\n- #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n- #22646: `./configure CC=/path/to/gcc ...`\n- #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)\n- #29113: Reimplement `sage -i SPKG` for optional/experimental packages as `configure --enable-SPKG && make build` (follow-up: #29626)\n- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n- Various other `configure` options, to replace use of environment variables that influence the build.\n\nClean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.\n- #21532: Create `SAGE_LOCAL` directory hierarchy during `make`, not `configure`\n- #21524: `configure.ac`: write `build/make/Makefile` within an `AC_CONFIG_COMMANDS`, not during main `configure`\n\nMake the separation between sage-the-distribution and sagelib (sage-the-Python-library) clearer. This will be beneficial for distributions such as Debian etc.\n- #21559: Move sage-the-distribution scripts from `src/bin` to `build/bin`\n- #21565: Add src/README.txt and build/README.txt\n\nFollowing are workarounds to enable root-owned installation hierarchies (`prefix`).\n- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:\n  - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)\n- #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`\n\nSee also:\n- #29133 META-META-TICKET: Build, packaging, testing improvements\n\n\n\n**CC:**  @vbraun @jdemeyer @kiwifb @embray @dimpase @williamstein @mezzarobba @tobihan @timokau @jhpalmieri @seblabbe\n\n**Author:** Matthias Koeppe\n\n**Status:** new\n\nIssue created by migration from https://trac.sagemath.org/ticket/21566\n\n",
    "created_at": "2016-09-22T18:27:28Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Make sage (the distribution) behave like a standard autotools package, to the extent possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21566",
    "user": "https://github.com/mkoeppe"
}
```
The goal of this ticket is to be able to explain to experienced Unix users what sage-the-distribution is, as follows:

 If you download sage-the-distribution and do

 ```
 ./configure --prefix=/SOMEWHERE && make 
 ```
 then that's the same as doing a sequence of about 100 times: 

 ```
wget SOMEPACKAGE.tar.gz && tar xf SOMEPACKAGE.tar.gz && (cd SOMEPACKAGE \
&& ./configure --prefix=/SOMEWHERE && make && make install)
 ```
 (and about a 50 times `pip install SOMEPACKAGE`).
 sage-the-distribution has figured out the right order of installing these packages, tricky configure options so that everything works, and on top has fixes for various outdated/handwritten/missing build systems of various packages.

Thus it is beyond the scope of this ticket:
- to separate `make` and `make install`. Our `make install` is a no-op. ANY discussion of this needs to go to ticket #21495, not here.

We will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages; and that `./configure` is an *optional* step of the installation process).

We have a separate task ticket for the following:
- #21507: Make sagelib (sage-the-Python-library) a normal Python package, installable by `setup.py`, `pip`, etc. and eventually even via PyPI.  We will NOT turn sagelib to an automake package (which was proposed in #14807). 
(There will be some interaction with some of the steps of that ticket.)

Included on this ticket are the following steps.

Implement standard features expected of an autotools build system.

- Choosing the installation hierarchy (`configure --prefix=SAGE_LOCAL`). Right now it is the subdirectory `local` of `SAGE_ROOT`. 
  - #21501: Allow SAGE_LOCAL to be customized
  - #21534: Allow SAGE_LOCAL to be customized - follow-up
  - #21479: ./configure --prefix=SAGE_LOCAL
- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to the environment variables `SAGE_LOCAL`, or `SAGE_ROOT` (or `SAGE_SRC_ROOT`). An exception could perhaps be made for the latter for "debugging" or "source inspection" facilities:
  - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`
  - #21509: Install cython_debug somewhere in SAGE_LOCAL
- #21539: `make V=0` should silence the build
- #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)
- #21591: Replace use of `SAGE_ROOT` by more specific environment variables
- #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
- #22646: `./configure CC=/path/to/gcc ...`
- #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)
- #29113: Reimplement `sage -i SPKG` for optional/experimental packages as `configure --enable-SPKG && make build` (follow-up: #29626)
- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
- Various other `configure` options, to replace use of environment variables that influence the build.

Clean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.
- #21532: Create `SAGE_LOCAL` directory hierarchy during `make`, not `configure`
- #21524: `configure.ac`: write `build/make/Makefile` within an `AC_CONFIG_COMMANDS`, not during main `configure`

Make the separation between sage-the-distribution and sagelib (sage-the-Python-library) clearer. This will be beneficial for distributions such as Debian etc.
- #21559: Move sage-the-distribution scripts from `src/bin` to `build/bin`
- #21565: Add src/README.txt and build/README.txt

Following are workarounds to enable root-owned installation hierarchies (`prefix`).
- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:
  - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)
- #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`

See also:
- #29133 META-META-TICKET: Build, packaging, testing improvements



**CC:**  @vbraun @jdemeyer @kiwifb @embray @dimpase @williamstein @mezzarobba @tobihan @timokau @jhpalmieri @seblabbe

**Author:** Matthias Koeppe

**Status:** new

Issue created by migration from https://trac.sagemath.org/ticket/21566





---

archive/issue_comments_400339.json:
```json
{
    "body": "<a id='comment:3'></a>\nDo you intend `./configure` to detect already installed dependencies so that `make` skips installing them? (Eventually? as part of this task?) For example, is the idea that `./configure` would finish by saying something like \u201cthe following dependencies are missing: ... please install them, or type `make` and I'll install my own copy\u201d? (This wouldn't be *quite* standard, but close enough, while staying mostly compatible with the installation procedure of sage-the-distribution.)\n\nOr would sage-the-distribution still always have its private version of everything, so that users would have to choose between installing it and installing sagelib directly (e.g., via pip)?",
    "created_at": "2016-09-23T13:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400339",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:3'></a>
Do you intend `./configure` to detect already installed dependencies so that `make` skips installing them? (Eventually? as part of this task?) For example, is the idea that `./configure` would finish by saying something like “the following dependencies are missing: ... please install them, or type `make` and I'll install my own copy”? (This wouldn't be *quite* standard, but close enough, while staying mostly compatible with the installation procedure of sage-the-distribution.)

Or would sage-the-distribution still always have its private version of everything, so that users would have to choose between installing it and installing sagelib directly (e.g., via pip)?



---

archive/issue_comments_400340.json:
```json
{
    "body": "<a id='comment:4'></a>\n(Sorry, the comment that was here previously was meant to go on #21507 -- I have too many tabs open)",
    "created_at": "2016-09-23T13:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400340",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
(Sorry, the comment that was here previously was meant to go on #21507 -- I have too many tabs open)



---

archive/issue_comments_400341.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mmezzarobba](#comment%3A3):\n> Do you intend `./configure` to detect already installed dependencies so that `make` skips installing them? (Eventually? as part of this task?) \n\n\nThat is beyond the scope of this task ticket. But I would be interested in a follow-up ticket to this effect.",
    "created_at": "2016-09-23T15:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400341",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [mmezzarobba](#comment%3A3):
> Do you intend `./configure` to detect already installed dependencies so that `make` skips installing them? (Eventually? as part of this task?) 


That is beyond the scope of this task ticket. But I would be interested in a follow-up ticket to this effect.



---

archive/issue_comments_400342.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,6 +35,7 @@\n   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`\n   - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21539: `make V=0` should silence the build\n+- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n - #21538: `./configure --with-packages=...`\n - Various other `configure` options, to replace use of environment variables that influence the build.\n``````\n",
    "created_at": "2016-09-24T21:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400342",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,6 +35,7 @@
   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`
   - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21539: `make V=0` should silence the build
+- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
 - #21538: `./configure --with-packages=...`
 - Various other `configure` options, to replace use of environment variables that influence the build.
``````




---

archive/issue_comments_400343.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -31,7 +31,7 @@\n   - #21501: Allow SAGE_LOCAL to be customized\n   - #21534: Allow SAGE_LOCAL to be customized - follow-up\n   - #21479: ./configure --prefix=SAGE_LOCAL\n-- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to `SAGE_ROOT` (or `SAGE_SRC_ROOT`), except perhaps for \"debugging\" or \"source inspection\" facilities:\n+- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to the environment variables `SAGE_LOCAL`, or `SAGE_ROOT` (or `SAGE_SRC_ROOT`). An exception could perhaps be made for the latter for \"debugging\" or \"source inspection\" facilities:\n   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`\n   - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21539: `make V=0` should silence the build\n``````\n",
    "created_at": "2016-09-24T22:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400343",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -31,7 +31,7 @@
   - #21501: Allow SAGE_LOCAL to be customized
   - #21534: Allow SAGE_LOCAL to be customized - follow-up
   - #21479: ./configure --prefix=SAGE_LOCAL
-- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to `SAGE_ROOT` (or `SAGE_SRC_ROOT`), except perhaps for "debugging" or "source inspection" facilities:
+- By allowing the user to choose the installation hierarchy, there are new requirements. What is installed there should run without requiring environment variables to be set. It should not refer to the environment variables `SAGE_LOCAL`, or `SAGE_ROOT` (or `SAGE_SRC_ROOT`). An exception could perhaps be made for the latter for "debugging" or "source inspection" facilities:
   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`
   - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21539: `make V=0` should silence the build
``````




---

archive/issue_comments_400344.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,6 +36,7 @@\n   - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21539: `make V=0` should silence the build\n - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n+- #21591: Replace use of `SAGE_ROOT` by more specific environment variables\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n - #21538: `./configure --with-packages=...`\n - Various other `configure` options, to replace use of environment variables that influence the build.\n``````\n",
    "created_at": "2016-09-24T22:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400344",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,6 +36,7 @@
   - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21539: `make V=0` should silence the build
 - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
+- #21591: Replace use of `SAGE_ROOT` by more specific environment variables
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
 - #21538: `./configure --with-packages=...`
 - Various other `configure` options, to replace use of environment variables that influence the build.
``````




---

archive/issue_comments_400345.json:
```json
{
    "body": "<a id='comment:9'></a>\nWill this also fix how `make` actually runs `configure` for you, and that `configure` gets invoked even if you run `make clean` targets?",
    "created_at": "2016-10-05T09:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400345",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Will this also fix how `make` actually runs `configure` for you, and that `configure` gets invoked even if you run `make clean` targets?



---

archive/issue_comments_400346.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n Thus it is beyond the scope of this ticket:\n - to separate `make` and `make install`. Our `make install` is a no-op. ANY discussion of this needs to go to ticket #21495, not here.\n \n-We will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages).\n+We will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages; and that `./configure` is an *optional* step of the installation process).\n \n We have a separate task ticket for the following:\n - #21507: Make sagelib (sage-the-Python-library) a normal Python package, installable by `setup.py`, `pip`, etc. and eventually even via PyPI.  We will NOT turn sagelib to an automake package (which was proposed in #14807). \n``````\n",
    "created_at": "2016-10-05T17:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400346",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 Thus it is beyond the scope of this ticket:
 - to separate `make` and `make install`. Our `make install` is a no-op. ANY discussion of this needs to go to ticket #21495, not here.
 
-We will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages).
+We will implement this goal without sacrificing any of the traditional convenience features that Sage-the-distribution has provided for the casual user (such as `sage -i` for installing packages; and that `./configure` is an *optional* step of the installation process).
 
 We have a separate task ticket for the following:
 - #21507: Make sagelib (sage-the-Python-library) a normal Python package, installable by `setup.py`, `pip`, etc. and eventually even via PyPI.  We will NOT turn sagelib to an automake package (which was proposed in #14807). 
``````




---

archive/issue_comments_400347.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [embray](#comment%3A9):\n> Will this also fix how `make` actually runs `configure` for you, \n\n\nNo, probably not. For this ticket, I want to keep `configure` an *optional* step of the installation process. (I've updated the description.)\n\n> and that `configure` gets invoked even if you run `make clean` targets?\n\n\nNot sure about this one. To keep this ticket manageable, I want to change the top-level `Makefile` as little as possible. But please do open a ticket that describes `make clean` issues that ought to be addressed.",
    "created_at": "2016-10-05T17:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [embray](#comment%3A9):
> Will this also fix how `make` actually runs `configure` for you, 


No, probably not. For this ticket, I want to keep `configure` an *optional* step of the installation process. (I've updated the description.)

> and that `configure` gets invoked even if you run `make clean` targets?


Not sure about this one. To keep this ticket manageable, I want to change the top-level `Makefile` as little as possible. But please do open a ticket that describes `make clean` issues that ought to be addressed.



---

archive/issue_comments_400348.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A10):\n> Replying to [embray](#comment%3A9):\n> > Will this also fix how `make` actually runs `configure` for you, \n\n> \n> No, probably not. For this ticket, I want to keep `configure` an *optional* step of the installation process. (I've updated the description.)\n\n\nI guess it would be fine to make it an optional step.  But I don't think it should be a *mandatory* step for all make targets, and currently it is, or at least seems to be.  For example if I run `make maintainer-clean` twice in a row, the second time will run `configure` only to delete its output.\n\nThis is especially annoying on Cygwin where `configure` is *extremely slow*.",
    "created_at": "2016-10-06T09:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400348",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A10):
> Replying to [embray](#comment%3A9):
> > Will this also fix how `make` actually runs `configure` for you, 

> 
> No, probably not. For this ticket, I want to keep `configure` an *optional* step of the installation process. (I've updated the description.)


I guess it would be fine to make it an optional step.  But I don't think it should be a *mandatory* step for all make targets, and currently it is, or at least seems to be.  For example if I run `make maintainer-clean` twice in a row, the second time will run `configure` only to delete its output.

This is especially annoying on Cygwin where `configure` is *extremely slow*.



---

archive/issue_comments_400349.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [embray](#comment%3A9):\n> Will this also fix how `make` actually runs `configure` for you, and that `configure` gets invoked even if you run `make clean` targets?\n\n\nIn standard autotools packages, the `Makefile` gets *created* by `configure`, so you wouldn't be able to run `make clean` either without `configure`.",
    "created_at": "2016-10-06T12:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400349",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [embray](#comment%3A9):
> Will this also fix how `make` actually runs `configure` for you, and that `configure` gets invoked even if you run `make clean` targets?


In standard autotools packages, the `Makefile` gets *created* by `configure`, so you wouldn't be able to run `make clean` either without `configure`.



---

archive/issue_comments_400350.json:
```json
{
    "body": "<a id='comment:13'></a>\nTrue--in that case it should (hopefully) be a moot point.  This is currently a huge annoyance for me.",
    "created_at": "2016-10-07T08:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400350",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
True--in that case it should (hopefully) be a moot point.  This is currently a huge annoyance for me.



---

archive/issue_comments_400351.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -51,4 +51,5 @@\n \n Following are workarounds to enable root-owned installation hierarchies (`prefix`).\n - #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package\n+- #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)\n - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`\n``````\n",
    "created_at": "2016-10-26T05:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400351",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -51,4 +51,5 @@
 
 Following are workarounds to enable root-owned installation hierarchies (`prefix`).
 - #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package
+- #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)
 - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`
``````




---

archive/issue_comments_400352.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,6 +35,7 @@\n   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`\n   - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21539: `make V=0` should silence the build\n+- #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)\n - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n - #21591: Replace use of `SAGE_ROOT` by more specific environment variables\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n``````\n",
    "created_at": "2016-10-27T15:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400352",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,6 +35,7 @@
   - #21525: package `autotools`: Don't depend on `$SAGE_LOCAL`
   - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21539: `make V=0` should silence the build
+- #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)
 - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
 - #21591: Replace use of `SAGE_ROOT` by more specific environment variables
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
``````




---

archive/issue_comments_400353.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -51,6 +51,6 @@\n - #21565: Add src/README.txt and build/README.txt\n \n Following are workarounds to enable root-owned installation hierarchies (`prefix`).\n-- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package\n-- #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)\n+- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:\n+  - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)\n - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`\n``````\n",
    "created_at": "2016-11-08T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400353",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -51,6 +51,6 @@
 - #21565: Add src/README.txt and build/README.txt
 
 Following are workarounds to enable root-owned installation hierarchies (`prefix`).
-- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package
-- #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)
+- #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:
+  - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)
 - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`
``````




---

archive/issue_comments_400354.json:
```json
{
    "body": "<a id='comment:18'></a>\nDo we have a ticket somewhere for adding more configure-time checks for system packages?   If there is I can't find it.\n\nIt's a little outside the scope of this ticket but not entirely.  There are quite a few system packages installed by sage that could be skipped if we added the appropriate scripts to check for them.",
    "created_at": "2017-01-09T09:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400354",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Do we have a ticket somewhere for adding more configure-time checks for system packages?   If there is I can't find it.

It's a little outside the scope of this ticket but not entirely.  There are quite a few system packages installed by sage that could be skipped if we added the appropriate scripts to check for them.



---

archive/issue_comments_400355.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [embray](#comment%3A18):\n> Do we have a ticket somewhere for adding more configure-time checks for system packages?   If there is I can't find it.\n\n\nNo, we don't. Feel free to open a ticket. I would prefer one ticket for every package, not a single ticket trying to do too much.",
    "created_at": "2017-01-09T10:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400355",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Replying to [embray](#comment%3A18):
> Do we have a ticket somewhere for adding more configure-time checks for system packages?   If there is I can't find it.


No, we don't. Feel free to open a ticket. I would prefer one ticket for every package, not a single ticket trying to do too much.



---

archive/issue_comments_400356.json:
```json
{
    "body": "<a id='comment:20'></a>\nI agree--I probably won't even make a ticket for *every* package right away but I will make a master ticket for coordinating the task, and then open individual tickets for packages that I think are most worth tackling.",
    "created_at": "2017-01-09T16:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400356",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
I agree--I probably won't even make a ticket for *every* package right away but I will make a master ticket for coordinating the task, and then open individual tickets for packages that I think are most worth tackling.



---

archive/issue_comments_400357.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,6 +40,7 @@\n - #21591: Replace use of `SAGE_ROOT` by more specific environment variables\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n - #21538: `./configure --with-packages=...`\n+- #22646: `./configure CC=/path/to/gcc ...`\n - Various other `configure` options, to replace use of environment variables that influence the build.\n \n Clean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.\n``````\n",
    "created_at": "2017-03-19T05:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400357",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,6 +40,7 @@
 - #21591: Replace use of `SAGE_ROOT` by more specific environment variables
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
 - #21538: `./configure --with-packages=...`
+- #22646: `./configure CC=/path/to/gcc ...`
 - Various other `configure` options, to replace use of environment variables that influence the build.
 
 Clean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.
``````




---

archive/issue_comments_400358.json:
```json
{
    "body": "<a id='comment:22'></a>\nWould someone who has followed recent build system changes be interested in updating the description of this meta-ticket?",
    "created_at": "2017-07-07T17:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400358",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Would someone who has followed recent build system changes be interested in updating the description of this meta-ticket?



---

archive/issue_comments_400359.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [mkoeppe](#comment%3A22):\n> Would someone who has followed recent build system changes be interested in updating the description of this meta-ticket?\n\n\nWhich build system changes specifically?  I have a few open tickets that are making some not insignificant changes, but they don't terribly change things for this ticket. If anything they will help make it easier to implement the goals of this ticket.  There is one small conflict I can see: The work I'm doing in #22509 and in #23160 will mostly supersede the work you already did in #21537.  This is because the `sdh_make_install` helper function I added will also handle `$SAGE_SUDO`.\n\nRight now I'm working toward the goals I outlined [here](https://groups.google.com/d/msg/sage-devel/nTwhCV89FXE/_7GdzGy4BgAJ) for improving support for building Sage against dependencies from the system.  However, I haven't even made tickets for every aspect of that plan yet.  All the work I'm currently doing is toward #22509 and #22510 which I see as necessary for saner package management in Sage (they will also be very helpful for work I need to do of making it easier to install optional packages with the Windows installer, but that's otherwise an orthogonal issue).",
    "created_at": "2017-07-10T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400359",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
Replying to [mkoeppe](#comment%3A22):
> Would someone who has followed recent build system changes be interested in updating the description of this meta-ticket?


Which build system changes specifically?  I have a few open tickets that are making some not insignificant changes, but they don't terribly change things for this ticket. If anything they will help make it easier to implement the goals of this ticket.  There is one small conflict I can see: The work I'm doing in #22509 and in #23160 will mostly supersede the work you already did in #21537.  This is because the `sdh_make_install` helper function I added will also handle `$SAGE_SUDO`.

Right now I'm working toward the goals I outlined [here](https://groups.google.com/d/msg/sage-devel/nTwhCV89FXE/_7GdzGy4BgAJ) for improving support for building Sage against dependencies from the system.  However, I haven't even made tickets for every aspect of that plan yet.  All the work I'm currently doing is toward #22509 and #22510 which I see as necessary for saner package management in Sage (they will also be very helpful for work I need to do of making it easier to install optional packages with the Windows installer, but that's otherwise an orthogonal issue).



---

archive/issue_events_065046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T17:20:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65046"
}
```



---

archive/issue_comments_400360.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,11 +36,11 @@\n   - #21509: Install cython_debug somewhere in SAGE_LOCAL\n - #21539: `make V=0` should silence the build\n - #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)\n-- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n - #21591: Replace use of `SAGE_ROOT` by more specific environment variables\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n-- #21538: `./configure --with-packages=...`\n - #22646: `./configure CC=/path/to/gcc ...`\n+- #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)\n+- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n - Various other `configure` options, to replace use of environment variables that influence the build.\n \n Clean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.\n``````\n",
    "created_at": "2020-05-01T17:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400360",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,11 +36,11 @@
   - #21509: Install cython_debug somewhere in SAGE_LOCAL
 - #21539: `make V=0` should silence the build
 - #21775: make distclean: Don't delete the install hierarchy (SAGE_LOCAL)
-- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
 - #21591: Replace use of `SAGE_ROOT` by more specific environment variables
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
-- #21538: `./configure --with-packages=...`
 - #22646: `./configure CC=/path/to/gcc ...`
+- #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)
+- #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
 - Various other `configure` options, to replace use of environment variables that influence the build.
 
 Clean up parts of the build system to make it more standard. This is to make it straightforward for developers familiar with the autotools system to contribute to sage.
``````




---

archive/issue_events_065047.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "rename": {
        "from": "Task ticket: Make sage (the distribution) behave like a standard autotools package, to the extent possible",
        "to": "Meta-ticket: Make sage (the distribution) behave like a standard autotools package, to the extent possible"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65047"
}
```



---

archive/issue_comments_400361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,6 +40,7 @@\n - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)\n - #22646: `./configure CC=/path/to/gcc ...`\n - #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)\n+- #29113: Reimplement `sage -i SPKG` for optional/experimental packages as `configure --enable-SPKG && make build` (follow-up: #29626)\n - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`\n - Various other `configure` options, to replace use of environment variables that influence the build.\n \n``````\n",
    "created_at": "2020-05-01T17:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400361",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,6 +40,7 @@
 - #21469: Enable VPATH builds (`SAGE_SRC_ROOT/configure --srcdir=SAGE_SRC_ROOT`)
 - #22646: `./configure CC=/path/to/gcc ...`
 - #28095: Add --enable-OPTIONALSPKG options to configure (see also earlier #21538)
+- #29113: Reimplement `sage -i SPKG` for optional/experimental packages as `configure --enable-SPKG && make build` (follow-up: #29626)
 - #21589: Make `make V=0` the default by `./configure --enable-silent-rules`
 - Various other `configure` options, to replace use of environment variables that influence the build.
 
``````




---

archive/issue_comments_400362.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -56,3 +56,8 @@\n - #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:\n   - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)\n - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`\n+\n+See also:\n+- #29133 META-META-TICKET: Build, packaging, testing improvements\n+\n+\n``````\n",
    "created_at": "2020-05-01T17:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400362",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -56,3 +56,8 @@
 - #21537: If `$SAGE_SUDO` is set, use it whenever we do `make install` of a package. Subtickets:
   - #21726: Support splitting spkg install into `spkg-build` and `spkg-install` (for SAGE_SUDO)
 - #21536: documentation: Recommend GNU stow to people who want to install to `/usr/local`
+
+See also:
+- #29133 META-META-TICKET: Build, packaging, testing improvements
+
+
``````




---

archive/issue_events_065048.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65048"
}
```



---

archive/issue_events_065049.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65049"
}
```



---

archive/issue_events_065050.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65050"
}
```



---

archive/issue_events_065051.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65051"
}
```



---

archive/issue_comments_400363.json:
```json
{
    "body": "<a id='comment:30'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21566#issuecomment-400363",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_065052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65052"
}
```



---

archive/issue_events_065053.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65053"
}
```



---

archive/issue_events_065054.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65054"
}
```



---

archive/issue_events_065055.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65055"
}
```



---

archive/issue_events_065056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65056"
}
```



---

archive/issue_events_065057.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65057"
}
```



---

archive/issue_events_065058.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65058"
}
```



---

archive/issue_events_065059.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21566",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21566#event-65059"
}
```
