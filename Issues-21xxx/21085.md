# Issue 21085: Blow ups and resolution of singularities for curves

archive/issues_020848.json:
```json
{
    "body": "Implement functions to compute the blow up of an affine curve at a point, and to construct a nonsingular model for the curve by blowing up its singular points. These functions should describe the blow up/nonsingular model in terms of affine patches.\n\nCC:  @bhutz @miguelmarco\n\nKeywords: gsoc2016\n\nReviewer: Ben Hutz\n\nAuthor: Grayson Jorgenson\n\nBranch: bebf7b02f5cbe21fe85975821414b78fa65efadc\n\nDependencies: #21168, #21285\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21085\n\n",
    "closed_at": "2016-08-24T06:45:19Z",
    "created_at": "2016-07-24T18:20:34Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Blow ups and resolution of singularities for curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21085",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```
Implement functions to compute the blow up of an affine curve at a point, and to construct a nonsingular model for the curve by blowing up its singular points. These functions should describe the blow up/nonsingular model in terms of affine patches.

CC:  @bhutz @miguelmarco

Keywords: gsoc2016

Reviewer: Ben Hutz

Author: Grayson Jorgenson

Branch: bebf7b02f5cbe21fe85975821414b78fa65efadc

Dependencies: #21168, #21285

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21085





---

archive/issue_comments_385926.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gjorgenson/ticket/21085\"",
    "created_at": "2016-07-24T18:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385926",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing branch from "" to "u/gjorgenson/ticket/21085"



---

archive/issue_comments_385927.json:
```json
{
    "body": "Changing commit from \"\" to \"f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1\"",
    "created_at": "2016-07-28T08:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385927",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1"



---

archive/issue_comments_385928.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[f5fc535](https://git.sagemath.org/sage.git/commit/?id=f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1)|`21085: blow ups for affine curves`|",
    "created_at": "2016-07-28T08:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[f5fc535](https://git.sagemath.org/sage.git/commit/?id=f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1)|`21085: blow ups for affine curves`|



---

archive/issue_comments_385929.json:
```json
{
    "body": "Changing commit from \"f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1\" to \"3dd26e7cd33ac155e9d102952701b26c2d6f5b99\"",
    "created_at": "2016-08-12T07:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f5fc535f7ca0a493f7e8b0b33079b8ffbc466fc1" to "3dd26e7cd33ac155e9d102952701b26c2d6f5b99"



---

archive/issue_comments_385930.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[b923e36](https://git.sagemath.org/sage.git/commit/?id=b923e361515f8fceb9d9cc62075ef763c05eba25)|`21085: update the affine blow up function.`|\n|[112b608](https://git.sagemath.org/sage.git/commit/?id=112b6089cbd12d5ae766f55806553a54089f727a)|`Merge branch 'master' into u/gjorgenson/ticket/21085`|\n|[e4ea51e](https://git.sagemath.org/sage.git/commit/?id=e4ea51ed597705e4bf5d7015df020371402da2cd)|`21168: change_ring implementation`|\n|[b80b533](https://git.sagemath.org/sage.git/commit/?id=b80b533f9121f9b84fe82a53a345b8e2f87b42f7)|`21085: merge with ticket 21168 for access to change_ring function`|\n|[3dd26e7](https://git.sagemath.org/sage.git/commit/?id=3dd26e7cd33ac155e9d102952701b26c2d6f5b99)|`21085: resolution of singularities implementation, first attempt`|",
    "created_at": "2016-08-12T07:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[b923e36](https://git.sagemath.org/sage.git/commit/?id=b923e361515f8fceb9d9cc62075ef763c05eba25)|`21085: update the affine blow up function.`|
|[112b608](https://git.sagemath.org/sage.git/commit/?id=112b6089cbd12d5ae766f55806553a54089f727a)|`Merge branch 'master' into u/gjorgenson/ticket/21085`|
|[e4ea51e](https://git.sagemath.org/sage.git/commit/?id=e4ea51ed597705e4bf5d7015df020371402da2cd)|`21168: change_ring implementation`|
|[b80b533](https://git.sagemath.org/sage.git/commit/?id=b80b533f9121f9b84fe82a53a345b8e2f87b42f7)|`21085: merge with ticket 21168 for access to change_ring function`|
|[3dd26e7](https://git.sagemath.org/sage.git/commit/?id=3dd26e7cd33ac155e9d102952701b26c2d6f5b99)|`21085: resolution of singularities implementation, first attempt`|



---

archive/issue_comments_385931.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-12T07:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385931",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from new to needs_review.



---

archive/issue_events_056306.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gjorgenson",
    "created_at": "2016-08-12T07:33:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21085#event-56306"
}
```



---

archive/issue_comments_385932.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21168\"",
    "created_at": "2016-08-12T07:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385932",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing dependencies from "" to "#21168"



---

archive/issue_comments_385933.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Implement functions to compute the blow up of an affine/projective curve at a point. These functions should describe the blow up in terms of affine patches.\n+Implement functions to compute the blow up of an affine curve at a point, and to construct a nonsingular model for the curve by blowing up its singular points. These functions should describe the blow up/nonsingular model in terms of affine patches.\n``````\n",
    "created_at": "2016-08-12T07:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385933",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Implement functions to compute the blow up of an affine/projective curve at a point. These functions should describe the blow up in terms of affine patches.
+Implement functions to compute the blow up of an affine curve at a point, and to construct a nonsingular model for the curve by blowing up its singular points. These functions should describe the blow up/nonsingular model in terms of affine patches.
``````




---

archive/issue_comments_385934.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[4a6bfbf](https://git.sagemath.org/sage.git/commit/?id=4a6bfbfe819f427ec1485b8b1e8ea0a704af6682)|`21085: some minor changes`|",
    "created_at": "2016-08-13T09:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[4a6bfbf](https://git.sagemath.org/sage.git/commit/?id=4a6bfbfe819f427ec1485b8b1e8ea0a704af6682)|`21085: some minor changes`|



---

archive/issue_comments_385935.json:
```json
{
    "body": "Changing commit from \"3dd26e7cd33ac155e9d102952701b26c2d6f5b99\" to \"4a6bfbfe819f427ec1485b8b1e8ea0a704af6682\"",
    "created_at": "2016-08-13T09:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3dd26e7cd33ac155e9d102952701b26c2d6f5b99" to "4a6bfbfe819f427ec1485b8b1e8ea0a704af6682"



---

archive/issue_comments_385936.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-13T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385936",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_385937.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Hutz\"",
    "created_at": "2016-08-13T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385937",
    "user": "https://github.com/bhutz"
}
```

Changing reviewer from "" to "Ben Hutz"



---

archive/issue_comments_385938.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think this is looking good overall. I have a few nits and a couple suggestions.\n\n- you have no examples over `A^3` or higher even though it is in the general curve class\n\n- I'm not sure I like the behavior that you get when you resolve a curve where all the singularities are not rational. You essentially get the curve itself back. Perhaps you should raise an error of the form \"no rational singularities, use extend=True\" or something like that.\n\n  - you should explicitly use the keyword in examples: 'extend=True' instead of just 'True'\n\n- For the extend = True example, here is one that takes < 1s instead of the 3s that yours takes. I didn't look closely at yours, so if it tests additional functionality, then by all means leave it.\n\n```\nC=A.curve(x^4 + 2*x^2 + y^3 + 1)\n```\n- I was testing blowup() and really wanted to pass it a point other than the original. Is that a pain, to translate the point and then translate back?\n\n\n- the error cases are not run in the examples and they should be\n\n- in extension(): two code improvements\n\n```\nL = [pt[j] for j in range(len(self.ambient_space().gens())) for pt in pts]}}\n```\ncan be the simpler\n\n```\nL = [t for pt in pts for t in pt ]\n```\n\nand\n\n```\nK = number_field_elements_from_algebraics(L)[0]\nreturn [K, self.base_ring().embeddings(K)[0]]\n```\ncan be\n\n```\nK,a,phi = ...\nreturn [K,phi]\n```\nsince number_field_elements_from_algebraic returns the embedding it used, so you can return that instead of just the first element of embeddings.",
    "created_at": "2016-08-13T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385938",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:6'></a>
I think this is looking good overall. I have a few nits and a couple suggestions.

- you have no examples over `A^3` or higher even though it is in the general curve class

- I'm not sure I like the behavior that you get when you resolve a curve where all the singularities are not rational. You essentially get the curve itself back. Perhaps you should raise an error of the form "no rational singularities, use extend=True" or something like that.

  - you should explicitly use the keyword in examples: 'extend=True' instead of just 'True'

- For the extend = True example, here is one that takes < 1s instead of the 3s that yours takes. I didn't look closely at yours, so if it tests additional functionality, then by all means leave it.

```
C=A.curve(x^4 + 2*x^2 + y^3 + 1)
```
- I was testing blowup() and really wanted to pass it a point other than the original. Is that a pain, to translate the point and then translate back?


- the error cases are not run in the examples and they should be

- in extension(): two code improvements

```
L = [pt[j] for j in range(len(self.ambient_space().gens())) for pt in pts]}}
```
can be the simpler

```
L = [t for pt in pts for t in pt ]
```

and

```
K = number_field_elements_from_algebraics(L)[0]
return [K, self.base_ring().embeddings(K)[0]]
```
can be

```
K,a,phi = ...
return [K,phi]
```
since number_field_elements_from_algebraic returns the embedding it used, so you can return that instead of just the first element of embeddings.



---

archive/issue_comments_385939.json:
```json
{
    "body": "Changing commit from \"4a6bfbfe819f427ec1485b8b1e8ea0a704af6682\" to \"78e1ce23310ece13ece4eec995b849e5fc95ccf4\"",
    "created_at": "2016-08-14T07:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4a6bfbfe819f427ec1485b8b1e8ea0a704af6682" to "78e1ce23310ece13ece4eec995b849e5fc95ccf4"



---

archive/issue_comments_385940.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[78e1ce2](https://git.sagemath.org/sage.git/commit/?id=78e1ce23310ece13ece4eec995b849e5fc95ccf4)|`21085: changes from review`|",
    "created_at": "2016-08-14T07:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[78e1ce2](https://git.sagemath.org/sage.git/commit/?id=78e1ce23310ece13ece4eec995b849e5fc95ccf4)|`21085: changes from review`|



---

archive/issue_comments_385941.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-14T07:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385941",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_385942.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks! Made most of the changes.\n\nThere were two `A^3` examples in blowup() and resolution_of_singularities() so I left those as is, but I could still add some more higher dim. examples (the output gets long quickly).\n\nFor the extension() function I tried using the composite_fields functionality that number fields have; I think this might be cleaner than the approach I was trying with passing the generator of a number field as a QQbar element to number_field_elements_from_algebraics along with the other QQbar numbers in order to get a bigger field.\n\nI think I could get blowup() to work for arbitrary points. After moving a point to the origin and blowing up, I'm not sure how to transform back though as the blowup will live in a mixed product space. I think maybe just constructing the ideal for the blow up centered at a different point directly might work.\n\nGiven a point `P = (p_1,...,p_n)`, I think the ideal of the blow up at that point would be generated by the polynomials `(x_i - p_i)s_j - (x_j - p_j)s_i` where the `x_i` are the coords for the affine component, and the `s_i` are the coords of the projective component of the product space. I tried something like this in my first attempt at the blowup function, but was unsure whether it was the right construction. Do you think this gives the right ideal? It seems like it should still give the closure of the graph of the rational map defined `(x_1,...,x_n) ---> (x_1 - p_1 :... : x_n - p_n)` which I think is how the blow up at `P` is defined.",
    "created_at": "2016-08-14T07:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385942",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:8'></a>
Thanks! Made most of the changes.

There were two `A^3` examples in blowup() and resolution_of_singularities() so I left those as is, but I could still add some more higher dim. examples (the output gets long quickly).

For the extension() function I tried using the composite_fields functionality that number fields have; I think this might be cleaner than the approach I was trying with passing the generator of a number field as a QQbar element to number_field_elements_from_algebraics along with the other QQbar numbers in order to get a bigger field.

I think I could get blowup() to work for arbitrary points. After moving a point to the origin and blowing up, I'm not sure how to transform back though as the blowup will live in a mixed product space. I think maybe just constructing the ideal for the blow up centered at a different point directly might work.

Given a point `P = (p_1,...,p_n)`, I think the ideal of the blow up at that point would be generated by the polynomials `(x_i - p_i)s_j - (x_j - p_j)s_i` where the `x_i` are the coords for the affine component, and the `s_i` are the coords of the projective component of the product space. I tried something like this in my first attempt at the blowup function, but was unsure whether it was the right construction. Do you think this gives the right ideal? It seems like it should still give the closure of the graph of the rational map defined `(x_1,...,x_n) ---> (x_1 - p_1 :... : x_n - p_n)` which I think is how the blow up at `P` is defined.



---

archive/issue_comments_385943.json:
```json
{
    "body": "<a id='comment:9'></a>\nTHis new resolution functionality looks fine to me.\n\nFor the blow-up, yes that should be the correct ideal to blow up not at the origin. That is almost certainly easier than translating.",
    "created_at": "2016-08-14T14:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385943",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:9'></a>
THis new resolution functionality looks fine to me.

For the blow-up, yes that should be the correct ideal to blow up not at the origin. That is almost certainly easier than translating.



---

archive/issue_comments_385944.json:
```json
{
    "body": "Changing commit from \"78e1ce23310ece13ece4eec995b849e5fc95ccf4\" to \"1cbb355d5f51adf31d06de992798825cead6566b\"",
    "created_at": "2016-08-18T00:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "78e1ce23310ece13ece4eec995b849e5fc95ccf4" to "1cbb355d5f51adf31d06de992798825cead6566b"



---

archive/issue_comments_385945.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[1cbb355](https://git.sagemath.org/sage.git/commit/?id=1cbb355d5f51adf31d06de992798825cead6566b)|`21085: generalized blowup() to work for any point on a given curve`|",
    "created_at": "2016-08-18T00:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[1cbb355](https://git.sagemath.org/sage.git/commit/?id=1cbb355d5f51adf31d06de992798825cead6566b)|`21085: generalized blowup() to work for any point on a given curve`|



---

archive/issue_comments_385946.json:
```json
{
    "body": "Changing commit from \"1cbb355d5f51adf31d06de992798825cead6566b\" to \"78fdd8169cf389b44ff87dcfd0712bc66338114b\"",
    "created_at": "2016-08-18T04:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1cbb355d5f51adf31d06de992798825cead6566b" to "78fdd8169cf389b44ff87dcfd0712bc66338114b"



---

archive/issue_comments_385947.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[d1b1edb](https://git.sagemath.org/sage.git/commit/?id=d1b1edbeb7d51bdda2d5b91572785b2d9aafba58)|`Merge branch 'master' into u/gjorgenson/ticket/21085`|\n|[78fdd81](https://git.sagemath.org/sage.git/commit/?id=78fdd8169cf389b44ff87dcfd0712bc66338114b)|`21085: add import back in that was accidentally removed during merge`|",
    "created_at": "2016-08-18T04:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[d1b1edb](https://git.sagemath.org/sage.git/commit/?id=d1b1edbeb7d51bdda2d5b91572785b2d9aafba58)|`Merge branch 'master' into u/gjorgenson/ticket/21085`|
|[78fdd81](https://git.sagemath.org/sage.git/commit/?id=78fdd8169cf389b44ff87dcfd0712bc66338114b)|`21085: add import back in that was accidentally removed during merge`|



---

archive/issue_comments_385948.json:
```json
{
    "body": "<a id='comment:12'></a>\nOk, I generalized the blowup() function to work for arbitrary points. This simplified some of the code in resolution_of_singularities since there's no longer a need to keep track of change of coordinate maps used to move points to the origin. However, I ran into a couple of issues when testing some higher dimension examples.\n\nIt seems that the way I was trying to isolate the strict transforms of the curves wrt the blow ups isn't always sufficient for higher dimension curves, and sometimes the resulting curves would be reducible even though the original curves were irreducible. To address this, the blowup() function now looks at the irreducible components of the transformed curve (after substituting the relations that hold in a particular chart of the blowup) and ignores any component that lies within the exceptional divisor.\n\nIn implementing the above I noticed another issue which occurs when the transform of the curve coincides with the exceptional divisor. An example of this is when blowing up the line `x` at the origin; in one of the charts the transformed line and the exceptional divisor both seem to be defined by `x`. If I understand correctly the strict transform is the closure of the preimage by the projection map of the line minus the origin, which I think should be empty in that chart. The output in the current implementation is:\n\n```\nA.<x,y> = AffineSpace(QQ, 2)\nC = A.curve([x])\nC.blowup([0,0])[0]\n(Closed subscheme of Affine Space of dimension 2 over Rational Field\ndefined by: 1, Affine Plane Curve over Rational Field defined by s0)\n```\n\nShould the strict transform be empty in the first chart, and if so, would it be better to leave that chart out of the output?\n\nI also encountered an unrelated issue with applying change_ring to the transition maps when extending the base field. A simplified example of the problem is:\n\n```\nK.<a> = QuadraticField(-1)\nA.<x,y> = AffineSpace(K, 2)\nH = End(A)\nphi = H([x/y, y])\nemb = K.embeddings(QQbar)[0]\nphi.change_ring(emb)\n```\n\nwhich raises a `TypeError` without any description. This appears to only be an issue when there are actual fraction field elements defining the morphism. The line that breaks is `R = self.coordinate_ring().hom(R, T.ambient_space().coordinate_ring())` in the `change_ring` function for the SchemeMorphism_polynomial class of generic/morphism.py. Is this actually a bug, or perhaps am I just misusing the functionality?",
    "created_at": "2016-08-18T06:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385948",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:12'></a>
Ok, I generalized the blowup() function to work for arbitrary points. This simplified some of the code in resolution_of_singularities since there's no longer a need to keep track of change of coordinate maps used to move points to the origin. However, I ran into a couple of issues when testing some higher dimension examples.

It seems that the way I was trying to isolate the strict transforms of the curves wrt the blow ups isn't always sufficient for higher dimension curves, and sometimes the resulting curves would be reducible even though the original curves were irreducible. To address this, the blowup() function now looks at the irreducible components of the transformed curve (after substituting the relations that hold in a particular chart of the blowup) and ignores any component that lies within the exceptional divisor.

In implementing the above I noticed another issue which occurs when the transform of the curve coincides with the exceptional divisor. An example of this is when blowing up the line `x` at the origin; in one of the charts the transformed line and the exceptional divisor both seem to be defined by `x`. If I understand correctly the strict transform is the closure of the preimage by the projection map of the line minus the origin, which I think should be empty in that chart. The output in the current implementation is:

```
A.<x,y> = AffineSpace(QQ, 2)
C = A.curve([x])
C.blowup([0,0])[0]
(Closed subscheme of Affine Space of dimension 2 over Rational Field
defined by: 1, Affine Plane Curve over Rational Field defined by s0)
```

Should the strict transform be empty in the first chart, and if so, would it be better to leave that chart out of the output?

I also encountered an unrelated issue with applying change_ring to the transition maps when extending the base field. A simplified example of the problem is:

```
K.<a> = QuadraticField(-1)
A.<x,y> = AffineSpace(K, 2)
H = End(A)
phi = H([x/y, y])
emb = K.embeddings(QQbar)[0]
phi.change_ring(emb)
```

which raises a `TypeError` without any description. This appears to only be an issue when there are actual fraction field elements defining the morphism. The line that breaks is `R = self.coordinate_ring().hom(R, T.ambient_space().coordinate_ring())` in the `change_ring` function for the SchemeMorphism_polynomial class of generic/morphism.py. Is this actually a bug, or perhaps am I just misusing the functionality?



---

archive/issue_comments_385949.json:
```json
{
    "body": "<a id='comment:13'></a>\nYes, that is a bug. In that case the coordinate ring of the map was a fraction field, so it failed to create the hom. It is now fixed in #21285, which needs review.",
    "created_at": "2016-08-18T14:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385949",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>
Yes, that is a bug. In that case the coordinate ring of the map was a fraction field, so it failed to create the hom. It is now fixed in #21285, which needs review.



---

archive/issue_comments_385950.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis is getting a little beyond my expertise, but what are describing sounds correct to me. As for what to do with the empty chart. I would prefer to return it so that there are 'right' number of charts. It is clearly empty based on the defining equations.\n\nFor the blow-up at points. A couple things. While it is fine to accept a list as input and do the coercision in the function, I think it would be better to pass in actual points in the examples, maybe a curve point for one and an affine space point for another. Also, I'd like to see it default to the origin, so that the point parameter is optional.",
    "created_at": "2016-08-18T15:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385950",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:14'></a>
This is getting a little beyond my expertise, but what are describing sounds correct to me. As for what to do with the empty chart. I would prefer to return it so that there are 'right' number of charts. It is clearly empty based on the defining equations.

For the blow-up at points. A couple things. While it is fine to accept a list as input and do the coercision in the function, I think it would be better to pass in actual points in the examples, maybe a curve point for one and an affine space point for another. Also, I'd like to see it default to the origin, so that the point parameter is optional.



---

archive/issue_comments_385951.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-18T15:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385951",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_385952.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[50d05de](https://git.sagemath.org/sage.git/commit/?id=50d05de7b5c3c1e7dc134ad4c1548a9b0186fbbd)|`21285: error in change_ring for affine morphisms`|\n|[c6b7a42](https://git.sagemath.org/sage.git/commit/?id=c6b7a4243c16ee65f7752caea2063b99a002c12e)|`21085: merge with ticket 21285 for bug fix`|\n|[bebf7b0](https://git.sagemath.org/sage.git/commit/?id=bebf7b02f5cbe21fe85975821414b78fa65efadc)|`21085: minor improvements`|",
    "created_at": "2016-08-19T08:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[50d05de](https://git.sagemath.org/sage.git/commit/?id=50d05de7b5c3c1e7dc134ad4c1548a9b0186fbbd)|`21285: error in change_ring for affine morphisms`|
|[c6b7a42](https://git.sagemath.org/sage.git/commit/?id=c6b7a4243c16ee65f7752caea2063b99a002c12e)|`21085: merge with ticket 21285 for bug fix`|
|[bebf7b0](https://git.sagemath.org/sage.git/commit/?id=bebf7b02f5cbe21fe85975821414b78fa65efadc)|`21085: minor improvements`|



---

archive/issue_comments_385953.json:
```json
{
    "body": "Changing commit from \"78fdd8169cf389b44ff87dcfd0712bc66338114b\" to \"bebf7b02f5cbe21fe85975821414b78fa65efadc\"",
    "created_at": "2016-08-19T08:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "78fdd8169cf389b44ff87dcfd0712bc66338114b" to "bebf7b02f5cbe21fe85975821414b78fa65efadc"



---

archive/issue_comments_385954.json:
```json
{
    "body": "<a id='comment:16'></a>\nAlright, I made the changes and did some more functionality testing. So far everything seems to be working as intended on the examples I've come up with, and I think this should be good for review again.\n\nI've also been trying to implement a projective blow up function; for a projective curve defined by `f_1,...,f_m` in `P^n`, I was thinking to use the ideal generated by `f_1,...,f_m, x_i*y_j - x_j*y_i` for `i,j = 0,...,n-1` in the product space `P^n\\times P^{n-1}` to define the blow up of the curve at the point `(0:...:0:1)`, where the `x_i` are the coords for `P^n` and the `y_i` are the coords for `P^{n-1}`. However I'm not sure this is actually the correct ideal, and think it might be better to leave implementing projective blow ups at points for when more general functionality for blowing up along subschemes is implemented.",
    "created_at": "2016-08-21T23:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385954",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:16'></a>
Alright, I made the changes and did some more functionality testing. So far everything seems to be working as intended on the examples I've come up with, and I think this should be good for review again.

I've also been trying to implement a projective blow up function; for a projective curve defined by `f_1,...,f_m` in `P^n`, I was thinking to use the ideal generated by `f_1,...,f_m, x_i*y_j - x_j*y_i` for `i,j = 0,...,n-1` in the product space `P^n\times P^{n-1}` to define the blow up of the curve at the point `(0:...:0:1)`, where the `x_i` are the coords for `P^n` and the `y_i` are the coords for `P^{n-1}`. However I'm not sure this is actually the correct ideal, and think it might be better to leave implementing projective blow ups at points for when more general functionality for blowing up along subschemes is implemented.



---

archive/issue_comments_385955.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-21T23:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385955",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_385956.json:
```json
{
    "body": "Changing dependencies from \"#21168\" to \"#21168, #21285\"",
    "created_at": "2016-08-21T23:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385956",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing dependencies from "#21168" to "#21168, #21285"



---

archive/issue_comments_385957.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis seems fine to me, so I'll mark it positive.\n\nAs for the projective blow-up. Those equations don't really make a lot of sense. I was trying to think of a general form for a projective blow-up, but really, this is a local object and the most natural way to think of it is through affine charts anyway.\n\nSo I'm fine with holding off on projective blow-ups.",
    "created_at": "2016-08-22T16:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385957",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'></a>
This seems fine to me, so I'll mark it positive.

As for the projective blow-up. Those equations don't really make a lot of sense. I was trying to think of a general form for a projective blow-up, but really, this is a local object and the most natural way to think of it is through affine charts anyway.

So I'm fine with holding off on projective blow-ups.



---

archive/issue_comments_385958.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-22T16:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385958",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_385959.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-24T06:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385959",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056307.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-24T06:45:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21085#event-56307"
}
```



---

archive/issue_comments_385960.json:
```json
{
    "body": "Changing branch from \"u/gjorgenson/ticket/21085\" to \"bebf7b02f5cbe21fe85975821414b78fa65efadc\"",
    "created_at": "2016-08-24T06:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385960",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gjorgenson/ticket/21085" to "bebf7b02f5cbe21fe85975821414b78fa65efadc"



---

archive/issue_comments_385961.json:
```json
{
    "body": "<a id='comment:19'></a>\nAny chance some of you have a look at #17254#comment:364 ?\nWith the Singular upgrade a few signs changed in the doctests from here and we have no idea if the result is still valid (although it does not look obviously false).",
    "created_at": "2016-09-07T14:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385961",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>
Any chance some of you have a look at #17254#comment:364 ?
With the Singular upgrade a few signs changed in the doctests from here and we have no idea if the result is still valid (although it does not look obviously false).



---

archive/issue_comments_385962.json:
```json
{
    "body": "Changing commit from \"bebf7b02f5cbe21fe85975821414b78fa65efadc\" to \"\"",
    "created_at": "2016-09-07T14:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21085#issuecomment-385962",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing commit from "bebf7b02f5cbe21fe85975821414b78fa65efadc" to ""
