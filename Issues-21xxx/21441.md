# Issue 21441: Old installed version of Cython is used

archive/issues_021204.json:
```json
{
    "assignees": [],
    "body": "On a machine which had an older version of Cython installed but which was upgraded recently after #20218 was merged:\n\n```\n$ ls -ld local/lib/python/site-packages/Cython*\ndrwxrwxr-x 12 jdemeyer jdemeyer 4096 Sep  6 21:23 local/lib/python/site-packages/Cython\ndrwxrwxr-x  5 jdemeyer jdemeyer 4096 Sep  6 21:22 local/lib/python/site-packages/Cython-0.23.3-py2.7-linux-i686.egg\ndrwxrwxr-x  2 jdemeyer jdemeyer 4096 Sep  6 21:14 local/lib/python/site-packages/Cython-0.24.1-py2.7.egg-info\n```\n\nDespite Cython-0.24.1 being available, the older version 0.23.3 is still used by default. This causes breakage when building the Sage library.\n\n```\n>>> import Cython\n>>> Cython.__version__\n'0.23.3'\n>>> import sys\n>>> [x for x in sys.path if 'Cython' in x]\n['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']\n```\n\nThe problem is not limited to Cython, the same happens for other packages too.\n\nThis is a blocker ticket since it breaks upgrades from older Sage versions.\n\n**Steps to reproduce**:\n\n1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.\n\n2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.\n\n**Note to the release manager**: ideally, this would be merged together with #21552 since both tickets trigger recompilation of all Python packages.\n\nCC:  @embray\n\nBranch: **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**\n\nReviewer: **Jeroen Demeyer, Erik Bray, Matthias Koeppe**\n\nAuthor: **Erik Bray, Jeroen Demeyer**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21441_\n\n",
    "closed_at": "2016-10-03T17:41:44Z",
    "created_at": "2016-09-06T20:28:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Old installed version of Cython is used",
    "type": "issue",
    "updated_at": "2016-10-03T18:16:10Z",
    "url": "https://github.com/sagemath/sage/issues/21441",
    "user": "https://github.com/jdemeyer"
}
```
On a machine which had an older version of Cython installed but which was upgraded recently after #20218 was merged:

```
$ ls -ld local/lib/python/site-packages/Cython*
drwxrwxr-x 12 jdemeyer jdemeyer 4096 Sep  6 21:23 local/lib/python/site-packages/Cython
drwxrwxr-x  5 jdemeyer jdemeyer 4096 Sep  6 21:22 local/lib/python/site-packages/Cython-0.23.3-py2.7-linux-i686.egg
drwxrwxr-x  2 jdemeyer jdemeyer 4096 Sep  6 21:14 local/lib/python/site-packages/Cython-0.24.1-py2.7.egg-info
```

Despite Cython-0.24.1 being available, the older version 0.23.3 is still used by default. This causes breakage when building the Sage library.

```
>>> import Cython
>>> Cython.__version__
'0.23.3'
>>> import sys
>>> [x for x in sys.path if 'Cython' in x]
['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']
```

The problem is not limited to Cython, the same happens for other packages too.

This is a blocker ticket since it breaks upgrades from older Sage versions.

**Steps to reproduce**:

1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.

2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.

**Note to the release manager**: ideally, this would be merged together with #21552 since both tickets trigger recompilation of all Python packages.

CC:  @embray

Branch: **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**

Reviewer: **Jeroen Demeyer, Erik Bray, Matthias Koeppe**

Author: **Erik Bray, Jeroen Demeyer**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/21441_





---

archive/issue_events_301224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T20:28:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301224"
}
```



---

archive/issue_events_301225.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T20:28:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301225"
}
```



---

archive/issue_events_301226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T20:28:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301226"
}
```



---

archive/issue_events_301227.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T20:28:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301227"
}
```



---

archive/issue_events_301228.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T20:38:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "title_is": "Old installed version of Cython is used",
    "title_was": "Old version of Cython might be used",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301228"
}
```



---

archive/issue_comments_314239.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,5 +15,10 @@\n >>> [x for x in sys.path if 'Cython' in x]\n ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']\n ```\n+This causes breakage when building the Sage library.\n \n-This causes breakage when building the Sage library.\n+**Steps to reproduce**:\n+\n+1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython\n+\n+2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't\n``````\n",
    "created_at": "2016-09-06T20:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314239",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,5 +15,10 @@
 >>> [x for x in sys.path if 'Cython' in x]
 ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']
 ```
+This causes breakage when building the Sage library.
 
-This causes breakage when building the Sage library.
+**Steps to reproduce**:
+
+1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython
+
+2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't
``````




---

archive/issue_comments_314240.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,6 +19,6 @@\n \n **Steps to reproduce**:\n \n-1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython\n+1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.\n \n-2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't\n+2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.\n``````\n",
    "created_at": "2016-09-06T20:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314240",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,6 +19,6 @@
 
 **Steps to reproduce**:
 
-1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython
+1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.
 
-2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't
+2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.
``````




---

archive/issue_comments_314241.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,8 @@\n drwxrwxr-x  2 jdemeyer jdemeyer 4096 Sep  6 21:14 local/lib/python/site-packages/Cython-0.24.1-py2.7.egg-info\n ```\n \n+Despite Cython-0.24.1 being available, the older version 0.23.3 is still used by default. This causes breakage when building the Sage library.\n+\n ```\n >>> import Cython\n >>> Cython.__version__\n@@ -15,7 +17,8 @@\n >>> [x for x in sys.path if 'Cython' in x]\n ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']\n ```\n-This causes breakage when building the Sage library.\n+\n+This is a blocker ticket since it breaks upgrades from older Sage versions.\n \n **Steps to reproduce**:\n \n``````\n",
    "created_at": "2016-09-06T20:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314241",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,8 @@
 drwxrwxr-x  2 jdemeyer jdemeyer 4096 Sep  6 21:14 local/lib/python/site-packages/Cython-0.24.1-py2.7.egg-info
 ```
 
+Despite Cython-0.24.1 being available, the older version 0.23.3 is still used by default. This causes breakage when building the Sage library.
+
 ```
 >>> import Cython
 >>> Cython.__version__
@@ -15,7 +17,8 @@
 >>> [x for x in sys.path if 'Cython' in x]
 ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']
 ```
-This causes breakage when building the Sage library.
+
+This is a blocker ticket since it breaks upgrades from older Sage versions.
 
 **Steps to reproduce**:
 
``````




---

archive/issue_comments_314242.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,8 @@\n ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']\n ```\n \n+The problem is not limited to Cython, the same happens for other packages too.\n+\n This is a blocker ticket since it breaks upgrades from older Sage versions.\n \n **Steps to reproduce**:\n``````\n",
    "created_at": "2016-09-06T21:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314242",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,8 @@
 ['/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-i686.egg']
 ```
 
+The problem is not limited to Cython, the same happens for other packages too.
+
 This is a blocker ticket since it breaks upgrades from older Sage versions.
 
 **Steps to reproduce**:
``````




---

archive/issue_comments_314243.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWow, I see the issue.  When you use pip with the `--ignore-installed` option it also does not uninstall existing versions of the package (at the very least if it's an old .egg).  I would say that's undocumented behavior.",
    "created_at": "2016-09-07T09:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314243",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Wow, I see the issue.  When you use pip with the `--ignore-installed` option it also does not uninstall existing versions of the package (at the very least if it's an old .egg).  I would say that's undocumented behavior.



---

archive/issue_comments_314244.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.  That will also make `./sage -f` work properly since it will force reinstall of the package even if the same version was already installed.",
    "created_at": "2016-09-07T09:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314244",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.  That will also make `./sage -f` work properly since it will force reinstall of the package even if the same version was already installed.



---

archive/issue_comments_314245.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@embray](#comment:6):\n> I think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.\n\nThat is not entirely trivial because you need to figure out which package to uninstall. You cannot do `pip uninstall .`, you need something like `pip uninstall $PKGNAME`.\n\nOther than that, I like the idea. We could probably drop the `--ignore-installed --no-deps` options too.",
    "created_at": "2016-09-07T12:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314245",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@embray](#comment:6):
> I think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.

That is not entirely trivial because you need to figure out which package to uninstall. You cannot do `pip uninstall .`, you need something like `pip uninstall $PKGNAME`.

Other than that, I like the idea. We could probably drop the `--ignore-installed --no-deps` options too.



---

archive/issue_comments_314246.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On a machine which had on older version of Cython installed but which was upgraded recently after #20218 was merged:\n+On a machine which had an older version of Cython installed but which was upgraded recently after #20218 was merged:\n \n ```\n $ ls -ld local/lib/python/site-packages/Cython*\n``````\n",
    "created_at": "2016-09-07T12:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314246",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On a machine which had on older version of Cython installed but which was upgraded recently after #20218 was merged:
+On a machine which had an older version of Cython installed but which was upgraded recently after #20218 was merged:
 
 ```
 $ ls -ld local/lib/python/site-packages/Cython*
``````




---

archive/issue_comments_314247.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment:7):\n> Replying to [@embray](#comment:6):\n> > I think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.\n\n> \n> That is not entirely trivial because you need to figure out which package to uninstall. You cannot do `pip uninstall .`, you need something like `pip uninstall $PKGNAME`.\n\nFair point.  A broader idea I had is that as many of the `spkg-install`s (but not all!) have sections for uninstalling previous installations, that step should maybe be broken out to a separate `spkg-uninstall` script.  Another step in making the packages a little more uniform in how they are managed.  But my hope was to find a simple way to address this specific issue *now*.\n\nI'm sort of of the mind that `pip uninstall .` *should* work.  If there's a local `setup.py` it should use that to figure out the package's name, and then uninstall that.  \n\n> Other than that, I like the idea. We could probably drop the `--ignore-installed --no-deps` options too.\n\nI don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.  It seems that `--ignore-installed` is just very literal in its intent.  It really means \"pay no attention whatsoever to what I already have installed\".",
    "created_at": "2016-09-07T13:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314247",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment:7):
> Replying to [@embray](#comment:6):
> > I think the easiest thing to do for now would be to make `PIP_INSTALL` point to a little wrapper function that also forcibly calls `pip uninstall`.

> 
> That is not entirely trivial because you need to figure out which package to uninstall. You cannot do `pip uninstall .`, you need something like `pip uninstall $PKGNAME`.

Fair point.  A broader idea I had is that as many of the `spkg-install`s (but not all!) have sections for uninstalling previous installations, that step should maybe be broken out to a separate `spkg-uninstall` script.  Another step in making the packages a little more uniform in how they are managed.  But my hope was to find a simple way to address this specific issue *now*.

I'm sort of of the mind that `pip uninstall .` *should* work.  If there's a local `setup.py` it should use that to figure out the package's name, and then uninstall that.  

> Other than that, I like the idea. We could probably drop the `--ignore-installed --no-deps` options too.

I don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.  It seems that `--ignore-installed` is just very literal in its intent.  It really means "pay no attention whatsoever to what I already have installed".



---

archive/issue_comments_314248.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think what pip really needs here is an option to *explicitly* ensure that conflicting packages are uninstalled, even if I said `--ignore-installed`.",
    "created_at": "2016-09-07T13:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314248",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I think what pip really needs here is an option to *explicitly* ensure that conflicting packages are uninstalled, even if I said `--ignore-installed`.



---

archive/issue_comments_314249.json:
```json
{
    "body": "Branch: **[u/embray/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage-pip-install)**",
    "created_at": "2016-09-07T14:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314249",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage-pip-install)**



---

archive/issue_comments_314250.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHere's an initial stab at a fix.  Adds a new `sage-pip-install` script to wrap `pip`, since otherwise this got too unwieldy.  It just ensures that any previous installations of the package are thoroughly uninstalled before the actual `pip install` call.\n\nIn the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name (if it prints anything else it should be to stderr).  This is easy enough to work around, but I wonder what other packages make this mistake, and I'm testing for that now...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00\">015197a</a></td><td><code>Add a sage-pip-install wrapper for pip which handles uninstallation better.</code></td></tr></table>\n",
    "created_at": "2016-09-07T14:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314250",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

Here's an initial stab at a fix.  Adds a new `sage-pip-install` script to wrap `pip`, since otherwise this got too unwieldy.  It just ensures that any previous installations of the package are thoroughly uninstalled before the actual `pip install` call.

In the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name (if it prints anything else it should be to stderr).  This is easy enough to work around, but I wonder what other packages make this mistake, and I'm testing for that now...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00">015197a</a></td><td><code>Add a sage-pip-install wrapper for pip which handles uninstallation better.</code></td></tr></table>




---

archive/issue_comments_314251.json:
```json
{
    "body": "Commit: **[`015197a`](https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00)**",
    "created_at": "2016-09-07T14:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314251",
    "user": "https://github.com/embray"
}
```

Commit: **[`015197a`](https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00)**



---

archive/issue_comments_314252.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2016-09-07T14:17:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314252",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_314253.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8\">ea52ac9</a></td><td><code>Make sure to consume additional flags passed to the PIP_INSTALL command</code></td></tr></table>\n",
    "created_at": "2016-09-07T14:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8">ea52ac9</a></td><td><code>Make sure to consume additional flags passed to the PIP_INSTALL command</code></td></tr></table>




---

archive/issue_comments_314254.json:
```json
{
    "body": "Changed commit from **[`015197a`](https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00)** to **[`ea52ac9`](https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8)**",
    "created_at": "2016-09-07T14:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314254",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`015197a`](https://github.com/sagemath/sagetrac-mirror/commit/015197a071c29cdd158581f230d11668f63a6e00)** to **[`ea52ac9`](https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8)**



---

archive/issue_comments_314255.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14\">a6e0538</a></td><td><code>Ensure stderr is captured for repeat uninstalls</code></td></tr></table>\n",
    "created_at": "2016-09-07T14:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314255",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14">a6e0538</a></td><td><code>Ensure stderr is captured for repeat uninstalls</code></td></tr></table>




---

archive/issue_comments_314256.json:
```json
{
    "body": "Changed commit from **[`ea52ac9`](https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8)** to **[`a6e0538`](https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14)**",
    "created_at": "2016-09-07T14:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314256",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ea52ac9`](https://github.com/sagemath/sagetrac-mirror/commit/ea52ac9527aebf6ac967b6aa6cf56aed18b733d8)** to **[`a6e0538`](https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14)**



---

archive/issue_comments_314257.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n`#!/bin/bash` should be `#!/usr/bin/env bash`",
    "created_at": "2016-09-08T06:01:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314257",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

`#!/bin/bash` should be `#!/usr/bin/env bash`



---

archive/issue_comments_314258.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:8):\n> I don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.\n\nThe whole point of adding `--ignored-installed` in #20218 was to fix cases of existing but broken installations. Those would now be uninstalled anyway, so you no longer need the `--ignore-installed` flag. And once you do that, you can drop `--no-deps` to enable dependency checking.",
    "created_at": "2016-09-08T06:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314258",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:8):
> I don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.

The whole point of adding `--ignored-installed` in #20218 was to fix cases of existing but broken installations. Those would now be uninstalled anyway, so you no longer need the `--ignore-installed` flag. And once you do that, you can drop `--no-deps` to enable dependency checking.



---

archive/issue_comments_314259.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@embray](#comment:10):\n> In the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name\n\nIs Cython the only misbehaving package? If so, I would rather add https://github.com/cython/cython/pull/1455 in order to simplify `sage-pip-install`.",
    "created_at": "2016-09-08T07:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314259",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@embray](#comment:10):
> In the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name

Is Cython the only misbehaving package? If so, I would rather add https://github.com/cython/cython/pull/1455 in order to simplify `sage-pip-install`.



---

archive/issue_comments_314260.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> `#!/bin/bash` should be `#!/usr/bin/env bash`\n\nSure, will do.",
    "created_at": "2016-09-09T08:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314260",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> `#!/bin/bash` should be `#!/usr/bin/env bash`

Sure, will do.



---

archive/issue_comments_314261.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:14):\n> Replying to [@embray](#comment:8):\n> > I don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.\n\n> \n> The whole point of adding `--ignored-installed` in #20218 was to fix cases of existing but broken installations. Those would now be uninstalled anyway, so you no longer need the `--ignore-installed` flag. And once you do that, you can drop `--no-deps` to enable dependency checking.\n\nThat makes sense.  I think for the purposes of this ticket we shouldn't mess with it though--it's already working as is (minus this issue).  I'd rather get the uninstallation fixed, and then worry about further tweaking the install options.\n\nI'm also going to write up something about this experience for the pip mailing list.  As `pip` is now the de-facto installer for Python packages it ought to be easier for system integrators to control it a bit (though I still maintain that as system integrators dependency management is our job, not pip's).",
    "created_at": "2016-09-09T08:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314261",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:14):
> Replying to [@embray](#comment:8):
> > I don't know what you mean here.  If `--ignore-installed` is dropped then it's a moot point.  pip will uninstall the previous version of the package without that flag.

> 
> The whole point of adding `--ignored-installed` in #20218 was to fix cases of existing but broken installations. Those would now be uninstalled anyway, so you no longer need the `--ignore-installed` flag. And once you do that, you can drop `--no-deps` to enable dependency checking.

That makes sense.  I think for the purposes of this ticket we shouldn't mess with it though--it's already working as is (minus this issue).  I'd rather get the uninstallation fixed, and then worry about further tweaking the install options.

I'm also going to write up something about this experience for the pip mailing list.  As `pip` is now the de-facto installer for Python packages it ought to be easier for system integrators to control it a bit (though I still maintain that as system integrators dependency management is our job, not pip's).



---

archive/issue_comments_314262.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:15):\n> Replying to [@embray](#comment:10):\n> > In the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name\n\n> \n> Is Cython the only misbehaving package? If so, I would rather add https://github.com/cython/cython/pull/1455 in order to simplify `sage-pip-install`.\n\nThere are a few others I've found:\n\n* pari_jupyter\n* widgetsnbextension\n* giacpy\n* matplotlib\n\nI've already opened an issue for matplotlib, though I don't have a patch.  I think the check is good to leave in even if these are fixed because you never know when another package is going to be added, or updated in such a way that it breaks this.",
    "created_at": "2016-09-09T08:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314262",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:15):
> Replying to [@embray](#comment:10):
> > In the process I found out that Cython's `setup.py` is badly behaved--`./setup.py --name` should really *only* print the package's name

> 
> Is Cython the only misbehaving package? If so, I would rather add https://github.com/cython/cython/pull/1455 in order to simplify `sage-pip-install`.

There are a few others I've found:

* pari_jupyter
* widgetsnbextension
* giacpy
* matplotlib

I've already opened an issue for matplotlib, though I don't have a patch.  I think the check is good to leave in even if these are fixed because you never know when another package is going to be added, or updated in such a way that it breaks this.



---

archive/issue_comments_314263.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI see. For `pari_jupyter`, I need Cython 0.25 to fix that: https://github.com/jdemeyer/pari_jupyter/pull/1",
    "created_at": "2016-09-09T08:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314263",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I see. For `pari_jupyter`, I need Cython 0.25 to fix that: https://github.com/jdemeyer/pari_jupyter/pull/1



---

archive/issue_comments_314264.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nErik, I agree with everything you said. Remember to fix [comment:13] and set this to needs review when you feel like it is ready.",
    "created_at": "2016-09-09T08:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314264",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Erik, I agree with everything you said. Remember to fix [comment:13] and set this to needs review when you feel like it is ready.



---

archive/issue_comments_314265.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nImportant: we should also bump the version number of all involved packages to force reinstalling them. Alternatively, we could also just bump the Python version. That will also force a re-installation of all Python packages in Sage.",
    "created_at": "2016-09-09T09:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314265",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Important: we should also bump the version number of all involved packages to force reinstalling them. Alternatively, we could also just bump the Python version. That will also force a re-installation of all Python packages in Sage.



---

archive/issue_comments_314266.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:21):\n> Important: we should also bump the version number of all involved packages to force reinstalling them. Alternatively, we could also just bump the Python version. That will also force a re-installation of all Python packages in Sage.\n\nDoesn't that mean basically any package that uses pip?  I avoided doing that in #20218 since there was no real change in the packages themselves.  How they are installed is changed, but it shouldn't have otherwise impacted their functionality.\n\nI'm not opposed to doing it anyways, but I'm not sure it's really needed either.",
    "created_at": "2016-09-09T12:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314266",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:21):
> Important: we should also bump the version number of all involved packages to force reinstalling them. Alternatively, we could also just bump the Python version. That will also force a re-installation of all Python packages in Sage.

Doesn't that mean basically any package that uses pip?  I avoided doing that in #20218 since there was no real change in the packages themselves.  How they are installed is changed, but it shouldn't have otherwise impacted their functionality.

I'm not opposed to doing it anyways, but I'm not sure it's really needed either.



---

archive/issue_comments_314267.json:
```json
{
    "body": "Changed commit from **[`a6e0538`](https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14)** to **[`2ee51db`](https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b)**",
    "created_at": "2016-09-09T13:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314267",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a6e0538`](https://github.com/sagemath/sagetrac-mirror/commit/a6e053839fe27837626791d65efd87c9bcf55e14)** to **[`2ee51db`](https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b)**



---

archive/issue_comments_314268.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b\">2ee51db</a></td><td><code>Change the shebang line to user /usr/bin/env</code></td></tr></table>\n",
    "created_at": "2016-09-09T13:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314268",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b">2ee51db</a></td><td><code>Change the shebang line to user /usr/bin/env</code></td></tr></table>




---

archive/issue_comments_314269.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@embray](#comment:22):\n> Doesn't that mean basically any package that uses pip?\n\nYes indeed.\n\n> I avoided doing that in #20218 since there was no real change in the packages themselves.  \n\nThe *intent* was to have no real change. But this whole ticket is about an accidental change.\n\n> How they are installed is changed, but it shouldn't have otherwise impacted their functionality.\n\nGiven that the packages were installed badly, the change *does* impact the functionality.\n\nAnother example of breakage is the patchbot report of #20767: it reports a failure because the Cython update #21126 didn't work. If you don't force a rebuild, it will keep using the wrong version.",
    "created_at": "2016-09-09T13:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314269",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@embray](#comment:22):
> Doesn't that mean basically any package that uses pip?

Yes indeed.

> I avoided doing that in #20218 since there was no real change in the packages themselves.  

The *intent* was to have no real change. But this whole ticket is about an accidental change.

> How they are installed is changed, but it shouldn't have otherwise impacted their functionality.

Given that the packages were installed badly, the change *does* impact the functionality.

Another example of breakage is the patchbot report of #20767: it reports a failure because the Cython update #21126 didn't work. If you don't force a rebuild, it will keep using the wrong version.



---

archive/issue_comments_314270.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nBut that was only an issue specifically because Cython was updated.  The version number of Cython was bumped, at it was reinstalled.  It just didn't uninstall the old version.  Neither the old version nor the new version were \"installed badly\" on their own--only insofar as two copies were installed.\n\nIf a package wasn't otherwise updated there's no reason to reinstall it.",
    "created_at": "2016-09-09T14:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314270",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

But that was only an issue specifically because Cython was updated.  The version number of Cython was bumped, at it was reinstalled.  It just didn't uninstall the old version.  Neither the old version nor the new version were "installed badly" on their own--only insofar as two copies were installed.

If a package wasn't otherwise updated there's no reason to reinstall it.



---

archive/issue_comments_314271.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@embray](#comment:25):\n> But that was only an issue specifically because Cython was updated.\n\n...in the latest beta. If you assume that people upgrade at every beta release, then you might be right. But people might have skipped some beta releases (upgrading from an older version to the current version) and then more packages might be affected. I suggest we don't guess and just upgrade all `pip`-installed packages.\n\n> Neither the old version nor the new version were \"installed badly\" on their own--only insofar as two copies were installed.\n\nRight, it wasn't \"installed badly\" in the strict sense. But still, the packages are installed badly in the sense that if you try to `import` them, you get the wrong version.",
    "created_at": "2016-09-09T19:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314271",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@embray](#comment:25):
> But that was only an issue specifically because Cython was updated.

...in the latest beta. If you assume that people upgrade at every beta release, then you might be right. But people might have skipped some beta releases (upgrading from an older version to the current version) and then more packages might be affected. I suggest we don't guess and just upgrade all `pip`-installed packages.

> Neither the old version nor the new version were "installed badly" on their own--only insofar as two copies were installed.

Right, it wasn't "installed badly" in the strict sense. But still, the packages are installed badly in the sense that if you try to `import` them, you get the wrong version.



---

archive/issue_comments_314272.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAnyway, this is not something I want to fight about. My main concern is that this bug gets fixed :-)",
    "created_at": "2016-09-11T07:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314272",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Anyway, this is not something I want to fight about. My main concern is that this bug gets fixed :-)



---

archive/issue_comments_314273.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI think the `pushd`/`popd` logic is not needed since this script will be run in a separate process. A simple `cd` should work.",
    "created_at": "2016-09-13T14:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314273",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

I think the `pushd`/`popd` logic is not needed since this script will be run in a separate process. A simple `cd` should work.



---

archive/issue_comments_314274.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nErik, do you plan to work on this or should I take over?",
    "created_at": "2016-09-18T12:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314274",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Erik, do you plan to work on this or should I take over?



---

archive/issue_comments_314275.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@embray](#comment:18):\n> There are a few others I've found:\n> \n> * widgetsnbextension\n\nFor widgetsnbextension, see https://github.com/ipython/ipywidgets/pull/781",
    "created_at": "2016-09-20T09:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314275",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@embray](#comment:18):
> There are a few others I've found:
> 
> * widgetsnbextension

For widgetsnbextension, see https://github.com/ipython/ipywidgets/pull/781



---

archive/issue_comments_314276.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**",
    "created_at": "2016-09-20T10:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314276",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**



---

archive/issue_comments_314277.json:
```json
{
    "body": "Changed branch from **[u/embray/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage-pip-install)** to **[u/jdemeyer/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage-pip-install)**",
    "created_at": "2016-09-20T10:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314277",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage-pip-install)** to **[u/jdemeyer/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage-pip-install)**



---

archive/issue_comments_314278.json:
```json
{
    "body": "Changed commit from **[`2ee51db`](https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b)** to **[`92ae7d7`](https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3)**",
    "created_at": "2016-09-20T10:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314278",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`2ee51db`](https://github.com/sagemath/sagetrac-mirror/commit/2ee51db6b2f2e841b052cb6216b711deba51101b)** to **[`92ae7d7`](https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3)**



---

archive/issue_events_301229.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-20T10:13:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301229"
}
```



---

archive/issue_comments_314279.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccd94425cd0d5a89751269059a6ce508fa0265bf\">ccd9442</a></td><td><code>Add a sage-pip-install wrapper for pip which handles uninstallation better.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b61291db3c028bcac9741552c80bd179a0844d4\">3b61291</a></td><td><code>Directly call sage-pip-install instead of using $PIP_INSTALL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4ca23af1de4fcd0158fa3b0f459f625faec5ce9\">f4ca23a</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3\">92ae7d7</a></td><td><code>Minor fixes to sage-pip-install</code></td></tr></table>\n",
    "created_at": "2016-09-20T10:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314279",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccd94425cd0d5a89751269059a6ce508fa0265bf">ccd9442</a></td><td><code>Add a sage-pip-install wrapper for pip which handles uninstallation better.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b61291db3c028bcac9741552c80bd179a0844d4">3b61291</a></td><td><code>Directly call sage-pip-install instead of using $PIP_INSTALL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4ca23af1de4fcd0158fa3b0f459f625faec5ce9">f4ca23a</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3">92ae7d7</a></td><td><code>Minor fixes to sage-pip-install</code></td></tr></table>




---

archive/issue_comments_314280.json:
```json
{
    "body": "Changed commit from **[`92ae7d7`](https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3)** to **[`8afdf21`](https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa)**",
    "created_at": "2016-09-20T13:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314280",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`92ae7d7`](https://github.com/sagemath/sagetrac-mirror/commit/92ae7d7e63ca5ad97603d208de351bef7a2085e3)** to **[`8afdf21`](https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa)**



---

archive/issue_comments_314281.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa\">8afdf21</a></td><td><code>Fix various dependencies</code></td></tr></table>\n",
    "created_at": "2016-09-20T13:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314281",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa">8afdf21</a></td><td><code>Fix various dependencies</code></td></tr></table>




---

archive/issue_comments_314282.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,3 +27,5 @@\n 1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.\n \n 2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.\n+\n+**Note to the release manager**: ideally, this would be merged together with #21552 since both tickets trigger recompilation of all Python packages.\n``````\n",
    "created_at": "2016-09-21T10:19:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314282",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,3 +27,5 @@
 1. `./sage --sh -c 'easy_install cython==0.23.3'`   # Install an older version of Cython.
 
 2. `./sage -f cython`   # Rebuild the Cython in Sage. This *should* uninstall the old version but it doesn't.
+
+**Note to the release manager**: ideally, this would be merged together with #21552 since both tickets trigger recompilation of all Python packages.
``````




---

archive/issue_comments_314283.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI think the mass replacement of `PIP_INSTALL` with `sage-pip-install` was excessive.  I deliberately did not do that in the first place, because\n\na) I wanted to avoid another mass update of `spkg-installs` when that was already done to put `PIP_INSTALL` everywhere, and\n\nb) Leaving `PIP_INSTALL` as a variable means such mass updates can be avoided in the future.  For example, future improvements in pip itself might render the `sage-pip-install` script superfluous, at which point it might be nice to remove it.\n\nI also have ideas for more work to generalize common installation steps so that maybe many of these spkg-installs will just be pointers to a common install script for Python packages, so that will reduce duplication as well, at which point `PIP_INSTALL` might not be as useful.  But for now I think it's easier to leave it so that this can be changed in one place.",
    "created_at": "2016-09-22T16:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314283",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

I think the mass replacement of `PIP_INSTALL` with `sage-pip-install` was excessive.  I deliberately did not do that in the first place, because

a) I wanted to avoid another mass update of `spkg-installs` when that was already done to put `PIP_INSTALL` everywhere, and

b) Leaving `PIP_INSTALL` as a variable means such mass updates can be avoided in the future.  For example, future improvements in pip itself might render the `sage-pip-install` script superfluous, at which point it might be nice to remove it.

I also have ideas for more work to generalize common installation steps so that maybe many of these spkg-installs will just be pointers to a common install script for Python packages, so that will reduce duplication as well, at which point `PIP_INSTALL` might not be as useful.  But for now I think it's easier to leave it so that this can be changed in one place.



---

archive/issue_comments_314284.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n(Also, sorry, I was on vacation last week.  No disagreement with anything else here.)",
    "created_at": "2016-09-22T16:07:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314284",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

(Also, sorry, I was on vacation last week.  No disagreement with anything else here.)



---

archive/issue_comments_314285.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nTo be honest, I never liked the `PIP_INSTALL` the environment variable in the first place. And if that variable would just be the name of a script, why bother with the environment variable? And mass replacements are really not a big deal, that's trivially done with some `sed` script or other tool.\n\nHowever, for the sake of peace, I don't mind to change this back if that's the only issue you have.",
    "created_at": "2016-09-22T21:07:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314285",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

To be honest, I never liked the `PIP_INSTALL` the environment variable in the first place. And if that variable would just be the name of a script, why bother with the environment variable? And mass replacements are really not a big deal, that's trivially done with some `sed` script or other tool.

However, for the sake of peace, I don't mind to change this back if that's the only issue you have.



---

archive/issue_comments_314286.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n@embray: please clearly state what you require to set this to positive_review.",
    "created_at": "2016-09-23T09:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314286",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

@embray: please clearly state what you require to set this to positive_review.



---

archive/issue_comments_314287.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nJust removing the change to `PIP_INSTALL`.\n\nI don't like adding yet another \"sage-\" script and would prefer to remove it sooner rather than later.  But for now it's the easiest solution.",
    "created_at": "2016-09-23T11:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314287",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Just removing the change to `PIP_INSTALL`.

I don't like adding yet another "sage-" script and would prefer to remove it sooner rather than later.  But for now it's the easiest solution.



---

archive/issue_comments_314288.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d4d72c0fd05a5fb1371ee02e1eab419a11fd4f7\">4d4d72c</a></td><td><code>Various fixes and simplifications to sage-pip-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b28dd992c8c3f256c2329cab617858447bdeee3\">2b28dd9</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5\">e351c98</a></td><td><code>Fix various dependencies</code></td></tr></table>\n",
    "created_at": "2016-09-23T12:02:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314288",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d4d72c0fd05a5fb1371ee02e1eab419a11fd4f7">4d4d72c</a></td><td><code>Various fixes and simplifications to sage-pip-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b28dd992c8c3f256c2329cab617858447bdeee3">2b28dd9</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5">e351c98</a></td><td><code>Fix various dependencies</code></td></tr></table>




---

archive/issue_comments_314289.json:
```json
{
    "body": "Changed commit from **[`8afdf21`](https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa)** to **[`e351c98`](https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5)**",
    "created_at": "2016-09-23T12:02:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314289",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8afdf21`](https://github.com/sagemath/sagetrac-mirror/commit/8afdf212e25c9fd815d306ad89357f86309933aa)** to **[`e351c98`](https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5)**



---

archive/issue_comments_314290.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@embray](#comment:40):\n> I don't like adding yet another \"sage-\" script and would prefer to remove it sooner rather than later.  But for now it's the easiest solution.\n\nI would argue that adding a new environment variable in `sage-env` is uglier than a clean self-contained script. But here is what you asked for...",
    "created_at": "2016-09-23T12:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314290",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@embray](#comment:40):
> I don't like adding yet another "sage-" script and would prefer to remove it sooner rather than later.  But for now it's the easiest solution.

I would argue that adding a new environment variable in `sage-env` is uglier than a clean self-contained script. But here is what you asked for...



---

archive/issue_comments_314291.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI wouldn't have removed the `.` either.  `sage-pip-install` takes that as an argument.  The idea was to keep the interface otherwise the same, and minimize the changes needed to work around this issue, which I think represents deficiencies in pip more than anything else.",
    "created_at": "2016-09-23T12:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314291",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

I wouldn't have removed the `.` either.  `sage-pip-install` takes that as an argument.  The idea was to keep the interface otherwise the same, and minimize the changes needed to work around this issue, which I think represents deficiencies in pip more than anything else.



---

archive/issue_comments_314292.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@embray](#comment:43):\n> I wouldn't have removed the `.` either.\n\nI know. However, Sage *only* uses `.` as directory, so I didn't see the point of supporting a directory argument (it's extra complexity without a use case). We could also keep the `.` and just ignore it in `sage-pip-install`, but that looked like a worse solution.",
    "created_at": "2016-09-23T12:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314292",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@embray](#comment:43):
> I wouldn't have removed the `.` either.

I know. However, Sage *only* uses `.` as directory, so I didn't see the point of supporting a directory argument (it's extra complexity without a use case). We could also keep the `.` and just ignore it in `sage-pip-install`, but that looked like a worse solution.



---

archive/issue_comments_314293.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\n(I do agree having it as an environment variable sucks--in the future we'll want to redo how `spkg-install` works so that it instead sources what it needs instead of relying as much on environment variables).",
    "created_at": "2016-09-23T12:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314293",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">comment:45</div>

(I do agree having it as an environment variable sucks--in the future we'll want to redo how `spkg-install` works so that it instead sources what it needs instead of relying as much on environment variables).



---

archive/issue_events_301230.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-29T14:53:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301230"
}
```



---

archive/issue_events_301231.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-29T14:53:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301231"
}
```



---

archive/issue_comments_314294.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nSee above.",
    "created_at": "2016-09-29T14:53:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314294",
    "user": "https://github.com/embray"
}
```

<div id="comment:46" align="right">comment:46</div>

See above.



---

archive/issue_comments_314295.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@embray](#comment:46):\n> See above.\n\nCan you give a little more detail?",
    "created_at": "2016-09-29T14:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314295",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@embray](#comment:46):
> See above.

Can you give a little more detail?



---

archive/issue_comments_314296.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nIn other words: what would you like me to do concretely?",
    "created_at": "2016-09-29T14:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314296",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

In other words: what would you like me to do concretely?



---

archive/issue_comments_314297.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nRemove any changes to `spkg-install`s.",
    "created_at": "2016-09-29T15:56:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314297",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

Remove any changes to `spkg-install`s.



---

archive/issue_comments_314298.json:
```json
{
    "body": "Changed commit from **[`e351c98`](https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5)** to **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**",
    "created_at": "2016-09-30T08:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314298",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e351c98`](https://github.com/sagemath/sagetrac-mirror/commit/e351c98d94505343082bc16d9397a87f7058eef5)** to **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**



---

archive/issue_comments_314299.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29957fa92834038032f2febd817dd00c596e50fd\">29957fa</a></td><td><code>Various fixes and simplifications to sage-pip-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/783cd7d541970012f037de0364df099312d2624a\">783cd7d</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb\">8fd8273</a></td><td><code>Fix various dependencies</code></td></tr></table>\n",
    "created_at": "2016-09-30T08:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314299",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29957fa92834038032f2febd817dd00c596e50fd">29957fa</a></td><td><code>Various fixes and simplifications to sage-pip-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/783cd7d541970012f037de0364df099312d2624a">783cd7d</a></td><td><code>Re-install all pip-installed packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb">8fd8273</a></td><td><code>Fix various dependencies</code></td></tr></table>




---

archive/issue_events_301232.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-30T08:46:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301232"
}
```



---

archive/issue_events_301233.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-30T08:46:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301233"
}
```



---

archive/issue_comments_314300.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nNot fully tested yet, but this reverts all changes to `spkg-install`, except for the `pip` package.",
    "created_at": "2016-09-30T08:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314300",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Not fully tested yet, but this reverts all changes to `spkg-install`, except for the `pip` package.



---

archive/issue_events_301234.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-30T10:16:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301234"
}
```



---

archive/issue_events_301235.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-30T10:16:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301235"
}
```



---

archive/issue_comments_314301.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nLooks good to me.",
    "created_at": "2016-09-30T10:16:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314301",
    "user": "https://github.com/embray"
}
```

<div id="comment:52" align="right">comment:52</div>

Looks good to me.



---

archive/issue_comments_314302.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReviewer name...",
    "created_at": "2016-10-02T17:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314302",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:53" align="right">comment:53</div>

Reviewer name...



---

archive/issue_events_301236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-02T21:27:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301236"
}
```



---

archive/issue_events_301237.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-02T21:27:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301237"
}
```



---

archive/issue_comments_314303.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThe patch bumps the version numbers of dozens of packages without making changes to them. This seems unnecessary.",
    "created_at": "2016-10-03T02:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314303",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

The patch bumps the version numbers of dozens of packages without making changes to them. This seems unnecessary.



---

archive/issue_comments_314304.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Erik Bray, Matthias Koeppe**",
    "created_at": "2016-10-03T02:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314304",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Jeroen Demeyer, Erik Bray, Matthias Koeppe**



---

archive/issue_events_301238.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-03T06:03:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301238"
}
```



---

archive/issue_events_301239.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-03T06:03:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301239"
}
```



---

archive/issue_comments_314305.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@mkoeppe](#comment:55):\n> The patch bumps the version numbers of dozens of packages without making changes to them.\n\nThis patch *does* make implicit changes to all those `spkg-install` scripts because it changes `$PIP_INSTALL`. See [comment:21] and following.\n\nIn any case, if this is merged with  #21552, then all Python packages need to be rebuilt anyway so it wouldn't matter.",
    "created_at": "2016-10-03T06:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314305",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@mkoeppe](#comment:55):
> The patch bumps the version numbers of dozens of packages without making changes to them.

This patch *does* make implicit changes to all those `spkg-install` scripts because it changes `$PIP_INSTALL`. See [comment:21] and following.

In any case, if this is merged with  #21552, then all Python packages need to be rebuilt anyway so it wouldn't matter.



---

archive/issue_comments_314306.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI don't personally think it's terribly important to bump all these package versions since it doesn't actually change all of them--for example packages that did not use setuptools (and thus are not installed as .egg directories) really aren't changed *at all*.  For those that are changed, this changes some small details about how they are installed, but nothing about how they run.\n\nThat said, strictly speaking, Jeroen is right that this does change runtime behavior since it will change what `sys.path` looks like.  Also nice to bump the version numbers to force all the .egg installs to be removed.",
    "created_at": "2016-10-03T09:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314306",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

I don't personally think it's terribly important to bump all these package versions since it doesn't actually change all of them--for example packages that did not use setuptools (and thus are not installed as .egg directories) really aren't changed *at all*.  For those that are changed, this changes some small details about how they are installed, but nothing about how they run.

That said, strictly speaking, Jeroen is right that this does change runtime behavior since it will change what `sys.path` looks like.  Also nice to bump the version numbers to force all the .egg installs to be removed.



---

archive/issue_comments_314307.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage-pip-install)** to **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**",
    "created_at": "2016-10-03T17:41:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314307",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/sage-pip-install](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage-pip-install)** to **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)**



---

archive/issue_events_301240.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T17:41:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301240"
}
```



---

archive/issue_events_301241.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f8fc1eb16241842bc60a9309bd4ab27fb63c1f7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-10-03T17:41:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21441#event-301241"
}
```



---

archive/issue_comments_314308.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nOK, thanks for the explanation.",
    "created_at": "2016-10-03T18:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314308",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

OK, thanks for the explanation.



---

archive/issue_comments_314309.json:
```json
{
    "body": "Changed commit from **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)** to none",
    "created_at": "2016-10-03T18:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21441#issuecomment-314309",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`8fd8273`](https://github.com/sagemath/sagetrac-mirror/commit/8fd8273a000d17fba9fde19311aaf7adf6052fcb)** to none
