# Issue 21206: Add improved process shutdown code for PALPreader._iterate_list

archive/issues_020969.json:
```json
{
    "body": "This is to fix the tests in `sage.geometry.polyhedron.palp_database`, which were irregularly failing on Cygwin.  I don't think there's really anything Cygwin-specific about the issue, actually.  It just tends to exhibit itself on Cygwin because process shutdown takes longer, giving a wider window for the race condition described below.\n\nThis method had some code to force the PALP process to shut down at the end of iteration, rather than waiting for it to complete naturally.   However, this was failing randomly, at least on Windows, due to a race condition where the process could end between calling `poll()` and calling `terminate()` (and/or `kill()`)--the `terminate()` call would in turn cause an `OSError` (\"No such process\").\n\nThe newly added `terminate()` context manager does effectively the same thing as the old code, but also makes sure to close any streams, and handles the aforementioned race condition better.\n\nSince the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.\n\nAs discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.\n\n**Update:** The Cygwin issue is now fixed upstream: https://cygwin.com/git/?p=newlib-cygwin.git;a=commitdiff;h=86f79af827729f3968d8b3b8f860ac29d200da0d  No harm in checking for this behavior regardless though.\n\n**CC:**  gouezel @jdemeyer @vbraun\n\n**Keywords:** palp subprocess\n\n**Branch/Commit:** [87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Reviewer:** Erik Bray, Jeroen Demeyer\n\n**Author:** Erik Bray, Jeroen Demeyer\n\n**Dependencies:** #22695\n\nIssue created by migration from https://trac.sagemath.org/ticket/21206\n\n",
    "closed_at": "2017-04-25T17:40:12Z",
    "created_at": "2016-08-10T14:37:38Z",
    "labels": [
        "component: porting: cygwin",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "Add improved process shutdown code for PALPreader._iterate_list",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/21206",
    "user": "https://github.com/embray"
}
```
This is to fix the tests in `sage.geometry.polyhedron.palp_database`, which were irregularly failing on Cygwin.  I don't think there's really anything Cygwin-specific about the issue, actually.  It just tends to exhibit itself on Cygwin because process shutdown takes longer, giving a wider window for the race condition described below.

This method had some code to force the PALP process to shut down at the end of iteration, rather than waiting for it to complete naturally.   However, this was failing randomly, at least on Windows, due to a race condition where the process could end between calling `poll()` and calling `terminate()` (and/or `kill()`)--the `terminate()` call would in turn cause an `OSError` ("No such process").

The newly added `terminate()` context manager does effectively the same thing as the old code, but also makes sure to close any streams, and handles the aforementioned race condition better.

Since the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.

As discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.

**Update:** The Cygwin issue is now fixed upstream: https://cygwin.com/git/?p=newlib-cygwin.git;a=commitdiff;h=86f79af827729f3968d8b3b8f860ac29d200da0d  No harm in checking for this behavior regardless though.

**CC:**  gouezel @jdemeyer @vbraun

**Keywords:** palp subprocess

**Branch/Commit:** [87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)

**Upstream:** Fixed upstream, in a later stable release.

**Reviewer:** Erik Bray, Jeroen Demeyer

**Author:** Erik Bray, Jeroen Demeyer

**Dependencies:** #22695

Issue created by migration from https://trac.sagemath.org/ticket/21206





---

archive/issue_comments_311948.json:
```json
{
    "body": "**Commit:** [db6085b7df8080929629b4c6d1e75696ddc4d00e](https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e)",
    "created_at": "2016-08-10T14:38:07Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [db6085b7df8080929629b4c6d1e75696ddc4d00e](https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e)



---

archive/issue_comments_311949.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e\">db6085b</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr></table>\n",
    "created_at": "2016-08-10T14:38:07Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e">db6085b</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr></table>




---

archive/issue_events_190079.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-10T14:38:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190079"
}
```



---

archive/issue_comments_311950.json:
```json
{
    "body": "<a id='comment:3'></a>\nDuplicate of #17864?",
    "created_at": "2016-08-10T14:59:11Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311950",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Duplicate of #17864?



---

archive/issue_comments_311951.json:
```json
{
    "body": "<a id='comment:4'></a>\nAt least it's related to #17864, but the descriptions of both tickets seem to indicate a differnt cause.",
    "created_at": "2016-08-10T15:03:27Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311951",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
At least it's related to #17864, but the descriptions of both tickets seem to indicate a differnt cause.



---

archive/issue_comments_311952.json:
```json
{
    "body": "<a id='comment:5'></a>\n0.1 seconds is a ridiculously short time to wait. You might as well send `SIGKILL` directly...",
    "created_at": "2016-08-10T15:04:08Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311952",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
0.1 seconds is a ridiculously short time to wait. You might as well send `SIGKILL` directly...



---

archive/issue_comments_311953.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis `terminate()` context thing obviously does not belong in `palp_database.py`, it could be used more generally.\n\nSince it seems vaguely related to `src/sage/parallel/safefork.pyx`, I would actually propose to move your new code and `safefork.pyx` to a single file, say `src/sage/interfaces/process.pyx` (or whatever you want to call it).",
    "created_at": "2016-08-10T15:09:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311953",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
This `terminate()` context thing obviously does not belong in `palp_database.py`, it could be used more generally.

Since it seems vaguely related to `src/sage/parallel/safefork.pyx`, I would actually propose to move your new code and `safefork.pyx` to a single file, say `src/sage/interfaces/process.pyx` (or whatever you want to call it).



---

archive/issue_comments_311954.json:
```json
{
    "body": "<a id='comment:7'></a>\nJust a pointer: you should have a look at the code for killing `SagePtyProcess` in `src/sage/interfaces/sagespawn.pyx`",
    "created_at": "2016-08-10T15:18:09Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311954",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Just a pointer: you should have a look at the code for killing `SagePtyProcess` in `src/sage/interfaces/sagespawn.pyx`



---

archive/issue_comments_311955.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay on all of the above.  I don't know about #17864--this seems to fix any problem I had with this on Cygwin.",
    "created_at": "2016-08-10T15:45:17Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311955",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Okay on all of the above.  I don't know about #17864--this seems to fix any problem I had with this on Cygwin.



---

archive/issue_events_190080.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T09:57:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190080"
}
```



---

archive/issue_events_190081.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-11T09:57:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190081"
}
```



---

archive/issue_comments_311956.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n The newly added `terminate()` context manager does effectively the same thing as the old code, but also makes sure to close any streams, and handles the aforementioned race condition better.\n \n Since the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.\n+\n+As discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.\n``````\n",
    "created_at": "2016-08-11T09:57:15Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311956",
    "user": "https://github.com/embray"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 The newly added `terminate()` context manager does effectively the same thing as the old code, but also makes sure to close any streams, and handles the aforementioned race condition better.
 
 Since the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.
+
+As discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.
``````




---

archive/issue_comments_311957.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2016-08-11T09:57:15Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311957",
    "user": "https://github.com/embray"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_311958.json:
```json
{
    "body": "<a id='comment:10'></a>\nFor the purposes of PALP, would it be possible to just do a normal process termination? That is, work around the Cygwin bug but don't do stuff like sending `SIGKILL` in case the process does not terminate within a given time.",
    "created_at": "2016-08-12T08:19:20Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311958",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
For the purposes of PALP, would it be possible to just do a normal process termination? That is, work around the Cygwin bug but don't do stuff like sending `SIGKILL` in case the process does not terminate within a given time.



---

archive/issue_comments_311959.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n Since the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.\n \n As discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.\n+\n+**Update:** The Cygwin issue is now fixed upstream: https://cygwin.com/git/?p=newlib-cygwin.git;a=commitdiff;h=86f79af827729f3968d8b3b8f860ac29d200da0d  No harm in checking for this behavior regardless though.\n``````\n",
    "created_at": "2016-08-12T08:46:42Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311959",
    "user": "https://github.com/embray"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 Since the `terminate()` context manager is fairly generic, there is probably a better long-term home for it than here.
 
 As discussed in #17864, a more general problem here is that `kill()` should not return an error when sent to already exited processes, and the fact that it does on Cygwin is probably a misfeature, so I have reported it upstream: https://cygwin.com/ml/cygwin/2016-08/msg00188.html  This issue isn't *necessarily* unique to Cygwin though.
+
+**Update:** The Cygwin issue is now fixed upstream: https://cygwin.com/git/?p=newlib-cygwin.git;a=commitdiff;h=86f79af827729f3968d8b3b8f860ac29d200da0d  No harm in checking for this behavior regardless though.
``````




---

archive/issue_comments_311960.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2016-08-12T08:46:42Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311960",
    "user": "https://github.com/embray"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_311961.json:
```json
{
    "body": "<a id='comment:12'></a>\nI know this needs other work, but when I build the docs with this fix applied I get:\n\n```\n[dochtml] OSError: [geometry ] /home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/geometry/polyhedron/palp_database.py:docstring of sage.geometry.polyhedron.palp_database.terminate:31: WARNING: Block quote ends without a blank line; unexpected unindent.\n```\n\nI can't for the life of me figure out what this needs.  If I look at other docstrings there are plenty that have a blockquote at the end of the docstring with no newline.  But even when I add an additional newline it still complains.  Anyone seen this before?",
    "created_at": "2016-08-16T15:47:21Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311961",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
I know this needs other work, but when I build the docs with this fix applied I get:

```
[dochtml] OSError: [geometry ] /home/embray/src/sagemath/sage-cygwin/local/lib/python2.7/site-packages/sage/geometry/polyhedron/palp_database.py:docstring of sage.geometry.polyhedron.palp_database.terminate:31: WARNING: Block quote ends without a blank line; unexpected unindent.
```

I can't for the life of me figure out what this needs.  If I look at other docstrings there are plenty that have a blockquote at the end of the docstring with no newline.  But even when I add an additional newline it still complains.  Anyone seen this before?



---

archive/issue_comments_311962.json:
```json
{
    "body": "<a id='comment:13'></a>\nAbout `SIGALRM`: I have some ideas to improve `cysignals` to better cooperate with other libraries. Remember that `cysignals` was originally written just for Sage without much regard for more general usage.",
    "created_at": "2016-08-17T07:54:17Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311962",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
About `SIGALRM`: I have some ideas to improve `cysignals` to better cooperate with other libraries. Remember that `cysignals` was originally written just for Sage without much regard for more general usage.



---

archive/issue_comments_311963.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [embray](#comment%3A12):\n> But even when I add an additional newline it still complains.  Anyone seen this before?\n\n\n\n```\n\"\"\"\n[...]\nsignal(SIGTERM, SIG_IGN)\\n\n[...]\n\"\"\"\n```\nYou need to use a `r\"\"\"` string to make the `\\n` literal instead of an actual newline.",
    "created_at": "2016-08-17T07:56:33Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311963",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [embray](#comment%3A12):
> But even when I add an additional newline it still complains.  Anyone seen this before?



```
"""
[...]
signal(SIGTERM, SIG_IGN)\n
[...]
"""
```
You need to use a `r"""` string to make the `\n` literal instead of an actual newline.



---

archive/issue_comments_311964.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A14):\n> You need to use a `r\"\"\"` string to make the `\\n` literal instead of an actual newline.\n\n\nAh! Thanks for catching that.  Subtle(-ish).\n\nAs for SIGALRM I think that was about another ticket--I don't think there's really an issue with SIGALRM here, unless I'm missing something.  I'd be interested to hear your thoughts though.",
    "created_at": "2016-08-17T08:03:36Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311964",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A14):
> You need to use a `r"""` string to make the `\n` literal instead of an actual newline.


Ah! Thanks for catching that.  Subtle(-ish).

As for SIGALRM I think that was about another ticket--I don't think there's really an issue with SIGALRM here, unless I'm missing something.  I'd be interested to hear your thoughts though.



---

archive/issue_comments_311965.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jdemeyer](#comment%3A6):\n> This `terminate()` context thing obviously does not belong in `palp_database.py`, it could be used more generally.\n> \n> Since it seems vaguely related to `src/sage/parallel/safefork.pyx`, I would actually propose to move your new code and `safefork.pyx` to a single file, say `src/sage/interfaces/process.pyx` (or whatever you want to call it).\n\n\nI'm fine with this, but should I keep a `sage.parallel.safefork` alias for backwards compatibility?  And if so, what is the best way to deprecate it?",
    "created_at": "2016-11-24T11:28:40Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311965",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Replying to [jdemeyer](#comment%3A6):
> This `terminate()` context thing obviously does not belong in `palp_database.py`, it could be used more generally.
> 
> Since it seems vaguely related to `src/sage/parallel/safefork.pyx`, I would actually propose to move your new code and `safefork.pyx` to a single file, say `src/sage/interfaces/process.pyx` (or whatever you want to call it).


I'm fine with this, but should I keep a `sage.parallel.safefork` alias for backwards compatibility?  And if so, what is the best way to deprecate it?



---

archive/issue_comments_311966.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/cygwin-palp-database](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin-palp-database)\" to \"[u/embray/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage_interfaces_process)\".",
    "created_at": "2016-11-29T13:37:13Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311966",
    "user": "https://github.com/embray"
}
```

**Changing branch** from "[u/embray/cygwin-palp-database](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/cygwin-palp-database)" to "[u/embray/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage_interfaces_process)".



---

archive/issue_comments_311967.json:
```json
{
    "body": "**Changing commit** from \"[db6085b7df8080929629b4c6d1e75696ddc4d00e](https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e)\" to \"[f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49](https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49)\".",
    "created_at": "2016-11-29T13:37:13Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311967",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[db6085b7df8080929629b4c6d1e75696ddc4d00e](https://github.com/sagemath/sagetrac-mirror/commit/db6085b7df8080929629b4c6d1e75696ddc4d00e)" to "[f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49](https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49)".



---

archive/issue_events_190082.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-11-29T13:37:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190082"
}
```



---

archive/issue_events_190083.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-11-29T13:37:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190083"
}
```



---

archive/issue_comments_311968.json:
```json
{
    "body": "<a id='comment:17'></a>\nAs suggested I combined the `terminate` context manager and the `ContainChildren` context manager into a single module called `sage.interfaces.process` (to me that still seems like an odd place for it but I don't have a better suggestion).\n\nStill an open question is what to do with `sage.parallel.safefork` and it should be kept for backwards compatibility?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/448a9f87d41a3424f4aaef145233dbe4f3eb4401\">448a9f8</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb3d195f1dd24ecf4ef9470f1ce703d10481b70b\">cb3d195</a></td><td><code>Move the terminate and ContainChildren context managers into a new sage.interfaces.process module</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49\">f1ecb0e</a></td><td><code>Updated terminate() to add a little more customizability in its behavior, with I think reasonable defaults.</code></td></tr></table>\n",
    "created_at": "2016-11-29T13:37:13Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311968",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>
As suggested I combined the `terminate` context manager and the `ContainChildren` context manager into a single module called `sage.interfaces.process` (to me that still seems like an odd place for it but I don't have a better suggestion).

Still an open question is what to do with `sage.parallel.safefork` and it should be kept for backwards compatibility?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/448a9f87d41a3424f4aaef145233dbe4f3eb4401">448a9f8</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb3d195f1dd24ecf4ef9470f1ce703d10481b70b">cb3d195</a></td><td><code>Move the terminate and ContainChildren context managers into a new sage.interfaces.process module</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49">f1ecb0e</a></td><td><code>Updated terminate() to add a little more customizability in its behavior, with I think reasonable defaults.</code></td></tr></table>




---

archive/issue_comments_311969.json:
```json
{
    "body": "<a id='comment:18'></a>\nAny comments on this?  Per Jeroen's suggestion I moved the contents of `sage.parallel.safefork` into a new `sage.interfaces.process` module.  The open question for me is whether there should be a deprecation process for `sage.parallel.safefork` or if it can just be dropped entirely?",
    "created_at": "2017-01-03T11:30:55Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311969",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Any comments on this?  Per Jeroen's suggestion I moved the contents of `sage.parallel.safefork` into a new `sage.interfaces.process` module.  The open question for me is whether there should be a deprecation process for `sage.parallel.safefork` or if it can just be dropped entirely?



---

archive/issue_comments_311970.json:
```json
{
    "body": "<a id='comment:19'></a>\nFor me, there is no need to deprecate anything...",
    "created_at": "2017-01-03T15:55:18Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311970",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
For me, there is no need to deprecate anything...



---

archive/issue_comments_311971.json:
```json
{
    "body": "<a id='comment:20'></a>\nI think the `retries` argument is over-thinking it. Better send the signal once and wait 3 seconds instead of sending the signal 3 times and waiting 1 second every time.",
    "created_at": "2017-01-03T15:58:15Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311971",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
I think the `retries` argument is over-thinking it. Better send the signal once and wait 3 seconds instead of sending the signal 3 times and waiting 1 second every time.



---

archive/issue_comments_311972.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe docstring formatting of `terminate` is messed up: there is a stray `\"\"\"`.",
    "created_at": "2017-01-03T16:00:09Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311972",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
The docstring formatting of `terminate` is messed up: there is a stray `"""`.



---

archive/issue_comments_311973.json:
```json
{
    "body": "<a id='comment:22'></a>\nIf `sp.poll()` is racy, why call it at all? You could EAFP this and just call `send_signal` directly.",
    "created_at": "2017-01-03T16:02:41Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311973",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
If `sp.poll()` is racy, why call it at all? You could EAFP this and just call `send_signal` directly.



---

archive/issue_comments_311974.json:
```json
{
    "body": "<a id='comment:23'></a>\nI also suggest to add the delay between closing the streams and the first killing attempt. So the result would be:\n\n1. Close streams\n\n2. Wait\n\n3. Send `SIGTERM`\n\n4. Wait\n\n5. Send `SIGKILL`",
    "created_at": "2017-01-03T16:05:21Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311974",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
I also suggest to add the delay between closing the streams and the first killing attempt. So the result would be:

1. Close streams

2. Wait

3. Send `SIGTERM`

4. Wait

5. Send `SIGKILL`



---

archive/issue_comments_311975.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jdemeyer](#comment%3A20):\n> I think the `retries` argument is over-thinking it. Better send the signal once and wait 3 seconds instead of sending the signal 3 times and waiting 1 second every time.\n\n\nI think you're right--there's no point in resending the signal.  Either it gets handled (eventually) or is blocked forever in which case we move on to the next signal.",
    "created_at": "2017-01-03T16:28:27Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311975",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Replying to [jdemeyer](#comment%3A20):
> I think the `retries` argument is over-thinking it. Better send the signal once and wait 3 seconds instead of sending the signal 3 times and waiting 1 second every time.


I think you're right--there's no point in resending the signal.  Either it gets handled (eventually) or is blocked forever in which case we move on to the next signal.



---

archive/issue_comments_311976.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [jdemeyer](#comment%3A19):\n> For me, there is no need to deprecate anything...\n\n\nI ask because Sage does not have a well defined API.  I bet there are some things that if they were renamed/moved it would be a big problem.  Other things less so.  I have no way of knowing.",
    "created_at": "2017-01-03T16:29:53Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311976",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Replying to [jdemeyer](#comment%3A19):
> For me, there is no need to deprecate anything...


I ask because Sage does not have a well defined API.  I bet there are some things that if they were renamed/moved it would be a big problem.  Other things less so.  I have no way of knowing.



---

archive/issue_comments_311977.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [jdemeyer](#comment%3A21):\n> The docstring formatting of `terminate` is messed up: there is a stray `\"\"\"`.\n\n\nOops, not sure how that got there.  Must have been a stray paste last time I saved the file--it was weeks ago but I seem to recall confirming that all the tests were running and passing.",
    "created_at": "2017-01-03T16:32:50Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311977",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>
Replying to [jdemeyer](#comment%3A21):
> The docstring formatting of `terminate` is messed up: there is a stray `"""`.


Oops, not sure how that got there.  Must have been a stray paste last time I saved the file--it was weeks ago but I seem to recall confirming that all the tests were running and passing.



---

archive/issue_comments_311978.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jdemeyer](#comment%3A22):\n> If `sp.poll()` is racy, why call it at all? You could EAFP this and just call `send_signal` directly.\n\n\nIt's not really poll() itself that has a problem, but I see what you're saying.  If the point is to immediately terminate the process rather than let it finish (assuming it hasn't already finished) then I agree, there's no reason to call poll() or wait() in the first place.  I think I kept it just going off the original code this was based on.  You still need the try/except block regardless.\n\nAlternatively, the context manager could take a timeout argument allowing the process a little more time to finish on its own, but I don't see it being needed right now.",
    "created_at": "2017-01-03T16:42:20Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311978",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
Replying to [jdemeyer](#comment%3A22):
> If `sp.poll()` is racy, why call it at all? You could EAFP this and just call `send_signal` directly.


It's not really poll() itself that has a problem, but I see what you're saying.  If the point is to immediately terminate the process rather than let it finish (assuming it hasn't already finished) then I agree, there's no reason to call poll() or wait() in the first place.  I think I kept it just going off the original code this was based on.  You still need the try/except block regardless.

Alternatively, the context manager could take a timeout argument allowing the process a little more time to finish on its own, but I don't see it being needed right now.



---

archive/issue_comments_311979.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b24d072ac08859fe4b2eaa532ddda9589a3c5bcd\">b24d072</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03c5e01841d9669eb70c1b9ff09cc1d3d9748fd4\">03c5e01</a></td><td><code>Move the terminate and ContainChildren context managers into a new sage.interfaces.process module</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/973313cfe8c24261646d3752f9245c6bcdcdbb6d\">973313c</a></td><td><code>Updated terminate() to add a little more customizability in its behavior, with I think reasonable defaults.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b\">bcbe8e9</a></td><td><code>some simplifications: got rid of the unecessary 'retry' option; add delay after closing streams</code></td></tr></table>\n",
    "created_at": "2017-04-11T16:12:35Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b24d072ac08859fe4b2eaa532ddda9589a3c5bcd">b24d072</a></td><td><code>Add improved process shutdown code for PALPreader._iterate_list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03c5e01841d9669eb70c1b9ff09cc1d3d9748fd4">03c5e01</a></td><td><code>Move the terminate and ContainChildren context managers into a new sage.interfaces.process module</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/973313cfe8c24261646d3752f9245c6bcdcdbb6d">973313c</a></td><td><code>Updated terminate() to add a little more customizability in its behavior, with I think reasonable defaults.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b">bcbe8e9</a></td><td><code>some simplifications: got rid of the unecessary 'retry' option; add delay after closing streams</code></td></tr></table>




---

archive/issue_comments_311980.json:
```json
{
    "body": "**Changing commit** from \"[f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49](https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49)\" to \"[bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b](https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b)\".",
    "created_at": "2017-04-11T16:12:35Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49](https://github.com/sagemath/sagetrac-mirror/commit/f1ecb0ebfb6c20f22df87b6aa4dd392c76435b49)" to "[bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b](https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b)".



---

archive/issue_comments_311981.json:
```json
{
    "body": "<a id='comment:29'></a>\nFinally updated this--I think this addresses your last comments.  I kept the `poll()` call because I want to check if the process actually ended before making other attempts.",
    "created_at": "2017-04-11T16:21:16Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311981",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
Finally updated this--I think this addresses your last comments.  I kept the `poll()` call because I want to check if the process actually ended before making other attempts.



---

archive/issue_events_190084.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T16:21:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190084"
}
```



---

archive/issue_events_190085.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T16:21:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190085"
}
```



---

archive/issue_comments_311982.json:
```json
{
    "body": "<a id='comment:30'></a>\nDo you have a reference for this claim about `SIGHUP`?\n\n```\nit also first closes all standard I/O pipes, which should send a SIGHUP.\n```\n\nWriting to a closed pipe can give `SIGPIPE` but I don't think that just closing a pipe would send any signal.",
    "created_at": "2017-04-12T08:13:34Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311982",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Do you have a reference for this claim about `SIGHUP`?

```
it also first closes all standard I/O pipes, which should send a SIGHUP.
```

Writing to a closed pipe can give `SIGPIPE` but I don't think that just closing a pipe would send any signal.



---

archive/issue_comments_311983.json:
```json
{
    "body": "<a id='comment:31'></a>\nYou're right, that should probably say SIGPIPE.  It *would* be SIGHUP if this were a tty but that's not the case here (I think I was working on pexect more recently so that's probably what I was thinking about).",
    "created_at": "2017-04-12T14:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311983",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>
You're right, that should probably say SIGPIPE.  It *would* be SIGHUP if this were a tty but that's not the case here (I think I was working on pexect more recently so that's probably what I was thinking about).



---

archive/issue_comments_311984.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe `time.sleep()` is a inefficient. If the process exits after 1ms, we still have to wait 999ms to notice it.\n\nI suggest to improve this with a `SIGCHLD` handler. I have recently added code to `cysignals` to temporarily change a signal handler, so I could use that to implement the `SIGCHLD` trick.",
    "created_at": "2017-04-12T20:11:26Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311984",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
The `time.sleep()` is a inefficient. If the process exits after 1ms, we still have to wait 999ms to notice it.

I suggest to improve this with a `SIGCHLD` handler. I have recently added code to `cysignals` to temporarily change a signal handler, so I could use that to implement the `SIGCHLD` trick.



---

archive/issue_events_190086.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-12T20:11:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190086"
}
```



---

archive/issue_events_190087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-12T20:11:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190087"
}
```



---

archive/issue_events_190088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-13T08:50:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190088"
}
```



---

archive/issue_comments_311985.json:
```json
{
    "body": "<a id='comment:34'></a>\nWorking on this...",
    "created_at": "2017-04-13T08:50:43Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311985",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Working on this...



---

archive/issue_comments_311986.json:
```json
{
    "body": "**Changing author** from \"Erik Bray\" to \"Erik Bray, Jeroen Demeyer\".",
    "created_at": "2017-04-13T08:50:43Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311986",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Erik Bray" to "Erik Bray, Jeroen Demeyer".



---

archive/issue_comments_311987.json:
```json
{
    "body": "<a id='comment:35'></a>\nOkay.  I see what you're saying though and I agree.",
    "created_at": "2017-04-13T09:29:52Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311987",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
Okay.  I see what you're saying though and I agree.



---

archive/issue_comments_311988.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage_interfaces_process)\" to \"[u/jdemeyer/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage_interfaces_process)\".",
    "created_at": "2017-04-13T10:20:54Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311988",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/embray/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/sage_interfaces_process)" to "[u/jdemeyer/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage_interfaces_process)".



---

archive/issue_comments_311989.json:
```json
{
    "body": "**Changing commit** from \"[bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b](https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b)\" to \"[87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)\".",
    "created_at": "2017-04-13T14:32:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311989",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b](https://github.com/sagemath/sagetrac-mirror/commit/bcbe8e90bd75c89a0a7a0bc6daed9eb8ab395a5b)" to "[87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)".



---

archive/issue_events_190089.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-13T14:32:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190089"
}
```



---

archive/issue_events_190090.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-13T14:32:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190090"
}
```



---

archive/issue_comments_311990.json:
```json
{
    "body": "**Dependencies:** #22695",
    "created_at": "2017-04-13T14:32:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311990",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #22695



---

archive/issue_comments_311991.json:
```json
{
    "body": "<a id='comment:37'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c89d7eff3178b79b8e51e221cea13ea209991422\">c89d7ef</a></td><td><code>Fix compiler warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94\">87623c2</a></td><td><code>Improve shutdown code</code></td></tr></table>\n",
    "created_at": "2017-04-13T14:32:00Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311991",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c89d7eff3178b79b8e51e221cea13ea209991422">c89d7ef</a></td><td><code>Fix compiler warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94">87623c2</a></td><td><code>Improve shutdown code</code></td></tr></table>




---

archive/issue_comments_311992.json:
```json
{
    "body": "<a id='comment:38'></a>\nFine by me.  The only thing I don't get is the `t <= 4.0 or t` in the tests you added.  What's that about?",
    "created_at": "2017-04-14T08:46:27Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311992",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>
Fine by me.  The only thing I don't get is the `t <= 4.0 or t` in the tests you added.  What's that about?



---

archive/issue_comments_311993.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [embray](#comment%3A38):\n> Fine by me.  The only thing I don't get is the `t <= 4.0 or t` in the tests you added.  What's that about?\n\n\nThe `t <= 4.0` part is to check that the sleep inside the `with terminate(sp, interval=5.0):` block was actually interrupted. If the interrupt didn't work, at least 5 seconds would have passed.\n\nThe `or t` part is a neat trick I learned from Robert Bradshaw. In case of a doctest failure (where `t <= 4.0` would be `False`), you see the actual value of `t` instead of just `False`.",
    "created_at": "2017-04-15T12:05:20Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311993",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Replying to [embray](#comment%3A38):
> Fine by me.  The only thing I don't get is the `t <= 4.0 or t` in the tests you added.  What's that about?


The `t <= 4.0` part is to check that the sleep inside the `with terminate(sp, interval=5.0):` block was actually interrupted. If the interrupt didn't work, at least 5 seconds would have passed.

The `or t` part is a neat trick I learned from Robert Bradshaw. In case of a doctest failure (where `t <= 4.0` would be `False`), you see the actual value of `t` instead of just `False`.



---

archive/issue_comments_311994.json:
```json
{
    "body": "<a id='comment:40'></a>\nI see--it was the `or t` I didn't get.  That makes sense for a doctest.  Works for me.",
    "created_at": "2017-04-17T12:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311994",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
I see--it was the `or t` I didn't get.  That makes sense for a doctest.  Works for me.



---

archive/issue_events_190091.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T12:38:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190091"
}
```



---

archive/issue_events_190092.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T12:38:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190092"
}
```



---

archive/issue_events_190093.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T12:49:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190093"
}
```



---

archive/issue_events_190094.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T12:49:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190094"
}
```



---

archive/issue_comments_311995.json:
```json
{
    "body": "<a id='comment:41'></a>\nExcept--the cysignals in Sage currently does not have a `.pysignals` module.",
    "created_at": "2017-04-17T12:49:10Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311995",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
Except--the cysignals in Sage currently does not have a `.pysignals` module.



---

archive/issue_comments_311996.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [embray](#comment%3A41):\n> Except--the cysignals in Sage currently does not have a `.pysignals` module.\n\n\nWell, that's why I added #22695 as dependency.",
    "created_at": "2017-04-17T16:34:46Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311996",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
Replying to [embray](#comment%3A41):
> Except--the cysignals in Sage currently does not have a `.pysignals` module.


Well, that's why I added #22695 as dependency.



---

archive/issue_events_190095.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-17T16:34:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190095"
}
```



---

archive/issue_events_190096.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-17T16:34:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190096"
}
```



---

archive/issue_comments_311997.json:
```json
{
    "body": "<a id='comment:43'></a>\nOkay I didn't see that, I'll test that in bit.",
    "created_at": "2017-04-19T09:36:31Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311997",
    "user": "https://github.com/embray"
}
```

<a id='comment:43'></a>
Okay I didn't see that, I'll test that in bit.



---

archive/issue_comments_311998.json:
```json
{
    "body": "<a id='comment:44'></a>\nReviewer name missing...",
    "created_at": "2017-04-21T22:35:45Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311998",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>
Reviewer name missing...



---

archive/issue_events_190097.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-21T22:35:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190097"
}
```



---

archive/issue_events_190098.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-21T22:35:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190098"
}
```



---

archive/issue_events_190099.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-23T13:38:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190099"
}
```



---

archive/issue_events_190100.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-23T13:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190100"
}
```



---

archive/issue_comments_311999.json:
```json
{
    "body": "**Reviewer:** Erik Bray, Jeroen Demeyer",
    "created_at": "2017-04-23T13:38:13Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-311999",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Erik Bray, Jeroen Demeyer



---

archive/issue_comments_312000.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage_interfaces_process)\" to \"[87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)\".",
    "created_at": "2017-04-25T17:40:12Z",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21206#issuecomment-312000",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/sage_interfaces_process](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/sage_interfaces_process)" to "[87623c2f4cfee74c465000ff8df5eaf5e61e0e94](https://github.com/sagemath/sagetrac-mirror/commit/87623c2f4cfee74c465000ff8df5eaf5e61e0e94)".



---

archive/issue_events_190101.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-25T17:40:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190101"
}
```



---

archive/issue_events_190102.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-25T17:40:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21206#event-190102"
}
```
