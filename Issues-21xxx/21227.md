# Issue 21227: sage-mode broken in Sage 7.4. sage-shell-mode is the future?

archive/issues_020990.json:
```json
{
    "body": "On sage 7.4 beta0, emacs GNU Emacs 24.3.1 (x86_64-pc-linux-gnu, GTK+ Version 3.10.7) of 2014-03-07 on lamiak, modified by Debian, beloved sage_mode 0.14 is broken.  All in and output except the banner is unreadable!\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 7.4.beta0, Release Date: 2016-08-10               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n[?12l [?25h1+1\n[J [?7h [?12l [?25h [?2004l [?7h2\n[?12l [?25h\n```\n\nCC:  darthandrus@gmail.com @johanrosenkilde @vbraun @dimpase @kiwifb @EmmanuelCharpentier stakemori\n\nKeywords: sage_mode, sage-mode\n\nUpstream: Reported upstream. No feedback yet.\n\nReviewer: Dima Pasechnik\n\nBranch: u/mkoeppe/sage_mode_for_emacs_has_display_problem_in_sage_7_4_beta0\n\nCommit: 92378caa0c1a030b9399e889f42edb5afc8c6d87\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/21227\n\n",
    "closed_at": "2020-05-22T09:51:06Z",
    "created_at": "2016-08-11T21:45:45Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage-mode broken in Sage 7.4. sage-shell-mode is the future?",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21227",
    "user": "https://github.com/mantepse"
}
```
On sage 7.4 beta0, emacs GNU Emacs 24.3.1 (x86_64-pc-linux-gnu, GTK+ Version 3.10.7) of 2014-03-07 on lamiak, modified by Debian, beloved sage_mode 0.14 is broken.  All in and output except the banner is unreadable!

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.4.beta0, Release Date: 2016-08-10               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
[?12l [?25h1+1
[J [?7h [?12l [?25h [?2004l [?7h2
[?12l [?25h
```

CC:  darthandrus@gmail.com @johanrosenkilde @vbraun @dimpase @kiwifb @EmmanuelCharpentier stakemori

Keywords: sage_mode, sage-mode

Upstream: Reported upstream. No feedback yet.

Reviewer: Dima Pasechnik

Branch: u/mkoeppe/sage_mode_for_emacs_has_display_problem_in_sage_7_4_beta0

Commit: 92378caa0c1a030b9399e889f42edb5afc8c6d87

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/21227





---

archive/issue_comments_389507.json:
```json
{
    "body": "<a id='comment:1'></a>Leif mentioned on sage-devel:\n\n```\n3) Probably disable the color mode. \n```\n\nI'm not sure what he means with that, but just typing ```%colors NoColor``` after the weird sage prompt doesn't help.",
    "created_at": "2016-08-11T21:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389507",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:1'></a>Leif mentioned on sage-devel:

```
3) Probably disable the color mode. 
```

I'm not sure what he means with that, but just typing ```%colors NoColor``` after the weird sage prompt doesn't help.



---

archive/issue_comments_389508.json:
```json
{
    "body": "<a id='comment:2'></a>You may play with (settings in)\n\n```\nsage: %config SageTerminalInteractiveShell\n```",
    "created_at": "2016-08-11T22:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389508",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>You may play with (settings in)

```
sage: %config SageTerminalInteractiveShell
```



---

archive/issue_comments_389509.json:
```json
{
    "body": "<a id='comment:3'></a>(Sage 7.4.beta0 upgraded IPython to 5.0, see #21006.)",
    "created_at": "2016-08-11T22:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389509",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>(Sage 7.4.beta0 upgraded IPython to 5.0, see #21006.)



---

archive/issue_comments_389510.json:
```json
{
    "body": "<a id='comment:5'></a>Here's a simple change that enables \"simple prompts\" when sage is run within an Emacs inferior shell. \nHowever, as has been noted [here](http://emacs.stackexchange.com/questions/24453/weird-shell-output-when-using-ipython-5), the \"simple prompts\" mode lacks multi-line support, so one gets this:\n\n```\nIn [1]: def f(x):\n  File \"<ipython-input-1-cde3fd95d55b>\", line 1\n    def f(x):\n             ^\nSyntaxError: unexpected EOF while parsing\n```\n\n```diff\ndiff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py\nindex 1f4eda7..1d69829 100644\n--- a/src/sage/repl/interpreter.py\n+++ b/src/sage/repl/interpreter.py\n@@ -248,6 +248,14 @@ class SageTerminalInteractiveShell(SageShellOverride, TerminalInteractiveShell):\n         <sage.repl.interpreter.SageNotebookInteractiveShell object at 0x...>\n     \"\"\"\n \n+    def init_prompt_toolkit_cli(self):\n+        \"\"\"\n+        Use plain non-interactive output if TERM=dumb (as in an Emacs inferior shell)\n+        \"\"\"\n+        if os.environ['TERM'] == 'dumb':\n+            self.simple_prompt = True\n+        return super(SageTerminalInteractiveShell, self).init_prompt_toolkit_cli()\n+\n     def init_display_formatter(self):\n         \"\"\"\n         Switch to the Sage IPython commandline rich output backend\n```",
    "created_at": "2016-08-18T19:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389510",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Here's a simple change that enables "simple prompts" when sage is run within an Emacs inferior shell. 
However, as has been noted [here](http://emacs.stackexchange.com/questions/24453/weird-shell-output-when-using-ipython-5), the "simple prompts" mode lacks multi-line support, so one gets this:

```
In [1]: def f(x):
  File "<ipython-input-1-cde3fd95d55b>", line 1
    def f(x):
             ^
SyntaxError: unexpected EOF while parsing
```

```diff
diff --git a/src/sage/repl/interpreter.py b/src/sage/repl/interpreter.py
index 1f4eda7..1d69829 100644
--- a/src/sage/repl/interpreter.py
+++ b/src/sage/repl/interpreter.py
@@ -248,6 +248,14 @@ class SageTerminalInteractiveShell(SageShellOverride, TerminalInteractiveShell):
         <sage.repl.interpreter.SageNotebookInteractiveShell object at 0x...>
     """
 
+    def init_prompt_toolkit_cli(self):
+        """
+        Use plain non-interactive output if TERM=dumb (as in an Emacs inferior shell)
+        """
+        if os.environ['TERM'] == 'dumb':
+            self.simple_prompt = True
+        return super(SageTerminalInteractiveShell, self).init_prompt_toolkit_cli()
+
     def init_display_formatter(self):
         """
         Switch to the Sage IPython commandline rich output backend
```



---

archive/issue_comments_389511.json:
```json
{
    "body": "<a id='comment:6'></a>Thank you for this!  At least I can work again!",
    "created_at": "2016-08-18T20:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389511",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>Thank you for this!  At least I can work again!



---

archive/issue_comments_389512.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_mode_for_emacs_has_display_problem_in_sage_7_4_beta0\"",
    "created_at": "2016-08-18T20:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389512",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_mode_for_emacs_has_display_problem_in_sage_7_4_beta0"



---

archive/issue_comments_389513.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2016-08-18T21:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389513",
    "user": "https://github.com/mkoeppe"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_389514.json:
```json
{
    "body": "<a id='comment:8'></a>I've opened an IPython issue for this:\nhttps://github.com/ipython/ipython/issues/9886\n\n---\nNew commits:",
    "created_at": "2016-08-18T21:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389514",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I've opened an IPython issue for this:
https://github.com/ipython/ipython/issues/9886

---
New commits:



---

archive/issue_comments_389515.json:
```json
{
    "body": "Changing commit from \"\" to \"92378caa0c1a030b9399e889f42edb5afc8c6d87\"",
    "created_at": "2016-08-18T21:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389515",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "92378caa0c1a030b9399e889f42edb5afc8c6d87"



---

archive/issue_comments_389516.json:
```json
{
    "body": "<a id='comment:11'></a>A few remarks :\n\n* The [current patch](https://git.sagemath.org/sage.git/commit?id=92378caa0c1a030b9399e889f42edb5afc8c6d87) waits endlessly for a prompt.\n* When interrupted (C-G), it gives a functional prompt : the Sage REPL is working.\n* When inline plots are enabled, they are displayed, but the sustems claims (falsely) to have launced a png viewer.\n* When tyepeset output is enabled in the menu, the output is displayed as text :\n\n```\nIn [24]: integrate(arctan(x),x)\n\n\nBEGIN_TEXT:x*arctan(x) - 1/2*log(x^2 + 1):END_TEXT\nBEGIN_LATEX:\\newcommand{\\Bold}[1]{\\mathbf{#1}}x \\arctan\\left(x\\right) - \\frac{1}{2} \\, \\log\\left(x^{2} + 1\\right):END_LATEX\n```\n* Ditto when using the `%display typeset` magic...\n\n//\"Oooohhh, so clooose...\"//\n\nHTH,",
    "created_at": "2016-08-22T15:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389516",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:11'></a>A few remarks :

* The [current patch](https://git.sagemath.org/sage.git/commit?id=92378caa0c1a030b9399e889f42edb5afc8c6d87) waits endlessly for a prompt.
* When interrupted (C-G), it gives a functional prompt : the Sage REPL is working.
* When inline plots are enabled, they are displayed, but the sustems claims (falsely) to have launced a png viewer.
* When tyepeset output is enabled in the menu, the output is displayed as text :

```
In [24]: integrate(arctan(x),x)


BEGIN_TEXT:x*arctan(x) - 1/2*log(x^2 + 1):END_TEXT
BEGIN_LATEX:\newcommand{\Bold}[1]{\mathbf{#1}}x \arctan\left(x\right) - \frac{1}{2} \, \log\left(x^{2} + 1\right):END_LATEX
```
* Ditto when using the `%display typeset` magic...

//"Oooohhh, so clooose..."//

HTH,



---

archive/issue_comments_389517.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-08-30T07:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389517",
    "user": "https://github.com/mantepse"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_389518.json:
```json
{
    "body": "<a id='comment:12'></a>I'm making this a blocker, because without fix sage would loose a frontend which is used by not so few.  I also tried the ipython 5.0 branch of https://github.com/stakemori/sage-shell-mode, but could not (yet) get it to work.  (Install went OK, but I cannot even evaluate 1+1.)",
    "created_at": "2016-08-30T07:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389518",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'></a>I'm making this a blocker, because without fix sage would loose a frontend which is used by not so few.  I also tried the ipython 5.0 branch of https://github.com/stakemori/sage-shell-mode, but could not (yet) get it to work.  (Install went OK, but I cannot even evaluate 1+1.)



---

archive/issue_comments_389519.json:
```json
{
    "body": "<a id='comment:14'></a>I've pushed fixes to the master branch of sage-shell-mode. sage-shell-mode was fixed. To use sage-shell-mode with Sage7.4 beta0, please set `sage-shell:use-prompt-toolkit` to `t`.\n\nAs for the patch, could you use an environment variable other than `TERM`? (IPython uses `IPY_TEST_SIMPLE_PROMPT` for the same purpose). If this is merged, `sage-shell-mode` is forced to use the simple prompt. And I don't want to use the simple prompt inside Emacs.\n\nI think sage-mode (or inferior-python-mode) has to implement its own process filter function to fix this bug (without using simple prompt). IPython sends escape sequences that delete text or move the cursor position. So just ignoring escape sequences doesn't work. `comint-mode` cannot handle escape sequences well, but `term-mode` can handle them very well. So I imitated `term-mode`.",
    "created_at": "2016-09-06T22:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389519",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:14'></a>I've pushed fixes to the master branch of sage-shell-mode. sage-shell-mode was fixed. To use sage-shell-mode with Sage7.4 beta0, please set `sage-shell:use-prompt-toolkit` to `t`.

As for the patch, could you use an environment variable other than `TERM`? (IPython uses `IPY_TEST_SIMPLE_PROMPT` for the same purpose). If this is merged, `sage-shell-mode` is forced to use the simple prompt. And I don't want to use the simple prompt inside Emacs.

I think sage-mode (or inferior-python-mode) has to implement its own process filter function to fix this bug (without using simple prompt). IPython sends escape sequences that delete text or move the cursor position. So just ignoring escape sequences doesn't work. `comint-mode` cannot handle escape sequences well, but `term-mode` can handle them very well. So I imitated `term-mode`.



---

archive/issue_comments_389520.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [stakemori](#comment%3A14):\n> I've pushed fixes to the master branch of sage-shell-mode. sage-shell-mode was fixed. To use sage-shell-mode with Sage7.4 beta0, please set `sage-shell:use-prompt-toolkit` to `t`.\n> \n> As for the patch, could you use an environment variable other than `TERM`? (IPython uses `IPY_TEST_SIMPLE_PROMPT` for the same purpose). If this is merged, `sage-shell-mode` is forced to use the simple prompt. And I don't want to use the simple prompt inside Emacs.\n> \n> I think sage-mode (or inferior-python-mode) has to implement its own process filter function to fix this bug (without using simple prompt). IPython sends escape sequences that delete text or move the cursor position. So just ignoring escape sequences doesn't work. `comint-mode` cannot handle escape sequences well, but `term-mode` can handle them very well. So I imitated `term-mode`.\n\n\nWell, term-mode does not set `TERM=dumb`. It sets `TERM=eterm-color`. So?",
    "created_at": "2016-09-06T23:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389520",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [stakemori](#comment%3A14):
> I've pushed fixes to the master branch of sage-shell-mode. sage-shell-mode was fixed. To use sage-shell-mode with Sage7.4 beta0, please set `sage-shell:use-prompt-toolkit` to `t`.
> 
> As for the patch, could you use an environment variable other than `TERM`? (IPython uses `IPY_TEST_SIMPLE_PROMPT` for the same purpose). If this is merged, `sage-shell-mode` is forced to use the simple prompt. And I don't want to use the simple prompt inside Emacs.
> 
> I think sage-mode (or inferior-python-mode) has to implement its own process filter function to fix this bug (without using simple prompt). IPython sends escape sequences that delete text or move the cursor position. So just ignoring escape sequences doesn't work. `comint-mode` cannot handle escape sequences well, but `term-mode` can handle them very well. So I imitated `term-mode`.


Well, term-mode does not set `TERM=dumb`. It sets `TERM=eterm-color`. So?



---

archive/issue_comments_389521.json:
```json
{
    "body": "<a id='comment:17'></a>Sorry. I don't understand your question. What I meant is that the process filter function in `term-mode` (`term-emulate-terminal`) handles escape sequences very well. `sage-shell-mode` is also derived from `comint-mode`.",
    "created_at": "2016-09-06T23:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389521",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:17'></a>Sorry. I don't understand your question. What I meant is that the process filter function in `term-mode` (`term-emulate-terminal`) handles escape sequences very well. `sage-shell-mode` is also derived from `comint-mode`.



---

archive/issue_comments_389522.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [stakemori](#comment%3A17):\n> Sorry. I don't understand your question. What I meant is that the process filter function in `term-mode` (`term-emulate-terminal`) handles escape sequences very well. `sage-shell-mode` is also derived from `comint-mode`.\n\n\nWhat I'm saying is that:\n- term-mode sets `TERM=eterm-color` and so, even with the patch on this ticket, no \"simple prompts\" are used.\n- `comint-mode` does not handle escape sequences. Therefore it sets `TERM=dumb` to inform the applications running under it about this fact. \n- If your mode, derived from `comint-mode`, handles escape sequences, then it should not be using `TERM=dumb` but rather something else; perhaps `TERM=vt100`.",
    "created_at": "2016-09-06T23:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389522",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [stakemori](#comment%3A17):
> Sorry. I don't understand your question. What I meant is that the process filter function in `term-mode` (`term-emulate-terminal`) handles escape sequences very well. `sage-shell-mode` is also derived from `comint-mode`.


What I'm saying is that:
- term-mode sets `TERM=eterm-color` and so, even with the patch on this ticket, no "simple prompts" are used.
- `comint-mode` does not handle escape sequences. Therefore it sets `TERM=dumb` to inform the applications running under it about this fact. 
- If your mode, derived from `comint-mode`, handles escape sequences, then it should not be using `TERM=dumb` but rather something else; perhaps `TERM=vt100`.



---

archive/issue_comments_389523.json:
```json
{
    "body": "<a id='comment:19'></a>Thanks for your explanation. I will change it to other than `dumb`.",
    "created_at": "2016-09-06T23:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389523",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:19'></a>Thanks for your explanation. I will change it to other than `dumb`.



---

archive/issue_comments_389524.json:
```json
{
    "body": "<a id='comment:20'></a>Unfortunately IPython/Prompt Toolkit don't handle the TERM variable. I've just reported another upstream issue here (in addition to the IPython one, which so far has been ignored): https://github.com/jonathanslenders/python-prompt-toolkit/issues/390",
    "created_at": "2016-09-06T23:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389524",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Unfortunately IPython/Prompt Toolkit don't handle the TERM variable. I've just reported another upstream issue here (in addition to the IPython one, which so far has been ignored): https://github.com/jonathanslenders/python-prompt-toolkit/issues/390



---

archive/issue_comments_389525.json:
```json
{
    "body": "<a id='comment:21'></a>I am so grateful that you are working on this!  I'm documenting here how it went, following `Installation and Setup` in `README.org`:\n\n1. perfect\n2. perfect\n3. `set sage-shell:use-prompt-toolkit to non-nil` I wanted to use customize, but it complains:\n\n```\nCreating customization items...\nwidget-apply: Symbol's function definition is void: nil\n```\n4. doing `M-x sage-shell:run-sage` I get `sage-shell:-window-max-chars-per-line: Wrong number of arguments: window-body-width, 2`",
    "created_at": "2016-09-07T07:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389525",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:21'></a>I am so grateful that you are working on this!  I'm documenting here how it went, following `Installation and Setup` in `README.org`:

1. perfect
2. perfect
3. `set sage-shell:use-prompt-toolkit to non-nil` I wanted to use customize, but it complains:

```
Creating customization items...
widget-apply: Symbol's function definition is void: nil
```
4. doing `M-x sage-shell:run-sage` I get `sage-shell:-window-max-chars-per-line: Wrong number of arguments: window-body-width, 2`



---

archive/issue_comments_389526.json:
```json
{
    "body": "<a id='comment:22'></a>Thanks. I've pushed fix to master. But it will take a few hours for Melpa to rebuild the recipe.\nAs for 3, please put `(setq sage-shell:use-prompt-toolkit t)` in your configuration file.\n\nAccording to the error message, it seems that you are using Emacs older than 24.4. Please use Emacs 24.4 or later.",
    "created_at": "2016-09-07T07:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389526",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:22'></a>Thanks. I've pushed fix to master. But it will take a few hours for Melpa to rebuild the recipe.
As for 3, please put `(setq sage-shell:use-prompt-toolkit t)` in your configuration file.

According to the error message, it seems that you are using Emacs older than 24.4. Please use Emacs 24.4 or later.



---

archive/issue_comments_389527.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [stakemori](#comment%3A22):\n> Thanks. I've pushed fix to master. But it will take a few hours for Melpa to rebuild the recipe.\n> As for 3, please put `(setq sage-shell:use-prompt-toolkit t)` in your configuration file.\n> \n> According to the error message, it seems that you are using Emacs older than 24.4. Please use Emacs 24.4 or later.\n\n\nIndeed, 24.3.1...\n\nI'm a bit afraid of upgrading, but I guess I'll do it :-)",
    "created_at": "2016-09-07T08:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389527",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:23'></a>Replying to [stakemori](#comment%3A22):
> Thanks. I've pushed fix to master. But it will take a few hours for Melpa to rebuild the recipe.
> As for 3, please put `(setq sage-shell:use-prompt-toolkit t)` in your configuration file.
> 
> According to the error message, it seems that you are using Emacs older than 24.4. Please use Emacs 24.4 or later.


Indeed, 24.3.1...

I'm a bit afraid of upgrading, but I guess I'll do it :-)



---

archive/issue_comments_389528.json:
```json
{
    "body": "<a id='comment:24'></a>I did it (not quite sure yet whether I like Ubuntu 16.04...)\n\nAnyway: `M-x sage-shell:run-sage` starts sage and I can evaluate stuff.\n\n* I have no tab-completion (the modeline says: \"No match\")\n* sending a buffer to the `*sage*` buffer breaks emacs `(Error running timer: (wrong-type-argument bufferp nil)` occupies the modeline and won't go away anymore.\n\nthanks for helping!",
    "created_at": "2016-09-07T13:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389528",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:24'></a>I did it (not quite sure yet whether I like Ubuntu 16.04...)

Anyway: `M-x sage-shell:run-sage` starts sage and I can evaluate stuff.

* I have no tab-completion (the modeline says: "No match")
* sending a buffer to the `*sage*` buffer breaks emacs `(Error running timer: (wrong-type-argument bufferp nil)` occupies the modeline and won't go away anymore.

thanks for helping!



---

archive/issue_comments_389529.json:
```json
{
    "body": "<a id='comment:25'></a>`tab-completion` and sending buffer work for me (http://i.imgur.com/LL6vm3b.png). I am not sure why such an error occurs.",
    "created_at": "2016-09-07T15:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389529",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:25'></a>`tab-completion` and sending buffer work for me (http://i.imgur.com/LL6vm3b.png). I am not sure why such an error occurs.



---

archive/issue_comments_389530.json:
```json
{
    "body": "<a id='comment:26'></a>Can you reproduce this even if only `sage-shell-mode` is loaded? If so, could you tell me the Emacs version and a recipe for reproducing?",
    "created_at": "2016-09-07T15:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389530",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:26'></a>Can you reproduce this even if only `sage-shell-mode` is loaded? If so, could you tell me the Emacs version and a recipe for reproducing?



---

archive/issue_comments_389531.json:
```json
{
    "body": "<a id='comment:27'></a>I am using sage 7.4.beta1 with the patch on this ticket applied, emacs is 24.5.1.  Running `emacs -q` and then in `*scratch*`:\n\n```\n(require 'package)\npackage\n\n(add-to-list 'package-archives\n             '(\"melpa\" . \"https://melpa.org/packages/\"))\n((\"melpa\" . \"https://melpa.org/packages/\") (\"gnu\" . \"http://elpa.gnu.org/packages/\"))\n\n(package-initialize)\nt\n(setq sage-shell:use-prompt-toolkit 'T)\nT\n(setq sage-shell:sage-root \"~/SAGE\")\n\"~/SAGE\"\n```\nand finally\n\n```\nM-x sage-shell:run-sage\n```\ngives\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 7.4.beta1, Release Date: 2016-08-17               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nIn [1]: 12.is\n```\nbut no tab-completion.",
    "created_at": "2016-09-07T15:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389531",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:27'></a>I am using sage 7.4.beta1 with the patch on this ticket applied, emacs is 24.5.1.  Running `emacs -q` and then in `*scratch*`:

```
(require 'package)
package

(add-to-list 'package-archives
             '("melpa" . "https://melpa.org/packages/"))
(("melpa" . "https://melpa.org/packages/") ("gnu" . "http://elpa.gnu.org/packages/"))

(package-initialize)
t
(setq sage-shell:use-prompt-toolkit 'T)
T
(setq sage-shell:sage-root "~/SAGE")
"~/SAGE"
```
and finally

```
M-x sage-shell:run-sage
```
gives

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.4.beta1, Release Date: 2016-08-17               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
In [1]: 12.is
```
but no tab-completion.



---

archive/issue_comments_389532.json:
```json
{
    "body": "<a id='comment:28'></a>Thanks. I have not implemented the simple prompts feature. So `sage-shell-mode` does not work well with the patch. The latest `sage-shell-mode` in MELPA sets `TERM` to `emacs`. Please upgrade `sage-shell-mode` by `M-x package-list-packages`, `U` and `x`. The problem still persists?",
    "created_at": "2016-09-07T22:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389532",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:28'></a>Thanks. I have not implemented the simple prompts feature. So `sage-shell-mode` does not work well with the patch. The latest `sage-shell-mode` in MELPA sets `TERM` to `emacs`. Please upgrade `sage-shell-mode` by `M-x package-list-packages`, `U` and `x`. The problem still persists?



---

archive/issue_comments_389533.json:
```json
{
    "body": "<a id='comment:29'></a>It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?",
    "created_at": "2016-09-07T23:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389533",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:29'></a>It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?



---

archive/issue_comments_389534.json:
```json
{
    "body": "<a id='comment:30'></a>I'm confused now.  Is `sage-shell-mode` working on your computer without the patch in this ticket?  (I thought that \"simple prompts\" is not a feature, but a workaround.)",
    "created_at": "2016-09-08T04:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389534",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:30'></a>I'm confused now.  Is `sage-shell-mode` working on your computer without the patch in this ticket?  (I thought that "simple prompts" is not a feature, but a workaround.)



---

archive/issue_comments_389535.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [mantepse](#comment%3A30):\n> I'm confused now.  Is `sage-shell-mode` working on your computer without the patch in this ticket?  (I thought that \"simple prompts\" is not a feature, but a workaround.)\n\n\nYes. So `sage-shell-mode` support multi-line input (though there exits a minor issue. See https://github.com/stakemori/sage-shell-mode/issues/7).\n\n`sage-shell-mode` can handle a part of escape sequences related to text modification and cursor movement. If `sage-shell:use-prompt-toolkit` is non-nil, then I assume Sage is not using `simple prompt` or `GNU readline`. I will also support `simple prompt` in future.",
    "created_at": "2016-09-08T04:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389535",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:31'></a>Replying to [mantepse](#comment%3A30):
> I'm confused now.  Is `sage-shell-mode` working on your computer without the patch in this ticket?  (I thought that "simple prompts" is not a feature, but a workaround.)


Yes. So `sage-shell-mode` support multi-line input (though there exits a minor issue. See https://github.com/stakemori/sage-shell-mode/issues/7).

`sage-shell-mode` can handle a part of escape sequences related to text modification and cursor movement. If `sage-shell:use-prompt-toolkit` is non-nil, then I assume Sage is not using `simple prompt` or `GNU readline`. I will also support `simple prompt` in future.



---

archive/issue_comments_389536.json:
```json
{
    "body": "<a id='comment:32'></a>Wow!  I think you are getting very close!\n\n* tab completion works\n* sending a buffer with `C-c C-c` to the sage buffer works, also loading a file with `C-c C-l` works.\nA little suggestion: if the current buffer is a visited file in sage mode, it would be nice to have `C-c C-c` load the file instead, asking whether to save the buffer if necessary.  Because:\n\n```\nsage: load('/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.sage')\n```\ndoesn't give me a clue which file I actually loaded!\n\n* unfortunately, sending a line to sage does not work correctly:\n\n```\nsage: load('/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.py')\n  File \"/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.py\", line 3\n    sage: fricas('3 * 5')                                                       # optional - fricas\n        ^\nSyntaxError: invalid syntax\n```\nI think it doesn't strip the \"sage:\" anymore - was this done by ipython before?",
    "created_at": "2016-09-08T06:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389536",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:32'></a>Wow!  I think you are getting very close!

* tab completion works
* sending a buffer with `C-c C-c` to the sage buffer works, also loading a file with `C-c C-l` works.
A little suggestion: if the current buffer is a visited file in sage mode, it would be nice to have `C-c C-c` load the file instead, asking whether to save the buffer if necessary.  Because:

```
sage: load('/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.sage')
```
doesn't give me a clue which file I actually loaded!

* unfortunately, sending a line to sage does not work correctly:

```
sage: load('/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.py')
  File "/tmp/sage_shell_mode17030j9Q/sage_shell_mode_temp.py", line 3
    sage: fricas('3 * 5')                                                       # optional - fricas
        ^
SyntaxError: invalid syntax
```
I think it doesn't strip the "sage:" anymore - was this done by ipython before?



---

archive/issue_comments_389537.json:
```json
{
    "body": "<a id='comment:33'></a>Thank you for trying.\n\nTo fix this issue, I had to changed basic functions of this mode. So there may be such problems. Sorry.\n\n> unfortunately, sending a line to sage does not work correctly:\n\n\n`M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.\n\n> A little suggestion: if the current buffer is a visited file in sage mode, it would be nice to have C-c C-c load the file instead, asking whether to save the buffer if necessary.\n\n\nThank you for the suggestion. I will consider about it.",
    "created_at": "2016-09-08T07:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389537",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:33'></a>Thank you for trying.

To fix this issue, I had to changed basic functions of this mode. So there may be such problems. Sorry.

> unfortunately, sending a line to sage does not work correctly:


`M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.

> A little suggestion: if the current buffer is a visited file in sage mode, it would be nice to have C-c C-c load the file instead, asking whether to save the buffer if necessary.


Thank you for the suggestion. I will consider about it.



---

archive/issue_comments_389538.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [stakemori](#comment%3A33):\n> Thank you for trying.\n> \n> To fix this issue, I had to changed basic functions of this mode. So there may be such problems. Sorry.\n\n\nHey, your work is fantastic!  I have no idea what I would have done without you!\n\n> > unfortunately, sending a line to sage does not work correctly:\n\n> \n> `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.\n\n\nGreat! `M-x sage-shell-edit:send-line*` (with the asterisk!) does the right thing!",
    "created_at": "2016-09-08T07:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389538",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:34'></a>Replying to [stakemori](#comment%3A33):
> Thank you for trying.
> 
> To fix this issue, I had to changed basic functions of this mode. So there may be such problems. Sorry.


Hey, your work is fantastic!  I have no idea what I would have done without you!

> > unfortunately, sending a line to sage does not work correctly:

> 
> `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.


Great! `M-x sage-shell-edit:send-line*` (with the asterisk!) does the right thing!



---

archive/issue_comments_389539.json:
```json
{
    "body": "<a id='comment:35'></a>> Hey, your work is fantastic! I have no idea what I would have done without you!\n\n\nThank you very much! I am very glad that `sage-shell-mode` works on your computer.\n\nBy the way, it would be great if I (or someone) could write a process filter function for `sage-mode` (or `python-mode`) that handles escape sequence. In future, I may write one (but to be honest, I do not want to fix this twice. It was harder than I thought).",
    "created_at": "2016-09-08T08:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389539",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:35'></a>> Hey, your work is fantastic! I have no idea what I would have done without you!


Thank you very much! I am very glad that `sage-shell-mode` works on your computer.

By the way, it would be great if I (or someone) could write a process filter function for `sage-mode` (or `python-mode`) that handles escape sequence. In future, I may write one (but to be honest, I do not want to fix this twice. It was harder than I thought).



---

archive/issue_comments_389540.json:
```json
{
    "body": "<a id='comment:36'></a>why would you want to handle escape sequences?",
    "created_at": "2016-09-08T08:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389540",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:36'></a>why would you want to handle escape sequences?



---

archive/issue_comments_389541.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [stakemori](#comment%3A35):\n> By the way, it would be great if I (or someone) could write a process filter function for `sage-mode` (or `python-mode`) that handles escape sequence. In future, I may write one (but to be honest, I do not want to fix this twice. It was harder than I thought).\n\n\nI'm currently a `sage-mode` user and would be interested in getting it to work again. But my knowledge of terminals and the details of `comint-mode` is not very extensive, and I've lost track of what changes were necessary to make `sage-shell-mode` work again. How difficult would you estimate porting your fixes would be?\n\nBut perhaps rather: should we take this as a cue to merge the efforts of `sage-shell-mode` and `sage-mode`; after all, they're trying to do more or less the same. The current maintainer of `sage-mode` is Ivan Andrus but my impression is that he is really only maintaining - not developing. `sage-shell-mode` is much more vibrant in comparison! My impression is that `sage-shell-mode` currently does completion better than `sage-mode`, but `sage-mode` can render latex and images. There might also be small differences in how editing directly in the shell works?\n\nMy own contributions to `sage-mode` are modest: I've written the current help file/landing page, I wrote a small set of functions, `sage-blocks.el`, for giving light-weight notebook-like editing, and I've helped report and track down some bugs. Rather than porting fixes to `sage-mode`, I would be interested in trying out `sage-shell-mode` and lending a hand on implementing the features that would make it a great alternative for current `sage-mode` users. I'm also an `eVil`-user, so I would naturally be testing/modding `sage-shell-mode` to work under those conditions.\n\nBest,\nJohan",
    "created_at": "2016-09-08T08:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389541",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:37'></a>Replying to [stakemori](#comment%3A35):
> By the way, it would be great if I (or someone) could write a process filter function for `sage-mode` (or `python-mode`) that handles escape sequence. In future, I may write one (but to be honest, I do not want to fix this twice. It was harder than I thought).


I'm currently a `sage-mode` user and would be interested in getting it to work again. But my knowledge of terminals and the details of `comint-mode` is not very extensive, and I've lost track of what changes were necessary to make `sage-shell-mode` work again. How difficult would you estimate porting your fixes would be?

But perhaps rather: should we take this as a cue to merge the efforts of `sage-shell-mode` and `sage-mode`; after all, they're trying to do more or less the same. The current maintainer of `sage-mode` is Ivan Andrus but my impression is that he is really only maintaining - not developing. `sage-shell-mode` is much more vibrant in comparison! My impression is that `sage-shell-mode` currently does completion better than `sage-mode`, but `sage-mode` can render latex and images. There might also be small differences in how editing directly in the shell works?

My own contributions to `sage-mode` are modest: I've written the current help file/landing page, I wrote a small set of functions, `sage-blocks.el`, for giving light-weight notebook-like editing, and I've helped report and track down some bugs. Rather than porting fixes to `sage-mode`, I would be interested in trying out `sage-shell-mode` and lending a hand on implementing the features that would make it a great alternative for current `sage-mode` users. I'm also an `eVil`-user, so I would naturally be testing/modding `sage-shell-mode` to work under those conditions.

Best,
Johan



---

archive/issue_comments_389542.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [mantepse](#comment%3A36):\n> why would you want to handle escape sequences?\n\n\nI don't want to handle escape sequences if possible. But developers of IPython choose `prompt_toolkit` rather than `readline` and `prompt_toolkit` uses a lot of escape sequences. Therefore I think `sage-shell-mode` should handle them. And I don't want to use the simple prompt workaround at the moment.",
    "created_at": "2016-09-08T11:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389542",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:38'></a>Replying to [mantepse](#comment%3A36):
> why would you want to handle escape sequences?


I don't want to handle escape sequences if possible. But developers of IPython choose `prompt_toolkit` rather than `readline` and `prompt_toolkit` uses a lot of escape sequences. Therefore I think `sage-shell-mode` should handle them. And I don't want to use the simple prompt workaround at the moment.



---

archive/issue_comments_389543.json:
```json
{
    "body": "<a id='comment:39'></a>> I'm currently a sage-mode user and would be interested in getting it to work again. But my knowledge of terminals and the details of comint-mode is not very extensive, and I've lost track of what changes were necessary to make sage-shell-mode work again. How difficult would you estimate porting your fixes would be?\n\n\nIf you use the simple prompt workaround, then I guess it would be easy to fix `sage-mode`. But you might lose some features because of the workaround (Above, charpent remarked that\n  \"When inline plots are enabled, they are displayed, but the sustems claims (falsely) to have launced a png viewer.\"\nI am not sure if it is because of the workaround).\n\nIf you don't use the workaround, then it would be not so easy to fix it. Most important point is to implement a process filter function. `comint-output-filter` doesn't work. If you want to implement it, you could copy code in `sage-shell-mode` and I could help you.\n\n\n> But perhaps rather: should we take this as a cue to merge the efforts of sage-shell-mode and sage-mode; after all, they're trying to do more or less the same. The current maintainer of sage-mode is Ivan Andrus but my impression is that he is really only maintaining - not developing. sage-shell-mode is much more vibrant in comparison! My impression is that sage-shell-mode currently does completion better than sage-mode, but sage-mode can render latex and images. There might also be small differences in how editing directly in the shell works?\n\n\nI am OK with merging. I would be glad if `sage-shell-mode` could render latex and images. I have exchanged email with Ivan Andrus a few years ago. He was also writing about merging. I guess he also might agree with merging.\n\nI do not understand `sage-blocks.el` very well. Is it similar to ob-sagemath (https://github.com/stakemori/ob-sagemath)? And I would be very happy if you contributed to `sage-shell-mode`.",
    "created_at": "2016-09-08T11:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389543",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:39'></a>> I'm currently a sage-mode user and would be interested in getting it to work again. But my knowledge of terminals and the details of comint-mode is not very extensive, and I've lost track of what changes were necessary to make sage-shell-mode work again. How difficult would you estimate porting your fixes would be?


If you use the simple prompt workaround, then I guess it would be easy to fix `sage-mode`. But you might lose some features because of the workaround (Above, charpent remarked that
  "When inline plots are enabled, they are displayed, but the sustems claims (falsely) to have launced a png viewer."
I am not sure if it is because of the workaround).

If you don't use the workaround, then it would be not so easy to fix it. Most important point is to implement a process filter function. `comint-output-filter` doesn't work. If you want to implement it, you could copy code in `sage-shell-mode` and I could help you.


> But perhaps rather: should we take this as a cue to merge the efforts of sage-shell-mode and sage-mode; after all, they're trying to do more or less the same. The current maintainer of sage-mode is Ivan Andrus but my impression is that he is really only maintaining - not developing. sage-shell-mode is much more vibrant in comparison! My impression is that sage-shell-mode currently does completion better than sage-mode, but sage-mode can render latex and images. There might also be small differences in how editing directly in the shell works?


I am OK with merging. I would be glad if `sage-shell-mode` could render latex and images. I have exchanged email with Ivan Andrus a few years ago. He was also writing about merging. I guess he also might agree with merging.

I do not understand `sage-blocks.el` very well. Is it similar to ob-sagemath (https://github.com/stakemori/ob-sagemath)? And I would be very happy if you contributed to `sage-shell-mode`.



---

archive/issue_comments_389544.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [stakemori](#comment%3A39):\n> If you don't use the workaround, then it would be not so easy to fix it. Most important point is to implement a process filter function. `comint-output-filter` doesn't work. If you want to implement it, you could copy code in `sage-shell-mode` and I could help you.\n\n\nOK, thanks. I'll first try to see if `sage-shell-mode` could be a replacement for me.\n\n> I am OK with merging. I would be glad if `sage-shell-mode` could render latex and images. I have exchanged email with Ivan Andrus a few years ago. He was also writing about merging. I guess he also might agree with merging.\n\n\nOK.\n\n> I do not understand `sage-blocks.el` very well. Is it similar to ob-sagemath (https://github.com/stakemori/ob-sagemath)?\n\n\nIt's much simpler than that: it simply assumes that the user has logically separated his source file using markers (`###` by default), each of which we call a \"block\". Then there are keybindings for dealing with these: moving up/down block-wise and sending the current block to the shell. This is extremely handy for the way I develop Sage. It's so simple that it would be easy to port to `sage-shell-mode`, I'm sure.\n\n> And I would be very happy if you contributed to `sage-shell-mode`.\n\n\nAs a first approximation, I've cloned `sage-shell-mode` and I'm trying it out. As you've already seen I'll post Issues when I hit funky behaviour ;-)\n\nThanks for your hard work on this!\n\nBest,\nJohan",
    "created_at": "2016-09-08T13:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389544",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:40'></a>Replying to [stakemori](#comment%3A39):
> If you don't use the workaround, then it would be not so easy to fix it. Most important point is to implement a process filter function. `comint-output-filter` doesn't work. If you want to implement it, you could copy code in `sage-shell-mode` and I could help you.


OK, thanks. I'll first try to see if `sage-shell-mode` could be a replacement for me.

> I am OK with merging. I would be glad if `sage-shell-mode` could render latex and images. I have exchanged email with Ivan Andrus a few years ago. He was also writing about merging. I guess he also might agree with merging.


OK.

> I do not understand `sage-blocks.el` very well. Is it similar to ob-sagemath (https://github.com/stakemori/ob-sagemath)?


It's much simpler than that: it simply assumes that the user has logically separated his source file using markers (`###` by default), each of which we call a "block". Then there are keybindings for dealing with these: moving up/down block-wise and sending the current block to the shell. This is extremely handy for the way I develop Sage. It's so simple that it would be easy to port to `sage-shell-mode`, I'm sure.

> And I would be very happy if you contributed to `sage-shell-mode`.


As a first approximation, I've cloned `sage-shell-mode` and I'm trying it out. As you've already seen I'll post Issues when I hit funky behaviour ;-)

Thanks for your hard work on this!

Best,
Johan



---

archive/issue_comments_389545.json:
```json
{
    "body": "<a id='comment:41'></a>> > unfortunately, sending a line to sage does not work correctly:\n\n> \n> `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.\n\n\nThat would be great!\n\nAnother tiny problem: saying\n\n```\n(sage-shell:define-alias)\n```\nin `.emacs` doesn't work - must it be in `.emacs.d/init.el`?\n\n```\nWarning (initialization): An error occurred while loading `/home/martin/.emacs':\n\nSymbol's function definition is void: sage-shell:define-alias\n```",
    "created_at": "2016-09-08T15:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389545",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:41'></a>> > unfortunately, sending a line to sage does not work correctly:

> 
> `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.


That would be great!

Another tiny problem: saying

```
(sage-shell:define-alias)
```
in `.emacs` doesn't work - must it be in `.emacs.d/init.el`?

```
Warning (initialization): An error occurred while loading `/home/martin/.emacs':

Symbol's function definition is void: sage-shell:define-alias
```



---

archive/issue_comments_389546.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [stakemori](#comment%3A29):\n> It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?\n\n\nBut I don't have control over the environment variables that are set within a `M-x shell` in emacs.",
    "created_at": "2016-09-08T17:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389546",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Replying to [stakemori](#comment%3A29):
> It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?


But I don't have control over the environment variables that are set within a `M-x shell` in emacs.



---

archive/issue_comments_389547.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [mkoeppe](#comment%3A42):\n> Replying to [stakemori](#comment%3A29):\n> > It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?\n\n> \n> But I don't have control over the environment variables that are set within a `M-x shell` in emacs.\n\n\nHere's a reference that may be helpful in choosing the right TERM that reflects what you implemented. http://invisible-island.net/ncurses/terminfo.src.html",
    "created_at": "2016-09-08T17:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389547",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [mkoeppe](#comment%3A42):
> Replying to [stakemori](#comment%3A29):
> > It seems that `sage-shell-mode` must set `TERM` to `dumb`. `sage-shell-mode` is not a full terminal emulator. It can handle a part of escape sequences but not all. Also it doesn't handle pager. I set `TERM` to `emacs`, but the `clear` command shows an error message. Again, could you use an environment variable other than `TERM` in the patch?

> 
> But I don't have control over the environment variables that are set within a `M-x shell` in emacs.


Here's a reference that may be helpful in choosing the right TERM that reflects what you implemented. http://invisible-island.net/ncurses/terminfo.src.html



---

archive/issue_comments_389548.json:
```json
{
    "body": "<a id='comment:44'></a>> It's much simpler than that: it simply assumes that the user has logically separated his source file using markers (### by default), each of which we call a \"block\". Then there are keybindings for dealing with these: moving up/down block-wise and sending the current block to the shell. This is extremely handy for the way I develop Sage. It's so simple that it would be easy to port to sage-shell-mode, I'm sure.\n\n\nThank you for explanation. It looks very convenient.",
    "created_at": "2016-09-08T23:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389548",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:44'></a>> It's much simpler than that: it simply assumes that the user has logically separated his source file using markers (### by default), each of which we call a "block". Then there are keybindings for dealing with these: moving up/down block-wise and sending the current block to the shell. This is extremely handy for the way I develop Sage. It's so simple that it would be easy to port to sage-shell-mode, I'm sure.


Thank you for explanation. It looks very convenient.



---

archive/issue_comments_389549.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [mantepse](#comment%3A41):\n> > > unfortunately, sending a line to sage does not work correctly:\n\n> > \n> > `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.\n\n> \n> That would be great!\n> \n> Another tiny problem: saying\n> \n> ```\n> (sage-shell:define-alias)\n> ```\n> in `.emacs` doesn't work - must it be in `.emacs.d/init.el`?\n> \n> ```\n> Warning (initialization): An error occurred while loading `/home/martin/.emacs':\n> \n> Symbol's function definition is void: sage-shell:define-alias\n> ```\n\n\nIt is OK to use `.emacs`. Place is not a problem, the order of evaluation is a problem. You should evaluate `(package-initialize)` before evaluating `(sage-shell:define-alias)`. I hope this helps.",
    "created_at": "2016-09-08T23:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389549",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:45'></a>Replying to [mantepse](#comment%3A41):
> > > unfortunately, sending a line to sage does not work correctly:

> > 
> > `M-x sage-shell-edit:send-line*` doesn't work? If it works, I will replace the command.

> 
> That would be great!
> 
> Another tiny problem: saying
> 
> ```
> (sage-shell:define-alias)
> ```
> in `.emacs` doesn't work - must it be in `.emacs.d/init.el`?
> 
> ```
> Warning (initialization): An error occurred while loading `/home/martin/.emacs':
> 
> Symbol's function definition is void: sage-shell:define-alias
> ```


It is OK to use `.emacs`. Place is not a problem, the order of evaluation is a problem. You should evaluate `(package-initialize)` before evaluating `(sage-shell:define-alias)`. I hope this helps.



---

archive/issue_comments_389550.json:
```json
{
    "body": "<a id='comment:46'></a>> Here's a reference that may be helpful in choosing the right TERM that reflects what you implemented. \u200bhttp://invisible-island.net/ncurses/terminfo.src.html\n\n\nThank you. It looks very helpful. I will read it carefully.",
    "created_at": "2016-09-08T23:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389550",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:46'></a>> Here's a reference that may be helpful in choosing the right TERM that reflects what you implemented. ​http://invisible-island.net/ncurses/terminfo.src.html


Thank you. It looks very helpful. I will read it carefully.



---

archive/issue_comments_389551.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [stakemori](#comment%3A45):\n\n> It is OK to use `.emacs`. Place is not a problem, the order of evaluation is a problem. You should evaluate `(package-initialize)` before evaluating `(sage-shell:define-alias)`. I hope this helps.\n\n\nYes, it does!  You are my emacs 24 hero!\n\nMartin",
    "created_at": "2016-09-09T06:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389551",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:47'></a>Replying to [stakemori](#comment%3A45):

> It is OK to use `.emacs`. Place is not a problem, the order of evaluation is a problem. You should evaluate `(package-initialize)` before evaluating `(sage-shell:define-alias)`. I hope this helps.


Yes, it does!  You are my emacs 24 hero!

Martin



---

archive/issue_comments_389552.json:
```json
{
    "body": "<a id='comment:48'></a>I would be happy to combine sage-mode and sage-shell-mode.  I quite like sage-mode, but I haven't had much time for working on it, and don't forsee that I will in the future either.  Sage users deserve something that's maintained.  \n\nLong ago I wrote a feature comparison at https://wiki.sagemath.org/SageModeComparison but it's probably out of date.  For example, I think sage-shell-mode recently got blocks.  If that's the case then the things to port from sage-mode to \n\n- AUCTeX integration \n  - This can probably be copied as-is or moved to a separate package entirely.  I think it only references sage-mode once.\n- Inline plots and typeset output\n  - This is somewhat intricate, but could probably be simplified by dropping support for ancient versions of Sage.\n- Doctesting and Building help\n  - I'm less sure about how much work this will be.\n\nIf I get some time I'll start looking at sage-shell-mode's code to see if I can submit a pull request or something.",
    "created_at": "2016-09-12T15:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389552",
    "user": "https://github.com/gvol"
}
```

<a id='comment:48'></a>I would be happy to combine sage-mode and sage-shell-mode.  I quite like sage-mode, but I haven't had much time for working on it, and don't forsee that I will in the future either.  Sage users deserve something that's maintained.  

Long ago I wrote a feature comparison at https://wiki.sagemath.org/SageModeComparison but it's probably out of date.  For example, I think sage-shell-mode recently got blocks.  If that's the case then the things to port from sage-mode to 

- AUCTeX integration 
  - This can probably be copied as-is or moved to a separate package entirely.  I think it only references sage-mode once.
- Inline plots and typeset output
  - This is somewhat intricate, but could probably be simplified by dropping support for ancient versions of Sage.
- Doctesting and Building help
  - I'm less sure about how much work this will be.

If I get some time I'll start looking at sage-shell-mode's code to see if I can submit a pull request or something.



---

archive/issue_comments_389553.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [iandrus](#comment%3A48):\n\nThank you very much! I also would be very glad if you could port those features to `sage-shell-mode`.",
    "created_at": "2016-09-13T04:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389553",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:49'></a>Replying to [iandrus](#comment%3A48):

Thank you very much! I also would be very glad if you could port those features to `sage-shell-mode`.



---

archive/issue_comments_389554.json:
```json
{
    "body": "<a id='comment:50'></a>I suggest to close the ticket, since `sage-shell-mode` now works very well, as far as I can tell.\n\n**Thank you stakemori!\n\nThe optional package `sage-mode` does not work anymore, so it probably should be moved to experimental or something similar.\n\nI have no idea how to do any of this, though.",
    "created_at": "2016-09-14T17:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389554",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:50'></a>I suggest to close the ticket, since `sage-shell-mode` now works very well, as far as I can tell.

**Thank you stakemori!

The optional package `sage-mode` does not work anymore, so it probably should be moved to experimental or something similar.

I have no idea how to do any of this, though.



---

archive/issue_comments_389555.json:
```json
{
    "body": "<a id='comment:51'></a>Let's keep this ticket open to keep track of the issues that I reported upstream with IPython and python-prompt-toolkit.",
    "created_at": "2016-09-14T18:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389555",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Let's keep this ticket open to keep track of the issues that I reported upstream with IPython and python-prompt-toolkit.



---

archive/issue_comments_389556.json:
```json
{
    "body": "<a id='comment:52'></a>Considering the excellent state of `sage-shell-mode` and the Comment 48 by Ivan, perhaps we should also open a ticket for making `sage-shell-mode` the default package in Sage for Emacs, and move `sage-mode` to experimental or remove it.",
    "created_at": "2016-09-15T06:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389556",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:52'></a>Considering the excellent state of `sage-shell-mode` and the Comment 48 by Ivan, perhaps we should also open a ticket for making `sage-shell-mode` the default package in Sage for Emacs, and move `sage-mode` to experimental or remove it.



---

archive/issue_comments_389557.json:
```json
{
    "body": "<a id='comment:53'></a>mantepse, you are welcome!\n\njsrn, thanks for the suggestion. \n\n> making sage-shell-mode the default package in Sage for Emacs\n\n\nWhat does it exactly mean? It means editing the wiki or the link in http://www.sagemath.org/download-linux.html?",
    "created_at": "2016-09-15T09:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389557",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:53'></a>mantepse, you are welcome!

jsrn, thanks for the suggestion. 

> making sage-shell-mode the default package in Sage for Emacs


What does it exactly mean? It means editing the wiki or the link in http://www.sagemath.org/download-linux.html?



---

archive/issue_comments_389558.json:
```json
{
    "body": "<a id='comment:54'></a>> > making sage-shell-mode the default package in Sage for Emacs\n\n> \n> What does it exactly mean? It means editing the wiki or the link in http://www.sagemath.org/download-linux.html? \n\n\nYes, something like:\n\n1. Modify the link http://www.sagemath.org/download-linux.html.\n2. Modify any other mention of `sage-mode` on sagemath.org.\n3. Modify any mention of `sage-mode` on the Sage wiki.\n4. Don't ship `sage-mode` together with Sage.\n5. Start shipping `sage-emacs-mode` with Sage? I vote yes.\n6. Modify references to `sage-mode` in source code (a grep found e.g. `src/sage/repl/rich_output/backend_emacs.py` which might be necessary for porting `sage-view` to `sage-shell-mode`).\n\nApart from that one could consider:\n\n1. In future `sage-shell-mode` releases, consider activating the aliases by default.\n2. Put a warning on the `sage-mode` bitbucket page that it no longer works?",
    "created_at": "2016-09-15T12:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389558",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:54'></a>> > making sage-shell-mode the default package in Sage for Emacs

> 
> What does it exactly mean? It means editing the wiki or the link in http://www.sagemath.org/download-linux.html? 


Yes, something like:

1. Modify the link http://www.sagemath.org/download-linux.html.
2. Modify any other mention of `sage-mode` on sagemath.org.
3. Modify any mention of `sage-mode` on the Sage wiki.
4. Don't ship `sage-mode` together with Sage.
5. Start shipping `sage-emacs-mode` with Sage? I vote yes.
6. Modify references to `sage-mode` in source code (a grep found e.g. `src/sage/repl/rich_output/backend_emacs.py` which might be necessary for porting `sage-view` to `sage-shell-mode`).

Apart from that one could consider:

1. In future `sage-shell-mode` releases, consider activating the aliases by default.
2. Put a warning on the `sage-mode` bitbucket page that it no longer works?



---

archive/issue_comments_389559.json:
```json
{
    "body": "<a id='comment:55'></a>Actually, given that iandrus agrees and is interested in having the remaining features of `sage-mode` merged into `sage-shell-mode`, and given that `sage-mode` is unlikely to be resurrected, wouldn't it be easier to make `sage-mode` an alias for `sage-shell-mode`?",
    "created_at": "2016-09-15T12:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389559",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:55'></a>Actually, given that iandrus agrees and is interested in having the remaining features of `sage-mode` merged into `sage-shell-mode`, and given that `sage-mode` is unlikely to be resurrected, wouldn't it be easier to make `sage-mode` an alias for `sage-shell-mode`?



---

archive/issue_comments_389560.json:
```json
{
    "body": "<a id='comment:56'></a>Thanks for making the list, jsrn.\n\n> Modify any other mention of sage-mode on sagemath.org.\n\nDo you know how to do this? I don't know.\n\n> In future sage-shell-mode releases, consider activating the aliases by default.\n\nTo do this, `sage-shell-mode` has to renamed to `sage-mode` or `sage`. This is convention of elisp.\n\n> given that sage-mode is unlikely to be resurrected\n\n\nIf mkoeppe's request to `prompt_toolkit` is accepted, `sage-mode` will be resurrected. So concerning with alias or renaming, I will see how it goes for a while.",
    "created_at": "2016-09-15T22:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389560",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:56'></a>Thanks for making the list, jsrn.

> Modify any other mention of sage-mode on sagemath.org.

Do you know how to do this? I don't know.

> In future sage-shell-mode releases, consider activating the aliases by default.

To do this, `sage-shell-mode` has to renamed to `sage-mode` or `sage`. This is convention of elisp.

> given that sage-mode is unlikely to be resurrected


If mkoeppe's request to `prompt_toolkit` is accepted, `sage-mode` will be resurrected. So concerning with alias or renaming, I will see how it goes for a while.



---

archive/issue_comments_389561.json:
```json
{
    "body": "<a id='comment:57'></a>Renaming software is usually not a good idea, because it causes confusion.",
    "created_at": "2016-09-15T22:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389561",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>Renaming software is usually not a good idea, because it causes confusion.



---

archive/issue_comments_389562.json:
```json
{
    "body": "<a id='comment:58'></a>Is sage-shell-mode available on MELPA?",
    "created_at": "2016-09-16T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389562",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>Is sage-shell-mode available on MELPA?



---

archive/issue_comments_389563.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [mkoeppe](#comment%3A58):\n> Is sage-shell-mode available on MELPA?\n\n\nYes. https://melpa.org/#/sage-shell-mode",
    "created_at": "2016-09-16T07:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389563",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:59'></a>Replying to [mkoeppe](#comment%3A58):
> Is sage-shell-mode available on MELPA?


Yes. https://melpa.org/#/sage-shell-mode



---

archive/issue_comments_389564.json:
```json
{
    "body": "<a id='comment:60'></a>Great. Then there's probably no need to ship it with Sage (step 5 above), as installing via MELPA is probably the easiest way for users.",
    "created_at": "2016-09-16T07:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389564",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Great. Then there's probably no need to ship it with Sage (step 5 above), as installing via MELPA is probably the easiest way for users.



---

archive/issue_comments_389565.json:
```json
{
    "body": "<a id='comment:61'></a>Replying to [mkoeppe](#comment%3A60):\nI agree.",
    "created_at": "2016-09-16T07:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389565",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:61'></a>Replying to [mkoeppe](#comment%3A60):
I agree.



---

archive/issue_comments_389566.json:
```json
{
    "body": "<a id='comment:62'></a>> > Modify any other mention of sage-mode on sagemath.org.\n\n> Do you know how to do this? I don't know.\n\nHmm, no, sorry.",
    "created_at": "2016-09-19T06:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389566",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:62'></a>> > Modify any other mention of sage-mode on sagemath.org.

> Do you know how to do this? I don't know.

Hmm, no, sorry.



---

archive/issue_comments_389567.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [jsrn](#comment%3A62):\n\nThere is no need to apologize. Thanks.\n\nI will ask how to do it at sage-devel. But before doing this, I would like iandrus's agreement with making `sage-shell-mode` the default package.",
    "created_at": "2016-09-19T07:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389567",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:63'></a>Replying to [jsrn](#comment%3A62):

There is no need to apologize. Thanks.

I will ask how to do it at sage-devel. But before doing this, I would like iandrus's agreement with making `sage-shell-mode` the default package.



---

archive/issue_comments_389568.json:
```json
{
    "body": "<a id='comment:64'></a>to request updates to sagemath.org, submit a pull request with the proposed changes at https://github.com/sagemath/website",
    "created_at": "2016-09-20T22:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389568",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>to request updates to sagemath.org, submit a pull request with the proposed changes at https://github.com/sagemath/website



---

archive/issue_comments_389569.json:
```json
{
    "body": "<a id='comment:65'></a>Replying to [dimpase](#comment%3A64):\n> to request updates to sagemath.org, submit a pull request with the proposed changes at https://github.com/sagemath/website\n> \n\nThank you very much for your information!",
    "created_at": "2016-09-21T01:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389569",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:65'></a>Replying to [dimpase](#comment%3A64):
> to request updates to sagemath.org, submit a pull request with the proposed changes at https://github.com/sagemath/website
> 

Thank you very much for your information!



---

archive/issue_comments_389570.json:
```json
{
    "body": "<a id='comment:66'></a>I think that Ivan was pretty clear on his stance: \"Sage users deserve something that's maintained\". In any case, thank you for your hard work on maintaining `sage-mode` these years, Ivan!\n\nReplying to [jsrn](#comment%3A54):\n> 3. Modify any mention of `sage-mode` on the Sage wiki.\n\n\nI modified the pages [https://wiki.sagemath.org/sage-mode](https://wiki.sagemath.org/sage-mode), [https://wiki.sagemath.org/Emacs](https://wiki.sagemath.org/Emacs) and [https://wiki.sagemath.org/SageModeComparison](https://wiki.sagemath.org/SageModeComparison), but kept all of them for now. Later on we might prune and/or clean them further.\n\n> 4. Don't ship `sage-mode` together with Sage.\n> 5. Start shipping `sage-emacs-mode` with Sage? I vote yes.\n\n\nI opened #21549 for this.\n\n> 6. Modify references to `sage-mode` in source code (a grep found e.g. `src/sage/repl/rich_output/backend_emacs.py` which might be necessary for porting `sage-view` to `sage-shell-mode`).\n\n\nUntil the `sage-view` features of `sage-mode` have been ported to `sage-shell-mode`, it is unclear to me how much of this will be used. I vote for just leaving it for now.\n\n> Apart from that one could consider:\n> \n> 1. In future `sage-shell-mode` releases, consider activating the aliases by default.\n\n\nAs pointed out by stakemori, this is against Elisp conventions.\n\nBest,\nJohan",
    "created_at": "2016-09-21T07:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389570",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:66'></a>I think that Ivan was pretty clear on his stance: "Sage users deserve something that's maintained". In any case, thank you for your hard work on maintaining `sage-mode` these years, Ivan!

Replying to [jsrn](#comment%3A54):
> 3. Modify any mention of `sage-mode` on the Sage wiki.


I modified the pages [https://wiki.sagemath.org/sage-mode](https://wiki.sagemath.org/sage-mode), [https://wiki.sagemath.org/Emacs](https://wiki.sagemath.org/Emacs) and [https://wiki.sagemath.org/SageModeComparison](https://wiki.sagemath.org/SageModeComparison), but kept all of them for now. Later on we might prune and/or clean them further.

> 4. Don't ship `sage-mode` together with Sage.
> 5. Start shipping `sage-emacs-mode` with Sage? I vote yes.


I opened #21549 for this.

> 6. Modify references to `sage-mode` in source code (a grep found e.g. `src/sage/repl/rich_output/backend_emacs.py` which might be necessary for porting `sage-view` to `sage-shell-mode`).


Until the `sage-view` features of `sage-mode` have been ported to `sage-shell-mode`, it is unclear to me how much of this will be used. I vote for just leaving it for now.

> Apart from that one could consider:
> 
> 1. In future `sage-shell-mode` releases, consider activating the aliases by default.


As pointed out by stakemori, this is against Elisp conventions.

Best,
Johan



---

archive/issue_comments_389571.json:
```json
{
    "body": "<a id='comment:67'></a>I removed the \"blocker\" status since stakemori's hard work means we have a Sage mode again!\n\nI also updated the title of the ticket. Perhaps this ticket will contain the changes to Sage documentation for making `sage-shell-mode` the official Emacs mode?",
    "created_at": "2016-09-21T07:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389571",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:67'></a>I removed the "blocker" status since stakemori's hard work means we have a Sage mode again!

I also updated the title of the ticket. Perhaps this ticket will contain the changes to Sage documentation for making `sage-shell-mode` the official Emacs mode?



---

archive/issue_comments_389572.json:
```json
{
    "body": "Changing keywords from \"sage_mode\" to \"sage_mode, sage-mode\".",
    "created_at": "2016-09-21T07:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389572",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "sage_mode" to "sage_mode, sage-mode".



---

archive/issue_comments_389573.json:
```json
{
    "body": "<a id='comment:69'></a>I am quite sure it would be good (with iandrus permission, of course) to make sage-shell-mode the successor of sage-mode and rename it.  The current function names are terrible to type.",
    "created_at": "2016-09-21T07:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389573",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:69'></a>I am quite sure it would be good (with iandrus permission, of course) to make sage-shell-mode the successor of sage-mode and rename it.  The current function names are terrible to type.



---

archive/issue_comments_389574.json:
```json
{
    "body": "<a id='comment:70'></a>Thank you for your good work, Johan!\n\nI sent a PR (https://github.com/sagemath/website/pull/95) to https://github.com/sagemath/website.\n\n> The current function names are terrible to type.\n\n\nI try to make interactive function names shorter or define more aliases.",
    "created_at": "2016-09-21T10:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389574",
    "user": "https://trac.sagemath.org/admin/accounts/users/stakemori"
}
```

<a id='comment:70'></a>Thank you for your good work, Johan!

I sent a PR (https://github.com/sagemath/website/pull/95) to https://github.com/sagemath/website.

> The current function names are terrible to type.


I try to make interactive function names shorter or define more aliases.



---

archive/issue_comments_389575.json:
```json
{
    "body": "<a id='comment:71'></a>Replying to [stakemori](#comment%3A70):\n\n> > The current function names are terrible to type.\n\n> \n> I try to make interactive function names shorter or define more aliases.\n\n\nSorry, I was unclear.  What I meant is: without the aliases it's terrible, and it's easier for the user if she doesn't need to modify `.emacs`.  But it's only a suggestion, personally I have no problem.  Indeed, I am very happy.  (special thanks for `send-doctest`, which I immediately bound to `C-c C-j` :-)",
    "created_at": "2016-09-21T11:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389575",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:71'></a>Replying to [stakemori](#comment%3A70):

> > The current function names are terrible to type.

> 
> I try to make interactive function names shorter or define more aliases.


Sorry, I was unclear.  What I meant is: without the aliases it's terrible, and it's easier for the user if she doesn't need to modify `.emacs`.  But it's only a suggestion, personally I have no problem.  Indeed, I am very happy.  (special thanks for `send-doctest`, which I immediately bound to `C-c C-j` :-)



---

archive/issue_comments_389576.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [mkoeppe](#comment%3A51):\n> Let's keep this ticket open to keep track of the issues that I reported upstream with IPython and python-prompt-toolkit.\n\n\nI've actually created a new ticket #21558 for that purpose. \nSo it's OK with me if the present ticket is closed when items 1--3 are done.",
    "created_at": "2016-09-21T23:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389576",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>Replying to [mkoeppe](#comment%3A51):
> Let's keep this ticket open to keep track of the issues that I reported upstream with IPython and python-prompt-toolkit.


I've actually created a new ticket #21558 for that purpose. 
So it's OK with me if the present ticket is closed when items 1--3 are done.



---

archive/issue_comments_389577.json:
```json
{
    "body": "<a id='comment:73'></a>time to close this ticket",
    "created_at": "2020-04-25T02:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389577",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>time to close this ticket



---

archive/issue_events_056589.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-25T02:10:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21227#event-56589"
}
```



---

archive/issue_comments_389578.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-25T02:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389578",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389579.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-04-25T02:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389579",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_389580.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-25T02:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389580",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389581.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-05-22T09:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21227#issuecomment-389581",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid



---

archive/issue_events_056590.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-05-22T09:51:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21227",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21227#event-56590"
}
```
