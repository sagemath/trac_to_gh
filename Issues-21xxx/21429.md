# Issue 21429: Rational log not working

archive/issues_021192.json:
```json
{
    "body": "\n```\nsage: ZZ(8).log(2)\n3\n\nsage: QQ(8/27).log(2/3)\n...\nAttributeError: 'sage.rings.rational.Rational' object has no attribute 'log'\n```\nThis can be done fast using `mpz_remove` (or `ZZ.log`) on numerator and denominator.\n\nBranch/Commit: 8c2ad23abc73ca6af5288385dacee7e959dce841\n\nReviewer: Travis Scrimshaw\n\nAuthor: Ralf Stephan\n\nDependencies: #21517\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21429\n\n",
    "closed_at": "2017-01-21T16:35:18Z",
    "created_at": "2016-09-06T05:41:29Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Rational log not working",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21429",
    "user": "https://github.com/rwst"
}
```

```
sage: ZZ(8).log(2)
3

sage: QQ(8/27).log(2/3)
...
AttributeError: 'sage.rings.rational.Rational' object has no attribute 'log'
```
This can be done fast using `mpz_remove` (or `ZZ.log`) on numerator and denominator.

Branch/Commit: 8c2ad23abc73ca6af5288385dacee7e959dce841

Reviewer: Travis Scrimshaw

Author: Ralf Stephan

Dependencies: #21517

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21429





---

archive/issue_comments_397083.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21518\"",
    "created_at": "2016-09-28T05:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397083",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#21518"



---

archive/issue_comments_397084.json:
```json
{
    "body": "Changing dependencies from \"#21518\" to \"#21517\"",
    "created_at": "2016-09-29T08:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397084",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#21518" to "#21517"



---

archive/issue_comments_397085.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/21429-1\"",
    "created_at": "2016-09-29T08:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397085",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/21429-1"



---

archive/issue_comments_397086.json:
```json
{
    "body": "Changing commit from \"\" to \"a16e1c4df5ed2c522af97e5fd5252e751fc51773\"",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397086",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "a16e1c4df5ed2c522af97e5fd5252e751fc51773"



---

archive/issue_comments_397087.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397087",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397088.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397088",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_397089.json:
```json
{
    "body": "<a id='comment:5'></a>\nNew commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[de1acfa](https://github.com/sagemath/sagetrac-mirror/commit/de1acfad2c24ba8c587eeb84cdba0d88579c614a)|`21517: handle ZZ.log(1/n)`|\n|[4aba8a9](https://github.com/sagemath/sagetrac-mirror/commit/4aba8a99c827b6ca3088c5703a98bb0b0c1271e9)|`21517: avoid duplicate computations`|\n|[a16e1c4](https://github.com/sagemath/sagetrac-mirror/commit/a16e1c4df5ed2c522af97e5fd5252e751fc51773)|`21429: implement rational log`|",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397089",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'></a>
New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[de1acfa](https://github.com/sagemath/sagetrac-mirror/commit/de1acfad2c24ba8c587eeb84cdba0d88579c614a)|`21517: handle ZZ.log(1/n)`|
|[4aba8a9](https://github.com/sagemath/sagetrac-mirror/commit/4aba8a99c827b6ca3088c5703a98bb0b0c1271e9)|`21517: avoid duplicate computations`|
|[a16e1c4](https://github.com/sagemath/sagetrac-mirror/commit/a16e1c4df5ed2c522af97e5fd5252e751fc51773)|`21429: implement rational log`|



---

archive/issue_comments_397090.json:
```json
{
    "body": "<a id='comment:6'></a>\nSome micro-optimizations (I slightly care because this could be used in tight loops):\n\n- You call `Rational(m)` twice.\n- You call the `perfect_power` of `anum` and the like twice.\n- `an` (and other like variables) are integers, correct? IIRC, a faster way to construct rational numbers is `Rational(an, bn)`.\n- It is likely faster to extract the numerator and denominator than to use a try/except block:\n  {{{#!sage\nsage: def foo(q):\n....:     try:\n....:         return ZZ(q)\n....:     except (ValueError, TypeError):\n....:         return None\nsage: def bar(q):\n....:     if q.denom() == ZZ.one():\n....:         return q.numer()\n....:     else:\n....:         return None\nsage: q = 4 / 3\nsage: %timeit foo(q)\nThe slowest run took 7.89 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.24 \u00b5s per loop\nsage: %timeit bar(q)\nThe slowest run took 42.67 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 212 ns per loop\nsage: q = 4 / 1\nsage: %timeit foo(q)\nThe slowest run took 35.47 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 202 ns per loop\nsage: %timeit bar(q)\nThe slowest run took 37.56 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 292 ns per loop\n  }}}\n  You might be able to get even a bit more out of this by not going through `numer` and `denom`, but using the actual mpir data.\n\nA cosmetic change:\n\n```diff\n-        -  ``m`` - default: natural log base e\n+        -  ``m`` -- (default: natural log base `e`) the base\n \n-        -  ``prec`` - integer (default: None): if None, return\n+        -  ``prec`` -- integer (default: ``None``); if ``None``, return\n            symbolic, else to given bits of precision as in RealField\n```",
    "created_at": "2016-09-29T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397090",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Some micro-optimizations (I slightly care because this could be used in tight loops):

- You call `Rational(m)` twice.
- You call the `perfect_power` of `anum` and the like twice.
- `an` (and other like variables) are integers, correct? IIRC, a faster way to construct rational numbers is `Rational(an, bn)`.
- It is likely faster to extract the numerator and denominator than to use a try/except block:
  {{{#!sage
sage: def foo(q):
....:     try:
....:         return ZZ(q)
....:     except (ValueError, TypeError):
....:         return None
sage: def bar(q):
....:     if q.denom() == ZZ.one():
....:         return q.numer()
....:     else:
....:         return None
sage: q = 4 / 3
sage: %timeit foo(q)
The slowest run took 7.89 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.24 Âµs per loop
sage: %timeit bar(q)
The slowest run took 42.67 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 212 ns per loop
sage: q = 4 / 1
sage: %timeit foo(q)
The slowest run took 35.47 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 202 ns per loop
sage: %timeit bar(q)
The slowest run took 37.56 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 292 ns per loop
  }}}
  You might be able to get even a bit more out of this by not going through `numer` and `denom`, but using the actual mpir data.

A cosmetic change:

```diff
-        -  ``m`` - default: natural log base e
+        -  ``m`` -- (default: natural log base `e`) the base
 
-        -  ``prec`` - integer (default: None): if None, return
+        -  ``prec`` -- integer (default: ``None``); if ``None``, return
            symbolic, else to given bits of precision as in RealField
```



---

archive/issue_comments_397091.json:
```json
{
    "body": "Changing branch from \"u/rws/21429-1\" to \"u/rws/21429-2\"",
    "created_at": "2016-09-30T06:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397091",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/21429-1" to "u/rws/21429-2"



---

archive/issue_comments_397092.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis version also looks much better.\n\n---\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[997afa8](https://github.com/sagemath/sagetrac-mirror/commit/997afa8d5662f7537ceac46f4fd61fa3e6b99005)|`21429: rational log`|",
    "created_at": "2016-09-30T06:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397092",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
This version also looks much better.

---
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[997afa8](https://github.com/sagemath/sagetrac-mirror/commit/997afa8d5662f7537ceac46f4fd61fa3e6b99005)|`21429: rational log`|



---

archive/issue_comments_397093.json:
```json
{
    "body": "Changing commit from \"a16e1c4df5ed2c522af97e5fd5252e751fc51773\" to \"997afa8d5662f7537ceac46f4fd61fa3e6b99005\"",
    "created_at": "2016-09-30T06:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397093",
    "user": "https://github.com/rwst"
}
```

Changing commit from "a16e1c4df5ed2c522af97e5fd5252e751fc51773" to "997afa8d5662f7537ceac46f4fd61fa3e6b99005"



---

archive/issue_comments_397094.json:
```json
{
    "body": "<a id='comment:9'></a>\nfailing doctests (see patchbot).",
    "created_at": "2017-01-12T07:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397094",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:9'></a>
failing doctests (see patchbot).



---

archive/issue_comments_397095.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-12T07:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397095",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397096.json:
```json
{
    "body": "Changing commit from \"997afa8d5662f7537ceac46f4fd61fa3e6b99005\" to \"2ded5706ad4537258b9b9cf47d7947192b2bc89f\"",
    "created_at": "2017-01-15T08:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "997afa8d5662f7537ceac46f4fd61fa3e6b99005" to "2ded5706ad4537258b9b9cf47d7947192b2bc89f"



---

archive/issue_comments_397097.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[95e8048](https://github.com/sagemath/sagetrac-mirror/commit/95e8048fc42c424b9a44d69979131de7c4cb9cce)|`Merge branch 'develop' into t/21429/21429-2`|\n|[2ded570](https://github.com/sagemath/sagetrac-mirror/commit/2ded5706ad4537258b9b9cf47d7947192b2bc89f)|`21429: fix doctest fails`|",
    "created_at": "2017-01-15T08:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[95e8048](https://github.com/sagemath/sagetrac-mirror/commit/95e8048fc42c424b9a44d69979131de7c4cb9cce)|`Merge branch 'develop' into t/21429/21429-2`|
|[2ded570](https://github.com/sagemath/sagetrac-mirror/commit/2ded5706ad4537258b9b9cf47d7947192b2bc89f)|`21429: fix doctest fails`|



---

archive/issue_comments_397098.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-15T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397098",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_064758.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-15T08:19:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21429#event-64758"
}
```



---

archive/issue_comments_397099.json:
```json
{
    "body": "Changing branch from \"u/rws/21429-2\" to \"u/tscrim/rational_log_fix-21429\"",
    "created_at": "2017-01-15T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397099",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/rws/21429-2" to "u/tscrim/rational_log_fix-21429"



---

archive/issue_comments_397100.json:
```json
{
    "body": "<a id='comment:12'></a>\nSorry for having this fall off my radar. I made some fixes to the doc and some other small cosmetic changes. If you agree, then you can set a positive review.\n\n---\nNew commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[8c2ad23](https://github.com/sagemath/sagetrac-mirror/commit/8c2ad23abc73ca6af5288385dacee7e959dce841)|`Docstring and cosmetic changes.`|",
    "created_at": "2017-01-15T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397100",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Sorry for having this fall off my radar. I made some fixes to the doc and some other small cosmetic changes. If you agree, then you can set a positive review.

---
New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[8c2ad23](https://github.com/sagemath/sagetrac-mirror/commit/8c2ad23abc73ca6af5288385dacee7e959dce841)|`Docstring and cosmetic changes.`|



---

archive/issue_comments_397101.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-01-15T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397101",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_397102.json:
```json
{
    "body": "Changing commit from \"2ded5706ad4537258b9b9cf47d7947192b2bc89f\" to \"8c2ad23abc73ca6af5288385dacee7e959dce841\"",
    "created_at": "2017-01-15T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397102",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "2ded5706ad4537258b9b9cf47d7947192b2bc89f" to "8c2ad23abc73ca6af5288385dacee7e959dce841"



---

archive/issue_comments_397103.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks!",
    "created_at": "2017-01-16T07:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397103",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
Thanks!



---

archive/issue_comments_397104.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-16T07:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397104",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397105.json:
```json
{
    "body": "Changing branch from \"u/tscrim/rational_log_fix-21429\" to \"8c2ad23abc73ca6af5288385dacee7e959dce841\"",
    "created_at": "2017-01-21T16:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397105",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/tscrim/rational_log_fix-21429" to "8c2ad23abc73ca6af5288385dacee7e959dce841"



---

archive/issue_events_064759.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T16:35:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21429#event-64759"
}
```



---

archive/issue_comments_397106.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T16:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21429",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21429#issuecomment-397106",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
