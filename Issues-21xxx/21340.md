# Issue 21340: LatticePoset: bug in testing semidistributivity

archive/issues_021103.json:
```json
{
    "body": "Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison in logarithm of Sage `Integer`.\n\n\n**CC:**  @nexttime\n\n**Branch/Commit:** [68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Jori M\u00e4ntysalo\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21340\n\n",
    "closed_at": "2016-09-16T06:55:21Z",
    "created_at": "2016-08-26T04:50:24Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "LatticePoset: bug in testing semidistributivity",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21340",
    "user": "https://github.com/jm58660"
}
```
Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison in logarithm of Sage `Integer`.


**CC:**  @nexttime

**Branch/Commit:** [68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)

**Reviewer:** Frédéric Chapoton

**Author:** Jori Mäntysalo

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/21340





---

archive/issue_comments_395123.json:
```json
{
    "body": "**Branch:** [u/jmantysalo/latticeposet__bug_in_testing_semidistributivity](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__bug_in_testing_semidistributivity)",
    "created_at": "2016-08-26T06:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395123",
    "user": "https://github.com/jm58660"
}
```

**Branch:** [u/jmantysalo/latticeposet__bug_in_testing_semidistributivity](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__bug_in_testing_semidistributivity)



---

archive/issue_comments_395124.json:
```json
{
    "body": "<a id='comment:2'></a>\nReady for review, but let's first wait if discussion at https://groups.google.com/forum/#!topic/sage-devel/ZtwUc5c4Js0 founds better solution.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83\">1a72740</a></td><td><code>Workaround for log bug.</code></td></tr></table>\n",
    "created_at": "2016-08-26T07:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395124",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>
Ready for review, but let's first wait if discussion at https://groups.google.com/forum/#!topic/sage-devel/ZtwUc5c4Js0 founds better solution.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83">1a72740</a></td><td><code>Workaround for log bug.</code></td></tr></table>




---

archive/issue_comments_395125.json:
```json
{
    "body": "**Commit:** [1a727401edf30b7217771de99acef212703eca83](https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83)",
    "created_at": "2016-08-26T07:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395125",
    "user": "https://github.com/jm58660"
}
```

**Commit:** [1a727401edf30b7217771de99acef212703eca83](https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83)



---

archive/issue_comments_395126.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is propably due to division by `2` that is not preparsed and was hence missed in my tests.\n+Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison between logarithm and integer.\n \n``````\n",
    "created_at": "2016-08-26T07:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395126",
    "user": "https://github.com/jm58660"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is propably due to division by `2` that is not preparsed and was hence missed in my tests.
+Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison between logarithm and integer.
 
``````




---

archive/issue_comments_395127.json:
```json
{
    "body": "**Changing commit** from \"[1a727401edf30b7217771de99acef212703eca83](https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83)\" to \"[9edd77b37e3570fdae8d77b5344678f4b6f0cf9a](https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a)\".",
    "created_at": "2016-08-27T05:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1a727401edf30b7217771de99acef212703eca83](https://github.com/sagemath/sagetrac-mirror/commit/1a727401edf30b7217771de99acef212703eca83)" to "[9edd77b37e3570fdae8d77b5344678f4b6f0cf9a](https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a)".



---

archive/issue_comments_395128.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a\">9edd77b</a></td><td><code>Workaround for logarithm bug.</code></td></tr></table>\n",
    "created_at": "2016-08-27T05:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a">9edd77b</a></td><td><code>Workaround for logarithm bug.</code></td></tr></table>




---

archive/issue_comments_395129.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison between logarithm and integer.\n+Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison in logarithm of Sage `Integer`.\n \n``````\n",
    "created_at": "2016-08-27T05:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395129",
    "user": "https://github.com/jm58660"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison between logarithm and integer.
+Sage says that the Boolean lattice of `2^3=8` elements is not [meet|join]-semidistributive. This is due to comparison in logarithm of Sage `Integer`.
 
``````




---

archive/issue_comments_395130.json:
```json
{
    "body": "<a id='comment:4'></a>\nLeif, can you check this basically one line patch?",
    "created_at": "2016-08-27T05:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395130",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>
Leif, can you check this basically one line patch?



---

archive/issue_comments_395131.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-08-27T05:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395131",
    "user": "https://github.com/jm58660"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_395132.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is a *massive* hack solution that comes from this behavior:\n\n```sage\nsage: log(8, 2)\n3\nsage: log(8, int(2))\nlog(8)/log(2)\nsage: log(int(8), int(2))\nlog(8)/log(2)\n```\nIf we are to accept this hack, we should well document it as such.",
    "created_at": "2016-08-27T05:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395132",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
This is a *massive* hack solution that comes from this behavior:

```sage
sage: log(8, 2)
3
sage: log(8, int(2))
log(8)/log(2)
sage: log(int(8), int(2))
log(8)/log(2)
```
If we are to accept this hack, we should well document it as such.



---

archive/issue_comments_395133.json:
```json
{
    "body": "<a id='comment:6'></a>\nWell, of course right solution would be correcting `log`. For example output type should depend on input type, not on input value. But\n\n```\nsage: type(log(8, 2))\n<type 'sage.rings.integer.Integer'>\nsage: type(log(9, 2))\n<type 'sage.symbolic.expression.Expression'>\n```\n\nShould I just remove the quick test of non-semidistributivity then? Won't make much difference.",
    "created_at": "2016-08-27T05:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395133",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'></a>
Well, of course right solution would be correcting `log`. For example output type should depend on input type, not on input value. But

```
sage: type(log(8, 2))
<type 'sage.rings.integer.Integer'>
sage: type(log(9, 2))
<type 'sage.symbolic.expression.Expression'>
```

Should I just remove the quick test of non-semidistributivity then? Won't make much difference.



---

archive/issue_comments_395134.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe biggest thing is just documenting why we are doing certain things, so when we go back and look again or someone else comes and looks at it, it is clear why things were done this way.\n\nOne option would be wrapping the inequality test in `bool(...)`. This evaluates the symbolic expression to a boolean and doesn't affect boolean values:\n\n```\nsage: bool(13 > 8 * log(8, 2) / 2)\nTrue\nsage: bool(12 > 8 * log(8, 2) / 2)\nFalse\nsage: bool(True)\nTrue\nsage: bool(False)\nFalse\n```\nAgain, there should be a comment. Another option would be to do `log(8,2).n()`, which could introduce some numerical noise. Or just force both values to `ZZ`.",
    "created_at": "2016-08-27T15:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395134",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
The biggest thing is just documenting why we are doing certain things, so when we go back and look again or someone else comes and looks at it, it is clear why things were done this way.

One option would be wrapping the inequality test in `bool(...)`. This evaluates the symbolic expression to a boolean and doesn't affect boolean values:

```
sage: bool(13 > 8 * log(8, 2) / 2)
True
sage: bool(12 > 8 * log(8, 2) / 2)
False
sage: bool(True)
True
sage: bool(False)
False
```
Again, there should be a comment. Another option would be to do `log(8,2).n()`, which could introduce some numerical noise. Or just force both values to `ZZ`.



---

archive/issue_comments_395135.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tscrim](#comment%3A7):\n> One option would be wrapping the inequality test in `bool(...)`. This evaluates the symbolic expression to a boolean and doesn't affect boolean values:\n> \n> ```\n> sage: bool(13 > 8 * log(8, 2) / 2)\n> True\n> sage: bool(12 > 8 * log(8, 2) / 2)\n> False\n> sage: bool(True)\n> True\n> sage: bool(False)\n> False\n> ```\n\n\nQuoting from sage-devel:\n\n```\nRalf Stephan wrote:\n> On Saturday, August 27, 2016 at 7:05:28 AM UTC+2, Jori M\u00e4ntysalo wrote:\n>\n>     But shouldn't it work in any case? I.e. comparison of\n>     log(a+b*c^2...) to\n>     some number should work when a,b,c... are sage Integers.\n>\n>\n> log(integer) will not be expanded numerically except for log(0) and log(1).\n> If you want it expanded, either give a float argument, eg log(2.), or\n> append n().\n\nN() wasn't the problem, but (also) rounding:\n\n(s is 12 here.)\n\nsage: n*log(n, 2)\n24\nsage: n*log(n, 2r)\n8*log(8)/log(2)\nsage: N(n*log(n, 2r))\n24.0000000000000\nsage: 2*s < n*log(n, 2)\nFalse\nsage: 2*s > n*log(n, 2)\nFalse\nsage: 2*s > n*log(n, 2r)\n24 > 8*log(8)/log(2)\nsage: bool(2*s > n*log(n, 2r))\nTrue\nsage: bool(2r*s > n*log(n, 2r))\nTrue\nsage: bool(2r*s > n*log(n, 2))\nFalse\nsage: 24 > N(n*log(n, 2r))\nTrue\n```\n\nSo I'd suggest to rewrite the code, and/or call the proper `log()`, or (first) check whether `n` is a power of 2.",
    "created_at": "2016-08-27T16:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395135",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Replying to [tscrim](#comment%3A7):
> One option would be wrapping the inequality test in `bool(...)`. This evaluates the symbolic expression to a boolean and doesn't affect boolean values:
> 
> ```
> sage: bool(13 > 8 * log(8, 2) / 2)
> True
> sage: bool(12 > 8 * log(8, 2) / 2)
> False
> sage: bool(True)
> True
> sage: bool(False)
> False
> ```


Quoting from sage-devel:

```
Ralf Stephan wrote:
> On Saturday, August 27, 2016 at 7:05:28 AM UTC+2, Jori Mäntysalo wrote:
>
>     But shouldn't it work in any case? I.e. comparison of
>     log(a+b*c^2...) to
>     some number should work when a,b,c... are sage Integers.
>
>
> log(integer) will not be expanded numerically except for log(0) and log(1).
> If you want it expanded, either give a float argument, eg log(2.), or
> append n().

N() wasn't the problem, but (also) rounding:

(s is 12 here.)

sage: n*log(n, 2)
24
sage: n*log(n, 2r)
8*log(8)/log(2)
sage: N(n*log(n, 2r))
24.0000000000000
sage: 2*s < n*log(n, 2)
False
sage: 2*s > n*log(n, 2)
False
sage: 2*s > n*log(n, 2r)
24 > 8*log(8)/log(2)
sage: bool(2*s > n*log(n, 2r))
True
sage: bool(2r*s > n*log(n, 2r))
True
sage: bool(2r*s > n*log(n, 2))
False
sage: 24 > N(n*log(n, 2r))
True
```

So I'd suggest to rewrite the code, and/or call the proper `log()`, or (first) check whether `n` is a power of 2.



---

archive/issue_comments_395136.json:
```json
{
    "body": "<a id='comment:9'></a>\n(The left side of the comparison doesn't matter here, but note that\n\n  `bool(2*s > n*log(n, 2r))`\n\nand\n\n  `bool(2*s > n*log(n, 2))`\n\ngive different results due to the behaviour of `log()` and rounding issues.)",
    "created_at": "2016-08-27T16:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395136",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
(The left side of the comparison doesn't matter here, but note that

  `bool(2*s > n*log(n, 2r))`

and

  `bool(2*s > n*log(n, 2))`

give different results due to the behaviour of `log()` and rounding issues.)



---

archive/issue_comments_395137.json:
```json
{
    "body": "<a id='comment:10'></a>\nMaybe I just wrote the `log_2` myself:\n\n```\ndef _log_2(n):\n    \"\"\"\n    Return the 2-based logarithm of `n` rounded up.\n    \n    `n` is assumed to be a positive integer.\n    \n    EXAMPLES::\n        \n        sage: sage.combinat.poset.lattices._log_2(10)\n        4\n    \"\"\"\n    bits = -1\n    i = n\n    while i:\n        i = i >> 1\n        bits += 1\n    if 1 << bits == n:\n        return bits\n    return bits+1\n```\n\n(On x86 one could use `LZCNT` and `POPCNT`. `:=)`)",
    "created_at": "2016-08-28T08:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395137",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:10'></a>
Maybe I just wrote the `log_2` myself:

```
def _log_2(n):
    """
    Return the 2-based logarithm of `n` rounded up.
    
    `n` is assumed to be a positive integer.
    
    EXAMPLES::
        
        sage: sage.combinat.poset.lattices._log_2(10)
        4
    """
    bits = -1
    i = n
    while i:
        i = i >> 1
        bits += 1
    if 1 << bits == n:
        return bits
    return bits+1
```

(On x86 one could use `LZCNT` and `POPCNT`. `:=)`)



---

archive/issue_comments_395138.json:
```json
{
    "body": "<a id='comment:11'></a>\nSee also the `ffs()` family, `[__builtin_]clz()`, ...  (also on ARM etc.)\n\nIf you just want to know *whether* `n` is an exact power of two (<=> n==0 or popcnt(n)==1), you can use `n & ~(n-1) == n`.\n\nYou could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).",
    "created_at": "2016-08-28T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395138",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
See also the `ffs()` family, `[__builtin_]clz()`, ...  (also on ARM etc.)

If you just want to know *whether* `n` is an exact power of two (<=> n==0 or popcnt(n)==1), you can use `n & ~(n-1) == n`.

You could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).



---

archive/issue_comments_395139.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A11):\n\n> You could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).  \n\n\nIsn't there the same rounding problem with `math.log`?",
    "created_at": "2016-08-28T14:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395139",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A11):

> You could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).  


Isn't there the same rounding problem with `math.log`?



---

archive/issue_comments_395140.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jmantysalo](#comment%3A12):\n> Replying to [leif](#comment%3A11):\n> \n> > You could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).  \n\n> \n> Isn't there the same rounding problem with `math.log`?\n\n\nProbably not for true powers of 2; don't know why Sage's log() is so bad in that regard.  (How large does `n`, or  `log(n, 2)`, practically get?)\n\nFWIW, if you want to stay in the integer domain, you could as well use `4`<sup>`s`</sup>`> n`<sup>`n`</sup>, where the right-hand side is as cheap as the left if (`n` is sufficiently small or `ctz(n)` is relatively large or) `n` is a power of 2.\n\nBut that's perhaps already towards bike-shedding.\n\n\\\\\n\nEspecially if you know `n` is a power of 2, you could do appropriate rounding as well, but I'd rather fix log() or use a different one.\n\nBut doesn't already using `sage.misc.functional.log(n, Integer(2))` solve (or, more precisely, work around) the main problem here?",
    "created_at": "2016-08-28T15:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395140",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Replying to [jmantysalo](#comment%3A12):
> Replying to [leif](#comment%3A11):
> 
> > You could likewise use Python's `math.log(int(n), 2)`, or various functions from GMP (since Sage Integers are based on `mpz_t`).  

> 
> Isn't there the same rounding problem with `math.log`?


Probably not for true powers of 2; don't know why Sage's log() is so bad in that regard.  (How large does `n`, or  `log(n, 2)`, practically get?)

FWIW, if you want to stay in the integer domain, you could as well use `4`<sup>`s`</sup>`> n`<sup>`n`</sup>, where the right-hand side is as cheap as the left if (`n` is sufficiently small or `ctz(n)` is relatively large or) `n` is a power of 2.

But that's perhaps already towards bike-shedding.

\\

Especially if you know `n` is a power of 2, you could do appropriate rounding as well, but I'd rather fix log() or use a different one.

But doesn't already using `sage.misc.functional.log(n, Integer(2))` solve (or, more precisely, work around) the main problem here?



---

archive/issue_comments_395141.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [leif](#comment%3A13):\n> Replying to [jmantysalo](#comment%3A12):\n> > Isn't there the same rounding problem with `math.log`?\n\n> \n> Probably not for true powers of 2; don't know why Sage's log() is so bad in that regard.  (How large does `n`, or  `log(n, 2)`, practically get?)\n\n\nIt should be safe up to at least 2<sup>52</sup>+ (maybe even up to 2<sup>1022</sup>+) because Python's `float`s (returned by `math.log()`) are actually `double`s AFAIK.",
    "created_at": "2016-08-28T16:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395141",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Replying to [leif](#comment%3A13):
> Replying to [jmantysalo](#comment%3A12):
> > Isn't there the same rounding problem with `math.log`?

> 
> Probably not for true powers of 2; don't know why Sage's log() is so bad in that regard.  (How large does `n`, or  `log(n, 2)`, practically get?)


It should be safe up to at least 2<sup>52</sup>+ (maybe even up to 2<sup>1022</sup>+) because Python's `float`s (returned by `math.log()`) are actually `double`s AFAIK.



---

archive/issue_comments_395142.json:
```json
{
    "body": "<a id='comment:15'></a>\nDistantly related:\n\nWhile we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?",
    "created_at": "2016-08-28T17:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395142",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Distantly related:

While we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?



---

archive/issue_comments_395143.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [leif](#comment%3A15):\n> Distantly related:\n> \n> While we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?\n\n\nOther than `is_semidistributive`?\n\nBut yes, you are right. Kevin said the same at #21002. Suggestion for better name?",
    "created_at": "2016-08-29T03:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395143",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:16'></a>
Replying to [leif](#comment%3A15):
> Distantly related:
> 
> While we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?


Other than `is_semidistributive`?

But yes, you are right. Kevin said the same at #21002. Suggestion for better name?



---

archive/issue_comments_395144.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5\">68419a4</a></td><td><code>Logarithm in semidistributive.</code></td></tr></table>\n",
    "created_at": "2016-08-30T05:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5">68419a4</a></td><td><code>Logarithm in semidistributive.</code></td></tr></table>




---

archive/issue_comments_395145.json:
```json
{
    "body": "**Changing commit** from \"[9edd77b37e3570fdae8d77b5344678f4b6f0cf9a](https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a)\" to \"[68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)\".",
    "created_at": "2016-08-30T05:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9edd77b37e3570fdae8d77b5344678f4b6f0cf9a](https://github.com/sagemath/sagetrac-mirror/commit/9edd77b37e3570fdae8d77b5344678f4b6f0cf9a)" to "[68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)".



---

archive/issue_comments_395146.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK, should work now. Also function name changed.",
    "created_at": "2016-08-30T05:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395146",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:18'></a>
OK, should work now. Also function name changed.



---

archive/issue_comments_395147.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jmantysalo](#comment%3A18):\n> OK, should work now. Also function name changed.\n\n\nDoesn't the latter require a deprecation of the old function first?",
    "created_at": "2016-08-30T16:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395147",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [jmantysalo](#comment%3A18):
> OK, should work now. Also function name changed.


Doesn't the latter require a deprecation of the old function first?



---

archive/issue_comments_395148.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jmantysalo](#comment%3A16):\n> Replying to [leif](#comment%3A15):\n> > Distantly related:\n> > \n> > While we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?\n\n> \n> Other than `is_semidistributive`?\n\n\nYes.  The first (I think) being `.is_complemented(self)`, but there are more IIRC.\n\n\\\\\n\n> But yes, you are right. Kevin said the same at #21002. Suggestion for better name?\n\n\n`certify`, `prove[_if_(true|false)]`, `[return_]witness[_if_false]`?  ;-)\n\n(I guess you were referring to `is_...()`, not the keyword argument, though.)\n\nI'd rather keep the `is_...()`, but add (a) keyword or boolean argument(s), and only change the return type(s).\n\nBut then you'd have to first make the old behaviour the default, for backwards compatibility.",
    "created_at": "2016-08-30T16:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395148",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Replying to [jmantysalo](#comment%3A16):
> Replying to [leif](#comment%3A15):
> > Distantly related:
> > 
> > While we (you?) are at it, `HasseDiagram` has a couple of `.is_...()` methods which do not return `True` or `False`, but either `None` or some sample.  Shouldn't these return the former unless a keyword argument `certificate` :-) (which they currently don't have) is passed?

> 
> Other than `is_semidistributive`?


Yes.  The first (I think) being `.is_complemented(self)`, but there are more IIRC.

\\

> But yes, you are right. Kevin said the same at #21002. Suggestion for better name?


`certify`, `prove[_if_(true|false)]`, `[return_]witness[_if_false]`?  ;-)

(I guess you were referring to `is_...()`, not the keyword argument, though.)

I'd rather keep the `is_...()`, but add (a) keyword or boolean argument(s), and only change the return type(s).

But then you'd have to first make the old behaviour the default, for backwards compatibility.



---

archive/issue_comments_395149.json:
```json
{
    "body": "<a id='comment:21'></a>\nPerhaps a bit late, but did you look at `Integer.{log,exact_log}()`?",
    "created_at": "2016-08-30T16:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395149",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
Perhaps a bit late, but did you look at `Integer.{log,exact_log}()`?



---

archive/issue_comments_395150.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [leif](#comment%3A19):\n\n> > OK, should work now. Also function name changed.\n\n> \n> Doesn't the latter require a deprecation of the old function first?\n\n\nI have thinked that `hasse_diagram.py` is an internal implementation file that can be changed. And the function is one release old only.",
    "created_at": "2016-08-31T03:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395150",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:22'></a>
Replying to [leif](#comment%3A19):

> > OK, should work now. Also function name changed.

> 
> Doesn't the latter require a deprecation of the old function first?


I have thinked that `hasse_diagram.py` is an internal implementation file that can be changed. And the function is one release old only.



---

archive/issue_comments_395151.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [leif](#comment%3A20):\n\n> (I guess you were referring to `is_...()`, not the keyword argument, though.)\n> \n> I'd rather keep the `is_...()`, but add (a) keyword or boolean argument(s), and only change the return type(s).\n\n\nI can think those later in another ticket. Actually there is more to think about in splitting code in `posets.py` and `lattices.py` vs. `hasse_diagram.py`.\n\nBut is there more to do for this ticket?\n\n`exact_log` rounds down, my helper function rounds up. Of course I could use it, but the code would not be much simpler. Waiting for Python 3 and log_2...",
    "created_at": "2016-08-31T10:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395151",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:23'></a>
Replying to [leif](#comment%3A20):

> (I guess you were referring to `is_...()`, not the keyword argument, though.)
> 
> I'd rather keep the `is_...()`, but add (a) keyword or boolean argument(s), and only change the return type(s).


I can think those later in another ticket. Actually there is more to think about in splitting code in `posets.py` and `lattices.py` vs. `hasse_diagram.py`.

But is there more to do for this ticket?

`exact_log` rounds down, my helper function rounds up. Of course I could use it, but the code would not be much simpler. Waiting for Python 3 and log_2...



---

archive/issue_comments_395152.json:
```json
{
    "body": "<a id='comment:24'></a>\nAssuming that #21419 get accepted it offers a faster way to chech if a lattice is semidistributive.",
    "created_at": "2016-09-06T05:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395152",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:24'></a>
Assuming that #21419 get accepted it offers a faster way to chech if a lattice is semidistributive.



---

archive/issue_comments_395153.json:
```json
{
    "body": "<a id='comment:25'></a>\nJust a ping... Currently Sage says that a distributive lattice is not semidistributive, which is bad. There are more to add, but IMO bugs should be corrected first.\n\nReplying to [jmantysalo](#comment%3A23):\n\n> But is there more to do for this ticket?",
    "created_at": "2016-09-13T04:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395153",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:25'></a>
Just a ping... Currently Sage says that a distributive lattice is not semidistributive, which is bad. There are more to add, but IMO bugs should be corrected first.

Replying to [jmantysalo](#comment%3A23):

> But is there more to do for this ticket?



---

archive/issue_comments_395154.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-09-14T12:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395154",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_395155.json:
```json
{
    "body": "<a id='comment:26'></a>\nok, ok. It would have been better to put this log2 in some other place.",
    "created_at": "2016-09-14T12:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395155",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
ok, ok. It would have been better to put this log2 in some other place.



---

archive/issue_comments_395156.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2016-09-14T12:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395156",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_395157.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [chapoton](#comment%3A26):\n> It would have been better to put this log2 in some other place.\n\n\nBut I think that someone, \"Fr\u00e9d\u00e9ric\" if I remember the name correctly, is converting [SageMath](SageMath) to Python 3. `:=)` Then we will have `math.log2()`.",
    "created_at": "2016-09-14T12:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395157",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:27'></a>
Replying to [chapoton](#comment%3A26):
> It would have been better to put this log2 in some other place.


But I think that someone, "Frédéric" if I remember the name correctly, is converting [SageMath](SageMath) to Python 3. `:=)` Then we will have `math.log2()`.



---

archive/issue_events_064552.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-16T06:55:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21340#event-64552"
}
```



---

archive/issue_comments_395158.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-09-16T06:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395158",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_395159.json:
```json
{
    "body": "**Changing branch** from \"[u/jmantysalo/latticeposet__bug_in_testing_semidistributivity](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__bug_in_testing_semidistributivity)\" to \"[68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)\".",
    "created_at": "2016-09-16T06:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21340#issuecomment-395159",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jmantysalo/latticeposet__bug_in_testing_semidistributivity](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/latticeposet__bug_in_testing_semidistributivity)" to "[68419a4806a5674caa0ea535577ef9a6eea1a5c5](https://github.com/sagemath/sagetrac-mirror/commit/68419a4806a5674caa0ea535577ef9a6eea1a5c5)".
