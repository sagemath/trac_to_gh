# Issue 21772: sage -t src/sage/misc/latex.py opens 2 sage.pdf file

archive/issues_021772.json:
```json
{
    "body": "CC:  @mo271 jepperlein\n\nThis was introduced in #21947.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22009\n\n",
    "closed_at": "2016-12-05T00:44:34Z",
    "created_at": "2016-12-02T07:20:33Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "sage -t src/sage/misc/latex.py opens 2 sage.pdf file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21772",
    "user": "https://github.com/seblabbe"
}
```
CC:  @mo271 jepperlein

This was introduced in #21947.

Issue created by migration from https://trac.sagemath.org/ticket/22009





---

archive/issue_comments_301713.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301713",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_301714.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301714",
    "user": "https://github.com/seblabbe"
}
```

New commits:



---

archive/issue_comments_301715.json:
```json
{
    "body": "Something that happened to me with those tests as well is that I got a more verbose output the first time\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/latex.py\", line 2157, in sage.misc.latex.?\nFailed example:\n    view(4, margin=5, debug=True)\nExpected:\n    \\documentclass{article}\n    ...\n    \\usepackage[tightpage,active]{preview}\n    \\PreviewEnvironment{page}\n    \\setlength\\PreviewBorder{5.000000mm}\n    \\begin{document}\\begin{page}$4$\\end{page}\n    \\end{document}\n    ...\nGot:\n    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)\n     restricted \\write18 enabled.\n    entering extended mode\n    LaTeX2e <2014/05/01>\n    Babel <3.9l> and hyphenation patterns for 48 languages loaded.\n...\n```\nIt ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.",
    "created_at": "2016-12-02T07:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301715",
    "user": "https://github.com/kiwifb"
}
```

Something that happened to me with those tests as well is that I got a more verbose output the first time

```
File "/usr/lib64/python2.7/site-packages/sage/misc/latex.py", line 2157, in sage.misc.latex.?
Failed example:
    view(4, margin=5, debug=True)
Expected:
    \documentclass{article}
    ...
    \usepackage[tightpage,active]{preview}
    \PreviewEnvironment{page}
    \setlength\PreviewBorder{5.000000mm}
    \begin{document}\begin{page}$4$\end{page}
    \end{document}
    ...
Got:
    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)
     restricted \write18 enabled.
    entering extended mode
    LaTeX2e <2014/05/01>
    Babel <3.9l> and hyphenation patterns for 48 languages loaded.
...
```
It ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.



---

archive/issue_comments_301716.json:
```json
{
    "body": "It must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.\n\nAlso, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.\n\nPersonnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.",
    "created_at": "2016-12-02T08:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301716",
    "user": "https://github.com/seblabbe"
}
```

It must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.

Also, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.

Personnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.



---

archive/issue_comments_301717.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-02T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301717",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301718.json:
```json
{
    "body": "OK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.\n\nCan you fill in the author section please.",
    "created_at": "2016-12-02T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301718",
    "user": "https://github.com/kiwifb"
}
```

OK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.

Can you fill in the author section please.



---

archive/issue_comments_301719.json:
```json
{
    "body": "I fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.",
    "created_at": "2016-12-02T08:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301719",
    "user": "https://trac.sagemath.org/admin/accounts/users/jepperlein"
}
```

I fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.



---

archive/issue_comments_301720.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-12-03T16:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301720",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_events_057956.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-05T00:44:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21772#event-57956"
}
```



---

archive/issue_comments_301721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-05T00:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21772#issuecomment-301721",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
