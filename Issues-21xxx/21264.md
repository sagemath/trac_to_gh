# Issue 21264: Factoring and Irreducibility Related Methods in Skew Polynomials

archive/issues_021027.json:
```json
{
    "body": "CC:  @tscrim @xcaruso @johanrosenkilde dlucas @vbraun\n\nThis ticket implements the following methods (all related to factorization and irreducible divisors) for skew polynomials over finite fields\n\n- `is_irreducible`\n- `right_irreducible_divisor`, `left_irreducible_divisor` (return a divisor)\n- `right_irreducible_divisors`, `left_irreducible_divisors` (return an iterator over all divisors)\n- `count_irreducible_divisors`\n- `factor` (return a factorization)\n- `factorizations` (return an iterator over all factorizations)\n- `count_factorizations`\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21264\n\n",
    "closed_at": "2020-06-21T22:37:20Z",
    "created_at": "2016-08-17T11:23:33Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Factoring and Irreducibility Related Methods in Skew Polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21264",
    "user": "https://github.com/arpitdm"
}
```
CC:  @tscrim @xcaruso @johanrosenkilde dlucas @vbraun

This ticket implements the following methods (all related to factorization and irreducible divisors) for skew polynomials over finite fields

- `is_irreducible`
- `right_irreducible_divisor`, `left_irreducible_divisor` (return a divisor)
- `right_irreducible_divisors`, `left_irreducible_divisors` (return an iterator over all divisors)
- `count_irreducible_divisors`
- `factor` (return a factorization)
- `factorizations` (return an iterator over all factorizations)
- `count_factorizations`


Issue created by migration from https://trac.sagemath.org/ticket/21264





---

archive/issue_comments_291025.json:
```json
{
    "body": "Please also note that the current code is more or less just what was in the original patch for #13215 related to Factoring and Irreducibility methods. No effort has been made yet to accommodate for changes in #13215 since this addition was factored out.",
    "created_at": "2016-08-17T11:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291025",
    "user": "https://github.com/arpitdm"
}
```

Please also note that the current code is more or less just what was in the original patch for #13215 related to Factoring and Irreducibility methods. No effort has been made yet to accommodate for changes in #13215 since this addition was factored out.



---

archive/issue_comments_291026.json:
```json
{
    "body": "Where is the code of this ticket?\n\nShould I copy it from https://trac.sagemath.org/attachment/ticket/13215/trac_13215_skew_polynomials.patch or can I find it somewhere on git?",
    "created_at": "2020-04-03T19:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291026",
    "user": "https://github.com/xcaruso"
}
```

Where is the code of this ticket?

Should I copy it from https://trac.sagemath.org/attachment/ticket/13215/trac_13215_skew_polynomials.patch or can I find it somewhere on git?



---

archive/issue_comments_291027.json:
```json
{
    "body": "OK, I found it.\n\n---\nLast 10 new commits:",
    "created_at": "2020-04-04T09:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291027",
    "user": "https://github.com/xcaruso"
}
```

OK, I found it.

---
Last 10 new commits:



---

archive/issue_comments_291028.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-04-10T21:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291028",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_291029.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-04-14T12:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_291030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-15T13:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-16T12:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291032.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-16T12:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291032",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_events_056673.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2020-04-16T12:13:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21264#event-56673"
}
```



---

archive/issue_comments_291033.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-16T14:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291034.json:
```json
{
    "body": "Can you rebase the branch off #21262 so the commits/changes specific to this ticket are easier to review?\n\nAlso there are added functions in `skew_polynomial_element.pyx` that do not have doctests and formatting should be\n\n```\n- some really long text that needs to be wrapped on\n  multiple lines should have the text start on the\n  same line as the first character that is not the\n  bullet point/number\n```",
    "created_at": "2020-04-17T00:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291034",
    "user": "https://github.com/tscrim"
}
```

Can you rebase the branch off #21262 so the commits/changes specific to this ticket are easier to review?

Also there are added functions in `skew_polynomial_element.pyx` that do not have doctests and formatting should be

```
- some really long text that needs to be wrapped on
  multiple lines should have the text start on the
  same line as the first character that is not the
  bullet point/number
```



---

archive/issue_comments_291035.json:
```json
{
    "body": "> Can you rebase the branch off #21262 so the commits/changes specific to this ticket are easier to review?\n\n\nI tried to do it but it fails. So I create a new branch and push my changes on top of ticket #21262.",
    "created_at": "2020-04-17T09:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291035",
    "user": "https://github.com/xcaruso"
}
```

> Can you rebase the branch off #21262 so the commits/changes specific to this ticket are easier to review?


I tried to do it but it fails. So I create a new branch and push my changes on top of ticket #21262.



---

archive/issue_comments_291036.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-17T13:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-17T15:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291038.json:
```json
{
    "body": "Thank you, that helped a lot. It looks good and quite impressive. However, I do have a few comments:\n\nIn `_left_lcm_cofactor`, is `while not V3.is_zero():` faster than `while not V3:`? Experience tells me the latter is nearly always faster. Also would it make sense to have this be an inlined cdef function? Could you specify the types of some of the variables there (you can do this in `def` methods too)? Same comment for the `_right_lcm_cofactor`.\n\nCould `_reduced_norm_factored` also be an inlined cdef method? Same for all of the other hidden methods like `_irreducible_divisors` (possibly not inlined)?\n\nI would do it like this in `type` to make it more clear what the loop is testing:\n\n```diff\n+            d = self.right_gcd(NS)\n+            deg = d.degree() / degN\n+            while deg == 0:\n-            while True:\n-                d = self.right_gcd(NS)\n-                deg = d.degree()/degN\n-                if deg == 0:\n-                    break\n                 if m >= 0:\n                     if deg == 1:\n                         type += m * [1]\n                         break\n                     m -= deg\n                 self = self // d\n                 type.append(deg)\n+                d = self.right_gcd(NS)\n+                deg = d.degree() / degN\n```\nCan you also specify the type of some of the variables, like the lists? This should make the C code cleaner and offer some micro speedups (especially if you use `type.extend(m * [1])` instead of `type += m * [1]`). Also, since the result is cached, you should ultimately make it a tuple (or some other immutable object).\n\nWhy do you initialize `_types` to be `None` instead of an empty dict? It seems like a reasonable thing to do and have an `__init__` method to me.\n\nThis syntax is somewhat deprecated `for j from 0 <= j < e:` -> `for j in range(e):`.\n\nThe following are all for `_rdivisor_c`:\n\nI think it be faster to do:\n\n```diff\n-Integer((E.cardinality()-1)/2)\n+<Integer>( (E.cardinality()-1) // 2 )\n```\n\nRather than compute `lM` and then take the transpose, I think it would be must better to construct directly in transpose form (which requires a little more computation, but I think it is faster).\n\nI would pull the `if skew_ring.characteristic() == 2:` test outside of the `while` loop and store it as a boolean variable. In that case you can also do `zz = yy` to avoid an extra function call.\n\nBack to general comments: It would be nice to be more PEP8 compliant and have things like `if P1.degree() == degN: break` on 2 lines IMO.\n\nI would restructure the last part fo `left_irreducible_factor` as:\n\n```python\n        if not uniform:\n            LD = P1 // P1.right_gcd(NS // D)\n            if LD.degree() == degN:\n                return LD\n        while True:\n            R = skew_ring.random_element((deg,deg))\n            if NS.right_gcd(R) == 1: break\n        D = NS.right_gcd(D*R)\n        LD = P1 // P1.right_gcd(NS // D)\n        if LD.degree() == degN:\n            return LD\n```\nYes, there is some code repetition, but it make the overall logic easier IMO.\n\nIn `_factor_uniform_c`, you know `type[0]` is an `int`, so I would explicitly make that cast `if <int>(type[0]) > 1:` to simplify the C code. Actually, you might want to locally make the `type` variable an array of `int`s to not have to do these casts everywhere and speedup element access. For the `q_jordan`, why is `maxtype` being converted to a partition? This is not needed for the function AFAICS. (Side note, this might be a good reason to consider Cythonizing these low-level but important combinatorial objects.)\n\n`while 1:` -> `while True:`\n\nIn `factor`:\n\n```diff\n         - ``uniform`` -- a boolean (default: ``False``); whether the \n-        output irreducible divisor should be uniformly distributed\n-        among all possibilities\n+          output irreducible divisor should be uniformly distributed\n+          among all possibilities\n```\nAlso `sig_on` and `sig_off` should not contain Python code I believe. Just put it around the `self._factor_c()` call.\n\nAlso, our convention is the 1-line descriptions should end with a period/full-stop.",
    "created_at": "2020-04-21T01:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291038",
    "user": "https://github.com/tscrim"
}
```

Thank you, that helped a lot. It looks good and quite impressive. However, I do have a few comments:

In `_left_lcm_cofactor`, is `while not V3.is_zero():` faster than `while not V3:`? Experience tells me the latter is nearly always faster. Also would it make sense to have this be an inlined cdef function? Could you specify the types of some of the variables there (you can do this in `def` methods too)? Same comment for the `_right_lcm_cofactor`.

Could `_reduced_norm_factored` also be an inlined cdef method? Same for all of the other hidden methods like `_irreducible_divisors` (possibly not inlined)?

I would do it like this in `type` to make it more clear what the loop is testing:

```diff
+            d = self.right_gcd(NS)
+            deg = d.degree() / degN
+            while deg == 0:
-            while True:
-                d = self.right_gcd(NS)
-                deg = d.degree()/degN
-                if deg == 0:
-                    break
                 if m >= 0:
                     if deg == 1:
                         type += m * [1]
                         break
                     m -= deg
                 self = self // d
                 type.append(deg)
+                d = self.right_gcd(NS)
+                deg = d.degree() / degN
```
Can you also specify the type of some of the variables, like the lists? This should make the C code cleaner and offer some micro speedups (especially if you use `type.extend(m * [1])` instead of `type += m * [1]`). Also, since the result is cached, you should ultimately make it a tuple (or some other immutable object).

Why do you initialize `_types` to be `None` instead of an empty dict? It seems like a reasonable thing to do and have an `__init__` method to me.

This syntax is somewhat deprecated `for j from 0 <= j < e:` -> `for j in range(e):`.

The following are all for `_rdivisor_c`:

I think it be faster to do:

```diff
-Integer((E.cardinality()-1)/2)
+<Integer>( (E.cardinality()-1) // 2 )
```

Rather than compute `lM` and then take the transpose, I think it would be must better to construct directly in transpose form (which requires a little more computation, but I think it is faster).

I would pull the `if skew_ring.characteristic() == 2:` test outside of the `while` loop and store it as a boolean variable. In that case you can also do `zz = yy` to avoid an extra function call.

Back to general comments: It would be nice to be more PEP8 compliant and have things like `if P1.degree() == degN: break` on 2 lines IMO.

I would restructure the last part fo `left_irreducible_factor` as:

```python
        if not uniform:
            LD = P1 // P1.right_gcd(NS // D)
            if LD.degree() == degN:
                return LD
        while True:
            R = skew_ring.random_element((deg,deg))
            if NS.right_gcd(R) == 1: break
        D = NS.right_gcd(D*R)
        LD = P1 // P1.right_gcd(NS // D)
        if LD.degree() == degN:
            return LD
```
Yes, there is some code repetition, but it make the overall logic easier IMO.

In `_factor_uniform_c`, you know `type[0]` is an `int`, so I would explicitly make that cast `if <int>(type[0]) > 1:` to simplify the C code. Actually, you might want to locally make the `type` variable an array of `int`s to not have to do these casts everywhere and speedup element access. For the `q_jordan`, why is `maxtype` being converted to a partition? This is not needed for the function AFAICS. (Side note, this might be a good reason to consider Cythonizing these low-level but important combinatorial objects.)

`while 1:` -> `while True:`

In `factor`:

```diff
         - ``uniform`` -- a boolean (default: ``False``); whether the 
-        output irreducible divisor should be uniformly distributed
-        among all possibilities
+          output irreducible divisor should be uniformly distributed
+          among all possibilities
```
Also `sig_on` and `sig_off` should not contain Python code I believe. Just put it around the `self._factor_c()` call.

Also, our convention is the 1-line descriptions should end with a period/full-stop.



---

archive/issue_comments_291039.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-21T16:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291040.json:
```json
{
    "body": "I think I addressed all your remarks.",
    "created_at": "2020-04-21T16:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291040",
    "user": "https://github.com/xcaruso"
}
```

I think I addressed all your remarks.



---

archive/issue_comments_291041.json:
```json
{
    "body": "Thank you. So I have gotten a look at the C code and did another pass, and I have a few more comments. I think this will be the last batch.\n\nCould you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).\n\nInstead of calling `N.parent()`, you can you the (inline) C function `parent(N)`.\n\nI think this could be simplified in `type()`:\n\n```diff\n-i = [ n for n,_ in self._norm_factor ].index(N)\n-m = self._norm_factor[i][1]\n+m = -1\n+for n, mp in self._norm_factor:\n+    if n == N:\n+        m = mp\n+        break\n```\nThis way you don't create a whole new list and have to iterate through the entire `self._norm_factor` nor obtain the index again.\n\nIt would be nice to put the imports\n\n```\nfrom sage.matrix.matrix_space import MatrixSpace\nfrom sage.matrix.matrix2 import NotFullRankError\n```\nat the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...\n\nI guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?\n\nIn this line, do you really need to create a new list?\n\n```\nX = <SkewPolynomial_finite_field_dense>Q._new_c(Q._coeffs[:],Q._parent)\n```\nIf so, then I think it is better to do `list(Q._coeffs)`.\n\nI still think the `M = MatrixSpace(E,e,e)(lM).transpose()` is relatively expensive and could be avoided. For example:\n\n```python\nlM = [None] * e**2\nfor j in range(e):\n    for i in range(e):\n        coeffs = [skew_ring._retraction(X[t*r+i]) for t in range(d)]\n        value = E(coeffs)\n        lM[i*e+j] = value\n```\n\n```diff\n-xx = PE(W.list() + [E(-1)])\n+xx = PE((<list> W.list()) + [E(-1)])\n```\n\nI think instead of `mul = lambda a,b: a*b` and for the other in `_irreducible_divisors`, it would be better to have little inline cdef functions `lmul` and `rmul` (say in the `pxd` file) that you set `mul` to. This seems to make the C code better.\n\nThis is impossible: `if len(a) < 0:`. Did you mean `if len(a) == 0`, in which case it is faster to just do `if not a:`?\n\nI am not 100% sure that this is safe:\n\n```\ncdef RingElement unit = <RingElement>self.leading_coefficient()\n```\nIs it possible to have something over a commutative base ring that whose elements are not a `RingElement`? There are such things, like the ring of symmetric functions (granted, this is not a finite field, but merely to point out such things can exists within Sage). There might not be any benefit for specifying the type here.\n\nTake advantage of the caching:\n\n```diff\n-skew_ring(1)\n+skew_ring.one()\n```\n\nSo you don't have to create an intermediate object:\n\n```diff\n-cdef list indices = list(Permutations(len(factorsN)).random_element())\n+from sage.misc.prandom import sample  # Do this import at the top level\\\n+m = len(factorsN)\n+cdef list indices = <list> sample(range(1,m+1), m))\n```\n\nMissed one:\n\n```diff\n-maxcount = q_jordan(Partition(maxtype),cardE)\n+maxcount = q_jordan(maxtype, cardE)\n```",
    "created_at": "2020-04-22T00:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291041",
    "user": "https://github.com/tscrim"
}
```

Thank you. So I have gotten a look at the C code and did another pass, and I have a few more comments. I think this will be the last batch.

Could you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).

Instead of calling `N.parent()`, you can you the (inline) C function `parent(N)`.

I think this could be simplified in `type()`:

```diff
-i = [ n for n,_ in self._norm_factor ].index(N)
-m = self._norm_factor[i][1]
+m = -1
+for n, mp in self._norm_factor:
+    if n == N:
+        m = mp
+        break
```
This way you don't create a whole new list and have to iterate through the entire `self._norm_factor` nor obtain the index again.

It would be nice to put the imports

```
from sage.matrix.matrix_space import MatrixSpace
from sage.matrix.matrix2 import NotFullRankError
```
at the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...

I guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?

In this line, do you really need to create a new list?

```
X = <SkewPolynomial_finite_field_dense>Q._new_c(Q._coeffs[:],Q._parent)
```
If so, then I think it is better to do `list(Q._coeffs)`.

I still think the `M = MatrixSpace(E,e,e)(lM).transpose()` is relatively expensive and could be avoided. For example:

```python
lM = [None] * e**2
for j in range(e):
    for i in range(e):
        coeffs = [skew_ring._retraction(X[t*r+i]) for t in range(d)]
        value = E(coeffs)
        lM[i*e+j] = value
```

```diff
-xx = PE(W.list() + [E(-1)])
+xx = PE((<list> W.list()) + [E(-1)])
```

I think instead of `mul = lambda a,b: a*b` and for the other in `_irreducible_divisors`, it would be better to have little inline cdef functions `lmul` and `rmul` (say in the `pxd` file) that you set `mul` to. This seems to make the C code better.

This is impossible: `if len(a) < 0:`. Did you mean `if len(a) == 0`, in which case it is faster to just do `if not a:`?

I am not 100% sure that this is safe:

```
cdef RingElement unit = <RingElement>self.leading_coefficient()
```
Is it possible to have something over a commutative base ring that whose elements are not a `RingElement`? There are such things, like the ring of symmetric functions (granted, this is not a finite field, but merely to point out such things can exists within Sage). There might not be any benefit for specifying the type here.

Take advantage of the caching:

```diff
-skew_ring(1)
+skew_ring.one()
```

So you don't have to create an intermediate object:

```diff
-cdef list indices = list(Permutations(len(factorsN)).random_element())
+from sage.misc.prandom import sample  # Do this import at the top level\
+m = len(factorsN)
+cdef list indices = <list> sample(range(1,m+1), m))
```

Missed one:

```diff
-maxcount = q_jordan(Partition(maxtype),cardE)
+maxcount = q_jordan(maxtype, cardE)
```



---

archive/issue_comments_291042.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-23T13:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291043.json:
```json
{
    "body": "Replying to [comment:22 tscrim]:\n> Could you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).\n\n\nIt's done, I think. Please tell me if I've implemented correctly what you had in mind.\n\nI tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:\n\n```\n    quo_rem = SkewPolynomial_finite_field._right_quo_rem\n    quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n```\nI don't know why exactly.\n\n> It would be nice to put the imports\n> \n> ```\n> from sage.matrix.matrix_space import MatrixSpace\n> from sage.matrix.matrix2 import NotFullRankError\n> ```\n> at the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...\n\n\nYes, it creates import errors. And indeed, it would be nice to fix it.\n\n> I guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?\n\n\nWell, it's a polynomial. So probably an instance of the generic class `Polynomial` (or maybe even `Polynomial_generic_dense`) but I'm not sure it will always be the case.\n\nAnother point: From time to time, I got errors with `sig_on()` and `sig_off()`, e.g.:\n\n```\nsage: k.<a> = GF(5^4)\nsage: Frob = k.frobenius_endomorphism(2)\nsage: S.<x> = k['x', Frob]\nsage: P = x^2 + a + a^25\nsage: P.factor()\nTraceback (most recent call last):\n...\nSystemError: calling remove_from_pari_stack() inside sig_on()\n```\nSo, I've removed them and added a call to `sig_check()` in the methods `_left_quo_rem` and `_right_quo_rem` (which are called repeatedly by all nontrivial algorithms). Is this okay?",
    "created_at": "2020-04-23T13:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291043",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:22 tscrim]:
> Could you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).


It's done, I think. Please tell me if I've implemented correctly what you had in mind.

I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:

```
    quo_rem = SkewPolynomial_finite_field._right_quo_rem
    quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
```
I don't know why exactly.

> It would be nice to put the imports
> 
> ```
> from sage.matrix.matrix_space import MatrixSpace
> from sage.matrix.matrix2 import NotFullRankError
> ```
> at the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...


Yes, it creates import errors. And indeed, it would be nice to fix it.

> I guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?


Well, it's a polynomial. So probably an instance of the generic class `Polynomial` (or maybe even `Polynomial_generic_dense`) but I'm not sure it will always be the case.

Another point: From time to time, I got errors with `sig_on()` and `sig_off()`, e.g.:

```
sage: k.<a> = GF(5^4)
sage: Frob = k.frobenius_endomorphism(2)
sage: S.<x> = k['x', Frob]
sage: P = x^2 + a + a^25
sage: P.factor()
Traceback (most recent call last):
...
SystemError: calling remove_from_pari_stack() inside sig_on()
```
So, I've removed them and added a call to `sig_check()` in the methods `_left_quo_rem` and `_right_quo_rem` (which are called repeatedly by all nontrivial algorithms). Is this okay?



---

archive/issue_comments_291044.json:
```json
{
    "body": "Replying to [comment:24 caruso]:\n> Replying to [comment:22 tscrim]:\n> > Could you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).\n\n> \n> It's done, I think. Please tell me if I've implemented correctly what you had in mind.\n> \n> I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:\n> \n> ```\n>     quo_rem = SkewPolynomial_finite_field._right_quo_rem\n>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n> ```\n> I don't know why exactly.\n\n\nSo I think it is because Cython doesn't know that those should be function pointers and will have the same signature. You might be able to make them actual function pointers since you know everything is the correct type. However, I am not sure exactly how to do this as Cython tutorials don't seem to talk much about how to do function pointers, much less with cdef methods.\n\n> > It would be nice to put the imports\n> > \n> > ```\n> > from sage.matrix.matrix_space import MatrixSpace\n> > from sage.matrix.matrix2 import NotFullRankError\n> > ```\n> > at the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...\n\n> \n> Yes, it creates import errors. And indeed, it would be nice to fix it.\n\n\nThis is now #29561, which fixes the import loop when I tested it.\n\n> > I guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?\n\n> \n> Well, it's a polynomial. So probably an instance of the generic class `Polynomial` (or maybe even `Polynomial_generic_dense`) but I'm not sure it will always be the case.\n\n\nThat's fine. I just wanted to ask to see if I was missing something.\n\n> Another point: From time to time, I got errors with `sig_on()` and `sig_off()`, e.g.:\n> \n> ```\n> sage: k.<a> = GF(5^4)\n> sage: Frob = k.frobenius_endomorphism(2)\n> sage: S.<x> = k['x', Frob]\n> sage: P = x^2 + a + a^25\n> sage: P.factor()\n> Traceback (most recent call last):\n> ...\n> SystemError: calling remove_from_pari_stack() inside sig_on()\n> ```\n> So, I've removed them and added a call to `sig_check()` in the methods `_left_quo_rem` and `_right_quo_rem` (which are called repeatedly by all nontrivial algorithms). Is this okay?\n\n\nI am pretty certain that is okay. Although I am not such a Cython expert to say it is surely correct.",
    "created_at": "2020-04-24T02:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291044",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:24 caruso]:
> Replying to [comment:22 tscrim]:
> > Could you separate the main part of `right_quo_rem` (and same for the left) into a `cdef` that assumes an input in the parent? This should improve the C code in `_left_lcm_cofactor` (same for the right).

> 
> It's done, I think. Please tell me if I've implemented correctly what you had in mind.
> 
> I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:
> 
> ```
>     quo_rem = SkewPolynomial_finite_field._right_quo_rem
>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
> ```
> I don't know why exactly.


So I think it is because Cython doesn't know that those should be function pointers and will have the same signature. You might be able to make them actual function pointers since you know everything is the correct type. However, I am not sure exactly how to do this as Cython tutorials don't seem to talk much about how to do function pointers, much less with cdef methods.

> > It would be nice to put the imports
> > 
> > ```
> > from sage.matrix.matrix_space import MatrixSpace
> > from sage.matrix.matrix2 import NotFullRankError
> > ```
> > at the top-level. I guess this is the import loop we had on the other ticket? I still need to fix that...

> 
> Yes, it creates import errors. And indeed, it would be nice to fix it.


This is now #29561, which fixes the import loop when I tested it.

> > I guess we don't know anything about the type of `N` in `_rdivisor_c`, correct?

> 
> Well, it's a polynomial. So probably an instance of the generic class `Polynomial` (or maybe even `Polynomial_generic_dense`) but I'm not sure it will always be the case.


That's fine. I just wanted to ask to see if I was missing something.

> Another point: From time to time, I got errors with `sig_on()` and `sig_off()`, e.g.:
> 
> ```
> sage: k.<a> = GF(5^4)
> sage: Frob = k.frobenius_endomorphism(2)
> sage: S.<x> = k['x', Frob]
> sage: P = x^2 + a + a^25
> sage: P.factor()
> Traceback (most recent call last):
> ...
> SystemError: calling remove_from_pari_stack() inside sig_on()
> ```
> So, I've removed them and added a call to `sig_check()` in the methods `_left_quo_rem` and `_right_quo_rem` (which are called repeatedly by all nontrivial algorithms). Is this okay?


I am pretty certain that is okay. Although I am not such a Cython expert to say it is surely correct.



---

archive/issue_comments_291045.json:
```json
{
    "body": "Replying to [comment:24 caruso]:\n> I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:\n> \n> ```\n>     quo_rem = SkewPolynomial_finite_field._right_quo_rem\n>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n> ```\n> I don't know why exactly.\n\n\nIt's really weird. It really looks like a bug in a cython compiler. For instance,\n\n```\n    quo_rem = SkewPolynomial_finite_field.right_quo_rem\n    quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n```\nsometimes works... but not always. (And I couldn't figure out on what it depends.)",
    "created_at": "2020-04-25T13:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291045",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:24 caruso]:
> I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:
> 
> ```
>     quo_rem = SkewPolynomial_finite_field._right_quo_rem
>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
> ```
> I don't know why exactly.


It's really weird. It really looks like a bug in a cython compiler. For instance,

```
    quo_rem = SkewPolynomial_finite_field.right_quo_rem
    quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
```
sometimes works... but not always. (And I couldn't figure out on what it depends.)



---

archive/issue_comments_291046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-25T13:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291047.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-26T04:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291047",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291048.json:
```json
{
    "body": "Replying to [comment:26 caruso]:\n> Replying to [comment:24 caruso]:\n> > I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:\n> > \n> > ```\n> >     quo_rem = SkewPolynomial_finite_field._right_quo_rem\n> >     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n> > ```\n> > I don't know why exactly.\n\n> \n> It's really weird. It really looks like a bug in a cython compiler. For instance,\n> \n> ```\n>     quo_rem = SkewPolynomial_finite_field.right_quo_rem\n>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem\n> ```\n> sometimes works... but not always. (And I couldn't figure out on what it depends.)\n\n\nThat is strange. Well, I think that can be a mystery for another day for additional optimization. I have done everything I can see is natural to do. Thank you for caring care of all of those changes.",
    "created_at": "2020-04-26T04:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291048",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:26 caruso]:
> Replying to [comment:24 caruso]:
> > I tried to call the methods `_left_quo_rem` and `_right_quo_rem` in `_irreducible_divisors` but the following lines fail:
> > 
> > ```
> >     quo_rem = SkewPolynomial_finite_field._right_quo_rem
> >     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
> > ```
> > I don't know why exactly.

> 
> It's really weird. It really looks like a bug in a cython compiler. For instance,
> 
> ```
>     quo_rem = SkewPolynomial_finite_field.right_quo_rem
>     quo_rem2 = SkewPolynomial_finite_field._left_quo_rem
> ```
> sometimes works... but not always. (And I couldn't figure out on what it depends.)


That is strange. Well, I think that can be a mystery for another day for additional optimization. I have done everything I can see is natural to do. Thank you for caring care of all of those changes.



---

archive/issue_comments_291049.json:
```json
{
    "body": "Great!\n\nSince, I merged #29561 in this ticket, I think it's better if I give a positive review to #29561 right now. We will see later for pyflakes issues.",
    "created_at": "2020-04-26T09:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291049",
    "user": "https://github.com/xcaruso"
}
```

Great!

Since, I merged #29561 in this ticket, I think it's better if I give a positive review to #29561 right now. We will see later for pyflakes issues.



---

archive/issue_comments_291050.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-05-07T15:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_291051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-05-07T15:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_291052.json:
```json
{
    "body": "Conflict resolved.",
    "created_at": "2020-05-07T15:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291052",
    "user": "https://github.com/xcaruso"
}
```

Conflict resolved.



---

archive/issue_comments_291053.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-07T15:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291053",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291054.json:
```json
{
    "body": "Hi Volker, is there some reason this hasn't yet been merged in? All of the dependency tickets were closed (I removed them in case that is causing some issues with your scripts).",
    "created_at": "2020-06-03T23:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291054",
    "user": "https://github.com/tscrim"
}
```

Hi Volker, is there some reason this hasn't yet been merged in? All of the dependency tickets were closed (I removed them in case that is causing some issues with your scripts).



---

archive/issue_comments_291055.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-21T22:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21264#issuecomment-291055",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056674.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-21T22:37:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21264",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21264#event-56674"
}
```
