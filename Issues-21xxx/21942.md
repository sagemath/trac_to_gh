# Issue 21942: Cheeger constant(s) of graphs

archive/issues_021705.json:
```json
{
    "body": "Assignee: @pelegm\n\nCC:  @videlec jepperlein @slel\n\nKeywords: cheeger, MathExp2018\n\nThis ticket adds three methods to graphs to compute three variations  of the Cheeger constant:\n\n- the \"transition isoperimetric number\" (`cheeger_constant`)\n- the edge isoperimetric number (`edge_isoperimetric_number`)\n- the vertex isoperimetric number or magnifying constant (`vertex_isoperimetric_number`)\n\nNote that the implemented Cheeger constant is also the **conductance** of the simple random walk on the graph.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21942\n\n",
    "closed_at": "2020-07-19T07:24:34Z",
    "created_at": "2016-11-23T10:08:51Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Cheeger constant(s) of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21942",
    "user": "https://github.com/pelegm"
}
```
Assignee: @pelegm

CC:  @videlec jepperlein @slel

Keywords: cheeger, MathExp2018

This ticket adds three methods to graphs to compute three variations  of the Cheeger constant:

- the "transition isoperimetric number" (`cheeger_constant`)
- the edge isoperimetric number (`edge_isoperimetric_number`)
- the vertex isoperimetric number or magnifying constant (`vertex_isoperimetric_number`)

Note that the implemented Cheeger constant is also the **conductance** of the simple random walk on the graph.

Issue created by migration from https://trac.sagemath.org/ticket/21942





---

archive/issue_comments_300931.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-23T10:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300931",
    "user": "https://github.com/pelegm"
}
```

New commits:



---

archive/issue_comments_300932.json:
```json
{
    "body": "Set assignee to @pelegm.",
    "created_at": "2016-11-23T10:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300932",
    "user": "https://github.com/pelegm"
}
```

Set assignee to @pelegm.



---

archive/issue_comments_300933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-23T12:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300934.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-23T13:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300935.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-23T13:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300935",
    "user": "https://github.com/pelegm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_300936.json:
```json
{
    "body": "Will rebase to `develop`.",
    "created_at": "2016-11-23T16:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300936",
    "user": "https://github.com/pelegm"
}
```

Will rebase to `develop`.



---

archive/issue_comments_300937.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-24T12:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300937",
    "user": "https://github.com/pelegm"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_300938.json:
```json
{
    "body": "`@`vdelecroix, perhaps we can work on this together on some notebook on the cloud or somewhere else?",
    "created_at": "2016-11-24T12:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300938",
    "user": "https://github.com/pelegm"
}
```

`@`vdelecroix, perhaps we can work on this together on some notebook on the cloud or somewhere else?



---

archive/issue_comments_300939.json:
```json
{
    "body": "I know nothing about those functions. However, two general notes:\n\n- One-sentence descriptions will be used in the toc and they should really be just one sentence. It is kind of dull to have \"Return the edge-isoperimetric number of a graph.\" when the name is `edge_isoperimetric_number()`, but there is no good alternative. (When there is no real one-line description like for example `size()` has.)\n\n- Please test for empty graphs. See #21741 for bugs we already have had.",
    "created_at": "2016-11-29T21:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300939",
    "user": "https://github.com/jm58660"
}
```

I know nothing about those functions. However, two general notes:

- One-sentence descriptions will be used in the toc and they should really be just one sentence. It is kind of dull to have "Return the edge-isoperimetric number of a graph." when the name is `edge_isoperimetric_number()`, but there is no good alternative. (When there is no real one-line description like for example `size()` has.)

- Please test for empty graphs. See #21741 for bugs we already have had.



---

archive/issue_comments_300940.json:
```json
{
    "body": "Thanks for the feedback. I am currently testing a better algorithm, based on gray codes. I will also modify the docstrings appropriately, and test/fix the method for empty graphs (and, in general, for graphs with no edges).",
    "created_at": "2016-11-30T11:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300940",
    "user": "https://github.com/pelegm"
}
```

Thanks for the feedback. I am currently testing a better algorithm, based on gray codes. I will also modify the docstrings appropriately, and test/fix the method for empty graphs (and, in general, for graphs with no edges).



---

archive/issue_comments_300941.json:
```json
{
    "body": "There is no consensus about the definition of Cheeger constants for the empty graph and the graph with 1 vertex. I suggest that we will raise an exception if the graph is empty, and return infinity if the graph contains a single vertex (so that usual lower bounds on the mixing time of the random walk on the graph will not fail).\n\nThe Cheeger constant of a disconnected graph is 0.  I should add that as a heuristic at the beginning of each of the methods.",
    "created_at": "2016-11-30T16:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300941",
    "user": "https://github.com/pelegm"
}
```

There is no consensus about the definition of Cheeger constants for the empty graph and the graph with 1 vertex. I suggest that we will raise an exception if the graph is empty, and return infinity if the graph contains a single vertex (so that usual lower bounds on the mixing time of the random walk on the graph will not fail).

The Cheeger constant of a disconnected graph is 0.  I should add that as a heuristic at the beginning of each of the methods.



---

archive/issue_comments_300942.json:
```json
{
    "body": "You could do the following to reduce overall computation time:\n\n```\nfor k in range(1, self.order()//2):\n    for s in Subsets(self.vertices(), k):\n         ....\n```\nand of course start methods testing the trivial cases.",
    "created_at": "2016-12-01T08:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300942",
    "user": "https://github.com/dcoudert"
}
```

You could do the following to reduce overall computation time:

```
for k in range(1, self.order()//2):
    for s in Subsets(self.vertices(), k):
         ....
```
and of course start methods testing the trivial cases.



---

archive/issue_comments_300943.json:
```json
{
    "body": "I strongly believe that the best way to go is a C backtracker implemented on sparse C graphs. It will be at least 100x faster. With the current code it is not even possible to make computation with graphs with 20 vertices.",
    "created_at": "2016-12-01T08:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300943",
    "user": "https://github.com/videlec"
}
```

I strongly believe that the best way to go is a C backtracker implemented on sparse C graphs. It will be at least 100x faster. With the current code it is not even possible to make computation with graphs with 20 vertices.



---

archive/issue_comments_300944.json:
```json
{
    "body": ">  You could do the following to reduce overall computation time: \n\nWell, this will not do for the Cheeger constant, but might help the isoperimetric numbers.\n\n> I strongly believe that the best way to go is a C backtracker implemented on sparse C graphs. It will be at least 100x faster. With the current code it is not even possible to make computation with graphs with 20 vertices.\n\n\nYou are right: it is very slow. However, I must say that I have no idea how to implement stuff in C. About the backtracker you've offered: do you think that we should simply use a gray code which traverses the entire lattice, or should we really think of something smarter that traverses (mostly) only the relevant subsets? This is probably just a matter of a X2 speed factor, I believe (probably even much less).",
    "created_at": "2016-12-01T08:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300944",
    "user": "https://github.com/pelegm"
}
```

>  You could do the following to reduce overall computation time: 

Well, this will not do for the Cheeger constant, but might help the isoperimetric numbers.

> I strongly believe that the best way to go is a C backtracker implemented on sparse C graphs. It will be at least 100x faster. With the current code it is not even possible to make computation with graphs with 20 vertices.


You are right: it is very slow. However, I must say that I have no idea how to implement stuff in C. About the backtracker you've offered: do you think that we should simply use a gray code which traverses the entire lattice, or should we really think of something smarter that traverses (mostly) only the relevant subsets? This is probably just a matter of a X2 speed factor, I believe (probably even much less).



---

archive/issue_comments_300945.json:
```json
{
    "body": "Let me try it now.",
    "created_at": "2016-12-01T08:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300945",
    "user": "https://github.com/videlec"
}
```

Let me try it now.



---

archive/issue_comments_300946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-12-01T10:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_300947.json:
```json
{
    "body": "In the meanwhile, I have rebased to 7.5beta4 and added some heuristics.",
    "created_at": "2016-12-01T10:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300947",
    "user": "https://github.com/pelegm"
}
```

In the meanwhile, I have rebased to 7.5beta4 and added some heuristics.



---

archive/issue_comments_300948.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-01T17:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300948",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300949.json:
```json
{
    "body": "I am considering changing the doc index from //Algorithmically hard stuff// to //Expansion properties//.  What do you think?",
    "created_at": "2016-12-01T17:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300949",
    "user": "https://github.com/pelegm"
}
```

I am considering changing the doc index from //Algorithmically hard stuff// to //Expansion properties//.  What do you think?



---

archive/issue_comments_300950.json:
```json
{
    "body": "Replying to [comment:18 pelegm]:\n> I am considering changing the doc index from //Algorithmically hard stuff// to //Expansion properties//.  What do you think?\n\n\nWhole idea of //Algorithmically hard stuff// as a TOC headear is odd. To compare, posets have //Properties of the poset//, even when `height` is trivial, `width` is harder but polynomial and `dimension` is proven to not be in `P`.\n\nSo yes, please do that.",
    "created_at": "2016-12-02T07:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300950",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:18 pelegm]:
> I am considering changing the doc index from //Algorithmically hard stuff// to //Expansion properties//.  What do you think?


Whole idea of //Algorithmically hard stuff// as a TOC headear is odd. To compare, posets have //Properties of the poset//, even when `height` is trivial, `width` is harder but polynomial and `dimension` is proven to not be in `P`.

So yes, please do that.



---

archive/issue_comments_300951.json:
```json
{
    "body": "I push a C implementation at `u/vdelecroix/cheeger` which seems to coincide with the one here ;-)\n\n```\nsage: from sage.graphs.isoperimetric_inequalities import cheeger\nsage: G = graphs.CubeGraph(4)\nsage: %time G.cheeger_constant()\nCPU times: user 4.12 s, sys: 52 ms, total: 4.18 s\nWall time: 4.1 s\n1/4\nsage: %time cheeger(G)\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 1.97 ms\n1/4\n```",
    "created_at": "2016-12-02T08:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300951",
    "user": "https://github.com/videlec"
}
```

I push a C implementation at `u/vdelecroix/cheeger` which seems to coincide with the one here ;-)

```
sage: from sage.graphs.isoperimetric_inequalities import cheeger
sage: G = graphs.CubeGraph(4)
sage: %time G.cheeger_constant()
CPU times: user 4.12 s, sys: 52 ms, total: 4.18 s
Wall time: 4.1 s
1/4
sage: %time cheeger(G)
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.97 ms
1/4
```



---

archive/issue_comments_300952.json:
```json
{
    "body": "but not all ;-(\n\n```\nsage: G = graphs.FibonacciTree(6)\nsage: %time G.cheeger_constant()\nCPU times: user 1min 3s, sys: 28 ms, total: 1min 3s\nWall time: 1min 3s\n1/15\nsage: %time cheeger(G)\nCPU times: user 16 ms, sys: 0 ns, total: 16 ms\nWall time: 14.5 ms\n1/13\n```\nI can not work on it right now. I will debug later.",
    "created_at": "2016-12-02T08:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300952",
    "user": "https://github.com/videlec"
}
```

but not all ;-(

```
sage: G = graphs.FibonacciTree(6)
sage: %time G.cheeger_constant()
CPU times: user 1min 3s, sys: 28 ms, total: 1min 3s
Wall time: 1min 3s
1/15
sage: %time cheeger(G)
CPU times: user 16 ms, sys: 0 ns, total: 16 ms
Wall time: 14.5 ms
1/13
```
I can not work on it right now. I will debug later.



---

archive/issue_comments_300953.json:
```json
{
    "body": "I will verify my algorithm for the Fibonacci tree, and if it looks fine I will have a look at your code. Thanks!",
    "created_at": "2016-12-02T09:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300953",
    "user": "https://github.com/pelegm"
}
```

I will verify my algorithm for the Fibonacci tree, and if it looks fine I will have a look at your code. Thanks!



---

archive/issue_comments_300954.json:
```json
{
    "body": "I believe that mine is wrong. Anyway it is worth to look at the code. In particular are there situations were we can perform cheap branch cut?",
    "created_at": "2016-12-02T09:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300954",
    "user": "https://github.com/videlec"
}
```

I believe that mine is wrong. Anyway it is worth to look at the code. In particular are there situations were we can perform cheap branch cut?



---

archive/issue_comments_300955.json:
```json
{
    "body": "Well, I guess that at least for trees the algorithm can be vastly improved.",
    "created_at": "2016-12-02T09:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300955",
    "user": "https://github.com/pelegm"
}
```

Well, I guess that at least for trees the algorithm can be vastly improved.



---

archive/issue_comments_300956.json:
```json
{
    "body": "This paper: http://ac.els-cdn.com/0095895689900294/1-s2.0-0095895689900294-main.pdf?_tid=c92aa55e-b880-11e6-a64e-00000aab0f02&acdnat=1480677575_44a9c4d6e1d9a6be9b2770c5d14f7ecf claims there is a linear algorithm for calculating the edge isoperimetric number of trees.\nIt is a corollary of a more general statement, according to which for every connected graph there exists a partition of its vertex set to **X** and **Y** such that the subgraphs induced by these sets are both connected and the (edge) isoperimetric number equals **|E(X,Y)|/min{|X|,|Y|}**.",
    "created_at": "2016-12-02T11:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300956",
    "user": "https://github.com/pelegm"
}
```

This paper: http://ac.els-cdn.com/0095895689900294/1-s2.0-0095895689900294-main.pdf?_tid=c92aa55e-b880-11e6-a64e-00000aab0f02&acdnat=1480677575_44a9c4d6e1d9a6be9b2770c5d14f7ecf claims there is a linear algorithm for calculating the edge isoperimetric number of trees.
It is a corollary of a more general statement, according to which for every connected graph there exists a partition of its vertex set to **X** and **Y** such that the subgraphs induced by these sets are both connected and the (edge) isoperimetric number equals **|E(X,Y)|/min{|X|,|Y|}**.



---

archive/issue_comments_300957.json:
```json
{
    "body": "Indeed, if we can restrict to connected X and Y in the parition then it is much better! I was not expecting something that strong. However I do not see linearity coming in. There are many partitions X,Y of the vertices so that both induced graphs are connected.",
    "created_at": "2016-12-02T12:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300957",
    "user": "https://github.com/videlec"
}
```

Indeed, if we can restrict to connected X and Y in the parition then it is much better! I was not expecting something that strong. However I do not see linearity coming in. There are many partitions X,Y of the vertices so that both induced graphs are connected.



---

archive/issue_comments_300958.json:
```json
{
    "body": "The algorithm works in general and is linear on trees!",
    "created_at": "2016-12-02T13:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300958",
    "user": "https://github.com/videlec"
}
```

The algorithm works in general and is linear on trees!



---

archive/issue_comments_300959.json:
```json
{
    "body": "I think the following algorithm works for trees:\n\nhttps://github.com/pelegm/iso",
    "created_at": "2016-12-02T14:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300959",
    "user": "https://github.com/pelegm"
}
```

I think the following algorithm works for trees:

https://github.com/pelegm/iso



---

archive/issue_comments_300960.json:
```json
{
    "body": "The algorithm now also finds Cheeger constant (and not only edge isoperimetric number) of trees.",
    "created_at": "2016-12-02T14:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300960",
    "user": "https://github.com/pelegm"
}
```

The algorithm now also finds Cheeger constant (and not only edge isoperimetric number) of trees.



---

archive/issue_comments_300961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-04T19:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300962.json:
```json
{
    "body": "1) You should test the case with 1 vertex.\n\n2) I fixed the backtracker in C. It is still available at `u/vdelecroix/cheeger`. It would be easy to adapt to the other constants.",
    "created_at": "2016-12-07T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300962",
    "user": "https://github.com/videlec"
}
```

1) You should test the case with 1 vertex.

2) I fixed the backtracker in C. It is still available at `u/vdelecroix/cheeger`. It would be easy to adapt to the other constants.



---

archive/issue_comments_300963.json:
```json
{
    "body": "rebased on 8.3.beta3\n\n---\nNew commits:",
    "created_at": "2018-05-28T15:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300963",
    "user": "https://github.com/videlec"
}
```

rebased on 8.3.beta3

---
New commits:



---

archive/issue_events_057854.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-28T15:34:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57854"
}
```



---

archive/issue_comments_300964.json:
```json
{
    "body": "TODO:\n\n- implement the backtracker for the 3 versions\n- use branch and bound (ie cut branches)",
    "created_at": "2018-05-28T15:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300964",
    "user": "https://github.com/videlec"
}
```

TODO:

- implement the backtracker for the 3 versions
- use branch and bound (ie cut branches)



---

archive/issue_comments_300965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-28T15:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_300966.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-28T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_300967.json:
```json
{
    "body": "Changing keywords from \"cheeger,isoperimetric,random walk,days79\" to \"cheeger, MathExp2018\".",
    "created_at": "2018-05-28T21:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300967",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "cheeger,isoperimetric,random walk,days79" to "cheeger, MathExp2018".



---

archive/issue_comments_300968.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-28T21:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300968",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_300969.json:
```json
{
    "body": "Thanks for all your work on this!\n\nThe code looks fine, testing a couple of cases on my machine works great, however, I cannot build the docs, but it seems like the issue is not with your new code (I get `[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12`).\n\nWould you call it a positive review?",
    "created_at": "2018-05-29T08:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300969",
    "user": "https://github.com/pelegm"
}
```

Thanks for all your work on this!

The code looks fine, testing a couple of cases on my machine works great, however, I cannot build the docs, but it seems like the issue is not with your new code (I get `[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12`).

Would you call it a positive review?



---

archive/issue_comments_300970.json:
```json
{
    "body": "Replying to [comment:39 pelegm]: \n> The code looks fine, testing a couple of cases on my machine works great, however, I cannot build the docs, but it seems like the issue is not with your new code (I get `[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12`).\n\n\nIt might be something on your computer. It looks fine with the patchbot as well as on my computer. Did you do a `make doc-clean` before building the doc?",
    "created_at": "2018-05-30T15:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300970",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:39 pelegm]: 
> The code looks fine, testing a couple of cases on my machine works great, however, I cannot build the docs, but it seems like the issue is not with your new code (I get `[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12`).


It might be something on your computer. It looks fine with the patchbot as well as on my computer. Did you do a `make doc-clean` before building the doc?



---

archive/issue_comments_300971.json:
```json
{
    "body": "This is how it looks like:\n\n```\npeleg@etti:develop:~/sage$ git fetch trac u/vdelecroix/21942\nFrom git://trac.sagemath.org/sage\n * branch                  u/vdelecroix/21942 -> FETCH_HEAD\npeleg@etti:develop:~/sage$ git checkout -b 21942 FETCH_HEAD \nSwitched to a new branch '21942'\npeleg@etti:21942:~/sage$ make doc-clean\n\n...\n\nSage build/upgrade complete!\npeleg@etti:21942:~/sage$ sage --docbuild reference/graphs html\n\n...\n\n[graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12\n\n...\n\n[graphs   ] WARNING: Error building the documentation.\n[graphs   ] Traceback (most recent call last):\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/runpy.py\", line 174, in _run_module_as_main\n[graphs   ]     \"__main__\", fname, loader, pkg_name)\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/runpy.py\", line 72, in _run_code\n[graphs   ]     exec code in run_globals\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[graphs   ]     main()\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1713, in main\n[graphs   ]     builder()\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 749, in _wrapper\n[graphs   ]     getattr(DocBuilder, build_type)(self, *args, **kwds)\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 130, in f\n[graphs   ]     runsphinx()\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py\", line 276, in runsphinx\n[graphs   ]     sys.stderr.raise_errors()\n[graphs   ]   File \"/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py\", line 216, in raise_errors\n[graphs   ]     raise OSError(self._error)\n[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12\n```",
    "created_at": "2018-05-31T05:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300971",
    "user": "https://github.com/pelegm"
}
```

This is how it looks like:

```
peleg@etti:develop:~/sage$ git fetch trac u/vdelecroix/21942
From git://trac.sagemath.org/sage
 * branch                  u/vdelecroix/21942 -> FETCH_HEAD
peleg@etti:develop:~/sage$ git checkout -b 21942 FETCH_HEAD 
Switched to a new branch '21942'
peleg@etti:21942:~/sage$ make doc-clean

...

Sage build/upgrade complete!
peleg@etti:21942:~/sage$ sage --docbuild reference/graphs html

...

[graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12

...

[graphs   ] WARNING: Error building the documentation.
[graphs   ] Traceback (most recent call last):
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/runpy.py", line 174, in _run_module_as_main
[graphs   ]     "__main__", fname, loader, pkg_name)
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/runpy.py", line 72, in _run_code
[graphs   ]     exec code in run_globals
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[graphs   ]     main()
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1713, in main
[graphs   ]     builder()
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 749, in _wrapper
[graphs   ]     getattr(DocBuilder, build_type)(self, *args, **kwds)
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 130, in f
[graphs   ]     runsphinx()
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 276, in runsphinx
[graphs   ]     sys.stderr.raise_errors()
[graphs   ]   File "/media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py", line 216, in raise_errors
[graphs   ]     raise OSError(self._error)
[graphs   ] OSError: [graphs   ] /media/peleg/peleg/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py:docstring of sage.combinat.designs.incidence_structures.IncidenceStructure.is_generalized_quadrangle:3: WARNING: citation not found: BH12
```



---

archive/issue_comments_300972.json:
```json
{
    "body": "After `make doc-clean` you should be using `make doc`.",
    "created_at": "2018-05-31T07:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300972",
    "user": "https://github.com/videlec"
}
```

After `make doc-clean` you should be using `make doc`.



---

archive/issue_comments_300973.json:
```json
{
    "body": "Works, thanks (took 2.5 hours, though...).\n\nSome minor suggestions:\n- In the cheeger constant docs, I'd replace `S(X)` with `Vol(X)` (it's a more common notation)\n- I'd add \"SEE ALSO\" sections from each of the isoperimetric constants to the others.\n\nOther than that, everything looks great. You may switch to positive review after you apply the suggestions, or if you decide not to apply them.",
    "created_at": "2018-05-31T12:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300973",
    "user": "https://github.com/pelegm"
}
```

Works, thanks (took 2.5 hours, though...).

Some minor suggestions:
- In the cheeger constant docs, I'd replace `S(X)` with `Vol(X)` (it's a more common notation)
- I'd add "SEE ALSO" sections from each of the isoperimetric constants to the others.

Other than that, everything looks great. You may switch to positive review after you apply the suggestions, or if you decide not to apply them.



---

archive/issue_comments_300974.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T14:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300974",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-31T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300975",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_300976.json:
```json
{
    "body": "Done!",
    "created_at": "2018-05-31T14:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300976",
    "user": "https://github.com/videlec"
}
```

Done!



---

archive/issue_comments_300977.json:
```json
{
    "body": "Reviewer name?",
    "created_at": "2018-05-31T18:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300977",
    "user": "https://github.com/vbraun"
}
```

Reviewer name?



---

archive/issue_comments_300978.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-31T18:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300978",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_300979.json:
```json
{
    "body": "Sorry",
    "created_at": "2018-06-01T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300979",
    "user": "https://github.com/videlec"
}
```

Sorry



---

archive/issue_comments_300980.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-06-01T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300980",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_300981.json:
```json
{
    "body": "Hi, I apologize for yet another late response, but just wanted to ask: for graphs without edges (and at least 2 vertices) you set the Cheeger constant to be 1.\n\nIt is correct that the constant is not well defined for graphs without edges, but still I would maybe set it to be 0, to be consistent with the general idea that larger Cheeger constant means higher connectivity, and the specific idea that non-connected graphs have Cheeger constant 0.\n\nIn fact, if you agree with this then we may add a quick heuristic at the beginning of the method, which checks whether the graph is connected, and returns 0 otherwise.",
    "created_at": "2018-06-01T08:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300981",
    "user": "https://github.com/pelegm"
}
```

Hi, I apologize for yet another late response, but just wanted to ask: for graphs without edges (and at least 2 vertices) you set the Cheeger constant to be 1.

It is correct that the constant is not well defined for graphs without edges, but still I would maybe set it to be 0, to be consistent with the general idea that larger Cheeger constant means higher connectivity, and the specific idea that non-connected graphs have Cheeger constant 0.

In fact, if you agree with this then we may add a quick heuristic at the beginning of the method, which checks whether the graph is connected, and returns 0 otherwise.



---

archive/issue_comments_300982.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-06-01T08:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300982",
    "user": "https://github.com/videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_300983.json:
```json
{
    "body": "I also agree that you should test that the input graph is connected.\n\nSome remarks:\n* Why not cythonizing method `vertex_isoperimetric_number` ? \n\n* in file `index.rst`, I think that the first initial of a ref needs a `\\`, like in `.. [ADKF1970] \\V. Arlazarov`\n\n* At the top of file `isoperimetric_inequalities.pyx`, you should add some words on the kind of methods that are in this file.\n\n* in `graph.py`, method `vertex_isoperimetric_number`: `and the sum is taken over the subsets` -> `and the minimum is taken over the subsets`\n\n* in method `cheeger_constant`, please add definition of `\\partial X`\n* similarly, in `edge_isoperimetric_number`, please define `\\partial S`",
    "created_at": "2018-06-02T09:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300983",
    "user": "https://github.com/dcoudert"
}
```

I also agree that you should test that the input graph is connected.

Some remarks:
* Why not cythonizing method `vertex_isoperimetric_number` ? 

* in file `index.rst`, I think that the first initial of a ref needs a `\`, like in `.. [ADKF1970] \V. Arlazarov`

* At the top of file `isoperimetric_inequalities.pyx`, you should add some words on the kind of methods that are in this file.

* in `graph.py`, method `vertex_isoperimetric_number`: `and the sum is taken over the subsets` -> `and the minimum is taken over the subsets`

* in method `cheeger_constant`, please add definition of `\partial X`
* similarly, in `edge_isoperimetric_number`, please define `\partial S`



---

archive/issue_comments_300984.json:
```json
{
    "body": "`    from sage.rings import infinity` -> `    from sage.rings.infinity import Infinity` or `    from sage.rings.infinity import infinity`, I don't know which is best.",
    "created_at": "2018-06-02T10:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300984",
    "user": "https://github.com/dcoudert"
}
```

`    from sage.rings import infinity` -> `    from sage.rings.infinity import Infinity` or `    from sage.rings.infinity import infinity`, I don't know which is best.



---

archive/issue_comments_300985.json:
```json
{
    "body": "For `vertex_isoperimetric_number`, it is not realistic to try to compute this value for large graphs. For up to 31 vertices, you can do in Cython:\n\n```\nfrom sage.graphs.graph_decompositions.fast_digraph cimport FastDigraph, compute_out_neighborhood_cardinality, popcount32\nfrom sage.rings.integer cimport Integer\n\ndef vertex_isoperimetric_number_fast(self):\n    \"\"\"\n    \"\"\"\n    cdef FastDigraph FG = FastDigraph(self)\n\n    cdef int card, boundary, S\n    cdef int mc = FG.n // 2\n    cdef int p = FG.n\n    cdef int q = 0\n    \n    for S in range(1, 2**FG.n):\n        card = popcount32(S)\n        if card <= mc:\n            boundary = compute_out_neighborhood_cardinality(FG, S)\n            if boundary * q < p * card:\n                p = boundary\n                q = card\n\n    return Integer(p) / Integer(q)\n```\nit iterates over all the non-empty subsets of vertices. `popcount32(S)` counts the number of `1`'s and so of vertices in the current subset `S`, and `compute_out_neighborhood_cardinality` computes the number of vertices in `N(S)\\S`.\n\n```\nsage: %time vertex_isoperimetric_number(G) # your method\nCPU times: user 4.36 ms, sys: 1.76 ms, total: 6.13 ms\nWall time: 9.11 ms\n3/2\nsage: G = graphs.CompleteGraph(5)\nsage: %time vertex_isoperimetric_number_fast(G)\nCPU times: user 83 \u00b5s, sys: 5 \u00b5s, total: 88 \u00b5s\nWall time: 88.9 \u00b5s\n3/2\n\nsage: G = graphs.CycleGraph(10)\nsage: %time vertex_isoperimetric_number_fast(G)\nCPU times: user 114 \u00b5s, sys: 17 \u00b5s, total: 131 \u00b5s\nWall time: 117 \u00b5s\n2/5\nsage: G = graphs.CycleGraph(20)\nsage: %time vertex_isoperimetric_number_fast(G)\nCPU times: user 34.7 ms, sys: 90 \u00b5s, total: 34.8 ms\nWall time: 34.8 ms\n1/5\nsage: G = graphs.CycleGraph(30)\nsage: %time vertex_isoperimetric_number_fast(G)\nCPU times: user 33.3 s, sys: 121 ms, total: 33.4 s\nWall time: 33.9 s\n2/15\n```\nWe can certainly do something similar for the other methods. We just need a smart way to compute `|\\partial X| / |Vol(X)|` and `|E(X)|` (which is not properly defined in the method) and `|\\partial S| / |S|`.\n\nIt is of course possible to add a parameter `k` to compute the value only over all subsets of order `k` (see https://en.wikipedia.org/wiki/Isoperimetric_inequality)",
    "created_at": "2018-06-02T10:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300985",
    "user": "https://github.com/dcoudert"
}
```

For `vertex_isoperimetric_number`, it is not realistic to try to compute this value for large graphs. For up to 31 vertices, you can do in Cython:

```
from sage.graphs.graph_decompositions.fast_digraph cimport FastDigraph, compute_out_neighborhood_cardinality, popcount32
from sage.rings.integer cimport Integer

def vertex_isoperimetric_number_fast(self):
    """
    """
    cdef FastDigraph FG = FastDigraph(self)

    cdef int card, boundary, S
    cdef int mc = FG.n // 2
    cdef int p = FG.n
    cdef int q = 0
    
    for S in range(1, 2**FG.n):
        card = popcount32(S)
        if card <= mc:
            boundary = compute_out_neighborhood_cardinality(FG, S)
            if boundary * q < p * card:
                p = boundary
                q = card

    return Integer(p) / Integer(q)
```
it iterates over all the non-empty subsets of vertices. `popcount32(S)` counts the number of `1`'s and so of vertices in the current subset `S`, and `compute_out_neighborhood_cardinality` computes the number of vertices in `N(S)\S`.

```
sage: %time vertex_isoperimetric_number(G) # your method
CPU times: user 4.36 ms, sys: 1.76 ms, total: 6.13 ms
Wall time: 9.11 ms
3/2
sage: G = graphs.CompleteGraph(5)
sage: %time vertex_isoperimetric_number_fast(G)
CPU times: user 83 µs, sys: 5 µs, total: 88 µs
Wall time: 88.9 µs
3/2

sage: G = graphs.CycleGraph(10)
sage: %time vertex_isoperimetric_number_fast(G)
CPU times: user 114 µs, sys: 17 µs, total: 131 µs
Wall time: 117 µs
2/5
sage: G = graphs.CycleGraph(20)
sage: %time vertex_isoperimetric_number_fast(G)
CPU times: user 34.7 ms, sys: 90 µs, total: 34.8 ms
Wall time: 34.8 ms
1/5
sage: G = graphs.CycleGraph(30)
sage: %time vertex_isoperimetric_number_fast(G)
CPU times: user 33.3 s, sys: 121 ms, total: 33.4 s
Wall time: 33.9 s
2/15
```
We can certainly do something similar for the other methods. We just need a smart way to compute `|\partial X| / |Vol(X)|` and `|E(X)|` (which is not properly defined in the method) and `|\partial S| / |S|`.

It is of course possible to add a parameter `k` to compute the value only over all subsets of order `k` (see https://en.wikipedia.org/wiki/Isoperimetric_inequality)



---

archive/issue_comments_300986.json:
```json
{
    "body": "I am not 100% convinced by `FastDigraph`:\n\n- why `FastDiagraph` is not merged with `base/static_dense_graph`? Both uses a bitset matrix and binary matrices are not limited to 32 vertices. Of course, if you have one limb you can perform some optimization but it would be nicer to have the same API (and use the same directory).\n\n- Using `int` might not be the best option. The library stdint proposes a `uint_fast32_t` that is exactly what you want here.\n\n- Many processors offer a `popcount` that `popcount32` is just ignoring.",
    "created_at": "2018-06-03T09:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300986",
    "user": "https://github.com/videlec"
}
```

I am not 100% convinced by `FastDigraph`:

- why `FastDiagraph` is not merged with `base/static_dense_graph`? Both uses a bitset matrix and binary matrices are not limited to 32 vertices. Of course, if you have one limb you can perform some optimization but it would be nicer to have the same API (and use the same directory).

- Using `int` might not be the best option. The library stdint proposes a `uint_fast32_t` that is exactly what you want here.

- Many processors offer a `popcount` that `popcount32` is just ignoring.



---

archive/issue_comments_300987.json:
```json
{
    "body": "With dense representation and bit operations one can indeed remove the inner loops from the already cythonized  `cheeger_constant` and `edge_isoperimetric_number`. On the other hand, these methods\n\n- perform incremental step in the construction of the subsets (so that updating volume/boundary is cheap)\n- do not go through all subsets but only through the one relevant to the definition (this is only a factor x2)",
    "created_at": "2018-06-03T09:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300987",
    "user": "https://github.com/videlec"
}
```

With dense representation and bit operations one can indeed remove the inner loops from the already cythonized  `cheeger_constant` and `edge_isoperimetric_number`. On the other hand, these methods

- perform incremental step in the construction of the subsets (so that updating volume/boundary is cheap)
- do not go through all subsets but only through the one relevant to the definition (this is only a factor x2)



---

archive/issue_comments_300988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-03T10:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_300989.json:
```json
{
    "body": "rebased on 8.3.beta4 + extra commit taking care of some of the remarks of David.",
    "created_at": "2018-06-03T10:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300989",
    "user": "https://github.com/videlec"
}
```

rebased on 8.3.beta4 + extra commit taking care of some of the remarks of David.



---

archive/issue_comments_300990.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-03T10:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300990",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_300991.json:
```json
{
    "body": "I'm not claiming that `FastDigraph` is perfect. It was useful for implementing vertex separation and cutwidth. It can certainly be cleaned/improved/etc. (e.g., using `__builtin_popcount` and `uint_fast32_t`). However, for such algorithms, the extra cost of using bitsets is not justified since we can hardly go above 32 nodes: huge computation time and memory usage.\\\\\nHere, if you think it is possible to compute the `vertex_isoperimetric_number` on larger graphs, then you can use `binary_matrix`. Another idea could be to use `short_digraph` and the same structure as for other methods, and maintain the vertices in the boundary (e.g., use an array to store the number of edges from `S` to each vertex outside `S`, and increase/decrease `vol` each time a cell becomes non-zero/zero).\n\nI did some tests using `static_dense_graph`, and so `binary_matrix`, for `cheeger_constant` and `edge_isoperimetric_number`. My code is slightly faster for dense graphs but slower for sparse graphs. Not so interesting here.\n\nThere are a small improvements you can do:\n- to update `vol` in `cheeger_constant`: use an array to store the degree of vertices, and then, instead of doing `vol += 1` inside the for loop, do `vol += degree[u]` outside.\n- add definition of `E(S)`. \n- have you tried maintaining the value `E(S)` ?\n- you use a bitset to maintain the set of vertices in the subgraph. Wouldn't it be faster to use an array of `bint` ? You don't use bitset operations here, and memory usage is clearly not an issue.",
    "created_at": "2018-06-03T11:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300991",
    "user": "https://github.com/dcoudert"
}
```

I'm not claiming that `FastDigraph` is perfect. It was useful for implementing vertex separation and cutwidth. It can certainly be cleaned/improved/etc. (e.g., using `__builtin_popcount` and `uint_fast32_t`). However, for such algorithms, the extra cost of using bitsets is not justified since we can hardly go above 32 nodes: huge computation time and memory usage.\\
Here, if you think it is possible to compute the `vertex_isoperimetric_number` on larger graphs, then you can use `binary_matrix`. Another idea could be to use `short_digraph` and the same structure as for other methods, and maintain the vertices in the boundary (e.g., use an array to store the number of edges from `S` to each vertex outside `S`, and increase/decrease `vol` each time a cell becomes non-zero/zero).

I did some tests using `static_dense_graph`, and so `binary_matrix`, for `cheeger_constant` and `edge_isoperimetric_number`. My code is slightly faster for dense graphs but slower for sparse graphs. Not so interesting here.

There are a small improvements you can do:
- to update `vol` in `cheeger_constant`: use an array to store the degree of vertices, and then, instead of doing `vol += 1` inside the for loop, do `vol += degree[u]` outside.
- add definition of `E(S)`. 
- have you tried maintaining the value `E(S)` ?
- you use a bitset to maintain the set of vertices in the subgraph. Wouldn't it be faster to use an array of `bint` ? You don't use bitset operations here, and memory usage is clearly not an issue.



---

archive/issue_comments_300992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-03T11:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300993.json:
```json
{
    "body": "I agree with your suggestions. Though, a much more needed improvement would be to be able to iterate through subsets `S` of vertices with `S` and `V \\ S` connected.",
    "created_at": "2018-06-03T11:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300993",
    "user": "https://github.com/videlec"
}
```

I agree with your suggestions. Though, a much more needed improvement would be to be able to iterate through subsets `S` of vertices with `S` and `V \ S` connected.



---

archive/issue_comments_300994.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-03T11:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300995.json:
```json
{
    "body": "An algorithm for iterating over connected subgraphs is described here https://stackoverflow.com/questions/15658245/efficiently-find-all-connected-induced-subgraphs. May be we can adapt it...\n\nAt least, it is possible to avoid the recursion and so to have a connected subgraph iterator. Not clear how to get an efficient implementation. I'll think about it.",
    "created_at": "2018-06-03T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300995",
    "user": "https://github.com/dcoudert"
}
```

An algorithm for iterating over connected subgraphs is described here https://stackoverflow.com/questions/15658245/efficiently-find-all-connected-induced-subgraphs. May be we can adapt it...

At least, it is possible to avoid the recursion and so to have a connected subgraph iterator. Not clear how to get an efficient implementation. I'll think about it.



---

archive/issue_comments_300996.json:
```json
{
    "body": "I have implemented an iterator over connected subgraphs is Cython. It is reasonably fast. I should open a ticket for it, but I don't know yet in which file to add it. Any suggestion ?\n\nIt can certainly help improving this ticket, although current implementations are quite good.",
    "created_at": "2018-06-03T18:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300996",
    "user": "https://github.com/dcoudert"
}
```

I have implemented an iterator over connected subgraphs is Cython. It is reasonably fast. I should open a ticket for it, but I don't know yet in which file to add it. Any suggestion ?

It can certainly help improving this ticket, although current implementations are quite good.



---

archive/issue_comments_300997.json:
```json
{
    "body": "Replying to [comment:62 dcoudert]:\n> I have implemented an iterator over connected subgraphs in Cython. It is reasonably fast. I should open a ticket for it, but I don't know yet in which file to add it. Any suggestion ?\n\n\n`connected_subgraphs_iterator.pyx`? Please, cc me.\n\n> It can certainly help improving this ticket, although current implementations are quite good. \n\n\nTo improve even more the computation of Cheeger constant, there should be an iterator over connected subgraph so that the complement is also connected! I can comment on this when your ticket is open.\n\nAre you ok setting this ticket in positive review as it is? It will serve as a base for further improvements.",
    "created_at": "2018-06-03T18:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300997",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:62 dcoudert]:
> I have implemented an iterator over connected subgraphs in Cython. It is reasonably fast. I should open a ticket for it, but I don't know yet in which file to add it. Any suggestion ?


`connected_subgraphs_iterator.pyx`? Please, cc me.

> It can certainly help improving this ticket, although current implementations are quite good. 


To improve even more the computation of Cheeger constant, there should be an iterator over connected subgraph so that the complement is also connected! I can comment on this when your ticket is open.

Are you ok setting this ticket in positive review as it is? It will serve as a base for further improvements.



---

archive/issue_comments_300998.json:
```json
{
    "body": "Note that I can easily factor `cheeger_constant` and `edge_isoperimetric_number` (exact same computation except the small difference for `vol`). It might be worth not duplicating code.",
    "created_at": "2018-06-03T18:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300998",
    "user": "https://github.com/videlec"
}
```

Note that I can easily factor `cheeger_constant` and `edge_isoperimetric_number` (exact same computation except the small difference for `vol`). It might be worth not duplicating code.



---

archive/issue_comments_300999.json:
```json
{
    "body": "Replying to [comment:64 vdelecroix]:\n> Note that I can easily factor `cheeger_constant` and `edge_isoperimetric_number` (exact same computation except the small difference for `vol`). It might be worth not duplicating code.\n\n\nWhat let me hesitate is that we can cut branches in the backtracking and when to cut will differ. What do you think?",
    "created_at": "2018-06-03T18:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-300999",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:64 vdelecroix]:
> Note that I can easily factor `cheeger_constant` and `edge_isoperimetric_number` (exact same computation except the small difference for `vol`). It might be worth not duplicating code.


What let me hesitate is that we can cut branches in the backtracking and when to cut will differ. What do you think?



---

archive/issue_comments_301000.json:
```json
{
    "body": "Do you plan to add cuts in a near future ? and is the current structure of the code appropriate to add cuts ? if not, you can factor the code.",
    "created_at": "2018-06-03T19:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301000",
    "user": "https://github.com/dcoudert"
}
```

Do you plan to add cuts in a near future ? and is the current structure of the code appropriate to add cuts ? if not, you can factor the code.



---

archive/issue_comments_301001.json:
```json
{
    "body": "Replying to [comment:66 dcoudert]:\n> Do you plan to add cuts in a near future ? and is the current structure of the code appropriate to add cuts ? if not, you can factor the code.\n\n\nAs my answers are \"no\" and \"no\" let me factor and add a note.",
    "created_at": "2018-06-03T19:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301001",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:66 dcoudert]:
> Do you plan to add cuts in a near future ? and is the current structure of the code appropriate to add cuts ? if not, you can factor the code.


As my answers are "no" and "no" let me factor and add a note.



---

archive/issue_comments_301002.json:
```json
{
    "body": "I spoke too fast: there are already two different cuts! By the definition of Cheeger constant, you cut when `Vol(s) > m` while for the isoperimetric number you cut `2*|S| > n` (where `m` and `n` are as usual number of edges and number of vertices).",
    "created_at": "2018-06-03T19:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301002",
    "user": "https://github.com/videlec"
}
```

I spoke too fast: there are already two different cuts! By the definition of Cheeger constant, you cut when `Vol(s) > m` while for the isoperimetric number you cut `2*|S| > n` (where `m` and `n` are as usual number of edges and number of vertices).



---

archive/issue_comments_301003.json:
```json
{
    "body": "Right.\n\nDon't forget to add `sig_on` `sig_off` so that we can kill computation if needed.",
    "created_at": "2018-06-03T21:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301003",
    "user": "https://github.com/dcoudert"
}
```

Right.

Don't forget to add `sig_on` `sig_off` so that we can kill computation if needed.



---

archive/issue_comments_301004.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-03T22:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301004",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301005.json:
```json
{
    "body": "I have a much better implementation for `vertex_isoperimetric_number` using the ideas from https://stackoverflow.com/questions/15658245/efficiently-find-all-connected-induced-subgraphs. You can use it on a multigraph with loops. No limit on the number of vertices, but of course the time complexity remains. \n\nRoughly, it uses a non-recursive version of the algorithm to generate all connected subgraphs of order at most `n/2`. I'm therefore using a binary matrix as a stack of bitsets.\n\n```\nfrom sage.rings.rational_field import QQ\nfrom sage.rings.infinity import Infinity\nfrom cysignals.signals cimport sig_on, sig_off\n\ninclude \"sage/data_structures/binary_matrix.pxi\"\nfrom sage.graphs.base.static_dense_graph cimport dense_graph_init\n\ndef vertex_isoperimetric_number_iter(G):\n    \"\"\"\n    \"\"\"\n    if G.is_directed():\n        raise ValueError(\"vertex-isoperimetric number is only defined on non-oriented graph\")\n    if G.order() == 0:\n        raise ValueError(\"vertex-isoperimetric number not defined for the empty graph\")\n    elif G.order() == 1:\n        return Infinity\n    elif not G.is_connected():\n        return QQ((0,1))\n\n    # We convert the graph to a static dense graph\n    cdef binary_matrix_t DG\n    dense_graph_init(DG, G)\n    cdef int n = G.order()\n    cdef int k = n / 2   # maximum size of a subset\n\n    sig_on()\n\n    # We use a stack of bitsets. For that, we need 3 bitsets per level with at\n    # most n/2 + 1 levels, so 3 * (n / 2) + 3 bitsets. We also need 1 bitset that\n    # we create at the same time, so so overall 3 * (n / 2) + 4 bitsets\n    cdef binary_matrix_t stack\n    binary_matrix_init(stack, 3 * (n / 2) + 4, n)\n\n    cdef bitset_t candidates = stack.rows[3 * (n / 2) + 3]\n    cdef bitset_t left     # vertices not yet explored\n    cdef bitset_t current  # vertices in the current subset\n    cdef bitset_t boundary # union of neighbors of vertices in current subset\n\n    cdef int l = 0\n    cdef int p = n\n    cdef int q = 0\n    cdef int c, b, v\n\n    # We initialize the first level\n    for v in range(3):\n        bitset_clear(stack.rows[v])\n    bitset_complement(stack.rows[0], stack.rows[0])\n\n    while l >= 0:\n\n        # We take the values at the top of the stack\n        left = stack.rows[l]\n        current = stack.rows[l + 1]\n        boundary = stack.rows[l + 2]\n\n        if bitset_isempty(current):\n            bitset_copy(candidates, left)\n        else:\n            bitset_and(candidates, left, boundary)\n\n        if bitset_isempty(candidates):\n            # We decrease l to pop the stack\n            l -= 3\n\n            # If the current set if non empty, we update the lower bound\n            c = bitset_len(current)\n            if c:\n                bitset_difference(boundary, boundary, current)\n                b = bitset_len(boundary)\n                if b * q < p * c:\n                    p = b\n                    q = c\n\n        else:\n            # Choose a candidate vertex v\n            v = bitset_first(candidates)\n            bitset_discard(left, v)\n\n            # Since we have not modified l, the bitsets for iterating without v\n            # in the subset current are now at the top of the stack, with \n            # correct values\n\n            if bitset_len(current) < k:\n                # We continue with v in the subset current\n                l += 3\n                bitset_copy(stack.rows[l], left)\n                bitset_copy(stack.rows[l + 1], current)\n                bitset_add(stack.rows[l + 1], v)\n                bitset_union(stack.rows[l + 2], boundary, DG.rows[v])\n\n    binary_matrix_free(stack)\n    binary_matrix_free(DG)\n    sig_off()\n\n    return QQ((p, q))\n```",
    "created_at": "2018-06-04T14:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301005",
    "user": "https://github.com/dcoudert"
}
```

I have a much better implementation for `vertex_isoperimetric_number` using the ideas from https://stackoverflow.com/questions/15658245/efficiently-find-all-connected-induced-subgraphs. You can use it on a multigraph with loops. No limit on the number of vertices, but of course the time complexity remains. 

Roughly, it uses a non-recursive version of the algorithm to generate all connected subgraphs of order at most `n/2`. I'm therefore using a binary matrix as a stack of bitsets.

```
from sage.rings.rational_field import QQ
from sage.rings.infinity import Infinity
from cysignals.signals cimport sig_on, sig_off

include "sage/data_structures/binary_matrix.pxi"
from sage.graphs.base.static_dense_graph cimport dense_graph_init

def vertex_isoperimetric_number_iter(G):
    """
    """
    if G.is_directed():
        raise ValueError("vertex-isoperimetric number is only defined on non-oriented graph")
    if G.order() == 0:
        raise ValueError("vertex-isoperimetric number not defined for the empty graph")
    elif G.order() == 1:
        return Infinity
    elif not G.is_connected():
        return QQ((0,1))

    # We convert the graph to a static dense graph
    cdef binary_matrix_t DG
    dense_graph_init(DG, G)
    cdef int n = G.order()
    cdef int k = n / 2   # maximum size of a subset

    sig_on()

    # We use a stack of bitsets. For that, we need 3 bitsets per level with at
    # most n/2 + 1 levels, so 3 * (n / 2) + 3 bitsets. We also need 1 bitset that
    # we create at the same time, so so overall 3 * (n / 2) + 4 bitsets
    cdef binary_matrix_t stack
    binary_matrix_init(stack, 3 * (n / 2) + 4, n)

    cdef bitset_t candidates = stack.rows[3 * (n / 2) + 3]
    cdef bitset_t left     # vertices not yet explored
    cdef bitset_t current  # vertices in the current subset
    cdef bitset_t boundary # union of neighbors of vertices in current subset

    cdef int l = 0
    cdef int p = n
    cdef int q = 0
    cdef int c, b, v

    # We initialize the first level
    for v in range(3):
        bitset_clear(stack.rows[v])
    bitset_complement(stack.rows[0], stack.rows[0])

    while l >= 0:

        # We take the values at the top of the stack
        left = stack.rows[l]
        current = stack.rows[l + 1]
        boundary = stack.rows[l + 2]

        if bitset_isempty(current):
            bitset_copy(candidates, left)
        else:
            bitset_and(candidates, left, boundary)

        if bitset_isempty(candidates):
            # We decrease l to pop the stack
            l -= 3

            # If the current set if non empty, we update the lower bound
            c = bitset_len(current)
            if c:
                bitset_difference(boundary, boundary, current)
                b = bitset_len(boundary)
                if b * q < p * c:
                    p = b
                    q = c

        else:
            # Choose a candidate vertex v
            v = bitset_first(candidates)
            bitset_discard(left, v)

            # Since we have not modified l, the bitsets for iterating without v
            # in the subset current are now at the top of the stack, with 
            # correct values

            if bitset_len(current) < k:
                # We continue with v in the subset current
                l += 3
                bitset_copy(stack.rows[l], left)
                bitset_copy(stack.rows[l + 1], current)
                bitset_add(stack.rows[l + 1], v)
                bitset_union(stack.rows[l + 2], boundary, DG.rows[v])

    binary_matrix_free(stack)
    binary_matrix_free(DG)
    sig_off()

    return QQ((p, q))
```



---

archive/issue_events_057855.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57855"
}
```



---

archive/issue_events_057856.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57856"
}
```



---

archive/issue_comments_301006.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301006",
    "user": "https://github.com/videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_301007.json:
```json
{
    "body": "Does not apply anymore.",
    "created_at": "2019-03-28T08:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301007",
    "user": "https://github.com/dkrenn"
}
```

Does not apply anymore.



---

archive/issue_comments_301008.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-28T08:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301008",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_057857.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-28T10:05:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57857"
}
```



---

archive/issue_events_057858.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-03-28T10:05:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57858"
}
```



---

archive/issue_comments_301009.json:
```json
{
    "body": "Note that we now have a connected subgraph iterator #25553.",
    "created_at": "2019-03-28T10:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301009",
    "user": "https://github.com/dcoudert"
}
```

Note that we now have a connected subgraph iterator #25553.



---

archive/issue_comments_301010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-03-31T17:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_301011.json:
```json
{
    "body": "(just a rebase, need to adapt the code to use the connected subgraph iterator)",
    "created_at": "2019-03-31T17:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301011",
    "user": "https://github.com/videlec"
}
```

(just a rebase, need to adapt the code to use the connected subgraph iterator)



---

archive/issue_comments_301012.json:
```json
{
    "body": "`@`dcoudert: I would be happy to use the subgraph iterator from #25553 however\n- it is only implemented for dense graphs\n- the iterator carries many information that would be extremely useful for implementing isoperimetric constants (such as boundary)\n- passing around lists of vertices (the output of the iterator) is a big waste\n\nOne possible way to proceed is to make a proper Cython class for the subgraph iterator so that we can grab information (at C level) at each step of the iteration.\n\nWhat do you think?",
    "created_at": "2019-03-31T17:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301012",
    "user": "https://github.com/videlec"
}
```

`@`dcoudert: I would be happy to use the subgraph iterator from #25553 however
- it is only implemented for dense graphs
- the iterator carries many information that would be extremely useful for implementing isoperimetric constants (such as boundary)
- passing around lists of vertices (the output of the iterator) is a big waste

One possible way to proceed is to make a proper Cython class for the subgraph iterator so that we can grab information (at C level) at each step of the iteration.

What do you think?



---

archive/issue_comments_301013.json:
```json
{
    "body": "Replying to [comment:79 vdelecroix]:\n> `@`dcoudert: I would be happy to use the subgraph iterator from #25553 however\n> - it is only implemented for dense graphs\n\n\nIt's reasonably fast this way :P But of course we could implement a sparse graph counter part.\n\n> - the iterator carries many information that would be extremely useful for implementing isoperimetric constants (such as boundary)\n> - passing around lists of vertices (the output of the iterator) is a big waste\n> One possible way to proceed is to make a proper Cython class for the subgraph iterator so that we can grab information (at C level) at each step of the iteration.\n> \n> What do you think?\n\n\nWe can certainly add such a class if it's needed. However, you have to be very careful if you want to access extra data. May be it's easier to copy/paste the code of the iterator, so that you can use the information you want safely at the time you need it.\nThe advantage of the class is to silently switch between sparse and dense representations.",
    "created_at": "2019-03-31T18:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301013",
    "user": "https://github.com/dcoudert"
}
```

Replying to [comment:79 vdelecroix]:
> `@`dcoudert: I would be happy to use the subgraph iterator from #25553 however
> - it is only implemented for dense graphs


It's reasonably fast this way :P But of course we could implement a sparse graph counter part.

> - the iterator carries many information that would be extremely useful for implementing isoperimetric constants (such as boundary)
> - passing around lists of vertices (the output of the iterator) is a big waste
> One possible way to proceed is to make a proper Cython class for the subgraph iterator so that we can grab information (at C level) at each step of the iteration.
> 
> What do you think?


We can certainly add such a class if it's needed. However, you have to be very careful if you want to access extra data. May be it's easier to copy/paste the code of the iterator, so that you can use the information you want safely at the time you need it.
The advantage of the class is to silently switch between sparse and dense representations.



---

archive/issue_events_057859.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57859"
}
```



---

archive/issue_events_057860.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57860"
}
```



---

archive/issue_comments_301014.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301014",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_301015.json:
```json
{
    "body": "Moving to 9.0. We can also work on a proper cython class for subgraph iterator if useful.",
    "created_at": "2019-10-07T10:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301015",
    "user": "https://github.com/dcoudert"
}
```

Moving to 9.0. We can also work on a proper cython class for subgraph iterator if useful.



---

archive/issue_events_057861.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-10-07T10:22:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57861"
}
```



---

archive/issue_events_057862.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-10-07T10:22:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57862"
}
```



---

archive/issue_comments_301016.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301016",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_057863.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57863"
}
```



---

archive/issue_events_057864.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57864"
}
```



---

archive/issue_events_057865.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57865"
}
```



---

archive/issue_events_057866.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57866"
}
```



---

archive/issue_comments_301017.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301017",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_301018.json:
```json
{
    "body": "There is some interest for this code : https://ask.sagemath.org/question/52410/edge-isoperimetric-number/\n\nI have rebased the branch\n\n---\nNew commits:",
    "created_at": "2020-07-11T06:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301018",
    "user": "https://github.com/fchapoton"
}
```

There is some interest for this code : https://ask.sagemath.org/question/52410/edge-isoperimetric-number/

I have rebased the branch

---
New commits:



---

archive/issue_comments_301019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-11T06:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301020.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-11T09:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-11T09:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301022.json:
```json
{
    "body": "I changed the code of vertex isoperimetric number. The new code is way faster on sparse graphs and can handle (multi-) graphs of any size. Of course, the running time can be significant on large graphs.\n\n```\nsage: G = graphs.Grid2dGraph(5,6)\nsage: %time G.vertex_isoperimetric_number()\nCPU times: user 328 ms, sys: 712 \u00b5s, total: 329 ms\nWall time: 329 ms\n1/3\nsage: G = graphs.Grid2dGraph(6, 6)\nsage: %time G.vertex_isoperimetric_number()\nCPU times: user 9.25 s, sys: 24.6 ms, total: 9.28 s\nWall time: 9.28 s\n1/3\nsage: G = graphs.CompleteGraph(10)\nsage: %time G.vertex_isoperimetric_number()\nCPU times: user 254 \u00b5s, sys: 4 \u00b5s, total: 258 \u00b5s\nWall time: 264 \u00b5s\n1\nsage: G = graphs.CompleteGraph(20)\nsage: %time G.vertex_isoperimetric_number()\nCPU times: user 32.3 ms, sys: 185 \u00b5s, total: 32.5 ms\nWall time: 32.5 ms\n1\nsage: G = graphs.CompleteGraph(30)\nsage: %time G.vertex_isoperimetric_number()\nCPU times: user 31.8 s, sys: 111 ms, total: 31.9 s\nWall time: 32 s\n1\n```",
    "created_at": "2020-07-11T09:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301022",
    "user": "https://github.com/dcoudert"
}
```

I changed the code of vertex isoperimetric number. The new code is way faster on sparse graphs and can handle (multi-) graphs of any size. Of course, the running time can be significant on large graphs.

```
sage: G = graphs.Grid2dGraph(5,6)
sage: %time G.vertex_isoperimetric_number()
CPU times: user 328 ms, sys: 712 µs, total: 329 ms
Wall time: 329 ms
1/3
sage: G = graphs.Grid2dGraph(6, 6)
sage: %time G.vertex_isoperimetric_number()
CPU times: user 9.25 s, sys: 24.6 ms, total: 9.28 s
Wall time: 9.28 s
1/3
sage: G = graphs.CompleteGraph(10)
sage: %time G.vertex_isoperimetric_number()
CPU times: user 254 µs, sys: 4 µs, total: 258 µs
Wall time: 264 µs
1
sage: G = graphs.CompleteGraph(20)
sage: %time G.vertex_isoperimetric_number()
CPU times: user 32.3 ms, sys: 185 µs, total: 32.5 ms
Wall time: 32.5 ms
1
sage: G = graphs.CompleteGraph(30)
sage: %time G.vertex_isoperimetric_number()
CPU times: user 31.8 s, sys: 111 ms, total: 31.9 s
Wall time: 32 s
1
```



---

archive/issue_comments_301023.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-11T09:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301023",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_301024.json:
```json
{
    "body": "For me this patch is good to go as is and we can let possible improvements for future tickets like:\n- algorithms for specific graph classes such as trees (#comment:28) or cliques\n- make a class for connected subgraphs iterator and use it to speed up / simplify some parts (#comment:59)\n\nI'm a bit lost in who should be in authors or reviewers or both...",
    "created_at": "2020-07-11T10:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301024",
    "user": "https://github.com/dcoudert"
}
```

For me this patch is good to go as is and we can let possible improvements for future tickets like:
- algorithms for specific graph classes such as trees (#comment:28) or cliques
- make a class for connected subgraphs iterator and use it to speed up / simplify some parts (#comment:59)

I'm a bit lost in who should be in authors or reviewers or both...



---

archive/issue_comments_301025.json:
```json
{
    "body": "On peut faire comme \u00e7a, par exemple. Tu peux te rajouter comme rapporteur si tu veux.",
    "created_at": "2020-07-13T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301025",
    "user": "https://github.com/fchapoton"
}
```

On peut faire comme ça, par exemple. Tu peux te rajouter comme rapporteur si tu veux.



---

archive/issue_comments_301026.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-13T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301026",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301027.json:
```json
{
    "body": "C'est tr\u00e8s bien comme \u00e7a. Thanks.",
    "created_at": "2020-07-13T08:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301027",
    "user": "https://github.com/dcoudert"
}
```

C'est très bien comme ça. Thanks.



---

archive/issue_events_057867.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-19T07:24:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21942#event-57867"
}
```



---

archive/issue_comments_301028.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-19T07:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21942#issuecomment-301028",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
