# Issue 21776: Galois representations over number fields speedup

archive/issues_021539.json:
```json
{
    "body": "The code for computing Galois representations of elliptic curves over number fields (which is used in isogeny computation) uses the default iterator over primes of degree 1 in the number field.  Two problems: first, the method K.primes_of_degree_one_iter() only gives primes up to some norm bound, and that is not always large enough if left at the default.  Second, where the function is used only principal primes are wanted but the iterator starts at 2 wheras there are no principal primes of norm less than discriminant/4!\n\nI put in a custom iterator which helps a lot.\n\nI will upload a patch when I have recovered an example which fails badly.\n\nKeywords: Galois representations\n\nBranch/Commit: 7ca67b08b99e9a538633bc2df9a388755b6e74a4\n\nReviewer: Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21776\n\n",
    "closed_at": "2016-11-17T18:01:57Z",
    "created_at": "2016-10-27T15:39:49Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Galois representations over number fields speedup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21776",
    "user": "https://github.com/JohnCremona"
}
```
The code for computing Galois representations of elliptic curves over number fields (which is used in isogeny computation) uses the default iterator over primes of degree 1 in the number field.  Two problems: first, the method K.primes_of_degree_one_iter() only gives primes up to some norm bound, and that is not always large enough if left at the default.  Second, where the function is used only principal primes are wanted but the iterator starts at 2 wheras there are no principal primes of norm less than discriminant/4!

I put in a custom iterator which helps a lot.

I will upload a patch when I have recovered an example which fails badly.

Keywords: Galois representations

Branch/Commit: 7ca67b08b99e9a538633bc2df9a388755b6e74a4

Reviewer: Travis Scrimshaw, Frédéric Chapoton

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21776





---

archive/issue_comments_318173.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-10-27T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318173",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_318174.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-27T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318174",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318175.json:
```json
{
    "body": "<a id='comment:2'></a>Two small things:\n\n```diff\n-    for l in D:\n+    for l in D.iterkeys():\n```\nThis change is unnecessary as the iteration over a dictionary is the keys (and `iterkeys` is going away in Python3).\nAlso, `xrange` is going away in Python3, so you should revert that change because the `from six.moves import range` already makes `range` an iterator, not a list.",
    "created_at": "2016-10-27T16:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318175",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Two small things:

```diff
-    for l in D:
+    for l in D.iterkeys():
```
This change is unnecessary as the iteration over a dictionary is the keys (and `iterkeys` is going away in Python3).
Also, `xrange` is going away in Python3, so you should revert that change because the `from six.moves import range` already makes `range` an iterator, not a list.



---

archive/issue_comments_318176.json:
```json
{
    "body": "<a id='comment:3'></a>Thanks, will do.  I have no idea why I put in the iterkeys().",
    "created_at": "2016-10-27T16:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318176",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>Thanks, will do.  I have no idea why I put in the iterkeys().



---

archive/issue_comments_318177.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-27T16:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318178.json:
```json
{
    "body": "<a id='comment:5'></a>You should add documentation to the new \"deg_one_prime_iter\" function.",
    "created_at": "2016-11-02T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318178",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>You should add documentation to the new "deg_one_prime_iter" function.



---

archive/issue_comments_318179.json:
```json
{
    "body": "<a id='comment:6'></a>OK, I am working on this.",
    "created_at": "2016-11-06T13:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318179",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>OK, I am working on this.



---

archive/issue_comments_318180.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-06T13:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318180",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_318181.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-08T12:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318182.json:
```json
{
    "body": "<a id='comment:8'></a>Docstring and test added.",
    "created_at": "2016-11-08T12:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318182",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>Docstring and test added.



---

archive/issue_comments_318183.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-08T12:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318183",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318184.json:
```json
{
    "body": "<a id='comment:9'></a>Looking at the `primes` documentation, it says you can pass `oo` as the second argument. So I removed the `maxnorm` argument. I also did a few cosmetic changes. If you agree with my changes, then you can set a positive review.\n\n---\nNew commits:",
    "created_at": "2016-11-08T15:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318184",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Looking at the `primes` documentation, it says you can pass `oo` as the second argument. So I removed the `maxnorm` argument. I also did a few cosmetic changes. If you agree with my changes, then you can set a positive review.

---
New commits:



---

archive/issue_comments_318185.json:
```json
{
    "body": "<a id='comment:10'></a>it.next() is not python3 compatible, use next(it) instead",
    "created_at": "2016-11-08T18:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318185",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>it.next() is not python3 compatible, use next(it) instead



---

archive/issue_comments_318186.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-08T20:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318187.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 chapoton]:\n> it.next() is not python3 compatible, use next(it) instead\n\n\nI did not know that -- and in fact one thing I had done was to make the reverse change, thinking it was somehow more efficient.  Thanks.\n\nI am happy with the changes since my commits.  What next?",
    "created_at": "2016-11-09T09:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318187",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:12'></a>Replying to [comment:10 chapoton]:
> it.next() is not python3 compatible, use next(it) instead


I did not know that -- and in fact one thing I had done was to make the reverse change, thinking it was somehow more efficient.  Thanks.

I am happy with the changes since my commits.  What next?



---

archive/issue_comments_318188.json:
```json
{
    "body": "<a id='comment:13'></a>doc does not build,  EXAMPLES: should be  EXAMPLES::",
    "created_at": "2016-11-09T11:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318188",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>doc does not build,  EXAMPLES: should be  EXAMPLES::



---

archive/issue_comments_318189.json:
```json
{
    "body": "<a id='comment:14'></a>OK, I'll fix that and put it back into my branch... (building docs takes such a long time it discourages proper testing!)",
    "created_at": "2016-11-09T12:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318189",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>OK, I'll fix that and put it back into my branch... (building docs takes such a long time it discourages proper testing!)



---

archive/issue_comments_318190.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-09T15:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_318191.json:
```json
{
    "body": "<a id='comment:16'></a>I just took care of it. (Partial doc builds can help for this kind of testing.) Feel free to put your branch if you make other changes.",
    "created_at": "2016-11-09T15:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318191",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>I just took care of it. (Partial doc builds can help for this kind of testing.) Feel free to put your branch if you make other changes.



---

archive/issue_comments_318192.json:
```json
{
    "body": "<a id='comment:17'></a>ok, looks good enough.",
    "created_at": "2016-11-13T09:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318192",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>ok, looks good enough.



---

archive/issue_comments_318193.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-13T09:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318193",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057607.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-17T18:01:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21776#event-57607"
}
```



---

archive/issue_comments_318194.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-17T18:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21776",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21776#issuecomment-318194",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
