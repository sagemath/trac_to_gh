# Issue 21725: Infrastructure for conversions of Sage number types for external Cython/Python packages (fpylll, pypolymake, ...)

archive/issues_021488.json:
```json
{
    "assignees": [],
    "body": "There is a current trend to develop Cython libraries as separate packages, rather than as part of Sage.\n\nMany of these libraries take numbers of various kinds as input or produce them as output.\n\nIt would be nice if these Cython libraries could do conversions from/to Sage number types. Otherwise, on the Sage side we would have to provide a separate wrapper around the Cython wrapper. \n\nCurrently, this leads to \n- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU) and #21728) and to \n- duplication of effort (for example, PyPolymake and its GMP wrappers)\n\nWe need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.\n\n\n\n\nCC:  @malb @jdemeyer @videlec @infinity0 @mezzarobba tmonteil @dimpase @slel @defeo Winfried\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21725_\n\n",
    "closed_at": "2018-02-06T11:33:45Z",
    "created_at": "2016-10-19T00:29:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Infrastructure for conversions of Sage number types for external Cython/Python packages (fpylll, pypolymake, ...)",
    "type": "issue",
    "updated_at": "2018-02-06T11:33:45Z",
    "url": "https://github.com/sagemath/sage/issues/21725",
    "user": "https://github.com/mkoeppe"
}
```
There is a current trend to develop Cython libraries as separate packages, rather than as part of Sage.

Many of these libraries take numbers of various kinds as input or produce them as output.

It would be nice if these Cython libraries could do conversions from/to Sage number types. Otherwise, on the Sage side we would have to provide a separate wrapper around the Cython wrapper. 

Currently, this leads to 
- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU) and #21728) and to 
- duplication of effort (for example, PyPolymake and its GMP wrappers)

We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.




CC:  @malb @jdemeyer @videlec @infinity0 @mezzarobba tmonteil @dimpase @slel @defeo Winfried

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/21725_





---

archive/issue_events_286902.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-19T00:29:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286902"
}
```



---

archive/issue_events_286903.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-19T00:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286903"
}
```



---

archive/issue_events_286904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-19T06:12:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286904"
}
```



---

archive/issue_comments_322008.json:
```json
{
    "body": "Replying to [ticket:21725 mkoeppe]:\n> We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.\n\nThat's not going to happen.",
    "created_at": "2016-10-19T06:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322008",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:21725 mkoeppe]:
> We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.

That's not going to happen.



---

archive/issue_events_286905.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-19T06:12:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286905"
}
```



---

archive/issue_events_286906.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-19T06:12:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286906"
}
```



---

archive/issue_events_286907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-19T06:12:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286907"
}
```



---

archive/issue_comments_322009.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nIf a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a \u201cwell-known\u201d C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location? This would at least make it possible to exchange multiple-precision numbers with sage without build-depending on it.",
    "created_at": "2016-10-19T06:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322009",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:3'>Comment 3:</a>
If a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a “well-known” C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location? This would at least make it possible to exchange multiple-precision numbers with sage without build-depending on it.



---

archive/issue_comments_322010.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@jdemeyer](#comment%3A2):\n> Replying to [ticket:21725 mkoeppe]:\n> > We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.\n\n> \n> That's not going to happen.\n\nHow do you know?",
    "created_at": "2016-10-19T06:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322010",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@jdemeyer](#comment%3A2):
> Replying to [ticket:21725 mkoeppe]:
> > We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.

> 
> That's not going to happen.

How do you know?



---

archive/issue_events_286908.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-19T06:27:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286908"
}
```



---

archive/issue_comments_322011.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI mean, how could it ever be possible to convert something to Sage types (I assume you mean with an efficient C interface) without depending on Sage?",
    "created_at": "2016-10-19T06:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322011",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
I mean, how could it ever be possible to convert something to Sage types (I assume you mean with an efficient C interface) without depending on Sage?



---

archive/issue_comments_322012.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@mezzarobba](#comment%3A3):\n> If a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a \u201cwell-known\u201d C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location?\n\nSage types already have such an interface using Cython. So you want to add something like add using a Python interface? I presume using a `PyCapsule`?\n\nTo be honest, I don't really understand the use case for this ticket. Why would you want to convert something to Sage without depending on Sage?",
    "created_at": "2016-10-19T06:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322012",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@mezzarobba](#comment%3A3):
> If a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a “well-known” C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location?

Sage types already have such an interface using Cython. So you want to add something like add using a Python interface? I presume using a `PyCapsule`?

To be honest, I don't really understand the use case for this ticket. Why would you want to convert something to Sage without depending on Sage?



---

archive/issue_comments_322013.json:
```json
{
    "body": "Replying to [ticket:21725 mkoeppe]:\n> - duplication of effort (for example, PyPolymake and its GMP wrappers)\n\nCan you elaborate on this?",
    "created_at": "2016-10-19T07:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322013",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:21725 mkoeppe]:
> - duplication of effort (for example, PyPolymake and its GMP wrappers)

Can you elaborate on this?



---

archive/issue_comments_322014.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nFor example, it would not seem so hard to provide a C library with a minimal interface such as\n\n```\nint mpz_from_python_integer(mpz_t target, PyObject *object)\n```\nthat fills `target` with a GMP integer converted from `object`\nand returns an error code if it can't.\n\nBy default (in plain Python), it would only deal with Python integers.\n\nBut libraries that provide new integer types such as sagelib can hook into this, for example by defining a method or any other of Python's dynamic mechanisms.\n\n\nFor the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...)",
    "created_at": "2016-10-19T07:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
For example, it would not seem so hard to provide a C library with a minimal interface such as

```
int mpz_from_python_integer(mpz_t target, PyObject *object)
```
that fills `target` with a GMP integer converted from `object`
and returns an error code if it can't.

By default (in plain Python), it would only deal with Python integers.

But libraries that provide new integer types such as sagelib can hook into this, for example by defining a method or any other of Python's dynamic mechanisms.


For the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...)



---

archive/issue_comments_322015.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@jdemeyer](#comment%3A8):\n> Replying to [ticket:21725 mkoeppe]:\n> > - duplication of effort (for example, PyPolymake and its GMP wrappers)\n\n> \n> Can you elaborate on this?\n\nVarious libraries that I am currently interested in (polymake, normaliz) need Cython wrappers, which should be usable with or without Sage. The interfaces are using integers (and integer vectors, matrices, and more complicated structures) - and one should be able to request Python integers or Sage integers from the Cython wrapper. \nHowever, it should definitely not build-depend on sagelib (because we will need the opposite dependency -- sagelib will have to build-depend on pyPolymake, pyNormaliz etc.)",
    "created_at": "2016-10-19T07:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322015",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@jdemeyer](#comment%3A8):
> Replying to [ticket:21725 mkoeppe]:
> > - duplication of effort (for example, PyPolymake and its GMP wrappers)

> 
> Can you elaborate on this?

Various libraries that I am currently interested in (polymake, normaliz) need Cython wrappers, which should be usable with or without Sage. The interfaces are using integers (and integer vectors, matrices, and more complicated structures) - and one should be able to request Python integers or Sage integers from the Cython wrapper. 
However, it should definitely not build-depend on sagelib (because we will need the opposite dependency -- sagelib will have to build-depend on pyPolymake, pyNormaliz etc.)



---

archive/issue_comments_322016.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@mkoeppe](#comment%3A9):\n> For the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...) \n\nFor example C library prototype:\n\n```\nPyObject *mpz_to_python_integer(mpz_t source, PyObject *output_type)\n```",
    "created_at": "2016-10-19T07:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322016",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@mkoeppe](#comment%3A9):
> For the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...) 

For example C library prototype:

```
PyObject *mpz_to_python_integer(mpz_t source, PyObject *output_type)
```



---

archive/issue_comments_322017.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@mkoeppe](#comment%3A11):\n> Replying to [@mkoeppe](#comment%3A9):\n> > For the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...) \n\n> \n> For example C library prototype:\n> \n> ```\n> PyObject *mpz_to_python_integer(mpz_t source, PyObject *output_type)\n> ```\n> \n\nThis is exactly the kind of thing I am fighting with in pypolymake. Actually pypolymake could easily provide a function to set the interface\n\n```\nint set_pypolymake_mpz_wrapper((PyObject *) (mpz_t, PyObject *))\n```\nI am not sure what is the best approach here but +1 for having a standardized and Sage agnostic way of doing it! I am available to test as many approaches as suggested within pypolymake. \n\nNote that we might want to do that for many basic types (integer, rational, floating point real and complexes, Zmodn, matrices, polynomials, ...). And this explosion might become a nightmare.",
    "created_at": "2016-10-19T08:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322017",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@mkoeppe](#comment%3A11):
> Replying to [@mkoeppe](#comment%3A9):
> > For the opposite conversion, for converting to the Python/Sage world, one would pass an extra argument to the wrapped function that indicates the type of output (Python integer? Sage integer? ...) 

> 
> For example C library prototype:
> 
> ```
> PyObject *mpz_to_python_integer(mpz_t source, PyObject *output_type)
> ```
> 

This is exactly the kind of thing I am fighting with in pypolymake. Actually pypolymake could easily provide a function to set the interface

```
int set_pypolymake_mpz_wrapper((PyObject *) (mpz_t, PyObject *))
```
I am not sure what is the best approach here but +1 for having a standardized and Sage agnostic way of doing it! I am available to test as many approaches as suggested within pypolymake. 

Note that we might want to do that for many basic types (integer, rational, floating point real and complexes, Zmodn, matrices, polynomials, ...). And this explosion might become a nightmare.



---

archive/issue_comments_322018.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@mkoeppe](#comment%3A9):\n> For example, it would not seem so hard to provide a C library\n\nI hope that you mean a Python module and not a C library. Libraries are a pain in Python.\n\nOne thing we really need to consider is efficiency. We already have plenty of slow ways to do what you want (e.g. for integers we can go via Python ints, for other types we could use strings). So I would like a solution which is implementable 100% in Cython (in particular, there should be no Python methods/attributes involved).",
    "created_at": "2016-10-19T08:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322018",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@mkoeppe](#comment%3A9):
> For example, it would not seem so hard to provide a C library

I hope that you mean a Python module and not a C library. Libraries are a pain in Python.

One thing we really need to consider is efficiency. We already have plenty of slow ways to do what you want (e.g. for integers we can go via Python ints, for other types we could use strings). So I would like a solution which is implementable 100% in Cython (in particular, there should be no Python methods/attributes involved).



---

archive/issue_events_286909.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-19T08:12:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286909"
}
```



---

archive/issue_comments_322019.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThere is this thing: https://pypi.python.org/pypi/gmpy2 which provides an interface to GMP and MPFR. It implements wrappers around the GMP/MPFR types, so it could probably be used to pass around `mpz_t` pointers.\n\nI don't think it was created with this use case in mind, but I still think that this could be a good starting point. We obviously would need to add a Cython interface.",
    "created_at": "2016-10-19T08:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322019",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
There is this thing: https://pypi.python.org/pypi/gmpy2 which provides an interface to GMP and MPFR. It implements wrappers around the GMP/MPFR types, so it could probably be used to pass around `mpz_t` pointers.

I don't think it was created with this use case in mind, but I still think that this could be a good starting point. We obviously would need to add a Cython interface.



---

archive/issue_comments_322020.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@jdemeyer](#comment%3A7):\n> Replying to [@mezzarobba](#comment%3A3):\n> > If a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a \u201cwell-known\u201d C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location?\n\n> \n> Sage types already have such an interface using Cython. So you want to add something like add using a Python interface? I presume using a `PyCapsule`?\n\nYes, something like that. Or perhaps the buffer protocol, if that's more convenient for some reason? Or even by asking the caller to pass an instance of Python extension class of a certain fixed form...\n\n> To be honest, I don't really understand the use case for this ticket. Why would you want to convert something to Sage without depending on Sage?\n\nMore or less for the same reason as the Debian packagers: to make it possible for Python interfaces to software using GMP, MPFR & co to be used in conjunction with Sage without necessarily being compiled with Sage support. For example, I am involved in a research project for which we developed a Python interface to [Sollya](http://sollya.gforge.inria.fr). In most cases, this interface is used to call Sollya from pure Python programs. In this mode, all computations with multiple-precision types (Sollya is based on MPFI) are done by the Sollya library and stay there. However, occasionally, it is also very useful to write code that uses both Sollya and Sage, and passes MPFI intervals back and forth. Currently, in order to do that, we need either to somehow encode these intervals as Python objects, or to build the interface in a special mode with Sage support. Now, the Python-Sollya interface is semi-private code with about four users, so that's not much of an issue for us. But if we were to clean it up and distribute it, supporting both modes would cause all kinds of headaches for no good reason.\n\nI don't think it is reasonable to move the Sage number types to an external package, if only because the Sage library is full of circular dependencies between modules. (And I don't see how to have conversions that don't go through Python at all without doing something like that...) However, I don't see the problem with trying to standardize a way to exchange, say, GMP, MPFR, MPFI, and perhaps FLINT/Arb objects between Python libraries (as originally suggested), or at least having an ad hoc solution to import/export these kinds of objects to/from Sage (as suggested in my comment).",
    "created_at": "2016-10-19T08:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322020",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@jdemeyer](#comment%3A7):
> Replying to [@mezzarobba](#comment%3A3):
> > If a Python call + a copy per number conversion it not too high a price to pay, then perhaps sage objects backed by a “well-known” C library could provide an interface that would make them read/write an `mpz_t` (resp. `mpq_t`, `mpfr_t`, `mpfi_t`...) from/to a specified location?

> 
> Sage types already have such an interface using Cython. So you want to add something like add using a Python interface? I presume using a `PyCapsule`?

Yes, something like that. Or perhaps the buffer protocol, if that's more convenient for some reason? Or even by asking the caller to pass an instance of Python extension class of a certain fixed form...

> To be honest, I don't really understand the use case for this ticket. Why would you want to convert something to Sage without depending on Sage?

More or less for the same reason as the Debian packagers: to make it possible for Python interfaces to software using GMP, MPFR & co to be used in conjunction with Sage without necessarily being compiled with Sage support. For example, I am involved in a research project for which we developed a Python interface to [Sollya](http://sollya.gforge.inria.fr). In most cases, this interface is used to call Sollya from pure Python programs. In this mode, all computations with multiple-precision types (Sollya is based on MPFI) are done by the Sollya library and stay there. However, occasionally, it is also very useful to write code that uses both Sollya and Sage, and passes MPFI intervals back and forth. Currently, in order to do that, we need either to somehow encode these intervals as Python objects, or to build the interface in a special mode with Sage support. Now, the Python-Sollya interface is semi-private code with about four users, so that's not much of an issue for us. But if we were to clean it up and distribute it, supporting both modes would cause all kinds of headaches for no good reason.

I don't think it is reasonable to move the Sage number types to an external package, if only because the Sage library is full of circular dependencies between modules. (And I don't see how to have conversions that don't go through Python at all without doing something like that...) However, I don't see the problem with trying to standardize a way to exchange, say, GMP, MPFR, MPFI, and perhaps FLINT/Arb objects between Python libraries (as originally suggested), or at least having an ad hoc solution to import/export these kinds of objects to/from Sage (as suggested in my comment).



---

archive/issue_events_286910.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-10-19T08:32:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286910"
}
```



---

archive/issue_events_286911.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-10-19T08:32:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286911"
}
```



---

archive/issue_comments_322021.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nI am going to add a `gmpy2` optional package to check whether we can do something with it: #21727",
    "created_at": "2016-10-19T08:37:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322021",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
I am going to add a `gmpy2` optional package to check whether we can do something with it: #21727



---

archive/issue_comments_322022.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI have been looking at `gmpy2` for the last hour or so. I think it could work to use the `gmpy2` types as intermediates for the proposed conversions.\n\nThe big issue is that `gmpy2` currently does not expose a C or Cython interface. So either we need to work with upstream to implement that or we need to fork `gmpy2`.",
    "created_at": "2016-10-19T09:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322022",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>Comment 19:</a>
I have been looking at `gmpy2` for the last hour or so. I think it could work to use the `gmpy2` types as intermediates for the proposed conversions.

The big issue is that `gmpy2` currently does not expose a C or Cython interface. So either we need to work with upstream to implement that or we need to fork `gmpy2`.



---

archive/issue_comments_322023.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@jdemeyer](#comment%3A13):\n> Replying to [@mkoeppe](#comment%3A9):\n> > For example, it would not seem so hard to provide a C library\n\n> \n> I hope that you mean a Python module and not a C library. Libraries are a pain in Python.\n\nThe C prototypes that I wrote are an illustration of what I would do if we were making the Python wrappers by hand instead of using Cython.\n\nOf course, we should be making a Cython library with corresponding Cython prototypes.",
    "created_at": "2016-10-19T17:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322023",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@jdemeyer](#comment%3A13):
> Replying to [@mkoeppe](#comment%3A9):
> > For example, it would not seem so hard to provide a C library

> 
> I hope that you mean a Python module and not a C library. Libraries are a pain in Python.

The C prototypes that I wrote are an illustration of what I would do if we were making the Python wrappers by hand instead of using Cython.

Of course, we should be making a Cython library with corresponding Cython prototypes.



---

archive/issue_comments_322024.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@mkoeppe](#comment%3A21):\n> Replying to [@jdemeyer](#comment%3A13):\n> > Replying to [@mkoeppe](#comment%3A9):\n> > > For example, it would not seem so hard to provide a C library\n\n> > \n> > I hope that you mean a Python module and not a C library. Libraries are a pain in Python.\n\n> \n> The C prototypes that I wrote are an illustration of what I would do if we were making the Python wrappers by hand instead of using Cython.\n> \n> Of course, we should be making a Cython library with corresponding Cython prototypes. \n\nAnd does it look like a good idea to use `gmpy2` for that? It already implements thin wrappers around the GMP types, which is precisely what we need.",
    "created_at": "2016-10-19T20:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322024",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@mkoeppe](#comment%3A21):
> Replying to [@jdemeyer](#comment%3A13):
> > Replying to [@mkoeppe](#comment%3A9):
> > > For example, it would not seem so hard to provide a C library

> > 
> > I hope that you mean a Python module and not a C library. Libraries are a pain in Python.

> 
> The C prototypes that I wrote are an illustration of what I would do if we were making the Python wrappers by hand instead of using Cython.
> 
> Of course, we should be making a Cython library with corresponding Cython prototypes. 

And does it look like a good idea to use `gmpy2` for that? It already implements thin wrappers around the GMP types, which is precisely what we need.



---

archive/issue_comments_322025.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@jdemeyer](#comment%3A22):\n> Replying to [@mkoeppe](#comment%3A21):\n> > Of course, we should be making a Cython library with corresponding Cython prototypes. \n\n> \n> And does it look like a good idea to use `gmpy2` for that? It already implements thin wrappers around the GMP types, which is precisely what we need.\n\nI'll take a look at `gmpy2` soon to find out.",
    "created_at": "2016-10-20T00:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@jdemeyer](#comment%3A22):
> Replying to [@mkoeppe](#comment%3A21):
> > Of course, we should be making a Cython library with corresponding Cython prototypes. 

> 
> And does it look like a good idea to use `gmpy2` for that? It already implements thin wrappers around the GMP types, which is precisely what we need.

I'll take a look at `gmpy2` soon to find out.



---

archive/issue_comments_322026.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n It would be nice if these Cython libraries could do conversions from/to Sage number types. Otherwise, on the Sage side we would have to provide a separate wrapper around the Cython wrapper. \n \n Currently, this leads to \n-- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU)) and to \n+- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU) and #21728) and to \n - duplication of effort (for example, PyPolymake and its GMP wrappers)\n \n We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.\n``````\n",
    "created_at": "2016-10-20T00:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322026",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 It would be nice if these Cython libraries could do conversions from/to Sage number types. Otherwise, on the Sage side we would have to provide a separate wrapper around the Cython wrapper. 
 
 Currently, this leads to 
-- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU)) and to 
+- awkward dependencies (such as fpylll depending on sagelib - see [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/s8yeEPK_9zU) and #21728) and to 
 - duplication of effort (for example, PyPolymake and its GMP wrappers)
 
 We need to develop shared infrastructure (a new lightweight library, which does NOT depend on sagelib) for this.
``````




---

archive/issue_comments_322027.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nMy idea would be:\n\n- Add an `__mpz__` method to various types. This will be used to convert an \"arbitrary\" object to a `gmpy2` integer (which is just a thin wrapper around an `mpz_t`). This conversion will not be very fast, but probably fast enough for most use cases.\n\n- For the cases where we have complete control over the types, we could use Cython code to construct a `gmpy2` integer using the C interface.\n\n- For conversion from `gmpy2` to a type `t`, we just need to add some `isinstance(x, gmpy2.mpz)` branches in `t.__init__`.\n\nAs I said before, this would require non-trivial (but backwards compatible) changes to `gmpy2`.",
    "created_at": "2016-10-20T06:31:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322027",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
My idea would be:

- Add an `__mpz__` method to various types. This will be used to convert an "arbitrary" object to a `gmpy2` integer (which is just a thin wrapper around an `mpz_t`). This conversion will not be very fast, but probably fast enough for most use cases.

- For the cases where we have complete control over the types, we could use Cython code to construct a `gmpy2` integer using the C interface.

- For conversion from `gmpy2` to a type `t`, we just need to add some `isinstance(x, gmpy2.mpz)` branches in `t.__init__`.

As I said before, this would require non-trivial (but backwards compatible) changes to `gmpy2`.



---

archive/issue_comments_322028.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@mkoeppe](#comment%3A9):\n> For example, it would not seem so hard to provide a C library with a minimal interface such as\n> \n> ```\n> int mpz_from_python_integer(mpz_t target, PyObject *object)\n> ```\n> that fills `target` with a GMP integer converted from `object`\n> and returns an error code if it can't.\n\nWith my idea, this function would be just the constructor of the `gmpy2.mpz` type.",
    "created_at": "2016-10-20T06:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322028",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@mkoeppe](#comment%3A9):
> For example, it would not seem so hard to provide a C library with a minimal interface such as
> 
> ```
> int mpz_from_python_integer(mpz_t target, PyObject *object)
> ```
> that fills `target` with a GMP integer converted from `object`
> and returns an error code if it can't.

With my idea, this function would be just the constructor of the `gmpy2.mpz` type.



---

archive/issue_comments_322029.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@jdemeyer](#comment%3A25):\n> My idea would be:\n> \n> - Add an `__mpz__` method to various types. This will be used to convert an \"arbitrary\" object to a `gmpy2` integer (which is just a thin wrapper around an `mpz_t`). This conversion will not be very fast, but probably fast enough for most use cases.\n> \n> - For the cases where we have complete control over the types, we could use Cython code to construct a `gmpy2` integer using the C interface.\n> \n> - For conversion from `gmpy2` to a type `t`, we just need to add some `isinstance(x, gmpy2.mpz)` branches in `t.__init__`.\n> \n> As I said before, this would require non-trivial (but backwards compatible) changes to `gmpy2`.\n\nWhy do you think it would be better to go through Python wrappers rather than direct C function calls? Note that such situation would create a dependency to gmpy2 for many projects. On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).\n\nThat being said, what would be the integration of these wrappers in the Sage ecosystem? For example with respect to coercion, would it make sense to have Sage types inheriting from these wrappers, etc.",
    "created_at": "2016-10-21T21:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322029",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@jdemeyer](#comment%3A25):
> My idea would be:
> 
> - Add an `__mpz__` method to various types. This will be used to convert an "arbitrary" object to a `gmpy2` integer (which is just a thin wrapper around an `mpz_t`). This conversion will not be very fast, but probably fast enough for most use cases.
> 
> - For the cases where we have complete control over the types, we could use Cython code to construct a `gmpy2` integer using the C interface.
> 
> - For conversion from `gmpy2` to a type `t`, we just need to add some `isinstance(x, gmpy2.mpz)` branches in `t.__init__`.
> 
> As I said before, this would require non-trivial (but backwards compatible) changes to `gmpy2`.

Why do you think it would be better to go through Python wrappers rather than direct C function calls? Note that such situation would create a dependency to gmpy2 for many projects. On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).

That being said, what would be the integration of these wrappers in the Sage ecosystem? For example with respect to coercion, would it make sense to have Sage types inheriting from these wrappers, etc.



---

archive/issue_comments_322030.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@videlec](#comment%3A28):\n> Why do you think it would be better to go through Python wrappers rather than direct C function calls?\n\nI just don't see how one could implement that if you don't want build-time dependencies and you don't want Python objects to be involved. You need to pass around `mpz_t` pointers but you cannot literally do that in Python: you need to wrap the `mpz_t` pointer in some Python object. And that's precisely what `gmpy2` does.\n\nLet me also point out that `gmpy2` does object caching (like Sage `Integer`), such that object creation/destruction can be very fast.\n\n> Note that such situation would create a dependency to gmpy2 for many projects.\n\nYou will need a dependency on *something* anyway. This feature needs to be implemented somewhere (not in thin air) and you will need to depend on that.\n\n> That being said, what would be the integration of these wrappers in the Sage ecosystem? For example with respect to coercion, would it make sense to have Sage types inheriting from these wrappers, etc.\n\nI see those `gmpy2` types purely as a way of passing around data. There should be a conversion from/to those types, but nothing more than that. Inheriting from those types wouldn't work because that's incompatible with the Sage coercion model.\n\nWe could still support those types in the Sage coercion model, like we currently do for the standard Python types like `int`. But that's not a priority.",
    "created_at": "2016-10-23T09:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322030",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@videlec](#comment%3A28):
> Why do you think it would be better to go through Python wrappers rather than direct C function calls?

I just don't see how one could implement that if you don't want build-time dependencies and you don't want Python objects to be involved. You need to pass around `mpz_t` pointers but you cannot literally do that in Python: you need to wrap the `mpz_t` pointer in some Python object. And that's precisely what `gmpy2` does.

Let me also point out that `gmpy2` does object caching (like Sage `Integer`), such that object creation/destruction can be very fast.

> Note that such situation would create a dependency to gmpy2 for many projects.

You will need a dependency on *something* anyway. This feature needs to be implemented somewhere (not in thin air) and you will need to depend on that.

> That being said, what would be the integration of these wrappers in the Sage ecosystem? For example with respect to coercion, would it make sense to have Sage types inheriting from these wrappers, etc.

I see those `gmpy2` types purely as a way of passing around data. There should be a conversion from/to those types, but nothing more than that. Inheriting from those types wouldn't work because that's incompatible with the Sage coercion model.

We could still support those types in the Sage coercion model, like we currently do for the standard Python types like `int`. But that's not a priority.



---

archive/issue_comments_322031.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@videlec](#comment%3A28):\n> On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).\n\nI don't really understand what you mean with that comment. Are you saying that we could use this instead of `gmpy2`? One issue is the fact that GMP/MPIR types are more \"standard\" than the FLINT types. A second issue is that `gmpy2` looks more optimized for speed than `python-flint`.",
    "created_at": "2016-10-23T09:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322031",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@videlec](#comment%3A28):
> On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).

I don't really understand what you mean with that comment. Are you saying that we could use this instead of `gmpy2`? One issue is the fact that GMP/MPIR types are more "standard" than the FLINT types. A second issue is that `gmpy2` looks more optimized for speed than `python-flint`.



---

archive/issue_comments_322032.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@jdemeyer](#comment%3A29):\n> Replying to [@videlec](#comment%3A28):\n> > Why do you think it would be better to go through Python wrappers rather than direct C function calls?\n\n> \n> I just don't see how one could implement that if you don't want build-time dependencies and you don't want Python objects to be involved. You need to pass around `mpz_t` pointers but you cannot literally do that in Python: you need to wrap the `mpz_t` pointer in some Python object. And that's precisely what `gmpy2` does.\n> \n> Let me also point out that `gmpy2` does object caching (like Sage `Integer`), such that object creation/destruction can be very fast.\n\nThis is not exactly what I need for pypolymake. This library is just a Python interface to polymake (that is currently a mix of C++ and Perl). When the answer to some method is an integer I want the possibility to return a Sage integer (if it is used from Sage), a gmpy2 integer (if it is used from Python with gmpy2 available) or a Python integer.\n\nThis is the kind of template I have\n\n```\ncpdef my_integer_question():\n    cdef mpz_t ans\n    my_polymake_function(ans)\n    return mpz_wrapper(ans)\n```\nAnd I want this `mpz_wrapper` parametrizable (on module loading or by the user). This is currently working but not very clean.\n\nWith your proposal, this function will have to go through `gmpy2` and then call a (possibly pure Python) conversion `gmpy2 -> whatever`.\n\n```\ncpdef my_integer_question():\n    cdef mpz_t ans\n    my_polymake_function(ans)\n    my_gmpy2 = mpz_wrapper(ans)\n    return gmpy2_converter(my_gmpy2)\n```\n\nI am not sure I prefer the gmpy2 version.",
    "created_at": "2016-10-23T09:57:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322032",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@jdemeyer](#comment%3A29):
> Replying to [@videlec](#comment%3A28):
> > Why do you think it would be better to go through Python wrappers rather than direct C function calls?

> 
> I just don't see how one could implement that if you don't want build-time dependencies and you don't want Python objects to be involved. You need to pass around `mpz_t` pointers but you cannot literally do that in Python: you need to wrap the `mpz_t` pointer in some Python object. And that's precisely what `gmpy2` does.
> 
> Let me also point out that `gmpy2` does object caching (like Sage `Integer`), such that object creation/destruction can be very fast.

This is not exactly what I need for pypolymake. This library is just a Python interface to polymake (that is currently a mix of C++ and Perl). When the answer to some method is an integer I want the possibility to return a Sage integer (if it is used from Sage), a gmpy2 integer (if it is used from Python with gmpy2 available) or a Python integer.

This is the kind of template I have

```
cpdef my_integer_question():
    cdef mpz_t ans
    my_polymake_function(ans)
    return mpz_wrapper(ans)
```
And I want this `mpz_wrapper` parametrizable (on module loading or by the user). This is currently working but not very clean.

With your proposal, this function will have to go through `gmpy2` and then call a (possibly pure Python) conversion `gmpy2 -> whatever`.

```
cpdef my_integer_question():
    cdef mpz_t ans
    my_polymake_function(ans)
    my_gmpy2 = mpz_wrapper(ans)
    return gmpy2_converter(my_gmpy2)
```

I am not sure I prefer the gmpy2 version.



---

archive/issue_comments_322033.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@jdemeyer](#comment%3A30):\n> Replying to [@videlec](#comment%3A28):\n> > On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).\n\n> \n> I don't really understand what you mean with that comment. Are you saying that we could use this instead of `gmpy2`? One issue is the fact that GMP/MPIR types are more \"standard\" than the FLINT types. A second issue is that `gmpy2` looks more optimized for speed than `python-flint`. \n\nThis is a follow-up comment: we also want to support flint and arb conversions and there are already small Python wrappers for that purpose. It is disjoint from the gmp problem but it was worth mentioning to help taking a decision.",
    "created_at": "2016-10-23T10:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322033",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@jdemeyer](#comment%3A30):
> Replying to [@videlec](#comment%3A28):
> > On the plus side, flint and arb have [python-flint](https://github.com/fredrik-johansson/python-flint).

> 
> I don't really understand what you mean with that comment. Are you saying that we could use this instead of `gmpy2`? One issue is the fact that GMP/MPIR types are more "standard" than the FLINT types. A second issue is that `gmpy2` looks more optimized for speed than `python-flint`. 

This is a follow-up comment: we also want to support flint and arb conversions and there are already small Python wrappers for that purpose. It is disjoint from the gmp problem but it was worth mentioning to help taking a decision.



---

archive/issue_comments_322034.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@videlec](#comment%3A31):\n> With your proposal, this function will have to go through `gmpy2` and then call a (possibly pure Python) conversion `gmpy2 -> whatever`.\n\nAt least it's *possible* to do a slow-but-working pure Python conversion.",
    "created_at": "2016-10-23T10:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322034",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@videlec](#comment%3A31):
> With your proposal, this function will have to go through `gmpy2` and then call a (possibly pure Python) conversion `gmpy2 -> whatever`.

At least it's *possible* to do a slow-but-working pure Python conversion.



---

archive/issue_comments_322035.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nI think we are talking about two different things:\n\n1. Implementing a way for Python projects to efficiently communicate integers between them, without build-time dependencies (the `fpylll` problem).\n\n2. A customizable `make_whatever_integer_from_mpz()` function (the `pypolymake` problem)\n\nThese are different problems and I consider this ticket to be about 1. (but the ticket description is not clear what it really is about).",
    "created_at": "2016-10-23T10:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322035",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
I think we are talking about two different things:

1. Implementing a way for Python projects to efficiently communicate integers between them, without build-time dependencies (the `fpylll` problem).

2. A customizable `make_whatever_integer_from_mpz()` function (the `pypolymake` problem)

These are different problems and I consider this ticket to be about 1. (but the ticket description is not clear what it really is about).



---

archive/issue_comments_322036.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nAnd actually, 2. is totally trivial to implement in like 10 lines of Cython code (you just need to store a pointer to a conversion function in a global variable). Ideally, this would be added to some existing project because it seems a bit overkill to create a separate Python project for just those 10 lines.",
    "created_at": "2016-10-23T10:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322036",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
And actually, 2. is totally trivial to implement in like 10 lines of Cython code (you just need to store a pointer to a conversion function in a global variable). Ideally, this would be added to some existing project because it seems a bit overkill to create a separate Python project for just those 10 lines.



---

archive/issue_comments_322037.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@jdemeyer](#comment%3A35):\n> And actually, 2. is totally trivial to implement in like 10 lines of Cython code (you just need to store a pointer to a conversion function in a global variable).\n\nI would not like to see Cython libraries to use global variables for that; it seems a short-sighted design decision. If library A does that, but then libraries B and C use library A, they may need library A to use two different output conversions. \n\nAlso fpylll's current solution, namely making Sage integers instead of Python integers whenever it finds sage.all in the system, seems like a poor design decision as well. If another Python library uses fpylll, it may break when fpylll decides to use Sage integers.",
    "created_at": "2016-10-27T21:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322037",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@jdemeyer](#comment%3A35):
> And actually, 2. is totally trivial to implement in like 10 lines of Cython code (you just need to store a pointer to a conversion function in a global variable).

I would not like to see Cython libraries to use global variables for that; it seems a short-sighted design decision. If library A does that, but then libraries B and C use library A, they may need library A to use two different output conversions. 

Also fpylll's current solution, namely making Sage integers instead of Python integers whenever it finds sage.all in the system, seems like a poor design decision as well. If another Python library uses fpylll, it may break when fpylll decides to use Sage integers.



---

archive/issue_comments_322038.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nReplying to [@mkoeppe](#comment%3A37):\n> I would not like to see Cython libraries to use global variables for that; it seems a short-sighted design decision. If library A does that, but then libraries B and C use library A, they may need library A to use two different output conversions.\n\nI actually think that a global variable is the whole point of the requested feature. You want all libraries to use a common given output format requested by the **user** (not other libraries).",
    "created_at": "2016-10-27T22:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322038",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'>Comment 38:</a>
Replying to [@mkoeppe](#comment%3A37):
> I would not like to see Cython libraries to use global variables for that; it seems a short-sighted design decision. If library A does that, but then libraries B and C use library A, they may need library A to use two different output conversions.

I actually think that a global variable is the whole point of the requested feature. You want all libraries to use a common given output format requested by the **user** (not other libraries).



---

archive/issue_comments_322039.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nIt's a cleaner design to pass an extra argument around. \n\nIn my experience, global variables never solve a problem but only create new ones.",
    "created_at": "2016-10-27T22:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322039",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>Comment 39:</a>
It's a cleaner design to pass an extra argument around. 

In my experience, global variables never solve a problem but only create new ones.



---

archive/issue_comments_322040.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nReplying to [@mkoeppe](#comment%3A39):\n> It's a cleaner design to pass an extra argument around.\n\nOr just return something generic (like a `gmpy2` instance) and let the user code convert it if needed.\n\n> In my experience, global variables never solve a problem but only create new ones. \n\nVincent is the one who asked for this feature, so I'll let him discuss it with you.\n\nAnyway, I would still like to know what you think of my idea to use `gmpy2` as \"de facto\" standard to pass around integers.",
    "created_at": "2016-10-28T06:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322040",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>Comment 40:</a>
Replying to [@mkoeppe](#comment%3A39):
> It's a cleaner design to pass an extra argument around.

Or just return something generic (like a `gmpy2` instance) and let the user code convert it if needed.

> In my experience, global variables never solve a problem but only create new ones. 

Vincent is the one who asked for this feature, so I'll let him discuss it with you.

Anyway, I would still like to know what you think of my idea to use `gmpy2` as "de facto" standard to pass around integers.



---

archive/issue_events_286912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T11:39:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286912"
}
```



---

archive/issue_comments_322041.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nGiven the unclear ticket description and the lack of interest, I suggest to close this as invalid.\n\nI am not saying that there is nothing to be done here, just that this ticket is too vague. It seems that everybody has a different idea about what it means.\n\nIf you want some feature in the spirit of this ticket, please open a new ticket, clearly stating what you want.",
    "created_at": "2017-03-01T11:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322041",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'>Comment 44:</a>
Given the unclear ticket description and the lack of interest, I suggest to close this as invalid.

I am not saying that there is nothing to be done here, just that this ticket is too vague. It seems that everybody has a different idea about what it means.

If you want some feature in the spirit of this ticket, please open a new ticket, clearly stating what you want.



---

archive/issue_events_286913.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T11:39:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286913"
}
```



---

archive/issue_events_286914.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-01T11:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286914"
}
```



---

archive/issue_comments_322042.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nUh, we are working on it. Greeting from Sage Days.",
    "created_at": "2017-03-01T11:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322042",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'>Comment 45:</a>
Uh, we are working on it. Greeting from Sage Days.



---

archive/issue_events_286915.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-03-01T11:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286915"
}
```



---

archive/issue_events_286916.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-03-01T11:42:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286916"
}
```



---

archive/issue_events_286917.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-03-01T11:42:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286917"
}
```



---

archive/issue_comments_322043.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nReplying to [@mkoeppe](#comment%3A45):\n> Uh, we are working on it.\n\nGood! I am looking forward to your update of the ticket description (I hope you have read [comment:44] and understand *why* I proposed to close this ticket).",
    "created_at": "2017-03-01T11:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322043",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'>Comment 47:</a>
Replying to [@mkoeppe](#comment%3A45):
> Uh, we are working on it.

Good! I am looking forward to your update of the ticket description (I hope you have read [comment:44] and understand *why* I proposed to close this ticket).



---

archive/issue_comments_322044.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\n**ping**",
    "created_at": "2017-03-08T12:43:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322044",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'>Comment 48:</a>
**ping**



---

archive/issue_comments_322045.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nThese are two weeks Sage days. Why are you so picky about this ticket?",
    "created_at": "2017-03-08T22:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322045",
    "user": "https://github.com/videlec"
}
```

<a id='comment:49'>Comment 49:</a>
These are two weeks Sage days. Why are you so picky about this ticket?



---

archive/issue_comments_322046.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nDoes it really take 2 weeks to figure out what the ticket is about?\n\nI'm picky about this one because I feel like I might be interested and I could help if only somebody would clarify what this ticket is about.\n\nIn reality, I guess that this ticket is really about several things and each of those things should get its own ticket.",
    "created_at": "2017-03-09T08:37:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322046",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'>Comment 50:</a>
Does it really take 2 weeks to figure out what the ticket is about?

I'm picky about this one because I feel like I might be interested and I could help if only somebody would clarify what this ticket is about.

In reality, I guess that this ticket is really about several things and each of those things should get its own ticket.



---

archive/issue_comments_322047.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nAnother case at hand is #23024...",
    "created_at": "2018-02-06T08:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322047",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'>Comment 51:</a>
Another case at hand is #23024...



---

archive/issue_events_286918.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-06T11:33:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286918"
}
```



---

archive/issue_comments_322048.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\n11 months and still no explanation.",
    "created_at": "2018-02-06T11:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322048",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'>Comment 52:</a>
11 months and still no explanation.



---

archive/issue_events_286919.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-06T11:33:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286919"
}
```



---

archive/issue_events_286920.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-06T11:33:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21725#event-286920"
}
```



---

archive/issue_comments_322049.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-02-06T11:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21725#issuecomment-322049",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**
