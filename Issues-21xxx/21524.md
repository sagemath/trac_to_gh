# Issue 21524: configure.ac: write build/make/Makefile within an AC_CONFIG_FILE, not during main configure

archive/issues_021287.json:
```json
{
    "body": "`build/make/Makefile` should be written by `config.status` within an `AC_CONFIG_FILE` template, not at `configure` time.\n\nReviewer: Julian R\u00fcth\n\nAuthor: Erik Bray\n\nBranch: 2a991859c7fdb62357a0136c6c6df8902e677050\n\nDependencies: #24729, #24703\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21524\n\n",
    "closed_at": "2018-03-12T19:42:39Z",
    "created_at": "2016-09-17T23:53:45Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "configure.ac: write build/make/Makefile within an AC_CONFIG_FILE, not during main configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21524",
    "user": "https://github.com/mkoeppe"
}
```
`build/make/Makefile` should be written by `config.status` within an `AC_CONFIG_FILE` template, not at `configure` time.

Reviewer: Julian Rüth

Author: Erik Bray

Branch: 2a991859c7fdb62357a0136c6c6df8902e677050

Dependencies: #24729, #24703

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21524





---

archive/issue_comments_314304.json:
```json
{
    "body": "The title \"Get rid of file descriptor 7 hack\" is different from the description \"build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure\". Do you want to fix both things here? Can you please clarify?\n\nAnd honestly, I think there is nothing wrong with the \"file descriptor 7 hack\". `autoconf` itself uses similar hacks internally.",
    "created_at": "2016-09-18T11:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314304",
    "user": "https://github.com/jdemeyer"
}
```

The title "Get rid of file descriptor 7 hack" is different from the description "build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure". Do you want to fix both things here? Can you please clarify?

And honestly, I think there is nothing wrong with the "file descriptor 7 hack". `autoconf` itself uses similar hacks internally.



---

archive/issue_comments_314305.json:
```json
{
    "body": "<a id='comment:2'></a>I've updated the title",
    "created_at": "2016-09-18T17:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314305",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>I've updated the title



---

archive/issue_comments_314306.json:
```json
{
    "body": "<a id='comment:3'></a>I agree, there's nothing wrong with using a file descriptor to write to a file ;)",
    "created_at": "2016-09-18T20:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314306",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>I agree, there's nothing wrong with using a file descriptor to write to a file ;)



---

archive/issue_comments_314307.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure, not at configure time.\n+`build/make/Makefile` should be written within an AC_CONFIG_COMMANDS procedure, not at configure time. \n+\n+Marking this as dependent on #21479 just because that that ticket changes the same part of `configure.ac`.\n \n Comment: description.1\n \n``````\n",
    "created_at": "2016-09-18T20:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314307",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure, not at configure time.
+`build/make/Makefile` should be written within an AC_CONFIG_COMMANDS procedure, not at configure time. 
+
+Marking this as dependent on #21479 just because that that ticket changes the same part of `configure.ac`.
 
 Comment: description.1
 
``````




---

archive/issue_comments_314308.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+`build/make/Makefile` should be written within an AC_CONFIG_COMMANDS procedure, not at configure time. \n \n+Marking this as dependent on #21479 just because that ticket changes the same part of `configure.ac`.\n \n Comment: description.1\n \n``````\n",
    "created_at": "2016-09-18T20:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314308",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+`build/make/Makefile` should be written within an AC_CONFIG_COMMANDS procedure, not at configure time. 
 
+Marking this as dependent on #21479 just because that ticket changes the same part of `configure.ac`.
 
 Comment: description.1
 
``````




---

archive/issue_comments_314309.json:
```json
{
    "body": "<a id='comment:6'></a>Does it necessarily need to use `AC_CONFIG_COMMANDS`?  Most of the stuff that writes `build/make/Makefile` could just as easily be moved into its own macro in a separate file in the `m4/` directory.\n\nAs I see it the main goal here is to simplify the configure.ac by moving more functionality into separate files.  But moving the existing code into an m4 macro would take less work, and has the advantage that it would have full access to any other variables set in other parts of the `configure` script, without having to explicitly pass them on to an external command.",
    "created_at": "2017-07-19T11:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314309",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>Does it necessarily need to use `AC_CONFIG_COMMANDS`?  Most of the stuff that writes `build/make/Makefile` could just as easily be moved into its own macro in a separate file in the `m4/` directory.

As I see it the main goal here is to simplify the configure.ac by moving more functionality into separate files.  But moving the existing code into an m4 macro would take less work, and has the advantage that it would have full access to any other variables set in other parts of the `configure` script, without having to explicitly pass them on to an external command.



---

archive/issue_comments_314310.json:
```json
{
    "body": "<a id='comment:7'></a>On second thought, I can see why this way would be better, as it's more in spirit with how configure is supposed to work w.r.t. generating files.  I'll have to give that some more thought.  Maybe there aren't so many variables that need to be passed in.",
    "created_at": "2017-07-19T12:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314310",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>On second thought, I can see why this way would be better, as it's more in spirit with how configure is supposed to work w.r.t. generating files.  I'll have to give that some more thought.  Maybe there aren't so many variables that need to be passed in.



---

archive/issue_comments_314311.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+`build/make/Makefile` should be written within an AC_CONFIG_FILE template, not at configure time. \n \n+Marking this as dependent on #21479 just because that ticket changes the same part of `configure.ac`.\n \n Comment: description.1\n \n``````\n",
    "created_at": "2017-07-20T15:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314311",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+`build/make/Makefile` should be written within an AC_CONFIG_FILE template, not at configure time. 
 
+Marking this as dependent on #21479 just because that ticket changes the same part of `configure.ac`.
 
 Comment: description.1
 
``````




---

archive/issue_events_057126.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-20T15:25:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57126"
}
```



---

archive/issue_comments_314312.json:
```json
{
    "body": "<a id='comment:8'></a>Here's my proposed solution to this (I updated the ticket to mention `AC_CONFIG_FILE` since that's what this uses).\n\nThis adds a `build/make/Makefile.in` template that is used to generated `build/make/Makefile` in `config.status`.  The `configure` script now just collects values for some variables that are inserted into the Makefile template.  I tried to keep as much actual Makefile syntax out of the output variables as possible, sticking mostly to just lists of package names that are operated over.  Most of the rules for building packages are generated by the Makefile itself in `$(eval ...)` loops.  The end result I think is actually cleaner and easier to understand.\n\nIf any of this should be controversial, it may be the use of some more advanced GNU make constructs, the portability of which I'm not sure.  This was tested with GNU make 3.81 (about 11 years old), and 4.2.1 (very recent).  That said, it's using some relatively advanced GNU make features that may not be available in other makes.  I think it's still *better*, but if need be more of the Makefile generation could be pushed back into `configure`, but still provided via output variables, instead of writing directly to a file.\n\nIncreased the priority since I have other build system work that would likely depend on this, and also because it makes some non-trivial performance improvements, especially on Cygwin.\n\n---\nNew commits:",
    "created_at": "2017-07-20T15:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314312",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Here's my proposed solution to this (I updated the ticket to mention `AC_CONFIG_FILE` since that's what this uses).

This adds a `build/make/Makefile.in` template that is used to generated `build/make/Makefile` in `config.status`.  The `configure` script now just collects values for some variables that are inserted into the Makefile template.  I tried to keep as much actual Makefile syntax out of the output variables as possible, sticking mostly to just lists of package names that are operated over.  Most of the rules for building packages are generated by the Makefile itself in `$(eval ...)` loops.  The end result I think is actually cleaner and easier to understand.

If any of this should be controversial, it may be the use of some more advanced GNU make constructs, the portability of which I'm not sure.  This was tested with GNU make 3.81 (about 11 years old), and 4.2.1 (very recent).  That said, it's using some relatively advanced GNU make features that may not be available in other makes.  I think it's still *better*, but if need be more of the Makefile generation could be pushed back into `configure`, but still provided via output variables, instead of writing directly to a file.

Increased the priority since I have other build system work that would likely depend on this, and also because it makes some non-trivial performance improvements, especially on Cygwin.

---
New commits:



---

archive/issue_comments_314313.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-20T15:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314313",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314314.json:
```json
{
    "body": "<a id='comment:10'></a>Weird that the patchbot is failing due to Numpy of all things.  I wonder if it has something more to do with the fact that it's building in a temp dir (since this is an \"unsafe\" ticket) than anything to do with the patch itself, but I'll have to see if I can reproduce...\n\n```\n[numpy-1.12.1] Traceback (most recent call last):\n[numpy-1.12.1]   File \"<stdin>\", line 3, in <module>\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/__init__.py\", line 142, in <module>\n[numpy-1.12.1]     from . import add_newdocs\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/add_newdocs.py\", line 13, in <module>\n[numpy-1.12.1]     from numpy.lib import add_newdoc\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/__init__.py\", line 18, in <module>\n[numpy-1.12.1]     from .polynomial import *\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/polynomial.py\", line 20, in <module>\n[numpy-1.12.1]     from numpy.linalg import eigvals, lstsq, inv\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/__init__.py\", line 51, in <module>\n[numpy-1.12.1]     from .linalg import *\n[numpy-1.12.1]   File \"/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/linalg.py\", line 29, in <module>\n[numpy-1.12.1]     from numpy.linalg import lapack_lite, _umath_linalg\n[numpy-1.12.1] ImportError: /tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/lapack_lite.so: undefined symbol: zungqr_\n```",
    "created_at": "2017-09-08T08:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314314",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>Weird that the patchbot is failing due to Numpy of all things.  I wonder if it has something more to do with the fact that it's building in a temp dir (since this is an "unsafe" ticket) than anything to do with the patch itself, but I'll have to see if I can reproduce...

```
[numpy-1.12.1] Traceback (most recent call last):
[numpy-1.12.1]   File "<stdin>", line 3, in <module>
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/__init__.py", line 142, in <module>
[numpy-1.12.1]     from . import add_newdocs
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/add_newdocs.py", line 13, in <module>
[numpy-1.12.1]     from numpy.lib import add_newdoc
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/__init__.py", line 18, in <module>
[numpy-1.12.1]     from .polynomial import *
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/polynomial.py", line 20, in <module>
[numpy-1.12.1]     from numpy.linalg import eigvals, lstsq, inv
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/__init__.py", line 51, in <module>
[numpy-1.12.1]     from .linalg import *
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/linalg.py", line 29, in <module>
[numpy-1.12.1]     from numpy.linalg import lapack_lite, _umath_linalg
[numpy-1.12.1] ImportError: /tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/lapack_lite.so: undefined symbol: zungqr_
```



---

archive/issue_events_057127.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57127"
}
```



---

archive/issue_events_057128.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57128"
}
```



---

archive/issue_comments_314315.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-14T01:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314315",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314316.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-16T17:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314317.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-16T17:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314317",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314318.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-30T11:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314319.json:
```json
{
    "body": "<a id='comment:17'></a>Why? This makes the `Makefile` much harder to understand for no obvious benefit...",
    "created_at": "2018-01-30T15:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Why? This makes the `Makefile` much harder to understand for no obvious benefit...



---

archive/issue_comments_314320.json:
```json
{
    "body": "<a id='comment:18'></a>Personally, I find this horrible. I highly value the debuggability of an explicit `Makefile`.\n\nOf course, that's a very subjective thing so I'm keeping the needs_review status.",
    "created_at": "2018-01-30T16:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314320",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Personally, I find this horrible. I highly value the debuggability of an explicit `Makefile`.

Of course, that's a very subjective thing so I'm keeping the needs_review status.



---

archive/issue_comments_314321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+`build/make/Makefile` should be written by `config.status` within an `AC_CONFIG_FILE` template, not at `configure` time.\n \n Comment: description.1\n \n``````\n",
    "created_at": "2018-01-30T16:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314321",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+`build/make/Makefile` should be written by `config.status` within an `AC_CONFIG_FILE` template, not at `configure` time.
 
 Comment: description.1
 
``````




---

archive/issue_comments_314322.json:
```json
{
    "body": "<a id='comment:19'></a>I explained all of this in my e-mail...",
    "created_at": "2018-01-30T17:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314322",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>I explained all of this in my e-mail...



---

archive/issue_comments_314323.json:
```json
{
    "body": "<a id='comment:20'></a>Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.",
    "created_at": "2018-01-31T15:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.



---

archive/issue_comments_314324.json:
```json
{
    "body": "<a id='comment:21'></a>I think the proposed changes are an improvement. I find the proposed setup easier to read, understand, and modify than the previous echos in configure. It also feels closer to the intended way of using autoconf. I am not sure if the resulting Makefile is harder to read, I don't really see why, in any case, I can see why we would like to get rid of the `echo` hack which makes it quite annoying to edit `configure` imho.\n\nSome comments (apart from these minor issues, I would not mind setting this to positive review):\n\n* I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?\n\n```\n+# This file has been automatically generated by\n+#   /home/embray/src/sagemath/sage/config.status\n+# You should not edit it by hand\n```\n    I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.\n* I don't really understand the following comment\n\n```\n+    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to\n+    # some dummy file to skip the installation.\n```\n    So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)\n* I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)\n\n```\n+    # Below we have to obscure A\"\"M_V_at, or autoconf would complain:\n+    # \"error: possibly undefined macro: A\"\"M_V_at\"\n```\n* I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.",
    "created_at": "2018-01-31T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314324",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:21'></a>I think the proposed changes are an improvement. I find the proposed setup easier to read, understand, and modify than the previous echos in configure. It also feels closer to the intended way of using autoconf. I am not sure if the resulting Makefile is harder to read, I don't really see why, in any case, I can see why we would like to get rid of the `echo` hack which makes it quite annoying to edit `configure` imho.

Some comments (apart from these minor issues, I would not mind setting this to positive review):

* I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?

```
+# This file has been automatically generated by
+#   /home/embray/src/sagemath/sage/config.status
+# You should not edit it by hand
```
    I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.
* I don't really understand the following comment

```
+    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to
+    # some dummy file to skip the installation.
```
    So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)
* I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)

```
+    # Below we have to obscure A""M_V_at, or autoconf would complain:
+    # "error: possibly undefined macro: A""M_V_at"
```
* I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.



---

archive/issue_comments_314325.json:
```json
{
    "body": "<a id='comment:22'></a>I think this should be for followup ticket. It's taken about half a year to get from Erik's commits to somebody reviewing this. If we do a complete rewrite of this, I think this is going to take forever. (Btw, you agreed to fix up #20382 11 months ago. It's easy to get distracted and not move at all\u2026. We should not strive for absolute perfection here but go with improvements that introduce good code. And then get better in the next iteration\u2026)\n\nReplying to [comment:20 jdemeyer]:\n> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.",
    "created_at": "2018-01-31T15:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314325",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:22'></a>I think this should be for followup ticket. It's taken about half a year to get from Erik's commits to somebody reviewing this. If we do a complete rewrite of this, I think this is going to take forever. (Btw, you agreed to fix up #20382 11 months ago. It's easy to get distracted and not move at all…. We should not strive for absolute perfection here but go with improvements that introduce good code. And then get better in the next iteration…)

Replying to [comment:20 jdemeyer]:
> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.



---

archive/issue_comments_314326.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:20 jdemeyer]:\n> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.\n\n\nIt's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.  It has a name but until I feel ready to post the code it's a secret :-)  It supports POSIX-compatible Makefiles but it also has its own pure-Python format that lets you write make rules in Python, including all the high-level constructs thereof.\n\nIn the meantime I don't really see how that would solve anything though.",
    "created_at": "2018-01-31T15:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314326",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Replying to [comment:20 jdemeyer]:
> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.


It's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.  It has a name but until I feel ready to post the code it's a secret :-)  It supports POSIX-compatible Makefiles but it also has its own pure-Python format that lets you write make rules in Python, including all the high-level constructs thereof.

In the meantime I don't really see how that would solve anything though.



---

archive/issue_comments_314327.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 embray]:\n> In the meantime I don't really see how that would solve anything though.\n\n\nIt would solve exactly the same issues as the ones that you are fixing in your branch, just in a different way.",
    "created_at": "2018-01-31T16:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314327",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Replying to [comment:23 embray]:
> In the meantime I don't really see how that would solve anything though.


It would solve exactly the same issues as the ones that you are fixing in your branch, just in a different way.



---

archive/issue_comments_314328.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:23 embray]:\n> It's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.\n\n\nI would be more interested in the converse: turn any Python `setup.py` into `Makefile` rules.",
    "created_at": "2018-01-31T16:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314328",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>Replying to [comment:23 embray]:
> It's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.


I would be more interested in the converse: turn any Python `setup.py` into `Makefile` rules.



---

archive/issue_comments_314329.json:
```json
{
    "body": "<a id='comment:27'></a>It would still be much slower just by involving Python.  It would still be an (actual!) abuse of autoconf.",
    "created_at": "2018-01-31T16:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314329",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>It would still be much slower just by involving Python.  It would still be an (actual!) abuse of autoconf.



---

archive/issue_comments_314330.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:21 saraedum]:\n> Some comments (apart from these minor issues, I would not mind setting this to positive review):\n> \n> * I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?\n> \n> ```\n> +# This file has been automatically generated by\n> +#   /home/embray/src/sagemath/sage/config.status\n> +# You should not edit it by hand\n> ```\n\n\nOops, I'm not sure how that got there since I wrote this six months ago :) It might be that I started from editing a generated file exactly as it says not to do. But let me double-check that `config.status` isn't *actually* putting that there because that would be a bug, and a bad one at that.\n\n>     I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.\n\n\nThat would help, though I'm not sure where to put it.  It would be nice to have some documentation about though, as it took me a while to wrap my head around too. It's a bit hard to follow that the top-level `Makefile` calls `build/make/install` which calls `make` again but with `build/make/Makefile`, which in turn calls `sage-spkg` to actually build/install packages.  I don't have too much of a problem with that aspect of the process but it's not obvious.\n\n> * I don't really understand the following comment\n> \n> ```\n> +    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to\n> +    # some dummy file to skip the installation.\n> ```\n>     So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)\n\n\nYes, maybe this could be spelled more consistently.\n\nThis definitely deserves better documentation (most of how this works is carried over from the existing Makefile--I really didn't change much...)  The actual physical (as in, a real file) targets associate with each package are the \"stamp\" files installed to `$SAGE_LOCAL/var/lib/sage/installed/<pkg_name>-<pkg_version>`.  Within the Makefile the paths to these files are stored in variables named `$(inst_<pkg_name>)`.\n\nWhat this is referring to is that for packages which are not actually installed into Sage (e.g. we use the system version), instead of pointing to a real stamp file, the `$(inst_<pkg_name>)` just points to a dummy file indicating \"yes, this dependency is satisfied\".  This way we don't need to *remove* that package as a dependency of any other package.  It's just trivially satisfied.\n\nAnyways, I'll see if I can make that comment clearer.\n\n> * I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)\n> \n> ```\n> +    # Below we have to obscure A\"\"M_V_at, or autoconf would complain:\n> +    # \"error: possibly undefined macro: A\"\"M_V_at\"\n> ```\n\n\nCarried over from the original configure.ac.  It's not relevant now anywhere so can just be deleted.\n\n> * I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.\n\n\nOkay, maybe that's a decent place to put it...",
    "created_at": "2018-01-31T16:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314330",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>Replying to [comment:21 saraedum]:
> Some comments (apart from these minor issues, I would not mind setting this to positive review):
> 
> * I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?
> 
> ```
> +# This file has been automatically generated by
> +#   /home/embray/src/sagemath/sage/config.status
> +# You should not edit it by hand
> ```


Oops, I'm not sure how that got there since I wrote this six months ago :) It might be that I started from editing a generated file exactly as it says not to do. But let me double-check that `config.status` isn't *actually* putting that there because that would be a bug, and a bad one at that.

>     I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.


That would help, though I'm not sure where to put it.  It would be nice to have some documentation about though, as it took me a while to wrap my head around too. It's a bit hard to follow that the top-level `Makefile` calls `build/make/install` which calls `make` again but with `build/make/Makefile`, which in turn calls `sage-spkg` to actually build/install packages.  I don't have too much of a problem with that aspect of the process but it's not obvious.

> * I don't really understand the following comment
> 
> ```
> +    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to
> +    # some dummy file to skip the installation.
> ```
>     So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)


Yes, maybe this could be spelled more consistently.

This definitely deserves better documentation (most of how this works is carried over from the existing Makefile--I really didn't change much...)  The actual physical (as in, a real file) targets associate with each package are the "stamp" files installed to `$SAGE_LOCAL/var/lib/sage/installed/<pkg_name>-<pkg_version>`.  Within the Makefile the paths to these files are stored in variables named `$(inst_<pkg_name>)`.

What this is referring to is that for packages which are not actually installed into Sage (e.g. we use the system version), instead of pointing to a real stamp file, the `$(inst_<pkg_name>)` just points to a dummy file indicating "yes, this dependency is satisfied".  This way we don't need to *remove* that package as a dependency of any other package.  It's just trivially satisfied.

Anyways, I'll see if I can make that comment clearer.

> * I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)
> 
> ```
> +    # Below we have to obscure A""M_V_at, or autoconf would complain:
> +    # "error: possibly undefined macro: A""M_V_at"
> ```


Carried over from the original configure.ac.  It's not relevant now anywhere so can just be deleted.

> * I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.


Okay, maybe that's a decent place to put it...



---

archive/issue_comments_314331.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-31T16:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314331",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314332.json:
```json
{
    "body": "<a id='comment:30'></a>While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.\n\nOther ideas:\n\n1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where \"make\" isn't GNU?\n2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)\n3. Is Bash needed for the makefile at all? If we replace \"source\" with \".\", does anything else crash with POSIX sh?",
    "created_at": "2018-01-31T21:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314332",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:30'></a>While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.

Other ideas:

1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where "make" isn't GNU?
2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)
3. Is Bash needed for the makefile at all? If we replace "source" with ".", does anything else crash with POSIX sh?



---

archive/issue_comments_314333.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:27 embray]:\n> It would still be much slower just by involving Python.\n\n\nWhy do you think that? It just needs to read of bunch of files and do some string manipulation. It should be easy.\n\n> It would still be an (actual!) abuse of autoconf.\n\n\nI'm not denying that...\n\nStill, I think it would be fast, work well and produce readable output. So I think that you should at least seriously consider it.",
    "created_at": "2018-02-01T11:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314333",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>Replying to [comment:27 embray]:
> It would still be much slower just by involving Python.


Why do you think that? It just needs to read of bunch of files and do some string manipulation. It should be easy.

> It would still be an (actual!) abuse of autoconf.


I'm not denying that...

Still, I think it would be fast, work well and produce readable output. So I think that you should at least seriously consider it.



---

archive/issue_comments_314334.json:
```json
{
    "body": "<a id='comment:32'></a>Let's give this a try for now (modulo other review comments). I sympathize with your concerns but I strongly *suspect* that they will prove overstated.  If it turns into a concrete problem somehow then I'll reconsider.",
    "created_at": "2018-02-01T12:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314334",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>Let's give this a try for now (modulo other review comments). I sympathize with your concerns but I strongly *suspect* that they will prove overstated.  If it turns into a concrete problem somehow then I'll reconsider.



---

archive/issue_comments_314335.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:30 mjo]:\n> While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.\n\n\nI'm going to try to do a bit of reformatting to make it a little easier to read.\n\n> Other ideas:\n> \n> 1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where \"make\" isn't GNU?\n\n\nOne thing I'll point out that I haven't explicitly mentioned yet: I asked a few people about this before doing the work (I forget who) but at the time everyone seemed to agree that it would be fine to require GNU make, as there are other packages in Sage that require it, so building the full Sage-the-distribution doesn't work with any other make implementation anyways.\n\nI suppose we could do that though.\n\n> 2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)\n\n\nRight; originally we had ` SHELL = `command -v bash` ` here.  I'll fix that.\n\n> 3. Is Bash needed for the makefile at all? If we replace \"source\" with \".\", does anything else crash with POSIX sh?\n\n\nI'm not sure it's necessarily strictly needed for the makefile itself, but it in turn calls scripts that require bash, so I don't see any advantage in not just forcing bash in the makefile as well.",
    "created_at": "2018-02-01T12:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314335",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>Replying to [comment:30 mjo]:
> While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.


I'm going to try to do a bit of reformatting to make it a little easier to read.

> Other ideas:
> 
> 1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where "make" isn't GNU?


One thing I'll point out that I haven't explicitly mentioned yet: I asked a few people about this before doing the work (I forget who) but at the time everyone seemed to agree that it would be fine to require GNU make, as there are other packages in Sage that require it, so building the full Sage-the-distribution doesn't work with any other make implementation anyways.

I suppose we could do that though.

> 2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)


Right; originally we had ` SHELL = `command -v bash` ` here.  I'll fix that.

> 3. Is Bash needed for the makefile at all? If we replace "source" with ".", does anything else crash with POSIX sh?


I'm not sure it's necessarily strictly needed for the makefile itself, but it in turn calls scripts that require bash, so I don't see any advantage in not just forcing bash in the makefile as well.



---

archive/issue_comments_314336.json:
```json
{
    "body": "<a id='comment:34'></a>One other issue I noticed while working on cleaning this up and adding better debugging tools, is that this doesn't currently handle order-only prerequisites correctly.  This was definitely obscured before, but will be easy to fix.",
    "created_at": "2018-02-01T13:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314336",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>One other issue I noticed while working on cleaning this up and adding better debugging tools, is that this doesn't currently handle order-only prerequisites correctly.  This was definitely obscured before, but will be easy to fix.



---

archive/issue_comments_314337.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-01T14:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314338.json:
```json
{
    "body": "<a id='comment:36'></a>Last commit made the templates look a bit less noisy.  For example, before:\n\n```\ndefine NORMAL_PACKAGE_templ\n$$(INST)/$(1)-$$(vers_$(1)): $$(foreach dep,$$(deps_$(1)),$$(inst_$$(dep)))\n\t+$(AM_V_at)sage-logger -p '$(SAGE_SPKG) $(1)-$$(vers_$(1))' '$(SAGE_LOGS)/$(1)-$$(vers_$(1)).log'\n \n$(1): $$(INST)/$(1)-$$(vers_$(1))\n \n$(1)-clean:\n\trm -rf $$(INST)/$(1)-$$(vers_$(1))\nendef\n```\n\nand after:\n\n```\ndefine NORMAL_PACKAGE_templ\n$$(INST)/$(1)-$(2): $(3)\n\t+$(AM_V_at)sage-logger -p '$$(SAGE_SPKG) $(1)-$(2)' '$$(SAGE_LOGS)/$(1)-$(2).log'\n \n$(1): $$(INST)/$(1)-$(2)\n \n$(1)-clean:\n\trm -rf $$(INST)/$(1)-$(2)\nendef\n```\n\nI also added the `DEBUG_RULES` flag that I mentioned on sage-devel.  If you run the generated makefile in dry-run mode with this flag defined you can see exactly what the templates are outputting:\n\n```\n$ make -f build/make/Makefile -n DEBUG_RULES=1\n# Rules for standard packages\n$(INST)/4ti2-1.6.7:   $(inst_zlib)  $(inst_mpir)  $(inst_glpk)\n        +sage-logger -p '$(SAGE_SPKG) 4ti2-1.6.7' '$(SAGE_LOGS)/4ti2-1.6.7.log'\n\n4ti2: $(INST)/4ti2-1.6.7\n\n4ti2-clean:\n        rm -rf $(INST)/4ti2-1.6.7\n\n$(INST)/alabaster-0.7.10:   $(inst_python2)  |  $(inst_pip)\n        +sage-logger -p '$(SAGE_SPKG) alabaster-0.7.10' '$(SAGE_LOGS)/alabaster-0.7.10.log'\n...\n```",
    "created_at": "2018-02-01T14:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314338",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>Last commit made the templates look a bit less noisy.  For example, before:

```
define NORMAL_PACKAGE_templ
$$(INST)/$(1)-$$(vers_$(1)): $$(foreach dep,$$(deps_$(1)),$$(inst_$$(dep)))
	+$(AM_V_at)sage-logger -p '$(SAGE_SPKG) $(1)-$$(vers_$(1))' '$(SAGE_LOGS)/$(1)-$$(vers_$(1)).log'
 
$(1): $$(INST)/$(1)-$$(vers_$(1))
 
$(1)-clean:
	rm -rf $$(INST)/$(1)-$$(vers_$(1))
endef
```

and after:

```
define NORMAL_PACKAGE_templ
$$(INST)/$(1)-$(2): $(3)
	+$(AM_V_at)sage-logger -p '$$(SAGE_SPKG) $(1)-$(2)' '$$(SAGE_LOGS)/$(1)-$(2).log'
 
$(1): $$(INST)/$(1)-$(2)
 
$(1)-clean:
	rm -rf $$(INST)/$(1)-$(2)
endef
```

I also added the `DEBUG_RULES` flag that I mentioned on sage-devel.  If you run the generated makefile in dry-run mode with this flag defined you can see exactly what the templates are outputting:

```
$ make -f build/make/Makefile -n DEBUG_RULES=1
# Rules for standard packages
$(INST)/4ti2-1.6.7:   $(inst_zlib)  $(inst_mpir)  $(inst_glpk)
        +sage-logger -p '$(SAGE_SPKG) 4ti2-1.6.7' '$(SAGE_LOGS)/4ti2-1.6.7.log'

4ti2: $(INST)/4ti2-1.6.7

4ti2-clean:
        rm -rf $(INST)/4ti2-1.6.7

$(INST)/alabaster-0.7.10:   $(inst_python2)  |  $(inst_pip)
        +sage-logger -p '$(SAGE_SPKG) alabaster-0.7.10' '$(SAGE_LOGS)/alabaster-0.7.10.log'
...
```



---

archive/issue_comments_314339.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-01T14:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314340.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-01T15:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314341.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-01T16:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314342.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:32 embray]:\n> I sympathize with your concerns but I strongly *suspect* that they will prove overstated.\n\n\nI really hope that you are right and that this won't turn in a \"I told you so\" scenario.\n\nI'll stop protesting for now. There is not much to discuss further anyway, we each know the other's opinions.",
    "created_at": "2018-02-01T17:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314342",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>Replying to [comment:32 embray]:
> I sympathize with your concerns but I strongly *suspect* that they will prove overstated.


I really hope that you are right and that this won't turn in a "I told you so" scenario.

I'll stop protesting for now. There is not much to discuss further anyway, we each know the other's opinions.



---

archive/issue_comments_314343.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:40 jdemeyer]:\n> Replying to [comment:32 embray]:\n> > I sympathize with your concerns but I strongly *suspect* that they will prove overstated.\n\n> \n> I really hope that you are right and that this won't turn in a \"I told you so\" scenario.\n\n\nIf it does, I promise that I'll graciously accept that you were right :)",
    "created_at": "2018-02-02T12:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314343",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>Replying to [comment:40 jdemeyer]:
> Replying to [comment:32 embray]:
> > I sympathize with your concerns but I strongly *suspect* that they will prove overstated.

> 
> I really hope that you are right and that this won't turn in a "I told you so" scenario.


If it does, I promise that I'll graciously accept that you were right :)



---

archive/issue_comments_314344.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-02T12:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314344",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314345.json:
```json
{
    "body": "<a id='comment:42'></a>Also, I think that I've addressed most of the other review comments so far....",
    "created_at": "2018-02-02T12:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314345",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>Also, I think that I've addressed most of the other review comments so far....



---

archive/issue_comments_314346.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-16T16:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314346",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314347.json:
```json
{
    "body": "<a id='comment:44'></a>Rebased to incorporate #24729",
    "created_at": "2018-02-16T16:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314347",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>Rebased to incorporate #24729



---

archive/issue_comments_314348.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-19T16:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314349.json:
```json
{
    "body": "<a id='comment:46'></a>Rebased again and incorporated #24703.",
    "created_at": "2018-02-19T16:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314349",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>Rebased again and incorporated #24703.



---

archive/issue_comments_314350.json:
```json
{
    "body": "<a id='comment:47'></a>needs rebase",
    "created_at": "2018-03-03T07:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314350",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:47'></a>needs rebase



---

archive/issue_comments_314351.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-03T07:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314351",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_314352.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-05T11:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_314353.json:
```json
{
    "body": "<a id='comment:49'></a>The longer this stays open the harder it is to keep it maintained because it will conflict with anything that modifies `configure.ac`.",
    "created_at": "2018-03-05T11:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314353",
    "user": "https://github.com/embray"
}
```

<a id='comment:49'></a>The longer this stays open the harder it is to keep it maintained because it will conflict with anything that modifies `configure.ac`.



---

archive/issue_comments_314354.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-05T11:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314354",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314355.json:
```json
{
    "body": "<a id='comment:50'></a>Ok. Reviewing this now\u2026",
    "created_at": "2018-03-05T12:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314355",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:50'></a>Ok. Reviewing this now…



---

archive/issue_comments_314356.json:
```json
{
    "body": "<a id='comment:51'></a>Thanks for this very nice summary in the README. If you have checked that this actually works, feel free to set this to positive review.",
    "created_at": "2018-03-05T12:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314356",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:51'></a>Thanks for this very nice summary in the README. If you have checked that this actually works, feel free to set this to positive review.



---

archive/issue_comments_314357.json:
```json
{
    "body": "<a id='comment:52'></a>There's one last change I would like to make, though it shouldn't substantially alter anything.  I just want to move all the stuff that collects the packages into its own macro, and move it to a separate file.\n\nI already did this in another branch, but it doesn't make particular sense to leave out of this ticket.",
    "created_at": "2018-03-06T12:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314357",
    "user": "https://github.com/embray"
}
```

<a id='comment:52'></a>There's one last change I would like to make, though it shouldn't substantially alter anything.  I just want to move all the stuff that collects the packages into its own macro, and move it to a separate file.

I already did this in another branch, but it doesn't make particular sense to leave out of this ticket.



---

archive/issue_comments_314358.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-06T13:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314359.json:
```json
{
    "body": "<a id='comment:54'></a>Will be interesting to see how the buildbots do with this.",
    "created_at": "2018-03-06T13:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314359",
    "user": "https://github.com/embray"
}
```

<a id='comment:54'></a>Will be interesting to see how the buildbots do with this.



---

archive/issue_comments_314360.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-06T13:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314360",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314361.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-03-06T14:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314361",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_314362.json:
```json
{
    "body": "<a id='comment:55'></a>There appears to be a bug in outputting the package versions during the configure checks.  This might have been introduced in my last rebase...",
    "created_at": "2018-03-06T14:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314362",
    "user": "https://github.com/embray"
}
```

<a id='comment:55'></a>There appears to be a bug in outputting the package versions during the configure checks.  This might have been introduced in my last rebase...



---

archive/issue_comments_314363.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-06T14:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314363",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314364.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-03-06T14:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314364",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_314365.json:
```json
{
    "body": "<a id='comment:58'></a>Ok. Your recent changes look good to me.",
    "created_at": "2018-03-07T11:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314365",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:58'></a>Ok. Your recent changes look good to me.



---

archive/issue_events_057129.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-08T00:02:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57129"
}
```



---

archive/issue_comments_314366.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-08T00:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314366",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_314367.json:
```json
{
    "body": "<a id='comment:60'></a>This completely breaks upgrading Sage, it seems to me. On three different OS X machines with 8.2.beta7 installed, upgrading to 8.2.beta8, or in particular just using this branch, results in a bad `build/make/Makefile`: lines like\n\n```\ndeps_4ti2 =  $(SAGE_LOCAL)/bin/gcczlib $(MP_LIBRARY) glpk\ndeps_alabaster =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip\ndeps_appnope =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip\n```\nPlease fix this.",
    "created_at": "2018-03-12T18:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314367",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:60'></a>This completely breaks upgrading Sage, it seems to me. On three different OS X machines with 8.2.beta7 installed, upgrading to 8.2.beta8, or in particular just using this branch, results in a bad `build/make/Makefile`: lines like

```
deps_4ti2 =  $(SAGE_LOCAL)/bin/gcczlib $(MP_LIBRARY) glpk
deps_alabaster =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip
deps_appnope =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip
```
Please fix this.



---

archive/issue_comments_314368.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-03-12T19:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314368",
    "user": "https://github.com/embray"
}
```

Changing status from closed to new.



---

archive/issue_events_057130.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-12T19:25:31Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57130"
}
```



---

archive/issue_comments_314369.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-03-12T19:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314369",
    "user": "https://github.com/embray"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_314370.json:
```json
{
    "body": "<a id='comment:61'></a>Indeed, it looks like a bug introduced upon the last rebase.  I didn't catch it because it only affects if you are using Sage's `gcc` spkg.",
    "created_at": "2018-03-12T19:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314370",
    "user": "https://github.com/embray"
}
```

<a id='comment:61'></a>Indeed, it looks like a bug introduced upon the last rebase.  I didn't catch it because it only affects if you are using Sage's `gcc` spkg.



---

archive/issue_comments_314371.json:
```json
{
    "body": "<a id='comment:62'></a>Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...",
    "created_at": "2018-03-12T19:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314371",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'></a>Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...



---

archive/issue_comments_314372.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:62 embray]:\n> Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...\n\n\nI take that back--the missing space is in my code.",
    "created_at": "2018-03-12T19:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314372",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'></a>Replying to [comment:62 embray]:
> Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...


I take that back--the missing space is in my code.



---

archive/issue_comments_314373.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-12T19:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314373",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314374.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-12T19:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314374",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_057131.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-12T19:42:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21524#event-57131"
}
```



---

archive/issue_comments_314375.json:
```json
{
    "body": "<a id='comment:65'></a>You cannot just re-open a ticket. Only the release manager should do that.",
    "created_at": "2018-03-12T19:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314375",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>You cannot just re-open a ticket. Only the release manager should do that.



---

archive/issue_comments_314376.json:
```json
{
    "body": "<a id='comment:66'></a>Especially this ticket must not be re-opened since it has already been released. Just open a new ticket to fix it.",
    "created_at": "2018-03-12T19:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314376",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'></a>Especially this ticket must not be re-opened since it has already been released. Just open a new ticket to fix it.



---

archive/issue_comments_314377.json:
```json
{
    "body": "<a id='comment:67'></a>It's not in the latest beta yet.",
    "created_at": "2018-03-12T19:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314377",
    "user": "https://github.com/embray"
}
```

<a id='comment:67'></a>It's not in the latest beta yet.



---

archive/issue_comments_314378.json:
```json
{
    "body": "<a id='comment:68'></a>Oops, apparently it is.  If I had thought otherwise I wouldn't have reopened.  Strange--I just checked too any I didn't see it.",
    "created_at": "2018-03-12T19:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314378",
    "user": "https://github.com/embray"
}
```

<a id='comment:68'></a>Oops, apparently it is.  If I had thought otherwise I wouldn't have reopened.  Strange--I just checked too any I didn't see it.



---

archive/issue_comments_314379.json:
```json
{
    "body": "<a id='comment:69'></a>Followup in #24961.",
    "created_at": "2018-03-12T19:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314379",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>Followup in #24961.



---

archive/issue_comments_314380.json:
```json
{
    "body": "<a id='comment:70'></a>Thanks for the quick diagnosis, by the way!",
    "created_at": "2018-03-13T02:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314380",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:70'></a>Thanks for the quick diagnosis, by the way!



---

archive/issue_comments_314381.json:
```json
{
    "body": "<a id='comment:71'></a>Replying to [comment:70 jhpalmieri]:\n> Thanks for the quick diagnosis, by the way!\n\n\nNo, thank you for pointing it out.",
    "created_at": "2018-03-13T14:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314381",
    "user": "https://github.com/embray"
}
```

<a id='comment:71'></a>Replying to [comment:70 jhpalmieri]:
> Thanks for the quick diagnosis, by the way!


No, thank you for pointing it out.



---

archive/issue_comments_314382.json:
```json
{
    "body": "<a id='comment:72'></a>Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.",
    "created_at": "2018-03-17T07:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314382",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.



---

archive/issue_comments_314383.json:
```json
{
    "body": "<a id='comment:73'></a>This might have broken `$(SAGERUNTIME)`: #24995",
    "created_at": "2018-03-17T18:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314383",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:73'></a>This might have broken `$(SAGERUNTIME)`: #24995



---

archive/issue_comments_314384.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:72 jdemeyer]:\n> Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.\n\n\nI just noticed this comment.  That was *not* intentional.  Probably a mis-resolved conflict (though I don't know why since I never made any edits to that file in the first place).",
    "created_at": "2018-03-21T16:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314384",
    "user": "https://github.com/embray"
}
```

<a id='comment:74'></a>Replying to [comment:72 jdemeyer]:
> Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.


I just noticed this comment.  That was *not* intentional.  Probably a mis-resolved conflict (though I don't know why since I never made any edits to that file in the first place).



---

archive/issue_comments_314385.json:
```json
{
    "body": "<a id='comment:75'></a>`DUMMY_PACKAGES` seems broken: #25188",
    "created_at": "2018-04-17T09:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314385",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:75'></a>`DUMMY_PACKAGES` seems broken: #25188



---

archive/issue_comments_314386.json:
```json
{
    "body": "<a id='comment:76'></a>What was the purpose of this change:\n\n```diff\n@@ -58,11 +58,11 @@ all-sage: \\\n # option to make forces all targets to be built unconditionally)\n download-for-sdist: base\n        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \\\n-               $(SDIST_PACKAGES)\n+               $(SDIST_PACKAGE_INSTS)\n \n```\n\nIt has broken sdists, see #25319.",
    "created_at": "2018-06-08T08:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21524#issuecomment-314386",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:76'></a>What was the purpose of this change:

```diff
@@ -58,11 +58,11 @@ all-sage: \
 # option to make forces all targets to be built unconditionally)
 download-for-sdist: base
        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \
-               $(SDIST_PACKAGES)
+               $(SDIST_PACKAGE_INSTS)
 
```

It has broken sdists, see #25319.
