# Issue 21779: py3 get rid of cmp() in some cython files

archive/issues_021542.json:
```json
{
    "body": "as a very tiny step in the huge cmp problem\n\ndone by using `PyObject_RichCompare`.\n\n**CC:**  @jm58660 @tscrim @a-andre @jdemeyer\n\n**Branch:** [c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21779\n\n",
    "closed_at": "2016-11-08T23:42:11Z",
    "created_at": "2016-10-28T18:24:12Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "py3 get rid of cmp() in some cython files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21779",
    "user": "https://github.com/fchapoton"
}
```
as a very tiny step in the huge cmp problem

done by using `PyObject_RichCompare`.

**CC:**  @jm58660 @tscrim @a-andre @jdemeyer

**Branch:** [c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/21779





---

archive/issue_comments_404814.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db\">a4d7648</a></td><td><code>get rid of a bunch of cmp() in some cython files</code></td></tr></table>\n",
    "created_at": "2016-10-28T18:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404814",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db">a4d7648</a></td><td><code>get rid of a bunch of cmp() in some cython files</code></td></tr></table>




---

archive/issue_comments_404815.json:
```json
{
    "body": "**Branch:** [u/chapoton/21779](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21779)",
    "created_at": "2016-10-28T18:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404815",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/21779](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21779)



---

archive/issue_comments_404816.json:
```json
{
    "body": "**Commit:** [a4d764816dd15738b90bc66d9dcbff6336ddb2db](https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db)",
    "created_at": "2016-10-28T18:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404816",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [a4d764816dd15738b90bc66d9dcbff6336ddb2db](https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db)



---

archive/issue_comments_404817.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-10-28T18:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404817",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_404818.json:
```json
{
    "body": "<a id='comment:2'></a>\nIn **Cython** files, use **C** or **Cython** functions, don't `import richcmp`, just use `PyObject_RichCompare`.",
    "created_at": "2016-10-28T23:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404818",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
In **Cython** files, use **C** or **Cython** functions, don't `import richcmp`, just use `PyObject_RichCompare`.



---

archive/issue_comments_404819.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-10-28T23:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404819",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_404820.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n as a very tiny step in the huge cmp problem\n \n-done by using richcmp\n+done by using `PyObject_RichCompare`.\n``````\n",
    "created_at": "2016-10-28T23:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404820",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 as a very tiny step in the huge cmp problem
 
-done by using richcmp
+done by using `PyObject_RichCompare`.
``````




---

archive/issue_comments_404821.json:
```json
{
    "body": "<a id='comment:4'></a>\nAlso, `raise NotImplemented` should be `return NotImplemented`.",
    "created_at": "2016-10-28T23:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404821",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Also, `raise NotImplemented` should be `return NotImplemented`.



---

archive/issue_comments_404822.json:
```json
{
    "body": "**Changing commit** from \"[a4d764816dd15738b90bc66d9dcbff6336ddb2db](https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db)\" to \"[ebb3663b21c4c31c007450168e6c03edfc2dcc1e](https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e)\".",
    "created_at": "2016-10-29T07:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a4d764816dd15738b90bc66d9dcbff6336ddb2db](https://github.com/sagemath/sagetrac-mirror/commit/a4d764816dd15738b90bc66d9dcbff6336ddb2db)" to "[ebb3663b21c4c31c007450168e6c03edfc2dcc1e](https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e)".



---

archive/issue_comments_404823.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e\">ebb3663</a></td><td><code>trac 21779 using Pyobject_richcompare instead</code></td></tr></table>\n",
    "created_at": "2016-10-29T07:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e">ebb3663</a></td><td><code>trac 21779 using Pyobject_richcompare instead</code></td></tr></table>




---

archive/issue_comments_404824.json:
```json
{
    "body": "<a id='comment:6'></a>\ndone, thanks",
    "created_at": "2016-10-29T07:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404824",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
done, thanks



---

archive/issue_comments_404825.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-10-29T07:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404825",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_404826.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe code in `src/sage/modular/arithgroup/farey_symbol.pyx` is less efficient than before because it no longer \"lazily\" computes the `cusps()` and `fractions()` methods.",
    "created_at": "2016-10-29T10:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404826",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
The code in `src/sage/modular/arithgroup/farey_symbol.pyx` is less efficient than before because it no longer "lazily" computes the `cusps()` and `fractions()` methods.



---

archive/issue_comments_404827.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-10-29T10:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404827",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_404828.json:
```json
{
    "body": "<a id='comment:8'></a>\nSee also ticket:21176#comment:6",
    "created_at": "2016-10-29T10:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404828",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
See also ticket:21176#comment:6



---

archive/issue_comments_404829.json:
```json
{
    "body": "**Changing commit** from \"[ebb3663b21c4c31c007450168e6c03edfc2dcc1e](https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e)\" to \"[405a5ce07e4b08d17b80b975dd88cf27d3df21fa](https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa)\".",
    "created_at": "2016-10-29T14:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ebb3663b21c4c31c007450168e6c03edfc2dcc1e](https://github.com/sagemath/sagetrac-mirror/commit/ebb3663b21c4c31c007450168e6c03edfc2dcc1e)" to "[405a5ce07e4b08d17b80b975dd88cf27d3df21fa](https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa)".



---

archive/issue_comments_404830.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa\">405a5ce</a></td><td><code>trac 21779 introducing auxiliary function for sequential rich comparison</code></td></tr></table>\n",
    "created_at": "2016-10-29T14:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa">405a5ce</a></td><td><code>trac 21779 introducing auxiliary function for sequential rich comparison</code></td></tr></table>




---

archive/issue_comments_404831.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-10-29T14:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404831",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_404832.json:
```json
{
    "body": "<a id='comment:10'></a>\nok, I was expecting this answer...\n\nI introduced an helper function, to be used in this kind of situation.",
    "created_at": "2016-10-29T14:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404832",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok, I was expecting this answer...

I introduced an helper function, to be used in this kind of situation.



---

archive/issue_comments_404833.json:
```json
{
    "body": "<a id='comment:11'></a>\nPatchbot is green. I am not sure to have done the helper function in a proper way. I had to use richcmp to make it work, but maybe you would know a way to use PyObject_RichCompare ?",
    "created_at": "2016-10-30T14:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404833",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
Patchbot is green. I am not sure to have done the helper function in a proper way. I had to use richcmp to make it work, but maybe you would know a way to use PyObject_RichCompare ?



---

archive/issue_comments_404834.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-01T09:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404834",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_404835.json:
```json
{
    "body": "<a id='comment:12'></a>\n1. `elif op in [Py_LT, Py_GT, Py_LE, Py_GE]:` should be optimized to `else`.\n\n2. `richcmp_step` needs better documentation of what it does and how it should be used. Simply saying \"assumed to be only a non-final step in a sequence of several comparison checks.\" is absolutely not clear enough.\n\n3. Using `richcmp` is fine. The problem is *importing* `richcmp` (introducing Python overhead), not calling it.\n\n4. Replace `not(step is None)` by `step is not None`.\n\n5. Replace `richcmp(x, y, Py_EQ)` by `x == y`. Similarly, inside the first `if` branches where you know what `op` is.\n\n6. I still have to check whether your helper function is better/worse/equivalent to my proposal in ticket:21176#comment:6",
    "created_at": "2016-11-01T09:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404835",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
1. `elif op in [Py_LT, Py_GT, Py_LE, Py_GE]:` should be optimized to `else`.

2. `richcmp_step` needs better documentation of what it does and how it should be used. Simply saying "assumed to be only a non-final step in a sequence of several comparison checks." is absolutely not clear enough.

3. Using `richcmp` is fine. The problem is *importing* `richcmp` (introducing Python overhead), not calling it.

4. Replace `not(step is None)` by `step is not None`.

5. Replace `richcmp(x, y, Py_EQ)` by `x == y`. Similarly, inside the first `if` branches where you know what `op` is.

6. I still have to check whether your helper function is better/worse/equivalent to my proposal in ticket:21176#comment:6



---

archive/issue_comments_404836.json:
```json
{
    "body": "<a id='comment:13'></a>\nIn terms of behaviour, the use of your helper function looks identical to my proposal in ticket:21176#comment:6 (assuming that `x != y` is equivalent to `not x == y`).\n\nBut your code looks slightly less efficient (you always call `richcmp_step` and then check the result to `None` while I only call `richcmp_not_equal` when I know that the answer will be useful). Given that your code is not shorter nor more understandable, I don't see the advantage.\n\nI don't feel very strongly about this about this, but it makes me wonder why you didn't just implement ticket:21176#comment:6",
    "created_at": "2016-11-01T09:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404836",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
In terms of behaviour, the use of your helper function looks identical to my proposal in ticket:21176#comment:6 (assuming that `x != y` is equivalent to `not x == y`).

But your code looks slightly less efficient (you always call `richcmp_step` and then check the result to `None` while I only call `richcmp_not_equal` when I know that the answer will be useful). Given that your code is not shorter nor more understandable, I don't see the advantage.

I don't feel very strongly about this about this, but it makes me wonder why you didn't just implement ticket:21176#comment:6



---

archive/issue_comments_404837.json:
```json
{
    "body": "<a id='comment:14'></a>\n7. I would prefer to use `NotImplemented` to signal \"maybe\" instead of `None`.\n\n8. Code like\n\n```\nif richcmp(x, y, op):\n    return True\nelse:\n    return False\n```\ncould be shorted to `return richcmp(x, y, op)`.",
    "created_at": "2016-11-01T09:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404837",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
7. I would prefer to use `NotImplemented` to signal "maybe" instead of `None`.

8. Code like

```
if richcmp(x, y, op):
    return True
else:
    return False
```
could be shorted to `return richcmp(x, y, op)`.



---

archive/issue_comments_404838.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0faf9cd1f95724b5930d831eb2a12793dccb7585\">0faf9cd</a></td><td><code>Merge branch 'u/chapoton/21779' in 7.5.b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51\">9ee5a9d</a></td><td><code>trac 21779 reviewer's comments</code></td></tr></table>\n",
    "created_at": "2016-11-01T10:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0faf9cd1f95724b5930d831eb2a12793dccb7585">0faf9cd</a></td><td><code>Merge branch 'u/chapoton/21779' in 7.5.b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51">9ee5a9d</a></td><td><code>trac 21779 reviewer's comments</code></td></tr></table>




---

archive/issue_comments_404839.json:
```json
{
    "body": "**Changing commit** from \"[405a5ce07e4b08d17b80b975dd88cf27d3df21fa](https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa)\" to \"[9ee5a9d4515468c9210c2285255b0a2ef7bcfb51](https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51)\".",
    "created_at": "2016-11-01T10:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[405a5ce07e4b08d17b80b975dd88cf27d3df21fa](https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa)" to "[9ee5a9d4515468c9210c2285255b0a2ef7bcfb51](https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51)".



---

archive/issue_comments_404840.json:
```json
{
    "body": "<a id='comment:16'></a>\nThanks for the review.\n\n1: Done\n\n2: I have added some documentation, tell me if this is enough.\n\n3: so there is nothing to do, right ?\n\n4: Done\n\n5: Done in all possible places\n\n6: I see several differences: ~~mine compares the (potentially complex) objects at most once except when absolutely needed (yours does this always twice), and has the correct behaviour for NE (not sure about yours for that)~~\n\n**EDIT**: in fact, there is no real difference, maybe. I prefer the logic of mine, but let me think about that.\n\n7: I would prefer to keep `None`, because `NotImplemented` has a different precise \nsemantic. Of course the ideal would be `Maybe`, but there is no such constant, AFAIK\n\n8: Done",
    "created_at": "2016-11-01T10:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404840",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Thanks for the review.

1: Done

2: I have added some documentation, tell me if this is enough.

3: so there is nothing to do, right ?

4: Done

5: Done in all possible places

6: I see several differences: ~~mine compares the (potentially complex) objects at most once except when absolutely needed (yours does this always twice), and has the correct behaviour for NE (not sure about yours for that)~~

**EDIT**: in fact, there is no real difference, maybe. I prefer the logic of mine, but let me think about that.

7: I would prefer to keep `None`, because `NotImplemented` has a different precise 
semantic. Of course the ideal would be `Maybe`, but there is no such constant, AFAIK

8: Done



---

archive/issue_comments_404841.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25\">b413eb4</a></td><td><code>trac 21779 switching to richcmp_not_equal solution instead</code></td></tr></table>\n",
    "created_at": "2016-11-01T12:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25">b413eb4</a></td><td><code>trac 21779 switching to richcmp_not_equal solution instead</code></td></tr></table>




---

archive/issue_comments_404842.json:
```json
{
    "body": "**Changing commit** from \"[9ee5a9d4515468c9210c2285255b0a2ef7bcfb51](https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51)\" to \"[b413eb432a276f6b49774ea4ae330541a197ea25](https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25)\".",
    "created_at": "2016-11-01T12:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9ee5a9d4515468c9210c2285255b0a2ef7bcfb51](https://github.com/sagemath/sagetrac-mirror/commit/9ee5a9d4515468c9210c2285255b0a2ef7bcfb51)" to "[b413eb432a276f6b49774ea4ae330541a197ea25](https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25)".



---

archive/issue_comments_404843.json:
```json
{
    "body": "<a id='comment:18'></a>\nok, after reflexion, I decided to use your proposal. This is slightly less intuitive to use, maybe.",
    "created_at": "2016-11-01T12:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404843",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
ok, after reflexion, I decided to use your proposal. This is slightly less intuitive to use, maybe.



---

archive/issue_comments_404844.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-01T12:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404844",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_404845.json:
```json
{
    "body": "<a id='comment:19'></a>\nFYI: There is an `Unknown` object in Sage.",
    "created_at": "2016-11-01T13:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404845",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
FYI: There is an `Unknown` object in Sage.



---

archive/issue_comments_404846.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [chapoton](#comment%3A16):\n> 7: I would prefer to keep `None`, because `NotImplemented` has a different precise \n> semantic.\n\n\nThe object `NotImplemented` is used whenever a comparison function cannot decide what the result of the comparison is. That looks very much like what is needed here.",
    "created_at": "2016-11-01T14:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404846",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [chapoton](#comment%3A16):
> 7: I would prefer to keep `None`, because `NotImplemented` has a different precise 
> semantic.


The object `NotImplemented` is used whenever a comparison function cannot decide what the result of the comparison is. That looks very much like what is needed here.



---

archive/issue_comments_404847.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnyway, `None` is not longer used here, no need to find a better replacement.",
    "created_at": "2016-11-01T14:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404847",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
Anyway, `None` is not longer used here, no need to find a better replacement.



---

archive/issue_comments_404848.json:
```json
{
    "body": "<a id='comment:22'></a>\nRight!",
    "created_at": "2016-11-01T16:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404848",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Right!



---

archive/issue_comments_404849.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2016-11-01T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404849",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_404850.json:
```json
{
    "body": "<a id='comment:23'></a>\n`cimport`, not `import`!\n\n```\nfrom sage.structure.sage_object import richcmp_not_equal\n```",
    "created_at": "2016-11-01T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404850",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
`cimport`, not `import`!

```
from sage.structure.sage_object import richcmp_not_equal
```



---

archive/issue_comments_404851.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-11-01T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404851",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_404852.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6\">dc4cad5</a></td><td><code>trac 21779 cimport</code></td></tr></table>\n",
    "created_at": "2016-11-01T17:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6">dc4cad5</a></td><td><code>trac 21779 cimport</code></td></tr></table>




---

archive/issue_comments_404853.json:
```json
{
    "body": "**Changing commit** from \"[b413eb432a276f6b49774ea4ae330541a197ea25](https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25)\" to \"[dc4cad590ea167558a91e7240146171744db13a6](https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6)\".",
    "created_at": "2016-11-01T17:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b413eb432a276f6b49774ea4ae330541a197ea25](https://github.com/sagemath/sagetrac-mirror/commit/b413eb432a276f6b49774ea4ae330541a197ea25)" to "[dc4cad590ea167558a91e7240146171744db13a6](https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6)".



---

archive/issue_comments_404854.json:
```json
{
    "body": "<a id='comment:25'></a>\ndone so in the code. Should I change that in the examples too ?",
    "created_at": "2016-11-01T17:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404854",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
done so in the code. Should I change that in the examples too ?



---

archive/issue_comments_404855.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe examples are in Python, so you cannot `cimport`.",
    "created_at": "2016-11-01T19:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404855",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
The examples are in Python, so you cannot `cimport`.



---

archive/issue_comments_404856.json:
```json
{
    "body": "<a id='comment:27'></a>\nNeeds review?",
    "created_at": "2016-11-01T21:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404856",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Needs review?



---

archive/issue_comments_404857.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-02T07:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404857",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_404858.json:
```json
{
    "body": "<a id='comment:28'></a>\nyes, of course\n\nnote that I have not re-compiled to check that it works",
    "created_at": "2016-11-02T07:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404858",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>
yes, of course

note that I have not re-compiled to check that it works



---

archive/issue_comments_404859.json:
```json
{
    "body": "<a id='comment:29'></a>\nLet's see what the patchbot says.\n\nOne detail: this is not entirely true:\n\n```\nOUTPUT: ``True`` or ``False``\n```\nsince rich comparisons are not required to return `True` or `False`. I would be explicit and say something like:\n\n```\nOUTPUT: If ``op`` is not ``op_EQ`` or ``op_NE``, the result of ``richcmp(x, y, op)``. If ``op`` is ``op_EQ``, return ``False``. If ``op`` is ``op_NE``, return ``True``.\n```",
    "created_at": "2016-11-02T07:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404859",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Let's see what the patchbot says.

One detail: this is not entirely true:

```
OUTPUT: ``True`` or ``False``
```
since rich comparisons are not required to return `True` or `False`. I would be explicit and say something like:

```
OUTPUT: If ``op`` is not ``op_EQ`` or ``op_NE``, the result of ``richcmp(x, y, op)``. If ``op`` is ``op_EQ``, return ``False``. If ``op`` is ``op_NE``, return ``True``.
```



---

archive/issue_comments_404860.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9\">7980952</a></td><td><code>trac 21779 a typo</code></td></tr></table>\n",
    "created_at": "2016-11-02T12:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9">7980952</a></td><td><code>trac 21779 a typo</code></td></tr></table>




---

archive/issue_comments_404861.json:
```json
{
    "body": "**Changing commit** from \"[dc4cad590ea167558a91e7240146171744db13a6](https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6)\" to \"[798095224b421311fe7e2dba58728b63a5a583c9](https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9)\".",
    "created_at": "2016-11-02T12:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dc4cad590ea167558a91e7240146171744db13a6](https://github.com/sagemath/sagetrac-mirror/commit/dc4cad590ea167558a91e7240146171744db13a6)" to "[798095224b421311fe7e2dba58728b63a5a583c9](https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9)".



---

archive/issue_comments_404862.json:
```json
{
    "body": "**Changing commit** from \"[798095224b421311fe7e2dba58728b63a5a583c9](https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9)\" to \"[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)\".",
    "created_at": "2016-11-02T13:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[798095224b421311fe7e2dba58728b63a5a583c9](https://github.com/sagemath/sagetrac-mirror/commit/798095224b421311fe7e2dba58728b63a5a583c9)" to "[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)".



---

archive/issue_comments_404863.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293\">c6cad87</a></td><td><code>trac 21779 change in OUTPUT</code></td></tr></table>\n",
    "created_at": "2016-11-02T13:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293">c6cad87</a></td><td><code>trac 21779 change in OUTPUT</code></td></tr></table>




---

archive/issue_comments_404864.json:
```json
{
    "body": "<a id='comment:32'></a>\nPositive_review if this passes tests.",
    "created_at": "2016-11-02T21:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404864",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Positive_review if this passes tests.



---

archive/issue_comments_404865.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-11-03T07:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404865",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_404866.json:
```json
{
    "body": "<a id='comment:33'></a>\nok, bot is green. Thanks for the review.",
    "created_at": "2016-11-03T07:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404866",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>
ok, bot is green. Thanks for the review.



---

archive/issue_comments_404867.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-11-08T23:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404867",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_404868.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/21779](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21779)\" to \"[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)\".",
    "created_at": "2016-11-08T23:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404868",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/21779](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/21779)" to "[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)".



---

archive/issue_events_065523.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-08T23:42:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21779#event-65523"
}
```



---

archive/issue_comments_404869.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [git](#comment%3A9):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa\">405a5ce</a></td><td><code>trac 21779 introducing auxiliary function for sequential rich comparison</code></td></tr></table>\n\n\nFollow-up: in #22087 I will introduce a function very similar to the `richcmp_step` which was introduced here (but reverted again).",
    "created_at": "2017-05-31T11:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404869",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [git](#comment%3A9):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/405a5ce07e4b08d17b80b975dd88cf27d3df21fa">405a5ce</a></td><td><code>trac 21779 introducing auxiliary function for sequential rich comparison</code></td></tr></table>


Follow-up: in #22087 I will introduce a function very similar to the `richcmp_step` which was introduced here (but reverted again).



---

archive/issue_comments_404870.json:
```json
{
    "body": "**Changing commit** from \"[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)\" to \"\".",
    "created_at": "2017-05-31T11:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21779",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21779#issuecomment-404870",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[c6cad87f1f9949fb3abe47a6943f53e4b000a293](https://github.com/sagemath/sagetrac-mirror/commit/c6cad87f1f9949fb3abe47a6943f53e4b000a293)" to "".
