# Issue 21606: LatticePoset: Add Alan Day's doubling construction

archive/issues_021369.json:
```json
{
    "body": "This patch add Alan Day's doubling construction to finite lattices.\n\nAlso this contains a picture.\n\nCC:  @tscrim @fchapoton @nthiery\n\nBranch/Commit: 39042a592828a3026a2dc4ad23c990077486a564\n\nReviewer: Martin Rubey\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21606\n\n",
    "closed_at": "2016-10-29T14:26:43Z",
    "created_at": "2016-09-28T07:58:35Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "LatticePoset: Add Alan Day's doubling construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21606",
    "user": "https://github.com/jm58660"
}
```
This patch add Alan Day's doubling construction to finite lattices.

Also this contains a picture.

CC:  @tscrim @fchapoton @nthiery

Branch/Commit: 39042a592828a3026a2dc4ad23c990077486a564

Reviewer: Martin Rubey

Author: Jori MÃ¤ntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21606





---

archive/issue_comments_315662.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-28T08:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315662",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315663.json:
```json
{
    "body": "<a id='comment:2'></a>Nicolas: This is an answer to your comment \"YES!\" on thread https://groups.google.com/forum/#!topic/sage-devel/3YKltRTZ4vM\n\nThis code should be reviewed. But what's more important, is this kind of picture a good idea at all? I think that Nicolas was only one to comment my question about one year ago.\n\nAnd if this is theoretically good idea, how about this picture? I do not have eyes for graphical things. A good example, or bad? If good, a good visualization or not?\n\n---\nNew commits:",
    "created_at": "2016-09-28T08:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315663",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>Nicolas: This is an answer to your comment "YES!" on thread https://groups.google.com/forum/#!topic/sage-devel/3YKltRTZ4vM

This code should be reviewed. But what's more important, is this kind of picture a good idea at all? I think that Nicolas was only one to comment my question about one year ago.

And if this is theoretically good idea, how about this picture? I do not have eyes for graphical things. A good example, or bad? If good, a good visualization or not?

---
New commits:



---

archive/issue_comments_315664.json:
```json
{
    "body": "<a id='comment:3'></a>may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)",
    "created_at": "2016-09-29T19:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315664",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)



---

archive/issue_comments_315665.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 chapoton]:\n> may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)\n\n\nWhat to do with non-doubled elements? Think about `LatticePoset({1:[(1,1)], (1,1): [(1,1,1)]})` or something similar.",
    "created_at": "2016-09-30T03:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315665",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>Replying to [comment:3 chapoton]:
> may be more more economic to use labels 0 and 1 for the doubled elements in S (instead of 1 and 2)


What to do with non-doubled elements? Think about `LatticePoset({1:[(1,1)], (1,1): [(1,1,1)]})` or something similar.



---

archive/issue_comments_315666.json:
```json
{
    "body": "<a id='comment:5'></a>I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..",
    "created_at": "2016-09-30T15:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315666",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..



---

archive/issue_comments_315667.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 chapoton]:\n> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..\n\n\nAh, OK. Can be done.\n\nWhat about the picture?",
    "created_at": "2016-09-30T16:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315667",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:6'></a>Replying to [comment:5 chapoton]:
> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..


Ah, OK. Can be done.

What about the picture?



---

archive/issue_comments_315668.json:
```json
{
    "body": "<a id='comment:7'></a>Ping. Any comments about the picture?\n\nIf I got none, I'll remove it and just add for code review.",
    "created_at": "2016-10-15T04:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315668",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>Ping. Any comments about the picture?

If I got none, I'll remove it and just add for code review.



---

archive/issue_comments_315669.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-17T19:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315669",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315670.json:
```json
{
    "body": "<a id='comment:8'></a>I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  Perhaps adding \n\n```\nsage: L = LatticePoset({0:[\"a\"], \"a\":[\"b\",\"c\"], \"b\":[1], \"c\":[1]})\nsage: L.day_doubling([\"a\", \"b\", \"c\"])\nFinite lattice containing 8 elements\n```\nis helpful.  Maybe you also want\n\n```\nThe subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.\n```\n\n\nIn any case, I tried it on a few examples and I like it.",
    "created_at": "2016-10-17T19:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315670",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:8'></a>I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  Perhaps adding 

```
sage: L = LatticePoset({0:["a"], "a":["b","c"], "b":[1], "c":[1]})
sage: L.day_doubling(["a", "b", "c"])
Finite lattice containing 8 elements
```
is helpful.  Maybe you also want

```
The subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.
```


In any case, I tried it on a few examples and I like it.



---

archive/issue_comments_315671.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-17T19:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315671",
    "user": "https://github.com/jm58660"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_315672.json:
```json
{
    "body": "<a id='comment:9'></a>Back to needs_work because of this:\n\nReplying to [comment:5 chapoton]:\n> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..\n\n\nand for your comments. Big thanks for checking the picture!",
    "created_at": "2016-10-17T19:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315672",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>Back to needs_work because of this:

Replying to [comment:5 chapoton]:
> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled. But this is just a detail..


and for your comments. Big thanks for checking the picture!



---

archive/issue_comments_315673.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:5 chapoton]:\n\n> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled.\n\n\nAt least this made the code shorter. Hopefully I did not introduce bugs, please check.\n\nReplying to [comment:8 mantepse]:\n\n> I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  \n\n\nYep, automatically made plots are about never as good as hand-made, and Sage is not even a good at drawing. But still I think that the picture made by me is ugly. Hopefully some day someone with better color eye will change it.\n\nPerhaps adding \n> {{{\n> sage: L = LatticePoset({0:[\"a\"], \"a\":[\"b\",\"c\"], \"b\":[1], \"c\":[1]})\n> sage: L.day_doubling([\"a\", \"b\", \"c\"])\n> Finite lattice containing 8 elements\n> }}}\n> is helpful.\n\n\nI think that it should be easy to write by the user, there is already one example.\n\n> Maybe you also want\n> \n> ```\n> The subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.\n> ```\n\n\nHasse diagram is kind of internal documentation, so I just spelled out in the main text what convex and connected means.",
    "created_at": "2016-10-18T09:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315673",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:10'></a>Replying to [comment:5 chapoton]:

> I was suggesting to use (i,0) when i is not doubled and (i,0) and (i,1) when i is doubled.


At least this made the code shorter. Hopefully I did not introduce bugs, please check.

Replying to [comment:8 mantepse]:

> I think this is very nice, and indeed the picture makes it clearer than plotting the poset.  


Yep, automatically made plots are about never as good as hand-made, and Sage is not even a good at drawing. But still I think that the picture made by me is ugly. Hopefully some day someone with better color eye will change it.

Perhaps adding 
> {{{
> sage: L = LatticePoset({0:["a"], "a":["b","c"], "b":[1], "c":[1]})
> sage: L.day_doubling(["a", "b", "c"])
> Finite lattice containing 8 elements
> }}}
> is helpful.


I think that it should be easy to write by the user, there is already one example.

> Maybe you also want
> 
> ```
> The subset `S` is assumed to be :meth:`convex <sage.combinat.posets.hasse_diagram.HasseDiagram.is_convex_subset>` and connected.
> ```


Hasse diagram is kind of internal documentation, so I just spelled out in the main text what convex and connected means.



---

archive/issue_events_057325.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-10-18T09:00:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21606#event-57325"
}
```



---

archive/issue_comments_315674.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-18T09:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315674",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_315675.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-18T09:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315676.json:
```json
{
    "body": "<a id='comment:13'></a>Looks good to me.  If you want to, you may replace\n\n```\nResulting lattice `L[S]` has elements \n```\nwith\n\n```\nThe resulting lattice `L[S]` has elements\n```\nI'm still compiling (wrong computer)",
    "created_at": "2016-10-19T10:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315676",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:13'></a>Looks good to me.  If you want to, you may replace

```
Resulting lattice `L[S]` has elements 
```
with

```
The resulting lattice `L[S]` has elements
```
I'm still compiling (wrong computer)



---

archive/issue_comments_315677.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-19T10:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315678.json:
```json
{
    "body": "<a id='comment:15'></a>Looks good!",
    "created_at": "2016-10-19T14:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315678",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>Looks good!



---

archive/issue_comments_315679.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-19T14:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315679",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315680.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-21T06:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315680",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_315681.json:
```json
{
    "body": "<a id='comment:16'></a>Output order of these tests is not deterministic:\n\n```\n1994sage -t --long src/sage/combinat/posets/lattices.py\n1995**********************************************************************\n1996File \"src/sage/combinat/posets/lattices.py\", line 2450, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling\n1997Failed example:\n1998    L2.upper_covers((1, 0))\n1999Expected:\n2000    [(2, 0), ('a', 0), ('b', 0)]\n2001Got:\n2002    [(2, 0), ('b', 0), ('a', 0)]\n2003**********************************************************************\n2004File \"src/sage/combinat/posets/lattices.py\", line 2452, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling\n2005Failed example:\n2006    L2.upper_covers(('b', 0))\n2007Expected:\n2008    [('d', 0), ('b', 1), ('c', 0)]\n2009Got:\n2010    [('c', 0), ('b', 1), ('d', 0)]\n2011**********************************************************************\n20121 item had failures:\n2013   2 of   9 in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling\n2014    [394 tests, 2 failures, 2.42 s]\n```",
    "created_at": "2016-10-21T06:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315681",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>Output order of these tests is not deterministic:

```
1994sage -t --long src/sage/combinat/posets/lattices.py
1995**********************************************************************
1996File "src/sage/combinat/posets/lattices.py", line 2450, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
1997Failed example:
1998    L2.upper_covers((1, 0))
1999Expected:
2000    [(2, 0), ('a', 0), ('b', 0)]
2001Got:
2002    [(2, 0), ('b', 0), ('a', 0)]
2003**********************************************************************
2004File "src/sage/combinat/posets/lattices.py", line 2452, in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
2005Failed example:
2006    L2.upper_covers(('b', 0))
2007Expected:
2008    [('d', 0), ('b', 1), ('c', 0)]
2009Got:
2010    [('c', 0), ('b', 1), ('d', 0)]
2011**********************************************************************
20121 item had failures:
2013   2 of   9 in sage.combinat.posets.lattices.FiniteLatticePoset.day_doubling
2014    [394 tests, 2 failures, 2.42 s]
```



---

archive/issue_comments_315682.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-21T11:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315683.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-21T14:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315683",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_315684.json:
```json
{
    "body": "<a id='comment:18'></a>For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.",
    "created_at": "2016-10-21T14:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315684",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.



---

archive/issue_comments_315685.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 tscrim]:\n> For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.\n\n\nHow? Python3 forbids `'a' < 1` and `sorted(['a', 1])`.",
    "created_at": "2016-10-21T14:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315685",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:19'></a>Replying to [comment:18 tscrim]:
> For future reference, an easier solution (and somewhat easier to understand) is to call `sorted` and have the output be the list.


How? Python3 forbids `'a' < 1` and `sorted(['a', 1])`.



---

archive/issue_comments_315686.json:
```json
{
    "body": "<a id='comment:20'></a>`sorted(['a',1], key=str)` works.",
    "created_at": "2016-10-21T14:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315686",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>`sorted(['a',1], key=str)` works.



---

archive/issue_comments_315687.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-29T14:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21606#issuecomment-315687",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057326.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-29T14:26:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21606#event-57326"
}
```
