# Issue 21042: Contour plot of zero fails with rich representation warning

archive/issues_020805.json:
```json
{
    "body": "Attempting the contour plot\n\n```\nvar('x y')\ncontour_plot(0, (x,-1,1), (y,-1,1))\n```\n\ndoes not show a plot and fails with the error\n\n```\n/home/sc_serv/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: zero-size array to reduction operation minimum which has no identity\n  RichReprWarning,\n\nGraphics object consisting of 1 graphics primitive\n```\n\nContour plots of nonzero values display as expected. It was reported on [this ask question](http://ask.sagemath.org/question/34111/unable-to-create-a-contour_plot-of-a-system-of-inequalities/).\n\nCC:  @orlitzky\n\nReviewer: Dima Pasechnik\n\nAuthor: Michael Orlitzky\n\nBranch: 2d518364df619eb6211d4714e6b13ad85e651651\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21042\n\n",
    "closed_at": "2021-12-12T15:09:03Z",
    "created_at": "2016-07-18T01:40:48Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Contour plot of zero fails with rich representation warning",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21042",
    "user": "https://github.com/paulmasson"
}
```
Attempting the contour plot

```
var('x y')
contour_plot(0, (x,-1,1), (y,-1,1))
```

does not show a plot and fails with the error

```
/home/sc_serv/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: zero-size array to reduction operation minimum which has no identity
  RichReprWarning,

Graphics object consisting of 1 graphics primitive
```

Contour plots of nonzero values display as expected. It was reported on [this ask question](http://ask.sagemath.org/question/34111/unable-to-create-a-contour_plot-of-a-system-of-inequalities/).

CC:  @orlitzky

Reviewer: Dima Pasechnik

Author: Michael Orlitzky

Branch: 2d518364df619eb6211d4714e6b13ad85e651651

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21042





---

archive/issue_comments_287101.json:
```json
{
    "body": "<a id='comment:2'></a>It's not just the zero function, something else weird is going on here. This produces the line `x=y` like you'd expect:\n\n```\ncontour_plot(x-y, (0,1), (0,1), contours=[0], fill=False)\n```\n\nBut then this produces... nothing:\n\n```\ncontour_plot(abs(x-y), (0,1), (0,1), contours=[0], fill=False)\n```\n\nEven though it should be the same plot. Which is weird, but not as weird as being able to fix it with...\n\n```\ncontour_plot(abs(x-y)-0.000001, (0,1), (0,1), contours=[0], fill=False)\n```\n\nwhich gives you (roughly) the plot of `x=y` again.",
    "created_at": "2021-07-26T19:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287101",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:2'></a>It's not just the zero function, something else weird is going on here. This produces the line `x=y` like you'd expect:

```
contour_plot(x-y, (0,1), (0,1), contours=[0], fill=False)
```

But then this produces... nothing:

```
contour_plot(abs(x-y), (0,1), (0,1), contours=[0], fill=False)
```

Even though it should be the same plot. Which is weird, but not as weird as being able to fix it with...

```
contour_plot(abs(x-y)-0.000001, (0,1), (0,1), contours=[0], fill=False)
```

which gives you (roughly) the plot of `x=y` again.



---

archive/issue_comments_287102.json:
```json
{
    "body": "<a id='comment:3'></a>I think contour plot and implicit plot work by detecting\nsign changes to know where something vanishes.\n\nSo no surprise they don't work well with absolute values\nand squares of some quantities even though those have\nthe same vanishing loci.",
    "created_at": "2021-07-26T20:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287102",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>I think contour plot and implicit plot work by detecting
sign changes to know where something vanishes.

So no surprise they don't work well with absolute values
and squares of some quantities even though those have
the same vanishing loci.



---

archive/issue_comments_287103.json:
```json
{
    "body": "<a id='comment:4'></a>It would make sense to document that and add examples.",
    "created_at": "2021-07-26T20:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287103",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>It would make sense to document that and add examples.



---

archive/issue_comments_287104.json:
```json
{
    "body": "<a id='comment:5'></a>Actually... I don't think matplotlib expects `levels` (our `contours`) to contain only one element. We can probably fix this by using `contours=[-epsilon, epsilon]` instead of `contours=[0]`, which does who-knows-what under the hood.",
    "created_at": "2021-08-07T01:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287104",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>Actually... I don't think matplotlib expects `levels` (our `contours`) to contain only one element. We can probably fix this by using `contours=[-epsilon, epsilon]` instead of `contours=[0]`, which does who-knows-what under the hood.



---

archive/issue_comments_287105.json:
```json
{
    "body": "<a id='comment:6'></a>Update: using `contours=[-epsilon, epsilon]` doesn't break any existing implicit plots, but how good it looks depends on `epsilon` and the function you're plotting. Some functions require a lot more plot points for a given epsilon, or a smaller xrange and yrange.\n\nI wonder if there's a cheap heuristic we could use instead of a fixed tolerance.",
    "created_at": "2021-08-07T02:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287105",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'></a>Update: using `contours=[-epsilon, epsilon]` doesn't break any existing implicit plots, but how good it looks depends on `epsilon` and the function you're plotting. Some functions require a lot more plot points for a given epsilon, or a smaller xrange and yrange.

I wonder if there's a cheap heuristic we could use instead of a fixed tolerance.



---

archive/issue_comments_287106.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-08T01:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287106",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287107.json:
```json
{
    "body": "<a id='comment:7'></a>This heuristic is real hacky, but it can only improve things; and the important part is that we now warn the user anyway.\n\n---\nNew commits:",
    "created_at": "2021-10-08T01:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287107",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:7'></a>This heuristic is real hacky, but it can only improve things; and the important part is that we now warn the user anyway.

---
New commits:



---

archive/issue_comments_287108.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-10-08T01:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_287109.json:
```json
{
    "body": "<a id='comment:9'></a>Do we want this in? The milestone was off...",
    "created_at": "2021-12-03T10:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287109",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Do we want this in? The milestone was off...



---

archive/issue_events_056238.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-12-03T10:38:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21042#event-56238"
}
```



---

archive/issue_comments_287110.json:
```json
{
    "body": "<a id='comment:10'></a>OK, looks good",
    "created_at": "2021-12-03T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287110",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>OK, looks good



---

archive/issue_comments_287111.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T10:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287111",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_056239.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21042#event-56239"
}
```



---

archive/issue_comments_287112.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287112",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_287113.json:
```json
{
    "body": "<a id='comment:12'></a>This has broken our linter, by using a bad comparison to False.",
    "created_at": "2021-12-13T17:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287113",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>This has broken our linter, by using a bad comparison to False.



---

archive/issue_comments_287114.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 chapoton]:\n> This has broken our linter, by using a bad comparison to False.\n\n\nSee follow-up ticket for that at #33021.",
    "created_at": "2021-12-14T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21042#issuecomment-287114",
    "user": "https://github.com/slel"
}
```

<a id='comment:13'></a>Replying to [comment:12 chapoton]:
> This has broken our linter, by using a bad comparison to False.


See follow-up ticket for that at #33021.
