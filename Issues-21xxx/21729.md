# Issue 21729: Implement Didier Caucal's structural description of Cayley graphs

archive/issues_021492.json:
```json
{
    "body": "In a recent preprint [https://arxiv.org/abs/1609.08272](https://arxiv.org/abs/1609.08272) titled *Structural characterization of Cayley graphs*, Didier Caucal has proved that a directed graph is Cayley if and only if it is strongly connected, simple, deterministic, and vertex transitive.\n\nThe present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs. Moreover, it uses optional gap packages, which are not needed here. This method works only for directed graphs, and is sensitive to edge labels.\n\nCC:  @jasongrout boothby @jm58660 @dimpase\n\nKeywords: cayley graphs\n\nBranch: [u/amri/structural_cayley-21729](https://github.com/sagemath/sagetrac-mirror/tree/u/amri/structural_cayley-21729)\n\nCommit: [50d4e57e89ed0b5f6949c3786e4e109f309171d5](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)\n\nAuthor: Amritanshu Prasad\n\nStatus: needs_info\n\nIssue created by migration from https://trac.sagemath.org/ticket/21729\n\n",
    "created_at": "2016-10-19T13:39:36Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Implement Didier Caucal's structural description of Cayley graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21729",
    "user": "https://github.com/amritanshu-prasad"
}
```
In a recent preprint [https://arxiv.org/abs/1609.08272](https://arxiv.org/abs/1609.08272) titled *Structural characterization of Cayley graphs*, Didier Caucal has proved that a directed graph is Cayley if and only if it is strongly connected, simple, deterministic, and vertex transitive.

The present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs. Moreover, it uses optional gap packages, which are not needed here. This method works only for directed graphs, and is sensitive to edge labels.

CC:  @jasongrout boothby @jm58660 @dimpase

Keywords: cayley graphs

Branch: [u/amri/structural_cayley-21729](https://github.com/sagemath/sagetrac-mirror/tree/u/amri/structural_cayley-21729)

Commit: [50d4e57e89ed0b5f6949c3786e4e109f309171d5](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)

Author: Amritanshu Prasad

Status: needs_info

Issue created by migration from https://trac.sagemath.org/ticket/21729





---

archive/issue_comments_403826.json:
```json
{
    "body": "Commit: [38e51e4b488fc2f8797e3cd227e02fa9a09b4156](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)",
    "created_at": "2016-10-19T14:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403826",
    "user": "https://github.com/amritanshu-prasad"
}
```

Commit: [38e51e4b488fc2f8797e3cd227e02fa9a09b4156](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)



---

archive/issue_comments_403827.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[d423def](https://github.com/sagemath/sagetrac-mirror/commit/d423def54b20899448a2d2f92853fe5988022a06)|`Added working code.`|\n|[38e51e4](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)|`Improved performance for chacking simple and deterministic`|",
    "created_at": "2016-10-19T14:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403827",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[d423def](https://github.com/sagemath/sagetrac-mirror/commit/d423def54b20899448a2d2f92853fe5988022a06)|`Added working code.`|
|[38e51e4](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)|`Improved performance for chacking simple and deterministic`|



---

archive/issue_comments_403828.json:
```json
{
    "body": "Branch: [u/amri/structural_cayley-21729](https://github.com/sagemath/sagetrac-mirror/tree/u/amri/structural_cayley-21729)",
    "created_at": "2016-10-19T14:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403828",
    "user": "https://github.com/amritanshu-prasad"
}
```

Branch: [u/amri/structural_cayley-21729](https://github.com/sagemath/sagetrac-mirror/tree/u/amri/structural_cayley-21729)



---

archive/issue_comments_403829.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt runs a little faster than the existing code, even though my implementation is probably far from optimized.\n\n```\nsage: G = groups.permutation.Mathieu(9)\nsage: S = Set(G).subsets().random_element()\nsage: gr = G.cayley_graph(generators=list(S))\nsage: %timeit gr.is_cayley()\n100 loops, best of 3: 14.5 ms per loop\nsage: %timeit gr.is_cayley_directed()\n100 loops, best of 3: 6.92 ms per loop\n\n```",
    "created_at": "2016-10-19T15:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403829",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:2'></a>
It runs a little faster than the existing code, even though my implementation is probably far from optimized.

```
sage: G = groups.permutation.Mathieu(9)
sage: S = Set(G).subsets().random_element()
sage: gr = G.cayley_graph(generators=list(S))
sage: %timeit gr.is_cayley()
100 loops, best of 3: 14.5 ms per loop
sage: %timeit gr.is_cayley_directed()
100 loops, best of 3: 6.92 ms per loop

```



---

archive/issue_comments_403830.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[45d3073](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)|`Added documentation for DiGraph.is_cayley_directed`|",
    "created_at": "2016-10-27T12:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[45d3073](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)|`Added documentation for DiGraph.is_cayley_directed`|



---

archive/issue_comments_403831.json:
```json
{
    "body": "Changing commit from \"[38e51e4b488fc2f8797e3cd227e02fa9a09b4156](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)\" to \"[45d3073eaddd5ba82967ca75a6d9c870e417e866](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)\"",
    "created_at": "2016-10-27T12:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[38e51e4b488fc2f8797e3cd227e02fa9a09b4156](https://github.com/sagemath/sagetrac-mirror/commit/38e51e4b488fc2f8797e3cd227e02fa9a09b4156)" to "[45d3073eaddd5ba82967ca75a6d9c870e417e866](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)"



---

archive/issue_comments_403832.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n In a recent preprint [https://arxiv.org/abs/1609.08272](https://arxiv.org/abs/1609.08272) titled *Structural characterization of Cayley graphs*, Didier Caucal has proved that a directed graph is Cayley if and only if it is strongly connected, simple, deterministic, and vertex transitive.\n \n-The present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs.\n+The present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs. Moreover, it uses optional gap packages, which are not needed here. This method works only for directed graphs, and is sensitive to edge labels.\n``````\n",
    "created_at": "2016-10-27T12:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403832",
    "user": "https://github.com/amritanshu-prasad"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 In a recent preprint [https://arxiv.org/abs/1609.08272](https://arxiv.org/abs/1609.08272) titled *Structural characterization of Cayley graphs*, Didier Caucal has proved that a directed graph is Cayley if and only if it is strongly connected, simple, deterministic, and vertex transitive.
 
-The present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs.
+The present method for determining if a graph is Cayley in Sage involves looking for a free transitive subgroup of the automorphism group, which appears to be slower for directed graphs. Moreover, it uses optional gap packages, which are not needed here. This method works only for directed graphs, and is sensitive to edge labels.
``````




---

archive/issue_comments_403833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-27T12:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403833",
    "user": "https://github.com/amritanshu-prasad"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403834.json:
```json
{
    "body": "<a id='comment:6'></a>\nMore speed testing (see noticable improvement):\n\n```\nsage: G = groups.permutation.DiCyclic(4)\nsage: D = G.cayley_graph()\nsage: %timeit D.is_cayley()\n10 loops, best of 3: 6.82 ms per loop\nsage: %timeit D.is_cayley_directed()\n1000 loops, best of 3: 343 \u00b5s per loop\n```\n\n```\nsage: G = groups.permutation.PGL(2,4)\nsage: D = G.cayley_graph()\nsage: %timeit D.is_cayley()\n1 loop, best of 3: 96.8 ms per loop\nsage: %timeit D.is_cayley_directed()\n1000 loops, best of 3: 1.25 ms per loop\n```\nWe try a random graph\n\n```\nsage: D = digraphs.RandomDirectedGN(20)\nsage: %timeit D.is_cayley()\nThe slowest run took 6.25 times longer than the fastest. This could mean that an intermediate result is being cached.\n10 loops, best of 3: 4.01 ms per loop\nsage: %timeit D.is_cayley_directed()\nThe slowest run took 10.74 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.31 \u00b5s per loop\n```",
    "created_at": "2016-11-10T15:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403834",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:6'></a>
More speed testing (see noticable improvement):

```
sage: G = groups.permutation.DiCyclic(4)
sage: D = G.cayley_graph()
sage: %timeit D.is_cayley()
10 loops, best of 3: 6.82 ms per loop
sage: %timeit D.is_cayley_directed()
1000 loops, best of 3: 343 µs per loop
```

```
sage: G = groups.permutation.PGL(2,4)
sage: D = G.cayley_graph()
sage: %timeit D.is_cayley()
1 loop, best of 3: 96.8 ms per loop
sage: %timeit D.is_cayley_directed()
1000 loops, best of 3: 1.25 ms per loop
```
We try a random graph

```
sage: D = digraphs.RandomDirectedGN(20)
sage: %timeit D.is_cayley()
The slowest run took 6.25 times longer than the fastest. This could mean that an intermediate result is being cached.
10 loops, best of 3: 4.01 ms per loop
sage: %timeit D.is_cayley_directed()
The slowest run took 10.74 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.31 µs per loop
```



---

archive/issue_comments_403835.json:
```json
{
    "body": "Changing commit from \"[45d3073eaddd5ba82967ca75a6d9c870e417e866](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)\" to \"[50d4e57e89ed0b5f6949c3786e4e109f309171d5](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)\"",
    "created_at": "2016-11-10T15:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[45d3073eaddd5ba82967ca75a6d9c870e417e866](https://github.com/sagemath/sagetrac-mirror/commit/45d3073eaddd5ba82967ca75a6d9c870e417e866)" to "[50d4e57e89ed0b5f6949c3786e4e109f309171d5](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)"



---

archive/issue_comments_403836.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[50d4e57](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)|`algorithm for checking if digraph is Cayley now uses has_multiple_edges() method`|",
    "created_at": "2016-11-10T15:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[50d4e57](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)|`algorithm for checking if digraph is Cayley now uses has_multiple_edges() method`|



---

archive/issue_comments_403837.json:
```json
{
    "body": "<a id='comment:8'></a>\nNew commits:\n|                                                                                                                                          |                                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[50d4e57](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)|`algorithm for checking if digraph is Cayley now uses has_multiple_edges() method`|",
    "created_at": "2016-11-10T15:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403837",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:8'></a>
New commits:
|                                                                                                                                          |                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[50d4e57](https://github.com/sagemath/sagetrac-mirror/commit/50d4e57e89ed0b5f6949c3786e4e109f309171d5)|`algorithm for checking if digraph is Cayley now uses has_multiple_edges() method`|



---

archive/issue_comments_403838.json:
```json
{
    "body": "<a id='comment:9'></a>\nAt least `seen_ends` is now unused.\n\nThis can be done in two lines,\n\n```\nseen = set()\nnot any(e[2] in seen or seen.add(e[2]) for v in self for e in self.outgoing_edge_iterator(v))\n```\n\nbut your version might be easier to read.\n\nI still hope that someone who has read the paper can review this.",
    "created_at": "2016-11-11T09:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403838",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>
At least `seen_ends` is now unused.

This can be done in two lines,

```
seen = set()
not any(e[2] in seen or seen.add(e[2]) for v in self for e in self.outgoing_edge_iterator(v))
```

but your version might be easier to read.

I still hope that someone who has read the paper can review this.



---

archive/issue_comments_403839.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think the documentation should include a warning saying that the result has not been published in a refereed medium yet. While the author is certainly a respected researcher, it's in itself is not a guarantee for correctness.",
    "created_at": "2016-11-11T11:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403839",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
I think the documentation should include a warning saying that the result has not been published in a refereed medium yet. While the author is certainly a respected researcher, it's in itself is not a guarantee for correctness.



---

archive/issue_comments_403840.json:
```json
{
    "body": "<a id='comment:11'></a>\nI don't think it's correct to say that this is a faster algorithm to determine if the graph is Cayley. This is an algorithm to do this for a special class of edge-labelled (di)graphs. It's not clear at all that this method can be efficiently extended to the unlabelled case (and indeed nothing of this is claimed in the paper).\n\nIn the docstring \n\n```\n+        A directed graph with labeled edges is Cayley if and only if it is\n+        strongly connected, vertex transitive, simple and deterministic.\n```\nthe main result of the paper is misstated; certainly not every labelling of edges can be considered. Certainly for each vertex each outedge on it must have a different label. And a directed labelled Cayley graph has more restrictions of labels---there must be exactly k different labels, for k the out-degree of the (di)graph.",
    "created_at": "2016-11-11T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403840",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I don't think it's correct to say that this is a faster algorithm to determine if the graph is Cayley. This is an algorithm to do this for a special class of edge-labelled (di)graphs. It's not clear at all that this method can be efficiently extended to the unlabelled case (and indeed nothing of this is claimed in the paper).

In the docstring 

```
+        A directed graph with labeled edges is Cayley if and only if it is
+        strongly connected, vertex transitive, simple and deterministic.
```
the main result of the paper is misstated; certainly not every labelling of edges can be considered. Certainly for each vertex each outedge on it must have a different label. And a directed labelled Cayley graph has more restrictions of labels---there must be exactly k different labels, for k the out-degree of the (di)graph.



---

archive/issue_comments_403841.json:
```json
{
    "body": "<a id='comment:12'></a>\nIn this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:\n\n```\n+        This method is sensitive to edge labels::\n+\n+            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])\n+            sage: g.is_cayley()\n+            True\n+            sage: g.is_cayley_directed()\n+            False\n```\nDo you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.",
    "created_at": "2016-11-11T12:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403841",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:12'></a>
In this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:

```
+        This method is sensitive to edge labels::
+
+            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])
+            sage: g.is_cayley()
+            True
+            sage: g.is_cayley_directed()
+            False
```
Do you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.



---

archive/issue_comments_403842.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [amri](#comment%3A12):\n> In this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:\n> \n> ```\n> +        This method is sensitive to edge labels::\n> +\n> +            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])\n> +            sage: g.is_cayley()\n> +            True\n> +            sage: g.is_cayley_directed()\n> +            False\n> ```\n> Do you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.\n\n\nThe problem this ticket solve is the following: \n\ngiven a digraph D with edge labels 1,2,...,k, decide if there exists a group G generated by g_1,...,g_k so that D is the Cayley graph of G w.r.t. the generators g_1,...,g_k, right?\n\nThis is much more restrictive and much easier than recognising whether a digraph is a Cayley graph w.r.t. some group G with some set of generators.\n\nIn fact, it is straightforward to read the group off a Cayley graph with edge labels, and so I don't see why this is so interesting (it's good to have, but probably the punchline of the paper in question is somewhere else).\nIndeed, if the arc (ij) is labelled by g this just means that the permutation g\nmaps i to j, and so you can reconstruct all the permutations, or get stuck at some point---the latter simply means that it's not a Cayley graph w.r.t. the set of generators corresponding to edge labels.",
    "created_at": "2016-11-11T17:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403842",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [amri](#comment%3A12):
> In this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:
> 
> ```
> +        This method is sensitive to edge labels::
> +
> +            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])
> +            sage: g.is_cayley()
> +            True
> +            sage: g.is_cayley_directed()
> +            False
> ```
> Do you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.


The problem this ticket solve is the following: 

given a digraph D with edge labels 1,2,...,k, decide if there exists a group G generated by g_1,...,g_k so that D is the Cayley graph of G w.r.t. the generators g_1,...,g_k, right?

This is much more restrictive and much easier than recognising whether a digraph is a Cayley graph w.r.t. some group G with some set of generators.

In fact, it is straightforward to read the group off a Cayley graph with edge labels, and so I don't see why this is so interesting (it's good to have, but probably the punchline of the paper in question is somewhere else).
Indeed, if the arc (ij) is labelled by g this just means that the permutation g
maps i to j, and so you can reconstruct all the permutations, or get stuck at some point---the latter simply means that it's not a Cayley graph w.r.t. the set of generators corresponding to edge labels.



---

archive/issue_comments_403843.json:
```json
{
    "body": "<a id='comment:15'></a>\nAs a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).\nDavid.",
    "created_at": "2016-11-11T17:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403843",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
As a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).
David.



---

archive/issue_comments_403844.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [dimpase](#comment%3A14):\n\nWhile I agree that it is easy to read off a group from its Cayley graph when the edges are labeled, I believe that recognizing the graph to be Cayley is less easy. You could, for example take the group with generators the out edges from some node, and then use as relations the cycle language of that node (which forms a subgroup). However, you would still need to check that the graph you have is the Cayley graph of this group you have constructed. This turns out to be equivalent to vertex-transitivity.\n\n> Replying to [amri](#comment%3A12):\n> > In this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:\n> > \n> > ```\n> > +        This method is sensitive to edge labels::\n> > +\n> > +            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])\n> > +            sage: g.is_cayley()\n> > +            True\n> > +            sage: g.is_cayley_directed()\n> > +            False\n> > ```\n> > Do you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.\n\n> \n> The problem this ticket solve is the following: \n> \n> given a digraph D with edge labels 1,2,...,k, decide if there exists a group G generated by g_1,...,g_k so that D is the Cayley graph of G w.r.t. the generators g_1,...,g_k, right?\n> \n> This is much more restrictive and much easier than recognising whether a digraph is a Cayley graph w.r.t. some group G with some set of generators.\n> \n> In fact, it is straightforward to read the group off a Cayley graph with edge labels, and so I don't see why this is so interesting (it's good to have, but probably the punchline of the paper in question is somewhere else).\n> Indeed, if the arc (ij) is labelled by g this just means that the permutation g\n> maps i to j, and so you can reconstruct all the permutations, or get stuck at some point---the latter simply means that it's not a Cayley graph w.r.t. the set of generators corresponding to edge labels.\n> \n> \n> \n\n>",
    "created_at": "2016-11-15T03:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403844",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:16'></a>
Replying to [dimpase](#comment%3A14):

While I agree that it is easy to read off a group from its Cayley graph when the edges are labeled, I believe that recognizing the graph to be Cayley is less easy. You could, for example take the group with generators the out edges from some node, and then use as relations the cycle language of that node (which forms a subgroup). However, you would still need to check that the graph you have is the Cayley graph of this group you have constructed. This turns out to be equivalent to vertex-transitivity.

> Replying to [amri](#comment%3A12):
> > In this setting, a Cayley graph *is* a directed graph with edges labeled by generators. Dima rightly points out that if the edge labeling is changed, then the algorithm will not recognize the graph as Cayley. I pointed this out in the documentation:
> > 
> > ```
> > +        This method is sensitive to edge labels::
> > +
> > +            sage: g = DiGraph([(1, 2, 1), (2, 3, 1), (3, 1, 1), (2, 1, 1), (3, 2, 1), (1, 3, 1)])
> > +            sage: g.is_cayley()
> > +            True
> > +            sage: g.is_cayley_directed()
> > +            False
> > ```
> > Do you think I should make it more prominent? And of course, it is for this reason that the algorithm runs so fast - it uses the additional information (edge labels) which the earlier (Sabidussi) algorithm does not take into account.

> 
> The problem this ticket solve is the following: 
> 
> given a digraph D with edge labels 1,2,...,k, decide if there exists a group G generated by g_1,...,g_k so that D is the Cayley graph of G w.r.t. the generators g_1,...,g_k, right?
> 
> This is much more restrictive and much easier than recognising whether a digraph is a Cayley graph w.r.t. some group G with some set of generators.
> 
> In fact, it is straightforward to read the group off a Cayley graph with edge labels, and so I don't see why this is so interesting (it's good to have, but probably the punchline of the paper in question is somewhere else).
> Indeed, if the arc (ij) is labelled by g this just means that the permutation g
> maps i to j, and so you can reconstruct all the permutations, or get stuck at some point---the latter simply means that it's not a Cayley graph w.r.t. the set of generators corresponding to edge labels.
> 
> 
> 

>



---

archive/issue_comments_403845.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [dcoudert](#comment%3A15):\n> As a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).\n> David.\n\nI am not sure I understand how this works. Can you point me to a similar example?",
    "created_at": "2016-11-15T03:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403845",
    "user": "https://github.com/amritanshu-prasad"
}
```

<a id='comment:17'></a>
Replying to [dcoudert](#comment%3A15):
> As a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).
> David.

I am not sure I understand how this works. Can you point me to a similar example?



---

archive/issue_comments_403846.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [amri](#comment%3A17):\n> Replying to [dcoudert](#comment%3A15):\n> > As a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).\n> > David.\n\n> I am not sure I understand how this works. Can you point me to a similar example?\n\n```\nsage: G = Graph([(0,1)])\nsage: G._scream_if_not_simple()\nsage: G = Graph([(0,1), (0,1)], multiedges=True)\nsage: G._scream_if_not_simple()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-4-598886da2d1f> in <module>()\n----> 1 G._scream_if_not_simple()\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _scream_if_not_simple(self, allow_loops, allow_multiple_edges)\n   1295                    \"meantime if you want to use it please disallow \"+name+\" using \"+\n   1296                    functions+\".\")\n-> 1297             raise ValueError(msg)\n   1298 \n   1299     def networkx_graph(self, copy=True):\n\nValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().\nsage: try:\n....:     G._scream_if_not_simple()\n....:     print \"I'm simple\"\n....: except:\n....:     print \"I'm not simple\"\n....:     \nI'm not simple\n```\nyou can also decide to tolerate loops but not multiedges or the opposite.\n\n```\nsage: G = Graph([(0,1), (0,1)], multiedges=True)\nsage: G._scream_if_not_simple(allow_multiple_edges=True)\nsage: G._scream_if_not_simple(allow_loops=True)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-8-45f9140e8d3e> in <module>()\n----> 1 G._scream_if_not_simple(allow_loops=True)\n\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _scream_if_not_simple(self, allow_loops, allow_multiple_edges)\n   1295                    \"meantime if you want to use it please disallow \"+name+\" using \"+\n   1296                    functions+\".\")\n-> 1297             raise ValueError(msg)\n   1298 \n   1299     def networkx_graph(self, copy=True):\n\nValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().\n```",
    "created_at": "2016-11-15T06:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403846",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>
Replying to [amri](#comment%3A17):
> Replying to [dcoudert](#comment%3A15):
> > As a complement on the discussion on sage-dev, you may consider method `G._scream_if_not_simple()` that raises an error if the graph is not simple (loops or multiple edges).
> > David.

> I am not sure I understand how this works. Can you point me to a similar example?

```
sage: G = Graph([(0,1)])
sage: G._scream_if_not_simple()
sage: G = Graph([(0,1), (0,1)], multiedges=True)
sage: G._scream_if_not_simple()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-4-598886da2d1f> in <module>()
----> 1 G._scream_if_not_simple()

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _scream_if_not_simple(self, allow_loops, allow_multiple_edges)
   1295                    "meantime if you want to use it please disallow "+name+" using "+
   1296                    functions+".")
-> 1297             raise ValueError(msg)
   1298 
   1299     def networkx_graph(self, copy=True):

ValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().
sage: try:
....:     G._scream_if_not_simple()
....:     print "I'm simple"
....: except:
....:     print "I'm not simple"
....:     
I'm not simple
```
you can also decide to tolerate loops but not multiedges or the opposite.

```
sage: G = Graph([(0,1), (0,1)], multiedges=True)
sage: G._scream_if_not_simple(allow_multiple_edges=True)
sage: G._scream_if_not_simple(allow_loops=True)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-8-45f9140e8d3e> in <module>()
----> 1 G._scream_if_not_simple(allow_loops=True)

/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _scream_if_not_simple(self, allow_loops, allow_multiple_edges)
   1295                    "meantime if you want to use it please disallow "+name+" using "+
   1296                    functions+".")
-> 1297             raise ValueError(msg)
   1298 
   1299     def networkx_graph(self, copy=True):

ValueError: This method is not known to work on graphs with multiedges. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow multiedges using allow_multiple_edges().
```



---

archive/issue_comments_403847.json:
```json
{
    "body": "<a id='comment:19'></a>\nA few comments:\n* In method `is_deterministic`, please use `self.vertex_iterator()` and `self.outgoing_edge_iterator(v)`. Also, `seen_ends = set()` but not used.\n* the `EXAMPLES` section should show the interest for your new method, not `is_cayley` only.\n* I think that references should now be placed in the global bibliography file. See #21454\n* Add in method a SEEALSO section with :meth:`~sage.graphs.digraph.DiGraph.is_cayley_directed`\n* What if the digraph has loops?",
    "created_at": "2016-11-15T16:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403847",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>
A few comments:
* In method `is_deterministic`, please use `self.vertex_iterator()` and `self.outgoing_edge_iterator(v)`. Also, `seen_ends = set()` but not used.
* the `EXAMPLES` section should show the interest for your new method, not `is_cayley` only.
* I think that references should now be placed in the global bibliography file. See #21454
* Add in method a SEEALSO section with :meth:`~sage.graphs.digraph.DiGraph.is_cayley_directed`
* What if the digraph has loops?



---

archive/issue_comments_403848.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [amri](#comment%3A16):\n> Replying to [dimpase](#comment%3A14):\n> \n> While I agree that it is easy to read off a group from its Cayley graph when the edges are labeled, I believe that recognizing the graph to be Cayley is less easy. You could, for example take the group with generators the out edges from some node, and then use as relations the cycle language of that node (which forms a subgroup). However, you would still need to check that the graph you have is the Cayley graph of this group you have constructed. This turns out to be equivalent to vertex-transitivity.\n\n\nChecking transitivity of a permutation group given by generators is quite easy and can be done very efficiently. \n\nWhat is however less obvious is how to check is that you get a group acting regularly (i.e. transitively and with trivial vertex stabiliser). And this is something I did not mention in my previous comment.\n\nFor this, the quickest way I know is to write down the Schreier generators for the point stabiliser and check that they are all trivial.\nThis seems to be possible to do in time O(nr), with n the number of vertices and r number of group generators.\n\nDoes the paper offer anything faster?",
    "created_at": "2016-11-15T16:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403848",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [amri](#comment%3A16):
> Replying to [dimpase](#comment%3A14):
> 
> While I agree that it is easy to read off a group from its Cayley graph when the edges are labeled, I believe that recognizing the graph to be Cayley is less easy. You could, for example take the group with generators the out edges from some node, and then use as relations the cycle language of that node (which forms a subgroup). However, you would still need to check that the graph you have is the Cayley graph of this group you have constructed. This turns out to be equivalent to vertex-transitivity.


Checking transitivity of a permutation group given by generators is quite easy and can be done very efficiently. 

What is however less obvious is how to check is that you get a group acting regularly (i.e. transitively and with trivial vertex stabiliser). And this is something I did not mention in my previous comment.

For this, the quickest way I know is to write down the Schreier generators for the point stabiliser and check that they are all trivial.
This seems to be possible to do in time O(nr), with n the number of vertices and r number of group generators.

Does the paper offer anything faster?



---

archive/issue_comments_403849.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-02-17T06:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403849",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_403850.json:
```json
{
    "body": "<a id='comment:21'></a>\nI agree with Dima, this characterization is certainly not new, and probably not the punchline of the article advertised in the description. For example, it corresponds to the characterization of Galois covers in algebraic topology (see e.g. the book of A. Hatcher).\n\nDima: following these steps it is enough to check for a **single** vertex stabilizer\n- Test whether the graph `G` is connected and at each vertex there are exactly an input and an output edges of each label. If not return `False`.\n- Build the permutation group `P` acting on the vertices of `G` that consists in \"following the labels\" (one generator per label). Note that the transitivity of `P` is equivalent to the connectivity of `G`.\n- Pick a vertex `v0` of `G`. If the vertex stabilizer in `P` of `v0` is trivial then return `True` otherwise return `False`.\n\nThe reason that it works is that vertex stabilizers are conjugate (since the group `P` acts transitively on the vertices).\n\nAs pointed out by Dima, testing whether an **unlabelled graph** is Cayley is much more interesting. It is certainly doable starting from the automorphism group of the graph and analyzing the vertex stabilizer of a point.",
    "created_at": "2020-02-17T06:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403850",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
I agree with Dima, this characterization is certainly not new, and probably not the punchline of the article advertised in the description. For example, it corresponds to the characterization of Galois covers in algebraic topology (see e.g. the book of A. Hatcher).

Dima: following these steps it is enough to check for a **single** vertex stabilizer
- Test whether the graph `G` is connected and at each vertex there are exactly an input and an output edges of each label. If not return `False`.
- Build the permutation group `P` acting on the vertices of `G` that consists in "following the labels" (one generator per label). Note that the transitivity of `P` is equivalent to the connectivity of `G`.
- Pick a vertex `v0` of `G`. If the vertex stabilizer in `P` of `v0` is trivial then return `True` otherwise return `False`.

The reason that it works is that vertex stabilizers are conjugate (since the group `P` acts transitively on the vertices).

As pointed out by Dima, testing whether an **unlabelled graph** is Cayley is much more interesting. It is certainly doable starting from the automorphism group of the graph and analyzing the vertex stabilizer of a point.



---

archive/issue_comments_403851.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [vdelecroix](#comment%3A21):\n\n> As pointed out by Dima, testing whether an **unlabelled graph** is Cayley is much more interesting. It is certainly doable starting from the automorphism group of the graph and analyzing the vertex stabilizer of a point.\n\n\nit's much harder than that: the full automorphism group can be bigger, so one needs to look up all the transitive subgroups (up to conjugation) and check whether one of them is regular.",
    "created_at": "2020-02-17T08:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21729",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21729#issuecomment-403851",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
Replying to [vdelecroix](#comment%3A21):

> As pointed out by Dima, testing whether an **unlabelled graph** is Cayley is much more interesting. It is certainly doable starting from the automorphism group of the graph and analyzing the vertex stabilizer of a point.


it's much harder than that: the full automorphism group can be bigger, so one needs to look up all the transitive subgroups (up to conjugation) and check whether one of them is regular.
