# Issue 21537: If $SAGE_SUDO is set, use it whenever we do "make install" of a package.

archive/issues_021300.json:
```json
{
    "body": "That would be a solution for those who want to install Sage in a prefix that's only writable by root.\n\nIn this way, building can take place in unprivileged user account.\n\nIt could perhaps also be enabled by `./configure --enable-sudo-install`. (not on this ticket)\n\nThis ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.\n\n*** See #21726 for a slightly different approach ***\n\n\nCC:  @jdemeyer @kiwifb @embray @nexttime @vbraun @mezzarobba\n\nReviewer: Matthias Koeppe, Samuel Leli\u00e8vre\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/21537\n\n",
    "closed_at": "2021-08-26T02:08:43Z",
    "created_at": "2016-09-18T23:02:19Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "If $SAGE_SUDO is set, use it whenever we do \"make install\" of a package.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21537",
    "user": "https://github.com/mkoeppe"
}
```
That would be a solution for those who want to install Sage in a prefix that's only writable by root.

In this way, building can take place in unprivileged user account.

It could perhaps also be enabled by `./configure --enable-sudo-install`. (not on this ticket)

This ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.

*** See #21726 for a slightly different approach ***


CC:  @jdemeyer @kiwifb @embray @nexttime @vbraun @mezzarobba

Reviewer: Matthias Koeppe, Samuel Leli√®vre

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/21537





---

archive/issue_comments_396994.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,8 @@\n \n In this way, building can take place in unprivileged user account.\n \n+It could perhaps also be enabled by `./configure --enable-sudo-install`.\n+\n This ticket requires routine changes to all `spkg-install` scripts.\n \n+\n``````\n",
    "created_at": "2016-09-18T23:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396994",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,8 @@
 
 In this way, building can take place in unprivileged user account.
 
+It could perhaps also be enabled by `./configure --enable-sudo-install`.
+
 This ticket requires routine changes to all `spkg-install` scripts.
 
+
``````




---

archive/issue_comments_396995.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/if__sage_sudo_is_set__use_it_whenever_we_do__make_install__of_a_package_\"",
    "created_at": "2016-09-19T00:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396995",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/if__sage_sudo_is_set__use_it_whenever_we_do__make_install__of_a_package_"



---

archive/issue_comments_396996.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[444fd6e](https://git.sagemath.org/sage.git/commit?id=444fd6e910c46e8212e7d10eb160e908e14975c2)|`Add SAGE_SUDO for packages A-L`|",
    "created_at": "2016-09-19T00:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396996",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[444fd6e](https://git.sagemath.org/sage.git/commit?id=444fd6e910c46e8212e7d10eb160e908e14975c2)|`Add SAGE_SUDO for packages A-L`|



---

archive/issue_comments_396997.json:
```json
{
    "body": "Changing commit from \"\" to \"444fd6e910c46e8212e7d10eb160e908e14975c2\"",
    "created_at": "2016-09-19T00:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396997",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "444fd6e910c46e8212e7d10eb160e908e14975c2"



---

archive/issue_comments_396998.json:
```json
{
    "body": "<a id='comment:4'></a>\nPractical matters:\n* documentation \n* If you need a password and that the time between sudo-ing is longer than the time out, you will have to insert the password quite a number of times. In the case of a parallel install, will it block output to screen until you have entered the password?\n\nI don't know enough of the mechanics of sage standard output on screen to know how requesting a password will affect the flow.",
    "created_at": "2016-09-19T00:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396998",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Practical matters:
* documentation 
* If you need a password and that the time between sudo-ing is longer than the time out, you will have to insert the password quite a number of times. In the case of a parallel install, will it block output to screen until you have entered the password?

I don't know enough of the mechanics of sage standard output on screen to know how requesting a password will affect the flow.



---

archive/issue_comments_396999.json:
```json
{
    "body": "<a id='comment:5'></a>\nI guess I should say in the case of parallel make. In which the parallelism of make is translated into installing packages concurrently.",
    "created_at": "2016-09-19T00:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-396999",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I guess I should say in the case of parallel make. In which the parallelism of make is translated into installing packages concurrently.



---

archive/issue_comments_397000.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes, these issues need addressing in documentation and/or implementation.",
    "created_at": "2016-09-19T01:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397000",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Yes, these issues need addressing in documentation and/or implementation.



---

archive/issue_comments_397001.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[666fb57](https://git.sagemath.org/sage.git/commit/?id=666fb57e41dfcb66c08b1ad8231877b515f17a8e)|`Add SAGE_SUDO for packages L-P`|",
    "created_at": "2016-09-19T03:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397001",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[666fb57](https://git.sagemath.org/sage.git/commit/?id=666fb57e41dfcb66c08b1ad8231877b515f17a8e)|`Add SAGE_SUDO for packages L-P`|



---

archive/issue_comments_397002.json:
```json
{
    "body": "Changing commit from \"444fd6e910c46e8212e7d10eb160e908e14975c2\" to \"666fb57e41dfcb66c08b1ad8231877b515f17a8e\"",
    "created_at": "2016-09-19T03:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397002",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "444fd6e910c46e8212e7d10eb160e908e14975c2" to "666fb57e41dfcb66c08b1ad8231877b515f17a8e"



---

archive/issue_comments_397003.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [fbissey](#comment%3A4):\n> In the case of a parallel install, will it block output to screen until you have entered the password?\n> \n> I don't know enough of the mechanics of sage standard output on screen to know how requesting a password will affect the flow.\n\n\nThe problem of parallel output and prompts has been discussed before in #20884, #21082. \nAlso #21539 could help.",
    "created_at": "2016-09-19T04:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397003",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [fbissey](#comment%3A4):
> In the case of a parallel install, will it block output to screen until you have entered the password?
> 
> I don't know enough of the mechanics of sage standard output on screen to know how requesting a password will affect the flow.


The problem of parallel output and prompts has been discussed before in #20884, #21082. 
Also #21539 could help.



---

archive/issue_comments_397004.json:
```json
{
    "body": "Changing commit from \"666fb57e41dfcb66c08b1ad8231877b515f17a8e\" to \"ec6ce246c07221e75fad1c1a6d47983156753540\"",
    "created_at": "2016-09-19T05:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397004",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "666fb57e41dfcb66c08b1ad8231877b515f17a8e" to "ec6ce246c07221e75fad1c1a6d47983156753540"



---

archive/issue_comments_397005.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[ec6ce24](https://git.sagemath.org/sage.git/commit/?id=ec6ce246c07221e75fad1c1a6d47983156753540)|`spkg-do-install: Make executable`|",
    "created_at": "2016-09-19T05:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[ec6ce24](https://git.sagemath.org/sage.git/commit/?id=ec6ce246c07221e75fad1c1a6d47983156753540)|`spkg-do-install: Make executable`|



---

archive/issue_comments_397006.json:
```json
{
    "body": "Changing commit from \"ec6ce246c07221e75fad1c1a6d47983156753540\" to \"23e3ddcebbdfbae9d22e05688d2b98acc6c61726\"",
    "created_at": "2016-09-20T04:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ec6ce246c07221e75fad1c1a6d47983156753540" to "23e3ddcebbdfbae9d22e05688d2b98acc6c61726"



---

archive/issue_comments_397007.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[23e3ddc](https://git.sagemath.org/sage.git/commit/?id=23e3ddcebbdfbae9d22e05688d2b98acc6c61726)|`Packages P-S`|",
    "created_at": "2016-09-20T04:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[23e3ddc](https://git.sagemath.org/sage.git/commit/?id=23e3ddcebbdfbae9d22e05688d2b98acc6c61726)|`Packages P-S`|



---

archive/issue_comments_397008.json:
```json
{
    "body": "Changing commit from \"23e3ddcebbdfbae9d22e05688d2b98acc6c61726\" to \"74fbeff37dd0fe35ff5d85ade206b4fe9644cc79\"",
    "created_at": "2016-09-20T05:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "23e3ddcebbdfbae9d22e05688d2b98acc6c61726" to "74fbeff37dd0fe35ff5d85ade206b4fe9644cc79"



---

archive/issue_comments_397009.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[341bdb0](https://git.sagemath.org/sage.git/commit/?id=341bdb031065ca9c4427dd9c3f75aa54bda2a442)|`Packages M-Z`|\n|[74fbeff](https://git.sagemath.org/sage.git/commit/?id=74fbeff37dd0fe35ff5d85ade206b4fe9644cc79)|`Call pip with SAGE_SUDO`|",
    "created_at": "2016-09-20T05:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[341bdb0](https://git.sagemath.org/sage.git/commit/?id=341bdb031065ca9c4427dd9c3f75aa54bda2a442)|`Packages M-Z`|
|[74fbeff](https://git.sagemath.org/sage.git/commit/?id=74fbeff37dd0fe35ff5d85ade206b4fe9644cc79)|`Call pip with SAGE_SUDO`|



---

archive/issue_comments_397010.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2016-09-20T05:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397010",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_397011.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[d8919cc](https://git.sagemath.org/sage.git/commit/?id=d8919cc342ccff35109c2696ba6c87220ccd83bc)|`Add SAGE_SUDO for packages A-L`|\n|[7f46f6c](https://git.sagemath.org/sage.git/commit/?id=7f46f6c8ca27e5694f3d935844051647808688ae)|`Add SAGE_SUDO for packages L-P`|\n|[ccb3a13](https://git.sagemath.org/sage.git/commit/?id=ccb3a137bd0a672337f0b45131bf6f1c972b657f)|`spkg-do-install: Make executable`|\n|[3f957cc](https://git.sagemath.org/sage.git/commit/?id=3f957ccbf403b960d11e903fb74db5c31b43c71a)|`Packages P-S`|\n|[c806e9f](https://git.sagemath.org/sage.git/commit/?id=c806e9f50ff8e8f67f46c72046b93df164b2c82f)|`Packages M-Z`|\n|[abd3e96](https://git.sagemath.org/sage.git/commit/?id=abd3e96ace7de829396b691e209bb7dd813dd77d)|`Call pip with SAGE_SUDO`|",
    "created_at": "2016-09-27T19:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[d8919cc](https://git.sagemath.org/sage.git/commit/?id=d8919cc342ccff35109c2696ba6c87220ccd83bc)|`Add SAGE_SUDO for packages A-L`|
|[7f46f6c](https://git.sagemath.org/sage.git/commit/?id=7f46f6c8ca27e5694f3d935844051647808688ae)|`Add SAGE_SUDO for packages L-P`|
|[ccb3a13](https://git.sagemath.org/sage.git/commit/?id=ccb3a137bd0a672337f0b45131bf6f1c972b657f)|`spkg-do-install: Make executable`|
|[3f957cc](https://git.sagemath.org/sage.git/commit/?id=3f957ccbf403b960d11e903fb74db5c31b43c71a)|`Packages P-S`|
|[c806e9f](https://git.sagemath.org/sage.git/commit/?id=c806e9f50ff8e8f67f46c72046b93df164b2c82f)|`Packages M-Z`|
|[abd3e96](https://git.sagemath.org/sage.git/commit/?id=abd3e96ace7de829396b691e209bb7dd813dd77d)|`Call pip with SAGE_SUDO`|



---

archive/issue_comments_397012.json:
```json
{
    "body": "Changing commit from \"74fbeff37dd0fe35ff5d85ade206b4fe9644cc79\" to \"abd3e96ace7de829396b691e209bb7dd813dd77d\"",
    "created_at": "2016-09-27T19:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "74fbeff37dd0fe35ff5d85ade206b4fe9644cc79" to "abd3e96ace7de829396b691e209bb7dd813dd77d"



---

archive/issue_comments_397013.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,9 @@\n \n In this way, building can take place in unprivileged user account.\n \n-It could perhaps also be enabled by `./configure --enable-sudo-install`.\n+It could perhaps also be enabled by `./configure --enable-sudo-install`. (not on this ticket)\n \n-This ticket requires routine changes to all `spkg-install` scripts.\n+This ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.\n \n \n+\n``````\n",
    "created_at": "2016-09-27T19:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397013",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,9 @@
 
 In this way, building can take place in unprivileged user account.
 
-It could perhaps also be enabled by `./configure --enable-sudo-install`.
+It could perhaps also be enabled by `./configure --enable-sudo-install`. (not on this ticket)
 
-This ticket requires routine changes to all `spkg-install` scripts.
+This ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.
 
 
+
``````




---

archive/issue_comments_397014.json:
```json
{
    "body": "<a id='comment:14'></a>\nRebased on 7.4.beta6. \nNeeds review.",
    "created_at": "2016-09-27T19:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Rebased on 7.4.beta6. 
Needs review.



---

archive/issue_comments_397015.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-27T19:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397015",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397016.json:
```json
{
    "body": "<a id='comment:15'></a>\nSomehow this makes me feel a bit icky, but I'm not -1 on it either.  It's a solution for now.  I feel icky because if the Sage distribution were like a \"normal\" autoconf package I should be able to simply run `make && sudo make install` and not have tell configure that I intend to use sudo when I install.  Nor should sudo be invoked in each sub-make.  But the Sage distribution is definitely *not* a normal package since really it's just a big wrapper around a bunch of other packages, combined with some semblance of dependency management.\n\nThat said, it would be *nice* if the Sage distribution did work like `make && sudo make install`.  To me, this points toward another area where sage packages could and probably should be refactored anyways.  If packages had separate `spkg-build` and `spkg-install` scripts that would go a long way, I think.  Then `make`/`make build` would run the `spkg-build` scripts, and only `make install` would run the actual `spkg-install` scripts.  It would probably also go a long ways towards further eliminating duplication of effort between the many `spkg-install` scripts.\n\nOn another note, for Python packages installed with pip it still might be best to have separate \"build\" and \"install\" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  For that to work it might be best if this waited on #21441 which adds a new `sage-pip-install` script, which might be further modified to support this usage.",
    "created_at": "2016-09-28T06:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397016",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Somehow this makes me feel a bit icky, but I'm not -1 on it either.  It's a solution for now.  I feel icky because if the Sage distribution were like a "normal" autoconf package I should be able to simply run `make && sudo make install` and not have tell configure that I intend to use sudo when I install.  Nor should sudo be invoked in each sub-make.  But the Sage distribution is definitely *not* a normal package since really it's just a big wrapper around a bunch of other packages, combined with some semblance of dependency management.

That said, it would be *nice* if the Sage distribution did work like `make && sudo make install`.  To me, this points toward another area where sage packages could and probably should be refactored anyways.  If packages had separate `spkg-build` and `spkg-install` scripts that would go a long way, I think.  Then `make`/`make build` would run the `spkg-build` scripts, and only `make install` would run the actual `spkg-install` scripts.  It would probably also go a long ways towards further eliminating duplication of effort between the many `spkg-install` scripts.

On another note, for Python packages installed with pip it still might be best to have separate "build" and "install" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  For that to work it might be best if this waited on #21441 which adds a new `sage-pip-install` script, which might be further modified to support this usage.



---

archive/issue_comments_397017.json:
```json
{
    "body": "<a id='comment:16'></a>\nFine with me to wait for #21441 and its `sage-pip-install`. Is that ticket moving forward, by the way?",
    "created_at": "2016-09-29T07:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397017",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Fine with me to wait for #21441 and its `sage-pip-install`. Is that ticket moving forward, by the way?



---

archive/issue_comments_397018.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [embray](#comment%3A15):\n> [...] if the Sage distribution were like a \"normal\" autoconf package I should be able to simply run `make && sudo make install` and not have tell configure that I intend to use sudo when I install.  \n\n\nJust for reference for other readers (I know that you are aware of that ticket, Erik): Any discussion of separating `make` and `make install` for sage-the-distribution should take place on ticket #21495.",
    "created_at": "2016-09-30T01:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397018",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Replying to [embray](#comment%3A15):
> [...] if the Sage distribution were like a "normal" autoconf package I should be able to simply run `make && sudo make install` and not have tell configure that I intend to use sudo when I install.  


Just for reference for other readers (I know that you are aware of that ticket, Erik): Any discussion of separating `make` and `make install` for sage-the-distribution should take place on ticket #21495.



---

archive/issue_comments_397019.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [embray](#comment%3A15):\n>  To me, this points toward another area where sage packages could and probably should be refactored anyways.  If packages had separate `spkg-build` and `spkg-install` scripts that would go a long way, I think.  Then `make`/`make build` would run the `spkg-build` scripts, and only `make install` would run the actual `spkg-install` scripts.  It would probably also go a long ways towards further eliminating duplication of effort between the many `spkg-install` scripts.\n\n\nRight now, in this patch I am calling `spkg-do-install` scripts with `$SAGE_SUDO` from various package's `spkg-install` scripts.\nOf course, each package's `spkg-install` script needs to be changed for `$SAGE_SUDO` to work, and installing packages that have not been prepared for it will cause an error when trying to install them to a prefix that is only root-writable.\n\nAn \"easier\" solution would be to just call `spkg-build` if it exists, unprivileged, and then call `spkg-install` using `$SAGE_SUDO`. This would \"just work\" without making changes to the -- but it would run a lot of stuff as root until a package moves its build part from `spkg-install` to `spkg-build`.\n\nThoughts?\n\n> On another note, for Python packages installed with pip it still might be best to have separate \"build\" and \"install\" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  \n\n\nAre you sure that Python packages with extension modules are relocatable in this way? I have no experience with the specifics of the Python distutils world, but I would imagine all kinds of trouble (rpath/sonames, possible hardcoded paths, ...)\n\n> For that to work it might be best if this waited on #21441 which adds a new `sage-pip-install` script, which might be further modified to support this usage.\n\n\nSure, I've made it a dependency.",
    "created_at": "2016-09-30T01:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397019",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [embray](#comment%3A15):
>  To me, this points toward another area where sage packages could and probably should be refactored anyways.  If packages had separate `spkg-build` and `spkg-install` scripts that would go a long way, I think.  Then `make`/`make build` would run the `spkg-build` scripts, and only `make install` would run the actual `spkg-install` scripts.  It would probably also go a long ways towards further eliminating duplication of effort between the many `spkg-install` scripts.


Right now, in this patch I am calling `spkg-do-install` scripts with `$SAGE_SUDO` from various package's `spkg-install` scripts.
Of course, each package's `spkg-install` script needs to be changed for `$SAGE_SUDO` to work, and installing packages that have not been prepared for it will cause an error when trying to install them to a prefix that is only root-writable.

An "easier" solution would be to just call `spkg-build` if it exists, unprivileged, and then call `spkg-install` using `$SAGE_SUDO`. This would "just work" without making changes to the -- but it would run a lot of stuff as root until a package moves its build part from `spkg-install` to `spkg-build`.

Thoughts?

> On another note, for Python packages installed with pip it still might be best to have separate "build" and "install" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  


Are you sure that Python packages with extension modules are relocatable in this way? I have no experience with the specifics of the Python distutils world, but I would imagine all kinds of trouble (rpath/sonames, possible hardcoded paths, ...)

> For that to work it might be best if this waited on #21441 which adds a new `sage-pip-install` script, which might be further modified to support this usage.


Sure, I've made it a dependency.



---

archive/issue_comments_397020.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21441\"",
    "created_at": "2016-09-30T01:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397020",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#21441"



---

archive/issue_comments_397021.json:
```json
{
    "body": "<a id='comment:19'></a>\nRight, regardless of how make is invoked, if there are separate `spkg-build` and `spkg-install` scripts the former can be run unprivileged.  Then, at least in the current system, you would call `$SAGE_SUDO spkg-install`.\n\nI think most packages would be easy enough to split up their `spkg-install` into two scripts.  Though as I think I wrote in another ticket one might actually want a third `spkg-env` script that sets environment variables needed for both the build and install steps (fortunately for most autotools packages most relevant environment variables are only needed for the build step, I think).",
    "created_at": "2016-09-30T10:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397021",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
Right, regardless of how make is invoked, if there are separate `spkg-build` and `spkg-install` scripts the former can be run unprivileged.  Then, at least in the current system, you would call `$SAGE_SUDO spkg-install`.

I think most packages would be easy enough to split up their `spkg-install` into two scripts.  Though as I think I wrote in another ticket one might actually want a third `spkg-env` script that sets environment variables needed for both the build and install steps (fortunately for most autotools packages most relevant environment variables are only needed for the build step, I think).



---

archive/issue_comments_397022.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [mkoeppe](#comment%3A18):\n> Replying to [embray](#comment%3A15):\n> > On another note, for Python packages installed with pip it still might be best to have separate \"build\" and \"install\" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  \n\n> \n> Are you sure that Python packages with extension modules are relocatable in this way? I have no experience with the specifics of the Python distutils world, but I would imagine all kinds of trouble (rpath/sonames, possible hardcoded paths, ...)\n\n\nIn general, yes, it should not be a problem.  This does not affect rpath or soname for extension modules--I mean in principle it could but that would be a pathological case the likes of which I've never seen, and that is definitely not supported.\n\nIn principle one could also imagine a module that when installed generates some files containing hard-coded paths, but can't think of anything like that.  Most well made Python modules are good about keeping such things relative and dynamic.  So I'd be surprised if that's a problem anywhere, though if it is obviously exceptions can be made.\n\n(**Update:** In fact, I should add, this is how distutils builds packages normally anyways--first it builds everything to `build/`, and then simply copies from there directly to the install location--what I described simply adds one additional copy.  All the \"install\" commands really do in distutils is copy files--all the real work should usually be done in the \"build\" command (or sub-commands thereof).)",
    "created_at": "2016-09-30T10:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397022",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Replying to [mkoeppe](#comment%3A18):
> Replying to [embray](#comment%3A15):
> > On another note, for Python packages installed with pip it still might be best to have separate "build" and "install" phases--in particular for Python packages with extension modules, where one might not want to be running a compiler as root.  This could be achieved by running `pip install` without sudo with a temporary target directory, and then copying into the appropriate `site-packages` (perhaps after an uninstall of previously installed versions of the package).  

> 
> Are you sure that Python packages with extension modules are relocatable in this way? I have no experience with the specifics of the Python distutils world, but I would imagine all kinds of trouble (rpath/sonames, possible hardcoded paths, ...)


In general, yes, it should not be a problem.  This does not affect rpath or soname for extension modules--I mean in principle it could but that would be a pathological case the likes of which I've never seen, and that is definitely not supported.

In principle one could also imagine a module that when installed generates some files containing hard-coded paths, but can't think of anything like that.  Most well made Python modules are good about keeping such things relative and dynamic.  So I'd be surprised if that's a problem anywhere, though if it is obviously exceptions can be made.

(**Update:** In fact, I should add, this is how distutils builds packages normally anyways--first it builds everything to `build/`, and then simply copies from there directly to the install location--what I described simply adds one additional copy.  All the "install" commands really do in distutils is copy files--all the real work should usually be done in the "build" command (or sub-commands thereof).)



---

archive/issue_comments_397023.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-19T03:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397023",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n \n This ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.\n \n+*** See #21726 for a slightly different approach ***\n \n-\n``````\n",
    "created_at": "2016-10-19T03:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397024",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 
 This ticket makes routine changes to all `spkg-install` scripts. Whenever installing has more steps than just `make install`, it moves the install part to a separate script `spkg-do-install`.
 
+*** See #21726 for a slightly different approach ***
 
-
``````




---

archive/issue_comments_397025.json:
```json
{
    "body": "Changing dependencies from \"#21441\" to \"#21726\"",
    "created_at": "2016-11-08T18:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397025",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#21441" to "#21726"



---

archive/issue_comments_397026.json:
```json
{
    "body": "Changing work_issues from \"\" to \"redo patch using the method of 21726\"",
    "created_at": "2016-11-08T18:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397026",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "" to "redo patch using the method of 21726"



---

archive/issue_comments_397027.json:
```json
{
    "body": "Changing type from enhancement to task.",
    "created_at": "2016-11-08T18:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397027",
    "user": "https://github.com/mkoeppe"
}
```

Changing type from enhancement to task.



---

archive/issue_events_057169.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-11-08T18:53:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21537#event-57169"
}
```



---

archive/issue_comments_397028.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-15T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397028",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_397029.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis was implemented in #21726. The present ticket can be closed",
    "created_at": "2020-09-15T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397029",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
This was implemented in #21726. The present ticket can be closed



---

archive/issue_events_057170.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T18:40:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21537#event-57170"
}
```



---

archive/issue_events_057171.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T18:40:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21537#event-57171"
}
```



---

archive/issue_comments_397030.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"\"",
    "created_at": "2020-09-15T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397030",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe" to ""



---

archive/issue_comments_397031.json:
```json
{
    "body": "<a id='comment:25'></a>\nOk.",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397031",
    "user": "https://github.com/slel"
}
```

<a id='comment:25'></a>
Ok.



---

archive/issue_comments_397032.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/if__sage_sudo_is_set__use_it_whenever_we_do__make_install__of_a_package_\" to \"\"",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397032",
    "user": "https://github.com/slel"
}
```

Changing branch from "u/mkoeppe/if__sage_sudo_is_set__use_it_whenever_we_do__make_install__of_a_package_" to ""



---

archive/issue_comments_397033.json:
```json
{
    "body": "Changing commit from \"abd3e96ace7de829396b691e209bb7dd813dd77d\" to \"\"",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397033",
    "user": "https://github.com/slel"
}
```

Changing commit from "abd3e96ace7de829396b691e209bb7dd813dd77d" to ""



---

archive/issue_comments_397034.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397034",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397035.json:
```json
{
    "body": "Changing work_issues from \"redo patch using the method of 21726\" to \"\"",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397035",
    "user": "https://github.com/slel"
}
```

Changing work_issues from "redo patch using the method of 21726" to ""



---

archive/issue_comments_397036.json:
```json
{
    "body": "Changing dependencies from \"#21726\" to \"\"",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397036",
    "user": "https://github.com/slel"
}
```

Changing dependencies from "#21726" to ""



---

archive/issue_comments_397037.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe, Samuel Leli\u00e8vre\"",
    "created_at": "2021-08-19T22:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397037",
    "user": "https://github.com/slel"
}
```

Changing reviewer from "" to "Matthias Koeppe, Samuel Leli√®vre"



---

archive/issue_events_057172.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:08:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21537#event-57172"
}
```



---

archive/issue_comments_397038.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-08-26T02:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21537",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21537#issuecomment-397038",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
