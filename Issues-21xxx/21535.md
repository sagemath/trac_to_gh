# Issue 21535: Make src/setup.py respect --build-base and --inplace, independent of SAGE_CYTHONIZED

archive/issues_021298.json:
```json
{
    "assignees": [
        "https://github.com/embray"
    ],
    "body": "This is a follow-up on #21480, which put `src/setup.py` in charge of all `sagelib`building and removed dependencies on various environment variables, as a step towards the goal of making `sagelib` an ordinary Python package (#21507). \n\nHowever, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by `setup.py build --build-base`).\n\nThis dependency should be removed.\n\nAlso, `--inplace` should be supported.\n(See also: #12659: build the sage library in place)\n\nSee also #21508 on other cleanup issues of `src/setup.py`. \n\nDepends on #21480\nDepends on #21600\nDepends on #21604\nDepends on #23744\n\nCC:  @jdemeyer @embray\n\nBranch/Commit: **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21535_\n\n",
    "closed_at": "2017-09-10T22:05:52Z",
    "created_at": "2016-09-18T20:17:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make src/setup.py respect --build-base and --inplace, independent of SAGE_CYTHONIZED",
    "type": "issue",
    "updated_at": "2017-09-10T22:05:52Z",
    "url": "https://github.com/sagemath/sage/issues/21535",
    "user": "https://github.com/mkoeppe"
}
```
This is a follow-up on #21480, which put `src/setup.py` in charge of all `sagelib`building and removed dependencies on various environment variables, as a step towards the goal of making `sagelib` an ordinary Python package (#21507). 

However, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by `setup.py build --build-base`).

This dependency should be removed.

Also, `--inplace` should be supported.
(See also: #12659: build the sage library in place)

See also #21508 on other cleanup issues of `src/setup.py`. 

Depends on #21480
Depends on #21600
Depends on #21604
Depends on #23744

CC:  @jdemeyer @embray

Branch/Commit: **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**

Reviewer: **Matthias Koeppe**

Author: **Jeroen Demeyer**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/21535_





---

archive/issue_events_302483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T20:17:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302483"
}
```



---

archive/issue_events_302484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T20:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302484"
}
```



---

archive/issue_events_302485.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T20:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302485"
}
```



---

archive/issue_events_302486.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-18T20:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302486"
}
```



---

archive/issue_comments_316156.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI think I've brought this up with jdemeyer before, who had some objections (I think where I brought it up originally was in the context of cysignals, but same applies to sage itself).  Ultimately what it came down to is that he prefers the source tree to always be clean of build artifacts, which I can certainly respect.  But I don't personally have a problem like that, and like to be able to use `./setup.py build_ext --inplace` for in-place testing, which I find cuts down on time spent in the \"edit-build-install\" cycle.\n\nIn any case, these are subjective preferences for development practice, and I think either way should work--eliminating dependency on `$SAGE_CYTHONIZED` should be a step in the right direction.",
    "created_at": "2016-09-22T15:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316156",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

I think I've brought this up with jdemeyer before, who had some objections (I think where I brought it up originally was in the context of cysignals, but same applies to sage itself).  Ultimately what it came down to is that he prefers the source tree to always be clean of build artifacts, which I can certainly respect.  But I don't personally have a problem like that, and like to be able to use `./setup.py build_ext --inplace` for in-place testing, which I find cuts down on time spent in the "edit-build-install" cycle.

In any case, these are subjective preferences for development practice, and I think either way should work--eliminating dependency on `$SAGE_CYTHONIZED` should be a step in the right direction.



---

archive/issue_comments_316157.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@embray](#comment:1):\n> Ultimately what it came down to is that `[`jdemeyer`]` prefers the source tree to always be clean of build artifacts, which I can certainly respect.  But I don't personally have a problem like that, and \n\nI also like to keep the source tree clean, which is why I usually use VPATH builds. I have created #21469 for that.\n\n> like to be able to use `./setup.py build_ext --inplace` for in-place testing, which I find cuts down on time spent in the \"edit-build-install\" cycle.\n\nThanks for pointing out `--inplace`. I'll look into this.",
    "created_at": "2016-09-22T17:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316157",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@embray](#comment:1):
> Ultimately what it came down to is that `[`jdemeyer`]` prefers the source tree to always be clean of build artifacts, which I can certainly respect.  But I don't personally have a problem like that, and 

I also like to keep the source tree clean, which is why I usually use VPATH builds. I have created #21469 for that.

> like to be able to use `./setup.py build_ext --inplace` for in-place testing, which I find cuts down on time spent in the "edit-build-install" cycle.

Thanks for pointing out `--inplace`. I'll look into this.



---

archive/issue_comments_316158.json:
```json
{
    "body": "Dependencies: **#21480, #21600, #21604**",
    "created_at": "2016-10-11T18:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316158",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#21480, #21600, #21604**



---

archive/issue_events_302487.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-11T18:20:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "title_is": "Make src/setup.py respect --build-base and --inplace, independent of SAGE_CYTHONIZED",
    "title_was": "Make src/setup.py independent of SAGE_CYTHONIZED",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302487"
}
```



---

archive/issue_comments_316159.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n This is a follow-up on #21480, which put `src/setup.py` in charge of all `sagelib`building and removed dependencies on various environment variables, as a step towards the goal of making `sagelib` an ordinary Python package (#21507). \n \n-However, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by setup.py build --build-base).\n+However, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by `setup.py build --build-base`).\n \n This dependency should be removed.\n \n+Also, `--inplace` should be supported.\n+\n See also #21508 on other cleanup issues of `src/setup.py`. \n``````\n",
    "created_at": "2016-10-11T18:20:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316159",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
 This is a follow-up on #21480, which put `src/setup.py` in charge of all `sagelib`building and removed dependencies on various environment variables, as a step towards the goal of making `sagelib` an ordinary Python package (#21507). 
 
-However, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by setup.py build --build-base).
+However, there is still a dependency on `$SAGE_CYTHONIZED`, which needs to be set in a way that matches the build-base (set by `setup.py build --build-base`).
 
 This dependency should be removed.
 
+Also, `--inplace` should be supported.
+
 See also #21508 on other cleanup issues of `src/setup.py`. 
``````




---

archive/issue_comments_316160.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n#21682 might help with this one--it makes SAGE_CYTHONIZED mostly irrelevant IMO.",
    "created_at": "2016-10-12T08:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316160",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

#21682 might help with this one--it makes SAGE_CYTHONIZED mostly irrelevant IMO.



---

archive/issue_events_302488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-30T18:16:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302488"
}
```



---

archive/issue_events_302489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-30T18:16:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302489"
}
```



---

archive/issue_comments_316161.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,6 @@\n This dependency should be removed.\n \n Also, `--inplace` should be supported.\n+(See also: #12659: build the sage library in place)\n \n See also #21508 on other cleanup issues of `src/setup.py`. \n``````\n",
    "created_at": "2016-10-30T18:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316161",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,6 @@
 This dependency should be removed.
 
 Also, `--inplace` should be supported.
+(See also: #12659: build the sage library in place)
 
 See also #21508 on other cleanup issues of `src/setup.py`. 
``````




---

archive/issue_comments_316162.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI should be able to fix this with or without #21682, though I think it helps.",
    "created_at": "2016-11-07T13:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316162",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I should be able to fix this with or without #21682, though I think it helps.



---

archive/issue_events_302490.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-11-07T13:27:48Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "subject": "https://github.com/embray",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302490"
}
```



---

archive/issue_comments_316163.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWouldn't it be easier to fix with #21682, given that you are adding a `--build-dir` option?",
    "created_at": "2016-11-07T13:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316163",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Wouldn't it be easier to fix with #21682, given that you are adding a `--build-dir` option?



---

archive/issue_comments_316164.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYes, it would be easier.",
    "created_at": "2016-11-07T14:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316164",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Yes, it would be easier.



---

archive/issue_comments_316165.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSo what would be the impact of removing SAGE_CYTHONIZED entirely?  As far as I can tell it is only really used by setup.py/sage_setup.  Implementing this ticket makes it pretty pointless I think--it makes SAGE_CYTHONIZED not even make sense, really.\n\nWould it be a problem to outright remove it?  Or does it need to still be supported somehow?",
    "created_at": "2016-11-08T12:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316165",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

So what would be the impact of removing SAGE_CYTHONIZED entirely?  As far as I can tell it is only really used by setup.py/sage_setup.  Implementing this ticket makes it pretty pointless I think--it makes SAGE_CYTHONIZED not even make sense, really.

Would it be a problem to outright remove it?  Or does it need to still be supported somehow?



---

archive/issue_comments_316166.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n+1 for getting rid of SAGE_CYTHONIZED completely if you can.",
    "created_at": "2016-11-08T12:28:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316166",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

+1 for getting rid of SAGE_CYTHONIZED completely if you can.



---

archive/issue_comments_316167.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nErik and Jeroen, given that #21682 (`setup.py build_cython`) is merged, can we now get rid of `SAGE_CYTHONIZED` and support `setup.py build --build-base`?",
    "created_at": "2017-08-27T04:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316167",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Erik and Jeroen, given that #21682 (`setup.py build_cython`) is merged, can we now get rid of `SAGE_CYTHONIZED` and support `setup.py build --build-base`?



---

archive/issue_comments_316168.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI'd be all for that. Do you need me to work on it?",
    "created_at": "2017-08-29T10:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316168",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

I'd be all for that. Do you need me to work on it?



---

archive/issue_comments_316169.json:
```json
{
    "body": "Changed dependencies from **#21480, #21600, #21604** to **#21480, #21600, #21604, #23744**",
    "created_at": "2017-08-29T13:31:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316169",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#21480, #21600, #21604** to **#21480, #21600, #21604, #23744**



---

archive/issue_comments_316170.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAs a small first step, see #23744.",
    "created_at": "2017-08-29T13:31:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316170",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

As a small first step, see #23744.



---

archive/issue_comments_316171.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:12):\n> I'd be all for that. Do you need me to work on it?\n\nThat would be great!\n\nBy the way, in my current attempt at #21469 I noticed that `--build-base` already works. \n\nThis line in `src/setup.py`:\n\n```\nbuild_base = 'build' # the distutils default. Changing it is not supported by this setup.sh.\n```\nis probably a leftover from my earlier changes, and should probably be removed. The variable `build_base` does not seem to be used, and the comment is no longer correct.",
    "created_at": "2017-08-29T17:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316171",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:12):
> I'd be all for that. Do you need me to work on it?

That would be great!

By the way, in my current attempt at #21469 I noticed that `--build-base` already works. 

This line in `src/setup.py`:

```
build_base = 'build' # the distutils default. Changing it is not supported by this setup.sh.
```
is probably a leftover from my earlier changes, and should probably be removed. The variable `build_base` does not seem to be used, and the comment is no longer correct.



---

archive/issue_comments_316172.json:
```json
{
    "body": "Branch: **[u/jdemeyer/no_SAGE_CYTHONIZED](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/no_SAGE_CYTHONIZED)**",
    "created_at": "2017-09-01T12:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316172",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/no_SAGE_CYTHONIZED](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/no_SAGE_CYTHONIZED)**



---

archive/issue_events_302491.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-01T12:23:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302491"
}
```



---

archive/issue_comments_316173.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-09-01T12:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316173",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_316174.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHere is a branch getting rid of `SAGE_CYTHONIZED`. Unfortunately, two doctests in `sage_setup` still require `SAGE_CYTHONIZED`, so I just hardcoded the value there. This clearly goes against DRY, so I'm not so happy with it. Ideas or improvements are welcome.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33746a28f185fbabd69319ca3cde6a7316dff017\">33746a2</a></td><td><code>Don't use SAGE_CYTHONIZED in sage_include_directories()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c\">769de13</a></td><td><code>Stop using SAGE_CYTHONIZED</code></td></tr></table>\n",
    "created_at": "2017-09-01T12:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316174",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Here is a branch getting rid of `SAGE_CYTHONIZED`. Unfortunately, two doctests in `sage_setup` still require `SAGE_CYTHONIZED`, so I just hardcoded the value there. This clearly goes against DRY, so I'm not so happy with it. Ideas or improvements are welcome.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33746a28f185fbabd69319ca3cde6a7316dff017">33746a2</a></td><td><code>Don't use SAGE_CYTHONIZED in sage_include_directories()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c">769de13</a></td><td><code>Stop using SAGE_CYTHONIZED</code></td></tr></table>




---

archive/issue_comments_316175.json:
```json
{
    "body": "Commit: **[`769de13`](https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c)**",
    "created_at": "2017-09-01T12:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316175",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`769de13`](https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c)**



---

archive/issue_events_302492.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-01T12:23:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302492"
}
```



---

archive/issue_events_302493.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-01T12:23:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302493"
}
```



---

archive/issue_comments_316176.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHmm--one idea might be for `setup.py` to write out a sort of build configuration file, similar to what we do with `.cython_version`, logging attributes of interest from the distutils `Distribution`.  The test could then use that to determine the `build_base` that was used for the last build.  Probably overkill just to make a test work, but having such a file might be useful even for debugging/logging purposes if nothing else.",
    "created_at": "2017-09-01T12:52:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316176",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Hmm--one idea might be for `setup.py` to write out a sort of build configuration file, similar to what we do with `.cython_version`, logging attributes of interest from the distutils `Distribution`.  The test could then use that to determine the `build_base` that was used for the last build.  Probably overkill just to make a test work, but having such a file might be useful even for debugging/logging purposes if nothing else.



---

archive/issue_comments_316177.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:16):\n> Here is a branch getting rid of `SAGE_CYTHONIZED`. Unfortunately, two doctests in `sage_setup` still require `SAGE_CYTHONIZED`, so I just hardcoded the value there. This clearly goes against DRY, so I'm not so happy with it. Ideas or improvements are welcome.\n\nCommit 33746a2 is good, but I think some of the changes in 769de13 are not going in the right direction.\n\n1) In particular the following, I think, breaks the already working `--build-base` feature (see comment 14)!\n\n```diff\ndiff --git a/src/setup.py b/src/setup.py\nindex 6354427..be4036d 100755\n--- a/src/setup.py\n+++ b/src/setup.py\n@@ -52,12 +52,16 @@ sys.excepthook = excepthook\n \n build_base = 'build' # the distutils default. Changing it is not supported by this setup.sh.\n \n+# Directory to store Cython-generated files\n+SAGE_CYTHONIZED = os.path.join(build_base, \"cythonized\")\n+\n```\n\n2) The hardcoded paths depending on SAGE_SRC make it harder for the VPATH patch. Perhaps it's best to do this work after VPATH (#21469) is done.",
    "created_at": "2017-09-01T15:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316177",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:16):
> Here is a branch getting rid of `SAGE_CYTHONIZED`. Unfortunately, two doctests in `sage_setup` still require `SAGE_CYTHONIZED`, so I just hardcoded the value there. This clearly goes against DRY, so I'm not so happy with it. Ideas or improvements are welcome.

Commit 33746a2 is good, but I think some of the changes in 769de13 are not going in the right direction.

1) In particular the following, I think, breaks the already working `--build-base` feature (see comment 14)!

```diff
diff --git a/src/setup.py b/src/setup.py
index 6354427..be4036d 100755
--- a/src/setup.py
+++ b/src/setup.py
@@ -52,12 +52,16 @@ sys.excepthook = excepthook
 
 build_base = 'build' # the distutils default. Changing it is not supported by this setup.sh.
 
+# Directory to store Cython-generated files
+SAGE_CYTHONIZED = os.path.join(build_base, "cythonized")
+
```

2) The hardcoded paths depending on SAGE_SRC make it harder for the VPATH patch. Perhaps it's best to do this work after VPATH (#21469) is done.



---

archive/issue_comments_316178.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@embray](#comment:17):\n> Hmm--one idea might be for `setup.py` to write out a sort of build configuration file, similar to what we do with `.cython_version`, logging attributes of interest from the distutils `Distribution`.  The test could then use that to determine the `build_base` that was used for the last build.  Probably overkill just to make a test work, but having such a file might be useful even for debugging/logging purposes if nothing else.\n\nYes, I think this is a good idea. Basically this is part of #21707 (Split `sage-env` into `sage-build-env`, `sagelib-build-env` and `sage-env`) -- `setup.sh` should be responsible for writing out a configuration file concerning sagelib.",
    "created_at": "2017-09-01T15:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316178",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@embray](#comment:17):
> Hmm--one idea might be for `setup.py` to write out a sort of build configuration file, similar to what we do with `.cython_version`, logging attributes of interest from the distutils `Distribution`.  The test could then use that to determine the `build_base` that was used for the last build.  Probably overkill just to make a test work, but having such a file might be useful even for debugging/logging purposes if nothing else.

Yes, I think this is a good idea. Basically this is part of #21707 (Split `sage-env` into `sage-build-env`, `sagelib-build-env` and `sage-env`) -- `setup.sh` should be responsible for writing out a configuration file concerning sagelib.



---

archive/issue_events_302494.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T15:48:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302494"
}
```



---

archive/issue_events_302495.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-01T15:48:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302495"
}
```



---

archive/issue_comments_316179.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.",
    "created_at": "2017-09-02T11:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316179",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

I see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.



---

archive/issue_comments_316180.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWorking on this...",
    "created_at": "2017-09-02T13:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316180",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Working on this...



---

archive/issue_comments_316181.json:
```json
{
    "body": "Changed commit from **[`769de13`](https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c)** to **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**",
    "created_at": "2017-09-02T15:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`769de13`](https://github.com/sagemath/sagetrac-mirror/commit/769de13efb2d23fcb511dc1987ab82204e15150c)** to **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**



---

archive/issue_comments_316182.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9\">bd91b43</a></td><td><code>Stop using SAGE_CYTHONIZED</code></td></tr></table>\n",
    "created_at": "2017-09-02T15:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316182",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9">bd91b43</a></td><td><code>Stop using SAGE_CYTHONIZED</code></td></tr></table>




---

archive/issue_events_302496.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-02T15:11:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302496"
}
```



---

archive/issue_events_302497.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-02T15:11:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302497"
}
```



---

archive/issue_comments_316183.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis should address the concerns about `build_base`. The doctests still hardcode `build/cythonized`, but I prefer to fix that in a different ticket. I think this branch here does enough good things (even if it's not perfect), so I'm setting it back to needs_review.",
    "created_at": "2017-09-02T15:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316183",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

This should address the concerns about `build_base`. The doctests still hardcode `build/cythonized`, but I prefer to fix that in a different ticket. I think this branch here does enough good things (even if it's not perfect), so I'm setting it back to needs_review.



---

archive/issue_comments_316184.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment:21):\n> I see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.\n\nWell, in #21480 the variable `build_base` was still used, but some of Erik's later tickets seem to have removed all uses of it.",
    "created_at": "2017-09-02T21:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316184",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment:21):
> I see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.

Well, in #21480 the variable `build_base` was still used, but some of Erik's later tickets seem to have removed all uses of it.



---

archive/issue_comments_316185.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment:25):\n> Replying to [@jdemeyer](#comment:21):\n> > I see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.\n\n> \n> Well, in #21480 the variable `build_base` was still used, but some of Erik's later tickets seem to have removed all uses of it.\n\nI'm not actively concerned about any of my existing open tickets addressing issues in the setup.py.  I'd like to get back to that at some point but if any of those tickets still end up being useful I'll rework them.",
    "created_at": "2017-09-05T09:19:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316185",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment:25):
> Replying to [@jdemeyer](#comment:21):
> > I see. The variable `build_base` was really added by mistake in #21480 when removing support for `--build-base`.

> 
> Well, in #21480 the variable `build_base` was still used, but some of Erik's later tickets seem to have removed all uses of it.

I'm not actively concerned about any of my existing open tickets addressing issues in the setup.py.  I'd like to get back to that at some point but if any of those tickets still end up being useful I'll rework them.



---

archive/issue_comments_316186.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nHi Erik, there's no problem; to the contrary, as a result of these changes that are already merged, `--build-base` already works.",
    "created_at": "2017-09-05T20:48:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316186",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Hi Erik, there's no problem; to the contrary, as a result of these changes that are already merged, `--build-base` already works.



---

archive/issue_comments_316187.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIndeed. What this ticket does is also use the `build_base` directory for the `cythonized` files.",
    "created_at": "2017-09-06T08:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316187",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Indeed. What this ticket does is also use the `build_base` directory for the `cythonized` files.



---

archive/issue_comments_316188.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2017-09-06T22:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316188",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_302498.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-06T22:24:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302498"
}
```



---

archive/issue_events_302499.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-09-06T22:24:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302499"
}
```



---

archive/issue_comments_316189.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/no_SAGE_CYTHONIZED](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/no_SAGE_CYTHONIZED)** to **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**",
    "created_at": "2017-09-10T22:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21535#issuecomment-316189",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/no_SAGE_CYTHONIZED](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/no_SAGE_CYTHONIZED)** to **[`bd91b43`](https://github.com/sagemath/sagetrac-mirror/commit/bd91b438f6992c21ee4da35a850c81f28563d2e9)**



---

archive/issue_events_302500.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T22:05:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302500"
}
```



---

archive/issue_events_302501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c7b2d40f60c22c5a2bb7dabb233d415b5ff55885",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-10T22:05:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21535",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21535#event-302501"
}
```
