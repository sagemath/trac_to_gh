# Issue 21172: Docbuilding without TESTS: blocks fails

archive/issues_020935.json:
```json
{
    "body": "```\n./sage --docbuild --no-tests all html\n```\n\ngives\n\n```\n[libs     ] docstring of sage.libs.pari.pari_instance:162: WARNING: Definition list ends without a blank line; unexpected unindent.\nError building the documentation.\n```\n\n\nKeywords: --no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS\n\nReviewer: Jori M\u00e4ntysalo\n\nAuthor: John Palmieri\n\nBranch: f4c3edb33f5aaaae88d5484602d32b712e5f2879\n\nCommit: f4c3edb33f5aaaae88d5484602d32b712e5f2879\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21172\n\n",
    "closed_at": "2017-02-11T10:24:03Z",
    "created_at": "2016-08-05T05:51:33Z",
    "labels": [
        "component: documentation",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Docbuilding without TESTS: blocks fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21172",
    "user": "https://github.com/jm58660"
}
```
```
./sage --docbuild --no-tests all html
```

gives

```
[libs     ] docstring of sage.libs.pari.pari_instance:162: WARNING: Definition list ends without a blank line; unexpected unindent.
Error building the documentation.
```


Keywords: --no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS

Reviewer: Jori MÃ¤ntysalo

Author: John Palmieri

Branch: f4c3edb33f5aaaae88d5484602d32b712e5f2879

Commit: f4c3edb33f5aaaae88d5484602d32b712e5f2879

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21172





---

archive/issue_comments_289174.json:
```json
{
    "body": "Changing keywords from \"\" to \"--no-tests\".",
    "created_at": "2016-08-05T06:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289174",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "--no-tests".



---

archive/issue_events_056486.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-05T06:35:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56486"
}
```



---

archive/issue_comments_289175.json:
```json
{
    "body": "<a id='comment:2'></a>I thought that docbuilding without `TESTS` was the default? But apparently not...",
    "created_at": "2016-08-05T07:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289175",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I thought that docbuilding without `TESTS` was the default? But apparently not...



---

archive/issue_comments_289176.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 jdemeyer]:\n> I thought that docbuilding without `TESTS` was the default? But apparently not...\n\n\nI would like it to be default for most users. But then for developers it might be easier if it is not.\n\nAnyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.",
    "created_at": "2016-08-05T11:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289176",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>Replying to [comment:2 jdemeyer]:
> I thought that docbuilding without `TESTS` was the default? But apparently not...


I would like it to be default for most users. But then for developers it might be easier if it is not.

Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.



---

archive/issue_comments_289177.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 jmantysalo]:\n> Replying to [comment:2 jdemeyer]:\n> > I thought that docbuilding without `TESTS` was the default? But apparently not...\n\n> \n> I would like it to be default for most users. But then for developers it might be easier if it is not.\n\n\nYes.  It would be good anyway for different purposes to have something like a \"Sage developer mode\" which is not enabled by default (or in stable releases, say).\n\n\\\\\n\n> Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.\n\n\nIs it something that should go into the Sage Developer Guide (in order to avoid it in the future)?",
    "created_at": "2016-08-05T14:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289177",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Replying to [comment:3 jmantysalo]:
> Replying to [comment:2 jdemeyer]:
> > I thought that docbuilding without `TESTS` was the default? But apparently not...

> 
> I would like it to be default for most users. But then for developers it might be easier if it is not.


Yes.  It would be good anyway for different purposes to have something like a "Sage developer mode" which is not enabled by default (or in stable releases, say).

\\

> Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.


Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?



---

archive/issue_comments_289178.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 leif]:\n\n> Yes.  It would be good anyway for different purposes to have something like a \"Sage developer mode\" which is not enabled by default (or in stable releases, say).\n\n\nHmm... yes and no. Would be good, but OTOH dangerous as something might work in developer mode only. Actually this one is just a case of that! I compiled docs for several betas of 7.3 in a desktop, but for final version I installed it with `--no-tests` to our server.\n\n> > Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.\n\n> \n> Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?\n\n\nSome patchbot should compile with the flag and another without flag.\n\nI doubt how many developer or reviewer would compile documentation twise just to be sure.",
    "created_at": "2016-08-05T14:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289178",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>Replying to [comment:4 leif]:

> Yes.  It would be good anyway for different purposes to have something like a "Sage developer mode" which is not enabled by default (or in stable releases, say).


Hmm... yes and no. Would be good, but OTOH dangerous as something might work in developer mode only. Actually this one is just a case of that! I compiled docs for several betas of 7.3 in a desktop, but for final version I installed it with `--no-tests` to our server.

> > Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.

> 
> Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?


Some patchbot should compile with the flag and another without flag.

I doubt how many developer or reviewer would compile documentation twise just to be sure.



---

archive/issue_comments_289179.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 jmantysalo]:\n> I would like it to be default for most users. But then for developers it might be easier if it is not.\n\n\nAnd how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.\n\nI don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n\nEven the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.\n\n(I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).",
    "created_at": "2016-08-05T15:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289179",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:3 jmantysalo]:
> I would like it to be default for most users. But then for developers it might be easier if it is not.


And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.

I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.

Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.

(I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).



---

archive/issue_comments_289180.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:3 jmantysalo]:\n> Anyways, it seems that fix for this problem is removing two empty lines.\n\n\nIf you know the fix, can you put it on this ticket?",
    "created_at": "2016-08-05T15:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289180",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:3 jmantysalo]:
> Anyways, it seems that fix for this problem is removing two empty lines.


If you know the fix, can you put it on this ticket?



---

archive/issue_comments_289181.json:
```json
{
    "body": "<a id='comment:8'></a>I think this problem occurs because lines like the following (from Sage output in doctests around line 162 in `sage.libs.pari.pari_instance`)\n\n```\n    IFAC: cracking composite\n```\nmatch the regular expression which is supposed to signify the end of a `TESTS` block: a word all in caps followed by a colon (to match things like \"ALGORITHM:\" or \"REFERENCES:\" which we want to include in the documentation). As I think someone said, probably on the original ticket for skipping `TESTS` blocks, rather than regular expression matching, we should have a more sophisticated parser.",
    "created_at": "2016-08-05T15:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289181",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>I think this problem occurs because lines like the following (from Sage output in doctests around line 162 in `sage.libs.pari.pari_instance`)

```
    IFAC: cracking composite
```
match the regular expression which is supposed to signify the end of a `TESTS` block: a word all in caps followed by a colon (to match things like "ALGORITHM:" or "REFERENCES:" which we want to include in the documentation). As I think someone said, probably on the original ticket for skipping `TESTS` blocks, rather than regular expression matching, we should have a more sophisticated parser.



---

archive/issue_comments_289182.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 jdemeyer]:\n> Replying to [comment:3 jmantysalo]:\n> > I would like it to be default for most users. But then for developers it might be easier if it is not.\n\n> \n> And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.\n> \n> I don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n> \n> Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.\n> \n> (I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).\n\n\nI fully agree (and by the way think this belongs to this ticket).\n\nAdd `--include-test-blocks` for docbuilding and make `--no-tests` the default, probably completely removing that option.\n\nIMHO `TESTS:` should never end up in PDFs for example; it *might* be convenient for some to review code / docstrings using HTML output, but those could explicitly ask for including them when building their docs.  (Just wondering whether that's a \"global\" option that eventually triggers complete rebuild when changed.)\n\nThe problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.  But that's just my uneducated impression I got over the last years, and I cannot give any recent examples, right now at least.",
    "created_at": "2016-08-05T15:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289182",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>Replying to [comment:6 jdemeyer]:
> Replying to [comment:3 jmantysalo]:
> > I would like it to be default for most users. But then for developers it might be easier if it is not.

> 
> And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.
> 
> I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.
> 
> Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.
> 
> (I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).


I fully agree (and by the way think this belongs to this ticket).

Add `--include-test-blocks` for docbuilding and make `--no-tests` the default, probably completely removing that option.

IMHO `TESTS:` should never end up in PDFs for example; it *might* be convenient for some to review code / docstrings using HTML output, but those could explicitly ask for including them when building their docs.  (Just wondering whether that's a "global" option that eventually triggers complete rebuild when changed.)

The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.  But that's just my uneducated impression I got over the last years, and I cannot give any recent examples, right now at least.



---

archive/issue_comments_289183.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:6 jdemeyer]:\n\n> I don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n\n\nI think that it was discussed when add the switch. But I don't remember what was the reason to not make it default.",
    "created_at": "2016-08-05T16:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289183",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:10'></a>Replying to [comment:6 jdemeyer]:

> I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.


I think that it was discussed when add the switch. But I don't remember what was the reason to not make it default.



---

archive/issue_comments_289184.json:
```json
{
    "body": "<a id='comment:11'></a>For the record:\n\nThe online (terminal) help for `sage.libs.pari.pari_instance` gives the following:\n\n```\n...\nElliptic curves and precision: If you are working with elliptic\ncurves, you should set the precision for each method:\n\n   sage: e = pari([0,0,0,-82,0]).ellinit()\n   sage: eta1 = e.elleta(precision=100)[0]\n   sage: eta1.sage()\n   3.6054636014326520859158205642077267748\n   sage: eta1 = e.elleta(precision=180)[0]\n   sage: eta1.sage()\n   3.60546360143265208591582056420772677481026899659802474544\n\nNumber fields and precision: TODO\n\n   IFAC: cracking composite\n      49191317529892137643\n\n   IFAC: factor 6713103182899\n      is prime\n\n   IFAC: factor 7327657\n      is prime\n\n   IFAC: prime 7327657\n      appears with exponent = 1\n\n   IFAC: prime 6713103182899\n      appears with exponent = 1\n\n   IFAC: found 2 large prime (power) factors. [3, 1; 7327657, 1;\n   6713103182899, 1] sage: pari.default(\"debug\", 0) sage:\n   pari(2^67+1).factor() [3, 1; 7327657, 1; 6713103182899, 1]\n\nClass docstring:\nmodule(name[, doc])\n\nCreate a module object. The name must be a string; the optional doc\nargument can have any type.\nInit docstring:  x.__init__(...) initializes x; see help(type(x)) for signature\n(END) \n```\n\nNote that everything below `TODO` (only up to `Class docstring:` of course) belongs to the `TESTS:` block. :-)",
    "created_at": "2016-08-05T16:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289184",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>For the record:

The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:

```
...
Elliptic curves and precision: If you are working with elliptic
curves, you should set the precision for each method:

   sage: e = pari([0,0,0,-82,0]).ellinit()
   sage: eta1 = e.elleta(precision=100)[0]
   sage: eta1.sage()
   3.6054636014326520859158205642077267748
   sage: eta1 = e.elleta(precision=180)[0]
   sage: eta1.sage()
   3.60546360143265208591582056420772677481026899659802474544

Number fields and precision: TODO

   IFAC: cracking composite
      49191317529892137643

   IFAC: factor 6713103182899
      is prime

   IFAC: factor 7327657
      is prime

   IFAC: prime 7327657
      appears with exponent = 1

   IFAC: prime 6713103182899
      appears with exponent = 1

   IFAC: found 2 large prime (power) factors. [3, 1; 7327657, 1;
   6713103182899, 1] sage: pari.default("debug", 0) sage:
   pari(2^67+1).factor() [3, 1; 7327657, 1; 6713103182899, 1]

Class docstring:
module(name[, doc])

Create a module object. The name must be a string; the optional doc
argument can have any type.
Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature
(END) 
```

Note that everything below `TODO` (only up to `Class docstring:` of course) belongs to the `TESTS:` block. :-)



---

archive/issue_comments_289185.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 leif]:\n\n> The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.\n\n\nI agree. Most common problem is to not have a `TESTS` block at all. I have changed those in my Grand Poset Documentaion Polishing Project. :=)\n\nI guess this is partly because `--no-tests` is new and not the default. It makes much less sense to differentiate between examples and tests when both are shown to the user.",
    "created_at": "2016-08-05T16:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289185",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>Replying to [comment:9 leif]:

> The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.


I agree. Most common problem is to not have a `TESTS` block at all. I have changed those in my Grand Poset Documentaion Polishing Project. :=)

I guess this is partly because `--no-tests` is new and not the default. It makes much less sense to differentiate between examples and tests when both are shown to the user.



---

archive/issue_comments_289186.json:
```json
{
    "body": "<a id='comment:13'></a>Well, I do not know whether this was introduced at the same time, but the online help (`foo?`) meanwhile suppresses the `TESTS:` section *by default*, or at least tries to, as you can see above. ;-)",
    "created_at": "2016-08-05T16:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289186",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>Well, I do not know whether this was introduced at the same time, but the online help (`foo?`) meanwhile suppresses the `TESTS:` section *by default*, or at least tries to, as you can see above. ;-)



---

archive/issue_comments_289187.json:
```json
{
    "body": "<a id='comment:14'></a>Couldn't resist:\n\n```diff\ndiff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst\nindex 799b546..fa4a42e 100644\n--- a/src/doc/en/installation/source.rst\n+++ b/src/doc/en/installation/source.rst\n@@ -999,7 +999,7 @@ Here are some of the more commonly used variables affecting the build process:\n   you run ``make``, ``make doc``, or ``make doc-pdf``.\n   For example, you can add ``--no-plot`` to this variable to avoid building\n   the graphics coming from the ``.. PLOT`` directive within the documentation,\n-  or you can add ``--no-tests`` to omit all \"TESTS\" blocks in the\n+  or you can add ``--include-tests-blocks`` to include all \"TESTS\" blocks in the\n   reference manual. Run ``sage --docbuild help`` to see the full list\n   of options.\n \ndiff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py\nindex 1fc5ccb..e7363e7 100644\n--- a/src/sage_setup/docbuild/__init__.py\n+++ b/src/sage_setup/docbuild/__init__.py\n@@ -1445,9 +1445,9 @@ def setup_parser():\n     standard.add_option(\"--no-plot\", dest=\"no_plot\",\n                         action=\"store_true\",\n                         help=\"do not include graphics auto-generated using the '.. plot' markup\")\n-    standard.add_option(\"--no-tests\", dest=\"skip_tests\", default=False,\n-                        action=\"store_true\",\n-                        help=\"do not include TESTS blocks in the reference manual\")\n+    standard.add_option(\"--include-tests-blocks\", dest=\"skip_tests\", default=True,\n+                        action=\"store_false\",\n+                        help=\"include TESTS blocks in the reference manual\")\n     standard.add_option(\"--no-pdf-links\", dest=\"no_pdf_links\",\n                         action=\"store_true\",\n                         help=\"do not include PDF links in DOCUMENT 'website'; FORMATs: html, json, pickle, web\")\n```",
    "created_at": "2016-08-05T17:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289187",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Couldn't resist:

```diff
diff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst
index 799b546..fa4a42e 100644
--- a/src/doc/en/installation/source.rst
+++ b/src/doc/en/installation/source.rst
@@ -999,7 +999,7 @@ Here are some of the more commonly used variables affecting the build process:
   you run ``make``, ``make doc``, or ``make doc-pdf``.
   For example, you can add ``--no-plot`` to this variable to avoid building
   the graphics coming from the ``.. PLOT`` directive within the documentation,
-  or you can add ``--no-tests`` to omit all "TESTS" blocks in the
+  or you can add ``--include-tests-blocks`` to include all "TESTS" blocks in the
   reference manual. Run ``sage --docbuild help`` to see the full list
   of options.
 
diff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py
index 1fc5ccb..e7363e7 100644
--- a/src/sage_setup/docbuild/__init__.py
+++ b/src/sage_setup/docbuild/__init__.py
@@ -1445,9 +1445,9 @@ def setup_parser():
     standard.add_option("--no-plot", dest="no_plot",
                         action="store_true",
                         help="do not include graphics auto-generated using the '.. plot' markup")
-    standard.add_option("--no-tests", dest="skip_tests", default=False,
-                        action="store_true",
-                        help="do not include TESTS blocks in the reference manual")
+    standard.add_option("--include-tests-blocks", dest="skip_tests", default=True,
+                        action="store_false",
+                        help="include TESTS blocks in the reference manual")
     standard.add_option("--no-pdf-links", dest="no_pdf_links",
                         action="store_true",
                         help="do not include PDF links in DOCUMENT 'website'; FORMATs: html, json, pickle, web")
```



---

archive/issue_comments_289188.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:11 leif]:\n> For the record:\n> \n> The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:\n\n\n[snip]\n\nYes, and this is why I made [comment:8 comment above] (plus looking at the documentation and source code in `misc/sagedoc.py`).\n\nThe original ticket #19503 was precisely about skipping `TESTS` blocks in introspection; the focus was not on the reference manual, and that's one reason the default is the way it is. Plus there was some discussion of the concern Leif expressed above, that some `TESTS` blocks have useful information, so if we remove them from the reference manual, we lose helpful information.",
    "created_at": "2016-08-05T17:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289188",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>Replying to [comment:11 leif]:
> For the record:
> 
> The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:


[snip]

Yes, and this is why I made [comment:8 comment above] (plus looking at the documentation and source code in `misc/sagedoc.py`).

The original ticket #19503 was precisely about skipping `TESTS` blocks in introspection; the focus was not on the reference manual, and that's one reason the default is the way it is. Plus there was some discussion of the concern Leif expressed above, that some `TESTS` blocks have useful information, so if we remove them from the reference manual, we lose helpful information.



---

archive/issue_comments_289189.json:
```json
{
    "body": "<a id='comment:16'></a>So here's the culprit (`src/sage/misc/sagedoc.py`, line 298 ff.):\n\n```python\n    # end_of_block: match a line starting with whitespace, then Sphinx\n    # directives of the form \".. foo:\". This will match directive\n    # names \"foo\" containing letters of either case, hyphens,\n    # underscores.\n    # Also match uppercase text followed by a colon, like\n    # \"REFERENCES:\" or \"ALGORITHM:\".\n    end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n    # header: match a string of hyphens, or other characters which are\n    # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n```\n\nCurrently, only another `TEST`[`S`]`:`[`:`] doesn't terminate the block to skip:\n\n```python\n...\n        if not skip:\n            m = tests_block.match(l)\n            if m:\n                skip = True\n                indentation = m.group(1)\n            else:\n                s += \"\\n\"\n                s += l\n        else:\n            if end_of_block.match(l) and not tests_block.match(l):\n                skip = False\n                s += \"\\n\"\n                s += l\n...\n```\n\nSo we'd either have to whitelist PARI's `IFAC:` to not end a `TESTS` block, or (more seriously) have to explicitly look for *all* possible / \"valid\" section names (like `AUTHORS`, `REFERENCES`, etc.).\n\nNot sure whether there is at all a complete list of such.  (AFAIK, it's just informal convention to use this or that.)",
    "created_at": "2016-08-05T17:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289189",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>So here's the culprit (`src/sage/misc/sagedoc.py`, line 298 ff.):

```python
    # end_of_block: match a line starting with whitespace, then Sphinx
    # directives of the form ".. foo:". This will match directive
    # names "foo" containing letters of either case, hyphens,
    # underscores.
    # Also match uppercase text followed by a colon, like
    # "REFERENCES:" or "ALGORITHM:".
    end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
    # header: match a string of hyphens, or other characters which are
    # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
```

Currently, only another `TEST`[`S`]`:`[`:`] doesn't terminate the block to skip:

```python
...
        if not skip:
            m = tests_block.match(l)
            if m:
                skip = True
                indentation = m.group(1)
            else:
                s += "\n"
                s += l
        else:
            if end_of_block.match(l) and not tests_block.match(l):
                skip = False
                s += "\n"
                s += l
...
```

So we'd either have to whitelist PARI's `IFAC:` to not end a `TESTS` block, or (more seriously) have to explicitly look for *all* possible / "valid" section names (like `AUTHORS`, `REFERENCES`, etc.).

Not sure whether there is at all a complete list of such.  (AFAIK, it's just informal convention to use this or that.)



---

archive/issue_comments_289190.json:
```json
{
    "body": "<a id='comment:17'></a>Or check the indentation level: to terminate the block, a string like `AUTHORS:` should be indented no more than the original `TESTS:`, whereas `IFAC` (and anything in the output of a Sage test) is indented more.",
    "created_at": "2016-08-05T18:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289190",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>Or check the indentation level: to terminate the block, a string like `AUTHORS:` should be indented no more than the original `TESTS:`, whereas `IFAC` (and anything in the output of a Sage test) is indented more.



---

archive/issue_comments_289191.json:
```json
{
    "body": "<a id='comment:18'></a>Maybe something like\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 968a44c..77d6984 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):\n                 s += l\n         else:\n             if end_of_block.match(l) and not tests_block.match(l):\n+                if l.find(indentation) == 0:\n+                    continue\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n```",
    "created_at": "2016-08-05T18:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289191",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>Maybe something like

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 968a44c..77d6984 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):
                 s += l
         else:
             if end_of_block.match(l) and not tests_block.match(l):
+                if l.find(indentation) == 0:
+                    continue
                 skip = False
                 s += "\n"
                 s += l
```



---

archive/issue_comments_289192.json:
```json
{
    "body": "<a id='comment:19'></a>I've tried another way:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex a6c5568..dc5eb13 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -302,6 +302,13 @@ def skip_TESTS_block(docstring):\n     # Also match uppercase text followed by a colon, like\n     # \"REFERENCES:\" or \"ALGORITHM:\".\n     end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n+    # Only recognize commonly used section names, not e.g. output\n+    # from doctests incidentally matching '[A-Z]+:':\n+    SECTION_NAMES = set([\n+        \"AUTHOR\", \"AUTHORS\",\n+        \"ALGORITH\", \"ALGORITHMS\",\n+        \"REFERENCE\", \"REFERENCES\"\n+    ])\n     # header: match a string of hyphens, or other characters which are\n     # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n     header = re.compile(r'^[ ]*([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n@@ -320,7 +327,9 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            m = end_of_block.match(l)\n+            if m and not tests_block.match(l) \\\n+                 and m.group(1) in SECTION_NAMES:\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n```\n\nWorks for me modulo adding more section names.",
    "created_at": "2016-08-05T18:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289192",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>I've tried another way:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index a6c5568..dc5eb13 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -302,6 +302,13 @@ def skip_TESTS_block(docstring):
     # Also match uppercase text followed by a colon, like
     # "REFERENCES:" or "ALGORITHM:".
     end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
+    # Only recognize commonly used section names, not e.g. output
+    # from doctests incidentally matching '[A-Z]+:':
+    SECTION_NAMES = set([
+        "AUTHOR", "AUTHORS",
+        "ALGORITH", "ALGORITHMS",
+        "REFERENCE", "REFERENCES"
+    ])
     # header: match a string of hyphens, or other characters which are
     # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
     header = re.compile(r'^[ ]*([-=`:\'"~_^*+#><])\1+[ ]*$')
@@ -320,7 +327,9 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            m = end_of_block.match(l)
+            if m and not tests_block.match(l) \
+                 and m.group(1) in SECTION_NAMES:
                 skip = False
                 s += "\n"
                 s += l
```

Works for me modulo adding more section names.



---

archive/issue_comments_289193.json:
```json
{
    "body": "<a id='comment:20'></a>... and modulo spelling of course. ;-)",
    "created_at": "2016-08-05T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289193",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>... and modulo spelling of course. ;-)



---

archive/issue_comments_289194.json:
```json
{
    "body": "<a id='comment:21'></a>Speling is an issue, though ;) The likelihood of someone misspelling \"ALGORITM\", for example, seems pretty high, and it's only going to make a difference when they do it right after a TESTS block. Troubleshooting that will be difficult. Isn't indentation safer than whitelisting?",
    "created_at": "2016-08-05T19:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289194",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>Speling is an issue, though ;) The likelihood of someone misspelling "ALGORITM", for example, seems pretty high, and it's only going to make a difference when they do it right after a TESTS block. Troubleshooting that will be difficult. Isn't indentation safer than whitelisting?



---

archive/issue_comments_289195.json:
```json
{
    "body": "<a id='comment:22'></a>With your proposal, we at least need to add \"EXAMPLE\" and \"EXAMPLES\", by the way.",
    "created_at": "2016-08-05T19:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289195",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>With your proposal, we at least need to add "EXAMPLE" and "EXAMPLES", by the way.



---

archive/issue_comments_289196.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:18 jhpalmieri]:\n> Maybe something like\n> \n> ```\n> #!diff\n> diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\n> index 968a44c..77d6984 100644\n> --- a/src/sage/misc/sagedoc.py\n> +++ b/src/sage/misc/sagedoc.py\n> @@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):\n>                  s += l\n>          else:\n>              if end_of_block.match(l) and not tests_block.match(l):\n> +                if l.find(indentation) == 0:\n> +                    continue\n>                  skip = False\n>                  s += \"\\n\"\n>                  s += l\n> ```\n\n\nI was about to write that `l.find(indentation)` is *generally wrong* (and should be `l.startswith(indentation)`), but then suddenly realized that `.find()` is not C's `strstr()` and even works for the empty string... m)\n\nI'm not entirely sure yet your approach works though.  Deeeeeep thinking required...\n\nBut anyway, I'll (ab)use my approach to find all kinds of section names (and misspellings) later...\n\n(We could eventually also correct then.)",
    "created_at": "2016-08-05T19:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289196",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>Replying to [comment:18 jhpalmieri]:
> Maybe something like
> 
> ```
> #!diff
> diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
> index 968a44c..77d6984 100644
> --- a/src/sage/misc/sagedoc.py
> +++ b/src/sage/misc/sagedoc.py
> @@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):
>                  s += l
>          else:
>              if end_of_block.match(l) and not tests_block.match(l):
> +                if l.find(indentation) == 0:
> +                    continue
>                  skip = False
>                  s += "\n"
>                  s += l
> ```


I was about to write that `l.find(indentation)` is *generally wrong* (and should be `l.startswith(indentation)`), but then suddenly realized that `.find()` is not C's `strstr()` and even works for the empty string... m)

I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...

But anyway, I'll (ab)use my approach to find all kinds of section names (and misspellings) later...

(We could eventually also correct then.)



---

archive/issue_comments_289197.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 jhpalmieri]:\n> With your proposal, we at least need to add \"EXAMPLE\" and \"EXAMPLES\", by the way.\n\n\nYes and no.  Shouldn't<sup>TM</sup> `EXAMPLES` always precede `TESTS`?",
    "created_at": "2016-08-05T19:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289197",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>Replying to [comment:22 jhpalmieri]:
> With your proposal, we at least need to add "EXAMPLE" and "EXAMPLES", by the way.


Yes and no.  Shouldn't<sup>TM</sup> `EXAMPLES` always precede `TESTS`?



---

archive/issue_comments_289198.json:
```json
{
    "body": "<a id='comment:25'></a>FWIW, `l.startswith(indentation)` also works for the empty string and will be faster (not sure how much in practice though).",
    "created_at": "2016-08-05T19:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289198",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>FWIW, `l.startswith(indentation)` also works for the empty string and will be faster (not sure how much in practice though).



---

archive/issue_comments_289199.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:23 leif]:\n> I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...\n\n\nIt won't work for e.g.\n\n```\nTESTS:\n\n    ...\n\nFOO:\n    bar\n```\nwill it?\n\n(`FOO:` matches end_block and has the same indentation as `TESTS:` and doesn't match tests_block either, so you'd continue skipping.)",
    "created_at": "2016-08-05T19:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289199",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>Replying to [comment:23 leif]:
> I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...


It won't work for e.g.

```
TESTS:

    ...

FOO:
    bar
```
will it?

(`FOO:` matches end_block and has the same indentation as `TESTS:` and doesn't match tests_block either, so you'd continue skipping.)



---

archive/issue_comments_289200.json:
```json
{
    "body": "<a id='comment:27'></a>So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like `EXXAMPLES::`.",
    "created_at": "2016-08-05T19:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289200",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:27'></a>So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like `EXXAMPLES::`.



---

archive/issue_comments_289201.json:
```json
{
    "body": "<a id='comment:28'></a>So here's my preliminary word (section name) list:\n\n```\nABS:\nACKNOWLEDGEMENT:\nACKNOWLEDGEMENTS:\nACKNOWLEDGMENT:\nADD:\nALGORITHM:\nALGORITHMS:\nALIAS:\nALIASES:\nAPPLICATIONS:\nARTEFACT:\nASSUMPTION:\nASSUMPTIONS:\nAUTHOR:\nAUTHORS:\nB:\nBENCHMARK:\nBUGS:\nCACHING:\nCHECKME:\nCODE:\nCOERCIONS:\nCOMMENTS:\nCOMPARISONS:\nCOMPLEXITY:\nCONDITIONS:\nCONSTRUCTION:\nCRUCIAL:\nDEBUG:\nDEFINITION:\nDETAILS:\nDISCUSSION:\nDIV:\nDUP:\nEFFECT:\nEOS:\nEQ:\nERROR:\nEXAMPLE:\nEXAMPLES:\nEXMAPLES:\nF:\nFACTS:\nFIXME:\nFLOAT:\nFORMALLY:\nFORMATS:\nFUNCTIONS:\nG:\nGAME:\nGE:\nGRIN:\nGT:\nH:\nHISTORY:\nIFAC:\nIML:\nIMPLEMENTATION:\nIMPORTANT:\nIN:\nINFO:\nINPUT:\nINPUTS:\nINT:\nINVERT:\nISBN:\nISGCI:\nJ:\nJOKE:\nKEYWORDS:\nKIND:\nLE:\nLICENSE:\nLIMITATIONS:\nLOCALS:\nLOG:\nLT:\nM:\nMAPLE:\nMATHEMATICA:\nMATRIX:\nMETHOD:\nMH:\nMODULE:\nMODULUS:\nMUL:\nMUTABILITY:\nNAME:\nNB:\nNE:\nNEG:\nNOTATION:\nNOTE:\nNOTES:\nOPTIONAL:\nOPTIONS:\nOR:\nOUPUT:\nOUT:\nOUTPUT:\nOUTPUTS:\nOUTUT:\nP:\nPARALLELE:\nPARI:\nPATH:\nPERFORMANCE:\nPLOTTING:\nPOP:\nPOW:\nPRECONDITIONS:\nPREMIER:\nPRINTING:\nPROBLEM:\nPROFILE:\nPROOF:\nR:\nRAISES:\nRATIONALE:\nREFERENCE:\nREFERENCES:\nREFERENCS:\nREFRENCES:\nREMARK:\nREMARKS:\nREQUIRED:\nREQUIRES:\nRESTRICTIONS:\nRETURN:\nRI:\nRINGS:\nSAGE:\nSEE:\nSEEALSO:\nSERIE:\nSUB:\nT:\nTEST:\nTESTS:\nTHEOREM:\nTHEORY:\nTIMINGS:\nTODO:\nTUTORIAL:\nU:\nUNKN:\nUSAGE:\nUSE:\nV:\nVALUES:\nVERSION:\nW:\nWARNING:\nX:\nY:\n```\n\nAnd no, there's not a single instance of misspelled ALLGORERHYTHM, but other interesting EXMAPLES [sic]. :-)",
    "created_at": "2016-08-05T20:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289201",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>So here's my preliminary word (section name) list:

```
ABS:
ACKNOWLEDGEMENT:
ACKNOWLEDGEMENTS:
ACKNOWLEDGMENT:
ADD:
ALGORITHM:
ALGORITHMS:
ALIAS:
ALIASES:
APPLICATIONS:
ARTEFACT:
ASSUMPTION:
ASSUMPTIONS:
AUTHOR:
AUTHORS:
B:
BENCHMARK:
BUGS:
CACHING:
CHECKME:
CODE:
COERCIONS:
COMMENTS:
COMPARISONS:
COMPLEXITY:
CONDITIONS:
CONSTRUCTION:
CRUCIAL:
DEBUG:
DEFINITION:
DETAILS:
DISCUSSION:
DIV:
DUP:
EFFECT:
EOS:
EQ:
ERROR:
EXAMPLE:
EXAMPLES:
EXMAPLES:
F:
FACTS:
FIXME:
FLOAT:
FORMALLY:
FORMATS:
FUNCTIONS:
G:
GAME:
GE:
GRIN:
GT:
H:
HISTORY:
IFAC:
IML:
IMPLEMENTATION:
IMPORTANT:
IN:
INFO:
INPUT:
INPUTS:
INT:
INVERT:
ISBN:
ISGCI:
J:
JOKE:
KEYWORDS:
KIND:
LE:
LICENSE:
LIMITATIONS:
LOCALS:
LOG:
LT:
M:
MAPLE:
MATHEMATICA:
MATRIX:
METHOD:
MH:
MODULE:
MODULUS:
MUL:
MUTABILITY:
NAME:
NB:
NE:
NEG:
NOTATION:
NOTE:
NOTES:
OPTIONAL:
OPTIONS:
OR:
OUPUT:
OUT:
OUTPUT:
OUTPUTS:
OUTUT:
P:
PARALLELE:
PARI:
PATH:
PERFORMANCE:
PLOTTING:
POP:
POW:
PRECONDITIONS:
PREMIER:
PRINTING:
PROBLEM:
PROFILE:
PROOF:
R:
RAISES:
RATIONALE:
REFERENCE:
REFERENCES:
REFERENCS:
REFRENCES:
REMARK:
REMARKS:
REQUIRED:
REQUIRES:
RESTRICTIONS:
RETURN:
RI:
RINGS:
SAGE:
SEE:
SEEALSO:
SERIE:
SUB:
T:
TEST:
TESTS:
THEOREM:
THEORY:
TIMINGS:
TODO:
TUTORIAL:
U:
UNKN:
USAGE:
USE:
V:
VALUES:
VERSION:
W:
WARNING:
X:
Y:
```

And no, there's not a single instance of misspelled ALLGORERHYTHM, but other interesting EXMAPLES [sic]. :-)



---

archive/issue_comments_289202.json:
```json
{
    "body": "<a id='comment:29'></a>P.S.:  Yet produced with `grep` and `sed`, so there are of course still false positives (including PARI's `IFAC:`).",
    "created_at": "2016-08-05T20:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289202",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>P.S.:  Yet produced with `grep` and `sed`, so there are of course still false positives (including PARI's `IFAC:`).



---

archive/issue_comments_289203.json:
```json
{
    "body": "<a id='comment:30'></a>John, is \"acknowledgment\" really (the more) common spelling in the U.S.?",
    "created_at": "2016-08-05T20:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289203",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>John, is "acknowledgment" really (the more) common spelling in the U.S.?



---

archive/issue_comments_289204.json:
```json
{
    "body": "<a id='comment:31'></a>Still exmaples after #19601? Arghs.",
    "created_at": "2016-08-05T20:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289204",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:31'></a>Still exmaples after #19601? Arghs.



---

archive/issue_comments_289205.json:
```json
{
    "body": "<a id='comment:32'></a>For my approach, I think I need to do\n\n```\nif l.startswith(indentation + ' '): ...\n```\nto make sure the match is indented more than \"TESTS\" was. I haven't tested it much (only on the example from pari_instance).\n\n> John, is \"acknowledgment\" really (the more) common spelling in the U.S.? \n\n\nYes.\n\n> So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. \n\n\nI think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.",
    "created_at": "2016-08-05T20:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289205",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>For my approach, I think I need to do

```
if l.startswith(indentation + ' '): ...
```
to make sure the match is indented more than "TESTS" was. I haven't tested it much (only on the example from pari_instance).

> John, is "acknowledgment" really (the more) common spelling in the U.S.? 


Yes.

> So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. 


I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.



---

archive/issue_comments_289206.json:
```json
{
    "body": "<a id='comment:33'></a>And I think doctesting just looks for lines of the form\n\n```\nsage: INPUT\nOUTPUT\n```\nand tests them: indentation seems to be ignored, \"EXAMPLES\" is unnecessary, etc.",
    "created_at": "2016-08-05T20:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289206",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>And I think doctesting just looks for lines of the form

```
sage: INPUT
OUTPUT
```
and tests them: indentation seems to be ignored, "EXAMPLES" is unnecessary, etc.



---

archive/issue_comments_289207.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:32 jhpalmieri]:\n> > So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. \n\n> \n> I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.\n\n\nWe could write Sphinx directives `.. EXAMPLES` and `.. TESTS`. Since unindenting ends a Sphinx block, this would mean we couldn't do the following (AFAIK):\n\n```\n.. EXAMPLES::\n\n    sage: blah\n    blah\n\nOh, and also\n\n    sage: blah\n    blah\n```\nas a single EXAMPLES block.",
    "created_at": "2016-08-05T20:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289207",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>Replying to [comment:32 jhpalmieri]:
> > So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. 

> 
> I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.


We could write Sphinx directives `.. EXAMPLES` and `.. TESTS`. Since unindenting ends a Sphinx block, this would mean we couldn't do the following (AFAIK):

```
.. EXAMPLES::

    sage: blah
    blah

Oh, and also

    sage: blah
    blah
```
as a single EXAMPLES block.



---

archive/issue_comments_289208.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:31 jmantysalo]:\n> Still exmaples after #19601? Arghs.\n\n\n```\nsrc/sage/graphs/genus.pyx:692:    REFERENCS::\nsrc/sage/modular/btquotients/btquotient.py:417:        OUPUT:\nsrc/sage/modular/btquotients/btquotient.py:730:        OUPUT:\nsrc/sage/modular/pollack_stevens/dist.pyx:1879:#     OUPUT:\nsrc/sage/parallel/map_reduce.py:1903:        OUPUT: ``(z, )``\nsrc/sage/combinat/composition_tableau.py:578:    OUTUT:\nsrc/sage/combinat/sf/dual.py:266:        OUPUT\nsrc/sage/combinat/enumeration_mod_permgroup.pyx:97:    OUPUT:\nsrc/sage/combinat/matrices/dancing_links.pyx:342:        OUPUT:\nsrc/sage/combinat/matrices/dancing_links.pyx:386:        OUPUT:\nsrc/sage/combinat/words/finite_word.py:2006:        OUPUT\nsrc/sage/combinat/words/word_datatypes.pyx:258:        OUPUT:\nsrc/sage/combinat/words/word_datatypes.pyx:600:        OUPUT:\nsrc/sage/combinat/words/word_datatypes.pyx:1107:        OUPUT:\nsrc/sage/libs/linkages/padics/fmpz_poly_unram.pxi:70:    OUPUT:\nsrc/sage/libs/linkages/padics/API.pxi:113:    OUPUT:\nsrc/sage/libs/linkages/padics/mpz.pxi:70:    OUPUT:\nsrc/sage/libs/ppl.pyx:3636:        OUPUT:\nsrc/sage/libs/ppl.pyx:3904:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:359:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:454:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:497:        OUPUT:\nsrc/sage/schemes/curves/affine_curve.py:441:        OUPUT: Boolean.\nsrc/sage/schemes/curves/projective_curve.py:77:        EXMAPLES::\nsrc/sage/schemes/curves/projective_curve.py:748:        OUPUT: Boolean.\nsrc/sage/manifolds/scalarfield.py:1490:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1770:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1821:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1873:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1923:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1981:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:2068:        OUPUT:\n```\n\nDon't know where \"REFRENCES\" originated from...",
    "created_at": "2016-08-05T20:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289208",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>Replying to [comment:31 jmantysalo]:
> Still exmaples after #19601? Arghs.


```
src/sage/graphs/genus.pyx:692:    REFERENCS::
src/sage/modular/btquotients/btquotient.py:417:        OUPUT:
src/sage/modular/btquotients/btquotient.py:730:        OUPUT:
src/sage/modular/pollack_stevens/dist.pyx:1879:#     OUPUT:
src/sage/parallel/map_reduce.py:1903:        OUPUT: ``(z, )``
src/sage/combinat/composition_tableau.py:578:    OUTUT:
src/sage/combinat/sf/dual.py:266:        OUPUT
src/sage/combinat/enumeration_mod_permgroup.pyx:97:    OUPUT:
src/sage/combinat/matrices/dancing_links.pyx:342:        OUPUT:
src/sage/combinat/matrices/dancing_links.pyx:386:        OUPUT:
src/sage/combinat/words/finite_word.py:2006:        OUPUT
src/sage/combinat/words/word_datatypes.pyx:258:        OUPUT:
src/sage/combinat/words/word_datatypes.pyx:600:        OUPUT:
src/sage/combinat/words/word_datatypes.pyx:1107:        OUPUT:
src/sage/libs/linkages/padics/fmpz_poly_unram.pxi:70:    OUPUT:
src/sage/libs/linkages/padics/API.pxi:113:    OUPUT:
src/sage/libs/linkages/padics/mpz.pxi:70:    OUPUT:
src/sage/libs/ppl.pyx:3636:        OUPUT:
src/sage/libs/ppl.pyx:3904:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:359:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:454:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:497:        OUPUT:
src/sage/schemes/curves/affine_curve.py:441:        OUPUT: Boolean.
src/sage/schemes/curves/projective_curve.py:77:        EXMAPLES::
src/sage/schemes/curves/projective_curve.py:748:        OUPUT: Boolean.
src/sage/manifolds/scalarfield.py:1490:        OUPUT:
src/sage/manifolds/scalarfield.py:1770:        OUPUT:
src/sage/manifolds/scalarfield.py:1821:        OUPUT:
src/sage/manifolds/scalarfield.py:1873:        OUPUT:
src/sage/manifolds/scalarfield.py:1923:        OUPUT:
src/sage/manifolds/scalarfield.py:1981:        OUPUT:
src/sage/manifolds/scalarfield.py:2068:        OUPUT:
```

Don't know where "REFRENCES" originated from...



---

archive/issue_comments_289209.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 leif]:\n> Don't know where \"REFRENCES\" originated from...\n\n\n```\nsrc/sage/combinat/ribbon_tableau.py:197:    REFRENCES:\nsrc/sage/combinat/sf/jack.py:991:        REFRENCES:\n```",
    "created_at": "2016-08-05T21:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289209",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:36'></a>Replying to [comment:35 leif]:
> Don't know where "REFRENCES" originated from...


```
src/sage/combinat/ribbon_tableau.py:197:    REFRENCES:
src/sage/combinat/sf/jack.py:991:        REFRENCES:
```



---

archive/issue_comments_289210.json:
```json
{
    "body": "<a id='comment:37'></a>I've put the typos above on #21178.",
    "created_at": "2016-08-05T21:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289210",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>I've put the typos above on #21178.



---

archive/issue_comments_289211.json:
```json
{
    "body": "<a id='comment:39'></a>Here is a branch which uses the indentation solution (plus hiding TESTS blocks by default in the reference manual). Feel free to post one with the version using whitelisting of section names.\n\n---\nNew commits:",
    "created_at": "2016-08-06T00:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289211",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>Here is a branch which uses the indentation solution (plus hiding TESTS blocks by default in the reference manual). Feel free to post one with the version using whitelisting of section names.

---
New commits:



---

archive/issue_comments_289212.json:
```json
{
    "body": "<a id='comment:40'></a>Looks like positive review (modulo related things that could be done on a follow-up as well).\n\nBut I'm still performing further tests... (i.e., I'm actually reviewing what gets removed, which is quite a bit of work)",
    "created_at": "2016-08-07T06:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289212",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>Looks like positive review (modulo related things that could be done on a follow-up as well).

But I'm still performing further tests... (i.e., I'm actually reviewing what gets removed, which is quite a bit of work)



---

archive/issue_comments_289213.json:
```json
{
    "body": "<a id='comment:41'></a>Nope, needs work.\n\nThere's an `else` missing to handle the case that a `TESTS` block is just terminated by an \"ordinary\" line (not matching the patterns), which of course has to be less indented than the starting `TESTS:`[`:`] (otherwise it wouldn't terminate the block).\n\nSee for example `src/sage/rings/asymptotic/asymptotic_expansion_generators.py`, where incidentally (because of the `::`) \"only two\" (non-empty) lines after the `TESTS` block get eaten up:\n\n```python\nr\"\"\"\nCommon Asymptotic Expansions\n\n.. WARNING::\n\n    As this code is experimental, a warning is thrown when an\n    asymptotic ring (or an associated structure) is created for the\n    first time in a session (see\n    :class:`sage.misc.superseded.experimental`).\n\n    TESTS::\n\n        sage: AsymptoticRing(growth_group='z^ZZ * log(z)^QQ', coefficient_ring=ZZ)\n        doctest:...: FutureWarning: This class/method/function is marked as\n        experimental. It, its functionality or its interface might change\n        without a formal deprecation.\n        See http://trac.sagemath.org/17601 for details.\n        Asymptotic Ring <z^ZZ * log(z)^QQ> over Integer Ring\n\n\nAsymptotic expansions in SageMath can be built through the\n``asymptotic_expansions`` object. It contains generators for common\nasymptotic expressions. For example,\n::\n\n    sage: asymptotic_expansions.Stirling('n', precision=5)\n    sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(1/2) +\n    1/12*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-1/2) +\n    1/288*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-3/2) +\n    O(e^(n*log(n))*(e^n)^(-1)*n^(-5/2))\n\ngenerates the first 5 summands of Stirling's approximation formula for\nfactorials.\n\n...\n\"\"\"\n```\n\n(IMHO you shouldn't need `previous` anyway, except for adding a blank line, in which case you don't have to keep the actual contents, only maybe the indentation / number of spaces, but I'm not even sure that's necessary.)\n\n---\n\nEDIT: Removed *[... has to be less] **(or equally)** [indented than ...]* again I added afterwards, because that's wrong.",
    "created_at": "2016-08-07T09:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289213",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'></a>Nope, needs work.

There's an `else` missing to handle the case that a `TESTS` block is just terminated by an "ordinary" line (not matching the patterns), which of course has to be less indented than the starting `TESTS:`[`:`] (otherwise it wouldn't terminate the block).

See for example `src/sage/rings/asymptotic/asymptotic_expansion_generators.py`, where incidentally (because of the `::`) "only two" (non-empty) lines after the `TESTS` block get eaten up:

```python
r"""
Common Asymptotic Expansions

.. WARNING::

    As this code is experimental, a warning is thrown when an
    asymptotic ring (or an associated structure) is created for the
    first time in a session (see
    :class:`sage.misc.superseded.experimental`).

    TESTS::

        sage: AsymptoticRing(growth_group='z^ZZ * log(z)^QQ', coefficient_ring=ZZ)
        doctest:...: FutureWarning: This class/method/function is marked as
        experimental. It, its functionality or its interface might change
        without a formal deprecation.
        See http://trac.sagemath.org/17601 for details.
        Asymptotic Ring <z^ZZ * log(z)^QQ> over Integer Ring


Asymptotic expansions in SageMath can be built through the
``asymptotic_expansions`` object. It contains generators for common
asymptotic expressions. For example,
::

    sage: asymptotic_expansions.Stirling('n', precision=5)
    sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(1/2) +
    1/12*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-1/2) +
    1/288*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-3/2) +
    O(e^(n*log(n))*(e^n)^(-1)*n^(-5/2))

generates the first 5 summands of Stirling's approximation formula for
factorials.

...
"""
```

(IMHO you shouldn't need `previous` anyway, except for adding a blank line, in which case you don't have to keep the actual contents, only maybe the indentation / number of spaces, but I'm not even sure that's necessary.)

---

EDIT: Removed *[... has to be less] **(or equally)** [indented than ...]* again I added afterwards, because that's wrong.



---

archive/issue_comments_289214.json:
```json
{
    "body": "<a id='comment:42'></a>P.S.:  John, just in case you don't have the time (or mood) to further work on this now, I could take over and present something in the next days.",
    "created_at": "2016-08-07T10:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289214",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:42'></a>P.S.:  John, just in case you don't have the time (or mood) to further work on this now, I could take over and present something in the next days.



---

archive/issue_comments_289215.json:
```json
{
    "body": "Changing keywords from \"--no-tests\" to \"--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS\".",
    "created_at": "2016-08-07T10:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289215",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "--no-tests" to "--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS".



---

archive/issue_comments_289216.json:
```json
{
    "body": "<a id='comment:44'></a>A few comments: you need `previous` in the `header` case, since the previous line is the actual title of that header. Were you thinking of getting rid of it in general?\n\nGood catch on the example in `asymptotic_expansion_generators.py`, but I think that's pretty rare. What may also occur, unfortunately, is something like\n\n```\n    TESTS::\n\n        blah\n\n    We should also test x::\n\n        blah # should be considered part of the TESTS block\n\n    Now the tests are over, so let's make some remarks.\n    (This should not be part of the TESTS block.)\n```\nI don't know how to catch this. Maybe TESTS should be a Sphinx directive after all (but not on this ticket).\n\nIf you have time to work on your proposed changes, please go ahead.",
    "created_at": "2016-08-07T15:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289216",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>A few comments: you need `previous` in the `header` case, since the previous line is the actual title of that header. Were you thinking of getting rid of it in general?

Good catch on the example in `asymptotic_expansion_generators.py`, but I think that's pretty rare. What may also occur, unfortunately, is something like

```
    TESTS::

        blah

    We should also test x::

        blah # should be considered part of the TESTS block

    Now the tests are over, so let's make some remarks.
    (This should not be part of the TESTS block.)
```
I don't know how to catch this. Maybe TESTS should be a Sphinx directive after all (but not on this ticket).

If you have time to work on your proposed changes, please go ahead.



---

archive/issue_comments_289217.json:
```json
{
    "body": "<a id='comment:45'></a>I am now testing the following change (on top of the current commit):\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..0139a3e 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if not l.startswith(indentation):\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n```",
    "created_at": "2016-08-08T04:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289217",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>I am now testing the following change (on top of the current commit):

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..0139a3e 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if not l.startswith(indentation):
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
```



---

archive/issue_comments_289218.json:
```json
{
    "body": "<a id='comment:46'></a>No, that doesn't work. Hold on.",
    "created_at": "2016-08-08T04:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289218",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'></a>No, that doesn't work. Hold on.



---

archive/issue_comments_289219.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 jhpalmieri]:\n> No, that doesn't work. Hold on.\n\n\n... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + \" \"` won't ever hold either. ;-)",
    "created_at": "2016-08-08T05:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289219",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:47'></a>Replying to [comment:46 jhpalmieri]:
> No, that doesn't work. Hold on.


... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + " "` won't ever hold either. ;-)



---

archive/issue_comments_289220.json:
```json
{
    "body": "<a id='comment:48'></a>It *may* make sense to generally differentiate between TESTS blocks starting at top-level (`indentation==\"\"`) and TESTS blocks that started with arbitrary (non-zero) indentation, i.e., to introduce a new explicit state.\n\n(Perhaps also for headings.  AFAIK these *have to* start at column 0, haven't they?)",
    "created_at": "2016-08-08T05:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289220",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:48'></a>It *may* make sense to generally differentiate between TESTS blocks starting at top-level (`indentation==""`) and TESTS blocks that started with arbitrary (non-zero) indentation, i.e., to introduce a new explicit state.

(Perhaps also for headings.  AFAIK these *have to* start at column 0, haven't they?)



---

archive/issue_comments_289221.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:47 leif]:\n> Replying to [comment:46 jhpalmieri]:\n> > No, that doesn't work.\n\n> \n> ... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + \" \"` won't ever hold either. ;-)\n\n\nSeemed...  Don't strike that not. ;-)",
    "created_at": "2016-08-08T05:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289221",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>Replying to [comment:47 leif]:
> Replying to [comment:46 jhpalmieri]:
> > No, that doesn't work.

> 
> ... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + " "` won't ever hold either. ;-)


Seemed...  Don't strike that not. ;-)



---

archive/issue_comments_289222.json:
```json
{
    "body": "<a id='comment:50'></a>Maybe this one instead:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..8f54c43 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if l and not l.isspace() and not l.startswith(indentation):\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n```",
    "created_at": "2016-08-08T05:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289222",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:50'></a>Maybe this one instead:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..8f54c43 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if l and not l.isspace() and not l.startswith(indentation):
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
```



---

archive/issue_comments_289223.json:
```json
{
    "body": "<a id='comment:51'></a>So get rid of the leading space for the regexp for `header`, and don't bother in that case checking if the line starts with `indentation`?\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..6b7778b 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -306,7 +306,7 @@ def skip_TESTS_block(docstring):\n     end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n     # header: match a string of hyphens, or other characters which are\n     # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n-    header = re.compile(r'^[ ]*([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n+    header = re.compile(r'^([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n     s = ''\n     skip = False\n     previous = ''\n@@ -322,15 +322,20 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if l and not l.isspace() and not l.startswith(indentation):\n+                # A non-blank line indented less than 'TESTS:'\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n+                # A line matching end_of_block and indented the same as 'TESTS:'\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n             elif header.match(l):\n-                if l.startswith(indentation):\n-                    continue\n+                # A line matching header.\n                 skip = False\n                 if previous:\n                     s += \"\\n\"\n```",
    "created_at": "2016-08-08T05:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289223",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:51'></a>So get rid of the leading space for the regexp for `header`, and don't bother in that case checking if the line starts with `indentation`?

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..6b7778b 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -306,7 +306,7 @@ def skip_TESTS_block(docstring):
     end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
     # header: match a string of hyphens, or other characters which are
     # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
-    header = re.compile(r'^[ ]*([-=`:\'"~_^*+#><])\1+[ ]*$')
+    header = re.compile(r'^([-=`:\'"~_^*+#><])\1+[ ]*$')
     s = ''
     skip = False
     previous = ''
@@ -322,15 +322,20 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if l and not l.isspace() and not l.startswith(indentation):
+                # A non-blank line indented less than 'TESTS:'
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
+                # A line matching end_of_block and indented the same as 'TESTS:'
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
                 s += "\n"
                 s += l
             elif header.match(l):
-                if l.startswith(indentation):
-                    continue
+                # A line matching header.
                 skip = False
                 if previous:
                     s += "\n"
```



---

archive/issue_comments_289224.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:44 jhpalmieri]:\n> What may also occur, unfortunately, is something like\n> \n> ```\n>     TESTS::\n> \n>         blah\n> \n>     We should also test x::\n> \n>         blah # should be considered part of the TESTS block\n> \n>     Now the tests are over, so let's make some remarks.\n>     (This should not be part of the TESTS block.)\n> ```\n> I don't know how to catch this.\n\n\nI don't think we can, other than by detailing the documentation with a warning regarding exactly that case, and perhaps adding a tool to easily show what will get removed (without [looking at] HTML output; also since what `foo?` shows isn't always that readable).\n\n\\\\\n\n> Maybe TESTS should be a Sphinx directive after all (but not on this ticket).\n\n\nWell, you already mentioned the drawback; then we'd have to split almost any existing TESTS block into several.",
    "created_at": "2016-08-08T05:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289224",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>Replying to [comment:44 jhpalmieri]:
> What may also occur, unfortunately, is something like
> 
> ```
>     TESTS::
> 
>         blah
> 
>     We should also test x::
> 
>         blah # should be considered part of the TESTS block
> 
>     Now the tests are over, so let's make some remarks.
>     (This should not be part of the TESTS block.)
> ```
> I don't know how to catch this.


I don't think we can, other than by detailing the documentation with a warning regarding exactly that case, and perhaps adding a tool to easily show what will get removed (without [looking at] HTML output; also since what `foo?` shows isn't always that readable).

\\

> Maybe TESTS should be a Sphinx directive after all (but not on this ticket).


Well, you already mentioned the drawback; then we'd have to split almost any existing TESTS block into several.



---

archive/issue_comments_289225.json:
```json
{
    "body": "<a id='comment:53'></a>I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.",
    "created_at": "2016-08-08T09:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289225",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'></a>I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.



---

archive/issue_comments_289226.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-08T14:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289227.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-08T15:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289227",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289228.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-08T15:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289228",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289229.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:53 jdemeyer]:\n> I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.\n\n\nThat's the approach I'm currently working on.",
    "created_at": "2016-08-08T15:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289229",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:56'></a>Replying to [comment:53 jdemeyer]:
> I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.


That's the approach I'm currently working on.



---

archive/issue_comments_289230.json:
```json
{
    "body": "<a id='comment:57'></a>Just pinging. I tested this, and it works. But I can not really say that I understand this -- or any Sphinx-related -- code. Someone to review?\n\nI raised priority to major, as I think this to be quite important. Reading documentation is hard if half of the text must be skipped.",
    "created_at": "2016-09-20T11:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289230",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:57'></a>Just pinging. I tested this, and it works. But I can not really say that I understand this -- or any Sphinx-related -- code. Someone to review?

I raised priority to major, as I think this to be quite important. Reading documentation is hard if half of the text must be skipped.



---

archive/issue_events_056487.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56487"
}
```



---

archive/issue_events_056488.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56488"
}
```



---

archive/issue_comments_289231.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-18T13:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289231",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289232.json:
```json
{
    "body": "<a id='comment:58'></a>Needs rebasing.\n\nAnd really needs someone to review this.",
    "created_at": "2016-11-18T13:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289232",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:58'></a>Needs rebasing.

And really needs someone to review this.



---

archive/issue_comments_289233.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T17:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289234.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-18T17:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289234",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289235.json:
```json
{
    "body": "<a id='comment:61'></a>failing doctest (see patchbot).",
    "created_at": "2017-01-07T06:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289235",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:61'></a>failing doctest (see patchbot).



---

archive/issue_comments_289236.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-07T06:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289236",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289237.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-08T06:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289238.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-08T06:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289238",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289239.json:
```json
{
    "body": "<a id='comment:64'></a>Fixed.",
    "created_at": "2017-01-08T06:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289239",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:64'></a>Fixed.



---

archive/issue_comments_289240.json:
```json
{
    "body": "<a id='comment:65'></a>Why this?\n\n```diff\n@@ -278,8 +279,8 @@ def skip_TESTS_block(docstring):\n         sage: skip_TESTS_block(start + test + refs + test2 + directive).rstrip() == (start + refs + directive).rstrip()\n         True\n \n-        sage: header = 'Header:\\n~~~~~~~~'\n-        sage: fake_header = 'Header:\\n-=-=-=-=-='\n+        sage: header = ' Header:\\n ~~~~~~~~'\n+        sage: fake_header = ' Header:\\n -=-=-=-=-='\n         sage: skip_TESTS_block(start + test + header) == start + header\n         True\n         sage: skip_TESTS_block(start + test + fake_header).rstrip() == start.rstrip()\n```\nI think this doctest should work as it was before.",
    "created_at": "2017-01-09T10:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289240",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>Why this?

```diff
@@ -278,8 +279,8 @@ def skip_TESTS_block(docstring):
         sage: skip_TESTS_block(start + test + refs + test2 + directive).rstrip() == (start + refs + directive).rstrip()
         True
 
-        sage: header = 'Header:\n~~~~~~~~'
-        sage: fake_header = 'Header:\n-=-=-=-=-='
+        sage: header = ' Header:\n ~~~~~~~~'
+        sage: fake_header = ' Header:\n -=-=-=-=-='
         sage: skip_TESTS_block(start + test + header) == start + header
         True
         sage: skip_TESTS_block(start + test + fake_header).rstrip() == start.rstrip()
```
I think this doctest should work as it was before.



---

archive/issue_comments_289241.json:
```json
{
    "body": "<a id='comment:66'></a>The old test was not actually testing the \"header\" part of the code, since it was unindented compared to \" TESTS:\". Also, both `header` and `fake_header` were unindented, so both ended the TESTS block. So I added leading spaces.",
    "created_at": "2017-01-09T16:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289241",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:66'></a>The old test was not actually testing the "header" part of the code, since it was unindented compared to " TESTS:". Also, both `header` and `fake_header` were unindented, so both ended the TESTS block. So I added leading spaces.



---

archive/issue_comments_289242.json:
```json
{
    "body": "<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-01T00:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289243.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-01T00:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289243",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289244.json:
```json
{
    "body": "<a id='comment:68'></a>The doctests are organized better now (in my opinion). The PDF docs are not building right now, so \"needs work\". I'll try to figure out what's going on.",
    "created_at": "2017-02-01T00:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289244",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:68'></a>The doctests are organized better now (in my opinion). The PDF docs are not building right now, so "needs work". I'll try to figure out what's going on.



---

archive/issue_comments_289245.json:
```json
{
    "body": "<a id='comment:69'></a>It's working now. Maybe I forgot to do `make doc-clean` earlier.",
    "created_at": "2017-02-01T02:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289245",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:69'></a>It's working now. Maybe I forgot to do `make doc-clean` earlier.



---

archive/issue_comments_289246.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-01T02:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289246",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289247.json:
```json
{
    "body": "<a id='comment:70'></a>The branch seems to be red again.",
    "created_at": "2017-02-07T10:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289247",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:70'></a>The branch seems to be red again.



---

archive/issue_events_056489.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T10:16:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56489"
}
```



---

archive/issue_events_056490.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T10:16:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56490"
}
```



---

archive/issue_comments_289248.json:
```json
{
    "body": "<a id='comment:71'></a>I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).",
    "created_at": "2017-02-07T16:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289248",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:71'></a>I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).



---

archive/issue_comments_289249.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-07T20:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289249",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289250.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:71 jhpalmieri]:\n> I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).\n\n\nI guess I must do it. I know about nothing about Sphinx, and actually don't even want to know, but...",
    "created_at": "2017-02-07T20:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289250",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:72'></a>Replying to [comment:71 jhpalmieri]:
> I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).


I guess I must do it. I know about nothing about Sphinx, and actually don't even want to know, but...



---

archive/issue_comments_289251.json:
```json
{
    "body": "<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-02-09T02:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_289252.json:
```json
{
    "body": "<a id='comment:74'></a>Rebased to 7.6.beta3.\n\nTo help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.\n\nOh, it does change one thing with Sphinx: it changes the default from including TESTS blocks to omitting them.",
    "created_at": "2017-02-09T02:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289252",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:74'></a>Rebased to 7.6.beta3.

To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.

Oh, it does change one thing with Sphinx: it changes the default from including TESTS blocks to omitting them.



---

archive/issue_comments_289253.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-09T02:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289253",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289254.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-09T07:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289254",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289255.json:
```json
{
    "body": "<a id='comment:76'></a>Replying to [comment:74 jhpalmieri]:\n\n> To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.\n\n\nThanks for the explanation. This was the first time I look at Python implementation of regexps, but it seems to be clear. I mark this as a positive review.\n\n(Sidenote: We should have something better! I mean a structured way so that Sphinx (or whatever we would use) would know the blocks and one could say something like `--docskip=tests,algorithm` or like.)",
    "created_at": "2017-02-09T07:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289255",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:76'></a>Replying to [comment:74 jhpalmieri]:

> To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.


Thanks for the explanation. This was the first time I look at Python implementation of regexps, but it seems to be clear. I mark this as a positive review.

(Sidenote: We should have something better! I mean a structured way so that Sphinx (or whatever we would use) would know the blocks and one could say something like `--docskip=tests,algorithm` or like.)



---

archive/issue_events_056491.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-11T10:24:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21172#event-56491"
}
```



---

archive/issue_comments_289256.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-11T10:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21172#issuecomment-289256",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
