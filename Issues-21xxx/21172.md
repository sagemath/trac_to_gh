# Issue 21172: Docbuilding without TESTS: blocks fails

archive/issues_020935.json:
```json
{
    "assignees": [],
    "body": "\n```\n./sage --docbuild --no-tests all html\n```\n\ngives\n\n```\n[libs     ] docstring of sage.libs.pari.pari_instance:162: WARNING: Definition list ends without a blank line; unexpected unindent.\nError building the documentation.\n```\n\n\nKeywords: **--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS**\n\nBranch/Commit: **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**\n\nReviewer: **Jori M\u00e4ntysalo**\n\nAuthor: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21172_\n\n",
    "closed_at": "2017-02-11T10:24:03Z",
    "created_at": "2016-08-05T05:51:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Docbuilding without TESTS: blocks fails",
    "type": "issue",
    "updated_at": "2017-02-11T10:24:03Z",
    "url": "https://github.com/sagemath/sage/issues/21172",
    "user": "https://github.com/jm58660"
}
```

```
./sage --docbuild --no-tests all html
```

gives

```
[libs     ] docstring of sage.libs.pari.pari_instance:162: WARNING: Definition list ends without a blank line; unexpected unindent.
Error building the documentation.
```


Keywords: **--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS**

Branch/Commit: **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**

Reviewer: **Jori MÃ¤ntysalo**

Author: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/21172_





---

archive/issue_events_279779.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-05T05:51:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279779"
}
```



---

archive/issue_events_279780.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-05T05:51:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279780"
}
```



---

archive/issue_events_279781.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-05T05:51:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279781"
}
```



---

archive/issue_events_279782.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-05T05:51:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279782"
}
```



---

archive/issue_comments_311259.json:
```json
{
    "body": "Changed keywords from **** to **--no-tests**",
    "created_at": "2016-08-05T06:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311259",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **** to **--no-tests**



---

archive/issue_events_279783.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-05T06:35:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279783"
}
```



---

archive/issue_events_279784.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-05T06:35:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279784"
}
```



---

archive/issue_events_279785.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-05T06:35:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "title_is": "Docbuilding without TESTS: blocks fails",
    "title_was": "Docbuilding withot tests-blocks fails",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279785"
}
```



---

archive/issue_comments_311260.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI thought that docbuilding without `TESTS` was the default? But apparently not...",
    "created_at": "2016-08-05T07:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311260",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

I thought that docbuilding without `TESTS` was the default? But apparently not...



---

archive/issue_comments_311261.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> I thought that docbuilding without `TESTS` was the default? But apparently not...\n\nI would like it to be default for most users. But then for developers it might be easier if it is not.\n\nAnyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.",
    "created_at": "2016-08-05T11:32:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311261",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:3" align="right">Comment 3</div>

Replying to [@jdemeyer](#comment%3A2):
> I thought that docbuilding without `TESTS` was the default? But apparently not...

I would like it to be default for most users. But then for developers it might be easier if it is not.

Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.



---

archive/issue_comments_311262.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@jm58660](#comment%3A3):\n> Replying to [@jdemeyer](#comment%3A2):\n> > I thought that docbuilding without `TESTS` was the default? But apparently not...\n\n> \n> I would like it to be default for most users. But then for developers it might be easier if it is not.\n\nYes.  It would be good anyway for different purposes to have something like a \"Sage developer mode\" which is not enabled by default (or in stable releases, say).\n\n\\\\\n\n> Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.\n\nIs it something that should go into the Sage Developer Guide (in order to avoid it in the future)?",
    "created_at": "2016-08-05T14:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311262",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@jm58660](#comment%3A3):
> Replying to [@jdemeyer](#comment%3A2):
> > I thought that docbuilding without `TESTS` was the default? But apparently not...

> 
> I would like it to be default for most users. But then for developers it might be easier if it is not.

Yes.  It would be good anyway for different purposes to have something like a "Sage developer mode" which is not enabled by default (or in stable releases, say).

\\

> Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.

Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?



---

archive/issue_comments_311263.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@nexttime](#comment%3A4):\n\n> Yes.  It would be good anyway for different purposes to have something like a \"Sage developer mode\" which is not enabled by default (or in stable releases, say).\n\nHmm... yes and no. Would be good, but OTOH dangerous as something might work in developer mode only. Actually this one is just a case of that! I compiled docs for several betas of 7.3 in a desktop, but for final version I installed it with `--no-tests` to our server.\n\n> > Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.\n\n> \n> Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?\n\nSome patchbot should compile with the flag and another without flag.\n\nI doubt how many developer or reviewer would compile documentation twise just to be sure.",
    "created_at": "2016-08-05T14:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311263",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@nexttime](#comment%3A4):

> Yes.  It would be good anyway for different purposes to have something like a "Sage developer mode" which is not enabled by default (or in stable releases, say).

Hmm... yes and no. Would be good, but OTOH dangerous as something might work in developer mode only. Actually this one is just a case of that! I compiled docs for several betas of 7.3 in a desktop, but for final version I installed it with `--no-tests` to our server.

> > Anyways, it seems that fix for this problem is removing two empty lines. Someone with more time should check what is the real problem.

> 
> Is it something that should go into the Sage Developer Guide (in order to avoid it in the future)?

Some patchbot should compile with the flag and another without flag.

I doubt how many developer or reviewer would compile documentation twise just to be sure.



---

archive/issue_comments_311264.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@jm58660](#comment%3A3):\n> I would like it to be default for most users. But then for developers it might be easier if it is not.\n\nAnd how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.\n\nI don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n\nEven the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.\n\n(I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).",
    "created_at": "2016-08-05T15:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311264",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@jm58660](#comment%3A3):
> I would like it to be default for most users. But then for developers it might be easier if it is not.

And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.

I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.

Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.

(I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).



---

archive/issue_comments_311265.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@jm58660](#comment%3A3):\n> Anyways, it seems that fix for this problem is removing two empty lines.\n\nIf you know the fix, can you put it on this ticket?",
    "created_at": "2016-08-05T15:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311265",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@jm58660](#comment%3A3):
> Anyways, it seems that fix for this problem is removing two empty lines.

If you know the fix, can you put it on this ticket?



---

archive/issue_comments_311266.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI think this problem occurs because lines like the following (from Sage output in doctests around line 162 in `sage.libs.pari.pari_instance`)\n\n```\n    IFAC: cracking composite\n```\nmatch the regular expression which is supposed to signify the end of a `TESTS` block: a word all in caps followed by a colon (to match things like \"ALGORITHM:\" or \"REFERENCES:\" which we want to include in the documentation). As I think someone said, probably on the original ticket for skipping `TESTS` blocks, rather than regular expression matching, we should have a more sophisticated parser.",
    "created_at": "2016-08-05T15:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311266",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">Comment 8</div>

I think this problem occurs because lines like the following (from Sage output in doctests around line 162 in `sage.libs.pari.pari_instance`)

```
    IFAC: cracking composite
```
match the regular expression which is supposed to signify the end of a `TESTS` block: a word all in caps followed by a colon (to match things like "ALGORITHM:" or "REFERENCES:" which we want to include in the documentation). As I think someone said, probably on the original ticket for skipping `TESTS` blocks, rather than regular expression matching, we should have a more sophisticated parser.



---

archive/issue_comments_311267.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> Replying to [@jm58660](#comment%3A3):\n> > I would like it to be default for most users. But then for developers it might be easier if it is not.\n\n> \n> And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.\n> \n> I don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n> \n> Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.\n> \n> (I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).\n\nI fully agree (and by the way think this belongs to this ticket).\n\nAdd `--include-test-blocks` for docbuilding and make `--no-tests` the default, probably completely removing that option.\n\nIMHO `TESTS:` should never end up in PDFs for example; it *might* be convenient for some to review code / docstrings using HTML output, but those could explicitly ask for including them when building their docs.  (Just wondering whether that's a \"global\" option that eventually triggers complete rebuild when changed.)\n\nThe problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.  But that's just my uneducated impression I got over the last years, and I cannot give any recent examples, right now at least.",
    "created_at": "2016-08-05T15:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311267",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@jdemeyer](#comment%3A6):
> Replying to [@jm58660](#comment%3A3):
> > I would like it to be default for most users. But then for developers it might be easier if it is not.

> 
> And how many developers actually compile their own documentation and view that? I guess not many. I do it rarely in case I'm working on a documentation ticket and want to see the output. And even if I do that, I don't care about the `TESTS` blocks. Those `TESTS` blocks are mostly useful when reading/writing the code.
> 
> I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.
> 
> Even the online documentation still has the `TESTS` blocks and that's the single place where they should not be shown.
> 
> (I know this is all orthogonal to this ticket, but I just don't understand why somebody would add an option to remove `TESTS` blocks but then not make it the default).

I fully agree (and by the way think this belongs to this ticket).

Add `--include-test-blocks` for docbuilding and make `--no-tests` the default, probably completely removing that option.

IMHO `TESTS:` should never end up in PDFs for example; it *might* be convenient for some to review code / docstrings using HTML output, but those could explicitly ask for including them when building their docs.  (Just wondering whether that's a "global" option that eventually triggers complete rebuild when changed.)

The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.  But that's just my uneducated impression I got over the last years, and I cannot give any recent examples, right now at least.



---

archive/issue_comments_311268.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n\n> I don't see the point of \"optionally\" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.\n\nI think that it was discussed when add the switch. But I don't remember what was the reason to not make it default.",
    "created_at": "2016-08-05T16:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311268",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@jdemeyer](#comment%3A6):

> I don't see the point of "optionally" removing `TESTS` blocks. That creates an interesting paradox: the people who know how to remove the `TESTS` blocks are precisely the people who would be most interesting in seeing the `TESTS` blocks.

I think that it was discussed when add the switch. But I don't remember what was the reason to not make it default.



---

archive/issue_comments_311269.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nFor the record:\n\nThe online (terminal) help for `sage.libs.pari.pari_instance` gives the following:\n\n```\n...\nElliptic curves and precision: If you are working with elliptic\ncurves, you should set the precision for each method:\n\n   sage: e = pari([0,0,0,-82,0]).ellinit()\n   sage: eta1 = e.elleta(precision=100)[0]\n   sage: eta1.sage()\n   3.6054636014326520859158205642077267748\n   sage: eta1 = e.elleta(precision=180)[0]\n   sage: eta1.sage()\n   3.60546360143265208591582056420772677481026899659802474544\n\nNumber fields and precision: TODO\n\n   IFAC: cracking composite\n      49191317529892137643\n\n   IFAC: factor 6713103182899\n      is prime\n\n   IFAC: factor 7327657\n      is prime\n\n   IFAC: prime 7327657\n      appears with exponent = 1\n\n   IFAC: prime 6713103182899\n      appears with exponent = 1\n\n   IFAC: found 2 large prime (power) factors. [3, 1; 7327657, 1;\n   6713103182899, 1] sage: pari.default(\"debug\", 0) sage:\n   pari(2^67+1).factor() [3, 1; 7327657, 1; 6713103182899, 1]\n\nClass docstring:\nmodule(name[, doc])\n\nCreate a module object. The name must be a string; the optional doc\nargument can have any type.\nInit docstring:  x.__init__(...) initializes x; see help(type(x)) for signature\n(END) \n```\n\nNote that everything below `TODO` (only up to `Class docstring:` of course) belongs to the `TESTS:` block. :-)",
    "created_at": "2016-08-05T16:25:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311269",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">Comment 11</div>

For the record:

The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:

```
...
Elliptic curves and precision: If you are working with elliptic
curves, you should set the precision for each method:

   sage: e = pari([0,0,0,-82,0]).ellinit()
   sage: eta1 = e.elleta(precision=100)[0]
   sage: eta1.sage()
   3.6054636014326520859158205642077267748
   sage: eta1 = e.elleta(precision=180)[0]
   sage: eta1.sage()
   3.60546360143265208591582056420772677481026899659802474544

Number fields and precision: TODO

   IFAC: cracking composite
      49191317529892137643

   IFAC: factor 6713103182899
      is prime

   IFAC: factor 7327657
      is prime

   IFAC: prime 7327657
      appears with exponent = 1

   IFAC: prime 6713103182899
      appears with exponent = 1

   IFAC: found 2 large prime (power) factors. [3, 1; 7327657, 1;
   6713103182899, 1] sage: pari.default("debug", 0) sage:
   pari(2^67+1).factor() [3, 1; 7327657, 1; 6713103182899, 1]

Class docstring:
module(name[, doc])

Create a module object. The name must be a string; the optional doc
argument can have any type.
Init docstring:  x.__init__(...) initializes x; see help(type(x)) for signature
(END) 
```

Note that everything below `TODO` (only up to `Class docstring:` of course) belongs to the `TESTS:` block. :-)



---

archive/issue_comments_311270.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@nexttime](#comment%3A9):\n\n> The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.\n\nI agree. Most common problem is to not have a `TESTS` block at all. I have changed those in my Grand Poset Documentaion Polishing Project. :=)\n\nI guess this is partly because `--no-tests` is new and not the default. It makes much less sense to differentiate between examples and tests when both are shown to the user.",
    "created_at": "2016-08-05T16:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311270",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@nexttime](#comment%3A9):

> The problem I see (OTOH) is that `EXAMPLES:` and `TESTS:` are often rather randomly used; many doctests that no user would ever be interested in are in `EXAMPLES:`, while some `TESTS:` sections on the other hand contain examples that would be valuable to users as well.

I agree. Most common problem is to not have a `TESTS` block at all. I have changed those in my Grand Poset Documentaion Polishing Project. :=)

I guess this is partly because `--no-tests` is new and not the default. It makes much less sense to differentiate between examples and tests when both are shown to the user.



---

archive/issue_comments_311271.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nWell, I do not know whether this was introduced at the same time, but the online help (`foo?`) meanwhile suppresses the `TESTS:` section *by default*, or at least tries to, as you can see above. ;-)",
    "created_at": "2016-08-05T16:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311271",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">Comment 13</div>

Well, I do not know whether this was introduced at the same time, but the online help (`foo?`) meanwhile suppresses the `TESTS:` section *by default*, or at least tries to, as you can see above. ;-)



---

archive/issue_comments_311272.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nCouldn't resist:\n\n```diff\ndiff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst\nindex 799b546..fa4a42e 100644\n--- a/src/doc/en/installation/source.rst\n+++ b/src/doc/en/installation/source.rst\n@@ -999,7 +999,7 @@ Here are some of the more commonly used variables affecting the build process:\n   you run ``make``, ``make doc``, or ``make doc-pdf``.\n   For example, you can add ``--no-plot`` to this variable to avoid building\n   the graphics coming from the ``.. PLOT`` directive within the documentation,\n-  or you can add ``--no-tests`` to omit all \"TESTS\" blocks in the\n+  or you can add ``--include-tests-blocks`` to include all \"TESTS\" blocks in the\n   reference manual. Run ``sage --docbuild help`` to see the full list\n   of options.\n \ndiff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py\nindex 1fc5ccb..e7363e7 100644\n--- a/src/sage_setup/docbuild/__init__.py\n+++ b/src/sage_setup/docbuild/__init__.py\n@@ -1445,9 +1445,9 @@ def setup_parser():\n     standard.add_option(\"--no-plot\", dest=\"no_plot\",\n                         action=\"store_true\",\n                         help=\"do not include graphics auto-generated using the '.. plot' markup\")\n-    standard.add_option(\"--no-tests\", dest=\"skip_tests\", default=False,\n-                        action=\"store_true\",\n-                        help=\"do not include TESTS blocks in the reference manual\")\n+    standard.add_option(\"--include-tests-blocks\", dest=\"skip_tests\", default=True,\n+                        action=\"store_false\",\n+                        help=\"include TESTS blocks in the reference manual\")\n     standard.add_option(\"--no-pdf-links\", dest=\"no_pdf_links\",\n                         action=\"store_true\",\n                         help=\"do not include PDF links in DOCUMENT 'website'; FORMATs: html, json, pickle, web\")\n```",
    "created_at": "2016-08-05T17:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311272",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">Comment 14</div>

Couldn't resist:

```diff
diff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst
index 799b546..fa4a42e 100644
--- a/src/doc/en/installation/source.rst
+++ b/src/doc/en/installation/source.rst
@@ -999,7 +999,7 @@ Here are some of the more commonly used variables affecting the build process:
   you run ``make``, ``make doc``, or ``make doc-pdf``.
   For example, you can add ``--no-plot`` to this variable to avoid building
   the graphics coming from the ``.. PLOT`` directive within the documentation,
-  or you can add ``--no-tests`` to omit all "TESTS" blocks in the
+  or you can add ``--include-tests-blocks`` to include all "TESTS" blocks in the
   reference manual. Run ``sage --docbuild help`` to see the full list
   of options.
 
diff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py
index 1fc5ccb..e7363e7 100644
--- a/src/sage_setup/docbuild/__init__.py
+++ b/src/sage_setup/docbuild/__init__.py
@@ -1445,9 +1445,9 @@ def setup_parser():
     standard.add_option("--no-plot", dest="no_plot",
                         action="store_true",
                         help="do not include graphics auto-generated using the '.. plot' markup")
-    standard.add_option("--no-tests", dest="skip_tests", default=False,
-                        action="store_true",
-                        help="do not include TESTS blocks in the reference manual")
+    standard.add_option("--include-tests-blocks", dest="skip_tests", default=True,
+                        action="store_false",
+                        help="include TESTS blocks in the reference manual")
     standard.add_option("--no-pdf-links", dest="no_pdf_links",
                         action="store_true",
                         help="do not include PDF links in DOCUMENT 'website'; FORMATs: html, json, pickle, web")
```



---

archive/issue_comments_311273.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@nexttime](#comment%3A11):\n> For the record:\n> \n> The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:\n\n[snip]\n\nYes, and this is why I made [comment above](#comment%3A8) (plus looking at the documentation and source code in `misc/sagedoc.py`).\n\nThe original ticket #19503 was precisely about skipping `TESTS` blocks in introspection; the focus was not on the reference manual, and that's one reason the default is the way it is. Plus there was some discussion of the concern Leif expressed above, that some `TESTS` blocks have useful information, so if we remove them from the reference manual, we lose helpful information.",
    "created_at": "2016-08-05T17:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311273",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@nexttime](#comment%3A11):
> For the record:
> 
> The online (terminal) help for `sage.libs.pari.pari_instance` gives the following:

[snip]

Yes, and this is why I made [comment above](#comment%3A8) (plus looking at the documentation and source code in `misc/sagedoc.py`).

The original ticket #19503 was precisely about skipping `TESTS` blocks in introspection; the focus was not on the reference manual, and that's one reason the default is the way it is. Plus there was some discussion of the concern Leif expressed above, that some `TESTS` blocks have useful information, so if we remove them from the reference manual, we lose helpful information.



---

archive/issue_comments_311274.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nSo here's the culprit (`src/sage/misc/sagedoc.py`, line 298 ff.):\n\n```python\n    # end_of_block: match a line starting with whitespace, then Sphinx\n    # directives of the form \".. foo:\". This will match directive\n    # names \"foo\" containing letters of either case, hyphens,\n    # underscores.\n    # Also match uppercase text followed by a colon, like\n    # \"REFERENCES:\" or \"ALGORITHM:\".\n    end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n    # header: match a string of hyphens, or other characters which are\n    # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n```\n\nCurrently, only another `TEST`[`S`]`:`[`:`] doesn't terminate the block to skip:\n\n```python\n...\n        if not skip:\n            m = tests_block.match(l)\n            if m:\n                skip = True\n                indentation = m.group(1)\n            else:\n                s += \"\\n\"\n                s += l\n        else:\n            if end_of_block.match(l) and not tests_block.match(l):\n                skip = False\n                s += \"\\n\"\n                s += l\n...\n```\n\nSo we'd either have to whitelist PARI's `IFAC:` to not end a `TESTS` block, or (more seriously) have to explicitly look for *all* possible / \"valid\" section names (like `AUTHORS`, `REFERENCES`, etc.).\n\nNot sure whether there is at all a complete list of such.  (AFAIK, it's just informal convention to use this or that.)",
    "created_at": "2016-08-05T17:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311274",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">Comment 16</div>

So here's the culprit (`src/sage/misc/sagedoc.py`, line 298 ff.):

```python
    # end_of_block: match a line starting with whitespace, then Sphinx
    # directives of the form ".. foo:". This will match directive
    # names "foo" containing letters of either case, hyphens,
    # underscores.
    # Also match uppercase text followed by a colon, like
    # "REFERENCES:" or "ALGORITHM:".
    end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
    # header: match a string of hyphens, or other characters which are
    # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
```

Currently, only another `TEST`[`S`]`:`[`:`] doesn't terminate the block to skip:

```python
...
        if not skip:
            m = tests_block.match(l)
            if m:
                skip = True
                indentation = m.group(1)
            else:
                s += "\n"
                s += l
        else:
            if end_of_block.match(l) and not tests_block.match(l):
                skip = False
                s += "\n"
                s += l
...
```

So we'd either have to whitelist PARI's `IFAC:` to not end a `TESTS` block, or (more seriously) have to explicitly look for *all* possible / "valid" section names (like `AUTHORS`, `REFERENCES`, etc.).

Not sure whether there is at all a complete list of such.  (AFAIK, it's just informal convention to use this or that.)



---

archive/issue_comments_311275.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nOr check the indentation level: to terminate the block, a string like `AUTHORS:` should be indented no more than the original `TESTS:`, whereas `IFAC` (and anything in the output of a Sage test) is indented more.",
    "created_at": "2016-08-05T18:12:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311275",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">Comment 17</div>

Or check the indentation level: to terminate the block, a string like `AUTHORS:` should be indented no more than the original `TESTS:`, whereas `IFAC` (and anything in the output of a Sage test) is indented more.



---

archive/issue_comments_311276.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nMaybe something like\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 968a44c..77d6984 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):\n                 s += l\n         else:\n             if end_of_block.match(l) and not tests_block.match(l):\n+                if l.find(indentation) == 0:\n+                    continue\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n```",
    "created_at": "2016-08-05T18:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311276",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">Comment 18</div>

Maybe something like

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 968a44c..77d6984 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):
                 s += l
         else:
             if end_of_block.match(l) and not tests_block.match(l):
+                if l.find(indentation) == 0:
+                    continue
                 skip = False
                 s += "\n"
                 s += l
```



---

archive/issue_comments_311277.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI've tried another way:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex a6c5568..dc5eb13 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -302,6 +302,13 @@ def skip_TESTS_block(docstring):\n     # Also match uppercase text followed by a colon, like\n     # \"REFERENCES:\" or \"ALGORITHM:\".\n     end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n+    # Only recognize commonly used section names, not e.g. output\n+    # from doctests incidentally matching '[A-Z]+:':\n+    SECTION_NAMES = set([\n+        \"AUTHOR\", \"AUTHORS\",\n+        \"ALGORITH\", \"ALGORITHMS\",\n+        \"REFERENCE\", \"REFERENCES\"\n+    ])\n     # header: match a string of hyphens, or other characters which are\n     # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n     header = re.compile(r'^[ ]*([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n@@ -320,7 +327,9 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            m = end_of_block.match(l)\n+            if m and not tests_block.match(l) \\\n+                 and m.group(1) in SECTION_NAMES:\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n```\n\nWorks for me modulo adding more section names.",
    "created_at": "2016-08-05T18:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311277",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">Comment 19</div>

I've tried another way:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index a6c5568..dc5eb13 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -302,6 +302,13 @@ def skip_TESTS_block(docstring):
     # Also match uppercase text followed by a colon, like
     # "REFERENCES:" or "ALGORITHM:".
     end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
+    # Only recognize commonly used section names, not e.g. output
+    # from doctests incidentally matching '[A-Z]+:':
+    SECTION_NAMES = set([
+        "AUTHOR", "AUTHORS",
+        "ALGORITH", "ALGORITHMS",
+        "REFERENCE", "REFERENCES"
+    ])
     # header: match a string of hyphens, or other characters which are
     # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
     header = re.compile(r'^[ ]*([-=`:\'"~_^*+#><])\1+[ ]*$')
@@ -320,7 +327,9 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            m = end_of_block.match(l)
+            if m and not tests_block.match(l) \
+                 and m.group(1) in SECTION_NAMES:
                 skip = False
                 s += "\n"
                 s += l
```

Works for me modulo adding more section names.



---

archive/issue_comments_311278.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\n... and modulo spelling of course. ;-)",
    "created_at": "2016-08-05T18:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311278",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">Comment 20</div>

... and modulo spelling of course. ;-)



---

archive/issue_comments_311279.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nSpeling is an issue, though ;) The likelihood of someone misspelling \"ALGORITM\", for example, seems pretty high, and it's only going to make a difference when they do it right after a TESTS block. Troubleshooting that will be difficult. Isn't indentation safer than whitelisting?",
    "created_at": "2016-08-05T19:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311279",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">Comment 21</div>

Speling is an issue, though ;) The likelihood of someone misspelling "ALGORITM", for example, seems pretty high, and it's only going to make a difference when they do it right after a TESTS block. Troubleshooting that will be difficult. Isn't indentation safer than whitelisting?



---

archive/issue_comments_311280.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nWith your proposal, we at least need to add \"EXAMPLE\" and \"EXAMPLES\", by the way.",
    "created_at": "2016-08-05T19:05:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311280",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">Comment 22</div>

With your proposal, we at least need to add "EXAMPLE" and "EXAMPLES", by the way.



---

archive/issue_comments_311281.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@jhpalmieri](#comment%3A18):\n> Maybe something like\n> \n> ```diff\n> diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\n> index 968a44c..77d6984 100644\n> --- a/src/sage/misc/sagedoc.py\n> +++ b/src/sage/misc/sagedoc.py\n> @@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):\n>                  s += l\n>          else:\n>              if end_of_block.match(l) and not tests_block.match(l):\n> +                if l.find(indentation) == 0:\n> +                    continue\n>                  skip = False\n>                  s += \"\\n\"\n>                  s += l\n> ```\n\nI was about to write that `l.find(indentation)` is *generally wrong* (and should be `l.startswith(indentation)`), but then suddenly realized that `.find()` is not C's `strstr()` and even works for the empty string... m)\n\nI'm not entirely sure yet your approach works though.  Deeeeeep thinking required...\n\nBut anyway, I'll (ab)use my approach to find all kinds of section names (and misspellings) later...\n\n(We could eventually also correct then.)",
    "created_at": "2016-08-05T19:10:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311281",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@jhpalmieri](#comment%3A18):
> Maybe something like
> 
> ```diff
> diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
> index 968a44c..77d6984 100644
> --- a/src/sage/misc/sagedoc.py
> +++ b/src/sage/misc/sagedoc.py
> @@ -322,6 +322,8 @@ def skip_TESTS_block(docstring):
>                  s += l
>          else:
>              if end_of_block.match(l) and not tests_block.match(l):
> +                if l.find(indentation) == 0:
> +                    continue
>                  skip = False
>                  s += "\n"
>                  s += l
> ```

I was about to write that `l.find(indentation)` is *generally wrong* (and should be `l.startswith(indentation)`), but then suddenly realized that `.find()` is not C's `strstr()` and even works for the empty string... m)

I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...

But anyway, I'll (ab)use my approach to find all kinds of section names (and misspellings) later...

(We could eventually also correct then.)



---

archive/issue_comments_311282.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@jhpalmieri](#comment%3A22):\n> With your proposal, we at least need to add \"EXAMPLE\" and \"EXAMPLES\", by the way.\n\nYes and no.  Shouldn't<sup>TM</sup> `EXAMPLES` always precede `TESTS`?",
    "created_at": "2016-08-05T19:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311282",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@jhpalmieri](#comment%3A22):
> With your proposal, we at least need to add "EXAMPLE" and "EXAMPLES", by the way.

Yes and no.  Shouldn't<sup>TM</sup> `EXAMPLES` always precede `TESTS`?



---

archive/issue_comments_311283.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nFWIW, `l.startswith(indentation)` also works for the empty string and will be faster (not sure how much in practice though).",
    "created_at": "2016-08-05T19:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311283",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">Comment 25</div>

FWIW, `l.startswith(indentation)` also works for the empty string and will be faster (not sure how much in practice though).



---

archive/issue_comments_311284.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@nexttime](#comment%3A23):\n> I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...\n\nIt won't work for e.g.\n\n```\nTESTS:\n\n    ...\n\nFOO:\n    bar\n```\nwill it?\n\n(`FOO:` matches end_block and has the same indentation as `TESTS:` and doesn't match tests_block either, so you'd continue skipping.)",
    "created_at": "2016-08-05T19:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311284",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@nexttime](#comment%3A23):
> I'm not entirely sure yet your approach works though.  Deeeeeep thinking required...

It won't work for e.g.

```
TESTS:

    ...

FOO:
    bar
```
will it?

(`FOO:` matches end_block and has the same indentation as `TESTS:` and doesn't match tests_block either, so you'd continue skipping.)



---

archive/issue_comments_311285.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nSo Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like `EXXAMPLES::`.",
    "created_at": "2016-08-05T19:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311285",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:27" align="right">Comment 27</div>

So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like `EXXAMPLES::`.



---

archive/issue_comments_311286.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nSo here's my preliminary word (section name) list:\n\n```\nABS:\nACKNOWLEDGEMENT:\nACKNOWLEDGEMENTS:\nACKNOWLEDGMENT:\nADD:\nALGORITHM:\nALGORITHMS:\nALIAS:\nALIASES:\nAPPLICATIONS:\nARTEFACT:\nASSUMPTION:\nASSUMPTIONS:\nAUTHOR:\nAUTHORS:\nB:\nBENCHMARK:\nBUGS:\nCACHING:\nCHECKME:\nCODE:\nCOERCIONS:\nCOMMENTS:\nCOMPARISONS:\nCOMPLEXITY:\nCONDITIONS:\nCONSTRUCTION:\nCRUCIAL:\nDEBUG:\nDEFINITION:\nDETAILS:\nDISCUSSION:\nDIV:\nDUP:\nEFFECT:\nEOS:\nEQ:\nERROR:\nEXAMPLE:\nEXAMPLES:\nEXMAPLES:\nF:\nFACTS:\nFIXME:\nFLOAT:\nFORMALLY:\nFORMATS:\nFUNCTIONS:\nG:\nGAME:\nGE:\nGRIN:\nGT:\nH:\nHISTORY:\nIFAC:\nIML:\nIMPLEMENTATION:\nIMPORTANT:\nIN:\nINFO:\nINPUT:\nINPUTS:\nINT:\nINVERT:\nISBN:\nISGCI:\nJ:\nJOKE:\nKEYWORDS:\nKIND:\nLE:\nLICENSE:\nLIMITATIONS:\nLOCALS:\nLOG:\nLT:\nM:\nMAPLE:\nMATHEMATICA:\nMATRIX:\nMETHOD:\nMH:\nMODULE:\nMODULUS:\nMUL:\nMUTABILITY:\nNAME:\nNB:\nNE:\nNEG:\nNOTATION:\nNOTE:\nNOTES:\nOPTIONAL:\nOPTIONS:\nOR:\nOUPUT:\nOUT:\nOUTPUT:\nOUTPUTS:\nOUTUT:\nP:\nPARALLELE:\nPARI:\nPATH:\nPERFORMANCE:\nPLOTTING:\nPOP:\nPOW:\nPRECONDITIONS:\nPREMIER:\nPRINTING:\nPROBLEM:\nPROFILE:\nPROOF:\nR:\nRAISES:\nRATIONALE:\nREFERENCE:\nREFERENCES:\nREFERENCS:\nREFRENCES:\nREMARK:\nREMARKS:\nREQUIRED:\nREQUIRES:\nRESTRICTIONS:\nRETURN:\nRI:\nRINGS:\nSAGE:\nSEE:\nSEEALSO:\nSERIE:\nSUB:\nT:\nTEST:\nTESTS:\nTHEOREM:\nTHEORY:\nTIMINGS:\nTODO:\nTUTORIAL:\nU:\nUNKN:\nUSAGE:\nUSE:\nV:\nVALUES:\nVERSION:\nW:\nWARNING:\nX:\nY:\n```\n\nAnd no, there's not a single instance of misspelled ALLGORERHYTHM, but other interesting EXMAPLES [sic]. :-)",
    "created_at": "2016-08-05T20:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311286",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">Comment 28</div>

So here's my preliminary word (section name) list:

```
ABS:
ACKNOWLEDGEMENT:
ACKNOWLEDGEMENTS:
ACKNOWLEDGMENT:
ADD:
ALGORITHM:
ALGORITHMS:
ALIAS:
ALIASES:
APPLICATIONS:
ARTEFACT:
ASSUMPTION:
ASSUMPTIONS:
AUTHOR:
AUTHORS:
B:
BENCHMARK:
BUGS:
CACHING:
CHECKME:
CODE:
COERCIONS:
COMMENTS:
COMPARISONS:
COMPLEXITY:
CONDITIONS:
CONSTRUCTION:
CRUCIAL:
DEBUG:
DEFINITION:
DETAILS:
DISCUSSION:
DIV:
DUP:
EFFECT:
EOS:
EQ:
ERROR:
EXAMPLE:
EXAMPLES:
EXMAPLES:
F:
FACTS:
FIXME:
FLOAT:
FORMALLY:
FORMATS:
FUNCTIONS:
G:
GAME:
GE:
GRIN:
GT:
H:
HISTORY:
IFAC:
IML:
IMPLEMENTATION:
IMPORTANT:
IN:
INFO:
INPUT:
INPUTS:
INT:
INVERT:
ISBN:
ISGCI:
J:
JOKE:
KEYWORDS:
KIND:
LE:
LICENSE:
LIMITATIONS:
LOCALS:
LOG:
LT:
M:
MAPLE:
MATHEMATICA:
MATRIX:
METHOD:
MH:
MODULE:
MODULUS:
MUL:
MUTABILITY:
NAME:
NB:
NE:
NEG:
NOTATION:
NOTE:
NOTES:
OPTIONAL:
OPTIONS:
OR:
OUPUT:
OUT:
OUTPUT:
OUTPUTS:
OUTUT:
P:
PARALLELE:
PARI:
PATH:
PERFORMANCE:
PLOTTING:
POP:
POW:
PRECONDITIONS:
PREMIER:
PRINTING:
PROBLEM:
PROFILE:
PROOF:
R:
RAISES:
RATIONALE:
REFERENCE:
REFERENCES:
REFERENCS:
REFRENCES:
REMARK:
REMARKS:
REQUIRED:
REQUIRES:
RESTRICTIONS:
RETURN:
RI:
RINGS:
SAGE:
SEE:
SEEALSO:
SERIE:
SUB:
T:
TEST:
TESTS:
THEOREM:
THEORY:
TIMINGS:
TODO:
TUTORIAL:
U:
UNKN:
USAGE:
USE:
V:
VALUES:
VERSION:
W:
WARNING:
X:
Y:
```

And no, there's not a single instance of misspelled ALLGORERHYTHM, but other interesting EXMAPLES [sic]. :-)



---

archive/issue_comments_311287.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nP.S.:  Yet produced with `grep` and `sed`, so there are of course still false positives (including PARI's `IFAC:`).",
    "created_at": "2016-08-05T20:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311287",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">Comment 29</div>

P.S.:  Yet produced with `grep` and `sed`, so there are of course still false positives (including PARI's `IFAC:`).



---

archive/issue_comments_311288.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nJohn, is \"acknowledgment\" really (the more) common spelling in the U.S.?",
    "created_at": "2016-08-05T20:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311288",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:30" align="right">Comment 30</div>

John, is "acknowledgment" really (the more) common spelling in the U.S.?



---

archive/issue_comments_311289.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nStill exmaples after #19601? Arghs.",
    "created_at": "2016-08-05T20:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311289",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:31" align="right">Comment 31</div>

Still exmaples after #19601? Arghs.



---

archive/issue_comments_311290.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nFor my approach, I think I need to do\n\n```\nif l.startswith(indentation + ' '): ...\n```\nto make sure the match is indented more than \"TESTS\" was. I haven't tested it much (only on the example from pari_instance).\n\n> John, is \"acknowledgment\" really (the more) common spelling in the U.S.? \n\nYes.\n\n> So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. \n\nI think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.",
    "created_at": "2016-08-05T20:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311290",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">Comment 32</div>

For my approach, I think I need to do

```
if l.startswith(indentation + ' '): ...
```
to make sure the match is indented more than "TESTS" was. I haven't tested it much (only on the example from pari_instance).

> John, is "acknowledgment" really (the more) common spelling in the U.S.? 

Yes.

> So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. 

I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.



---

archive/issue_comments_311291.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nAnd I think doctesting just looks for lines of the form\n\n```\nsage: INPUT\nOUTPUT\n```\nand tests them: indentation seems to be ignored, \"EXAMPLES\" is unnecessary, etc.",
    "created_at": "2016-08-05T20:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311291",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">Comment 33</div>

And I think doctesting just looks for lines of the form

```
sage: INPUT
OUTPUT
```
and tests them: indentation seems to be ignored, "EXAMPLES" is unnecessary, etc.



---

archive/issue_comments_311292.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@jhpalmieri](#comment%3A32):\n> > So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. \n\n> \n> I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.\n\nWe could write Sphinx directives `.. EXAMPLES` and `.. TESTS`. Since unindenting ends a Sphinx block, this would mean we couldn't do the following (AFAIK):\n\n```\n.. EXAMPLES::\n\n    sage: blah\n    blah\n\nOh, and also\n\n    sage: blah\n    blah\n```\nas a single EXAMPLES block.",
    "created_at": "2016-08-05T20:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311292",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@jhpalmieri](#comment%3A32):
> > So Sphinx has no mechanism to restrict possible blocks of docstring? IMO the system should always fail with input like EXXAMPLES::. 

> 
> I think Sphinx just looks for indentations. It treats them specially if they are preceded by a Sphinx directive like `.. NOTE::` or `.. MATH::`, but it doesn't care about `EXXAMMPLES::` or `TESTS::`, etc., if it doesn't start with `'.. '`.

We could write Sphinx directives `.. EXAMPLES` and `.. TESTS`. Since unindenting ends a Sphinx block, this would mean we couldn't do the following (AFAIK):

```
.. EXAMPLES::

    sage: blah
    blah

Oh, and also

    sage: blah
    blah
```
as a single EXAMPLES block.



---

archive/issue_comments_311293.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nReplying to [@jm58660](#comment%3A31):\n> Still exmaples after #19601? Arghs.\n\n```\nsrc/sage/graphs/genus.pyx:692:    REFERENCS::\nsrc/sage/modular/btquotients/btquotient.py:417:        OUPUT:\nsrc/sage/modular/btquotients/btquotient.py:730:        OUPUT:\nsrc/sage/modular/pollack_stevens/dist.pyx:1879:#     OUPUT:\nsrc/sage/parallel/map_reduce.py:1903:        OUPUT: ``(z, )``\nsrc/sage/combinat/composition_tableau.py:578:    OUTUT:\nsrc/sage/combinat/sf/dual.py:266:        OUPUT\nsrc/sage/combinat/enumeration_mod_permgroup.pyx:97:    OUPUT:\nsrc/sage/combinat/matrices/dancing_links.pyx:342:        OUPUT:\nsrc/sage/combinat/matrices/dancing_links.pyx:386:        OUPUT:\nsrc/sage/combinat/words/finite_word.py:2006:        OUPUT\nsrc/sage/combinat/words/word_datatypes.pyx:258:        OUPUT:\nsrc/sage/combinat/words/word_datatypes.pyx:600:        OUPUT:\nsrc/sage/combinat/words/word_datatypes.pyx:1107:        OUPUT:\nsrc/sage/libs/linkages/padics/fmpz_poly_unram.pxi:70:    OUPUT:\nsrc/sage/libs/linkages/padics/API.pxi:113:    OUPUT:\nsrc/sage/libs/linkages/padics/mpz.pxi:70:    OUPUT:\nsrc/sage/libs/ppl.pyx:3636:        OUPUT:\nsrc/sage/libs/ppl.pyx:3904:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:359:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:454:        OUPUT:\nsrc/sage/schemes/toric/sheaf/klyachko.py:497:        OUPUT:\nsrc/sage/schemes/curves/affine_curve.py:441:        OUPUT: Boolean.\nsrc/sage/schemes/curves/projective_curve.py:77:        EXMAPLES::\nsrc/sage/schemes/curves/projective_curve.py:748:        OUPUT: Boolean.\nsrc/sage/manifolds/scalarfield.py:1490:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1770:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1821:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1873:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1923:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:1981:        OUPUT:\nsrc/sage/manifolds/scalarfield.py:2068:        OUPUT:\n```\n\nDon't know where \"REFRENCES\" originated from...",
    "created_at": "2016-08-05T20:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311293",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:35" align="right">Comment 35</div>

Replying to [@jm58660](#comment%3A31):
> Still exmaples after #19601? Arghs.

```
src/sage/graphs/genus.pyx:692:    REFERENCS::
src/sage/modular/btquotients/btquotient.py:417:        OUPUT:
src/sage/modular/btquotients/btquotient.py:730:        OUPUT:
src/sage/modular/pollack_stevens/dist.pyx:1879:#     OUPUT:
src/sage/parallel/map_reduce.py:1903:        OUPUT: ``(z, )``
src/sage/combinat/composition_tableau.py:578:    OUTUT:
src/sage/combinat/sf/dual.py:266:        OUPUT
src/sage/combinat/enumeration_mod_permgroup.pyx:97:    OUPUT:
src/sage/combinat/matrices/dancing_links.pyx:342:        OUPUT:
src/sage/combinat/matrices/dancing_links.pyx:386:        OUPUT:
src/sage/combinat/words/finite_word.py:2006:        OUPUT
src/sage/combinat/words/word_datatypes.pyx:258:        OUPUT:
src/sage/combinat/words/word_datatypes.pyx:600:        OUPUT:
src/sage/combinat/words/word_datatypes.pyx:1107:        OUPUT:
src/sage/libs/linkages/padics/fmpz_poly_unram.pxi:70:    OUPUT:
src/sage/libs/linkages/padics/API.pxi:113:    OUPUT:
src/sage/libs/linkages/padics/mpz.pxi:70:    OUPUT:
src/sage/libs/ppl.pyx:3636:        OUPUT:
src/sage/libs/ppl.pyx:3904:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:359:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:454:        OUPUT:
src/sage/schemes/toric/sheaf/klyachko.py:497:        OUPUT:
src/sage/schemes/curves/affine_curve.py:441:        OUPUT: Boolean.
src/sage/schemes/curves/projective_curve.py:77:        EXMAPLES::
src/sage/schemes/curves/projective_curve.py:748:        OUPUT: Boolean.
src/sage/manifolds/scalarfield.py:1490:        OUPUT:
src/sage/manifolds/scalarfield.py:1770:        OUPUT:
src/sage/manifolds/scalarfield.py:1821:        OUPUT:
src/sage/manifolds/scalarfield.py:1873:        OUPUT:
src/sage/manifolds/scalarfield.py:1923:        OUPUT:
src/sage/manifolds/scalarfield.py:1981:        OUPUT:
src/sage/manifolds/scalarfield.py:2068:        OUPUT:
```

Don't know where "REFRENCES" originated from...



---

archive/issue_comments_311294.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nReplying to [@nexttime](#comment%3A35):\n> Don't know where \"REFRENCES\" originated from...\n\n```\nsrc/sage/combinat/ribbon_tableau.py:197:    REFRENCES:\nsrc/sage/combinat/sf/jack.py:991:        REFRENCES:\n```",
    "created_at": "2016-08-05T21:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311294",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:36" align="right">Comment 36</div>

Replying to [@nexttime](#comment%3A35):
> Don't know where "REFRENCES" originated from...

```
src/sage/combinat/ribbon_tableau.py:197:    REFRENCES:
src/sage/combinat/sf/jack.py:991:        REFRENCES:
```



---

archive/issue_comments_311295.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI've put the typos above on #21178.",
    "created_at": "2016-08-05T21:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311295",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:37" align="right">Comment 37</div>

I've put the typos above on #21178.



---

archive/issue_comments_311296.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)**",
    "created_at": "2016-08-06T00:53:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311296",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)**



---

archive/issue_comments_311297.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nHere is a branch which uses the indentation solution (plus hiding TESTS blocks by default in the reference manual). Feel free to post one with the version using whitelisting of section names.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae\">eb908ce</a></td><td><code>trac 21172: TESTS blocks should end not on any line starting \"CAPITALS:\", but</code></td></tr></table>\n",
    "created_at": "2016-08-06T00:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311297",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">Comment 39</div>

Here is a branch which uses the indentation solution (plus hiding TESTS blocks by default in the reference manual). Feel free to post one with the version using whitelisting of section names.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae">eb908ce</a></td><td><code>trac 21172: TESTS blocks should end not on any line starting "CAPITALS:", but</code></td></tr></table>




---

archive/issue_comments_311298.json:
```json
{
    "body": "Commit: **[eb908ce](https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae)**",
    "created_at": "2016-08-06T00:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311298",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[eb908ce](https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae)**



---

archive/issue_comments_311299.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nLooks like positive review (modulo related things that could be done on a follow-up as well).\n\nBut I'm still performing further tests... (i.e., I'm actually reviewing what gets removed, which is quite a bit of work)",
    "created_at": "2016-08-07T06:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311299",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:40" align="right">Comment 40</div>

Looks like positive review (modulo related things that could be done on a follow-up as well).

But I'm still performing further tests... (i.e., I'm actually reviewing what gets removed, which is quite a bit of work)



---

archive/issue_comments_311300.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nNope, needs work.\n\nThere's an `else` missing to handle the case that a `TESTS` block is just terminated by an \"ordinary\" line (not matching the patterns), which of course has to be less indented than the starting `TESTS:`[`:`] (otherwise it wouldn't terminate the block).\n\nSee for example `src/sage/rings/asymptotic/asymptotic_expansion_generators.py`, where incidentally (because of the `::`) \"only two\" (non-empty) lines after the `TESTS` block get eaten up:\n\n```python\nr\"\"\"\nCommon Asymptotic Expansions\n\n.. WARNING::\n\n    As this code is experimental, a warning is thrown when an\n    asymptotic ring (or an associated structure) is created for the\n    first time in a session (see\n    :class:`sage.misc.superseded.experimental`).\n\n    TESTS::\n\n        sage: AsymptoticRing(growth_group='z^ZZ * log(z)^QQ', coefficient_ring=ZZ)\n        doctest:...: FutureWarning: This class/method/function is marked as\n        experimental. It, its functionality or its interface might change\n        without a formal deprecation.\n        See http://trac.sagemath.org/17601 for details.\n        Asymptotic Ring <z^ZZ * log(z)^QQ> over Integer Ring\n\n\nAsymptotic expansions in SageMath can be built through the\n``asymptotic_expansions`` object. It contains generators for common\nasymptotic expressions. For example,\n::\n\n    sage: asymptotic_expansions.Stirling('n', precision=5)\n    sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(1/2) +\n    1/12*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-1/2) +\n    1/288*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-3/2) +\n    O(e^(n*log(n))*(e^n)^(-1)*n^(-5/2))\n\ngenerates the first 5 summands of Stirling's approximation formula for\nfactorials.\n\n...\n\"\"\"\n```\n\n(IMHO you shouldn't need `previous` anyway, except for adding a blank line, in which case you don't have to keep the actual contents, only maybe the indentation / number of spaces, but I'm not even sure that's necessary.)\n\n---\n\nEDIT: Removed *[... has to be less] **(or equally)** [indented than ...]* again I added afterwards, because that's wrong.",
    "created_at": "2016-08-07T09:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311300",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:41" align="right">Comment 41</div>

Nope, needs work.

There's an `else` missing to handle the case that a `TESTS` block is just terminated by an "ordinary" line (not matching the patterns), which of course has to be less indented than the starting `TESTS:`[`:`] (otherwise it wouldn't terminate the block).

See for example `src/sage/rings/asymptotic/asymptotic_expansion_generators.py`, where incidentally (because of the `::`) "only two" (non-empty) lines after the `TESTS` block get eaten up:

```python
r"""
Common Asymptotic Expansions

.. WARNING::

    As this code is experimental, a warning is thrown when an
    asymptotic ring (or an associated structure) is created for the
    first time in a session (see
    :class:`sage.misc.superseded.experimental`).

    TESTS::

        sage: AsymptoticRing(growth_group='z^ZZ * log(z)^QQ', coefficient_ring=ZZ)
        doctest:...: FutureWarning: This class/method/function is marked as
        experimental. It, its functionality or its interface might change
        without a formal deprecation.
        See http://trac.sagemath.org/17601 for details.
        Asymptotic Ring <z^ZZ * log(z)^QQ> over Integer Ring


Asymptotic expansions in SageMath can be built through the
``asymptotic_expansions`` object. It contains generators for common
asymptotic expressions. For example,
::

    sage: asymptotic_expansions.Stirling('n', precision=5)
    sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(1/2) +
    1/12*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-1/2) +
    1/288*sqrt(2)*sqrt(pi)*e^(n*log(n))*(e^n)^(-1)*n^(-3/2) +
    O(e^(n*log(n))*(e^n)^(-1)*n^(-5/2))

generates the first 5 summands of Stirling's approximation formula for
factorials.

...
"""
```

(IMHO you shouldn't need `previous` anyway, except for adding a blank line, in which case you don't have to keep the actual contents, only maybe the indentation / number of spaces, but I'm not even sure that's necessary.)

---

EDIT: Removed *[... has to be less] **(or equally)** [indented than ...]* again I added afterwards, because that's wrong.



---

archive/issue_comments_311301.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nP.S.:  John, just in case you don't have the time (or mood) to further work on this now, I could take over and present something in the next days.",
    "created_at": "2016-08-07T10:11:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311301",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:42" align="right">Comment 42</div>

P.S.:  John, just in case you don't have the time (or mood) to further work on this now, I could take over and present something in the next days.



---

archive/issue_comments_311302.json:
```json
{
    "body": "Changed keywords from **--no-tests** to **--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS**",
    "created_at": "2016-08-07T10:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311302",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **--no-tests** to **--no-tests --include-tests-blocks SAGE_SKIP_TESTS_BLOCKS**



---

archive/issue_comments_311303.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nA few comments: you need `previous` in the `header` case, since the previous line is the actual title of that header. Were you thinking of getting rid of it in general?\n\nGood catch on the example in `asymptotic_expansion_generators.py`, but I think that's pretty rare. What may also occur, unfortunately, is something like\n\n```\n    TESTS::\n\n        blah\n\n    We should also test x::\n\n        blah # should be considered part of the TESTS block\n\n    Now the tests are over, so let's make some remarks.\n    (This should not be part of the TESTS block.)\n```\nI don't know how to catch this. Maybe TESTS should be a Sphinx directive after all (but not on this ticket).\n\nIf you have time to work on your proposed changes, please go ahead.",
    "created_at": "2016-08-07T15:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311303",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">Comment 44</div>

A few comments: you need `previous` in the `header` case, since the previous line is the actual title of that header. Were you thinking of getting rid of it in general?

Good catch on the example in `asymptotic_expansion_generators.py`, but I think that's pretty rare. What may also occur, unfortunately, is something like

```
    TESTS::

        blah

    We should also test x::

        blah # should be considered part of the TESTS block

    Now the tests are over, so let's make some remarks.
    (This should not be part of the TESTS block.)
```
I don't know how to catch this. Maybe TESTS should be a Sphinx directive after all (but not on this ticket).

If you have time to work on your proposed changes, please go ahead.



---

archive/issue_comments_311304.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nI am now testing the following change (on top of the current commit):\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..0139a3e 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if not l.startswith(indentation):\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n```",
    "created_at": "2016-08-08T04:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311304",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">Comment 45</div>

I am now testing the following change (on top of the current commit):

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..0139a3e 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if not l.startswith(indentation):
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
```



---

archive/issue_comments_311305.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nNo, that doesn't work. Hold on.",
    "created_at": "2016-08-08T04:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311305",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:46" align="right">Comment 46</div>

No, that doesn't work. Hold on.



---

archive/issue_comments_311306.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@jhpalmieri](#comment%3A46):\n> No, that doesn't work. Hold on.\n\n... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + \" \"` won't ever hold either. ;-)",
    "created_at": "2016-08-08T05:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311306",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@jhpalmieri](#comment%3A46):
> No, that doesn't work. Hold on.

... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + " "` won't ever hold either. ;-)



---

archive/issue_comments_311307.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nIt *may* make sense to generally differentiate between TESTS blocks starting at top-level (`indentation==\"\"`) and TESTS blocks that started with arbitrary (non-zero) indentation, i.e., to introduce a new explicit state.\n\n(Perhaps also for headings.  AFAIK these *have to* start at column 0, haven't they?)",
    "created_at": "2016-08-08T05:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311307",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:48" align="right">Comment 48</div>

It *may* make sense to generally differentiate between TESTS blocks starting at top-level (`indentation==""`) and TESTS blocks that started with arbitrary (non-zero) indentation, i.e., to introduce a new explicit state.

(Perhaps also for headings.  AFAIK these *have to* start at column 0, haven't they?)



---

archive/issue_comments_311308.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nReplying to [@nexttime](#comment%3A47):\n> Replying to [@jhpalmieri](#comment%3A46):\n> > No, that doesn't work.\n\n> \n> ... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + \" \"` won't ever hold either. ;-)\n\nSeemed...  Don't strike that not. ;-)",
    "created_at": "2016-08-08T05:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311308",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:49" align="right">Comment 49</div>

Replying to [@nexttime](#comment%3A47):
> Replying to [@jhpalmieri](#comment%3A46):
> > No, that doesn't work.

> 
> ... which seemed obvious since when `not l.startswith(indentation)` doesn't hold `l.startswith(indentation + " "` won't ever hold either. ;-)

Seemed...  Don't strike that not. ;-)



---

archive/issue_comments_311309.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nMaybe this one instead:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..8f54c43 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if l and not l.isspace() and not l.startswith(indentation):\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n```",
    "created_at": "2016-08-08T05:26:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311309",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:50" align="right">Comment 50</div>

Maybe this one instead:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..8f54c43 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -322,7 +322,11 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if l and not l.isspace() and not l.startswith(indentation):
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
```



---

archive/issue_comments_311310.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nSo get rid of the leading space for the regexp for `header`, and don't bother in that case checking if the line starts with `indentation`?\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9004bdb..6b7778b 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -306,7 +306,7 @@ def skip_TESTS_block(docstring):\n     end_of_block = re.compile('[ ]*(\\.\\.[ ]+[-_A-Za-z]+|[A-Z]+):')\n     # header: match a string of hyphens, or other characters which are\n     # valid markers for ReST headers: - = ` : ' \" ~ _ ^ * + # < >\n-    header = re.compile(r'^[ ]*([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n+    header = re.compile(r'^([-=`:\\'\"~_^*+#><])\\1+[ ]*$')\n     s = ''\n     skip = False\n     previous = ''\n@@ -322,15 +322,20 @@ def skip_TESTS_block(docstring):\n                 s += \"\\n\"\n                 s += l\n         else:\n-            if end_of_block.match(l) and not tests_block.match(l):\n+            if l and not l.isspace() and not l.startswith(indentation):\n+                # A non-blank line indented less than 'TESTS:'\n+                skip = False\n+                s += \"\\n\"\n+                s += l\n+            elif end_of_block.match(l) and not tests_block.match(l):\n+                # A line matching end_of_block and indented the same as 'TESTS:'\n                 if l.startswith(indentation + \" \"):\n                     continue\n                 skip = False\n                 s += \"\\n\"\n                 s += l\n             elif header.match(l):\n-                if l.startswith(indentation):\n-                    continue\n+                # A line matching header.\n                 skip = False\n                 if previous:\n                     s += \"\\n\"\n```",
    "created_at": "2016-08-08T05:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311310",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:51" align="right">Comment 51</div>

So get rid of the leading space for the regexp for `header`, and don't bother in that case checking if the line starts with `indentation`?

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9004bdb..6b7778b 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -306,7 +306,7 @@ def skip_TESTS_block(docstring):
     end_of_block = re.compile('[ ]*(\.\.[ ]+[-_A-Za-z]+|[A-Z]+):')
     # header: match a string of hyphens, or other characters which are
     # valid markers for ReST headers: - = ` : ' " ~ _ ^ * + # < >
-    header = re.compile(r'^[ ]*([-=`:\'"~_^*+#><])\1+[ ]*$')
+    header = re.compile(r'^([-=`:\'"~_^*+#><])\1+[ ]*$')
     s = ''
     skip = False
     previous = ''
@@ -322,15 +322,20 @@ def skip_TESTS_block(docstring):
                 s += "\n"
                 s += l
         else:
-            if end_of_block.match(l) and not tests_block.match(l):
+            if l and not l.isspace() and not l.startswith(indentation):
+                # A non-blank line indented less than 'TESTS:'
+                skip = False
+                s += "\n"
+                s += l
+            elif end_of_block.match(l) and not tests_block.match(l):
+                # A line matching end_of_block and indented the same as 'TESTS:'
                 if l.startswith(indentation + " "):
                     continue
                 skip = False
                 s += "\n"
                 s += l
             elif header.match(l):
-                if l.startswith(indentation):
-                    continue
+                # A line matching header.
                 skip = False
                 if previous:
                     s += "\n"
```



---

archive/issue_comments_311311.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nReplying to [@jhpalmieri](#comment%3A44):\n> What may also occur, unfortunately, is something like\n> \n> ```\n>     TESTS::\n> \n>         blah\n> \n>     We should also test x::\n> \n>         blah # should be considered part of the TESTS block\n> \n>     Now the tests are over, so let's make some remarks.\n>     (This should not be part of the TESTS block.)\n> ```\n> I don't know how to catch this.\n\nI don't think we can, other than by detailing the documentation with a warning regarding exactly that case, and perhaps adding a tool to easily show what will get removed (without [looking at] HTML output; also since what `foo?` shows isn't always that readable).\n\n\\\\\n\n> Maybe TESTS should be a Sphinx directive after all (but not on this ticket).\n\nWell, you already mentioned the drawback; then we'd have to split almost any existing TESTS block into several.",
    "created_at": "2016-08-08T05:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311311",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:52" align="right">Comment 52</div>

Replying to [@jhpalmieri](#comment%3A44):
> What may also occur, unfortunately, is something like
> 
> ```
>     TESTS::
> 
>         blah
> 
>     We should also test x::
> 
>         blah # should be considered part of the TESTS block
> 
>     Now the tests are over, so let's make some remarks.
>     (This should not be part of the TESTS block.)
> ```
> I don't know how to catch this.

I don't think we can, other than by detailing the documentation with a warning regarding exactly that case, and perhaps adding a tool to easily show what will get removed (without [looking at] HTML output; also since what `foo?` shows isn't always that readable).

\\

> Maybe TESTS should be a Sphinx directive after all (but not on this ticket).

Well, you already mentioned the drawback; then we'd have to split almost any existing TESTS block into several.



---

archive/issue_comments_311312.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nI don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.",
    "created_at": "2016-08-08T09:13:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311312",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">Comment 53</div>

I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.



---

archive/issue_comments_311313.json:
```json
{
    "body": "Changed commit from **[eb908ce](https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae)** to **[05ac635](https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca)**",
    "created_at": "2016-08-08T14:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311313",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eb908ce](https://github.com/sagemath/sagetrac-mirror/commit/eb908ce10d82bc26a13e01ed8b6e70552e361eae)** to **[05ac635](https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca)**



---

archive/issue_comments_311314.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca\">05ac635</a></td><td><code>trac 21172: TESTS blocks should also end on a line indented less than</code></td></tr></table>\n",
    "created_at": "2016-08-08T14:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311314",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54" align="right">Comment 54</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca">05ac635</a></td><td><code>trac 21172: TESTS blocks should also end on a line indented less than</code></td></tr></table>




---

archive/issue_comments_311315.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db\">b02630e</a></td><td><code>trac 21172: update documentation</code></td></tr></table>\n",
    "created_at": "2016-08-08T15:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311315",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55" align="right">Comment 55</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db">b02630e</a></td><td><code>trac 21172: update documentation</code></td></tr></table>




---

archive/issue_comments_311316.json:
```json
{
    "body": "Changed commit from **[05ac635](https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca)** to **[b02630e](https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db)**",
    "created_at": "2016-08-08T15:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311316",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[05ac635](https://github.com/sagemath/sagetrac-mirror/commit/05ac635641fe4f22bdca8aa88f1a1015c7a437ca)** to **[b02630e](https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db)**



---

archive/issue_events_279786.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-08-08T15:30:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279786"
}
```



---

archive/issue_comments_311317.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2016-08-08T15:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311317",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_comments_311318.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nReplying to [@jdemeyer](#comment%3A53):\n> I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.\n\nThat's the approach I'm currently working on.",
    "created_at": "2016-08-08T15:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311318",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">Comment 56</div>

Replying to [@jdemeyer](#comment%3A53):
> I don't think that there is necessary a problem with ending a `TESTS` block by something matching `[A-Z]+:`. The problem is that indentation should be considered too: line which are more indented than the `TESTS:` header should always be considered as part of the `TESTS` block.

That's the approach I'm currently working on.



---

archive/issue_events_279787.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-20T11:42:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279787"
}
```



---

archive/issue_events_279788.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-09-20T11:42:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279788"
}
```



---

archive/issue_comments_311319.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nJust pinging. I tested this, and it works. But I can not really say that I understand this -- or any Sphinx-related -- code. Someone to review?\n\nI raised priority to major, as I think this to be quite important. Reading documentation is hard if half of the text must be skipped.",
    "created_at": "2016-09-20T11:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311319",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:57" align="right">Comment 57</div>

Just pinging. I tested this, and it works. But I can not really say that I understand this -- or any Sphinx-related -- code. Someone to review?

I raised priority to major, as I think this to be quite important. Reading documentation is hard if half of the text must be skipped.



---

archive/issue_events_279789.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279789"
}
```



---

archive/issue_events_279790.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279790"
}
```



---

archive/issue_events_279791.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279791"
}
```



---

archive/issue_events_279792.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-11-18T13:16:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279792"
}
```



---

archive/issue_comments_311320.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nNeeds rebasing.\n\nAnd really needs someone to review this.",
    "created_at": "2016-11-18T13:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311320",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:58" align="right">Comment 58</div>

Needs rebasing.

And really needs someone to review this.



---

archive/issue_comments_311321.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6\">cdc3937</a></td><td><code>merge with 7.5.beta3</code></td></tr></table>\n",
    "created_at": "2016-11-18T17:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311321",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59" align="right">Comment 59</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6">cdc3937</a></td><td><code>merge with 7.5.beta3</code></td></tr></table>




---

archive/issue_comments_311322.json:
```json
{
    "body": "Changed commit from **[b02630e](https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db)** to **[cdc3937](https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6)**",
    "created_at": "2016-11-18T17:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311322",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b02630e](https://github.com/sagemath/sagetrac-mirror/commit/b02630ec24f41a568077274956ddb28dc67b89db)** to **[cdc3937](https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6)**



---

archive/issue_events_279793.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-11-18T17:48:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279793"
}
```



---

archive/issue_events_279794.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-11-18T17:48:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279794"
}
```



---

archive/issue_comments_311323.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nfailing doctest (see patchbot).",
    "created_at": "2017-01-07T06:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311323",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:61" align="right">Comment 61</div>

failing doctest (see patchbot).



---

archive/issue_events_279795.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-07T06:47:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279795"
}
```



---

archive/issue_events_279796.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2017-01-07T06:47:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279796"
}
```



---

archive/issue_comments_311324.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4\">570fb47</a></td><td><code>trac 21172: fix a problem with detecting headers</code></td></tr></table>\n",
    "created_at": "2017-01-08T06:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311324",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62" align="right">Comment 62</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4">570fb47</a></td><td><code>trac 21172: fix a problem with detecting headers</code></td></tr></table>




---

archive/issue_comments_311325.json:
```json
{
    "body": "Changed commit from **[cdc3937](https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6)** to **[570fb47](https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4)**",
    "created_at": "2017-01-08T06:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311325",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cdc3937](https://github.com/sagemath/sagetrac-mirror/commit/cdc39376266bd156d88599154b67c51421d022e6)** to **[570fb47](https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4)**



---

archive/issue_events_279797.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-01-08T06:22:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279797"
}
```



---

archive/issue_events_279798.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-01-08T06:22:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279798"
}
```



---

archive/issue_comments_311326.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nFixed.",
    "created_at": "2017-01-08T06:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311326",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:64" align="right">Comment 64</div>

Fixed.



---

archive/issue_comments_311327.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nWhy this?\n\n```diff\n@@ -278,8 +279,8 @@ def skip_TESTS_block(docstring):\n         sage: skip_TESTS_block(start + test + refs + test2 + directive).rstrip() == (start + refs + directive).rstrip()\n         True\n \n-        sage: header = 'Header:\\n~~~~~~~~'\n-        sage: fake_header = 'Header:\\n-=-=-=-=-='\n+        sage: header = ' Header:\\n ~~~~~~~~'\n+        sage: fake_header = ' Header:\\n -=-=-=-=-='\n         sage: skip_TESTS_block(start + test + header) == start + header\n         True\n         sage: skip_TESTS_block(start + test + fake_header).rstrip() == start.rstrip()\n```\nI think this doctest should work as it was before.",
    "created_at": "2017-01-09T10:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311327",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:65" align="right">Comment 65</div>

Why this?

```diff
@@ -278,8 +279,8 @@ def skip_TESTS_block(docstring):
         sage: skip_TESTS_block(start + test + refs + test2 + directive).rstrip() == (start + refs + directive).rstrip()
         True
 
-        sage: header = 'Header:\n~~~~~~~~'
-        sage: fake_header = 'Header:\n-=-=-=-=-='
+        sage: header = ' Header:\n ~~~~~~~~'
+        sage: fake_header = ' Header:\n -=-=-=-=-='
         sage: skip_TESTS_block(start + test + header) == start + header
         True
         sage: skip_TESTS_block(start + test + fake_header).rstrip() == start.rstrip()
```
I think this doctest should work as it was before.



---

archive/issue_comments_311328.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nThe old test was not actually testing the \"header\" part of the code, since it was unindented compared to \" TESTS:\". Also, both `header` and `fake_header` were unindented, so both ended the TESTS block. So I added leading spaces.",
    "created_at": "2017-01-09T16:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311328",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:66" align="right">Comment 66</div>

The old test was not actually testing the "header" part of the code, since it was unindented compared to " TESTS:". Also, both `header` and `fake_header` were unindented, so both ended the TESTS block. So I added leading spaces.



---

archive/issue_comments_311329.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61\">20e5e59</a></td><td><code>trac 21172: rearrange doctests</code></td></tr></table>\n",
    "created_at": "2017-02-01T00:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311329",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67" align="right">Comment 67</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61">20e5e59</a></td><td><code>trac 21172: rearrange doctests</code></td></tr></table>




---

archive/issue_comments_311330.json:
```json
{
    "body": "Changed commit from **[570fb47](https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4)** to **[20e5e59](https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61)**",
    "created_at": "2017-02-01T00:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311330",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[570fb47](https://github.com/sagemath/sagetrac-mirror/commit/570fb47df1a112d2c2d352ce27f50bf318ece9f4)** to **[20e5e59](https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61)**



---

archive/issue_events_279799.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-01T00:18:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279799"
}
```



---

archive/issue_events_279800.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-01T00:18:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279800"
}
```



---

archive/issue_comments_311331.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nThe doctests are organized better now (in my opinion). The PDF docs are not building right now, so \"needs work\". I'll try to figure out what's going on.",
    "created_at": "2017-02-01T00:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311331",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:68" align="right">Comment 68</div>

The doctests are organized better now (in my opinion). The PDF docs are not building right now, so "needs work". I'll try to figure out what's going on.



---

archive/issue_comments_311332.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nIt's working now. Maybe I forgot to do `make doc-clean` earlier.",
    "created_at": "2017-02-01T02:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311332",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:69" align="right">Comment 69</div>

It's working now. Maybe I forgot to do `make doc-clean` earlier.



---

archive/issue_events_279801.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-01T02:12:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279801"
}
```



---

archive/issue_events_279802.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-01T02:12:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279802"
}
```



---

archive/issue_comments_311333.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nThe branch seems to be red again.",
    "created_at": "2017-02-07T10:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311333",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:70" align="right">Comment 70</div>

The branch seems to be red again.



---

archive/issue_events_279803.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T10:16:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279803"
}
```



---

archive/issue_events_279804.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T10:16:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279804"
}
```



---

archive/issue_comments_311334.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nI'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).",
    "created_at": "2017-02-07T16:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311334",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:71" align="right">Comment 71</div>

I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).



---

archive/issue_events_279805.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T20:33:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279805"
}
```



---

archive/issue_events_279806.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-07T20:33:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279806"
}
```



---

archive/issue_comments_311335.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nReplying to [@jhpalmieri](#comment%3A71):\n> I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).\n\nI guess I must do it. I know about nothing about Sphinx, and actually don't even want to know, but...",
    "created_at": "2017-02-07T20:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311335",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:72" align="right">Comment 72</div>

Replying to [@jhpalmieri](#comment%3A71):
> I'll try to fix it after the next beta (although it is not clear that anyone is ever going to review it, so I may stop bothering after a while).

I guess I must do it. I know about nothing about Sphinx, and actually don't even want to know, but...



---

archive/issue_comments_311336.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e15e476cb6c20afc843fe2e0664103220470d1\">f0e15e4</a></td><td><code>Minor changes to the code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da012722473ae5bedfd6d67ab5f9b43749afc54e\">da01272</a></td><td><code>Fixed merge conflict. Doctests pass.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/804d2f2c9d6c9a050502c31220d2a295b9ff1a27\">804d2f2</a></td><td><code>Removed deprecation alias for min_wt_vec_gap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72105015f3e37ebcf0d2542d9ad61575782cbf0a\">7210501</a></td><td><code>Trac #20953: Improve minimum_distance for linear codes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf876cbd5ab538c80abc8d5bc7ff9ddb50dbe106\">bf876cb</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 7.6.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7de0514acb1880409d05cb874b15a73c081081e\">a7de051</a></td><td><code>trac 21172: TESTS blocks should end not on any line starting \"CAPITALS:\", but</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dd7e4ccc1bf474794f76416bf8e63a4a9004999\">9dd7e4c</a></td><td><code>trac 21172: TESTS blocks should also end on a line indented less than</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5374ad5055acb3a26484f56c942e2d0416e892c2\">5374ad5</a></td><td><code>trac 21172: update documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef59f47e79ed92337576edf3d9045fdd5e14e787\">ef59f47</a></td><td><code>trac 21172: fix a problem with detecting headers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879\">f4c3edb</a></td><td><code>trac 21172: rearrange doctests</code></td></tr></table>\n",
    "created_at": "2017-02-09T02:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311336",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73" align="right">Comment 73</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e15e476cb6c20afc843fe2e0664103220470d1">f0e15e4</a></td><td><code>Minor changes to the code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da012722473ae5bedfd6d67ab5f9b43749afc54e">da01272</a></td><td><code>Fixed merge conflict. Doctests pass.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/804d2f2c9d6c9a050502c31220d2a295b9ff1a27">804d2f2</a></td><td><code>Removed deprecation alias for min_wt_vec_gap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72105015f3e37ebcf0d2542d9ad61575782cbf0a">7210501</a></td><td><code>Trac #20953: Improve minimum_distance for linear codes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf876cbd5ab538c80abc8d5bc7ff9ddb50dbe106">bf876cb</a></td><td><code>Updated [SageMath](../wiki/SageMath) version to 7.6.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7de0514acb1880409d05cb874b15a73c081081e">a7de051</a></td><td><code>trac 21172: TESTS blocks should end not on any line starting "CAPITALS:", but</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dd7e4ccc1bf474794f76416bf8e63a4a9004999">9dd7e4c</a></td><td><code>trac 21172: TESTS blocks should also end on a line indented less than</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5374ad5055acb3a26484f56c942e2d0416e892c2">5374ad5</a></td><td><code>trac 21172: update documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef59f47e79ed92337576edf3d9045fdd5e14e787">ef59f47</a></td><td><code>trac 21172: fix a problem with detecting headers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879">f4c3edb</a></td><td><code>trac 21172: rearrange doctests</code></td></tr></table>




---

archive/issue_comments_311337.json:
```json
{
    "body": "Changed commit from **[20e5e59](https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61)** to **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**",
    "created_at": "2017-02-09T02:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[20e5e59](https://github.com/sagemath/sagetrac-mirror/commit/20e5e59336363c77b48e2e6c1581490631511b61)** to **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**



---

archive/issue_comments_311338.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nRebased to 7.6.beta3.\n\nTo help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.\n\nOh, it does change one thing with Sphinx: it changes the default from including TESTS blocks to omitting them.",
    "created_at": "2017-02-09T02:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311338",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:74" align="right">Comment 74</div>

Rebased to 7.6.beta3.

To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.

Oh, it does change one thing with Sphinx: it changes the default from including TESTS blocks to omitting them.



---

archive/issue_events_279807.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-09T02:50:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279807"
}
```



---

archive/issue_events_279808.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-02-09T02:50:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279808"
}
```



---

archive/issue_comments_311339.json:
```json
{
    "body": "Reviewer: **Jori M\u00e4ntysalo**",
    "created_at": "2017-02-09T07:47:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311339",
    "user": "https://github.com/jm58660"
}
```

Reviewer: **Jori MÃ¤ntysalo**



---

archive/issue_events_279809.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-09T07:47:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279809"
}
```



---

archive/issue_events_279810.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-02-09T07:47:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279810"
}
```



---

archive/issue_comments_311340.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nReplying to [@jhpalmieri](#comment%3A74):\n\n> To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.\n\nThanks for the explanation. This was the first time I look at Python implementation of regexps, but it seems to be clear. I mark this as a positive review.\n\n(Sidenote: We should have something better! I mean a structured way so that Sphinx (or whatever we would use) would know the blocks and one could say something like `--docskip=tests,algorithm` or like.)",
    "created_at": "2017-02-09T07:47:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311340",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:76" align="right">Comment 76</div>

Replying to [@jhpalmieri](#comment%3A74):

> To help with reviewing: this does nothing explicitly with Sphinx, because that work was done in the earlier ticket dealing with TESTS blocks. This modifies the function that detects when TESTS blocks start and end, so it is plain Python dealing with regular expressions. Sphinx then uses this to process docstrings, but it was already doing that.

Thanks for the explanation. This was the first time I look at Python implementation of regexps, but it seems to be clear. I mark this as a positive review.

(Sidenote: We should have something better! I mean a structured way so that Sphinx (or whatever we would use) would know the blocks and one could say something like `--docskip=tests,algorithm` or like.)



---

archive/issue_comments_311341.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)** to **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**",
    "created_at": "2017-02-11T10:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21172#issuecomment-311341",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/TESTS](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/TESTS)** to **[f4c3edb](https://github.com/sagemath/sagetrac-mirror/commit/f4c3edb33f5aaaae88d5484602d32b712e5f2879)**



---

archive/issue_events_279811.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-11T10:24:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279811"
}
```



---

archive/issue_events_279812.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c4d37d9abe02be937f757ad3fc1a5b830354c9b6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-02-11T10:24:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21172",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21172#event-279812"
}
```
