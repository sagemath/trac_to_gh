# Issue 21625: Strange linking order for omalloc due to pkgconfig bug

archive/issues_021388.json:
```json
{
    "assignees": [],
    "body": "This is a follow up to #17254 which upgraded to singular 4:\n\nThe linking order for Singular libraries is determined by `pkgconfig` which gives\n\n```\n-lomalloc -lSingular -lpolys -lfactory -lresources\n```\nThis does not look that right.\n\nThis is because `pkgconfig` uses sets that don't preserve the order of libraries (and include directories or macros etc...).\n\nA solution is to migrate `pkgconfig`  from sets to list.\n\nhttps://github.com/matze/pkgconfig/issues/10 \n\nhas been opened upstream to explain the rational, along with a pull request to implement it at \n\nhttps://github.com/matze/pkgconfig/pull/11\n\nThis has now been accepted upstream and is part of a new release with a few other fixes.\n\n**Tarball**: [https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)\n\nBranch: **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Fran\u00e7ois Bissey**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21625_\n\n",
    "closed_at": "2016-12-07T23:29:59Z",
    "created_at": "2016-10-03T10:05:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Strange linking order for omalloc due to pkgconfig bug",
    "type": "issue",
    "updated_at": "2016-12-11T20:05:16Z",
    "url": "https://github.com/sagemath/sage/issues/21625",
    "user": "https://github.com/jpflori"
}
```
This is a follow up to #17254 which upgraded to singular 4:

The linking order for Singular libraries is determined by `pkgconfig` which gives

```
-lomalloc -lSingular -lpolys -lfactory -lresources
```
This does not look that right.

This is because `pkgconfig` uses sets that don't preserve the order of libraries (and include directories or macros etc...).

A solution is to migrate `pkgconfig`  from sets to list.

https://github.com/matze/pkgconfig/issues/10 

has been opened upstream to explain the rational, along with a pull request to implement it at 

https://github.com/matze/pkgconfig/pull/11

This has now been accepted upstream and is part of a new release with a few other fixes.

**Tarball**: [https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)

Branch: **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Jeroen Demeyer**

Author: **FranÃ§ois Bissey**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/21625_





---

archive/issue_events_300961.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-10-03T10:05:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300961"
}
```



---

archive/issue_events_300962.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-10-03T10:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300962"
}
```



---

archive/issue_events_300963.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-10-03T10:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300963"
}
```



---

archive/issue_events_300964.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-10-03T10:05:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300964"
}
```



---

archive/issue_events_300965.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:09:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "title_is": "Strange linking order for omalloc",
    "title_was": "Starnge linking order for omalloc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300965"
}
```



---

archive/issue_comments_317751.json:
```json
{
    "body": "Replying to [ticket:21625 jpflori]:\n> This is a follow up to #17254 which upgraded to singular 4:\n> \n> * strange linking order (omalloc comes before singular!) \n\nYou mean during the build of Singular itself or Sage modules using Singular?",
    "created_at": "2016-10-21T08:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317751",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:21625 jpflori]:
> This is a follow up to #17254 which upgraded to singular 4:
> 
> * strange linking order (omalloc comes before singular!) 

You mean during the build of Singular itself or Sage modules using Singular?



---

archive/issue_comments_317752.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSee [#17254 comment:510](https://github.com/sagemath/sage/issues/17254#comment:510) :\n\"\"\"\nDuring linking some Sage files I see -lomalloc -lSingular -lpolys -lfactory -lresources which does not look that right.\n\"\"\"",
    "created_at": "2016-10-21T08:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317752",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:2" align="right">comment:2</div>

See [#17254 comment:510](https://github.com/sagemath/sage/issues/17254#comment:510) :
"""
During linking some Sage files I see -lomalloc -lSingular -lpolys -lfactory -lresources which does not look that right.
"""



---

archive/issue_events_300966.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:16:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300966"
}
```



---

archive/issue_events_300967.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-10-21T08:16:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300967"
}
```



---

archive/issue_comments_317753.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n This is a follow up to #17254 which upgraded to singular 4:\n \n-* strange linking order (omalloc comes before singular!) \n+The linking order for Singular libraries is determined by `pkgconfig` which gives\n+\n+```\n+-lomalloc -lSingular -lpolys -lfactory -lresources\n+```\n+This does not look that right.\n``````\n",
    "created_at": "2016-10-21T08:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317753",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
 This is a follow up to #17254 which upgraded to singular 4:
 
-* strange linking order (omalloc comes before singular!) 
+The linking order for Singular libraries is determined by `pkgconfig` which gives
+
+```
+-lomalloc -lSingular -lpolys -lfactory -lresources
+```
+This does not look that right.
``````




---

archive/issue_comments_317754.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThat's an annoying defect that I have noticed before in the python interface to pkg-config. The libraries are put in a set and of course it is not preserving the order. It was already evident when using ATLAS for blas/lapack.\n\n```\n$ pkg-config --libs Singular\n-lSingular -ldl -lpolys -lflint -lmpfr -lntl -lgmp -ldl -lfactory -lflint -lmpfr -lntl -lgmp -lomalloc -lresources \n```\nbut\n\n```\n$ python\nPython 2.7.10 (default, Jun 12 2016, 19:30:46) \n[GCC 5.3.0] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import pkgconfig\n>>> singular_pc = pkgconfig.parse('Singular')\n>>> list(singular_pc['libraries'])\n[u'omalloc', u'dl', u'Singular', u'polys', u'factory', u'flint', u'ntl', u'gmp', u'resources', u'mpfr']\n>>> singular_pc['libraries']\nset([u'omalloc', u'dl', u'Singular', u'polys', u'factory', u'flint', u'ntl', u'gmp', u'resources', u'mpfr'])\n```\nwhich is what you are seeing. If you still have a sage with ATLAS somewhere look at what you get for lapack. This needs to be fixed upstream so that something preserving the order is used instead of a set.",
    "created_at": "2016-10-23T08:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317754",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

That's an annoying defect that I have noticed before in the python interface to pkg-config. The libraries are put in a set and of course it is not preserving the order. It was already evident when using ATLAS for blas/lapack.

```
$ pkg-config --libs Singular
-lSingular -ldl -lpolys -lflint -lmpfr -lntl -lgmp -ldl -lfactory -lflint -lmpfr -lntl -lgmp -lomalloc -lresources 
```
but

```
$ python
Python 2.7.10 (default, Jun 12 2016, 19:30:46) 
[GCC 5.3.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import pkgconfig
>>> singular_pc = pkgconfig.parse('Singular')
>>> list(singular_pc['libraries'])
[u'omalloc', u'dl', u'Singular', u'polys', u'factory', u'flint', u'ntl', u'gmp', u'resources', u'mpfr']
>>> singular_pc['libraries']
set([u'omalloc', u'dl', u'Singular', u'polys', u'factory', u'flint', u'ntl', u'gmp', u'resources', u'mpfr'])
```
which is what you are seeing. If you still have a sage with ATLAS somewhere look at what you get for lapack. This needs to be fixed upstream so that something preserving the order is used instead of a set.



---

archive/issue_comments_317755.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIs this upstream:\n* https://github.com/matze/pkgconfig\n?\n\nIt does not look very active, last release was three years ago.",
    "created_at": "2016-10-25T12:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317755",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:5" align="right">comment:5</div>

Is this upstream:
* https://github.com/matze/pkgconfig
?

It does not look very active, last release was three years ago.



---

archive/issue_comments_317756.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDebian also thinks that is the homepage, yes.",
    "created_at": "2016-11-12T18:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317756",
    "user": "https://github.com/infinity0"
}
```

<div id="comment:6" align="right">comment:6</div>

Debian also thinks that is the homepage, yes.



---

archive/issue_comments_317757.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWell `pkg-config` is relatively stable. The nice thing about the set is of course that you don't have repeated elements in it. Is there an \"ordered set\" type in python?",
    "created_at": "2016-11-12T18:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317757",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

Well `pkg-config` is relatively stable. The nice thing about the set is of course that you don't have repeated elements in it. Is there an "ordered set" type in python?



---

archive/issue_comments_317758.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAfter a bit of googling I think upstream should either depend from an \"ordered set\" package or switch to a dictionary of list instead of a dictionary of set and then remove duplication.",
    "created_at": "2016-11-12T20:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317758",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

After a bit of googling I think upstream should either depend from an "ordered set" package or switch to a dictionary of list instead of a dictionary of set and then remove duplication.



---

archive/issue_comments_317759.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI have been working on making `pkgconfig` use lists instead of sets and then doing some deduplication. \n\nThere are two issues with deduplication - which was originally achieved by using sets:\n* Is it really necessary, that makes longer lines but `pkg-config` doesn't do it in the first place. Which brings us to second issue\n* Currently the first instance of everything is kept. Not a problem for macros, may be for include directories and library directories. Definitely a potential problem for libraries.\n\nI don't think deduplication - potentially from the end of the list rather than the beginning of it, is worth it.\n\nOpinion?",
    "created_at": "2016-11-14T01:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317759",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

I have been working on making `pkgconfig` use lists instead of sets and then doing some deduplication. 

There are two issues with deduplication - which was originally achieved by using sets:
* Is it really necessary, that makes longer lines but `pkg-config` doesn't do it in the first place. Which brings us to second issue
* Currently the first instance of everything is kept. Not a problem for macros, may be for include directories and library directories. Definitely a potential problem for libraries.

I don't think deduplication - potentially from the end of the list rather than the beginning of it, is worth it.

Opinion?



---

archive/issue_comments_317760.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI agree with Fran\u00e7ois: we shouldn't be smarter than necessary. There is nothing wrong with longer command lines (as long as it's not excessive).",
    "created_at": "2016-11-14T07:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317760",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

I agree with FranÃ§ois: we shouldn't be smarter than necessary. There is nothing wrong with longer command lines (as long as it's not excessive).



---

archive/issue_comments_317761.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOK, I definitely think it is not worth the bother so I'll probably go with this branch for my upstream pull request https://github.com/kiwifb/pkgconfig/tree/listify. If anyone wants to comment, now is the time.",
    "created_at": "2016-11-14T20:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317761",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

OK, I definitely think it is not worth the bother so I'll probably go with this branch for my upstream pull request https://github.com/kiwifb/pkgconfig/tree/listify. If anyone wants to comment, now is the time.



---

archive/issue_comments_317762.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nUpstream accepted my change, hopefully that will come with a new release soon. I did some experiments, while we will be able to simplify sage's code to populate the various variables `*_{libs,library_dirs,include_dir}` it should work out of the box without modification (haven't checked cflags actually).",
    "created_at": "2016-11-16T10:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317762",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">comment:12</div>

Upstream accepted my change, hopefully that will come with a new release soon. I did some experiments, while we will be able to simplify sage's code to populate the various variables `*_{libs,library_dirs,include_dir}` it should work out of the box without modification (haven't checked cflags actually).



---

archive/issue_comments_317763.json:
```json
{
    "body": "Upstream: **Fixed upstream, but not in a stable release.**",
    "created_at": "2016-11-16T20:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317763",
    "user": "https://github.com/kiwifb"
}
```

Upstream: **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_317764.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNot sure when upstream will cut a release, should we patch in the meantime?",
    "created_at": "2016-11-16T20:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317764",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

Not sure when upstream will cut a release, should we patch in the meantime?



---

archive/issue_comments_317765.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI say we patch.",
    "created_at": "2016-11-17T13:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317765",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:14" align="right">comment:14</div>

I say we patch.



---

archive/issue_comments_317766.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWorking on this. Some adjustments are needed in `modules_list.py`.",
    "created_at": "2016-11-22T22:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317766",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

Working on this. Some adjustments are needed in `modules_list.py`.



---

archive/issue_comments_317767.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nNow ready for review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d4de4a9ee44c5d813a6031b93cd882c598af3ba\"><code>9d4de4a</code></a></td><td><code>Add https://github.com/matze/pkgconfig/pull/11</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65a1d2a379b2fe16f09c598153cae5544d13da15\"><code>65a1d2a</code></a></td><td><code>migrating numpy helper script to use list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8\"><code>0accd59</code></a></td><td><code>migrate module_list.py to use list from pkgconfig</code></td></tr></table>\n",
    "created_at": "2016-11-22T23:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317767",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">comment:16</div>

Now ready for review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d4de4a9ee44c5d813a6031b93cd882c598af3ba"><code>9d4de4a</code></a></td><td><code>Add https://github.com/matze/pkgconfig/pull/11</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65a1d2a379b2fe16f09c598153cae5544d13da15"><code>65a1d2a</code></a></td><td><code>migrating numpy helper script to use list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8"><code>0accd59</code></a></td><td><code>migrate module_list.py to use list from pkgconfig</code></td></tr></table>




---

archive/issue_events_300968.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-11-22T23:51:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300968"
}
```



---

archive/issue_comments_317768.json:
```json
{
    "body": "Commit: **[`0accd59`](https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8)**",
    "created_at": "2016-11-22T23:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317768",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[`0accd59`](https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8)**



---

archive/issue_comments_317769.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2016-11-22T23:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317769",
    "user": "https://github.com/kiwifb"
}
```

Author: **FranÃ§ois Bissey**



---

archive/issue_comments_317770.json:
```json
{
    "body": "Branch: **[u/fbissey/pkgconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pkgconfig)**",
    "created_at": "2016-11-22T23:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317770",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/pkgconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pkgconfig)**



---

archive/issue_events_300969.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-23T07:11:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300969"
}
```



---

archive/issue_events_300970.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-23T07:11:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300970"
}
```



---

archive/issue_comments_317771.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor reference, please add a link to the upstream ticket in the patch file and in the ticket description.",
    "created_at": "2016-11-23T07:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317771",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

For reference, please add a link to the upstream ticket in the patch file and in the ticket description.



---

archive/issue_comments_317772.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,16 @@\n -lomalloc -lSingular -lpolys -lfactory -lresources\n ```\n This does not look that right.\n+\n+This is because `pkgconfig` uses sets that don't preserve the order of libraries (and include directories or macros etc...).\n+\n+A solution is to migrate `pkgconfig`  from sets to list.\n+\n+https://github.com/matze/pkgconfig/issues/10 \n+\n+has been opened upstream to explain the rational, along with a pull request to implement it at \n+\n+https://github.com/matze/pkgconfig/pull/11\n+\n+This has now been accepted upstream but is not part of a release yet.\n+\n``````\n",
    "created_at": "2016-11-24T20:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317772",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,16 @@
 -lomalloc -lSingular -lpolys -lfactory -lresources
 ```
 This does not look that right.
+
+This is because `pkgconfig` uses sets that don't preserve the order of libraries (and include directories or macros etc...).
+
+A solution is to migrate `pkgconfig`  from sets to list.
+
+https://github.com/matze/pkgconfig/issues/10 
+
+has been opened upstream to explain the rational, along with a pull request to implement it at 
+
+https://github.com/matze/pkgconfig/pull/11
+
+This has now been accepted upstream but is not part of a release yet.
+
``````




---

archive/issue_comments_317773.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf\"><code>07b5632</code></a></td><td><code>Add upstream information to the patch</code></td></tr></table>\n",
    "created_at": "2016-11-24T20:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317773",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf"><code>07b5632</code></a></td><td><code>Add upstream information to the patch</code></td></tr></table>




---

archive/issue_comments_317774.json:
```json
{
    "body": "Changed commit from **[`0accd59`](https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8)** to **[`07b5632`](https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf)**",
    "created_at": "2016-11-24T20:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317774",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0accd59`](https://github.com/sagemath/sagetrac-mirror/commit/0accd599126af79c272238689343bddcc45637c8)** to **[`07b5632`](https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf)**



---

archive/issue_comments_317775.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHope it is satisfactory.",
    "created_at": "2016-11-24T20:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317775",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

Hope it is satisfactory.



---

archive/issue_events_300971.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-11-24T20:44:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300971"
}
```



---

archive/issue_events_300972.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-11-24T20:44:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300972"
}
```



---

archive/issue_comments_317776.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWould it make sense to bump the Singular version to force a rebuild with the new `pkgconfig`?",
    "created_at": "2016-11-25T06:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317776",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Would it make sense to bump the Singular version to force a rebuild with the new `pkgconfig`?



---

archive/issue_comments_317777.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI guess so, of course we need to bump `singular` one way or another before 7.5 is released. But I can easily add a commit here and have the singular ticket depend on it.",
    "created_at": "2016-11-25T06:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317777",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

I guess so, of course we need to bump `singular` one way or another before 7.5 is released. But I can easily add a commit here and have the singular ticket depend on it.



---

archive/issue_events_300973.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-25T09:46:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "title_is": "Strange linking order for omalloc due to pkgconfig bug",
    "title_was": "Strange linking order for omalloc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300973"
}
```



---

archive/issue_comments_317778.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-11-25T09:46:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317778",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_317779.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kiwifb](#comment:22):\n> I guess so, of course we need to bump `singular` one way or another before 7.5 is released. But I can easily add a commit here and have the singular ticket depend on it.\n\nOn second thought, the problem is really in `pkgconfig` (the Python package) which simply reads the system `.pc` files. So there is no need to regenerate the `.pc` files. So no further action is needed I guess.\n\nI am now going to do a complete build from scratch with this ticket and see if it works...",
    "created_at": "2016-11-25T09:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317779",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kiwifb](#comment:22):
> I guess so, of course we need to bump `singular` one way or another before 7.5 is released. But I can easily add a commit here and have the singular ticket depend on it.

On second thought, the problem is really in `pkgconfig` (the Python package) which simply reads the system `.pc` files. So there is no need to regenerate the `.pc` files. So no further action is needed I guess.

I am now going to do a complete build from scratch with this ticket and see if it works...



---

archive/issue_comments_317780.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis seems to break building scipy, log attached.",
    "created_at": "2016-11-26T09:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317780",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

This seems to break building scipy, log attached.



---

archive/issue_comments_317781.json:
```json
{
    "body": "Attachment: **[scipy-0.17.1.p0.log](https://github.com/sagemath/sage/files/ticket21625/scipy-0.17.1.p0.log)**\n\nLog of failed scipy build",
    "created_at": "2016-11-26T09:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317781",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[scipy-0.17.1.p0.log](https://github.com/sagemath/sage/files/ticket21625/scipy-0.17.1.p0.log)**

Log of failed scipy build



---

archive/issue_events_300974.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-26T09:14:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300974"
}
```



---

archive/issue_events_300975.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-26T09:14:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300975"
}
```



---

archive/issue_comments_317782.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nHum, I can reproduce it. It is triggered by the `site.cfg` generated for `numpy` (installed at `local/lib/python2.7/site-packages/numpy/distutils/site.cfg`). There is now a repetition of `openblas` for `blas_libs` and that seems to be the issue strangely enough (it should be able to take more than one library).",
    "created_at": "2016-11-26T09:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317782",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">comment:27</div>

Hum, I can reproduce it. It is triggered by the `site.cfg` generated for `numpy` (installed at `local/lib/python2.7/site-packages/numpy/distutils/site.cfg`). There is now a repetition of `openblas` for `blas_libs` and that seems to be the issue strangely enough (it should be able to take more than one library).



---

archive/issue_comments_317783.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk `pkgconfig` (python) does another thing that's weird compared to `pkg-config`. I can do this\n\n```\n(sage-sh) fbissey@QCD-nzi3:sage$ pkg-config --libs blas cblas\n-L/home/fbissey/sandbox/git-fork/sage/local/lib -lopenblas \n```\nbut `pkgconfig` (python) will do two calls to `pkg-config` and add them together. Of course with sets that wasn't visible. In any case we should be able to survive with just `blas` in `numpy`'s `site.cfg`. I am not sure why Gentoo insists on both - possibly historical reasons.",
    "created_at": "2016-11-26T09:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317783",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok `pkgconfig` (python) does another thing that's weird compared to `pkg-config`. I can do this

```
(sage-sh) fbissey@QCD-nzi3:sage$ pkg-config --libs blas cblas
-L/home/fbissey/sandbox/git-fork/sage/local/lib -lopenblas 
```
but `pkgconfig` (python) will do two calls to `pkg-config` and add them together. Of course with sets that wasn't visible. In any case we should be able to survive with just `blas` in `numpy`'s `site.cfg`. I am not sure why Gentoo insists on both - possibly historical reasons.



---

archive/issue_comments_317784.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b\"><code>9dd50b6</code></a></td><td><code>Only query blas for numpy's and scipy's site.cfg</code></td></tr></table>\n",
    "created_at": "2016-11-26T09:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317784",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b"><code>9dd50b6</code></a></td><td><code>Only query blas for numpy's and scipy's site.cfg</code></td></tr></table>




---

archive/issue_comments_317785.json:
```json
{
    "body": "Changed commit from **[`07b5632`](https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf)** to **[`9dd50b6`](https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b)**",
    "created_at": "2016-11-26T09:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317785",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`07b5632`](https://github.com/sagemath/sagetrac-mirror/commit/07b5632ab1be45ca816b1396105bfc98743460bf)** to **[`9dd50b6`](https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b)**



---

archive/issue_comments_317786.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nYou'll need to rebuild `numpy` before `scipy` for the fix to work.",
    "created_at": "2016-11-26T09:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317786",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

You'll need to rebuild `numpy` before `scipy` for the fix to work.



---

archive/issue_events_300976.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-11-26T09:59:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300976"
}
```



---

archive/issue_events_300977.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-11-26T09:59:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300977"
}
```



---

archive/issue_comments_317787.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI don't really like that fix. It should not be a problem to have `-lopenblas -lopenblas` in the libraries.",
    "created_at": "2016-11-26T11:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317787",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

I don't really like that fix. It should not be a problem to have `-lopenblas -lopenblas` in the libraries.



---

archive/issue_comments_317788.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI would have to dig inside `numpy`. That's where the problem is, really. But it could need a mirror fix in `scipy`. I think it would be better to go back to `pkgconfig`and add a patch to make its output more consistent, both internally and with `pkg-config`. That wouldn't do anything for `numpy`/`scipy` setup problem of course.",
    "created_at": "2016-11-26T19:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317788",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

I would have to dig inside `numpy`. That's where the problem is, really. But it could need a mirror fix in `scipy`. I think it would be better to go back to `pkgconfig`and add a patch to make its output more consistent, both internally and with `pkg-config`. That wouldn't do anything for `numpy`/`scipy` setup problem of course.



---

archive/issue_comments_317789.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nPlease bump the numpy version number since the change you make is non-trivial.",
    "created_at": "2016-11-26T20:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317789",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Please bump the numpy version number since the change you make is non-trivial.



---

archive/issue_comments_317790.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWas thinking about that. I am not satisfied with the branch as it is anyway. I will hammer some more on `pkgconfig` side with another pull upstream as soon as I can. I'll probably revert my last commit but even so it is probably best if `numpy` is bumped as well.",
    "created_at": "2016-11-26T20:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317790",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">comment:34</div>

Was thinking about that. I am not satisfied with the branch as it is anyway. I will hammer some more on `pkgconfig` side with another pull upstream as soon as I can. I'll probably revert my last commit but even so it is probably best if `numpy` is bumped as well.



---

archive/issue_events_300978.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-26T20:34:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300978"
}
```



---

archive/issue_events_300979.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-11-26T20:34:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300979"
}
```



---

archive/issue_comments_317791.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIf you cannot immediately fix the real issue, it's OK for me to merge this hack as-is.\n\nI'm setting it back to needs_work because you still want to work on it.",
    "created_at": "2016-11-26T20:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317791",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

If you cannot immediately fix the real issue, it's OK for me to merge this hack as-is.

I'm setting it back to needs_work because you still want to work on it.



---

archive/issue_comments_317792.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI have pushed a few more things upstream and requested a release.  The changes I sent upstream makes my last commit unnecessary, so at the very least I'll retract it. If upstream makes a new release, I'll update the package instead of adding more patches.",
    "created_at": "2016-11-29T23:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317792",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">comment:36</div>

I have pushed a few more things upstream and requested a release.  The changes I sent upstream makes my last commit unnecessary, so at the very least I'll retract it. If upstream makes a new release, I'll update the package instead of adding more patches.



---

archive/issue_comments_317793.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/971c9d47a1985dcf201d4108f29495fd241a942d\"><code>971c9d4</code></a></td><td><code>upgrade pkgconfig to 1.2.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f\"><code>b03524b</code></a></td><td><code>migrate to list as used by the new pkgconfig 1.2.2.</code></td></tr></table>\n",
    "created_at": "2016-12-03T20:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317793",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/971c9d47a1985dcf201d4108f29495fd241a942d"><code>971c9d4</code></a></td><td><code>upgrade pkgconfig to 1.2.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f"><code>b03524b</code></a></td><td><code>migrate to list as used by the new pkgconfig 1.2.2.</code></td></tr></table>




---

archive/issue_comments_317794.json:
```json
{
    "body": "Changed commit from **[`9dd50b6`](https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b)** to **[`b03524b`](https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f)**",
    "created_at": "2016-12-03T20:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317794",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9dd50b6`](https://github.com/sagemath/sagetrac-mirror/commit/9dd50b6a72f15f173bac66720fc77e10c4ee087b)** to **[`b03524b`](https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f)**



---

archive/issue_comments_317795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,5 +17,8 @@\n \n https://github.com/matze/pkgconfig/pull/11\n \n-This has now been accepted upstream but is not part of a release yet.\n+This has now been accepted upstream and is part of a new release with a few other fixes.\n+New tarball from pypi\n+[https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)\n \n+\n``````\n",
    "created_at": "2016-12-03T20:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317795",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,5 +17,8 @@
 
 https://github.com/matze/pkgconfig/pull/11
 
-This has now been accepted upstream but is not part of a release yet.
+This has now been accepted upstream and is part of a new release with a few other fixes.
+New tarball from pypi
+[https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)
 
+
``````




---

archive/issue_events_300980.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-03T20:20:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300980"
}
```



---

archive/issue_events_300981.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-03T20:20:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300981"
}
```



---

archive/issue_comments_317796.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOK, new release from upstream with all fixes included. Now the output is list, which keep the order, and is also strictly mirroring the output of the equivalent `pkg-config` command. The extra 2 minor releases are for various fixes to the tests that we don't use in sage but are important for me in Gentoo since I do run `nose` tests.",
    "created_at": "2016-12-03T20:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317796",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">comment:38</div>

OK, new release from upstream with all fixes included. Now the output is list, which keep the order, and is also strictly mirroring the output of the equivalent `pkg-config` command. The extra 2 minor releases are for various fixes to the tests that we don't use in sage but are important for me in Gentoo since I do run `nose` tests.



---

archive/issue_comments_317797.json:
```json
{
    "body": "Changed upstream from **Fixed upstream, but not in a stable release.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2016-12-03T20:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317797",
    "user": "https://github.com/kiwifb"
}
```

Changed upstream from **Fixed upstream, but not in a stable release.** to **Fixed upstream, in a later stable release.**



---

archive/issue_events_300982.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T13:14:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300982"
}
```



---

archive/issue_events_300983.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-04T13:14:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300983"
}
```



---

archive/issue_comments_317798.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n[comment:33]",
    "created_at": "2016-12-04T13:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317798",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

[comment:33]



---

archive/issue_comments_317799.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nAll right, I'll do that ASAP.",
    "created_at": "2016-12-04T18:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317799",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">comment:40</div>

All right, I'll do that ASAP.



---

archive/issue_comments_317800.json:
```json
{
    "body": "Changed commit from **[`b03524b`](https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f)** to **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**",
    "created_at": "2016-12-04T20:08:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317800",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b03524b`](https://github.com/sagemath/sagetrac-mirror/commit/b03524b653cde297552f7f34c3b7522b4ccd013f)** to **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**



---

archive/issue_comments_317801.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1\"><code>bd61fc4</code></a></td><td><code>bump numpy's version to make sure it rebuilds</code></td></tr></table>\n",
    "created_at": "2016-12-04T20:08:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317801",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1"><code>bd61fc4</code></a></td><td><code>bump numpy's version to make sure it rebuilds</code></td></tr></table>




---

archive/issue_events_300984.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-04T20:08:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300984"
}
```



---

archive/issue_events_300985.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-04T20:08:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300985"
}
```



---

archive/issue_comments_317802.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nDone.",
    "created_at": "2016-12-04T20:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317802",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">comment:42</div>

Done.



---

archive/issue_comments_317803.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,7 +18,5 @@\n https://github.com/matze/pkgconfig/pull/11\n \n This has now been accepted upstream and is part of a new release with a few other fixes.\n-New tarball from pypi\n-[https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)\n \n-\n+**Tarball**: [https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)\n``````\n",
    "created_at": "2016-12-06T11:02:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317803",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,7 +18,5 @@
 https://github.com/matze/pkgconfig/pull/11
 
 This has now been accepted upstream and is part of a new release with a few other fixes.
-New tarball from pypi
-[https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)
 
-
+**Tarball**: [https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz](https://pypi.python.org/packages/9d/ba/80910bbed2b4e646a6adab4474d2e506744c260c7002a0e6b41ef8750d8d/pkgconfig-1.2.2.tar.gz)
``````




---

archive/issue_events_300986.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-06T14:56:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300986"
}
```



---

archive/issue_events_300987.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-06T14:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300987"
}
```



---

archive/issue_events_300988.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-07T23:29:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300988"
}
```



---

archive/issue_events_300989.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d0e3225c25a290509c56a1be7a79e417c180413e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-12-07T23:29:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21625#event-300989"
}
```



---

archive/issue_comments_317804.json:
```json
{
    "body": "Changed branch from **[u/fbissey/pkgconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pkgconfig)** to **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**",
    "created_at": "2016-12-07T23:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317804",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/pkgconfig](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/pkgconfig)** to **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)**



---

archive/issue_comments_317805.json:
```json
{
    "body": "Changed commit from **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)** to none",
    "created_at": "2016-12-11T20:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317805",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`bd61fc4`](https://github.com/sagemath/sagetrac-mirror/commit/bd61fc49a33cb0c3c764ba15c0262d344b2e78a1)** to none



---

archive/issue_comments_317806.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nBreakage: #22047",
    "created_at": "2016-12-11T20:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21625#issuecomment-317806",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Breakage: #22047
