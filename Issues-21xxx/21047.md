# Issue 21047: "sage -i autotools" fails because libtool 2.4.3 requires xz

archive/issues_020810.json:
```json
{
    "body": "`sage -i autotools` results in this error. In a parallel build, one is left with a nondeterministic collection of installed autotools versions. \n\n```\nexport MAKE='make -j12 -j1' ; \\\n\texport AUTOCONF_VERSION=2.62 ; \\\n\texport AUTOMAKE_VERSION=1.11.1 ; \\\n\tcd libtool-2.4.3 && bash bootstrap --skip-git --skip-po --gnulib-srcdir=../../src/gnulib && \\\n\t    ./configure --prefix=\"/Users/mkoeppe/cvs/sage/local/libtool-2.4.3\" && \\\n\t    $MAKE && $MAKE install\nbootstrap:   error: Prerequisite 'xz' not found. Please install it, or\nbootstrap:          'export XZ=/path/to/xz'.\nbootstrap:   error: HACKING explains how to obtain these prerequisite programs:\nbootstrap:          Program    Min_version Homepage                            \nbootstrap:          -----------------------------------------------------------\nbootstrap:          help2man   1.29        http://www.gnu.org/s/help2man       \nbootstrap:          make       3.81        http://www.gnu.org/s/make           \nbootstrap:          makeinfo   4.8         http://www.gnu.org/s/texinfo        \nbootstrap:          xz         4.999.8beta http://tukaani.org/xz               \nbootstrap:          autoconf   2.62        http://www.gnu.org/s/autoconf       \nbootstrap:          automake   1.11.1      http://www.gnu.org/s/automake       \nbootstrap:          -----------------------------------------------------------\nmake: *** [/Users/mkoeppe/cvs/sage/local/libtool-2.4.3] Error 1\n```\n\nCC:  jpflori @jdemeyer @vbraun felixs @nexttime @dimpase\n\nBranch/Commit: 789437568284ba3dfe3f9e4d4526eaeb8a186f9f\n\nReviewer: Jeroen Demeyer, Volker Braun\n\nAuthor: Matthias Koeppe\n\nDependencies: #21063\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21047\n\n",
    "closed_at": "2016-09-04T22:07:51Z",
    "created_at": "2016-07-18T09:58:34Z",
    "labels": [
        "component: packages: experimental",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "\"sage -i autotools\" fails because libtool 2.4.3 requires xz",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21047",
    "user": "https://github.com/mkoeppe"
}
```
`sage -i autotools` results in this error. In a parallel build, one is left with a nondeterministic collection of installed autotools versions. 

```
export MAKE='make -j12 -j1' ; \
	export AUTOCONF_VERSION=2.62 ; \
	export AUTOMAKE_VERSION=1.11.1 ; \
	cd libtool-2.4.3 && bash bootstrap --skip-git --skip-po --gnulib-srcdir=../../src/gnulib && \
	    ./configure --prefix="/Users/mkoeppe/cvs/sage/local/libtool-2.4.3" && \
	    $MAKE && $MAKE install
bootstrap:   error: Prerequisite 'xz' not found. Please install it, or
bootstrap:          'export XZ=/path/to/xz'.
bootstrap:   error: HACKING explains how to obtain these prerequisite programs:
bootstrap:          Program    Min_version Homepage                            
bootstrap:          -----------------------------------------------------------
bootstrap:          help2man   1.29        http://www.gnu.org/s/help2man       
bootstrap:          make       3.81        http://www.gnu.org/s/make           
bootstrap:          makeinfo   4.8         http://www.gnu.org/s/texinfo        
bootstrap:          xz         4.999.8beta http://tukaani.org/xz               
bootstrap:          autoconf   2.62        http://www.gnu.org/s/autoconf       
bootstrap:          automake   1.11.1      http://www.gnu.org/s/automake       
bootstrap:          -----------------------------------------------------------
make: *** [/Users/mkoeppe/cvs/sage/local/libtool-2.4.3] Error 1
```

CC:  jpflori @jdemeyer @vbraun felixs @nexttime @dimpase

Branch/Commit: 789437568284ba3dfe3f9e4d4526eaeb8a186f9f

Reviewer: Jeroen Demeyer, Volker Braun

Author: Matthias Koeppe

Dependencies: #21063

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21047





---

archive/issue_comments_384817.json:
```json
{
    "body": "<a id='comment:2'></a>#21063 adds the required xz package.\nBut next it runs into a problem with the old gm4 on Mac OS X.\n\n```\nbootstrap: running: autoreconf --symlink --install\nmain::scan_file() called too early to check prototype at /Users/mkoeppe/cvs/sage/local/automake-1.11.1/bin/aclocal line 617.\nm4/ltversion.m4:12: warning: ill-formed serial number `ltversion.m4', expecting a version string with only digits and dots\n/Library/Developer/CommandLineTools/usr/bin/gm4: unrecognized option `--debugfile=autom4te.cache/traces.0t'\nTry `/Library/Developer/CommandLineTools/usr/bin/gm4 --help' for more information.\nautom4te: gm4 failed with exit status: 1\n```",
    "created_at": "2016-07-20T15:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>#21063 adds the required xz package.
But next it runs into a problem with the old gm4 on Mac OS X.

```
bootstrap: running: autoreconf --symlink --install
main::scan_file() called too early to check prototype at /Users/mkoeppe/cvs/sage/local/automake-1.11.1/bin/aclocal line 617.
m4/ltversion.m4:12: warning: ill-formed serial number `ltversion.m4', expecting a version string with only digits and dots
/Library/Developer/CommandLineTools/usr/bin/gm4: unrecognized option `--debugfile=autom4te.cache/traces.0t'
Try `/Library/Developer/CommandLineTools/usr/bin/gm4 --help' for more information.
autom4te: gm4 failed with exit status: 1
```



---

archive/issue_comments_384818.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#21063\"",
    "created_at": "2016-07-20T15:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384818",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#21063"



---

archive/issue_comments_384819.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/_sage__i_autotools__fails_because_libtool_2_4_3_requires_xz\"",
    "created_at": "2016-07-20T15:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384819",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/_sage__i_autotools__fails_because_libtool_2_4_3_requires_xz"



---

archive/issue_comments_384820.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2016-07-20T15:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384820",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_384821.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-20T15:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384821",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384822.json:
```json
{
    "body": "Changing commit from \"\" to \"d70e85813f155bae6c1f0d9c37af8bd0b8c4c386\"",
    "created_at": "2016-07-20T15:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384822",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "d70e85813f155bae6c1f0d9c37af8bd0b8c4c386"



---

archive/issue_comments_384823.json:
```json
{
    "body": "<a id='comment:4'></a>Now it works. Needs review.\n\n---\nNew commits:",
    "created_at": "2016-07-20T15:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384823",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Now it works. Needs review.

---
New commits:



---

archive/issue_comments_384824.json:
```json
{
    "body": "<a id='comment:5'></a>An unrelated issue with autotools that should be fixed as well. \nThe package should actually install links \"aclocal-VERSION\" and \"automake-VERSION\" (actually `am__api_version`) to `$SAGE_LOCAL/bin`. For example, 1.14.1 and 1.14 have the same `am__api_version` (1.14). So we need to pick the better one I guess. \n\n(This is so that maintainer-mode Makefile targets which call automake work. )",
    "created_at": "2016-07-21T22:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384824",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>An unrelated issue with autotools that should be fixed as well. 
The package should actually install links "aclocal-VERSION" and "automake-VERSION" (actually `am__api_version`) to `$SAGE_LOCAL/bin`. For example, 1.14.1 and 1.14 have the same `am__api_version` (1.14). So we need to pick the better one I guess. 

(This is so that maintainer-mode Makefile targets which call automake work. )



---

archive/issue_comments_384825.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2016-07-22T07:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384825",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_384826.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-22T07:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384826",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_384827.json:
```json
{
    "body": "<a id='comment:6'></a>What's this???\n\n```\n# System m4 from Mac OS X 10.11.5 is too old to bootstrap libtool 1.4.3\nexport M4=\"$SAGE_LOCAL/bin/m4\"\n```\n\nThat `m4` should be the first one found in the `$PATH`, so I really do not see the point.",
    "created_at": "2016-07-22T07:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384827",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>What's this???

```
# System m4 from Mac OS X 10.11.5 is too old to bootstrap libtool 1.4.3
export M4="$SAGE_LOCAL/bin/m4"
```

That `m4` should be the first one found in the `$PATH`, so I really do not see the point.



---

archive/issue_comments_384828.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [jdemeyer](#comment%3A6):\n> What's this???\n> \n> ```\n> # System m4 from Mac OS X 10.11.5 is too old to bootstrap libtool 1.4.3\n> export M4=\"$SAGE_LOCAL/bin/m4\"\n> ```\n> \n> That `m4` should be the first one found in the `$PATH`, so I really do not see the point.\n\n\nThe configure script prefers \"gm4\" to \"m4\". That's why this is necessary.",
    "created_at": "2016-07-22T07:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384828",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Replying to [jdemeyer](#comment%3A6):
> What's this???
> 
> ```
> # System m4 from Mac OS X 10.11.5 is too old to bootstrap libtool 1.4.3
> export M4="$SAGE_LOCAL/bin/m4"
> ```
> 
> That `m4` should be the first one found in the `$PATH`, so I really do not see the point.


The configure script prefers "gm4" to "m4". That's why this is necessary.



---

archive/issue_comments_384829.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A7):\n> The configure script prefers \"gm4\" to \"m4\".\n\n\nPlease add this sentence to a comment in the patch (possibly with some more explanation) and refer to this ticket.",
    "created_at": "2016-07-22T07:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384829",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A7):
> The configure script prefers "gm4" to "m4".


Please add this sentence to a comment in the patch (possibly with some more explanation) and refer to this ticket.



---

archive/issue_comments_384830.json:
```json
{
    "body": "Changing commit from \"d70e85813f155bae6c1f0d9c37af8bd0b8c4c386\" to \"e09aaf37390699e318442506e0262a88a9266896\"",
    "created_at": "2016-07-23T14:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d70e85813f155bae6c1f0d9c37af8bd0b8c4c386" to "e09aaf37390699e318442506e0262a88a9266896"



---

archive/issue_comments_384831.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-23T14:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384832.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-23T14:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384832",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384833.json:
```json
{
    "body": "Changing commit from \"e09aaf37390699e318442506e0262a88a9266896\" to \"ff3f2b31d0bf071ee8828a8038d74082789d2e01\"",
    "created_at": "2016-08-08T23:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e09aaf37390699e318442506e0262a88a9266896" to "ff3f2b31d0bf071ee8828a8038d74082789d2e01"



---

archive/issue_comments_384834.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-08T23:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384835.json:
```json
{
    "body": "Changing commit from \"ff3f2b31d0bf071ee8828a8038d74082789d2e01\" to \"ba06f0e03ce2e7ba03d37c9ad450eee77535d107\"",
    "created_at": "2016-08-09T03:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ff3f2b31d0bf071ee8828a8038d74082789d2e01" to "ba06f0e03ce2e7ba03d37c9ad450eee77535d107"



---

archive/issue_comments_384836.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-09T03:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384837.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [mkoeppe](#comment%3A5):\n> An unrelated issue with autotools that should be fixed as well. \n> The package should actually install links \"aclocal-VERSION\" and \"automake-VERSION\" (actually `am__api_version`) to `$SAGE_LOCAL/bin`. For example, 1.14.1 and 1.14 have the same `am__api_version` (1.14). So we need to pick the better one I guess. \n> \n> (This is so that maintainer-mode Makefile targets which call automake work. )\n\n\nThis is done now.",
    "created_at": "2016-08-09T03:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [mkoeppe](#comment%3A5):
> An unrelated issue with autotools that should be fixed as well. 
> The package should actually install links "aclocal-VERSION" and "automake-VERSION" (actually `am__api_version`) to `$SAGE_LOCAL/bin`. For example, 1.14.1 and 1.14 have the same `am__api_version` (1.14). So we need to pick the better one I guess. 
> 
> (This is so that maintainer-mode Makefile targets which call automake work. )


This is done now.



---

archive/issue_comments_384838.json:
```json
{
    "body": "<a id='comment:14'></a>I have also fixed the installation of libtool's `ltversion.m4`, which was missing the serial number (`.serial`), causing the following warning. \n\n```\nm4/ltversion.m4:12: warning: ill-formed serial number 'ltversion.m4', expecting a version string with only digits and dots\n```",
    "created_at": "2016-08-09T03:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384838",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>I have also fixed the installation of libtool's `ltversion.m4`, which was missing the serial number (`.serial`), causing the following warning. 

```
m4/ltversion.m4:12: warning: ill-formed serial number 'ltversion.m4', expecting a version string with only digits and dots
```



---

archive/issue_comments_384839.json:
```json
{
    "body": "<a id='comment:15'></a>It now works fine for me.\nNeeds review.\n\nFollow-up ticket: #21196 - Upgrade autotools",
    "created_at": "2016-08-09T05:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384839",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>It now works fine for me.
Needs review.

Follow-up ticket: #21196 - Upgrade autotools



---

archive/issue_comments_384840.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-10T07:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384840",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_384841.json:
```json
{
    "body": "<a id='comment:17'></a>Style question: why did you change this part?\n\n```\nsed 's/^/\\t/;' <<EOF\ncd $p-$v && ${bootstrap}\\\\\n    ./configure --prefix=\"\\$(SAGE_LOCAL)/$p-$v\" && \\\\\n    \\$\\$MAKE && \\$\\$MAKE install\n# Remove all files except for the .* files\n[ \"\\$\\$SAGE_KEEP_BUILT_SPKGS\" = yes ] || rm -rf $p-$v/*\nEOF\n```\nI thought it was a very nice way to not have to write too many backslashes....\n\nI think that `spkg-write-makefile` needs more documentation. All the changes that you did are non-trivial and should be documented better. What does `# Fix up for wrong prereq.` mean for example?",
    "created_at": "2016-08-10T07:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384841",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Style question: why did you change this part?

```
sed 's/^/\t/;' <<EOF
cd $p-$v && ${bootstrap}\\
    ./configure --prefix="\$(SAGE_LOCAL)/$p-$v" && \\
    \$\$MAKE && \$\$MAKE install
# Remove all files except for the .* files
[ "\$\$SAGE_KEEP_BUILT_SPKGS" = yes ] || rm -rf $p-$v/*
EOF
```
I thought it was a very nice way to not have to write too many backslashes....

I think that `spkg-write-makefile` needs more documentation. All the changes that you did are non-trivial and should be documented better. What does `# Fix up for wrong prereq.` mean for example?



---

archive/issue_comments_384842.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [jdemeyer](#comment%3A17):\n> Style question: why did you change this part?\n> \n> ```\n> sed 's/^/\\t/;' <<EOF\n> cd $p-$v && ${bootstrap}\\\\\n>     ./configure --prefix=\"\\$(SAGE_LOCAL)/$p-$v\" && \\\\\n>     \\$\\$MAKE && \\$\\$MAKE install\n> # Remove all files except for the .* files\n> [ \"\\$\\$SAGE_KEEP_BUILT_SPKGS\" = yes ] || rm -rf $p-$v/*\n> EOF\n> ```\n> I thought it was a very nice way to not have to write too many backslashes....\n\n\nUnfortunately using '\\t' only works with GNU sed, not with the traditional sed that is available on Mac OS X.\n(See commit message).\n\n> I think that `spkg-write-makefile` needs more documentation. All the changes that you did are non-trivial and should be documented better. \n\n\nOK, I'll add some.\n\n> What does `# Fix up for wrong prereq.` mean for example?\n\n\nIt's a fix for an automake version that has a too low autoconf requirement listed in its source.\nI believe in the current spkg, someone must have fixed this by hand-editing the `Makefile.build`.",
    "created_at": "2016-08-10T08:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384842",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [jdemeyer](#comment%3A17):
> Style question: why did you change this part?
> 
> ```
> sed 's/^/\t/;' <<EOF
> cd $p-$v && ${bootstrap}\\
>     ./configure --prefix="\$(SAGE_LOCAL)/$p-$v" && \\
>     \$\$MAKE && \$\$MAKE install
> # Remove all files except for the .* files
> [ "\$\$SAGE_KEEP_BUILT_SPKGS" = yes ] || rm -rf $p-$v/*
> EOF
> ```
> I thought it was a very nice way to not have to write too many backslashes....


Unfortunately using '\t' only works with GNU sed, not with the traditional sed that is available on Mac OS X.
(See commit message).

> I think that `spkg-write-makefile` needs more documentation. All the changes that you did are non-trivial and should be documented better. 


OK, I'll add some.

> What does `# Fix up for wrong prereq.` mean for example?


It's a fix for an automake version that has a too low autoconf requirement listed in its source.
I believe in the current spkg, someone must have fixed this by hand-editing the `Makefile.build`.



---

archive/issue_comments_384843.json:
```json
{
    "body": "Changing commit from \"ba06f0e03ce2e7ba03d37c9ad450eee77535d107\" to \"afe7062c48cbb75a0e871efa8002eec132837d39\"",
    "created_at": "2016-08-10T08:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ba06f0e03ce2e7ba03d37c9ad450eee77535d107" to "afe7062c48cbb75a0e871efa8002eec132837d39"



---

archive/issue_comments_384844.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-10T08:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384845.json:
```json
{
    "body": "<a id='comment:20'></a>Also: please remove this:\n\n```\n+\t    # Could instead compute the .serial at \"make\" time:\n+\t    #echo -e \"\\tif test ! -f \\\"$p-$v/.serial\\\"; then ( cd \\$(SRC)/$p && git log --pretty=oneline $tag ) |wc -l | sed 's|[\\t ]||g ' > $p-$v/.serial ; fi\"\n```\nIt's only confusing...",
    "created_at": "2016-08-10T08:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384845",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Also: please remove this:

```
+	    # Could instead compute the .serial at "make" time:
+	    #echo -e "\tif test ! -f \"$p-$v/.serial\"; then ( cd \$(SRC)/$p && git log --pretty=oneline $tag ) |wc -l | sed 's|[\t ]||g ' > $p-$v/.serial ; fi"
```
It's only confusing...



---

archive/issue_comments_384846.json:
```json
{
    "body": "Changing commit from \"afe7062c48cbb75a0e871efa8002eec132837d39\" to \"c60f495f900f6082a231003e5474d5f8fb29989c\"",
    "created_at": "2016-08-10T08:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "afe7062c48cbb75a0e871efa8002eec132837d39" to "c60f495f900f6082a231003e5474d5f8fb29989c"



---

archive/issue_comments_384847.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-10T08:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384848.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-10T08:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384848",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384849.json:
```json
{
    "body": "<a id='comment:23'></a>Have you tested this version on OS X? I can test Linux but not OS X.",
    "created_at": "2016-08-10T14:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384849",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>Have you tested this version on OS X? I can test Linux but not OS X.



---

archive/issue_comments_384850.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-08-10T14:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384850",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_384851.json:
```json
{
    "body": "<a id='comment:24'></a>Why do you need the `.serial` files?",
    "created_at": "2016-08-10T14:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384851",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Why do you need the `.serial` files?



---

archive/issue_comments_384852.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [jdemeyer](#comment%3A24):\n> Why do you need the `.serial` files?\n\nSee comment 14 - it's also explained in the comment that I added to `spkg-write-makefile`",
    "created_at": "2016-08-10T14:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [jdemeyer](#comment%3A24):
> Why do you need the `.serial` files?

See comment 14 - it's also explained in the comment that I added to `spkg-write-makefile`



---

archive/issue_comments_384853.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [jdemeyer](#comment%3A23):\n> Have you tested this version on OS X? \n\nYes",
    "created_at": "2016-08-10T15:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Replying to [jdemeyer](#comment%3A23):
> Have you tested this version on OS X? 

Yes



---

archive/issue_comments_384854.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [mkoeppe](#comment%3A25):\n> it's also explained in the comment that I added to `spkg-write-makefile`\n\n\nWell, that comment only explains why that file is missing. Not why it is needed.",
    "created_at": "2016-08-10T15:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384854",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [mkoeppe](#comment%3A25):
> it's also explained in the comment that I added to `spkg-write-makefile`


Well, that comment only explains why that file is missing. Not why it is needed.



---

archive/issue_comments_384855.json:
```json
{
    "body": "Changing commit from \"c60f495f900f6082a231003e5474d5f8fb29989c\" to \"789437568284ba3dfe3f9e4d4526eaeb8a186f9f\"",
    "created_at": "2016-08-10T15:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c60f495f900f6082a231003e5474d5f8fb29989c" to "789437568284ba3dfe3f9e4d4526eaeb8a186f9f"



---

archive/issue_comments_384856.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-10T15:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_384857.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-08-10T15:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384857",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_384858.json:
```json
{
    "body": "<a id='comment:30'></a>enough documentation?",
    "created_at": "2016-08-15T18:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384858",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>enough documentation?



---

archive/issue_comments_384859.json:
```json
{
    "body": "<a id='comment:31'></a>ping?",
    "created_at": "2016-08-28T11:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384859",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>ping?



---

archive/issue_events_056253.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-09-04T00:39:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21047#event-56253"
}
```



---

archive/issue_comments_384860.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-04T08:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384860",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384861.json:
```json
{
    "body": "Changing reviewer from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Volker Braun\"",
    "created_at": "2016-09-04T08:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384861",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "Jeroen Demeyer" to "Jeroen Demeyer, Volker Braun"



---

archive/issue_comments_384862.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-04T22:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384862",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056254.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-04T22:07:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21047#event-56254"
}
```



---

archive/issue_comments_384863.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/_sage__i_autotools__fails_because_libtool_2_4_3_requires_xz\" to \"789437568284ba3dfe3f9e4d4526eaeb8a186f9f\"",
    "created_at": "2016-09-04T22:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21047#issuecomment-384863",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/_sage__i_autotools__fails_because_libtool_2_4_3_requires_xz" to "789437568284ba3dfe3f9e4d4526eaeb8a186f9f"
