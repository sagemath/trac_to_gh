# Issue 21020: gap/libgap polynomial to Sage

archive/issues_020783.json:
```json
{
    "body": "Given a polynomial in gap/libgap it is (most of the time) not possible to get it back into Sage.\n\nNote: the other direction is dealt with in #18266\n\nCC:  @dimpase @tscrim\n\nKeywords: libgap\n\nReviewer: Vincent Delecroix, Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix\n\nBranch: 9437416a316059cf109207397aa35ebeb63f7f6c\n\nDependencies: #27021\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21020\n\n",
    "closed_at": "2019-01-26T15:55:43Z",
    "created_at": "2016-07-13T20:23:45Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "gap/libgap polynomial to Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21020",
    "user": "https://github.com/videlec"
}
```
Given a polynomial in gap/libgap it is (most of the time) not possible to get it back into Sage.

Note: the other direction is dealt with in #18266

CC:  @dimpase @tscrim

Keywords: libgap

Reviewer: Vincent Delecroix, Frédéric Chapoton, Travis Scrimshaw

Author: Frédéric Chapoton, Vincent Delecroix

Branch: 9437416a316059cf109207397aa35ebeb63f7f6c

Dependencies: #27021

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21020





---

archive/issue_comments_286828.json:
```json
{
    "body": "<a id='comment:3'></a>first tentative:\n\n* working conversion of polynomial rings\n\n* not working conversion of polynomials in one variable\n\nI have no idea how to ask Gap for the Ring containing a polynomial..\n\n---\nNew commits:",
    "created_at": "2019-01-03T15:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286828",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>first tentative:

* working conversion of polynomial rings

* not working conversion of polynomials in one variable

I have no idea how to ask Gap for the Ring containing a polynomial..

---
New commits:



---

archive/issue_comments_286829.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 chapoton]:\n> I have no idea how to ask Gap for the Ring containing a polynomial..\n\nif `f` is your polynomial, then\n\n```\ngap> Ring(f);\n```\ndoes what you ask.",
    "created_at": "2019-01-03T16:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286829",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Replying to [comment:3 chapoton]:
> I have no idea how to ask Gap for the Ring containing a polynomial..

if `f` is your polynomial, then

```
gap> Ring(f);
```
does what you ask.



---

archive/issue_events_056204.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-03T17:46:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21020#event-56204"
}
```



---

archive/issue_comments_286830.json:
```json
{
    "body": "<a id='comment:6'></a>Hmm. Not very clear.. Does not look like a polynomial ring..\n\n```\nsage: x=polygen(QQ,'x')\nsage: f=x+6\nsage: g=libgap(f)\nsage: g.Ring()\n<ring with 1 generators>\nsage: g.Ring().IsPolynomialRing()\nfalse\n```",
    "created_at": "2019-01-03T17:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286830",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>Hmm. Not very clear.. Does not look like a polynomial ring..

```
sage: x=polygen(QQ,'x')
sage: f=x+6
sage: g=libgap(f)
sage: g.Ring()
<ring with 1 generators>
sage: g.Ring().IsPolynomialRing()
false
```



---

archive/issue_comments_286831.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-03T19:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286832.json:
```json
{
    "body": "<a id='comment:8'></a>Here is something that seems to work, even if somewhat ugly.",
    "created_at": "2019-01-03T19:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286832",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Here is something that seems to work, even if somewhat ugly.



---

archive/issue_comments_286833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-03T19:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286833",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_056205.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-03T19:30:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21020#event-56205"
}
```



---

archive/issue_events_056206.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-01-03T19:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21020#event-56206"
}
```



---

archive/issue_comments_286834.json:
```json
{
    "body": "Changing keywords from \"\" to \"libgap\".",
    "created_at": "2019-01-03T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286834",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "libgap".



---

archive/issue_comments_286835.json:
```json
{
    "body": "<a id='comment:11'></a>bot is morally green, please review",
    "created_at": "2019-01-04T08:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286835",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>bot is morally green, please review



---

archive/issue_comments_286836.json:
```json
{
    "body": "<a id='comment:12'></a>Dima, do you have any other comments? I am ready to set this to a positive review.",
    "created_at": "2019-01-04T18:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286836",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Dima, do you have any other comments? I am ready to set this to a positive review.



---

archive/issue_comments_286837.json:
```json
{
    "body": "<a id='comment:13'></a>Can we get doctests for multivariate polynomials? And for different base rings?",
    "created_at": "2019-01-05T00:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286837",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Can we get doctests for multivariate polynomials? And for different base rings?



---

archive/issue_comments_286838.json:
```json
{
    "body": "<a id='comment:14'></a>This will not work for multi-variate polynomials so far.",
    "created_at": "2019-01-05T07:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286838",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>This will not work for multi-variate polynomials so far.



---

archive/issue_comments_286839.json:
```json
{
    "body": "<a id='comment:15'></a>1) I think should also be treated at the same time\n- (univariate) rational functions\n- (univariate) laurent polynomials\n\n2) Instead of going through the coercion system in Sage you should just query gap base ring (function [CoefficientsRing](https://www.gap-system.org/Manuals/doc/ref/chap66.html#X8235D10781BE8003)).",
    "created_at": "2019-01-05T08:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286839",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>1) I think should also be treated at the same time
- (univariate) rational functions
- (univariate) laurent polynomials

2) Instead of going through the coercion system in Sage you should just query gap base ring (function [CoefficientsRing](https://www.gap-system.org/Manuals/doc/ref/chap66.html#X8235D10781BE8003)).



---

archive/issue_comments_286840.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-05T08:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286840",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286841.json:
```json
{
    "body": "<a id='comment:16'></a>By all ways, please do that! I have zero knowledge of gap, essentially.",
    "created_at": "2019-01-05T08:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286841",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>By all ways, please do that! I have zero knowledge of gap, essentially.



---

archive/issue_comments_286842.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:14 chapoton]:\n> This will not work for multi-variate polynomials so far.\n\n\nThere is code in this branch added for multivariate polynomial rings, so it was quite unclear why no examples for treating multivariate polynomials...",
    "created_at": "2019-01-05T08:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286842",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [comment:14 chapoton]:
> This will not work for multi-variate polynomials so far.


There is code in this branch added for multivariate polynomial rings, so it was quite unclear why no examples for treating multivariate polynomials...



---

archive/issue_comments_286843.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 chapoton]:\n> By all ways, please do that! I have zero knowledge of gap, essentially.\n\n\nI am working on a commit.",
    "created_at": "2019-01-05T08:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286843",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:16 chapoton]:
> By all ways, please do that! I have zero knowledge of gap, essentially.


I am working on a commit.



---

archive/issue_comments_286844.json:
```json
{
    "body": "<a id='comment:19'></a>Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the \"common_parent\".\n\nNow works with (univriate) Laurent polynomials and rational functions.\n\nNeeds review again.\n\n---\nNew commits:",
    "created_at": "2019-01-05T10:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286844",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the "common_parent".

Now works with (univriate) Laurent polynomials and rational functions.

Needs review again.

---
New commits:



---

archive/issue_comments_286845.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-05T10:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286845",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286846.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 vdelecroix]:\n> Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the \"common_parent\".\n\n\nDid you try `CoefficientRing(Ring(f))` for\na GAP polynomial `f`?\n\n(I'll have a look later today...)",
    "created_at": "2019-01-05T10:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286846",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>Replying to [comment:19 vdelecroix]:
> Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the "common_parent".


Did you try `CoefficientRing(Ring(f))` for
a GAP polynomial `f`?

(I'll have a look later today...)



---

archive/issue_comments_286847.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 dimpase]:\n> Replying to [comment:19 vdelecroix]:\n> > Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the \"common_parent\".\n\n> \n> Did you try `CoefficientRing(Ring(f))` for\n> a GAP polynomial `f`?\n> \n> (I'll have a look later today...)\n\n\ncomplete failure\n\n```\nsage: x = libgap.eval('Indeterminate(Integers, \"x\")')\nsage: libgap.Ring(x)\n<ring with 1 generators>\nsage: libgap.CoefficientsRing(libgap.Ring(x))\nTraceback (most recent call last):\n...\nAttributeError: No such attribute: CoefficientsRing.\n```",
    "created_at": "2019-01-05T11:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286847",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>Replying to [comment:20 dimpase]:
> Replying to [comment:19 vdelecroix]:
> > Contrarily to what I thought, it seems not possible to extract the common ring of the coefficients from GAP. I kept the "common_parent".

> 
> Did you try `CoefficientRing(Ring(f))` for
> a GAP polynomial `f`?
> 
> (I'll have a look later today...)


complete failure

```
sage: x = libgap.eval('Indeterminate(Integers, "x")')
sage: libgap.Ring(x)
<ring with 1 generators>
sage: libgap.CoefficientsRing(libgap.Ring(x))
Traceback (most recent call last):
...
AttributeError: No such attribute: CoefficientsRing.
```



---

archive/issue_comments_286848.json:
```json
{
    "body": "<a id='comment:22'></a>If this works in GAP then it is matter of putting `CoefficientRing` into an appropriate list of GAP functions, or just calling `libgap.function_factory(CoefficientRing)`",
    "created_at": "2019-01-05T12:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286848",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>If this works in GAP then it is matter of putting `CoefficientRing` into an appropriate list of GAP functions, or just calling `libgap.function_factory(CoefficientRing)`



---

archive/issue_comments_286849.json:
```json
{
    "body": "<a id='comment:23'></a>Dima, do you have a concrete proposal ? Otherwise, one could start with the current thing and enhance that later in other tickets ?\n\nWhat is the correct argument for  CoefficientsRing ?\n\n```\nsage: x=polygen(QQ,'x')\nsage: X=libgap(x)\nsage: R=X.Ring()\nsage: R.CoefficientsRing()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-9-003be256b736> in <module>()\n----> 1 R.CoefficientsRing()\n\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.pyx in sage.libs.gap.element.GapElement_MethodProxy.__call__ (build/cythonized/sage/libs/gap/element.c:18831)()\n   2465             return GapElement_Function.__call__(self, * ([self.first_argument] + list(args)))\n   2466         else:\n-> 2467             return GapElement_Function.__call__(self, self.first_argument)\n   2468 \n   2469 \n\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.pyx in sage.libs.gap.element.GapElement_Function.__call__ (build/cythonized/sage/libs/gap/element.c:18288)()\n   2353             return make_any_gap_element(self.parent(), result)\n   2354         except RuntimeError as msg:\n-> 2355             raise ValueError('libGAP: ' + str(msg))\n   2356         finally:\n   2357             GAP_Leave()\n\nValueError: libGAP: Error, no method found! Error, no 1st choice method found for `CoefficientsRing' on 1 arguments\n```",
    "created_at": "2019-01-05T17:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286849",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>Dima, do you have a concrete proposal ? Otherwise, one could start with the current thing and enhance that later in other tickets ?

What is the correct argument for  CoefficientsRing ?

```
sage: x=polygen(QQ,'x')
sage: X=libgap(x)
sage: R=X.Ring()
sage: R.CoefficientsRing()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-9-003be256b736> in <module>()
----> 1 R.CoefficientsRing()

/home/chapoton/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.pyx in sage.libs.gap.element.GapElement_MethodProxy.__call__ (build/cythonized/sage/libs/gap/element.c:18831)()
   2465             return GapElement_Function.__call__(self, * ([self.first_argument] + list(args)))
   2466         else:
-> 2467             return GapElement_Function.__call__(self, self.first_argument)
   2468 
   2469 

/home/chapoton/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.pyx in sage.libs.gap.element.GapElement_Function.__call__ (build/cythonized/sage/libs/gap/element.c:18288)()
   2353             return make_any_gap_element(self.parent(), result)
   2354         except RuntimeError as msg:
-> 2355             raise ValueError('libGAP: ' + str(msg))
   2356         finally:
   2357             GAP_Leave()

ValueError: libGAP: Error, no method found! Error, no 1st choice method found for `CoefficientsRing' on 1 arguments
```



---

archive/issue_comments_286850.json:
```json
{
    "body": "<a id='comment:24'></a>This looks like a GAP bug to me. I've opened [#3159](https://github.com/gap-system/gap/issues/3159) for GAP.\n\nIndeed, this should not stop us from going ahead with this ticket in some form.",
    "created_at": "2019-01-06T02:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286850",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>This looks like a GAP bug to me. I've opened [#3159](https://github.com/gap-system/gap/issues/3159) for GAP.

Indeed, this should not stop us from going ahead with this ticket in some form.



---

archive/issue_comments_286851.json:
```json
{
    "body": "<a id='comment:25'></a>Then I am satisfied with the current state, and ready to give a positive review.\n\nVincent, d'accord ?",
    "created_at": "2019-01-06T10:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286851",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>Then I am satisfied with the current state, and ready to give a positive review.

Vincent, d'accord ?



---

archive/issue_comments_286852.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 chapoton]:\n> Then I am satisfied with the current state, and ready to give a positive review.\n> \n> Vincent, d'accord ?\n\n\nC'est bon pour moi. Merci Fr\u00e9d\u00e9ric.",
    "created_at": "2019-01-07T07:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286852",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>Replying to [comment:25 chapoton]:
> Then I am satisfied with the current state, and ready to give a positive review.
> 
> Vincent, d'accord ?


C'est bon pour moi. Merci Frédéric.



---

archive/issue_comments_286853.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-07T07:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286853",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286854.json:
```json
{
    "body": "<a id='comment:27'></a>I don't know if it is only me but this ticket breaks building in sage-on-gentoo with cython-0.29.2\n\n```\n-> First build of interpreters\nrunning build_cython\nEnabling Cython debugging support\nUpdating Cython code....\nwarning: sage/graphs/mcqd.pyx:52:19: local variable 'clique_number' referenced before assignment\nwarning: sage/graphs/mcqd.pyx:55:57: local variable 'clique_number' referenced before assignment\n\nError compiling Cython file:\n------------------------------------------------------------\n...\nfrom sage.structure.parent import Parent\nfrom sage.rings.all import ZZ, QQ, RDF\n\nfrom sage.groups.perm_gps.permgroup_element cimport PermutationGroupElement\nfrom sage.combinat.permutation import Permutation\nfrom sage.structure.element cimport coercion_model as cm\n^\n------------------------------------------------------------\n\nsage/libs/gap/element.pyx:34:0: 'sage/structure/element/coercion_model.pxd' not found\nwarning: sage/libs/gap/element.pyx:238:21: local variable 'result' referenced before assignment\nwarning: sage/libs/gap/element.pyx:239:15: local variable 'result' referenced before assignment\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            var = var.sage()\n            num, den, val = self.CoefficientsOfUnivariateRationalFunction()\n            num = num.sage()\n            den = den.sage()\n            val = val.sage()\n            base_ring = cm.common_parent(*(num + den))\n                         ^\n------------------------------------------------------------\n\nsage/libs/gap/element.pyx:1277:26: cimported module has no attribute 'common_parent'\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            var = var.sage()\n            num, den, val = self.CoefficientsOfUnivariateRationalFunction()\n            num = num.sage()\n            den = den.sage()\n            val = val.sage()\n            base_ring = cm.common_parent(*(num + den))\n                         ^\n------------------------------------------------------------\n\nsage/libs/gap/element.pyx:1277:26: Compiler crash in AnalyseExpressionsTransform\n\nModuleNode.body = StatListNode(element.pyx:19:0)\nStatListNode.stats[13] = CClassDefNode(element.pyx:369:5,\n    as_name = u'GapElement',\n    class_name = u'GapElement',\n    doc = u\"\\n    Wrapper for all Gap objects.\\n\\n    .. NOTE::\\n\\n        In order to create ``GapElements`` you should use the\\n        ``libgap`` instance (the parent of all Gap elements) to\\n        convert things into ``GapElement``. You must not create\\n        ``GapElement`` instances manually.\\n\\n    EXAMPLES::\\n\\n        sage: libgap(0)\\n        0\\n\\n    If Gap finds an error while evaluating, a corresponding assertion is raised::\\n\\n        sage: libgap.eval('1/0')\\n        Traceback (most recent call last):\\n        ...\\n        ValueError: libGAP: Error, Rational operations: <divisor> must not be zero\\n\\n    Also, a ``ValueError`` is raised if the input is not a simple expression::\\n\\n        sage: libgap.eval('1; 2; 3')\\n        Traceback (most recent call last):\\n        ...\\n        ValueError: can only evaluate a single statement\\n    \")\nCClassDefNode.body = StatListNode(element.pyx:370:4)\nStatListNode.stats[30] = DefNode(element.pyx:1202:4,\n    doc = u'\\n        Return the Sage equivalent of the :class:`GapElement`\\n\\n        EXAMPLES::\\n\\n            sage: libgap(1).sage()\\n            1\\n            sage: type(_)\\n            <type \\'sage.rings.integer.Integer\\'>\\n\\n            sage: libgap(3/7).sage()\\n            3/7\\n            sage: type(_)\\n            <type \\'sage.rings.rational.Rational\\'>\\n\\n            sage: libgap.eval(\\'5 + 7*E(3)\\').sage()\\n            7*zeta3 + 5\\n\\n            sage: libgap(Infinity).sage()\\n            +Infinity\\n            sage: libgap(-Infinity).sage()\\n            -Infinity\\n\\n            sage: libgap(True).sage()\\n            True\\n            sage: libgap(False).sage()\\n            False\\n            sage: type(_)\\n            <... \\'bool\\'>\\n\\n            sage: libgap(\\'this is a string\\').sage()\\n            \\'this is a string\\'\\n            sage: type(_)\\n            <... \\'str\\'>\\n\\n            sage: x = libgap.eval(\\'Indeterminate(Integers, \"x\")\\')\\n\\n            sage: p = x^2 - 2*x + 3\\n            sage: p.sage()\\n            x^2 - 2*x + 3\\n            sage: p.sage().parent()\\n            Univariate Polynomial Ring in x over Integer Ring\\n\\n            sage: p = x^-2 + 3*x\\n            sage: p.sage()\\n            x^-2 + 3*x\\n            sage: p.sage().parent()\\n            Univariate Laurent Polynomial Ring in x over Integer Ring\\n\\n            sage: p = (3 * x^2 + x) / (x^2 - 2)\\n            sage: p.sage()\\n            (3*x^2 + x)/(x^2 - 2)\\n            sage: p.sage().parent()\\n            Fraction Field of Univariate Polynomial Ring in x over Integer Ring\\n        ',\n    modifiers = [...]/0,\n    name = u'sage',\n    np_args_idx = [...]/0,\n    num_required_args = 1,\n    outer_attrs = [...]/2,\n    py_wrapper_required = True,\n    used = True)\nFile 'ExprNodes.py', line 5338, in infer_type: GeneralCallNode(element.pyx:1277:40,\n    result_is_used = True,\n    use_managed_ref = True)\nFile 'ExprNodes.py', line 6826, in infer_type: AttributeNode(element.pyx:1277:26,\n    attribute = u'common_parent',\n    is_attribute = 1,\n    needs_none_check = True,\n    result_is_used = True,\n    use_managed_ref = True)\n\nCompiler crash traceback from this point on:\n  File \"/usr/lib64/python2.7/site-packages/Cython/Compiler/ExprNodes.py\", line 6826, in infer_type\n    return node.entry.type\nAttributeError: 'NoneType' object has no attribute 'type'\nTraceback (most recent call last):\n  File \"/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1244, in cythonize_one_helper\n    return cythonize_one(*m)\n  File \"/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1220, in cythonize_one\n    raise CompileError(None, pyx_file)\nCompileError: sage/libs/gap/element.pyx\n************************************************************************\nTraceback (most recent call last):\n  File \"setup.py\", line 954, in <module>\n    ext_modules = ext_modules)\n  File \"/usr/lib64/python2.7/distutils/core.py\", line 151, in setup\n    dist.run_commands()\n  File \"/usr/lib64/python2.7/distutils/dist.py\", line 953, in run_commands\n    self.run_command(cmd)\n  File \"/usr/lib64/python2.7/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"setup.py\", line 857, in run\n    build.run(self)\n  File \"/usr/lib64/python2.7/distutils/command/build.py\", line 127, in run\n    self.run_command(cmd_name)\n  File \"/usr/lib64/python2.7/distutils/cmd.py\", line 326, in run_command\n    self.distribution.run_command(command)\n  File \"/usr/lib64/python2.7/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"setup.py\", line 376, in run\n    cache=False,\n  File \"/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1088, in cythonize\n    result.get(99999)  # seconds\n  File \"/usr/lib64/python2.7/multiprocessing/pool.py\", line 572, in get\n    raise self._value\nCompileError: sage/libs/gap/element.pyx\n************************************************************************\nError building the Sage library\n************************************************************************\n```\nGoing from `from sage.structure.element cimport coercion_model as cm` to `from sage.structure.coerce cimport coercion_model as cm` seem to fix the breakage.",
    "created_at": "2019-01-18T00:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286854",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>I don't know if it is only me but this ticket breaks building in sage-on-gentoo with cython-0.29.2

```
-> First build of interpreters
running build_cython
Enabling Cython debugging support
Updating Cython code....
warning: sage/graphs/mcqd.pyx:52:19: local variable 'clique_number' referenced before assignment
warning: sage/graphs/mcqd.pyx:55:57: local variable 'clique_number' referenced before assignment

Error compiling Cython file:
------------------------------------------------------------
...
from sage.structure.parent import Parent
from sage.rings.all import ZZ, QQ, RDF

from sage.groups.perm_gps.permgroup_element cimport PermutationGroupElement
from sage.combinat.permutation import Permutation
from sage.structure.element cimport coercion_model as cm
^
------------------------------------------------------------

sage/libs/gap/element.pyx:34:0: 'sage/structure/element/coercion_model.pxd' not found
warning: sage/libs/gap/element.pyx:238:21: local variable 'result' referenced before assignment
warning: sage/libs/gap/element.pyx:239:15: local variable 'result' referenced before assignment

Error compiling Cython file:
------------------------------------------------------------
...
            var = var.sage()
            num, den, val = self.CoefficientsOfUnivariateRationalFunction()
            num = num.sage()
            den = den.sage()
            val = val.sage()
            base_ring = cm.common_parent(*(num + den))
                         ^
------------------------------------------------------------

sage/libs/gap/element.pyx:1277:26: cimported module has no attribute 'common_parent'

Error compiling Cython file:
------------------------------------------------------------
...
            var = var.sage()
            num, den, val = self.CoefficientsOfUnivariateRationalFunction()
            num = num.sage()
            den = den.sage()
            val = val.sage()
            base_ring = cm.common_parent(*(num + den))
                         ^
------------------------------------------------------------

sage/libs/gap/element.pyx:1277:26: Compiler crash in AnalyseExpressionsTransform

ModuleNode.body = StatListNode(element.pyx:19:0)
StatListNode.stats[13] = CClassDefNode(element.pyx:369:5,
    as_name = u'GapElement',
    class_name = u'GapElement',
    doc = u"\n    Wrapper for all Gap objects.\n\n    .. NOTE::\n\n        In order to create ``GapElements`` you should use the\n        ``libgap`` instance (the parent of all Gap elements) to\n        convert things into ``GapElement``. You must not create\n        ``GapElement`` instances manually.\n\n    EXAMPLES::\n\n        sage: libgap(0)\n        0\n\n    If Gap finds an error while evaluating, a corresponding assertion is raised::\n\n        sage: libgap.eval('1/0')\n        Traceback (most recent call last):\n        ...\n        ValueError: libGAP: Error, Rational operations: <divisor> must not be zero\n\n    Also, a ``ValueError`` is raised if the input is not a simple expression::\n\n        sage: libgap.eval('1; 2; 3')\n        Traceback (most recent call last):\n        ...\n        ValueError: can only evaluate a single statement\n    ")
CClassDefNode.body = StatListNode(element.pyx:370:4)
StatListNode.stats[30] = DefNode(element.pyx:1202:4,
    doc = u'\n        Return the Sage equivalent of the :class:`GapElement`\n\n        EXAMPLES::\n\n            sage: libgap(1).sage()\n            1\n            sage: type(_)\n            <type \'sage.rings.integer.Integer\'>\n\n            sage: libgap(3/7).sage()\n            3/7\n            sage: type(_)\n            <type \'sage.rings.rational.Rational\'>\n\n            sage: libgap.eval(\'5 + 7*E(3)\').sage()\n            7*zeta3 + 5\n\n            sage: libgap(Infinity).sage()\n            +Infinity\n            sage: libgap(-Infinity).sage()\n            -Infinity\n\n            sage: libgap(True).sage()\n            True\n            sage: libgap(False).sage()\n            False\n            sage: type(_)\n            <... \'bool\'>\n\n            sage: libgap(\'this is a string\').sage()\n            \'this is a string\'\n            sage: type(_)\n            <... \'str\'>\n\n            sage: x = libgap.eval(\'Indeterminate(Integers, "x")\')\n\n            sage: p = x^2 - 2*x + 3\n            sage: p.sage()\n            x^2 - 2*x + 3\n            sage: p.sage().parent()\n            Univariate Polynomial Ring in x over Integer Ring\n\n            sage: p = x^-2 + 3*x\n            sage: p.sage()\n            x^-2 + 3*x\n            sage: p.sage().parent()\n            Univariate Laurent Polynomial Ring in x over Integer Ring\n\n            sage: p = (3 * x^2 + x) / (x^2 - 2)\n            sage: p.sage()\n            (3*x^2 + x)/(x^2 - 2)\n            sage: p.sage().parent()\n            Fraction Field of Univariate Polynomial Ring in x over Integer Ring\n        ',
    modifiers = [...]/0,
    name = u'sage',
    np_args_idx = [...]/0,
    num_required_args = 1,
    outer_attrs = [...]/2,
    py_wrapper_required = True,
    used = True)
File 'ExprNodes.py', line 5338, in infer_type: GeneralCallNode(element.pyx:1277:40,
    result_is_used = True,
    use_managed_ref = True)
File 'ExprNodes.py', line 6826, in infer_type: AttributeNode(element.pyx:1277:26,
    attribute = u'common_parent',
    is_attribute = 1,
    needs_none_check = True,
    result_is_used = True,
    use_managed_ref = True)

Compiler crash traceback from this point on:
  File "/usr/lib64/python2.7/site-packages/Cython/Compiler/ExprNodes.py", line 6826, in infer_type
    return node.entry.type
AttributeError: 'NoneType' object has no attribute 'type'
Traceback (most recent call last):
  File "/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py", line 1244, in cythonize_one_helper
    return cythonize_one(*m)
  File "/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py", line 1220, in cythonize_one
    raise CompileError(None, pyx_file)
CompileError: sage/libs/gap/element.pyx
************************************************************************
Traceback (most recent call last):
  File "setup.py", line 954, in <module>
    ext_modules = ext_modules)
  File "/usr/lib64/python2.7/distutils/core.py", line 151, in setup
    dist.run_commands()
  File "/usr/lib64/python2.7/distutils/dist.py", line 953, in run_commands
    self.run_command(cmd)
  File "/usr/lib64/python2.7/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "setup.py", line 857, in run
    build.run(self)
  File "/usr/lib64/python2.7/distutils/command/build.py", line 127, in run
    self.run_command(cmd_name)
  File "/usr/lib64/python2.7/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/usr/lib64/python2.7/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "setup.py", line 376, in run
    cache=False,
  File "/usr/lib64/python2.7/site-packages/Cython/Build/Dependencies.py", line 1088, in cythonize
    result.get(99999)  # seconds
  File "/usr/lib64/python2.7/multiprocessing/pool.py", line 572, in get
    raise self._value
CompileError: sage/libs/gap/element.pyx
************************************************************************
Error building the Sage library
************************************************************************
```
Going from `from sage.structure.element cimport coercion_model as cm` to `from sage.structure.coerce cimport coercion_model as cm` seem to fix the breakage.



---

archive/issue_comments_286855.json:
```json
{
    "body": "<a id='comment:28'></a>coercion_model has been moved by ticket #27021\n\nso there is a conflict between here and there..",
    "created_at": "2019-01-18T07:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286855",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>coercion_model has been moved by ticket #27021

so there is a conflict between here and there..



---

archive/issue_comments_286856.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 chapoton]:\n> coercion_model has been moved by ticket #27021\n> \n> so there is a conflict between here and there..\n\n\nSo that won't just be me, Volker is just trying to merge both tickets at the same time.",
    "created_at": "2019-01-18T07:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286856",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>Replying to [comment:28 chapoton]:
> coercion_model has been moved by ticket #27021
> 
> so there is a conflict between here and there..


So that won't just be me, Volker is just trying to merge both tickets at the same time.



---

archive/issue_comments_286857.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-18T08:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286857",
    "user": "https://github.com/fchapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_286858.json:
```json
{
    "body": "<a id='comment:30'></a>let us step back here then",
    "created_at": "2019-01-18T08:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286858",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>let us step back here then



---

archive/issue_comments_286859.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-18T09:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286860.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-18T09:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286860",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286861.json:
```json
{
    "body": "<a id='comment:32'></a>now the correct fix..\n\n---\nNew commits:",
    "created_at": "2019-01-18T09:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286861",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:32'></a>now the correct fix..

---
New commits:



---

archive/issue_comments_286862.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-18T17:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286862",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286863.json:
```json
{
    "body": "<a id='comment:33'></a>LGTM.",
    "created_at": "2019-01-18T17:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286863",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>LGTM.



---

archive/issue_events_056207.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-26T15:55:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21020#event-56207"
}
```



---

archive/issue_comments_286864.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-26T15:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286864",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_286865.json:
```json
{
    "body": "<a id='comment:36'></a>follow up (a bug): #30496",
    "created_at": "2020-09-02T18:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21020#issuecomment-286865",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>follow up (a bug): #30496
