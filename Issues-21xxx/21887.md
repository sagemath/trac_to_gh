# Issue 21887: py3 making __nonzero__ an alias for __bool__ in rings folder

archive/issues_021650.json:
```json
{
    "body": "as a step to py3\n\npart of #16076\n\nhere only in the rings folder\n\n\n\nBranch/Commit: b27983499cc4ecb534cab9af8f31e122568c42fe\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/21887\n\n",
    "closed_at": "2016-11-19T22:09:51Z",
    "created_at": "2016-11-17T16:15:08Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "py3 making __nonzero__ an alias for __bool__ in rings folder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21887",
    "user": "https://github.com/fchapoton"
}
```
as a step to py3

part of #16076

here only in the rings folder



Branch/Commit: b27983499cc4ecb534cab9af8f31e122568c42fe

Reviewer: Jeroen Demeyer

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/21887





---

archive/issue_comments_404771.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[1eb9e08](https://git.sagemath.org/sage.git/commit?id=1eb9e08b6f0554a83048e5a2089ef539ed517d4c)|`making __nonzero__ an alias for __bool__ in rings folder`|",
    "created_at": "2016-11-17T16:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404771",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[1eb9e08](https://git.sagemath.org/sage.git/commit?id=1eb9e08b6f0554a83048e5a2089ef539ed517d4c)|`making __nonzero__ an alias for __bool__ in rings folder`|



---

archive/issue_comments_404772.json:
```json
{
    "body": "Changing commit from \"\" to \"1eb9e08b6f0554a83048e5a2089ef539ed517d4c\"",
    "created_at": "2016-11-17T16:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404772",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "1eb9e08b6f0554a83048e5a2089ef539ed517d4c"



---

archive/issue_comments_404773.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/21887\"",
    "created_at": "2016-11-17T16:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404773",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/21887"



---

archive/issue_comments_404774.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis is not needed for Cython extension types. Cython understands both special methods `__nonzero__` and `__bool__`.\n\nThere is one potential caveat: if you *really* need `__nonzero__` and `__bool__` non-special methods (that is, you really need `obj.__bool__` and not just `bool(obj)` or `not obj`), your trick might be needed.",
    "created_at": "2016-11-17T16:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404774",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
This is not needed for Cython extension types. Cython understands both special methods `__nonzero__` and `__bool__`.

There is one potential caveat: if you *really* need `__nonzero__` and `__bool__` non-special methods (that is, you really need `obj.__bool__` and not just `bool(obj)` or `not obj`), your trick might be needed.



---

archive/issue_comments_404775.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[e62142d](https://git.sagemath.org/sage.git/commit/?id=e62142dc3a614c694837a146d764167f19754844)|`trac 21887 one missing case`|",
    "created_at": "2016-11-17T16:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404775",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[e62142d](https://git.sagemath.org/sage.git/commit/?id=e62142dc3a614c694837a146d764167f19754844)|`trac 21887 one missing case`|



---

archive/issue_comments_404776.json:
```json
{
    "body": "Changing commit from \"1eb9e08b6f0554a83048e5a2089ef539ed517d4c\" to \"e62142dc3a614c694837a146d764167f19754844\"",
    "created_at": "2016-11-17T16:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1eb9e08b6f0554a83048e5a2089ef539ed517d4c" to "e62142dc3a614c694837a146d764167f19754844"



---

archive/issue_comments_404777.json:
```json
{
    "body": "<a id='comment:4'></a>\nSo should I refrain to make changes to any pyx or pxi files ?\n\nI would prefer to have something uniform, even if it is not necessary. Does it do any harm to do that also in pyx files ?",
    "created_at": "2016-11-17T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404777",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
So should I refrain to make changes to any pyx or pxi files ?

I would prefer to have something uniform, even if it is not necessary. Does it do any harm to do that also in pyx files ?



---

archive/issue_comments_404778.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [chapoton](#comment%3A4):\n> Does it do any harm to do that also in pyx files ?\n\n\nThere is no obvious harm, apart from code bloat.",
    "created_at": "2016-11-17T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404778",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [chapoton](#comment%3A4):
> Does it do any harm to do that also in pyx files ?


There is no obvious harm, apart from code bloat.



---

archive/issue_comments_404779.json:
```json
{
    "body": "<a id='comment:6'></a>\nOK, I actually tested it and it doesn't work...\n\n```\n/usr/local/src/sage-config/src/sage/rings/complex_number.pyx in init sage.rings.complex_number (/usr/local/src/sage-config/src/build/cythonized/sage/rings/complex_number.c:25899)()\n    860                                       imag_string, digit_precision_bound)\n    861 \n    862     def __bool__(self):\n    863         \"\"\"\n    864         Return ``True`` if ``self`` is not zero. This is an internal function;\n    865         use :meth:`is_zero()` instead.\n    866 \n    867         EXAMPLES::\n    868 \n    869             sage: z = 1 + CC(I)\n    870             sage: z.is_zero()\n    871             False\n    872         \"\"\"\n    873         return not (mpfr_zero_p(self.__re) and mpfr_zero_p(self.__im))\n    874 \n--> 875     __nonzero__ =__bool__\n        global __nonzero__ = undefined\n        global __bool__ = undefined\n    876 \n    877     def prec(self):\n    878         \"\"\"\n    879         Return precision of this complex number.\n    880 \n    881         EXAMPLES::\n    882 \n    883             sage: i = ComplexField(2000).0\n    884             sage: i.prec()\n    885             2000\n    886         \"\"\"\n    887         return self._parent.prec()\n    888 \n    889     def real(self):\n    890         \"\"\"\n\nNameError: name '__bool__' is not defined\n```\n\nI guess Cython extension types don't allow such assignment of special methods.",
    "created_at": "2016-11-17T20:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404779",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
OK, I actually tested it and it doesn't work...

```
/usr/local/src/sage-config/src/sage/rings/complex_number.pyx in init sage.rings.complex_number (/usr/local/src/sage-config/src/build/cythonized/sage/rings/complex_number.c:25899)()
    860                                       imag_string, digit_precision_bound)
    861 
    862     def __bool__(self):
    863         """
    864         Return ``True`` if ``self`` is not zero. This is an internal function;
    865         use :meth:`is_zero()` instead.
    866 
    867         EXAMPLES::
    868 
    869             sage: z = 1 + CC(I)
    870             sage: z.is_zero()
    871             False
    872         """
    873         return not (mpfr_zero_p(self.__re) and mpfr_zero_p(self.__im))
    874 
--> 875     __nonzero__ =__bool__
        global __nonzero__ = undefined
        global __bool__ = undefined
    876 
    877     def prec(self):
    878         """
    879         Return precision of this complex number.
    880 
    881         EXAMPLES::
    882 
    883             sage: i = ComplexField(2000).0
    884             sage: i.prec()
    885             2000
    886         """
    887         return self._parent.prec()
    888 
    889     def real(self):
    890         """

NameError: name '__bool__' is not defined
```

I guess Cython extension types don't allow such assignment of special methods.



---

archive/issue_comments_404780.json:
```json
{
    "body": "<a id='comment:7'></a>\nTo fix code like `obj.__nonzero__()` (for example in `src/sage/rings/complex_interval.pyx`), I would just use `bool(obj)`. That should \"just work\" in Python 2 and Python 3.",
    "created_at": "2016-11-17T20:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404780",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
To fix code like `obj.__nonzero__()` (for example in `src/sage/rings/complex_interval.pyx`), I would just use `bool(obj)`. That should "just work" in Python 2 and Python 3.



---

archive/issue_comments_404781.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[41d63ab](https://git.sagemath.org/sage.git/commit/?id=41d63ab51939a9bcfa0dee3a5f824201a212456e)|`trac 21887 undoing alias of __nonzero__ in pyx files`|",
    "created_at": "2016-11-17T20:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[41d63ab](https://git.sagemath.org/sage.git/commit/?id=41d63ab51939a9bcfa0dee3a5f824201a212456e)|`trac 21887 undoing alias of __nonzero__ in pyx files`|



---

archive/issue_comments_404782.json:
```json
{
    "body": "Changing commit from \"e62142dc3a614c694837a146d764167f19754844\" to \"41d63ab51939a9bcfa0dee3a5f824201a212456e\"",
    "created_at": "2016-11-17T20:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404782",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e62142dc3a614c694837a146d764167f19754844" to "41d63ab51939a9bcfa0dee3a5f824201a212456e"



---

archive/issue_comments_404783.json:
```json
{
    "body": "<a id='comment:9'></a>\n`.pxi` files should be treated just like `.pyx` files.",
    "created_at": "2016-11-17T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404783",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
`.pxi` files should be treated just like `.pyx` files.



---

archive/issue_comments_404784.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[28728df](https://git.sagemath.org/sage.git/commit/?id=28728df57b3b34e85f4b40f655d2abf8a74ae535)|`trac 21887 undo aliasing in pxi files too`|",
    "created_at": "2016-11-17T21:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[28728df](https://git.sagemath.org/sage.git/commit/?id=28728df57b3b34e85f4b40f655d2abf8a74ae535)|`trac 21887 undo aliasing in pxi files too`|



---

archive/issue_comments_404785.json:
```json
{
    "body": "Changing commit from \"41d63ab51939a9bcfa0dee3a5f824201a212456e\" to \"28728df57b3b34e85f4b40f655d2abf8a74ae535\"",
    "created_at": "2016-11-17T21:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "41d63ab51939a9bcfa0dee3a5f824201a212456e" to "28728df57b3b34e85f4b40f655d2abf8a74ae535"



---

archive/issue_comments_404786.json:
```json
{
    "body": "Changing commit from \"28728df57b3b34e85f4b40f655d2abf8a74ae535\" to \"b27983499cc4ecb534cab9af8f31e122568c42fe\"",
    "created_at": "2016-11-17T21:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "28728df57b3b34e85f4b40f655d2abf8a74ae535" to "b27983499cc4ecb534cab9af8f31e122568c42fe"



---

archive/issue_comments_404787.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[b279834](https://git.sagemath.org/sage.git/commit/?id=b27983499cc4ecb534cab9af8f31e122568c42fe)|`trac 21887 some forgotten cases`|",
    "created_at": "2016-11-17T21:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[b279834](https://git.sagemath.org/sage.git/commit/?id=b27983499cc4ecb534cab9af8f31e122568c42fe)|`trac 21887 some forgotten cases`|



---

archive/issue_comments_404788.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-18T07:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404788",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404789.json:
```json
{
    "body": "<a id='comment:12'></a>\nok, works now, green bot, setting to needs_review",
    "created_at": "2016-11-18T07:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404789",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
ok, works now, green bot, setting to needs_review



---

archive/issue_comments_404790.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2016-11-18T09:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404790",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_404791.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-18T09:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404791",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404792.json:
```json
{
    "body": "Changing branch from \"u/chapoton/21887\" to \"b27983499cc4ecb534cab9af8f31e122568c42fe\"",
    "created_at": "2016-11-19T22:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404792",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/21887" to "b27983499cc4ecb534cab9af8f31e122568c42fe"



---

archive/issue_comments_404793.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-19T22:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21887#issuecomment-404793",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057770.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T22:09:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21887",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21887#event-57770"
}
```
