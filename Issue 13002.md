# Issue 13002: Wrong documentation for methods @cached_method

Issue created by migration from https://trac.sagemath.org/ticket/13174

Original creator: Snark

Original creation time: 2012-06-28 10:45:06

Assignee: mvngu

Calling help on a cached method returns the help for cached_method, not for the actual method being cached :

```
sage:chi=DirichletGroup(6).0
sage:help(chi.conductor)
Help on CachedMethodCallerNoArgs in module sage.modular.dirichlet:

conductor(...)
    File: sage/misc/cachefunc.pyx (starting at line 1259)
    
    Utility class that is used by :class:`CachedMethod` to bind a
    cached method to an instance, in the case of a method that does
    not accept any arguments except ``self``.
    
    NOTE:
    
    The return value ``None`` would not be cached. So, if you have
    a method that does not accept arguments and may return ``None``
    after a lengthy computation, then ``@cached_method`` should not
    be used.
    
    EXAMPLE::
    
        sage: P.<a,b,c,d> = QQ[]
        sage: I = P*[a,b]
        sage: I.gens
        Cached version of <function gens at 0x...>
        sage: type(I.gens)
        <type 'sage.misc.cachefunc.CachedMethodCallerNoArgs'>
        sage: I.gens is I.gens
        True
        sage: I.gens() is I.gens()
        True
    
    AUTHOR:
    
    - Simon King (2011-04)

```


This is with 5.1.beta6 on an x86_64 box ; and I think it's a pretty big bug since introspection is an important feature of sage.


---

Comment by rws created at 2014-03-18 14:36:34

Changing status from new to needs_review.


---

Comment by rws created at 2014-03-18 14:36:34

Now that was easy. No doctest possible, but hey.
----
New commits:


---

Comment by mmezzarobba created at 2014-03-18 18:31:09

I suspect you should call `sage.misc.sageinspect.sage_getdoc` or something (which would use the implementation of `_sage_doc` provided by cached methods, and work for other kinds of magic objects) instead of special-casing cached methods in `sagedoc.py`.


---

Comment by rws created at 2014-03-19 10:04:32

Replying to [comment:5 mmezzarobba]:
> I suspect you should call `sage.misc.sageinspect.sage_getdoc` or something (which would use the implementation of `_sage_doc` provided by cached methods, and work for other kinds of magic objects) instead of special-casing cached methods in `sagedoc.py`.

All Sage functions may have a `sage_getdoc` method, but not all magic objects can be recognized in one comparison (no superclass of magic objects: `CachedFunction` directly inherits from object). You could now either copy the `pydoc.Helper` functionality into Sage, or create a magic function superclass that provides the function to give to `python_help()`. Shying back from the latter, the call to `python_help()` would be replaced by

```
    import pydoc
    pydoc.pager(sage_getdoc(func))
```


This indeed gives you the help for _all_ functions, regardless if magic or not, and even python builtins. However, text formatting is lost somewhere, so there is a bit more to it. What do you think, magic superclass or rewrite of `sagedoc.py:help()`?


---

Comment by mmezzarobba created at 2014-03-19 12:26:05

Replying to [comment:6 rws]:
> However, text formatting is lost somewhere, so there is a bit more to it. What do you think, magic superclass or rewrite of `sagedoc.py:help()`?

The laterâ€”I had in mind something along the line of your suggestion using `pydoc.pager`. But my main point was that the code specific to cached functions should live in their class, not in `sagedoc.py`.


---

Comment by git created at 2014-03-19 15:00:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-03-19 15:01:41

This works now nicely, and with a pretty minimal change. Thanks for your review. Have to improve the output still, though.


---

Comment by git created at 2014-03-19 15:47:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2014-03-19 19:44:56

Looks reasonable. (But IMO, in cases like this one, you shouldn't hesitate to amend your commit instead of piling up three commits for an eight-line patch!)


---

Comment by mmezzarobba created at 2014-03-19 19:44:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-20 15:43:44

Resolution: fixed
