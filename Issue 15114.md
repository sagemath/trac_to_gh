# Issue 15114: import_statements sometimes fails

archive/issues_015114.json:
```json
{
    "body": "Assignee: vdelecroix\n\nSometimes import_statements fails in given a working answer (pi, CIF, ...).\n\nThe patch contains a new function which_import_statements_fail that build the list of name in sage.all for which the answer of import_statements fail to import it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15351\n\n",
    "created_at": "2013-11-03T22:59:43Z",
    "labels": [
        "misc",
        "major",
        "bug"
    ],
    "title": "import_statements sometimes fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15114",
    "user": "vdelecroix"
}
```
Assignee: vdelecroix

Sometimes import_statements fails in given a working answer (pi, CIF, ...).

The patch contains a new function which_import_statements_fail that build the list of name in sage.all for which the answer of import_statements fail to import it.

Issue created by migration from https://trac.sagemath.org/ticket/15351





---

archive/issue_comments_193776.json:
```json
{
    "body": "the list of import_statements that fail",
    "created_at": "2013-11-03T23:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193776",
    "user": "vdelecroix"
}
```

the list of import_statements that fail



---

archive/issue_comments_193777.json:
```json
{
    "body": "Attachment [failed_import_statements](tarball://root/attachments/some-uuid/ticket15351/failed_import_statements) by vdelecroix created at 2013-11-03 23:03:03",
    "created_at": "2013-11-03T23:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193777",
    "user": "vdelecroix"
}
```

Attachment [failed_import_statements](tarball://root/attachments/some-uuid/ticket15351/failed_import_statements) by vdelecroix created at 2013-11-03 23:03:03



---

archive/issue_comments_193778.json:
```json
{
    "body": "Attachment [fix_import_statements.patch](tarball://root/attachments/some-uuid/ticket15351/fix_import_statements.patch) by vdelecroix created at 2013-11-03 23:27:59",
    "created_at": "2013-11-03T23:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193778",
    "user": "vdelecroix"
}
```

Attachment [fix_import_statements.patch](tarball://root/attachments/some-uuid/ticket15351/fix_import_statements.patch) by vdelecroix created at 2013-11-03 23:27:59



---

archive/issue_comments_193779.json:
```json
{
    "body": "Attachment [answer_sage_all](tarball://root/attachments/some-uuid/ticket15351/answer_sage_all) by vdelecroix created at 2013-11-03 23:29:22\n\nthe list of import_statements that answer \"from sage.all import XXX\"",
    "created_at": "2013-11-03T23:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193779",
    "user": "vdelecroix"
}
```

Attachment [answer_sage_all](tarball://root/attachments/some-uuid/ticket15351/answer_sage_all) by vdelecroix created at 2013-11-03 23:29:22

the list of import_statements that answer "from sage.all import XXX"



---

archive/issue_comments_193780.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-03T23:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193780",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_193781.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-03T23:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193781",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_193782.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-07T00:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193782",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_193783.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-11-07T00:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193783",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_193784.json:
```json
{
    "body": "Some related tickets : #14329 and #15333 (that needs review)",
    "created_at": "2014-02-24T09:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193784",
    "user": "chapoton"
}
```

Some related tickets : #14329 and #15333 (that needs review)



---

archive/issue_comments_193785.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T21:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193785",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T22:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193786",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193787.json:
```json
{
    "body": "I fixed (checking one by one) all the exceptions in the linked file (except the is_* stuff)... and this is now ready for review !!\n\nIt is much more robust but it would be marvellous to detect deprecated stuff (there is a note about that in the documentation of the function).",
    "created_at": "2014-03-13T22:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193787",
    "user": "vdelecroix"
}
```

I fixed (checking one by one) all the exceptions in the linked file (except the is_* stuff)... and this is now ready for review !!

It is much more robust but it would be marvellous to detect deprecated stuff (there is a note about that in the documentation of the function).



---

archive/issue_comments_193788.json:
```json
{
    "body": "Helloooooooooooooooooooooooo !!!\n\nSome remarks:\n\n1) Affected ? That's only correct in french I thing. Do you want to translate \"variable assignment\" ? But I believe that in this context messages like \"x is defined by <...>\" or \"x is equal to <...>\" would be clearer.\n\n2) `And one can actually check that FareySymbol and sum are aliases`. Would be better with `:func:`FareySymbol`` for the html doc.\n\n3) If there is an option to display the import line for lazy functions then the output of this function is meant to be copy/pasted. Thus, shouldn't the Warning line begin with a `#` ? Otherwise it is impossible to copy/paste it into Python code.\n\n4) `use it has a name` : as a name.\n\n5) This function is awful. It may be nice to split it into `identify_module`, `identify_object_from_module`, `identify_by_search_through_modules`, `identify_object_from_source_code`, etc ?... Would make the code a bit clearer `:-P`\n\n6) `names_pattern = dict((i,j) for i,j in whatever)` can be rewritten as `{i:j for i,v in whatever}`. Would make your `names_pattern` line clearer.\n\n7) `at the beginig`\n\n8) Why this `print_or_update` function ?\n\nI have not understood everything of the code yet, but fixing the things above might help `^^;`\n\nNathann",
    "created_at": "2014-03-14T12:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193788",
    "user": "ncohen"
}
```

Helloooooooooooooooooooooooo !!!

Some remarks:

1) Affected ? That's only correct in french I thing. Do you want to translate "variable assignment" ? But I believe that in this context messages like "x is defined by <...>" or "x is equal to <...>" would be clearer.

2) `And one can actually check that FareySymbol and sum are aliases`. Would be better with `:func:`FareySymbol`` for the html doc.

3) If there is an option to display the import line for lazy functions then the output of this function is meant to be copy/pasted. Thus, shouldn't the Warning line begin with a `#` ? Otherwise it is impossible to copy/paste it into Python code.

4) `use it has a name` : as a name.

5) This function is awful. It may be nice to split it into `identify_module`, `identify_object_from_module`, `identify_by_search_through_modules`, `identify_object_from_source_code`, etc ?... Would make the code a bit clearer `:-P`

6) `names_pattern = dict((i,j) for i,j in whatever)` can be rewritten as `{i:j for i,v in whatever}`. Would make your `names_pattern` line clearer.

7) `at the beginig`

8) Why this `print_or_update` function ?

I have not understood everything of the code yet, but fixing the things above might help `^^;`

Nathann



---

archive/issue_comments_193789.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-03-14T12:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193789",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_193790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-16T22:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193791.json:
```json
{
    "body": "Hi,\n\nThanks so much for telling me to rewrite it ! Now it is simpler and cleaner and I hope you will understand everything.\n\nI do have two things to solve before getting this in a needs-review status\n* try to not load extra modules in the function `find_objects_from_name` (see the [thread on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/Ok0s5ViT9dA))\n* possibly move the functions `find_objects_from_name` and `find_object_modules` in `sage.misc.sageinspect`\n\nSee you soooooooooooon",
    "created_at": "2014-03-16T22:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193791",
    "user": "vdelecroix"
}
```

Hi,

Thanks so much for telling me to rewrite it ! Now it is simpler and cleaner and I hope you will understand everything.

I do have two things to solve before getting this in a needs-review status
* try to not load extra modules in the function `find_objects_from_name` (see the [thread on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/Ok0s5ViT9dA))
* possibly move the functions `find_objects_from_name` and `find_object_modules` in `sage.misc.sageinspect`

See you soooooooooooon



---

archive/issue_comments_193792.json:
```json
{
    "body": "Yoooooo !!\n\n> Thanks so much for telling me to rewrite it ! Now it is simpler and cleaner and I hope you will understand everything.\n> \n> I do have two things to solve before getting this in a needs-review status\n\nOkayyyy.\n\n> See you soooooooooooon\n\nAre you coming to Paris ? I am not there right now, but in Brussels. And I should move to Lieges next !\n\nNathann",
    "created_at": "2014-03-17T07:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193792",
    "user": "ncohen"
}
```

Yoooooo !!

> Thanks so much for telling me to rewrite it ! Now it is simpler and cleaner and I hope you will understand everything.
> 
> I do have two things to solve before getting this in a needs-review status

Okayyyy.

> See you soooooooooooon

Are you coming to Paris ? I am not there right now, but in Brussels. And I should move to Lieges next !

Nathann



---

archive/issue_comments_193793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-22T17:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193793",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193794.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-22T21:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193794",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-22T21:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193795",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_193796.json:
```json
{
    "body": "Hello...\n\nReally I tried, and I don't get a word of what the main function does. I don't get it, I don't get how it does anything, I don't even get at every moment which variables can be assumed to be defined, what is left to be found, I don't get the flow of it. Sorry, I tried and I just don't get it.\n\nIf you cannot split it into subfunctions further, please add comments to say from time to time \"This has been defined, now we look for this\". I just don't get it, all I can do right now is check that three consecutive lines make sense, and that's not doing a very good review job.\n\nI add a small commit with a couple of unimportant modifications.\n\nSome remarks:\n\n- Why is `exclude_pattern` overwritten when module is `None` ?\n- \"Here we test some instances::\" is followed by nothing\n- Why should calling `import_statement` on a module raise an exception ? What if I do not know where `graph_decompositions` is located ?\n\n```\nsage: import_statements(\"graph_decompositions\")\n...\nValueError: the object '<module 'sage.graphs.graph_decompositions' from '/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/graph_decompositions/__init__.pyc'>' is a module\n```\n\n\n    More importantly, what should the following code do : raise an exception of continue ?\n\n```\nraise ValueError(\"the object '%s' is a module\"%obj)\ncontinue\n```\n\n\nNathann\n----\nNew commits:",
    "created_at": "2014-03-24T15:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193796",
    "user": "ncohen"
}
```

Hello...

Really I tried, and I don't get a word of what the main function does. I don't get it, I don't get how it does anything, I don't even get at every moment which variables can be assumed to be defined, what is left to be found, I don't get the flow of it. Sorry, I tried and I just don't get it.

If you cannot split it into subfunctions further, please add comments to say from time to time "This has been defined, now we look for this". I just don't get it, all I can do right now is check that three consecutive lines make sense, and that's not doing a very good review job.

I add a small commit with a couple of unimportant modifications.

Some remarks:

- Why is `exclude_pattern` overwritten when module is `None` ?
- "Here we test some instances::" is followed by nothing
- Why should calling `import_statement` on a module raise an exception ? What if I do not know where `graph_decompositions` is located ?

```
sage: import_statements("graph_decompositions")
...
ValueError: the object '<module 'sage.graphs.graph_decompositions' from '/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/graph_decompositions/__init__.pyc'>' is a module
```


    More importantly, what should the following code do : raise an exception of continue ?

```
raise ValueError("the object '%s' is a module"%obj)
continue
```


Nathann
----
New commits:



---

archive/issue_comments_193797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-31T09:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-31T12:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193798",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_193799.json:
```json
{
    "body": "Okay, still not an easy read but... better `T_T`\n\nThanks ! \n\nNathann",
    "created_at": "2014-03-31T12:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193799",
    "user": "ncohen"
}
```

Okay, still not an easy read but... better `T_T`

Thanks ! 

Nathann



---

archive/issue_comments_193800.json:
```json
{
    "body": "Hello,\n\n> Really I tried, and I don't get a word of what the main function does.\n> [...]\n\nOk. I had many comments into the code, especially about what the variables are.\n\n> - Why is `exclude_pattern` overwritten when module is `None` ?\n\nBecause you can crash Sage (really):\n\n```\nsage: from sage.misc.dev_tools import load_submodules\nsage: load_submodules(sage.libs)\nload sage.libs.coxeter3.coxeter_group...failed\nload sage.libs.cremona.homspace... suceeded\n...\nload sage.libs.singular.groebner_strategy... suceeded\nsage: quit  # BOOOOOM\n```\n\n\n> - \"Here we test some instances::\" is followed by nothing\n\nI removed it.\n\n> - Why should calling `import_statement` on a module raise an exception ? What if I do not know where `graph_decompositions` is located ?\n> {{{\n> sage: import_statements(\"graph_decompositions\")\n> ...\n> ValueError: the object '<module 'sage.graphs.graph_decompositions' from '/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/graph_decompositions/__init__.pyc'>' is a module\n> }}}\n\nFixed.\n\nVincent",
    "created_at": "2014-03-31T12:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193800",
    "user": "vdelecroix"
}
```

Hello,

> Really I tried, and I don't get a word of what the main function does.
> [...]

Ok. I had many comments into the code, especially about what the variables are.

> - Why is `exclude_pattern` overwritten when module is `None` ?

Because you can crash Sage (really):

```
sage: from sage.misc.dev_tools import load_submodules
sage: load_submodules(sage.libs)
load sage.libs.coxeter3.coxeter_group...failed
load sage.libs.cremona.homspace... suceeded
...
load sage.libs.singular.groebner_strategy... suceeded
sage: quit  # BOOOOOM
```


> - "Here we test some instances::" is followed by nothing

I removed it.

> - Why should calling `import_statement` on a module raise an exception ? What if I do not know where `graph_decompositions` is located ?
> {{{
> sage: import_statements("graph_decompositions")
> ...
> ValueError: the object '<module 'sage.graphs.graph_decompositions' from '/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/graph_decompositions/__init__.pyc'>' is a module
> }}}

Fixed.

Vincent



---

archive/issue_comments_193801.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-31T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15114#issuecomment-193801",
    "user": "vbraun"
}
```

Resolution: fixed
