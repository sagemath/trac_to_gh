# Issue 30175: Upgrade gf2x to 1.3

Issue created by migration from https://trac.sagemath.org/ticket/30412

Original creator: mkoeppe

Original creation time: 2020-08-21 00:36:28

CC:  slelievre dimpase zimmerma

https://prod-gitlab.inria.fr/gf2x/gf2x/-/releases


---

Comment by tmonteil created at 2020-08-21 10:44:56

Changing status from new to needs_review.


---

Comment by tmonteil created at 2020-08-21 10:44:56

Since `gf2x-1.3.0` does not provide a `configure` script anymore (only `configure.ac`) i called autotools (and removed touching files that was related to some patch that does not exist anymore). Tell me if it is the correct way to do.

Self-tests work well for me.
----
New commits:


---

Comment by mkoeppe created at 2020-08-21 14:25:40

Can't run autotools in `spkg-install`.


---

Comment by tmonteil created at 2020-08-21 14:49:29

If i do not add those lines, i got : 


```
[gf2x-1.3.0] /opt/sagemath/sage-source/build/bin/sage-dist-helpers: line 165: ./configure: No such file or directory
```


So, what is the good way ?


---

Comment by dimpase created at 2020-08-21 14:52:14

one needs to prepare a tarball (or a patch) with all the stuff produced by `autoreconf -ivf` or something like this.


---

Comment by mkoeppe created at 2020-08-21 15:54:39

That's right. See https://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate -- it falls in the case as "If you have to make changes to configure.ac or other source files of the autotools build system..."

It's an unfortunate trend that upstream maintainers don't prepare actual release tarballs any more...

After the autoreconf as suggested by Dima, run `./configure && make distcheck`.

Put these instructions into an `spkg-src` script.
The tarball can be put as an attachment on the ticket.


---

Comment by dimpase created at 2020-08-22 11:21:13

I'll try to ping gf2x people on this - but first one needs to get an account on the INRIA [GitLab](GitLab) server (I just asked for one).

By the way, did you check that none of the tarballs/zipfiles they offer contains `./configure` ?


---

Comment by tmonteil created at 2020-08-22 12:29:44

Replying to [comment:7 dimpase]:
> I'll try to ping gf2x people on this - but first one needs to get an account on the INRIA [GitLab](GitLab) server (I just asked for one).

I am about to do the same (by direct email). For me, they forgot to produce the file since the `README` still speaks about running `./configure`.
 
> By the way, did you check that none of the tarballs/zipfiles they offer contains `./configure` ? 

No. I will do that in case.


---

Comment by tmonteil created at 2020-08-22 12:32:20

Replying to [comment:8 tmonteil]:
> Replying to [comment:7 dimpase]:
> > By the way, did you check that none of the tarballs/zipfiles they offer contains `./configure` ? 
> 
> No. I will do that in case.

None of the archives contain a `configure` script.


---

Comment by tmonteil created at 2020-08-22 13:50:15

I sent an email to Emmanuel ThomÃ© and Paul Zimmermann (also Cc-ed on the ticket). I would prefer to ship an upstream traball than an ad-hoc one.


---

Comment by thome created at 2020-08-22 17:10:28

thanks for the heads up.

yes of course you're right.

when ditching gforge in favor of gitlab a few weeks ago, I accidentally forgot the implication that the tarballs that are attached to git tags no longer contain the autotools-generated configure scripts.

I'll try to fix that (and first, find out what is "the right way" to do it).

As regards the sponsorship wall on the inria gitlab account, this has recently been forced on us, and I have only limited hope that we can do something about it. I'm not at all confident that I have the right to create "normal" invitee accounts :-(. All I can do is hope that the sponsorship maze that they have invented is at least possible to work out if you have the will to try (and as for me, I'm 100% fine with ticking yes for anyone who wants to contribute to issue trackers)


---

Comment by dimpase created at 2020-08-23 10:44:26

Replying to [comment:11 thome]:
> thanks for the heads up.
> 
> yes of course you're right.
> 
> when ditching gforge in favor of gitlab a few weeks ago, I accidentally forgot the implication that the tarballs that are attached to git tags no longer contain the autotools-generated configure scripts.
> 
> I'll try to fix that (and first, find out what is "the right way" to do it).

unlike [GitHub](GitHub), gitlab does not seem to allow attaching binary blobs to releases, only links can be added.
Thus you can create a tarball and post it somewhere. E.g. clone the gitlab repo to a public [GitHub](GitHub), and post the tarball there in a release.
Then you could make a link to it in [GitLab](GitLab).
Or just put it somewhere else on the web.


> 
> As regards the sponsorship wall on the inria gitlab account, this has recently been forced on us, and I have only limited hope that we can do something about it. I'm not at all confident that I have the right to create "normal" invitee accounts :-(. All I can do is hope that the sponsorship maze that they have invented is at least possible to work out if you have the will to try (and as for me, I'm 100% fine with ticking yes for anyone who wants to contribute to issue trackers)

This is ludicrous (good luck explaining to your bosses that it goes against the whole concept of open source...). Why couldn't you host a de facto main repo somewhere that allows the public to comment, provide patches/pull requests, etc?


---

Comment by thome created at 2020-08-23 13:09:05

Replying to [comment:12 dimpase]:
> unlike [GitHub](GitHub), gitlab does not seem to allow attaching binary blobs to releases, only links can be added.
> Thus you can create a tarball and post it somewhere. E.g. clone the gitlab repo to a public [GitHub](GitHub), and post the tarball there in a release.
> Then you could make a link to it in [GitLab](GitLab).
> Or just put it somewhere else on the web.

As a matter of fact, you can add file attachments to the release notes. While this is a manual process that has some some obvious shortcomings, it will do for the time being. I searched a bit for a process that would ship a "make dist"-generated tarball as part of gitlab's ci/cd pipelines, but that does not seem to be possible as of now. Maybe in the future.

For the time being, I did just that, and attached tar.gz for the existing releases (exactly the same tarballs as the ones that used to exist on gforge).

I'm not entirely satisfied, and at this point the url to download these files is too long. Hopefully I'll figure out a way to do that better. But the tar.gz files themselves won't change.


---

Comment by saraedum created at 2020-08-23 13:52:58

Replying to [comment:13 thome]:
> I'm not entirely satisfied, and at this point the url to download these files is too long. Hopefully I'll figure out a way to do that better. But the tar.gz files themselves won't change.

Not sure if that's what you are looking for but if you create these tar.gz files during one of the [GitLab](GitLab) CI steps and treat them as build artifacts, they automatically get a reasonable public URL. Here's for a example a log file that is created during the build-from-clean step of the [GitLab](GitLab) CI that [SageMath](SageMath) is using:

https://gitlab.com/sagemath/sage/builds/artifacts/9.2.beta3/file/gitlab-build-docker.log?job=build-from-clean


---

Comment by git created at 2020-08-23 16:56:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-08-23 17:01:34

Thanks for providing an antotoolized tarball. I updated the branch (needs review).


---

Comment by dimpase created at 2020-08-23 17:31:54

please update `upstream_url:` to point to the correct tarball


---

Comment by slelievre created at 2020-08-23 19:01:35

Note: the url starts with `prod-gitlab` but starting with
the simpler `gitlab` without `prod-` seems to work too.


---

Comment by git created at 2020-08-23 21:20:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-08-23 22:20:23

Done, i was thinking the generic URL is useful when updating for next release.


---

Comment by dimpase created at 2020-08-24 16:40:53

lgtm


---

Comment by dimpase created at 2020-08-24 16:40:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-30 08:38:47

Resolution: fixed
