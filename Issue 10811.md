# Issue 10811: Add kernel fan to fan morphism

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2011-03-06 05:06:01

Assignee: mhampton

CC:  vbraun

Keywords: toric geometry

The attached patch adds `preimage_fan(cone)` and `kernel_fan` methods to `FanMorphism` class.


---

Comment by novoselt created at 2011-03-06 05:23:16

Hi Volker,

The patch is quite easy, as `preimage_cones` were already implemented, but in order to make everything shiny it would be nice to improve handling of degenerate cases. For this I need to resolve the situation with trivial fans, namely: is an empty set a fan, or it must include at least the origin? Fulton and Cox-Little-Schenck don't mention it explicitly, but from the point of view of nice correspondence to toric varieties it seems that completely empty fans should be prohibited as they seem to correspond to empty varieties, but then they don't really contain a torus.

Right now it is possible in Sage to create a fan without cones, I propose to automatically add the origin of the provided lattice in this case and treat it as the generating cone. Any objections?

Regarding `preimage_fans(cone)` it would imply that usually it is generated by `preimage_cones(cone)`, but some of them maybe unnecessary for generation (e.g. in the case of blow-up, described in the documentation), i.e. generating cones of `preimage_fan(cone)` are a subset of `preimage_cones(cone)`. However, if `preimage_cones(cone)` is empty, then `preimage_fan(cone)` will have an "extra" generating cone, namely the origin.


---

Comment by novoselt created at 2011-03-06 05:23:16

Changing status from new to needs_work.


---

Comment by novoselt created at 2011-03-07 03:02:44

After some thinking, I have decided to make `kernel_fan` live in the kernel sublattice. The drawback is that currently sublattices don't work extremely well as ambient ones for cones and fans, but that should eventually change. I have made some changes improving the situation, but dual objects still don't work and so one cannot ask for cones of this kernel fan (the doctest is marked as not tested). I propose to include it nevertheless, since the constructed fan is still correct and will be completely functional once other part are improved. (And the "old" version is still available as explicit `preimage_fan` of the origin.)

I have also tweaked the fan constructor a little to ensure adding at least the origin cone and allowing one to specify the fan lattice which is different then cone lattices, as long as it is possible to do the conversion:

```
sage: P2 = toric_varieties.P2()
sage: f = P2.fan()
sage: f
Rational polyhedral fan in 2-d lattice N
sage: Fan(f.generating_cones())                             
Rational polyhedral fan in 2-d lattice N
sage: Fan(f.generating_cones(), lattice=f.lattice().dual())
Rational polyhedral fan in 2-d lattice M
```

If the lattice is not given explicitly, no conversion will be made and all cones must belong to the same lattice. But giving the lattice explicitly may be quite handy for switching between lattices/sublattices/quotients and the above example with "switching to dual" is sometimes used when one wants to compare fans of polar polytopes and think of them as fans in the same lattice.

Ready for review!


---

Comment by novoselt created at 2011-03-07 03:05:55

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2011-03-07 03:05:55

Seems to apply cleanly on Sage-4.6.2 without anything else.


---

Comment by novoselt created at 2011-04-06 04:27:54

Changing status from needs_review to needs_info.


---

Comment by novoselt created at 2011-04-06 04:27:54

I am having second thoughts about preimage fans: shouldn't they be full fans that are mapped into a given cone? Rather then be generated by cones whose relative interior is mapped into the relative interior of the given one. I am convinced now that `preimage_cones` does the correct thing, but for `preimage_fan` it seems a bit weird.

The reason why I didn't think enough about it before is that for the moment I only needed the kernel fan where both approaches give the same result.


---

Comment by novoselt created at 2011-04-24 19:00:13

Rebased the patch on top of new PPL interface and implemented the change in the above comment: the preimage fan consists of all cones mapped into the given one, no matter whether they are its preimage cones or not. Ready for review once again!


---

Comment by novoselt created at 2011-04-24 19:00:13

Changing status from needs_info to needs_review.


---

Attachment


---

Comment by vbraun created at 2011-05-05 12:45:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2011-05-05 12:45:47

I agree with the definitions. Looks good to me!


---

Comment by jdemeyer created at 2011-05-27 12:01:46

Resolution: fixed
