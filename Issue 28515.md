# Issue 28515: Make sagelib pip-installable in a conda environment

archive/issues_028515.json:
```json
{
    "body": "CC:  @isuruf @saraedum @dimpase @embray @timokau @tscrim\n\nThe goal of this ticket is to make sagelib (i.e., subdirectory `SAGEROOT/src`) pip-installable when all required packages are provided by the conda distribution -- just through `SAGEROOT/src/setup.py` and completely bypassing all sage-the-distribution scripts (top-level `SAGEROOT/Makefile` and `SAGEROOT/build`.\n\n* Add `SAGEROOT/src/environment.yml` - describes all conda packages needed for installing sagelib for doing sagelib development (this is different from `SAGEROOT/environment.yml` introduced in #28745)\n* #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)\n* #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`\n\nOptional steps:\n* #21559: Move sage-the-distribution scripts from src/bin to build/bin\n* #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)\n* #21573: Make sure src/setup.py respects --install-base and --root\n* #21654: `src/setup.py`: Disentangle cleaning of stale installed files in build directory and in install directory\n* #21678: Testsuite for `src/setup.py`\n* #21707: Split `sage-env` into `sage-build-env` and `sage-env`\n* #22655: Support `package_data`-like of non-Python resource files in Python packages\n* #23747: Rename `SAGE_ROOT/build` to `SAGE_ROOT/sage-distro`, `SAGE_ROOT/src` to `SAGE_ROOT/sagelib`\n* #21516: Fix sagelib sdist (src/setup.py sdist)\n\n(see also earlier task ticket #21507: Make sagelib a pip-installable Python source package, listed on PyPI.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/28752\n\n",
    "created_at": "2019-11-17T21:35:40Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Make sagelib pip-installable in a conda environment",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28515",
    "user": "@mkoeppe"
}
```
CC:  @isuruf @saraedum @dimpase @embray @timokau @tscrim

The goal of this ticket is to make sagelib (i.e., subdirectory `SAGEROOT/src`) pip-installable when all required packages are provided by the conda distribution -- just through `SAGEROOT/src/setup.py` and completely bypassing all sage-the-distribution scripts (top-level `SAGEROOT/Makefile` and `SAGEROOT/build`.

* Add `SAGEROOT/src/environment.yml` - describes all conda packages needed for installing sagelib for doing sagelib development (this is different from `SAGEROOT/environment.yml` introduced in #28745)
* #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
* #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`

Optional steps:
* #21559: Move sage-the-distribution scripts from src/bin to build/bin
* #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
* #21573: Make sure src/setup.py respects --install-base and --root
* #21654: `src/setup.py`: Disentangle cleaning of stale installed files in build directory and in install directory
* #21678: Testsuite for `src/setup.py`
* #21707: Split `sage-env` into `sage-build-env` and `sage-env`
* #22655: Support `package_data`-like of non-Python resource files in Python packages
* #23747: Rename `SAGE_ROOT/build` to `SAGE_ROOT/sage-distro`, `SAGE_ROOT/src` to `SAGE_ROOT/sagelib`
* #21516: Fix sagelib sdist (src/setup.py sdist)

(see also earlier task ticket #21507: Make sagelib a pip-installable Python source package, listed on PyPI.)

Issue created by migration from https://trac.sagemath.org/ticket/28752





---

archive/issue_comments_402695.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402695",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_402696.json:
```json
{
    "body": "Changing keywords from \"\" to \"Anaconda\".",
    "created_at": "2020-01-13T18:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402696",
    "user": "@mkoeppe"
}
```

Changing keywords from "" to "Anaconda".



---

archive/issue_comments_402697.json:
```json
{
    "body": "Changing keywords from \"Anaconda\" to \"Anaconda, conda\".",
    "created_at": "2020-01-13T18:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402697",
    "user": "@mkoeppe"
}
```

Changing keywords from "Anaconda" to "Anaconda, conda".



---

archive/issue_comments_402698.json:
```json
{
    "body": "Changing keywords from \"Anaconda, conda\" to \"conda\".",
    "created_at": "2020-01-13T18:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402698",
    "user": "@mkoeppe"
}
```

Changing keywords from "Anaconda, conda" to "conda".



---

archive/issue_comments_402699.json:
```json
{
    "body": "This might work already with the pip-installable tarball generated by `./sage -sh -c build/pkgs/sagelib/spkg-src` in #29950",
    "created_at": "2020-06-28T23:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402699",
    "user": "@mkoeppe"
}
```

This might work already with the pip-installable tarball generated by `./sage -sh -c build/pkgs/sagelib/spkg-src` in #29950



---

archive/issue_comments_402700.json:
```json
{
    "body": "Changing keywords from \"conda\" to \"conda, sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402700",
    "user": "@mkoeppe"
}
```

Changing keywords from "conda" to "conda, sd111".



---

archive/issue_comments_402701.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28515#issuecomment-402701",
    "user": "@mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111
