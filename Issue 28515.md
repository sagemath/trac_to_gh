# Issue 28515: Make sagelib pip-installable in a conda environment

Issue created by migration from https://trac.sagemath.org/ticket/28752

Original creator: mkoeppe

Original creation time: 2019-11-17 21:35:40

CC:  isuruf saraedum dimpase embray @timokau tscrim

The goal of this ticket is to make sagelib (i.e., subdirectory `SAGEROOT/src`) pip-installable when all required packages are provided by the conda distribution -- just through `SAGEROOT/src/setup.py` and completely bypassing all sage-the-distribution scripts (top-level `SAGEROOT/Makefile` and `SAGEROOT/build`.

* Add `SAGEROOT/src/environment.yml` - describes all conda packages needed for installing sagelib for doing sagelib development (this is different from `SAGEROOT/environment.yml` introduced in #28745)
* #21569: Install `src/bin/*` scripts via `setup.py` (`scripts`, `console_scripts`)
* #21785: Installation of `SAGE_SRC/ext/` in `SAGE_LOCAL/share/sage/ext/` should be done by `setup.py`, not `build/make/Makefile`

Optional steps:
* #21559: Move sage-the-distribution scripts from src/bin to build/bin
* #21570: Move non-scripts of `src/bin/` elsewhere (and also move their install location)
* #21573: Make sure src/setup.py respects --install-base and --root
* #21654: `src/setup.py`: Disentangle cleaning of stale installed files in build directory and in install directory
* #21678: Testsuite for `src/setup.py`
* #21707: Split `sage-env` into `sage-build-env` and `sage-env`
* #22655: Support `package_data`-like of non-Python resource files in Python packages
* #23747: Rename `SAGE_ROOT/build` to `SAGE_ROOT/sage-distro`, `SAGE_ROOT/src` to `SAGE_ROOT/sagelib`
* #21516: Fix sagelib sdist (src/setup.py sdist)

(see also earlier task ticket #21507: Make sagelib a pip-installable Python source package, listed on PyPI.)


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-01-13 18:13:18

Changing keywords from "" to "Anaconda".


---

Comment by mkoeppe created at 2020-01-13 18:14:34

Changing keywords from "Anaconda" to "Anaconda, conda".


---

Comment by mkoeppe created at 2020-01-13 18:16:13

Changing keywords from "Anaconda, conda" to "conda".


---

Comment by mkoeppe created at 2020-06-28 23:13:08

This might work already with the pip-installable tarball generated by `./sage -sh -c build/pkgs/sagelib/spkg-src` in #29950


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "conda" to "conda, sd111".


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111
