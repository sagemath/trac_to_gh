# Issue 25969: py3: problem in coercion of quotients of polynomials

archive/issues_025969.json:
```json
{
    "body": "CC:  @embray @jdemeyer @tscrim\n\n\n```\nsage: R.<x> = PolynomialRing(ZZ)\nsage: S = R.quo(x^2-4)\nsage: f=S(x*x-x)\nsage: S.retract(S.lift(f))\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-18-cedeb2a4ca82> in <module>()\n----> 1 S.retract(S.lift(f))\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)\n    593                 return self.element_class(self, self.__ring(x.lift()), check=False)\n    594         # any ring that coerces to the base ring of this polynomial ring.\n--> 595         return self._coerce_try(x, [self.polynomial_ring()])\n    596 \n    597     ############################################\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()\n    276              v -- parent object or list (iterator) of parent objects\n    277         \"\"\"\n--> 278         check_old_coerce(self)\n    279         if not isinstance(v, list):\n    280             v = [v]\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()\n     41 cdef inline check_old_coerce(Parent p):\n     42     if p._element_constructor is not None:\n---> 43         raise RuntimeError(\"%s still using old coercion framework\" % p)\n     44 \n     45 \n\nRuntimeError: Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x^2 - 4 still using old coercion framework\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26206\n\n",
    "created_at": "2018-09-07T10:07:40Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "py3: problem in coercion of quotients of polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25969",
    "user": "https://github.com/fchapoton"
}
```
CC:  @embray @jdemeyer @tscrim


```
sage: R.<x> = PolynomialRing(ZZ)
sage: S = R.quo(x^2-4)
sage: f=S(x*x-x)
sage: S.retract(S.lift(f))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-18-cedeb2a4ca82> in <module>()
----> 1 S.retract(S.lift(f))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)
    593                 return self.element_class(self, self.__ring(x.lift()), check=False)
    594         # any ring that coerces to the base ring of this polynomial ring.
--> 595         return self._coerce_try(x, [self.polynomial_ring()])
    596 
    597     ############################################

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()
    276              v -- parent object or list (iterator) of parent objects
    277         """
--> 278         check_old_coerce(self)
    279         if not isinstance(v, list):
    280             v = [v]

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()
     41 cdef inline check_old_coerce(Parent p):
     42     if p._element_constructor is not None:
---> 43         raise RuntimeError("%s still using old coercion framework" % p)
     44 
     45 

RuntimeError: Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x^2 - 4 still using old coercion framework
```


Issue created by migration from https://trac.sagemath.org/ticket/26206





---

archive/issue_comments_365810.json:
```json
{
    "body": "minimal failure:\n\n```\nsage: R.<x> = QQ[]\nsage: S.<t> = R.quotient(R.cyclotomic_polynomial(3))\nsage: t*t\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-8-22391384ee54> in <module>()\n----> 1 t*t\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12228)()\n   1532         cdef int cl = classify_elements(left, right)\n   1533         if HAVE_SAME_PARENT(cl):\n-> 1534             return (<Element>left)._mul_(right)\n   1535         if BOTH_ARE_ELEMENT(cl):\n   1536             return coercion_model.bin_op(left, right, mul)\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement._mul_ (build/cythonized/sage/structure/element.c:18023)()\n   2546 \n   2547 cdef class RingElement(ModuleElement):\n-> 2548     cpdef _mul_(self, other):\n   2549         \"\"\"\n   2550         Abstract multiplication method\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods._mul_parent (build/cythonized/sage/categories/coercion_methods.c:2285)()\n     51         True\n     52     \"\"\"\n---> 53     return (<Element>self)._parent.product(self, other)\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/magmas.py in product(self, x, y)\n   1158                 assert(x in self)\n   1159                 assert(y in self)\n-> 1160                 return self.retract(self.lift(x) * self.lift(y))\n   1161 \n   1162     class Realizations(RealizationsCategory):\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)\n    593                 return self.element_class(self, self.__ring(x.lift()), check=False)\n    594         # any ring that coerces to the base ring of this polynomial ring.\n--> 595         return self._coerce_try(x, [self.polynomial_ring()])\n    596 \n    597     ############################################\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()\n    276              v -- parent object or list (iterator) of parent objects\n    277         \"\"\"\n--> 278         check_old_coerce(self)\n    279         if not isinstance(v, list):\n    280             v = [v]\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()\n     41 cdef inline check_old_coerce(Parent p):\n     42     if p._element_constructor is not None:\n---> 43         raise RuntimeError(\"%s still using old coercion framework\" % p)\n     44 \n     45 \n\nRuntimeError: Univariate Quotient Polynomial Ring in t over Rational Field with modulus x^2 + x + 1 still using old coercion framework\n```\n\n\nEDIT: `t._mul_??` does not give the same answer in python2 and python3.",
    "created_at": "2018-09-12T11:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365810",
    "user": "https://github.com/fchapoton"
}
```

minimal failure:

```
sage: R.<x> = QQ[]
sage: S.<t> = R.quotient(R.cyclotomic_polynomial(3))
sage: t*t
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-8-22391384ee54> in <module>()
----> 1 t*t

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12228)()
   1532         cdef int cl = classify_elements(left, right)
   1533         if HAVE_SAME_PARENT(cl):
-> 1534             return (<Element>left)._mul_(right)
   1535         if BOTH_ARE_ELEMENT(cl):
   1536             return coercion_model.bin_op(left, right, mul)

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement._mul_ (build/cythonized/sage/structure/element.c:18023)()
   2546 
   2547 cdef class RingElement(ModuleElement):
-> 2548     cpdef _mul_(self, other):
   2549         """
   2550         Abstract multiplication method

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods._mul_parent (build/cythonized/sage/categories/coercion_methods.c:2285)()
     51         True
     52     """
---> 53     return (<Element>self)._parent.product(self, other)

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/magmas.py in product(self, x, y)
   1158                 assert(x in self)
   1159                 assert(y in self)
-> 1160                 return self.retract(self.lift(x) * self.lift(y))
   1161 
   1162     class Realizations(RealizationsCategory):

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)
    593                 return self.element_class(self, self.__ring(x.lift()), check=False)
    594         # any ring that coerces to the base ring of this polynomial ring.
--> 595         return self._coerce_try(x, [self.polynomial_ring()])
    596 
    597     ############################################

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()
    276              v -- parent object or list (iterator) of parent objects
    277         """
--> 278         check_old_coerce(self)
    279         if not isinstance(v, list):
    280             v = [v]

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()
     41 cdef inline check_old_coerce(Parent p):
     42     if p._element_constructor is not None:
---> 43         raise RuntimeError("%s still using old coercion framework" % p)
     44 
     45 

RuntimeError: Univariate Quotient Polynomial Ring in t over Rational Field with modulus x^2 + x + 1 still using old coercion framework
```


EDIT: `t._mul_??` does not give the same answer in python2 and python3.



---

archive/issue_comments_365811.json:
```json
{
    "body": "In python3, `_mul_` redirects to `_mul_parent`, which fails just as it fails in python2.",
    "created_at": "2018-09-12T11:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365811",
    "user": "https://github.com/fchapoton"
}
```

In python3, `_mul_` redirects to `_mul_parent`, which fails just as it fails in python2.



---

archive/issue_comments_365812.json:
```json
{
    "body": "help required, please, for this annoying coercion problem in python3.",
    "created_at": "2018-09-12T12:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365812",
    "user": "https://github.com/fchapoton"
}
```

help required, please, for this annoying coercion problem in python3.



---

archive/issue_comments_365813.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-09-12T12:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365813",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_365814.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2018-09-12T14:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365814",
    "user": "https://github.com/embray"
}
```

Resolution: duplicate



---

archive/issue_events_024142.json:
```json
{
    "actor": "@embray",
    "created_at": "2018-09-12T14:34:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25969#event-24142"
}
```



---

archive/issue_comments_365815.json:
```json
{
    "body": "This is really a dupe of #24955.",
    "created_at": "2018-09-12T14:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25969#issuecomment-365815",
    "user": "https://github.com/embray"
}
```

This is really a dupe of #24955.
