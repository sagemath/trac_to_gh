# Issue 25969: py3: problem in coercion of quotients of polynomials

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-09-07 10:07:40

CC:  embray jdemeyer tscrim


```
sage: R.<x> = PolynomialRing(ZZ)
sage: S = R.quo(x^2-4)
sage: f=S(x*x-x)
sage: S.retract(S.lift(f))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-18-cedeb2a4ca82> in <module>()
----> 1 S.retract(S.lift(f))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)
    593                 return self.element_class(self, self.__ring(x.lift()), check=False)
    594         # any ring that coerces to the base ring of this polynomial ring.
--> 595         return self._coerce_try(x, [self.polynomial_ring()])
    596 
    597     ############################################

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()
    276              v -- parent object or list (iterator) of parent objects
    277         """
--> 278         check_old_coerce(self)
    279         if not isinstance(v, list):
    280             v = [v]

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()
     41 cdef inline check_old_coerce(Parent p):
     42     if p._element_constructor is not None:
---> 43         raise RuntimeError("%s still using old coercion framework" % p)
     44 
     45 

RuntimeError: Univariate Quotient Polynomial Ring in xbar over Integer Ring with modulus x^2 - 4 still using old coercion framework
```



---

Comment by chapoton created at 2018-09-12 11:48:51

minimal failure:

```
sage: R.<x> = QQ[]
sage: S.<t> = R.quotient(R.cyclotomic_polynomial(3))
sage: t*t
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-8-22391384ee54> in <module>()
----> 1 t*t

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12228)()
   1532         cdef int cl = classify_elements(left, right)
   1533         if HAVE_SAME_PARENT(cl):
-> 1534             return (<Element>left)._mul_(right)
   1535         if BOTH_ARE_ELEMENT(cl):
   1536             return coercion_model.bin_op(left, right, mul)

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement._mul_ (build/cythonized/sage/structure/element.c:18023)()
   2546 
   2547 cdef class RingElement(ModuleElement):
-> 2548     cpdef _mul_(self, other):
   2549         """
   2550         Abstract multiplication method

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods._mul_parent (build/cythonized/sage/categories/coercion_methods.c:2285)()
     51         True
     52     """
---> 53     return (<Element>self)._parent.product(self, other)

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/magmas.py in product(self, x, y)
   1158                 assert(x in self)
   1159                 assert(y in self)
-> 1160                 return self.retract(self.lift(x) * self.lift(y))
   1161 
   1162     class Realizations(RealizationsCategory):

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py in _coerce_impl(self, x)
    593                 return self.element_class(self, self.__ring(x.lift()), check=False)
    594         # any ring that coerces to the base ring of this polynomial ring.
--> 595         return self._coerce_try(x, [self.polynomial_ring()])
    596 
    597     ############################################

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.Parent._coerce_try (build/cythonized/sage/structure/parent_old.c:5836)()
    276              v -- parent object or list (iterator) of parent objects
    277         """
--> 278         check_old_coerce(self)
    279         if not isinstance(v, list):
    280             v = [v]

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/structure/parent_old.pyx in sage.structure.parent_old.check_old_coerce (build/cythonized/sage/structure/parent_old.c:2637)()
     41 cdef inline check_old_coerce(Parent p):
     42     if p._element_constructor is not None:
---> 43         raise RuntimeError("%s still using old coercion framework" % p)
     44 
     45 

RuntimeError: Univariate Quotient Polynomial Ring in t over Rational Field with modulus x^2 + x + 1 still using old coercion framework
```


EDIT: `t._mul_??` does not give the same answer in python2 and python3.


---

Comment by chapoton created at 2018-09-12 11:59:08

In python3, `_mul_` redirects to `_mul_parent`, which fails just as it fails in python2.


---

Comment by chapoton created at 2018-09-12 12:01:14

help required, please, for this annoying coercion problem in python3.


---

Comment by chapoton created at 2018-09-12 12:01:44

Changing status from new to needs_info.


---

Comment by embray created at 2018-09-12 14:34:33

Resolution: duplicate


---

Comment by embray created at 2018-09-12 14:34:33

This is really a dupe of #24955.
