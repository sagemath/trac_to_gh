# Issue 15319: Convert Stein-Watkins database to git spkg format

Issue created by migration from https://trac.sagemath.org/ticket/15556

Original creator: cremona

Original creation time: 2013-12-20 12:13:39

Keywords: elliptic curves, databases

There are two optional spkgs containing small and full version of the Stein-Watkins database of elliptic curves, namely database_stein_watkins_mini.p0.spkg (the small version, approximately 20mb) and stein-watkins-ecdb.p0.spkg (the huge version, approximately 2.7gb).

Both should be converted to the new git format for spkgs, at the same time making their names more consistent and completing their SPKG.txt information.  The interface in sage/databases/stein-watkins.py will need to be tested.


---

Comment by cremona created at 2013-12-20 20:05:32

Done both.

The new package files have been uploaded to sagemath in /home/cremona:

```
-rw-r--r-- 1 cremona cremona   19935714 Dec 20 09:19 database_stein_watkins_mini-20131220.tar.bz2
-rw-r--r-- 1 cremona cremona 2784729140 Dec 20 10:48 database_stein_watkins-20131220.tar.bz2
```


Installing even the small one is not very quick, and the long one quite slow.  The optional doctests in sage/da\
tabases/stein_watkins.py will work with only the mini package; remember to add --optional=stein_watkins_databas\
e to the command line or you'll not be checking much!


---

Comment by cremona created at 2013-12-20 20:06:59

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-12-23 10:22:09

Various details:
 1. use `cp -R` instead of `cp -rf`
 2. omit the version check (you're adding a check for version 6.x to a file which only exists in version 6.x)
 3. replace `$SAGE_LOCAL/share` by `$SAGE_SHARE`
 4. replace

```
if [ "x${SAGE_LOCAL}" = x ]; then
   echo "SAGE_LOCAL undefined ... exiting"
   echo "Maybe run 'sage -sh'?"
   exit 1
fi
```

by

```
if [ -z "$SAGE_SHARE" ]; then
    echo >&2 "SAGE_SHARE undefined ... exiting"
    echo >&2 "Maybe run 'sage --sh'?"
    exit 1
fi
```



---

Comment by git created at 2013-12-23 10:42:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2013-12-23 10:44:57

Replying to [comment:7 jdemeyer]:
> Various details:
>  1. use `cp -R` instead of `cp -rf`

done

>  2. omit the version check (you're adding a check for version 6.x to a file which only exists in version 6.x)

done

>  3. replace `$SAGE_LOCAL/share` by `$SAGE_SHARE`

done

>  4. replace
> {{{
> if [ "x${SAGE_LOCAL}" = x ]; then
>    echo "SAGE_LOCAL undefined ... exiting"
>    echo "Maybe run 'sage -sh'?"
>    exit 1
> fi
> }}}
> by
> {{{
> if [ -z "$SAGE_SHARE" ]; then
>     echo >&2 "SAGE_SHARE undefined ... exiting"
>     echo >&2 "Maybe run 'sage --sh'?"
>     exit 1
> fi
> }}}

done (all in both database_stein_watkins and ...mini).  New commit pushed.
----
New commits:


---

Comment by cremona created at 2013-12-23 10:46:22

Replying to [comment:7 jdemeyer]:
> Various details:
>  1. use `cp -R` instead of `cp -rf`

done

>  2. omit the version check (you're adding a check for version 6.x to a file which only exists in version 6.x)

done

>  3. replace `$SAGE_LOCAL/share` by `$SAGE_SHARE`

done

>  4. replace
> {{{
> if [ "x${SAGE_LOCAL}" = x ]; then
>    echo "SAGE_LOCAL undefined ... exiting"
>    echo "Maybe run 'sage -sh'?"
>    exit 1
> fi
> }}}
> by
> {{{
> if [ -z "$SAGE_SHARE" ]; then
>     echo >&2 "SAGE_SHARE undefined ... exiting"
>     echo >&2 "Maybe run 'sage --sh'?"
>     exit 1
> fi
> }}}

done (all in both database_stein_watkins and ...mini).  New commit pushed.  Wait though since there is a typo and a new one is coming up.
----
New commits:
----
New commits:


---

Comment by git created at 2013-12-23 10:54:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2013-12-23 10:58:03

For the `VERSION` of the package, would it not make more sense to use the date of the database itself, as supposed of the date of the packaging? So the version number would be `20030423.p1`


---

Comment by cremona created at 2013-12-23 11:09:30

Replying to [comment:12 jdemeyer]:
> For the `VERSION` of the package, would it not make more sense to use the date of the database itself, as supposed of the date of the packaging? So the version number would be `20030423.p1`

Possibly.  The people who should really decide that are S&W themselves.  Rather more important, there were some changes to the 2003 data made in 2007 and I am not sure whether the files in this version include those changes or not.  I did *not* intend to change the data in the spkg at all with this ticket, only the packaging of it.  So I used a data which related to the packaging, not the data itself.

If in fact the data in here is the original 2003 version (something I will check, but not today) then one possibility would be to use the 2003 date for the version now, and change it to a 2007 date for a revision.  Then it would be clear exactly what is what.

It would still be helpful to know if the new packages do install and test correctly, even if we change the version before committing to this.


---

Comment by jdemeyer created at 2013-12-23 11:18:40

My comment about the version check applies also to `database_cremona_ellcurve` so you can remove that also.


---

Comment by jdemeyer created at 2013-12-23 11:27:37

Replying to [comment:13 cremona]:
> The people who should really decide that are S&W themselves.
I don't see why. They are welcome to have an opinion, but I don't think we need to ask every upstream project how it should be included in Sage.

> Rather more important, there were some changes to the 2003 data made in 2007 and I am not sure whether the files in this version include those changes or not.
I checked and those changes are not included, the data is from 2003.

> If in fact the data in here is the original 2003 version (something I will check, but not today) then one possibility would be to use the 2003 date for the version now, and change it to a 2007 date for a revision.  Then it would be clear exactly what is what.
I totally agree with this. That's another reason why the version number should refer to the date of the database, to reduce such confusion. The date of today when you packaged the database is not relevant for anything.

> It would still be helpful to know if the new packages do install and test correctly, even if we change the version before committing to this.
Of course, I will check that.


---

Comment by cremona created at 2013-12-23 11:31:26

Replying to [comment:14 jdemeyer]:
> My comment about the version check applies also to `database_cremona_ellcurve` so you can remove that also.

I think that should be on another ticket.

I did use that one as a model for this one (I was not the author of it!)


---

Comment by cremona created at 2013-12-23 11:33:58

Replying to [comment:15 jdemeyer]:
> Replying to [comment:13 cremona]:
> > The people who should really decide that are S&W themselves.
> I don't see why. They are welcome to have an opinion, but I don't think we need to ask every upstream project how it should be included in Sage.
> 
> > Rather more important, there were some changes to the 2003 data made in 2007 and I am not sure whether the files in this version include those changes or not.
> I checked and those changes are not included, the data is from 2003.
> 
> > If in fact the data in here is the original 2003 version (something I will check, but not today) then one possibility would be to use the 2003 date for the version now, and change it to a 2007 date for a revision.  Then it would be clear exactly what is what.
> I totally agree with this. That's another reason why the version number should refer to the date of the database, to reduce such confusion. The date of today when you packaged the database is not relevant for anything.

ok, I will change it to what you suggested.  This will mean renamed upstream tarballs and so possibly also checksums.  And a second ticket to update both to include the 2007 fixes.

> 
> > It would still be helpful to know if the new packages do install and test correctly, even if we change the version before committing to this.
> Of course, I will check that.


---

Comment by jdemeyer created at 2013-12-23 12:28:36

Replying to [comment:16 cremona]:
> Replying to [comment:14 jdemeyer]:
> > My comment about the version check applies also to `database_cremona_ellcurve` so you can remove that also.
> 
> I think that should be on another ticket.
Sorry, but I disagree. You're already making modifications to `build/pkgs/database_cremona_ellcurve/spkg-install` on this ticket. It's pointless for me to review these changes in code which a new ticket will probably remove.


---

Comment by jdemeyer created at 2013-12-23 12:32:17

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2013-12-23 12:36:47

Replying to [comment:18 jdemeyer]:

> > > My comment about the version check applies also to `database_cremona_ellcurve` so you can remove that also.
> > 
> > I think that should be on another ticket.
> Sorry, but I disagree. You're already making modifications to `build/pkgs/database_cremona_ellcurve/spkg-install` on this ticket. It's pointless for me to review these changes in code which a new ticket will probably remove.

Of course -- I had forgotten that.  It Will Be Done.


---

Comment by jdemeyer created at 2013-12-23 12:38:38

The files inside the upstream tarballs must all have permission 644 (world-readable), otherwise they will not work for users besides the one who installed the database.


---

Comment by cremona created at 2013-12-23 16:00:06

Replying to [comment:21 jdemeyer]:
> The files inside the upstream tarballs must all have permission 644 (world-readable), otherwise they will not work for users besides the one who installed the database.
OK, have done that (and changed the names of these in the ticket description).


---

Comment by jdemeyer created at 2013-12-24 09:44:52

The second link gives

```
Forbidden

You don't have permission to access /home/cremona/database_stein_watkins-20030423.tar.bz2 on this server.
```



---

Comment by cremona created at 2013-12-24 10:19:41

Replying to [comment:25 jdemeyer]:
> The second link gives
> {{{
> Forbidden
> 
> You don't have permission to access /home/cremona/database_stein_watkins-20030423.tar.bz2 on this server.
> }}}

I fixed that and it is again ready for re-review, I have pushed anew commit, but will not respond until after the holiday so there is no rush!


---

Comment by git created at 2013-12-24 10:25:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2013-12-24 10:39:53

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-12-25 12:49:23

The tarball link in the ticket description is probably incorrect, it uses a package date from 2003 instead of 2013?


---

Comment by jdemeyer created at 2013-12-25 19:52:51

Replying to [comment:29 vbraun]:
> The tarball link in the ticket description is probably incorrect, it uses a package date from 2003 instead of 2013?
2003 is correct. The contents of the database in the tarball (which is what matters) are from the day in the version number.


---

Comment by vbraun created at 2013-12-25 20:13:55

OK, thanks. The implementation looks good. We must change the license to something other than "None", as no license technically means all right reserved and no permission to distribute whatsoever. Per William's post this should be "Public domain"


---

Comment by jdemeyer created at 2013-12-26 09:51:35

Replying to [comment:31 vbraun]:
> OK, thanks. The implementation looks good. We must change the license to something other than "None", as no license technically means all right reserved and no permission to distribute whatsoever. Per William's post this should be "Public domain"
IANAL, but I thought that pure data is not copyrighted and therefore is automatically public domain...


---

Comment by vbraun created at 2013-12-26 21:08:41

There is no copyright for facts, but there is for how they are presented. And the bar is really low for what constitutes an original presentation. E.g. the information in the yellow pages is not protected, but the layout and arrangement of the printed yellow pages is.


---

Comment by jdemeyer created at 2013-12-27 10:12:46

Replying to [comment:31 vbraun]:
> Per William's post this should be "Public domain"
Link please.


---

Comment by jdemeyer created at 2013-12-27 12:30:31

Additional commit needs review.
----
New commits:


---

Comment by git created at 2013-12-27 13:13:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-12-27 13:55:29

https://groups.google.com/d/msg/sage-devel/onWFAVz-LDA/wj7FAsabIpkJ

anybody can use them however they want = public domain


---

Comment by cremona created at 2013-12-27 15:44:53

Thanks for tidying this up, Jeroen.  I can see the point in removing the optional tags and also renaming the optional flag to match the spkg name.  The new version works for me, so shall we mutually approve each other's commits?  [I did need to remember to do "--optional=sage,database_stein_watkins" to do the testing.]

My intention had been to go straight on to revising this to include the (very slightly different) 2007 data, building on this branch.  I am not sure whether we should ask for the commits so far to be merged before doing that.  It will only require:  making new versions of the upstream tarballs with version date being 2007???? (the fixed files are dated June 16, June 25, and Aug 25 and 27, so perhaps we should take the latest date) and changing both packa-version.txt files to the same date.


---

Comment by jdemeyer created at 2013-12-28 10:34:57

Replying to [comment:39 cremona]:
> My intention had been to go straight on to revising this to include the (very slightly different) 2007 data, building on this branch.  I am not sure whether we should ask for the commits so far to be merged before doing that.  It will only require:  making new versions of the upstream tarballs with version date being 2007???? (the fixed files are dated June 16, June 25, and Aug 25 and 27, so perhaps we should take the latest date) and changing both packa-version.txt files to the same date.
Do as you wish, for me it's fine either way.


---

Comment by cremona created at 2013-12-29 13:52:54

I'm going to make the 2007 upgrade into another ticket (dependent on this one), which I will cross-ref here when it has been created.  So this one can have a positive review.


---

Comment by jdemeyer created at 2013-12-29 13:55:39

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2013-12-29 14:00:23

See #15607 for the follow-up ticket.


---

Comment by vbraun created at 2014-01-05 00:45:51

Resolution: fixed
