# Issue 15002: Nondegeneracy for subschemes of toric varieties

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2013-09-29 13:38:39

CC:  kedlaya ursula asalerno edgarcosta

Nondegeneracy is a weaker version of smoothness, that is actually comparatively easy to implement (relative to the existing `is_smooth`). This branch implements smoothness.


---

Comment by git created at 2013-09-29 13:39:18

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by vbraun created at 2013-09-29 13:53:46

Changing status from new to needs_review.


---

Comment by ursula created at 2014-08-08 16:13:56

Compare Example 3.2.5 of Helmut A. Hamm, "Differential forms and Hodge numbers for toric complete intersections" ( http://arxiv.org/abs/1106.1826 ).  That example gives a hypersurface that is not non-degenerate.  It's worked out in a patch, but I think the following test with a homogeneous polynomial is equivalent:


```

X = toric_varieties.WP([1,4,2,3], names='z0 z1 z2 z3')

X.inject_variables()

g0 =z1^3 + z2^6 +z3^4

g = g0-2*z2^3*z0^6+z2*z0^10+z0^12

hyp = X.subscheme([g])
```



Right now, hyp.is_nondegenerate() returns True, but Hamm says it should return False.  The problem may be that the current code only checks at top-dimensional cones, rather than checking at all cones in the fan?


---

Comment by ursula created at 2014-08-08 16:13:56

Changing status from needs_review to needs_work.


---

Comment by kedlaya created at 2016-03-22 05:07:11

To add some urgency to this, Edgar Costa, David Harvey, and I are working on computing zeta functions of nondegenerate hypersurfaces using p-adic cohomology, so we would find this routine very useful.

I don't really know how polytopes work in Sage, but it certainly looks like the code iterates over cones of all dimensions in the fan. Maybe there's a problem with the test for individual cones?


---

Comment by chapoton created at 2016-04-26 18:39:00

The example in the given reference is instead

```
g0 =z1^3 + z2^6 +z3^4
g = g0-2*z3^2*z0^6+z2*z0^10+z0^12
```

so the test in comment:6 is not a correct one.


---

Comment by kedlaya created at 2016-04-27 15:20:01

Replying to [comment:9 chapoton]:
> The example in the given reference is instead
> {{{
> g0 =z1^3 + z2^6 +z3^4
> g = g0-2*z3<sup>2*z0</sup>6+z2*z0<sup>10+z0</sup>12
> }}}
> so the test in comment:6 is not a correct one.

Here's a corrected test indicating the problem:

```
sage: X = toric_varieties.WP([1,4,2,3], names='z0 z1 z2 z3')
sage: X.inject_variables()
Defining z0, z1, z2, z3
sage: g0 =z1^3 + z2^6 +z3^4
sage: g = g0-2*z3^2*z0^6+z2*z0^10+z0^12
sage: hyp = X.subscheme([g])
sage: hyp.is_nondegenerate() # Should return False per Hamm
True
```



---

Comment by kedlaya created at 2016-04-27 16:10:49

I think I see the problem with this example. In `restrict`, at some point `Jac_patch` takes the value

```
Ideal (t0^12 - 2*t0^6*t3^2 + t3^4, 12*t0^11 - 12*t0^5*t3^2, 0, t0^10, -4*t0^6*t3 + 4*t3^3) of Multivariate Polynomial Ring in t0, t1, t2, t3, t4 over Rational Field
```

but the third value in the tuple ought to be 0. The point is that specializing to 0 does not commute with forming the Jacobian ideal when you have a linear factor of a monomial, that is, the line

```
Jac_patch = Jac.subs(patch)
```

is incorrect.


---

Comment by kedlaya created at 2016-04-27 16:25:26

There are also some subtleties surrounding the underlying mathematical concept. In particular, I would also take issue with this doctest:

```
sage: P1 = toric_varieties.P1()
sage: X = toric_varieties.P2_112().cartesian_product(P1)
sage: X.inject_variables()
Defining z0, z1, z2, z3, z4
sage: Y = X.subscheme([z4])    # = P2_112 x {point}
sage: Y.is_nondegenerate()
True
```

As far as I understand, nondegeneracy is only defined when you have a local complete intersection, and then the condition is that the intersection with each stratifying torus should be transversal. That's stronger than saying that the intersection should be lci, as in this example: the intersection of a smooth variety with itself is smooth but not transversal.

However, I struggle to find an "official" definition of nondegeneracy in the literature which would clear up this ambiguity. I've only ever seen it used for global complete intersections. So it would be okay to stick with the proposed definition here as long as (a) it is documented (as it currently is) and (b) it is computed correctly (not there yet).


---

Comment by kedlaya created at 2017-08-22 21:38:59

I recently learned that the term "sch√∂n" sometimes appears as a synonym for "nondegenerate" in this context. So we may also want to provide `is_schon` as an alias for `is_nondegenerate`.
----
New commits:


---

Comment by git created at 2017-08-23 18:38:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-23 20:14:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-23 20:21:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2017-08-23 20:22:56

I changed the internal computation to replace the restriction of the Jacobian to a face (incorrect) with the Jacobian of the restriction (correct). I also changed the definition of nondegeneracy in the docstring to handle the corner cases in the manner I proposed (namely, an intersection with the boundary which is not transversal should not count as nondegenerate, contrary to the original patch). I also added `is_schon` as an alias.

This could stand to have some more robust doctests; suggestions welcome.


---

Comment by kedlaya created at 2017-08-23 20:22:56

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-08-23 22:46:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2017-08-23 22:47:10

Added another doctest suggested by edgarcosta.


---

Comment by edgarcosta created at 2017-08-24 16:34:44

Rewrote the previous example and added a following up example
----
New commits:


---

Comment by git created at 2017-08-24 16:37:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2017-08-25 19:28:43

New commits:


---

Comment by kedlaya created at 2017-08-25 19:28:43

Changing keywords from "" to "days88".


---

Comment by edgarcosta created at 2017-08-25 20:14:57

New commits:


---

Comment by aly.deines created at 2017-08-25 21:22:35

Changing status from needs_review to needs_work.


---

Comment by aly.deines created at 2017-08-25 21:22:35

This looks good.  If you change:


```
sage: F = z0^2*z1^2*z2^2 + z1^2*z2^2*z3^2 + z0^2*z2^2*z4^2 + z2^2*z3^2*z4^2 +\
....: t*z0*z1*z2*z3*z4*z5 + z0^2*z1^2*z5^2 + z1^2*z3^2*z5^2 +\
....: z0^2*z4^2*z5^2 + z3^2*z4^2*z5^2
```


so that it wraps at 79 characters (even though here 72 is preferred)


```
sage: F = z0^2*z1^2*z2^2 + z1^2*z2^2*z3^2 + z0^2*z2^2*z4^2\
....: + z2^2*z3^2*z4^2 + t*z0*z1*z2*z3*z4*z5 + z0^2*z1^2*z5^2\
....: + z1^2*z3^2*z5^2 + z0^2*z4^2*z5^2 + z3^2*z4^2*z5^2
```


and the other two lines in the documentation that are too long, I'll give it a positive review.


---

Comment by aly.deines created at 2017-08-25 21:31:11

Changing status from needs_work to positive_review.


---

Comment by aly.deines created at 2017-08-25 21:31:11

Since someone grumbled. :)  I've made the changes and pushed them.
----
New commits:


---

Comment by vbraun created at 2017-08-29 19:51:19

Resolution: fixed
