# Issue 19727: tight complex interval inverse

archive/issues_019727.json:
```json
{
    "body": "CC:  @tscrim @videlec @dkrenn @jdemeyer tmonteil @cheuberg\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19964\n\n",
    "created_at": "2016-01-26T15:47:04Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "tight complex interval inverse",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19727",
    "user": "@miguelmarco"
}
```
CC:  @tscrim @videlec @dkrenn @jdemeyer tmonteil @cheuberg



Issue created by migration from https://trac.sagemath.org/ticket/19964





---

archive/issue_comments_271167.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-26T15:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271167",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271168.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-26T15:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271168",
    "user": "@miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271169.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to numerical.",
    "created_at": "2016-01-26T15:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271169",
    "user": "@miguelmarco"
}
```

Changing component from PLEASE CHANGE to numerical.



---

archive/issue_comments_271170.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-26T15:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271170",
    "user": "@miguelmarco"
}
```

New commits:



---

archive/issue_comments_271171.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-01-26T15:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271171",
    "user": "@miguelmarco"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_271172.json:
```json
{
    "body": "Changing keywords from \"\" to \"interval, root\".",
    "created_at": "2016-01-26T15:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271172",
    "user": "@miguelmarco"
}
```

Changing keywords from "" to "interval, root".



---

archive/issue_comments_271173.json:
```json
{
    "body": "Can you give an example which clearly illustrates the better bounds? Also, have you run timings versus the schoolbook version? (I don't have the technical abilities to review this ticket though.)",
    "created_at": "2016-01-26T16:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271173",
    "user": "@tscrim"
}
```

Can you give an example which clearly illustrates the better bounds? Also, have you run timings versus the schoolbook version? (I don't have the technical abilities to review this ticket though.)



---

archive/issue_comments_271174.json:
```json
{
    "body": "Added some examples to the description.",
    "created_at": "2016-01-26T17:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271174",
    "user": "@miguelmarco"
}
```

Added some examples to the description.



---

archive/issue_comments_271175.json:
```json
{
    "body": "Is this better in all cases?\n\n```diff\n-             0.?e-182 - 0.7598602580415435?*I,\n-             0.?e-249 + 0.7598602580415435?*I,\n+             0.?e-215 - 0.7598602580415435?*I,\n+             0.?e-229 + 0.7598602580415435?*I,\n```\n",
    "created_at": "2016-03-09T19:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271175",
    "user": "@videlec"
}
```

Is this better in all cases?

```diff
-             0.?e-182 - 0.7598602580415435?*I,
-             0.?e-249 + 0.7598602580415435?*I,
+             0.?e-215 - 0.7598602580415435?*I,
+             0.?e-229 + 0.7598602580415435?*I,
```




---

archive/issue_comments_271176.json:
```json
{
    "body": "It should be, up to floating point artifacts. I don't know much about the subtleties of floating point numbers though.",
    "created_at": "2016-03-09T19:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271176",
    "user": "@miguelmarco"
}
```

It should be, up to floating point artifacts. I don't know much about the subtleties of floating point numbers though.



---

archive/issue_comments_271177.json:
```json
{
    "body": "I was wondering about the `e-249` becoming a `e-229` in the above example...",
    "created_at": "2016-03-09T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271177",
    "user": "@videlec"
}
```

I was wondering about the `e-249` becoming a `e-229` in the above example...



---

archive/issue_comments_271178.json:
```json
{
    "body": "Yes, that is what i imagined, but i would guess that in those two cases the discrepancy is due to those pesky numerical artifacts that can appear just by, for example, performing the same operations in different order.",
    "created_at": "2016-03-09T19:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271178",
    "user": "@miguelmarco"
}
```

Yes, that is what i imagined, but i would guess that in those two cases the discrepancy is due to those pesky numerical artifacts that can appear just by, for example, performing the same operations in different order.



---

archive/issue_comments_271179.json:
```json
{
    "body": "IMHO the tests should cover all branches of the new implementation (ideally with test cases where the rounding modes matter, if that's not too hard to achieve).",
    "created_at": "2016-03-25T10:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271179",
    "user": "@mezzarobba"
}
```

IMHO the tests should cover all branches of the new implementation (ideally with test cases where the rounding modes matter, if that's not too hard to achieve).



---

archive/issue_comments_271180.json:
```json
{
    "body": "Following [comment:12 comment:12] I added a doctest. And I also removed the trailing whitespaces in a second commit.\n\nThis is good for me to go. Any remarks?\n----\nNew commits:",
    "created_at": "2016-04-05T19:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271180",
    "user": "@videlec"
}
```

Following [comment:12 comment:12] I added a doctest. And I also removed the trailing whitespaces in a second commit.

This is good for me to go. Any remarks?
----
New commits:



---

archive/issue_comments_271181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-05T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271181",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_271182.json:
```json
{
    "body": "lgtm except that I'd suggest the following change in order to really test all possible cases:\n\n```\n@@ -1130,12 +1130,15 @@ cdef class ComplexIntervalFieldElement(sage.structure.element.FieldElement):\n         Check that the code is valid in all regions of the complex plane::\n \n             sage: rats = [15423/906, 337/59976, 145151/145112]\n-            sage: for a in rats:\n-            ....:     for b in rats:\n-            ....:         x = CIF(a, b)\n-            ....:         assert (x * (~x) - 1).contains_zero()\n-            ....:         x = -CIF(a,b)\n-            ....:         assert (x * (~x) - 1).contains_zero()\n+            sage: ivs = [RIF(aa, bb) for a in rats for b in rats\n+            ....:                   for aa in [-a, a] for bb in [-b, b]\n+            ....:                   if aa <= bb]\n+            sage: for x in ivs:\n+            ....:     for y in ivs:\n+            ....:         z = CIF(x, y)\n+            ....:         inv = ~z\n+            ....:         assert ((z*inv - 1).contains_zero()\n+            ....:                 or z.contains_zero() and inv.real().is_NaN())\n```\n",
    "created_at": "2016-04-06T08:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271182",
    "user": "@mezzarobba"
}
```

lgtm except that I'd suggest the following change in order to really test all possible cases:

```
@@ -1130,12 +1130,15 @@ cdef class ComplexIntervalFieldElement(sage.structure.element.FieldElement):
         Check that the code is valid in all regions of the complex plane::
 
             sage: rats = [15423/906, 337/59976, 145151/145112]
-            sage: for a in rats:
-            ....:     for b in rats:
-            ....:         x = CIF(a, b)
-            ....:         assert (x * (~x) - 1).contains_zero()
-            ....:         x = -CIF(a,b)
-            ....:         assert (x * (~x) - 1).contains_zero()
+            sage: ivs = [RIF(aa, bb) for a in rats for b in rats
+            ....:                   for aa in [-a, a] for bb in [-b, b]
+            ....:                   if aa <= bb]
+            sage: for x in ivs:
+            ....:     for y in ivs:
+            ....:         z = CIF(x, y)
+            ....:         inv = ~z
+            ....:         assert ((z*inv - 1).contains_zero()
+            ....:                 or z.contains_zero() and inv.real().is_NaN())
```




---

archive/issue_comments_271183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T20:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271183",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271184.json:
```json
{
    "body": "You really don't want to test the cases where the interval contains zero `;-)`. But so be it.",
    "created_at": "2016-04-12T16:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271184",
    "user": "@mezzarobba"
}
```

You really don't want to test the cases where the interval contains zero `;-)`. But so be it.



---

archive/issue_comments_271185.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-12T16:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271185",
    "user": "@mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271186.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-13T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271186",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_271187.json:
```json
{
    "body": "Breakage: #22834",
    "created_at": "2017-04-20T08:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19727",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19727#issuecomment-271187",
    "user": "@jdemeyer"
}
```

Breakage: #22834
