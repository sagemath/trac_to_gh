# Issue 19727: tight complex interval inverse

Issue created by migration from https://trac.sagemath.org/ticket/19964

Original creator: mmarco

Original creation time: 2016-01-26 15:47:04

CC:  tscrim vdelecroix dkrenn jdemeyer tmonteil cheuberg




---

Comment by git created at 2016-01-26 15:55:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-01-26 15:59:27

Changing status from new to needs_review.


---

Comment by mmarco created at 2016-01-26 15:59:27

Changing component from PLEASE CHANGE to numerical.


---

Comment by mmarco created at 2016-01-26 15:59:27

New commits:


---

Comment by mmarco created at 2016-01-26 15:59:27

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mmarco created at 2016-01-26 15:59:27

Changing keywords from "" to "interval, root".


---

Comment by tscrim created at 2016-01-26 16:21:45

Can you give an example which clearly illustrates the better bounds? Also, have you run timings versus the schoolbook version? (I don't have the technical abilities to review this ticket though.)


---

Comment by mmarco created at 2016-01-26 17:31:51

Added some examples to the description.


---

Comment by vdelecroix created at 2016-03-09 19:02:09

Is this better in all cases?

```diff
-             0.?e-182 - 0.7598602580415435?*I,
-             0.?e-249 + 0.7598602580415435?*I,
+             0.?e-215 - 0.7598602580415435?*I,
+             0.?e-229 + 0.7598602580415435?*I,
```



---

Comment by mmarco created at 2016-03-09 19:24:12

It should be, up to floating point artifacts. I don't know much about the subtleties of floating point numbers though.


---

Comment by vdelecroix created at 2016-03-09 19:28:02

I was wondering about the `e-249` becoming a `e-229` in the above example...


---

Comment by mmarco created at 2016-03-09 19:35:26

Yes, that is what i imagined, but i would guess that in those two cases the discrepancy is due to those pesky numerical artifacts that can appear just by, for example, performing the same operations in different order.


---

Comment by mmezzarobba created at 2016-03-25 10:41:55

IMHO the tests should cover all branches of the new implementation (ideally with test cases where the rounding modes matter, if that's not too hard to achieve).


---

Comment by vdelecroix created at 2016-04-05 19:28:45

Following [comment:12 comment:12] I added a doctest. And I also removed the trailing whitespaces in a second commit.

This is good for me to go. Any remarks?
----
New commits:


---

Comment by git created at 2016-04-05 19:30:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2016-04-06 08:10:21

lgtm except that I'd suggest the following change in order to really test all possible cases:

```
@@ -1130,12 +1130,15 @@ cdef class ComplexIntervalFieldElement(sage.structure.element.FieldElement):
         Check that the code is valid in all regions of the complex plane::
 
             sage: rats = [15423/906, 337/59976, 145151/145112]
-            sage: for a in rats:
-            ....:     for b in rats:
-            ....:         x = CIF(a, b)
-            ....:         assert (x * (~x) - 1).contains_zero()
-            ....:         x = -CIF(a,b)
-            ....:         assert (x * (~x) - 1).contains_zero()
+            sage: ivs = [RIF(aa, bb) for a in rats for b in rats
+            ....:                   for aa in [-a, a] for bb in [-b, b]
+            ....:                   if aa <= bb]
+            sage: for x in ivs:
+            ....:     for y in ivs:
+            ....:         z = CIF(x, y)
+            ....:         inv = ~z
+            ....:         assert ((z*inv - 1).contains_zero()
+            ....:                 or z.contains_zero() and inv.real().is_NaN())
```



---

Comment by git created at 2016-04-07 20:14:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2016-04-12 16:01:10

You really don't want to test the cases where the interval contains zero `;-)`. But so be it.


---

Comment by mmezzarobba created at 2016-04-12 16:01:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-04-13 17:05:18

Resolution: fixed


---

Comment by jdemeyer created at 2017-04-20 08:51:17

Breakage: #22834
