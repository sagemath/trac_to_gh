# Issue 17787: Mutability of tableaux part II: replacing CombinatorialObject by ClonableList

Issue created by migration from https://trac.sagemath.org/ticket/18024

Original creator: darij

Original creation time: 2015-03-21 00:17:06

CC:  jkeitel jpswanson mariamonks opechenik tscrim

Keywords: permutation,

Jan Keitel's work. Depends on #15862 but probably needs to be merged with its current state.


---

Comment by darij created at 2015-03-21 00:26:31

Changing keywords from "permutation," to "tableaux, sage-combinat, mutability, ClonableList, days64".


---

Comment by git created at 2015-03-21 00:28:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-03-21 00:40:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-21 01:36:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-21 01:53:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-21 07:14:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-21 08:02:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-03-21 08:41:36

Done profiling this. The speed changes range from significant speedups to minor slowdowns, the latter being mainly on methods (such as Tableau's `restrict`) which ducktype the result as follows:

```
        # attempt to return a tableau of the same type
        try:
            return self.parent()( res )
        except Exception:
            try:
                return self.parent().Element( res )
            except Exception:
                return Tableau(res)
```


Also, two unpickling doctests are broken: one in ribbon_tableau.py, and one in ribbon_shape_tableau.py. One of them makes no sense to me, but the other might be worth salvaging.


---

Comment by darij created at 2015-03-21 08:41:36

Changing status from new to needs_review.


---

Comment by git created at 2015-03-21 08:41:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-03-21 12:16:36

Hello,

I just opened the branch to see what it does (I do not understand anything of the math involved here) and I noticed this change:


```
-                if not (i is None):
+                if i > 0 and not (i is None):
```


If `i` can be equal to `None`, you should probably write `not (i is None) and i > 0` instead (i.e. reverse the conditions).

Nathann


---

Comment by git created at 2015-03-21 15:35:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-21 15:40:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-03-21 15:46:19

New commits:


---

Comment by git created at 2015-03-21 18:59:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-23 00:41:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpswanson created at 2015-03-26 08:17:06

Thanks Darij for finishing off #15862. There's been a couple of commits on this one since it was set to needs_review and there's a work issue left. Is it ready for review after all?


---

Comment by darij created at 2015-03-26 15:45:42

It is ready modulo the two broken pickles.


---

Comment by git created at 2015-03-27 08:23:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-27 08:54:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-03-27 08:54:53

Good work. But I am not sure if we are supposed to delete these pickles...


---

Comment by jpswanson created at 2015-03-27 08:55:59

Made a few minor reviewer changes, so as soon as someone signs off on those we can call this good.

After looking into the old pickles issue, I decided to just remove them for the following reasons.
1. We had already removed a couple of old pickle tests and none of the contributors on this ticket had yet complained.
2. Frankly, I haven't found anyone who seems to really care about old pickles breaking, except for some old posts by William Stein. The most relevant sage-devel thread I found was [this one](https://groups.google.com/forum/#!searchin/sage-devel/pickles/sage-devel/KjnxIXO-xnE/YvTX9PV7LAsJ), where an old k-Schur class had been deprecated though it had some old pickles in the pickle jar, and efforts to override proved unsuccessful. Discussion eventually died off and the old pickles were just removed. In a similar vein, discussion about refreshing the pickle jar in #11720 never went anywhere, and there are several other examples of pickle-related discussion that seem to trail off into nothingness. I also asked Andrew Ohana, who doesn't care about them, and I personally do not care about them. To be fair, I may have missed people or oversimplified their views.
3. The consensus I've been able to gather is that pickling is a terrible archival format, one should not use it alone to store important information for many years, and if the worst happens, you should be able to get an old version of sage to recover your data. I also haven't found evidence of many users complaining about old pickles breaking.
4. The k-Schur sage-devel thread I linked above makes it seem that a large amount of time and effort was wasted on that particular issue. Even if maintaining backwards compatibility of old pickles is a worthwhile goal, I'm not at all convinced it's worth stealing development time.

If others care about these pickle issues, please let me know!


---

Comment by jpswanson created at 2015-03-27 09:05:41

Oh, I forgot one thing: `RibbonShapedTableau([])` does not error despite there being no cell in row 1 or column 1. They are supposed to have "at least one cell in row `1`" and in column 1. I'd just tweak the docstring to allow an empty ribbon shaped tableau, but one could also throw an error on it.


---

Comment by tscrim created at 2015-03-27 14:55:20

I care. For something like tableaux (compared to k-Schur functions), there is a much higher likelihood of an old pickle needing to be eaten and by someone who doesn't know to contact sage-devel/look at trac. I'm planning to try and get the pickling to work, but I won't have time until next week.


---

Comment by jpswanson created at 2015-04-05 11:28:29

Any luck with pickling this last week? If not, I should be able to do it this coming week. It'd be nice to finish the ticket off.


---

Comment by tscrim created at 2015-04-05 17:12:45

No, I haven't had time. Feel free to take a crack at it.


---

Comment by git created at 2015-04-15 15:14:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-04-15 15:15:52

Pickling has been fixed and I've made a quick pass through the code and overall I'm happy with it. Although someone will need to do a rebasing on the latest version of Sage and review my changes.


---

Comment by tscrim created at 2015-04-15 15:16:10

Changing keywords from "tableaux, sage-combinat, mutability, ClonableList, days64" to "tableaux, sage-combinat, mutability, ClonableList, days64, sd67".


---

Comment by git created at 2015-04-15 15:23:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-15 15:44:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-15 15:45:46

Thank you! The patch looks good to me as far as I can tell (I don't personally use pickles).

Can you take a quick look at my latest changes? Your setstate made me realize that there was an ugly hack in ribbon_shaped_tableau.py, which looked easy enough to get rid of.
----
New commits:


---

Comment by git created at 2015-04-15 19:46:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-15 20:11:39

Changing status from needs_review to positive_review.


---

Comment by darij created at 2015-04-15 20:11:47

Positive review according to Travis here.


---

Comment by vbraun created at 2015-04-19 01:52:12

Resolution: fixed
