# Issue 17787: Mutability of tableaux part II: replacing CombinatorialObject by ClonableList

archive/issues_017787.json:
```json
{
    "body": "CC:  jkeitel jpswanson mariamonks opechenik tscrim\n\nKeywords: permutation,\n\nJan Keitel's work. Depends on #15862 but probably needs to be merged with its current state.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18024\n\n",
    "created_at": "2015-03-21T00:17:06Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Mutability of tableaux part II: replacing CombinatorialObject by ClonableList",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17787",
    "user": "darij"
}
```
CC:  jkeitel jpswanson mariamonks opechenik tscrim

Keywords: permutation,

Jan Keitel's work. Depends on #15862 but probably needs to be merged with its current state.

Issue created by migration from https://trac.sagemath.org/ticket/18024





---

archive/issue_comments_238294.json:
```json
{
    "body": "Changing keywords from \"permutation,\" to \"tableaux, sage-combinat, mutability, ClonableList, days64\".",
    "created_at": "2015-03-21T00:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238294",
    "user": "darij"
}
```

Changing keywords from "permutation," to "tableaux, sage-combinat, mutability, ClonableList, days64".



---

archive/issue_comments_238295.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-03-21T00:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238295",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_238296.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T00:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238296",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238297.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T01:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238297",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238298.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T01:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238298",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238299.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T07:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238299",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238300.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T08:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238300",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238301.json:
```json
{
    "body": "Done profiling this. The speed changes range from significant speedups to minor slowdowns, the latter being mainly on methods (such as Tableau's `restrict`) which ducktype the result as follows:\n\n```\n        # attempt to return a tableau of the same type\n        try:\n            return self.parent()( res )\n        except Exception:\n            try:\n                return self.parent().Element( res )\n            except Exception:\n                return Tableau(res)\n```\n\n\nAlso, two unpickling doctests are broken: one in ribbon_tableau.py, and one in ribbon_shape_tableau.py. One of them makes no sense to me, but the other might be worth salvaging.",
    "created_at": "2015-03-21T08:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238301",
    "user": "darij"
}
```

Done profiling this. The speed changes range from significant speedups to minor slowdowns, the latter being mainly on methods (such as Tableau's `restrict`) which ducktype the result as follows:

```
        # attempt to return a tableau of the same type
        try:
            return self.parent()( res )
        except Exception:
            try:
                return self.parent().Element( res )
            except Exception:
                return Tableau(res)
```


Also, two unpickling doctests are broken: one in ribbon_tableau.py, and one in ribbon_shape_tableau.py. One of them makes no sense to me, but the other might be worth salvaging.



---

archive/issue_comments_238302.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-21T08:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238302",
    "user": "darij"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_238303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T08:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238303",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238304.json:
```json
{
    "body": "Hello,\n\nI just opened the branch to see what it does (I do not understand anything of the math involved here) and I noticed this change:\n\n\n```\n-                if not (i is None):\n+                if i > 0 and not (i is None):\n```\n\n\nIf `i` can be equal to `None`, you should probably write `not (i is None) and i > 0` instead (i.e. reverse the conditions).\n\nNathann",
    "created_at": "2015-03-21T12:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238304",
    "user": "ncohen"
}
```

Hello,

I just opened the branch to see what it does (I do not understand anything of the math involved here) and I noticed this change:


```
-                if not (i is None):
+                if i > 0 and not (i is None):
```


If `i` can be equal to `None`, you should probably write `not (i is None) and i > 0` instead (i.e. reverse the conditions).

Nathann



---

archive/issue_comments_238305.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T15:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238305",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T15:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238306",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238307.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-03-21T15:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238307",
    "user": "darij"
}
```

New commits:



---

archive/issue_comments_238308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-21T18:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238308",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-23T00:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238309",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238310.json:
```json
{
    "body": "Thanks Darij for finishing off #15862. There's been a couple of commits on this one since it was set to needs_review and there's a work issue left. Is it ready for review after all?",
    "created_at": "2015-03-26T08:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238310",
    "user": "jpswanson"
}
```

Thanks Darij for finishing off #15862. There's been a couple of commits on this one since it was set to needs_review and there's a work issue left. Is it ready for review after all?



---

archive/issue_comments_238311.json:
```json
{
    "body": "It is ready modulo the two broken pickles.",
    "created_at": "2015-03-26T15:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238311",
    "user": "darij"
}
```

It is ready modulo the two broken pickles.



---

archive/issue_comments_238312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T08:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238312",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238313.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T08:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238313",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238314.json:
```json
{
    "body": "Good work. But I am not sure if we are supposed to delete these pickles...",
    "created_at": "2015-03-27T08:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238314",
    "user": "darij"
}
```

Good work. But I am not sure if we are supposed to delete these pickles...



---

archive/issue_comments_238315.json:
```json
{
    "body": "Made a few minor reviewer changes, so as soon as someone signs off on those we can call this good.\n\nAfter looking into the old pickles issue, I decided to just remove them for the following reasons.\n1. We had already removed a couple of old pickle tests and none of the contributors on this ticket had yet complained.\n2. Frankly, I haven't found anyone who seems to really care about old pickles breaking, except for some old posts by William Stein. The most relevant sage-devel thread I found was [this one](https://groups.google.com/forum/#!searchin/sage-devel/pickles/sage-devel/KjnxIXO-xnE/YvTX9PV7LAsJ), where an old k-Schur class had been deprecated though it had some old pickles in the pickle jar, and efforts to override proved unsuccessful. Discussion eventually died off and the old pickles were just removed. In a similar vein, discussion about refreshing the pickle jar in #11720 never went anywhere, and there are several other examples of pickle-related discussion that seem to trail off into nothingness. I also asked Andrew Ohana, who doesn't care about them, and I personally do not care about them. To be fair, I may have missed people or oversimplified their views.\n3. The consensus I've been able to gather is that pickling is a terrible archival format, one should not use it alone to store important information for many years, and if the worst happens, you should be able to get an old version of sage to recover your data. I also haven't found evidence of many users complaining about old pickles breaking.\n4. The k-Schur sage-devel thread I linked above makes it seem that a large amount of time and effort was wasted on that particular issue. Even if maintaining backwards compatibility of old pickles is a worthwhile goal, I'm not at all convinced it's worth stealing development time.\n\nIf others care about these pickle issues, please let me know!",
    "created_at": "2015-03-27T08:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238315",
    "user": "jpswanson"
}
```

Made a few minor reviewer changes, so as soon as someone signs off on those we can call this good.

After looking into the old pickles issue, I decided to just remove them for the following reasons.
1. We had already removed a couple of old pickle tests and none of the contributors on this ticket had yet complained.
2. Frankly, I haven't found anyone who seems to really care about old pickles breaking, except for some old posts by William Stein. The most relevant sage-devel thread I found was [this one](https://groups.google.com/forum/#!searchin/sage-devel/pickles/sage-devel/KjnxIXO-xnE/YvTX9PV7LAsJ), where an old k-Schur class had been deprecated though it had some old pickles in the pickle jar, and efforts to override proved unsuccessful. Discussion eventually died off and the old pickles were just removed. In a similar vein, discussion about refreshing the pickle jar in #11720 never went anywhere, and there are several other examples of pickle-related discussion that seem to trail off into nothingness. I also asked Andrew Ohana, who doesn't care about them, and I personally do not care about them. To be fair, I may have missed people or oversimplified their views.
3. The consensus I've been able to gather is that pickling is a terrible archival format, one should not use it alone to store important information for many years, and if the worst happens, you should be able to get an old version of sage to recover your data. I also haven't found evidence of many users complaining about old pickles breaking.
4. The k-Schur sage-devel thread I linked above makes it seem that a large amount of time and effort was wasted on that particular issue. Even if maintaining backwards compatibility of old pickles is a worthwhile goal, I'm not at all convinced it's worth stealing development time.

If others care about these pickle issues, please let me know!



---

archive/issue_comments_238316.json:
```json
{
    "body": "Oh, I forgot one thing: `RibbonShapedTableau([])` does not error despite there being no cell in row 1 or column 1. They are supposed to have \"at least one cell in row `1`\" and in column 1. I'd just tweak the docstring to allow an empty ribbon shaped tableau, but one could also throw an error on it.",
    "created_at": "2015-03-27T09:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238316",
    "user": "jpswanson"
}
```

Oh, I forgot one thing: `RibbonShapedTableau([])` does not error despite there being no cell in row 1 or column 1. They are supposed to have "at least one cell in row `1`" and in column 1. I'd just tweak the docstring to allow an empty ribbon shaped tableau, but one could also throw an error on it.



---

archive/issue_comments_238317.json:
```json
{
    "body": "I care. For something like tableaux (compared to k-Schur functions), there is a much higher likelihood of an old pickle needing to be eaten and by someone who doesn't know to contact sage-devel/look at trac. I'm planning to try and get the pickling to work, but I won't have time until next week.",
    "created_at": "2015-03-27T14:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238317",
    "user": "tscrim"
}
```

I care. For something like tableaux (compared to k-Schur functions), there is a much higher likelihood of an old pickle needing to be eaten and by someone who doesn't know to contact sage-devel/look at trac. I'm planning to try and get the pickling to work, but I won't have time until next week.



---

archive/issue_comments_238318.json:
```json
{
    "body": "Any luck with pickling this last week? If not, I should be able to do it this coming week. It'd be nice to finish the ticket off.",
    "created_at": "2015-04-05T11:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238318",
    "user": "jpswanson"
}
```

Any luck with pickling this last week? If not, I should be able to do it this coming week. It'd be nice to finish the ticket off.



---

archive/issue_comments_238319.json:
```json
{
    "body": "No, I haven't had time. Feel free to take a crack at it.",
    "created_at": "2015-04-05T17:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238319",
    "user": "tscrim"
}
```

No, I haven't had time. Feel free to take a crack at it.



---

archive/issue_comments_238320.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T15:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238320",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238321.json:
```json
{
    "body": "Pickling has been fixed and I've made a quick pass through the code and overall I'm happy with it. Although someone will need to do a rebasing on the latest version of Sage and review my changes.",
    "created_at": "2015-04-15T15:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238321",
    "user": "tscrim"
}
```

Pickling has been fixed and I've made a quick pass through the code and overall I'm happy with it. Although someone will need to do a rebasing on the latest version of Sage and review my changes.



---

archive/issue_comments_238322.json:
```json
{
    "body": "Changing keywords from \"tableaux, sage-combinat, mutability, ClonableList, days64\" to \"tableaux, sage-combinat, mutability, ClonableList, days64, sd67\".",
    "created_at": "2015-04-15T15:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238322",
    "user": "tscrim"
}
```

Changing keywords from "tableaux, sage-combinat, mutability, ClonableList, days64" to "tableaux, sage-combinat, mutability, ClonableList, days64, sd67".



---

archive/issue_comments_238323.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T15:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238323",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238324.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T15:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238324",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238325.json:
```json
{
    "body": "Thank you! The patch looks good to me as far as I can tell (I don't personally use pickles).\n\nCan you take a quick look at my latest changes? Your setstate made me realize that there was an ugly hack in ribbon_shaped_tableau.py, which looked easy enough to get rid of.\n----\nNew commits:",
    "created_at": "2015-04-15T15:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238325",
    "user": "darij"
}
```

Thank you! The patch looks good to me as far as I can tell (I don't personally use pickles).

Can you take a quick look at my latest changes? Your setstate made me realize that there was an ugly hack in ribbon_shaped_tableau.py, which looked easy enough to get rid of.
----
New commits:



---

archive/issue_comments_238326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T19:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238326",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238327.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-15T20:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238327",
    "user": "darij"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_238328.json:
```json
{
    "body": "Positive review according to Travis here.",
    "created_at": "2015-04-15T20:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238328",
    "user": "darij"
}
```

Positive review according to Travis here.



---

archive/issue_comments_238329.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-19T01:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17787#issuecomment-238329",
    "user": "vbraun"
}
```

Resolution: fixed
