# Issue 23880: integrate(sqrt(1-4*sin(x)^2),x) is wrong

Issue created by migration from Trac.

Original creator: slabbe

Original creation time: 2017-10-27 15:13:26

CC:  kcrisman jhpalmieri slelievre

Keywords: maxima

I received an email from Pierre Arnoux saying that this is wrong:

```
sage: integrate (sqrt(1-4*sin(x)^2),x, algorithm='maxima')
-1/12*sin(3*x) + 1/4*sin(x)
```


Quoting what Pierre says: "_Ce qui est visiblement faux: il y a un point d'inflexion horizontal en 0 alors que la fonction à intégrer vaut 1 en 0, ça ne peut pas être une primitive. Est-ce que vous avez une idée de ce qui ne marche pas?_"

Other programs in Sage just can't solve this integral:


```
sage: integrate (sqrt(1-4*sin(x)^2),x, algorithm='fricas')  # installed with "sage -i fricas"
integral(sqrt(4*cos(x)^2 - 3), x)
sage: integrate (sqrt(1-4*sin(x)^2),x, algorithm='giac')
integrate(sqrt(-4*sin(x)^2 + 1), x)
sage: integrate (sqrt(1-4*sin(x)^2),x, algorithm='sympy')
....does not halt...
```



---

Comment by rws created at 2017-10-27 15:16:59

See also #18821.


---

Comment by slelievre created at 2017-11-26 03:33:05

Here is how I would describe this bug in the integrate function.
(This can be turned into a doctest when this bug is resolved.)


```
sage: f(x) = sqrt(1-4*sin(x)^2)
sage: F(x) = integrate(f(x), x)
sage: F(x)
-1/12*sin(3*x) + 1/4*sin(x)
```


Comparing the derivative of F with f shows this is wrong.


```
sage: g(x) = diff(F(x), x)
sage: g(x)
-1/4*cos(3*x) + 1/4*cos(x)
sage: f(0), g(0)
(1, 0)
```


Looking at the plots of f and F also reveals an error:


```
sage: xr = (-0.4, 0.4)
sage: plot(f, xr, color='blue') + plot(F, xr, color='red')
```


Here, f (blue curve) is 1 at 0, so its primitive F (red curve)
should have slope 1 at 0, instead of 0.


---

Comment by rws created at 2017-11-26 07:14:52

There are half a dozen similar tickets to this. The reason is that Sage uses a (now) unmaintained package of Maxima, see #12731 for an overview.


---

Comment by chapoton created at 2019-05-17 18:01:07

Changing keywords from "maxima" to "maxima, abs_integrate".


---

Comment by chapoton created at 2019-06-17 14:41:36

this one is fixed by #27958, that needs review


---

Comment by chapoton created at 2020-06-25 06:49:07

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-06-25 06:49:07

easy one
----
New commits:


---

Comment by git created at 2020-06-25 06:49:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2020-06-26 14:53:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-06-27 09:26:52

Resolution: fixed
