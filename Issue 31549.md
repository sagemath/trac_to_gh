# Issue 31549: Meta-ticket: Support gcc 11 (fedora 34)

Issue created by migration from https://trac.sagemath.org/ticket/31786

Original creator: mkoeppe

Original creation time: 2021-05-06 17:21:13

CC:  @zlscherr jhpalmieri dimpase fbissey enriqueartal vbraun

- #29703 Upgrade gcc to 10.3 (latest 10.x), fix --without-system-gcc builds
- #31624 fedora-34-standard: eclib, singular build failures with system ntl


---

Comment by fbissey created at 2021-05-06 20:24:13

I didn't have any problems in Gentoo with `eclib` and `ntl`.


---

Comment by fbissey created at 2021-05-06 20:34:20

Note that issue of standard do not arise in vanilla sage since we enforce std=c++11. However, issues with headers are not prevented by sticking to that standard, which means the following have to be fixed in any case:
 * fplll
 * pynac
 * lcalc

Others can be delayed.


---

Comment by mkoeppe created at 2021-05-19 01:46:24

New commits:


---

Comment by enriqueartal created at 2021-05-29 21:01:27

The compilation failed with lcalc and pynac. The other packages in the introduction have been built, except for fplll which did not appear.


---

Comment by vbraun created at 2021-05-30 17:05:51

Workaround for libgd is at #31879


---

Comment by dimpase created at 2021-06-22 20:40:48

rebase please


---

Comment by mkoeppe created at 2021-06-22 22:16:46

The branch is no longer relevant, all tickets have been merged


---

Comment by dimpase created at 2021-06-23 08:25:35

By the way, a viable route to work on Fedora 34 might be to use clang rather than gcc.


```
dnf install clang
CC=clang CXX=clang++ ./configure...
```

Do we test Linux/clang on GH Actions? We should...


---

Comment by mkoeppe created at 2021-06-23 16:04:36

Replying to [comment:17 dimpase]:
> Do we test Linux/clang on GH Actions? We should...

I agree. #30835 can be broadened to include this...


---

Comment by dimpase created at 2021-06-30 16:49:58

we see Maxima builds failing in Fedora 34 on the latests CI runs, see e.g.
https://github.com/sagemath/sagetrac-mirror/runs/2918514130


---

Comment by mkoeppe created at 2021-06-30 18:13:17

earlier in that log:

```
;;; (EXT:RUN-PROGRAM "gcc" ("-I." "-I/usr/include/" "-D_GNU_SOURCE" "-D_FILE_OFFSET_BITS=64" "-O2" "-flto=auto" "-ffat-lto-objects" "-fexceptions" "-g" "-grecord-gcc-switches" "-pipe" "-Wall" "-Werror=format-security" "-Wp,-D_FORTIFY_SOURCE=2" "-Wp,-D_GLIBCXX_ASSERTIONS" "-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1" "-fstack-protector-strong" "-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1" "-m64" "-mtune=generic" "-fasynchronous-unwind-tables" "-fstack-clash-protection" "-fcf-protection" "-Wno-unused" "-Wno-return-type" "-Wno-unknown-pragmas" "-fPIC" "-D_THREAD_SAFE" "-Dlinux" "-O2" "-c" "binary-ecl/maxima-package.c" "-o" "binary-ecl/maxima-package.o")):
;;; cc1: fatal error: inaccessible plugin file /sage/local/lib/gcc/x86_64-pc-linux-gnu/10.3.0/plugin/annobin.so expanded from short plugin name annobin: No such file or directory
;;; compilation terminated.
;      - Loading binary file "binary-ecl/maxima-package.fas" 
Condition of type: FILE-ERROR
Filesystem error with pathname #P"/sage/local/var/tmp/sage/build/maxima-5.45.0/src/src/binary-ecl/maxima-package.fas".
```



---

Comment by mkoeppe created at 2021-06-30 18:18:25

Looks like combining system `ecl` with our `gcc` does not work because it uses Fedora-specific compiler options. 

This will go away when we can accept system gcc11...


---

Comment by dimpase created at 2021-06-30 20:13:54

that annobin-related gcc/ecl bug was also reported on sage-devel

Redhat/Fedora does something special with annobin,
perhaps that's the fallout we see here


---

Comment by mkoeppe created at 2021-06-30 20:29:02

I've opened #32093 for this


---

Comment by mkoeppe created at 2021-06-30 21:20:29

Last 10 new commits:


---

Comment by mkoeppe created at 2021-06-30 21:31:40

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-06-30 21:31:40

Changing priority from major to blocker.


---

Comment by dimpase created at 2021-07-07 16:25:33

Does this work with #32037 and without lcalc patch?


---

Comment by mkoeppe created at 2021-07-07 20:05:26

This is unknown. I don't think portability testing has been run on #32037.


---

Comment by dimpase created at 2021-07-07 22:52:01

Replying to [comment:29 mkoeppe]:
> This is unknown. I don't think portability testing has been run on #32037.
they are now running on https://github.com/sagemath/sagetrac-mirror/actions/runs/1009717554


---

Comment by dimpase created at 2021-07-08 10:25:31

gengetopt does not build on ubunty-trusty. Arrgh...


---

Comment by mkoeppe created at 2021-07-19 03:02:27

With all dependencies now merged in 9.4.beta5, let's get this in please.


---

Comment by dimpase created at 2021-07-19 21:49:36

I believe it actually works on Fedora 34, right?


---

Comment by dimpase created at 2021-07-19 21:49:36

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-19 22:00:54

Thanks, yes, I think so


---

Comment by enriqueartal created at 2021-07-20 06:08:37

It works for me in Fedora 34


---

Comment by vbraun created at 2021-07-23 20:12:01

Resolution: fixed


---

Comment by vbraun created at 2022-06-12 12:51:38

I've created #33981 for latte_int
