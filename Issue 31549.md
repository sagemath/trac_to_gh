# Issue 31549: Meta-ticket: Support gcc 11 (fedora 34)

archive/issues_031549.json:
```json
{
    "body": "CC:  @zlscherr @jhpalmieri @dimpase @kiwifb @enriqueartal @vbraun\n\n- #29703 Upgrade gcc to 10.3 (latest 10.x), fix --without-system-gcc builds\n- #31624 fedora-34-standard: eclib, singular build failures with system ntl\n\nIssue created by migration from https://trac.sagemath.org/ticket/31786\n\n",
    "created_at": "2021-05-06T17:21:13Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Meta-ticket: Support gcc 11 (fedora 34)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31549",
    "user": "@mkoeppe"
}
```
CC:  @zlscherr @jhpalmieri @dimpase @kiwifb @enriqueartal @vbraun

- #29703 Upgrade gcc to 10.3 (latest 10.x), fix --without-system-gcc builds
- #31624 fedora-34-standard: eclib, singular build failures with system ntl

Issue created by migration from https://trac.sagemath.org/ticket/31786





---

archive/issue_comments_450914.json:
```json
{
    "body": "I didn't have any problems in Gentoo with `eclib` and `ntl`.",
    "created_at": "2021-05-06T20:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450914",
    "user": "@kiwifb"
}
```

I didn't have any problems in Gentoo with `eclib` and `ntl`.



---

archive/issue_comments_450915.json:
```json
{
    "body": "Note that issue of standard do not arise in vanilla sage since we enforce std=c++11. However, issues with headers are not prevented by sticking to that standard, which means the following have to be fixed in any case:\n* fplll\n* pynac\n* lcalc\n\nOthers can be delayed.",
    "created_at": "2021-05-06T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450915",
    "user": "@kiwifb"
}
```

Note that issue of standard do not arise in vanilla sage since we enforce std=c++11. However, issues with headers are not prevented by sticking to that standard, which means the following have to be fixed in any case:
* fplll
* pynac
* lcalc

Others can be delayed.



---

archive/issue_comments_450916.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-19T01:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450916",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_450917.json:
```json
{
    "body": "The compilation failed with lcalc and pynac. The other packages in the introduction have been built, except for fplll which did not appear.",
    "created_at": "2021-05-29T21:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450917",
    "user": "@enriqueartal"
}
```

The compilation failed with lcalc and pynac. The other packages in the introduction have been built, except for fplll which did not appear.



---

archive/issue_comments_450918.json:
```json
{
    "body": "Workaround for libgd is at #31879",
    "created_at": "2021-05-30T17:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450918",
    "user": "@vbraun"
}
```

Workaround for libgd is at #31879



---

archive/issue_comments_450919.json:
```json
{
    "body": "rebase please",
    "created_at": "2021-06-22T20:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450919",
    "user": "@dimpase"
}
```

rebase please



---

archive/issue_comments_450920.json:
```json
{
    "body": "The branch is no longer relevant, all tickets have been merged",
    "created_at": "2021-06-22T22:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450920",
    "user": "@mkoeppe"
}
```

The branch is no longer relevant, all tickets have been merged



---

archive/issue_comments_450921.json:
```json
{
    "body": "By the way, a viable route to work on Fedora 34 might be to use clang rather than gcc.\n\n\n```\ndnf install clang\nCC=clang CXX=clang++ ./configure...\n```\n\nDo we test Linux/clang on GH Actions? We should...",
    "created_at": "2021-06-23T08:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450921",
    "user": "@dimpase"
}
```

By the way, a viable route to work on Fedora 34 might be to use clang rather than gcc.


```
dnf install clang
CC=clang CXX=clang++ ./configure...
```

Do we test Linux/clang on GH Actions? We should...



---

archive/issue_comments_450922.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> Do we test Linux/clang on GH Actions? We should...\n\nI agree. #30835 can be broadened to include this...",
    "created_at": "2021-06-23T16:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450922",
    "user": "@mkoeppe"
}
```

Replying to [comment:17 dimpase]:
> Do we test Linux/clang on GH Actions? We should...

I agree. #30835 can be broadened to include this...



---

archive/issue_comments_450923.json:
```json
{
    "body": "we see Maxima builds failing in Fedora 34 on the latests CI runs, see e.g.\nhttps://github.com/sagemath/sagetrac-mirror/runs/2918514130",
    "created_at": "2021-06-30T16:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450923",
    "user": "@dimpase"
}
```

we see Maxima builds failing in Fedora 34 on the latests CI runs, see e.g.
https://github.com/sagemath/sagetrac-mirror/runs/2918514130



---

archive/issue_comments_450924.json:
```json
{
    "body": "earlier in that log:\n\n```\n;;; (EXT:RUN-PROGRAM \"gcc\" (\"-I.\" \"-I/usr/include/\" \"-D_GNU_SOURCE\" \"-D_FILE_OFFSET_BITS=64\" \"-O2\" \"-flto=auto\" \"-ffat-lto-objects\" \"-fexceptions\" \"-g\" \"-grecord-gcc-switches\" \"-pipe\" \"-Wall\" \"-Werror=format-security\" \"-Wp,-D_FORTIFY_SOURCE=2\" \"-Wp,-D_GLIBCXX_ASSERTIONS\" \"-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1\" \"-fstack-protector-strong\" \"-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1\" \"-m64\" \"-mtune=generic\" \"-fasynchronous-unwind-tables\" \"-fstack-clash-protection\" \"-fcf-protection\" \"-Wno-unused\" \"-Wno-return-type\" \"-Wno-unknown-pragmas\" \"-fPIC\" \"-D_THREAD_SAFE\" \"-Dlinux\" \"-O2\" \"-c\" \"binary-ecl/maxima-package.c\" \"-o\" \"binary-ecl/maxima-package.o\")):\n;;; cc1: fatal error: inaccessible plugin file /sage/local/lib/gcc/x86_64-pc-linux-gnu/10.3.0/plugin/annobin.so expanded from short plugin name annobin: No such file or directory\n;;; compilation terminated.\n;      - Loading binary file \"binary-ecl/maxima-package.fas\" \nCondition of type: FILE-ERROR\nFilesystem error with pathname #P\"/sage/local/var/tmp/sage/build/maxima-5.45.0/src/src/binary-ecl/maxima-package.fas\".\n```\n",
    "created_at": "2021-06-30T18:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450924",
    "user": "@mkoeppe"
}
```

earlier in that log:

```
;;; (EXT:RUN-PROGRAM "gcc" ("-I." "-I/usr/include/" "-D_GNU_SOURCE" "-D_FILE_OFFSET_BITS=64" "-O2" "-flto=auto" "-ffat-lto-objects" "-fexceptions" "-g" "-grecord-gcc-switches" "-pipe" "-Wall" "-Werror=format-security" "-Wp,-D_FORTIFY_SOURCE=2" "-Wp,-D_GLIBCXX_ASSERTIONS" "-specs=/usr/lib/rpm/redhat/redhat-hardened-cc1" "-fstack-protector-strong" "-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1" "-m64" "-mtune=generic" "-fasynchronous-unwind-tables" "-fstack-clash-protection" "-fcf-protection" "-Wno-unused" "-Wno-return-type" "-Wno-unknown-pragmas" "-fPIC" "-D_THREAD_SAFE" "-Dlinux" "-O2" "-c" "binary-ecl/maxima-package.c" "-o" "binary-ecl/maxima-package.o")):
;;; cc1: fatal error: inaccessible plugin file /sage/local/lib/gcc/x86_64-pc-linux-gnu/10.3.0/plugin/annobin.so expanded from short plugin name annobin: No such file or directory
;;; compilation terminated.
;      - Loading binary file "binary-ecl/maxima-package.fas" 
Condition of type: FILE-ERROR
Filesystem error with pathname #P"/sage/local/var/tmp/sage/build/maxima-5.45.0/src/src/binary-ecl/maxima-package.fas".
```




---

archive/issue_comments_450925.json:
```json
{
    "body": "Looks like combining system `ecl` with our `gcc` does not work because it uses Fedora-specific compiler options. \n\nThis will go away when we can accept system gcc11...",
    "created_at": "2021-06-30T18:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450925",
    "user": "@mkoeppe"
}
```

Looks like combining system `ecl` with our `gcc` does not work because it uses Fedora-specific compiler options. 

This will go away when we can accept system gcc11...



---

archive/issue_comments_450926.json:
```json
{
    "body": "that annobin-related gcc/ecl bug was also reported on sage-devel\n\nRedhat/Fedora does something special with annobin,\nperhaps that's the fallout we see here",
    "created_at": "2021-06-30T20:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450926",
    "user": "@dimpase"
}
```

that annobin-related gcc/ecl bug was also reported on sage-devel

Redhat/Fedora does something special with annobin,
perhaps that's the fallout we see here



---

archive/issue_comments_450927.json:
```json
{
    "body": "I've opened #32093 for this",
    "created_at": "2021-06-30T20:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450927",
    "user": "@mkoeppe"
}
```

I've opened #32093 for this



---

archive/issue_comments_450928.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-06-30T21:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450928",
    "user": "@mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_450929.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-30T21:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450929",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450930.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-06-30T21:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450930",
    "user": "@mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_450931.json:
```json
{
    "body": "Does this work with #32037 and without lcalc patch?",
    "created_at": "2021-07-07T16:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450931",
    "user": "@dimpase"
}
```

Does this work with #32037 and without lcalc patch?



---

archive/issue_comments_450932.json:
```json
{
    "body": "This is unknown. I don't think portability testing has been run on #32037.",
    "created_at": "2021-07-07T20:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450932",
    "user": "@mkoeppe"
}
```

This is unknown. I don't think portability testing has been run on #32037.



---

archive/issue_comments_450933.json:
```json
{
    "body": "Replying to [comment:29 mkoeppe]:\n> This is unknown. I don't think portability testing has been run on #32037.\nthey are now running on https://github.com/sagemath/sagetrac-mirror/actions/runs/1009717554",
    "created_at": "2021-07-07T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450933",
    "user": "@dimpase"
}
```

Replying to [comment:29 mkoeppe]:
> This is unknown. I don't think portability testing has been run on #32037.
they are now running on https://github.com/sagemath/sagetrac-mirror/actions/runs/1009717554



---

archive/issue_comments_450934.json:
```json
{
    "body": "gengetopt does not build on ubunty-trusty. Arrgh...",
    "created_at": "2021-07-08T10:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450934",
    "user": "@dimpase"
}
```

gengetopt does not build on ubunty-trusty. Arrgh...



---

archive/issue_comments_450935.json:
```json
{
    "body": "With all dependencies now merged in 9.4.beta5, let's get this in please.",
    "created_at": "2021-07-19T03:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450935",
    "user": "@mkoeppe"
}
```

With all dependencies now merged in 9.4.beta5, let's get this in please.



---

archive/issue_comments_450936.json:
```json
{
    "body": "I believe it actually works on Fedora 34, right?",
    "created_at": "2021-07-19T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450936",
    "user": "@dimpase"
}
```

I believe it actually works on Fedora 34, right?



---

archive/issue_comments_450937.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-19T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450937",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450938.json:
```json
{
    "body": "Thanks, yes, I think so",
    "created_at": "2021-07-19T22:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450938",
    "user": "@mkoeppe"
}
```

Thanks, yes, I think so



---

archive/issue_comments_450939.json:
```json
{
    "body": "It works for me in Fedora 34",
    "created_at": "2021-07-20T06:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450939",
    "user": "@enriqueartal"
}
```

It works for me in Fedora 34



---

archive/issue_comments_450940.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450940",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_450941.json:
```json
{
    "body": "I've created #33981 for latte_int",
    "created_at": "2022-06-12T12:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31549#issuecomment-450941",
    "user": "@vbraun"
}
```

I've created #33981 for latte_int
