# Issue 19778: Matrix: check keyword arguments

archive/issues_019778.json:
```json
{
    "body": "CC:  ncohen\n\n\n```\nsage: Matrix(whatever=53)\n[]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20015\n\n",
    "created_at": "2016-02-05T17:21:51Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "title": "Matrix: check keyword arguments",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19778",
    "user": "jdemeyer"
}
```
CC:  ncohen


```
sage: Matrix(whatever=53)
[]
```


Issue created by migration from https://trac.sagemath.org/ticket/20015





---

archive/issue_comments_271783.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-06T12:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271783",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271784.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-02-06T12:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271784",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_271785.json:
```json
{
    "body": "In this line:\n\n```\n arg = [[arg(i,j) for j in range(ncols)] for i in range(nrows)]\n```\n\ncan we use srange? This came up on [sage-support](https://groups.google.com/d/msg/sage-support/x82MR4yBAek/R3ZBNOsCAQAJ)",
    "created_at": "2016-02-16T07:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271785",
    "user": "nbruin"
}
```

In this line:

```
 arg = [[arg(i,j) for j in range(ncols)] for i in range(nrows)]
```

can we use srange? This came up on [sage-support](https://groups.google.com/d/msg/sage-support/x82MR4yBAek/R3ZBNOsCAQAJ)



---

archive/issue_comments_271786.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-16T15:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271786",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_271787.json:
```json
{
    "body": "Replying to [comment:11 nbruin]:\n> This came up on [sage-support](https://groups.google.com/d/msg/sage-support/x82MR4yBAek/R3ZBNOsCAQAJ)\n\nNot really, that was a different issue with `range` vs. `srange`, unrelated to the matrix constructor. But of course you are right that we should use Sage integers.",
    "created_at": "2016-02-16T15:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271787",
    "user": "jdemeyer"
}
```

Replying to [comment:11 nbruin]:
> This came up on [sage-support](https://groups.google.com/d/msg/sage-support/x82MR4yBAek/R3ZBNOsCAQAJ)

Not really, that was a different issue with `range` vs. `srange`, unrelated to the matrix constructor. But of course you are right that we should use Sage integers.



---

archive/issue_comments_271788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-11T12:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_271789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-11T14:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_271790.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-11T14:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271790",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_271791.json:
```json
{
    "body": "Replying to [comment:11 nbruin]:\n> In this line:\n> {{{\n>  arg = [[arg(i,j) for j in range(ncols)] for i in range(nrows)]\n> }}}\n> can we use srange?\n\nDone.",
    "created_at": "2016-03-11T17:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271791",
    "user": "jdemeyer"
}
```

Replying to [comment:11 nbruin]:
> In this line:
> {{{
>  arg = [[arg(i,j) for j in range(ncols)] for i in range(nrows)]
> }}}
> can we use srange?

Done.



---

archive/issue_comments_271792.json:
```json
{
    "body": "For some input we get strange error messages\n\n```\nsage: matrix(ZZ,2,3,1)\n...\nTypeError: self must be a space of square matrices\n```\n\nAnd some strange input might actually gives a matrix\n\n```\nsage: matrix(RR, 1.5, 2.3)\n[0.000000000000000 0.000000000000000]\n```\n\nWith cythonization, we could use `sage.misc.long.pyobject_to_long`.",
    "created_at": "2016-03-12T14:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271792",
    "user": "vdelecroix"
}
```

For some input we get strange error messages

```
sage: matrix(ZZ,2,3,1)
...
TypeError: self must be a space of square matrices
```

And some strange input might actually gives a matrix

```
sage: matrix(RR, 1.5, 2.3)
[0.000000000000000 0.000000000000000]
```

With cythonization, we could use `sage.misc.long.pyobject_to_long`.



---

archive/issue_comments_271793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-14T05:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271793",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271794.json:
```json
{
    "body": "Vincent, this fixes the two issues you mentioned. I have not yet ran all doctests.",
    "created_at": "2016-03-14T05:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271794",
    "user": "jdemeyer"
}
```

Vincent, this fixes the two issues you mentioned. I have not yet ran all doctests.



---

archive/issue_comments_271795.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-14T12:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271795",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_271796.json:
```json
{
    "body": "One trivial doctest fails in `misc/sageinspect.py`.",
    "created_at": "2016-03-14T12:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271796",
    "user": "vdelecroix"
}
```

One trivial doctest fails in `misc/sageinspect.py`.



---

archive/issue_comments_271797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-14T13:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271798.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-14T13:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271798",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_271799.json:
```json
{
    "body": "The error message does not correspond to what is happening with other entries\n\n```\nsage: matrix(QQ,2,2,0)\n[0 0]\n[0 0]\nsage: matrix(QQ,2,2,0.0)\n[0 0]\n[0 0]\nsage: matrix(QQ,2,2,'0')\n[0 0]\n[0 0]\nsage: matrix(QQ,2,2,'0.0')\n...\nTypeError: entries must be coercible to a list or integer\n```\n\nIf the data must be coercible then the last 3 should fail. Though, if the ring is provided I would be less strict and also allow conversion (and make all the above work).\n\nThe following should either work or not work for all rings\n\n```\nsage: matrix(QQ,2,2,'3')\n[3 0]\n[0 3]\nsage: matrix(RBF,2,2,'3')\n[3.000000000000000                 0]\n[                0 3.000000000000000]\nsage: matrix(ZZ,2,2,'3')\n...\nTypeError: entries has the wrong length\nsage: matrix(QQbar,2,2,'3')\n...\nTypeError: entries has the wrong length\n```\n\n(there is something weird above since `QQbar('3')` does not work but `ZZ('3')` does)\n\nSimilarly, some rings are less strict about input conversion/coercion\n\n```\nsage: matrix(QQbar,2,2,3.0)\n...\nTypeError: entries must be coercible to a list or the base ring\nsage: matrix(ZZ,2,2,3.0)\n[3 0]\n[0 3]\n```\n",
    "created_at": "2016-03-14T13:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271799",
    "user": "vdelecroix"
}
```

The error message does not correspond to what is happening with other entries

```
sage: matrix(QQ,2,2,0)
[0 0]
[0 0]
sage: matrix(QQ,2,2,0.0)
[0 0]
[0 0]
sage: matrix(QQ,2,2,'0')
[0 0]
[0 0]
sage: matrix(QQ,2,2,'0.0')
...
TypeError: entries must be coercible to a list or integer
```

If the data must be coercible then the last 3 should fail. Though, if the ring is provided I would be less strict and also allow conversion (and make all the above work).

The following should either work or not work for all rings

```
sage: matrix(QQ,2,2,'3')
[3 0]
[0 3]
sage: matrix(RBF,2,2,'3')
[3.000000000000000                 0]
[                0 3.000000000000000]
sage: matrix(ZZ,2,2,'3')
...
TypeError: entries has the wrong length
sage: matrix(QQbar,2,2,'3')
...
TypeError: entries has the wrong length
```

(there is something weird above since `QQbar('3')` does not work but `ZZ('3')` does)

Similarly, some rings are less strict about input conversion/coercion

```
sage: matrix(QQbar,2,2,3.0)
...
TypeError: entries must be coercible to a list or the base ring
sage: matrix(ZZ,2,2,3.0)
[3 0]
[0 3]
```




---

archive/issue_comments_271800.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> Similarly, some rings are less strict about input conversion/coercion\n> {{{\n> sage: matrix(QQbar,2,2,3.0)\n> ...\n> TypeError: entries must be coercible to a list or the base ring\n> sage: matrix(ZZ,2,2,3.0)\n> [3 0]\n> [0 3]\n> }}}\nThat is certainly outside the scope of this ticket. The matrix constructor should obviously just call `QQbar(3.0)` or `ZZ(3.0)` and let the parent ring deal with it.",
    "created_at": "2016-03-15T09:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271800",
    "user": "jdemeyer"
}
```

Replying to [comment:25 vdelecroix]:
> Similarly, some rings are less strict about input conversion/coercion
> {{{
> sage: matrix(QQbar,2,2,3.0)
> ...
> TypeError: entries must be coercible to a list or the base ring
> sage: matrix(ZZ,2,2,3.0)
> [3 0]
> [0 3]
> }}}
That is certainly outside the scope of this ticket. The matrix constructor should obviously just call `QQbar(3.0)` or `ZZ(3.0)` and let the parent ring deal with it.



---

archive/issue_comments_271801.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> {{{\n> sage: matrix(QQbar,2,2,'3')\n> ...\n> TypeError: entries has the wrong length\n> }}}\n\nThis is actually due to Python treating strings as some kind of list. Really, there is very little difference between `\"abcd\"` and `[\"a\", \"b\", \"c\", \"d\"]`. So we unless we explicitly blacklist strings (which I don't want to do), I think this error is unavoidable.",
    "created_at": "2016-03-15T09:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271801",
    "user": "jdemeyer"
}
```

Replying to [comment:25 vdelecroix]:
> {{{
> sage: matrix(QQbar,2,2,'3')
> ...
> TypeError: entries has the wrong length
> }}}

This is actually due to Python treating strings as some kind of list. Really, there is very little difference between `"abcd"` and `["a", "b", "c", "d"]`. So we unless we explicitly blacklist strings (which I don't want to do), I think this error is unavoidable.



---

archive/issue_comments_271802.json:
```json
{
    "body": "Vincent, the problems you mention in [comment:25] are really in the `__init__` method of the various matrix classes, not the matrix constructor. So I would like to consider that for a follow-up ticket #20211.",
    "created_at": "2016-03-15T10:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271802",
    "user": "jdemeyer"
}
```

Vincent, the problems you mention in [comment:25] are really in the `__init__` method of the various matrix classes, not the matrix constructor. So I would like to consider that for a follow-up ticket #20211.



---

archive/issue_comments_271803.json:
```json
{
    "body": "Fine for me. Could you at least replace \"coerce\" by \"convert\" in the error message?\n\nThe following should be coherent between various ring as well\n\n```\nsage: matrix(ZZ,2,2,'1234')\n[1 2]\n[3 4]\nsage: matrix(QQ,2,2,'1234')\n[1234    0]\n[   0 1234]\n```\n",
    "created_at": "2016-03-15T11:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271803",
    "user": "vdelecroix"
}
```

Fine for me. Could you at least replace "coerce" by "convert" in the error message?

The following should be coherent between various ring as well

```
sage: matrix(ZZ,2,2,'1234')
[1 2]
[3 4]
sage: matrix(QQ,2,2,'1234')
[1234    0]
[   0 1234]
```




---

archive/issue_comments_271804.json:
```json
{
    "body": "Replying to [comment:29 vdelecroix]:\n> Fine for me. Could you at least replace \"coerce\" by \"convert\" in the error message?\n> \n> The following should be coherent between various ring as well\n> {{{\n> sage: matrix(ZZ,2,2,'1234')\n> [1 2]\n> [3 4]\n> sage: matrix(QQ,2,2,'1234')\n> [1234    0]\n> [   0 1234]\n> }}}\n\nCan we please leave both of these for #20211? This ticket deals with the higher-level matrix constructor, not with how matrices are initialized from the given entries.",
    "created_at": "2016-03-15T12:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271804",
    "user": "jdemeyer"
}
```

Replying to [comment:29 vdelecroix]:
> Fine for me. Could you at least replace "coerce" by "convert" in the error message?
> 
> The following should be coherent between various ring as well
> {{{
> sage: matrix(ZZ,2,2,'1234')
> [1 2]
> [3 4]
> sage: matrix(QQ,2,2,'1234')
> [1234    0]
> [   0 1234]
> }}}

Can we please leave both of these for #20211? This ticket deals with the higher-level matrix constructor, not with how matrices are initialized from the given entries.



---

archive/issue_comments_271805.json:
```json
{
    "body": "All right. Then please take care of this in #20211.",
    "created_at": "2016-03-15T13:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271805",
    "user": "vdelecroix"
}
```

All right. Then please take care of this in #20211.



---

archive/issue_comments_271806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-15T13:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271806",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271807.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-20T23:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19778#issuecomment-271807",
    "user": "vbraun"
}
```

Resolution: fixed
