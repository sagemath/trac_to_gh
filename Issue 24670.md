# Issue 24670: GCC is installed multiple times

archive/issues_024670.json:
```json
{
    "body": "CC:  embray\n\n#24599 introduced an import regression: GCC is installed multiple times:\n\n```\njdemeyer@sardonis:~/sage-gcc$ grep 'Setting up build directory for gcc' logs/install.log \n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24907\n\n",
    "created_at": "2018-03-06T10:17:16Z",
    "labels": [
        "build: configure",
        "blocker",
        "bug"
    ],
    "title": "GCC is installed multiple times",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24670",
    "user": "jdemeyer"
}
```
CC:  embray

#24599 introduced an import regression: GCC is installed multiple times:

```
jdemeyer@sardonis:~/sage-gcc$ grep 'Setting up build directory for gcc' logs/install.log 
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
```


Issue created by migration from https://trac.sagemath.org/ticket/24907





---

archive/issue_comments_346138.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-08T09:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346138",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_346139.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-08T09:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346139",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346140.json:
```json
{
    "body": "\n```\n+            rm -f \"$SAGE_LOCAL\"/gcc\n+            rm -f \"$SAGE_LOCAL\"/g++\n```\n\nDo you mean `\"$SAGE_LOCAL\"/bin/gcc` etc. here? And what does it mean to \"pretend\" that it is not installed?",
    "created_at": "2018-03-09T04:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346140",
    "user": "mkoeppe"
}
```


```
+            rm -f "$SAGE_LOCAL"/gcc
+            rm -f "$SAGE_LOCAL"/g++
```

Do you mean `"$SAGE_LOCAL"/bin/gcc` etc. here? And what does it mean to "pretend" that it is not installed?



---

archive/issue_comments_346141.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-09T06:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346141",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346142.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T09:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346142",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346143.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-09T09:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346143",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346144.json:
```json
{
    "body": "This looks fine to me but I don't fully understand the details of how gcc and its dependencies are installed in sage, so someone else should finish the review of this ticket.",
    "created_at": "2018-03-10T00:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346144",
    "user": "mkoeppe"
}
```

This looks fine to me but I don't fully understand the details of how gcc and its dependencies are installed in sage, so someone else should finish the review of this ticket.



---

archive/issue_comments_346145.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-13T23:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346145",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346146.json:
```json
{
    "body": "This wasn't the cause for the breakage in ppl/givaro noted at #24703#comment:17, various 32-bit buildbots are still borked",
    "created_at": "2018-03-16T22:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346146",
    "user": "vbraun"
}
```

This wasn't the cause for the breakage in ppl/givaro noted at #24703#comment:17, various 32-bit buildbots are still borked



---

archive/issue_comments_346147.json:
```json
{
    "body": "In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:\n\n```\nbuildbot@sagebd07_32s02:~/slave/sage_git/build$ grep -B 1 able-cxx logs/pkgs/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.log \nConfiguring MPIR with the following options:\n    --prefix=\"/home/buildbot/slave/sage_git/build/local\" --libdir=\"/home/buildbot/slave/sage_git/build/local/lib\" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static\n```\n",
    "created_at": "2018-03-16T22:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346147",
    "user": "vbraun"
}
```

In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:

```
buildbot@sagebd07_32s02:~/slave/sage_git/build$ grep -B 1 able-cxx logs/pkgs/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.log 
Configuring MPIR with the following options:
    --prefix="/home/buildbot/slave/sage_git/build/local" --libdir="/home/buildbot/slave/sage_git/build/local/lib" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static
```




---

archive/issue_comments_346148.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-03-16T22:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346148",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_346149.json:
```json
{
    "body": "It does fix the building-gcc-twice bug tho; but maybe the remaining toolchain dependencies coud be fixed here as well?",
    "created_at": "2018-03-16T22:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346149",
    "user": "vbraun"
}
```

It does fix the building-gcc-twice bug tho; but maybe the remaining toolchain dependencies coud be fixed here as well?



---

archive/issue_comments_346150.json:
```json
{
    "body": "If you insist... but one could also consider that an independent bug.",
    "created_at": "2018-03-17T07:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346150",
    "user": "jdemeyer"
}
```

If you insist... but one could also consider that an independent bug.



---

archive/issue_comments_346151.json:
```json
{
    "body": "Replying to [comment:10 vbraun]:\n> In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:\n\nI think that might have been broken in #21524.",
    "created_at": "2018-03-17T07:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346151",
    "user": "jdemeyer"
}
```

Replying to [comment:10 vbraun]:
> In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:

I think that might have been broken in #21524.



---

archive/issue_comments_346152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-17T08:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346152",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346153.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-17T08:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346153",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346154.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-19T07:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346154",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_346155.json:
```json
{
    "body": "I didn't even get to see this before it was closed as \"fixed\", but I must insist that in the future `./configure` should not be doing weird things that modify `$SAGE_LOCAL`.\n\nInstead this should change something about how the makefile works...",
    "created_at": "2018-03-19T11:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346155",
    "user": "embray"
}
```

I didn't even get to see this before it was closed as "fixed", but I must insist that in the future `./configure` should not be doing weird things that modify `$SAGE_LOCAL`.

Instead this should change something about how the makefile works...



---

archive/issue_comments_346156.json:
```json
{
    "body": "What's a reliable way to reproduce this, so that I can try out a different fix?  Is it just to install Sage's gcc package, and then what?  Why would the gcc in Sage be broken?",
    "created_at": "2018-03-19T11:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346156",
    "user": "embray"
}
```

What's a reliable way to reproduce this, so that I can try out a different fix?  Is it just to install Sage's gcc package, and then what?  Why would the gcc in Sage be broken?



---

archive/issue_comments_346157.json:
```json
{
    "body": "Replying to [comment:19 embray]:\n> What's a reliable way to reproduce this\n\nRevert this commit and build Sage with `SAGE_INSTALL_GCC=yes`. It should only build GCC once.\n\n> Why would the gcc in Sage be broken?\n\nBecause the libraries it depends on are upgraded, see #24599.",
    "created_at": "2018-03-19T12:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346157",
    "user": "jdemeyer"
}
```

Replying to [comment:19 embray]:
> What's a reliable way to reproduce this

Revert this commit and build Sage with `SAGE_INSTALL_GCC=yes`. It should only build GCC once.

> Why would the gcc in Sage be broken?

Because the libraries it depends on are upgraded, see #24599.



---

archive/issue_comments_346158.json:
```json
{
    "body": "I still cannot figure out an exact sequence of steps to reproduce this on 8.2.beta8.  I install GCC, then I install giac, then I `./sage -f gcc`?  Seems to work...  Should I go back to an older version?",
    "created_at": "2018-03-20T15:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346158",
    "user": "embray"
}
```

I still cannot figure out an exact sequence of steps to reproduce this on 8.2.beta8.  I install GCC, then I install giac, then I `./sage -f gcc`?  Seems to work...  Should I go back to an older version?



---

archive/issue_comments_346159.json:
```json
{
    "body": "Replying to [comment:21 embray]:\n> I still cannot figure out an exact sequence of steps to reproduce this\n\nWhat is \"this\"? #24907 or #24599?",
    "created_at": "2018-03-20T20:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346159",
    "user": "jdemeyer"
}
```

Replying to [comment:21 embray]:
> I still cannot figure out an exact sequence of steps to reproduce this

What is "this"? #24907 or #24599?



---

archive/issue_comments_346160.json:
```json
{
    "body": "Both, really.  I can't reproduce #24907 (this ticket, hence \"this\").  But I don't know how to reproduce it without reproducing #24599 which I also can't do (but maybe I have to go back to an older version to do that).",
    "created_at": "2018-03-21T09:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24670#issuecomment-346160",
    "user": "embray"
}
```

Both, really.  I can't reproduce #24907 (this ticket, hence "this").  But I don't know how to reproduce it without reproducing #24599 which I also can't do (but maybe I have to go back to an older version to do that).
