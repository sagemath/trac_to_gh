# Issue 19222: Fix containment

archive/issues_019222.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/19459\n\n",
    "created_at": "2015-10-22T17:09:02Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Fix containment",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19222",
    "user": "switzel"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/19459





---

archive/issue_comments_263690.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-10-22T18:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263690",
    "user": "switzel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_263691.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-22T18:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263691",
    "user": "switzel"
}
```

New commits:



---

archive/issue_comments_263692.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to coercion.",
    "created_at": "2015-10-22T18:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263692",
    "user": "switzel"
}
```

Changing component from PLEASE CHANGE to coercion.



---

archive/issue_comments_263693.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-22T18:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263693",
    "user": "switzel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263694.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-22T20:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263694",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263695.json:
```json
{
    "body": "Two comments:\n- For every bug fixed, there needs to be a doctest showing that the bug has been fixed.\n- It is not clear to me that this is the correct fix; I would find it more appropriate to change the method `LaurentSeries.power_series()` to raise a `ValueError` instead of an `ArithmeticError` when given a Laurent series containing terms with negative exponents.  (It seems to me that `ArithmeticError` is intended rather for things like zero division and overflow.)",
    "created_at": "2015-10-22T20:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263695",
    "user": "pbruin"
}
```

Two comments:
- For every bug fixed, there needs to be a doctest showing that the bug has been fixed.
- It is not clear to me that this is the correct fix; I would find it more appropriate to change the method `LaurentSeries.power_series()` to raise a `ValueError` instead of an `ArithmeticError` when given a Laurent series containing terms with negative exponents.  (It seems to me that `ArithmeticError` is intended rather for things like zero division and overflow.)



---

archive/issue_comments_263696.json:
```json
{
    "body": "* Concerning your first comment, I will have to look into that.\n* Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest? [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]",
    "created_at": "2015-10-23T07:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263696",
    "user": "switzel"
}
```

* Concerning your first comment, I will have to look into that.
* Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest? [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]



---

archive/issue_comments_263697.json:
```json
{
    "body": "I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with\n\n```\nsage: ZZ(1/2)\n...\nTypeError: no conversion of this rational to integer\n```\n",
    "created_at": "2015-10-23T11:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263697",
    "user": "jdemeyer"
}
```

I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with

```
sage: ZZ(1/2)
...
TypeError: no conversion of this rational to integer
```




---

archive/issue_comments_263698.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with\n> {{{\n> sage: ZZ(1/2)\n> ...\n> TypeError: no conversion of this rational to integer\n> }}}\nThis is probably the best solution; it is also consistent with rational functions.\n\n```\nsage: R.<x> = QQ[]\nsage: 1/(1 + x)\nTraceback (most recent call last):\n...\nTypeError: denominator must be a unit\n```\n",
    "created_at": "2015-10-23T13:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263698",
    "user": "pbruin"
}
```

Replying to [comment:6 jdemeyer]:
> I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with
> {{{
> sage: ZZ(1/2)
> ...
> TypeError: no conversion of this rational to integer
> }}}
This is probably the best solution; it is also consistent with rational functions.

```
sage: R.<x> = QQ[]
sage: 1/(1 + x)
Traceback (most recent call last):
...
TypeError: denominator must be a unit
```




---

archive/issue_comments_263699.json:
```json
{
    "body": "Replying to [comment:4 switzel]:\n> * Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest?\nThere is no formal decision procedure; the author(s) and reviewer(s) should agree on a solution, and if nobody objects and the release manager agrees to close the ticket, then that is it.\n>  [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]\nI'd be surprised if there is any code that relies on `LaurentSeries.power_series()` raising an `ArithmeticError`, but then again, there may also be code that relies on `__contains__()` not catching `ArithmeticError`...  Anyway, I agree with Jeroen that a `TypeError` is best in view of consistency.",
    "created_at": "2015-10-23T13:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263699",
    "user": "pbruin"
}
```

Replying to [comment:4 switzel]:
> * Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest?
There is no formal decision procedure; the author(s) and reviewer(s) should agree on a solution, and if nobody objects and the release manager agrees to close the ticket, then that is it.
>  [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]
I'd be surprised if there is any code that relies on `LaurentSeries.power_series()` raising an `ArithmeticError`, but then again, there may also be code that relies on `__contains__()` not catching `ArithmeticError`...  Anyway, I agree with Jeroen that a `TypeError` is best in view of consistency.



---

archive/issue_comments_263700.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-26T13:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263700",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263701.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-26T13:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263701",
    "user": "switzel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263702.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-27T07:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263702",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263703.json:
```json
{
    "body": "- There is a doctest failure; see the `shortlog` link in the patchbot report (click the yellow blob on the top right).\n- Use the syntax `raise TypeError(\"bla\")` instead of `raise TypeError, \"bla\"` in new or changed code; see the `plugins.raise_statements` link in the patchbot report.",
    "created_at": "2015-10-27T07:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263703",
    "user": "pbruin"
}
```

- There is a doctest failure; see the `shortlog` link in the patchbot report (click the yellow blob on the top right).
- Use the syntax `raise TypeError("bla")` instead of `raise TypeError, "bla"` in new or changed code; see the `plugins.raise_statements` link in the patchbot report.



---

archive/issue_comments_263704.json:
```json
{
    "body": "Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.\nAccording to our discussion I will change the example.",
    "created_at": "2015-10-27T08:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263704",
    "user": "switzel"
}
```

Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.
According to our discussion I will change the example.



---

archive/issue_comments_263705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T08:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263705",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263706.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-27T08:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263706",
    "user": "switzel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263707.json:
```json
{
    "body": "Replying to [comment:13 switzel]:\n> Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.\nI meant that I didn't expect code (either Sage code or external programs) to specifically depend on an `ArithmeticError`,  For a doctest that just exists to show that an error is raised for invalid input, it is certainly no surprise that it has to be adapted when the specific error changes...\n\nOne more thing: could you please add a reference to this Trac ticket in the doctest (using the syntax `:trac:`19459``)?  See the item \"Bugfixes\" on http://doc.sagemath.org/html/en/developer/reviewer_checklist.html (admittedly this is the reviewer's checklist, but it is useful as an author's checklist as well...)",
    "created_at": "2015-10-27T14:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263707",
    "user": "pbruin"
}
```

Replying to [comment:13 switzel]:
> Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.
I meant that I didn't expect code (either Sage code or external programs) to specifically depend on an `ArithmeticError`,  For a doctest that just exists to show that an error is raised for invalid input, it is certainly no surprise that it has to be adapted when the specific error changes...

One more thing: could you please add a reference to this Trac ticket in the doctest (using the syntax `:trac:`19459``)?  See the item "Bugfixes" on http://doc.sagemath.org/html/en/developer/reviewer_checklist.html (admittedly this is the reviewer's checklist, but it is useful as an author's checklist as well...)



---

archive/issue_comments_263708.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-27T14:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263708",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263709.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T16:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263709",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263710.json:
```json
{
    "body": "Ok, I don't want to argue the point.\n\nAbout your second point, I changed the code. Generally, I'm happy to follow the documentation I can find (so far mostly [http://doc.sagemath.org/html/en/developer/coding_basics.html](http://doc.sagemath.org/html/en/developer/coding_basics.html), which seems not really exhaustive).\n----\nNew commits:",
    "created_at": "2015-10-27T16:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263710",
    "user": "switzel"
}
```

Ok, I don't want to argue the point.

About your second point, I changed the code. Generally, I'm happy to follow the documentation I can find (so far mostly [http://doc.sagemath.org/html/en/developer/coding_basics.html](http://doc.sagemath.org/html/en/developer/coding_basics.html), which seems not really exhaustive).
----
New commits:



---

archive/issue_comments_263711.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-27T16:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263711",
    "user": "switzel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263712.json:
```json
{
    "body": "Final nitpick: I know you didn't introduce this typo, but could you correct\n\n```\nself is a not a power series\n```\n\nto\n\n```\nself is not a power series\n```\n\n(there is an \"a\" too many)?  Then you can set it to positive review on my behalf.",
    "created_at": "2015-10-27T17:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263712",
    "user": "pbruin"
}
```

Final nitpick: I know you didn't introduce this typo, but could you correct

```
self is a not a power series
```

to

```
self is not a power series
```

(there is an "a" too many)?  Then you can set it to positive review on my behalf.



---

archive/issue_comments_263713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T19:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263713",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263714.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-27T19:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263714",
    "user": "switzel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-10-27T20:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263715",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_263716.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-10-27T20:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263716",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_263717.json:
```json
{
    "body": "The doctest in `laurent_series_ring_element.pyx` also needs to be re-fixed for the same reason.",
    "created_at": "2015-10-28T08:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263717",
    "user": "pbruin"
}
```

The doctest in `laurent_series_ring_element.pyx` also needs to be re-fixed for the same reason.



---

archive/issue_comments_263718.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-28T08:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263718",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263719.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-28T11:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263719",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263720.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-10-28T13:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263720",
    "user": "pbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_263721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-28T23:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19222#issuecomment-263721",
    "user": "vbraun"
}
```

Resolution: fixed
