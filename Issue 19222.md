# Issue 19222: Fix containment

Issue created by migration from Trac.

Original creator: switzel

Original creation time: 2015-10-22 17:09:02




---

Comment by switzel created at 2015-10-22 18:22:36

Changing type from PLEASE CHANGE to defect.


---

Comment by switzel created at 2015-10-22 18:22:36

New commits:


---

Comment by switzel created at 2015-10-22 18:22:36

Changing component from PLEASE CHANGE to coercion.


---

Comment by switzel created at 2015-10-22 18:22:36

Changing status from new to needs_review.


---

Comment by pbruin created at 2015-10-22 20:39:55

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2015-10-22 20:39:55

Two comments:
- For every bug fixed, there needs to be a doctest showing that the bug has been fixed.
- It is not clear to me that this is the correct fix; I would find it more appropriate to change the method `LaurentSeries.power_series()` to raise a `ValueError` instead of an `ArithmeticError` when given a Laurent series containing terms with negative exponents.  (It seems to me that `ArithmeticError` is intended rather for things like zero division and overflow.)


---

Comment by switzel created at 2015-10-23 07:57:16

* Concerning your first comment, I will have to look into that.
* Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest? [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]


---

Comment by jdemeyer created at 2015-10-23 11:54:05

I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with

```
sage: ZZ(1/2)
...
TypeError: no conversion of this rational to integer
```



---

Comment by pbruin created at 2015-10-23 13:17:56

Replying to [comment:6 jdemeyer]:
> I'd vote for `TypeError` (as opposed to `ValueError` or `ArithmeticError`) by analogy with
> {{{
> sage: ZZ(1/2)
> ...
> TypeError: no conversion of this rational to integer
> }}}
This is probably the best solution; it is also consistent with rational functions.

```
sage: R.<x> = QQ[]
sage: 1/(1 + x)
Traceback (most recent call last):
...
TypeError: denominator must be a unit
```



---

Comment by pbruin created at 2015-10-23 13:21:16

Replying to [comment:4 switzel]:
> * Concerning your second comment: I don't have a strong opinion on these more philosophical questions (having no experience as a sage developer). How is the decision procedure here? Should I just fix it the way you suggest?
There is no formal decision procedure; the author(s) and reviewer(s) should agree on a solution, and if nobody objects and the release manager agrees to close the ticket, then that is it.
>  [In practical terms my solution is more likely to keep bugs from beeing detected (because an ArithmeticError might be caught by the containment when it shouldn't) while your solution is more likely to break working code (that tests for ArithmeticError that now become ValueErrors).]
I'd be surprised if there is any code that relies on `LaurentSeries.power_series()` raising an `ArithmeticError`, but then again, there may also be code that relies on `__contains__()` not catching `ArithmeticError`...  Anyway, I agree with Jeroen that a `TypeError` is best in view of consistency.


---

Comment by git created at 2015-10-26 13:42:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by switzel created at 2015-10-26 13:44:25

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2015-10-27 07:38:40

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2015-10-27 07:38:40

- There is a doctest failure; see the `shortlog` link in the patchbot report (click the yellow blob on the top right).
- Use the syntax `raise TypeError("bla")` instead of `raise TypeError, "bla"` in new or changed code; see the `plugins.raise_statements` link in the patchbot report.


---

Comment by switzel created at 2015-10-27 08:40:13

Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.
According to our discussion I will change the example.


---

Comment by git created at 2015-10-27 08:50:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by switzel created at 2015-10-27 08:55:39

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2015-10-27 14:03:41

Replying to [comment:13 switzel]:
> Well, seems like what happened is precisely what you said you would be surprised if it happened: the example wants `LaurentSeries.power_series()` to raise an `ArithmeticError` rather than a `TypeError`.
I meant that I didn't expect code (either Sage code or external programs) to specifically depend on an `ArithmeticError`,  For a doctest that just exists to show that an error is raised for invalid input, it is certainly no surprise that it has to be adapted when the specific error changes...

One more thing: could you please add a reference to this Trac ticket in the doctest (using the syntax `:trac:`19459``)?  See the item "Bugfixes" on http://doc.sagemath.org/html/en/developer/reviewer_checklist.html (admittedly this is the reviewer's checklist, but it is useful as an author's checklist as well...)


---

Comment by pbruin created at 2015-10-27 14:03:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-10-27 16:35:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by switzel created at 2015-10-27 16:42:34

Ok, I don't want to argue the point.

About your second point, I changed the code. Generally, I'm happy to follow the documentation I can find (so far mostly [http://doc.sagemath.org/html/en/developer/coding_basics.html](http://doc.sagemath.org/html/en/developer/coding_basics.html), which seems not really exhaustive).
----
New commits:


---

Comment by switzel created at 2015-10-27 16:42:34

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2015-10-27 17:09:45

Final nitpick: I know you didn't introduce this typo, but could you correct

```
self is a not a power series
```

to

```
self is not a power series
```

(there is an "a" too many)?  Then you can set it to positive review on my behalf.


---

Comment by git created at 2015-10-27 19:05:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by switzel created at 2015-10-27 19:06:34

Changing status from needs_review to positive_review.


---

Comment by git created at 2015-10-27 20:09:46

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-10-27 20:09:46

Changing status from positive_review to needs_review.


---

Comment by pbruin created at 2015-10-28 08:22:46

The doctest in `laurent_series_ring_element.pyx` also needs to be re-fixed for the same reason.


---

Comment by pbruin created at 2015-10-28 08:22:46

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-10-28 11:17:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2015-10-28 13:01:54

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-10-28 23:17:10

Resolution: fixed
