# Issue 21740: make linbox compile with clang and libc++ on Linux

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2016-11-26 15:49:57

Keywords: clang, libc++

Presently linbox assumes that clang and libc++ only come on OSX,
and breakes such a configuration by forcing low-level libstdc++-only features (see #12426, comment 109)


---

Comment by dimpase created at 2016-11-26 17:53:44

reported upstream https://github.com/linbox-team/linbox/issues/46


---

Comment by fbissey created at 2017-04-05 01:49:02

I corrected the bit about `std::_Bit_reference` at the top of `field/gf2.h` and there is another similar problem at the end of the same file

```
[linbox-1.4.2] ../../linbox/field/gf2.h:1010:10: fatal error: 'bits/stl_bvector.h' file not found
[linbox-1.4.2] #include <bits/stl_bvector.h>
[linbox-1.4.2]          ^
[linbox-1.4.2] 1 error generated.
```

The code is 

```
#if __cplusplus >= 201103L
#if defined( __APPLE__) && defined(__clang__)
#include <__bit_reference>
#else
#include <bits/stl_bvector.h>
#endif /* __clang__ */
```

You shouldn't use headers under `bits` directly, they are implementation dependent. Is it hard to understand?


---

Comment by fbissey created at 2017-04-05 22:28:40

Also I believe it is time to re-enable spkg-check in linbox

```
[linbox-1.4.2] make[8]: Leaving directory '/home/fbissey/sandbox/git-fork/sage-clang/local/var/tmp/sage/build/linbox-1.4.2/src/tests'
[linbox-1.4.2] make[7]: Leaving directory '/home/fbissey/sandbox/git-fork/sage-clang/local/var/tmp/sage/build/linbox-1.4.2/src/tests'
[linbox-1.4.2] ============================================================================
[linbox-1.4.2] Testsuite summary for LinBox 1.4.2
[linbox-1.4.2] ============================================================================
[linbox-1.4.2] # TOTAL: 15
[linbox-1.4.2] # PASS:  15
[linbox-1.4.2] # SKIP:  0
[linbox-1.4.2] # XFAIL: 0
[linbox-1.4.2] # FAIL:  0
[linbox-1.4.2] # XPASS: 0
[linbox-1.4.2] # ERROR: 0
[linbox-1.4.2] ============================================================================
```



---

Comment by fbissey created at 2017-04-05 22:54:22

New commits:


---

Comment by fbissey created at 2017-04-05 22:54:22

Changing status from new to needs_review.


---

Comment by dimpase created at 2017-04-06 22:00:03

I am running ptestlong on freebsd with this branch now.


---

Comment by dimpase created at 2017-04-07 08:13:43

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2017-04-07 08:13:43

looks good.


---

Comment by vbraun created at 2017-04-08 17:13:02

Resolution: fixed
