# Issue 21453: fplll 5.x build fails on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/21690

Original creator: embray

Original creation time: 2016-10-12 08:53:24

CC:  malb

Keywords: windows cygwin fplll

Relevant portion of the build log:


```
[fplll-5.0.3rc0] depbase=`echo fplll.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
[fplll-5.0.3rc0] /bin/sh ../libtool  --tag=CXX   --mode=compile g++ -std=c++11 -DHAVE_CONFIG_H -I. -I..  -DFPLLL_DEFAULT_STRATEGY_PATH=\"/home/embray/src/sagemath/sage/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/home/embray/src/sagemath/sage/local/share/fplll/strategies/default.json\" -I./.. -I/home/embray/src/sagemath/sage/local/include/  -I/home/embray/src/sagemath/sage/local/include/ -L/home/embray/src/sagemath/sage/local/lib -O0 -MT fplll.lo -MD -MP -MF $depbase.Tpo -c -o fplll.lo fplll.cpp &&\
[fplll-5.0.3rc0] mv -f $depbase.Tpo $depbase.Plo
[fplll-5.0.3rc0] libtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\"/home/embray/src/sagemath/sage/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/home/embray/src/sagemath/sage/local/share/fplll/strategies/default.json\" -I./.. -I/home/embray/src/sagemath/sage/local/include/ -I/home/embray/src/sagemath/sage/local/include/ -L/home/embray/src/sagemath/sage/local/lib -O0 -MT fplll.lo -MD -MP -MF .deps/fplll.Tpo -c fplll.cpp  -DDLL_EXPORT -DPIC -o .libs/fplll.o
[fplll-5.0.3rc0] In file included from ../fplll/nr/../defs.h:55:0,
[fplll-5.0.3rc0]                  from ../fplll/nr/nr.h:8,
[fplll-5.0.3rc0]                  from ../fplll/nr/numvect.h:19,
[fplll-5.0.3rc0]                  from nr/matrix.h:21,
[fplll-5.0.3rc0]                  from util.h:23,
[fplll-5.0.3rc0]                  from fplll.h:25,
[fplll-5.0.3rc0]                  from fplll.cpp:18:
[fplll-5.0.3rc0] ../fplll/nr/../nr/dpe.h: In function 'void dpe_ugly_log(dpe_struct*, const dpe_struct*)':
[fplll-5.0.3rc0] ../fplll/nr/../nr/dpe.h:775:42: error: 'M_LN2' was not declared in this scope
[fplll-5.0.3rc0]    dpe_set_d (x, ((double) DPE_EXP(y)) *  M_LN2 + log (DPE_MANT(y)));
[fplll-5.0.3rc0]                                           ^
[fplll-5.0.3rc0] In file included from ../fplll/nr/nr.h:10:0,
[fplll-5.0.3rc0]                  from ../fplll/nr/numvect.h:19,
[fplll-5.0.3rc0]                  from nr/matrix.h:21,
[fplll-5.0.3rc0]                  from util.h:23,
[fplll-5.0.3rc0]                  from fplll.h:25,
[fplll-5.0.3rc0]                  from fplll.cpp:18:
[fplll-5.0.3rc0] ../fplll/nr/nr_rand.inl: In static member function 'static void fplll::RandGen::init_with_time2()':
[fplll-5.0.3rc0] ../fplll/nr/nr_rand.inl:29:28: error: 'gettimeofday' was not declared in this scope
[fplll-5.0.3rc0]      gettimeofday(&time,NULL);
[fplll-5.0.3rc0]                             ^
[fplll-5.0.3rc0] In file included from bkz.h:24:0,
[fplll-5.0.3rc0]                  from fplll.h:28,
[fplll-5.0.3rc0]                  from fplll.cpp:18:
[fplll-5.0.3rc0] lll.h: In destructor 'fplll::LLLReduction<ZT, FT>::~LLLReduction()':
[fplll-5.0.3rc0] lll.h:39:21: error: 'LDConvHelper' has not been declared
[fplll-5.0.3rc0]    ~LLLReduction() { LDConvHelper::free(); }
[fplll-5.0.3rc0]                      ^
[fplll-5.0.3rc0] make[6]: *** [Makefile:851: fplll.lo] Error 1
```


This only started since #21221 was merged.  I haven't looked at the cause at all yet.

(P.S. I can't wait to get that cygwin build bot up and running :D)


---

Comment by embray created at 2016-10-12 10:29:23

Changing status from new to needs_review.


---

Comment by embray created at 2016-10-12 10:29:23

Here's an initial fix (against #21675) which includes the patch to `lll.h` and a patch to `spkg-install`.

I'm also about to try a patch to the `configure.ac` for supporting Cygwin.
----
New commits:


---

Comment by embray created at 2016-10-13 10:41:27

Looks like fpylll also has a problem on Cygwin.  I'm going to address that as part of this ticket while I'm at it.  It appears to be another issue with long double.


---

Comment by embray created at 2016-10-13 10:41:27

Changing status from needs_review to needs_work.


---

Comment by embray created at 2016-10-14 08:28:06

My patch for the issue in fpylll is here: https://github.com/fplll/fpylll/pull/41  I've confirmed that it solves the problem for me and passes the existing tests.  I could update this ticket to include the patch, but there's no longer any urgency on this for me (as I can proceed with the build) so I'll wait and see.


---

Comment by git created at 2016-10-14 12:53:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by embray created at 2016-10-14 12:54:44

Changing status from needs_work to needs_review.


---

Comment by embray created at 2016-10-14 12:54:44

Added additional patch needed for fpylll to build/work on Cygwin.  Rebased on #20692 which I'm making a dependency of this ticket, just so I don't have to rebase _that_ branch again.  This ticket can wait on #20692.


---

Comment by cheuberg created at 2017-01-08 06:34:29

does not merge with 7.5.rc2


---

Comment by cheuberg created at 2017-01-08 06:34:29

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-01-09 09:00:26

Hm, I wouldn't complain but this one never even got a review.


---

Comment by jpflori created at 2017-01-26 07:54:00

Please update the branch and I'll review it.


---

Comment by git created at 2017-01-26 09:54:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-01-26 09:55:20

Rebased.


---

Comment by embray created at 2017-01-26 09:55:20

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2017-01-26 10:00:36

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2017-01-26 10:00:36

Looks ok to me.
I trust Erik tested it properly.


---

Comment by vbraun created at 2017-01-28 17:25:22

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-01-28 17:25:22


```
Applying ../patches/ticket-21690.patch
patching file setup.py
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
1 out of 1 hunk ignored -- saving rejects to file setup.py.rej
patching file src/fpylll/config.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
1 out of 1 hunk ignored -- saving rejects to file src/fpylll/config.pyx.rej
patching file src/fpylll/fplll/bkz.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
16 out of 16 hunks ignored -- saving rejects to file src/fpylll/fplll/bkz.pyx.rej
patching file src/fpylll/fplll/decl.pxd
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
1 out of 1 hunk ignored -- saving rejects to file src/fpylll/fplll/decl.pxd.rej
patching file src/fpylll/fplll/enumeration.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
8 out of 8 hunks ignored -- saving rejects to file src/fpylll/fplll/enumeration.pyx.rej
patching file src/fpylll/fplll/gso.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
30 out of 30 hunks ignored -- saving rejects to file src/fpylll/fplll/gso.pyx.rej
patching file src/fpylll/fplll/lll.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
9 out of 9 hunks ignored -- saving rejects to file src/fpylll/fplll/lll.pyx.rej
patching file src/fpylll/fplll/pruner.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
3 out of 3 hunks ignored -- saving rejects to file src/fpylll/fplll/pruner.pyx.rej
patching file src/fpylll/numpy.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
2 out of 2 hunks ignored -- saving rejects to file src/fpylll/numpy.pyx.rej
patching file src/fpylll/util.pyx
Reversed (or previously applied) patch detected!  Assume -R? [n] 
Apply anyway? [n] 
Skipping patch.
1 out of 1 hunk ignored -- saving rejects to file src/fpylll/util.pyx.rej
Error applying '../patches/ticket-21690.patch'
```



---

Comment by embray created at 2017-01-30 11:04:08

Um, this obviously used to work.  Was the fpylll package updated?


---

Comment by git created at 2017-01-30 11:08:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-01-30 11:11:32

Updated the branch to drop to patch for fpylll since it is no longer needed since the fpylll version was bumped in #21728.


---

Comment by embray created at 2017-01-30 11:11:32

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2017-02-13 09:48:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-16 22:28:27

Resolution: fixed
