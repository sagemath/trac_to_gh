# Issue 16255: Unital non-associative algebras can't be created

Issue created by migration from https://trac.sagemath.org/ticket/16492

Original creator: tscrim

Original creation time: 2014-06-17 17:29:18

Assignee: tscrim

CC:  nthiery simonking

Keywords: unital nonassociative algebras, coercion

In #16055, I was trying to create a unital "magmatic" algebra `A` and pass a base ring to `Parent`. This then tries to setup the default coercion from the base ring to `A`, which fails because `A` is not in `Rings()`.

```
sage: from sage.categories.magmatic_algebras import MagmaticAlgebras
sage: class A(Parent):
....:     def __init__(self, R):
....:         Parent.__init__(self, base=R, category=MagmaticAlgebras(R).Unital())
....:         
sage: A(QQ)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-15-88fb3480ad86> in <module>()
----> 1 A(QQ)

<ipython-input-14-60fb77c01127> in __init__(self, R)
      1 class A(Parent):
      2     def __init__(self, R):
----> 3         Parent.__init__(self, base=R, category=MagmaticAlgebras(R).Unital())
      4 

/home/travis/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__init__ (sage/structure/parent.c:4594)()

/home/travis/sage/local/lib/python2.7/site-packages/sage/categories/unital_algebras.pyc in __init_extra__(self)
    105             mor = None
    106             # This could be a morphism of Algebras(self.base_ring()); however, e.g., QQ is not in Algebras(QQ)
--> 107             H = Hom(base_ring, self, Rings()) # TODO: non associative ring!
    108 
    109             # Idea: There is a generic method "from_base_ring", that just does multiplication with

/home/travis/sage/local/lib/python2.7/site-packages/sage/categories/homset.pyc in Hom(X, Y, category, check)
    391                     # available for the following error message. It simply
    392                     # belongs to the wrong category.
--> 393                     raise ValueError("{} is not in {}".format(O, category))
    394 
    395         # Construct H

ValueError: <class '__main__.A_with_category'> is not in Category of rings
```



---

Comment by tscrim created at 2014-06-17 17:32:56

So I'm thinking we should have a new category for unital associative algebras which sets up this coercion and the non-associative variety not. Comments?


---

Comment by nthiery created at 2014-06-20 23:00:01

Ah, interesting: there can be situations where it's perfectly legitimate to want to define a morphism in a category C with a codomain that does not belong to C. Maybe we just want to add a "force=True" argument to reduce the sanity checks in those cases where the caller knows what he is doing. And reciprocally, we should better take into account the axioms of the domain in the case at hand.

Fun topic for an upcoming brainstorm in any cases!


---

Comment by pbruin created at 2017-08-04 12:34:32

It looks like this may be solved by #19225.


---

Comment by tscrim created at 2017-08-06 14:57:56

I do not think #19225 is the solution. I think the problem is the lack of a proper category for nonassociative rings and rngs for the corresponding `Hom`, which is still a problem even with #19225.


---

Comment by pbruin created at 2017-08-07 05:54:07

Replying to [comment:5 tscrim]:
> I do not think #19225 is the solution. I think the problem is the lack of a proper category for nonassociative rings and rngs for the corresponding `Hom`, which is still a problem even with #19225.
Why is it a problem?  The change in #19225 that fixes this particular error is replacing `Rings()` by `Sets()`; this doesn't break anything as far as I can see.  

Of course, if you really want you can use something like `MagmasAndAdditiveMagmas().Distributive().AdditiveAssociative().AdditiveCommutative().AdditiveUnital().AdditiveInverse().Unital()` for the `Hom` set, but then perhaps the next type of object someone wants to create may not have additive inverses, for example.


---

Comment by pbruin created at 2020-03-02 07:54:05

There is no error anymore in SageMath 9.1.beta6:

```
sage: from sage.categories.magmatic_algebras import MagmaticAlgebras
....: class A(Parent):
....:     def __init__(self, R):
....:         Parent.__init__(self, base=R, category=MagmaticAlgebras(R).Unital())
....: B = A(QQ); B
....: B.coerce_map_from(QQ)
....:
<__main__.A_with_category object at 0x7ee3bdc39408>
Generic morphism:
  From: Rational Field
  To:   <__main__.A_with_category object at 0x7ee3bdc39408>
```



---

Comment by tscrim created at 2020-03-02 23:40:23

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-03-02 23:40:23

Seems like you were right. Thus works-for-me.


---

Comment by pbruin created at 2020-03-03 07:37:28

Actually it was already fixed in SageMath 9.0 or earlier, most likely by #28328.  I guess we can regard this ticket as a duplicate.


---

Comment by pbruin created at 2020-03-03 07:37:28

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-03-06 19:29:57

Resolution: duplicate
