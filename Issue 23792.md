# Issue 23792: Force -std=gnu++11 for Linbox

Issue created by migration from https://trac.sagemath.org/ticket/24029

Original creator: jdemeyer

Original creation time: 2017-10-13 10:23:01

CC:  fbissey cpernet

It turns out that Linbox compiles with `-std=gnu++11` but not with `-std=c++11`:

```
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/buildbot/slave/sage_git/build/local/include -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/home/buildbot/slave/sage_git/build/src -I/home/buildbot/slave/sage_git/build/src/sage/ext -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -c build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp -o build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/linbox/linbox_flint_interface.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -U_LB_DEBUG -DDISABLE_COMMENTATOR -Wall -DNDEBUG -UFFLASFFPACK_DEBUG -D__FFLASFFPACK_HAVE_CBLAS -g -O2 -DFFLAS_COMPILED -DFFPACK_COMPILED -fPIC -mmmx -mpopcnt -msse -msse2 -msse3 -msse4.1 -msse4.2 -mavx -mavx2 -mfma -mbmi -mbmi2 -mfpmath=sse -fabi-version=6 -I/home/buildbot/slave/sage_git/build/local/include/linbox -I/home/buildbot/slave/sage_git/build/local/include -std=c++11
In file included from /usr/include/c++/6/bits/move.h:57:0,
                 from /usr/include/c++/6/bits/nested_exception.h:40,
                 from /usr/include/c++/6/exception:173,
                 from /usr/include/c++/6/ios:39,
                 from /usr/include/c++/6/ostream:38,
                 from /usr/include/c++/6/iostream:39,
                 from /home/buildbot/slave/sage_git/build/local/include/linbox/linbox-config.h:45,
                 from build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp:655:
/usr/include/c++/6/type_traits: In instantiation of ‘struct std::make_unsigned<__int128 unsigned>’:
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from ‘class Givaro::Modular<long int, __int128 unsigned>’
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:32:36:   required from here
/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type ‘class std::__make_unsigned_selector<__int128 unsigned, false, false>’
     { typedef typename __make_unsigned_selector<_Tp>::__type type; };
                                                              ^~~~
/usr/include/c++/6/type_traits:1788:11: note: declaration of ‘class std::__make_unsigned_selector<__int128 unsigned, false, false>’
     class __make_unsigned_selector;
           ^~~~~~~~~~~~~~~~~~~~~~~~
/usr/include/c++/6/type_traits: In instantiation of ‘struct std::make_unsigned<__int128>’:
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from ‘class Givaro::Modular<long int, __int128>’
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:36:35:   required from here
/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type ‘class std::__make_unsigned_selector<__int128, false, false>’
     { typedef typename __make_unsigned_selector<_Tp>::__type type; };
                                                              ^~~~
```

To make this fact explicit and to fix #23919, I propose to add `-std=gnu++11` to the CXXFLAGS of Linbox.


---

Comment by jdemeyer created at 2017-10-13 13:20:20

New commits:


---

Comment by jdemeyer created at 2017-10-13 13:20:20

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-10-26 21:01:42

LGTM


---

Comment by fbissey created at 2017-10-26 21:01:42

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-10-26 21:02:33

Actually I am surprised you didn't bump the version number of linbox. That's out of character for you :)


---

Comment by cpernet created at 2017-10-27 06:39:57

For the record: when compiling LinBox (and fflas-ffpack and givaro) with clang-3.8 and using the glibc++ v>=6 (IIRC), we hit a bug when the `--std=gnu++11` as the compiler does not support the `__float128` type.
See https://github.com/linbox-team/givaro/issues/47

Replacing `std=gnu++11` by `std=c++11` in this case solves the problem.
Hence, we let givaro/fflas/linbox configure scripts select which option to use and properly export it in the pc files (in upstream version of the lib).

I think this ticket is still good to go for the current version of linbox shipped in Sage, and assuming that one compiles with gcc, but it will probably be removed when the new versions will be ported to sage (which I am working on now). I am just a little worried about having the main sage configure script forcing the `gnu++11` option unconditionally.


---

Comment by fbissey created at 2017-10-27 06:44:56

We don't force anything. Actually we stopped `spkg-install` from forcing `-std=c++98/gnu++98`, it now default to whatever `configure` default to. We only force `gnu++11` in the sage library. I guess I'll see what happens with clang in #12426.


---

Comment by cpernet created at 2017-10-27 06:51:50

Replying to [comment:8 fbissey]:
> We only force `gnu++11` in the sage library. 
But since linbox/fflas are source libraries, they are compiled bits by bits while compiling the sage library, and it would therefore require to use the appropriate c++11 flag that linbox/fflas will expose in their pc files.


---

Comment by fbissey created at 2017-10-27 07:09:54

I cannot argue with that. Real consistency will hopefully be achieved in the near future.


---

Comment by vbraun created at 2017-10-29 10:31:45

Resolution: fixed
