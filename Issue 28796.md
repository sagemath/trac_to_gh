# Issue 28796: Support minimal system Python version 3.6

archive/issues_028796.json:
```json
{
    "body": "CC:  @jhpalmieri @dimpase @kiwifb @orlitzky\n\nWith #29032 it is possible to use an existing Python 3.7 on the system to build and run Sage.  This is designed to work with Python 3.7 (and < 3.8) since that's what's currently used by sage-the-distribution and is best-tested.\n\nHowever, it turns out an existing Python 3.6 can work just fine as the minimum Python version with a few small fixes (sage-the-distribution used Python 3.6 until last year, so the degree to which we diverged from supporting it was minimal).\n\nI think this would be a nice-to-have, if not strictly necessary.  Maybe since Sage is less tested with 3.6, there could be a warning against using it.  But actually I'd be happy to keep running a Python 3.6 patchbot for a while until/unless it becomes untenable to support Python 3.6.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29033\n\n",
    "created_at": "2020-01-17T17:36:10Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Support minimal system Python version 3.6",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28796",
    "user": "https://github.com/embray"
}
```
CC:  @jhpalmieri @dimpase @kiwifb @orlitzky

With #29032 it is possible to use an existing Python 3.7 on the system to build and run Sage.  This is designed to work with Python 3.7 (and < 3.8) since that's what's currently used by sage-the-distribution and is best-tested.

However, it turns out an existing Python 3.6 can work just fine as the minimum Python version with a few small fixes (sage-the-distribution used Python 3.6 until last year, so the degree to which we diverged from supporting it was minimal).

I think this would be a nice-to-have, if not strictly necessary.  Maybe since Sage is less tested with 3.6, there could be a warning against using it.  But actually I'd be happy to keep running a Python 3.6 patchbot for a while until/unless it becomes untenable to support Python 3.6.

Issue created by migration from https://trac.sagemath.org/ticket/29033





---

archive/issue_comments_406469.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-17T17:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406469",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_406470.json:
```json
{
    "body": "Related to the question of what Python versions are good is #26457 - \"Do not depend on a patched Python\"",
    "created_at": "2020-01-17T20:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406470",
    "user": "https://github.com/mkoeppe"
}
```

Related to the question of what Python versions are good is #26457 - "Do not depend on a patched Python"



---

archive/issue_comments_406471.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406471",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_406472.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-22T05:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406472",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_406473.json:
```json
{
    "body": "This would need rebasing",
    "created_at": "2020-04-22T05:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406473",
    "user": "https://github.com/mkoeppe"
}
```

This would need rebasing



---

archive/issue_comments_406474.json:
```json
{
    "body": "Edited description to clarify that this is about the venv python3, not sage-system-python.",
    "created_at": "2020-05-28T06:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406474",
    "user": "https://github.com/mkoeppe"
}
```

Edited description to clarify that this is about the venv python3, not sage-system-python.



---

archive/issue_comments_406475.json:
```json
{
    "body": "Tests at https://github.com/mkoeppe/sage/pull/37/checks\n----\nNew commits:",
    "created_at": "2020-06-05T21:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406475",
    "user": "https://github.com/mkoeppe"
}
```

Tests at https://github.com/mkoeppe/sage/pull/37/checks
----
New commits:



---

archive/issue_comments_406476.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-05T21:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406476",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_406477.json:
```json
{
    "body": "TODO: Check `fedora-28` and `centos-8` in https://github.com/mkoeppe/sage/actions/runs/126407840",
    "created_at": "2020-06-06T06:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406477",
    "user": "https://github.com/mkoeppe"
}
```

TODO: Check `fedora-28` and `centos-8` in https://github.com/mkoeppe/sage/actions/runs/126407840



---

archive/issue_comments_406478.json:
```json
{
    "body": "LGTM if those tests pass.",
    "created_at": "2020-06-06T11:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406478",
    "user": "https://github.com/orlitzky"
}
```

LGTM if those tests pass.



---

archive/issue_comments_406479.json:
```json
{
    "body": "Tests now at https://github.com/mkoeppe/sage/actions/runs/127369767",
    "created_at": "2020-06-07T03:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406479",
    "user": "https://github.com/mkoeppe"
}
```

Tests now at https://github.com/mkoeppe/sage/actions/runs/127369767



---

archive/issue_comments_406480.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-07T18:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406480",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_406481.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-06-07T18:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406481",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_406482.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-21T22:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406482",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_406483.json:
```json
{
    "body": "C.UTF-8 locale is a Debian-specific thing (and maybe Fedora). Please don't assume that it is available. On Arch, this causes lots (as in, one every other line in the compilation output) of warnings \n\n```\n/bin/sh: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)\n```\n",
    "created_at": "2020-07-03T07:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406483",
    "user": "https://github.com/antonio-rojas"
}
```

C.UTF-8 locale is a Debian-specific thing (and maybe Fedora). Please don't assume that it is available. On Arch, this causes lots (as in, one every other line in the compilation output) of warnings 

```
/bin/sh: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
```




---

archive/issue_comments_406484.json:
```json
{
    "body": "on another ticket, fixing docbuild on non-EN locales, someone using Arch complained that `LANG=C` causes a lot of warnings.",
    "created_at": "2020-07-03T08:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406484",
    "user": "https://github.com/dimpase"
}
```

on another ticket, fixing docbuild on non-EN locales, someone using Arch complained that `LANG=C` causes a lot of warnings.



---

archive/issue_comments_406485.json:
```json
{
    "body": "Replying to [comment:21 arojas]:\n> C.UTF-8 locale is a Debian-specific thing (and maybe Fedora). Please don't assume that it is available.\n\nSorry about that, I didn't realize that Gentoo's glibc was patched (the patches are in an unusual place). It looks like discussion is still ongoing for glibc:\n\nhttps://sourceware.org/pipermail/libc-alpha/2020-June/115224.html\n\nMusl, on the other hand, already supports it I think?\n\nhttps://wiki.musl-libc.org/functional-differences-from-glibc.html\n\nIn any case, we should probably revert to `C` in the meantime.",
    "created_at": "2020-07-03T11:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406485",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:21 arojas]:
> C.UTF-8 locale is a Debian-specific thing (and maybe Fedora). Please don't assume that it is available.

Sorry about that, I didn't realize that Gentoo's glibc was patched (the patches are in an unusual place). It looks like discussion is still ongoing for glibc:

https://sourceware.org/pipermail/libc-alpha/2020-June/115224.html

Musl, on the other hand, already supports it I think?

https://wiki.musl-libc.org/functional-differences-from-glibc.html

In any case, we should probably revert to `C` in the meantime.



---

archive/issue_comments_406486.json:
```json
{
    "body": "the locale issue is being dealt with on #30053",
    "created_at": "2020-07-03T13:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406486",
    "user": "https://github.com/dimpase"
}
```

the locale issue is being dealt with on #30053



---

archive/issue_comments_406487.json:
```json
{
    "body": "This has introduced an unfortunate bug related to a weird search order in `AC_PATH_PROGS_FEATURE_CHECK()`, which has the outer loop over `PATH` entries.\nThus, a python on the list `[python.foo python.baz ....]` of pythons that comes first in `PATH` and has all the features will be picked, not the first python on the list.\n\nAs modifying `PATH` to put the best python 1st might be error-prone (think about Conda, Homebrew, etc), this should be fixed.\n\nThis is of course an autoconf bug, too, as `AC_PATH_PROGS()` has a sane order, ie. its outer loop is over the list entries.",
    "created_at": "2020-09-10T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406487",
    "user": "https://github.com/dimpase"
}
```

This has introduced an unfortunate bug related to a weird search order in `AC_PATH_PROGS_FEATURE_CHECK()`, which has the outer loop over `PATH` entries.
Thus, a python on the list `[python.foo python.baz ....]` of pythons that comes first in `PATH` and has all the features will be picked, not the first python on the list.

As modifying `PATH` to put the best python 1st might be error-prone (think about Conda, Homebrew, etc), this should be fixed.

This is of course an autoconf bug, too, as `AC_PATH_PROGS()` has a sane order, ie. its outer loop is over the list entries.



---

archive/issue_comments_406488.json:
```json
{
    "body": "Replying to [comment:25 dimpase]:\n> This has introduced an unfortunate bug related to a weird search order in `AC_PATH_PROGS_FEATURE_CHECK()`, which has the outer loop over `PATH` entries.\n> Thus, a python on the list `[python.foo python.baz ....]` of pythons that comes first in `PATH` and has all the features will be picked, not the first python on the list.\n> \n> As modifying `PATH` to put the best python 1st might be error-prone (think about Conda, Homebrew, etc), this should be fixed.\n> \n> This is of course an autoconf bug, too, as `AC_PATH_PROGS()` has a sane order, ie. its outer loop is over the list entries.\n> \n>   \nsee #30546 for a fix",
    "created_at": "2020-09-10T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406488",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:25 dimpase]:
> This has introduced an unfortunate bug related to a weird search order in `AC_PATH_PROGS_FEATURE_CHECK()`, which has the outer loop over `PATH` entries.
> Thus, a python on the list `[python.foo python.baz ....]` of pythons that comes first in `PATH` and has all the features will be picked, not the first python on the list.
> 
> As modifying `PATH` to put the best python 1st might be error-prone (think about Conda, Homebrew, etc), this should be fixed.
> 
> This is of course an autoconf bug, too, as `AC_PATH_PROGS()` has a sane order, ie. its outer loop is over the list entries.
> 
>   
see #30546 for a fix



---

archive/issue_comments_406489.json:
```json
{
    "body": "Follow up regarding `centos-7`:\n> (because a dependency of python3 is too old):\n>  - `centos-7` (3.6.8): `sqlite` is too old (https://github.com/mkoeppe/sage/runs/743789990)\n\nAfter #30559, `sqlite` is no longer the problem, but python3 is still not accepted on this system because of `zlib` -> `libpng`:\n\n```\nChecking whether SageMath should install SPKG zlib...\nchecking for inflateEnd in -lz... yes\nchecking zlib.h usability... yes\nchecking zlib.h presence... yes\nchecking for zlib.h... yes\nchecking for LIBPNG... no\nchecking for inflateValidate in -lz... no\nconfigure: no suitable system package found for SPKG zlib\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG libpng...\nchecking installing zlib? ... yes; install libpng as well\nconfigure: no suitable system package found for SPKG libpng\n```\n",
    "created_at": "2020-12-05T03:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406489",
    "user": "https://github.com/mkoeppe"
}
```

Follow up regarding `centos-7`:
> (because a dependency of python3 is too old):
>  - `centos-7` (3.6.8): `sqlite` is too old (https://github.com/mkoeppe/sage/runs/743789990)

After #30559, `sqlite` is no longer the problem, but python3 is still not accepted on this system because of `zlib` -> `libpng`:

```
Checking whether SageMath should install SPKG zlib...
checking for inflateEnd in -lz... yes
checking zlib.h usability... yes
checking zlib.h presence... yes
checking for zlib.h... yes
checking for LIBPNG... no
checking for inflateValidate in -lz... no
configure: no suitable system package found for SPKG zlib
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG libpng...
checking installing zlib? ... yes; install libpng as well
configure: no suitable system package found for SPKG libpng
```




---

archive/issue_comments_406490.json:
```json
{
    "body": "#31009 is taking care of this.",
    "created_at": "2020-12-05T03:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28796",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28796#issuecomment-406490",
    "user": "https://github.com/mkoeppe"
}
```

#31009 is taking care of this.
