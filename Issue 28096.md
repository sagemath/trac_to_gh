# Issue 28096: spkg-configure.m4 for eclib

Issue created by migration from https://trac.sagemath.org/ticket/28333

Original creator: dimpase

Original creation time: 2019-08-08 16:06:07

CC:  embray fbissey isuruf

the main issue here is how to check that the version installed on the system is good enough.


---

Comment by dimpase created at 2019-08-08 16:15:53

while at it, we should fix eclib's `spkg-install`, which should always have `--with-flint`, otherwise flint is not linked it (causing worse performance I guess).


---

Comment by dimpase created at 2019-08-08 16:17:31

see https://github.com/JohnCremona/eclib/issues/56 for the version issue


---

Comment by dimpase created at 2019-08-08 20:28:02

New commits:


---

Comment by git created at 2019-08-08 20:36:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-08-09 07:33:07

The current Debian eclib is too old, one needs to rule it out using something like
https://github.com/JohnCremona/eclib/issues/56#issuecomment-519813168
----
New commits:


---

Comment by git created at 2019-08-09 08:27:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2019-08-09 09:23:03

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-08-09 10:41:51

To test this, I checked that eclib from Debian 10 does not get picked up (as it should be). Then I uninstalled the system's eclib and installed the current eclib into /usr/local (with the configure parameters as in spkg-install), and it got picked up just fine.


---

Comment by isuruf created at 2019-08-09 17:58:10


```
configure:12023: /projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/bin/x86_64-conda_cos6-linux-gnu-c++ -std=gnu++11 -o conftest -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -I/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/include -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -L/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/lib -Wl,-rpath,/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/lib -lec conftest.cpp -lmpfr -lgmp -lm  -lntl >&5
/projects/66d93023-00f0-4c12-8a25-5d6d4e486740/sage-build/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /tmp/ccEA25VC.o: in function `main':
conftest.cpp:(.text.startup.main+0x11): undefined reference to `show_version()'
```


Note that `-lec` comes before `conftest.cpp` and not after like the other libs.


---

Comment by isuruf created at 2019-08-09 17:58:10

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-08-09 19:25:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2019-08-09 19:26:41

OK, I've fixed this, it was a really bad bug there, not the least wrong number of parameters used for AC_RUN_IFELSE.


---

Comment by dimpase created at 2019-08-09 19:26:41

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-08-09 20:31:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-08-09 20:32:38

rebased over updated #28242


---

Comment by isuruf created at 2019-08-10 04:54:25

Changing status from needs_review to positive_review.


---

Comment by isuruf created at 2019-08-10 04:54:25

Works for me in conda


---

Comment by vbraun created at 2019-08-11 16:43:58

Resolution: fixed
