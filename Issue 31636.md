# Issue 31636: use libgiac instead of giac for integration

archive/issues_031636.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: giac, integration\n\nNow that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).\n\nThis will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.\n\nThe `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.\n\n```\nsage: integrate(abs(cos(x)), x, 0, 2*pi)\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [abs(cos(x))]\nDiscontinuities at zeroes of cos(x) were not checked\n4\n```\nThese messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.\n\nDue to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.\n\nPart of meta-ticket #16688.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31873\n\n",
    "closed_at": "2021-08-29T09:36:42Z",
    "created_at": "2021-05-28T20:34:55Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "use libgiac instead of giac for integration",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31636",
    "user": "https://github.com/mwageringel"
}
```
CC:  @slel

Keywords: giac, integration

Now that giacpy_sage has been included into Sage by #29171, we can use it for integration instead of the Pexpect interface. This ticket adds a `libgiac_integrator` which replaces the `giac_integrator` in the default integrator (which uses Maxima, Giac, and Sympy).

This will resolve issues like #28913 or this [ask-sage question](https://ask.sagemath.org/question/57312/result-that-comes-with-warning-from-giac-integrator/) where the Pexpect output cannot be parsed by Sage because Giac prints warning messages to the output.

The `libgiac_integrator` behaves slightly different than the Pexpect-based integrator, in that warning messages issued by Giac are not stripped away anymore.

```
sage: integrate(abs(cos(x)), x, 0, 2*pi)
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(cos(x))]
Discontinuities at zeroes of cos(x) were not checked
4
```
These messages are generally useful in interactive use. For doctests, the current branch adjusts most of the tests so that they do not depend on the presence of these messages.

Due to the problem at #31655, the first doctest in a file that uses libgiac results in some additional messages, but again the tests are written so that this does not matter. If that ticket is resolved, the second commit could be mostly reverted, but this is not strictly necessary. With the default integrator, these Giac loading messages will appear on the first integral that Maxima cannot solve.

Part of meta-ticket #16688.

Issue created by migration from https://trac.sagemath.org/ticket/31873





---

archive/issue_comments_451265.json:
```json
{
    "body": "Changing keywords from \"\" to \"giac\".",
    "created_at": "2021-05-28T20:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451265",
    "user": "https://github.com/mwageringel"
}
```

Changing keywords from "" to "giac".



---

archive/issue_comments_451266.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451266",
    "user": "https://github.com/mwageringel"
}
```

New commits:



---

archive/issue_comments_451267.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451267",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_451268.json:
```json
{
    "body": "Changing keywords from \"giac\" to \"giac, integration\".",
    "created_at": "2021-06-17T18:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451268",
    "user": "https://github.com/mwageringel"
}
```

Changing keywords from "giac" to "giac, integration".



---

archive/issue_comments_451269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-18T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T21:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451271.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-17T21:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451271",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_451272.json:
```json
{
    "body": "LGTM",
    "created_at": "2021-07-17T21:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451272",
    "user": "https://github.com/mkoeppe"
}
```

LGTM



---

archive/issue_comments_451273.json:
```json
{
    "body": "Thanks.",
    "created_at": "2021-07-18T13:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451273",
    "user": "https://github.com/mwageringel"
}
```

Thanks.



---

archive/issue_comments_451274.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-23T23:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451274",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_451275.json:
```json
{
    "body": "test failures\n\n```\nsage -t --long --warn-long 45.1 --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed\nsage -t --long --warn-long 45.1 --random-seed=0 src/doc/en/prep/Calculus.rst  # 1 doctest failed\n```",
    "created_at": "2021-07-23T23:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451275",
    "user": "https://github.com/vbraun"
}
```

test failures

```
sage -t --long --warn-long 45.1 --random-seed=0 src/sage/symbolic/integration/integral.py  # 2 doctests failed
sage -t --long --warn-long 45.1 --random-seed=0 src/doc/en/prep/Calculus.rst  # 1 doctest failed
```



---

archive/issue_comments_451276.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-26T20:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451277.json:
```json
{
    "body": "I have fixed the doctests. Now this passes ptestlong again. Also, this does not conflict with #32275.",
    "created_at": "2021-07-26T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451277",
    "user": "https://github.com/mwageringel"
}
```

I have fixed the doctests. Now this passes ptestlong again. Also, this does not conflict with #32275.



---

archive/issue_comments_451278.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-26T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451278",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_451279.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-01T23:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451279",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_084188.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31636#event-84188"
}
```



---

archive/issue_events_084189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-29T09:36:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31636#event-84189"
}
```



---

archive/issue_comments_451280.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31636#issuecomment-451280",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
