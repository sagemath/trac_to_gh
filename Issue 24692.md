# Issue 24692: Fix q_binomial

archive/issues_024692.json:
```json
{
    "body": "CC:  @videlec @tscrim\n\nWe fix three bugs with `q_binomial`:\n\n1.\n\n```\nsage: R.<q> = QQ[]\nsage: q_binomial(2, 1 ,q-1, algorithm=\"naive\")\nq\nsage: q_binomial(2, 1 ,q-1, algorithm=\"cyclotomic\")\nq + 1\n```\n\n2.\n\n```\nsage: q_binomial(4, 3, 1, algorithm=\"naive\")\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-0d4b1b1e4d70> in <module>()\n----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm=\"naive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)\n    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm\n    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value\n--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')\n    330         else:\n    331             num = prod(one - q**i for i in range(n-k+1, n+1))\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()\n    194     return L\n    195 \n--> 196 def cyclotomic_value(n, x):\n    197     \"\"\"\n    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.\n\nTypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)\n```\n\n3.\n\n```\nsage: parent(q_binomial(3,2))\nUnivariate Polynomial Ring in q over Integer Ring\nsage: parent(q_binomial(3,3))\nInteger Ring\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/24929\n\n",
    "closed_at": "2018-03-19T21:59:29Z",
    "created_at": "2018-03-08T12:39:47Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix q_binomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24692",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @videlec @tscrim

We fix three bugs with `q_binomial`:

1.

```
sage: R.<q> = QQ[]
sage: q_binomial(2, 1 ,q-1, algorithm="naive")
q
sage: q_binomial(2, 1 ,q-1, algorithm="cyclotomic")
q + 1
```

2.

```
sage: q_binomial(4, 3, 1, algorithm="naive")
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-0d4b1b1e4d70> in <module>()
----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm="naive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)
    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm
    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value
--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')
    330         else:
    331             num = prod(one - q**i for i in range(n-k+1, n+1))

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()
    194     return L
    195 
--> 196 def cyclotomic_value(n, x):
    197     """
    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.

TypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)
```

3.

```
sage: parent(q_binomial(3,2))
Univariate Polynomial Ring in q over Integer Ring
sage: parent(q_binomial(3,3))
Integer Ring
```

Issue created by migration from https://trac.sagemath.org/ticket/24929





---

archive/issue_comments_346204.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2018-03-08T12:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346204",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_346205.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-08T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346205",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_346206.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-08T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346206",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346207.json:
```json
{
    "body": "`R.zero()` and `R.one()` should always work for rings.",
    "created_at": "2018-03-08T13:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346207",
    "user": "https://github.com/videlec"
}
```

`R.zero()` and `R.one()` should always work for rings.



---

archive/issue_comments_346208.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> `R.zero()` and `R.one()` should always work for rings.\n\n\nAnd `R(0)` and `R(1)` should always work without conditions.",
    "created_at": "2018-03-08T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346208",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 vdelecroix]:
> `R.zero()` and `R.one()` should always work for rings.


And `R(0)` and `R(1)` should always work without conditions.



---

archive/issue_comments_346209.json:
```json
{
    "body": "You are breaking the pep8 formatting of the header. Please do not do that.",
    "created_at": "2018-03-08T16:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346209",
    "user": "https://github.com/fchapoton"
}
```

You are breaking the pep8 formatting of the header. Please do not do that.



---

archive/issue_comments_346210.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-08T16:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346211.json:
```json
{
    "body": "I am guessing you want `R(0)` and `R(1)` in case `R` is something like `int` so we don't have to special case it. Could you add a comment saying this as otherwise someone (who could very well be me) might go to `R.zero()`/`R.one()` as it is faster (avoids going through the coercion framework) and cached.",
    "created_at": "2018-03-08T23:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346211",
    "user": "https://github.com/tscrim"
}
```

I am guessing you want `R(0)` and `R(1)` in case `R` is something like `int` so we don't have to special case it. Could you add a comment saying this as otherwise someone (who could very well be me) might go to `R.zero()`/`R.one()` as it is faster (avoids going through the coercion framework) and cached.



---

archive/issue_comments_346212.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T09:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346213.json:
```json
{
    "body": "LGTM. Any other comments or objections to setting a positive review?",
    "created_at": "2018-03-09T14:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346213",
    "user": "https://github.com/tscrim"
}
```

LGTM. Any other comments or objections to setting a positive review?



---

archive/issue_comments_346214.json:
```json
{
    "body": "Would be good to check more output types. For example in\n\n```\nsage: q_binomial(3r, 2r, 1r)\n3\n```",
    "created_at": "2018-03-09T20:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346214",
    "user": "https://github.com/videlec"
}
```

Would be good to check more output types. For example in

```
sage: q_binomial(3r, 2r, 1r)
3
```



---

archive/issue_comments_346215.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T20:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_346216.json:
```json
{
    "body": "LGTM as well.",
    "created_at": "2018-03-09T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346216",
    "user": "https://github.com/videlec"
}
```

LGTM as well.



---

archive/issue_comments_346217.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-09T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346217",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_062572.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-19T21:59:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24692#event-62572"
}
```



---

archive/issue_comments_346218.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-19T21:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24692",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24692#issuecomment-346218",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
