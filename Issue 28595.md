# Issue 28595: suitesparse spkg does not properly use a DESTDIR installation

archive/issues_028595.json:
```json
{
    "body": "CC:  dimpase\n\nKeywords: suitesparse cvxopt\n\nThis SPKG was introduced in #22380 as a standard package.\n\nHowever, it does not properly use the the facilities for DESTDIR installation, and thus a file manifest is not produced for it:\n\n\n```\n$ cat local/var/lib/sage/installed/suitesparse-5.6.0\n{\n    \"package_name\": \"suitesparse\",\n    \"package_version\": \"5.6.0\",\n    \"install_date\": \"Mon Dec  2 11:44:16 UTC 2019\",\n    \"system_uname\": \"Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\",\n    \"sage_version\": \"SageMath version 9.0.beta8, Release Date: 2019-12-01\",\n    \"test_result\": \"\",\n    \"files\": [\n\n    ]\n}\n```\n\n\nsuitesparse apparently has a custom build system (parts of it contain sub-libraries built with CMake (GraphBLAS, Mongoose) and hence should support `DESTDIR` but according to the `SPKG.txt` we don't install those components anyways.\n\nWe should have better documentation, for adding new SPKGs, about ensuring that DESTDIR install works.  I opened #28831 for that.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28832\n\n",
    "created_at": "2019-12-02T14:17:37Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "suitesparse spkg does not properly use a DESTDIR installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28595",
    "user": "embray"
}
```
CC:  dimpase

Keywords: suitesparse cvxopt

This SPKG was introduced in #22380 as a standard package.

However, it does not properly use the the facilities for DESTDIR installation, and thus a file manifest is not produced for it:


```
$ cat local/var/lib/sage/installed/suitesparse-5.6.0
{
    "package_name": "suitesparse",
    "package_version": "5.6.0",
    "install_date": "Mon Dec  2 11:44:16 UTC 2019",
    "system_uname": "Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux",
    "sage_version": "SageMath version 9.0.beta8, Release Date: 2019-12-01",
    "test_result": "",
    "files": [

    ]
}
```


suitesparse apparently has a custom build system (parts of it contain sub-libraries built with CMake (GraphBLAS, Mongoose) and hence should support `DESTDIR` but according to the `SPKG.txt` we don't install those components anyways.

We should have better documentation, for adding new SPKGs, about ensuring that DESTDIR install works.  I opened #28831 for that.

Issue created by migration from https://trac.sagemath.org/ticket/28832





---

archive/issue_comments_403584.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403584",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403585.json:
```json
{
    "body": "This fixes it: \n\n\n```\n{\n    \"package_name\": \"suitesparse\",\n    \"package_version\": \"5.6.0\",\n    \"install_date\": \"Mon Dec  2 14:40:14 UTC 2019\",\n    \"system_uname\": \"Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\"\n,\n    \"sage_version\": \"SageMath version 9.0.beta8, Release Date: 2019-12-01\",\n    \"test_result\": \"\",\n    \"files\": [\n        \"include/RBio.h\",\n        \"include/SuiteSparseQR.hpp\",\n        \"include/SuiteSparseQR_C.h\",\n        \"include/SuiteSparseQR_definitions.h\",\n        \"include/SuiteSparse_config.h\",\n        \"include/amd.h\",\n        \"include/btf.h\",\n        \"include/camd.h\",\n        \"include/ccolamd.h\",\n        \"include/cholmod.h\",\n        \"include/cholmod_blas.h\",\n        \"include/cholmod_camd.h\",\n        \"include/cholmod_check.h\",\n        \"include/cholmod_cholesky.h\",\n        \"include/cholmod_complexity.h\",\n        \"include/cholmod_config.h\",\n        \"include/cholmod_core.h\",\n        \"include/cholmod_function.h\",\n        \"include/cholmod_gpu.h\",\n        \"include/cholmod_gpu_kernels.h\",\n        \"include/cholmod_io64.h\",\n        \"include/cholmod_matrixops.h\",\n        \"include/cholmod_modify.h\",\n        \"include/cholmod_partition.h\",\n        \"include/cholmod_supernodal.h\",\n        \"include/cholmod_template.h\",\n        \"include/colamd.h\",\n        \"include/cs.h\",\n        \"include/klu.h\",\n        \"include/ldl.h\",\n        \"include/spqr.hpp\",\n        \"include/umfpack.h\",\n        \"include/umfpack_col_to_triplet.h\",\n        \"include/umfpack_defaults.h\",\n        \"include/umfpack_free_numeric.h\",\n        \"include/umfpack_free_symbolic.h\",\n        \"include/umfpack_get_determinant.h\",\n        \"include/umfpack_get_lunz.h\",\n        \"include/umfpack_get_numeric.h\",\n        \"include/umfpack_get_symbolic.h\",\n        \"include/umfpack_global.h\",\n        \"include/umfpack_load_numeric.h\",\n        \"include/umfpack_load_symbolic.h\",\n        \"include/umfpack_numeric.h\",\n        \"include/umfpack_qsymbolic.h\",\n        \"include/umfpack_report_control.h\",\n        \"include/umfpack_report_info.h\",\n        \"include/umfpack_report_matrix.h\",\n        \"include/umfpack_report_numeric.h\",\n        \"include/umfpack_report_perm.h\",\n        \"include/umfpack_report_status.h\",\n        \"include/umfpack_report_symbolic.h\",\n        \"include/umfpack_report_triplet.h\",\n        \"include/umfpack_report_vector.h\",\n        \"include/umfpack_save_numeric.h\",\n        \"include/umfpack_save_symbolic.h\",\n        \"include/umfpack_scale.h\",\n        \"include/umfpack_solve.h\",\n        \"include/umfpack_symbolic.h\",\n        \"include/umfpack_tictoc.h\",\n        \"include/umfpack_timer.h\",\n        \"include/umfpack_transpose.h\",\n        \"include/umfpack_triplet_to_col.h\",\n        \"include/umfpack_wsolve.h\",\n        \"lib/libamd.so\",\n        \"lib/libamd.so.2\",\n        \"lib/libamd.so.2.4.6\",\n        \"lib/libbtf.so\",\n        \"lib/libbtf.so.1\",\n        \"lib/libbtf.so.1.2.6\",\n        \"lib/libcamd.so\",\n        \"lib/libcamd.so.2\",\n        \"lib/libcamd.so.2.4.6\",\n        \"lib/libccolamd.so\",\n        \"lib/libccolamd.so.2\",\n        \"lib/libccolamd.so.2.9.6\",\n        \"lib/libcholmod.so\",\n        \"lib/libcholmod.so.3\",\n        \"lib/libcholmod.so.3.0.13\",\n        \"lib/libcolamd.so\",\n        \"lib/libcolamd.so.2\",\n        \"lib/libcolamd.so.2.9.6\",\n        \"lib/libcxsparse.so\",\n        \"lib/libcxsparse.so.3\",\n        \"lib/libcxsparse.so.3.2.0\",\n        \"lib/libklu.so\",\n        \"lib/libklu.so.1\",                                                                                                   \n        \"lib/libklu.so.1.3.8\",\n        \"lib/libldl.so\",\n        \"lib/libldl.so.2\",\n        \"lib/libldl.so.2.2.6\",\n        \"lib/librbio.so\",\n        \"lib/librbio.so.2\",\n        \"lib/librbio.so.2.2.6\",\n        \"lib/libspqr.so\",\n        \"lib/libspqr.so.2\",\n        \"lib/libspqr.so.2.0.9\",\n        \"lib/libsuitesparseconfig.so\",\n        \"lib/libsuitesparseconfig.so.5\",\n        \"lib/libsuitesparseconfig.so.5.5.0\",\n        \"lib/libumfpack.so\",\n        \"lib/libumfpack.so.5\",\n        \"lib/libumfpack.so.5.7.9\",\n        \"share/doc/suitesparse-5.6.0/AMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/AMD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/BTF_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CAMD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/CCOLAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CHOLMOD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CHOLMOD_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/COLAMD_README.txt\",\n        \"share/doc/suitesparse-5.6.0/CXSPARSE_README.txt\",\n        \"share/doc/suitesparse-5.6.0/KLU_README.txt\",\n        \"share/doc/suitesparse-5.6.0/KLU_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/LDL_README.txt\",\n        \"share/doc/suitesparse-5.6.0/RBIO_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SPQR_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SUITESPARSECONFIG_README.txt\",\n        \"share/doc/suitesparse-5.6.0/SuiteSparse_README.txt\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_QuickStart.pdf\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_README.txt\",\n        \"share/doc/suitesparse-5.6.0/UMFPACK_UserGuide.pdf\",\n        \"share/doc/suitesparse-5.6.0/ldl_userguide.pdf\",\n        \"share/doc/suitesparse-5.6.0/spqr_user_guide.pdf\"\n    ]\n}\n```\n\n\nI also confirmed that none of the installed files contain the DESTDIR temporary path, which is generally required for a proper staged install.\n\n----\nNew commits:",
    "created_at": "2019-12-02T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403585",
    "user": "embray"
}
```

This fixes it: 


```
{
    "package_name": "suitesparse",
    "package_version": "5.6.0",
    "install_date": "Mon Dec  2 14:40:14 UTC 2019",
    "system_uname": "Linux sage-docker 3.13.0-170-generic #220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux"
,
    "sage_version": "SageMath version 9.0.beta8, Release Date: 2019-12-01",
    "test_result": "",
    "files": [
        "include/RBio.h",
        "include/SuiteSparseQR.hpp",
        "include/SuiteSparseQR_C.h",
        "include/SuiteSparseQR_definitions.h",
        "include/SuiteSparse_config.h",
        "include/amd.h",
        "include/btf.h",
        "include/camd.h",
        "include/ccolamd.h",
        "include/cholmod.h",
        "include/cholmod_blas.h",
        "include/cholmod_camd.h",
        "include/cholmod_check.h",
        "include/cholmod_cholesky.h",
        "include/cholmod_complexity.h",
        "include/cholmod_config.h",
        "include/cholmod_core.h",
        "include/cholmod_function.h",
        "include/cholmod_gpu.h",
        "include/cholmod_gpu_kernels.h",
        "include/cholmod_io64.h",
        "include/cholmod_matrixops.h",
        "include/cholmod_modify.h",
        "include/cholmod_partition.h",
        "include/cholmod_supernodal.h",
        "include/cholmod_template.h",
        "include/colamd.h",
        "include/cs.h",
        "include/klu.h",
        "include/ldl.h",
        "include/spqr.hpp",
        "include/umfpack.h",
        "include/umfpack_col_to_triplet.h",
        "include/umfpack_defaults.h",
        "include/umfpack_free_numeric.h",
        "include/umfpack_free_symbolic.h",
        "include/umfpack_get_determinant.h",
        "include/umfpack_get_lunz.h",
        "include/umfpack_get_numeric.h",
        "include/umfpack_get_symbolic.h",
        "include/umfpack_global.h",
        "include/umfpack_load_numeric.h",
        "include/umfpack_load_symbolic.h",
        "include/umfpack_numeric.h",
        "include/umfpack_qsymbolic.h",
        "include/umfpack_report_control.h",
        "include/umfpack_report_info.h",
        "include/umfpack_report_matrix.h",
        "include/umfpack_report_numeric.h",
        "include/umfpack_report_perm.h",
        "include/umfpack_report_status.h",
        "include/umfpack_report_symbolic.h",
        "include/umfpack_report_triplet.h",
        "include/umfpack_report_vector.h",
        "include/umfpack_save_numeric.h",
        "include/umfpack_save_symbolic.h",
        "include/umfpack_scale.h",
        "include/umfpack_solve.h",
        "include/umfpack_symbolic.h",
        "include/umfpack_tictoc.h",
        "include/umfpack_timer.h",
        "include/umfpack_transpose.h",
        "include/umfpack_triplet_to_col.h",
        "include/umfpack_wsolve.h",
        "lib/libamd.so",
        "lib/libamd.so.2",
        "lib/libamd.so.2.4.6",
        "lib/libbtf.so",
        "lib/libbtf.so.1",
        "lib/libbtf.so.1.2.6",
        "lib/libcamd.so",
        "lib/libcamd.so.2",
        "lib/libcamd.so.2.4.6",
        "lib/libccolamd.so",
        "lib/libccolamd.so.2",
        "lib/libccolamd.so.2.9.6",
        "lib/libcholmod.so",
        "lib/libcholmod.so.3",
        "lib/libcholmod.so.3.0.13",
        "lib/libcolamd.so",
        "lib/libcolamd.so.2",
        "lib/libcolamd.so.2.9.6",
        "lib/libcxsparse.so",
        "lib/libcxsparse.so.3",
        "lib/libcxsparse.so.3.2.0",
        "lib/libklu.so",
        "lib/libklu.so.1",                                                                                                   
        "lib/libklu.so.1.3.8",
        "lib/libldl.so",
        "lib/libldl.so.2",
        "lib/libldl.so.2.2.6",
        "lib/librbio.so",
        "lib/librbio.so.2",
        "lib/librbio.so.2.2.6",
        "lib/libspqr.so",
        "lib/libspqr.so.2",
        "lib/libspqr.so.2.0.9",
        "lib/libsuitesparseconfig.so",
        "lib/libsuitesparseconfig.so.5",
        "lib/libsuitesparseconfig.so.5.5.0",
        "lib/libumfpack.so",
        "lib/libumfpack.so.5",
        "lib/libumfpack.so.5.7.9",
        "share/doc/suitesparse-5.6.0/AMD_README.txt",
        "share/doc/suitesparse-5.6.0/AMD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/BTF_README.txt",
        "share/doc/suitesparse-5.6.0/CAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CAMD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/CCOLAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CHOLMOD_README.txt",
        "share/doc/suitesparse-5.6.0/CHOLMOD_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/COLAMD_README.txt",
        "share/doc/suitesparse-5.6.0/CXSPARSE_README.txt",
        "share/doc/suitesparse-5.6.0/KLU_README.txt",
        "share/doc/suitesparse-5.6.0/KLU_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/LDL_README.txt",
        "share/doc/suitesparse-5.6.0/RBIO_README.txt",
        "share/doc/suitesparse-5.6.0/SPQR_README.txt",
        "share/doc/suitesparse-5.6.0/SUITESPARSECONFIG_README.txt",
        "share/doc/suitesparse-5.6.0/SuiteSparse_README.txt",
        "share/doc/suitesparse-5.6.0/UMFPACK_QuickStart.pdf",
        "share/doc/suitesparse-5.6.0/UMFPACK_README.txt",
        "share/doc/suitesparse-5.6.0/UMFPACK_UserGuide.pdf",
        "share/doc/suitesparse-5.6.0/ldl_userguide.pdf",
        "share/doc/suitesparse-5.6.0/spqr_user_guide.pdf"
    ]
}
```


I also confirmed that none of the installed files contain the DESTDIR temporary path, which is generally required for a proper staged install.

----
New commits:



---

archive/issue_comments_403586.json:
```json
{
    "body": "Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.",
    "created_at": "2019-12-02T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403586",
    "user": "fbissey"
}
```

Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.



---

archive/issue_comments_403587.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-02T21:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403587",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403588.json:
```json
{
    "body": "Replying to [comment:2 fbissey]:\n> Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.\n\nYeah don't worry, not your fault.  I need to do more work to make this clearer.  It's not even currently *that* important for \"standard\" packages, but is still useful for proper uninstallation/cleanup when updating package versions.",
    "created_at": "2019-12-03T10:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403588",
    "user": "embray"
}
```

Replying to [comment:2 fbissey]:
> Fair enough, I didn't know it was this important. Otherwise, I would have made the effort. Looks good to me.

Yeah don't worry, not your fault.  I need to do more work to make this clearer.  It's not even currently *that* important for "standard" packages, but is still useful for proper uninstallation/cleanup when updating package versions.



---

archive/issue_comments_403589.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-12-05T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403589",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_403590.json:
```json
{
    "body": "I'm getting \n\n```\nranlib libamd.a\ngcc -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib  -shared -Wl,-soname -Wl,libamd.so.2 -Wl,--no-undefined amd_i_aat.o amd_i_1.o amd_i_2.o amd_i_dump.o amd_i_postorder.o amd_i_defaults.o amd_i_post_tree.o amd_i_order.o amd_i_control.o amd_i_info.o amd_i_valid.o amd_i_preprocess.o amd_l_aat.o amd_l_1.o amd_l_2.o amd_l_dump.o amd_l_postorder.o amd_l_defaults.o amd_l_post_tree.o amd_l_order.o amd_l_control.o amd_l_info.o amd_l_valid.o amd_l_preprocess.o -o /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6 -lm -lrt -lsuitesparseconfig\n/usr/bin/ld: cannot find -lsuitesparseconfig\ncollect2: error: ld returned 1 exit status\nmake[6]: *** [Makefile:90: /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6] Error 1\nmake[6]: Leaving directory '/home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/src/AMD/Lib'\n```\n\non my Ryzen 3800X. Note:\n\n```\n[release@zen Sage]$ find local | grep suitesparseconfig\nlocal/var/tmp/sage/build/suitesparse-5.6.0/src/SuiteSparse_config/libsuitesparseconfig.a\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5.5.0\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so\nlocal/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5\n```\n",
    "created_at": "2019-12-05T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403590",
    "user": "vbraun"
}
```

I'm getting 

```
ranlib libamd.a
gcc -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib  -shared -Wl,-soname -Wl,libamd.so.2 -Wl,--no-undefined amd_i_aat.o amd_i_1.o amd_i_2.o amd_i_dump.o amd_i_postorder.o amd_i_defaults.o amd_i_post_tree.o amd_i_order.o amd_i_control.o amd_i_info.o amd_i_valid.o amd_i_preprocess.o amd_l_aat.o amd_l_1.o amd_l_2.o amd_l_dump.o amd_l_postorder.o amd_l_defaults.o amd_l_post_tree.o amd_l_order.o amd_l_control.o amd_l_info.o amd_l_valid.o amd_l_preprocess.o -o /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6 -lm -lrt -lsuitesparseconfig
/usr/bin/ld: cannot find -lsuitesparseconfig
collect2: error: ld returned 1 exit status
make[6]: *** [Makefile:90: /home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libamd.so.2.4.6] Error 1
make[6]: Leaving directory '/home/release/Sage/local/var/tmp/sage/build/suitesparse-5.6.0/src/AMD/Lib'
```

on my Ryzen 3800X. Note:

```
[release@zen Sage]$ find local | grep suitesparseconfig
local/var/tmp/sage/build/suitesparse-5.6.0/src/SuiteSparse_config/libsuitesparseconfig.a
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5.5.0
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so
local/var/tmp/sage/build/suitesparse-5.6.0/inst/home/release/Sage/local/lib/libsuitesparseconfig.so.5
```




---

archive/issue_comments_403591.json:
```json
{
    "body": "Hum, it should have worked. There must be something no behaving in AMD's makefile. Investigating.",
    "created_at": "2019-12-05T21:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403591",
    "user": "fbissey"
}
```

Hum, it should have worked. There must be something no behaving in AMD's makefile. Investigating.



---

archive/issue_comments_403592.json:
```json
{
    "body": "I think I know what's happening. The new patch removes\n\n```\n+-    LDFLAGS += -L$(INSTALL_LIB)\n```\n\nAnd later we have \n\n```\nSO_OPTS = $(LDFLAGS)\n```\n\nSo we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.",
    "created_at": "2019-12-05T21:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403592",
    "user": "fbissey"
}
```

I think I know what's happening. The new patch removes

```
+-    LDFLAGS += -L$(INSTALL_LIB)
```

And later we have 

```
SO_OPTS = $(LDFLAGS)
```

So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.



---

archive/issue_comments_403593.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403593",
    "user": "fbissey"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_403594.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-12-05T23:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403594",
    "user": "fbissey"
}
```

New commits:



---

archive/issue_comments_403595.json:
```json
{
    "body": "I'm getting doctesting errors on OS X 10.14.6, for example:\n\n```\nsage -t --long src/sage/numerical/optimize.py\n**********************************************************************\nFile \"src/sage/numerical/optimize.py\", line 597, in sage.numerical.optimize.linear_program\nFailed example:\n    sol=linear_program(c,G,h)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.numerical.optimize.linear_program[3]>\", line 1, in <module>\n        sol=linear_program(c,G,h)\n      File \"sage/misc/lazy_import.pyx\", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3686)\n        return self.get_object()(*args, **kwds)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/numerical/optimize.py\", line 639, in linear_program\n        sol=solvers.lp(c_,G_,h_,solver=solver)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/coneprog.py\", line 2783, in lp\n        from cvxopt import base, blas, misc\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/misc.py\", line 21, in <module>\n        from cvxopt import base, blas, lapack, cholmod, misc_solvers\n    ImportError: dlopen(/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so, 2): Library not loaded: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib\n      Referenced from: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so\n      Reason: image not found\n```\n",
    "created_at": "2019-12-06T00:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403595",
    "user": "jhpalmieri"
}
```

I'm getting doctesting errors on OS X 10.14.6, for example:

```
sage -t --long src/sage/numerical/optimize.py
**********************************************************************
File "src/sage/numerical/optimize.py", line 597, in sage.numerical.optimize.linear_program
Failed example:
    sol=linear_program(c,G,h)
Exception raised:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.optimize.linear_program[3]>", line 1, in <module>
        sol=linear_program(c,G,h)
      File "sage/misc/lazy_import.pyx", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3686)
        return self.get_object()(*args, **kwds)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/sage/numerical/optimize.py", line 639, in linear_program
        sol=solvers.lp(c_,G_,h_,solver=solver)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/coneprog.py", line 2783, in lp
        from cvxopt import base, blas, misc
      File "/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/misc.py", line 21, in <module>
        from cvxopt import base, blas, lapack, cholmod, misc_solvers
    ImportError: dlopen(/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so, 2): Library not loaded: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib
      Referenced from: /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.beta8/local/lib/python3.7/site-packages/cvxopt/cholmod.cpython-37m-darwin.so
      Reason: image not found
```




---

archive/issue_comments_403596.json:
```json
{
    "body": "Is it just with this ticket, or since we introduced suitesparse? Also does cvxopt work and pass its testsuite on the same machine?",
    "created_at": "2019-12-06T00:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403596",
    "user": "fbissey"
}
```

Is it just with this ticket, or since we introduced suitesparse? Also does cvxopt work and pass its testsuite on the same machine?



---

archive/issue_comments_403597.json:
```json
{
    "body": "Lack of `install_name` on OS X could be an issue but should also be present without this ticket.",
    "created_at": "2019-12-06T00:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403597",
    "user": "fbissey"
}
```

Lack of `install_name` on OS X could be an issue but should also be present without this ticket.



---

archive/issue_comments_403598.json:
```json
{
    "body": "Actually, now I am thinking that `install_name` could be automatically set to the location provided by the `-o` argument in linking. Which, with this ticket will be prefixed by `DESTDIR` and that would be an issue. And now that I tried to ask you some output of `otool -L` I realise that the prefix is present in what the loader asks. So this is the problem. I will fix it ASAP.",
    "created_at": "2019-12-06T00:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403598",
    "user": "fbissey"
}
```

Actually, now I am thinking that `install_name` could be automatically set to the location provided by the `-o` argument in linking. Which, with this ticket will be prefixed by `DESTDIR` and that would be an issue. And now that I tried to ask you some output of `otool -L` I realise that the prefix is present in what the loader asks. So this is the problem. I will fix it ASAP.



---

archive/issue_comments_403599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-06T01:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403599",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403600.json:
```json
{
    "body": "Try it now.",
    "created_at": "2019-12-06T01:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403600",
    "user": "fbissey"
}
```

Try it now.



---

archive/issue_comments_403601.json:
```json
{
    "body": "I'm using a different machine (OS X 10.15.1) but same result. `cvxopt` fails its test suite, too: same problem. With plain Sage 9.0.beta8, all tests pass and `cvxopt` passes its test suite.",
    "created_at": "2019-12-06T04:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403601",
    "user": "jhpalmieri"
}
```

I'm using a different machine (OS X 10.15.1) but same result. `cvxopt` fails its test suite, too: same problem. With plain Sage 9.0.beta8, all tests pass and `cvxopt` passes its test suite.



---

archive/issue_comments_403602.json:
```json
{
    "body": "Even with my updated branch? What does `otool -L local/lib/libcholmod.3.0.13.dylib` report?",
    "created_at": "2019-12-06T04:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403602",
    "user": "fbissey"
}
```

Even with my updated branch? What does `otool -L local/lib/libcholmod.3.0.13.dylib` report?



---

archive/issue_comments_403603.json:
```json
{
    "body": "Yes, this with the updated branch; the latest entry in `git log` is \n\n```\ncommit 8d795908b343506192a5f9cdcaab76a2a7624180 (HEAD -> t/28832/ticket-28832, trac/u/fbissey/ticket-28832)\nAuthor: Fran\u00e7ois Bissey <frp.bissey@gmail.com>\nDate:   Fri Dec 6 14:10:15 2019 +1300\n\n    fix install_name on OS X\n```\n\nI unpacked a tar file, ran `git trac config`, `git trac checkout 28832`, and then `make ptestlong`.\n\nThe paths are broken \u2014\u00a0they point to the temporary build directory:\n\n```\n% otool -L local/lib/libcholmod.3.0.13.dylib\nlocal/lib/libcholmod.3.0.13.dylib:\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.dylib (compatibility version 3.0.0, current version 3.0.13)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.dylib (compatibility version 5.0.0, current version 5.5.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libccolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)\n```\n\nIn comparison, with plain 9.0.beta8:\n\n```\n% otool -L local/lib/libcholmod.3.0.13.dylib\nlocal/lib/libcholmod.3.0.13.dylib:\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib (compatibility version 3.0.0, current version 3.0.13)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.5.0.dylib (compatibility version 5.0.0, current version 5.5.0)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libccolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)\n\t/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)\n```\n",
    "created_at": "2019-12-06T05:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403603",
    "user": "jhpalmieri"
}
```

Yes, this with the updated branch; the latest entry in `git log` is 

```
commit 8d795908b343506192a5f9cdcaab76a2a7624180 (HEAD -> t/28832/ticket-28832, trac/u/fbissey/ticket-28832)
Author: François Bissey <frp.bissey@gmail.com>
Date:   Fri Dec 6 14:10:15 2019 +1300

    fix install_name on OS X
```

I unpacked a tar file, ran `git trac config`, `git trac checkout 28832`, and then `make ptestlong`.

The paths are broken — they point to the temporary build directory:

```
% otool -L local/lib/libcholmod.3.0.13.dylib
local/lib/libcholmod.3.0.13.dylib:
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcholmod.3.dylib (compatibility version 3.0.0, current version 3.0.13)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.dylib (compatibility version 5.0.0, current version 5.5.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libccolamd.2.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/var/tmp/sage/build/suitesparse-5.6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libcamd.2.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)
```

In comparison, with plain 9.0.beta8:

```
% otool -L local/lib/libcholmod.3.0.13.dylib
local/lib/libcholmod.3.0.13.dylib:
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcholmod.3.0.13.dylib (compatibility version 3.0.0, current version 3.0.13)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1281.0.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libsuitesparseconfig.5.5.0.dylib (compatibility version 5.0.0, current version 5.5.0)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libccolamd.2.9.6.dylib (compatibility version 2.0.0, current version 2.9.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libcamd.2.4.6.dylib (compatibility version 2.0.0, current version 2.4.6)
	/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-9.0.beta8/local/lib/libopenblas_haswellp-r0.3.6.dylib (compatibility version 0.0.0, current version 0.0.0)
```




---

archive/issue_comments_403604.json:
```json
{
    "body": "I am officially stupid. Correcting...",
    "created_at": "2019-12-06T06:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403604",
    "user": "fbissey"
}
```

I am officially stupid. Correcting...



---

archive/issue_comments_403605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-06T06:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403606.json:
```json
{
    "body": "Should be better now.",
    "created_at": "2019-12-06T06:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403606",
    "user": "fbissey"
}
```

Should be better now.



---

archive/issue_comments_403607.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> I think I know what's happening. The new patch removes\n> {{{\n> +-    LDFLAGS += -L$(INSTALL_LIB)\n> }}}\n> And later we have \n> {{{\n> SO_OPTS = $(LDFLAGS)\n> }}}\n> So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.\n\nYou're right, of course.  I made the same update to the patch in #28829, but I really should have fixed the version here.  I'll have to rebase #28829 on this one if you think it's ready.",
    "created_at": "2019-12-06T13:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403607",
    "user": "embray"
}
```

Replying to [comment:6 fbissey]:
> I think I know what's happening. The new patch removes
> {{{
> +-    LDFLAGS += -L$(INSTALL_LIB)
> }}}
> And later we have 
> {{{
> SO_OPTS = $(LDFLAGS)
> }}}
> So we only get sage's `LDFLAGS` which doesn't include the path to the temporary installation. I think that part of the patch should be removed.

You're right, of course.  I made the same update to the patch in #28829, but I really should have fixed the version here.  I'll have to rebase #28829 on this one if you think it's ready.



---

archive/issue_comments_403608.json:
```json
{
    "body": "Thank you for adding the OSX stuff--I should've caught that.  Positive review from me pending review from John.",
    "created_at": "2019-12-06T13:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403608",
    "user": "embray"
}
```

Thank you for adding the OSX stuff--I should've caught that.  Positive review from me pending review from John.



---

archive/issue_comments_403609.json:
```json
{
    "body": "This version works for me.",
    "created_at": "2019-12-06T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403609",
    "user": "jhpalmieri"
}
```

This version works for me.



---

archive/issue_comments_403610.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-06T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403610",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-09T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28595#issuecomment-403611",
    "user": "vbraun"
}
```

Resolution: fixed
