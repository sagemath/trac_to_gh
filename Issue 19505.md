# Issue 19505: CyclotomicField.zeta() inconsistent with zeta_order() and docs

archive/issues_019505.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/19742\n\n",
    "created_at": "2015-12-18T13:03:58Z",
    "labels": [
        "number fields",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "CyclotomicField.zeta() inconsistent with zeta_order() and docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19505",
    "user": "@jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/19742





---

archive/issue_comments_268031.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-18T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268031",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268032.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-18T15:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268032",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_268033.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-20T20:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268033",
    "user": "@saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268034.json:
```json
{
    "body": "I don't think this is quite ready.\n\nIt would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.  But\n\n```\nsage: C = CyclotomicField(5)\nsage: C.primitive_root_of_unity(), C.zeta()\n(-zeta5, -zeta5^3)\n```\n\n\nThe new error message\n\n```\nsage: C.zeta(4)\n...\nValueError: 4 does not divide order of generator (10)\n```\n\nis somewhat misleading, since\n\n```\nsage: C.gen().multiplicative_order()\n5\n```\n\nThe error message for generic fields is better:\n\n```\nsage: K.<a> = NumberField(x^3 - 5)\nsage: K.zeta(3)\n...\nValueError: There are no 3rd roots of unity in self.\n```\n\nand negative arguments are handled differently:\n\n```\nsage: C.zeta(-2)\n-1\nsage: K.zeta(-2)\nTraceback (most recent call last)\n...\nValueError: n (=-2) must be positive\n```\n\nBut there is incompatibility with generic fields, for which n=2 is the default (surely a mistake):\n\n```\nsage: K = NumberField(x^2 - x + 1, 'a')\nsage: C = CyclotomicField(6)\nsage: K.zeta(), C.zeta()\n(-1, zeta6)\nsage: C.is_isomorphic(K)\nTrue\n```\n",
    "created_at": "2015-12-23T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268034",
    "user": "fwclarke"
}
```

I don't think this is quite ready.

It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.  But

```
sage: C = CyclotomicField(5)
sage: C.primitive_root_of_unity(), C.zeta()
(-zeta5, -zeta5^3)
```


The new error message

```
sage: C.zeta(4)
...
ValueError: 4 does not divide order of generator (10)
```

is somewhat misleading, since

```
sage: C.gen().multiplicative_order()
5
```

The error message for generic fields is better:

```
sage: K.<a> = NumberField(x^3 - 5)
sage: K.zeta(3)
...
ValueError: There are no 3rd roots of unity in self.
```

and negative arguments are handled differently:

```
sage: C.zeta(-2)
-1
sage: K.zeta(-2)
Traceback (most recent call last)
...
ValueError: n (=-2) must be positive
```

But there is incompatibility with generic fields, for which n=2 is the default (surely a mistake):

```
sage: K = NumberField(x^2 - x + 1, 'a')
sage: C = CyclotomicField(6)
sage: K.zeta(), C.zeta()
(-1, zeta6)
sage: C.is_isomorphic(K)
True
```




---

archive/issue_comments_268035.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-23T07:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268035",
    "user": "fwclarke"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_268036.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-12-23T08:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268036",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_268037.json:
```json
{
    "body": "The title of this ticket is not \"fix all possible issues with `zeta()`\". Open a new ticket if you want other things to be fixed.",
    "created_at": "2015-12-23T08:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268037",
    "user": "@jdemeyer"
}
```

The title of this ticket is not "fix all possible issues with `zeta()`". Open a new ticket if you want other things to be fixed.



---

archive/issue_comments_268038.json:
```json
{
    "body": "Replying to [comment:5 fwclarke]:\n> It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.\n\nMaybe reasonable, but there are good reasons why this is not the case:\n\n1. `C.zeta()` is a very fast, almost trivial operation because it's specialized for cyclotomic fields.\n\n2. `C.primitive_root_of_unity()` uses a computation in PARI. This must be so, in order to be consistent with other uses of the PARI unit group.\n\nSo neither making `zeta` an alias of `primitive_root_of_unity` nor making `primitive_root_of_unity` an alias of `zeta` looks like a good idea.",
    "created_at": "2015-12-23T08:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268038",
    "user": "@jdemeyer"
}
```

Replying to [comment:5 fwclarke]:
> It would be reasonable to expect that `C.primitive_root_of_unity()` and `C.zeta()` gave the same answer.

Maybe reasonable, but there are good reasons why this is not the case:

1. `C.zeta()` is a very fast, almost trivial operation because it's specialized for cyclotomic fields.

2. `C.primitive_root_of_unity()` uses a computation in PARI. This must be so, in order to be consistent with other uses of the PARI unit group.

So neither making `zeta` an alias of `primitive_root_of_unity` nor making `primitive_root_of_unity` an alias of `zeta` looks like a good idea.



---

archive/issue_comments_268039.json:
```json
{
    "body": "Replying to [comment:5 fwclarke]:\n> The new error message\n> {{{\n> sage: C.zeta(4)\n> ...\n> ValueError: 4 does not divide order of generator (10)\n> }}}\n> is somewhat misleading\n\nIt's not a *new* error message, only a rephrasing of the old message. But I see your point.",
    "created_at": "2015-12-23T08:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268039",
    "user": "@jdemeyer"
}
```

Replying to [comment:5 fwclarke]:
> The new error message
> {{{
> sage: C.zeta(4)
> ...
> ValueError: 4 does not divide order of generator (10)
> }}}
> is somewhat misleading

It's not a *new* error message, only a rephrasing of the old message. But I see your point.



---

archive/issue_comments_268040.json:
```json
{
    "body": "Feel free to open a new ticket to make the error messages consistent.",
    "created_at": "2015-12-23T08:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268040",
    "user": "@jdemeyer"
}
```

Feel free to open a new ticket to make the error messages consistent.



---

archive/issue_comments_268041.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-23T11:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19505#issuecomment-268041",
    "user": "@vbraun"
}
```

Resolution: fixed
