# Issue 29993: pdf doc build breakage in sage/coding/linear_rank_metric.py

Issue created by migration from https://trac.sagemath.org/ticket/30230

Original creator: fbissey

Original creation time: 2020-07-27 01:10:20

CC:  strogdon slelievre

As reported in the sage-on-gentoo github issue 593 [https://github.com/cschwan/sage-on-gentoo/issues/593](https://github.com/cschwan/sage-on-gentoo/issues/593) when building the pdf doc we have

```
! Package inputenc Error: Unicode character ^^H (U+0008)
(inputenc)                not set up for use with LaTeX.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.4655 \(1,^^H
              eta,\ldots,^^Heta^{sm}\) be the power basis that SageMath uses to

? 
! Emergency stop.
 ...                                              
                                                  
l.4655 \(1,^^H
              eta,\ldots,^^Heta^{sm}\) be the power basis that SageMath uses to

!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on coding.log
```

in `sage/coding/linear_rank_metric.py`.

This is due to missing raw string markers as noted in the github issue. It is also noted that a typo has been copy pasted for a total of six copies.


---

Comment by strogdon created at 2020-07-27 01:27:37

A few typo corrections in addition to adding raw string markers. It's not clear why the failure now appears since the code in `sage/coding/linear_rank_metric.py` hasn't been recently changed. Perhaps the `sphinx` upgrade, #30001 exposed the issue. It would be good if someone could review the code in `sage/coding/linear_rank_metric.py` to determine if additional changes are warranted.


---

Comment by fbissey created at 2020-07-27 01:28:56

Can you push?


---

Comment by git created at 2020-07-27 01:38:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2020-07-27 01:42:35

had to change my public key but that which was pushed is not correct.


---

Comment by git created at 2020-07-27 01:51:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2020-07-27 01:52:04

I think we're there now.


---

Comment by fbissey created at 2020-07-27 01:54:09

That's one more typo than I had spotted. We should wait for the approval of Samuel Lelievre before going to positive review.


---

Comment by strogdon created at 2020-07-27 01:58:05

Changing status from new to needs_review.


---

Comment by strogdon created at 2020-07-27 01:58:05

I did notice that there was one more string that needed to be a raw string, but I don't believe it impacted anything.


---

Comment by fbissey created at 2020-07-27 02:00:25

I think sage doc in general needs more raw strings but this is not my decision.


---

Comment by slelievre created at 2020-07-27 04:29:24

Thanks for fixing this. I consider all docstrings should be raw!

While we're at it would you

- add the missing `::` at lines 396, 418, 426, 433, 464, 521
- remove the empty line at line 316

Or you can leave that for a different ticket and set to positive review on my behalf.

There would also be a few docstring first lines to change:
- "Returns" -> "Return"
- "Constructs" -> "Construct"
- "Initializes" -> "Initialize"
- "Tests" -> "Test"
but that's cosmetic and might even more belong to a different ticket.


---

Comment by slelievre created at 2020-07-27 04:29:24

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-07-27 05:18:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2020-07-27 05:19:50

Changing status from needs_work to needs_review.


---

Comment by strogdon created at 2020-07-27 05:19:50

Let's see if I got everything. Feel free to make any changes.


---

Comment by slelievre created at 2020-07-27 05:41:17

Since some doctests will be run for the first time (with the new `::`),
let's hear from the bots.

If the bots are happy, positive review.


---

Comment by fbissey created at 2020-07-28 00:10:54

I changed the ticket title and description to reflect the scope creep. I note that some bots do fine but one has failed because of a lack of disk space.

The bots which have run are happy enough so I move this to positive review which should lead to further bot testing.


---

Comment by fbissey created at 2020-07-28 00:10:54

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2020-07-28 02:58:13

I amended the ticket summary and description a bit more, hope that's ok:
I learned a lot about Sage by watching Trac and lists, which was not always easy,
so I try to make ticket summaries and descriptions as helpful as I can to learners.

The happy patchbots still have pyflakes warnings about unused imports,
but let's get this in and those imports can be cleaned up in a different ticket.


---

Comment by vbraun created at 2020-07-28 22:38:59

Merge conflict


---

Comment by vbraun created at 2020-07-28 22:38:59

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2020-07-28 22:41:00

Does any one know which other ticket is also touching `sage/coding/linear_rank_metric.py`?


---

Comment by strogdon created at 2020-07-28 23:51:14

perhaps #30085


---

Comment by fbissey created at 2020-07-28 23:55:45

Replying to [comment:19 strogdon]:
> perhaps #30085

Well, it created the file as far as I see it. And was included in the latest beta. In other word, We are truly fixing something introduced in the latest beta.

But may there is another ticket addressing some of the points we are looking in this ticket.


---

Comment by strogdon created at 2020-07-29 00:00:20

Replying to [comment:20 fbissey]:
> Replying to [comment:19 strogdon]:
> > perhaps #30085
> 
> Well, it created the file as far as I see it. And was included in the latest beta. In other word, We are truly fixing something introduced in the latest beta.
> 
> But may there is another ticket addressing some of the points we are looking in this ticket.

You're right. It was closed 3 days ago. I only looked at that. This then explains the pdf docs failing.


---

Comment by strogdon created at 2020-07-29 00:55:40

Maybe fixed by #21226 and commit https://git.sagemath.org/sage.git/commit?id=899d3900180c956773f3d34c53b96483aa95c57f. But why make beta unicode? I don't think that ticket fixed the raw string markers.


---

Comment by fbissey created at 2020-07-29 01:02:31

That looks like our culprit. Just been merged. The use of unicode in these case usually boils down to "because I can". I don't know how portable it is. And yes it doesn't fix the raw string markers, or the missing ":" or the various spelling/grammar mistakes. Just the use of `\beta` and some doctests change.


---

Comment by strogdon created at 2020-07-29 01:04:34

Wait 'til the next beta and then correct things?


---

Comment by fbissey created at 2020-07-29 01:06:55

That or merge the ticket in this one and mark it as depending on that ticket (just in case it gets unmerged). I don't have a preference either way. Sometimes a merge is complicated but this one is easily manageable I'd say.


---

Comment by git created at 2020-07-29 03:43:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2020-07-29 04:06:23

Changing status from needs_work to needs_review.


---

Comment by strogdon created at 2020-07-29 04:06:23

Let me know if I've messed things up.


---

Comment by fbissey created at 2020-07-29 09:23:11

Somehow you have lost the unicode beta.


---

Comment by strogdon created at 2020-07-29 20:15:28

The original branch here had `\beta` inside raw strings which allowed the pdf docs to build. I left things as they were, i.e. I replaced unicode beta with `\beta` since unicode is not needed inside raw strings. At least this is what I was trying to do. I don't know how to check to see if this branch can successfully be merged on top of #21226.


---

Comment by dimpase created at 2020-08-01 11:30:28

I don't understand what's going on - it seems as if the last commit of #21226 did not make it into the beta6.


---

Comment by dimpase created at 2020-08-02 10:35:23

Replying to [comment:29 strogdon]:
> The original branch here had `\beta` inside raw strings which allowed the pdf docs to build. I left things as they were, i.e. I replaced unicode beta with `\beta` since unicode is not needed inside raw strings. At least this is what I was trying to do. I don't know how to check to see if this branch can successfully be merged on top of #21226.

what's wrong with unicode beta? They're displayed quite well in 21st century setups.

By the way, did you check that pdf docs build with your changes? I spent some time trying to fix that pdf failing problem without resorting to unicode, gave up and added unicode, which made them work. The reason it ever popped up is that something went wrong in the release process and the commit which fixed that issue didn't make it in.


---

Comment by strogdon created at 2020-08-02 15:56:13

Replying to [comment:31 dimpase]:
> Replying to [comment:29 strogdon]:
> > The original branch here had `\beta` inside raw strings which allowed the pdf docs to build. I left things as they were, i.e. I replaced unicode beta with `\beta` since unicode is not needed inside raw strings. At least this is what I was trying to do. I don't know how to check to see if this branch can successfully be merged on top of #21226.
> 
> what's wrong with unicode beta? They're displayed quite well in 21st century setups.
> 

I suppose nothing is wrong with using a unicode beta. I'll let others decide as to whether unicode should be used when instead a raw string marker can be added with the usual `\beta`.

> By the way, did you check that pdf docs build with your changes? I spent some time trying to fix that pdf failing problem without resorting to unicode, gave up and added unicode, which made them work. The reason it ever popped up is that something went wrong in the release process and the commit which fixed that issue didn't make it in.

Yes, this was tested (see [​sage-on-gentoo github issue 593](https://github.com/cschwan/sage-on-gentoo/issues/593)). And it was tested on vanilla Sage as well. Yes is was `9.2.beta6` where I discovered it. Personally, I think using raw string markers is easier to implement.


---

Comment by fbissey created at 2020-08-02 20:47:03

Using unicode `beta` certainly helps getting rid of problems with `\b`. But ultimately using raw string is the proper thing to do. And one doesn't prevent the other I guess.


---

Comment by fbissey created at 2020-08-02 21:54:24

9.2.beta7 is available now on github, let's rebase on that.


---

Comment by fbissey created at 2020-08-03 00:17:56

Volker is merging, let's not do anything until he reports.


---

Comment by strogdon created at 2020-08-03 23:49:44

It merged cleanly and the associated commit looks to be correct.


---

Comment by vbraun created at 2020-08-07 19:07:49

Resolution: fixed
