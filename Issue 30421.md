# Issue 30421: conda-forge-ubuntu-standard: Pillow fails to install (follow up)

Issue created by migration from https://trac.sagemath.org/ticket/30658

Original creator: mkoeppe

Original creation time: 2020-09-25 01:59:51

CC:  isuruf dimpase

Follow-up from #30550:

  We should disable all of the features in â€‹https://github.com/python-pillow/Pillow/blob/master/setup.py#L261-L272 if they are not provided by sage or by a configure check


---

Comment by isuruf created at 2020-09-25 14:30:54

Looks like that's not the issue. `build_ext` is first run with the options that we give and then `build_ext` is run again without the options we give. Not sure why it is run twice.


---

Comment by mkoeppe created at 2020-09-25 14:43:30

I started to use `bdist_wheel` (#29500) - perhaps this is not playing well with pillow's `setup.py`


---

Comment by isuruf created at 2020-09-25 14:49:06

`@`mkoeppe, yes, that's an issue. Options passed to `build_ext` are not used in `bdist_wheel`.


---

Comment by isuruf created at 2020-09-25 14:56:03

A fix for this would be to move `bdist_wheel` before `build_ext`.

```
python setup.py bdist_wheel build_ext <options>
```

instead of

```
python setup.py build_ext <options> bdist_wheel
```



---

Comment by mkoeppe created at 2020-09-25 15:17:36

Thanks! I'll try this


---

Comment by mkoeppe created at 2020-09-25 15:30:40

Last 10 new commits:


---

Comment by mkoeppe created at 2020-09-25 15:30:40

Changing status from new to needs_review.


---

Comment by isuruf created at 2020-09-25 15:32:22

you might need to do the same for numpy


---

Comment by mkoeppe created at 2020-09-25 16:11:51

For numpy I think the command is OK:

```
sage-python23 setup.py \
        --no-user-cfg \
       bdist_wheel \
       ${NUMPY_FCONFIG} || sdh_die "Error building wheel for numpy"
```



---

Comment by mkoeppe created at 2020-09-25 16:12:58

Confirmed that pillow now works:

```
$  tox -e docker-conda-forge-ubuntu-standard -- pillow
...
[pillow-7.2.0] installing. Log file: /sage/logs/pkgs/pillow-7.2.0.log
  [pillow-7.2.0] successfully installed.
```



---

Comment by mkoeppe created at 2020-09-25 16:16:55

Also

```
[numpy-1.19.1] installing. Log file: /sage/logs/pkgs/numpy-1.19.1.log
  [numpy-1.19.1] successfully installed.
```



---

Comment by mkoeppe created at 2020-09-25 17:52:08

Ready for review


---

Comment by isuruf created at 2020-09-25 17:54:11

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-09-25 17:55:40

Thanks!


---

Comment by vbraun created at 2020-09-30 22:30:05

Resolution: fixed
