# Issue 24460: Upgrade MPFR to 4.0.1

Issue created by migration from Trac.

Original creator: fredrik.johansson

Original creation time: 2018-02-09 16:34:35

CC:  fbissey

MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.

There are also some versioning issues in 4.0.0. In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac. I don't know if it's exactly the same problem, but it looks very similar to what is reported at https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=888422 which suggests upgrading MPFR to 4.0.1 is a fix.


---

Comment by jdemeyer created at 2018-02-09 16:38:30

Replying to [ticket:24697 fredrik.johansson]:
> In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac.

That is not an MPFR bug at all. It's just because you have the old MPFR and new MPFR installed. Some libraries that GCC links against are using the old MPFR and some are using the new MPFR. The solution is to recompile GCC.


---

Comment by jdemeyer created at 2018-02-09 16:40:30

That being said, we should still upgrade to 4.0.1 but it won't fix your library versioning issues.


---

Comment by jdemeyer created at 2018-02-09 16:40:30

Changing type from PLEASE CHANGE to defect.


---

Comment by jdemeyer created at 2018-02-09 16:40:30

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by jdemeyer created at 2018-02-09 16:43:56

If the error in `mpfr_div` is serious, this should be a blocker.


---

Comment by jdemeyer created at 2018-02-09 16:43:56

Changing priority from critical to blocker.


---

Comment by fredrik.johansson created at 2018-02-09 19:06:42

> That is not an MPFR bug at all.

You're right, thanks for the correction, although I was puzzled by seeing the error messages pointing to Sage's copy of MPC. I was able to build Sage by switching to gcc-7.

> If the error in mpfr_div is serious, this should be a blocker.

I don't know if it's likely to cause trouble in real computations, but it did break Arb's test suite (which is how it was discovered). In any case, it makes sense to do the upgrade sooner rather than later.


---

Comment by jdemeyer created at 2018-02-10 09:45:31

New commits:


---

Comment by jdemeyer created at 2018-02-10 09:45:31

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-02-10 20:34:20

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-02-10 20:34:20

May the buildbots be with you.


---

Comment by vbraun created at 2018-02-12 22:30:11

Resolution: fixed
