# Issue 24460: Upgrade MPFR to 4.0.1

archive/issues_024460.json:
```json
{
    "body": "CC:  @kiwifb\n\nMPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.\n\n**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2\n\nIssue created by migration from https://trac.sagemath.org/ticket/24697\n\n",
    "closed_at": "2018-02-12T22:30:11Z",
    "created_at": "2018-02-09T16:34:35Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Upgrade MPFR to 4.0.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24460",
    "user": "https://github.com/fredrik-johansson"
}
```
CC:  @kiwifb

MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.

**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2

Issue created by migration from https://trac.sagemath.org/ticket/24697





---

archive/issue_comments_342756.json:
```json
{
    "body": "Replying to [ticket:24697 fredrik.johansson]:\n> In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac.\n\n\nThat is not an MPFR bug at all. It's just because you have the old MPFR and new MPFR installed. Some libraries that GCC links against are using the old MPFR and some are using the new MPFR. The solution is to recompile GCC.",
    "created_at": "2018-02-09T16:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342756",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:24697 fredrik.johansson]:
> In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac.


That is not an MPFR bug at all. It's just because you have the old MPFR and new MPFR installed. Some libraries that GCC links against are using the old MPFR and some are using the new MPFR. The solution is to recompile GCC.



---

archive/issue_comments_342757.json:
```json
{
    "body": "That being said, we should still upgrade to 4.0.1 but it won't fix your library versioning issues.",
    "created_at": "2018-02-09T16:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342757",
    "user": "https://github.com/jdemeyer"
}
```

That being said, we should still upgrade to 4.0.1 but it won't fix your library versioning issues.



---

archive/issue_comments_342758.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2018-02-09T16:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342758",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_342759.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2018-02-09T16:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342759",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_342760.json:
```json
{
    "body": "If the error in `mpfr_div` is serious, this should be a blocker.",
    "created_at": "2018-02-09T16:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342760",
    "user": "https://github.com/jdemeyer"
}
```

If the error in `mpfr_div` is serious, this should be a blocker.



---

archive/issue_comments_342761.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2018-02-09T16:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342761",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_342762.json:
```json
{
    "body": "> That is not an MPFR bug at all.\n\n\nYou're right, thanks for the correction, although I was puzzled by seeing the error messages pointing to Sage's copy of MPC. I was able to build Sage by switching to gcc-7.\n\n> If the error in mpfr_div is serious, this should be a blocker.\n\n\nI don't know if it's likely to cause trouble in real computations, but it did break Arb's test suite (which is how it was discovered). In any case, it makes sense to do the upgrade sooner rather than later.",
    "created_at": "2018-02-09T19:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342762",
    "user": "https://github.com/fredrik-johansson"
}
```

> That is not an MPFR bug at all.


You're right, thanks for the correction, although I was puzzled by seeing the error messages pointing to Sage's copy of MPC. I was able to build Sage by switching to gcc-7.

> If the error in mpfr_div is serious, this should be a blocker.


I don't know if it's likely to cause trouble in real computations, but it did break Arb's test suite (which is how it was discovered). In any case, it makes sense to do the upgrade sooner rather than later.



---

archive/issue_comments_342763.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342763",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_342764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342764",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342765.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-10T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342765",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342766.json:
```json
{
    "body": "May the buildbots be with you.",
    "created_at": "2018-02-10T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342766",
    "user": "https://github.com/tscrim"
}
```

May the buildbots be with you.



---

archive/issue_events_062166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-12T22:30:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24460#event-62166"
}
```



---

archive/issue_comments_342767.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-12T22:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24460#issuecomment-342767",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
