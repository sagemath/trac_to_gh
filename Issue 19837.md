# Issue 19837: QQbar cleaning 2

Issue created by migration from https://trac.sagemath.org/ticket/20074

Original creator: vdelecroix

Original creation time: 2016-02-17 02:55:18

We further simplify QQbar code by:
- using python operator to indentify binary operators instead of strings. In other words we replace `'+'` by `operator.add`, `'-'` by `operator.sub`, etc
- writing only one function `binop` instead of `addsub` and `muldiv`.
- removing the method `kind` of descriptors and instead use the class themselves for dispatching
- detect unions earlier in the code to avoid constructing `ANBinaryExpr`


---

Comment by vdelecroix created at 2016-02-17 02:57:27

Last 10 new commits:


---

Comment by vdelecroix created at 2016-02-17 02:57:27

Changing status from new to needs_review.


---

Comment by git created at 2016-02-17 12:16:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-17 13:52:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-02-26 20:40:44

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2016-02-26 20:40:44

does not apply


---

Comment by vdelecroix created at 2016-03-07 17:04:59

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-03-07 17:05:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2016-03-07 22:01:26

For this change:

```diff
@@ -7461,14 +7076,16 @@ class ANBinaryExpr(ANDescr):
 
             op = self._op
 
-            if op == '+':
+            if op is operator.add:
                 value = left_value + right_value
-            if op == '-':
+            elif op is operator.sub:
                 value = left_value - right_value
-            if op == '*':
+            elif op is operator.mul:
                 value = left_value * right_value
-            if op == '/':
+            elif op is operator.div:
                 value = left_value / right_value
+            else:
+                raise RuntimeError("op is {}".format(op))
 
             if gen.is_trivial():
                 return ANRational(value)
```

Is there a reason why you did not just do `value = op(left_value, right_value)`?

Have you done any speed comparisons?


---

Comment by vdelecroix created at 2016-03-08 01:17:34

Replying to [comment:10 tscrim]:
> For this change:
> ...
> Is there a reason why you did not just do `value = op(left_value, right_value)`?

Nope.

> Have you done any speed comparisons?

I don't think it changes anything. The code is just much simpler.


---

Comment by vdelecroix created at 2016-03-08 01:17:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-03-08 13:46:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-08 13:49:37

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-03-08 19:47:02

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-03-08 19:47:02

ok, looks good to me. Patchbots are happy. Let it be.


---

Comment by vbraun created at 2016-03-08 23:34:40

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-03-08 23:34:40

Merge conflict, try the next beta...


---

Comment by git created at 2016-03-11 13:19:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-03-11 14:25:59

Changing status from needs_work to positive_review.


---

Comment by vdelecroix created at 2016-03-11 14:40:17

Changing status from positive_review to needs_work.


---

Comment by vdelecroix created at 2016-03-11 14:40:17

I need to fix a doctest...


---

Comment by git created at 2016-03-11 14:40:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-11 14:45:50

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-03-20 23:41:36

Resolution: fixed
