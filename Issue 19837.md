# Issue 19837: QQbar cleaning 2

archive/issues_019837.json:
```json
{
    "body": "We further simplify QQbar code by:\n- using python operator to indentify binary operators instead of strings. In other words we replace `'+'` by `operator.add`, `'-'` by `operator.sub`, etc\n- writing only one function `binop` instead of `addsub` and `muldiv`.\n- removing the method `kind` of descriptors and instead use the class themselves for dispatching\n- detect unions earlier in the code to avoid constructing `ANBinaryExpr`\n\nIssue created by migration from https://trac.sagemath.org/ticket/20074\n\n",
    "created_at": "2016-02-17T02:55:18Z",
    "labels": [
        "number fields",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "QQbar cleaning 2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19837",
    "user": "vdelecroix"
}
```
We further simplify QQbar code by:
- using python operator to indentify binary operators instead of strings. In other words we replace `'+'` by `operator.add`, `'-'` by `operator.sub`, etc
- writing only one function `binop` instead of `addsub` and `muldiv`.
- removing the method `kind` of descriptors and instead use the class themselves for dispatching
- detect unions earlier in the code to avoid constructing `ANBinaryExpr`

Issue created by migration from https://trac.sagemath.org/ticket/20074





---

archive/issue_comments_272595.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2016-02-17T02:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272595",
    "user": "vdelecroix"
}
```

Last 10 new commits:



---

archive/issue_comments_272596.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-17T02:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272596",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_272597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-17T12:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-17T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272598",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272599.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-26T20:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272599",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_272600.json:
```json
{
    "body": "does not apply",
    "created_at": "2016-02-26T20:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272600",
    "user": "chapoton"
}
```

does not apply



---

archive/issue_comments_272601.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-07T17:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272601",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_272602.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-07T17:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272602",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_272603.json:
```json
{
    "body": "For this change:\n\n```diff\n@@ -7461,14 +7076,16 @@ class ANBinaryExpr(ANDescr):\n \n             op = self._op\n \n-            if op == '+':\n+            if op is operator.add:\n                 value = left_value + right_value\n-            if op == '-':\n+            elif op is operator.sub:\n                 value = left_value - right_value\n-            if op == '*':\n+            elif op is operator.mul:\n                 value = left_value * right_value\n-            if op == '/':\n+            elif op is operator.div:\n                 value = left_value / right_value\n+            else:\n+                raise RuntimeError(\"op is {}\".format(op))\n \n             if gen.is_trivial():\n                 return ANRational(value)\n```\n\nIs there a reason why you did not just do `value = op(left_value, right_value)`?\n\nHave you done any speed comparisons?",
    "created_at": "2016-03-07T22:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272603",
    "user": "tscrim"
}
```

For this change:

```diff
@@ -7461,14 +7076,16 @@ class ANBinaryExpr(ANDescr):
 
             op = self._op
 
-            if op == '+':
+            if op is operator.add:
                 value = left_value + right_value
-            if op == '-':
+            elif op is operator.sub:
                 value = left_value - right_value
-            if op == '*':
+            elif op is operator.mul:
                 value = left_value * right_value
-            if op == '/':
+            elif op is operator.div:
                 value = left_value / right_value
+            else:
+                raise RuntimeError("op is {}".format(op))
 
             if gen.is_trivial():
                 return ANRational(value)
```

Is there a reason why you did not just do `value = op(left_value, right_value)`?

Have you done any speed comparisons?



---

archive/issue_comments_272604.json:
```json
{
    "body": "Replying to [comment:10 tscrim]:\n> For this change:\n> ...\n> Is there a reason why you did not just do `value = op(left_value, right_value)`?\n\nNope.\n\n> Have you done any speed comparisons?\n\nI don't think it changes anything. The code is just much simpler.",
    "created_at": "2016-03-08T01:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272604",
    "user": "vdelecroix"
}
```

Replying to [comment:10 tscrim]:
> For this change:
> ...
> Is there a reason why you did not just do `value = op(left_value, right_value)`?

Nope.

> Have you done any speed comparisons?

I don't think it changes anything. The code is just much simpler.



---

archive/issue_comments_272605.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-08T01:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272605",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_272606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-08T13:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272606",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272607.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-08T13:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272607",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_272608.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-08T19:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272608",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_272609.json:
```json
{
    "body": "ok, looks good to me. Patchbots are happy. Let it be.",
    "created_at": "2016-03-08T19:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272609",
    "user": "chapoton"
}
```

ok, looks good to me. Patchbots are happy. Let it be.



---

archive/issue_comments_272610.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-03-08T23:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272610",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_272611.json:
```json
{
    "body": "Merge conflict, try the next beta...",
    "created_at": "2016-03-08T23:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272611",
    "user": "vbraun"
}
```

Merge conflict, try the next beta...



---

archive/issue_comments_272612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-11T13:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272612",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272613.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-03-11T14:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272613",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_272614.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-03-11T14:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272614",
    "user": "vdelecroix"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_272615.json:
```json
{
    "body": "I need to fix a doctest...",
    "created_at": "2016-03-11T14:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272615",
    "user": "vdelecroix"
}
```

I need to fix a doctest...



---

archive/issue_comments_272616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-11T14:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272617.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-03-11T14:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272617",
    "user": "vdelecroix"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_272618.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-20T23:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19837",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19837#issuecomment-272618",
    "user": "vbraun"
}
```

Resolution: fixed
