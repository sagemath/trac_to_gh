# Issue 23876: Add test for cactus graph

archive/issues_023876.json:
```json
{
    "body": "CC:  dcoudert\n\nThis patch adds a function to check if a graph is cactus graph.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24113\n\n",
    "created_at": "2017-10-26T12:49:01Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "Add test for cactus graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23876",
    "user": "jmantysalo"
}
```
CC:  dcoudert

This patch adds a function to check if a graph is cactus graph.


Issue created by migration from https://trac.sagemath.org/ticket/24113





---

archive/issue_comments_334666.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-26T12:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334666",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334667.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-26T12:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334667",
    "user": "jmantysalo"
}
```

New commits:



---

archive/issue_comments_334668.json:
```json
{
    "body": "Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.\n\nMake `cutverts` a set to speed up the test `v not in cutverts`.\n\nIn the examples/tests, you could take a 2 x 3 grid graph. Removing any edge, you get a cactus.\n\nThe empty graph is a cactus.\n\nLoops are of course allowed here, but what about multiple edges ?",
    "created_at": "2017-10-26T13:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334668",
    "user": "dcoudert"
}
```

Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.

Make `cutverts` a set to speed up the test `v not in cutverts`.

In the examples/tests, you could take a 2 x 3 grid graph. Removing any edge, you get a cactus.

The empty graph is a cactus.

Loops are of course allowed here, but what about multiple edges ?



---

archive/issue_comments_334669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-26T13:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334669",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334670.json:
```json
{
    "body": "Replying to [comment:3 dcoudert]:\n> Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.\n\nSee the last test `Graph('Fli`@`?')`, it will fail if you remove the test for circular planarity.\n\n> Make `cutverts` a set to speed up the test `v not in cutverts`.\n\nGood point, done.\n\n> In the examples/tests, you could take a 2 x 3 grid graph. Removing any edge, you get a cactus.\n\nHmm... At least some example with \"tail\" would be good.\n\n> The empty graph is a cactus.\n\n?? By this function, yes. Should it be? It is tested.\n\n> Loops are of course allowed here, but what about multiple edges ?\n\nI don't know. Maybe just `_scream_if_not_simple()`?",
    "created_at": "2017-10-26T13:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334670",
    "user": "jmantysalo"
}
```

Replying to [comment:3 dcoudert]:
> Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.

See the last test `Graph('Fli`@`?')`, it will fail if you remove the test for circular planarity.

> Make `cutverts` a set to speed up the test `v not in cutverts`.

Good point, done.

> In the examples/tests, you could take a 2 x 3 grid graph. Removing any edge, you get a cactus.

Hmm... At least some example with "tail" would be good.

> The empty graph is a cactus.

?? By this function, yes. Should it be? It is tested.

> Loops are of course allowed here, but what about multiple edges ?

I don't know. Maybe just `_scream_if_not_simple()`?



---

archive/issue_comments_334671.json:
```json
{
    "body": "> > Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.\n> \n> See the last test `Graph('Fli`@`?')`, it will fail if you remove the test for circular planarity.\n\nRight, but can we think to a faster test ?\n\n> > The empty graph is a cactus.\n> \n> ?? By this function, yes. Should it be? It is tested.\n\nI don't know if it should be, but it is what your method answers.\n\n> > Loops are of course allowed here, but what about multiple edges ?\n> I don't know. Maybe just `_scream_if_not_simple()`?\nthat would ease the stuff",
    "created_at": "2017-10-26T13:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334671",
    "user": "dcoudert"
}
```

> > Why are you testing if the graph is circular planar ? This is much more expensive than the other tests.
> 
> See the last test `Graph('Fli`@`?')`, it will fail if you remove the test for circular planarity.

Right, but can we think to a faster test ?

> > The empty graph is a cactus.
> 
> ?? By this function, yes. Should it be? It is tested.

I don't know if it should be, but it is what your method answers.

> > Loops are of course allowed here, but what about multiple edges ?
> I don't know. Maybe just `_scream_if_not_simple()`?
that would ease the stuff



---

archive/issue_comments_334672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-27T08:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334672",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-27T08:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334673",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_334674.json:
```json
{
    "body": "First, this does not work. See `Graph('Gx?HxC')`. My bad.\n\nI added an example and check for being simple.\n\nAs the empty graph already is, say, planar, I see no reason not to define it as cactus too.\n\nThen, about the speed... Testing for planarity is `O(n)`, as is adding the universal vertex to check being outer planar. We can assume that the graph is very sparse, as we can first check if there are so many edges that the graph can not be cactus. We should start from a vertex of degree at least three, make a circuit and remove edges in the circuit. Then... duh, back to the drawing board.",
    "created_at": "2017-10-27T08:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334674",
    "user": "jmantysalo"
}
```

First, this does not work. See `Graph('Gx?HxC')`. My bad.

I added an example and check for being simple.

As the empty graph already is, say, planar, I see no reason not to define it as cactus too.

Then, about the speed... Testing for planarity is `O(n)`, as is adding the universal vertex to check being outer planar. We can assume that the graph is very sparse, as we can first check if there are so many edges that the graph can not be cactus. We should start from a vertex of degree at least three, make a circuit and remove edges in the circuit. Then... duh, back to the drawing board.



---

archive/issue_comments_334675.json:
```json
{
    "body": "OK.\n\nCould you add in file `isgci.py` the line\n\n```\ngraph_classes.Cactus = GraphClass(\"Cactus\", \"gc_108\", recognition_function = lambda x:x.is_cactus())\n```\n\n[http://www.graphclasses.org/classes/gc_108.html](http://www.graphclasses.org/classes/gc_108.html)",
    "created_at": "2017-10-27T16:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334675",
    "user": "dcoudert"
}
```

OK.

Could you add in file `isgci.py` the line

```
graph_classes.Cactus = GraphClass("Cactus", "gc_108", recognition_function = lambda x:x.is_cactus())
```

[http://www.graphclasses.org/classes/gc_108.html](http://www.graphclasses.org/classes/gc_108.html)



---

archive/issue_comments_334676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-27T17:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334676",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334677.json:
```json
{
    "body": "Perfect.",
    "created_at": "2017-10-27T20:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334677",
    "user": "dcoudert"
}
```

Perfect.



---

archive/issue_comments_334678.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-27T20:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334678",
    "user": "dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_334679.json:
```json
{
    "body": "No no! It still does not work, I just added the entry to isgsi that should be added in any case.",
    "created_at": "2017-10-28T05:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334679",
    "user": "jmantysalo"
}
```

No no! It still does not work, I just added the entry to isgsi that should be added in any case.



---

archive/issue_comments_334680.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-28T05:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334680",
    "user": "jmantysalo"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_334681.json:
```json
{
    "body": "OK, let's go back to the definitions.\n\nIn a cactus graph, a biconnected component is either a cycle or a bridge.\nNow, consider the faces of the graph (`self.faces()`). We must have one face containing all vertices, and then each block that is not a bridge must be a face. So the number of faces must be 1 plus the number of blocks of order > 2 (blocks that are not bridges). So we get:\n\n```\n    self._scream_if_not_simple()\n    if not self.order():\n        return True\n    if not self.is_connected():\n        return False\n    B,C = self.blocks_and_cut_vertices()\n    # the number of faces is 1 plus the number of blocks of order > 2\n    return len(self.faces()) == sum(1 for b in B if len(b) > 2) + 1\n```\n\nHere I consider that a graph made of two cycles connected by a path is a cactus. If this is compatible with the definition (i.e., considering that a bridge is a C2), then above code do the job.",
    "created_at": "2017-10-28T08:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334681",
    "user": "dcoudert"
}
```

OK, let's go back to the definitions.

In a cactus graph, a biconnected component is either a cycle or a bridge.
Now, consider the faces of the graph (`self.faces()`). We must have one face containing all vertices, and then each block that is not a bridge must be a face. So the number of faces must be 1 plus the number of blocks of order > 2 (blocks that are not bridges). So we get:

```
    self._scream_if_not_simple()
    if not self.order():
        return True
    if not self.is_connected():
        return False
    B,C = self.blocks_and_cut_vertices()
    # the number of faces is 1 plus the number of blocks of order > 2
    return len(self.faces()) == sum(1 for b in B if len(b) > 2) + 1
```

Here I consider that a graph made of two cycles connected by a path is a cactus. If this is compatible with the definition (i.e., considering that a bridge is a C2), then above code do the job.



---

archive/issue_comments_334682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-28T16:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334682",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_334683.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-28T16:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334683",
    "user": "jmantysalo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_334684.json:
```json
{
    "body": "I also did a test code with `blocks_and_cut_vertices`, checking that all blocks are cycles or single points. Here I used your code slightly modified.\n\nReady for review now.",
    "created_at": "2017-10-28T16:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334684",
    "user": "jmantysalo"
}
```

I also did a test code with `blocks_and_cut_vertices`, checking that all blocks are cycles or single points. Here I used your code slightly modified.

Ready for review now.



---

archive/issue_comments_334685.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-28T17:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334685",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334686.json:
```json
{
    "body": "It's true that we can also check that each block is isomorphic to a cycle of the same order, but it's not needed. The current implementation do perfectly the job.\n\nGood to go.",
    "created_at": "2017-10-28T17:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334686",
    "user": "dcoudert"
}
```

It's true that we can also check that each block is isomorphic to a cycle of the same order, but it's not needed. The current implementation do perfectly the job.

Good to go.



---

archive/issue_comments_334687.json:
```json
{
    "body": "Replying to [comment:16 dcoudert]:\n\n> Good to go.\n\nSo do we.\n\nWould be nice exercise to make a faster function. If the function searching blocks founds just one block that is not cycle nor a single vertex, it could instantly return `False`.",
    "created_at": "2017-10-28T17:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334687",
    "user": "jmantysalo"
}
```

Replying to [comment:16 dcoudert]:

> Good to go.

So do we.

Would be nice exercise to make a faster function. If the function searching blocks founds just one block that is not cycle nor a single vertex, it could instantly return `False`.



---

archive/issue_comments_334688.json:
```json
{
    "body": "sure, but much more complex to code for a not so critical method.... would be better to speed up the `blocks_and_cut_vertices` and the `faces` methods.",
    "created_at": "2017-10-29T00:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334688",
    "user": "dcoudert"
}
```

sure, but much more complex to code for a not so critical method.... would be better to speed up the `blocks_and_cut_vertices` and the `faces` methods.



---

archive/issue_comments_334689.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-01T18:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23876#issuecomment-334689",
    "user": "vbraun"
}
```

Resolution: fixed
