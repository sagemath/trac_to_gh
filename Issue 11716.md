# Issue 11716: Sage is missing the lambert_w function conversion from Maxima

archive/issues_011716.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman ktkohl\n\nKeywords: lambert_w symbolics conversion maxima\n\nMaxima returns solutions to some exponential equations in terms of the `lambert_w` function. Sage is missing a conversion for this function:\n\n\n```\n\nsage: solve(e^(5*x)+x==0, x, to_poly_solve=True)\n[x == -1/5*lambert_w(5)]\nsage: S = solve(e^(5*x)+x==0, x, to_poly_solve=True)\nsage: z = S[0].rhs()\nsage: z\n-1/5*lambert_w(5)\nsage: N(z)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Users/jonesbe/sage/sage-4.7.2.alpha2/devel/sage-test/sage/<ipython console> in <module>()\n\n/Users/jonesbe/sage/latest/local/lib/python2.6/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits)\n   1264             prec = int((digits+1) * 3.32192) + 1\n   1265     try:\n-> 1266         return x._numerical_approx(prec)\n   1267     except AttributeError:\n   1268         from sage.rings.complex_double import is_ComplexDoubleElement\n\n/Users/jonesbe/sage/latest/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (sage/symbolic/expression.cpp:17950)()\n\nTypeError: cannot evaluate symbolic expression numerically\nsage: lambert_w(5)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n\n/Users/jonesbe/sage/sage-4.7.2.alpha2/devel/sage-test/sage/<ipython console> in <module>()\n\nNameError: name 'lambert_w' is not defined\nsage: \n```\n\n\n`mpmath` can evaluate the `lambert_w` function, so it should be easy to add a new symbolic function to Sage that will fix this issue.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11888\n\n",
    "created_at": "2011-10-01T23:04:08Z",
    "labels": [
        "symbolics",
        "minor",
        "bug"
    ],
    "title": "Sage is missing the lambert_w function conversion from Maxima",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11716",
    "user": "benjaminfjones"
}
```
Assignee: burcin

CC:  kcrisman ktkohl

Keywords: lambert_w symbolics conversion maxima

Maxima returns solutions to some exponential equations in terms of the `lambert_w` function. Sage is missing a conversion for this function:


```

sage: solve(e^(5*x)+x==0, x, to_poly_solve=True)
[x == -1/5*lambert_w(5)]
sage: S = solve(e^(5*x)+x==0, x, to_poly_solve=True)
sage: z = S[0].rhs()
sage: z
-1/5*lambert_w(5)
sage: N(z)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/jonesbe/sage/sage-4.7.2.alpha2/devel/sage-test/sage/<ipython console> in <module>()

/Users/jonesbe/sage/latest/local/lib/python2.6/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits)
   1264             prec = int((digits+1) * 3.32192) + 1
   1265     try:
-> 1266         return x._numerical_approx(prec)
   1267     except AttributeError:
   1268         from sage.rings.complex_double import is_ComplexDoubleElement

/Users/jonesbe/sage/latest/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (sage/symbolic/expression.cpp:17950)()

TypeError: cannot evaluate symbolic expression numerically
sage: lambert_w(5)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)

/Users/jonesbe/sage/sage-4.7.2.alpha2/devel/sage-test/sage/<ipython console> in <module>()

NameError: name 'lambert_w' is not defined
sage: 
```


`mpmath` can evaluate the `lambert_w` function, so it should be easy to add a new symbolic function to Sage that will fix this issue.

Issue created by migration from https://trac.sagemath.org/ticket/11888





---

archive/issue_comments_132781.json:
```json
{
    "body": "Attachment [trac_11888.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888.patch) by benjaminfjones created at 2012-01-10 02:41:53\n\nadd lambert_w symbolic function",
    "created_at": "2012-01-10T02:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132781",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888.patch) by benjaminfjones created at 2012-01-10 02:41:53

add lambert_w symbolic function



---

archive/issue_comments_132782.json:
```json
{
    "body": "Changing keywords from \"lambert_w symbolics conversion maxima\" to \"lambert_w symbolics conversion maxima sd35.5\".",
    "created_at": "2012-01-10T02:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132782",
    "user": "benjaminfjones"
}
```

Changing keywords from "lambert_w symbolics conversion maxima" to "lambert_w symbolics conversion maxima sd35.5".



---

archive/issue_comments_132783.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-10T02:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132783",
    "user": "benjaminfjones"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_132784.json:
```json
{
    "body": "Preliminary patch needs review.  The function has been added using the template developed as part of #11143. The issue described in the description is addressed in one of the doctests.",
    "created_at": "2012-01-10T02:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132784",
    "user": "benjaminfjones"
}
```

Preliminary patch needs review.  The function has been added using the template developed as part of #11143. The issue described in the description is addressed in one of the doctests.



---

archive/issue_comments_132785.json:
```json
{
    "body": "apply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-10T11:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132785",
    "user": "kini"
}
```

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_132786.json:
```json
{
    "body": "Attachment [trac_11888-doctests.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888-doctests.patch) by kini created at 2012-01-10 11:39:21\n\nRunning `make ptestlong` now. I fixed a couple of doctests that broke, and fixed some typos and rST syntax problems in your docstring.",
    "created_at": "2012-01-10T11:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132786",
    "user": "kini"
}
```

Attachment [trac_11888-doctests.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888-doctests.patch) by kini created at 2012-01-10 11:39:21

Running `make ptestlong` now. I fixed a couple of doctests that broke, and fixed some typos and rST syntax problems in your docstring.



---

archive/issue_comments_132787.json:
```json
{
    "body": "All tests pass.",
    "created_at": "2012-01-10T12:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132787",
    "user": "kini"
}
```

All tests pass.



---

archive/issue_comments_132788.json:
```json
{
    "body": "Thanks for the fixes, kini. I've run `make ptestlong` with the patches applied and verified that all tests pass. Maybe I can get `@`kcrisman to finish a review this afternoon.",
    "created_at": "2012-01-10T20:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132788",
    "user": "benjaminfjones"
}
```

Thanks for the fixes, kini. I've run `make ptestlong` with the patches applied and verified that all tests pass. Maybe I can get `@`kcrisman to finish a review this afternoon.



---

archive/issue_comments_132789.json:
```json
{
    "body": "I don't see any obvious problems, but the random expression usually doesn't change much with these new functions and this one is *really* different.  \n\nIt's also spread across many lines, and I'm not sure if this is appropriate (just in this one case, of course).",
    "created_at": "2012-01-10T20:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132789",
    "user": "kcrisman"
}
```

I don't see any obvious problems, but the random expression usually doesn't change much with these new functions and this one is *really* different.  

It's also spread across many lines, and I'm not sure if this is appropriate (just in this one case, of course).



---

archive/issue_comments_132790.json:
```json
{
    "body": "I spread it across lines because 1) I was trying to keep within the recommended PEP 8 guidelines for line length, and 2) because of this\n\n\n```\n[2012-01-10 22:54:53] <kini> while I was fixing the second doctest, some weird\nstuff started happening to vim\n[2012-01-10 22:55:02] <kini> I thought my terminal had frozen or something\n[2012-01-10 22:56:02] <kini> but it turns out that apparently opening a new line\nafter a line with a 1800-character-long Sage symbolic expression on it causes\nvim to take a full 12 seconds to compute the correct indentation level for the\nnext line\n[2012-01-10 22:56:20] <benjaminfjones> ha!\n[2012-01-10 22:56:30] <kini> on a 4.5 GHz Core i5-2500K and utilizing three\ncores!\n[2012-01-10 22:56:39] <benjaminfjones> wow\n```\n\n\nWhat is inappropriate about adding line breaks?\n\nAs for the length of the expression, it seems to be a fluke. With the patches applied, starting with random seeds other than `2` gives expressions of a more \"normal\" length.",
    "created_at": "2012-01-11T01:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132790",
    "user": "kini"
}
```

I spread it across lines because 1) I was trying to keep within the recommended PEP 8 guidelines for line length, and 2) because of this


```
[2012-01-10 22:54:53] <kini> while I was fixing the second doctest, some weird
stuff started happening to vim
[2012-01-10 22:55:02] <kini> I thought my terminal had frozen or something
[2012-01-10 22:56:02] <kini> but it turns out that apparently opening a new line
after a line with a 1800-character-long Sage symbolic expression on it causes
vim to take a full 12 seconds to compute the correct indentation level for the
next line
[2012-01-10 22:56:20] <benjaminfjones> ha!
[2012-01-10 22:56:30] <kini> on a 4.5 GHz Core i5-2500K and utilizing three
cores!
[2012-01-10 22:56:39] <benjaminfjones> wow
```


What is inappropriate about adding line breaks?

As for the length of the expression, it seems to be a fluke. With the patches applied, starting with random seeds other than `2` gives expressions of a more "normal" length.



---

archive/issue_comments_132791.json:
```json
{
    "body": "I agree, it looks like a fluke that the expression grows so large. I did some testing of `random_expr` and found that it \"normally\" produces output around 200 - 400 character long, but occasionally the outputs can be 10 times that (I saw a few around 2500 characters long!)",
    "created_at": "2012-01-11T03:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132791",
    "user": "benjaminfjones"
}
```

I agree, it looks like a fluke that the expression grows so large. I did some testing of `random_expr` and found that it "normally" produces output around 200 - 400 character long, but occasionally the outputs can be 10 times that (I saw a few around 2500 characters long!)



---

archive/issue_comments_132792.json:
```json
{
    "body": "I strongly recommend implementing the general version of the Lambert W function (taking a branch parameter).",
    "created_at": "2012-01-11T15:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132792",
    "user": "fredrik.johansson"
}
```

I strongly recommend implementing the general version of the Lambert W function (taking a branch parameter).



---

archive/issue_comments_132793.json:
```json
{
    "body": "> I strongly recommend implementing the general version of the Lambert W function (taking a branch parameter).\n\nCan you be more specific?  (Is this standard with other multivalued functions in Sage?)  Maybe this could be a separate ticket, unless the change was really easy.",
    "created_at": "2012-01-11T15:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132793",
    "user": "kcrisman"
}
```

> I strongly recommend implementing the general version of the Lambert W function (taking a branch parameter).

Can you be more specific?  (Is this standard with other multivalued functions in Sage?)  Maybe this could be a separate ticket, unless the change was really easy.



---

archive/issue_comments_132794.json:
```json
{
    "body": "The change should be simple. mpmath implements the a branch `W_k(z)` for each integer `k`. It's just a matter of adding a second parameter to the wrapper and putting in some tests. I'm sitting on the train from Beverly MA to Logan airport now, I'll see if I can get it uploaded before the train stops (or my battery dies).",
    "created_at": "2012-01-11T15:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132794",
    "user": "benjaminfjones"
}
```

The change should be simple. mpmath implements the a branch `W_k(z)` for each integer `k`. It's just a matter of adding a second parameter to the wrapper and putting in some tests. I'm sitting on the train from Beverly MA to Logan airport now, I'll see if I can get it uploaded before the train stops (or my battery dies).



---

archive/issue_comments_132795.json:
```json
{
    "body": "Sweet, I didn't realize it was that quick.  I love doing Sage development on that train :)  There is also free wifi at Logan, I believe.",
    "created_at": "2012-01-11T15:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132795",
    "user": "kcrisman"
}
```

Sweet, I didn't realize it was that quick.  I love doing Sage development on that train :)  There is also free wifi at Logan, I believe.



---

archive/issue_comments_132796.json:
```json
{
    "body": "Ping.  I'd love to review this but sounds like Fredrik's point is good and if it's pretty easy for you to add that, we might as well.",
    "created_at": "2012-02-03T03:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132796",
    "user": "kcrisman"
}
```

Ping.  I'd love to review this but sounds like Fredrik's point is good and if it's pretty easy for you to add that, we might as well.



---

archive/issue_comments_132797.json:
```json
{
    "body": "Yes, it should be easy; just add an optional branch parameter, lambertw(z, branch=0).\n\nAnother suggestion is to use scipy.special.lambertw for evaluation over RDF and CDF. The SciPy implementation is a Cython translation of the double precision version in mpmath; it supports all branches and has excellent numerical stability, and runs quite a bit faster.\n\n\n```\nimport scipy.special\nimport mpmath\ntimeit(\"mpmath.lambertw(-35.0r+4.6jr,2r)\")\ntimeit(\"mpmath.fp.lambertw(-35.0r+4.6jr,2r)\")\ntimeit(\"scipy.special.lambertw(-35.0r+4.6jr,2r)\")\nprint repr(complex(mpmath.lambertw(-35.0r+4.6jr,2r)))\nprint repr(mpmath.fp.lambertw(-35.0r+4.6jr,2r))\nprint repr(scipy.special.lambertw(-35.0r+4.6jr,2r))\n\n625 loops, best of 3: 301 \u00b5s per loop\n625 loops, best of 3: 65.1 \u00b5s per loop\n625 loops, best of 3: 6.75 \u00b5s per loop\n(0.91763023745202721+14.071606637742889j)\n(0.91763023745202721+14.071606637742889j)\n(0.91763023745202721+14.071606637742889j)\n```\n",
    "created_at": "2012-02-03T10:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132797",
    "user": "fredrik.johansson"
}
```

Yes, it should be easy; just add an optional branch parameter, lambertw(z, branch=0).

Another suggestion is to use scipy.special.lambertw for evaluation over RDF and CDF. The SciPy implementation is a Cython translation of the double precision version in mpmath; it supports all branches and has excellent numerical stability, and runs quite a bit faster.


```
import scipy.special
import mpmath
timeit("mpmath.lambertw(-35.0r+4.6jr,2r)")
timeit("mpmath.fp.lambertw(-35.0r+4.6jr,2r)")
timeit("scipy.special.lambertw(-35.0r+4.6jr,2r)")
print repr(complex(mpmath.lambertw(-35.0r+4.6jr,2r)))
print repr(mpmath.fp.lambertw(-35.0r+4.6jr,2r))
print repr(scipy.special.lambertw(-35.0r+4.6jr,2r))

625 loops, best of 3: 301 µs per loop
625 loops, best of 3: 65.1 µs per loop
625 loops, best of 3: 6.75 µs per loop
(0.91763023745202721+14.071606637742889j)
(0.91763023745202721+14.071606637742889j)
(0.91763023745202721+14.071606637742889j)
```




---

archive/issue_comments_132798.json:
```json
{
    "body": "Nice; I wonder if there are more places we are beginning to default to mpmath where SciPy could be useful for the double fields.",
    "created_at": "2012-02-03T15:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132798",
    "user": "kcrisman"
}
```

Nice; I wonder if there are more places we are beginning to default to mpmath where SciPy could be useful for the double fields.



---

archive/issue_comments_132799.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-03T15:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132799",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132800.json:
```json
{
    "body": "Thanks for the ping. I'm still here (and I have a patch pretty much ready to go) I just got buried under teaching. I'll try to upload a patch this evening.",
    "created_at": "2012-02-03T17:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132800",
    "user": "benjaminfjones"
}
```

Thanks for the ping. I'm still here (and I have a patch pretty much ready to go) I just got buried under teaching. I'll try to upload a patch this evening.



---

archive/issue_comments_132801.json:
```json
{
    "body": "After looking at this a bit more, it may be more involved than I initially envisioned to implement arbitrary branches of the lambert_w function in one symbolic function. Right now, the patch from SD 35.5 implements a subclass of !`BuiltinFunction`. The underlying assumptions about subclasses of BuiltinFunction include: (from sage/symbolic/function.pyx)\n\n\n```\nWe assume that each subclass of this class will define one symbolic function.\n```\n\n\nOne issue is that there isn't a way (as far as I can see) to pass a branch parameter to !`BuiltinFunction`'s `_call_` method. (Perhaps burcin or other authority on Sage symbolics can comment on this.)\n\nChanging the evaluation numerical eval to use SciPy would be an easy change, that's for sure. I can do that quickly and upload a patch that implements the principle branch only. \n\nAnother idea I just had was to do something like what we have for the Bessel functions, in particular the !`Bessel` class in sage/functions/special.py which is just a basic python class returning one of the Bessel (I,J,Y) functions of a given order.",
    "created_at": "2012-02-04T01:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132801",
    "user": "benjaminfjones"
}
```

After looking at this a bit more, it may be more involved than I initially envisioned to implement arbitrary branches of the lambert_w function in one symbolic function. Right now, the patch from SD 35.5 implements a subclass of !`BuiltinFunction`. The underlying assumptions about subclasses of BuiltinFunction include: (from sage/symbolic/function.pyx)


```
We assume that each subclass of this class will define one symbolic function.
```


One issue is that there isn't a way (as far as I can see) to pass a branch parameter to !`BuiltinFunction`'s `_call_` method. (Perhaps burcin or other authority on Sage symbolics can comment on this.)

Changing the evaluation numerical eval to use SciPy would be an easy change, that's for sure. I can do that quickly and upload a patch that implements the principle branch only. 

Another idea I just had was to do something like what we have for the Bessel functions, in particular the !`Bessel` class in sage/functions/special.py which is just a basic python class returning one of the Bessel (I,J,Y) functions of a given order.



---

archive/issue_comments_132802.json:
```json
{
    "body": "Ok, that makes sense.   I feel like there should be a way to do that nonetheless - see `incomplete_gamma`, with\n\n```\n        BuiltinFunction.__init__(self, \"gamma\", nargs=2, latex_name=r\"\\Gamma\",\n                conversions={'maxima':'gamma_incomplete', 'mathematica':'Gamma',\n                    'maple':'GAMMA'})\n```\n\nand then use `_eval_` and `_evalf_`, but I don't have time to try looking into whether that would work here now.\n\nBased on Fredrik's comment, make sure to only use SciPy for RDF/CDF - hopefully there is a good model elsewhere to use for that.",
    "created_at": "2012-02-04T01:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132802",
    "user": "kcrisman"
}
```

Ok, that makes sense.   I feel like there should be a way to do that nonetheless - see `incomplete_gamma`, with

```
        BuiltinFunction.__init__(self, "gamma", nargs=2, latex_name=r"\Gamma",
                conversions={'maxima':'gamma_incomplete', 'mathematica':'Gamma',
                    'maple':'GAMMA'})
```

and then use `_eval_` and `_evalf_`, but I don't have time to try looking into whether that would work here now.

Based on Fredrik's comment, make sure to only use SciPy for RDF/CDF - hopefully there is a good model elsewhere to use for that.



---

archive/issue_comments_132803.json:
```json
{
    "body": "proof of concept patch (not ready for review)",
    "created_at": "2012-02-06T05:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132803",
    "user": "benjaminfjones"
}
```

proof of concept patch (not ready for review)



---

archive/issue_comments_132804.json:
```json
{
    "body": "Attachment [trac_11888_v2.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v2.patch) by benjaminfjones created at 2012-02-06 05:26:29\n\nOK, I made a second attempt. The patch isn't complete (I need to fix and add docstrings and do more testing) and is *not* ready for review, but if the reviewers will take a look at the basic implementation and give me feedback, I'd appreciate it.\n\nIn [attachment:trac_11888_v2.patch] there is a new symbolic function  `lambert_w_branch` which takes two arguments, a complex number `z` and an integer branch `n`. This is implemented using scipy.special.lambertw for RDF/CDF arguments z and using mpmath otherwise. \n\nThere is also a wrapper function `lambert_w` that accepts either one or two arguments. For one argument it returns the principle branch `lambert_w_branch(z,0)`, for two it returns `lambert_w_branch(z,n)`. I still need to add the conversion from Maxima (by hand now, since `lambert_w` doesn't inherit from BuiltinFunction any more).",
    "created_at": "2012-02-06T05:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132804",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v2.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v2.patch) by benjaminfjones created at 2012-02-06 05:26:29

OK, I made a second attempt. The patch isn't complete (I need to fix and add docstrings and do more testing) and is *not* ready for review, but if the reviewers will take a look at the basic implementation and give me feedback, I'd appreciate it.

In [attachment:trac_11888_v2.patch] there is a new symbolic function  `lambert_w_branch` which takes two arguments, a complex number `z` and an integer branch `n`. This is implemented using scipy.special.lambertw for RDF/CDF arguments z and using mpmath otherwise. 

There is also a wrapper function `lambert_w` that accepts either one or two arguments. For one argument it returns the principle branch `lambert_w_branch(z,0)`, for two it returns `lambert_w_branch(z,n)`. I still need to add the conversion from Maxima (by hand now, since `lambert_w` doesn't inherit from BuiltinFunction any more).



---

archive/issue_comments_132805.json:
```json
{
    "body": "I fixed the doctests and added lambert_w to the symbol table. I verified that all tests pass including the random_tests.py ones. The patch [attachment:trac_11888_v3.patch] is ready for review.",
    "created_at": "2012-02-11T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132805",
    "user": "benjaminfjones"
}
```

I fixed the doctests and added lambert_w to the symbol table. I verified that all tests pass including the random_tests.py ones. The patch [attachment:trac_11888_v3.patch] is ready for review.



---

archive/issue_comments_132806.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-11T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132806",
    "user": "benjaminfjones"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132807.json:
```json
{
    "body": "principle -> principal, branchs -> branches\n\nOtherwise, from looking at the patch, seems good.",
    "created_at": "2012-02-11T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132807",
    "user": "fredrik.johansson"
}
```

principle -> principal, branchs -> branches

Otherwise, from looking at the patch, seems good.



---

archive/issue_comments_132808.json:
```json
{
    "body": "Thanks for looking at the patch, Fredrik. I've fixed the mistakes and replaced the latest patch.",
    "created_at": "2012-02-12T00:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132808",
    "user": "benjaminfjones"
}
```

Thanks for looking at the patch, Fredrik. I've fixed the mistakes and replaced the latest patch.



---

archive/issue_comments_132809.json:
```json
{
    "body": "adds lambert_w and lambert_w_branch functions",
    "created_at": "2012-02-12T00:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132809",
    "user": "benjaminfjones"
}
```

adds lambert_w and lambert_w_branch functions



---

archive/issue_comments_132810.json:
```json
{
    "body": "Attachment [trac_11888_v3.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v3.patch) by kcrisman created at 2012-02-12 03:45:44\n\n* typo\n\n```\n  SciPy is used to evalute\n```\n\n* Will this conflict with the beta function patch when it comes to the random test?\n* I'm wondering whether we should add a couple conversions to Mma/Maple in the init (apparently Maxima is working fine, though see [this possible enhancement](http://www.ma.utexas.edu/pipermail/maxima/2011/025861.html)).  Mathematica apparently calls it ProductLog...",
    "created_at": "2012-02-12T03:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132810",
    "user": "kcrisman"
}
```

Attachment [trac_11888_v3.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v3.patch) by kcrisman created at 2012-02-12 03:45:44

* typo

```
  SciPy is used to evalute
```

* Will this conflict with the beta function patch when it comes to the random test?
* I'm wondering whether we should add a couple conversions to Mma/Maple in the init (apparently Maxima is working fine, though see [this possible enhancement](http://www.ma.utexas.edu/pipermail/maxima/2011/025861.html)).  Mathematica apparently calls it ProductLog...



---

archive/issue_comments_132811.json:
```json
{
    "body": "* I'll fix the typo (tomorrow)\n  * I'll make the beta function ticket a dependency so the random test will come out correctly after the two patches are merged in order\n  * ProductLog in Mathematica puts the branch parameter first. I guess it makes sense to be consistent with that convention as well as the discussion on the Maxima list. I can't figure out whether the generalized lambert function ever made it into Maxima..",
    "created_at": "2012-02-12T06:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132811",
    "user": "benjaminfjones"
}
```

* I'll fix the typo (tomorrow)
  * I'll make the beta function ticket a dependency so the random test will come out correctly after the two patches are merged in order
  * ProductLog in Mathematica puts the branch parameter first. I guess it makes sense to be consistent with that convention as well as the discussion on the Maxima list. I can't figure out whether the generalized lambert function ever made it into Maxima..



---

archive/issue_comments_132812.json:
```json
{
    "body": "addressed reviewer issues, changed order of arguments to be consistant with Mma/Maple",
    "created_at": "2012-02-12T20:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132812",
    "user": "benjaminfjones"
}
```

addressed reviewer issues, changed order of arguments to be consistant with Mma/Maple



---

archive/issue_comments_132813.json:
```json
{
    "body": "Attachment [trac_11888_v4.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v4.patch) by benjaminfjones created at 2012-02-12 20:49:38\n\nfixes random tests after rebasing against #9130",
    "created_at": "2012-02-12T20:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132813",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v4.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v4.patch) by benjaminfjones created at 2012-02-12 20:49:38

fixes random tests after rebasing against #9130



---

archive/issue_comments_132814.json:
```json
{
    "body": "Attachment [trac_11888-random-tests.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888-random-tests.patch) by benjaminfjones created at 2012-02-12 20:51:25",
    "created_at": "2012-02-12T20:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132814",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888-random-tests.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888-random-tests.patch) by benjaminfjones created at 2012-02-12 20:51:25



---

archive/issue_comments_132815.json:
```json
{
    "body": "Do we really want to call this function `lambert_w_branch()`? Can we name it `lambert_w()`? I would even suggest to add custom printing methods (`_print_()` and `_print_latex_()`) to avoid printing the branch argument if it is 0.\n\nIf the function is named lambert_w, you can remove the wrapper function `lambert_w()` and the manual manipulation of the symbol table. In this case, a custom `__call__()` method would take the place of the wrapper method.\n\nBTW, we should either open a new ticket to add known exact evaluations to `_eval_()` or do this here:\n- 0 -> 0\n- e -> 1\n- -1/e -> -1",
    "created_at": "2012-02-13T10:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132815",
    "user": "burcin"
}
```

Do we really want to call this function `lambert_w_branch()`? Can we name it `lambert_w()`? I would even suggest to add custom printing methods (`_print_()` and `_print_latex_()`) to avoid printing the branch argument if it is 0.

If the function is named lambert_w, you can remove the wrapper function `lambert_w()` and the manual manipulation of the symbol table. In this case, a custom `__call__()` method would take the place of the wrapper method.

BTW, we should either open a new ticket to add known exact evaluations to `_eval_()` or do this here:
- 0 -> 0
- e -> 1
- -1/e -> -1



---

archive/issue_comments_132816.json:
```json
{
    "body": "I have one more comment. Sorry for multiple emails.\n\nYou should check if the parent is `RDF` or `CDF` using `is`, not `==`. In this context, `parent` is an argument to the `_evalf_()` method, which overrides the `parent()` function imported from `sage.structure.coerce`. I suggest naming the argument `parent_d` instead of `parent`. Then you can do:\n\n\n```\nR = parent_d or parent(z)\nif R is float or R is complex or R is RDF or R is CDF: \n    import scipy.special \n    return scipy.special.lambertw(z, n) \nelse: \n    import mpmath \n    return mpmath_utils.call(mpmath.lambertw, z, n, parent=parent) \n```\n",
    "created_at": "2012-02-13T10:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132816",
    "user": "burcin"
}
```

I have one more comment. Sorry for multiple emails.

You should check if the parent is `RDF` or `CDF` using `is`, not `==`. In this context, `parent` is an argument to the `_evalf_()` method, which overrides the `parent()` function imported from `sage.structure.coerce`. I suggest naming the argument `parent_d` instead of `parent`. Then you can do:


```
R = parent_d or parent(z)
if R is float or R is complex or R is RDF or R is CDF: 
    import scipy.special 
    return scipy.special.lambertw(z, n) 
else: 
    import mpmath 
    return mpmath_utils.call(mpmath.lambertw, z, n, parent=parent) 
```




---

archive/issue_comments_132817.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-13T10:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132817",
    "user": "burcin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132818.json:
```json
{
    "body": "Replying to [comment:28 burcin]:\n> Do we really want to call this function `lambert_w_branch()`? Can we name it `lambert_w()`? I would even suggest to add custom printing methods (`_print_()` and `_print_latex_()`) to avoid printing the branch argument if it is 0.\nThat's a great idea.",
    "created_at": "2012-02-13T18:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132818",
    "user": "kcrisman"
}
```

Replying to [comment:28 burcin]:
> Do we really want to call this function `lambert_w_branch()`? Can we name it `lambert_w()`? I would even suggest to add custom printing methods (`_print_()` and `_print_latex_()`) to avoid printing the branch argument if it is 0.
That's a great idea.



---

archive/issue_comments_132819.json:
```json
{
    "body": "I've written a new patch that includes significant changes compared to the last one. I think I've included all of burcin's suggestions and I think it's much improved now. All tests pass with the patch applied on 5.0.beta4 + #12507.\n\nOne thing I haven't managed to figure out is how to get integration to work, e.g.\n\n\n```\nsage: integrate(lambert_w(x), x)\n...\nRuntimeError: ECL says: Error executing code in Maxima: lambert_w: wrong number of arguments.\n```\n\n\nI guess that's because there isn't a two-argument version of lambert_w defined in maxima. The conversion maxima -> Sage works (as shown in one of the doctests) but it looks like the other way doesn't. Another example:\n\n\n```\nsage: maxima(lambert_w(5))\nMaxima ERROR:\n\t\nlambert_w: wrong number of arguments.\n -- an error. To debug this try: debugmode(true);\n```\n\n\nQ: How do I get around this?\n\nNumerical integration also fails unless I pass a lambda function:\n\n\n```\nsage: numerical_integral(lambert_w(x), 0, 1)\nException TypeError: \"function not supported for these types, and can't coerce safely to supported types\" in 'sage.gsl.integration.c_ff' ignored\n...\n(0.0, 0.0)\n```\n\n\nbut ....\n\n\n```\nsage: numerical_integral(lambda x: lambert_w(x), 0, 1)\n(0.33036612476168054, 3.667800782666048e-15)\n```\n\n\nQ: How do I fix this?",
    "created_at": "2012-02-18T06:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132819",
    "user": "benjaminfjones"
}
```

I've written a new patch that includes significant changes compared to the last one. I think I've included all of burcin's suggestions and I think it's much improved now. All tests pass with the patch applied on 5.0.beta4 + #12507.

One thing I haven't managed to figure out is how to get integration to work, e.g.


```
sage: integrate(lambert_w(x), x)
...
RuntimeError: ECL says: Error executing code in Maxima: lambert_w: wrong number of arguments.
```


I guess that's because there isn't a two-argument version of lambert_w defined in maxima. The conversion maxima -> Sage works (as shown in one of the doctests) but it looks like the other way doesn't. Another example:


```
sage: maxima(lambert_w(5))
Maxima ERROR:
	
lambert_w: wrong number of arguments.
 -- an error. To debug this try: debugmode(true);
```


Q: How do I get around this?

Numerical integration also fails unless I pass a lambda function:


```
sage: numerical_integral(lambert_w(x), 0, 1)
Exception TypeError: "function not supported for these types, and can't coerce safely to supported types" in 'sage.gsl.integration.c_ff' ignored
...
(0.0, 0.0)
```


but ....


```
sage: numerical_integral(lambda x: lambert_w(x), 0, 1)
(0.33036612476168054, 3.667800782666048e-15)
```


Q: How do I fix this?



---

archive/issue_comments_132820.json:
```json
{
    "body": "adds lambert_w function",
    "created_at": "2012-02-18T06:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132820",
    "user": "benjaminfjones"
}
```

adds lambert_w function



---

archive/issue_comments_132821.json:
```json
{
    "body": "Attachment [trac_11888_v5.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v5.patch) by benjaminfjones created at 2012-02-18 06:11:57",
    "created_at": "2012-02-18T06:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132821",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v5.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v5.patch) by benjaminfjones created at 2012-02-18 06:11:57



---

archive/issue_comments_132822.json:
```json
{
    "body": "Replying to [comment:31 benjaminfjones]:\n> I've written a new patch that includes significant changes compared to the last one. I think I've included all of burcin's suggestions and I think it's much improved now. All tests pass with the patch applied on 5.0.beta4 + #12507.\n\nThanks! The patch looks really good. When checking if the input is 0 in `_eval_`, you might want to `return z` instead of `Integer(0)` to preserve the type of the input. Similarly, we should return `parent(z)(1)` or `parent(z)(-1)` in the other branches.\n\n<snip>\n> I guess that's because there isn't a two-argument version of lambert_w defined in maxima. The conversion maxima -> Sage works (as shown in one of the doctests) but it looks like the other way doesn't. Another example:\n> \n> {{{\n> sage: maxima(lambert_w(5))\n> Maxima ERROR:\n> \t\n> lambert_w: wrong number of arguments.\n>  -- an error. To debug this try: debugmode(true);\n> }}}\n> \n> Q: How do I get around this?\n\nYou need to define `_maxima_init_evaled_()`. See line 895 of `sage/fuctions/other.py`:\n\nhttp://hg.sagemath.org/sage-main/file/c239be1054e0/sage/functions/other.py#l895",
    "created_at": "2012-02-18T16:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132822",
    "user": "burcin"
}
```

Replying to [comment:31 benjaminfjones]:
> I've written a new patch that includes significant changes compared to the last one. I think I've included all of burcin's suggestions and I think it's much improved now. All tests pass with the patch applied on 5.0.beta4 + #12507.

Thanks! The patch looks really good. When checking if the input is 0 in `_eval_`, you might want to `return z` instead of `Integer(0)` to preserve the type of the input. Similarly, we should return `parent(z)(1)` or `parent(z)(-1)` in the other branches.

<snip>
> I guess that's because there isn't a two-argument version of lambert_w defined in maxima. The conversion maxima -> Sage works (as shown in one of the doctests) but it looks like the other way doesn't. Another example:
> 
> {{{
> sage: maxima(lambert_w(5))
> Maxima ERROR:
> 	
> lambert_w: wrong number of arguments.
>  -- an error. To debug this try: debugmode(true);
> }}}
> 
> Q: How do I get around this?

You need to define `_maxima_init_evaled_()`. See line 895 of `sage/fuctions/other.py`:

http://hg.sagemath.org/sage-main/file/c239be1054e0/sage/functions/other.py#l895



---

archive/issue_comments_132823.json:
```json
{
    "body": "Replying to [comment:33 burcin]:\n> \n> You need to define `_maxima_init_evaled_()`. See line 895 of `sage/fuctions/other.py`:\n> \n> http://hg.sagemath.org/sage-main/file/c239be1054e0/sage/functions/other.py#l895\n> \n\nIt seems that adding `_maxima_init_evaled_()` solves one issue, converting to Maxima with `_maxima_()`,\n\n\n```\nsage: lambert_w(x)._maxima_()\nlambert_w(x)\nsage: lambert_w(1,x)._maxima_()\n...\nNotImplementedError: Non-principal branch lambert_w[1](x) is not implemented in Maxima\n```\n\n\nbut integration still doesn't work (same error is raised as before). Looking closer it seems that the issue is here:\n\n\n```\nsage: z = lambert_w(x)\nsage: z.operands()\n[0, x]\nsage: z.operator()\nlambert_w\n```\n\n\nbecause when `sr_to_max` is called in the integration code, I get:\n\n\n```\nsage: from sage.interfaces.maxima_lib import sr_to_max\nsage: sr_to_max(lambert_w(x))\n<ECL: ((%LAMBERT_W) 0 $X)>\nsage: sr_to_max(lambert_w(1, x))\n<ECL: ((%LAMBERT_W) 1 $X)>\n```\n\n\nand Maxima barfs because it doesn't know what to do with `((%LAMBERT_W) 0 $X)`.",
    "created_at": "2012-02-22T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132823",
    "user": "benjaminfjones"
}
```

Replying to [comment:33 burcin]:
> 
> You need to define `_maxima_init_evaled_()`. See line 895 of `sage/fuctions/other.py`:
> 
> http://hg.sagemath.org/sage-main/file/c239be1054e0/sage/functions/other.py#l895
> 

It seems that adding `_maxima_init_evaled_()` solves one issue, converting to Maxima with `_maxima_()`,


```
sage: lambert_w(x)._maxima_()
lambert_w(x)
sage: lambert_w(1,x)._maxima_()
...
NotImplementedError: Non-principal branch lambert_w[1](x) is not implemented in Maxima
```


but integration still doesn't work (same error is raised as before). Looking closer it seems that the issue is here:


```
sage: z = lambert_w(x)
sage: z.operands()
[0, x]
sage: z.operator()
lambert_w
```


because when `sr_to_max` is called in the integration code, I get:


```
sage: from sage.interfaces.maxima_lib import sr_to_max
sage: sr_to_max(lambert_w(x))
<ECL: ((%LAMBERT_W) 0 $X)>
sage: sr_to_max(lambert_w(1, x))
<ECL: ((%LAMBERT_W) 1 $X)>
```


and Maxima barfs because it doesn't know what to do with `((%LAMBERT_W) 0 $X)`.



---

archive/issue_comments_132824.json:
```json
{
    "body": "Attachment [trac_11888_v6.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v6.patch) by benjaminfjones created at 2012-03-13 19:49:49\n\nadded custom latex printing and Maxima initialization",
    "created_at": "2012-03-13T19:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132824",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v6.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v6.patch) by benjaminfjones created at 2012-03-13 19:49:49

added custom latex printing and Maxima initialization



---

archive/issue_comments_132825.json:
```json
{
    "body": "I've posted my latest patch in case anyone wants to play around with getting integration of `lambert_w` to work. \n\nThis issue could be a new ticket. One solution I can see is to add `lambert_w` to the `special_sage_to_max` dictionary in `sage/intefaces/maxima_lib.py`. There are a few other special functions listed there (like `Ei` and `polylog`) that need special conversions to maxima.\n\nSo, I propose that we either:\na. Review patch [attachment:trac_11888_v6.patch] and open a new ticket for the integration issue\nb. Agree on a simple workaround like adding `lambert_w` to `special_sage_to_max` and I'll add it to the patch.",
    "created_at": "2012-03-13T21:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132825",
    "user": "benjaminfjones"
}
```

I've posted my latest patch in case anyone wants to play around with getting integration of `lambert_w` to work. 

This issue could be a new ticket. One solution I can see is to add `lambert_w` to the `special_sage_to_max` dictionary in `sage/intefaces/maxima_lib.py`. There are a few other special functions listed there (like `Ei` and `polylog`) that need special conversions to maxima.

So, I propose that we either:
a. Review patch [attachment:trac_11888_v6.patch] and open a new ticket for the integration issue
b. Agree on a simple workaround like adding `lambert_w` to `special_sage_to_max` and I'll add it to the patch.



---

archive/issue_comments_132826.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-13T21:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132826",
    "user": "benjaminfjones"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132827.json:
```json
{
    "body": "I think that b. makes sense.  You'd also have to add `max_lambert_w` at about [this spot](http://hg.sagemath.org/sage-main/file/c239be1054e0/sage/interfaces/maxima_lib.py#l1093) but having numerical integrals would be worth it.  \n\nI assume that this is a pretty easy change?  If not, I guess we could just document that this doesn't work yet.  In either case something should be documented, though, since half of our bug reports seem to be people using new, cool functionality who then expect that new functionality to be fully featured as well - i.e., it's not really a bug report at all, but a feature request.  Having good doc for what we *don't* do will help with that.",
    "created_at": "2012-03-14T12:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132827",
    "user": "kcrisman"
}
```

I think that b. makes sense.  You'd also have to add `max_lambert_w` at about [this spot](http://hg.sagemath.org/sage-main/file/c239be1054e0/sage/interfaces/maxima_lib.py#l1093) but having numerical integrals would be worth it.  

I assume that this is a pretty easy change?  If not, I guess we could just document that this doesn't work yet.  In either case something should be documented, though, since half of our bug reports seem to be people using new, cool functionality who then expect that new functionality to be fully featured as well - i.e., it's not really a bug report at all, but a feature request.  Having good doc for what we *don't* do will help with that.



---

archive/issue_comments_132828.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-16T02:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132828",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132829.json:
```json
{
    "body": "'Needs work' for b.",
    "created_at": "2012-03-16T02:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132829",
    "user": "kcrisman"
}
```

'Needs work' for b.



---

archive/issue_comments_132830.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-19T19:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132830",
    "user": "benjaminfjones"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132831.json:
```json
{
    "body": "Success! \n\nSymbolic and numerical integration now work as expected for the principle branch. I added doctests to indicate what is and is not implemented. \n\n----\n\nOne other comment, to indicate what causes errors, I want to add doctests to `lambert_w` such as: \n\n\n```\nsage: integral(lambert_w(1,x), x)                                                                   \nERROR: An unexpected error occurred while tokenizing input                                          \n...                                                                                                 \nRuntimeError: ECL says: Error executing code in Maxima: lambert_w: expected exactly 1 arguments.   \n```\n\n\nand \n\n\n```\nsage: numerical_integral(lambert_w(x), 0, 1)                                                        \nException TypeError: \"function not supported for these types, and can't coerce safely to supported types\" in 'sage.gsl.integration.c_ff' ignored                                                    \n...                                                                                                 \n(0.0, 0.0)\n```\n\n\nbut the doctest framework doesn't recognize the `Exception TypeError` and it seems to automatically fail if a `RuntimeError` is raised. If I put the latter 4 lines in the docstring for `lambert_w`, it fails doctesting, the framework only sees the `(0.0, 0.0)` part at the end. Is there a way around either of these issues?",
    "created_at": "2012-03-19T19:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132831",
    "user": "benjaminfjones"
}
```

Success! 

Symbolic and numerical integration now work as expected for the principle branch. I added doctests to indicate what is and is not implemented. 

----

One other comment, to indicate what causes errors, I want to add doctests to `lambert_w` such as: 


```
sage: integral(lambert_w(1,x), x)                                                                   
ERROR: An unexpected error occurred while tokenizing input                                          
...                                                                                                 
RuntimeError: ECL says: Error executing code in Maxima: lambert_w: expected exactly 1 arguments.   
```


and 


```
sage: numerical_integral(lambert_w(x), 0, 1)                                                        
Exception TypeError: "function not supported for these types, and can't coerce safely to supported types" in 'sage.gsl.integration.c_ff' ignored                                                    
...                                                                                                 
(0.0, 0.0)
```


but the doctest framework doesn't recognize the `Exception TypeError` and it seems to automatically fail if a `RuntimeError` is raised. If I put the latter 4 lines in the docstring for `lambert_w`, it fails doctesting, the framework only sees the `(0.0, 0.0)` part at the end. Is there a way around either of these issues?



---

archive/issue_comments_132832.json:
```json
{
    "body": "adds lambert_w function, including integration",
    "created_at": "2012-03-19T19:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132832",
    "user": "benjaminfjones"
}
```

adds lambert_w function, including integration



---

archive/issue_comments_132833.json:
```json
{
    "body": "Attachment [trac_11888_v7.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v7.patch) by benjaminfjones created at 2012-03-19 20:00:20",
    "created_at": "2012-03-19T20:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132833",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v7.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v7.patch) by benjaminfjones created at 2012-03-19 20:00:20



---

archive/issue_comments_132834.json:
```json
{
    "body": "Apply trac_11888_v7.patch\n\n(for patchbot, which is trying to apply all nine patches at once)",
    "created_at": "2012-03-26T07:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132834",
    "user": "davidloeffler"
}
```

Apply trac_11888_v7.patch

(for patchbot, which is trying to apply all nine patches at once)



---

archive/issue_comments_132835.json:
```json
{
    "body": "I removed #12507 from dependencies since it was merged in 5.0.beta5 and now the patchbot is getting confused trying to apply #12507 to 5.0.beta12 before testing.\n\nI verified that [attachment:trac_11888_v7.2.patch] applies cleanly to 5.0.beta12 and I'm rerunning a patchbot instance on it.",
    "created_at": "2012-04-07T22:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132835",
    "user": "benjaminfjones"
}
```

I removed #12507 from dependencies since it was merged in 5.0.beta5 and now the patchbot is getting confused trying to apply #12507 to 5.0.beta12 before testing.

I verified that [attachment:trac_11888_v7.2.patch] applies cleanly to 5.0.beta12 and I'm rerunning a patchbot instance on it.



---

archive/issue_comments_132836.json:
```json
{
    "body": "I'm sure we can finish this off next week in Seattle.  Meanwhile, an interesting update from the Maxima developers about coming attractions:\n\n```\n\nMessage: 4\nDate: Thu, 17 May 2012 04:31:13 +0000 (UTC)\nFrom: Robert Dodier <robert.dodier@gmail.com>\nTo: maxima@math.utexas.edu\nSubject: Re: [Maxima] Generalized Lambert W function - premature\n       commit\nMessage-ID: <jp1uuh$jv8$1@dough.gmane.org>\n\nOn 2012-05-17, David Billinghurst <dbmaxima@gmail.com> wrote:\n\n> Oops. I have accidentally committed some code for Generalized Lambert\n> W function to src/specfn.lisp.  Still getting my head around git.\n\n> The code seems functionally correct, and passes tests in\n> tests/rtest_lambert_w.mac, but I hadn't finished polishing it and it\n> is still undocumented.  Unless anyone objects, I will leave it in\n> place for the time being.\n\nNo problem, OK by me.\n\n> There is a new function generalized_lambert_w(k,z) that returns the\n> kth branch W_k(z).  There are float and bigfloat routines for complex\n> z.  generalized_lambert_w(0,z) is not (yet) simplified to\n> lambert_w(z), as I hadn't decided if this should be done\n> unconditionally or controlled by a flag.  Thoughts?\n\nIs it more convenient to simplify W_0(z) instead of W(z) ? If not, then\nit seems reasonable to just go ahead and simplify it.\n\nIf you decide against automatically simplifying W_0(z) to W(z), I guess\nI hope you don't make it controlled by a flag; flags cause trouble,\nbecause one can't guess by looking at some code how it's going to turn\nout. How about a function to carry out the simplification.\n\n```\n",
    "created_at": "2012-05-17T12:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132836",
    "user": "kcrisman"
}
```

I'm sure we can finish this off next week in Seattle.  Meanwhile, an interesting update from the Maxima developers about coming attractions:

```

Message: 4
Date: Thu, 17 May 2012 04:31:13 +0000 (UTC)
From: Robert Dodier <robert.dodier@gmail.com>
To: maxima@math.utexas.edu
Subject: Re: [Maxima] Generalized Lambert W function - premature
       commit
Message-ID: <jp1uuh$jv8$1@dough.gmane.org>

On 2012-05-17, David Billinghurst <dbmaxima@gmail.com> wrote:

> Oops. I have accidentally committed some code for Generalized Lambert
> W function to src/specfn.lisp.  Still getting my head around git.

> The code seems functionally correct, and passes tests in
> tests/rtest_lambert_w.mac, but I hadn't finished polishing it and it
> is still undocumented.  Unless anyone objects, I will leave it in
> place for the time being.

No problem, OK by me.

> There is a new function generalized_lambert_w(k,z) that returns the
> kth branch W_k(z).  There are float and bigfloat routines for complex
> z.  generalized_lambert_w(0,z) is not (yet) simplified to
> lambert_w(z), as I hadn't decided if this should be done
> unconditionally or controlled by a flag.  Thoughts?

Is it more convenient to simplify W_0(z) instead of W(z) ? If not, then
it seems reasonable to just go ahead and simplify it.

If you decide against automatically simplifying W_0(z) to W(z), I guess
I hope you don't make it controlled by a flag; flags cause trouble,
because one can't guess by looking at some code how it's going to turn
out. How about a function to carry out the simplification.

```




---

archive/issue_comments_132837.json:
```json
{
    "body": "That will be good; should allow us to integrate the non-principle branch. Although, in Sage 5.0, we're still a major version behind the current Maxima release.",
    "created_at": "2012-05-17T20:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132837",
    "user": "benjaminfjones"
}
```

That will be good; should allow us to integrate the non-principle branch. Although, in Sage 5.0, we're still a major version behind the current Maxima release.



---

archive/issue_comments_132838.json:
```json
{
    "body": "I am reviewing an expository paper about the Lambert W function and it says \"Maple this\" and \"Maple that\".  Let's get this into Sage and stay competitive with the M's!  ;-)\n\nRob, in cheerleader mode",
    "created_at": "2012-05-18T04:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132838",
    "user": "rbeezer"
}
```

I am reviewing an expository paper about the Lambert W function and it says "Maple this" and "Maple that".  Let's get this into Sage and stay competitive with the M's!  ;-)

Rob, in cheerleader mode



---

archive/issue_comments_132839.json:
```json
{
    "body": "removed trailing whitespace",
    "created_at": "2012-05-18T04:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132839",
    "user": "benjaminfjones"
}
```

removed trailing whitespace



---

archive/issue_comments_132840.json:
```json
{
    "body": "Attachment [trac_11888_v7.2.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v7.2.patch) by benjaminfjones created at 2012-05-18 04:41:27\n\nI agree! In that spirit, here is a rebase of the patch for Sage-5.0.",
    "created_at": "2012-05-18T04:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132840",
    "user": "benjaminfjones"
}
```

Attachment [trac_11888_v7.2.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v7.2.patch) by benjaminfjones created at 2012-05-18 04:41:27

I agree! In that spirit, here is a rebase of the patch for Sage-5.0.



---

archive/issue_comments_132841.json:
```json
{
    "body": "this ticket is pointed out on the SD40.5 wiki page. Is there any particular thing one should review?\n\nPaul",
    "created_at": "2012-05-25T09:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132841",
    "user": "zimmerma"
}
```

this ticket is pointed out on the SD40.5 wiki page. Is there any particular thing one should review?

Paul



---

archive/issue_comments_132842.json:
```json
{
    "body": "It looks like a few principle/principal mixups made it through.",
    "created_at": "2012-05-25T12:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132842",
    "user": "dsm"
}
```

It looks like a few principle/principal mixups made it through.



---

archive/issue_comments_132843.json:
```json
{
    "body": "> this ticket is pointed out on the SD40.5 wiki page. Is there any particular thing one should review?\nI think that just checking everything still works and that syntax is proper (and spelling, thanks dsm) is good.  Checking some random values against another program would be helpful, especially for the branches.  Making sure documentation builds and looks good.  But this has been looked at by a lot of eyes, so I don't think it needs to be gone over completely from scratch, especially since I think Ben has doctested a lot of the issues raised in previous comments (which are worth scanning).",
    "created_at": "2012-05-25T13:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132843",
    "user": "kcrisman"
}
```

> this ticket is pointed out on the SD40.5 wiki page. Is there any particular thing one should review?
I think that just checking everything still works and that syntax is proper (and spelling, thanks dsm) is good.  Checking some random values against another program would be helpful, especially for the branches.  Making sure documentation builds and looks good.  But this has been looked at by a lot of eyes, so I don't think it needs to be gone over completely from scratch, especially since I think Ben has doctested a lot of the issues raised in previous comments (which are worth scanning).



---

archive/issue_comments_132844.json:
```json
{
    "body": "Changing keywords from \"lambert_w symbolics conversion maxima sd35.5\" to \"lambert_w symbolics conversion maxima sd35.5 sd40.5\".",
    "created_at": "2012-05-25T18:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132844",
    "user": "benjaminfjones"
}
```

Changing keywords from "lambert_w symbolics conversion maxima sd35.5" to "lambert_w symbolics conversion maxima sd35.5 sd40.5".



---

archive/issue_comments_132845.json:
```json
{
    "body": "I can make a quick spelling fix patch, but I'll wait and see if anyone else has changes to suggest.",
    "created_at": "2012-05-25T18:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132845",
    "user": "benjaminfjones"
}
```

I can make a quick spelling fix patch, but I'll wait and see if anyone else has changes to suggest.



---

archive/issue_comments_132846.json:
```json
{
    "body": "After some real-world discussions, I'd prefer to avoid falling into Python ints for (some of) the special values:\n\n\n```\nsage: parent(lambert_w(0))\nInteger Ring\nsage: parent(lambert_w(e))\n<type 'int'>\nsage: parent(lambert_w(-1/e))\n<type 'int'>\nsage: parent(lambert_w(SR(-1/e)))\n<type 'int'>\nsage: parent(lambert_w(SR(0)))\nInteger Ring\n```\n\n\nMysteriously enough, instrumenting it reveals that `_eval_` is actually returning SR(1) which then in some part of the code I don't understand becomes int(1) before we get it back.  If we explicitly return Integer(1) then it seems to stay as Integer(1).  This isn't the biggest deal in the world but there have been several bug reports caused by something falling out of Sagespace into Pythonspace.",
    "created_at": "2012-05-26T07:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132846",
    "user": "dsm"
}
```

After some real-world discussions, I'd prefer to avoid falling into Python ints for (some of) the special values:


```
sage: parent(lambert_w(0))
Integer Ring
sage: parent(lambert_w(e))
<type 'int'>
sage: parent(lambert_w(-1/e))
<type 'int'>
sage: parent(lambert_w(SR(-1/e)))
<type 'int'>
sage: parent(lambert_w(SR(0)))
Integer Ring
```


Mysteriously enough, instrumenting it reveals that `_eval_` is actually returning SR(1) which then in some part of the code I don't understand becomes int(1) before we get it back.  If we explicitly return Integer(1) then it seems to stay as Integer(1).  This isn't the biggest deal in the world but there have been several bug reports caused by something falling out of Sagespace into Pythonspace.



---

archive/issue_comments_132847.json:
```json
{
    "body": "It looks like whatever happens after _eval_ might \"dereference\" the SR; the call seems to give Integer(1) if _eval_ returns SR(Integer(1)).  Probably someone who actually knows what's going on could explain it in one line.",
    "created_at": "2012-05-26T20:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132847",
    "user": "dsm"
}
```

It looks like whatever happens after _eval_ might "dereference" the SR; the call seems to give Integer(1) if _eval_ returns SR(Integer(1)).  Probably someone who actually knows what's going on could explain it in one line.



---

archive/issue_comments_132848.json:
```json
{
    "body": "One solution is to change the return statements in these special cases where the automatic simplification returns an integer to just explicitly return `Integer(1)`, etc..\n\nHow does that sound?",
    "created_at": "2012-05-27T06:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132848",
    "user": "benjaminfjones"
}
```

One solution is to change the return statements in these special cases where the automatic simplification returns an integer to just explicitly return `Integer(1)`, etc..

How does that sound?



---

archive/issue_comments_132849.json:
```json
{
    "body": "New patch is ready for review. I hope this can be the final revision! \n\nPatchbot: apply [This is the Trac macro *attachment:trac_11888_v8.patch* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#attachment:trac_11888_v8.patch-macro) to $SAGE_ROOT/devel/sage",
    "created_at": "2012-05-27T18:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132849",
    "user": "benjaminfjones"
}
```

New patch is ready for review. I hope this can be the final revision! 

Patchbot: apply [This is the Trac macro *attachment:trac_11888_v8.patch* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#attachment:trac_11888_v8.patch-macro) to $SAGE_ROOT/devel/sage



---

archive/issue_comments_132850.json:
```json
{
    "body": "Looking at it now.",
    "created_at": "2012-05-27T20:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132850",
    "user": "dsm"
}
```

Looking at it now.



---

archive/issue_comments_132851.json:
```json
{
    "body": "fixed spelling / grammer mistakes, returned parent(Integer(...)) for special values",
    "created_at": "2012-05-27T20:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132851",
    "user": "benjaminfjones"
}
```

fixed spelling / grammer mistakes, returned parent(Integer(...)) for special values



---

archive/issue_comments_132852.json:
```json
{
    "body": "Attachment [trac_11888_v8.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v8.patch) by dsm created at 2012-05-27 21:18:05\n\nOkay, this looks good.  Two copyedits, an extra doc describing the behaviours of the derivative function, some tests making sure we can't differentiate with respect to the branch number, and the addition of lambert_W(-pi/2) = pi/2*I as a special value.\n\nI give positive review to the preexisting parts of v8; if the new bits of v9 look okay I think we're good to go.",
    "created_at": "2012-05-27T21:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132852",
    "user": "dsm"
}
```

Attachment [trac_11888_v8.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v8.patch) by dsm created at 2012-05-27 21:18:05

Okay, this looks good.  Two copyedits, an extra doc describing the behaviours of the derivative function, some tests making sure we can't differentiate with respect to the branch number, and the addition of lambert_W(-pi/2) = pi/2*I as a special value.

I give positive review to the preexisting parts of v8; if the new bits of v9 look okay I think we're good to go.



---

archive/issue_comments_132853.json:
```json
{
    "body": "Attachment [trac_11888_v9.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v9.patch) by dsm created at 2012-05-27 21:18:55\n\npost-review version of lambertw sf",
    "created_at": "2012-05-27T21:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132853",
    "user": "dsm"
}
```

Attachment [trac_11888_v9.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v9.patch) by dsm created at 2012-05-27 21:18:55

post-review version of lambertw sf



---

archive/issue_comments_132854.json:
```json
{
    "body": "New changes look good; good catch about the derivative w.r.t. branch. All relavent tests pass for me on sage-5.0. I would say this is ready to go in! Thanks for the very thorough review, Doug.",
    "created_at": "2012-05-27T22:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132854",
    "user": "benjaminfjones"
}
```

New changes look good; good catch about the derivative w.r.t. branch. All relavent tests pass for me on sage-5.0. I would say this is ready to go in! Thanks for the very thorough review, Doug.



---

archive/issue_comments_132855.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-27T22:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132855",
    "user": "dsm"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132856.json:
```json
{
    "body": "+1.  Tx for the work!",
    "created_at": "2012-05-27T22:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132856",
    "user": "dsm"
}
```

+1.  Tx for the work!



---

archive/issue_comments_132857.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-27T22:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132857",
    "user": "was"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_132858.json:
```json
{
    "body": "This patch is awesome!  It's also a great example of how to make a well-documented new symbolic function that illustrates many issues. Here are a few trivial nitpicks:\n\n* What is \"simplication\"?\n\n```\nWhen automatic simplication occurs, the parent of the output value should be \n```\n\n\n* This docstring should start with r\" since it contains a backslash:\n\n```\n        646\t        \"\"\" \n \t647\t        The derivative of `W_n(x)` is `W_n(x)/(x \\cdot W_n(x) + x)`. \n```\n\n(check for similar instances throughout).\n\n* Don't use periods at the end of exceptions (also don't capitalize).  Many instances of this being wrong, e.g., \n\n```\n \t679\t            raise ValueError(\"Derivative not defined with respect to the branch number.\") \n```\n\nHere's a good example of what an exception string should look like (built into python):\n\n```\n>>> 1/0\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nZeroDivisionError: integer division or modulo by zero\n```\n",
    "created_at": "2012-05-27T22:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132858",
    "user": "was"
}
```

This patch is awesome!  It's also a great example of how to make a well-documented new symbolic function that illustrates many issues. Here are a few trivial nitpicks:

* What is "simplication"?

```
When automatic simplication occurs, the parent of the output value should be 
```


* This docstring should start with r" since it contains a backslash:

```
        646	        """ 
 	647	        The derivative of `W_n(x)` is `W_n(x)/(x \cdot W_n(x) + x)`. 
```

(check for similar instances throughout).

* Don't use periods at the end of exceptions (also don't capitalize).  Many instances of this being wrong, e.g., 

```
 	679	            raise ValueError("Derivative not defined with respect to the branch number.") 
```

Here's a good example of what an exception string should look like (built into python):

```
>>> 1/0
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: integer division or modulo by zero
```




---

archive/issue_comments_132859.json:
```json
{
    "body": "Updated version taking into account comments of was.",
    "created_at": "2012-05-27T22:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132859",
    "user": "dsm"
}
```

Updated version taking into account comments of was.



---

archive/issue_comments_132860.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-27T22:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132860",
    "user": "dsm"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132861.json:
```json
{
    "body": "minor edits",
    "created_at": "2012-05-27T22:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132861",
    "user": "dsm"
}
```

minor edits



---

archive/issue_comments_132862.json:
```json
{
    "body": "Attachment [trac_11888_v10.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v10.patch) by was created at 2012-05-27 22:49:43",
    "created_at": "2012-05-27T22:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132862",
    "user": "was"
}
```

Attachment [trac_11888_v10.patch](tarball://root/attachments/some-uuid/ticket11888/trac_11888_v10.patch) by was created at 2012-05-27 22:49:43



---

archive/issue_comments_132863.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-27T22:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132863",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132864.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-14T06:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11716#issuecomment-132864",
    "user": "jdemeyer"
}
```

Resolution: fixed
