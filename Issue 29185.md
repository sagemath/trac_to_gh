# Issue 29185: DiFUB diameter

Issue created by migration from https://trac.sagemath.org/ticket/29422

Original creator: @ArchitWagle

Original creation time: 2020-03-27 23:15:45

CC:  dcoudert




---

Comment by @ArchitWagle created at 2020-03-27 23:34:22

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @ArchitWagle created at 2020-03-27 23:34:22

Changing component from PLEASE CHANGE to graph theory.


---

Comment by @ArchitWagle created at 2020-03-27 23:34:22

Changing keywords from "" to "gsoc, diameter,DiFUB".


---

Comment by @ArchitWagle created at 2020-03-27 23:34:22

Changing status from new to needs_review.


---

Comment by @vipul79321 created at 2020-03-28 16:34:08

Please note that I have implemented `2dsweep` algorithm for lower bound on diameter computation of unweighted directed graph in ticket #29351(positive reviewed), which might be useful for you. You can have a look at it and hopefully use it here to avoid any merge conflict.\\
Regards\\
Vipul


---

Comment by @ArchitWagle created at 2020-03-28 17:26:39

Replying to [comment:3 gh-vipul79321]:
> Please note that I have implemented `2dsweep` algorithm for lower bound on diameter computation of unweighted directed graph in ticket #29351(positive reviewed), which might be useful for you. You can have a look at it and hopefully use it here to avoid any merge conflict.\\
> Regards\\
> Vipul

Sure, The implementation of 2dsweep at #29351 is cleaner. I will use it over here.
Regards,
Madhav Wagle


---

Comment by git created at 2020-03-28 20:45:48

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @puzzleweaver created at 2020-03-29 20:58:14

The code functionality, formatting, and test cases look good.

However, building the documentation using the command:


```
 ./sage --docbuild 'reference/graphs' html
```


returns that the citations [Broder2000] and [CGLM2014] are not found.


---

Comment by @puzzleweaver created at 2020-03-29 20:58:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-03-29 21:38:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-03-31 11:12:39

When adding references, you sometimes have to `make doc-clean` and rebuild all the full documentation.

If I understand well, you have rebased the ticket on #28351, right ? If so, you must add the dependency in the appropriate field.

Please use the memory allocator, as is done in 2Dsweep. This way, allocated arrays will be freed before returning the result. You also have to ensure that you free the bit sets.

Instead of `tmp = max([simple_BFS(g, j, distances, NULL, waiting_list, seen) for j in Bb[i]])`, you should make a for loop to stop iteration if the diameter is proved.

More generally, I don't understand why you use `Bf` and `Bb`. The waiting list gives you the order of the vertices. The last vertex in waiting list is at largest distance from the source. So you have to iterate from last to first vertex.


---

Comment by @ArchitWagle created at 2020-03-31 21:23:58

Replying to [comment:8 dcoudert]:

> If I understand well, you have rebased the ticket on #28351, right ? If so, you must add the dependency in the appropriate field.
> 
> Please use the memory allocator, as is done in 2Dsweep. This way, allocated arrays will be freed before returning the result. You also have to ensure that you free the bit sets.
> 
\\
Sure, I will make all the above changes \\ 
\\

> Instead of `tmp = max([simple_BFS(g, j, distances, NULL, waiting_list, seen) for j in Bb[i]])`, you should make a for loop to stop iteration if the diameter is proved.
> 
> More generally, I don't understand why you use `Bf` and `Bb`. The waiting list gives you the order of the vertices. The last vertex in waiting list is at largest distance from the source. So you have to iterate from last to first vertex.
> 
\\
I did the stuff with the `Bf` and `Bb` for my implementation to resemble the pseudo code mentioned in  https://courses.cs.ut.ee/MTAT.03.238/2014_fall/uploads/Main/diameter.pdf. 
\\
But I will try to do it using the reversed waiting list, since that would also be consistent with the existing undirected iFUB implementation in sage.

\\ Thanks for the suggestions,\\
Madhav


---

Comment by @ArchitWagle created at 2020-04-01 15:02:38

Replying to [comment:8 dcoudert]:
> 
> Instead of `tmp = max([simple_BFS(g, j, distances, NULL, waiting_list, seen) for j in Bb[i]])`, you should make a for loop to stop iteration if the diameter is proved.
> 
But the 

> More generally, I don't understand why you use `Bf` and `Bb`. The waiting list gives you the order of the vertices. The last vertex in waiting list is at largest distance from the source. So you have to iterate from last to first vertex.
> 
\\
I tried it using just the waiting list only


```
    eccb_m = simple_BFS(g_rev, m, layer_1, NULL, waiting_list, seen)
    for i in range(n):
        order_1[i] = waiting_list[n - i - 1]
        

    eccf_m = simple_BFS(g, m, layer_2, NULL, waiting_list, seen)
    for i in range(n):
        order_2[i] = waiting_list[n - i - 1]

    i = 0
    LB = max(LB,eccf_m,eccb_m)
    
    while(layer_1[order_1[i]]+layer_2[order_2[i]] > LB and i<n ):
        tmp =  simple_BFS(g, order_1[i], distances, NULL, waiting_list, seen)
        tmp_1=  simple_BFS(g_rev, order_2[i], distances, NULL, waiting_list, seen)
        i+=1
        LB = max(tmp,tmp_1,LB)        
```


And although the above code is giving correct answers, there is a degradation in performance compared to my previous approach(more bfs calls on an average).

regards, \\
Madhav


---

Comment by dcoudert created at 2020-04-02 08:45:49

The "error" is that you do BFS from vertices that may be at different forward/backward distances from m. That's the interest of using Bf and Bb. However, an alternative is to do something like that (not completely sure of the bounds).

```
d = max(eccb_m, eccf_m)
i1 = 0
i2 = 0
while (layer_1[order_1[i1]]+layer_2[order_2[i2]] > LB and d > 0):
    if ib < n and layer_1[order_1[i1]] >= d:
        LB = max(LB, simple_BFS(g, order_1[i1], distances, NULL, waiting_list, seen))
        i1 += 1
    if i2 < n and layer_1[order_2[i2]] >= d:
        LB = max(LB, simple_BFS(g, order_2[i2], distances, NULL, waiting_list, seen))
        i2 += 1
    if ib < n and layer_1[order_1[i1]] < d and  i2 < n and layer_1[order_2[i2]] < d:
        d -= 1
```



---

Comment by @ArchitWagle created at 2020-04-02 09:37:02

Replying to [comment:12 dcoudert]:
> The "error" is that you do BFS from vertices that may be at different forward/backward distances from m. That's the interest of using Bf and Bb. However, an alternative is to do something like that (not completely sure of the bounds).
> {{{
> d = max(eccb_m, eccf_m)
> i1 = 0
> i2 = 0
> while (layer_1[order_1[i1]]+layer_2[order_2[i2]] > LB and d > 0):
>     if ib < n and layer_1[order_1[i1]] >= d:
>         LB = max(LB, simple_BFS(g, order_1[i1], distances, NULL, waiting_list, seen))
>         i1 += 1
>     if i2 < n and layer_1[order_2[i2]] >= d:
>         LB = max(LB, simple_BFS(g, order_2[i2], distances, NULL, waiting_list, seen))
>         i2 += 1
>     if ib < n and layer_1[order_1[i1]] < d and  i2 < n and layer_1[order_2[i2]] < d:
>         d -= 1
> }}}

Oh ok, I will try the level wise approach without the Bf, Bb then.
regards,
Madhav Wagle


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by @vipul79321 created at 2020-06-27 06:51:03

Changing keywords from "gsoc, diameter,DiFUB" to "gsoc2020".


---

Comment by @vipul79321 created at 2020-06-27 06:51:03

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-06-27 06:51:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-06-27 06:54:36

I have added DiFUB method for unweighted Directed graphs.

I am kind of uncertain about algorithm's description in code's comments. Please have a look at it.

Any suggestion will be helpful :)


---

Comment by git created at 2020-06-27 12:05:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-06-27 12:13:04

It remains to expose the algorithm in `digraph.py` and do some tests to ensure that nothing is forgotten.


---

Comment by @vipul79321 created at 2020-06-29 07:12:48

Replying to [comment:19 dcoudert]:
> It remains to expose the algorithm in `digraph.py` and do some tests to ensure that nothing is forgotten.

shall we work on its weighted version too, it will also require weighted version of 2Dsweep?


---

Comment by dcoudert created at 2020-06-29 07:48:23

The weighted version can be done in another ticket.

The patchbot reports a small issue. Please check.


---

Comment by git created at 2020-06-30 08:00:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-06-30 08:02:01

Replying to [comment:21 dcoudert]:
> The weighted version can be done in another ticket.
ok
> 
> The patchbot reports a small issue. Please check.
Done


---

Comment by dcoudert created at 2020-06-30 08:35:21

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-06-30 08:35:21

LGTM.


---

Comment by git created at 2020-07-06 17:13:23

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2020-07-06 17:13:23

Changing status from positive_review to needs_review.


---

Comment by @vipul79321 created at 2020-07-06 17:15:07

Replying to [comment:25 git]:
> Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
> ||[ed9e424](https://git.sagemath.org/sage.git/commit/?id=ed9e4241760f8a8c636593523e372e4f4907e7b6)||`patchbot issue fixed`||

Fixed minor issue.


---

Comment by dcoudert created at 2020-07-07 08:16:44

LGTM


---

Comment by dcoudert created at 2020-07-07 08:16:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-07-10 19:34:21

Resolution: fixed


---

Comment by @ArchitWagle created at 2021-03-13 05:05:41

Corrected my name :)
