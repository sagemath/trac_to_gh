# Issue 17000: Consistent complex arguments for log integral

Issue created by migration from https://trac.sagemath.org/ticket/17237

Original creator: kcrisman

Original creation time: 2014-10-27 18:29:51

CC:  fredrik.johansson

At [this ask.sagemath question](http://ask.sagemath.org/question/24630/log_integral-gives-wrong-values-for-complex-arguments/) it comes to our attention that `Li(x)` and `Ei(log(x))` don't always agree, though apparently `Ei(log(x))` currently gives what one wants on the critical strip for the Riemann zeta function.  mpmath apparently doesn't really choose "smart" branch cuts for `Ei` internally, or maybe it's the log integral that doesn't ... anyway, we need consistency here more than anything else, though having it agree with the usual stuff on the critical line would be nice.


---

Comment by kcrisman created at 2014-10-28 12:37:50

Some thoughts from FJ:
> Here is a possible solution that seems to work off the real line (but
> I haven't checked all corner cases). You can basically write the
> asymptotic expansion of li as a 2F0 plus an ugly branch correction
> term (http://functions.wolfram.com/GammaBetaErf/LogIntegral/06/02/0003/).
> Removing most of the ugly branch correction term should do the trick.
> The 2F0 diverges, but mpmath can normalize it.

```
def li1(z):
    return quad(lambda t: 1/ln(t), [2, z]) + li(2)

def li2(z):
    return z * hyp2f0(1,1,1/log(z))/log(z) + pi * sign(im(z)) * 1j
```

> The outputs seem to agree:

```
mp.dps = 30

for n in range(30):
    z=30*(rand()-0.5)+30*(rand()-0.5)*1j
    print z, chop(li1(z) - li2(z))
```

> (You get some large differences, but they appear to be due to the
> numerical integration.)
> I don't think this is the best way to compute the function, but it
> might be *a* way. It needs to be checked to make sure it's actually
> correct, of course.


---

Comment by kcrisman created at 2014-10-28 12:38:41

As another thought, perhaps at least updating documentation to talk about what to expect and when to use the other branch stuff might be useful...
