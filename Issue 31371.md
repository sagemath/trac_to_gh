# Issue 31371: Eliminate pynac's handle_factor method

Issue created by migration from https://trac.sagemath.org/ticket/31608

Original creator: @DaveWitteMorris

Original creation time: 2021-04-05 00:24:09

Keywords: pynac, refactoring

After #31554, the `handle_factor` method will be used in only 3 places in the pynac source code:

```
expairseq.cpp:994:  ex newfactor = mf.handle_factor(elem, _ex1);
expairseq.cpp:1003: ex newfactor = mf.handle_factor(elem, _ex1);
expairseq.cpp:1049: combine_overall_coeff(ex_to<numeric>(mf.handle_factor(elem.rest, _ex1)));
```

It is completely unnecessary in those places, because `handle_factor(x, 1)` is equal to `x`.  So we should refactor the code to get rid of it (and the class `make_flat_inserter` that contains it).

Here is the definition:

```
class make_flat_inserter
{
	public:
		make_flat_inserter(const epvector &epv, bool b)
		{}
		make_flat_inserter(const exvector &v, bool b)
                {}
		ex handle_factor(const ex &x, const ex &coeff)
		{
			if (is_exactly_a<numeric>(coeff) and coeff.is_zero())
				return coeff;
		        return x;
		}
};
```




---

Comment by chapoton created at 2022-02-18 17:23:33

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-02-18 17:23:33

tentative commit
----
New commits:


---

Comment by chapoton created at 2022-02-22 08:07:33

seems to go smoothly..


---

Comment by mkoeppe created at 2022-02-23 00:45:45

Upstream has slightly more substantial code there https://www.ginac.de/ginac.git/?p=ginac.git;a=blob;f=ginac/expairseq.h;h=0618e2d777e8ecc29876f643bbe262425486d903;hb=HEAD


---

Comment by mkoeppe created at 2022-04-01 21:20:45

Changing status from needs_review to needs_info.
