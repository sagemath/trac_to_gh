# Issue 25405: wrong cardinality in PartitionDiagrams

archive/issues_025405.json:
```json
{
    "body": "CC:  @alauve @tscrim @zabrocki\n\nThere is a simple bug and a strange behaviour:\n\n\n```\nsage: import sage.combinat.diagram_algebras as da\nsage: pd = da.PartitionDiagrams(2.5)\nsage: pd.cardinality()\n15\nsage: len(list(pd))\n52\nsage: pd.cardinality()\n15\nsage: len(pd.list())\n52\nsage: pd.cardinality()\n52\n```\n\n\nThe implementation of `PartitionDiagrams.cardinality` is a trivial mistake, and easy to fix.  It currently reads:\n\n```\n        if self.order in ZZ:\n            return bell_number(2*self.order)\n        return bell_number(2*(self.order-1/2))\n```\n\nbut should be\n\n```\n        return bell_number(2*self.order)\n```\n\n\nHowever, I do not understand why, after invoking `PartitionDiagrams(2.5).list()`, the method from `finite_enumerated_sets` is used, and I do not understand why this is not the case when invoking `list(PartitionDiagrams(2.5))`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25642\n\n",
    "created_at": "2018-06-23T17:31:17Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "wrong cardinality in PartitionDiagrams",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25405",
    "user": "@mantepse"
}
```
CC:  @alauve @tscrim @zabrocki

There is a simple bug and a strange behaviour:


```
sage: import sage.combinat.diagram_algebras as da
sage: pd = da.PartitionDiagrams(2.5)
sage: pd.cardinality()
15
sage: len(list(pd))
52
sage: pd.cardinality()
15
sage: len(pd.list())
52
sage: pd.cardinality()
52
```


The implementation of `PartitionDiagrams.cardinality` is a trivial mistake, and easy to fix.  It currently reads:

```
        if self.order in ZZ:
            return bell_number(2*self.order)
        return bell_number(2*(self.order-1/2))
```

but should be

```
        return bell_number(2*self.order)
```


However, I do not understand why, after invoking `PartitionDiagrams(2.5).list()`, the method from `finite_enumerated_sets` is used, and I do not understand why this is not the case when invoking `list(PartitionDiagrams(2.5))`.

Issue created by migration from https://trac.sagemath.org/ticket/25642





---

archive/issue_comments_358246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-23T21:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358246",
    "user": "@mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_358247.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-23T21:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358247",
    "user": "@mantepse"
}
```

New commits:



---

archive/issue_comments_358248.json:
```json
{
    "body": "I do not know whether the strange behaviour observed in the description is something that needs fixing, nor how to do it, if so...",
    "created_at": "2018-06-23T21:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358248",
    "user": "@mantepse"
}
```

I do not know whether the strange behaviour observed in the description is something that needs fixing, nor how to do it, if so...



---

archive/issue_comments_358249.json:
```json
{
    "body": "Why does this depend on #25462?\n\n`list(foo)` calls the iterator first before `foo.list()`, so it does not set `cardinality` to `_cardinality_from_list`. This is the correct behavior and nothing strange about it. If there was no bug, you would never notice the difference.",
    "created_at": "2018-06-24T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358249",
    "user": "@tscrim"
}
```

Why does this depend on #25462?

`list(foo)` calls the iterator first before `foo.list()`, so it does not set `cardinality` to `_cardinality_from_list`. This is the correct behavior and nothing strange about it. If there was no bug, you would never notice the difference.



---

archive/issue_comments_358250.json:
```json
{
    "body": "I'm getting doctest failures on lines 1229 and 1587 because of the order of the output.",
    "created_at": "2018-06-24T16:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358250",
    "user": "@zabrocki"
}
```

I'm getting doctest failures on lines 1229 and 1587 because of the order of the output.



---

archive/issue_comments_358251.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> Why does this depend on #25462?\n\nBecause after #25462 the output order changes, and there is no point in changing the doctests twice.  But if you wish, I can do this, too.\n\n> `list(foo)` calls the iterator first before `foo.list()`, so it does not set `cardinality` to `_cardinality_from_list`. This is the correct behavior and nothing strange about it. If there was no bug, you would never notice the difference.\n\nOK, great!",
    "created_at": "2018-06-24T19:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358251",
    "user": "@mantepse"
}
```

Replying to [comment:4 tscrim]:
> Why does this depend on #25462?

Because after #25462 the output order changes, and there is no point in changing the doctests twice.  But if you wish, I can do this, too.

> `list(foo)` calls the iterator first before `foo.list()`, so it does not set `cardinality` to `_cardinality_from_list`. This is the correct behavior and nothing strange about it. If there was no bug, you would never notice the difference.

OK, great!



---

archive/issue_comments_358252.json:
```json
{
    "body": "Replying to [comment:5 zabrocki]:\n> I'm getting doctest failures on lines 1229 and 1587 because of the order of the output.\n\nYes, I do not know how to make this properly depend on #25462.  If you do pull in #25462, the output order will be correct.",
    "created_at": "2018-06-24T19:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358252",
    "user": "@mantepse"
}
```

Replying to [comment:5 zabrocki]:
> I'm getting doctest failures on lines 1229 and 1587 because of the order of the output.

Yes, I do not know how to make this properly depend on #25462.  If you do pull in #25462, the output order will be correct.



---

archive/issue_comments_358253.json:
```json
{
    "body": "I noticed this problem in the tests on Python 3, where the problem becomes more pronounced due to slightly different code paths covered by the tests.",
    "created_at": "2018-08-13T09:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358253",
    "user": "@embray"
}
```

I noticed this problem in the tests on Python 3, where the problem becomes more pronounced due to slightly different code paths covered by the tests.



---

archive/issue_comments_358254.json:
```json
{
    "body": "Since this depends on #25462, I'll rebase your branch on top of it.  The rest looks like it makes sense to me.",
    "created_at": "2018-08-13T09:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358254",
    "user": "@embray"
}
```

Since this depends on #25462, I'll rebase your branch on top of it.  The rest looks like it makes sense to me.



---

archive/issue_comments_358255.json:
```json
{
    "body": "I rebased this on top of #25462, but I still had to update a couple of the doctests.\n----\nLast 10 new commits:",
    "created_at": "2018-08-13T10:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358255",
    "user": "@embray"
}
```

I rebased this on top of #25462, but I still had to update a couple of the doctests.
----
Last 10 new commits:



---

archive/issue_comments_358256.json:
```json
{
    "body": "Warning: please note also #25662... (are you touching `contains`?)",
    "created_at": "2018-08-13T10:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358256",
    "user": "@mantepse"
}
```

Warning: please note also #25662... (are you touching `contains`?)



---

archive/issue_comments_358257.json:
```json
{
    "body": "Martin, you were the one who tweaked the `__contains__`.\n\nSomething closer to bikeshedding, but I would want changed before a positive review is splitting the lines for the `NotImplementedError` messages (to ~80 char/line) and making them more concise:\n\n```diff\n-            raise NotImplementedError(\"from_involution_permutation_triple is only implemented for Brauer diagrams of integer order, not for order %s\" %(self.order))\n+            raise NotImplementedError(\"only implemented for integer order,\"\n+                                      \" not for order %s\" % (self.order))\n```\n\nand same for `symmetric_diagrams`. Similar for the output in the doctests.",
    "created_at": "2018-08-13T10:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358257",
    "user": "@tscrim"
}
```

Martin, you were the one who tweaked the `__contains__`.

Something closer to bikeshedding, but I would want changed before a positive review is splitting the lines for the `NotImplementedError` messages (to ~80 char/line) and making them more concise:

```diff
-            raise NotImplementedError("from_involution_permutation_triple is only implemented for Brauer diagrams of integer order, not for order %s" %(self.order))
+            raise NotImplementedError("only implemented for integer order,"
+                                      " not for order %s" % (self.order))
```

and same for `symmetric_diagrams`. Similar for the output in the doctests.



---

archive/issue_comments_358258.json:
```json
{
    "body": "I'm a little confused--should this also be tweaked to merge cleanly with #25662?",
    "created_at": "2018-08-13T11:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358258",
    "user": "@embray"
}
```

I'm a little confused--should this also be tweaked to merge cleanly with #25662?



---

archive/issue_comments_358259.json:
```json
{
    "body": "Replying to [comment:14 embray]:\n> I'm a little confused--should this also be tweaked to merge cleanly with #25662?\n\nNo, if I recall correctly, I made this ticket a dependency of #25662.  So this ticket should go in first, then #25659 (which is independent of this ticket), and finally #25662.\n----\nNew commits:",
    "created_at": "2018-08-13T11:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358259",
    "user": "@mantepse"
}
```

Replying to [comment:14 embray]:
> I'm a little confused--should this also be tweaked to merge cleanly with #25662?

No, if I recall correctly, I made this ticket a dependency of #25662.  So this ticket should go in first, then #25659 (which is independent of this ticket), and finally #25662.
----
New commits:



---

archive/issue_comments_358260.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-08-13T12:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358260",
    "user": "@tscrim"
}
```

Thank you.



---

archive/issue_comments_358261.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-13T12:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358261",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_358262.json:
```json
{
    "body": "Wow, that was quick!",
    "created_at": "2018-08-13T12:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358262",
    "user": "@mantepse"
}
```

Wow, that was quick!



---

archive/issue_comments_358263.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-17T21:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25405",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25405#issuecomment-358263",
    "user": "@vbraun"
}
```

Resolution: fixed
