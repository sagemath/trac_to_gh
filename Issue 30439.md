# Issue 30439: Follow up to #30563 too many quotes in maxima.py

archive/issues_030439.json:
```json
{
    "body": "CC:  strogdon\n\nIn #30563 one particular setting of `MAXIMA` used in sage-on-gentoo (`maximax -l ecl`) was extensively tested when applied to `bin/sage`. It unfortunately hadn't been so thoroughly tested in `interfaces/maxima.py`.\n\nThe `__init__` method in `maxima.py` quote the variable `MAXIMA` when building the command for `pexpect`\n\n```\n                        command = '\"{0}\" -p \"{1}\"'.format(MAXIMA, STARTUP),\n```\n\nthis leads the whole expression `maxima -l ecl`, with spaces, to be considered a command by pexpect. Removing the double quotes fix the problem and doesn't introduce any issue with more conventional values of `MAXIMA`.\n \n\nIssue created by migration from https://trac.sagemath.org/ticket/30676\n\n",
    "created_at": "2020-09-28T06:19:53Z",
    "labels": [
        "interfaces",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Follow up to #30563 too many quotes in maxima.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30439",
    "user": "fbissey"
}
```
CC:  strogdon

In #30563 one particular setting of `MAXIMA` used in sage-on-gentoo (`maximax -l ecl`) was extensively tested when applied to `bin/sage`. It unfortunately hadn't been so thoroughly tested in `interfaces/maxima.py`.

The `__init__` method in `maxima.py` quote the variable `MAXIMA` when building the command for `pexpect`

```
                        command = '"{0}" -p "{1}"'.format(MAXIMA, STARTUP),
```

this leads the whole expression `maxima -l ecl`, with spaces, to be considered a command by pexpect. Removing the double quotes fix the problem and doesn't introduce any issue with more conventional values of `MAXIMA`.
 

Issue created by migration from https://trac.sagemath.org/ticket/30676





---

archive/issue_comments_434280.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-28T06:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434280",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434281.json:
```json
{
    "body": "`@`strogdon, you may have seen that issue.\n----\nNew commits:",
    "created_at": "2020-09-28T06:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434281",
    "user": "fbissey"
}
```

`@`strogdon, you may have seen that issue.
----
New commits:



---

archive/issue_comments_434282.json:
```json
{
    "body": "`STARTUP` should probably be quoted in case the directory contains whitespace.",
    "created_at": "2020-09-28T19:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434282",
    "user": "mkoeppe"
}
```

`STARTUP` should probably be quoted in case the directory contains whitespace.



---

archive/issue_comments_434283.json:
```json
{
    "body": "OK, I guess someone would have complained already if putting double quote there broke things.\n\nI'll add that in fact sage-on-broken was potentially broken if you had maxima with sbcl and ecl installed - from the day `interfaces/maxima.py` started to use `MAXIMA`. So those improvements were really needed.",
    "created_at": "2020-09-28T20:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434283",
    "user": "fbissey"
}
```

OK, I guess someone would have complained already if putting double quote there broke things.

I'll add that in fact sage-on-broken was potentially broken if you had maxima with sbcl and ecl installed - from the day `interfaces/maxima.py` started to use `MAXIMA`. So those improvements were really needed.



---

archive/issue_comments_434284.json:
```json
{
    "body": "Hum, then it may break things if `MAXIMA` is a path with spaces in it. A situation which could be common on windows.",
    "created_at": "2020-09-28T20:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434284",
    "user": "fbissey"
}
```

Hum, then it may break things if `MAXIMA` is a path with spaces in it. A situation which could be common on windows.



---

archive/issue_comments_434285.json:
```json
{
    "body": "#30563 would already cause trouble if `MAXIMA` is a path with spaces in it because I didn't double quote in that ticket either. Which may mean no bots has that kind of configuration.",
    "created_at": "2020-09-28T20:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434285",
    "user": "fbissey"
}
```

#30563 would already cause trouble if `MAXIMA` is a path with spaces in it because I didn't double quote in that ticket either. Which may mean no bots has that kind of configuration.



---

archive/issue_comments_434286.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-28T20:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434286",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_434287.json:
```json
{
    "body": "If there are complaints I have a plan B.",
    "created_at": "2020-09-28T20:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434287",
    "user": "fbissey"
}
```

If there are complaints I have a plan B.



---

archive/issue_comments_434288.json:
```json
{
    "body": "Well, since `MAXIMA` is used as the beginning of a shell command line (this could be documented...), one would be able to use shell quoting within the value of this variable.",
    "created_at": "2020-09-28T20:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434288",
    "user": "mkoeppe"
}
```

Well, since `MAXIMA` is used as the beginning of a shell command line (this could be documented...), one would be able to use shell quoting within the value of this variable.



---

archive/issue_comments_434289.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Well, since `MAXIMA` is used as the beginning of a shell command line (this could be documented...), one would be able to use shell quoting within the value of this variable.\n\nCan you give a concrete example of your line of thought there? I am not completely sure of what your idea is and how to put it in practice.",
    "created_at": "2020-09-28T20:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434289",
    "user": "fbissey"
}
```

Replying to [comment:8 mkoeppe]:
> Well, since `MAXIMA` is used as the beginning of a shell command line (this could be documented...), one would be able to use shell quoting within the value of this variable.

Can you give a concrete example of your line of thought there? I am not completely sure of what your idea is and how to put it in practice.



---

archive/issue_comments_434290.json:
```json
{
    "body": "If `maxima` lies in `/path with spaces/`, then\n`MAXIMA` could be set to `'\"/path with spaces/maxima\" -l ecl'` and that would work with the current version on the branch.\n\nUnrelated, but perhaps an improvement:\n\n```diff\n- command = '{0} -p \"{1}\"'.format(MAXIMA, STARTUP)\n+ command = '{0} -p {1}'.format(MAXIMA, shlex.quote(STARTUP))\n```\n\nhttps://docs.python.org/3/library/shlex.html",
    "created_at": "2020-09-28T21:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434290",
    "user": "mkoeppe"
}
```

If `maxima` lies in `/path with spaces/`, then
`MAXIMA` could be set to `'"/path with spaces/maxima" -l ecl'` and that would work with the current version on the branch.

Unrelated, but perhaps an improvement:

```diff
- command = '{0} -p "{1}"'.format(MAXIMA, STARTUP)
+ command = '{0} -p {1}'.format(MAXIMA, shlex.quote(STARTUP))
```

https://docs.python.org/3/library/shlex.html



---

archive/issue_comments_434291.json:
```json
{
    "body": "Thanks for the explanation, that was helpful. \n\nUsing stuff like `shlex` more seems like a good idea to me and `quote` is available from 3.3 so it is ok to use. I'll redo the branch shortly.",
    "created_at": "2020-09-28T21:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434291",
    "user": "fbissey"
}
```

Thanks for the explanation, that was helpful. 

Using stuff like `shlex` more seems like a good idea to me and `quote` is available from 3.3 so it is ok to use. I'll redo the branch shortly.



---

archive/issue_comments_434292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-28T21:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434292",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_434293.json:
```json
{
    "body": "Does `shlex` have to be imported somewhere? `interfaces/maxima.py` fails here on s-o-g unless I explicitly `import shlex`.",
    "created_at": "2020-09-29T01:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434293",
    "user": "strogdon"
}
```

Does `shlex` have to be imported somewhere? `interfaces/maxima.py` fails here on s-o-g unless I explicitly `import shlex`.



---

archive/issue_comments_434294.json:
```json
{
    "body": "I'll confess that I thought it would be OK without import and it was foolish. I'll fix that.",
    "created_at": "2020-09-29T01:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434294",
    "user": "fbissey"
}
```

I'll confess that I thought it would be OK without import and it was foolish. I'll fix that.



---

archive/issue_comments_434295.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-29T01:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434295",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434296.json:
```json
{
    "body": "Done.",
    "created_at": "2020-09-29T01:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434296",
    "user": "fbissey"
}
```

Done.



---

archive/issue_comments_434297.json:
```json
{
    "body": "This works here.\n\n`@`mkoeppe please add yourself if you see fit as I would never have thought of using `shlex`.",
    "created_at": "2020-09-29T02:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434297",
    "user": "strogdon"
}
```

This works here.

`@`mkoeppe please add yourself if you see fit as I would never have thought of using `shlex`.



---

archive/issue_comments_434298.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-29T02:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434298",
    "user": "strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_434299.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-03T22:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30439#issuecomment-434299",
    "user": "vbraun"
}
```

Resolution: fixed
