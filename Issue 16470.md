# Issue 16470: Provide more useful error messages from categories

Issue created by migration from https://trac.sagemath.org/ticket/16707

Original creator: ppurka

Original creation time: 2014-07-23 17:01:41

CC:  tscrim vbraun nthiery ncohen simonking

The reason for opening this ticket is well discussed in #16644 (see `@`vbraun's comments). Essentially, things like this should not happen.

Here is a file called `a.sage`.

```python
import sage.modules.module as module 

class MyClass(module.Module):
    def __init__(self, number):
        base_ring = number.parent()
        module.Module.__init__(self, base_ring)
```

And here is an output. This should not happen at all.

```
sage: %runfile a.sage
sage: C = MyClass(1)
sage: C.element_class()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-66b2e3babdf7> in <module>()
----> 1 C.element_class()

/home/punarbasu/tmp/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__getattr__ (build/cythonized/sage/structure/parent.c:7290)()

/home/punarbasu/tmp/sage/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1687)()

AttributeError: 'MyClass_with_category' object has no attribute 'element_class'

sage: 'element_class' in dir(C)
True
sage: hasattr(C, 'element_class')
False
```

There are other cases where it is not clear why some stuff is not implemented and yet available in the method list:

```
sage: C.sum(())
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
...
NotImplementedError: 
```


So, this ticket should go through all the default methods that are usually available and provide useful error message - for instance the `sum` method can say that the `zero()` method needs to be implemented.

If the changes are extensive, then open other child tickets and put them in the "dependencies" of this one.


---

Comment by vbraun created at 2014-08-05 18:39:48

Changing priority from major to critical.


---

Comment by nthiery created at 2014-08-29 05:37:51

I am all for having more meaningful error messages. Finding what's actually meaningfull is often hard however. So reports of the form "I tried this, got this error message; this alternative other error message would have been helpful" are very useful. Thanks! That's how I usually improve the messages; by being bitten by them myself.

For the `element_class`: this is a general thing about conditionaly defined lazy attributes. If we have them report an error (like `Element` is required), then classes higher up in the hierarchy don't get a chance to provide an alternative definition. Hence the NotImplemented protocol for lazy attributes.

In the special case at hand, I could be convinced that no class above `Parent` will provide `element_class`, and that we could report a message (which one?) instead.

As for the fact that `element_class` appears in `dir` but is not necessarily available: this is not really different from a method that would raise a not implemented error upon being called, or is it?
Granted, looking up the documentation of the method is easier.


For `C.sum()`, it seems to me that the traceback is making it pretty clear that it calls `C.zero`, and that the default implementation for the later is to coerce in `0` which might, or not, be implemented:

```
sage: C.sum(())
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-16-e76fdc39515c> in <module>()
----> 1 C.sum(())

/opt/sage-git/local/lib/python2.7/site-packages/sage/categories/additive_monoids.pyc in sum(self, args)
     67                 True
     68             """
---> 69             return sum(args, self.zero())
     70 

/opt/sage-git/local/lib/python2.7/site-packages/sage/misc/cachefunc.so in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12263)()

/opt/sage-git/local/lib/python2.7/site-packages/sage/categories/additive_magmas.pyc in zero(self)
    707                 """
    708                 # TODO: add a test that actually exercise this default implementation
--> 709                 return self(0)
    710 
    711             def zero_element(self):

/opt/sage-git/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:8685)()

NotImplementedError:  
```


Now, if you think we should get rid of this default implementation of `zero`, and replace it by an abstract method, please go for it: I find coercing from `0` pretty ugly. I assume there are still a few parents around that depend on it, so it might take a bit of work, but nothing terrible.

Please keep on with futher suggestions of better error messages!


---

Comment by mkoeppe created at 2021-03-09 00:26:42

Changing priority from critical to major.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.
