# Issue 13477: fix issues with SAGE_TMP

archive/issues_013477.json:
```json
{
    "body": "Assignee: leif\n\nCC:  jdemeyer\n\n#13579 changed `SAGE_TMP`. There are some places with less-than-ideal handling of `SAGE_TMP` that are broken in the process.\n\n* `sage-cleaner` hardcodes '.../temp/...' but thats not correct any more.\n* Many doctests use SAGE_TMP+'foo.bar'. The new SAGE_TMP doesn't end in a backslash any more. Using `os.path.join` would have saved the day.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13681\n\n",
    "created_at": "2012-11-03T16:11:11Z",
    "labels": [
        "scripts",
        "major",
        "bug"
    ],
    "title": "fix issues with SAGE_TMP",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13477",
    "user": "vbraun"
}
```
Assignee: leif

CC:  jdemeyer

#13579 changed `SAGE_TMP`. There are some places with less-than-ideal handling of `SAGE_TMP` that are broken in the process.

* `sage-cleaner` hardcodes '.../temp/...' but thats not correct any more.
* Many doctests use SAGE_TMP+'foo.bar'. The new SAGE_TMP doesn't end in a backslash any more. Using `os.path.join` would have saved the day.

Issue created by migration from https://trac.sagemath.org/ticket/13681





---

archive/issue_comments_166198.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2012-11-03T18:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166198",
    "user": "jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_166199.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-11-03T18:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166199",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_166200.json:
```json
{
    "body": "Would you consider merging #13147 into 5.4, and then rebasing this on top of that?",
    "created_at": "2012-11-03T19:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166200",
    "user": "jhpalmieri"
}
```

Would you consider merging #13147 into 5.4, and then rebasing this on top of that?



---

archive/issue_comments_166201.json:
```json
{
    "body": "Replying to [comment:2 jhpalmieri]:\n> Would you consider merging #13147 into 5.4, and then rebasing this on top of that?\nWhy?  I don't see the advantage.",
    "created_at": "2012-11-03T19:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166201",
    "user": "jdemeyer"
}
```

Replying to [comment:2 jhpalmieri]:
> Would you consider merging #13147 into 5.4, and then rebasing this on top of that?
Why?  I don't see the advantage.



---

archive/issue_comments_166202.json:
```json
{
    "body": "I could incorporate all the changes from #13147 *except* for the \"lazy string\" part.",
    "created_at": "2012-11-03T19:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166202",
    "user": "jdemeyer"
}
```

I could incorporate all the changes from #13147 *except* for the "lazy string" part.



---

archive/issue_comments_166203.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-11-03T19:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166203",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_166204.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-03T21:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166204",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_166205.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> I could incorporate all the changes from #13147 *except* for the \"lazy string\" part.\nDone.",
    "created_at": "2012-11-03T21:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166205",
    "user": "jdemeyer"
}
```

Replying to [comment:4 jdemeyer]:
> I could incorporate all the changes from #13147 *except* for the "lazy string" part.
Done.



---

archive/issue_comments_166206.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> Replying to [comment:2 jhpalmieri]:\n> > Would you consider merging #13147 into 5.4, and then rebasing this on top of that?\n> Why?  I don't see the advantage.\n\nOne advantage would have been so #13147 wouldn't need rebasing, and it also solved some of the same issues. But now I guess it will need rebasing anyway.",
    "created_at": "2012-11-03T21:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166206",
    "user": "jhpalmieri"
}
```

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 jhpalmieri]:
> > Would you consider merging #13147 into 5.4, and then rebasing this on top of that?
> Why?  I don't see the advantage.

One advantage would have been so #13147 wouldn't need rebasing, and it also solved some of the same issues. But now I guess it will need rebasing anyway.



---

archive/issue_comments_166207.json:
```json
{
    "body": "Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`. I'll attach a patch to fix this.\n\nPositive review to all the other patches.",
    "created_at": "2012-11-04T00:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166207",
    "user": "vbraun"
}
```

Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`. I'll attach a patch to fix this.

Positive review to all the other patches.



---

archive/issue_comments_166208.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-11-04T00:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166208",
    "user": "vbraun"
}
```

Initial patch



---

archive/issue_comments_166209.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-11-04T00:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166209",
    "user": "vbraun"
}
```

Attachment



---

archive/issue_comments_166210.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`.\nIs this a regression due to #13579?  If it's not, I prefer to leave this change for a different ticket.",
    "created_at": "2012-11-04T08:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166210",
    "user": "jdemeyer"
}
```

Replying to [comment:9 vbraun]:
> Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`.
Is this a regression due to #13579?  If it's not, I prefer to leave this change for a different ticket.



---

archive/issue_comments_166211.json:
```json
{
    "body": "Volker, could you agree with not merging your patch here?  I feel that the chance of stuff breaking is too big to risk merging it.",
    "created_at": "2012-11-05T07:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166211",
    "user": "jdemeyer"
}
```

Volker, could you agree with not merging your patch here?  I feel that the chance of stuff breaking is too big to risk merging it.



---

archive/issue_comments_166212.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-05T20:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166212",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_166213.json:
```json
{
    "body": "I'll attach the `SAGE_TESTDIR` stuff to the followup ticket, then.",
    "created_at": "2012-11-05T20:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166213",
    "user": "vbraun"
}
```

I'll attach the `SAGE_TESTDIR` stuff to the followup ticket, then.



---

archive/issue_comments_166214.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-05T20:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13477#issuecomment-166214",
    "user": "jdemeyer"
}
```

Resolution: fixed
