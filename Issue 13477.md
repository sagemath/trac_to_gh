# Issue 13477: fix issues with SAGE_TMP

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-11-03 16:11:11

Assignee: leif

CC:  jdemeyer

#13579 changed `SAGE_TMP`. There are some places with less-than-ideal handling of `SAGE_TMP` that are broken in the process.

* `sage-cleaner` hardcodes '.../temp/...' but thats not correct any more.
* Many doctests use SAGE_TMP+'foo.bar'. The new SAGE_TMP doesn't end in a backslash any more. Using `os.path.join` would have saved the day.


---

Comment by jdemeyer created at 2012-11-03 18:10:13

Changing priority from major to blocker.


---

Attachment


---

Comment by jhpalmieri created at 2012-11-03 19:32:29

Would you consider merging #13147 into 5.4, and then rebasing this on top of that?


---

Comment by jdemeyer created at 2012-11-03 19:40:37

Replying to [comment:2 jhpalmieri]:
> Would you consider merging #13147 into 5.4, and then rebasing this on top of that?
Why?  I don't see the advantage.


---

Comment by jdemeyer created at 2012-11-03 19:45:59

I could incorporate all the changes from #13147 _except_ for the "lazy string" part.


---

Attachment


---

Comment by jdemeyer created at 2012-11-03 21:00:00

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-11-03 21:00:15

Replying to [comment:4 jdemeyer]:
> I could incorporate all the changes from #13147 _except_ for the "lazy string" part.
Done.


---

Comment by jhpalmieri created at 2012-11-03 21:21:39

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 jhpalmieri]:
> > Would you consider merging #13147 into 5.4, and then rebasing this on top of that?
> Why?  I don't see the advantage.

One advantage would have been so #13147 wouldn't need rebasing, and it also solved some of the same issues. But now I guess it will need rebasing anyway.


---

Comment by vbraun created at 2012-11-04 00:54:34

Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`. I'll attach a patch to fix this.

Positive review to all the other patches.


---

Comment by vbraun created at 2012-11-04 00:54:51

Initial patch


---

Attachment


---

Comment by jdemeyer created at 2012-11-04 08:43:36

Replying to [comment:9 vbraun]:
> Doctesting still litters files around than don't get deleted because `SAGE_TESTDIR` is not a the expected `DOT_SAGE/tmp/hostname/pid/...`.
Is this a regression due to #13579?  If it's not, I prefer to leave this change for a different ticket.


---

Comment by jdemeyer created at 2012-11-05 07:48:09

Volker, could you agree with not merging your patch here?  I feel that the chance of stuff breaking is too big to risk merging it.


---

Comment by vbraun created at 2012-11-05 20:06:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-11-05 20:06:56

I'll attach the `SAGE_TESTDIR` stuff to the followup ticket, then.


---

Comment by jdemeyer created at 2012-11-05 20:45:05

Resolution: fixed
