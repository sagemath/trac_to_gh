# Issue 15830: Python 3 preparation: The semantic of filter() function is changed

Issue created by migration from Trac.

Original creator: wluebbe

Original creation time: 2014-04-07 08:38:48

CC:  aapitzsch

Keywords: python3

In Py2 `filter()` returns a list, while in Py3 `filter()` returns an iterator (as `itertools.ifilter()` does in Py2).

The tool 2to3 wraps `filter()` usages with a call to `list()`.


An alternative approach is to add `from future_builtins import filter` and to check where a wrapping with `list()` is required.

There are 53 effected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.


---

Comment by wluebbe created at 2014-05-20 16:26:19

`2to3` does even better as its documentation [2to3 filter](https://docs.python.org/2.7/library/2to3.html#2to3fixer-filter) suggests:

"Wraps filter() usage in a list call."

Often it changes the code as indicated by [filter()](https://docs.python.org/2.7/library/functions.html#filter):


"Note that `filter(function, iterable)` is equivalent to `[item for item in iterable if function(item)]` if function is not `None` and `[item for item in iterable if item]` if function is `None`."

This is more readable and more pythonic as a combination of `filter` and `lamda`.
And it allows sometimes further improvements!
----
New commits:


---

Comment by wluebbe created at 2014-05-20 16:27:40

These are the generated changes. Some manual fixups / improvements to come.


---

Comment by wluebbe created at 2014-05-21 13:17:57

Apparently I did not run `./sage -b` before the test - Grrr ...  :-(

Now I will always use `./sage -b;./sage -tp 4 --all --long >logs/sage-tp4-all-long-16067.log` in one line!


---

Comment by git created at 2014-05-21 15:57:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-05-21 16:02:46

In `sage/graphs/generic_graph.py` the name `filter` was overwritten (by a local function definition. Therefore `2to3` got confused and wrapped the call `filter()` with `list()`. This caused a lot of doctest failures and 4 segfaults!


---

Comment by git created at 2014-05-21 19:52:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-05-21 19:57:18

I think this a complete fix for the `filter()` function.

This ticket may really belong to stage 1 ...


---

Comment by wluebbe created at 2014-05-21 19:57:18

Changing status from new to needs_review.


---

Comment by git created at 2014-05-26 15:46:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-05-29 12:23:45

Hi André, would you like to review this Py3 ticket?


---

Comment by aapitzsch created at 2014-05-31 09:20:35

Hi,
please change `==None` back to `is None` in `src/sage/combinat/k_tableau.py`.

Could you check that the indentions are correct, e.g. in `src/sage/misc/sagedoc.py`:

```
match_list = [s for s in match_list if re.search(extra, s[1],
                                  re.MULTILINE | flags)]
```

should be

```
match_list = [s for s in match_list if re.search(extra, s[1],
                                                 re.MULTILINE | flags)]
```



---

Comment by aapitzsch created at 2014-05-31 09:20:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-06-04 19:59:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-05 09:26:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-06-05 09:29:46

Changing status from needs_work to needs_review.


---

Comment by wluebbe created at 2014-06-05 09:29:46

Resolved merge conflict, answered the reviewer comment and added a few additional improvements. All doctests pass.


---

Comment by aapitzsch created at 2014-06-05 21:52:43

Changing status from needs_review to needs_work.


---

Comment by aapitzsch created at 2014-06-05 21:52:43

Check your changes in `src/sage/doctest/control.py` and `src/sage/quadratic_forms/quadratic_form__ternary_Tornaria.py`. Some functionality appears twice.


---

Comment by git created at 2014-06-06 07:39:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-06-06 07:49:03

Hi André, thank you for reviewing and finding these problems! Apparently I wanted to go too fast  :-/  

"Eile mit Weile ..."


---

Comment by wluebbe created at 2014-06-06 07:49:03

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2014-06-06 08:40:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-06 18:08:04

Resolution: fixed
