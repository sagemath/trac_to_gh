# Issue 23528: Connected filtered Hopf algebras have a default antipode

archive/issues_023528.json:
```json
{
    "body": "CC:  sage-combinat darij chapoton\n\nKeywords: Hopf algebras\n\nWe move it up from the connected graded Hopf algebras.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23765\n\n",
    "created_at": "2017-08-31T14:47:23Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "title": "Connected filtered Hopf algebras have a default antipode",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23528",
    "user": "tscrim"
}
```
CC:  sage-combinat darij chapoton

Keywords: Hopf algebras

We move it up from the connected graded Hopf algebras.

Issue created by migration from https://trac.sagemath.org/ticket/23765





---

archive/issue_comments_329677.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-31T14:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329677",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_329678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-31T14:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329678",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329679.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-31T14:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329679",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_329680.json:
```json
{
    "body": "What do you require of the basis? If the basis is just required to play well with the filtration, then `counit_on_basis` is wrong since any basis element of any degree might have a nonzero counit.\n\nEDIT: Similarly, `antipode_on_basis` also assumes that any nontrivial basis element has zero counit (in this case, it's fine). This shouldn't be hard to fix.",
    "created_at": "2017-08-31T16:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329680",
    "user": "darij"
}
```

What do you require of the basis? If the basis is just required to play well with the filtration, then `counit_on_basis` is wrong since any basis element of any degree might have a nonzero counit.

EDIT: Similarly, `antipode_on_basis` also assumes that any nontrivial basis element has zero counit (in this case, it's fine). This shouldn't be hard to fix.



---

archive/issue_comments_329681.json:
```json
{
    "body": "Each basis element should be contained in a homogeneous degree component (i.e. A<sub>i</sub> - A,,i - 1,,). Other than that, I don't think there is any requirements.",
    "created_at": "2017-08-31T17:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329681",
    "user": "tscrim"
}
```

Each basis element should be contained in a homogeneous degree component (i.e. A<sub>i</sub> - A,,i - 1,,). Other than that, I don't think there is any requirements.



---

archive/issue_comments_329682.json:
```json
{
    "body": "I can't ssh to UMN now, and I have uninstalled my virtualbox from this laptop already (planning to get a new one when I'm back to Minneapolis). Meanwhile, can you please do the following?\n\n1. Remove the `counit_on_basis` method. Or, if you feel like making things more interesting, keep it in, but only if a keyword argument `augmented_basis` has been set to `True` when instantiating the class. (\"Augmented basis\" means that the basis has the property that only the element 1 has nonzero counit.)\n\n2. In `antipode_on_basis`, replace\n\n```\n+                return -x__S_Id(self.monomial(index).coproduct()\n+                                - tensor([self.monomial(index), self.one()])\n+                               )\n```\n\nby\n\n```\n+                smi = self.monomial(index)\n+                return -x__S_Id(smi.coproduct()\n+                                - tensor([smi, self.one()])\n+                               ) + smi.counit()\n```\n\n\n3. Bonus: Those weird non-graded bases of Sym corresponding to the symplectic(?) groups should now properly work without hacks...",
    "created_at": "2017-09-01T11:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329682",
    "user": "darij"
}
```

I can't ssh to UMN now, and I have uninstalled my virtualbox from this laptop already (planning to get a new one when I'm back to Minneapolis). Meanwhile, can you please do the following?

1. Remove the `counit_on_basis` method. Or, if you feel like making things more interesting, keep it in, but only if a keyword argument `augmented_basis` has been set to `True` when instantiating the class. ("Augmented basis" means that the basis has the property that only the element 1 has nonzero counit.)

2. In `antipode_on_basis`, replace

```
+                return -x__S_Id(self.monomial(index).coproduct()
+                                - tensor([self.monomial(index), self.one()])
+                               )
```

by

```
+                smi = self.monomial(index)
+                return -x__S_Id(smi.coproduct()
+                                - tensor([smi, self.one()])
+                               ) + smi.counit()
```


3. Bonus: Those weird non-graded bases of Sym corresponding to the symplectic(?) groups should now properly work without hacks...



---

archive/issue_comments_329683.json:
```json
{
    "body": "Replying to [comment:6 darij]:\n> I can't ssh to UMN now, and I have uninstalled my virtualbox from this laptop already (planning to get a new one when I'm back to Minneapolis). Meanwhile, can you please do the following?\n\nSure, I will push the changes.\n\n> 1. Remove the `counit_on_basis` method. Or, if you feel like making things more interesting, keep it in, but only if a keyword argument `augmented_basis` has been set to `True` when instantiating the class. (\"Augmented basis\" means that the basis has the property that only the element 1 has nonzero counit.)\n\nQuestion before I do that: This would not be correct in general in the graded case as well, right?",
    "created_at": "2017-09-01T14:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329683",
    "user": "tscrim"
}
```

Replying to [comment:6 darij]:
> I can't ssh to UMN now, and I have uninstalled my virtualbox from this laptop already (planning to get a new one when I'm back to Minneapolis). Meanwhile, can you please do the following?

Sure, I will push the changes.

> 1. Remove the `counit_on_basis` method. Or, if you feel like making things more interesting, keep it in, but only if a keyword argument `augmented_basis` has been set to `True` when instantiating the class. ("Augmented basis" means that the basis has the property that only the element 1 has nonzero counit.)

Question before I do that: This would not be correct in general in the graded case as well, right?



---

archive/issue_comments_329684.json:
```json
{
    "body": "Oops, I've just realized that a graded basis of a connected graded module as we define it is *automatically* augmented. So the stuff you removed from the Graded().Category() class should probably go back.\n\nBUT a graded module can have a filtered basis that is not graded and not augmented. (Stable dual Grothendieck polynomials for Sym are an example of a filtered basis that is not graded, but augmented. One of your symplectic bases, I think, is neither.) I am wondering whether we have the tools for this. Ideally, it should be in the category\n\n```\nHopfAlgebras().Filtered().Connected().WithBasis()\n```\n\nand in the category\n\n```\nHopfAlgebras().Graded().Connected()\n```\n\nbut NOT in the category\n\n```\nHopfAlgebras().Graded().Connected().WithBasis()\n```\n\nI never understood the category framework well enough to tell if this works natively.",
    "created_at": "2017-09-01T14:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329684",
    "user": "darij"
}
```

Oops, I've just realized that a graded basis of a connected graded module as we define it is *automatically* augmented. So the stuff you removed from the Graded().Category() class should probably go back.

BUT a graded module can have a filtered basis that is not graded and not augmented. (Stable dual Grothendieck polynomials for Sym are an example of a filtered basis that is not graded, but augmented. One of your symplectic bases, I think, is neither.) I am wondering whether we have the tools for this. Ideally, it should be in the category

```
HopfAlgebras().Filtered().Connected().WithBasis()
```

and in the category

```
HopfAlgebras().Graded().Connected()
```

but NOT in the category

```
HopfAlgebras().Graded().Connected().WithBasis()
```

I never understood the category framework well enough to tell if this works natively.



---

archive/issue_comments_329685.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T15:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329685",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329686.json:
```json
{
    "body": "Done all related to this ticket.\n\nIf you do\n\n```\nHopfAlgebras(QQ).Graded().WithBasis()\n```\n\nyou are saying the Hopf algebra is graded, but your basis does not necessarily respect that grading, in contrast with\n\n```\nHopfAlgebras(QQ).WithBasis().Graded()\n```\n\nwhere you are specifying the basis is graded. You can see the difference here:\n\n```\nsage: HopfAlgebras(QQ).Graded().WithBasis()\nJoin of Category of hopf algebras with basis over Rational Field and Category of graded algebras over Rational Field\nsage: type(HopfAlgebras(QQ).Graded().WithBasis())\n<class 'sage.categories.category.JoinCategory_with_category'>\nsage: HopfAlgebras(QQ).WithBasis().Graded()\nCategory of graded hopf algebras with basis over Rational Field\nsage: type(HopfAlgebras(QQ).WithBasis().Graded())\n<class 'sage.categories.graded_hopf_algebras_with_basis.GradedHopfAlgebrasWithBasis_with_category'>\n```\n\nHowever, the Sym issue is a separate ticket IMO.",
    "created_at": "2017-09-01T15:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329686",
    "user": "tscrim"
}
```

Done all related to this ticket.

If you do

```
HopfAlgebras(QQ).Graded().WithBasis()
```

you are saying the Hopf algebra is graded, but your basis does not necessarily respect that grading, in contrast with

```
HopfAlgebras(QQ).WithBasis().Graded()
```

where you are specifying the basis is graded. You can see the difference here:

```
sage: HopfAlgebras(QQ).Graded().WithBasis()
Join of Category of hopf algebras with basis over Rational Field and Category of graded algebras over Rational Field
sage: type(HopfAlgebras(QQ).Graded().WithBasis())
<class 'sage.categories.category.JoinCategory_with_category'>
sage: HopfAlgebras(QQ).WithBasis().Graded()
Category of graded hopf algebras with basis over Rational Field
sage: type(HopfAlgebras(QQ).WithBasis().Graded())
<class 'sage.categories.graded_hopf_algebras_with_basis.GradedHopfAlgebrasWithBasis_with_category'>
```

However, the Sym issue is a separate ticket IMO.



---

archive/issue_comments_329687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-02T15:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329687",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329688.json:
```json
{
    "body": "*ping*",
    "created_at": "2017-09-16T14:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329688",
    "user": "tscrim"
}
```

*ping*



---

archive/issue_comments_329689.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-16T15:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329689",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329690.json:
```json
{
    "body": "Just got my Sage running again yesterday, now compiling some months worth of updates; so this will take a while. Should be done today though.\n\nQuick question: Why is `HopfAlgebrasWithBasis` not a parent category of this? Would this lead to the incorrect conclusion that `FilteredHopfAlgebrasWithBasis == HopfAlgebras.Filtered.WithBasis`?",
    "created_at": "2017-09-16T15:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329690",
    "user": "darij"
}
```

Just got my Sage running again yesterday, now compiling some months worth of updates; so this will take a while. Should be done today though.

Quick question: Why is `HopfAlgebrasWithBasis` not a parent category of this? Would this lead to the incorrect conclusion that `FilteredHopfAlgebrasWithBasis == HopfAlgebras.Filtered.WithBasis`?



---

archive/issue_comments_329691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-16T15:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329691",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329692.json:
```json
{
    "body": "Replying to [comment:14 darij]:\n> Just got my Sage running again yesterday, now compiling some months worth of updates; so this will take a while. Should be done today though.\n\nYay.\n\n> Quick question: Why is `HopfAlgebrasWithBasis` not a parent category of this? Would this lead to the incorrect conclusion that `FilteredHopfAlgebrasWithBasis == HopfAlgebras.Filtered.WithBasis`?\n\nI don't understand. We have this:\n\n```\nsage: from sage.categories.filtered_hopf_algebras_with_basis import FilteredHopfAlgebrasWithBasis\nsage: FilteredHopfAlgebrasWithBasis(QQ).super_categories()\n[Category of hopf algebras with basis over Rational Field,\n Category of filtered algebras with basis over Rational Field]\n```\n\n\nI also removed your requirements as this is a subcategory of `FilteredModulesWithBasis`, so it has to respect them.",
    "created_at": "2017-09-16T15:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329692",
    "user": "tscrim"
}
```

Replying to [comment:14 darij]:
> Just got my Sage running again yesterday, now compiling some months worth of updates; so this will take a while. Should be done today though.

Yay.

> Quick question: Why is `HopfAlgebrasWithBasis` not a parent category of this? Would this lead to the incorrect conclusion that `FilteredHopfAlgebrasWithBasis == HopfAlgebras.Filtered.WithBasis`?

I don't understand. We have this:

```
sage: from sage.categories.filtered_hopf_algebras_with_basis import FilteredHopfAlgebrasWithBasis
sage: FilteredHopfAlgebrasWithBasis(QQ).super_categories()
[Category of hopf algebras with basis over Rational Field,
 Category of filtered algebras with basis over Rational Field]
```


I also removed your requirements as this is a subcategory of `FilteredModulesWithBasis`, so it has to respect them.



---

archive/issue_comments_329693.json:
```json
{
    "body": "Oh, I should learn reading.\n\nI wouldn't get rid of the requirements, though. Maybe replace them by something like this:\n\n```\n    A filtered Hopf algebra with basis over a commutative ring `R`\n    is a filtered Hopf algebra over `R` endowed with the structure\n    of a filtered module with basis (with the same underlying\n    filtered-module structure).\n    A filtered Hopf algebra over `R` means a Hopf algebra equipped\n    with a module filtration such that all structure maps of the\n    Hopf algebra respect the filtration. See\n    :class:`~sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis`\n    for the notion of a filtered module.\n```\n\n(Something similar is done in `filtered_algebras_with_basis.py`.)",
    "created_at": "2017-09-16T15:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329693",
    "user": "darij"
}
```

Oh, I should learn reading.

I wouldn't get rid of the requirements, though. Maybe replace them by something like this:

```
    A filtered Hopf algebra with basis over a commutative ring `R`
    is a filtered Hopf algebra over `R` endowed with the structure
    of a filtered module with basis (with the same underlying
    filtered-module structure).
    A filtered Hopf algebra over `R` means a Hopf algebra equipped
    with a module filtration such that all structure maps of the
    Hopf algebra respect the filtration. See
    :class:`~sage.categories.filtered_modules_with_basis.FilteredModulesWithBasis`
    for the notion of a filtered module.
```

(Something similar is done in `filtered_algebras_with_basis.py`.)



---

archive/issue_comments_329694.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-16T16:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329694",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329695.json:
```json
{
    "body": "I can live with that (although it feels a little verbose and superfluous).",
    "created_at": "2017-09-16T16:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329695",
    "user": "tscrim"
}
```

I can live with that (although it feels a little verbose and superfluous).



---

archive/issue_comments_329696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-16T18:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329696",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329697.json:
```json
{
    "body": "Yeah, that was an awkward formulation. Let me know if the new one is better. Positive_review if you are OK with my changes.\n\nSorry for how long this took!\n\n(Rationale for my other changes: Theoretically, a basis of a connected graded Hopf algebra might contain, say, -1 instead of 1. Thus, the claim that the counit of $i$ is \"1 & \\hbox{if $i$ is the unique element of degree $0$}\" is false. Also, the recursive formula for S(x) in the graded case was not true for degree 0, so I replaced \"in general\" by \"when `|x| > 0`\".)",
    "created_at": "2017-09-16T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329697",
    "user": "darij"
}
```

Yeah, that was an awkward formulation. Let me know if the new one is better. Positive_review if you are OK with my changes.

Sorry for how long this took!

(Rationale for my other changes: Theoretically, a basis of a connected graded Hopf algebra might contain, say, -1 instead of 1. Thus, the claim that the counit of $i$ is "1 & \hbox{if $i$ is the unique element of degree $0$}" is false. Also, the recursive formula for S(x) in the graded case was not true for degree 0, so I replaced "in general" by "when `|x| > 0`".)



---

archive/issue_comments_329698.json:
```json
{
    "body": "I know this is basically bikeshedding, but I do not want the word \"requirement\" to appear. It feels too much like exposing implementation details (or maybe instructions to [future] authors) to the casual user. So could you revert this part:\n\n```diff\n-    for the notion of a filtered module.\n+    for the meaning of the latter requirement).\n```\n\n(with adding the `)` of course). You can set a positive review on my behalf when done.\n\nThank you for doing the review.",
    "created_at": "2017-09-16T18:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329698",
    "user": "tscrim"
}
```

I know this is basically bikeshedding, but I do not want the word "requirement" to appear. It feels too much like exposing implementation details (or maybe instructions to [future] authors) to the casual user. So could you revert this part:

```diff
-    for the notion of a filtered module.
+    for the meaning of the latter requirement).
```

(with adding the `)` of course). You can set a positive review on my behalf when done.

Thank you for doing the review.



---

archive/issue_comments_329699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-16T18:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329699",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329700.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-16T18:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329700",
    "user": "darij"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329701.json:
```json
{
    "body": "Perfect! (I've added \"with basis\", though, as I had forgotten it.)",
    "created_at": "2017-09-16T18:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329701",
    "user": "darij"
}
```

Perfect! (I've added "with basis", though, as I had forgotten it.)



---

archive/issue_comments_329702.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23528#issuecomment-329702",
    "user": "vbraun"
}
```

Resolution: fixed
