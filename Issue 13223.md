# Issue 13223: Fix upgrading

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2012-08-24 06:39:07

Assignee: GeorgSWeber

CC:  leif

The GCC spkg broke some aspects of upgrading Sage from earlier versions. Fix these.


---

Comment by jdemeyer created at 2012-08-24 07:06:48

Changing priority from critical to blocker.


---

Comment by jdemeyer created at 2012-08-27 10:47:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-08-29 19:59:52

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-08-29 20:26:45

Changing assignee from GeorgSWeber to jdemeyer.


---

Comment by jdemeyer created at 2012-08-31 13:20:10

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-09-04 02:38:58

Why doesn't touching `spkg/installed/gcc-*` before going an upgrade cause all packages that depend on gcc to be rebuilt? Oh, I see, nothing actually depends on gcc.

I've tried upgrading using this patch, and several times I've gotten an error with R:

```
mkdir /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.X-upgrade/local/lib/R/include
mkdir: /Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.X-upgrade/local/lib/R/include: File exists
```

And sure enough, there is a _file_ (not a directory) `SAGE_LOCAL/lib/R/include`. It's not from the previous installation, since the spkg-install file deletes `SAGE_LOCAL/lib/R/`. I'm guessing that it's not related to this ticket. Have you ever seen this before?


---

Comment by jhpalmieri created at 2012-09-04 03:20:50

If sage-env gets sourced more than once (as can happen during upgrading with this patch), we will get duplicate entries in $PATH, $LD_LIBRARY_PATH, and others. I don't think this is an issue, but it was one of the points of #10469. Should I be concerned about this?


---

Comment by jhpalmieri created at 2012-09-04 03:33:40

In the comments about versioning in sage-env, is it worth mentioning the motivation behind it, or are the pointers to the tickets good enough? We don't want people updating the version needlessly, so maybe add a sentence or two explaining when it's necessary (and when it's not?) to change the version number.


---

Comment by jhpalmieri created at 2012-09-04 05:42:33

Regarding the problem with R, I see it without this patch also. This is on OS X 10.7, for what that's worth. The file `src/include/libintl.h` from the R spkg ends up copied to the file `SAGE_LOCAL/lib/R/include`.


---

Comment by jdemeyer created at 2012-09-04 07:04:30

Replying to [comment:12 jhpalmieri]:
> And sure enough, there is a _file_ (not a directory) `SAGE_LOCAL/lib/R/include`. It's not from the previous installation, since the spkg-install file deletes `SAGE_LOCAL/lib/R/`. I'm guessing that it's not related to this ticket. Have you ever seen this before?

Yes, I only ever saw it on OS X though but I haven't investigated further.


---

Comment by jdemeyer created at 2012-09-04 07:06:56

Replying to [comment:13 jhpalmieri]:
> If sage-env gets sourced more than once (as can happen during upgrading with this patch), we will get duplicate entries in $PATH, $LD_LIBRARY_PATH, and others.
True.

> I don't think this is an issue, but it was one of the points of #10469. Should I be concerned about this?
Personally, I am not concerned about this.  I don't see a problem (apart from efficiency perhaps) with having duplicate `PATH` or `LD_LIBRARY_PATH` entries.  Also note that #10469 did not point out a particular problem that this causes.

Also remember that this can happen only _during_ upgrading.


---

Comment by jdemeyer created at 2012-09-04 07:31:19

Made a comment-only change to the patch.  I made a potentially controversial edit to the list of authors, let me know what you think (we could also get rid of the "authors" list completely).


---

Comment by jhpalmieri created at 2012-09-04 15:16:18

Looks good to me. If you feel like one more minor edit, in line 11 of sage-env, change "intented" to "intended". Obviously not a big deal.


---

Comment by jhpalmieri created at 2012-09-04 15:16:18

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-09-06 05:24:30

Resolution: fixed


---

Attachment


---

Comment by kcrisman created at 2012-09-11 15:30:42

> Regarding the problem with R, I see it without this patch also. This is on OS X 10.7, for what that's worth. The file `src/include/libintl.h` from the R spkg ends up copied to the file `SAGE_LOCAL/lib/R/include`.

For the record, I have seen this too now, same type of system.


---

Comment by jhpalmieri created at 2012-09-11 15:52:12

Replying to [comment:21 kcrisman]:
> > Regarding the problem with R, I see it without this patch also. This is on OS X 10.7, for what that's worth. The file `src/include/libintl.h` from the R spkg ends up copied to the file `SAGE_LOCAL/lib/R/include`.
> 
> For the record, I have seen this too now, same type of system.

Also for the record, it's fixed at #13428.


---

Comment by kcrisman created at 2012-09-11 16:21:14

> > For the record, I have seen this too now, same type of system.
> 
> Also for the record, it's fixed at #13428.

Great, thanks!
