# Issue 17555: Word problem for FareySymbol

archive/issues_017555.json:
```json
{
    "body": "CC:  xguitart @monien @JohnCremona\n\nKeywords: farey symbol, SL2Z, word problem\n\nThis ticket implements the word problem for Farey symbols obtained for finite index subgroups of SL2Z.\n\nHere is an example:\n\n```\nsage: F = Gamma0(30).farey_symbol()\nsage: gens = F.generators()\nsage: g = gens[3] * gens[10] * gens[8]**-1 * gens[5]\nsage: g\n[-628597   73008]\n[-692130   80387]\nsage: wd = F.word_problem(g)\nsage: wd\n[4, 11, -9, 6]\n```\n\n\nWhile implementing it, I detected a bug in the LLT algorithm used, which was irrelevant with the existing functionality since some of the output of LLT algorithm was not used elsewhere.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17792\n\n",
    "created_at": "2015-02-17T09:28:31Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Word problem for FareySymbol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17555",
    "user": "https://github.com/mmasdeu"
}
```
CC:  xguitart @monien @JohnCremona

Keywords: farey symbol, SL2Z, word problem

This ticket implements the word problem for Farey symbols obtained for finite index subgroups of SL2Z.

Here is an example:

```
sage: F = Gamma0(30).farey_symbol()
sage: gens = F.generators()
sage: g = gens[3] * gens[10] * gens[8]**-1 * gens[5]
sage: g
[-628597   73008]
[-692130   80387]
sage: wd = F.word_problem(g)
sage: wd
[4, 11, -9, 6]
```


While implementing it, I detected a bug in the LLT algorithm used, which was irrelevant with the existing functionality since some of the output of LLT algorithm was not used elsewhere.

Issue created by migration from https://trac.sagemath.org/ticket/17792





---

archive/issue_comments_234002.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-17T09:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234002",
    "user": "https://github.com/mmasdeu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234003.json:
```json
{
    "body": "Doc does not build, see patchbot report.\n\n```\nError building the documentation.\nTraceback (most recent call last):\nOSError: [arithgrou] docstring of\nsage.modular.arithgroup.farey_symbol.Farey.get_pmats_to_gens:11:\nWARNING: Literal block expected; none found.\n```\n",
    "created_at": "2015-04-05T18:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234003",
    "user": "https://github.com/fchapoton"
}
```

Doc does not build, see patchbot report.

```
Error building the documentation.
Traceback (most recent call last):
OSError: [arithgrou] docstring of
sage.modular.arithgroup.farey_symbol.Farey.get_pmats_to_gens:11:
WARNING: Literal block expected; none found.
```




---

archive/issue_comments_234004.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-05T18:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234004",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234005.json:
```json
{
    "body": "I have made sure that the doc builds, and also cleaned the file a little bit.\n----\nNew commits:",
    "created_at": "2015-04-15T09:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234005",
    "user": "https://github.com/fchapoton"
}
```

I have made sure that the doc builds, and also cleaned the file a little bit.
----
New commits:



---

archive/issue_comments_234006.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-15T09:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234006",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234007.json:
```json
{
    "body": "Why would you use a 1-based answer while the Python is 0-based. Couldn't you return a list of pairs `(index, power)`. That would be much more convenient:\n\n```\nsage: wd = F.word_problem(g)\nsage: prod(F.gen(i)**j for i,j in wd) == g\nTrue\n```\n\n\nVincent",
    "created_at": "2015-04-20T09:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234007",
    "user": "https://github.com/videlec"
}
```

Why would you use a 1-based answer while the Python is 0-based. Couldn't you return a list of pairs `(index, power)`. That would be much more convenient:

```
sage: wd = F.word_problem(g)
sage: prod(F.gen(i)**j for i,j in wd) == g
True
```


Vincent



---

archive/issue_comments_234008.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-04-20T09:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234008",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_234009.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-04-20T10:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234009",
    "user": "https://github.com/mmasdeu"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_234010.json:
```json
{
    "body": "What you say makes a lot of sense, but the representation used here is quite standard in other implementations of finitely presented groups (AFAIK), and also in Sage. It's called Tietze representation, see [http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html](http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html). Since unfortunately -0 = 0, the 1-based approach is essential here no matter how much you like 0-based languages :-).\n\nAlso, you can always do something like:\n\n```\nsage: wd = F.word_problem(g)\nsage: prod(F.gen(i-1) if i > 0 else F.gen(-i-1)**-1 for i in wd) == g\nTrue\n```\n\n\nReplying to [comment:6 vdelecroix]:\n> Why would you use a 1-based answer while the Python is 0-based. Couldn't you return a list of pairs `(index, power)`. That would be much more convenient:\n> {{{\n> sage: wd = F.word_problem(g)\n> sage: prod(F.gen(i)**j for i,j in wd) == g\n> True\n> }}}\n> \n> Vincent",
    "created_at": "2015-04-20T10:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234010",
    "user": "https://github.com/mmasdeu"
}
```

What you say makes a lot of sense, but the representation used here is quite standard in other implementations of finitely presented groups (AFAIK), and also in Sage. It's called Tietze representation, see [http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html](http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html). Since unfortunately -0 = 0, the 1-based approach is essential here no matter how much you like 0-based languages :-).

Also, you can always do something like:

```
sage: wd = F.word_problem(g)
sage: prod(F.gen(i-1) if i > 0 else F.gen(-i-1)**-1 for i in wd) == g
True
```


Replying to [comment:6 vdelecroix]:
> Why would you use a 1-based answer while the Python is 0-based. Couldn't you return a list of pairs `(index, power)`. That would be much more convenient:
> {{{
> sage: wd = F.word_problem(g)
> sage: prod(F.gen(i)**j for i,j in wd) == g
> True
> }}}
> 
> Vincent



---

archive/issue_comments_234011.json:
```json
{
    "body": "Replying to [comment:7 mmasdeu]:\n> What you say makes a lot of sense, but the representation used here is quite standard in other implementations of finitely presented groups (AFAIK), and also in Sage. It's called Tietze representation, see [http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html](http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html). Since unfortunately -0 = 0, the 1-based approach is essential here no matter how much you like 0-based languages :-).\n\nQuoting Sage in order to prove that you are right is wrong ;-) This Tietze representation is AFAIK something internal to GAP system (which is 1-based). IMHO The fact that we used it as a non hidden attribute in free group is wrong. I did not find any mathematical reference mentioning \"Tietze representation\".\n\nWhen somebody calls \"word problem\" he/she is even expecting a list of generators! Using the (possibly more compact) list of `(gen, power)` is fine. Replacing `gen` with its index is already a little bit of a hack. Replacing `gen` with its index plus one is too much for calling it `word_problem`. IMHO, the best would be a `Factorization` object\n\n```python\nsage: sage: F.<x,y> = FreeGroup()\nsage: f = Factorization([(x,2), (y,-3), (x,1), (y,1)], sort=False)\nsage: f\nx^2 * y^-3 * x * y\nsage: for i,j in f:\n....:     print i,j\nx 2\ny -3\nx 1\ny 1\n```\n\nFor matrices, the representation is ugly, but this can be easily fixed to be something like\n\n```python\nsage: m1 = SL2Z([1,1,0,1])\nsage: m2 = SL2Z([1,0,1,1])\nsage: f = Factorization([(m1,2),(m2,-3),(m1,2)], sort=False)\nsage: f        # this is currently ugly\n[1 1]^2  * [1 0]^-3 * [1 1]^2\n[0 1]      [1 1]      [0 1]\nsage: prod(f)  # this does work\n[-5 -8]\n[-3 -5]\n```\n\nI would be happy to fix the `Factorization._repr_` if you like this solution.\n\n> Also, you can always do something like:\n> {{{\n> sage: wd = F.word_problem(g)\n> sage: prod(F.gen(i-1) if i > 0 else F.gen(-i-1)**-1 for i in wd) == g\n> True\n> }}}\n\nVery elegant and very natural!\n\nVincent",
    "created_at": "2015-04-20T11:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234011",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:7 mmasdeu]:
> What you say makes a lot of sense, but the representation used here is quite standard in other implementations of finitely presented groups (AFAIK), and also in Sage. It's called Tietze representation, see [http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html](http://www.sagemath.org/doc/reference/groups/sage/groups/finitely_presented.html). Since unfortunately -0 = 0, the 1-based approach is essential here no matter how much you like 0-based languages :-).

Quoting Sage in order to prove that you are right is wrong ;-) This Tietze representation is AFAIK something internal to GAP system (which is 1-based). IMHO The fact that we used it as a non hidden attribute in free group is wrong. I did not find any mathematical reference mentioning "Tietze representation".

When somebody calls "word problem" he/she is even expecting a list of generators! Using the (possibly more compact) list of `(gen, power)` is fine. Replacing `gen` with its index is already a little bit of a hack. Replacing `gen` with its index plus one is too much for calling it `word_problem`. IMHO, the best would be a `Factorization` object

```python
sage: sage: F.<x,y> = FreeGroup()
sage: f = Factorization([(x,2), (y,-3), (x,1), (y,1)], sort=False)
sage: f
x^2 * y^-3 * x * y
sage: for i,j in f:
....:     print i,j
x 2
y -3
x 1
y 1
```

For matrices, the representation is ugly, but this can be easily fixed to be something like

```python
sage: m1 = SL2Z([1,1,0,1])
sage: m2 = SL2Z([1,0,1,1])
sage: f = Factorization([(m1,2),(m2,-3),(m1,2)], sort=False)
sage: f        # this is currently ugly
[1 1]^2  * [1 0]^-3 * [1 1]^2
[0 1]      [1 1]      [0 1]
sage: prod(f)  # this does work
[-5 -8]
[-3 -5]
```

I would be happy to fix the `Factorization._repr_` if you like this solution.

> Also, you can always do something like:
> {{{
> sage: wd = F.word_problem(g)
> sage: prod(F.gen(i-1) if i > 0 else F.gen(-i-1)**-1 for i in wd) == g
> True
> }}}

Very elegant and very natural!

Vincent



---

archive/issue_comments_234012.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n\n> Quoting Sage in order to prove that you are right is wrong ;-) This Tietze representation is AFAIK something internal to GAP system (which is 1-based). IMHO The fact that we used it as a non hidden attribute in free group is wrong. I did not find any mathematical reference mentioning \"Tietze representation\".\n\nBoth GAP and Magma use this representation (yes, they are both are 1-based, also). In any case, converting back and forth consists of two one liners:\n\n\n```\nsage: gapway = [sgn(a)*(i + 1) for i,a in yourway for _ in range(abs(a))]\nsage: yourway = [(a-1,len(list(g))) if a > 0 else (-a-1,-len(list(g))) for a,g in groupby(gapway)]\n```\n\n\n> \n> When somebody calls \"word problem\" he/she is even expecting a list of generators! Using > the (possibly more compact) list of `(gen, power)` is fine. Replacing `gen` with its\n> index is already a little bit of a hack.\n\nI am not so sure about this. Magma users get a \"Tietze\" list when they do the word problem for (say) units of quaternion orders. It is the one that comes out naturally out of any kind of \"reduction\" algorithm (like the one done in Farey symbols) and it might be good for input into other functions, so I would advocate for avoiding the extra processing.\n\nA list of the type (gen,power) is unlikely to be more compact as soon as you have more than two generators, also.\n\nI like your Factorization alternative, but I see two problems with it:\n\n1. Again, the user might want the more \"raw\" data, which we threw away.\n2. Suppose you have a group homomorphism defined by the images of the generators, which you stored in a list. How would you evaluate this homomorphism on a given group element? Well, you call the word_problem function, and then you still need to keep doing linear searches on your list of generators to figure out their index. This information was known to the `word_problem` method and you just threw it away...\n\n> I would be happy to fix the `Factorization._repr_` if you like this solution.\n\nWhat about having a `word_problem` method and a `factor` method? The first one can be as it is now, the `factor` could output a `Factorization` object exactly like you suggest, which would be good for visualizing but maybe not so much for programming.\n\n> Very elegant and very natural!\n\nI do agree ;-).",
    "created_at": "2015-04-20T12:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234012",
    "user": "https://github.com/mmasdeu"
}
```

Replying to [comment:8 vdelecroix]:

> Quoting Sage in order to prove that you are right is wrong ;-) This Tietze representation is AFAIK something internal to GAP system (which is 1-based). IMHO The fact that we used it as a non hidden attribute in free group is wrong. I did not find any mathematical reference mentioning "Tietze representation".

Both GAP and Magma use this representation (yes, they are both are 1-based, also). In any case, converting back and forth consists of two one liners:


```
sage: gapway = [sgn(a)*(i + 1) for i,a in yourway for _ in range(abs(a))]
sage: yourway = [(a-1,len(list(g))) if a > 0 else (-a-1,-len(list(g))) for a,g in groupby(gapway)]
```


> 
> When somebody calls "word problem" he/she is even expecting a list of generators! Using > the (possibly more compact) list of `(gen, power)` is fine. Replacing `gen` with its
> index is already a little bit of a hack.

I am not so sure about this. Magma users get a "Tietze" list when they do the word problem for (say) units of quaternion orders. It is the one that comes out naturally out of any kind of "reduction" algorithm (like the one done in Farey symbols) and it might be good for input into other functions, so I would advocate for avoiding the extra processing.

A list of the type (gen,power) is unlikely to be more compact as soon as you have more than two generators, also.

I like your Factorization alternative, but I see two problems with it:

1. Again, the user might want the more "raw" data, which we threw away.
2. Suppose you have a group homomorphism defined by the images of the generators, which you stored in a list. How would you evaluate this homomorphism on a given group element? Well, you call the word_problem function, and then you still need to keep doing linear searches on your list of generators to figure out their index. This information was known to the `word_problem` method and you just threw it away...

> I would be happy to fix the `Factorization._repr_` if you like this solution.

What about having a `word_problem` method and a `factor` method? The first one can be as it is now, the `factor` could output a `Factorization` object exactly like you suggest, which would be good for visualizing but maybe not so much for programming.

> Very elegant and very natural!

I do agree ;-).



---

archive/issue_comments_234013.json:
```json
{
    "body": "Replying to [comment:9 mmasdeu]:\n> Replying to [comment:8 vdelecroix]:\n\nDefinitely, it would be good to have several output forms available. Though I do not agree on the way it has to be. First of all, I think that any function that is accessible by user (i.e. not starting with a `_` and with default options) should be 0-based. Moreover, if you want something useful to program morphisms, it would be better if 0-based, isn't it?\n\nFrom the name `word_problem` I would expect a function that gives me precisely the Factorization that I proposed. If you want a more raw level function, which is useful, it would better be `.word_problem(raw=True)` or `._as_prod_of_gens()`. The name `factor` is not common (or please give a reference) and is moreover used for elements not parents\n\n```\nsage: 18.factor()\n2 * 3^2\nsage: ZZ.factor(18)\n...\nAttributeError\n```\n\nI would keep `factor` for factorization over PID or possibly as an alias for `.word_problem`.\n\nAnswering your remark for 0-based to 1-based, I know that these are one liners and I know how to do. But\n- it is additional code\n- the code is ugly\n- it can be avoided\nNote that we interface both pari (the library) and libgap which are 1-based... but\n\n```\nsage: p = pari(\"[1,2,3]\")\nsage: p[1]\n2\nsage: p = libgap.eval(\"[1,2,3]\")\nsage: p[1]\n2\n```\n\nversus\n\n```\nGP/PARI CALCULATOR Version 2.8.0\n? l = [1,2,3];\n? l[1]\n%4 = 1\n```\n\nand\n\n```\nGAP, Version 4.7.7\ngap> l := [1,2,3];;\ngap> l[1];\n1\n```\n\nWhy is that? Because it is natural as we are using Python (and sometimes C)!\n\nVincent",
    "created_at": "2015-04-20T13:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234013",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:9 mmasdeu]:
> Replying to [comment:8 vdelecroix]:

Definitely, it would be good to have several output forms available. Though I do not agree on the way it has to be. First of all, I think that any function that is accessible by user (i.e. not starting with a `_` and with default options) should be 0-based. Moreover, if you want something useful to program morphisms, it would be better if 0-based, isn't it?

From the name `word_problem` I would expect a function that gives me precisely the Factorization that I proposed. If you want a more raw level function, which is useful, it would better be `.word_problem(raw=True)` or `._as_prod_of_gens()`. The name `factor` is not common (or please give a reference) and is moreover used for elements not parents

```
sage: 18.factor()
2 * 3^2
sage: ZZ.factor(18)
...
AttributeError
```

I would keep `factor` for factorization over PID or possibly as an alias for `.word_problem`.

Answering your remark for 0-based to 1-based, I know that these are one liners and I know how to do. But
- it is additional code
- the code is ugly
- it can be avoided
Note that we interface both pari (the library) and libgap which are 1-based... but

```
sage: p = pari("[1,2,3]")
sage: p[1]
2
sage: p = libgap.eval("[1,2,3]")
sage: p[1]
2
```

versus

```
GP/PARI CALCULATOR Version 2.8.0
? l = [1,2,3];
? l[1]
%4 = 1
```

and

```
GAP, Version 4.7.7
gap> l := [1,2,3];;
gap> l[1];
1
```

Why is that? Because it is natural as we are using Python (and sometimes C)!

Vincent



---

archive/issue_comments_234014.json:
```json
{
    "body": "Alternatively, for raw data you can use `-1` for the inverse of `0`. But then, please make sure that the following would work\n\n```\nsage: F.<x,y> = FreeGroup()\nsage: F.gen(-1)\nx^-1\nsage: F.gen(-2)\ny^-1\n```\n\nI do not find it very elegant though.",
    "created_at": "2015-04-20T13:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234014",
    "user": "https://github.com/videlec"
}
```

Alternatively, for raw data you can use `-1` for the inverse of `0`. But then, please make sure that the following would work

```
sage: F.<x,y> = FreeGroup()
sage: F.gen(-1)
x^-1
sage: F.gen(-2)
y^-1
```

I do not find it very elegant though.



---

archive/issue_comments_234015.json:
```json
{
    "body": "The notation should be consistent with the one used for arithgroup_perm. Either change both or make it consistent with arithgroup_perm. One reason why I did not advertise the functionality in the \n**FareySymbol** was that the output of the word problem is that it is inconsistent with the output of sl2z_word_problem ... . Probably one should replace this as well but I would check the timing before removing that part.",
    "created_at": "2015-04-20T13:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234015",
    "user": "https://github.com/monien"
}
```

The notation should be consistent with the one used for arithgroup_perm. Either change both or make it consistent with arithgroup_perm. One reason why I did not advertise the functionality in the 
**FareySymbol** was that the output of the word problem is that it is inconsistent with the output of sl2z_word_problem ... . Probably one should replace this as well but I would check the timing before removing that part.



---

archive/issue_comments_234016.json:
```json
{
    "body": "I don't really think this should be dragged on too much, but here is another example of how Sage works which contradicts some of the examples above:\n\n\n```\nsage: F = FreeGroup(2)\nsage: F\nFree Group on generators {x0, x1}\nsage: F([1])\nx0\n```\n\n\nI agree though with the above comment that it should be consistent with sl2z_word_problem. Maybe a flag in the `word_problem` method is a nearly-optimal solution...",
    "created_at": "2015-04-20T13:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234016",
    "user": "https://github.com/mmasdeu"
}
```

I don't really think this should be dragged on too much, but here is another example of how Sage works which contradicts some of the examples above:


```
sage: F = FreeGroup(2)
sage: F
Free Group on generators {x0, x1}
sage: F([1])
x0
```


I agree though with the above comment that it should be consistent with sl2z_word_problem. Maybe a flag in the `word_problem` method is a nearly-optimal solution...



---

archive/issue_comments_234017.json:
```json
{
    "body": "I agreed with Marc to take a look at this ticket, and now I have done so I am almost regretting it!\nWe surely all agree that the functionality exposed here is something we definitely all want to have aceesible to Sage users.  The only issues are (1) whether to use 1-based or 0-based numbering for the generator indices; and (2) whether the word_problem / factorization function should return the actual generators as matrices, or their indices.\n\nIs that a fiar summary of where we are so far?\n\nIn reply to Marc's worry about having to do a lot of linear searches to find out which generator a given generator is, it would be possible to have a dict of { gens[i]:i } pairs instead.\n\nThere could be two options to the word_problem function.  One could return a list of (gen, exponent) pairs where gen is an actual matrix.  One could return a list of (index, exponent) pairs.   The only option where 0-basing causes difficulties is where what is returned is a simple list of signed indices where +i means the i'th gen while -i means its inverse (and i=0 is not allowed).  To me this looks like a technical internal representation which need not be exposed to the user.\n\nI am only (so far) trying to clarify the remaining issues.  Have I managed that?",
    "created_at": "2015-04-21T11:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234017",
    "user": "https://github.com/JohnCremona"
}
```

I agreed with Marc to take a look at this ticket, and now I have done so I am almost regretting it!
We surely all agree that the functionality exposed here is something we definitely all want to have aceesible to Sage users.  The only issues are (1) whether to use 1-based or 0-based numbering for the generator indices; and (2) whether the word_problem / factorization function should return the actual generators as matrices, or their indices.

Is that a fiar summary of where we are so far?

In reply to Marc's worry about having to do a lot of linear searches to find out which generator a given generator is, it would be possible to have a dict of { gens[i]:i } pairs instead.

There could be two options to the word_problem function.  One could return a list of (gen, exponent) pairs where gen is an actual matrix.  One could return a list of (index, exponent) pairs.   The only option where 0-basing causes difficulties is where what is returned is a simple list of signed indices where +i means the i'th gen while -i means its inverse (and i=0 is not allowed).  To me this looks like a technical internal representation which need not be exposed to the user.

I am only (so far) trying to clarify the remaining issues.  Have I managed that?



---

archive/issue_comments_234018.json:
```json
{
    "body": "Thank you John for the putting things in perspective. After looking at how ``FinitelyPresentedGroup`` and ``FreeGroup`` work:\n\n\n```\nsage: F = FreeGroup(2)\nsage: a = F([1,2,1]); a\nx0*x1*x0\nsage: a.syllables()\n((x0, 1), (x1, 1), (x0, 1))\nsage: a.Tietze()\n(1, 2, 1)\n```\n\n\nI think that the best alternative is to provide three methods: ``Tietze``, ``syllables``, and ``word_problem``. The outputs would be respectively a tuple of integers, a tuple of pairs of integers, and a tuple of pairs (gen,exp) as has been suggested. The documentation will refer to each other, and Tietze will be cached and used by the other two. This will make the outputs compatible with what already exists in Sage.\n\nPlease let me know if that seems a reasonable solution and I will implement it.",
    "created_at": "2015-04-22T16:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234018",
    "user": "https://github.com/mmasdeu"
}
```

Thank you John for the putting things in perspective. After looking at how ``FinitelyPresentedGroup`` and ``FreeGroup`` work:


```
sage: F = FreeGroup(2)
sage: a = F([1,2,1]); a
x0*x1*x0
sage: a.syllables()
((x0, 1), (x1, 1), (x0, 1))
sage: a.Tietze()
(1, 2, 1)
```


I think that the best alternative is to provide three methods: ``Tietze``, ``syllables``, and ``word_problem``. The outputs would be respectively a tuple of integers, a tuple of pairs of integers, and a tuple of pairs (gen,exp) as has been suggested. The documentation will refer to each other, and Tietze will be cached and used by the other two. This will make the outputs compatible with what already exists in Sage.

Please let me know if that seems a reasonable solution and I will implement it.



---

archive/issue_comments_234019.json:
```json
{
    "body": "That sounds very reasonable to me.  Just to make sure of the details:\n\nTietze -- should probably no be capitalised, and returns a list of signed nonzero integers referring to indices of generators based at 1;\n\nsyllables -- the first integer in each pair is a generator index, based at 0 or 1?\n\nword_problem -- no indices are returned so no ambiguity.\n\nI feel that a group theorist should be involved here, so after you have implemented this we could perhaps ask (a friendly) one.   For the last function, it seems odd to me to call a function \"word_problem\" when the function *solves* the word probem!",
    "created_at": "2015-04-23T09:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234019",
    "user": "https://github.com/JohnCremona"
}
```

That sounds very reasonable to me.  Just to make sure of the details:

Tietze -- should probably no be capitalised, and returns a list of signed nonzero integers referring to indices of generators based at 1;

syllables -- the first integer in each pair is a generator index, based at 0 or 1?

word_problem -- no indices are returned so no ambiguity.

I feel that a group theorist should be involved here, so after you have implemented this we could perhaps ask (a friendly) one.   For the last function, it seems odd to me to call a function "word_problem" when the function *solves* the word probem!



---

archive/issue_comments_234020.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-01T10:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234020",
    "user": "https://github.com/mmasdeu"
}
```

New commits:



---

archive/issue_comments_234021.json:
```json
{
    "body": "I have implemented what I suggested (with tietze not capitalized, even if this clashes with another use in Sage).\n\nIf I see a friendly senior computational number theorist around I will ask what he thinks of the solution we have found. For now, I set the ticket to needs-review.\n\nThank you all for the constructive comments!",
    "created_at": "2015-05-01T10:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234021",
    "user": "https://github.com/mmasdeu"
}
```

I have implemented what I suggested (with tietze not capitalized, even if this clashes with another use in Sage).

If I see a friendly senior computational number theorist around I will ask what he thinks of the solution we have found. For now, I set the ticket to needs-review.

Thank you all for the constructive comments!



---

archive/issue_comments_234022.json:
```json
{
    "body": "Hello,\n\nWhen you construct a tuple, there is no need to construct a list first! You can replace\n\n```\ntuple([X for Y in Z])\n```\n\nby\n\n```\ntuple(X for Y in Z)\n```\n\n\nI actually do not like so much the fact the three methods do actually exactly the same job and are called differently... Why not adding an argument to `tietze` or `word_problem` to choose the output type? Can be\n- `\"standard\"`: just with `1,2,3,...` and  `-1,-2,-3,...` as it was (the current `tietze`)\n- `\"gens_index\"`: as pairs `(i,+1)` or `(i,-1)` where `i` is the generator (the current `syllabes`)\n- `\"gens\"`: as pairs `(m,+1)` or `(m,-1)` where `m` is one of the generator (the current `word_problem).\n\nIn the case of `word_problem` above wouldn't it be better to output a list of matrices (that can be either a generator or inverse of a generator)?\n\nThe public method `get_pmats_to_gens` is not appropriate if it has to be public. The names must be complete: `paring_matrices_to_gens_table` or something similar. Again, why is this method `1`-based if there `gens` in the name? Call it `pairing_matrices_to_tietze_index` but do not mention `gens` if it has to be `1`-based.\n\nStill in `get_pmats_to_gens`, why not using `cached_method` if you need to cache the result? By the way, is there really a need to make it cached?\n\nStill in `get_pmats_to_gens`, this `try/except` blocks are ugly. Moreover, doing `l.index` is a linear search through a list. So I would rather do\n\n```\ngens_dict = {g:i for i,g in enumerate(self.generators())}\nans = []\nfor pm in self.pairing_matrices():\n    if pm in gens_dict:\n        ans.append(gens_dict[pm])\n        continue\n    m = -pm\n    if m in gens_dict:\n        ans.append(gens_dict[m])\n        continue\n    m = ~pm\n    if m in gens_dict:\n        ans.append(-gens_dict[m])\n        continue\n    m = -m\n    if m in gens_dict:\n        ans.append(-gens_dict[m])\n        continue\n    raise RuntimeError(\"this should not happen, right?\")\n\nreturn ans\n```\n\n\nVincent",
    "created_at": "2015-05-02T10:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234022",
    "user": "https://github.com/videlec"
}
```

Hello,

When you construct a tuple, there is no need to construct a list first! You can replace

```
tuple([X for Y in Z])
```

by

```
tuple(X for Y in Z)
```


I actually do not like so much the fact the three methods do actually exactly the same job and are called differently... Why not adding an argument to `tietze` or `word_problem` to choose the output type? Can be
- `"standard"`: just with `1,2,3,...` and  `-1,-2,-3,...` as it was (the current `tietze`)
- `"gens_index"`: as pairs `(i,+1)` or `(i,-1)` where `i` is the generator (the current `syllabes`)
- `"gens"`: as pairs `(m,+1)` or `(m,-1)` where `m` is one of the generator (the current `word_problem).

In the case of `word_problem` above wouldn't it be better to output a list of matrices (that can be either a generator or inverse of a generator)?

The public method `get_pmats_to_gens` is not appropriate if it has to be public. The names must be complete: `paring_matrices_to_gens_table` or something similar. Again, why is this method `1`-based if there `gens` in the name? Call it `pairing_matrices_to_tietze_index` but do not mention `gens` if it has to be `1`-based.

Still in `get_pmats_to_gens`, why not using `cached_method` if you need to cache the result? By the way, is there really a need to make it cached?

Still in `get_pmats_to_gens`, this `try/except` blocks are ugly. Moreover, doing `l.index` is a linear search through a list. So I would rather do

```
gens_dict = {g:i for i,g in enumerate(self.generators())}
ans = []
for pm in self.pairing_matrices():
    if pm in gens_dict:
        ans.append(gens_dict[pm])
        continue
    m = -pm
    if m in gens_dict:
        ans.append(gens_dict[m])
        continue
    m = ~pm
    if m in gens_dict:
        ans.append(-gens_dict[m])
        continue
    m = -m
    if m in gens_dict:
        ans.append(-gens_dict[m])
        continue
    raise RuntimeError("this should not happen, right?")

return ans
```


Vincent



---

archive/issue_comments_234023.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-02T10:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234023",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234024.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-07T17:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234025.json:
```json
{
    "body": "I have just pushed a new version. Some comments:\n\n1) In the timings I had, it look like it was faster to create the tuple out of the list instead of the generator expression. But I have changed it as you proposed.\n\n2) I have reverted back to one single function as you proposed. The output is as both John and myself had decided: the exponents can be any nonzero integer, not just +1 or -1. I have applications for this kind of output and so may have other potential users.\n\n3) I use now cached_method instead manual caching. I changed the try/except blocks with a more elegant solution (I think it is better than what you suggest --which also doesn't work because matrices in SL2Z do not have a unary \"-\"--, since it uses half the queries in a dictionary).\n\nI do hope that this is close to finished!",
    "created_at": "2015-05-07T19:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234025",
    "user": "https://github.com/mmasdeu"
}
```

I have just pushed a new version. Some comments:

1) In the timings I had, it look like it was faster to create the tuple out of the list instead of the generator expression. But I have changed it as you proposed.

2) I have reverted back to one single function as you proposed. The output is as both John and myself had decided: the exponents can be any nonzero integer, not just +1 or -1. I have applications for this kind of output and so may have other potential users.

3) I use now cached_method instead manual caching. I changed the try/except blocks with a more elegant solution (I think it is better than what you suggest --which also doesn't work because matrices in SL2Z do not have a unary "-"--, since it uses half the queries in a dictionary).

I do hope that this is close to finished!



---

archive/issue_comments_234026.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-07T19:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234026",
    "user": "https://github.com/mmasdeu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234027.json:
```json
{
    "body": "Hello,\n\nReplying to [comment:21 mmasdeu]:\n> 1) In the timings I had, it look like it was faster to create the tuple out of the list instead of the generator expression. But I have changed it as you proposed.\n\nLooks strange! I do not understand why `[i for i in l]` should be faster than `tuple(i for i in l)`...\n\n> 2) I have reverted back to one single function as you proposed. The output is as both John and myself had decided: the exponents can be any nonzero integer, not just +1 or -1. I have applications for this kind of output and so may have other potential users.\n\nThanks.\n\n> 3) I use now cached_method instead manual caching. I changed the try/except blocks with a more elegant solution (I think it is better than what you suggest --which also doesn't work because matrices in SL2Z do not have a unary \"-\"--, since it uses half the queries in a dictionary).\n\nNice. Do you know why SL2Z matrices do not have a unary `-`? \n\nVincent",
    "created_at": "2015-05-07T20:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234027",
    "user": "https://github.com/videlec"
}
```

Hello,

Replying to [comment:21 mmasdeu]:
> 1) In the timings I had, it look like it was faster to create the tuple out of the list instead of the generator expression. But I have changed it as you proposed.

Looks strange! I do not understand why `[i for i in l]` should be faster than `tuple(i for i in l)`...

> 2) I have reverted back to one single function as you proposed. The output is as both John and myself had decided: the exponents can be any nonzero integer, not just +1 or -1. I have applications for this kind of output and so may have other potential users.

Thanks.

> 3) I use now cached_method instead manual caching. I changed the try/except blocks with a more elegant solution (I think it is better than what you suggest --which also doesn't work because matrices in SL2Z do not have a unary "-"--, since it uses half the queries in a dictionary).

Nice. Do you know why SL2Z matrices do not have a unary `-`? 

Vincent



---

archive/issue_comments_234028.json:
```json
{
    "body": "I am happy with this now, and think we should accept it, leaving further issues to follow-ups.",
    "created_at": "2015-05-09T12:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234028",
    "user": "https://github.com/JohnCremona"
}
```

I am happy with this now, and think we should accept it, leaving further issues to follow-ups.



---

archive/issue_comments_234029.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-09T12:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234029",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_234030.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-12T22:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17555#issuecomment-234030",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_016911.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-05-12T22:15:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17555",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17555#event-16911"
}
```
