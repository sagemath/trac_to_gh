# Issue 12939: variable camera position, light, etc. for tachyon ray tracer

Issue created by migration from https://trac.sagemath.org/ticket/13111

Original creator: dkrenn

Original creation time: 2012-06-13 19:10:23

Assignee: jason, was

CC:  egourgoulhon @mjungmath jipilab

Keywords: camera light tachyon

When using the tachyon ray tracer, at the moment the parameters for the camera, as well as for the light and for the background-plane are hard-coded in `sage/plot/plot3d/base.pyx`:

```
    def tachyon(self):
    ...
         camera
            zoom 1.0
            aspectratio 1.0
            antialiasing %s
            raydepth 8
            center  2.3 2.4 2.0
            viewdir  -2.3 -2.4 -2.0
            updir  0.0 0.0 1.0
         end_camera

      light center  4.0 3.0 2.0
            rad 0.2
            color  1.0 1.0 1.0

      plane
        center -2000 -1000 -500
        normal 2.3 2.4 2.0
        TEXTURE
            AMBIENT 1.0 DIFFUSE 1.0 SPECULAR 1.0 OPACITY 1.0
            COLOR 1.0 1.0 1.0
            TEXFUNC 0
```

Those things should be variable, i.e. it should be possible to pass those parameters by optional parameters (e.g. when calling `show`).


---

Comment by git created at 2021-01-24 02:04:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-24 04:26:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by guenterrote created at 2021-01-24 04:35:53

Changing status from new to needs_review.


---

Comment by guenterrote created at 2021-01-24 04:35:53

I fixed the tachyon viewer. (I did not touch the other viewers, although there would be some room for improvements too)


---

Comment by git created at 2021-01-24 17:18:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by guenterrote created at 2021-02-08 19:31:02

I don't know what I'm doing (I wanted to change the branch to a public branch)
----
New commits:


---

Comment by guenterrote created at 2021-02-08 19:55:29

This is the long-awaited possibility to control many aspects of the tachyon viewer by
options of the `show()` method.
All available options are now properly documented.

(The tachyon viewer has now more available controls than the default threejs viewer, but
reorganizing the threejs options would be another project with a separate ticket.)

I also added an overview comparing the different viewer choices, and some warnings about some unexpected behaviour of certain viewers.
(There is also some code for a so-called `"wavefront"` viewer. Is that obsolete?)


---

Comment by slelievre created at 2021-03-22 20:15:17

Please add full name in author field.


---

Comment by git created at 2021-03-23 10:31:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-23 12:42:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2021-03-23 18:57:49

This is not proper english

``` 
The most important facts about these classes are
hat you can add simply add graphics objects
together
```



---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by git created at 2021-03-24 06:13:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-24 07:02:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LaisRast created at 2021-03-24 10:43:14

All of these comments are related to the parameter `camera_center`:

* In `plot/base.pyz`, two examples still use the old parameter `camera_center`. However it will be ignored since it is not in `tachyon_keywords`:

```
            sage: p.show(viewer="tachyon",camera_center=(4,0,0))
            sage: p.show(viewer="tachyon",camera_center=(2,2,0.3),aspect_ratio=1)
}}} 
* Instead of removing a parameter from a function directly, a `DeprecationWarning` should be raised for some time before removing the parameter entirely. This makes sure that old examples still behave the same and tells the user to switch to the new parameter.

* In `threejs_template.html`, when clicking on `Get camera` option, it copies `',camera_center=' + cam_position` (the old parameter name). I also suggest to only copy the value of camera position, not with the whole sentence. This makes it similar to what `Copy Viewpoint` does. 
{{{#!diff
-        textArea.textContent = ',camera_center=' + cam_position;
+        textArea.textContent = cam_position;
}}}


---

Comment by @LaisRast created at 2021-03-24 10:43:14

Changing status from needs_review to needs_work.


---

Comment by guenterrote created at 2021-03-26 02:38:36

Replying to [comment:22 gh-LaisRast]:
> * Instead of removing a parameter from a function directly, a `DeprecationWarning` should be raised for some time before removing the parameter entirely. This makes sure that old examples still behave the same and tells the user to switch to the new parameter.
> 

The old name `camera_center` was the name I chose initially, following the convention of the Tachyon object.
https://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/tachyon.html

I chose to rename it because "camera position" is what is commonly used in computer graphics, but it has never been a parameter of show() or the tachyon() function before I introduced it; so there is no need to deprecate it.

(But I have to fix the few places where I forgot to change it.)


---

Comment by guenterrote created at 2021-03-26 02:41:55

Replying to [comment:22 gh-LaisRast]:
> * In `threejs_template.html`, when clicking on `Get camera` option, it copies `',camera_center=' + cam_position` (the old parameter name). I also suggest to only copy the value of camera position, not with the whole sentence. This makes it similar to what `Copy Viewpoint` does. 

I found it annoying that I had to write the parameter name (and perhaps look it up) myself when I used `Copy Viewpoint`. There is hardly any conceivable use for `Get camera` than to insert the result into the parameter list.


---

Comment by git created at 2021-03-26 02:47:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by guenterrote created at 2021-03-26 03:00:20

Changing status from needs_work to needs_review.


---

Comment by @LaisRast created at 2021-03-26 16:21:59

* An example in the docstring of `sage.geometry.polyhedron.plot.Projection.render_wireframe_3d` fails due to the changes of this ticket.
* In `threejs_template.html`: "Get camera" -> "Get Camera" to make the UI consistent. (Just a suggestion)
* Remove old lines of code instead of commenting them out.
* Comments indentation should match indentation of the block they are in. For instance, the heading before `tachyon_keywords`.
* Did you mean to include all the below under the warning? 

```diff
         .. WARNING::
 
-         By default, the jmol and tachyon viewers perform
-         some non-uniform scaling of the axes.
-
-        If this is not desired, one can set ``aspect_ratio=1``::
-
-            sage: p = plot3d(lambda u,v:(cos(u)-cos(v)), (-0.2,0.2),(-0.2,0.2))
-            sage: p.show(viewer="threejs")
-            sage: p.show(viewer="jmol")
-            sage: p.show(viewer="jmol",aspect_ratio=1)
-            sage: p.show(viewer="tachyon",camera_position=(4,0,0))
-            sage: p.show(viewer="tachyon",camera_position=(2,2,0.3),aspect_ratio=1)
+            By default, the jmol and tachyon viewers perform
+            some non-uniform scaling of the axes.
+
+            If this is not desired, one can set ``aspect_ratio=1``::
+
+                sage: p = plot3d(lambda u,v:(cos(u)-cos(v)), (-0.2,0.2),(-0.2,0.2))
+                sage: p.show(viewer="threejs")
+                sage: p.show(viewer="jmol")
+                sage: p.show(viewer="jmol",aspect_ratio=1)
+                sage: p.show(viewer="tachyon",camera_position=(4,0,0))
+                sage: p.show(viewer="tachyon",camera_position=(2,2,0.3),aspect_ratio=1)
```

If not, just make the indentation to 4 spaces in the paragraph starting with "By default..."
* In the function `_flip_orientation`, did you mean Javascript (threejs) instead of Java, or you meant jmol? Also the first word in the docstring of this function should be capitalized.

Other than that, this ticket looks good to me.


---

Comment by @LaisRast created at 2021-03-26 16:21:59

Changing status from needs_review to needs_work.


---

Comment by guenterrote created at 2021-03-27 10:44:47

Replying to [comment:27 gh-LaisRast]:
> * An example in the docstring of `sage.geometry.polyhedron.plot.Projection.render_wireframe_3d` fails due to the changes of this ticket.

Fixed. (Anyway, what is the purpose of that test? Somebody adds a line to the beginning
of the tachyon output, then that test must be updated.)

> * In `threejs_template.html`: "Get camera" -> "Get Camera" to make the UI consistent. (Just a suggestion)

I have changed "Get Viewpoint" to "Get viewpoint" for consistency.

> {{{#!diff
>          .. WARNING::
>  
> -         By default, the jmol and tachyon viewers perform
> -         some non-uniform scaling of the axes.
> }}}
> If not, just make the indentation to 4 spaces in the paragraph starting with "By default..."

No, I indeed want only a short warning. On my system, the following text comes out separate from the warning in the html doc. I have now increased the indentation of the warning to 4 (extra) spaces. The result looks the same as before.

> * In the function `_flip_orientation`, did you mean Javascript (threejs) instead of Java, or you meant jmol? Also the first word in the docstring of this function should be capitalized.
> 

I factored this function out from some other part
of the program (copying the comment), but I don't understand why it is there.


---

Comment by git created at 2021-03-27 10:46:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by guenterrote created at 2021-03-27 12:12:26

Changing status from needs_work to needs_review.


---

Comment by @LaisRast created at 2021-03-27 13:11:59

Replying to [comment:28 guenterrote]:

> Fixed. (Anyway, what is the purpose of that test? Somebody adds a line to the beginning
> of the tachyon output, then that test must be updated.)
I agree. 

> I have now increased the indentation of the warning to 4 (extra) spaces. The result looks the same as before. 
Yes, the result looks the same. It is just a general convention to use 4 spaces.

The tickets looks go to me, and thus I will put it on positive review once the patchbot finishes.


---

Comment by @LaisRast created at 2021-03-27 14:40:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-05-27 20:30:43

Resolution: fixed
