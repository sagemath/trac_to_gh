# Issue 23489: Find roots of polynomials in subrings of the base ring via filtering

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2017-08-26 11:15:02

Implement a fallback rootfinder that looks for roots in the polynomial base ring and filters the ones belonging to a subring, in order to make things like

```
sage: Pols.<x> = QQ[]
sage: ((x^2 - 1/2)*(x^2 - 1)).roots(ZZ)
[(1, 1), (-1, 1)]
```

work.


---

Comment by mmezzarobba created at 2017-08-26 11:15:27

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-08-26 14:21:01

What is the point of

```
if not multiplicities:
    rts_K = [(rt, None) for rt in rts_K]
```



---

Comment by mmezzarobba created at 2017-08-26 14:37:09

Replying to [comment:2 vdelecroix]:
> What is the point of
> {{{
> if not multiplicities:
>     rts_K = [(rt, None) for rt in rts_K]
> }}}

It is better to call `self.roots()` with the value of `multiplicities` with which we were called, because `roots()` might be implemented only in the case `multiplicities=False` (though that's unlikely over exact rings). And I found it clearer to write the loop that follows as

```
for xK, mult in rts_K:
    ...
```

instead of making a distinction there.


---

Comment by vdelecroix created at 2017-08-27 20:46:42

Why not

```
if xK in L:
    rts_L.append((L(xK), mult))
```



---

Comment by mmezzarobba created at 2017-08-28 08:00:47

Replying to [comment:4 vdelecroix]:
> Why not
> {{{
> if xK in L:
>     rts_L.append((L(xK), mult))
> }}}

To avoid doing the conversion twice.


---

Comment by mmezzarobba created at 2017-08-30 09:28:06

(All tests pass in spite of the yellow patchbot icon, see the complete patchbot report.)


---

Comment by vdelecroix created at 2017-09-02 00:04:47

I would do some stronger type checking (ie `L` should be a subring and there should be a coercion to `base_ring`)

```
sage: ZZ.is_subring(QQ)
True
sage: QQ.has_coerce_map_from(ZZ)
True
```

And possibly use `.section()`

```
sage: f = QQ.coerce_map_from(ZZ).section()
sage: f
Generic map:
  From: Rational Field
  To:   Integer Ring
sage: f(2)
2
sage: f(2/3)
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```



---

Comment by mmezzarobba created at 2017-09-02 08:38:13

Thanks for you suggestions!

Replying to [comment:7 vdelecroix]:
> I would do some stronger type checking (ie `L` should be a subring and there should be a coercion to `base_ring`)
> {{{
> sage: ZZ.is_subring(QQ)
> True
> sage: QQ.has_coerce_map_from(ZZ)
> True
> }}}

Wouldn't that be redundant? What `is_subring()` does is check that the “natural map” between the two rings is injective, and `sage.rings.homset.RingHomset_generic` defines the natural map as the coercion morphism (if there is one).

> And possibly use `.section()`
> {{{
> sage: f = QQ.coerce_map_from(ZZ).section()
> sage: f
> Generic map:
>   From: Rational Field
>   To:   Integer Ring
> sage: f(2)
> 2
> sage: f(2/3)
> Traceback (most recent call last):
> ...
> TypeError: no conversion of this rational to integer
> }}}

Most coercion morphisms don't have an explicit section, even when the satisfy the requirements I'm setting here. For example, `sage: QQ['x'].coerce_map_from(ZZ).section()` is `None`.


---

Comment by vdelecroix created at 2017-09-02 16:55:55

Replying to [comment:8 mmezzarobba]:
> Thanks for you suggestions!
> 
> Replying to [comment:7 vdelecroix]:
> > I would do some stronger type checking (ie `L` should be a subring and there should be a coercion to `base_ring`)
> > {{{
> > sage: ZZ.is_subring(QQ)
> > True
> > sage: QQ.has_coerce_map_from(ZZ)
> > True
> > }}}
> 
> Wouldn't that be redundant? What `is_subring()` does is check that the “natural map” between the two rings is injective, and `sage.rings.homset.RingHomset_generic` defines the natural map as the coercion morphism (if there is one).

Indeed, `is_subring` alone should do the job!

> > And possibly use `.section()`
> > {{{
> > sage: f = QQ.coerce_map_from(ZZ).section()
> > sage: f
> > Generic map:
> >   From: Rational Field
> >   To:   Integer Ring
> > sage: f(2)
> > 2
> > sage: f(2/3)
> > Traceback (most recent call last):
> > ...
> > TypeError: no conversion of this rational to integer
> > }}}
> 
> Most coercion morphisms don't have an explicit section, even when they satisfy the requirements I'm setting here. For example, `sage: QQ['x'].coerce_map_from(ZZ).section()` is `None`.

That was a suggestion. I think this is the cleanest way to go (that would benefit in other parts of Sage). If you choose to use it the implementation of sections has to be improved in another ticket!


---

Comment by mmezzarobba created at 2017-09-03 15:49:38

Replying to [comment:9 vdelecroix]:
> That was a suggestion. I think this is the cleanest way to go (that would benefit in other parts of Sage). If you choose to use it the implementation of sections has to be improved in another ticket!

I would prefer to keep this ticket as it is for now, and consider switching to using `section()` once sections become more powerful.


---

Comment by vdelecroix created at 2017-09-03 15:52:49

Replying to [comment:10 mmezzarobba]:
> Replying to [comment:9 vdelecroix]:
> > That was a suggestion. I think this is the cleanest way to go (that would benefit in other parts of Sage). If you choose to use it the implementation of sections has to be improved in another ticket!
> 
> I would prefer to keep this ticket as it is for now, and consider switching to using `section()` once sections become more powerful.

Waiting for a miracle? If you do not help it, it will not happen.


---

Comment by mmezzarobba created at 2017-09-03 16:01:05

Replying to [comment:11 vdelecroix]:
> Waiting for a miracle? If you do not help it, it will not happen.

I might work on it someday, but for now, I have other things on my todo-list for sage that I consider much more important. I think the feature the present ticket provides would already be useful in the meantime.


---

Comment by soehms created at 2019-01-19 16:43:39

I'm not a miracle, but maybe I can help to have this ticket go ahead. Indeed, it's a pity that the implementation of a `section` method is rarely done. I can offer support at this point:

I've created a ticket #27081 for the implementation of a `section` method for composite maps. This would cover the example `QQ['x'].coerce_map_from(ZZ).section()` above.

My feeling is, that in general the overhead to implement `section` is to high. This maybe the reason, that it is missing in many situations where it could be obtained easily from an existing method, for example the `lift` method of GAP group homomorphism (I recently did that in ticket #26750).

Other examples where a section as a python function exist, but is not used to implement `section` are `_element_constructor_` methods of a natural map's domain. An example for this are coercion maps between number fields:


```
sage: CF3 = CyclotomicField(3)
sage: CF9 = CyclotomicField(9)
sage: PCF9.<v> = CF9[]
sage: p = v**9 -1
sage: p.roots(CF3)
[(1, 1), (zeta3, 1), (-zeta3 - 1, 1)]
sage: emb = CF9.coerce_map_from(CF3)
sage: emb.section() is None
True
```


This example is working with this ticket, but would not work if `section` would be used. But, in this case a `section` method could be obtained easily from the element construction.

My suggestion to have sections being implemented more easily is the following:

1. Implement new generic methods `_section_function` in `sage.categories.map.Map` and `_natural_map_section_function` in `sage.structure.parent.Parent` such that they `return None` by default.

2. Extend the class `Section` (or implement a special subclass for that purpose) such that the supported python function can be used in its `_call_` method.

3. In `section` look if the new methods (according to 1.) support functions to obtain a section. If so, return an instance of `Section` (according to 2.).

I offer to work on such an enhancement, if you consider it to be reasonable!


---

Comment by @varenyamBakshi created at 2020-02-22 17:47:40

Changing status from needs_review to needs_work.


---

Comment by @varenyamBakshi created at 2020-02-22 17:47:40

as work needs to be done on this issue so there is no point of it being in 'needs_review' status. therefore i changed its status


---

Comment by git created at 2020-08-19 08:01:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2020-08-19 08:02:08

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2020-08-19 08:02:08

Rebased and updated to use the improved section infrastructure.


---

Comment by mmezzarobba created at 2020-08-20 11:32:48

`@`Varenyam bakshi: I'm removing you from the Reviewers field to make it clear that this ticket is still waiting for a reviewer, since you didn't comment on the code. Please do put your name back if you intend to review the code.


---

Comment by vdelecroix created at 2020-10-10 21:05:57

This is definitely an improvement.


---

Comment by vdelecroix created at 2020-10-10 21:05:57

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2020-10-11 07:29:42

Thank you!


---

Comment by vbraun created at 2020-10-31 18:07:51

Resolution: fixed
