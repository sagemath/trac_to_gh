# Issue 21290: Allow SAGE_LOCAL to be customized - follow-up

Issue created by migration from https://trac.sagemath.org/ticket/21527

Original creator: mkoeppe

Original creation time: 2016-09-18 05:43:34

CC:  jdemeyer fbissey vdelecroix vbraun rbeezer slelievre tmonteil nthiery embray

Followup on #21501:
Some more places with 'local' hardcoded:
 
 - from fbissey (#21501, comment 18): I am expecting the link `src/doc/common/themes/sage/static/thebe.js` which is pointing to `../../../../../../local/share/thebe/thebe.js` to be dangling for you. I have no solution for you, I usually deal with those at the package manager level. Although in that particular case I just added `thebe.js` to the source in place.

 - Makefile target micro_release has hardcoded "local".


---

Comment by fbissey created at 2016-09-18 08:37:49

The link didn't cause any trouble so far because it is not tested in any way. But I complained that the link was going to cause trouble in #20690#comment:47 I didn't expect it to happen so soon. Its use is not currently tested in any way so doctest didn't spot that it was dangling.


---

Comment by mkoeppe created at 2016-09-18 17:43:14

Cc'ing people who worked on the Thebe ticket #20690. 
This needs fixing. Having a symbolic link like that in the source tree is just not sustainable.


---

Comment by jdemeyer created at 2016-09-18 20:00:14

Splitting this ticket in two: see also #21534.


---

Comment by nthiery created at 2016-09-19 13:02:19

I don't have a good suggestion for what to do with thebe.js.  It's a
general problem: we are lacking a clean solution for managing the
javascript packages Sage depends on. Reverting to the first
implementation of #20690 (including thebe.js directly in Sage's lib)
is indeed on the ugly side. But this is a simple solution that seems
to actually ease the life of our packagers for now, and we are already
doing that for mathjax.


---

Comment by jdemeyer created at 2016-09-19 13:26:01

Replying to [comment:7 nthiery]:
> and we are already doing that for mathjax.

What are we doing for mathjax? I cannot really find how we make mathjax work, but it's certainly _not_ the same way as we do with `thebe.js`.


---

Comment by tmonteil created at 2016-09-19 13:36:55

Replying to [comment:7 nthiery]:
> I don't have a good suggestion for what to do with thebe.js.  It's a
> general problem: we are lacking a clean solution for managing the
> javascript packages Sage depends on. Reverting to the first
> implementation of #20690 (including thebe.js directly in Sage's lib)
> is indeed on the ugly side. But this is a simple solution that seems
> to actually ease the life of our packagers for now, and we are already
> doing that for mathjax.

This is not true, mathjax is installed separately for a while now (it used to be bundled with sagenb, and was made a spkg to avoid duplication since jupyter also depends on mathjax).

For sagenb, it also uses symlink, the only difference is that the symlink is installed during sagenb's `spkg-install` (in particular, both sides of the symlink belong to the `SAGE_LOCAL` directory, which i guess is why no downstream packager complained). As i told in the previous ticket, there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.

The use of symlink at install time used to be the case for jupyter as well, but it seems not to be the case anymore, so perhaps we could try to mimic the jupyter way (i have no idea how mathjax and jupyter are currently linked).


---

Comment by mkoeppe created at 2016-10-03 03:29:03

Replying to [comment:9 tmonteil]:
> there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.

Sounds good - could you prepare a patch for that? 
If no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.


---

Comment by mkoeppe created at 2016-10-09 18:08:44

Changing priority from major to blocker.


---

Comment by jdemeyer created at 2016-10-09 18:13:00

I don't really think this is a blocker... it still works with the default `SAGE_LOCAL`. Given that we don't really officially support changing `SAGE_LOCAL`, I don't think this is so urgent.


---

Comment by vbraun created at 2016-10-11 22:41:36

Changing priority from blocker to major.


---

Comment by tmonteil created at 2016-10-16 19:38:35

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 tmonteil]:
> > there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.
> 
> Sounds good - could you prepare a patch for that? 
> If no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.

I will do that, but i have to say that i will be very buzy during ther next 3 weeks, so it might take some time.


---

Comment by mkoeppe created at 2016-10-16 19:40:26

OK, I've changed the milestone.


---

Comment by mkoeppe created at 2016-12-04 01:11:10

*ping*


---

Comment by mkoeppe created at 2016-12-29 17:24:00

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2016-12-29 17:24:00

Apparently fixed in #22061.


---

Comment by embray created at 2016-12-29 20:34:02

Ah, didn't see this ticket before. Yes, should be addressed by #22061, hopefully.


---

Comment by fbissey created at 2016-12-29 20:36:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 18:03:11

Resolution: invalid
