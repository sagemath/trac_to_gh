# Issue 21290: Allow SAGE_LOCAL to be customized - follow-up

archive/issues_021290.json:
```json
{
    "body": "CC:  @jdemeyer @kiwifb @videlec @vbraun @rbeezer @slel tmonteil @nthiery @embray\n\nFollowup on #21501:\nSome more places with 'local' hardcoded:\n \n- from fbissey (#21501, comment 18): I am expecting the link `src/doc/common/themes/sage/static/thebe.js` which is pointing to `../../../../../../local/share/thebe/thebe.js` to be dangling for you. I have no solution for you, I usually deal with those at the package manager level. Although in that particular case I just added `thebe.js` to the source in place.\n\n- Makefile target micro_release has hardcoded \"local\".\n\nIssue created by migration from https://trac.sagemath.org/ticket/21527\n\n",
    "created_at": "2016-09-18T05:43:34Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Allow SAGE_LOCAL to be customized - follow-up",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21290",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jdemeyer @kiwifb @videlec @vbraun @rbeezer @slel tmonteil @nthiery @embray

Followup on #21501:
Some more places with 'local' hardcoded:
 
- from fbissey (#21501, comment 18): I am expecting the link `src/doc/common/themes/sage/static/thebe.js` which is pointing to `../../../../../../local/share/thebe/thebe.js` to be dangling for you. I have no solution for you, I usually deal with those at the package manager level. Although in that particular case I just added `thebe.js` to the source in place.

- Makefile target micro_release has hardcoded "local".

Issue created by migration from https://trac.sagemath.org/ticket/21527





---

archive/issue_comments_295163.json:
```json
{
    "body": "The link didn't cause any trouble so far because it is not tested in any way. But I complained that the link was going to cause trouble in #20690#comment:47 I didn't expect it to happen so soon. Its use is not currently tested in any way so doctest didn't spot that it was dangling.",
    "created_at": "2016-09-18T08:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295163",
    "user": "https://github.com/kiwifb"
}
```

The link didn't cause any trouble so far because it is not tested in any way. But I complained that the link was going to cause trouble in #20690#comment:47 I didn't expect it to happen so soon. Its use is not currently tested in any way so doctest didn't spot that it was dangling.



---

archive/issue_comments_295164.json:
```json
{
    "body": "Cc'ing people who worked on the Thebe ticket #20690. \nThis needs fixing. Having a symbolic link like that in the source tree is just not sustainable.",
    "created_at": "2016-09-18T17:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295164",
    "user": "https://github.com/mkoeppe"
}
```

Cc'ing people who worked on the Thebe ticket #20690. 
This needs fixing. Having a symbolic link like that in the source tree is just not sustainable.



---

archive/issue_comments_295165.json:
```json
{
    "body": "Splitting this ticket in two: see also #21534.",
    "created_at": "2016-09-18T20:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295165",
    "user": "https://github.com/jdemeyer"
}
```

Splitting this ticket in two: see also #21534.



---

archive/issue_comments_295166.json:
```json
{
    "body": "I don't have a good suggestion for what to do with thebe.js.  It's a\ngeneral problem: we are lacking a clean solution for managing the\njavascript packages Sage depends on. Reverting to the first\nimplementation of #20690 (including thebe.js directly in Sage's lib)\nis indeed on the ugly side. But this is a simple solution that seems\nto actually ease the life of our packagers for now, and we are already\ndoing that for mathjax.",
    "created_at": "2016-09-19T13:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295166",
    "user": "https://github.com/nthiery"
}
```

I don't have a good suggestion for what to do with thebe.js.  It's a
general problem: we are lacking a clean solution for managing the
javascript packages Sage depends on. Reverting to the first
implementation of #20690 (including thebe.js directly in Sage's lib)
is indeed on the ugly side. But this is a simple solution that seems
to actually ease the life of our packagers for now, and we are already
doing that for mathjax.



---

archive/issue_comments_295167.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> and we are already doing that for mathjax.\n\nWhat are we doing for mathjax? I cannot really find how we make mathjax work, but it's certainly *not* the same way as we do with `thebe.js`.",
    "created_at": "2016-09-19T13:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295167",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 nthiery]:
> and we are already doing that for mathjax.

What are we doing for mathjax? I cannot really find how we make mathjax work, but it's certainly *not* the same way as we do with `thebe.js`.



---

archive/issue_comments_295168.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> I don't have a good suggestion for what to do with thebe.js.  It's a\n> general problem: we are lacking a clean solution for managing the\n> javascript packages Sage depends on. Reverting to the first\n> implementation of #20690 (including thebe.js directly in Sage's lib)\n> is indeed on the ugly side. But this is a simple solution that seems\n> to actually ease the life of our packagers for now, and we are already\n> doing that for mathjax.\n\nThis is not true, mathjax is installed separately for a while now (it used to be bundled with sagenb, and was made a spkg to avoid duplication since jupyter also depends on mathjax).\n\nFor sagenb, it also uses symlink, the only difference is that the symlink is installed during sagenb's `spkg-install` (in particular, both sides of the symlink belong to the `SAGE_LOCAL` directory, which i guess is why no downstream packager complained). As i told in the previous ticket, there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.\n\nThe use of symlink at install time used to be the case for jupyter as well, but it seems not to be the case anymore, so perhaps we could try to mimic the jupyter way (i have no idea how mathjax and jupyter are currently linked).",
    "created_at": "2016-09-19T13:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295168",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:7 nthiery]:
> I don't have a good suggestion for what to do with thebe.js.  It's a
> general problem: we are lacking a clean solution for managing the
> javascript packages Sage depends on. Reverting to the first
> implementation of #20690 (including thebe.js directly in Sage's lib)
> is indeed on the ugly side. But this is a simple solution that seems
> to actually ease the life of our packagers for now, and we are already
> doing that for mathjax.

This is not true, mathjax is installed separately for a while now (it used to be bundled with sagenb, and was made a spkg to avoid duplication since jupyter also depends on mathjax).

For sagenb, it also uses symlink, the only difference is that the symlink is installed during sagenb's `spkg-install` (in particular, both sides of the symlink belong to the `SAGE_LOCAL` directory, which i guess is why no downstream packager complained). As i told in the previous ticket, there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.

The use of symlink at install time used to be the case for jupyter as well, but it seems not to be the case anymore, so perhaps we could try to mimic the jupyter way (i have no idea how mathjax and jupyter are currently linked).



---

archive/issue_comments_295169.json:
```json
{
    "body": "Replying to [comment:9 tmonteil]:\n> there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.\n\nSounds good - could you prepare a patch for that? \nIf no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.",
    "created_at": "2016-10-03T03:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295169",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:9 tmonteil]:
> there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.

Sounds good - could you prepare a patch for that? 
If no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.



---

archive/issue_comments_295170.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2016-10-09T18:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295170",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_295171.json:
```json
{
    "body": "I don't really think this is a blocker... it still works with the default `SAGE_LOCAL`. Given that we don't really officially support changing `SAGE_LOCAL`, I don't think this is so urgent.",
    "created_at": "2016-10-09T18:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295171",
    "user": "https://github.com/jdemeyer"
}
```

I don't really think this is a blocker... it still works with the default `SAGE_LOCAL`. Given that we don't really officially support changing `SAGE_LOCAL`, I don't think this is so urgent.



---

archive/issue_comments_295172.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> Replying to [comment:9 tmonteil]:\n> > there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.\n> \n> Sounds good - could you prepare a patch for that? \n> If no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.\n\nI will do that, but i have to say that i will be very buzy during ther next 3 weeks, so it might take some time.",
    "created_at": "2016-10-16T19:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295172",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 tmonteil]:
> > there is no docbuild pkg where to install the symlink, but we can try to set is somewhere in the docbuild script, so that both sides of the symlink are done within the `SAGE_LOCAL` directory.
> 
> Sounds good - could you prepare a patch for that? 
> If no better place can be found, I suppose it would even be OK to make the symlink in one of the doc-related targets of `build/make/deps`.

I will do that, but i have to say that i will be very buzy during ther next 3 weeks, so it might take some time.



---

archive/issue_comments_295173.json:
```json
{
    "body": "OK, I've changed the milestone.",
    "created_at": "2016-10-16T19:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295173",
    "user": "https://github.com/mkoeppe"
}
```

OK, I've changed the milestone.



---

archive/issue_comments_295174.json:
```json
{
    "body": "*ping*",
    "created_at": "2016-12-04T01:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295174",
    "user": "https://github.com/mkoeppe"
}
```

*ping*



---

archive/issue_comments_295175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-29T17:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295175",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_295176.json:
```json
{
    "body": "Apparently fixed in #22061.",
    "created_at": "2016-12-29T17:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295176",
    "user": "https://github.com/mkoeppe"
}
```

Apparently fixed in #22061.



---

archive/issue_comments_295177.json:
```json
{
    "body": "Ah, didn't see this ticket before. Yes, should be addressed by #22061, hopefully.",
    "created_at": "2016-12-29T20:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295177",
    "user": "https://github.com/embray"
}
```

Ah, didn't see this ticket before. Yes, should be addressed by #22061, hopefully.



---

archive/issue_comments_295178.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-29T20:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295178",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_295179.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-21T18:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21290#issuecomment-295179",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid



---

archive/issue_events_020156.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21290",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21290#event-20156"
}
```
