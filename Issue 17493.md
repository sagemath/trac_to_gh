# Issue 17493: Use Pari for is_cyclotomic()

Issue created by migration from https://trac.sagemath.org/ticket/17730

Original creator: bruno

Original creation time: 2015-02-04 21:04:01

CC:  vdelecroix

Keywords: cyclotomic polynomial

The current implementation of `is_cyclotomic()` is either in Python or through the GP interface (when a certificate is required). Replacing all that by a call to Pari would be much faster.


---

Comment by jdemeyer created at 2015-02-05 07:36:10

It could be done now since `poliscyclo` is in PARI-2.7.1


---

Comment by bruno created at 2015-02-06 13:19:13

Replying to [comment:1 jdemeyer]:
> It could be done now since `poliscyclo` is in PARI-2.7.1
The idea (proposed by [ticket:17695#comment:10 vdelecroix]) was to wait for #17631 to be closed in order to avoid to have to manually edit `libs/pari/gen.pyx`. Do you think I shouldn't?


---

Comment by jdemeyer created at 2015-02-06 13:36:53

I don't really have an opinion on whether you _should_. I'm just saying you _could_ in case you were under the false impression that you really need #17631.


---

Comment by bruno created at 2015-02-06 13:46:09

The point is that I am not familiar with Pari's interface in Sage. So I am reluctant to learn it if I can avoid it by simply waiting for #17631 to be ready...


---

Comment by jdemeyer created at 2015-02-06 13:51:24

Replying to [comment:4 bruno]:
> by simply waiting for #17631 to be ready...
I hope you're not in a hurry :-)

I would say that #17631 is ready, but there is not much point in setting it to needs_review since it is based on #16997. And people don't seem to like #16997 that much since it is about upgrading to a non-released version of PARI. So probably you need to wait for a new PARI release to come out.


---

Comment by vdelecroix created at 2015-03-20 16:01:07

New commits:


---

Comment by vdelecroix created at 2015-03-20 16:01:07

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-03-20 16:02:55

With the branch applied

```
sage: p = cyclotomic_polynomial(14)
sage: timeit("p.is_cyclotomic(algorithm='sage')")
625 loops, best of 3: 429 µs per loop
sage: timeit("p.is_cyclotomic(algorithm='pari')")
625 loops, best of 3: 29.3 µs per loop
```



---

Comment by chapoton created at 2015-03-22 09:07:00

Looks good to me.

I have made a review commit:

- moving things around inside `is_cyclotomic` doc
- changing the following behavior: if we ask for a certificate, then pari is used

If you agree with my changes, you can set a positive review
----
New commits:


---

Comment by vdelecroix created at 2015-03-22 10:29:05

I do not like the fact that some argument forces the other silently. I do prefer the version in which the combination `p.is_cyclotomic(algorithm='sage', certificate=True)` raises an error. I took care of some of your modifications in my commit.

On the other hand, there was a mistake in the previous version: the arguments were not forwarded when the polynomial had coefficients in `QQ`.
----
New commits:


---

Comment by chapoton created at 2015-03-22 12:47:21

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-03-22 12:47:21

Ok, looks good to me.

I have just made three very minor doc formatting changes on top of your branch.

Positive review.
----
New commits:


---

Comment by vdelecroix created at 2015-03-22 12:50:49

Great. Thanks!

I still do not get why you need a merge commit (here 09a0022)...!?


---

Comment by chapoton created at 2015-03-22 13:33:09

Well, I am doing that (where develop is the latest beta):

```
git ch develop -b 17XXX
git pull trac whatever_branch_for_17XXX
```

to get the branch.

If the branch is not based on the latest beta, the merge is forced upon me by git.
This has been working for me very well since long, but maybe I am plain wrong in my use of git.


---

Comment by vdelecroix created at 2015-03-22 20:48:02

Replying to [comment:13 chapoton]:
> Well, I am doing that (where develop is the latest beta):
> {{{
> git ch develop -b 17XXX
> git pull trac whatever_branch_for_17XXX
> }}}
> to get the branch.
> 
> If the branch is not based on the latest beta, the merge is forced upon me by git.
> This has been working for me very well since long, but maybe I am plain wrong in my use of git.

My branch was based on beta-6.6 and the last beta is the rc0. This is the reason. The thing that I dislike is that it introduces a useless commit in the history. There is nothing bad with branch based on previous beta and instead you can do

```
git fetch trac whatever_branch_for_17XXX
git ch -b 17XXX FETCH_HEAD
```


The alternative is to do the merge as you did. And then, you can rebase your commit on top of mine.

Not that important.

Vincent


---

Comment by vbraun created at 2015-04-10 20:20:34

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-04-10 20:20:34

reviewer name


---

Comment by vdelecroix created at 2015-04-11 08:34:38

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-04-14 19:43:58

Resolution: fixed
