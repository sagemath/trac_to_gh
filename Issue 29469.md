# Issue 29469: Move Extension options from src/module_list.py to "distutils:" directives in the individual files

archive/issues_029469.json:
```json
{
    "body": "CC:  @kiwifb @dimpase @jhpalmieri @tscrim @kliem @roed314 @videlec @vbraun\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29706\n\n",
    "created_at": "2020-05-18T00:46:51Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Move Extension options from src/module_list.py to \"distutils:\" directives in the individual files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29469",
    "user": "@mkoeppe"
}
```
CC:  @kiwifb @dimpase @jhpalmieri @tscrim @kliem @roed314 @videlec @vbraun



Issue created by migration from https://trac.sagemath.org/ticket/29706





---

archive/issue_comments_418246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-18T03:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418246",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-18T05:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418247",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-18T05:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418248",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-18T05:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418249",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418250.json:
```json
{
    "body": "Aren't all these `extra_compile_args=['-std=c++11']` (and the corresponding cython `#`-directives obsolete (as we now set this globally for the C++ compiler)?",
    "created_at": "2020-05-18T09:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418250",
    "user": "@dimpase"
}
```

Aren't all these `extra_compile_args=['-std=c++11']` (and the corresponding cython `#`-directives obsolete (as we now set this globally for the C++ compiler)?



---

archive/issue_comments_418251.json:
```json
{
    "body": "I would guess so but would prefer to do that on a different ticket",
    "created_at": "2020-05-18T15:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418251",
    "user": "@mkoeppe"
}
```

I would guess so but would prefer to do that on a different ticket



---

archive/issue_comments_418252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-21T05:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418252",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418253.json:
```json
{
    "body": "Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?\n\n\n```diff\n-# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n+# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n```\n\nSame thing in \n- `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`\n- `sage/stats/distributions/discrete_gaussian_integer.pyx`)\n\nI think you missed this one. At least I don't find the corresponding file in the diffs.\n\n```\n-    Extension('sage.modular.pollack_stevens.dist',\n-              sources = ['sage/modular/pollack_stevens/dist.pyx'],\n-              libraries = [\"gmp\", \"zn_poly\"],\n-              extra_compile_args = [\"-D_XPG6\"]),\n```\n\n\nI don't understand (this is probably reasonable, but I don't have any knowledge about that)\n\n\n```\n    # TODO: Remove Cygwin hack by installing a suitable cblas.pc\n    if os.path.exists('/usr/lib/libblas.dll.a'):\n        aliases[\"CBLAS_LIBS\"] = ['gslcblas']\n```\n\n\nEverything else looks great to me. However, I didn't test anything yet.",
    "created_at": "2020-05-27T18:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418253",
    "user": "@kliem"
}
```

Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?


```diff
-# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
+# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
```

Same thing in 
- `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`
- `sage/stats/distributions/discrete_gaussian_integer.pyx`)

I think you missed this one. At least I don't find the corresponding file in the diffs.

```
-    Extension('sage.modular.pollack_stevens.dist',
-              sources = ['sage/modular/pollack_stevens/dist.pyx'],
-              libraries = ["gmp", "zn_poly"],
-              extra_compile_args = ["-D_XPG6"]),
```


I don't understand (this is probably reasonable, but I don't have any knowledge about that)


```
    # TODO: Remove Cygwin hack by installing a suitable cblas.pc
    if os.path.exists('/usr/lib/libblas.dll.a'):
        aliases["CBLAS_LIBS"] = ['gslcblas']
```


Everything else looks great to me. However, I didn't test anything yet.



---

archive/issue_comments_418254.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd109\".",
    "created_at": "2020-05-27T18:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418254",
    "user": "@kliem"
}
```

Changing keywords from "" to "sd109".



---

archive/issue_comments_418255.json:
```json
{
    "body": "Replying to [comment:14 gh-kliem]:\n> Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?\n> \n> {{{#!diff\n> -# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n> +# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n> }}}\n> Same thing in \n> - `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`\n> - `sage/stats/distributions/discrete_gaussian_integer.pyx`)\n> \n> I think you missed this one. At least I don't find the corresponding file in the diffs.\n> {{{\n> -    Extension('sage.modular.pollack_stevens.dist',\n> -              sources = ['sage/modular/pollack_stevens/dist.pyx'],\n> -              libraries = [\"gmp\", \"zn_poly\"],\n> -              extra_compile_args = [\"-D_XPG6\"]),\n> }}}\n\nQuite possible on both of these. If you have time to test and make these fixes, that would be great!\n\n> I don't understand (this is probably reasonable, but I don't have any knowledge about that)\n> \n> {{{\n>     # TODO: Remove Cygwin hack by installing a suitable cblas.pc\n>     if os.path.exists('/usr/lib/libblas.dll.a'):\n>         aliases[\"CBLAS_LIBS\"] = ['gslcblas']\n> }}}\n\n\nI don't understand it either, I only it moved it there from its origin.  It's quite likely that it is outdated - this should be addressed on a separate ticket.",
    "created_at": "2020-05-29T18:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418255",
    "user": "@mkoeppe"
}
```

Replying to [comment:14 gh-kliem]:
> Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?
> 
> {{{#!diff
> -# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
> +# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
> }}}
> Same thing in 
> - `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`
> - `sage/stats/distributions/discrete_gaussian_integer.pyx`)
> 
> I think you missed this one. At least I don't find the corresponding file in the diffs.
> {{{
> -    Extension('sage.modular.pollack_stevens.dist',
> -              sources = ['sage/modular/pollack_stevens/dist.pyx'],
> -              libraries = ["gmp", "zn_poly"],
> -              extra_compile_args = ["-D_XPG6"]),
> }}}

Quite possible on both of these. If you have time to test and make these fixes, that would be great!

> I don't understand (this is probably reasonable, but I don't have any knowledge about that)
> 
> {{{
>     # TODO: Remove Cygwin hack by installing a suitable cblas.pc
>     if os.path.exists('/usr/lib/libblas.dll.a'):
>         aliases["CBLAS_LIBS"] = ['gslcblas']
> }}}


I don't understand it either, I only it moved it there from its origin.  It's quite likely that it is outdated - this should be addressed on a separate ticket.



---

archive/issue_comments_418256.json:
```json
{
    "body": "Ok. I'm testing it now both locally and with github actions.",
    "created_at": "2020-05-30T07:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418256",
    "user": "@kliem"
}
```

Ok. I'm testing it now both locally and with github actions.



---

archive/issue_comments_418257.json:
```json
{
    "body": "It all worked on my end (`sage -t --all --long`)\n\nTesting it on github reavealed some strange error with debian buster standard.\n\nhttps://github.com/kliem/sage-test-27122/runs/722743115\n\n\n```\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage/matrix/__init__.py\", line 2, in <module>\n  [dochtml]       import sage.matrix.args\n  [dochtml]     File \"sage/matrix/args.pyx\", line 23, in init sage.matrix.args (build/cythonized/sage/matrix/args.c:21224)\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py\", line 44, in <module>\n  [dochtml]       from . import matrix_modn_sparse\n  [dochtml]     File \"sage/matrix/matrix_integer_sparse.pxd\", line 5, in init sage.matrix.matrix_modn_sparse (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:16301)\n  [dochtml]   ImportError: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.26' not found (required by /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_integer_sparse.cpython-\n```\n\n\nHow come `numerical`, `rings` etc. wheren't touched?",
    "created_at": "2020-05-30T18:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418257",
    "user": "@kliem"
}
```

It all worked on my end (`sage -t --all --long`)

Testing it on github reavealed some strange error with debian buster standard.

https://github.com/kliem/sage-test-27122/runs/722743115


```
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage/matrix/__init__.py", line 2, in <module>
  [dochtml]       import sage.matrix.args
  [dochtml]     File "sage/matrix/args.pyx", line 23, in init sage.matrix.args (build/cythonized/sage/matrix/args.c:21224)
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py", line 44, in <module>
  [dochtml]       from . import matrix_modn_sparse
  [dochtml]     File "sage/matrix/matrix_integer_sparse.pxd", line 5, in init sage.matrix.matrix_modn_sparse (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:16301)
  [dochtml]   ImportError: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.26' not found (required by /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_integer_sparse.cpython-
```


How come `numerical`, `rings` etc. wheren't touched?



---

archive/issue_comments_418258.json:
```json
{
    "body": "I also see this kind of strange error on GH Actions on buster. Perhaps the buster image used is faulty?",
    "created_at": "2020-05-30T20:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418258",
    "user": "@dimpase"
}
```

I also see this kind of strange error on GH Actions on buster. Perhaps the buster image used is faulty?



---

archive/issue_comments_418259.json:
```json
{
    "body": "Also happens on ubuntu bionic and linuxmint 19.\n\nOverall the testing experience is awful at the moment and it appears to have nothing to do with this ticket: https://github.com/kliem/sage-test-27122/actions/runs/119764262\n\nExcept for ubuntu focal and eoan and debian bullseye and sid (all standard not minimal) nothing passes within 6 hours and many failures.",
    "created_at": "2020-05-31T05:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418259",
    "user": "@kliem"
}
```

Also happens on ubuntu bionic and linuxmint 19.

Overall the testing experience is awful at the moment and it appears to have nothing to do with this ticket: https://github.com/kliem/sage-test-27122/actions/runs/119764262

Except for ubuntu focal and eoan and debian bullseye and sid (all standard not minimal) nothing passes within 6 hours and many failures.



---

archive/issue_comments_418260.json:
```json
{
    "body": "In comparison to almost everything succeeding at 9.1 release.",
    "created_at": "2020-05-31T05:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418260",
    "user": "@kliem"
}
```

In comparison to almost everything succeeding at 9.1 release.



---

archive/issue_comments_418261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-01T23:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-02T00:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418263.json:
```json
{
    "body": "Replying to [comment:16 mkoeppe]:\n> Replying to [comment:14 gh-kliem]:\n> > Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?\n> > \n> > {{{#!diff\n> > -# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n> > +# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc\n> > }}}\n> > Same thing in \n> > - `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`\n> > - `sage/stats/distributions/discrete_gaussian_integer.pyx`)\n> > \n> > I think you missed this one. At least I don't find the corresponding file in the diffs.\n> > {{{\n> > -    Extension('sage.modular.pollack_stevens.dist',\n> > -              sources = ['sage/modular/pollack_stevens/dist.pyx'],\n> > -              libraries = [\"gmp\", \"zn_poly\"],\n> > -              extra_compile_args = [\"-D_XPG6\"]),\n> > }}}\n> \n> Quite possible on both of these. \n\nI have made these changes.",
    "created_at": "2020-06-02T00:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418263",
    "user": "@mkoeppe"
}
```

Replying to [comment:16 mkoeppe]:
> Replying to [comment:14 gh-kliem]:
> > Isn't `src/sage/geometry/triangulation/base.pyx` itself redundant here?
> > 
> > {{{#!diff
> > -# distutils: sources = sage/geometry/triangulation/base.pyx sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
> > +# distutils: sources = sage/geometry/triangulation/functions.cc sage/geometry/triangulation/data.cc sage/geometry/triangulation/triangulations.cc
> > }}}
> > Same thing in 
> > - `/src/sage/schemes/hyperelliptic_curves/hypellfrob.pyx`
> > - `sage/stats/distributions/discrete_gaussian_integer.pyx`)
> > 
> > I think you missed this one. At least I don't find the corresponding file in the diffs.
> > {{{
> > -    Extension('sage.modular.pollack_stevens.dist',
> > -              sources = ['sage/modular/pollack_stevens/dist.pyx'],
> > -              libraries = ["gmp", "zn_poly"],
> > -              extra_compile_args = ["-D_XPG6"]),
> > }}}
> 
> Quite possible on both of these. 

I have made these changes.



---

archive/issue_comments_418264.json:
```json
{
    "body": "Replying to [comment:18 gh-kliem]:\n> How come `numerical`, `rings` etc. weren't touched?\nThe present ticket only touches top-level packages that do not have `OptionalExtension`s. \nPart 2 will do `OptionalExtension`s. Part 3 all remaining (mixed) ones. I split it up to reduce the potential for merge conflicts.",
    "created_at": "2020-06-02T00:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418264",
    "user": "@mkoeppe"
}
```

Replying to [comment:18 gh-kliem]:
> How come `numerical`, `rings` etc. weren't touched?
The present ticket only touches top-level packages that do not have `OptionalExtension`s. 
Part 2 will do `OptionalExtension`s. Part 3 all remaining (mixed) ones. I split it up to reduce the potential for merge conflicts.



---

archive/issue_comments_418265.json:
```json
{
    "body": "As far as I can see `OptionalExtension` is used only in `graphs`, `interfaces`, `libs` and `matrix`.\n\n`Numerical`, `rings`, `finite_rings`, `number_field`, `padics` and `polynomial` don't seem to have that.\n\nMaybe I'm missing something. We can also split at this point, because we are already touching enough packages.",
    "created_at": "2020-06-02T05:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418265",
    "user": "@kliem"
}
```

As far as I can see `OptionalExtension` is used only in `graphs`, `interfaces`, `libs` and `matrix`.

`Numerical`, `rings`, `finite_rings`, `number_field`, `padics` and `polynomial` don't seem to have that.

Maybe I'm missing something. We can also split at this point, because we are already touching enough packages.



---

archive/issue_comments_418266.json:
```json
{
    "body": "It's quite possible that I misremembered and it's just an arbitrary subset.",
    "created_at": "2020-06-02T05:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418266",
    "user": "@mkoeppe"
}
```

It's quite possible that I misremembered and it's just an arbitrary subset.



---

archive/issue_comments_418267.json:
```json
{
    "body": "Works for me.\n\nAs it apparently also works on your mac and it passes on cygwin https://github.com/kliem/sage-test-27122/actions/runs/119764261 and it works fine on multiple linux instances, the build process seems to work just the same as before.",
    "created_at": "2020-06-02T06:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418267",
    "user": "@kliem"
}
```

Works for me.

As it apparently also works on your mac and it passes on cygwin https://github.com/kliem/sage-test-27122/actions/runs/119764261 and it works fine on multiple linux instances, the build process seems to work just the same as before.



---

archive/issue_comments_418268.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-02T06:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418268",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418269.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-06-02T06:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418269",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_418270.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-05T22:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418270",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_418271.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-06-06T18:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418271",
    "user": "@vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_418272.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-06-06T18:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418272",
    "user": "@vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_418273.json:
```json
{
    "body": "on OSX:\n\n```\n[sagelib-9.2.beta0] cd . && export                                    \\\n[sagelib-9.2.beta0] \t    SAGE_ROOT=/doesnotexist                               \\\n[sagelib-9.2.beta0] \t    SAGE_SRC=/doesnotexist                                \\\n[sagelib-9.2.beta0] \t    SAGE_SRC_ROOT=/doesnotexist                           \\\n[sagelib-9.2.beta0] \t    SAGE_DOC_SRC=/doesnotexist                            \\\n[sagelib-9.2.beta0] \t    SAGE_BUILD_DIR=/doesnotexist                          \\\n[sagelib-9.2.beta0] \t    SAGE_PKGS=/Users/buildbot-sage/slave/sage_git/build/build/pkgs                \\\n[sagelib-9.2.beta0] \t&& sage-python -u setup.py --no-user-cfg build install\n[sagelib-9.2.beta0] /Users/buildbot-sage/slave/sage_git/build/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory\n[sagelib-9.2.beta0] Warning: overwriting SAGE_ROOT environment variable:\n[sagelib-9.2.beta0] Old SAGE_ROOT=/doesnotexist\n[sagelib-9.2.beta0] New SAGE_ROOT=\n[sagelib-9.2.beta0] ************************************************************************\n[sagelib-9.2.beta0] Traceback (most recent call last):\n[sagelib-9.2.beta0]   File \"setup.py\", line 72, in <module>\n[sagelib-9.2.beta0]     from module_list import ext_modules, library_order\n[sagelib-9.2.beta0]   File \"/Users/buildbot-sage/slave/sage_git/build/src/module_list.py\", line 80, in <module>\n[sagelib-9.2.beta0]     aliases = cython_aliases()\n[sagelib-9.2.beta0]   File \"/Users/buildbot-sage/slave/sage_git/build/src/sage/env.py\", line 395, in cython_aliases\n[sagelib-9.2.beta0]     aliases[var + \"CFLAGS\"] = pkgconfig.cflags(lib).split()\n[sagelib-9.2.beta0]   File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 144, in cflags\n[sagelib-9.2.beta0]     _raise_if_not_exists(package)\n[sagelib-9.2.beta0]   File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n[sagelib-9.2.beta0]     raise PackageNotFoundError(package)\n[sagelib-9.2.beta0] pkgconfig.pkgconfig.PackageNotFoundError: zlib not found\n[sagelib-9.2.beta0] ************************************************************************\n[sagelib-9.2.beta0] Error building the Sage library\n[sagelib-9.2.beta0] ************************************************************************\n[sagelib-9.2.beta0] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[sagelib-9.2.beta0] explaining the problem and including the relevant part of the log file\n[sagelib-9.2.beta0]   /Users/buildbot-sage/slave/sage_git/build/logs/pkgs/sagelib-9.2.beta0.log\n[sagelib-9.2.beta0] Describe your computer, operating system, etc.\n[sagelib-9.2.beta0] ************************************************************************\n```\n",
    "created_at": "2020-06-06T18:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418273",
    "user": "@vbraun"
}
```

on OSX:

```
[sagelib-9.2.beta0] cd . && export                                    \
[sagelib-9.2.beta0] 	    SAGE_ROOT=/doesnotexist                               \
[sagelib-9.2.beta0] 	    SAGE_SRC=/doesnotexist                                \
[sagelib-9.2.beta0] 	    SAGE_SRC_ROOT=/doesnotexist                           \
[sagelib-9.2.beta0] 	    SAGE_DOC_SRC=/doesnotexist                            \
[sagelib-9.2.beta0] 	    SAGE_BUILD_DIR=/doesnotexist                          \
[sagelib-9.2.beta0] 	    SAGE_PKGS=/Users/buildbot-sage/slave/sage_git/build/build/pkgs                \
[sagelib-9.2.beta0] 	&& sage-python -u setup.py --no-user-cfg build install
[sagelib-9.2.beta0] /Users/buildbot-sage/slave/sage_git/build/src/bin/sage-env: line 130: cd: /doesnotexist: No such file or directory
[sagelib-9.2.beta0] Warning: overwriting SAGE_ROOT environment variable:
[sagelib-9.2.beta0] Old SAGE_ROOT=/doesnotexist
[sagelib-9.2.beta0] New SAGE_ROOT=
[sagelib-9.2.beta0] ************************************************************************
[sagelib-9.2.beta0] Traceback (most recent call last):
[sagelib-9.2.beta0]   File "setup.py", line 72, in <module>
[sagelib-9.2.beta0]     from module_list import ext_modules, library_order
[sagelib-9.2.beta0]   File "/Users/buildbot-sage/slave/sage_git/build/src/module_list.py", line 80, in <module>
[sagelib-9.2.beta0]     aliases = cython_aliases()
[sagelib-9.2.beta0]   File "/Users/buildbot-sage/slave/sage_git/build/src/sage/env.py", line 395, in cython_aliases
[sagelib-9.2.beta0]     aliases[var + "CFLAGS"] = pkgconfig.cflags(lib).split()
[sagelib-9.2.beta0]   File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 144, in cflags
[sagelib-9.2.beta0]     _raise_if_not_exists(package)
[sagelib-9.2.beta0]   File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
[sagelib-9.2.beta0]     raise PackageNotFoundError(package)
[sagelib-9.2.beta0] pkgconfig.pkgconfig.PackageNotFoundError: zlib not found
[sagelib-9.2.beta0] ************************************************************************
[sagelib-9.2.beta0] Error building the Sage library
[sagelib-9.2.beta0] ************************************************************************
[sagelib-9.2.beta0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[sagelib-9.2.beta0] explaining the problem and including the relevant part of the log file
[sagelib-9.2.beta0]   /Users/buildbot-sage/slave/sage_git/build/logs/pkgs/sagelib-9.2.beta0.log
[sagelib-9.2.beta0] Describe your computer, operating system, etc.
[sagelib-9.2.beta0] ************************************************************************
```




---

archive/issue_comments_418274.json:
```json
{
    "body": "That fix looks plausible to me.\n----\nLast 10 new commits:",
    "created_at": "2020-06-06T19:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418274",
    "user": "@kliem"
}
```

That fix looks plausible to me.
----
Last 10 new commits:



---

archive/issue_comments_418275.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-06T19:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418275",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418276.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-06T19:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418276",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418277.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-06-06T19:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418277",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_418278.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-21T19:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418278",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_418279.json:
```json
{
    "body": "Still getting on OSX:\n\n```\n[sagelib-9.2.beta1] ************************************************************************\n[sagelib-9.2.beta1] Traceback (most recent call last):\n[sagelib-9.2.beta1]   File \"setup.py\", line 72, in <module>\n[sagelib-9.2.beta1]     from module_list import ext_modules, library_order\n[sagelib-9.2.beta1]   File \"/Users/buildbot-sage/slave/sage_git/build/src/module_list.py\", line 80, in <module>\n[sagelib-9.2.beta1]     aliases = cython_aliases()\n[sagelib-9.2.beta1]   File \"/Users/buildbot-sage/slave/sage_git/build/src/sage/env.py\", line 409, in cython_aliases\n[sagelib-9.2.beta1]     aliases[var + \"LIBEXTRA\"] = list(filter(lambda s: not s.startswith(('-l','-L')), pkgconfig.libs(lib).split()))\n[sagelib-9.2.beta1]   File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 165, in libs\n[sagelib-9.2.beta1]     _raise_if_not_exists(package)\n[sagelib-9.2.beta1]   File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n[sagelib-9.2.beta1]     raise PackageNotFoundError(package)\n[sagelib-9.2.beta1] pkgconfig.pkgconfig.PackageNotFoundError: zlib not found\n[sagelib-9.2.beta1] ************************************************************************\n[sagelib-9.2.beta1] Error building the Sage library\n\n```\n",
    "created_at": "2020-06-21T19:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418279",
    "user": "@vbraun"
}
```

Still getting on OSX:

```
[sagelib-9.2.beta1] ************************************************************************
[sagelib-9.2.beta1] Traceback (most recent call last):
[sagelib-9.2.beta1]   File "setup.py", line 72, in <module>
[sagelib-9.2.beta1]     from module_list import ext_modules, library_order
[sagelib-9.2.beta1]   File "/Users/buildbot-sage/slave/sage_git/build/src/module_list.py", line 80, in <module>
[sagelib-9.2.beta1]     aliases = cython_aliases()
[sagelib-9.2.beta1]   File "/Users/buildbot-sage/slave/sage_git/build/src/sage/env.py", line 409, in cython_aliases
[sagelib-9.2.beta1]     aliases[var + "LIBEXTRA"] = list(filter(lambda s: not s.startswith(('-l','-L')), pkgconfig.libs(lib).split()))
[sagelib-9.2.beta1]   File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 165, in libs
[sagelib-9.2.beta1]     _raise_if_not_exists(package)
[sagelib-9.2.beta1]   File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
[sagelib-9.2.beta1]     raise PackageNotFoundError(package)
[sagelib-9.2.beta1] pkgconfig.pkgconfig.PackageNotFoundError: zlib not found
[sagelib-9.2.beta1] ************************************************************************
[sagelib-9.2.beta1] Error building the Sage library

```




---

archive/issue_comments_418280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-21T21:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418280",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418281.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-21T21:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418281",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418282.json:
```json
{
    "body": "Sorry, here's another fix.",
    "created_at": "2020-06-21T21:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418282",
    "user": "@mkoeppe"
}
```

Sorry, here's another fix.



---

archive/issue_comments_418283.json:
```json
{
    "body": "Any suggestions for how to reproduce the error? I've tried using the previous version of the branch, and either building with lots of system packages or with very few, but I haven't hit this build error.",
    "created_at": "2020-06-22T05:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418283",
    "user": "@jhpalmieri"
}
```

Any suggestions for how to reproduce the error? I've tried using the previous version of the branch, and either building with lots of system packages or with very few, but I haven't hit this build error.



---

archive/issue_comments_418284.json:
```json
{
    "body": "Basically, one needs a macOS without homebrew (which installs .pc files for system libraries). Or do the following to simulate that:\n\n```\n  (cd /usr/local/Homebrew/Library/Homebrew/os/mac/ && mv pkgconfig pkgconfig-moved)\n```\n",
    "created_at": "2020-06-22T05:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418284",
    "user": "@mkoeppe"
}
```

Basically, one needs a macOS without homebrew (which installs .pc files for system libraries). Or do the following to simulate that:

```
  (cd /usr/local/Homebrew/Library/Homebrew/os/mac/ && mv pkgconfig pkgconfig-moved)
```




---

archive/issue_comments_418285.json:
```json
{
    "body": "I created #29929 (`tox.ini: Add a macos environment without homebrew, conda`) so we can test such a barebones macOS environment on GH Actions",
    "created_at": "2020-06-22T05:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418285",
    "user": "@mkoeppe"
}
```

I created #29929 (`tox.ini: Add a macos environment without homebrew, conda`) so we can test such a barebones macOS environment on GH Actions



---

archive/issue_comments_418286.json:
```json
{
    "body": "Have you tried the current branch with such a system? I am completely clueless, whether the last commit resolves the problem.",
    "created_at": "2020-06-22T09:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418286",
    "user": "@kliem"
}
```

Have you tried the current branch with such a system? I am completely clueless, whether the last commit resolves the problem.



---

archive/issue_comments_418287.json:
```json
{
    "body": "Replying to [comment:52 gh-kliem]:\n> Have you tried the current branch with such a system? I am completely clueless, whether the last commit resolves the problem.\nYes, a build from scratch with the manipulation mentioned in comment 50 just finished successfully on my machine.",
    "created_at": "2020-06-22T21:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418287",
    "user": "@mkoeppe"
}
```

Replying to [comment:52 gh-kliem]:
> Have you tried the current branch with such a system? I am completely clueless, whether the last commit resolves the problem.
Yes, a build from scratch with the manipulation mentioned in comment 50 just finished successfully on my machine.



---

archive/issue_comments_418288.json:
```json
{
    "body": "I have not yet been able to reproduce the error, so I can't tell if the most recent change fixes anything. Renaming `/usr/local/Homebrew/Library/Homebrew/os/mac/pkgconfig` didn't cause breakage, nor did renaming `/usr/local/lib/pkgconfig`. I'm trying on a different machine by just removing homebrew altogether.",
    "created_at": "2020-06-22T22:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418288",
    "user": "@jhpalmieri"
}
```

I have not yet been able to reproduce the error, so I can't tell if the most recent change fixes anything. Renaming `/usr/local/Homebrew/Library/Homebrew/os/mac/pkgconfig` didn't cause breakage, nor did renaming `/usr/local/lib/pkgconfig`. I'm trying on a different machine by just removing homebrew altogether.



---

archive/issue_comments_418289.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-22T22:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418289",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418290.json:
```json
{
    "body": "I can confirm on a machine without Homebrew, I hit the failure that Volker mentioned, and the most recent change fixes it. I'm going to switch to a positive review.",
    "created_at": "2020-06-22T22:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418290",
    "user": "@jhpalmieri"
}
```

I can confirm on a machine without Homebrew, I hit the failure that Volker mentioned, and the most recent change fixes it. I'm going to switch to a positive review.



---

archive/issue_comments_418291.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-06-22T23:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418291",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_418292.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-24T23:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29469#issuecomment-418292",
    "user": "@vbraun"
}
```

Resolution: fixed
