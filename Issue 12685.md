# Issue 12685: Split off Graphics class from plot.py

Issue created by migration from https://trac.sagemath.org/ticket/12857

Original creator: jdemeyer

Original creation time: 2012-04-19 07:18:34

Assignee: tbd

CC:  kcrisman

The file `sage/plot/plot.py` is getting huge.  One consequence is that doctesting this file (without `--long`) takes double the time of any other file.  One obvious thing to do is to move the `Graphics` class to a new file.


---

Comment by jdemeyer created at 2012-04-19 07:18:54

Changing component from PLEASE CHANGE to plotting.


---

Comment by jdemeyer created at 2012-04-19 08:48:27

Changing priority from major to blocker.


---

Comment by jdemeyer created at 2012-04-19 09:09:20

The attached patch is a rough approximation, but mostly does it.


---

Comment by jdemeyer created at 2012-04-19 12:42:36

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-04-19 12:42:36

Changing component from plotting to graphics.


---

Comment by kcrisman created at 2012-04-19 13:01:32

Quite the patch bomb!  I won't be able to look at this this weekend for sure.  But I would ask you whether you might try building the documentation with this patch; I have a suspicion that there are cross-links that won't work now (probably not too many, but some).

Thanks for cutting the rough draft on this.


---

Comment by jdemeyer created at 2012-04-19 13:15:16

Replying to [comment:8 kcrisman]:
> Quite the patch bomb!  I won't be able to look at this this weekend for sure.  But I would ask you whether you might try building the documentation with this patch; I have a suspicion that there are cross-links that won't work now (probably not too many, but some).
Building the documentation works.  Is there an automatic way to check for broken cross-links?


---

Comment by jdemeyer created at 2012-04-19 13:21:19

The "patch bomb" is not as bad as it looks: large parts of the patch simply remove duplicate code from `plot.py` xor `graphics.py`.  The rest is mostly obvious changing of imports.


---

Comment by benjaminfjones created at 2012-04-19 16:28:51

The patch applies cleanly to 5.0.beta12 and all tests pass on `sage/plot/*.py`. I also looked through the live documentation in the 2d/3d graphics sections and everything looks good to me. I didn't look for broken links, though.


---

Comment by jdemeyer created at 2012-04-19 20:51:55

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-04-19 20:51:55

Okay, I'll check the links.


---

Comment by jdemeyer created at 2012-04-20 11:18:22

Fixed some more links.  I think the documentation is okay now, except for one huge problem: the module `sage.combinat.e_one_star` is documented as `UNABLE TO IMPORT MODULE`, see my sage-devel post.


---

Comment by jdemeyer created at 2012-04-20 14:55:28

The UNABLE TO IMPORT MODULE seems like a Sphinx bug, or a bug in how Sage calls Sphinx.

I did a diff of the old and new documentation and, as far as I could see, all links still work.  Needs review.


---

Comment by jdemeyer created at 2012-04-20 14:55:28

Changing status from needs_work to needs_review.


---

Comment by niles created at 2012-04-22 18:05:04

Replying to [comment:14 jdemeyer]:
> The UNABLE TO IMPORT MODULE seems like a Sphinx bug, or a bug in how Sage calls Sphinx.
> 
> I did a diff of the old and new documentation and, as far as I could see, all links still work.  Needs review.

Shouldn't it be necessary to issue a deprecation warning for at least a few Sage releases before we change the location of something?  If I understand correctly, this patch will break all uses of `sage.plot.plot.Graphics`.  To me, this seems like a bad idea for 5.0.  Doing `search_src('plot.Graphics')` brings up a few more places `Graphics` and `GraphicsArray` are used in this way, but not addressed by this patch.  For example, `graphs/graph_generators.py` and `shemes/elliptic_curves/ell_generic.py`.

I'm switching this to "needs info", and someone can overrule me if there is good reason to skip the deprecation process for this ticket.


---

Comment by niles created at 2012-04-22 18:05:04

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2012-04-22 19:22:17

Feel free to implement alternative solutions to the problem that `plot.py` takes too long to doctest.


---

Comment by jdemeyer created at 2012-04-22 19:27:02

Actually, `sage.plot.plot.Graphics` and `sage.plot.plot.GraphicsArray` still work since `Graphics` and `GraphicsArray` are imported from `sage.plot.plot`.  So there isn't really a problem...


---

Attachment

`sage/schemes/elliptic_curves/*` is okay since it uses:

```
import sage.plot.all as plot
```



---

Comment by jdemeyer created at 2012-04-22 19:31:17

Changing status from needs_info to needs_review.


---

Comment by hivert created at 2012-04-26 09:46:26

Replying to [comment:9 jdemeyer]:
> Building the documentation works.  Is there an automatic way to check for broken cross-links?

Yes ! There is an option "--warn-links" to docbuild recently added by #9128.

I didn't yet check the documentation but I've a small reviewer patch which silent `sage -coverage`.

Florent


---

Comment by hivert created at 2012-04-26 09:55:17

Good news ! No broken links were reported ! So upto doctesting the whole Sage lib, I'm positive review with the patch. Please review my review patch.


---

Comment by hivert created at 2012-04-26 10:34:14

A `ptestlong` reported

```
All tests passed!
```

with the two patch applied. So it just remains to review my reviewer patch which should be quite trivial.

Florent


---

Comment by kcrisman created at 2012-04-26 12:49:06

Your patch needs to have a useful commit message.  Also, after `sage: g2.show() ` you should have a blank, like


```
    sage: g2.show() 

::

    sage: isinstance(g2, Graphics)
```

so that people can see the graphic.  In this case, an empty one with just axes, but it does work.

Otherwise this reviewer patch seems ok, modulo that I haven't tested whether anything applies - taking your word for it.


---

Attachment

Replying to [comment:23 kcrisman]:
> Your patch needs to have a useful commit message.  

Oups !

> Also, after `sage: g2.show() ` you should have a blank, like
> 
> {{{
>     sage: g2.show() 
> 
> ::
> 
>     sage: isinstance(g2, Graphics)
> }}}
> so that people can see the graphic.  In this case, an empty one with just axes, but it does work.
> 
> Otherwise this reviewer patch seems ok, modulo that I haven't tested whether anything applies - taking your word for it.

The new uploaded patch should adress you comments.


---

Comment by kcrisman created at 2012-04-26 17:20:28

The reviewer patch is now fine as far as it goes.

----

I'm still a little nervous about such a big change (I know it's not really big in that sense, but it does make a large change to where things are located) in an rc.  I bet some outside links to the Sage doc will break, and the biggest problem is that all those helpful `show` options, which are only documented there, are now not in the same place as `plot`.    Although in principle redistributing like this is good and we should aim to fix timeouts, it does seem that this ticket was created in response to a somewhat contrived problem (timeout on busy systems).  Presumably someone can always make a system busy enough that Sage doctests will time out.  I'm just not sure that the last release candidate is the place for something that should be used "in practice" at least a little while.

I don't have time to come up with any other solutions, and if Ben checked things out and `DOCTEST_MODE` and `EMBEDDED_MODE` and so forth still work (and whatever other constants like DPI there are) without trouble in the same ways as before, then I guess that's okay.  But it does seems like (said the person who has never done a release, nor has the skills to do one) that we should have had a Sage 4.9 a few betas ago so this kind of thing wouldn't have happened...


---

Comment by jhpalmieri created at 2012-04-26 18:27:03

It sounds to me as though we should give this a positive review so that it can go into a prerelease and get lots of testing, get lots of people looking at it. (I would suggest the same for #11616, to make it easy to test it on different platforms.)


---

Comment by benjaminfjones created at 2012-04-26 20:07:21

Replying to [comment:26 jhpalmieri]:
> It sounds to me as though we should give this a positive review so that it can go into a prerelease and get lots of testing, get lots of people looking at it. (I would suggest the same for #11616, to make it easy to test it on different platforms.)

I agree with `@`jhpalmieri. I've looked over the patch again and the reviewer patch. This gets a positive review from me. I'm running a patchbot to check the doctests again. It's pending.


---

Comment by benjaminfjones created at 2012-04-26 22:06:43

All doctests pass when applied to 5.0.beta13.


---

Comment by jdemeyer created at 2012-04-26 22:13:52

Replying to [comment:25 kcrisman]:
> it does seem that this ticket was created in response to a somewhat contrived problem (timeout on busy systems
It is not a "contrived problem".  It is a real issue happening in practice.

If somebody comes up with a different solution to these timeouts, that's fine for me.  I just think that the timeouts should be fixed in sage-5.0 and splitting `plot.py` seemed a reasonable solution.


---

Comment by hivert created at 2012-04-27 16:42:44

Changing status from needs_review to positive_review.


---

Comment by hivert created at 2012-04-27 16:42:44

Despite kcrisman comments which are by the way quite sound, and seconded by jhpalmieri and benjaminfjones, I'm giving positive review. I trust Jeroen for knowing the risk we take by merging such a big change in and RC. He certainly known better that us the balance risks/advantages of merging this one.

Florent


---

Comment by kcrisman created at 2012-04-28 02:58:17

Replying to [comment:30 hivert]:
> Despite kcrisman comments which are by the way quite sound, and seconded by jhpalmieri and benjaminfjones, I'm giving positive review. I trust Jeroen for knowing the risk we take by merging such a big change in and RC. He certainly known better that us the balance risks/advantages of merging this one.
>
Okay, I'm just glad there was some good discussion on this, and with several more eyes this seems reasonable.  I'm not suggesting at all that there is anything wrong with the patch, just that we have been hit in the past by unintended moving of things.


---

Comment by jdemeyer created at 2012-04-30 09:50:59

Resolution: fixed
