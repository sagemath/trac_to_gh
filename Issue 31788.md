# Issue 31788: PolyhedronFace: Fix pickling

Issue created by migration from https://trac.sagemath.org/ticket/32025

Original creator: mkoeppe

Original creation time: 2021-06-21 19:09:52

CC:  @kliem tscrim

needed for #32013


---

Comment by @kliem created at 2021-06-21 19:13:26

Can you please provide an example on where it fails? If you are going to fix it yourself then I guess you'll provide an example along with the fix.


---

Comment by mkoeppe created at 2021-06-21 19:58:41

The `TestSuite` fails -- currently all calls to `TestSuite` use `skip='_test_pickling'`.

I'm working on something else right now - so help with this ticket would be welcome!


---

Comment by @kliem created at 2021-06-21 20:14:38

Well, the only problem is that we currently require `face._polyhedron` to be identical for two faces to be tested equal. Otherwise, everything is working, isn't it?


---

Comment by mkoeppe created at 2021-06-21 20:52:24

OK, perhaps it's too tricky to implement __richcmp__ for faces of polyhedra that are merely equal, not identical. 

Although I suppose if the polyhedra are not the same, one could just delegate the comparison to `as_polyhedron(...)`. 

But I guess I can just skip the pickling test in #32013 to work around it.


---

Comment by mkoeppe created at 2021-06-21 20:54:05

Changing priority from major to minor.


---

Comment by @kliem created at 2021-06-22 10:37:46

I didn't mean to imply that this does not need to be fixed. I just wanted to comment that the fixing needs to be done in richcmp and not pickling. Pickling works fine.

I guess instead of requiring the two polyhedra two be identical, we can just require the `Vrepresentation` and `Hrepresentation` to be the same:


```diff
    if self._polyhedron is not other._polyhedron:
-       raise NotImplementedError
+       if (self._polyhedron.Vrepresentation() != other._polyhedron.Vrepresentation() 
+               or self._polyhedron.Hrepresentation() != other._polyhedron.Hrepresentation()):
+           raise NotImplementedError
```


Actually we can be less strict and allow the Hrepresentation to differ. We could even allow the Vrepresentation to be a permutation of the other Vrepresentation, but this is definitely not needed to fix the pickling test for faces.


---

Comment by @kliem created at 2021-06-22 10:58:11

New commits:


---

Comment by @kliem created at 2021-06-22 10:58:11

Changing status from new to needs_review.


---

Comment by git created at 2021-06-22 14:24:05

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2021-06-22 14:24:26

Merged to resolve merge conflict


---

Comment by mkoeppe created at 2021-06-23 01:12:24

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-06-23 01:12:24

Thanks for working on this! LGTM


---

Comment by vbraun created at 2021-07-25 13:25:32

Resolution: fixed
