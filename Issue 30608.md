# Issue 30608: GH Actions: Add test for conda without SPKG

archive/issues_030608.json:
```json
{
    "body": "CC:  @isuruf @tobiasdiez @dimpase @saraedum\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30845\n\n",
    "created_at": "2020-11-01T18:57:38Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "GH Actions: Add test for conda without SPKG",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30608",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @isuruf @tobiasdiez @dimpase @saraedum



Issue created by migration from https://trac.sagemath.org/ticket/30845





---

archive/issue_comments_436749.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436749",
    "user": "https://github.com/mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_436750.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436750",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_436751.json:
```json
{
    "body": "Something like https://github.com/tobiasdiez/sage/blob/public/build/conda_gh/.github/workflows/ci-conda.yml?\n\nThis currently fails with\n\n```\nconfigure: creating ./config.status\nconfig.status: creating build/make/Makefile-auto\nconfig.status: creating build/make/Makefile\nconfig.status: creating src/bin/sage-env-config\nconfig.status: creating src/bin/sage-src-env-config\nconfig.status: creating build/bin/sage-build-env-config\nconfig.status: creating build/pkgs/sage_conf/src/sage_conf.py\nconfig.status: creating build/pkgs/sage_conf/src/setup.cfg\nconfig.status: executing depfiles commands\nconfig.status: executing mkdirs commands\nconfig.status: creating directory /home/runner/work/sage/sage/logs/pkgs\nconfig.status: creating directory \nmkdir: cannot create directory '': No such file or directory\nconfig.status: error: could not create \nError: Process completed with exit code 1.\n```\n\nhttps://github.com/tobiasdiez/sage/runs/1594237745?check_suite_focus=true\nAny idea what could be the reason and how to fix it?",
    "created_at": "2020-12-22T10:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436751",
    "user": "https://github.com/tobiasdiez"
}
```

Something like https://github.com/tobiasdiez/sage/blob/public/build/conda_gh/.github/workflows/ci-conda.yml?

This currently fails with

```
configure: creating ./config.status
config.status: creating build/make/Makefile-auto
config.status: creating build/make/Makefile
config.status: creating src/bin/sage-env-config
config.status: creating src/bin/sage-src-env-config
config.status: creating build/bin/sage-build-env-config
config.status: creating build/pkgs/sage_conf/src/sage_conf.py
config.status: creating build/pkgs/sage_conf/src/setup.cfg
config.status: executing depfiles commands
config.status: executing mkdirs commands
config.status: creating directory /home/runner/work/sage/sage/logs/pkgs
config.status: creating directory 
mkdir: cannot create directory '': No such file or directory
config.status: error: could not create 
Error: Process completed with exit code 1.
```

https://github.com/tobiasdiez/sage/runs/1594237745?check_suite_focus=true
Any idea what could be the reason and how to fix it?



---

archive/issue_comments_436752.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-22T10:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436752",
    "user": "https://github.com/tobiasdiez"
}
```

New commits:



---

archive/issue_comments_436753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T11:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T11:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436755.json:
```json
{
    "body": "Managed to fix the above error, just to be stuck two lines further down:\n\n```\nconfigure: creating ./config.status\nconfig.status: creating build/make/Makefile-auto\nconfig.status: creating build/make/Makefile\nconfig.status: creating src/bin/sage-env-config\nconfig.status: creating src/bin/sage-src-env-config\nconfig.status: creating build/bin/sage-build-env-config\nconfig.status: creating build/pkgs/sage_conf/src/sage_conf.py\nconfig.status: creating build/pkgs/sage_conf/src/setup.cfg\nconfig.status: executing depfiles commands\nconfig.status: executing broken-gcc commands\nconfig.status: executing mkdirs commands\nconfig.status: creating directory /home/runner/work/sage/sage/logs/pkgs\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/bin\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/etc\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/include\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/lib\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/lib/pkgconfig\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/share\nconfig.status: creating directory /usr/share/miniconda/envs/sage-build/var/lib/sage/installed\nconfig.status: error: Cannot perform incremental update, run \"make distclean && make\"\nconfig.status: /usr/share/miniconda/envs/sage-build/lib64 is not a symlink, see Trac #19782\nError: Process completed with exit code 1.\n```\n\nhttps://github.com/tobiasdiez/sage/runs/1594601374?check_suite_focus=true",
    "created_at": "2020-12-22T11:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436755",
    "user": "https://github.com/tobiasdiez"
}
```

Managed to fix the above error, just to be stuck two lines further down:

```
configure: creating ./config.status
config.status: creating build/make/Makefile-auto
config.status: creating build/make/Makefile
config.status: creating src/bin/sage-env-config
config.status: creating src/bin/sage-src-env-config
config.status: creating build/bin/sage-build-env-config
config.status: creating build/pkgs/sage_conf/src/sage_conf.py
config.status: creating build/pkgs/sage_conf/src/setup.cfg
config.status: executing depfiles commands
config.status: executing broken-gcc commands
config.status: executing mkdirs commands
config.status: creating directory /home/runner/work/sage/sage/logs/pkgs
config.status: creating directory /usr/share/miniconda/envs/sage-build
config.status: creating directory /usr/share/miniconda/envs/sage-build/bin
config.status: creating directory /usr/share/miniconda/envs/sage-build/etc
config.status: creating directory /usr/share/miniconda/envs/sage-build/include
config.status: creating directory /usr/share/miniconda/envs/sage-build/lib
config.status: creating directory /usr/share/miniconda/envs/sage-build/lib/pkgconfig
config.status: creating directory /usr/share/miniconda/envs/sage-build/share
config.status: creating directory /usr/share/miniconda/envs/sage-build/var/lib/sage/installed
config.status: error: Cannot perform incremental update, run "make distclean && make"
config.status: /usr/share/miniconda/envs/sage-build/lib64 is not a symlink, see Trac #19782
Error: Process completed with exit code 1.
```

https://github.com/tobiasdiez/sage/runs/1594601374?check_suite_focus=true



---

archive/issue_comments_436756.json:
```json
{
    "body": "Found a hack that fixed it by removing the lib64 folder. It only contained `libcc1.so` (not sure where/how this is needed).",
    "created_at": "2020-12-22T12:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436756",
    "user": "https://github.com/tobiasdiez"
}
```

Found a hack that fixed it by removing the lib64 folder. It only contained `libcc1.so` (not sure where/how this is needed).



---

archive/issue_comments_436757.json:
```json
{
    "body": "Made a bit more progress, but it currently errors while compiling gcc. Moreover, there is a problem in the detection of the conda/system gcc because \"sage-env-config\" doesn't exist.\nhttps://github.com/tobiasdiez/sage/runs/1594867631?check_suite_focus=true",
    "created_at": "2020-12-22T13:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436757",
    "user": "https://github.com/tobiasdiez"
}
```

Made a bit more progress, but it currently errors while compiling gcc. Moreover, there is a problem in the detection of the conda/system gcc because "sage-env-config" doesn't exist.
https://github.com/tobiasdiez/sage/runs/1594867631?check_suite_focus=true



---

archive/issue_comments_436758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T13:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436759.json:
```json
{
    "body": "The `direct` variant should use `src/environment.yml` - which installs the Python packages of Sage in addition to what is listed in `environment.yml`",
    "created_at": "2020-12-22T14:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436759",
    "user": "https://github.com/mkoeppe"
}
```

The `direct` variant should use `src/environment.yml` - which installs the Python packages of Sage in addition to what is listed in `environment.yml`



---

archive/issue_comments_436760.json:
```json
{
    "body": "The `lib64` looks like a conda packaging bug to me - `@`isuruf, can you help?",
    "created_at": "2020-12-22T14:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436760",
    "user": "https://github.com/mkoeppe"
}
```

The `lib64` looks like a conda packaging bug to me - `@`isuruf, can you help?



---

archive/issue_comments_436761.json:
```json
{
    "body": "`environment.yml` already includes `compilers` -- I don't think adding `cxx-compiler` should be necessary",
    "created_at": "2020-12-22T14:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436761",
    "user": "https://github.com/mkoeppe"
}
```

`environment.yml` already includes `compilers` -- I don't think adding `cxx-compiler` should be necessary



---

archive/issue_comments_436762.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T14:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436763.json:
```json
{
    "body": "Replying to [comment:13 gh-tobiasdiez]:\n> Made a bit more progress, but it currently errors while compiling gcc. Moreover, there is a problem in the detection of the conda/system gcc because \"sage-env-config\" doesn't exist.\n> https://github.com/tobiasdiez/sage/runs/1594867631?check_suite_focus=true\n\nThis is now #31097.",
    "created_at": "2020-12-22T15:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436763",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:13 gh-tobiasdiez]:
> Made a bit more progress, but it currently errors while compiling gcc. Moreover, there is a problem in the detection of the conda/system gcc because "sage-env-config" doesn't exist.
> https://github.com/tobiasdiez/sage/runs/1594867631?check_suite_focus=true

This is now #31097.



---

archive/issue_comments_436764.json:
```json
{
    "body": "I don't see a `lib64` folder. Which package is that coming from?",
    "created_at": "2020-12-22T16:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436764",
    "user": "https://github.com/isuruf"
}
```

I don't see a `lib64` folder. Which package is that coming from?



---

archive/issue_comments_436765.json:
```json
{
    "body": "It contains `libcc1.so` so I guess gcc, g++ or some other compiler package.",
    "created_at": "2020-12-22T16:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436765",
    "user": "https://github.com/tobiasdiez"
}
```

It contains `libcc1.so` so I guess gcc, g++ or some other compiler package.



---

archive/issue_comments_436766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T18:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436767.json:
```json
{
    "body": "Current status:\n- Building sage using `make` on top of conda fails, since gcc is not found and the custom build of gcc fails.\n- Installing sagelib on top of a conda works, but many doctests fail.\n\nhttps://github.com/sagemath/sagetrac-mirror/actions?query=workflow%3A%22Build+%26+Test+using+conda%22\n\nI let somebody else with more experience in conda/the intricacies of sage's build system take over from here.",
    "created_at": "2020-12-22T18:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436767",
    "user": "https://github.com/tobiasdiez"
}
```

Current status:
- Building sage using `make` on top of conda fails, since gcc is not found and the custom build of gcc fails.
- Installing sagelib on top of a conda works, but many doctests fail.

https://github.com/sagemath/sagetrac-mirror/actions?query=workflow%3A%22Build+%26+Test+using+conda%22

I let somebody else with more experience in conda/the intricacies of sage's build system take over from here.



---

archive/issue_comments_436768.json:
```json
{
    "body": "Thanks for getting this started!",
    "created_at": "2020-12-22T18:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436768",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for getting this started!



---

archive/issue_comments_436769.json:
```json
{
    "body": "Unfortunately the runs do not give the config.log",
    "created_at": "2020-12-22T18:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436769",
    "user": "https://github.com/mkoeppe"
}
```

Unfortunately the runs do not give the config.log



---

archive/issue_comments_436770.json:
```json
{
    "body": "Now I finally realize that for `on-top-of-spkg` you were trying to do `./configure --prefix=$CONDA_PREFIX` -- that can't work.",
    "created_at": "2020-12-22T18:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436770",
    "user": "https://github.com/mkoeppe"
}
```

Now I finally realize that for `on-top-of-spkg` you were trying to do `./configure --prefix=$CONDA_PREFIX` -- that can't work.



---

archive/issue_comments_436771.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T21:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436772.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T21:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436773.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T21:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436773",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436774.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> Now I finally realize that for `on-top-of-spkg` you were trying to do `./configure --prefix=$CONDA_PREFIX` -- that can't work. \n\nThanks! Removing the prefix part indeed fixed the gcc issue. Now we are further in the build, and find this beautiful error:\n\n```\n2020-12-22T21:44:17.7966259Z [cvxopt-1.2.5]   x86_64-conda_cos6-linux-gnu-gcc -pthread -shared -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -Wl,-rpath-link,/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -L/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -Wl,-rpath,/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -Wl,-rpath-link,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /usr/share/miniconda/envs/sage-build/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /usr/share/miniconda/envs/sage-build/include build/temp.linux-x86_64-3.8/src/C/lapack.o -L/usr/share/miniconda/envs/sage-build/lib -lopenblas -lopenblas -o build/lib.linux-x86_64-3.8/cvxopt/lapack.cpython-38-x86_64-linux-gnu.so\n2020-12-22T21:44:17.7974135Z [cvxopt-1.2.5]   building 'umfpack' extension\n2020-12-22T21:44:17.7979362Z [cvxopt-1.2.5]   /usr/share/miniconda/envs/sage-build/bin/x86_64-conda-linux-gnu-cc -Wno-unused-result -Wsign-compare -DNDEBUG -fwrapv -O2 -Wall -Wstrict-prototypes -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /usr/share/miniconda/envs/sage-build/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /usr/share/miniconda/envs/sage-build/include -fPIC -I/usr/include -I/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/include -I/usr/share/miniconda/envs/sage-build/include/python3.8 -c src/C/umfpack.c -o build/temp.linux-x86_64-3.8/src/C/umfpack.o\n2020-12-22T21:44:17.7990748Z [cvxopt-1.2.5]   In file included from /usr/share/miniconda/envs/sage-build/include/python3.8/Python.h:11:0,\n2020-12-22T21:44:17.7991831Z [cvxopt-1.2.5]                    from src/C/cvxopt.h:22,\n2020-12-22T21:44:17.7992613Z [cvxopt-1.2.5]                    from src/C/umfpack.c:22:\n2020-12-22T21:44:17.7993750Z [cvxopt-1.2.5]   /usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory\n2020-12-22T21:44:17.7994924Z [cvxopt-1.2.5]    #include <bits/libc-header-start.h>\n2020-12-22T21:44:17.7995741Z [cvxopt-1.2.5]             ^~~~~~~~~~~~~~~~~~~~~~~~~~\n2020-12-22T21:44:17.7996470Z [cvxopt-1.2.5]   compilation terminated.\n2020-12-22T21:44:17.7997728Z [cvxopt-1.2.5]   error: command '/usr/share/miniconda/envs/sage-build/bin/x86_64-conda-linux-gnu-cc' failed with exit status 1\n2020-12-22T21:44:17.7999070Z [cvxopt-1.2.5]   Building wheel for cvxopt (setup.py): finished with status 'error'\n```\n\nCould this be related to the fact that libcc1 is installed in `lib64`?",
    "created_at": "2020-12-22T21:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436774",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:28 mkoeppe]:
> Now I finally realize that for `on-top-of-spkg` you were trying to do `./configure --prefix=$CONDA_PREFIX` -- that can't work. 

Thanks! Removing the prefix part indeed fixed the gcc issue. Now we are further in the build, and find this beautiful error:

```
2020-12-22T21:44:17.7966259Z [cvxopt-1.2.5]   x86_64-conda_cos6-linux-gnu-gcc -pthread -shared -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -Wl,-rpath-link,/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -L/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -Wl,-rpath,/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/lib -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/usr/share/miniconda/envs/sage-build/lib -Wl,-rpath-link,/usr/share/miniconda/envs/sage-build/lib -L/usr/share/miniconda/envs/sage-build/lib -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /usr/share/miniconda/envs/sage-build/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /usr/share/miniconda/envs/sage-build/include build/temp.linux-x86_64-3.8/src/C/lapack.o -L/usr/share/miniconda/envs/sage-build/lib -lopenblas -lopenblas -o build/lib.linux-x86_64-3.8/cvxopt/lapack.cpython-38-x86_64-linux-gnu.so
2020-12-22T21:44:17.7974135Z [cvxopt-1.2.5]   building 'umfpack' extension
2020-12-22T21:44:17.7979362Z [cvxopt-1.2.5]   /usr/share/miniconda/envs/sage-build/bin/x86_64-conda-linux-gnu-cc -Wno-unused-result -Wsign-compare -DNDEBUG -fwrapv -O2 -Wall -Wstrict-prototypes -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -pipe -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /usr/share/miniconda/envs/sage-build/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /usr/share/miniconda/envs/sage-build/include -fPIC -I/usr/include -I/home/runner/work/sagetrac-mirror/sagetrac-mirror/local/include -I/usr/share/miniconda/envs/sage-build/include/python3.8 -c src/C/umfpack.c -o build/temp.linux-x86_64-3.8/src/C/umfpack.o
2020-12-22T21:44:17.7990748Z [cvxopt-1.2.5]   In file included from /usr/share/miniconda/envs/sage-build/include/python3.8/Python.h:11:0,
2020-12-22T21:44:17.7991831Z [cvxopt-1.2.5]                    from src/C/cvxopt.h:22,
2020-12-22T21:44:17.7992613Z [cvxopt-1.2.5]                    from src/C/umfpack.c:22:
2020-12-22T21:44:17.7993750Z [cvxopt-1.2.5]   /usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory
2020-12-22T21:44:17.7994924Z [cvxopt-1.2.5]    #include <bits/libc-header-start.h>
2020-12-22T21:44:17.7995741Z [cvxopt-1.2.5]             ^~~~~~~~~~~~~~~~~~~~~~~~~~
2020-12-22T21:44:17.7996470Z [cvxopt-1.2.5]   compilation terminated.
2020-12-22T21:44:17.7997728Z [cvxopt-1.2.5]   error: command '/usr/share/miniconda/envs/sage-build/bin/x86_64-conda-linux-gnu-cc' failed with exit status 1
2020-12-22T21:44:17.7999070Z [cvxopt-1.2.5]   Building wheel for cvxopt (setup.py): finished with status 'error'
```

Could this be related to the fact that libcc1 is installed in `lib64`?



---

archive/issue_comments_436775.json:
```json
{
    "body": "This is known. #30710",
    "created_at": "2020-12-22T21:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436775",
    "user": "https://github.com/isuruf"
}
```

This is known. #30710



---

archive/issue_comments_436776.json:
```json
{
    "body": "Ah thx for the pointer!",
    "created_at": "2020-12-22T22:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436776",
    "user": "https://github.com/tobiasdiez"
}
```

Ah thx for the pointer!



---

archive/issue_comments_436777.json:
```json
{
    "body": "I guess the main objective of this ticket was to add a workflow verifying that sagelib installed on top of conda works. Since this is accomplished, I'll put it as ready for review.\n\nFixing the doctests and the build using `make` can be done later (e.g by resolving #30710).",
    "created_at": "2020-12-22T22:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436777",
    "user": "https://github.com/tobiasdiez"
}
```

I guess the main objective of this ticket was to add a workflow verifying that sagelib installed on top of conda works. Since this is accomplished, I'll put it as ready for review.

Fixing the doctests and the build using `make` can be done later (e.g by resolving #30710).



---

archive/issue_comments_436778.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-22T22:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436778",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_436779.json:
```json
{
    "body": "As `on-top-of-spkg` turns out to be a variant of `local-conda-forge-ubuntu-standard`, I think I would want to implement this variant using tox.",
    "created_at": "2020-12-23T00:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436779",
    "user": "https://github.com/mkoeppe"
}
```

As `on-top-of-spkg` turns out to be a variant of `local-conda-forge-ubuntu-standard`, I think I would want to implement this variant using tox.



---

archive/issue_comments_436780.json:
```json
{
    "body": "I have opened #31099 for this.",
    "created_at": "2020-12-23T00:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436780",
    "user": "https://github.com/mkoeppe"
}
```

I have opened #31099 for this.



---

archive/issue_comments_436781.json:
```json
{
    "body": "Replying to [comment:36 mkoeppe]:\n> As `on-top-of-spkg` turns out to be a variant of `local-conda-forge-ubuntu-standard`, I think I would want to implement this variant using tox.\n\nI thought about using tox as well, but there are\n\na) problems setting up conda on github actions (this is why the workflow uses a special action for the conda setup) \n\nb) difficulties with conda and tox environment interactions (which I guess are handled by the tox-conda plugin, but I didn't wanted to dive into this)\n\nc) I still think tox is not the right tool for managing the user's environment beyond the Python environment.",
    "created_at": "2020-12-23T11:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436781",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:36 mkoeppe]:
> As `on-top-of-spkg` turns out to be a variant of `local-conda-forge-ubuntu-standard`, I think I would want to implement this variant using tox.

I thought about using tox as well, but there are

a) problems setting up conda on github actions (this is why the workflow uses a special action for the conda setup) 

b) difficulties with conda and tox environment interactions (which I guess are handled by the tox-conda plugin, but I didn't wanted to dive into this)

c) I still think tox is not the right tool for managing the user's environment beyond the Python environment.



---

archive/issue_comments_436782.json:
```json
{
    "body": "`local-conda-forge-ubuntu-standard` has been running for months on GH Actions, see for example https://github.com/sagemath/sage/runs/1553907433 for 9.3.beta4.\n\n#31099 is just a matter of creating a variant that uses `conda env create -f environment.yml` instead of `conda install ...`.",
    "created_at": "2020-12-23T17:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436782",
    "user": "https://github.com/mkoeppe"
}
```

`local-conda-forge-ubuntu-standard` has been running for months on GH Actions, see for example https://github.com/sagemath/sage/runs/1553907433 for 9.3.beta4.

#31099 is just a matter of creating a variant that uses `conda env create -f environment.yml` instead of `conda install ...`.



---

archive/issue_comments_436783.json:
```json
{
    "body": "red branch => needs work",
    "created_at": "2021-01-31T20:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436783",
    "user": "https://github.com/fchapoton"
}
```

red branch => needs work



---

archive/issue_comments_436784.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-31T20:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436784",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436785.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436785",
    "user": "https://github.com/mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_436786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-12T17:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_436787.json:
```json
{
    "body": "I have reduced the branch to one of the jobs, `direct`, to remove the duplication with the existing workflows.",
    "created_at": "2021-11-12T17:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436787",
    "user": "https://github.com/mkoeppe"
}
```

I have reduced the branch to one of the jobs, `direct`, to remove the duplication with the existing workflows.



---

archive/issue_comments_436788.json:
```json
{
    "body": "Still needs updating to follow the steps of \"Conda for Sage Developers\" - https://wiki.sagemath.org/Conda - help welcome",
    "created_at": "2021-11-12T17:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436788",
    "user": "https://github.com/mkoeppe"
}
```

Still needs updating to follow the steps of "Conda for Sage Developers" - https://wiki.sagemath.org/Conda - help welcome



---

archive/issue_comments_436789.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2022-02-10T20:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436789",
    "user": "https://github.com/tobiasdiez"
}
```

Last 10 new commits:



---

archive/issue_comments_436790.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-10T23:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436790",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_436791.json:
```json
{
    "body": "Okay, this is now ready for review.\n\nAny pointers to the two open issues are welcome. I looked for open tickets in these directions, but couldn't find one.",
    "created_at": "2022-02-10T23:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436791",
    "user": "https://github.com/tobiasdiez"
}
```

Okay, this is now ready for review.

Any pointers to the two open issues are welcome. I looked for open tickets in these directions, but couldn't find one.



---

archive/issue_comments_436792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-10T23:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436793.json:
```json
{
    "body": "In https://github.com/sagemath/sagetrac-mirror/runs/5146995129?check_suite_focus=true I see\n\nI see \n\n```\nbuilding 'sage.libs.lcalc.lcalc_Lfunction' extension\n    cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++\n    In file included from sage/libs/lcalc/lcalc_Lfunction.cpp:740:\n    sage/libs/lcalc/lcalc_sage.h:1:10: fatal error: lcalc/L.h: No such file or directory\n        1 | #include \"lcalc/L.h\"\n          |          ^~~~~~~~~~~\n    compilation terminated.\n    building 'sage.libs.libecm' extension\n```\n",
    "created_at": "2022-02-10T23:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436793",
    "user": "https://github.com/mkoeppe"
}
```

In https://github.com/sagemath/sagetrac-mirror/runs/5146995129?check_suite_focus=true I see

I see 

```
building 'sage.libs.lcalc.lcalc_Lfunction' extension
    cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++
    In file included from sage/libs/lcalc/lcalc_Lfunction.cpp:740:
    sage/libs/lcalc/lcalc_sage.h:1:10: fatal error: lcalc/L.h: No such file or directory
        1 | #include "lcalc/L.h"
          |          ^~~~~~~~~~~
    compilation terminated.
    building 'sage.libs.libecm' extension
```




---

archive/issue_comments_436794.json:
```json
{
    "body": "Good observation. I think, however, this is not the reason why the build terminates as this error occurs somewhere in the middle (and I had similar error messages with `gap` before).\nI've added it to the list of \"issues\" in the ticket description.",
    "created_at": "2022-02-11T08:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436794",
    "user": "https://github.com/tobiasdiez"
}
```

Good observation. I think, however, this is not the reason why the build terminates as this error occurs somewhere in the middle (and I had similar error messages with `gap` before).
I've added it to the list of "issues" in the ticket description.



---

archive/issue_comments_436795.json:
```json
{
    "body": "This is the reason for the failure. There's no mystery there.",
    "created_at": "2022-02-11T18:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436795",
    "user": "https://github.com/mkoeppe"
}
```

This is the reason for the failure. There's no mystery there.



---

archive/issue_comments_436796.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-11T18:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436796",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436797.json:
```json
{
    "body": "Do you get `lcalc>=2` with conda?",
    "created_at": "2022-02-11T19:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436797",
    "user": "https://github.com/isuruf"
}
```

Do you get `lcalc>=2` with conda?



---

archive/issue_comments_436798.json:
```json
{
    "body": "Replying to [comment:55 mkoeppe]:\n> This is the reason for the failure. There's no mystery there.\n\nCould be. But the point of this ticket is to add the github action, so that one can fix these issues in follow-up tickets and have a direct verification. It might take quite some time until this workflow is green, especially since there are probably quite a few tests that fail.\n\nSo except if you think that there is something fundamentally flawed with the current steps which result in the lcalc error, this should be ready for review.",
    "created_at": "2022-02-11T20:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436798",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:55 mkoeppe]:
> This is the reason for the failure. There's no mystery there.

Could be. But the point of this ticket is to add the github action, so that one can fix these issues in follow-up tickets and have a direct verification. It might take quite some time until this workflow is green, especially since there are probably quite a few tests that fail.

So except if you think that there is something fundamentally flawed with the current steps which result in the lcalc error, this should be ready for review.



---

archive/issue_comments_436799.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-11T20:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436799",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_436800.json:
```json
{
    "body": "Replying to [comment:56 isuruf]:\n> Do you get `lcalc>=2` with conda?\n\nNope, its installing lcalc 1.23 h0d16fac_1004 conda-forge. That's probably the reason why its not working.",
    "created_at": "2022-02-11T20:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436800",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:56 isuruf]:
> Do you get `lcalc>=2` with conda?

Nope, its installing lcalc 1.23 h0d16fac_1004 conda-forge. That's probably the reason why its not working.



---

archive/issue_comments_436801.json:
```json
{
    "body": "So `build/pkgs/lcalc/distros/conda.txt` should be changed",
    "created_at": "2022-02-11T20:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436801",
    "user": "https://github.com/mkoeppe"
}
```

So `build/pkgs/lcalc/distros/conda.txt` should be changed



---

archive/issue_comments_436802.json:
```json
{
    "body": "Replying to [comment:57 gh-tobiasdiez]:\n> the point of this ticket is to add the github action\n\nWell, it fails early, so we cannot see whether the later steps work.",
    "created_at": "2022-02-11T20:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436802",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:57 gh-tobiasdiez]:
> the point of this ticket is to add the github action

Well, it fails early, so we cannot see whether the later steps work.



---

archive/issue_comments_436803.json:
```json
{
    "body": "Replying to [comment:59 mkoeppe]:\n> So `build/pkgs/lcalc/distros/conda.txt` should be changed\n\nI don't think it will be that easy to solve:\n\n```\nmamba install lcalc=2.0.5 -n sage-dev\n > package libeantic-1.0.2-hf1f868f_1 requires antic >=0.2.4,<0.3.0a0, but none of the providers can be installed\n\nmamba install libeantic=1.1.0 -n sage-dev\n > package libeantic-1.1.0-h52e3b27_0 requires arb >=2.21.1,<2.22.0a0, but none of the providers can be installed\n\nmamba install arb=2.21.1 -n sage-dev\n > package e-antic-1.0.2-hf1f868f_0 requires arb >=2.19.0,<2.20.0a0, but none of the providers can be installed\n```\n\nI appears that there is a funny cyclic dependency thing going on.",
    "created_at": "2022-02-12T15:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436803",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:59 mkoeppe]:
> So `build/pkgs/lcalc/distros/conda.txt` should be changed

I don't think it will be that easy to solve:

```
mamba install lcalc=2.0.5 -n sage-dev
 > package libeantic-1.0.2-hf1f868f_1 requires antic >=0.2.4,<0.3.0a0, but none of the providers can be installed

mamba install libeantic=1.1.0 -n sage-dev
 > package libeantic-1.1.0-h52e3b27_0 requires arb >=2.21.1,<2.22.0a0, but none of the providers can be installed

mamba install arb=2.21.1 -n sage-dev
 > package e-antic-1.0.2-hf1f868f_0 requires arb >=2.19.0,<2.20.0a0, but none of the providers can be installed
```

I appears that there is a funny cyclic dependency thing going on.



---

archive/issue_comments_436804.json:
```json
{
    "body": "Replying to [comment:60 mkoeppe]:\n> Replying to [comment:57 gh-tobiasdiez]:\n> > the point of this ticket is to add the github action\n> \n> Well, it fails early, so we cannot see whether the later steps work.\n\nShould I un-comment the last test step for now?",
    "created_at": "2022-02-12T15:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436804",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:60 mkoeppe]:
> Replying to [comment:57 gh-tobiasdiez]:
> > the point of this ticket is to add the github action
> 
> Well, it fails early, so we cannot see whether the later steps work.

Should I un-comment the last test step for now?



---

archive/issue_comments_436805.json:
```json
{
    "body": "Try switching from `src/environment-optional.yml` to `src/environment.yml`.\n`e_antic` is an optional package for Sage. Let's try without optional packages first.",
    "created_at": "2022-02-12T16:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436805",
    "user": "https://github.com/mkoeppe"
}
```

Try switching from `src/environment-optional.yml` to `src/environment.yml`.
`e_antic` is an optional package for Sage. Let's try without optional packages first.



---

archive/issue_comments_436806.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-12T17:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436807.json:
```json
{
    "body": "That should indeed work to get `loalc 2.0.5`. Good suggestion.\n\nFor the record: first installing `environment.yml` and then updating the env to `environment-optional.yml` yields the following downgrade of packgages:\n\n```\n  Downgrade:\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  - arb                                               2.22.1  hbbd85db_0              installed\n  + arb                                               2.19.0  h7e34412_0              conda-forge/linux-64        7MB\n  - boost-cpp                                         1.77.0  h359cf19_1              installed\n  + boost-cpp                                         1.74.0  h312852a_4              conda-forge/linux-64     Cached\n  - cvxopt                                             1.2.7  py310h9fd565e_1         installed\n  + cvxopt                                             1.2.6  py38h55e5319_0          conda-forge/linux-64     Cached\n  - cysignals                                         1.11.2  py310h15010d2_0         installed\n  + cysignals                                         1.10.3  py38hd3cf888_0          conda-forge/linux-64     Cached\n  - eclib                                           20210625  h52f5ea4_4              installed\n  + eclib                                           20190909  h5b7fb09_3              conda-forge/linux-64       36MB\n  - gap-core                                          4.11.1  h1725ef4_2              installed\n  + gap-core                                          4.11.0  h1725ef4_7              conda-forge/linux-64       67MB\n  - gap-defaults                                      4.11.1  ha770c72_2              installed\n  + gap-defaults                                      4.11.0  ha770c72_7              conda-forge/linux-64       88MB\n  - gsl                                                  2.7  he838d99_0              installed\n  + gsl                                                  2.6  he838d99_2              conda-forge/linux-64     Cached\n  - harfbuzz                                           3.3.1  hb4a5f5f_0              installed\n  + harfbuzz                                           3.1.1  h83ec7ef_0              conda-forge/linux-64     Cached\n  - icu                                                 69.1  h9c3ff4c_0              installed\n  + icu                                                 68.2  h9c3ff4c_0              conda-forge/linux-64     Cached\n  - lcalc                                              2.0.5  h8cd7e2e_0              installed\n  + lcalc                                               1.23  h0d16fac_1004           conda-forge/linux-64     Cached\n  - libclang                                          13.0.1  default_hc23dcda_0      installed\n  + libclang                                          11.1.0  default_ha53f305_1      conda-forge/linux-64     Cached\n  - libflint                                           2.8.4  hd3cd37b_ntl_100        installed\n  + libflint                                           2.6.3  h6b702e8_0              conda-forge/linux-64       11MB\n  - libpq                                               14.2  hd57d9b9_0              installed\n  + libpq                                               13.5  hd57d9b9_1              conda-forge/linux-64     Cached\n  - libuv                                             1.43.0  h7f98852_0              installed\n  + libuv                                             1.42.0  h7f98852_0              conda-forge/linux-64     Cached\n  - pari                                              2.13.3  h82e6b41_1_pthread      installed\n  + pari                                              2.11.4  hddaffa3_2              conda-forge/linux-64     Cached\n  - python                                            3.10.2  h85951f9_3_cpython      installed\n  + python                                            3.8.12  ha38a3c6_3_cpython      conda-forge/linux-64     Cached\n  - python_abi                                          3.10  2_cp310                 installed\n  + python_abi                                           3.8  2_cp38                  conda-forge/linux-64     Cached\n  - r-base                                             4.1.2  hde4fec0_0              installed\n  + r-base                                             4.1.1  hb67fd72_0              conda-forge/linux-64     Cached\n  - singular                                        4.2.1.p3  haca423c_0              installed\n  + singular                                        4.1.1.p2  ha188dad_4              conda-forge/linux-64       22MB\n\n```\n",
    "created_at": "2022-02-12T17:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436807",
    "user": "https://github.com/tobiasdiez"
}
```

That should indeed work to get `loalc 2.0.5`. Good suggestion.

For the record: first installing `environment.yml` and then updating the env to `environment-optional.yml` yields the following downgrade of packgages:

```
  Downgrade:


  - arb                                               2.22.1  hbbd85db_0              installed
  + arb                                               2.19.0  h7e34412_0              conda-forge/linux-64        7MB
  - boost-cpp                                         1.77.0  h359cf19_1              installed
  + boost-cpp                                         1.74.0  h312852a_4              conda-forge/linux-64     Cached
  - cvxopt                                             1.2.7  py310h9fd565e_1         installed
  + cvxopt                                             1.2.6  py38h55e5319_0          conda-forge/linux-64     Cached
  - cysignals                                         1.11.2  py310h15010d2_0         installed
  + cysignals                                         1.10.3  py38hd3cf888_0          conda-forge/linux-64     Cached
  - eclib                                           20210625  h52f5ea4_4              installed
  + eclib                                           20190909  h5b7fb09_3              conda-forge/linux-64       36MB
  - gap-core                                          4.11.1  h1725ef4_2              installed
  + gap-core                                          4.11.0  h1725ef4_7              conda-forge/linux-64       67MB
  - gap-defaults                                      4.11.1  ha770c72_2              installed
  + gap-defaults                                      4.11.0  ha770c72_7              conda-forge/linux-64       88MB
  - gsl                                                  2.7  he838d99_0              installed
  + gsl                                                  2.6  he838d99_2              conda-forge/linux-64     Cached
  - harfbuzz                                           3.3.1  hb4a5f5f_0              installed
  + harfbuzz                                           3.1.1  h83ec7ef_0              conda-forge/linux-64     Cached
  - icu                                                 69.1  h9c3ff4c_0              installed
  + icu                                                 68.2  h9c3ff4c_0              conda-forge/linux-64     Cached
  - lcalc                                              2.0.5  h8cd7e2e_0              installed
  + lcalc                                               1.23  h0d16fac_1004           conda-forge/linux-64     Cached
  - libclang                                          13.0.1  default_hc23dcda_0      installed
  + libclang                                          11.1.0  default_ha53f305_1      conda-forge/linux-64     Cached
  - libflint                                           2.8.4  hd3cd37b_ntl_100        installed
  + libflint                                           2.6.3  h6b702e8_0              conda-forge/linux-64       11MB
  - libpq                                               14.2  hd57d9b9_0              installed
  + libpq                                               13.5  hd57d9b9_1              conda-forge/linux-64     Cached
  - libuv                                             1.43.0  h7f98852_0              installed
  + libuv                                             1.42.0  h7f98852_0              conda-forge/linux-64     Cached
  - pari                                              2.13.3  h82e6b41_1_pthread      installed
  + pari                                              2.11.4  hddaffa3_2              conda-forge/linux-64     Cached
  - python                                            3.10.2  h85951f9_3_cpython      installed
  + python                                            3.8.12  ha38a3c6_3_cpython      conda-forge/linux-64     Cached
  - python_abi                                          3.10  2_cp310                 installed
  + python_abi                                           3.8  2_cp38                  conda-forge/linux-64     Cached
  - r-base                                             4.1.2  hde4fec0_0              installed
  + r-base                                             4.1.1  hb67fd72_0              conda-forge/linux-64     Cached
  - singular                                        4.2.1.p3  haca423c_0              installed
  + singular                                        4.1.1.p2  ha188dad_4              conda-forge/linux-64       22MB

```




---

archive/issue_comments_436808.json:
```json
{
    "body": "There must be some outdated pins / version constraints in the conda-forge packaging. Likely related to the fact that the Sage distribution has fallen behind upstream regarding `e_antic`/`normaliz` (see #31588).",
    "created_at": "2022-02-12T18:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436808",
    "user": "https://github.com/mkoeppe"
}
```

There must be some outdated pins / version constraints in the conda-forge packaging. Likely related to the fact that the Sage distribution has fallen behind upstream regarding `e_antic`/`normaliz` (see #31588).



---

archive/issue_comments_436809.json:
```json
{
    "body": "`@`isuruf, I think Sage works fine with current upstream versions of normaliz/pynormaliz that use the `e_antic` 1.x series, so it should be safe to remove such constraints. (We just can't yet update within the Sage distribution because of portability bugs in `e_antic`, see #31588.)",
    "created_at": "2022-02-12T18:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436809",
    "user": "https://github.com/mkoeppe"
}
```

`@`isuruf, I think Sage works fine with current upstream versions of normaliz/pynormaliz that use the `e_antic` 1.x series, so it should be safe to remove such constraints. (We just can't yet update within the Sage distribution because of portability bugs in `e_antic`, see #31588.)



---

archive/issue_comments_436810.json:
```json
{
    "body": "Replying to [comment:59 mkoeppe]:\n> So `build/pkgs/lcalc/distros/conda.txt` should be changed\n... to say `\"lcalc >=2\"`",
    "created_at": "2022-02-12T18:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436810",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:59 mkoeppe]:
> So `build/pkgs/lcalc/distros/conda.txt` should be changed
... to say `"lcalc >=2"`



---

archive/issue_comments_436811.json:
```json
{
    "body": "Regarding the `pari` issue mentioned in the ticket description, we should probably use  `configure --with-system-pari=force` so the error is signalled earlier\n\nLet's also keep the instructions in https://wiki.sagemath.org/Conda updated.",
    "created_at": "2022-02-12T18:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436811",
    "user": "https://github.com/mkoeppe"
}
```

Regarding the `pari` issue mentioned in the ticket description, we should probably use  `configure --with-system-pari=force` so the error is signalled earlier

Let's also keep the instructions in https://wiki.sagemath.org/Conda updated.



---

archive/issue_comments_436812.json:
```json
{
    "body": "Oh, and `configure --with-system-lcalc=force` too...",
    "created_at": "2022-02-12T18:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436812",
    "user": "https://github.com/mkoeppe"
}
```

Oh, and `configure --with-system-lcalc=force` too...



---

archive/issue_comments_436813.json:
```json
{
    "body": "Replying to [comment:70 mkoeppe]:\n> Regarding the `pari` issue mentioned in the ticket description, we should probably use  `configure --with-system-pari=force` so the error is signalled earlier\n> \n> Let's also keep the instructions in https://wiki.sagemath.org/Conda updated. \n\nWith the basic env, its now also using `pari 2.13.3`.\n\nI guess some of the optional packages is lagging behind a bit and still requiring some older version of some package. This then leads to these various downgrades of arb, ecl, pari, lcalc etc",
    "created_at": "2022-02-12T18:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436813",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:70 mkoeppe]:
> Regarding the `pari` issue mentioned in the ticket description, we should probably use  `configure --with-system-pari=force` so the error is signalled earlier
> 
> Let's also keep the instructions in https://wiki.sagemath.org/Conda updated. 

With the basic env, its now also using `pari 2.13.3`.

I guess some of the optional packages is lagging behind a bit and still requiring some older version of some package. This then leads to these various downgrades of arb, ecl, pari, lcalc etc



---

archive/issue_comments_436814.json:
```json
{
    "body": "Yes, and we are missing many of the version constraints that are in https://github.com/conda-forge/sage-feedstock/blob/master/recipe/meta.yaml",
    "created_at": "2022-02-12T18:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436814",
    "user": "https://github.com/mkoeppe"
}
```

Yes, and we are missing many of the version constraints that are in https://github.com/conda-forge/sage-feedstock/blob/master/recipe/meta.yaml



---

archive/issue_comments_436815.json:
```json
{
    "body": "Many of these should be added to the `conda.txt` files, so that they will be included in our `src/environment*.yml`.",
    "created_at": "2022-02-12T18:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436815",
    "user": "https://github.com/mkoeppe"
}
```

Many of these should be added to the `conda.txt` files, so that they will be included in our `src/environment*.yml`.



---

archive/issue_comments_436816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-12T18:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436817.json:
```json
{
    "body": "Okay, after using `environment.yml` the build now succeeds. The tests fail almost immediately at the import of `sage.all`, because `primecountpy` is not installed in the conda env (it is also in neither `environment` file).\n\nI propose to get this ticket in and then work on the improvements to fix the various issues.",
    "created_at": "2022-02-12T20:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436817",
    "user": "https://github.com/tobiasdiez"
}
```

Okay, after using `environment.yml` the build now succeeds. The tests fail almost immediately at the import of `sage.all`, because `primecountpy` is not installed in the conda env (it is also in neither `environment` file).

I propose to get this ticket in and then work on the improvements to fix the various issues.



---

archive/issue_comments_436818.json:
```json
{
    "body": "Just add `build/pkgs/primecountpy/distros/conda.txt`",
    "created_at": "2022-02-12T20:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436818",
    "user": "https://github.com/mkoeppe"
}
```

Just add `build/pkgs/primecountpy/distros/conda.txt`



---

archive/issue_comments_436819.json:
```json
{
    "body": "At the current pace, it will take months before this ticket is merged. Little point in waiting for that to happen. There's a momentum now to fix it.",
    "created_at": "2022-02-12T20:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436819",
    "user": "https://github.com/mkoeppe"
}
```

At the current pace, it will take months before this ticket is merged. Little point in waiting for that to happen. There's a momentum now to fix it.



---

archive/issue_comments_436820.json:
```json
{
    "body": "comment:70, comment:71, comment:76, comment:82 are actionable",
    "created_at": "2022-02-12T20:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436820",
    "user": "https://github.com/mkoeppe"
}
```

comment:70, comment:71, comment:76, comment:82 are actionable



---

archive/issue_comments_436821.json:
```json
{
    "body": "Also, the ticket description claims that it follows https://wiki.sagemath.org/Conda; but that uses `pip install -r src/requirements.txt`, which would install the missing `primecountpy` too.",
    "created_at": "2022-02-12T20:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436821",
    "user": "https://github.com/mkoeppe"
}
```

Also, the ticket description claims that it follows https://wiki.sagemath.org/Conda; but that uses `pip install -r src/requirements.txt`, which would install the missing `primecountpy` too.



---

archive/issue_comments_436822.json:
```json
{
    "body": "It's better to not use pip.",
    "created_at": "2022-02-12T20:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436822",
    "user": "https://github.com/isuruf"
}
```

It's better to not use pip.



---

archive/issue_comments_436823.json:
```json
{
    "body": "Replying to [comment:83 mkoeppe]:\n> At the current pace, it will take months before this ticket is merged. Little point in waiting for that to happen. There's a momentum now to fix it.\n\nThat's sadly true, but follow-up tickets can easily depend on this ticket here to run the CI.",
    "created_at": "2022-02-12T20:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436823",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:83 mkoeppe]:
> At the current pace, it will take months before this ticket is merged. Little point in waiting for that to happen. There's a momentum now to fix it.

That's sadly true, but follow-up tickets can easily depend on this ticket here to run the CI.



---

archive/issue_comments_436824.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-12T20:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436824",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436825.json:
```json
{
    "body": "Replying to [comment:71 mkoeppe]:\n> Oh, and `configure --with-system-lcalc=force` too...\n\nDo you really think we should add a `--with-system-xyz=force` for every system package?",
    "created_at": "2022-02-12T22:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436825",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:71 mkoeppe]:
> Oh, and `configure --with-system-lcalc=force` too...

Do you really think we should add a `--with-system-xyz=force` for every system package?



---

archive/issue_comments_436826.json:
```json
{
    "body": "I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...",
    "created_at": "2022-02-12T22:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436826",
    "user": "https://github.com/mkoeppe"
}
```

I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...



---

archive/issue_comments_436827.json:
```json
{
    "body": "Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`",
    "created_at": "2022-02-12T22:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436827",
    "user": "https://github.com/mkoeppe"
}
```

Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`



---

archive/issue_comments_436828.json:
```json
{
    "body": "Why do you need `--with-system-lcalc=force`?",
    "created_at": "2022-02-12T22:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436828",
    "user": "https://github.com/isuruf"
}
```

Why do you need `--with-system-lcalc=force`?



---

archive/issue_comments_436829.json:
```json
{
    "body": "So that it is an immediate error if the system package is not usable. Here we are testing the workflow that does not run `make` at all.",
    "created_at": "2022-02-12T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436829",
    "user": "https://github.com/mkoeppe"
}
```

So that it is an immediate error if the system package is not usable. Here we are testing the workflow that does not run `make` at all.



---

archive/issue_comments_436830.json:
```json
{
    "body": "Replying to [comment:92 mkoeppe]:\n> Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`\n\nBut doesn't this trigger errors as soon as a system package is rejected? That currently happens with a lot of packages as you can see in the github workflow.\n\nMoreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that \u0300 configure` currently performs.",
    "created_at": "2022-02-12T23:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436830",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:92 mkoeppe]:
> Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`

But doesn't this trigger errors as soon as a system package is rejected? That currently happens with a lot of packages as you can see in the github workflow.

Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that  configure` currently performs.



---

archive/issue_comments_436831.json:
```json
{
    "body": "Replying to [comment:95 gh-tobiasdiez]:\n> Replying to [comment:92 mkoeppe]:\n> > Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`\n> \n> But doesn't this trigger errors as soon as a system package is rejected? That currently happens with a lot of packages as you can see in the github workflow.\n\nYes, that's the idea. For packages that have an `spkg-configure.m4`, our configure script knows which versions work. It should fail early if there is something that cannot be accepted.",
    "created_at": "2022-02-13T00:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436831",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:95 gh-tobiasdiez]:
> Replying to [comment:92 mkoeppe]:
> > Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`
> 
> But doesn't this trigger errors as soon as a system package is rejected? That currently happens with a lot of packages as you can see in the github workflow.

Yes, that's the idea. For packages that have an `spkg-configure.m4`, our configure script knows which versions work. It should fail early if there is something that cannot be accepted.



---

archive/issue_comments_436832.json:
```json
{
    "body": "Replying to [comment:95 gh-tobiasdiez]:\n> Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that \u0300 configure` currently performs.\n\nThat is something that is best left to the downstream packagers.",
    "created_at": "2022-02-13T00:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436832",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:95 gh-tobiasdiez]:
> Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that  configure` currently performs.

That is something that is best left to the downstream packagers.



---

archive/issue_comments_436833.json:
```json
{
    "body": "Replying to [comment:95 gh-tobiasdiez]:\n> That currently happens with a lot of packages as you can see in the github workflow.\n\n`python3` is rejected because your script doesn't follow the instructions at https://wiki.sagemath.org/Conda - `--with-python=$CONDA_PREFIX/bin/python` is missing.",
    "created_at": "2022-02-13T00:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436833",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:95 gh-tobiasdiez]:
> That currently happens with a lot of packages as you can see in the github workflow.

`python3` is rejected because your script doesn't follow the instructions at https://wiki.sagemath.org/Conda - `--with-python=$CONDA_PREFIX/bin/python` is missing.



---

archive/issue_comments_436834.json:
```json
{
    "body": "And many others fail because you use `--without-system-gcc`, which is a bad idea.",
    "created_at": "2022-02-13T00:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436834",
    "user": "https://github.com/mkoeppe"
}
```

And many others fail because you use `--without-system-gcc`, which is a bad idea.



---

archive/issue_comments_436835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-13T09:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436836.json:
```json
{
    "body": "Replying to [comment:99 mkoeppe]:\n> And many others fail because you use `--without-system-gcc`, which is a bad idea.\n\nOtherwise configure fails with\n\n```\n configure: error: \n\n    Given --with-system-gcc=force, but no system package could be used.\n    That's an error.  Please install the indicated package to continue.\n    (To override this error, use ./configure --without-system-gcc)\n```\n",
    "created_at": "2022-02-13T09:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436836",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:99 mkoeppe]:
> And many others fail because you use `--without-system-gcc`, which is a bad idea.

Otherwise configure fails with

```
 configure: error: 

    Given --with-system-gcc=force, but no system package could be used.
    That's an error.  Please install the indicated package to continue.
    (To override this error, use ./configure --without-system-gcc)
```




---

archive/issue_comments_436837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-13T09:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_436838.json:
```json
{
    "body": "Replying to [comment:97 mkoeppe]:\n> Replying to [comment:95 gh-tobiasdiez]:\n> > Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that \u0300 configure` currently performs.\n> \n> That is something that is best left to the downstream packagers.\n> \n\nThe section has the title \"Conda for Sage Developers\" so downstream packagers are not involved here.",
    "created_at": "2022-02-13T09:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436838",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:97 mkoeppe]:
> Replying to [comment:95 gh-tobiasdiez]:
> > Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that  configure` currently performs.
> 
> That is something that is best left to the downstream packagers.
> 

The section has the title "Conda for Sage Developers" so downstream packagers are not involved here.



---

archive/issue_comments_436839.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-13T09:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436839",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_436840.json:
```json
{
    "body": "Replying to [comment:82 mkoeppe]:\n> Just add `build/pkgs/primecountpy/distros/conda.txt`\n\nThis is now #33330.",
    "created_at": "2022-02-13T11:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436840",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:82 mkoeppe]:
> Just add `build/pkgs/primecountpy/distros/conda.txt`

This is now #33330.



---

archive/issue_comments_436841.json:
```json
{
    "body": "I undestand that the GH run on #33330 uses this branch, so it looks good to me.",
    "created_at": "2022-02-13T12:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436841",
    "user": "https://github.com/dimpase"
}
```

I undestand that the GH run on #33330 uses this branch, so it looks good to me.



---

archive/issue_comments_436842.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-13T12:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436842",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_436843.json:
```json
{
    "body": "Also here, thanks for the review.",
    "created_at": "2022-02-13T13:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436843",
    "user": "https://github.com/tobiasdiez"
}
```

Also here, thanks for the review.



---

archive/issue_comments_436844.json:
```json
{
    "body": "I've now created #33331 for the follow-up issues.",
    "created_at": "2022-02-13T13:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436844",
    "user": "https://github.com/tobiasdiez"
}
```

I've now created #33331 for the follow-up issues.



---

archive/issue_comments_436845.json:
```json
{
    "body": "Replying to [comment:103 gh-tobiasdiez]:\n> Replying to [comment:97 mkoeppe]:\n> > Replying to [comment:95 gh-tobiasdiez]:\n> > > Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that \u0300 configure` currently performs.\n> > \n> > That is something that is best left to the downstream packagers.\n> \n> The section has the title \"Conda for Sage Developers\" so downstream packagers are not involved here.\n\nExactly, so in other words we should not attempt to skip `configure`'s checks.",
    "created_at": "2022-02-13T16:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436845",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:103 gh-tobiasdiez]:
> Replying to [comment:97 mkoeppe]:
> > Replying to [comment:95 gh-tobiasdiez]:
> > > Moreover, we have complete control over which versions we install in the conda systems, so one could actually skip the whole system check that  configure` currently performs.
> > 
> > That is something that is best left to the downstream packagers.
> 
> The section has the title "Conda for Sage Developers" so downstream packagers are not involved here.

Exactly, so in other words we should not attempt to skip `configure`'s checks.



---

archive/issue_comments_436846.json:
```json
{
    "body": "Replying to [comment:101 gh-tobiasdiez]:\n> Replying to [comment:99 mkoeppe]:\n> > And many others fail because you use `--without-system-gcc`, which is a bad idea.\n> \n> Otherwise configure fails with\n> {{{\n>  configure: error: \n> \n>     Given --with-system-gcc=force, but no system package could be used.\n>     That's an error.  Please install the indicated package to continue.\n>     (To override this error, use ./configure --without-system-gcc)\n> }}}\n\nWhy does it reject gcc?",
    "created_at": "2022-02-13T16:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436846",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:101 gh-tobiasdiez]:
> Replying to [comment:99 mkoeppe]:
> > And many others fail because you use `--without-system-gcc`, which is a bad idea.
> 
> Otherwise configure fails with
> {{{
>  configure: error: 
> 
>     Given --with-system-gcc=force, but no system package could be used.
>     That's an error.  Please install the indicated package to continue.
>     (To override this error, use ./configure --without-system-gcc)
> }}}

Why does it reject gcc?



---

archive/issue_comments_436847.json:
```json
{
    "body": "comment:98 still unaddressed",
    "created_at": "2022-02-13T16:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436847",
    "user": "https://github.com/mkoeppe"
}
```

comment:98 still unaddressed



---

archive/issue_comments_436848.json:
```json
{
    "body": "Replying to [comment:113 mkoeppe]:\n> comment:98 still unaddressed\n\nIt is addressed in comment:100 (commit \u200b8a297af), no?",
    "created_at": "2022-02-13T21:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436848",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:113 mkoeppe]:
> comment:98 still unaddressed

It is addressed in comment:100 (commit 8a297af), no?



---

archive/issue_comments_436849.json:
```json
{
    "body": "That commit is not on the current branch",
    "created_at": "2022-02-13T21:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436849",
    "user": "https://github.com/mkoeppe"
}
```

That commit is not on the current branch



---

archive/issue_comments_436850.json:
```json
{
    "body": "Yes, I had to revert that commit since the workflow didn't passed. https://github.com/sagemath/sagetrac-mirror/actions/runs/1836383017\n\nThat conda's python is rejected is #31539. And since sage is not invoking python during the workflow run, it also shouldn't matter if its rejected or not.",
    "created_at": "2022-02-13T21:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436850",
    "user": "https://github.com/tobiasdiez"
}
```

Yes, I had to revert that commit since the workflow didn't passed. https://github.com/sagemath/sagetrac-mirror/actions/runs/1836383017

That conda's python is rejected is #31539. And since sage is not invoking python during the workflow run, it also shouldn't matter if its rejected or not.



---

archive/issue_comments_436851.json:
```json
{
    "body": "That failure was from `gcc`, not python. So why back out the fix for python?",
    "created_at": "2022-02-13T21:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436851",
    "user": "https://github.com/mkoeppe"
}
```

That failure was from `gcc`, not python. So why back out the fix for python?



---

archive/issue_comments_436852.json:
```json
{
    "body": "Replying to [comment:116 gh-tobiasdiez]:\n> since sage is not invoking python during the workflow run\n\nHm?",
    "created_at": "2022-02-13T21:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436852",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:116 gh-tobiasdiez]:
> since sage is not invoking python during the workflow run

Hm?



---

archive/issue_comments_436853.json:
```json
{
    "body": "Replying to [comment:117 mkoeppe]:\n> That failure was from `gcc`, not python. So why back out the fix for python?\n\nSince it is working without this \"fix\".",
    "created_at": "2022-02-13T21:51:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436853",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:117 mkoeppe]:
> That failure was from `gcc`, not python. So why back out the fix for python?

Since it is working without this "fix".



---

archive/issue_comments_436854.json:
```json
{
    "body": "Also, could you please add some steps that package up the logs, like the three last steps of `local-ubuntu` in tox.yml?\n\nRight now we cannot see what went wrong in the `gcc` detection, as we cannot see config.log",
    "created_at": "2022-02-13T21:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436854",
    "user": "https://github.com/mkoeppe"
}
```

Also, could you please add some steps that package up the logs, like the three last steps of `local-ubuntu` in tox.yml?

Right now we cannot see what went wrong in the `gcc` detection, as we cannot see config.log



---

archive/issue_comments_436855.json:
```json
{
    "body": "Replying to [comment:119 gh-tobiasdiez]:\n> Replying to [comment:117 mkoeppe]:\n> > That failure was from `gcc`, not python. So why back out the fix for python?\n> \n> Since it is working without this \"fix\".\n\nBut what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.",
    "created_at": "2022-02-13T21:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436855",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:119 gh-tobiasdiez]:
> Replying to [comment:117 mkoeppe]:
> > That failure was from `gcc`, not python. So why back out the fix for python?
> 
> Since it is working without this "fix".

But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.



---

archive/issue_comments_436856.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-02-14T10:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436856",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_436857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T12:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436858.json:
```json
{
    "body": "Replying to [comment:120 mkoeppe]:\n> Also, could you please add some steps that package up the logs, like the three last steps of `local-ubuntu` in tox.yml?\n> \n> Right now we cannot see what went wrong in the `gcc` detection, as we cannot see config.log\n\nDone.",
    "created_at": "2022-02-14T12:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436858",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:120 mkoeppe]:
> Also, could you please add some steps that package up the logs, like the three last steps of `local-ubuntu` in tox.yml?
> 
> Right now we cannot see what went wrong in the `gcc` detection, as we cannot see config.log

Done.



---

archive/issue_comments_436859.json:
```json
{
    "body": "Replying to [comment:121 mkoeppe]:\n> Replying to [comment:119 gh-tobiasdiez]:\n> > Replying to [comment:117 mkoeppe]:\n> > > That failure was from `gcc`, not python. So why back out the fix for python?\n> > \n> > Since it is working without this \"fix\".\n> \n> But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.\n\nI still don't understand why it's so important that sage's configure script accepts conda's python, but I've added the explicit `--with-python` argument.",
    "created_at": "2022-02-14T12:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436859",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:121 mkoeppe]:
> Replying to [comment:119 gh-tobiasdiez]:
> > Replying to [comment:117 mkoeppe]:
> > > That failure was from `gcc`, not python. So why back out the fix for python?
> > 
> > Since it is working without this "fix".
> 
> But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.

I still don't understand why it's so important that sage's configure script accepts conda's python, but I've added the explicit `--with-python` argument.



---

archive/issue_comments_436860.json:
```json
{
    "body": "> I still don't understand why it's so important that sage's configure script accepts conda's python\n\nHow else would you expect to be using Conda's Python packages in Sage, if you used another Python?",
    "created_at": "2022-02-14T13:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436860",
    "user": "https://github.com/dimpase"
}
```

> I still don't understand why it's so important that sage's configure script accepts conda's python

How else would you expect to be using Conda's Python packages in Sage, if you used another Python?



---

archive/issue_comments_436861.json:
```json
{
    "body": "The workflow is completely bypassing the make-scripts of sage. So using Conda's python packages follows the 'usual' strategy:\n- Create (virtual) python environment (done by conda)\n- Install other python packages (done by conda)\n- Install sagelib into the same environment (done via pip install)\n\nSo sage is not managing the python installation nor the python environment. It is simply a normal python package that gets installed in an existing environment. In this context, it is pretty non-standard to pose more requirements at the python installation then a simple version requirement (which is checked by pip). Ideally, you wouldn't even want to call configure, a simple `pip install -e src` should be enough (and that's for example the workflow numpy and scipy are using), but that's of course currently not possible.",
    "created_at": "2022-02-14T14:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436861",
    "user": "https://github.com/tobiasdiez"
}
```

The workflow is completely bypassing the make-scripts of sage. So using Conda's python packages follows the 'usual' strategy:
- Create (virtual) python environment (done by conda)
- Install other python packages (done by conda)
- Install sagelib into the same environment (done via pip install)

So sage is not managing the python installation nor the python environment. It is simply a normal python package that gets installed in an existing environment. In this context, it is pretty non-standard to pose more requirements at the python installation then a simple version requirement (which is checked by pip). Ideally, you wouldn't even want to call configure, a simple `pip install -e src` should be enough (and that's for example the workflow numpy and scipy are using), but that's of course currently not possible.



---

archive/issue_comments_436862.json:
```json
{
    "body": "OK, but note that `./bootstrap` and `./configure` still need to be run to install various things and fill in `*.in` templates.\nPassing wrong parameters to `./configure` is not a good idea, IMHO.",
    "created_at": "2022-02-14T16:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436862",
    "user": "https://github.com/dimpase"
}
```

OK, but note that `./bootstrap` and `./configure` still need to be run to install various things and fill in `*.in` templates.
Passing wrong parameters to `./configure` is not a good idea, IMHO.



---

archive/issue_comments_436863.json:
```json
{
    "body": "Replying to [comment:125 gh-tobiasdiez]:\n> > > Since it is working without this \"fix\".\n> > \n> > But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.\n> \n> I still don't understand why it's so important that sage's configure script accepts conda's python\n\nAs I said before in comment:70, comment:92, etc., the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.",
    "created_at": "2022-02-14T17:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436863",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:125 gh-tobiasdiez]:
> > > Since it is working without this "fix".
> > 
> > But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.
> 
> I still don't understand why it's so important that sage's configure script accepts conda's python

As I said before in comment:70, comment:92, etc., the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.



---

archive/issue_comments_436864.json:
```json
{
    "body": "Replying to [ticket:30845 mkoeppe]:\n> - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)\n\nFor example, this one about `ecl-config` is the result of the misconfiguration. The configure script does not accept system ecl because of the misconfiguration `--without-system-gcc`. So the configuration reflects use of an ECL built using SPKG (which is not done because `make` is not involved).",
    "created_at": "2022-02-14T17:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436864",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [ticket:30845 mkoeppe]:
> - Documentation doesn't mention the use of `--prefix=$CONDA_PREFIX` (without this things like `ecl-config` are not found)

For example, this one about `ecl-config` is the result of the misconfiguration. The configure script does not accept system ecl because of the misconfiguration `--without-system-gcc`. So the configuration reflects use of an ECL built using SPKG (which is not done because `make` is not involved).



---

archive/issue_comments_436865.json:
```json
{
    "body": "Replying to [comment:128 dimpase]:\n> OK, but note that `./bootstrap` and `./configure` still need to be run to install various things and fill in `*.in` templates.\n> Passing wrong parameters to `./configure` is not a good idea, IMHO.\n\nSure, I agree with this!",
    "created_at": "2022-02-14T17:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436865",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:128 dimpase]:
> OK, but note that `./bootstrap` and `./configure` still need to be run to install various things and fill in `*.in` templates.
> Passing wrong parameters to `./configure` is not a good idea, IMHO.

Sure, I agree with this!



---

archive/issue_comments_436866.json:
```json
{
    "body": "Replying to [comment:129 mkoeppe]:\n> Replying to [comment:125 gh-tobiasdiez]:\n> > > > Since it is working without this \"fix\".\n> > > \n> > > But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.\n> > \n> > I still don't understand why it's so important that sage's configure script accepts conda's python\n> \n> As I said before in comment:70, comment:92, etc., the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.\n\nNot sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. But regardless, adding these force statements doesn't currently work.",
    "created_at": "2022-02-14T17:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436866",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:129 mkoeppe]:
> Replying to [comment:125 gh-tobiasdiez]:
> > > > Since it is working without this "fix".
> > > 
> > > But what does it test? Currently certainly not installation steps that we could recommend to developers. The `configure` run should really reflect the system configuration.
> > 
> > I still don't understand why it's so important that sage's configure script accepts conda's python
> 
> As I said before in comment:70, comment:92, etc., the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.

Not sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. But regardless, adding these force statements doesn't currently work.



---

archive/issue_comments_436867.json:
```json
{
    "body": "Replying to [comment:132 gh-tobiasdiez]:\n> adding these force statements doesn't currently work.\n\nYou reported that `--with-system-gcc=force` does not work; what else does not work?",
    "created_at": "2022-02-14T17:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436867",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:132 gh-tobiasdiez]:
> adding these force statements doesn't currently work.

You reported that `--with-system-gcc=force` does not work; what else does not work?



---

archive/issue_comments_436868.json:
```json
{
    "body": "Replying to [comment:133 mkoeppe]:\n> Replying to [comment:132 gh-tobiasdiez]:\n> > adding these force statements doesn't currently work.\n> \n> You reported that `--with-system-gcc=force` does not work\n\n... and we can fix it if you show us the config.log",
    "created_at": "2022-02-14T18:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436868",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:133 mkoeppe]:
> Replying to [comment:132 gh-tobiasdiez]:
> > adding these force statements doesn't currently work.
> 
> You reported that `--with-system-gcc=force` does not work

... and we can fix it if you show us the config.log



---

archive/issue_comments_436869.json:
```json
{
    "body": "I didn't check the force argument, but ecl, arb, ntl, ppl are not recognized.",
    "created_at": "2022-02-14T18:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436869",
    "user": "https://github.com/tobiasdiez"
}
```

I didn't check the force argument, but ecl, arb, ntl, ppl are not recognized.



---

archive/issue_comments_436870.json:
```json
{
    "body": "yes, because of the misconfigured gcc (I just explained it in comment:130)",
    "created_at": "2022-02-14T18:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436870",
    "user": "https://github.com/mkoeppe"
}
```

yes, because of the misconfigured gcc (I just explained it in comment:130)



---

archive/issue_comments_436871.json:
```json
{
    "body": "Replying to [comment:132 gh-tobiasdiez]:\n> > the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.\n> \n> Not sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. \n\nBoth.",
    "created_at": "2022-02-14T18:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436871",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:132 gh-tobiasdiez]:
> > the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.
> 
> Not sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. 

Both.



---

archive/issue_comments_436872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T18:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436873.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T19:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436874.json:
```json
{
    "body": "Replying to [comment:137 mkoeppe]:\n> Replying to [comment:132 gh-tobiasdiez]:\n> > > the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.\n> > \n> > Not sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. \n> \n> Both. \n\nWhat's the point of the force except that the workflow fails early? Wouldn't it make more sense to let it run through and see what error it produces?",
    "created_at": "2022-02-14T19:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436874",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:137 mkoeppe]:
> Replying to [comment:132 gh-tobiasdiez]:
> > > the configure script should really be invoked with `--with-system-xyz=force` for all packages for which we have `spkg-configure.m4`.
> > 
> > Not sure if that's really a good idea or if it would be better to just exclude versions of conda packages that are known to not work. 
> 
> Both. 

What's the point of the force except that the workflow fails early? Wouldn't it make more sense to let it run through and see what error it produces?



---

archive/issue_comments_436875.json:
```json
{
    "body": "Replying to [comment:140 gh-tobiasdiez]:\n> What's the point of the force except that the workflow fails early? \n\nFailing early is good. \n\n> Wouldn't it make more sense to let it run through and see what error it produces?\n\nNo, because we do not want to send developers to manually diagnose build or run problems that have already been diagnosed and codified in our configure tests.",
    "created_at": "2022-02-14T19:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436875",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:140 gh-tobiasdiez]:
> What's the point of the force except that the workflow fails early? 

Failing early is good. 

> Wouldn't it make more sense to let it run through and see what error it produces?

No, because we do not want to send developers to manually diagnose build or run problems that have already been diagnosed and codified in our configure tests.



---

archive/issue_comments_436876.json:
```json
{
    "body": "Replying to [comment:139 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[5940d76](https://git.sagemath.org/sage.git/commit/?id=5940d76d46fa1f5762f69f446d756a5a1ca38559)||`Try again with system gcc`||\n\nLocally this fails, output can be found at https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true in a bit.\n\nIt accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place). Nothing of this is specific to the github action and can easily be investigated after creating a conda env locally.\n\nBut can we do this error analysis and corresponding improvements please in a follow-up ticket? The version using prefix works with almost no test failures (apart from giac, which is broken and has already a ticket). Moreover, in this ticket, I tried to codify the instructions of the wiki in a github workflow. The instructions didn't work for me verbatim in a fresh clone, nor via the github action. The current version works relatively well in my eyes. I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.",
    "created_at": "2022-02-14T19:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436876",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:139 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[5940d76](https://git.sagemath.org/sage.git/commit/?id=5940d76d46fa1f5762f69f446d756a5a1ca38559)||`Try again with system gcc`||

Locally this fails, output can be found at https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true in a bit.

It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place). Nothing of this is specific to the github action and can easily be investigated after creating a conda env locally.

But can we do this error analysis and corresponding improvements please in a follow-up ticket? The version using prefix works with almost no test failures (apart from giac, which is broken and has already a ticket). Moreover, in this ticket, I tried to codify the instructions of the wiki in a github workflow. The instructions didn't work for me verbatim in a fresh clone, nor via the github action. The current version works relatively well in my eyes. I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.



---

archive/issue_comments_436877.json:
```json
{
    "body": "Replying to [comment:141 mkoeppe]:\n> Replying to [comment:140 gh-tobiasdiez]:\n> > What's the point of the force except that the workflow fails early? \n> \n> Failing early is good. \n> \n> > Wouldn't it make more sense to let it run through and see what error it produces?\n> \n> No, because we do not want to send developers to manually diagnose build or run problems that have already been diagnosed and codified in our configure tests.\n> \n\nWhat about adding a warning annotation in the github workflow when a system package is not recognized? Then you still get the information that the config didn't work as expected but keep the benefit of seeing error messages. This should become helpful down the road, as the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.",
    "created_at": "2022-02-14T19:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436877",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:141 mkoeppe]:
> Replying to [comment:140 gh-tobiasdiez]:
> > What's the point of the force except that the workflow fails early? 
> 
> Failing early is good. 
> 
> > Wouldn't it make more sense to let it run through and see what error it produces?
> 
> No, because we do not want to send developers to manually diagnose build or run problems that have already been diagnosed and codified in our configure tests.
> 

What about adding a warning annotation in the github workflow when a system package is not recognized? Then you still get the information that the config didn't work as expected but keep the benefit of seeing error messages. This should become helpful down the road, as the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.



---

archive/issue_comments_436878.json:
```json
{
    "body": "comment:121 - the workflow should be testing something that we can recommend to developers. As of the current branch it's \"let's misconfigure creatively so that configure does not end with an error; please ignore everything that the configure script says because it does not matter. There may be errors in build and run later, YMMV.\"",
    "created_at": "2022-02-14T19:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436878",
    "user": "https://github.com/mkoeppe"
}
```

comment:121 - the workflow should be testing something that we can recommend to developers. As of the current branch it's "let's misconfigure creatively so that configure does not end with an error; please ignore everything that the configure script says because it does not matter. There may be errors in build and run later, YMMV."



---

archive/issue_comments_436879.json:
```json
{
    "body": "Replying to [comment:142 gh-tobiasdiez]:\n> I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.\n\nI've already offered to fix the problem with `--with-system-gcc=force`",
    "created_at": "2022-02-14T20:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436879",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:142 gh-tobiasdiez]:
> I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.

I've already offered to fix the problem with `--with-system-gcc=force`



---

archive/issue_comments_436880.json:
```json
{
    "body": "Replying to [comment:142 gh-tobiasdiez]:\n> It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).\n\nThese reports would be more useful if you attach the config.log",
    "created_at": "2022-02-14T20:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436880",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:142 gh-tobiasdiez]:
> It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).

These reports would be more useful if you attach the config.log



---

archive/issue_comments_436881.json:
```json
{
    "body": "Replying to [comment:145 mkoeppe]:\n> Replying to [comment:142 gh-tobiasdiez]:\n> > I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.\n> \n> I've already offered to fix the problem with `--with-system-gcc=force`\n\nCan you please give the full commands that create a working conda env and are able to recognize gcc and ecl. As you can see here `with-system-gcc` doesn't work: https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true",
    "created_at": "2022-02-14T20:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436881",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:145 mkoeppe]:
> Replying to [comment:142 gh-tobiasdiez]:
> > I'm happy to try a different combination of commands, but then please check yourself that these work locally for you.
> 
> I've already offered to fix the problem with `--with-system-gcc=force`

Can you please give the full commands that create a working conda env and are able to recognize gcc and ecl. As you can see here `with-system-gcc` doesn't work: https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true



---

archive/issue_comments_436882.json:
```json
{
    "body": "Replying to [comment:146 mkoeppe]:\n> Replying to [comment:142 gh-tobiasdiez]:\n> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).\n> \n> These reports would be more useful if you attach the config.log\n> \n((Yes, it's available now at https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true)",
    "created_at": "2022-02-14T20:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436882",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:146 mkoeppe]:
> Replying to [comment:142 gh-tobiasdiez]:
> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).
> 
> These reports would be more useful if you attach the config.log
> 
((Yes, it's available now at https://github.com/sagemath/sagetrac-mirror/runs/5189468934?check_suite_focus=true)



---

archive/issue_comments_436883.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket30845/config.log) by @tobiasdiez created at 2022-02-14 20:19:01\n\nReplying to [comment:146 mkoeppe]:\n> Replying to [comment:142 gh-tobiasdiez]:\n> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).\n> \n> These reports would be more useful if you attach the config.log\n> \n\nNow attached to the ticket.",
    "created_at": "2022-02-14T20:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436883",
    "user": "https://github.com/tobiasdiez"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket30845/config.log) by @tobiasdiez created at 2022-02-14 20:19:01

Replying to [comment:146 mkoeppe]:
> Replying to [comment:142 gh-tobiasdiez]:
> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part. But then a few other packages are still not properly recognized:  `ecl bdw-gc libhomfly` (which was the reason why I added the prefix in the first place).
> 
> These reports would be more useful if you attach the config.log
> 

Now attached to the ticket.



---

archive/issue_comments_436884.json:
```json
{
    "body": "Replying to [comment:146 mkoeppe]:\n> Replying to [comment:142 gh-tobiasdiez]:\n> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part.\n\nOK, here's why it does not accept it when the (questionable, but perhaps currently necessary) option `--prefix=$CONDA_PREFIX` is given:\n`build/pkgs/gcc/spkg-configure.m4` has these lines:\n\n```\n    if test -f \"$SAGE_LOCAL/bin/gcc\"; then\n        # Special value for SAGE_INSTALL_GCC if GCC is already installed\n        SAGE_INSTALL_GCC=exists\n        # Set yes since this implies we have already installed GCC and want to keep\n        # it selected\n        sage_spkg_install_gcc=yes\n\n        # Check whether it actually works...\n        # See https://trac.sagemath.org/ticket/24599\n        SAGE_CHECK_BROKEN_GCC()\n[...]\n```\n",
    "created_at": "2022-02-14T20:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436884",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:146 mkoeppe]:
> Replying to [comment:142 gh-tobiasdiez]:
> > It accepts the conda gcc if I remove the `--prefix=$CONDA_PREFIX` part.

OK, here's why it does not accept it when the (questionable, but perhaps currently necessary) option `--prefix=$CONDA_PREFIX` is given:
`build/pkgs/gcc/spkg-configure.m4` has these lines:

```
    if test -f "$SAGE_LOCAL/bin/gcc"; then
        # Special value for SAGE_INSTALL_GCC if GCC is already installed
        SAGE_INSTALL_GCC=exists
        # Set yes since this implies we have already installed GCC and want to keep
        # it selected
        sage_spkg_install_gcc=yes

        # Check whether it actually works...
        # See https://trac.sagemath.org/ticket/24599
        SAGE_CHECK_BROKEN_GCC()
[...]
```




---

archive/issue_comments_436885.json:
```json
{
    "body": "I'll work on a fix for this later today.",
    "created_at": "2022-02-14T20:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436885",
    "user": "https://github.com/mkoeppe"
}
```

I'll work on a fix for this later today.



---

archive/issue_comments_436886.json:
```json
{
    "body": "Replying to [comment:149 gh-tobiasdiez]:\n> Replying to [comment:146 mkoeppe]:\n> > These reports would be more useful if you attach the config.log\n> \n> Now attached to the ticket.\n\nThanks. From config.log:\n\n```\n## --------------------------------------------------- ##\n## Checking whether SageMath should install SPKG gc... ##\n## --------------------------------------------------- ##\nconfigure:19428: checking whether any of libatomic_ops is installed as or will be installed as SPKG\nconfigure:19437: result: no\nconfigure:19440: checking whether we run on WSL\nconfigure:19444: result: yes; disabling using of system gc\nconfigure:19693: no suitable system package found for SPKG gc\n```\n\nThis is why `ecl` and `homfly` are not used.",
    "created_at": "2022-02-14T20:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436886",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:149 gh-tobiasdiez]:
> Replying to [comment:146 mkoeppe]:
> > These reports would be more useful if you attach the config.log
> 
> Now attached to the ticket.

Thanks. From config.log:

```
## --------------------------------------------------- ##
## Checking whether SageMath should install SPKG gc... ##
## --------------------------------------------------- ##
configure:19428: checking whether any of libatomic_ops is installed as or will be installed as SPKG
configure:19437: result: no
configure:19440: checking whether we run on WSL
configure:19444: result: yes; disabling using of system gc
configure:19693: no suitable system package found for SPKG gc
```

This is why `ecl` and `homfly` are not used.



---

archive/issue_comments_436887.json:
```json
{
    "body": "`ecl` is rejected because `gc` is rejected on WSL, see #30629: Reject system libgc that breaks ECL build on WSL\n\nThis rejection should not happen if ECL is already provided, I think. (ditto for the other consumers of `gc` - `libhomfly`)",
    "created_at": "2022-02-14T20:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436887",
    "user": "https://github.com/dimpase"
}
```

`ecl` is rejected because `gc` is rejected on WSL, see #30629: Reject system libgc that breaks ECL build on WSL

This rejection should not happen if ECL is already provided, I think. (ditto for the other consumers of `gc` - `libhomfly`)



---

archive/issue_comments_436888.json:
```json
{
    "body": "Replying to [comment:153 dimpase]:\n> This rejection should not happen if ECL is already provided, I think. (ditto for the other consumers of `gc` - `libhomfly`)\n\nThis one is pretty subtle. `gc` is used by both ECL and libhomfly. So only if BOTH can be used from the system, then we do not need to build `gc` itself.",
    "created_at": "2022-02-14T20:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436888",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:153 dimpase]:
> This rejection should not happen if ECL is already provided, I think. (ditto for the other consumers of `gc` - `libhomfly`)

This one is pretty subtle. `gc` is used by both ECL and libhomfly. So only if BOTH can be used from the system, then we do not need to build `gc` itself.



---

archive/issue_comments_436889.json:
```json
{
    "body": "Actually, Jammy already has fixed `gc`.\nhttps://launchpad.net/ubuntu/+source/libgc\nhttps://bugs.launchpad.net/ubuntu/+source/libgc/+bug/1897371/comments/1",
    "created_at": "2022-02-14T20:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436889",
    "user": "https://github.com/dimpase"
}
```

Actually, Jammy already has fixed `gc`.
https://launchpad.net/ubuntu/+source/libgc
https://bugs.launchpad.net/ubuntu/+source/libgc/+bug/1897371/comments/1



---

archive/issue_comments_436890.json:
```json
{
    "body": "So we need an improved test",
    "created_at": "2022-02-14T20:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436890",
    "user": "https://github.com/mkoeppe"
}
```

So we need an improved test



---

archive/issue_comments_436891.json:
```json
{
    "body": "is it `gc`  from Conda (it should be OK, right?)",
    "created_at": "2022-02-14T20:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436891",
    "user": "https://github.com/dimpase"
}
```

is it `gc`  from Conda (it should be OK, right?)



---

archive/issue_comments_436892.json:
```json
{
    "body": "Replying to [comment:157 dimpase]:\n> is it `gc`  from Conda (it should be OK, right?)\n\nYes it's bdw-gc 8.0.4, which is probably to old. There is a PR updating to 8.0.6 but that's unmerged for quite some time now https://github.com/conda-forge/bdw-gc-feedstock/pull/17",
    "created_at": "2022-02-14T20:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436892",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:157 dimpase]:
> is it `gc`  from Conda (it should be OK, right?)

Yes it's bdw-gc 8.0.4, which is probably to old. There is a PR updating to 8.0.6 but that's unmerged for quite some time now https://github.com/conda-forge/bdw-gc-feedstock/pull/17



---

archive/issue_comments_436893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T21:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436894.json:
```json
{
    "body": "Conda's gc would only be too old if it were built with a particular option.\n\nThey probably use it to build ecl, and it won't fly if it was broken!",
    "created_at": "2022-02-14T21:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436894",
    "user": "https://github.com/dimpase"
}
```

Conda's gc would only be too old if it were built with a particular option.

They probably use it to build ecl, and it won't fly if it was broken!



---

archive/issue_comments_436895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T21:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436896.json:
```json
{
    "body": "Here's an attempt, not really tested yet",
    "created_at": "2022-02-14T21:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436896",
    "user": "https://github.com/mkoeppe"
}
```

Here's an attempt, not really tested yet



---

archive/issue_comments_436897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T23:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436898.json:
```json
{
    "body": "Tested locally with `EXTRA_CONFIGURE_ARGS=--prefix=/opt/conda tox -e docker-conda-forge-standard -- config.status`",
    "created_at": "2022-02-14T23:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436898",
    "user": "https://github.com/mkoeppe"
}
```

Tested locally with `EXTRA_CONFIGURE_ARGS=--prefix=/opt/conda tox -e docker-conda-forge-standard -- config.status`



---

archive/issue_comments_436899.json:
```json
{
    "body": "Replying to [comment:91 mkoeppe]:\n> I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...\n\nNow I have a better solution: With #33345, we can use `configure --with-system-standard-packages=force`.",
    "created_at": "2022-02-15T01:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436899",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:91 mkoeppe]:
> I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...

Now I have a better solution: With #33345, we can use `configure --with-system-standard-packages=force`.



---

archive/issue_comments_436900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-15T02:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-15T04:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_436902.json:
```json
{
    "body": "Replying to [comment:152 mkoeppe]:\n> Replying to [comment:149 gh-tobiasdiez]:\n> > Replying to [comment:146 mkoeppe]:\n> > > These reports would be more useful if you attach the config.log\n> > \n> > Now attached to the ticket.\n> \n> Thanks. From config.log:\n> {{{\n> ## --------------------------------------------------- ##\n> ## Checking whether [SageMath](SageMath) should install SPKG gc... ##\n> ## --------------------------------------------------- ##\n> configure:19428: checking whether any of libatomic_ops is installed as or will be installed as SPKG\n> configure:19437: result: no\n> configure:19440: checking whether we run on WSL\n> configure:19444: result: yes; disabling using of system gc\n> configure:19693: no suitable system package found for SPKG gc\n> }}}\n> This is why `ecl` and `homfly` are not used.\n\nThat makes sense. Sorry, should have investigated this before deviating from the instructions outlined in the wiki. Thanks for your patience and investigation.",
    "created_at": "2022-02-15T12:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436902",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:152 mkoeppe]:
> Replying to [comment:149 gh-tobiasdiez]:
> > Replying to [comment:146 mkoeppe]:
> > > These reports would be more useful if you attach the config.log
> > 
> > Now attached to the ticket.
> 
> Thanks. From config.log:
> {{{
> ## --------------------------------------------------- ##
> ## Checking whether [SageMath](SageMath) should install SPKG gc... ##
> ## --------------------------------------------------- ##
> configure:19428: checking whether any of libatomic_ops is installed as or will be installed as SPKG
> configure:19437: result: no
> configure:19440: checking whether we run on WSL
> configure:19444: result: yes; disabling using of system gc
> configure:19693: no suitable system package found for SPKG gc
> }}}
> This is why `ecl` and `homfly` are not used.

That makes sense. Sorry, should have investigated this before deviating from the instructions outlined in the wiki. Thanks for your patience and investigation.



---

archive/issue_comments_436903.json:
```json
{
    "body": "Replying to [comment:165 mkoeppe]:\n> Replying to [comment:91 mkoeppe]:\n> > I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...\n> \n> Now I have a better solution: With #33345, we can use `configure --with-system-standard-packages=force`.\n\nhttps://trac.sagemath.org/ticket/30845#comment:143 ?",
    "created_at": "2022-02-15T12:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436903",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:165 mkoeppe]:
> Replying to [comment:91 mkoeppe]:
> > I don't have a better solution at the moment, but at least there's a reasonably short way to write it as `configure --with-system-{gcc,lcalc}=force`...
> 
> Now I have a better solution: With #33345, we can use `configure --with-system-standard-packages=force`.

https://trac.sagemath.org/ticket/30845#comment:143 ?



---

archive/issue_comments_436904.json:
```json
{
    "body": "Replying to [comment:158 gh-tobiasdiez]:\n> Replying to [comment:157 dimpase]:\n> > is it `gc`  from Conda (it should be OK, right?)\n> \n> Yes it's bdw-gc 8.0.4, which is probably to old. There is a PR updating to 8.0.6 but that's unmerged for quite some time now https://github.com/conda-forge/bdw-gc-feedstock/pull/17\n\nUpstream says one has to check that\n\n```\nstrings /usr/lib/x86_64-linux-gnu/libgc.so | grep \"Wrong __data_start/_end pair\"\n```\n \ndoes not find anything. But this rules out all 8.0.4 (and possibly earlier) installations of libgc, not only broken ones.",
    "created_at": "2022-02-15T12:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436904",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:158 gh-tobiasdiez]:
> Replying to [comment:157 dimpase]:
> > is it `gc`  from Conda (it should be OK, right?)
> 
> Yes it's bdw-gc 8.0.4, which is probably to old. There is a PR updating to 8.0.6 but that's unmerged for quite some time now https://github.com/conda-forge/bdw-gc-feedstock/pull/17

Upstream says one has to check that

```
strings /usr/lib/x86_64-linux-gnu/libgc.so | grep "Wrong __data_start/_end pair"
```
 
does not find anything. But this rules out all 8.0.4 (and possibly earlier) installations of libgc, not only broken ones.



---

archive/issue_comments_436905.json:
```json
{
    "body": "Replying to [comment:143 gh-tobiasdiez]:\n> What about adding a warning annotation in the github workflow when a system package is not recognized? \n\nWe don't have a mechanism for that, see discussion in #29499.",
    "created_at": "2022-02-15T15:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436905",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:143 gh-tobiasdiez]:
> What about adding a warning annotation in the github workflow when a system package is not recognized? 

We don't have a mechanism for that, see discussion in #29499.



---

archive/issue_comments_436906.json:
```json
{
    "body": "Replying to [comment:143 gh-tobiasdiez]:\n> the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.\n\nThat's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo",
    "created_at": "2022-02-15T15:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436906",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:143 gh-tobiasdiez]:
> the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.

That's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo



---

archive/issue_comments_436907.json:
```json
{
    "body": "How about adding another job (via matrix) that uses `src/environment-optional.yml`?",
    "created_at": "2022-02-15T16:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436907",
    "user": "https://github.com/mkoeppe"
}
```

How about adding another job (via matrix) that uses `src/environment-optional.yml`?



---

archive/issue_comments_436908.json:
```json
{
    "body": "Also, adding jobs that test other python versions could probably be useful",
    "created_at": "2022-02-15T16:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436908",
    "user": "https://github.com/mkoeppe"
}
```

Also, adding jobs that test other python versions could probably be useful



---

archive/issue_comments_436909.json:
```json
{
    "body": "Replying to [comment:171 mkoeppe]:\n> Replying to [comment:143 gh-tobiasdiez]:\n> > What about adding a warning annotation in the github workflow when a system package is not recognized? \n> \n> We don't have a mechanism for that, see discussion in #29499.\n\nOne could add a problem matcher for \"no suitable system package; standard, will be installed as an SPKG\" for now.",
    "created_at": "2022-02-15T16:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436909",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:171 mkoeppe]:
> Replying to [comment:143 gh-tobiasdiez]:
> > What about adding a warning annotation in the github workflow when a system package is not recognized? 
> 
> We don't have a mechanism for that, see discussion in #29499.

One could add a problem matcher for "no suitable system package; standard, will be installed as an SPKG" for now.



---

archive/issue_comments_436910.json:
```json
{
    "body": "Replying to [comment:173 mkoeppe]:\n> How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n\nProbably wait with this until this workflow here passes without errors. There is not much of an advantage in having 5 different matrix flows fail.",
    "created_at": "2022-02-15T16:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436910",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:173 mkoeppe]:
> How about adding another job (via matrix) that uses `src/environment-optional.yml`?

Probably wait with this until this workflow here passes without errors. There is not much of an advantage in having 5 different matrix flows fail.



---

archive/issue_comments_436911.json:
```json
{
    "body": "Replying to [comment:172 mkoeppe]:\n> Replying to [comment:143 gh-tobiasdiez]:\n> > the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.\n> \n> That's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo\n\nBut in this case the workflow does not simply fail because the package is not accepted, right?",
    "created_at": "2022-02-15T16:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436911",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:172 mkoeppe]:
> Replying to [comment:143 gh-tobiasdiez]:
> > the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.
> 
> That's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo

But in this case the workflow does not simply fail because the package is not accepted, right?



---

archive/issue_comments_436912.json:
```json
{
    "body": "Replying to [comment:175 gh-tobiasdiez]:\n> Replying to [comment:171 mkoeppe]:\n> > Replying to [comment:143 gh-tobiasdiez]:\n> > > What about adding a warning annotation in the github workflow when a system package is not recognized? \n> > \n> > We don't have a mechanism for that, see discussion in #29499.\n> \n> One could add a problem matcher for \"no suitable system package; standard, will be installed as an SPKG\" for now.\n\nNo, the problem is that the configuration variables need to be set for the accepted system packages. #29499#comment:3",
    "created_at": "2022-02-15T17:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436912",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:175 gh-tobiasdiez]:
> Replying to [comment:171 mkoeppe]:
> > Replying to [comment:143 gh-tobiasdiez]:
> > > What about adding a warning annotation in the github workflow when a system package is not recognized? 
> > 
> > We don't have a mechanism for that, see discussion in #29499.
> 
> One could add a problem matcher for "no suitable system package; standard, will be installed as an SPKG" for now.

No, the problem is that the configuration variables need to be set for the accepted system packages. #29499#comment:3



---

archive/issue_comments_436913.json:
```json
{
    "body": "Replying to [comment:176 gh-tobiasdiez]:\n> Replying to [comment:173 mkoeppe]:\n> > How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n> \n> Probably wait with this until this workflow here passes without errors. \n\nJust reduce the errors in the `ptest` to warnings. This would be in line with the entire portability test suite.",
    "created_at": "2022-02-15T17:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436913",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:176 gh-tobiasdiez]:
> Replying to [comment:173 mkoeppe]:
> > How about adding another job (via matrix) that uses `src/environment-optional.yml`?
> 
> Probably wait with this until this workflow here passes without errors. 

Just reduce the errors in the `ptest` to warnings. This would be in line with the entire portability test suite.



---

archive/issue_comments_436914.json:
```json
{
    "body": "Replying to [comment:177 gh-tobiasdiez]:\n> Replying to [comment:172 mkoeppe]:\n> > Replying to [comment:143 gh-tobiasdiez]:\n> > > the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.\n> > \n> > That's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo\n> \n> But in this case the workflow does not simply fail because the package is not accepted, right?\n\nThat's right, Sage will just build the SPKG.",
    "created_at": "2022-02-15T17:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436914",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:177 gh-tobiasdiez]:
> Replying to [comment:172 mkoeppe]:
> > Replying to [comment:143 gh-tobiasdiez]:
> > > the conda packages are quite up to date and thus may fail to be recognized for the simple reason that they are too new.
> > 
> > That's not really specific to conda-forge but also true for various cutting-edge distributions including archlinux and gentoo
> 
> But in this case the workflow does not simply fail because the package is not accepted, right?

That's right, Sage will just build the SPKG.



---

archive/issue_comments_436915.json:
```json
{
    "body": "When a Sage user/developer follows our (to-be-updated) instructions with `--with-system-standard-packages=force` and it gives the configure error regarding the unsuitable system package, there is a clear recourse: Find and install a version that works.\n\nWhen Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in `conda.txt` files if possible; or file a conda bug report. \n\nSeeing error messages from using a system package that `configure` knows to reject does not help. It only leads to developers engaging in unproductive guesswork. \n\nFor updating Sage and our `spkg-configure.m4` scripts to work with new versions, local development and testing on many platforms is necessary anyway; it does not help if there's 1 platform that already speculatively displays some errors.",
    "created_at": "2022-02-15T17:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436915",
    "user": "https://github.com/mkoeppe"
}
```

When a Sage user/developer follows our (to-be-updated) instructions with `--with-system-standard-packages=force` and it gives the configure error regarding the unsuitable system package, there is a clear recourse: Find and install a version that works.

When Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in `conda.txt` files if possible; or file a conda bug report. 

Seeing error messages from using a system package that `configure` knows to reject does not help. It only leads to developers engaging in unproductive guesswork. 

For updating Sage and our `spkg-configure.m4` scripts to work with new versions, local development and testing on many platforms is necessary anyway; it does not help if there's 1 platform that already speculatively displays some errors.



---

archive/issue_comments_436916.json:
```json
{
    "body": "Replying to [comment:178 mkoeppe]:\n> Replying to [comment:175 gh-tobiasdiez]:\n> > Replying to [comment:171 mkoeppe]:\n> > > Replying to [comment:143 gh-tobiasdiez]:\n> > > > What about adding a warning annotation in the github workflow when a system package is not recognized? \n> > > \n> > > We don't have a mechanism for that, see discussion in #29499.\n> > \n> > One could add a problem matcher for \"no suitable system package; standard, will be installed as an SPKG\" for now.\n> \n> No, the problem is that the configuration variables need to be set for the accepted system packages. #29499#comment:3\n> \n\nI meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print \"no suitable system package; standard, will be installed as an SPKG\", which is detected and reported in the action overview.",
    "created_at": "2022-02-15T17:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436916",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:178 mkoeppe]:
> Replying to [comment:175 gh-tobiasdiez]:
> > Replying to [comment:171 mkoeppe]:
> > > Replying to [comment:143 gh-tobiasdiez]:
> > > > What about adding a warning annotation in the github workflow when a system package is not recognized? 
> > > 
> > > We don't have a mechanism for that, see discussion in #29499.
> > 
> > One could add a problem matcher for "no suitable system package; standard, will be installed as an SPKG" for now.
> 
> No, the problem is that the configuration variables need to be set for the accepted system packages. #29499#comment:3
> 

I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print "no suitable system package; standard, will be installed as an SPKG", which is detected and reported in the action overview.



---

archive/issue_comments_436917.json:
```json
{
    "body": "Replying to [comment:182 gh-tobiasdiez]:\n> I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print \"no suitable system package; standard, will be installed as an SPKG\", which is detected and reported in the action overview. \n\nSure, +1 on that, that's a good idea.",
    "created_at": "2022-02-15T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436917",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:182 gh-tobiasdiez]:
> I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print "no suitable system package; standard, will be installed as an SPKG", which is detected and reported in the action overview. 

Sure, +1 on that, that's a good idea.



---

archive/issue_comments_436918.json:
```json
{
    "body": "I have some of this in tox.yml, matching configure warnings and error",
    "created_at": "2022-02-15T17:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436918",
    "user": "https://github.com/mkoeppe"
}
```

I have some of this in tox.yml, matching configure warnings and error



---

archive/issue_comments_436919.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-15T18:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_436920.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-15T20:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436921.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-16T11:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436922.json:
```json
{
    "body": "Replying to [comment:183 mkoeppe]:\n> Replying to [comment:182 gh-tobiasdiez]:\n> > I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print \"no suitable system package; standard, will be installed as an SPKG\", which is detected and reported in the action overview. \n> \n> Sure, +1 on that, that's a good idea.\n\nOkay, this is now implemented. See https://github.com/sagemath/sagetrac-mirror/actions/runs/1852417654",
    "created_at": "2022-02-16T12:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436922",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:183 mkoeppe]:
> Replying to [comment:182 gh-tobiasdiez]:
> > I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print "no suitable system package; standard, will be installed as an SPKG", which is detected and reported in the action overview. 
> 
> Sure, +1 on that, that's a good idea.

Okay, this is now implemented. See https://github.com/sagemath/sagetrac-mirror/actions/runs/1852417654



---

archive/issue_comments_436923.json:
```json
{
    "body": "The tests now fail with the following error:\n\n```\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n```\n\nIs this a consequence of me merging the latest develop branch, or did I accidentally misconfigured something?\nHow can one overwrite this check?",
    "created_at": "2022-02-16T12:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436923",
    "user": "https://github.com/tobiasdiez"
}
```

The tests now fail with the following error:

```
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
```

Is this a consequence of me merging the latest develop branch, or did I accidentally misconfigured something?
How can one overwrite this check?



---

archive/issue_comments_436924.json:
```json
{
    "body": "Replying to [comment:173 mkoeppe]:\n> How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n\nDone, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9",
    "created_at": "2022-02-16T12:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436924",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:173 mkoeppe]:
> How about adding another job (via matrix) that uses `src/environment-optional.yml`?

Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9



---

archive/issue_comments_436925.json:
```json
{
    "body": "Replying to [comment:185 git]:\n> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n> ||[c1c9e61](https://git.sagemath.org/sage.git/commit/?id=c1c9e6123b0f4c516e3007415e731dab1f38b5ec)||`Add matrix`||\n> ||[6ff193f](https://git.sagemath.org/sage.git/commit/?id=6ff193fe4608756ee7b99b0b9f465beaab5bc7bf)||`Add problem matcher`||\n\nThis nuked my changes, intended?",
    "created_at": "2022-02-16T16:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436925",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:185 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
> ||[c1c9e61](https://git.sagemath.org/sage.git/commit/?id=c1c9e6123b0f4c516e3007415e731dab1f38b5ec)||`Add matrix`||
> ||[6ff193f](https://git.sagemath.org/sage.git/commit/?id=6ff193fe4608756ee7b99b0b9f465beaab5bc7bf)||`Add problem matcher`||

This nuked my changes, intended?



---

archive/issue_comments_436926.json:
```json
{
    "body": "Replying to [comment:190 gh-tobiasdiez]:\n> Dependencies #33330, #33345 deleted\n\n?",
    "created_at": "2022-02-16T16:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436926",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:190 gh-tobiasdiez]:
> Dependencies #33330, #33345 deleted

?



---

archive/issue_comments_436927.json:
```json
{
    "body": "Replying to [comment:193 mkoeppe]:\n> Replying to [comment:190 gh-tobiasdiez]:\n> > Dependencies #33330, #33345 deleted\n> \n> ?\n\nNo longer needed.",
    "created_at": "2022-02-16T17:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436927",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:193 mkoeppe]:
> Replying to [comment:190 gh-tobiasdiez]:
> > Dependencies #33330, #33345 deleted
> 
> ?

No longer needed.



---

archive/issue_comments_436928.json:
```json
{
    "body": "Replying to [comment:191 gh-tobiasdiez]:\n> Replying to [comment:173 mkoeppe]:\n> > How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n> \n> Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9\n\nShould be fixed with #33358",
    "created_at": "2022-02-16T17:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436928",
    "user": "https://github.com/isuruf"
}
```

Replying to [comment:191 gh-tobiasdiez]:
> Replying to [comment:173 mkoeppe]:
> > How about adding another job (via matrix) that uses `src/environment-optional.yml`?
> 
> Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9

Should be fixed with #33358



---

archive/issue_comments_436929.json:
```json
{
    "body": "Replying to [comment:183 mkoeppe]:\n> Replying to [comment:182 gh-tobiasdiez]:\n> > I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print \"no suitable system package; standard, will be installed as an SPKG\", which is detected and reported in the action overview. \n> \n> Sure, +1 on that, that's a good idea.\n\nWait, I missed that you said \"run configure without `-with-system = force`\".\n\nI was +1 on adding the problem matchers.",
    "created_at": "2022-02-16T17:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436929",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:183 mkoeppe]:
> Replying to [comment:182 gh-tobiasdiez]:
> > I meant as a github annotation. Just run configure without `-with-system = force`. Then configure will print "no suitable system package; standard, will be installed as an SPKG", which is detected and reported in the action overview. 
> 
> Sure, +1 on that, that's a good idea.

Wait, I missed that you said "run configure without `-with-system = force`".

I was +1 on adding the problem matchers.



---

archive/issue_comments_436930.json:
```json
{
    "body": "In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.",
    "created_at": "2022-02-16T17:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436930",
    "user": "https://github.com/mkoeppe"
}
```

In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.



---

archive/issue_comments_436931.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-16T17:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436931",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436932.json:
```json
{
    "body": "Replying to [comment:197 mkoeppe]:\n> In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.\n\n> When Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in conda.txt files if possible; or file a conda bug report. \n\nThis is still accomplished with the current problem matchers, and even easier. Developer looks at the workflow run, sees that system packages are not accepted and can take action. In addition, she can directly see what errors result from not accepting the system package.\n\nI don't see any advantage in hiding useful information (what does break because of the missing package).",
    "created_at": "2022-02-16T17:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436932",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:197 mkoeppe]:
> In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.

> When Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in conda.txt files if possible; or file a conda bug report. 

This is still accomplished with the current problem matchers, and even easier. Developer looks at the workflow run, sees that system packages are not accepted and can take action. In addition, she can directly see what errors result from not accepting the system package.

I don't see any advantage in hiding useful information (what does break because of the missing package).



---

archive/issue_comments_436933.json:
```json
{
    "body": "Replying to [comment:195 isuruf]:\n> Replying to [comment:191 gh-tobiasdiez]:\n> > Replying to [comment:173 mkoeppe]:\n> > > How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n> > \n> > Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9\n> \n> Should be fixed with #33358\n\nThanks!",
    "created_at": "2022-02-16T17:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436933",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:195 isuruf]:
> Replying to [comment:191 gh-tobiasdiez]:
> > Replying to [comment:173 mkoeppe]:
> > > How about adding another job (via matrix) that uses `src/environment-optional.yml`?
> > 
> > Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9
> 
> Should be fixed with #33358

Thanks!



---

archive/issue_comments_436934.json:
```json
{
    "body": "Any idea on how to fix #30845#comment:189?",
    "created_at": "2022-02-16T17:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436934",
    "user": "https://github.com/tobiasdiez"
}
```

Any idea on how to fix #30845#comment:189?



---

archive/issue_comments_436935.json:
```json
{
    "body": "Replying to [comment:199 gh-tobiasdiez]:\n> I don't see any advantage in hiding useful information\n\nI've already explained that it's not useful for those who know how to update our configure tests.",
    "created_at": "2022-02-16T18:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436935",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:199 gh-tobiasdiez]:
> I don't see any advantage in hiding useful information

I've already explained that it's not useful for those who know how to update our configure tests.



---

archive/issue_comments_436936.json:
```json
{
    "body": "Replying to [comment:201 gh-tobiasdiez]:\n> Any idea on how to fix #30845#comment:189?\n\nYes, you didn't install the Sage library where you promised that it would be installed. `SAGE_LOCAL` (set by `--prefix`) defaults to `SAGE_ROOT/local` and `SAGE_VENV` defaults to a subdirectory of it. But you installed the Sage library instead into the system site-packages.",
    "created_at": "2022-02-16T18:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436936",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:201 gh-tobiasdiez]:
> Any idea on how to fix #30845#comment:189?

Yes, you didn't install the Sage library where you promised that it would be installed. `SAGE_LOCAL` (set by `--prefix`) defaults to `SAGE_ROOT/local` and `SAGE_VENV` defaults to a subdirectory of it. But you installed the Sage library instead into the system site-packages.



---

archive/issue_comments_436937.json:
```json
{
    "body": "Replying to [comment:199 gh-tobiasdiez]:\n> Replying to [comment:197 mkoeppe]:\n> > In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.\n> \n> > When Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in conda.txt files if possible; or file a conda bug report. \n> \n> This is still accomplished with the current problem matchers, and even easier. \n\nBut it misses the criterion of comment:121 - does it test what we would recommend to developers.",
    "created_at": "2022-02-16T18:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436937",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:199 gh-tobiasdiez]:
> Replying to [comment:197 mkoeppe]:
> > In comment:181 I explained why we DON'T want to have it run anyway and produce mysterious errors that send developers into doing unproductive guesswork.
> 
> > When Sage developers see this in the CI run, there is also a clear course of action: Adjust the conda-specific version constraints in conda.txt files if possible; or file a conda bug report. 
> 
> This is still accomplished with the current problem matchers, and even easier. 

But it misses the criterion of comment:121 - does it test what we would recommend to developers.



---

archive/issue_comments_436938.json:
```json
{
    "body": "Also comment:178.",
    "created_at": "2022-02-16T18:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436938",
    "user": "https://github.com/mkoeppe"
}
```

Also comment:178.



---

archive/issue_comments_436939.json:
```json
{
    "body": "Replying to [comment:203 mkoeppe]:\n> Replying to [comment:201 gh-tobiasdiez]:\n> > Any idea on how to fix #30845#comment:189?\n> \n> Yes, you didn't install the Sage library where you promised that it would be installed. `SAGE_LOCAL` (set by `--prefix`) defaults to `SAGE_ROOT/local` and `SAGE_VENV` defaults to a subdirectory of it. But you installed the Sage library instead into the system site-packages.\n\nAnd how does one fix it without using prefix (which according to you isn't desired)?",
    "created_at": "2022-02-16T18:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436939",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:203 mkoeppe]:
> Replying to [comment:201 gh-tobiasdiez]:
> > Any idea on how to fix #30845#comment:189?
> 
> Yes, you didn't install the Sage library where you promised that it would be installed. `SAGE_LOCAL` (set by `--prefix`) defaults to `SAGE_ROOT/local` and `SAGE_VENV` defaults to a subdirectory of it. But you installed the Sage library instead into the system site-packages.

And how does one fix it without using prefix (which according to you isn't desired)?



---

archive/issue_comments_436940.json:
```json
{
    "body": "For now, using `--prefix` is the best option. That's why I provided commits 9799fd7/757bd73.",
    "created_at": "2022-02-16T18:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436940",
    "user": "https://github.com/mkoeppe"
}
```

For now, using `--prefix` is the best option. That's why I provided commits 9799fd7/757bd73.



---

archive/issue_comments_436941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-16T18:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436942.json:
```json
{
    "body": "Replying to [comment:195 isuruf]:\n> Replying to [comment:191 gh-tobiasdiez]:\n> > Replying to [comment:173 mkoeppe]:\n> > > How about adding another job (via matrix) that uses `src/environment-optional.yml`?\n> > \n> > Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9\n> \n> Should be fixed with #33358\n\nIt is indeed correctly using lcalc 2 now. Thanks!",
    "created_at": "2022-02-16T19:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436942",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:195 isuruf]:
> Replying to [comment:191 gh-tobiasdiez]:
> > Replying to [comment:173 mkoeppe]:
> > > How about adding another job (via matrix) that uses `src/environment-optional.yml`?
> > 
> > Done, but it is currently failing (as reported before). Also added a minimal matrix for python versions 3.8 + 3.9
> 
> Should be fixed with #33358

It is indeed correctly using lcalc 2 now. Thanks!



---

archive/issue_comments_436943.json:
```json
{
    "body": "Replying to [comment:207 mkoeppe]:\n> For now, using `--prefix` is the best option. That's why I provided commits 9799fd7/757bd73.\n\nThanks. I've reverted to using --prefix (with --without-system-gcc). Let's put your improvements to the gcc detection script in a follow-up ticket.",
    "created_at": "2022-02-16T19:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436943",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:207 mkoeppe]:
> For now, using `--prefix` is the best option. That's why I provided commits 9799fd7/757bd73.

Thanks. I've reverted to using --prefix (with --without-system-gcc). Let's put your improvements to the gcc detection script in a follow-up ticket.



---

archive/issue_comments_436944.json:
```json
{
    "body": "Replying to [comment:202 mkoeppe]:\n> Replying to [comment:199 gh-tobiasdiez]:\n> > I don't see any advantage in hiding useful information\n> \n> I've already explained that it's not useful for those who know how to update our configure tests.\n\nThere are also people that don't know much about these configure scripts but still want to work on the conda environment.\n\nThe point of this ticket (at least for me), is having a CI infrastructure to confirm that updates to the conda evniroment such as #33330 and #33358 indeed have a positive impact. For this it is not helpful if the workflow exists early because some conda package got updated in the meantime and now the corresponding \"system\" package is rejected by sage.\n\nTo be honest, I feel tired by this discussion and think we already invested more time discussing pros and cons then developer will ever spend while chasing mysterious bugs potentially coming from this. If its so important to you, I would like to ask you to implement it in a follow-up ticket.",
    "created_at": "2022-02-16T19:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436944",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:202 mkoeppe]:
> Replying to [comment:199 gh-tobiasdiez]:
> > I don't see any advantage in hiding useful information
> 
> I've already explained that it's not useful for those who know how to update our configure tests.

There are also people that don't know much about these configure scripts but still want to work on the conda environment.

The point of this ticket (at least for me), is having a CI infrastructure to confirm that updates to the conda evniroment such as #33330 and #33358 indeed have a positive impact. For this it is not helpful if the workflow exists early because some conda package got updated in the meantime and now the corresponding "system" package is rejected by sage.

To be honest, I feel tired by this discussion and think we already invested more time discussing pros and cons then developer will ever spend while chasing mysterious bugs potentially coming from this. If its so important to you, I would like to ask you to implement it in a follow-up ticket.



---

archive/issue_comments_436945.json:
```json
{
    "body": "It's now working: build succeeds and most tests pass in all tested configs. https://github.com/sagemath/sagetrac-mirror/actions/runs/1854640215\n\nLet's move potential improvements (like removing --prefix, --without-system-gcc, fixes to giac, updates to the docs etc) to follow-up tickets.",
    "created_at": "2022-02-16T19:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436945",
    "user": "https://github.com/tobiasdiez"
}
```

It's now working: build succeeds and most tests pass in all tested configs. https://github.com/sagemath/sagetrac-mirror/actions/runs/1854640215

Let's move potential improvements (like removing --prefix, --without-system-gcc, fixes to giac, updates to the docs etc) to follow-up tickets.



---

archive/issue_comments_436946.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-16T19:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436946",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_436947.json:
```json
{
    "body": "Replying to [comment:212 gh-tobiasdiez]:\n> Replying to [comment:202 mkoeppe]:\n> > Replying to [comment:199 gh-tobiasdiez]:\n> > > I don't see any advantage in hiding useful information\n> > \n> > I've already explained that it's not useful for those who know how to update our configure tests.\n> \n> There are also people that don't know much about these configure scripts but still want to work on the conda environment.\n\nYes, and they can do that as I explained in comment:181. They don't need to see the errors if they don't want to work on the configure scripts.",
    "created_at": "2022-02-16T19:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436947",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:212 gh-tobiasdiez]:
> Replying to [comment:202 mkoeppe]:
> > Replying to [comment:199 gh-tobiasdiez]:
> > > I don't see any advantage in hiding useful information
> > 
> > I've already explained that it's not useful for those who know how to update our configure tests.
> 
> There are also people that don't know much about these configure scripts but still want to work on the conda environment.

Yes, and they can do that as I explained in comment:181. They don't need to see the errors if they don't want to work on the configure scripts.



---

archive/issue_comments_436948.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-16T19:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436948",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436949.json:
```json
{
    "body": "Replying to [comment:213 gh-tobiasdiez]:\n> It's now working: build succeeds and most tests pass in all tested configs.\n\nIt still doesn't pass the criterion of comment:121 - does it test what we would recommend to developers.",
    "created_at": "2022-02-16T19:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436949",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:213 gh-tobiasdiez]:
> It's now working: build succeeds and most tests pass in all tested configs.

It still doesn't pass the criterion of comment:121 - does it test what we would recommend to developers.



---

archive/issue_comments_436950.json:
```json
{
    "body": "Replying to [comment:212 gh-tobiasdiez]:\n> If it's so important to you, I would like to ask you to implement it in a follow-up ticket.\n\nI already did, but you removed the commits that implemented it.",
    "created_at": "2022-02-16T19:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436950",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:212 gh-tobiasdiez]:
> If it's so important to you, I would like to ask you to implement it in a follow-up ticket.

I already did, but you removed the commits that implemented it.



---

archive/issue_comments_436951.json:
```json
{
    "body": "Replying to [comment:215 mkoeppe]:\n> Replying to [comment:213 gh-tobiasdiez]:\n> > It's now working: build succeeds and most tests pass in all tested configs.\n> \n> It still doesn't pass the criterion of comment:121 - does it test what we would recommend to developers.\n> \n\nC'mon, according to your own information using --prefix is the best way currently. Without any changes to gcc detection or whatever (which is not the point of this ticket), this only works with --without-system-gcc.",
    "created_at": "2022-02-16T19:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436951",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:215 mkoeppe]:
> Replying to [comment:213 gh-tobiasdiez]:
> > It's now working: build succeeds and most tests pass in all tested configs.
> 
> It still doesn't pass the criterion of comment:121 - does it test what we would recommend to developers.
> 

C'mon, according to your own information using --prefix is the best way currently. Without any changes to gcc detection or whatever (which is not the point of this ticket), this only works with --without-system-gcc.



---

archive/issue_comments_436952.json:
```json
{
    "body": "`@`gh-tobiasdiez, can you restore `@`mkoeppe's commits that fixed the gcc detection? Then we can use --prefix.",
    "created_at": "2022-02-16T20:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436952",
    "user": "https://github.com/isuruf"
}
```

`@`gh-tobiasdiez, can you restore `@`mkoeppe's commits that fixed the gcc detection? Then we can use --prefix.



---

archive/issue_comments_436953.json:
```json
{
    "body": "I'll put these commits on #33361 now",
    "created_at": "2022-02-16T20:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436953",
    "user": "https://github.com/mkoeppe"
}
```

I'll put these commits on #33361 now



---

archive/issue_comments_436954.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T12:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436955.json:
```json
{
    "body": "Replying to [comment:219 mkoeppe]:\n> I'll put these commits on #33361 now\n\nThanks",
    "created_at": "2022-02-17T12:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436955",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:219 mkoeppe]:
> I'll put these commits on #33361 now

Thanks



---

archive/issue_comments_436956.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-17T12:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436956",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_436957.json:
```json
{
    "body": "Replying to [comment:218 isuruf]:\n> `@`gh-tobiasdiez, can you restore `@`mkoeppe's commits that fixed the gcc detection? Then we can use --prefix. \n\nDone by merging #33361. (For the record, I initially removed these commits because it seemed like the whole prefix thing wasn't necessary).\n\nStill a bit confused why #33361 couldn't just be a follow-up on top of this ticket, but, well, I guess I'm used to a different developing/merging strategy.",
    "created_at": "2022-02-17T12:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436957",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:218 isuruf]:
> `@`gh-tobiasdiez, can you restore `@`mkoeppe's commits that fixed the gcc detection? Then we can use --prefix. 

Done by merging #33361. (For the record, I initially removed these commits because it seemed like the whole prefix thing wasn't necessary).

Still a bit confused why #33361 couldn't just be a follow-up on top of this ticket, but, well, I guess I'm used to a different developing/merging strategy.



---

archive/issue_comments_436958.json:
```json
{
    "body": "Seems to work well, no gc errors anymore and all standard conda packages are detected successfully (even with the `environment-optional.yml).\n\nSo should be good to go now.",
    "created_at": "2022-02-17T12:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436958",
    "user": "https://github.com/tobiasdiez"
}
```

Seems to work well, no gc errors anymore and all standard conda packages are detected successfully (even with the `environment-optional.yml).

So should be good to go now.



---

archive/issue_comments_436959.json:
```json
{
    "body": "How is there no `gc` error any more? What has changed in this respect?",
    "created_at": "2022-02-17T17:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436959",
    "user": "https://github.com/dimpase"
}
```

How is there no `gc` error any more? What has changed in this respect?



---

archive/issue_comments_436960.json:
```json
{
    "body": "Replying to [comment:225 dimpase]:\n> How is there no `gc` error any more? What has changed in this respect? \n\n#33361 fixed it.",
    "created_at": "2022-02-17T17:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436960",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:225 dimpase]:
> How is there no `gc` error any more? What has changed in this respect? 

#33361 fixed it.



---

archive/issue_comments_436961.json:
```json
{
    "body": "Replying to [comment:226 gh-tobiasdiez]:\n> Replying to [comment:225 dimpase]:\n> > How is there no `gc` error any more? What has changed in this respect? \n> \n> #33361 fixed it.\nthis must be close a miracle - as only `gcc` was touched there.",
    "created_at": "2022-02-17T17:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436961",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:226 gh-tobiasdiez]:
> Replying to [comment:225 dimpase]:
> > How is there no `gc` error any more? What has changed in this respect? 
> 
> #33361 fixed it.
this must be close a miracle - as only `gcc` was touched there.



---

archive/issue_comments_436962.json:
```json
{
    "body": "`gc` was rejected via SPKG_DEPCHECK on `gcc`.",
    "created_at": "2022-02-17T17:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436962",
    "user": "https://github.com/mkoeppe"
}
```

`gc` was rejected via SPKG_DEPCHECK on `gcc`.



---

archive/issue_comments_436963.json:
```json
{
    "body": "Replying to [comment:228 mkoeppe]:\n> `gc` was rejected via SPKG_DEPCHECK on `gcc`.\nDoes this mean that somehow #33361 is blessing `gcc`'s deps?\nHmm, not sure I follow.",
    "created_at": "2022-02-17T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436963",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:228 mkoeppe]:
> `gc` was rejected via SPKG_DEPCHECK on `gcc`.
Does this mean that somehow #33361 is blessing `gcc`'s deps?
Hmm, not sure I follow.



---

archive/issue_comments_436964.json:
```json
{
    "body": "no, that's really weird. `gc` is not used by `gcc`... OK, this is a Church of gcc spkg, and I'm a non-believer...",
    "created_at": "2022-02-17T18:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436964",
    "user": "https://github.com/dimpase"
}
```

no, that's really weird. `gc` is not used by `gcc`... OK, this is a Church of gcc spkg, and I'm a non-believer...



---

archive/issue_comments_436965.json:
```json
{
    "body": "Replying to [comment:228 mkoeppe]:\n> `gc` was rejected via SPKG_DEPCHECK on `gcc`.\n\nSorry, I was wrong - I misremembered",
    "created_at": "2022-02-17T18:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436965",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:228 mkoeppe]:
> `gc` was rejected via SPKG_DEPCHECK on `gcc`.

Sorry, I was wrong - I misremembered



---

archive/issue_comments_436966.json:
```json
{
    "body": "There was no problem with `gc` except within Tobias's WSL install.",
    "created_at": "2022-02-17T18:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436966",
    "user": "https://github.com/mkoeppe"
}
```

There was no problem with `gc` except within Tobias's WSL install.



---

archive/issue_comments_436967.json:
```json
{
    "body": "Sorry for the missing c and the confusion it caused :-)",
    "created_at": "2022-02-17T19:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436967",
    "user": "https://github.com/tobiasdiez"
}
```

Sorry for the missing c and the confusion it caused :-)



---

archive/issue_comments_436968.json:
```json
{
    "body": "![](https://i.stack.imgur.com/jiFfM.jpg)",
    "created_at": "2022-02-17T20:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436968",
    "user": "https://github.com/dimpase"
}
```

![](https://i.stack.imgur.com/jiFfM.jpg)



---

archive/issue_comments_436969.json:
```json
{
    "body": "Replying to [comment:92 mkoeppe]:\n> Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`\n\nWith dependency #33361 positively reviewed, but #33345 (`configure --with-system-standard-packages=force`) stalled, let's use the above as a solution.",
    "created_at": "2022-03-15T21:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436969",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:92 mkoeppe]:
> Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`

With dependency #33361 positively reviewed, but #33345 (`configure --with-system-standard-packages=force`) stalled, let's use the above as a solution.



---

archive/issue_comments_436970.json:
```json
{
    "body": "`@`isuruf - `--with-system-lrcalc=force` fails because conda-forge does not provide lrcalc 2.x yet",
    "created_at": "2022-03-15T21:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436970",
    "user": "https://github.com/mkoeppe"
}
```

`@`isuruf - `--with-system-lrcalc=force` fails because conda-forge does not provide lrcalc 2.x yet



---

archive/issue_comments_436971.json:
```json
{
    "body": "Fixed by\n\n- https://github.com/conda-forge/lrcalc-feedstock/pull/7",
    "created_at": "2022-03-16T08:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436971",
    "user": "https://github.com/slel"
}
```

Fixed by

- https://github.com/conda-forge/lrcalc-feedstock/pull/7



---

archive/issue_comments_436972.json:
```json
{
    "body": "Replying to [comment:235 mkoeppe]:\n> Replying to [comment:92 mkoeppe]:\n> > Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`\n> \n> With dependency #33361 positively reviewed, but #33345 (`configure --with-system-standard-packages=force`) stalled, let's use the above as a solution.\n\n\nIf a system package is not used, then an error message is displayed in the github flow, so these force arguments are not necessary (or can later be added as part of #33345) .\n\nCan we please get this ticket in?",
    "created_at": "2022-03-16T17:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436972",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:235 mkoeppe]:
> Replying to [comment:92 mkoeppe]:
> > Or generate it as `$(for pkg in $(./sage -package list :standard: --has-file spkg-configure.m4); do echo --with-system-$pkg=force; done)`
> 
> With dependency #33361 positively reviewed, but #33345 (`configure --with-system-standard-packages=force`) stalled, let's use the above as a solution.


If a system package is not used, then an error message is displayed in the github flow, so these force arguments are not necessary (or can later be added as part of #33345) .

Can we please get this ticket in?



---

archive/issue_comments_436973.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-16T18:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436973",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436974.json:
```json
{
    "body": "Replying to [comment:238 gh-tobiasdiez]:\n> Can we please get this ticket in? \n\nWorking on it, as you can see",
    "created_at": "2022-03-16T19:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436974",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:238 gh-tobiasdiez]:
> Can we please get this ticket in? 

Working on it, as you can see



---

archive/issue_comments_436975.json:
```json
{
    "body": "Replying to [comment:237 slelievre]:\n> Fixed by\n> \n> - https://github.com/conda-forge/lrcalc-feedstock/pull/7\n\nGreat, now I see that lrcalc 2.1. Still need https://pypi.org/project/lrcalc/ in conda-forge, or we need to install it with pip.",
    "created_at": "2022-03-16T19:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436975",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:237 slelievre]:
> Fixed by
> 
> - https://github.com/conda-forge/lrcalc-feedstock/pull/7

Great, now I see that lrcalc 2.1. Still need https://pypi.org/project/lrcalc/ in conda-forge, or we need to install it with pip.



---

archive/issue_comments_436976.json:
```json
{
    "body": "Replying to [comment:240 mkoeppe]:\n> Replying to [comment:238 gh-tobiasdiez]:\n> > Can we please get this ticket in? \n> \n> Working on it, as you can see\n\nCan you please revert 574c6df thanks!",
    "created_at": "2022-03-16T19:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436976",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:240 mkoeppe]:
> Replying to [comment:238 gh-tobiasdiez]:
> > Can we please get this ticket in? 
> 
> Working on it, as you can see

Can you please revert 574c6df thanks!



---

archive/issue_comments_436977.json:
```json
{
    "body": "I'm also getting\n\n```\nChecking whether SageMath should install SPKG singular...\nchecking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\nchecking for Singular... /usr/share/miniconda/envs/sage-build/bin/Singular\nchecking for SINGULAR... no\n...\nconfigure: error: \n\n    Given --with-system-singular=force, but no system package could be used.\n    That's an error.  Please install the indicated package to continue.\n    (To override this error, use ./configure --without-system-singular)\n```\n\n(https://github.com/mkoeppe/sage/runs/5575546912?check_suite_focus=true)",
    "created_at": "2022-03-16T19:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436977",
    "user": "https://github.com/mkoeppe"
}
```

I'm also getting

```
Checking whether SageMath should install SPKG singular...
checking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
checking for Singular... /usr/share/miniconda/envs/sage-build/bin/Singular
checking for SINGULAR... no
...
configure: error: 

    Given --with-system-singular=force, but no system package could be used.
    That's an error.  Please install the indicated package to continue.
    (To override this error, use ./configure --without-system-singular)
```

(https://github.com/mkoeppe/sage/runs/5575546912?check_suite_focus=true)



---

archive/issue_comments_436978.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-16T19:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436978",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_436979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-16T19:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436980.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-16T19:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436981.json:
```json
{
    "body": "Working on both lrcalc and singular issue. Can you add `python-lrcalc` as the name for conda package for `lrcalc_python`?",
    "created_at": "2022-03-16T19:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436981",
    "user": "https://github.com/isuruf"
}
```

Working on both lrcalc and singular issue. Can you add `python-lrcalc` as the name for conda package for `lrcalc_python`?



---

archive/issue_comments_436982.json:
```json
{
    "body": "Will do, thanks!",
    "created_at": "2022-03-16T20:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436982",
    "user": "https://github.com/mkoeppe"
}
```

Will do, thanks!



---

archive/issue_comments_436983.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-16T20:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436984.json:
```json
{
    "body": "Can you also do `singular>=4.2.1.p3`? Apparently conda thinks `4.2.1.p3` is a development version and is `<4.2.1`",
    "created_at": "2022-03-16T20:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436984",
    "user": "https://github.com/isuruf"
}
```

Can you also do `singular>=4.2.1.p3`? Apparently conda thinks `4.2.1.p3` is a development version and is `<4.2.1`



---

archive/issue_comments_436985.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-16T20:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436985",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436986.json:
```json
{
    "body": "Replying to [comment:243 mkoeppe]:\n> I'm also getting\n> {{{\n> Checking whether [SageMath](SageMath) should install SPKG singular...\n> checking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no\n> checking for Singular... /usr/share/miniconda/envs/sage-build/bin/Singular\n> checking for SINGULAR... no\n> ...\n> configure: error: \n> \n>     Given --with-system-singular=force, but no system package could be used.\n>     That's an error.  Please install the indicated package to continue.\n>     (To override this error, use ./configure --without-system-singular)\n> }}}\n> (https://github.com/mkoeppe/sage/runs/5575546912?check_suite_focus=true)\n\nCan we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.\n\nSimilarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).\n----\nNew commits:",
    "created_at": "2022-03-16T20:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436986",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:243 mkoeppe]:
> I'm also getting
> {{{
> Checking whether [SageMath](SageMath) should install SPKG singular...
> checking whether any of gmp ntl flint readline mpfr cddlib is installed as or will be installed as SPKG... no
> checking for Singular... /usr/share/miniconda/envs/sage-build/bin/Singular
> checking for SINGULAR... no
> ...
> configure: error: 
> 
>     Given --with-system-singular=force, but no system package could be used.
>     That's an error.  Please install the indicated package to continue.
>     (To override this error, use ./configure --without-system-singular)
> }}}
> (https://github.com/mkoeppe/sage/runs/5575546912?check_suite_focus=true)

Can we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.

Similarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).
----
New commits:



---

archive/issue_comments_436987.json:
```json
{
    "body": "Replying to [comment:253 gh-tobiasdiez]:\n> Can we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.\n> \n> Similarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).\n\nPlease, Tobias, an author repeatedly demanding that the ticket goes in \"as is\" is not helpful and is not part of the collaborative workflow of the Sage project.",
    "created_at": "2022-03-16T20:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436987",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:253 gh-tobiasdiez]:
> Can we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.
> 
> Similarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).

Please, Tobias, an author repeatedly demanding that the ticket goes in "as is" is not helpful and is not part of the collaborative workflow of the Sage project.



---

archive/issue_comments_436988.json:
```json
{
    "body": "Replying to [comment:251 isuruf]:\n> Can you also do `singular>=4.2.1.p3`? Apparently conda thinks `4.2.1.p3` is a development version and is `<4.2.1`\n\nThanks, this works.",
    "created_at": "2022-03-16T20:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436988",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:251 isuruf]:
> Can you also do `singular>=4.2.1.p3`? Apparently conda thinks `4.2.1.p3` is a development version and is `<4.2.1`

Thanks, this works.



---

archive/issue_comments_436989.json:
```json
{
    "body": "Replying to [comment:254 mkoeppe]:\n> Replying to [comment:253 gh-tobiasdiez]:\n> > Can we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.\n> > \n> > Similarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).\n> \n> Please, Tobias, an author repeatedly demanding that the ticket goes in \"as is\" is not helpful and is not part of the collaborative workflow of the Sage project. \n\nThat's not what I'm saying. I just don't see the need that these changes, that then need further changes etc need to be part of this ticket. I'm happy to adjust the github workflow if you have any comments/suggestions on this.",
    "created_at": "2022-03-16T20:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436989",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:254 mkoeppe]:
> Replying to [comment:253 gh-tobiasdiez]:
> > Can we please do this in a follow-up ticket (i.e. remove the force for now). This has nothing to do with the github action action in this ticket.
> > 
> > Similarly, the changes to the conda package versions / package names should go to their own tickets (based on this ticket here to check if they indeed work as intended).
> 
> Please, Tobias, an author repeatedly demanding that the ticket goes in "as is" is not helpful and is not part of the collaborative workflow of the Sage project. 

That's not what I'm saying. I just don't see the need that these changes, that then need further changes etc need to be part of this ticket. I'm happy to adjust the github workflow if you have any comments/suggestions on this.



---

archive/issue_comments_436990.json:
```json
{
    "body": "I see that `python-lrcalc` 2.1 is now available in the conda-forge channel. Thanks `@`isuruf! \n\nTests running at https://github.com/mkoeppe/sage/actions/runs/1996031338",
    "created_at": "2022-03-17T01:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436990",
    "user": "https://github.com/mkoeppe"
}
```

I see that `python-lrcalc` 2.1 is now available in the conda-forge channel. Thanks `@`isuruf! 

Tests running at https://github.com/mkoeppe/sage/actions/runs/1996031338



---

archive/issue_comments_436991.json:
```json
{
    "body": "There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion",
    "created_at": "2022-03-17T03:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436991",
    "user": "https://github.com/mkoeppe"
}
```

There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion



---

archive/issue_comments_436992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T06:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436993.json:
```json
{
    "body": "I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.\n\nsee https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true",
    "created_at": "2022-03-17T06:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436993",
    "user": "https://github.com/mkoeppe"
}
```

I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.

see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true



---

archive/issue_comments_436994.json:
```json
{
    "body": "Replying to [comment:260 mkoeppe]:\n> I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.\n> \n> see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true\n\nthis looks to me like a bug in `m4/ppl.m4`. They extract `-L`, etc, flags into `PPL_LDFLAGS` but forget\nto append them to `LDFLAGS` for testing in `AC_RUN_IF_ELSE`. Something like this should make it work\n(assuming these flags are getting into `PPL_LDFLAGS` at all):\n\n\n```diff\n--- a/m4/ppl.m4\n+++ b/m4/ppl.m4\n@@ -96,9 +96,11 @@ else\n   if test \"x$enable_ppltest\" = xyes\n   then\n     ac_save_CPPFLAGS=\"$CPPFLAGS\"\n+    ac_save_LDFLAGS=\"$LDFLAGS\"\n     ac_save_LIBS=\"$LIBS\"\n     CPPFLAGS=\"$CPPFLAGS $PPL_CPPFLAGS\"\n     LIBS=\"$LIBS $PPL_LIBS\"\n+    LDFLAGS=\"$LDFLAGS $PPL_LDFLAGS\"\n \n dnl Now check if the installed PPL is sufficiently new.\n dnl (Also sanity checks the results of ppl-config to some extent.)\n@@ -238,6 +240,7 @@ main() {\n \n     CPPFLAGS=\"$ac_save_CPPFLAGS\"\n     LIBS=\"$ac_save_LIBS\"\n+    LDFLAGS=\"$ac_save_LDFLAGS\"\n   fi\n fi\n \n@@ -261,6 +264,7 @@ else\n       echo \"*** Could not run PPL test program, checking why...\"\n       CPPFLAGS=\"$CPPFLAGS $PPL_CPPFLAGS\"\n       LIBS=\"$LIBS $PPL_LIBS\"\n+      LDFLAGS=\"$LDFLAGS $PPL_LDFLAGS\"\n       AC_LINK_IFELSE([AC_LANG_PROGRAM([[\n #include <ppl.hh>\n using namespace Parma_Polyhedra_Library;\n@@ -287,6 +291,7 @@ using namespace Parma_Polyhedra_Library;\n ])\n       CPPFLAGS=\"$ac_save_CPPFLAGS\"\n       LIBS=\"$ac_save_LIBS\"\n+      LDFLAGS=\"$ac_save_LDFLAGS\"\n     fi\n   fi\n   PPL_CPPFLAGS=\"\"\n```\n\n\nUntested.",
    "created_at": "2022-03-17T09:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436994",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:260 mkoeppe]:
> I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.
> 
> see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true

this looks to me like a bug in `m4/ppl.m4`. They extract `-L`, etc, flags into `PPL_LDFLAGS` but forget
to append them to `LDFLAGS` for testing in `AC_RUN_IF_ELSE`. Something like this should make it work
(assuming these flags are getting into `PPL_LDFLAGS` at all):


```diff
--- a/m4/ppl.m4
+++ b/m4/ppl.m4
@@ -96,9 +96,11 @@ else
   if test "x$enable_ppltest" = xyes
   then
     ac_save_CPPFLAGS="$CPPFLAGS"
+    ac_save_LDFLAGS="$LDFLAGS"
     ac_save_LIBS="$LIBS"
     CPPFLAGS="$CPPFLAGS $PPL_CPPFLAGS"
     LIBS="$LIBS $PPL_LIBS"
+    LDFLAGS="$LDFLAGS $PPL_LDFLAGS"
 
 dnl Now check if the installed PPL is sufficiently new.
 dnl (Also sanity checks the results of ppl-config to some extent.)
@@ -238,6 +240,7 @@ main() {
 
     CPPFLAGS="$ac_save_CPPFLAGS"
     LIBS="$ac_save_LIBS"
+    LDFLAGS="$ac_save_LDFLAGS"
   fi
 fi
 
@@ -261,6 +264,7 @@ else
       echo "*** Could not run PPL test program, checking why..."
       CPPFLAGS="$CPPFLAGS $PPL_CPPFLAGS"
       LIBS="$LIBS $PPL_LIBS"
+      LDFLAGS="$LDFLAGS $PPL_LDFLAGS"
       AC_LINK_IFELSE([AC_LANG_PROGRAM([[
 #include <ppl.hh>
 using namespace Parma_Polyhedra_Library;
@@ -287,6 +291,7 @@ using namespace Parma_Polyhedra_Library;
 ])
       CPPFLAGS="$ac_save_CPPFLAGS"
       LIBS="$ac_save_LIBS"
+      LDFLAGS="$ac_save_LDFLAGS"
     fi
   fi
   PPL_CPPFLAGS=""
```


Untested.



---

archive/issue_comments_436995.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T09:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436996.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T09:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436996",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436997.json:
```json
{
    "body": "No, it's a bug in the conda package with binary relocation. Will fix shortly.\n\nReplying to [comment:261 dimpase]:\n> Replying to [comment:260 mkoeppe]:\n> > I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.\n> > \n> > see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true\n> \n> this looks to me like a bug in `m4/ppl.m4`. They extract `-L`, etc, flags into `PPL_LDFLAGS` but forget",
    "created_at": "2022-03-17T09:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436997",
    "user": "https://github.com/isuruf"
}
```

No, it's a bug in the conda package with binary relocation. Will fix shortly.

Replying to [comment:261 dimpase]:
> Replying to [comment:260 mkoeppe]:
> > I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.
> > 
> > see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true
> 
> this looks to me like a bug in `m4/ppl.m4`. They extract `-L`, etc, flags into `PPL_LDFLAGS` but forget



---

archive/issue_comments_436998.json:
```json
{
    "body": "I've reverted the changes to the lower bounds to singular and lrcalc since for me they were not necessary. It also looks like on github `lcalc 2.1` and `singular 4.2.1.p3` are used automatically. This is also expected since conda always tries to use the most recent versions and only in very rare instances lower bounds are necessary (essentially only if there are two different branches in the dependency resolution tree, and conda would choose the 'wrong' one). Why did you added these lower bounds?",
    "created_at": "2022-03-17T12:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436998",
    "user": "https://github.com/tobiasdiez"
}
```

I've reverted the changes to the lower bounds to singular and lrcalc since for me they were not necessary. It also looks like on github `lcalc 2.1` and `singular 4.2.1.p3` are used automatically. This is also expected since conda always tries to use the most recent versions and only in very rare instances lower bounds are necessary (essentially only if there are two different branches in the dependency resolution tree, and conda would choose the 'wrong' one). Why did you added these lower bounds?



---

archive/issue_comments_436999.json:
```json
{
    "body": "Replying to [comment:260 mkoeppe]:\n> I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.\n> \n> see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true\n\nAnd which advantages does one now gain from the fact that the github workflow already quits after the configure step, and doesn't run build and tests?\n\nMoreover, after the change with the force parameter the github matcher is no longer working correctly since now \" no suitable system package; this is an error\" is displayed in the logs.",
    "created_at": "2022-03-17T13:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-436999",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:260 mkoeppe]:
> I have also added tests on `macos-latest`. This reproduces an error that I saw on my machine: `ppl` is rejected by the configure script.
> 
> see https://github.com/mkoeppe/sage/runs/5581501610?check_suite_focus=true

And which advantages does one now gain from the fact that the github workflow already quits after the configure step, and doesn't run build and tests?

Moreover, after the change with the force parameter the github matcher is no longer working correctly since now " no suitable system package; this is an error" is displayed in the logs.



---

archive/issue_comments_437000.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T15:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437000",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437001.json:
```json
{
    "body": "Replying to [comment:265 gh-tobiasdiez]:\n> I've reverted the changes to the lower bounds to singular and lrcalc since for me they were not necessary\n\nYes, they are not needed any more, thanks.",
    "created_at": "2022-03-17T15:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437001",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:265 gh-tobiasdiez]:
> I've reverted the changes to the lower bounds to singular and lrcalc since for me they were not necessary

Yes, they are not needed any more, thanks.



---

archive/issue_comments_437002.json:
```json
{
    "body": "`@`isuruf, on macos with `environment-optional.yml` (https://github.com/mkoeppe/sage/runs/5586815094?check_suite_focus=true), I am getting an error from gdb\n\n```\nWarning: ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.\n  \n  ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.\n  Rolling back transaction: ...working... done\n  Warning: \n  LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3\n  location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh\n  ==> script messages <==\n  <None>\n  ==> script output <==\n  stdout: Warning: GDB is not codesigned.\n  Generating and installing gdb_codesign certificate\n  \n  stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory\n  error: Something went wrong when installing the certificate\n  \n  return code: 1\n  \n  ()\n  \n  \n  \n  LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3\n  location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh\n  ==> script messages <==\n  <None>\n  ==> script output <==\n  stdout: Warning: GDB is not codesigned.\n  Generating and installing gdb_codesign certificate\n  \n  stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory\n  error: Something went wrong when installing the certificate\n  \n  return code: 1\n  \n```\n",
    "created_at": "2022-03-17T15:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437002",
    "user": "https://github.com/mkoeppe"
}
```

`@`isuruf, on macos with `environment-optional.yml` (https://github.com/mkoeppe/sage/runs/5586815094?check_suite_focus=true), I am getting an error from gdb

```
Warning: ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.
  
  ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.
  Rolling back transaction: ...working... done
  Warning: 
  LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3
  location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh
  ==> script messages <==
  <None>
  ==> script output <==
  stdout: Warning: GDB is not codesigned.
  Generating and installing gdb_codesign certificate
  
  stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory
  error: Something went wrong when installing the certificate
  
  return code: 1
  
  ()
  
  
  
  LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3
  location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh
  ==> script messages <==
  <None>
  ==> script output <==
  stdout: Warning: GDB is not codesigned.
  Generating and installing gdb_codesign certificate
  
  stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory
  error: Something went wrong when installing the certificate
  
  return code: 1
  
```




---

archive/issue_comments_437003.json:
```json
{
    "body": "`@`isuruf, on macos I see lots of warnings `ld: warning: -pie being ignored. It is only used when linking a main executable` in the doctests. I see this is coming from `LDFLAGS` in the conda environments. Is this something that can be fixed, or should we silence this warning in our doctest machinery?",
    "created_at": "2022-03-17T16:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437003",
    "user": "https://github.com/mkoeppe"
}
```

`@`isuruf, on macos I see lots of warnings `ld: warning: -pie being ignored. It is only used when linking a main executable` in the doctests. I see this is coming from `LDFLAGS` in the conda environments. Is this something that can be fixed, or should we silence this warning in our doctest machinery?



---

archive/issue_comments_437004.json:
```json
{
    "body": "Replying to [comment:258 mkoeppe]:\n> There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion\n\nThis one is specific to Linux; it's fine on macos.",
    "created_at": "2022-03-17T16:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437004",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:258 mkoeppe]:
> There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion

This one is specific to Linux; it's fine on macos.



---

archive/issue_comments_437005.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T17:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437006.json:
```json
{
    "body": "Replying to [comment:272 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[ed0967c](https://git.sagemath.org/sage.git/commit/?id=ed0967c881b63c928391ce4cbe8f7bf6370d187c)||`.github/workflows/configure-systempackage-problem-matcher.json: Also match 'no suitable system package; this is an error'`||\n\nError: Unable to process command '::add-matcher::.github/workflows/configure-systempackage-problem-matcher.json' successfully.\nError: After parsing a value an unexpected character was encountered: {. Path 'problemMatcher[0]', line 15, position 8.",
    "created_at": "2022-03-17T19:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437006",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:272 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[ed0967c](https://git.sagemath.org/sage.git/commit/?id=ed0967c881b63c928391ce4cbe8f7bf6370d187c)||`.github/workflows/configure-systempackage-problem-matcher.json: Also match 'no suitable system package; this is an error'`||

Error: Unable to process command '::add-matcher::.github/workflows/configure-systempackage-problem-matcher.json' successfully.
Error: After parsing a value an unexpected character was encountered: {. Path 'problemMatcher[0]', line 15, position 8.



---

archive/issue_comments_437007.json:
```json
{
    "body": "Is there something else that is left to do?",
    "created_at": "2022-03-17T19:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437007",
    "user": "https://github.com/tobiasdiez"
}
```

Is there something else that is left to do?



---

archive/issue_comments_437008.json:
```json
{
    "body": "Replying to [comment:270 mkoeppe]:\n> `@`isuruf, on macos I see lots of warnings `ld: warning: -pie being ignored. It is only used when linking a main executable` in the doctests. I see this is coming from `LDFLAGS` in the conda environments. Is this something that can be fixed, or should we silence this warning in our doctest machinery?\n\nNot easy to do. It's better to silence in the doctest machinery",
    "created_at": "2022-03-17T19:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437008",
    "user": "https://github.com/isuruf"
}
```

Replying to [comment:270 mkoeppe]:
> `@`isuruf, on macos I see lots of warnings `ld: warning: -pie being ignored. It is only used when linking a main executable` in the doctests. I see this is coming from `LDFLAGS` in the conda environments. Is this something that can be fixed, or should we silence this warning in our doctest machinery?

Not easy to do. It's better to silence in the doctest machinery



---

archive/issue_comments_437009.json:
```json
{
    "body": "OK, I'll do that so that the noise from these warnings does not hide real failures",
    "created_at": "2022-03-17T19:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437009",
    "user": "https://github.com/mkoeppe"
}
```

OK, I'll do that so that the noise from these warnings does not hide real failures



---

archive/issue_comments_437010.json:
```json
{
    "body": "Can you open an issue in https://github.com/conda-forge/gdb-feedstock/?\n\nReplying to [comment:269 mkoeppe]:\n> `@`isuruf, on macos with `environment-optional.yml` (https://github.com/mkoeppe/sage/runs/5586815094?check_suite_focus=true), I am getting an error from gdb\n> {{{\n> Warning: ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.\n>   \n>   ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.\n>   Rolling back transaction: ...working... done\n>   Warning: \n>   LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3\n>   location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh\n>   ==> script messages <==\n>   <None>\n>   ==> script output <==\n>   stdout: Warning: GDB is not codesigned.\n>   Generating and installing gdb_codesign certificate\n>   \n>   stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory\n>   error: Something went wrong when installing the certificate\n>   \n>   return code: 1\n>   \n>   ()\n>   \n>   \n>   \n>   LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3\n>   location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh\n>   ==> script messages <==\n>   <None>\n>   ==> script output <==\n>   stdout: Warning: GDB is not codesigned.\n>   Generating and installing gdb_codesign certificate\n>   \n>   stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory\n>   error: Something went wrong when installing the certificate\n>   \n>   return code: 1\n>   \n> }}}",
    "created_at": "2022-03-17T19:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437010",
    "user": "https://github.com/isuruf"
}
```

Can you open an issue in https://github.com/conda-forge/gdb-feedstock/?

Replying to [comment:269 mkoeppe]:
> `@`isuruf, on macos with `environment-optional.yml` (https://github.com/mkoeppe/sage/runs/5586815094?check_suite_focus=true), I am getting an error from gdb
> {{{
> Warning: ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.
>   
>   ERROR conda.core.link:_execute(699): An error occurred while installing package 'conda-forge::gdb-11.1-py38h36b043a_3'.
>   Rolling back transaction: ...working... done
>   Warning: 
>   LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3
>   location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh
>   ==> script messages <==
>   <None>
>   ==> script output <==
>   stdout: Warning: GDB is not codesigned.
>   Generating and installing gdb_codesign certificate
>   
>   stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory
>   error: Something went wrong when installing the certificate
>   
>   return code: 1
>   
>   ()
>   
>   
>   
>   LinkError: post-link script failed for package conda-forge::gdb-11.1-py38h36b043a_3
>   location of failed script: /usr/local/miniconda/envs/sage-build/bin/.gdb-post-link.sh
>   ==> script messages <==
>   <None>
>   ==> script output <==
>   stdout: Warning: GDB is not codesigned.
>   Generating and installing gdb_codesign certificate
>   
>   stderr: cat: /usr/local/miniconda/envs/sage-build/etc/gdb/.messages.txt: No such file or directory
>   error: Something went wrong when installing the certificate
>   
>   return code: 1
>   
> }}}



---

archive/issue_comments_437011.json:
```json
{
    "body": "A minor thing to fix: Installing sagelib downgrades `scipy`, `networkx` via install-requires; that's now #33520.",
    "created_at": "2022-03-17T19:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437011",
    "user": "https://github.com/mkoeppe"
}
```

A minor thing to fix: Installing sagelib downgrades `scipy`, `networkx` via install-requires; that's now #33520.



---

archive/issue_comments_437012.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T19:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T19:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T19:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T20:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437016.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T20:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437016",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437017.json:
```json
{
    "body": "Replying to [comment:277 isuruf]:\n> Can you open an issue in https://github.com/conda-forge/gdb-feedstock/?\n\nWill do. For now I've disabled it",
    "created_at": "2022-03-17T20:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437017",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:277 isuruf]:
> Can you open an issue in https://github.com/conda-forge/gdb-feedstock/?

Will do. For now I've disabled it



---

archive/issue_comments_437018.json:
```json
{
    "body": "I've opened https://github.com/conda-forge/gdb-feedstock/issues/53",
    "created_at": "2022-03-17T20:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437018",
    "user": "https://github.com/mkoeppe"
}
```

I've opened https://github.com/conda-forge/gdb-feedstock/issues/53



---

archive/issue_comments_437019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T20:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437020.json:
```json
{
    "body": "Replying to [comment:287 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[b431edb](https://git.sagemath.org/sage.git/commit/?id=b431edb380db1a4bd7fc07c5619bc350a45ca428)||`.github/workflows/configure-systempackage-problem-matcher.json: Fix 'Duplicate owner name'`||\n\n`echo \"::remove-matcher owner=configure-systempackage::\"` in the workflow has to be probably be changed as well now.",
    "created_at": "2022-03-17T22:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437020",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:287 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[b431edb](https://git.sagemath.org/sage.git/commit/?id=b431edb380db1a4bd7fc07c5619bc350a45ca428)||`.github/workflows/configure-systempackage-problem-matcher.json: Fix 'Duplicate owner name'`||

`echo "::remove-matcher owner=configure-systempackage::"` in the workflow has to be probably be changed as well now.



---

archive/issue_comments_437021.json:
```json
{
    "body": "Btw, the new workflow is running in the sagetrac-mirror repo (https://github.com/sagemath/sagetrac-mirror/actions/workflows/ci-conda.yml) so you don't have to run this manually in your own fork.",
    "created_at": "2022-03-17T22:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437021",
    "user": "https://github.com/tobiasdiez"
}
```

Btw, the new workflow is running in the sagetrac-mirror repo (https://github.com/sagemath/sagetrac-mirror/actions/workflows/ci-conda.yml) so you don't have to run this manually in your own fork.



---

archive/issue_comments_437022.json:
```json
{
    "body": "macos-latest-3.8-environment: https://github.com/mkoeppe/sage/runs/5591728773?check_suite_focus=true\n\n```\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/env.py  # 1 doctest failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/expect.py  # 40 doctests failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/gap.py  # 75 doctests failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/mwrank.py  # 6 doctests failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/quit.py  # 6 doctests failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/interpreter.py  # 2 doctests failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/interface_magic.py  # 1 doctest failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/ipython_kernel/install.py  # 1 doctest failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/structure/coerce_actions.pyx  # 1 doctest failed\nsage -t --random-seed=295057506920321218473335936870781003380 src/sage/tests/cmdline.py  # 2 doctests failed\n```\n",
    "created_at": "2022-03-17T22:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437022",
    "user": "https://github.com/mkoeppe"
}
```

macos-latest-3.8-environment: https://github.com/mkoeppe/sage/runs/5591728773?check_suite_focus=true

```
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/env.py  # 1 doctest failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/expect.py  # 40 doctests failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/gap.py  # 75 doctests failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/mwrank.py  # 6 doctests failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/interfaces/quit.py  # 6 doctests failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/interpreter.py  # 2 doctests failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/interface_magic.py  # 1 doctest failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/repl/ipython_kernel/install.py  # 1 doctest failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/structure/coerce_actions.pyx  # 1 doctest failed
sage -t --random-seed=295057506920321218473335936870781003380 src/sage/tests/cmdline.py  # 2 doctests failed
```




---

archive/issue_comments_437023.json:
```json
{
    "body": "I think the many failures from `sage.interfaces` are the failure of too recent versions of `ptyprocess` (#32147).",
    "created_at": "2022-03-17T23:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437023",
    "user": "https://github.com/mkoeppe"
}
```

I think the many failures from `sage.interfaces` are the failure of too recent versions of `ptyprocess` (#32147).



---

archive/issue_comments_437024.json:
```json
{
    "body": "`@`isuruf unfortunately, the only working version of ptyprocess (0.5.1) on macOS is only available on outdated python versions in conda-forge.\n\n```\nptyprocess                     0.5.1          py27_0  conda-forge         \nptyprocess                     0.5.1          py34_0  conda-forge         \nptyprocess                     0.5.1          py35_0  conda-forge         \nptyprocess                     0.5.1          py36_0  conda-forge         \n```\n",
    "created_at": "2022-03-17T23:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437024",
    "user": "https://github.com/mkoeppe"
}
```

`@`isuruf unfortunately, the only working version of ptyprocess (0.5.1) on macOS is only available on outdated python versions in conda-forge.

```
ptyprocess                     0.5.1          py27_0  conda-forge         
ptyprocess                     0.5.1          py34_0  conda-forge         
ptyprocess                     0.5.1          py35_0  conda-forge         
ptyprocess                     0.5.1          py36_0  conda-forge         
```




---

archive/issue_comments_437025.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T23:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437026.json:
```json
{
    "body": "Replying to [comment:290 gh-tobiasdiez]:\n> Btw, the new workflow is running in the sagetrac-mirror repo (https://github.com/sagemath/sagetrac-mirror/actions/workflows/ci-conda.yml) so you don't have to run this manually in your own fork.\n\nThanks, yes, but the pipeline is pretty clogged",
    "created_at": "2022-03-17T23:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437026",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:290 gh-tobiasdiez]:
> Btw, the new workflow is running in the sagetrac-mirror repo (https://github.com/sagemath/sagetrac-mirror/actions/workflows/ci-conda.yml) so you don't have to run this manually in your own fork.

Thanks, yes, but the pipeline is pretty clogged



---

archive/issue_comments_437027.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-17T23:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437027",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437028.json:
```json
{
    "body": "The other failures on macOS are very minor.",
    "created_at": "2022-03-17T23:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437028",
    "user": "https://github.com/mkoeppe"
}
```

The other failures on macOS are very minor.



---

archive/issue_comments_437029.json:
```json
{
    "body": "Replying to [comment:258 mkoeppe]:\n> There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion\n\nThis failure on Linux is the remaining big issue.",
    "created_at": "2022-03-17T23:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437029",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:258 mkoeppe]:
> There's something wrong with libgiac, in the doctests of `src/sage/calculus/calculus.py` it looks like infinite recursion

This failure on Linux is the remaining big issue.



---

archive/issue_comments_437030.json:
```json
{
    "body": "(The log of these runs is about 250 MB uncompressed, not fun to look at.)",
    "created_at": "2022-03-17T23:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437030",
    "user": "https://github.com/mkoeppe"
}
```

(The log of these runs is about 250 MB uncompressed, not fun to look at.)



---

archive/issue_comments_437031.json:
```json
{
    "body": "There's also some cysignals-related breakage on Linux:\n\n```\n2022-03-17T21:25:16.4730359Z **********************************************************************\n2022-03-17T21:25:16.4812929Z File \"src/sage/functions/min_max.py\", line 240, in sage.functions.min_max.MaxSymbolic._evalf_\n2022-03-17T21:25:16.4813319Z Failed example:\n2022-03-17T21:25:16.4813740Z     sig_on_count() # check sig_on/off pairings (virtual doctest)\n2022-03-17T21:25:16.4814033Z Expected:\n2022-03-17T21:25:16.4814224Z     0\n2022-03-17T21:25:16.4814414Z Got:\n2022-03-17T21:25:16.4814603Z     2947\n2022-03-17T21:25:16.4935843Z **********************************************************************\n```\n",
    "created_at": "2022-03-17T23:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437031",
    "user": "https://github.com/mkoeppe"
}
```

There's also some cysignals-related breakage on Linux:

```
2022-03-17T21:25:16.4730359Z **********************************************************************
2022-03-17T21:25:16.4812929Z File "src/sage/functions/min_max.py", line 240, in sage.functions.min_max.MaxSymbolic._evalf_
2022-03-17T21:25:16.4813319Z Failed example:
2022-03-17T21:25:16.4813740Z     sig_on_count() # check sig_on/off pairings (virtual doctest)
2022-03-17T21:25:16.4814033Z Expected:
2022-03-17T21:25:16.4814224Z     0
2022-03-17T21:25:16.4814414Z Got:
2022-03-17T21:25:16.4814603Z     2947
2022-03-17T21:25:16.4935843Z **********************************************************************
```




---

archive/issue_comments_437032.json:
```json
{
    "body": "giac error should be fixed with https://github.com/conda-forge/giac-feedstock/pull/29",
    "created_at": "2022-03-18T06:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437032",
    "user": "https://github.com/isuruf"
}
```

giac error should be fixed with https://github.com/conda-forge/giac-feedstock/pull/29



---

archive/issue_comments_437033.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-18T08:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437034.json:
```json
{
    "body": "Most doctests are now passing, so this should be good to go now (leaving fixes to the other tests to follow-up tickets).",
    "created_at": "2022-03-18T08:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437034",
    "user": "https://github.com/tobiasdiez"
}
```

Most doctests are now passing, so this should be good to go now (leaving fixes to the other tests to follow-up tickets).



---

archive/issue_comments_437035.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-18T08:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437035",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437036.json:
```json
{
    "body": "`continue-on-error` makes no sense because the unconfigured source tree cannot be tested.",
    "created_at": "2022-03-18T15:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437036",
    "user": "https://github.com/mkoeppe"
}
```

`continue-on-error` makes no sense because the unconfigured source tree cannot be tested.



---

archive/issue_comments_437037.json:
```json
{
    "body": "Replying to [comment:302 isuruf]:\n> giac error should be fixed with https://github.com/conda-forge/giac-feedstock/pull/29\n\nThanks `@`isuruf, looking great.",
    "created_at": "2022-03-18T15:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437037",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:302 isuruf]:
> giac error should be fixed with https://github.com/conda-forge/giac-feedstock/pull/29

Thanks `@`isuruf, looking great.



---

archive/issue_comments_437038.json:
```json
{
    "body": "Replying to [comment:305 mkoeppe]:\n> `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.\n\nOther than that, it's in good shape now. Could someone review my changes please?",
    "created_at": "2022-03-18T15:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437038",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:305 mkoeppe]:
> `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.

Other than that, it's in good shape now. Could someone review my changes please?



---

archive/issue_comments_437039.json:
```json
{
    "body": "Replying to [comment:305 mkoeppe]:\n> `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.\n\nThat largely depends on the nature of the error. If the error in the config step is critical, then the build step will fail and no tests are run. Moreover, there is no harm in executing also the other steps, the workflow will still be displayed as failed due to the error in the config job. You just get a bit more information.",
    "created_at": "2022-03-18T15:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437039",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:305 mkoeppe]:
> `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.

That largely depends on the nature of the error. If the error in the config step is critical, then the build step will fail and no tests are run. Moreover, there is no harm in executing also the other steps, the workflow will still be displayed as failed due to the error in the config job. You just get a bit more information.



---

archive/issue_comments_437040.json:
```json
{
    "body": "Replying to [comment:308 gh-tobiasdiez]:\n> Replying to [comment:305 mkoeppe]:\n> > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.\n> \n> That largely depends on the nature of the error. \n\nNo, it doesn't. On error, the generated files are not generated.",
    "created_at": "2022-03-18T15:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437040",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:308 gh-tobiasdiez]:
> Replying to [comment:305 mkoeppe]:
> > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.
> 
> That largely depends on the nature of the error. 

No, it doesn't. On error, the generated files are not generated.



---

archive/issue_comments_437041.json:
```json
{
    "body": "Replying to [comment:307 mkoeppe]:\n> Replying to [comment:305 mkoeppe]:\n> > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.\n> \n> Other than that, it's in good shape now. Could someone review my changes please?\n\nI'm fine with these changes (although they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow; but lets not be overly pedantic).",
    "created_at": "2022-03-18T15:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437041",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:307 mkoeppe]:
> Replying to [comment:305 mkoeppe]:
> > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.
> 
> Other than that, it's in good shape now. Could someone review my changes please?

I'm fine with these changes (although they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow; but lets not be overly pedantic).



---

archive/issue_comments_437042.json:
```json
{
    "body": "Replying to [comment:309 mkoeppe]:\n> Replying to [comment:308 gh-tobiasdiez]:\n> > Replying to [comment:305 mkoeppe]:\n> > > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.\n> > \n> > That largely depends on the nature of the error. \n> \n> No, it doesn't. On error, the generated files are not generated.\n\nI tried it locally and the necessary files seem to be still present when `with-system-SPKG=force` triggers an error. Having a quick look at the code these errors are also deferred to the very end of the configure script.",
    "created_at": "2022-03-18T16:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437042",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:309 mkoeppe]:
> Replying to [comment:308 gh-tobiasdiez]:
> > Replying to [comment:305 mkoeppe]:
> > > `continue-on-error` makes no sense because the unconfigured source tree cannot be tested.
> > 
> > That largely depends on the nature of the error. 
> 
> No, it doesn't. On error, the generated files are not generated.

I tried it locally and the necessary files seem to be still present when `with-system-SPKG=force` triggers an error. Having a quick look at the code these errors are also deferred to the very end of the configure script.



---

archive/issue_comments_437043.json:
```json
{
    "body": "Replying to [comment:314 gh-tobiasdiez]:\n> I tried it locally and the necessary files seem to be still present when `with-system-SPKG=force` triggers an error. Having a quick look at the code these errors are also deferred to the very end of the configure script.\n\nYou are right.",
    "created_at": "2022-03-18T16:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437043",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:314 gh-tobiasdiez]:
> I tried it locally and the necessary files seem to be still present when `with-system-SPKG=force` triggers an error. Having a quick look at the code these errors are also deferred to the very end of the configure script.

You are right.



---

archive/issue_comments_437044.json:
```json
{
    "body": "Nevertheless, `continue-on-error` makes no sense as I have explained throughout the thread, comment:141 etc.",
    "created_at": "2022-03-18T16:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437044",
    "user": "https://github.com/mkoeppe"
}
```

Nevertheless, `continue-on-error` makes no sense as I have explained throughout the thread, comment:141 etc.



---

archive/issue_comments_437045.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-18T16:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437045",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437046.json:
```json
{
    "body": "But it's fine for now, let's see that we can get it merged in 9.6.",
    "created_at": "2022-03-18T16:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437046",
    "user": "https://github.com/mkoeppe"
}
```

But it's fine for now, let's see that we can get it merged in 9.6.



---

archive/issue_comments_437047.json:
```json
{
    "body": "Onward to documenting it, #33426?",
    "created_at": "2022-03-18T16:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437047",
    "user": "https://github.com/mkoeppe"
}
```

Onward to documenting it, #33426?



---

archive/issue_comments_437048.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-03-18T16:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437048",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_437049.json:
```json
{
    "body": "Replying to [comment:310 gh-tobiasdiez]:\n> they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow\n\nYes, the fix to `src/sage/features/pkg_systems.py` could perhaps have been made a separate ticket and a dependency here. But it would have been difficult to test it separately because the present ticket is its only use case.\n\nSometimes the scope of a ticket needs to be adjusted during development. You already know that sometimes the scope turns out to be too big and it is necessary break out smaller, more manageable and more clearly defined tickets.\n\nBut sometimes the scope of a ticket also turns out to be too small and the ticket is not viable on its own. This is what happened on the present ticket. The workflow documented in the wiki https://wiki.sagemath.org/Conda has never actually worked. Creating a GH Actions workflow based on a semi-quasi-working variant of it, by itself was not convincing as a ticket (comment:121 - \"what does it test\"). With the broader scope of actually fixing this way of installing Sage and testing something that we can recommend to developers, the ticket has a viable scope: The changes bring a clear improvement to Sage.",
    "created_at": "2022-03-18T16:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437049",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:310 gh-tobiasdiez]:
> they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow

Yes, the fix to `src/sage/features/pkg_systems.py` could perhaps have been made a separate ticket and a dependency here. But it would have been difficult to test it separately because the present ticket is its only use case.

Sometimes the scope of a ticket needs to be adjusted during development. You already know that sometimes the scope turns out to be too big and it is necessary break out smaller, more manageable and more clearly defined tickets.

But sometimes the scope of a ticket also turns out to be too small and the ticket is not viable on its own. This is what happened on the present ticket. The workflow documented in the wiki https://wiki.sagemath.org/Conda has never actually worked. Creating a GH Actions workflow based on a semi-quasi-working variant of it, by itself was not convincing as a ticket (comment:121 - "what does it test"). With the broader scope of actually fixing this way of installing Sage and testing something that we can recommend to developers, the ticket has a viable scope: The changes bring a clear improvement to Sage.



---

archive/issue_comments_437050.json:
```json
{
    "body": "Some of the test suite failures that we saw are from ipython 8.x; #33170 updates the doctests",
    "created_at": "2022-03-18T21:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437050",
    "user": "https://github.com/mkoeppe"
}
```

Some of the test suite failures that we saw are from ipython 8.x; #33170 updates the doctests



---

archive/issue_comments_437051.json:
```json
{
    "body": "Replying to [comment:318 mkoeppe]:\n> But it's fine for now, let's see that we can get it merged in 9.6.\n\nThanks for the review!",
    "created_at": "2022-03-18T22:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437051",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:318 mkoeppe]:
> But it's fine for now, let's see that we can get it merged in 9.6.

Thanks for the review!



---

archive/issue_comments_437052.json:
```json
{
    "body": "Replying to [comment:319 mkoeppe]:\n> Onward to documenting it, #33426?\n\nYes!",
    "created_at": "2022-03-18T22:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437052",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:319 mkoeppe]:
> Onward to documenting it, #33426?

Yes!



---

archive/issue_comments_437053.json:
```json
{
    "body": "Replying to [comment:321 mkoeppe]:\n> Replying to [comment:310 gh-tobiasdiez]:\n> > they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow\n> \n> Yes, the fix to `src/sage/features/pkg_systems.py` could perhaps have been made a separate ticket and a dependency here. But it would have been difficult to test it separately because the present ticket is its only use case.\n> \n> Sometimes the scope of a ticket needs to be adjusted during development. You already know that sometimes the scope turns out to be too big and it is necessary break out smaller, more manageable and more clearly defined tickets.\n> \n> But sometimes the scope of a ticket also turns out to be too small and the ticket is not viable on its own. This is what happened on the present ticket. The workflow documented in the wiki https://wiki.sagemath.org/Conda has never actually worked. Creating a GH Actions workflow based on a semi-quasi-working variant of it, by itself was not convincing as a ticket (comment:121 - \"what does it test\"). With the broader scope of actually fixing this way of installing Sage and testing something that we can recommend to developers, the ticket has a viable scope: The changes bring a clear improvement to Sage. \n\nIn general I agree that a ticket has to have a clear scope and improvement. For this ticket here, the github workflow essentially didn't change in the past 4 weeks, and at this point it was already clear that the workflow works in principle, with the caveat that a lot of docstests failed. In my opinion, it would have been better to merge the ticket already (with the few additional improvements to the workflow that we have discussed), then follow-up tickets could have easily improved different aspects of the conda environment, while the previous runs of the ci would have served as a baseline. Even thinks like the addition of the tests for macos could have been small follow-up tickets. I really think the tendency of the sage developers to create a lot of parallel, inter-dependent tickets makes reviewing harder and slows down the process. A more linear approach would increase the dev experience and velocity in my opinion.\n\nAnyway, I'm happy that this ticket is finally ready to be merged.",
    "created_at": "2022-03-18T22:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437053",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:321 mkoeppe]:
> Replying to [comment:310 gh-tobiasdiez]:
> > they probably should have been extracted to their own tickets as they don't have to do anything with the github workflow
> 
> Yes, the fix to `src/sage/features/pkg_systems.py` could perhaps have been made a separate ticket and a dependency here. But it would have been difficult to test it separately because the present ticket is its only use case.
> 
> Sometimes the scope of a ticket needs to be adjusted during development. You already know that sometimes the scope turns out to be too big and it is necessary break out smaller, more manageable and more clearly defined tickets.
> 
> But sometimes the scope of a ticket also turns out to be too small and the ticket is not viable on its own. This is what happened on the present ticket. The workflow documented in the wiki https://wiki.sagemath.org/Conda has never actually worked. Creating a GH Actions workflow based on a semi-quasi-working variant of it, by itself was not convincing as a ticket (comment:121 - "what does it test"). With the broader scope of actually fixing this way of installing Sage and testing something that we can recommend to developers, the ticket has a viable scope: The changes bring a clear improvement to Sage. 

In general I agree that a ticket has to have a clear scope and improvement. For this ticket here, the github workflow essentially didn't change in the past 4 weeks, and at this point it was already clear that the workflow works in principle, with the caveat that a lot of docstests failed. In my opinion, it would have been better to merge the ticket already (with the few additional improvements to the workflow that we have discussed), then follow-up tickets could have easily improved different aspects of the conda environment, while the previous runs of the ci would have served as a baseline. Even thinks like the addition of the tests for macos could have been small follow-up tickets. I really think the tendency of the sage developers to create a lot of parallel, inter-dependent tickets makes reviewing harder and slows down the process. A more linear approach would increase the dev experience and velocity in my opinion.

Anyway, I'm happy that this ticket is finally ready to be merged.



---

archive/issue_comments_437054.json:
```json
{
    "body": "Replying to [comment:325 gh-tobiasdiez]:\n> it was already clear that the workflow works in principle\n\nThe project generally uses a standard for tickets higher than that.\nYes, there's a tradeoff between velocity and stability.",
    "created_at": "2022-03-18T22:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437054",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:325 gh-tobiasdiez]:
> it was already clear that the workflow works in principle

The project generally uses a standard for tickets higher than that.
Yes, there's a tradeoff between velocity and stability.



---

archive/issue_comments_437055.json:
```json
{
    "body": "Is there a ticket for the remaining failures after this ticket?",
    "created_at": "2022-03-21T07:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437055",
    "user": "https://github.com/isuruf"
}
```

Is there a ticket for the remaining failures after this ticket?



---

archive/issue_comments_437056.json:
```json
{
    "body": "Yes, they are collected in #33331.",
    "created_at": "2022-03-21T10:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437056",
    "user": "https://github.com/tobiasdiez"
}
```

Yes, they are collected in #33331.



---

archive/issue_comments_437057.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-27T15:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30608#issuecomment-437057",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
