# Issue 18238: Use LattE exit codes in Polyhedron_ZZ::ehrhart_polynomial

Issue created by migration from https://trac.sagemath.org/ticket/18475

Original creator: mkoeppe

Original creation time: 2015-05-22 17:45:46

CC:  chapoton bedutra vbraun ncohen vdelecroix dimpase

Keywords: latte

As I promised in the discussion of #18211,
we have made a new release of LattE, which gives an nonzero exit code on errors (this was a regression).
The spkg has been upgraded in #18458.
I suppose the code of sage.geometry.polyhedron.Polyhedron_ZZ::ehrhart_polynomial which worked around this could now be cleaned up.



---

Comment by mkoeppe created at 2015-06-09 06:25:32

Above commit is a quick fix for #18558 "LattE's doctest failures".
----
New commits:


---

Comment by mkoeppe created at 2015-06-09 06:26:47

Changing type from task to defect.


---

Comment by ncohen created at 2015-06-09 07:19:59

needs review ?


---

Comment by mkoeppe created at 2015-06-09 07:31:30

No, it needs work.

You guys wanted to use LattE's exit codes somehow for more robust error handling.


---

Comment by vdelecroix created at 2015-06-09 07:35:02

Yep. Do you want me to do it?


---

Comment by mkoeppe created at 2015-06-09 07:38:51

Replying to [comment:6 vdelecroix]:
> Yep. Do you want me to do it?

That would be good.


---

Comment by vdelecroix created at 2015-06-09 07:40:17

I will push a commit above yours in a minute.

Vincent


---

Comment by vdelecroix created at 2015-06-09 07:52:33

New commits:


---

Comment by vdelecroix created at 2015-06-09 07:52:33

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2015-06-12 18:03:35

Doctest seems to fail for me:


```
d241:~/s/sage/sage-develop/src/sage/geometry/polyhedron (t/18475/public/18475)$ sage -t --optional=sage,latte_int base_ZZ.py 
too few successful tests, not using stored timings
Running doctests with ID 2015-06-12-11-02-17-2cf0bb19.
Git branch: t/18475/public/18475
Doctesting 1 file.
sage -t base_ZZ.py
**********************************************************************
File "base_ZZ.py", line 256, in sage.geometry.polyhedron.base_ZZ.Polyhedron_ZZ.?
Failed example:
    P.ehrhart_polynomial(bim_bam_boum=19)   # optional - latte_int
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Latte returned 1 when running:
    count --ehrhart-polynomial --redundancy-check=none --bim-bam-boum=19 --cdd ...
    (see output above)
Got:
    This is LattE integrale 1.7.3
    Available from http://www.math.ucdavis.edu/~latte/
    <BLANKLINE>
    Invocation: count --ehrhart-polynomial '--redundancy-check=none' '--bim-bam-boum=19' --cdd /Users/mkoeppe/.sage/temp/egret-2.local/29272/tmp_6aD5dX.ine 
    Unknown command/option --bim-bam-boum=19
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base_ZZ.Polyhedron_ZZ.?[25]>", line 1, in <module>
        P.ehrhart_polynomial(bim_bam_boum=Integer(19))   # optional - latte_int
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base_ZZ.py", line 325, in ehrhart_polynomial
        raise RuntimeError("Something went wrong (see output above) when running:\n{}".format(' '.join(args)))
    RuntimeError: Something went wrong (see output above) when running:
    count --ehrhart-polynomial --redundancy-check=none --bim-bam-boum=19 --cdd /Users/mkoeppe/.sage/temp/egret-2.local/29272/tmp_6aD5dX.ine
**********************************************************************
1 item had failures:
   1 of  27 in sage.geometry.polyhedron.base_ZZ.Polyhedron_ZZ.?
    [67 tests, 1 failure, 1.17 s]
----------------------------------------------------------------------

```



---

Comment by vdelecroix created at 2015-06-12 20:38:32

Did you run `sage -b`?? The error message "Something went wrong (see output above) when running:" is not even here anymore.


---

Comment by mkoeppe created at 2015-06-12 20:56:19

Sorry for the noise!

Works for me now. Thanks!


---

Comment by vdelecroix created at 2015-06-12 20:57:26

Replying to [comment:12 mkoeppe]:
> Sorry for the noise!

No problem.

> Works for me now.

Cool!


---

Comment by dimpase created at 2015-06-20 09:36:05

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2015-06-20 09:36:05

looks good.


---

Comment by vbraun created at 2015-06-21 09:11:32

Resolution: fixed
