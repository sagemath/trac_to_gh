# Issue 21535: 7.4 binaries SIGILL

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2016-10-27 12:00:02

As reported by Samuel Neves here: https://groups.google.com/d/msg/sage-support/2aaCWqPY65g/FBDGEOf5FQAJ


```
$ find . -name *.so | xargs objdump -d -M intel | egrep -e 'shrx|file format'
...
./local/lib/python2.7/site-packages/sage/libs/singular/polynomial.so:     file format elf64-x86-64
    435d:       c4 e2 fb f7 c9          shrx   rcx,rcx,rax
    4390:       c4 e2 ab f7 c9          shrx   rcx,rcx,r10
```

SHRX is a BMI2 instruction, only available in Intel Haswell and later processors. This makes Sage crash on startup on previous models. Looking at ./src/build/cythonized/sage/libs/singular/polynomial.cpp we see that the build system picked up the host's instruction sets:

```
        "extra_compile_args": [
            "-fPIC",
            "-mmmx",
            "-mpopcnt",
            "-msse",
            "-msse2",
            "-msse3",
            "-msse4.1",
            "-msse4.2",
            "-mavx",
            "-mavx2",
            "-mfma",
            "-mbmi",
            "-mbmi2",
            "-mfpmath=sse",
            "-fabi-version=6",
            "-I/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/include",
            "-I/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local//include",
            "-I/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/include",
            "-fno-strict-aliasing"
        ],
```



---

Comment by jdemeyer created at 2016-10-27 19:32:49

Changing priority from major to blocker.


---

Comment by dimpase created at 2016-11-08 21:11:35

A workaround would be to build on something really old, like a Core2Duo machine.
Let me update Xcode and try...


---

Comment by kcrisman created at 2016-11-09 17:39:12

I apologize that I can't help with that kind of testing any more - they took away my old Mac and of course my _really_ old Mac is not useful for this any more :)


---

Comment by jdemeyer created at 2016-11-10 14:54:45

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-11-10 14:54:45

New commits:


---

Comment by vbraun created at 2016-11-22 22:07:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-24 23:41:22

Resolution: fixed
