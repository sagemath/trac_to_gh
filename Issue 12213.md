# Issue 12213: Questionable semantics of Graph().all_simple_paths

archive/issues_012213.json:
```json
{
    "body": "Assignee: @kini\n\nCC:  @nathanncohen abmasse\n\nKeywords: graphs all_simple_paths\n\nSee [this sage-support thread](https://groups.google.com/d/topic/sage-support/zVmqCIv82zI/discussion).\n\nThe docstring of `Graph().all_simple_paths` starts with this paragraph:\n\n\n```\n       Returns a list of all the simple paths of self starting with one of\n       the given vertices. A path is simple if no vertex occurs twice in\n       it except possibly the starting and ending one. The paths are\n       enumerated in increasing length order.\n```\n\n\nIn short, the `Graph().all_simple_paths` function deems paths of the form `[a, b, c, b]` to be simple. This is not true according to the generally accepted definition of a simple path. I suspect the intent of the author was to allow paths of the form `[b, c, b]` (i.e. paths which are actually cycles), which seems reasonable.\n\nAnother possibility would be to use the definition found on Wikipedia, namely that a simple path must not have *any* repeated vertices, and that a \"simple cycle\" is a path whose first vertex is its last vertex but has no other vertex repetitions. In this case the function should exclude both paths of the form `[a, b, c, b]` and paths of the form `[b, c, b]`. But I don't see that this is very useful. The function allows you to specify sets of starting and ending points for the paths you want returned, and if you specify non-disjoint sets, you are likely asking for cycles to be included.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12385\n\n",
    "created_at": "2012-01-30T04:10:13Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Questionable semantics of Graph().all_simple_paths",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12213",
    "user": "https://github.com/kini"
}
```
Assignee: @kini

CC:  @nathanncohen abmasse

Keywords: graphs all_simple_paths

See [this sage-support thread](https://groups.google.com/d/topic/sage-support/zVmqCIv82zI/discussion).

The docstring of `Graph().all_simple_paths` starts with this paragraph:


```
       Returns a list of all the simple paths of self starting with one of
       the given vertices. A path is simple if no vertex occurs twice in
       it except possibly the starting and ending one. The paths are
       enumerated in increasing length order.
```


In short, the `Graph().all_simple_paths` function deems paths of the form `[a, b, c, b]` to be simple. This is not true according to the generally accepted definition of a simple path. I suspect the intent of the author was to allow paths of the form `[b, c, b]` (i.e. paths which are actually cycles), which seems reasonable.

Another possibility would be to use the definition found on Wikipedia, namely that a simple path must not have *any* repeated vertices, and that a "simple cycle" is a path whose first vertex is its last vertex but has no other vertex repetitions. In this case the function should exclude both paths of the form `[a, b, c, b]` and paths of the form `[b, c, b]`. But I don't see that this is very useful. The function allows you to specify sets of starting and ending points for the paths you want returned, and if you specify non-disjoint sets, you are likely asking for cycles to be included.

Issue created by migration from https://trac.sagemath.org/ticket/12385





---

archive/issue_comments_142432.json:
```json
{
    "body": "Here's a patch which implements the first suggestion in the ticket description. The original ticket seems to be #8273 so I'm CCing the author and reviewer of that ticket.\n\nDoing a `make ptestlong` on this patch now, though the file in question passes and `search_src()` tells me this function is not used by any other code, so I don't expect any doctest problems.",
    "created_at": "2012-01-30T04:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142432",
    "user": "https://github.com/kini"
}
```

Here's a patch which implements the first suggestion in the ticket description. The original ticket seems to be #8273 so I'm CCing the author and reviewer of that ticket.

Doing a `make ptestlong` on this patch now, though the file in question passes and `search_src()` tells me this function is not used by any other code, so I don't expect any doctest problems.



---

archive/issue_comments_142433.json:
```json
{
    "body": "apply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-30T04:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142433",
    "user": "https://github.com/kini"
}
```

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_142434.json:
```json
{
    "body": "Changing keywords from \"graphs all_simple_paths\" to \"digraphs graphs all_simple_paths\".",
    "created_at": "2012-01-30T04:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142434",
    "user": "https://github.com/kini"
}
```

Changing keywords from "graphs all_simple_paths" to "digraphs graphs all_simple_paths".



---

archive/issue_comments_142435.json:
```json
{
    "body": "Attachment [trac_12385-all-simple-paths.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.patch) by @kini created at 2012-01-30 04:24:02\n\nWhoops, sorry, this is a digraph method, not a graph method. I mistitled the ticket.",
    "created_at": "2012-01-30T04:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142435",
    "user": "https://github.com/kini"
}
```

Attachment [trac_12385-all-simple-paths.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.patch) by @kini created at 2012-01-30 04:24:02

Whoops, sorry, this is a digraph method, not a graph method. I mistitled the ticket.



---

archive/issue_comments_142436.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-30T05:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142436",
    "user": "https://github.com/kini"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142437.json:
```json
{
    "body": "`make ptestlong` passes. Comments?",
    "created_at": "2012-01-30T05:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142437",
    "user": "https://github.com/kini"
}
```

`make ptestlong` passes. Comments?



---

archive/issue_comments_142438.json:
```json
{
    "body": "First that what you are doing is totally right, then that I will try to review the ticket today `:-)`\n\nNathann",
    "created_at": "2012-01-30T10:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142438",
    "user": "https://github.com/nathanncohen"
}
```

First that what you are doing is totally right, then that I will try to review the ticket today `:-)`

Nathann



---

archive/issue_comments_142439.json:
```json
{
    "body": "Hellooooo !!!\n\nHmmm... I was a bit worried at your path.count(path[-1]) `^^;`\n\nWhat do you think of the alternative version I attach ? In this one I check whether the path is a cycle *before* adding it to the queue. This way a \"neighbor in path\" is sufficient.\n\nI also do not understand why you removed the \"if trivial\" from before the loop to put it inside. It would be a waste to \"test\" trivial at each loop, and also to test len(path) > 1 when we know it will always be true after some step, wouldn't it ?\n\nTell me what you think `:-)`\n\nNathann",
    "created_at": "2012-01-30T12:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142439",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooo !!!

Hmmm... I was a bit worried at your path.count(path[-1]) `^^;`

What do you think of the alternative version I attach ? In this one I check whether the path is a cycle *before* adding it to the queue. This way a "neighbor in path" is sufficient.

I also do not understand why you removed the "if trivial" from before the loop to put it inside. It would be a waste to "test" trivial at each loop, and also to test len(path) > 1 when we know it will always be true after some step, wouldn't it ?

Tell me what you think `:-)`

Nathann



---

archive/issue_comments_142440.json:
```json
{
    "body": "Attachment [trac_12385_review.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385_review.patch) by @nathanncohen created at 2012-01-30 12:14:52",
    "created_at": "2012-01-30T12:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142440",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_12385_review.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385_review.patch) by @nathanncohen created at 2012-01-30 12:14:52



---

archive/issue_comments_142441.json:
```json
{
    "body": "Hi, Keshav and Nathann,\n\nThank you, Keshav, for finding that bug, I'm sorry we missed it the first time.\n\nSince Nathann has already started the review, I'll let him finish it (I don't even have the last Sage version installed on my computer).\n\nBy the way, the title \"Questionable semantics of DiGraph().all_simple_paths\" could be replaced by \"Wrong semantics of DiGraph().all_simple_paths\" :-)\n\nAlexandre",
    "created_at": "2012-01-30T13:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142441",
    "user": "https://trac.sagemath.org/admin/accounts/users/abmasse"
}
```

Hi, Keshav and Nathann,

Thank you, Keshav, for finding that bug, I'm sorry we missed it the first time.

Since Nathann has already started the review, I'll let him finish it (I don't even have the last Sage version installed on my computer).

By the way, the title "Questionable semantics of DiGraph().all_simple_paths" could be replaced by "Wrong semantics of DiGraph().all_simple_paths" :-)

Alexandre



---

archive/issue_comments_142442.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> Hmmm... I was a bit worried at your path.count(path[-1]) `^^;`\n\nCan you explain? I think the same expression was used in the old code.\n\n> What do you think of the alternative version I attach ? In this one I check whether the path is a cycle *before* adding it to the queue. This way a \"neighbor in path\" is sufficient.\n\nNice! It's definitely better. I don't know why I avoided touching that last loop. Of course that is the better place to do this logic.\n\n> I also do not understand why you removed the \"if trivial\" from before the loop to put it inside. It would be a waste to \"test\" trivial at each loop, and also to test len(path) > 1 when we know it will always be true after some step, wouldn't it ?\n\nWell, part of it was a mistake - I meant to put the check for `trivial` after the check for `len(path)`. Because of the lazy evaluation of boolean operators in Python (`a and b` skips checking `b` if `a` is false, etc.), this would still make `trivial` be evaluated only once, and would reduce the number of `yield` statements in the code, making it \"easier to read\", theoretically. Also I made it so that `len(path)` would only be checked for each path with a desired endpoint, not every single path.\n\nBut you're right, it's possible to make this better by moving the condition check in the `while` loop to somewhere in the middle of the body rather than at the top. Patch attached! (Or will be after I post this comment.) I made some other changes too, such as inverting the loop and if/else in your code to check `simple` on every good incomplete path rather than every candidate extension. It would be best if `simple` and `trivial` could be declared as constant so that Python could optimize away all these checks. Or maybe it already knows this, since we don't assign any values to those variables... how smart is Python, anyway? I think I am getting stuck in the premature optimization trap... :P",
    "created_at": "2012-01-31T05:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142442",
    "user": "https://github.com/kini"
}
```

Replying to [comment:5 ncohen]:
> Hmmm... I was a bit worried at your path.count(path[-1]) `^^;`

Can you explain? I think the same expression was used in the old code.

> What do you think of the alternative version I attach ? In this one I check whether the path is a cycle *before* adding it to the queue. This way a "neighbor in path" is sufficient.

Nice! It's definitely better. I don't know why I avoided touching that last loop. Of course that is the better place to do this logic.

> I also do not understand why you removed the "if trivial" from before the loop to put it inside. It would be a waste to "test" trivial at each loop, and also to test len(path) > 1 when we know it will always be true after some step, wouldn't it ?

Well, part of it was a mistake - I meant to put the check for `trivial` after the check for `len(path)`. Because of the lazy evaluation of boolean operators in Python (`a and b` skips checking `b` if `a` is false, etc.), this would still make `trivial` be evaluated only once, and would reduce the number of `yield` statements in the code, making it "easier to read", theoretically. Also I made it so that `len(path)` would only be checked for each path with a desired endpoint, not every single path.

But you're right, it's possible to make this better by moving the condition check in the `while` loop to somewhere in the middle of the body rather than at the top. Patch attached! (Or will be after I post this comment.) I made some other changes too, such as inverting the loop and if/else in your code to check `simple` on every good incomplete path rather than every candidate extension. It would be best if `simple` and `trivial` could be declared as constant so that Python could optimize away all these checks. Or maybe it already knows this, since we don't assign any values to those variables... how smart is Python, anyway? I think I am getting stuck in the premature optimization trap... :P



---

archive/issue_comments_142443.json:
```json
{
    "body": "Attachment [trac_12385-all-simple-paths.2.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.2.patch) by @kini created at 2012-01-31 05:04:02\n\napply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-31T05:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142443",
    "user": "https://github.com/kini"
}
```

Attachment [trac_12385-all-simple-paths.2.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.2.patch) by @kini created at 2012-01-31 05:04:02

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_142444.json:
```json
{
    "body": "Attachment [trac_12385_review.2.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385_review.2.patch) by @kini created at 2012-01-31 05:08:00\n\napply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-31T05:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142444",
    "user": "https://github.com/kini"
}
```

Attachment [trac_12385_review.2.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385_review.2.patch) by @kini created at 2012-01-31 05:08:00

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_142445.json:
```json
{
    "body": "Your commit message was weird so I fixed it :)",
    "created_at": "2012-01-31T05:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142445",
    "user": "https://github.com/kini"
}
```

Your commit message was weird so I fixed it :)



---

archive/issue_comments_142446.json:
```json
{
    "body": "BTW, thanks Alexandre for writing the code in the first place :)",
    "created_at": "2012-01-31T06:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142446",
    "user": "https://github.com/kini"
}
```

BTW, thanks Alexandre for writing the code in the first place :)



---

archive/issue_comments_142447.json:
```json
{
    "body": "Here's a documentation patch which changes the stated definition of simple paths as well (to the one I added to the description). I also took the opportunity to enforce PEP 8 in the functions I touched, with the exception of doctest input lines (because of #10458 which I really need to get back to one of these days...). Patch below!",
    "created_at": "2012-01-31T12:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142447",
    "user": "https://github.com/kini"
}
```

Here's a documentation patch which changes the stated definition of simple paths as well (to the one I added to the description). I also took the opportunity to enforce PEP 8 in the functions I touched, with the exception of doctest input lines (because of #10458 which I really need to get back to one of these days...). Patch below!



---

archive/issue_comments_142448.json:
```json
{
    "body": "Attachment [trac_12385-all-simple-paths.3.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.3.patch) by @kini created at 2012-01-31 13:00:04\n\napply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-31T13:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142448",
    "user": "https://github.com/kini"
}
```

Attachment [trac_12385-all-simple-paths.3.patch](tarball://root/attachments/some-uuid/ticket12385/trac_12385-all-simple-paths.3.patch) by @kini created at 2012-01-31 13:00:04

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_142449.json:
```json
{
    "body": "Weird loop, but it works `:-)`\n\nIf you are are also ok with it, you can set the ticket to \"positive_review\" !\n\nNathann",
    "created_at": "2012-01-31T18:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142449",
    "user": "https://github.com/nathanncohen"
}
```

Weird loop, but it works `:-)`

If you are are also ok with it, you can set the ticket to "positive_review" !

Nathann



---

archive/issue_comments_142450.json:
```json
{
    "body": "I wrote it, so I guess I'm OK with it :) Thanks!",
    "created_at": "2012-01-31T18:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142450",
    "user": "https://github.com/kini"
}
```

I wrote it, so I guess I'm OK with it :) Thanks!



---

archive/issue_comments_142451.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-31T18:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142451",
    "user": "https://github.com/kini"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142452.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12213#issuecomment-142452",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_012224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:22:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12213#event-12224"
}
```
