# Issue 23548: Fix sagelib setup.py install issues on Python 3

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2017-09-05 13:19:47

CC:  chapoton

This fixes a few issues, particularly with `clean_stale_files` on Python 3.  In particular, it prevents deletion of valid extension module and Python bytecode files, by better handling of `__pycache__` and the more complex filename extensions used in Python 3.


---

Comment by git created at 2017-09-05 13:20:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-09-05 14:23:45

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-09-06 06:12:14

This does not seem to work..


---

Comment by embray created at 2017-09-06 09:24:13

Replying to [comment:3 chapoton]:
> This does not seem to work..

Okay--I appreciate you testing it but this is not the most helpful comment...  It works for me.  How does it not work for you?


---

Comment by chapoton created at 2017-09-06 09:29:25

see patchbot reports, sorry


---

Comment by embray created at 2017-09-06 09:38:49

Ah, oops, thanks!  Sorry I misunderstood you.


---

Comment by chapoton created at 2017-09-06 19:24:09

patchbot says

```
[sagelib-8.1.beta4] Traceback (most recent call last):
[sagelib-8.1.beta4]   File "setup.py", line 843, in <module>
[sagelib-8.1.beta4]     SAGE_SRC, ['sage', 'sage_setup'])
[sagelib-8.1.beta4]   File "/home/kevin/sage-patchbot/src/sage_setup/find.py", line 61, in find_python_sources
[sagelib-8.1.beta4]     INIT_FILE = '__init__' + PYMOD_EXT
[sagelib-8.1.beta4] TypeError: cannot concatenate 'str' and 'int' objects
```



---

Comment by git created at 2017-09-07 11:09:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-09-07 17:36:21

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-09-07 17:36:21

ok, looks good enough. And bot is green.


---

Comment by vbraun created at 2017-09-11 13:47:05

Resolution: fixed
