# Issue 21466: Interface PARI precision in bits

archive/issues_021466.json:
```json
{
    "body": "CC:  defeo\n\nPARI now stores its precision internally in bits (as opposed to decimal). This ticket adds an interface for the PARI precision in bits. It also removes the `PariInstance._real_precision` attribute.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21703\n\n",
    "created_at": "2016-10-14T11:30:04Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "title": "Interface PARI precision in bits",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21466",
    "user": "jdemeyer"
}
```
CC:  defeo

PARI now stores its precision internally in bits (as opposed to decimal). This ticket adds an interface for the PARI precision in bits. It also removes the `PariInstance._real_precision` attribute.

Issue created by migration from https://trac.sagemath.org/ticket/21703





---

archive/issue_comments_298002.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-14T14:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298002",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298003.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-14T14:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298003",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_298004.json:
```json
{
    "body": "Very interesting, I learned a lot on real precision in PARI.\n\nI'm good with it, but wouldn't the \"guide\" be best put in `__init__`, so that it would be read by anyone who types `pari?`?",
    "created_at": "2016-10-19T09:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298004",
    "user": "defeo"
}
```

Very interesting, I learned a lot on real precision in PARI.

I'm good with it, but wouldn't the "guide" be best put in `__init__`, so that it would be read by anyone who types `pari?`?



---

archive/issue_comments_298005.json:
```json
{
    "body": "Or maybe in `__init__.py`, so that `sage.libs.pari?` shows it.",
    "created_at": "2016-10-19T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298005",
    "user": "defeo"
}
```

Or maybe in `__init__.py`, so that `sage.libs.pari?` shows it.



---

archive/issue_comments_298006.json:
```json
{
    "body": "`set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?",
    "created_at": "2016-10-19T11:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298006",
    "user": "defeo"
}
```

`set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?



---

archive/issue_comments_298007.json:
```json
{
    "body": "Replying to [comment:6 defeo]:\n> `set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?\n\nI decided to not return the old value in `set_real_precision_bits()` because the PARI call does not return it either. If users really want the old value, they can still call `get_real_precision_bits()`.\n\nI did not change `set_real_precision()` because we cannot do that without a deprecation.",
    "created_at": "2016-10-19T11:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298007",
    "user": "jdemeyer"
}
```

Replying to [comment:6 defeo]:
> `set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?

I decided to not return the old value in `set_real_precision_bits()` because the PARI call does not return it either. If users really want the old value, they can still call `get_real_precision_bits()`.

I did not change `set_real_precision()` because we cannot do that without a deprecation.



---

archive/issue_comments_298008.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Replying to [comment:6 defeo]:\n> > `set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?\n> \n> I decided to not return the old value in `set_real_precision_bits()` because the PARI call does not return it either. If users really want the old value, they can still call `get_real_precision_bits()`.\n> \n> I did not change `set_real_precision()` because we cannot do that without a deprecation.\n\nThat was my guess. Let's put the deprecation, then?",
    "created_at": "2016-10-19T12:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298008",
    "user": "defeo"
}
```

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 defeo]:
> > `set_real_precision()` returns the old precision. `set_real_precision_bits()` doesn't return anything. Couldn't we be more consistent here?
> 
> I decided to not return the old value in `set_real_precision_bits()` because the PARI call does not return it either. If users really want the old value, they can still call `get_real_precision_bits()`.
> 
> I did not change `set_real_precision()` because we cannot do that without a deprecation.

That was my guess. Let's put the deprecation, then?



---

archive/issue_comments_298009.json:
```json
{
    "body": "Replying to [comment:8 defeo]:\n> That was my guess. Let's put the deprecation, then?\n\nPersonally, I wouldn't bother. I don't see the harm in keeping both functions (with a slightly different interface).",
    "created_at": "2016-10-19T12:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298009",
    "user": "jdemeyer"
}
```

Replying to [comment:8 defeo]:
> That was my guess. Let's put the deprecation, then?

Personally, I wouldn't bother. I don't see the harm in keeping both functions (with a slightly different interface).



---

archive/issue_comments_298010.json:
```json
{
    "body": "Sure, that's no big deal.\n\nWhat about the docstrings?",
    "created_at": "2016-10-19T12:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298010",
    "user": "defeo"
}
```

Sure, that's no big deal.

What about the docstrings?



---

archive/issue_comments_298011.json:
```json
{
    "body": "Replying to [comment:10 defeo]:\n> What about the docstrings?\n\nI have to try to see what works. Ideally, I want the documentation easily findable both from the command line as well as when browsing the reference manual.",
    "created_at": "2016-10-19T12:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298011",
    "user": "jdemeyer"
}
```

Replying to [comment:10 defeo]:
> What about the docstrings?

I have to try to see what works. Ideally, I want the documentation easily findable both from the command line as well as when browsing the reference manual.



---

archive/issue_comments_298012.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-19T14:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298012",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298013.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-21T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298013",
    "user": "defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298014.json:
```json
{
    "body": "Ok, these fixes to the docs work *a minima*. If needed, we'll have time to rethink the organization of the docs when we externalize.",
    "created_at": "2016-10-21T09:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298014",
    "user": "defeo"
}
```

Ok, these fixes to the docs work *a minima*. If needed, we'll have time to rethink the organization of the docs when we externalize.



---

archive/issue_comments_298015.json:
```json
{
    "body": "Weird, the startup modules plugin is failing. Presumably not related to this?",
    "created_at": "2016-10-21T09:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298015",
    "user": "defeo"
}
```

Weird, the startup modules plugin is failing. Presumably not related to this?



---

archive/issue_comments_298016.json:
```json
{
    "body": "The startup modules \"failure\" is from #20241.",
    "created_at": "2016-10-21T09:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298016",
    "user": "jdemeyer"
}
```

The startup modules "failure" is from #20241.



---

archive/issue_comments_298017.json:
```json
{
    "body": "On 32 bit \n\n```\n4014sage -t --long src/sage/libs/pari/pari_instance.pyx\n4015**********************************************************************\n4016File \"src/sage/libs/pari/pari_instance.pyx\", line 185, in sage.libs.pari.pari_instance\n4017Failed example:\n4018    pari(1).sin(precision=150).sage()\n4019Expected:\n4020    0.841470984807896506652502321630298999622563060798371065673\n4021Got:\n4022    0.84147098480789650665250232163029899962256306080\n4023**********************************************************************\n4024File \"src/sage/libs/pari/pari_instance.pyx\", line 187, in sage.libs.pari.pari_instance\n4025Failed example:\n4026    pari(1).sin(precision=20).sage()\n4027Expected:\n4028    0.841470984807896507\n4029Got:\n4030    0.841470985\n4031**********************************************************************\n40321 item had failures:\n4033   2 of  55 in sage.libs.pari.pari_instance\n4034    [164 tests, 2 failures, 0.33 s]\n```\n",
    "created_at": "2016-10-31T02:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298017",
    "user": "vbraun"
}
```

On 32 bit 

```
4014sage -t --long src/sage/libs/pari/pari_instance.pyx
4015**********************************************************************
4016File "src/sage/libs/pari/pari_instance.pyx", line 185, in sage.libs.pari.pari_instance
4017Failed example:
4018    pari(1).sin(precision=150).sage()
4019Expected:
4020    0.841470984807896506652502321630298999622563060798371065673
4021Got:
4022    0.84147098480789650665250232163029899962256306080
4023**********************************************************************
4024File "src/sage/libs/pari/pari_instance.pyx", line 187, in sage.libs.pari.pari_instance
4025Failed example:
4026    pari(1).sin(precision=20).sage()
4027Expected:
4028    0.841470984807896507
4029Got:
4030    0.841470985
4031**********************************************************************
40321 item had failures:
4033   2 of  55 in sage.libs.pari.pari_instance
4034    [164 tests, 2 failures, 0.33 s]
```




---

archive/issue_comments_298018.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-31T02:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298018",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_298019.json:
```json
{
    "body": "Right, we should only pick precisions which are between 33 and 64 mod 64.",
    "created_at": "2016-10-31T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298019",
    "user": "jdemeyer"
}
```

Right, we should only pick precisions which are between 33 and 64 mod 64.



---

archive/issue_comments_298020.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-02T11:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298020",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298021.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-02T11:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298021",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298022.json:
```json
{
    "body": "Wouldn't it be simpler and clearer to replace 180\u2192192 and 40\u219264?",
    "created_at": "2016-11-02T13:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298022",
    "user": "defeo"
}
```

Wouldn't it be simpler and clearer to replace 180→192 and 40→64?



---

archive/issue_comments_298023.json:
```json
{
    "body": "Replying to [comment:20 defeo]:\n> Wouldn't it be simpler and clearer to replace 180\u2192192 and 40\u219264?\n\nThat would defeat the whole point of that explanation. I want to explain that precision in PARI is not the same as precision in Sage.",
    "created_at": "2016-11-02T14:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298023",
    "user": "jdemeyer"
}
```

Replying to [comment:20 defeo]:
> Wouldn't it be simpler and clearer to replace 180→192 and 40→64?

That would defeat the whole point of that explanation. I want to explain that precision in PARI is not the same as precision in Sage.



---

archive/issue_comments_298024.json:
```json
{
    "body": "> That would defeat the whole point of that explanation. I want to explain that precision in PARI is not the same as precision in Sage.\n\nThat was my guess, but I think in this case the docstring misses the point: unless he counts the digits by hand, the user won't realize that the output is printed with 192 bits of precision instead of 180. Maybe adding a `parent(_)` to the docstring would help clarify? Something like this:\n\n\n```\nsage: pari(1).sin(precision=180).sage()\n0.841470984807896506652502321630298999622563060798371065673\nsage: x = pari(1).sin(precision=180)\nsage: x\n0.841470984807897\nsage: x.bitprecision()\n192\nsage: x.sage()\n0.841470984807896506652502321630298999622563060798371065673\nsage: parent(_)\nReal Field with 192 bits of precision\n```\n\n\nAnd maybe line 169 should print with 180 bits, to highlight the difference.\n\nAlso, in lines 182-183, when you write \"real precision\", there is confusion btw real as in reality and real as in real number (frankly, after re-reading for the 10th time that sentence, I'm not sure I understand it).",
    "created_at": "2016-11-02T14:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298024",
    "user": "defeo"
}
```

> That would defeat the whole point of that explanation. I want to explain that precision in PARI is not the same as precision in Sage.

That was my guess, but I think in this case the docstring misses the point: unless he counts the digits by hand, the user won't realize that the output is printed with 192 bits of precision instead of 180. Maybe adding a `parent(_)` to the docstring would help clarify? Something like this:


```
sage: pari(1).sin(precision=180).sage()
0.841470984807896506652502321630298999622563060798371065673
sage: x = pari(1).sin(precision=180)
sage: x
0.841470984807897
sage: x.bitprecision()
192
sage: x.sage()
0.841470984807896506652502321630298999622563060798371065673
sage: parent(_)
Real Field with 192 bits of precision
```


And maybe line 169 should print with 180 bits, to highlight the difference.

Also, in lines 182-183, when you write "real precision", there is confusion btw real as in reality and real as in real number (frankly, after re-reading for the 10th time that sentence, I'm not sure I understand it).



---

archive/issue_comments_298025.json:
```json
{
    "body": "Continuing the previous example, I'm confused by this:\n\n\n```\nsage: x = pari(1).sin(precision=180)\nsage: x.precision()\n5\n```\n\n\nwhat's the unit used by PARI?",
    "created_at": "2016-11-02T14:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298025",
    "user": "defeo"
}
```

Continuing the previous example, I'm confused by this:


```
sage: x = pari(1).sin(precision=180)
sage: x.precision()
5
```


what's the unit used by PARI?



---

archive/issue_comments_298026.json:
```json
{
    "body": "Replying to [comment:22 defeo]:\n> Also, in lines 182-183, when you write \"real precision\", there is confusion btw real as in reality and real as in real number (frankly, after re-reading for the 10th time that sentence, I'm not sure I understand it).\n\nPARI uses the term \"real precision\" to mean precision of real numbers. I use it the same way.",
    "created_at": "2016-11-02T18:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298026",
    "user": "jdemeyer"
}
```

Replying to [comment:22 defeo]:
> Also, in lines 182-183, when you write "real precision", there is confusion btw real as in reality and real as in real number (frankly, after re-reading for the 10th time that sentence, I'm not sure I understand it).

PARI uses the term "real precision" to mean precision of real numbers. I use it the same way.



---

archive/issue_comments_298027.json:
```json
{
    "body": "Replying to [comment:23 defeo]:\n> Continuing the previous example, I'm confused by this:\n> \n> {{{\n> sage: x = pari(1).sin(precision=180)\n> sage: x.precision()\n> 5\n> }}}\n> \n> what's the unit used by PARI?\n\nIn this case, words (i.e. units of 32 or 64 bits)",
    "created_at": "2016-11-02T18:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298027",
    "user": "jdemeyer"
}
```

Replying to [comment:23 defeo]:
> Continuing the previous example, I'm confused by this:
> 
> {{{
> sage: x = pari(1).sin(precision=180)
> sage: x.precision()
> 5
> }}}
> 
> what's the unit used by PARI?

In this case, words (i.e. units of 32 or 64 bits)



---

archive/issue_comments_298028.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-02T20:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298028",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298029.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> Replying to [comment:23 defeo]:\n> > Continuing the previous example, I'm confused by this:\n> > \n> > {{{\n> > sage: x = pari(1).sin(precision=180)\n> > sage: x.precision()\n> > 5\n> > }}}\n> > \n> > what's the unit used by PARI?\n> \n> In this case, words (i.e. units of 32 or 64 bits)\n\n?? 5*32=160. How does that fit with 192 bits of precision?",
    "created_at": "2016-11-03T00:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298029",
    "user": "defeo"
}
```

Replying to [comment:25 jdemeyer]:
> Replying to [comment:23 defeo]:
> > Continuing the previous example, I'm confused by this:
> > 
> > {{{
> > sage: x = pari(1).sin(precision=180)
> > sage: x.precision()
> > 5
> > }}}
> > 
> > what's the unit used by PARI?
> 
> In this case, words (i.e. units of 32 or 64 bits)

?? 5*32=160. How does that fit with 192 bits of precision?



---

archive/issue_comments_298030.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-03T00:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298030",
    "user": "defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298031.json:
```json
{
    "body": "Replying to [comment:28 defeo]:\n> ?? 5*32=160. How does that fit with 192 bits of precision?\n\nIt's actually `(5 - 2) * 64 = 192`:\n\n\n```\nsage: from sage.libs.pari.pari_instance import prec_words_to_bits\n....: prec_words_to_bits(5)\n192\n```\n",
    "created_at": "2016-11-03T07:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298031",
    "user": "jdemeyer"
}
```

Replying to [comment:28 defeo]:
> ?? 5*32=160. How does that fit with 192 bits of precision?

It's actually `(5 - 2) * 64 = 192`:


```
sage: from sage.libs.pari.pari_instance import prec_words_to_bits
....: prec_words_to_bits(5)
192
```




---

archive/issue_comments_298032.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-08T23:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21466#issuecomment-298032",
    "user": "vbraun"
}
```

Resolution: fixed
