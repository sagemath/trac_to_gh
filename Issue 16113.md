# Issue 16113: wrong path to git in sage-env

Issue created by migration from https://trac.sagemath.org/ticket/16350

Original creator: rws

Original creation time: 2014-05-13 16:09:01

CC:  simonking

doctest fails in sagedev caused by wrong path in sage-env


---

Comment by rws created at 2014-05-13 16:19:17

Changing keywords from "" to "environment, git".


---

Comment by jhpalmieri created at 2014-05-13 16:26:43

Please point out where in the git build process `execdir` gets set to `local/lib`.


---

Comment by rws created at 2014-05-13 17:11:57

It probably happens when `autoconf` is run, because the path is hardcoded in the `Makefile`. I can reproduce it with a git-2.0.0 version outside of Sage. This looks like the relevant log, i.e., not a wrong setting, but the failure of an env var being set:

```
config.log:| # If user did not specify libexecdir, set the correct target:
config.log:| # Nor FHS nor openSUSE allow prefix/libexec. Let's default to prefix/lib.
config.log:|
config.log:| if test "$libexecdir" = '${exec_prefix}/libexec' ; then
config.log:|    libexecdir='${exec_prefix}/lib'
```

But since this is official behaviour, Sage should be aware of it.


---

Comment by jhpalmieri created at 2014-05-13 17:52:27

But we don't run autoconf when we build git, do we? I think we just run `configure` and `make`. When I do `sage -f -s git`, I see the same `Makefile` which is in the tarball, which contains

```
gitexecdir = libexec/git-core
```

I also did `grep -R libexec= local/var/tmp/sage/build/git-1.8.4.4/src` and found no instances where `libexec` would be set to `lib`:

```
local/var/tmp/sage/build/git-1.8.4.4/src/config.log:libexecdir='${exec_prefix}/libexec'
local/var/tmp/sage/build/git-1.8.4.4/src/configure:libexecdir='${exec_prefix}/libexec'
local/var/tmp/sage/build/git-1.8.4.4/src/configure:  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
local/var/tmp/sage/build/git-1.8.4.4/src/configure:    libexecdir=$ac_optarg ;;
local/var/tmp/sage/build/git-1.8.4.4/src/configure:  --libexecdir=DIR        program executables [EPREFIX/libexec]
```

I guess my question really is, how can I reproduce your problem? I do not see it on several different platforms.


---

Comment by rws created at 2014-05-14 04:38:40

So, for sanity, any package installing libexecs should set the directory explicitly to `libexec` via the `configure` parameter, I guess (written from tablet, not on my work machine).


---

Comment by jhpalmieri created at 2014-05-14 06:02:09

For what it's worth, I've done `sage -f git` on

```
"a Sun-Blade-2500 running SunOS 5.10"
"a ppc64-Linux-power7 running Suse"
"an x86_64-Linux-core2 running Fedora"
several OS X machines
```

and on all of them, `execdir` gets set to `libexec`, not `lib`. So I'm puzzled. We could set `--libexecdir=...` in the call to `configure` in `spkg-install`, but I don't understand why it should be necessary.


---

Comment by rws created at 2014-05-14 06:10:28

Here on OpenSuSE, `configure` does:

```
## ----------- ##
## Core tests. ##
## ----------- ##

configure:2185: loading site script /usr/share/site/x86_64-unknown-linux-gnu
aible.
```

It depends on what's in `/usr/share/site/x86_64-unknown-linux-gnu`, but it's only changeable by Sage via `configure --libexecdir`.


---

Comment by rws created at 2014-05-14 07:35:05

You could reproduce it by giving those three lines

```
```

in your site-config script.
| if test "$libexecdir" = '${exec_prefix}/libexec' ; then
|       libexecdir='${exec_prefix}/lib'
| fi
Interestingly for example, the ECL package among others installs excutables outside `bin/` too but specifies `lib` as path instead of `libexec`. So it seems both the distributions and the packages have their say in the matter, and git is unfortunate to not commit to `lib`, as it is suggested by the standard.
----
New commits:


---

Comment by rws created at 2014-05-14 07:42:10

Changing status from new to needs_review.


---

Comment by leif created at 2014-05-14 07:56:22

R also installs binaries below `lib/R/`.


---

Comment by rws created at 2014-05-14 07:58:57

Replying to [comment:13 leif]:
> R also installs binaries below `lib/R/`.
Yes, it's just that their configure uses the varname `libdir` instead of `libexecdir`.


---

Comment by leif created at 2014-05-14 08:26:18


```
For better control, use the options below.

Fine tuning of the installation directories:
  --bindir=DIR            user executables [EPREFIX/bin]
  --sbindir=DIR           system admin executables [EPREFIX/sbin]
  --libexecdir=DIR        program executables [EPREFIX/libexec]
  --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
  --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
  --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
  --libdir=DIR            object code libraries [EPREFIX/lib]
  --includedir=DIR        C header files [PREFIX/include]
  --oldincludedir=DIR     C header files for non-gcc [/usr/include]
  --datarootdir=DIR       read-only arch.-independent data root [PREFIX/share]
  --datadir=DIR           read-only architecture-independent data [DATAROOTDIR]
  --infodir=DIR           info documentation [DATAROOTDIR/info]
  --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
  --mandir=DIR            man documentation [DATAROOTDIR/man]
  --docdir=DIR            documentation root [DATAROOTDIR/doc/git]
  --htmldir=DIR           html documentation [DOCDIR]
  --dvidir=DIR            dvi documentation [DOCDIR]
  --pdfdir=DIR            pdf documentation [DOCDIR]
  --psdir=DIR             ps documentation [DOCDIR]
```


I.e., `s/libexec/libexecdir/`.


---

Comment by leif created at 2014-05-14 08:28:08

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-05-14 08:30:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-05-14 08:31:12

Changing status from needs_work to needs_review.


---

Comment by leif created at 2014-05-14 08:46:37

Probably Simon (on OpenSUSE) should give it positive review.


---

Comment by SimonKing created at 2014-05-14 10:32:53

How am I supposed to build? Checking out the ticket branch, and then just "make"? Or is there more to do?


---

Comment by leif created at 2014-05-14 10:35:33

Replying to [comment:21 SimonKing]:
> How am I supposed to build? Checking out the ticket branch, and then just "make"? Or is there more to do?

Pull the branch, do `sage -f git`, then try your favorite git command in a Sage subshell (e.g. `sage --sh -c 'git <foo>'`) I'd say.


---

Comment by leif created at 2014-05-14 10:36:26

Or run the tests in `src/sage/dev/` afterwards.


---

Comment by SimonKing created at 2014-05-14 10:37:16

Yep, it works now! Thank you for the fix.


---

Comment by SimonKing created at 2014-05-14 10:37:16

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2014-05-15 14:48:16

Should we bump the version number to force a rebuild of git?


---

Comment by rws created at 2014-05-15 15:42:23

Indeed, if I touch `spkg-install` then `make`, nothing gets rebuilt. Isn't that a bug? As to version bump, after 1.9.1 or so (we have 1.8.4.4 atm) output of git changes and messes up sagedev doctesting. So, get the newest stable 1.9.3 and include a sagedev doctest fix with this ticket?


---

Comment by jhpalmieri created at 2014-05-15 15:59:09

No, I mean we can just change the file `package-version.txt` so that it says `1.8.4.4.p0`, for example. That should trigger a rebuild.


---

Comment by rws created at 2014-05-15 16:03:45


```
Error building Sage.

The following package(s) may have failed to build:

package: git-1.8.4.4p0
```



---

Comment by rws created at 2014-05-15 16:21:07

Means, short of a new version, I can find no way to force a single rebuild using a patch (well you could install code that deletes itself but...), so I think it best to close this ticket soonest such that the number of people having to do `sage -f git` is small.


---

Comment by jhpalmieri created at 2014-05-15 16:46:38

What does the log file for the git build say? Changing the version number should not do anything except force a rebuild, so if this fails, then so should `./sage -f git`.


---

Comment by jhpalmieri created at 2014-05-16 16:26:53

Changing status from positive_review to needs_info.


---

Comment by git created at 2014-05-16 16:34:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-05-16 16:36:23

Your idea works actually. Thanks. I used `1.8.4.4p0` which does not work. Please set positive.


---

Comment by rws created at 2014-05-16 16:36:23

Changing status from needs_info to needs_review.


---

Comment by jhpalmieri created at 2014-05-16 16:54:46

Changing status from needs_review to positive_review.


---

Comment by rws created at 2014-05-17 06:25:15

Hope you don't mind me adding your name.


---

Comment by vbraun created at 2014-05-19 12:53:29

Resolution: fixed
