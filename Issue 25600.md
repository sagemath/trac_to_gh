# Issue 25600: Make the sage notebook optional

Issue created by migration from Trac.

Original creator: @timokau

Original creation time: 2018-07-11 22:19:48

CC:  embray vbraun jdemeyer kcrisman fbissey arojas @timokau infinity0 novoselt pcpa nthiery slelievre saraedum schilly strogdon thansen tmonteil was

Keywords: notebook

An intention to eventually deprecate sagenb has already been mentioned many times in different tickets. But I couldn't find a ticket tracking progress and discussing sagenb's future, so here it is.

Reasons to make sagenb optional:

- most of its functionalities have been replaced for a while

- it is not actively maintained -- merely on life support (if even that)

- it has various open issues (looking at the "Critical" label in the github repo)
	- unmaintained dependencies (https://github.com/sagemath/sagenb/issues/440#issuecomment-381583952)
	- incompatibility with the latest flask-babel (https://github.com/sagemath/sagenb/issues/437)
	- incompatibility with python3 (https://github.com/sagemath/sagenb/issues/343)
	- an XSS vulnerability, unfixed for 3.5 years (https://github.com/sagemath/sagenb/issues/319)

- just as a bit of history, `@`vbraun was already implying sagenb deprecation in 2013: https://github.com/sagemath/sagenb/issues/169#issuecomment-20026780

- and for me personally: I don't want to package it. I feel like it causes an unproportional amount of issues considering its relatively low value in todays sage.

Reasons to keep sagenb around:

- there are still some features depending on it

- there might still be people using it. An example would be `@`fbissey's university: #25382#comment:16

In making it optional, we still make it possible to use it for now. An when it inevitably breaks further, the people relying on it can weigh the effort of keeping it alive themselves against the effort of switching to the new notebook.

Tickets and issues tracking progress/going in that direction (issues taken from #22431):

- #25382: do not include sagenb docs in sage

- port/remove the graph editor

- port/remove the graph database navigator

- port/remove the interactive debugger

Otherwise relevant:

- #22431: first step in making sagenb python3 compatible


---

Comment by embray created at 2018-07-12 14:13:22

Some issues I'm aware of related to features that are only in sagenb:

* #25015 - object introspection (`<obj>?`) in the Jupyter notebook does not display HTML-formatted docs (esp. with latex formatting), while sagenb does.  I believe Odile might be looking into this now.  Not a significantly difficult issue but not trivial either.

* #24784 - `search_doc` does not work in the Jupyter notebook

* #9048 - `automatic_names` only works in sagenb.  This was also discussed recently on sage-devel: https://groups.google.com/d/msg/sage-devel/RoBZ36i1xo4/e6ZunaKRAwAJ  I believe `automatic_names()` can be reimplemented in such a way that's mostly independent on the front-end, though one would still need front-end specific hooks for it to work.  I haven't tried this yet though.

I think at a minimum these issues should be fixed before taking further steps at abandoning the old sagenb.


---

Comment by kcrisman created at 2018-07-12 15:35:37

I would also say that something "official" when one uses sagenb *even when directly* that says it is deprecated is necessary.


---

Comment by @timokau created at 2018-07-12 19:43:51

I modified the ticket description to incorporate (read: shamelessly copy) your additions.

It would be nice if we could get the deprecation warning into 8.3 so that users will have at least one release to prepare. Thats a very optimistic estimate of course, but getting it in 8.3 would be nice either way.


---

Comment by @timokau created at 2018-07-12 19:47:42

I have opened #25852 for that. I have only ever actually started the notebook once. Do you have an idea where best to add such a message? Just print it on the command line?


---

Comment by kcrisman created at 2018-07-12 20:57:49

Probably on the notebook itself as well, which would require changes in sagenb.


---

Comment by slelievre created at 2018-07-13 06:42:36

cc a few people who package Sage in various ways


---

Comment by slelievre created at 2018-07-13 06:42:36

Changing keywords from "notebook" to "notebook, sagenb".


---

Comment by embray created at 2018-07-18 13:19:34

Another issue that was brought up here: https://ask.sagemath.org/question/43051/file-download-as-latex/

Converting a Jupyter notebook to PDF kind of sucks at the moment for notebooks that contain a lot of math in latex.  There are two main cases in the notebook where latex can appear, and both have issues in sage:

1) If an object output from a code cell has `_render_latex_` then the notebook will display the rendered latex with mathjax.  However, when converting the notebook to PDF, nbconvert just takes the plain-text representation of the output, not the latex, and puts it in a verbatim block.  Not good, especially not for Sage.

2) If a markdown cell contains equations in latex, nbconvert *will* render them correctly, but only if you have pandoc installed.  This is already a known issue, but since pandoc does not come with Sage and is not a dependency this makes for a sucky user experience for something that should Just Work.

I'm not sure what to do about the first case; it seems like an issue for nbconvert but I haven't explored it too deeply.  For the latter case (which probably also affects the first case) I wonder if we shouldn't just make pandoc another sage dependency.


---

Comment by @timokau created at 2018-07-20 15:18:15

I've updated the ticket. The flask issue was resolved (thanks `@`fchapoton!), I added the pdf complaint and improved formatting.


---

Comment by @timokau created at 2018-07-23 16:06:30

I've added a section intended for end users. Please improve on that if you have more knowledge about sagenb or the Jupyter Notebook, which you probably do.


---

Comment by was created at 2018-07-25 12:13:14

>  Those features are listed below. 

Where is the list?  I can't find it. 

I touched on this on page 26 of a talk I gave yesterday (https://share.cocalc.com/share/6cd832d3-c523-41e3-9e54-c8f2d2e8fa2a/travel/2018/2018-07-icms/talks/cocalc/slides/slides.html#1)

One example is that if you start running:


```
for i in range(10):
   print(i)
   sys.stdout.flush()
   time.sleep(1)
```

then close and open your browser (to simulate a network failure, say), you
should not loose output.   In Jupyter, you do.


---

Comment by embray created at 2018-07-25 12:57:57

Replying to [comment:15 was]:
> >  Those features are listed below. 
> 
> Where is the list?  I can't find it. 

It's in the description of the ticket, but perhaps that still needs more reformatting, because there are a number of thing "below" that sentence that include, but are not limited to, missing features.

Most of it falls under the heading "Functionality sagenb currently does better than Jupyter" though that list is far from complete.  There's also a link to a wiki page listing other issues.


---

Comment by jhpalmieri created at 2018-08-20 22:10:30

"#24784: search_doc does not work in the Jupyter notebook" is now ready for review.


---

Comment by chapoton created at 2018-09-05 06:10:39

Could someone (having the required rights) please now merge the 4 top pull requests in sagenb github, including the one related to the present ticket ?

https://github.com/sagemath/sagenb/pulls


---

Comment by dimpase created at 2018-10-17 15:58:55

Replying to [comment:20 chapoton]:
> Could someone (having the required rights) please now merge the 4 top pull requests in sagenb github, including the one related to the present ticket ?
> 
> https://github.com/sagemath/sagenb/pulls

done, I guess. See #26499 for the new release of sagenb.


---

Comment by chapoton created at 2018-12-13 16:45:26

New commits:


---

Comment by chapoton created at 2019-03-05 15:36:23

remaining imports in 8.7.b6 :

```
git grep "import.*sagenb" src/
src/doc/en/developer/sagenb/index.rst:The most important section involves how to update your new sagenb
src/sage/all.py:lazy_import('sagenb.notebook.notebook_object', 'notebook')
src/sage/all.py:lazy_import('sagenb.notebook.notebook_object', 'inotebook')
src/sage/all.py:lazy_import('sagenb.notebook.sage_email', 'email')
src/sage/all.py:lazy_import('sagenb.notebook.interact', 'interact')
src/sage/graphs/graph_editor.py:    import sagenb.notebook.interact
src/sage/interacts/library.py:        import sagenb.notebook.interact
```



---

Comment by kcrisman created at 2019-04-09 17:42:59

Apparently [this question implies](https://ask.sagemath.org/question/46005/issue-printing-tables-in-jupyter-notebook/) that we should add "can't do the table command" in Jupyter.  Is that accurate?


---

Comment by jhpalmieri created at 2019-04-09 19:47:03

It works for me.


---

Comment by dimpase created at 2019-04-09 20:18:07

Changing status from new to needs_review.


---

Comment by slelievre created at 2019-04-13 11:32:04

Replying to [comment:26 kcrisman]:
> Apparently [this question](https://ask.sagemath.org/question/46005/) implies that we should add "can't do the table command" in Jupyter.  Is that accurate?

Now tracked at #27656.


---

Comment by dimpase created at 2019-04-14 22:27:14

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-04-14 22:27:14

Does anything stop this from going forward?


---

Comment by kcrisman created at 2019-04-15 13:12:22

> Does anything stop this from going forward?

Well, does Jupyter actually do all this stuff yet or not?

Also, for people who download a new Sage (which many do, as opposed to pulling and upgrading), it's not clear to me what happens when they try to use the notebook export functionality (which should still be the default as of now).  How do they acquire this optional package if they have a binary-only Sage?  Or would the export still accurately export to Jupyter anyway?


---

Comment by embray created at 2019-04-15 15:03:55

IMO there shouldn't be any rush on this until at a minimum the issues listed in the description of this ticket are dealt with.

Is there a reason to rush this forward?  If so, what tickets could use my help?


---

Comment by embray created at 2019-04-15 15:03:55

Changing status from positive_review to needs_info.


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by jhpalmieri created at 2019-09-16 22:21:24

Replying to [comment:32 embray]:
> IMO there shouldn't be any rush on this until at a minimum the issues listed in the description of this ticket are dealt with.
> 
> Is there a reason to rush this forward?  If so, what tickets could use my help?

If SageNB doesn't work with Python 3, then we will need to drop it when we make the switch. Since the switch is coming up, we should officially deprecate this as soon as possible. If we manage to switch to Python 3 by January 1, we already won't make the required (by Sage policy) 6 months of deprecation time.


---

Comment by dimpase created at 2019-09-17 07:05:14

SageNB won't be ported to Python 3, it's been clear for ages I think.

I think this patch is potentially breaking the current notebook-launching setup, 
as we don't want to have a not always installed package pointed to by
`Run the old Sage Notebook` menu item.

The latter should not be shown if the package is not installed.
In this case instead a message saying something like "Install sagenb  optional package
for the old SageNB" should be there.


---

Comment by dimpase created at 2019-09-17 07:05:14

Changing status from needs_info to needs_work.


---

Comment by @timokau created at 2019-09-21 10:21:14

Replying to [comment:35 jhpalmieri]:
> Replying to [comment:32 embray]:
> > IMO there shouldn't be any rush on this until at a minimum the issues listed in the description of this ticket are dealt with.
> > 
> > Is there a reason to rush this forward?  If so, what tickets could use my help?
> 
> If SageNB doesn't work with Python 3, then we will need to drop it when we make the switch. Since the switch is coming up, we should officially deprecate this as soon as possible. If we manage to switch to Python 3 by January 1, we already won't make the required (by Sage policy) 6 months of deprecation time.

I added a deprecation warning close to a year ago: #25852

So I think we're good on that front if we decide to drop it with the first python3 release. Feature parity is a different issue though.


---

Comment by chapoton created at 2019-09-23 14:55:07

I have made a pull request to change the front page of the exporter.

https://github.com/vbraun/ExportSageNB/pull/16


---

Comment by chapoton created at 2019-10-07 15:35:43

This pull request have been merged.


---

Comment by kcrisman created at 2019-11-07 13:40:50

> We will not completely stop supporting the legacy notebook until those issues are resolved. 

Did those issues get resolved, and/or will they soon?  `automatic_names` for instance would be an actual regression.  Does Jupyter now support matrix input for interacts?  Just wondering, before the switch is actually pulled ...


---

Comment by kcrisman created at 2019-11-07 14:19:03

And was the graph stuff ever removed as is suggested in the description?


---

Comment by jhpalmieri created at 2019-11-07 16:20:28

When we talk about regressions, I think the context is: we are imagining people converting their notebooks from SageNB to Jupyter and not using SageNB any more (as opposed to: using SageNB for some tasks, Jupyter for others). In that context, it is also worthwhile to ask what features Jupyter has that SageNB doesn't. I don't think we are just losing things by moving from SageNB to Jupyter; aside from Python 3 compatibility, I think we gain some things by moving to Jupyter. So it is a trade-off. At what point does the balance tip to the Jupyter side? Maybe the Python 3 support is enough on its own, in fact.


---

Comment by kcrisman created at 2019-11-08 01:55:45

> Maybe the Python 3 support is enough on its own, in fact.

Obviously that is the consensus decision.  I'm just quoting this ticket right now when I mention these things, and would hate to have them disappear for all time.   But as you said elsewhere, someone has to work on them.


---

Comment by nthiery created at 2019-11-23 14:34:32

A functionality that Jupyter is currently missing over sagenb is the rich text editor. This may possibly be resolved by:

https://github.com/jupytercalpoly/jupyterlab-richtext-mode


---

Comment by dimpase created at 2019-11-23 15:18:28

the most pressing issue is inability to normally use jsmol in Jupyter notebooks, needed to export 3d drawings for animations. We are having a lot of complaints about it.
There is something with the jsmol pop-up menu, which gets cut out by the notebook cell, and can't be used (thus making exports impossible)

https://github.com/jupyter/notebook/issues/1872 discussing this has been opened in 2016 (pity that it was not resolved during ODK).


---

Comment by nthiery created at 2019-11-24 10:12:07

Indeed; too bad this was not brought up. That being said, we still are in good contact with the Jupyter team :-) So if we provide them with a specific and easy to reproduce example (e.g. through a binder link) on the above issue, there are chances that we can make progress. It would be worth testing how things are in jupyterlab too.


---

Comment by kcrisman created at 2019-11-25 17:12:21

By the way, I note that only jsmol can make stereographic plots for 3d viewing, though I don't know how often this capability is used.   (People like it when advertising Sage!)


---

Comment by dimpase created at 2019-11-25 18:15:06

Replying to [comment:47 kcrisman]:
> By the way, I note that only jsmol can make stereographic plots for 3d viewing, though I don't know how often this capability is used.   (People like it when advertising Sage!)

can't plotly do it? see e.g. https://plot.ly/~empet/13037.embed


---

Comment by kcrisman created at 2019-11-25 20:34:09

By "only jsmol", I meant the only thing included standard in Sage.  What is plotly?  (Am I so behind that I missed a major new Sage internal plot mechanism? Yikes.)


---

Comment by dimpase created at 2019-11-25 20:38:17

I read your comments as "the only Python library that can do this sort if plotting"

plotly is Python library, no idea if it can work in Sage.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-04 20:14:58

This was done another ticket merged for 9.1 (see #29320), should be closed.

But #17590 (update sagenb SPKG.txt) needs work for 9.1


---

Comment by mkoeppe created at 2020-05-04 20:14:58

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2020-05-04 21:07:44

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-05-05 05:53:31

Resolution: duplicate
