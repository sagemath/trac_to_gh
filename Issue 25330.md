# Issue 25330: Upgrade to pari-2.10.0.alpha

archive/issues_025330.json:
```json
{
    "body": "CC:  fbissey cremona @timokau frederichan\n\n**Tarball**: https://pari.math.u-bordeaux.fr/pub/pari/unstable/pari-2.10.0.alpha.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/25567\n\n",
    "created_at": "2018-06-12T21:34:58Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Upgrade to pari-2.10.0.alpha",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25330",
    "user": "jdemeyer"
}
```
CC:  fbissey cremona @timokau frederichan

**Tarball**: https://pari.math.u-bordeaux.fr/pub/pari/unstable/pari-2.10.0.alpha.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/25567





---

archive/issue_comments_357039.json:
```json
{
    "body": "Sage input file which causes a pari crash with current Sage/Pari versino",
    "created_at": "2018-06-13T09:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357039",
    "user": "cremona"
}
```

Sage input file which causes a pari crash with current Sage/Pari versino



---

archive/issue_comments_357040.json:
```json
{
    "body": "Attachment [pols.sage](tarball://root/attachments/some-uuid/ticket25567/pols.sage) by cremona created at 2018-06-13 09:39:41\n\nSee the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.\n----\nNew commits:",
    "created_at": "2018-06-13T09:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357040",
    "user": "cremona"
}
```

Attachment [pols.sage](tarball://root/attachments/some-uuid/ticket25567/pols.sage) by cremona created at 2018-06-13 09:39:41

See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.
----
New commits:



---

archive/issue_comments_357041.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-13T10:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357041",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357042.json:
```json
{
    "body": "Replying to [comment:4 cremona]:\n> See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.\n\nI'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.",
    "created_at": "2018-06-13T10:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357042",
    "user": "jdemeyer"
}
```

Replying to [comment:4 cremona]:
> See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.

I'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.



---

archive/issue_comments_357043.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:4 cremona]:\n> > See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.\n> \n> I'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.\n\nNo, I agree.  But at least we could have an assertion on this ticket that it works, so that whoever reviews the ticket (or me) can test it manually.",
    "created_at": "2018-06-13T11:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357043",
    "user": "cremona"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 cremona]:
> > See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.
> 
> I'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.

No, I agree.  But at least we could have an assertion on this ticket that it works, so that whoever reviews the ticket (or me) can test it manually.



---

archive/issue_comments_357044.json:
```json
{
    "body": "Thanks to a Sage doctest, I found a genuine bug in the new PARI. So we'll need to wait for this to be fixed before we can proceed.",
    "created_at": "2018-06-13T13:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357044",
    "user": "jdemeyer"
}
```

Thanks to a Sage doctest, I found a genuine bug in the new PARI. So we'll need to wait for this to be fixed before we can proceed.



---

archive/issue_comments_357045.json:
```json
{
    "body": "I could not find pari bug 2055, but 2054 is possibly similar?",
    "created_at": "2018-06-13T13:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357045",
    "user": "cremona"
}
```

I could not find pari bug 2055, but 2054 is possibly similar?



---

archive/issue_comments_357046.json:
```json
{
    "body": "Replying to [comment:9 cremona]:\n> I could not find pari bug 2055\n\nIt should be there now. Their bug tracker sometimes takes a few minutes to update.",
    "created_at": "2018-06-13T13:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357046",
    "user": "jdemeyer"
}
```

Replying to [comment:9 cremona]:
> I could not find pari bug 2055

It should be there now. Their bug tracker sometimes takes a few minutes to update.



---

archive/issue_comments_357047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-13T14:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-13T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357048",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357049.json:
```json
{
    "body": "So I ran all doctests and found 3 independent new bugs in PARI. One was already fixed in master, I reported two and one of those is already fixed. So this ticket is essentially \"needs review\" modulo the `elleta` issue.",
    "created_at": "2018-06-13T14:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357049",
    "user": "jdemeyer"
}
```

So I ran all doctests and found 3 independent new bugs in PARI. One was already fixed in master, I reported two and one of those is already fixed. So this ticket is essentially "needs review" modulo the `elleta` issue.



---

archive/issue_comments_357050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-14T08:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357050",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357051.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-14T08:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357051",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_357052.json:
```json
{
    "body": "Just for information, the doctest in heegner is also touched by #25635.",
    "created_at": "2018-06-27T06:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357052",
    "user": "chapoton"
}
```

Just for information, the doctest in heegner is also touched by #25635.



---

archive/issue_comments_357053.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-08T21:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357053",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-09T07:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357054",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357055.json:
```json
{
    "body": "Unfortunately, this breaks cypari2:\n\n```\n[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_232_nf_nfzk':\n[cypari-1.1.4]     cypari2/gen.c:157941:3: error: too many arguments to function 'nf_nfzk'\n[cypari-1.1.4]        nf_nfzk(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, (&__pyx_v_zknf), (&__pyx_v_czknf));\n[cypari-1.1.4]        ^~~~~~~\n[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,\n[cypari-1.1.4]                      from cypari2/gen.c:599:\n[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2329:5: note: declared here\n[cypari-1.1.4]      GEN     nf_nfzk(GEN nf, GEN rnfeq);\n[cypari-1.1.4]          ^~~~~~~\n[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_234_nfeltup':\n[cypari-1.1.4]     cypari2/gen.c:158154:60: error: too many arguments to function 'nfeltup'\n[cypari-1.1.4]        __pyx_t_1 = ((PyObject *)__pyx_f_7cypari2_5stack_new_gen(nfeltup(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, __pyx_v_t1->__pyx_base.g, __pyx_v_t2->__pyx_base.g))); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4064, __pyx_L1_error)\n[cypari-1.1.4]                                                                 ^~~~~~~\n[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,\n[cypari-1.1.4]                      from cypari2/gen.c:599:\n[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2332:5: note: declared here\n[cypari-1.1.4]      GEN     nfeltup(GEN nf, GEN x, GEN zknf);\n[cypari-1.1.4]          ^~~~~~~\n```\n",
    "created_at": "2018-07-09T07:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357055",
    "user": "jdemeyer"
}
```

Unfortunately, this breaks cypari2:

```
[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_232_nf_nfzk':
[cypari-1.1.4]     cypari2/gen.c:157941:3: error: too many arguments to function 'nf_nfzk'
[cypari-1.1.4]        nf_nfzk(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, (&__pyx_v_zknf), (&__pyx_v_czknf));
[cypari-1.1.4]        ^~~~~~~
[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,
[cypari-1.1.4]                      from cypari2/gen.c:599:
[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2329:5: note: declared here
[cypari-1.1.4]      GEN     nf_nfzk(GEN nf, GEN rnfeq);
[cypari-1.1.4]          ^~~~~~~
[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_234_nfeltup':
[cypari-1.1.4]     cypari2/gen.c:158154:60: error: too many arguments to function 'nfeltup'
[cypari-1.1.4]        __pyx_t_1 = ((PyObject *)__pyx_f_7cypari2_5stack_new_gen(nfeltup(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, __pyx_v_t1->__pyx_base.g, __pyx_v_t2->__pyx_base.g))); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4064, __pyx_L1_error)
[cypari-1.1.4]                                                                 ^~~~~~~
[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,
[cypari-1.1.4]                      from cypari2/gen.c:599:
[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2332:5: note: declared here
[cypari-1.1.4]      GEN     nfeltup(GEN nf, GEN x, GEN zknf);
[cypari-1.1.4]          ^~~~~~~
```




---

archive/issue_comments_357056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-10T15:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-13T11:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357057",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357058.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-13T13:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357058",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-13T14:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357059",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357060.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-13T14:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357060",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357061.json:
```json
{
    "body": "[pari-2.11.0 (STABLE) released !](http://pari.math.u-bordeaux.fr/archives/pari-announce-18/msg00006.html)\n\nShould we instead update to that or first update to beta and then follow up?",
    "created_at": "2018-07-23T11:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357061",
    "user": "@timokau"
}
```

[pari-2.11.0 (STABLE) released !](http://pari.math.u-bordeaux.fr/archives/pari-announce-18/msg00006.html)

Should we instead update to that or first update to beta and then follow up?



---

archive/issue_comments_357062.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-23T11:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357062",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357063.json:
```json
{
    "body": "I'm experiencing a giac test failure when I update the pari nix package. I'm not sure yet if its actually caused by the pari update, the giac test suite seems somewhat non-deterministic. I'll investigate and report upstream if it is relevant.",
    "created_at": "2018-07-23T12:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357063",
    "user": "@timokau"
}
```

I'm experiencing a giac test failure when I update the pari nix package. I'm not sure yet if its actually caused by the pari update, the giac test suite seems somewhat non-deterministic. I'll investigate and report upstream if it is relevant.



---

archive/issue_comments_357064.json:
```json
{
    "body": "Seems like I get the failure\n\n\n```\n13c13\n< 1,\n---\n> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>\nFAIL: chk_fhan11\n```\n\n\nwhen updating pari. The latest version of giac (1.4.9-69) unfortunately doesn't fix this but instead introduces one more failure:\n\n\n```\n35c35\n< 2/3*sign(a)*asin(sqrt(x)*x/sqrt(a)/a),\n---\n> 2/3*asin(sqrt(x)*x/sqrt(a)/a)*sign(a),\nFAIL: chk_integrate\n```\n\n\nI'll have to wait until my upstream forum account is approved until I can report.",
    "created_at": "2018-07-23T12:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357064",
    "user": "@timokau"
}
```

Seems like I get the failure


```
13c13
< 1,
---
> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
FAIL: chk_fhan11
```


when updating pari. The latest version of giac (1.4.9-69) unfortunately doesn't fix this but instead introduces one more failure:


```
35c35
< 2/3*sign(a)*asin(sqrt(x)*x/sqrt(a)/a),
---
> 2/3*asin(sqrt(x)*x/sqrt(a)/a)*sign(a),
FAIL: chk_integrate
```


I'll have to wait until my upstream forum account is approved until I can report.



---

archive/issue_comments_357065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-26T10:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357065",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357066.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-26T10:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357066",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357067.json:
```json
{
    "body": "Replying to [comment:35 gh-timokau]:\n> Seems like I get the failure\n> \n> {{{\n> 13c13\n> < 1,\n> ---\n> > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>\n> FAIL: chk_fhan11\n> }}}\n> \n> when updating pari.\n\nDid you report that upstream?\n\nI analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.\n\nThe test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.",
    "created_at": "2018-07-26T11:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357067",
    "user": "jdemeyer"
}
```

Replying to [comment:35 gh-timokau]:
> Seems like I get the failure
> 
> {{{
> 13c13
> < 1,
> ---
> > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
> FAIL: chk_fhan11
> }}}
> 
> when updating pari.

Did you report that upstream?

I analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.

The test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.



---

archive/issue_comments_357068.json:
```json
{
    "body": "Replying to [comment:38 jdemeyer]:\n> Replying to [comment:35 gh-timokau]:\n> > Seems like I get the failure\n> > \n> > {{{\n> > 13c13\n> > < 1,\n> > ---\n> > > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>\n> > FAIL: chk_fhan11\n> > }}}\n> > \n> > when updating pari.\n> \n> Did you report that upstream?\n\nThe only contact info I found was that [forum](https://xcas.univ-grenoble-alpes.fr/forum/) and I'm still waiting for my account to be approved. I think I accidentally chose the wrong option at the age question (doesn't help that the forum is in french). I sent an email to the administrators, no reply yet.\n\nIf you want to try, maybe you have more luck. I wish they'd just use some issue tracker or plain old email.\n\n> I analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.\n> \n> The test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.\n\nGreat, thanks for analyzing this :)\n\nShould we then adapt / disable giac's `spkg-check` until this is fixed? Or is it okay for those spkg checks to fail?",
    "created_at": "2018-07-26T12:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357068",
    "user": "@timokau"
}
```

Replying to [comment:38 jdemeyer]:
> Replying to [comment:35 gh-timokau]:
> > Seems like I get the failure
> > 
> > {{{
> > 13c13
> > < 1,
> > ---
> > > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
> > FAIL: chk_fhan11
> > }}}
> > 
> > when updating pari.
> 
> Did you report that upstream?

The only contact info I found was that [forum](https://xcas.univ-grenoble-alpes.fr/forum/) and I'm still waiting for my account to be approved. I think I accidentally chose the wrong option at the age question (doesn't help that the forum is in french). I sent an email to the administrators, no reply yet.

If you want to try, maybe you have more luck. I wish they'd just use some issue tracker or plain old email.

> I analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.
> 
> The test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.

Great, thanks for analyzing this :)

Should we then adapt / disable giac's `spkg-check` until this is fixed? Or is it okay for those spkg checks to fail?



---

archive/issue_comments_357069.json:
```json
{
    "body": "Replying to [comment:39 gh-timokau]:\n> I wish they'd just use some issue tracker or plain old email.\n\nMore generally, their website is a mess... Even finding the source tarballs is hard. And that page has `debian` in its name even though these are just the sources: https://www-fourier.ujf-grenoble.fr/~parisse/debian/dists/stable/main/source/\n\nI just recall now that `@`frederichan is a Giac developer and usually all bug reports from Sage go through him. \u200bFrederic: if you missed the discussion, the upgrade to PARI/GP breaks one test from Giac:\n\n```\n13c13\n< 1,\n---\n> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>\nFAIL: chk_fhan11\n```\n\nSee [comment:38] for the analysis.",
    "created_at": "2018-07-26T13:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357069",
    "user": "jdemeyer"
}
```

Replying to [comment:39 gh-timokau]:
> I wish they'd just use some issue tracker or plain old email.

More generally, their website is a mess... Even finding the source tarballs is hard. And that page has `debian` in its name even though these are just the sources: https://www-fourier.ujf-grenoble.fr/~parisse/debian/dists/stable/main/source/

I just recall now that `@`frederichan is a Giac developer and usually all bug reports from Sage go through him. â€‹Frederic: if you missed the discussion, the upgrade to PARI/GP breaks one test from Giac:

```
13c13
< 1,
---
> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
FAIL: chk_fhan11
```

See [comment:38] for the analysis.



---

archive/issue_comments_357070.json:
```json
{
    "body": "I have reported this here: \nhttps://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326\n\nAs this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?\n\n\n```\n--- a/check/TP11-sol.cas.out1\t2018-07-26 17:12:30.516949491 +0200\n+++ b/check/TP11-sol.cas.out1\t2018-07-26 17:13:04.397032363 +0200\n@@ -10,7 +10,7 @@\n 1073741824000000000000000000061203284109000000000000000000000000008409,\n 2^3*3*389*733*156904374622257604823879982847602392900751802349981470895277241,\n \"Done\",\n-matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix[[2,13,1],[3,3,1],[5,2,1],[7,2,1],[56467,2,1],[6553084925887974620811527,2,matrix[[2,5,1],[19,2,1],[71,2,1],[126823,2,1]]]]]],\n+1,\n 0,\n [],\n 1,\n```\n\nbest\nFrederic",
    "created_at": "2018-07-26T15:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357070",
    "user": "frederichan"
}
```

I have reported this here: 
https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326

As this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?


```
--- a/check/TP11-sol.cas.out1	2018-07-26 17:12:30.516949491 +0200
+++ b/check/TP11-sol.cas.out1	2018-07-26 17:13:04.397032363 +0200
@@ -10,7 +10,7 @@
 1073741824000000000000000000061203284109000000000000000000000000008409,
 2^3*3*389*733*156904374622257604823879982847602392900751802349981470895277241,
 "Done",
-matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix[[2,13,1],[3,3,1],[5,2,1],[7,2,1],[56467,2,1],[6553084925887974620811527,2,matrix[[2,5,1],[19,2,1],[71,2,1],[126823,2,1]]]]]],
+1,
 0,
 [],
 1,
```

best
Frederic



---

archive/issue_comments_357071.json:
```json
{
    "body": "Thanks for reporting! If the test really just tests the pari interface without ever using that part of the interface, I'd just remove the test instead.\n\nNot quite relevant to this ticket, but could you report the `chk_integrate` failure too? [the test failure is here](https://trac.sagemath.org/ticket/25567#comment:35). That occurs when I update giac from 1.4.9-59 to 1.4.9-69 (without changing anything else).",
    "created_at": "2018-07-26T15:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357071",
    "user": "@timokau"
}
```

Thanks for reporting! If the test really just tests the pari interface without ever using that part of the interface, I'd just remove the test instead.

Not quite relevant to this ticket, but could you report the `chk_integrate` failure too? [the test failure is here](https://trac.sagemath.org/ticket/25567#comment:35). That occurs when I update giac from 1.4.9-59 to 1.4.9-69 (without changing anything else).



---

archive/issue_comments_357072.json:
```json
{
    "body": "Replying to [comment:41 frederichan]:\n> I have reported this here: \n> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326\n> \n> As this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?\n\nDepends whether you want to want the tests to pass on older PARI versions too. Personally, I would just remove the test completely.",
    "created_at": "2018-07-26T18:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357072",
    "user": "jdemeyer"
}
```

Replying to [comment:41 frederichan]:
> I have reported this here: 
> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326
> 
> As this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?

Depends whether you want to want the tests to pass on older PARI versions too. Personally, I would just remove the test completely.



---

archive/issue_comments_357073.json:
```json
{
    "body": "`@`frederichan also not really relevant for this ticket, but lacking another communication channel: Apparently the nix maintainer for giac also already requested a forum account last yer and never got it: https://github.com/NixOS/nixpkgs/pull/44129#issuecomment-408203217\n\nRegarding this ticket: I don't know how the review process works, but LGTM. I haven't run the doctests yet though.",
    "created_at": "2018-07-26T22:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357073",
    "user": "@timokau"
}
```

`@`frederichan also not really relevant for this ticket, but lacking another communication channel: Apparently the nix maintainer for giac also already requested a forum account last yer and never got it: https://github.com/NixOS/nixpkgs/pull/44129#issuecomment-408203217

Regarding this ticket: I don't know how the review process works, but LGTM. I haven't run the doctests yet though.



---

archive/issue_comments_357074.json:
```json
{
    "body": "Replying to [comment:44 gh-timokau]:\n> I don't know how the review process works\n\nJust a general reply:\n\n- look at the diff and see whether it makes sense.\n- Sage cares a lot about tests, so check whether the code is well tested.\n- check the patchbot (the colored blob at the top of the page).\n- maybe try a few examples, test corner cases in the code.\n- if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).\n\nIn this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.",
    "created_at": "2018-07-27T07:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357074",
    "user": "jdemeyer"
}
```

Replying to [comment:44 gh-timokau]:
> I don't know how the review process works

Just a general reply:

- look at the diff and see whether it makes sense.
- Sage cares a lot about tests, so check whether the code is well tested.
- check the patchbot (the colored blob at the top of the page).
- maybe try a few examples, test corner cases in the code.
- if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).

In this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.



---

archive/issue_comments_357075.json:
```json
{
    "body": "I have also reported chk_integrate here:\nhttps://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104\n\nIndeed my giac/xcas forum account is old, to obtain one I think the safest is a direct mail to Bernard Parisse:\nhttps://www-fourier.ujf-grenoble.fr/?q=fr/content/annuaire\n(he may be in vacation at this time). He also have a trac account: parisse\n\n(cf #25822#comment:12)\n\nRegarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.\n\nFor a sage package where you always have pari you may decide to suppress it.\n\nNB: if you plan to upgrade giac package, 1.4.6.69 is not enough to fix #25822 but the next stable should be.",
    "created_at": "2018-07-27T08:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357075",
    "user": "frederichan"
}
```

I have also reported chk_integrate here:
https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104

Indeed my giac/xcas forum account is old, to obtain one I think the safest is a direct mail to Bernard Parisse:
https://www-fourier.ujf-grenoble.fr/?q=fr/content/annuaire
(he may be in vacation at this time). He also have a trac account: parisse

(cf #25822#comment:12)

Regarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.

For a sage package where you always have pari you may decide to suppress it.

NB: if you plan to upgrade giac package, 1.4.6.69 is not enough to fix #25822 but the next stable should be.



---

archive/issue_comments_357076.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:44 gh-timokau]:\n> > I don't know how the review process works\n> \n> Just a general reply:\n> \n> - look at the diff and see whether it makes sense.\n\nDid that. While I won't pretend all the math, the changes look very reasonable to me. No obviously wrong results and I think we can trust pari with the details.\n\nTwo things that stuck out to me though:\n\n\n```\nsage: a.multiplicative_order()\n-        4547473508864641189575195312\n+        189478062869360049565633138\n```\n\n\n\n```\n             sage: O3.absolute_discriminant()\n-            8643600\n+            400160824478095086350656915693814563600\n```\n\n\nI would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique. But again, my knowledge is limited.\n\n> - Sage cares a lot about tests, so check whether the code is well tested.\n\ncheck\n\n> - check the patchbot (the colored blob at the top of the page).\n\nOh, I've always wondered what exactly the patchbot is everybody is talking about.\n\n> - maybe try a few examples, test corner cases in the code.\n> - if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).\n\nBut can anybody just do that?\n\n> In this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.\n\nWhy doesn't the patchbot test package upgrades? I think if we can just take anybody's word for it, its probably yours.\n\n\nReplying to [comment:46 frederichan]:\n> I have also reported chk_integrate here:\n> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104\n\nThanks :)\n\n> Regarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.\n\nA very brittle test suite is at risk of just being ignored after a few false-positives. I think a few high-value tests are way more valuable than testing the literal output of every function. Sage has a bit of the same problem in my opinion.\n\n> For a sage package where you always have pari you may decide to suppress it.\n\nFor now I just did `echo > check/chk_fhan11`. Its not that easy to disable an individual test.",
    "created_at": "2018-07-27T11:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357076",
    "user": "@timokau"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:44 gh-timokau]:
> > I don't know how the review process works
> 
> Just a general reply:
> 
> - look at the diff and see whether it makes sense.

Did that. While I won't pretend all the math, the changes look very reasonable to me. No obviously wrong results and I think we can trust pari with the details.

Two things that stuck out to me though:


```
sage: a.multiplicative_order()
-        4547473508864641189575195312
+        189478062869360049565633138
```



```
             sage: O3.absolute_discriminant()
-            8643600
+            400160824478095086350656915693814563600
```


I would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique. But again, my knowledge is limited.

> - Sage cares a lot about tests, so check whether the code is well tested.

check

> - check the patchbot (the colored blob at the top of the page).

Oh, I've always wondered what exactly the patchbot is everybody is talking about.

> - maybe try a few examples, test corner cases in the code.
> - if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).

But can anybody just do that?

> In this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.

Why doesn't the patchbot test package upgrades? I think if we can just take anybody's word for it, its probably yours.


Replying to [comment:46 frederichan]:
> I have also reported chk_integrate here:
> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104

Thanks :)

> Regarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.

A very brittle test suite is at risk of just being ignored after a few false-positives. I think a few high-value tests are way more valuable than testing the literal output of every function. Sage has a bit of the same problem in my opinion.

> For a sage package where you always have pari you may decide to suppress it.

For now I just did `echo > check/chk_fhan11`. Its not that easy to disable an individual test.



---

archive/issue_comments_357077.json:
```json
{
    "body": "Replying to [comment:47 gh-timokau]:\n> Two things that stuck out to me though:\n> \n> {{{\n> sage: a.multiplicative_order()\n> -        4547473508864641189575195312\n> +        189478062869360049565633138\n> }}}\n> \n> {{{\n>              sage: O3.absolute_discriminant()\n> -            8643600\n> +            400160824478095086350656915693814563600\n> }}}\n> \n> I would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique.\n\nThe multiplicative order is certainly unique, but the *element* `a` that we're taking the order of is different.\n\nIn the second case, I changed the test input because PARI got more clever in computing orders. We need the large primes `1000003` and `1000099` to make it more difficult for PARI to accidentally find the maximal order.\n\n> > - check the patchbot (the colored blob at the top of the page).\n> \n> Oh, I've always wondered what exactly the patchbot is everybody is talking about.\n\nIt's what Sage uses for continuous integration. It's far from perfect and there is a proposal to replace it: #24854\n\n> But can anybody just do that?\n\nYes, anybody can do that. This process seems to be working fine.\n\n> Why doesn't the patchbot test package upgrades?\n\nGood question actually, I don't know the answer.",
    "created_at": "2018-08-01T11:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357077",
    "user": "jdemeyer"
}
```

Replying to [comment:47 gh-timokau]:
> Two things that stuck out to me though:
> 
> {{{
> sage: a.multiplicative_order()
> -        4547473508864641189575195312
> +        189478062869360049565633138
> }}}
> 
> {{{
>              sage: O3.absolute_discriminant()
> -            8643600
> +            400160824478095086350656915693814563600
> }}}
> 
> I would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique.

The multiplicative order is certainly unique, but the *element* `a` that we're taking the order of is different.

In the second case, I changed the test input because PARI got more clever in computing orders. We need the large primes `1000003` and `1000099` to make it more difficult for PARI to accidentally find the maximal order.

> > - check the patchbot (the colored blob at the top of the page).
> 
> Oh, I've always wondered what exactly the patchbot is everybody is talking about.

It's what Sage uses for continuous integration. It's far from perfect and there is a proposal to replace it: #24854

> But can anybody just do that?

Yes, anybody can do that. This process seems to be working fine.

> Why doesn't the patchbot test package upgrades?

Good question actually, I don't know the answer.



---

archive/issue_comments_357078.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-04T15:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357078",
    "user": "@timokau"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357079.json:
```json
{
    "body": "Oh, I didn't notice that you also changed the test input.",
    "created_at": "2018-08-04T15:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357079",
    "user": "@timokau"
}
```

Oh, I didn't notice that you also changed the test input.



---

archive/issue_comments_357080.json:
```json
{
    "body": "Reviewer name.",
    "created_at": "2018-08-04T22:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357080",
    "user": "tscrim"
}
```

Reviewer name.



---

archive/issue_comments_357081.json:
```json
{
    "body": "FWIW the testsuite fails on kucalc (linux 64-bit):\n\n```\n* Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   \n```\n",
    "created_at": "2018-08-05T18:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357081",
    "user": "vbraun"
}
```

FWIW the testsuite fails on kucalc (linux 64-bit):

```
* Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   
```




---

archive/issue_comments_357082.json:
```json
{
    "body": "Pretty sure this is due to pari on 32-bit linux:\n\n```\nFile \"src/sage/schemes/elliptic_curves/period_lattice.py\", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm\nFailed example:\n    L.elliptic_exponential(_)\nExpected:\n    (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)\nGot:\n    (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)\n```\n\n\nI also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)",
    "created_at": "2018-08-05T22:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357082",
    "user": "vbraun"
}
```

Pretty sure this is due to pari on 32-bit linux:

```
File "src/sage/schemes/elliptic_curves/period_lattice.py", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm
Failed example:
    L.elliptic_exponential(_)
Expected:
    (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)
Got:
    (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)
```


I also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)



---

archive/issue_comments_357083.json:
```json
{
    "body": "PS: the patchbot doesn't test package updates since it doesn't have a programmatic way of downloading tarballs, also patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.",
    "created_at": "2018-08-05T22:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357083",
    "user": "vbraun"
}
```

PS: the patchbot doesn't test package updates since it doesn't have a programmatic way of downloading tarballs, also patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.



---

archive/issue_comments_357084.json:
```json
{
    "body": "So should this be set to needs_work then?",
    "created_at": "2018-08-06T08:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357084",
    "user": "jdemeyer"
}
```

So should this be set to needs_work then?



---

archive/issue_comments_357085.json:
```json
{
    "body": "Replying to [comment:53 vbraun]:\n> Pretty sure this is due to pari on 32-bit linux:\n> {{{\n> File \"src/sage/schemes/elliptic_curves/period_lattice.py\", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm\n> Failed example:\n>     L.elliptic_exponential(_)\n> Expected:\n>     (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)\n> Got:\n>     (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)\n> }}}\n\nThat makes sense.  In line 1773 the pari function ellwp() is called (in the method elliptic_exponential())  and that is what does the work for this.\n\n> \n> I also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)",
    "created_at": "2018-08-06T08:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357085",
    "user": "cremona"
}
```

Replying to [comment:53 vbraun]:
> Pretty sure this is due to pari on 32-bit linux:
> {{{
> File "src/sage/schemes/elliptic_curves/period_lattice.py", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm
> Failed example:
>     L.elliptic_exponential(_)
> Expected:
>     (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)
> Got:
>     (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)
> }}}

That makes sense.  In line 1773 the pari function ellwp() is called (in the method elliptic_exponential())  and that is what does the work for this.

> 
> I also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)



---

archive/issue_comments_357086.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-06T08:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357086",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_357087.json:
```json
{
    "body": "Also I'd appreciate it if the giac testsuite could be worked around, otherwise I'll have to disabled it on the buildbot and, realistically, I'll never turn it back on.",
    "created_at": "2018-08-06T08:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357087",
    "user": "vbraun"
}
```

Also I'd appreciate it if the giac testsuite could be worked around, otherwise I'll have to disabled it on the buildbot and, realistically, I'll never turn it back on.



---

archive/issue_comments_357088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-06T09:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357088",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357089.json:
```json
{
    "body": "Replying to [comment:54 vbraun]:\n> patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.\n\nThat's true for any ticket. I don't believe that package upgrades are the tickets most likely to cause breakage of the patchbot.",
    "created_at": "2018-08-06T14:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357089",
    "user": "jdemeyer"
}
```

Replying to [comment:54 vbraun]:
> patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.

That's true for any ticket. I don't believe that package upgrades are the tickets most likely to cause breakage of the patchbot.



---

archive/issue_comments_357090.json:
```json
{
    "body": "Replying to [comment:52 vbraun]:\n> FWIW the testsuite fails on kucalc (linux 64-bit):\n> {{{\n> * Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   \n> }}}\n\nFixed by #26010.",
    "created_at": "2018-08-07T14:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357090",
    "user": "jdemeyer"
}
```

Replying to [comment:52 vbraun]:
> FWIW the testsuite fails on kucalc (linux 64-bit):
> {{{
> * Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   
> }}}

Fixed by #26010.



---

archive/issue_comments_357091.json:
```json
{
    "body": "Replying to [comment:53 vbraun]:\n> Pretty sure this is due to pari on 32-bit linux:\n\nFixed by adding some doctest tolerance.",
    "created_at": "2018-08-07T14:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357091",
    "user": "jdemeyer"
}
```

Replying to [comment:53 vbraun]:
> Pretty sure this is due to pari on 32-bit linux:

Fixed by adding some doctest tolerance.



---

archive/issue_comments_357092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-07T14:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357092",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357093.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-07T15:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357093",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357094.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-07T15:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357094",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357095.json:
```json
{
    "body": "Ping? It would be nice to review this again. I recall that it had positive_review before. So this would need reviewing the dependency #26010 and the few added commits.",
    "created_at": "2018-08-20T10:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357095",
    "user": "jdemeyer"
}
```

Ping? It would be nice to review this again. I recall that it had positive_review before. So this would need reviewing the dependency #26010 and the few added commits.



---

archive/issue_comments_357096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-08-22T15:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357096",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357097.json:
```json
{
    "body": "Rebased to latest version of #26010.",
    "created_at": "2018-08-22T15:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357097",
    "user": "jdemeyer"
}
```

Rebased to latest version of #26010.



---

archive/issue_comments_357098.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-22T23:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357098",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357099.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-26T09:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357099",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_357100.json:
```json
{
    "body": "Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.\n\n1. Is there a better way?\n2. Is the version going to be updated regularly to the current development version of pari?",
    "created_at": "2018-09-07T08:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357100",
    "user": "cremona"
}
```

Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.

1. Is there a better way?
2. Is the version going to be updated regularly to the current development version of pari?



---

archive/issue_comments_357101.json:
```json
{
    "body": "Replying to [comment:71 cremona]:\n> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.\n> \n>   1. Is there a better way?\n\nAs far as I can say that's quick and slightly dirty but probably not too much. I think the best way would be for your code to look for a variable, say `GP_EXEC`, and use its value as the `gp` executable if it exists. You can then put that in your environment and only your code is ever affected and you don't need to mess up with the link.",
    "created_at": "2018-09-07T08:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357101",
    "user": "fbissey"
}
```

Replying to [comment:71 cremona]:
> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.
> 
>   1. Is there a better way?

As far as I can say that's quick and slightly dirty but probably not too much. I think the best way would be for your code to look for a variable, say `GP_EXEC`, and use its value as the `gp` executable if it exists. You can then put that in your environment and only your code is ever affected and you don't need to mess up with the link.



---

archive/issue_comments_357102.json:
```json
{
    "body": "I thought of something like that but the Gp() constructor for a new gp interpreter does not allow the user to specify the interpreter's path explicitly.  It calls `Expect.__init__` with \n`command=\"gp --fast --emacs --quiet --stacksize %s\"%stacksize`\nso that relies on picking up gp from Sage's path.\n\nAm I missing something?  I am using a personal Sage build rather than messing with the system-wide one.",
    "created_at": "2018-09-07T09:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357102",
    "user": "cremona"
}
```

I thought of something like that but the Gp() constructor for a new gp interpreter does not allow the user to specify the interpreter's path explicitly.  It calls `Expect.__init__` with 
`command="gp --fast --emacs --quiet --stacksize %s"%stacksize`
so that relies on picking up gp from Sage's path.

Am I missing something?  I am using a personal Sage build rather than messing with the system-wide one.



---

archive/issue_comments_357103.json:
```json
{
    "body": "Replying to [comment:71 cremona]:\n> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.\n> \n>   1. Is there a better way?\n\nsage sets its `PATH` in `sage-env`. After setting that it sources `~/.sage/sagerc` if available. So if you create that file with the following contents:\n\n\n```\nexport PATH=\"<insert path to local build of gp here>/bin:$PATH\"\n```\n\n\nsage should pick up your gp since it is first in PATH.\n\n>   2. Is the version going to be updated regularly to the current development version of pari?\n\nI don't think that is a good idea. Development versions are not for \"production\" use. Instead you could ask upstream for a release or suggest to them to release bugfixes in point releases.",
    "created_at": "2018-09-07T09:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357103",
    "user": "@timokau"
}
```

Replying to [comment:71 cremona]:
> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.
> 
>   1. Is there a better way?

sage sets its `PATH` in `sage-env`. After setting that it sources `~/.sage/sagerc` if available. So if you create that file with the following contents:


```
export PATH="<insert path to local build of gp here>/bin:$PATH"
```


sage should pick up your gp since it is first in PATH.

>   2. Is the version going to be updated regularly to the current development version of pari?

I don't think that is a good idea. Development versions are not for "production" use. Instead you could ask upstream for a release or suggest to them to release bugfixes in point releases.



---

archive/issue_comments_357104.json:
```json
{
    "body": "In the long run you may also be interested in #24919.",
    "created_at": "2018-09-07T09:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357104",
    "user": "@timokau"
}
```

In the long run you may also be interested in #24919.



---

archive/issue_comments_357105.json:
```json
{
    "body": "Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).\n\nOf course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.",
    "created_at": "2018-09-07T10:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357105",
    "user": "cremona"
}
```

Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).

Of course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.



---

archive/issue_comments_357106.json:
```json
{
    "body": "Replying to [comment:76 cremona]:\n> Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).\n\nIn that case the current solution or one through #24919 is probably best.\n\n> Of course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.\n\nYes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.",
    "created_at": "2018-09-07T10:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357106",
    "user": "@timokau"
}
```

Replying to [comment:76 cremona]:
> Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).

In that case the current solution or one through #24919 is probably best.

> Of course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.

Yes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.



---

archive/issue_comments_357107.json:
```json
{
    "body": "Replying to [comment:77 gh-timokau]:\n> Yes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.\n\nWe can ask, but it probably won't happen just because we ask.",
    "created_at": "2018-09-07T14:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357107",
    "user": "jdemeyer"
}
```

Replying to [comment:77 gh-timokau]:
> Yes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.

We can ask, but it probably won't happen just because we ask.



---

archive/issue_comments_357108.json:
```json
{
    "body": "We should still ask. Even if it doesn't happen, they may have good reasons for that and explain them.",
    "created_at": "2018-09-07T15:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357108",
    "user": "@timokau"
}
```

We should still ask. Even if it doesn't happen, they may have good reasons for that and explain them.



---

archive/issue_comments_357109.json:
```json
{
    "body": "Bother `@`jdemeyer and I are in regular contact with the Pari developers anyway.",
    "created_at": "2018-09-07T15:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357109",
    "user": "cremona"
}
```

Bother `@`jdemeyer and I are in regular contact with the Pari developers anyway.



---

archive/issue_comments_357110.json:
```json
{
    "body": "Having the reasons public would be better. Some explanation why the state of that particular comment is good enough for sage but not good enough for pari's upstream.\n\nAll that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.",
    "created_at": "2018-09-07T15:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357110",
    "user": "@timokau"
}
```

Having the reasons public would be better. Some explanation why the state of that particular comment is good enough for sage but not good enough for pari's upstream.

All that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.



---

archive/issue_comments_357111.json:
```json
{
    "body": "Replying to [comment:81 gh-timokau]:\n> All that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.\n\nIt's not the case yet, but judging from past experiences, this is likely to happen.",
    "created_at": "2018-09-07T18:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25330",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25330#issuecomment-357111",
    "user": "jdemeyer"
}
```

Replying to [comment:81 gh-timokau]:
> All that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.

It's not the case yet, but judging from past experiences, this is likely to happen.
