# Issue 25330: Upgrade to pari-2.10.0.alpha

Issue created by migration from https://trac.sagemath.org/ticket/25567

Original creator: jdemeyer

Original creation time: 2018-06-12 21:34:58

CC:  fbissey cremona @timokau frederichan

*Tarball*: https://pari.math.u-bordeaux.fr/pub/pari/unstable/pari-2.10.0.alpha.tar.gz


---

Comment by cremona created at 2018-06-13 09:38:39

Sage input file which causes a pari crash with current Sage/Pari versino


---

Attachment

See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.
----
New commits:


---

Comment by git created at 2018-06-13 10:15:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-06-13 10:25:02

Replying to [comment:4 cremona]:
> See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.

I'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.


---

Comment by cremona created at 2018-06-13 11:38:42

Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 cremona]:
> > See the attached file which crashes using 8.1's pari version.  Testing suggests that this will be OK in 2.10.0.alpha, and this should be verified before this ticket is merged.
> 
> I'm not sure whether you would propose to add it as doctest, but I'd rather not since it takes quite a long time.

No, I agree.  But at least we could have an assertion on this ticket that it works, so that whoever reviews the ticket (or me) can test it manually.


---

Comment by jdemeyer created at 2018-06-13 13:08:07

Thanks to a Sage doctest, I found a genuine bug in the new PARI. So we'll need to wait for this to be fixed before we can proceed.


---

Comment by cremona created at 2018-06-13 13:17:16

I could not find pari bug 2055, but 2054 is possibly similar?


---

Comment by jdemeyer created at 2018-06-13 13:24:45

Replying to [comment:9 cremona]:
> I could not find pari bug 2055

It should be there now. Their bug tracker sometimes takes a few minutes to update.


---

Comment by git created at 2018-06-13 14:43:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-06-13 14:57:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-06-13 14:58:50

So I ran all doctests and found 3 independent new bugs in PARI. One was already fixed in master, I reported two and one of those is already fixed. So this ticket is essentially "needs review" modulo the `elleta` issue.


---

Comment by git created at 2018-06-14 08:55:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-06-14 08:57:07

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-06-27 06:16:10

Just for information, the doctest in heegner is also touched by #25635.


---

Comment by jdemeyer created at 2018-07-08 21:02:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-07-09 07:17:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-07-09 07:27:19

Unfortunately, this breaks cypari2:

```
[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_232_nf_nfzk':
[cypari-1.1.4]     cypari2/gen.c:157941:3: error: too many arguments to function 'nf_nfzk'
[cypari-1.1.4]        nf_nfzk(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, (&__pyx_v_zknf), (&__pyx_v_czknf));
[cypari-1.1.4]        ^~~~~~~
[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,
[cypari-1.1.4]                      from cypari2/gen.c:599:
[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2329:5: note: declared here
[cypari-1.1.4]      GEN     nf_nfzk(GEN nf, GEN rnfeq);
[cypari-1.1.4]          ^~~~~~~
[cypari-1.1.4]     cypari2/gen.c: In function '__pyx_pf_7cypari2_3gen_3Gen_234_nfeltup':
[cypari-1.1.4]     cypari2/gen.c:158154:60: error: too many arguments to function 'nfeltup'
[cypari-1.1.4]        __pyx_t_1 = ((PyObject *)__pyx_f_7cypari2_5stack_new_gen(nfeltup(__pyx_v_self->__pyx_base.g, __pyx_v_t0->__pyx_base.g, __pyx_v_t1->__pyx_base.g, __pyx_v_t2->__pyx_base.g))); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 4064, __pyx_L1_error)
[cypari-1.1.4]                                                                 ^~~~~~~
[cypari-1.1.4]     In file included from ../../usr/local/src/sage-config/local/include/pari/pari.h:45:0,
[cypari-1.1.4]                      from cypari2/gen.c:599:
[cypari-1.1.4]     ../../usr/local/src/sage-config/local/include/pari/paridecl.h:2332:5: note: declared here
[cypari-1.1.4]      GEN     nfeltup(GEN nf, GEN x, GEN zknf);
[cypari-1.1.4]          ^~~~~~~
```



---

Comment by git created at 2018-07-10 15:08:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-13 11:50:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-13 13:08:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-13 14:20:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-07-13 14:24:36

Changing status from needs_work to needs_review.


---

Comment by @timokau created at 2018-07-23 11:44:23

[pari-2.11.0 (STABLE) released !](http://pari.math.u-bordeaux.fr/archives/pari-announce-18/msg00006.html)

Should we instead update to that or first update to beta and then follow up?


---

Comment by jdemeyer created at 2018-07-23 11:48:13

Changing status from needs_review to needs_work.


---

Comment by @timokau created at 2018-07-23 12:00:51

I'm experiencing a giac test failure when I update the pari nix package. I'm not sure yet if its actually caused by the pari update, the giac test suite seems somewhat non-deterministic. I'll investigate and report upstream if it is relevant.


---

Comment by @timokau created at 2018-07-23 12:44:04

Seems like I get the failure


```
13c13
< 1,
---
> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
FAIL: chk_fhan11
```


when updating pari. The latest version of giac (1.4.9-69) unfortunately doesn't fix this but instead introduces one more failure:


```
35c35
< 2/3*sign(a)*asin(sqrt(x)*x/sqrt(a)/a),
---
> 2/3*asin(sqrt(x)*x/sqrt(a)/a)*sign(a),
FAIL: chk_integrate
```


I'll have to wait until my upstream forum account is approved until I can report.


---

Comment by git created at 2018-07-26 10:44:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-07-26 10:55:07

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-07-26 11:57:21

Replying to [comment:35 gh-timokau]:
> Seems like I get the failure
> 
> {{{
> 13c13
> < 1,
> ---
> > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
> FAIL: chk_fhan11
> }}}
> 
> when updating pari.

Did you report that upstream?

I analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.

The test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.


---

Comment by @timokau created at 2018-07-26 12:36:59

Replying to [comment:38 jdemeyer]:
> Replying to [comment:35 gh-timokau]:
> > Seems like I get the failure
> > 
> > {{{
> > 13c13
> > < 1,
> > ---
> > > matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
> > FAIL: chk_fhan11
> > }}}
> > 
> > when updating pari.
> 
> Did you report that upstream?

The only contact info I found was that [forum](https://xcas.univ-grenoble-alpes.fr/forum/) and I'm still waiting for my account to be approved. I think I accidentally chose the wrong option at the age question (doesn't help that the forum is in french). I sent an email to the administrators, no reply yet.

If you want to try, maybe you have more luck. I wish they'd just use some issue tracker or plain old email.

> I analyzed the problem and the problem happens because the output of `isprime(p, 1)` changed from returning a primality certificate to a boolean answer. There is now a separate function `primecert()` for getting a certificate.
> 
> The test directly checks the PARI interface, but otherwise these primality certificates are not used by anything in giac. So while the test fails, nothing else in giac should fail because of this.

Great, thanks for analyzing this :)

Should we then adapt / disable giac's `spkg-check` until this is fixed? Or is it okay for those spkg checks to fail?


---

Comment by jdemeyer created at 2018-07-26 13:12:11

Replying to [comment:39 gh-timokau]:
> I wish they'd just use some issue tracker or plain old email.

More generally, their website is a mess... Even finding the source tarballs is hard. And that page has `debian` in its name even though these are just the sources: https://www-fourier.ujf-grenoble.fr/~parisse/debian/dists/stable/main/source/

I just recall now that `@`frederichan is a Giac developer and usually all bug reports from Sage go through him. ​Frederic: if you missed the discussion, the upgrade to PARI/GP breaks one test from Giac:

```
13c13
< 1,
---
> matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix>
FAIL: chk_fhan11
```

See [comment:38] for the analysis.


---

Comment by frederichan created at 2018-07-26 15:31:08

I have reported this here: 
https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326

As this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?


```
--- a/check/TP11-sol.cas.out1	2018-07-26 17:12:30.516949491 +0200
+++ b/check/TP11-sol.cas.out1	2018-07-26 17:13:04.397032363 +0200
@@ -10,7 +10,7 @@
 1073741824000000000000000000061203284109000000000000000000000000008409,
 2^3*3*389*733*156904374622257604823879982847602392900751802349981470895277241,
 "Done",
-matrix[[2,7,1],[3,2,1],[389,2,1],[733,2,1],[156904374622257604823879982847602392900751802349981470895277241,2,matrix[[2,13,1],[3,3,1],[5,2,1],[7,2,1],[56467,2,1],[6553084925887974620811527,2,matrix[[2,5,1],[19,2,1],[71,2,1],[126823,2,1]]]]]],
+1,
 0,
 [],
 1,
```

best
Frederic


---

Comment by @timokau created at 2018-07-26 15:52:22

Thanks for reporting! If the test really just tests the pari interface without ever using that part of the interface, I'd just remove the test instead.

Not quite relevant to this ticket, but could you report the `chk_integrate` failure too? [the test failure is here](https://trac.sagemath.org/ticket/25567#comment:35). That occurs when I update giac from 1.4.9-59 to 1.4.9-69 (without changing anything else).


---

Comment by jdemeyer created at 2018-07-26 18:22:42

Replying to [comment:41 frederichan]:
> I have reported this here: 
> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2102#p10326
> 
> As this example is just calling the pari function, patching the output with the new behaviour looks natural, something like this?

Depends whether you want to want the tests to pass on older PARI versions too. Personally, I would just remove the test completely.


---

Comment by @timokau created at 2018-07-26 22:03:31

`@`frederichan also not really relevant for this ticket, but lacking another communication channel: Apparently the nix maintainer for giac also already requested a forum account last yer and never got it: https://github.com/NixOS/nixpkgs/pull/44129#issuecomment-408203217

Regarding this ticket: I don't know how the review process works, but LGTM. I haven't run the doctests yet though.


---

Comment by jdemeyer created at 2018-07-27 07:12:12

Replying to [comment:44 gh-timokau]:
> I don't know how the review process works

Just a general reply:

- look at the diff and see whether it makes sense.
- Sage cares a lot about tests, so check whether the code is well tested.
- check the patchbot (the colored blob at the top of the page).
- maybe try a few examples, test corner cases in the code.
- if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).

In this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.


---

Comment by frederichan created at 2018-07-27 08:21:00

I have also reported chk_integrate here:
https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104

Indeed my giac/xcas forum account is old, to obtain one I think the safest is a direct mail to Bernard Parisse:
https://www-fourier.ujf-grenoble.fr/?q=fr/content/annuaire
(he may be in vacation at this time). He also have a trac account: parisse

(cf #25822#comment:12)

Regarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.

For a sage package where you always have pari you may decide to suppress it.

NB: if you plan to upgrade giac package, 1.4.6.69 is not enough to fix #25822 but the next stable should be.


---

Comment by @timokau created at 2018-07-27 11:14:19

Replying to [comment:45 jdemeyer]:
> Replying to [comment:44 gh-timokau]:
> > I don't know how the review process works
> 
> Just a general reply:
> 
> - look at the diff and see whether it makes sense.

Did that. While I won't pretend all the math, the changes look very reasonable to me. No obviously wrong results and I think we can trust pari with the details.

Two things that stuck out to me though:


```
sage: a.multiplicative_order()
-        4547473508864641189575195312
+        189478062869360049565633138
```



```
             sage: O3.absolute_discriminant()
-            8643600
+            400160824478095086350656915693814563600
```


I would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique. But again, my knowledge is limited.

> - Sage cares a lot about tests, so check whether the code is well tested.

check

> - check the patchbot (the colored blob at the top of the page).

Oh, I've always wondered what exactly the patchbot is everybody is talking about.

> - maybe try a few examples, test corner cases in the code.
> - if all is well: set the ticket to positive_review and add your real name as Reviewer on the Trac page. At that point, the release manager will merge the ticket in some later beta/rc release (assuming that all dependencies are merged).

But can anybody just do that?

> In this case, this is a package upgrade, which is a bit different. The patchbot doesn't test it, so somebody should manually run the full Sage testsuite. If you want to take my word for it, I did that and tests passed.

Why doesn't the patchbot test package upgrades? I think if we can just take anybody's word for it, its probably yours.


Replying to [comment:46 frederichan]:
> I have also reported chk_integrate here:
> https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=4&t=2104

Thanks :)

> Regarding the testsuite, although many files have my name I didn't wrote them for a testsuite so they are often too sensitive. But I think (this was often the case in the past) that bernard prefers to keep many examples and look if the changes are bugs or not. In this particular example, there are not so many giac functions that can't be run without pari (ex: ifactor still works in giac without pari), so I guess that bernard will keep this test.

A very brittle test suite is at risk of just being ignored after a few false-positives. I think a few high-value tests are way more valuable than testing the literal output of every function. Sage has a bit of the same problem in my opinion.

> For a sage package where you always have pari you may decide to suppress it.

For now I just did `echo > check/chk_fhan11`. Its not that easy to disable an individual test.


---

Comment by jdemeyer created at 2018-08-01 11:24:16

Replying to [comment:47 gh-timokau]:
> Two things that stuck out to me though:
> 
> {{{
> sage: a.multiplicative_order()
> -        4547473508864641189575195312
> +        189478062869360049565633138
> }}}
> 
> {{{
>              sage: O3.absolute_discriminant()
> -            8643600
> +            400160824478095086350656915693814563600
> }}}
> 
> I would've thought that both the multiplicative order and the absolute discriminant are supposed to be unique.

The multiplicative order is certainly unique, but the _element_ `a` that we're taking the order of is different.

In the second case, I changed the test input because PARI got more clever in computing orders. We need the large primes `1000003` and `1000099` to make it more difficult for PARI to accidentally find the maximal order.

> > - check the patchbot (the colored blob at the top of the page).
> 
> Oh, I've always wondered what exactly the patchbot is everybody is talking about.

It's what Sage uses for continuous integration. It's far from perfect and there is a proposal to replace it: #24854

> But can anybody just do that?

Yes, anybody can do that. This process seems to be working fine.

> Why doesn't the patchbot test package upgrades?

Good question actually, I don't know the answer.


---

Comment by @timokau created at 2018-08-04 15:42:38

Changing status from needs_review to positive_review.


---

Comment by @timokau created at 2018-08-04 15:42:38

Oh, I didn't notice that you also changed the test input.


---

Comment by tscrim created at 2018-08-04 22:20:11

Reviewer name.


---

Comment by vbraun created at 2018-08-05 18:14:52

FWIW the testsuite fails on kucalc (linux 64-bit):

```
* Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   
```



---

Comment by vbraun created at 2018-08-05 22:55:06

Pretty sure this is due to pari on 32-bit linux:

```
File "src/sage/schemes/elliptic_curves/period_lattice.py", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm
Failed example:
    L.elliptic_exponential(_)
Expected:
    (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)
Got:
    (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)
```


I also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)


---

Comment by vbraun created at 2018-08-05 22:57:10

PS: the patchbot doesn't test package updates since it doesn't have a programmatic way of downloading tarballs, also patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.


---

Comment by jdemeyer created at 2018-08-06 08:02:41

So should this be set to needs_work then?


---

Comment by cremona created at 2018-08-06 08:11:02

Replying to [comment:53 vbraun]:
> Pretty sure this is due to pari on 32-bit linux:
> {{{
> File "src/sage/schemes/elliptic_curves/period_lattice.py", line 1463, in sage.schemes.elliptic_curves.period_lattice.PeriodLattice_ell.elliptic_logarithm
> Failed example:
>     L.elliptic_exponential(_)
> Expected:
>     (3.00000000000000000000000000... : 5.00000000000000000000000000... : 1.000000000000000000000000000)
> Got:
>     (3.000000000000000000000000000 : 4.999999999999999999999999999 : 1.000000000000000000000000000)
> }}}

That makes sense.  In line 1773 the pari function ellwp() is called (in the method elliptic_exponential())  and that is what does the work for this.

> 
> I also get a lot of buildbots with giac testsuite failures, this might also be due to the pari udpate. I'll test some more... (edit: i see its already noted here)


---

Comment by vbraun created at 2018-08-06 08:24:03

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-08-06 08:24:03

Also I'd appreciate it if the giac testsuite could be worked around, otherwise I'll have to disabled it on the buildbot and, realistically, I'll never turn it back on.


---

Comment by git created at 2018-08-06 09:41:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-08-06 14:59:39

Replying to [comment:54 vbraun]:
> patchbot does incremental rebuilds which are likely to get hosed if something is wrong with the ticket.

That's true for any ticket. I don't believe that package upgrades are the tickets most likely to cause breakage of the patchbot.


---

Comment by jdemeyer created at 2018-08-07 14:41:25

Replying to [comment:52 vbraun]:
> FWIW the testsuite fails on kucalc (linux 64-bit):
> {{{
> * Testing galpol           gp-sta..BUG [2116]   gp-dyn..BUG [2220]   
> }}}

Fixed by #26010.


---

Comment by jdemeyer created at 2018-08-07 14:41:55

Replying to [comment:53 vbraun]:
> Pretty sure this is due to pari on 32-bit linux:

Fixed by adding some doctest tolerance.


---

Comment by git created at 2018-08-07 14:47:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-08-07 15:18:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-08-07 15:18:47

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-08-20 10:46:09

Ping? It would be nice to review this again. I recall that it had positive_review before. So this would need reviewing the dependency #26010 and the few added commits.


---

Comment by git created at 2018-08-22 15:04:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-08-22 15:07:29

Rebased to latest version of #26010.


---

Comment by vbraun created at 2018-08-22 23:45:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-26 09:37:59

Resolution: fixed


---

Comment by cremona created at 2018-09-07 08:29:56

Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.

  1. Is there a better way?
  2. Is the version going to be updated regularly to the current development version of pari?


---

Comment by fbissey created at 2018-09-07 08:36:17

Replying to [comment:71 cremona]:
> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.
> 
>   1. Is there a better way?

As far as I can say that's quick and slightly dirty but probably not too much. I think the best way would be for your code to look for a variable, say `GP_EXEC`, and use its value as the `gp` executable if it exists. You can then put that in your environment and only your code is ever affected and you don't need to mess up with the link.


---

Comment by cremona created at 2018-09-07 09:04:47

I thought of something like that but the Gp() constructor for a new gp interpreter does not allow the user to specify the interpreter's path explicitly.  It calls `Expect.__init__` with 
`command="gp --fast --emacs --quiet --stacksize %s"%stacksize`
so that relies on picking up gp from Sage's path.

Am I missing something?  I am using a personal Sage build rather than messing with the system-wide one.


---

Comment by @timokau created at 2018-09-07 09:28:17

Replying to [comment:71 cremona]:
> Since the release of 2.11 there have been several bug-fixes which are important for my current work.  Some of the new mf* functions crash on 2.11.0 but run fine with the current development commit.  What I am currently doing is building this development gp executable outside Sage and manually changing the link  SAGE_ROOT/local/bin/gp to point to that.  (My code is only using gp.eval(), not Pari library functions.
> 
>   1. Is there a better way?

sage sets its `PATH` in `sage-env`. After setting that it sources `~/.sage/sagerc` if available. So if you create that file with the following contents:


```
export PATH="<insert path to local build of gp here>/bin:$PATH"
```


sage should pick up your gp since it is first in PATH.

>   2. Is the version going to be updated regularly to the current development version of pari?

I don't think that is a good idea. Development versions are not for "production" use. Instead you could ask upstream for a release or suggest to them to release bugfixes in point releases.


---

Comment by @timokau created at 2018-09-07 09:29:29

In the long run you may also be interested in #24919.


---

Comment by cremona created at 2018-09-07 10:19:46

Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).

Of course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.


---

Comment by @timokau created at 2018-09-07 10:45:48

Replying to [comment:76 cremona]:
> Thanks for the suggestion in 1 which is certainly cleaner than whan I was doing.  As for 2, it is a matter of terminology what is production and what is testing.  The work I am doing is effectively a massive test of the new modular forms functionality in Pari/GP, and I am finding bugs which upstream Pari is fixing.  But I am doing the testing using calls from Sage since using gp itself is much harder, especially when I get to compare the results with the output of a different package (hint: one of the 3 Ms).

In that case the current solution or one through #24919 is probably best.

> Of course that is not to say that Sage should be repeatedly changing to the latest pari commit; however pari releases come around rather too infrequently.

Yes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.


---

Comment by jdemeyer created at 2018-09-07 14:21:37

Replying to [comment:77 gh-timokau]:
> Yes that is true. But if there is something upstream we need, we should at least ask them for a release before deciding to just fetch some unstable commit.

We can ask, but it probably won't happen just because we ask.


---

Comment by @timokau created at 2018-09-07 15:24:06

We should still ask. Even if it doesn't happen, they may have good reasons for that and explain them.


---

Comment by cremona created at 2018-09-07 15:31:07

Bother `@`jdemeyer and I are in regular contact with the Pari developers anyway.


---

Comment by @timokau created at 2018-09-07 15:42:52

Having the reasons public would be better. Some explanation why the state of that particular comment is good enough for sage but not good enough for pari's upstream.

All that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.


---

Comment by jdemeyer created at 2018-09-07 18:48:07

Replying to [comment:81 gh-timokau]:
> All that is hypothetical in the case that pari adds important features that we need in sage and they refuse to make a release including them in reasonable time. As far as I understand, that is not the case yet.

It's not the case yet, but judging from past experiences, this is likely to happen.
