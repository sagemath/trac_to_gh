# Issue 25813: zn_poly breaks Cygwin64 build

archive/issues_025813.json:
```json
{
    "body": "CC:  @embray @tscrim\n\nKeywords: zn_poly, build, ld, gcc\n\nsage 8.4beta0 fails to compile on my cygwin, even after a distclean, because \"ld: cannot find -lzn_poly\". This happens at the sagelib compilation stage (zn_poly itself seems to have installed correctly; at least sage doesn't let me install it again):\n\n\n```\n[sagelib-8.4.beta0] [  1/184] gcc -I/usr/include/ncurses -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -I./sage/libs/ntl -I/home/skraeling/sage/local/lib/python2.7/site-packages/cypari2 -I/home/skraeling/sage/local/include -I/home/skraeling/sage/local/include/python2.7 -I/home/skraeling/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/skraeling/sage/src -I/home/skraeling/sage/src/sage/ext -Ibuild/cythonized -I/home/skraeling/sage/local/include/python2.7 -c build/cythonized/sage/modular/pollack_stevens/dist.c -o build/temp.cygwin-2.10.0-x86_64-2.7/build/cythonized/sage/modular/pollack_stevens/dist.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -D_XPG6 -std=gnu99\n[sagelib-8.4.beta0] gcc -shared -Wl,--enable-auto-image-base -L/home/skraeling/sage/local/lib -Wl,-rpath,/home/skraeling/sage/local/lib -L/home/skraeling/sage/local/lib -Wl,-rpath,/home/skraeling/sage/local/lib build/temp.cygwin-2.10.0-x86_64-2.7/build/cythonized/sage/modular/pollack_stevens/dist.o -L/home/skraeling/sage/local/lib -L/home/skraeling/sage/local/lib/python2.7/config -L/home/skraeling/sage/local/lib -lflint -lgmp -lzn_poly -lpython2.7 -o build/lib.cygwin-2.10.0-x86_64-2.7/sage/modular/pollack_stevens/dist.dll\n[sagelib-8.4.beta0] /usr/lib/gcc/x86_64-pc-cygwin/7.3.0/../../../../x86_64-pc-cygwin/bin/ld: cannot find -lzn_poly\n```\n\n\nReverting #25085 fixes the bug on my machine.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26050\n\n",
    "created_at": "2018-08-12T14:19:17Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "zn_poly breaks Cygwin64 build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25813",
    "user": "https://github.com/darijgr"
}
```
CC:  @embray @tscrim

Keywords: zn_poly, build, ld, gcc

sage 8.4beta0 fails to compile on my cygwin, even after a distclean, because "ld: cannot find -lzn_poly". This happens at the sagelib compilation stage (zn_poly itself seems to have installed correctly; at least sage doesn't let me install it again):


```
[sagelib-8.4.beta0] [  1/184] gcc -I/usr/include/ncurses -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I./sage/cpython -I./sage/libs/ntl -I/home/skraeling/sage/local/lib/python2.7/site-packages/cypari2 -I/home/skraeling/sage/local/include -I/home/skraeling/sage/local/include/python2.7 -I/home/skraeling/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/skraeling/sage/src -I/home/skraeling/sage/src/sage/ext -Ibuild/cythonized -I/home/skraeling/sage/local/include/python2.7 -c build/cythonized/sage/modular/pollack_stevens/dist.c -o build/temp.cygwin-2.10.0-x86_64-2.7/build/cythonized/sage/modular/pollack_stevens/dist.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -D_XPG6 -std=gnu99
[sagelib-8.4.beta0] gcc -shared -Wl,--enable-auto-image-base -L/home/skraeling/sage/local/lib -Wl,-rpath,/home/skraeling/sage/local/lib -L/home/skraeling/sage/local/lib -Wl,-rpath,/home/skraeling/sage/local/lib build/temp.cygwin-2.10.0-x86_64-2.7/build/cythonized/sage/modular/pollack_stevens/dist.o -L/home/skraeling/sage/local/lib -L/home/skraeling/sage/local/lib/python2.7/config -L/home/skraeling/sage/local/lib -lflint -lgmp -lzn_poly -lpython2.7 -o build/lib.cygwin-2.10.0-x86_64-2.7/sage/modular/pollack_stevens/dist.dll
[sagelib-8.4.beta0] /usr/lib/gcc/x86_64-pc-cygwin/7.3.0/../../../../x86_64-pc-cygwin/bin/ld: cannot find -lzn_poly
```


Reverting #25085 fixes the bug on my machine.

Issue created by migration from https://trac.sagemath.org/ticket/26050





---

archive/issue_comments_363936.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-08-13T11:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363936",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_363937.json:
```json
{
    "body": "Thanks, I'll look into it.  I think I see what the problem might be.\n\nI didn't have any problems with this, but it looks like I still have an old `libzn_poly-0.9.so` hanging out in my `$SAGE_LOCAL/lib`.  That *should* have been cleaned away but it wasn't--it appears the zn_poly package doesn't do anything to clean up old versions.  So building from scratch would still fail.",
    "created_at": "2018-08-13T11:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363937",
    "user": "https://github.com/embray"
}
```

Thanks, I'll look into it.  I think I see what the problem might be.

I didn't have any problems with this, but it looks like I still have an old `libzn_poly-0.9.so` hanging out in my `$SAGE_LOCAL/lib`.  That *should* have been cleaned away but it wasn't--it appears the zn_poly package doesn't do anything to clean up old versions.  So building from scratch would still fail.



---

archive/issue_comments_363938.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2018-09-06T12:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363938",
    "user": "https://github.com/embray"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_363939.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-06T13:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363939",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_363940.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-06T13:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363940",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_363941.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-07T13:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363941",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_363942.json:
```json
{
    "body": "There is still a problem, which is that since the build outputs the libzn_poly DLL as `libzn_poly-0.9.so`, that is also set to its DLL name in the binary; simply renaming the file to `cygzn_poly.dll` when moving it does not change this, so modules linked to it are still looking for a `libzn_poly-0.9.so`.  Really need to fix that.",
    "created_at": "2018-09-07T13:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363942",
    "user": "https://github.com/embray"
}
```

There is still a problem, which is that since the build outputs the libzn_poly DLL as `libzn_poly-0.9.so`, that is also set to its DLL name in the binary; simply renaming the file to `cygzn_poly.dll` when moving it does not change this, so modules linked to it are still looking for a `libzn_poly-0.9.so`.  Really need to fix that.



---

archive/issue_comments_363943.json:
```json
{
    "body": "It seems the `-soname` flag for GNU `ld` has no impact on the DLL name used in DLL export sections, only the actual output filename.\n\nDoes anyone know the most recent status of zn_poly?  According to http://web.maths.unsw.edu.au/~davidharvey/code/zn_poly/ it is \"no longer maintained\".  Should we just make a new upstream repo for it and become its maintainers?",
    "created_at": "2018-09-07T13:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363943",
    "user": "https://github.com/embray"
}
```

It seems the `-soname` flag for GNU `ld` has no impact on the DLL name used in DLL export sections, only the actual output filename.

Does anyone know the most recent status of zn_poly?  According to http://web.maths.unsw.edu.au/~davidharvey/code/zn_poly/ it is "no longer maintained".  Should we just make a new upstream repo for it and become its maintainers?



---

archive/issue_comments_363944.json:
```json
{
    "body": "Thanks for doing this, Erik!",
    "created_at": "2018-09-10T14:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363944",
    "user": "https://github.com/darijgr"
}
```

Thanks for doing this, Erik!



---

archive/issue_comments_363945.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-10T15:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363945",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_363946.json:
```json
{
    "body": "New upstream tarball for an 0.9.1 release candidate based on https://gitlab.com/sagemath/zn_poly  \n\nIf this works in Sage then I'll \"release\" it for real.\n\nThe new tarball has all the previous patches from Sage applied, and few other changes besides that.  It also contains improved Cygwin build support so this remains a blocker for fixing the Cygwin build.\n----\nNew commits:",
    "created_at": "2018-09-10T15:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363946",
    "user": "https://github.com/embray"
}
```

New upstream tarball for an 0.9.1 release candidate based on https://gitlab.com/sagemath/zn_poly  

If this works in Sage then I'll "release" it for real.

The new tarball has all the previous patches from Sage applied, and few other changes besides that.  It also contains improved Cygwin build support so this remains a blocker for fixing the Cygwin build.
----
New commits:



---

archive/issue_comments_363947.json:
```json
{
    "body": "Darij, does this work for you? I am ready to set this to a positive review.",
    "created_at": "2018-09-16T04:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363947",
    "user": "https://github.com/tscrim"
}
```

Darij, does this work for you? I am ready to set this to a positive review.



---

archive/issue_comments_363948.json:
```json
{
    "body": "Ouch, I forgot to check. Await an answer in a day or longer (Cygwin full compiles aren't a laughing matter).",
    "created_at": "2018-09-16T04:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363948",
    "user": "https://github.com/darijgr"
}
```

Ouch, I forgot to check. Await an answer in a day or longer (Cygwin full compiles aren't a laughing matter).



---

archive/issue_comments_363949.json:
```json
{
    "body": "Hmm :(\n\n\n```\n[zn_poly-0.9.1] http://sagepad.org/spkg/upstream/zn_poly/zn_poly-0.9.1.tar.gz\n[zn_poly-0.9.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[zn_poly-0.9.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/zn_poly/zn_poly-0.9.1.tar.gz'\n[zn_poly-0.9.1] Traceback (most recent call last):\n[zn_poly-0.9.1]   File \"/home/skraeling/sage/build/bin/sage-download-file\", line 28, in <module>\n[zn_poly-0.9.1]     run_safe()\n[zn_poly-0.9.1]   File \"/home/skraeling/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 118, in run_safe\n[zn_poly-0.9.1]     run()\n[zn_poly-0.9.1]   File \"/home/skraeling/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 100, in run\n[zn_poly-0.9.1]     app.download_tarball(args.url_or_tarball, args.destination)\n[zn_poly-0.9.1]   File \"/home/skraeling/sage/build/bin/../sage_bootstrap/download/app.py\", line 43, in download_tarball\n[zn_poly-0.9.1]     tarball.download()\n[zn_poly-0.9.1]   File \"/home/skraeling/sage/build/bin/../sage_bootstrap/tarball.py\", line 162, in download\n[zn_poly-0.9.1]     raise FileNotMirroredError('tarball does not exist on mirror network')\n[zn_poly-0.9.1] sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n[zn_poly-0.9.1] ************************************************************************\n[zn_poly-0.9.1] Error downloading zn_poly-0.9.1.tar.gz\n[zn_poly-0.9.1] ************************************************************************\n[zn_poly-0.9.1] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[zn_poly-0.9.1] explaining the problem and including the log file\n[zn_poly-0.9.1]   /home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log\n[zn_poly-0.9.1] Describe your computer, operating system, etc.\n[zn_poly-0.9.1] ************************************************************************\nmake[3]: *** [Makefile:2099: /home/skraeling/sage/local/var/lib/sage/installed/zn_poly-0.9.1] Error 1\nmake[3]: Leaving directory '/home/skraeling/sage/build/make'\nmake[2]: *** [Makefile:1792: all-build] Error 2\nmake[2]: Leaving directory '/home/skraeling/sage/build/make'\n\nreal    195m21.143s\nuser    101m24.436s\nsys     49m44.530s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make all-build'):\n\n* package: zn_poly-0.9.1\n  log file: /home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log\n  build directory: /home/skraeling/sage/local/var/tmp/sage/build/zn_poly-0.9.1\n\nThe build directory may contain configuration files and other potentially\nhelpful information. WARNING: if you now run 'make' again, the build\ndirectory will, by default, be deleted. Set the environment variable\nSAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.\n\nmake[1]: *** [Makefile:33: all-build] Error 1\nmake[1]: Leaving directory '/home/skraeling/sage'\nmake: *** [Makefile:16: build] Error 2\n```\n\n\nThis is with your branch merged into 8.4.beta5. But at least this looks like an easy one to fix.",
    "created_at": "2018-09-16T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363949",
    "user": "https://github.com/darijgr"
}
```

Hmm :(


```
[zn_poly-0.9.1] http://sagepad.org/spkg/upstream/zn_poly/zn_poly-0.9.1.tar.gz
[zn_poly-0.9.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[zn_poly-0.9.1] ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/zn_poly/zn_poly-0.9.1.tar.gz'
[zn_poly-0.9.1] Traceback (most recent call last):
[zn_poly-0.9.1]   File "/home/skraeling/sage/build/bin/sage-download-file", line 28, in <module>
[zn_poly-0.9.1]     run_safe()
[zn_poly-0.9.1]   File "/home/skraeling/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 118, in run_safe
[zn_poly-0.9.1]     run()
[zn_poly-0.9.1]   File "/home/skraeling/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 100, in run
[zn_poly-0.9.1]     app.download_tarball(args.url_or_tarball, args.destination)
[zn_poly-0.9.1]   File "/home/skraeling/sage/build/bin/../sage_bootstrap/download/app.py", line 43, in download_tarball
[zn_poly-0.9.1]     tarball.download()
[zn_poly-0.9.1]   File "/home/skraeling/sage/build/bin/../sage_bootstrap/tarball.py", line 162, in download
[zn_poly-0.9.1]     raise FileNotMirroredError('tarball does not exist on mirror network')
[zn_poly-0.9.1] sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
[zn_poly-0.9.1] ************************************************************************
[zn_poly-0.9.1] Error downloading zn_poly-0.9.1.tar.gz
[zn_poly-0.9.1] ************************************************************************
[zn_poly-0.9.1] Please email sage-devel (http://groups.google.com/group/sage-devel)
[zn_poly-0.9.1] explaining the problem and including the log file
[zn_poly-0.9.1]   /home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log
[zn_poly-0.9.1] Describe your computer, operating system, etc.
[zn_poly-0.9.1] ************************************************************************
make[3]: *** [Makefile:2099: /home/skraeling/sage/local/var/lib/sage/installed/zn_poly-0.9.1] Error 1
make[3]: Leaving directory '/home/skraeling/sage/build/make'
make[2]: *** [Makefile:1792: all-build] Error 2
make[2]: Leaving directory '/home/skraeling/sage/build/make'

real    195m21.143s
user    101m24.436s
sys     49m44.530s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all-build'):

* package: zn_poly-0.9.1
  log file: /home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log
  build directory: /home/skraeling/sage/local/var/tmp/sage/build/zn_poly-0.9.1

The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.

make[1]: *** [Makefile:33: all-build] Error 1
make[1]: Leaving directory '/home/skraeling/sage'
make: *** [Makefile:16: build] Error 2
```


This is with your branch merged into 8.4.beta5. But at least this looks like an easy one to fix.



---

archive/issue_comments_363950.json:
```json
{
    "body": "You need to manually download the tar ball and put it in your upstream folder. Is that what you did?",
    "created_at": "2018-09-16T20:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363950",
    "user": "https://github.com/tscrim"
}
```

You need to manually download the tar ball and put it in your upstream folder. Is that what you did?



---

archive/issue_comments_363951.json:
```json
{
    "body": "No; how does it work?=",
    "created_at": "2018-09-16T20:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363951",
    "user": "https://github.com/darijgr"
}
```

No; how does it work?=



---

archive/issue_comments_363952.json:
```json
{
    "body": "Download the tar file in the ticket description and put it in the \"$SAGE_ROOT/upstream\" flder. Then run make.",
    "created_at": "2018-09-16T21:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363952",
    "user": "https://github.com/tscrim"
}
```

Download the tar file in the ticket description and put it in the "$SAGE_ROOT/upstream" flder. Then run make.



---

archive/issue_comments_363953.json:
```json
{
    "body": "OK, I did, but it's still searching the web:\n\n```\nsage-logger -p 'sage-spkg zn_poly-0.9.1' '/home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log'\n[zn_poly-0.9.1] Found local metadata for zn_poly-0.9.1\n[zn_poly-0.9.1] Attempting to download package zn_poly-0.9.1.tar.gz from mirrors\n```\n",
    "created_at": "2018-09-16T21:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363953",
    "user": "https://github.com/darijgr"
}
```

OK, I did, but it's still searching the web:

```
sage-logger -p 'sage-spkg zn_poly-0.9.1' '/home/skraeling/sage/logs/pkgs/zn_poly-0.9.1.log'
[zn_poly-0.9.1] Found local metadata for zn_poly-0.9.1
[zn_poly-0.9.1] Attempting to download package zn_poly-0.9.1.tar.gz from mirrors
```




---

archive/issue_comments_363954.json:
```json
{
    "body": "Ooooh, it was a wget issue. Sorry.",
    "created_at": "2018-09-16T21:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363954",
    "user": "https://github.com/darijgr"
}
```

Ooooh, it was a wget issue. Sorry.



---

archive/issue_comments_363955.json:
```json
{
    "body": "It works! Thanks, Erik!\n\n(Note to future self: wget mangles .gz on download; use curl instead.)",
    "created_at": "2018-09-16T21:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363955",
    "user": "https://github.com/darijgr"
}
```

It works! Thanks, Erik!

(Note to future self: wget mangles .gz on download; use curl instead.)



---

archive/issue_comments_363956.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-16T22:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363956",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363957.json:
```json
{
    "body": "This causes massive breakage on incremental builds. Some modules link to libzn_poly-0.9.so which no longer exists:\n\n```\n$ ldd src/build/lib.linux-x86_64-2.7/sage/modular/pollack_stevens/dist.so\n\tlinux-vdso.so.1 (0x00007ffc8a5f8000)\n\tlibflint.so.13 => /mnt/disk/home/release/Sage/local/lib/libflint.so.13 (0x00007f70f46db000)\n\tlibgmp.so.23 => /mnt/disk/home/release/Sage/local/lib/libgmp.so.23 (0x00007f70f4467000)\n\tlibzn_poly-0.9.so => not found\n$ ll local/lib/libzn_poly*\n-rwxrwxr-x. 1 release release 527456 Sep 18 00:22 local/lib/libzn_poly-0.9.1.so\nlrwxrwxrwx. 1 release release     19 Sep 18 00:22 local/lib/libzn_poly.so -> libzn_poly-0.9.1.so\n```\n",
    "created_at": "2018-09-18T22:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363957",
    "user": "https://github.com/vbraun"
}
```

This causes massive breakage on incremental builds. Some modules link to libzn_poly-0.9.so which no longer exists:

```
$ ldd src/build/lib.linux-x86_64-2.7/sage/modular/pollack_stevens/dist.so
	linux-vdso.so.1 (0x00007ffc8a5f8000)
	libflint.so.13 => /mnt/disk/home/release/Sage/local/lib/libflint.so.13 (0x00007f70f46db000)
	libgmp.so.23 => /mnt/disk/home/release/Sage/local/lib/libgmp.so.23 (0x00007f70f4467000)
	libzn_poly-0.9.so => not found
$ ll local/lib/libzn_poly*
-rwxrwxr-x. 1 release release 527456 Sep 18 00:22 local/lib/libzn_poly-0.9.1.so
lrwxrwxrwx. 1 release release     19 Sep 18 00:22 local/lib/libzn_poly.so -> libzn_poly-0.9.1.so
```




---

archive/issue_comments_363958.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-18T22:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363958",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_363959.json:
```json
{
    "body": "I'm not sure I understand.  Shouldn't they just be rebuilt?",
    "created_at": "2018-09-19T14:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363959",
    "user": "https://github.com/embray"
}
```

I'm not sure I understand.  Shouldn't they just be rebuilt?



---

archive/issue_comments_363960.json:
```json
{
    "body": "Perhaps I'll just modify it so that the soname still uses \"0.9\" instead of \"0.9.1\".  After all, the ABI is identical so there's no reason to change it.\n\nBut really Sage should just be rebuilt.  It lists zn_poly as a dependency, but there's no mechanism to recompile/link all modules that depend on a library that changed...",
    "created_at": "2018-09-19T14:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363960",
    "user": "https://github.com/embray"
}
```

Perhaps I'll just modify it so that the soname still uses "0.9" instead of "0.9.1".  After all, the ABI is identical so there's no reason to change it.

But really Sage should just be rebuilt.  It lists zn_poly as a dependency, but there's no mechanism to recompile/link all modules that depend on a library that changed...



---

archive/issue_comments_363961.json:
```json
{
    "body": "Replying to [comment:21 embray]:\n> Perhaps I'll just modify it so that the soname still uses \"0.9\" instead of \"0.9.1\".  After all, the ABI is identical so there's no reason to change it.\n> \n> But really Sage should just be rebuilt.  It lists zn_poly as a dependency, but there's no mechanism to recompile/link all modules that depend on a library that changed...\n\nThat doesn't see like a good thing to do. What if there happens to be a major upgrade? A less-bad-but-still-major-hack way to do this might be to touch all of the Cython files so they will be forced to be rebuilt and link against the new library.\n\nI agree that all of these files should just be rebuilt because the dependency changed. Maybe there is a bug somewhere in the build system?",
    "created_at": "2018-09-20T02:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363961",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:21 embray]:
> Perhaps I'll just modify it so that the soname still uses "0.9" instead of "0.9.1".  After all, the ABI is identical so there's no reason to change it.
> 
> But really Sage should just be rebuilt.  It lists zn_poly as a dependency, but there's no mechanism to recompile/link all modules that depend on a library that changed...

That doesn't see like a good thing to do. What if there happens to be a major upgrade? A less-bad-but-still-major-hack way to do this might be to touch all of the Cython files so they will be forced to be rebuilt and link against the new library.

I agree that all of these files should just be rebuilt because the dependency changed. Maybe there is a bug somewhere in the build system?



---

archive/issue_comments_363962.json:
```json
{
    "body": "AFAICT there's no bug--although zn_poly is listed among the dependencies for Sage in the makefile, the result of updating them is to effectively run `./sage -b`, which has no mechanism by which to determine if any libraries modules are linked to changed.  As you suggested, the only obvious way to is touch all the Cython files, which should probably happen any time one of Sage's link-time dependencies change.\n\nSo that's something that clearly needs to be fixed.\n\nHowever, in the meantime, for zn_poly I really should have included a `libzn_poly-0.9` symlink, since there is effectively no difference between 0.9 and 0.9.1.  If/when I get around to redoing zn_poly's build system with automake I can easily handle this better.",
    "created_at": "2018-09-20T08:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363962",
    "user": "https://github.com/embray"
}
```

AFAICT there's no bug--although zn_poly is listed among the dependencies for Sage in the makefile, the result of updating them is to effectively run `./sage -b`, which has no mechanism by which to determine if any libraries modules are linked to changed.  As you suggested, the only obvious way to is touch all the Cython files, which should probably happen any time one of Sage's link-time dependencies change.

So that's something that clearly needs to be fixed.

However, in the meantime, for zn_poly I really should have included a `libzn_poly-0.9` symlink, since there is effectively no difference between 0.9 and 0.9.1.  If/when I get around to redoing zn_poly's build system with automake I can easily handle this better.



---

archive/issue_comments_363963.json:
```json
{
    "body": "Attachment [zn_poly-0.9.1.tar.gz](tarball://root/attachments/some-uuid/ticket26050/zn_poly-0.9.1.tar.gz) by @embray created at 2018-09-20 09:09:30",
    "created_at": "2018-09-20T09:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363963",
    "user": "https://github.com/embray"
}
```

Attachment [zn_poly-0.9.1.tar.gz](tarball://root/attachments/some-uuid/ticket26050/zn_poly-0.9.1.tar.gz) by @embray created at 2018-09-20 09:09:30



---

archive/issue_comments_363964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-20T09:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_363965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T09:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363966.json:
```json
{
    "body": "Updated tarball and branch.  This version should retain the original \"libzn_poly-0.9.so\" SONAME on Linux, for a smooth upgrade.",
    "created_at": "2018-09-20T09:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363966",
    "user": "https://github.com/embray"
}
```

Updated tarball and branch.  This version should retain the original "libzn_poly-0.9.so" SONAME on Linux, for a smooth upgrade.



---

archive/issue_comments_363967.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-20T09:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363967",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_363968.json:
```json
{
    "body": "Can you also bump the version when making a new release; the old tarball is already on the mirrors.",
    "created_at": "2018-09-20T17:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363968",
    "user": "https://github.com/vbraun"
}
```

Can you also bump the version when making a new release; the old tarball is already on the mirrors.



---

archive/issue_comments_363969.json:
```json
{
    "body": "I am still not in favor of making a symlink, but I will not object to this as this ticket is a net improvement and my solution is still a hack.",
    "created_at": "2018-09-20T22:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363969",
    "user": "https://github.com/tscrim"
}
```

I am still not in favor of making a symlink, but I will not object to this as this ticket is a net improvement and my solution is still a hack.



---

archive/issue_comments_363970.json:
```json
{
    "body": "It's not really a question of making a symlink.  In fact, really that has nothing to do with it--the problem is everything to do with the SONAME embedded in the binary.",
    "created_at": "2018-09-21T08:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363970",
    "user": "https://github.com/embray"
}
```

It's not really a question of making a symlink.  In fact, really that has nothing to do with it--the problem is everything to do with the SONAME embedded in the binary.



---

archive/issue_comments_363971.json:
```json
{
    "body": "Replying to [comment:27 vbraun]:\n> Can you also bump the version when making a new release; the old tarball is already on the mirrors.\n\nI'm not sure what you mean.  I stated that the original 0.9.1 tarball I uploaded was a release candidate.  Perhaps I should have appended something to the filename to that effect.  The tarball attached to this ticket is different from the original one of the same name.  Can't you just replace it on the mirrors?  I don't think anyone cares if you do.",
    "created_at": "2018-09-21T08:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363971",
    "user": "https://github.com/embray"
}
```

Replying to [comment:27 vbraun]:
> Can you also bump the version when making a new release; the old tarball is already on the mirrors.

I'm not sure what you mean.  I stated that the original 0.9.1 tarball I uploaded was a release candidate.  Perhaps I should have appended something to the filename to that effect.  The tarball attached to this ticket is different from the original one of the same name.  Can't you just replace it on the mirrors?  I don't think anyone cares if you do.



---

archive/issue_comments_363972.json:
```json
{
    "body": "Replying to [comment:29 embray]:\n> It's not really a question of making a symlink.  In fact, really that has nothing to do with it--the problem is everything to do with the SONAME embedded in the binary. \n\nI was going off what you said in comment:23 (I'm still a bit out of my depth on these issues). But my objection still applies in either case: 0.9.1 should not be masquerading as 0.9. Yet, like I said, this should not block this ticket from getting a positive review.",
    "created_at": "2018-09-21T14:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363972",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:29 embray]:
> It's not really a question of making a symlink.  In fact, really that has nothing to do with it--the problem is everything to do with the SONAME embedded in the binary. 

I was going off what you said in comment:23 (I'm still a bit out of my depth on these issues). But my objection still applies in either case: 0.9.1 should not be masquerading as 0.9. Yet, like I said, this should not block this ticket from getting a positive review.



---

archive/issue_comments_363973.json:
```json
{
    "body": "I think I see what you're saying here, and I admit I'm not 100% sure if it's the best way to go either.  I'm being inspired partially by https://www.debian.org/doc/debian-policy/ch-sharedlibs.html, though the exact file naming scheme is not the same (for now) as Debian prescribes.\n\nThere the convention is generally that the *actual* .so file has the full library version in the filename (this allows multiple versions to be installed simultaneously, in principle.  Then there is usually at least once.  Then there's a symlink that is named the same as the library's SONAME, pointing to the real file.  Finally in some cases (but not all) there is a symlink that's just `libwhatever.so` with no version.\n\nFor example on my Debian system I have:\n\n\n```\nlrwxrwxrwx 1 root root       16 May 29  2017 libtiff.so -> libtiff.so.5.2.0\nlrwxrwxrwx 1 root root       16 May 29  2017 libtiff.so.5 -> libtiff.so.5.2.0\n-rw-r--r-- 1 root root   467208 May 29  2017 libtiff.so.5.2.0\n```\n\n\nThough for most libs there's no `libfoo.so`; usually just `libfoo.so.<ABI version>`.  I don't know why that's the case.\n\nIn this case for zn_poly what I have is:\n\n\n```\nlibzn_poly-0.9.1.so  (where 0.9.1 is the library version)\nlibzn_poly-0.9.so -> libzn_poly-0.9.1.so (where in this case I'm saying 0.9 is just the ABI version--in a future release I will probably change this to just \"1\")\nlibzn_poly.so -> libzn_poly-0.9.1.so  (generic libzn_poly without version info)\n```\n\n\nSo I think this makes sense, but is it \"right\"? I'm not really sure.  I plan to redo it later anyways when it's not as urgent :)",
    "created_at": "2018-09-21T14:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363973",
    "user": "https://github.com/embray"
}
```

I think I see what you're saying here, and I admit I'm not 100% sure if it's the best way to go either.  I'm being inspired partially by https://www.debian.org/doc/debian-policy/ch-sharedlibs.html, though the exact file naming scheme is not the same (for now) as Debian prescribes.

There the convention is generally that the *actual* .so file has the full library version in the filename (this allows multiple versions to be installed simultaneously, in principle.  Then there is usually at least once.  Then there's a symlink that is named the same as the library's SONAME, pointing to the real file.  Finally in some cases (but not all) there is a symlink that's just `libwhatever.so` with no version.

For example on my Debian system I have:


```
lrwxrwxrwx 1 root root       16 May 29  2017 libtiff.so -> libtiff.so.5.2.0
lrwxrwxrwx 1 root root       16 May 29  2017 libtiff.so.5 -> libtiff.so.5.2.0
-rw-r--r-- 1 root root   467208 May 29  2017 libtiff.so.5.2.0
```


Though for most libs there's no `libfoo.so`; usually just `libfoo.so.<ABI version>`.  I don't know why that's the case.

In this case for zn_poly what I have is:


```
libzn_poly-0.9.1.so  (where 0.9.1 is the library version)
libzn_poly-0.9.so -> libzn_poly-0.9.1.so (where in this case I'm saying 0.9 is just the ABI version--in a future release I will probably change this to just "1")
libzn_poly.so -> libzn_poly-0.9.1.so  (generic libzn_poly without version info)
```


So I think this makes sense, but is it "right"? I'm not really sure.  I plan to redo it later anyways when it's not as urgent :)



---

archive/issue_comments_363974.json:
```json
{
    "body": "I'm not quite sure either about Volker's comment:27. Perhaps it was a misunderstanding? If not, Volker, could you explain a bit more when you set this back from positive review?",
    "created_at": "2018-09-22T22:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363974",
    "user": "https://github.com/tscrim"
}
```

I'm not quite sure either about Volker's comment:27. Perhaps it was a misunderstanding? If not, Volker, could you explain a bit more when you set this back from positive review?



---

archive/issue_comments_363975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-22T22:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363975",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363976.json:
```json
{
    "body": "The mirrors don't update instantaneously, rather it takes some number of days that is up to the mirror admin. In the meantime everybody will download stale tarballs from the mirrors, note that the checksum does not match, and fail to build.\n\nI can update the tarball on the mirror and then you wait until **all** mirrors have updated if you prefer.",
    "created_at": "2018-09-22T23:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363976",
    "user": "https://github.com/vbraun"
}
```

The mirrors don't update instantaneously, rather it takes some number of days that is up to the mirror admin. In the meantime everybody will download stale tarballs from the mirrors, note that the checksum does not match, and fail to build.

I can update the tarball on the mirror and then you wait until **all** mirrors have updated if you prefer.



---

archive/issue_comments_363977.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-22T23:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363977",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_363978.json:
```json
{
    "body": "I'm sorry, I still don't quite understand. The current (8.4.beta6) tarball is 0.9, but this new tarball is 0.9.1. Why is this different than any other spkg upgrade? At least, I see that as a version bump. Or did 0.9.1 get put onto the mirrors?",
    "created_at": "2018-09-23T22:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363978",
    "user": "https://github.com/tscrim"
}
```

I'm sorry, I still don't quite understand. The current (8.4.beta6) tarball is 0.9, but this new tarball is 0.9.1. Why is this different than any other spkg upgrade? At least, I see that as a version bump. Or did 0.9.1 get put onto the mirrors?



---

archive/issue_comments_363979.json:
```json
{
    "body": "Tarballs are uploaded before the ticket is tested on the buildbot. On this ticket Eric had one 0.9.1 tarball, I tested it (hence uploaded to mirrors), then Eric make a different 0.9.1 tarball, the problem is going to be due to the different tarball.",
    "created_at": "2018-09-23T23:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363979",
    "user": "https://github.com/vbraun"
}
```

Tarballs are uploaded before the ticket is tested on the buildbot. On this ticket Eric had one 0.9.1 tarball, I tested it (hence uploaded to mirrors), then Eric make a different 0.9.1 tarball, the problem is going to be due to the different tarball.



---

archive/issue_comments_363980.json:
```json
{
    "body": "I see, I was not aware of that. Thank you for the explanation.",
    "created_at": "2018-09-23T23:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363980",
    "user": "https://github.com/tscrim"
}
```

I see, I was not aware of that. Thank you for the explanation.



---

archive/issue_comments_363981.json:
```json
{
    "body": "> Tarballs are uploaded before the ticket is tested on the buildbot.\n\nWhy?  That doesn't make a lot of sense.  At the very least, shouldn't there be a couple of testing mirrors that the buildbots can be pointed to, rather that ones used for releases?\n\nWhat do I need to do here?  This issue not only blocks Cygwin builds, it is also preventing the Cygwin patchbot from proceeding.",
    "created_at": "2018-09-24T10:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363981",
    "user": "https://github.com/embray"
}
```

> Tarballs are uploaded before the ticket is tested on the buildbot.

Why?  That doesn't make a lot of sense.  At the very least, shouldn't there be a couple of testing mirrors that the buildbots can be pointed to, rather that ones used for releases?

What do I need to do here?  This issue not only blocks Cygwin builds, it is also preventing the Cygwin patchbot from proceeding.



---

archive/issue_comments_363982.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-09-24T10:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363982",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_363983.json:
```json
{
    "body": "I'm just going to go ahead and set this back to positive review.  I'm going to go ahead now and put the updated tarball on the mirrors (now that I know how to do that).",
    "created_at": "2018-09-24T10:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363983",
    "user": "https://github.com/embray"
}
```

I'm just going to go ahead and set this back to positive review.  I'm going to go ahead now and put the updated tarball on the mirrors (now that I know how to do that).



---

archive/issue_comments_363984.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-24T17:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363984",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_363985.json:
```json
{
    "body": "Please set it back to positive review after all mirrors have synced",
    "created_at": "2018-09-24T17:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363985",
    "user": "https://github.com/vbraun"
}
```

Please set it back to positive review after all mirrors have synced



---

archive/issue_comments_363986.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-09-25T09:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363986",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_363987.json:
```json
{
    "body": "I have no idea how to know that all mirrors have synced.  Look: The change has been reviewed positively in of its own right.  You are within your own power to determine if/when it is safe for you to merge--that's a matter of your process, not the review status of the change.",
    "created_at": "2018-09-25T09:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363987",
    "user": "https://github.com/embray"
}
```

I have no idea how to know that all mirrors have synced.  Look: The change has been reviewed positively in of its own right.  You are within your own power to determine if/when it is safe for you to merge--that's a matter of your process, not the review status of the change.



---

archive/issue_comments_363988.json:
```json
{
    "body": "To follow up: I'm not trying to pick a fight here; I just feel like you're creating a double-standard around this for some reason.  I've never seen you or anyone claim a ticket that updates a package does not have \"positive review\" just because the package tarball has not \"synced to all the mirrors\" (which IMO should not be part of the process in the first place but nevermind...)",
    "created_at": "2018-09-25T09:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363988",
    "user": "https://github.com/embray"
}
```

To follow up: I'm not trying to pick a fight here; I just feel like you're creating a double-standard around this for some reason.  I've never seen you or anyone claim a ticket that updates a package does not have "positive review" just because the package tarball has not "synced to all the mirrors" (which IMO should not be part of the process in the first place but nevermind...)



---

archive/issue_comments_363989.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-25T09:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363989",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_363990.json:
```json
{
    "body": "In good faith, I'll set it back to \"needs_work\" but as I have no idea how to know if \"all mirrors are synced\" I will leave that to you.",
    "created_at": "2018-09-25T09:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363990",
    "user": "https://github.com/embray"
}
```

In good faith, I'll set it back to "needs_work" but as I have no idea how to know if "all mirrors are synced" I will leave that to you.



---

archive/issue_comments_363991.json:
```json
{
    "body": "Just wait a day or two...",
    "created_at": "2018-09-25T22:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363991",
    "user": "https://github.com/vbraun"
}
```

Just wait a day or two...



---

archive/issue_comments_363992.json:
```json
{
    "body": "That's fine, I'm in no hurry.  I am just confused.",
    "created_at": "2018-09-26T09:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363992",
    "user": "https://github.com/embray"
}
```

That's fine, I'm in no hurry.  I am just confused.



---

archive/issue_comments_363993.json:
```json
{
    "body": "Since it has been 5 days, I am setting this back to positive review.",
    "created_at": "2018-09-30T22:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363993",
    "user": "https://github.com/tscrim"
}
```

Since it has been 5 days, I am setting this back to positive review.



---

archive/issue_comments_363994.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-09-30T22:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363994",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_363995.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-01T22:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363995",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065052.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-01T22:35:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25813#event-65052"
}
```



---

archive/issue_comments_363996.json:
```json
{
    "body": "Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional? And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?\n\nThanks for taking over maintenance!",
    "created_at": "2018-10-03T14:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363996",
    "user": "https://github.com/timokau"
}
```

Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional? And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?

Thanks for taking over maintenance!



---

archive/issue_comments_363997.json:
```json
{
    "body": "Replying to [comment:48 gh-timokau]:\n> Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?\n\nYes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.\n\n> And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?\n\nYou can look at the commit log on the fork, but that's mainly it, modulo a few other minor build changes.\n\nI intend to redo the build system for this package, but it's low priority as long a the existing one is \"working\".",
    "created_at": "2018-10-03T15:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363997",
    "user": "https://github.com/embray"
}
```

Replying to [comment:48 gh-timokau]:
> Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?

Yes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.

> And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?

You can look at the commit log on the fork, but that's mainly it, modulo a few other minor build changes.

I intend to redo the build system for this package, but it's low priority as long a the existing one is "working".



---

archive/issue_comments_363998.json:
```json
{
    "body": "Replying to [comment:49 embray]:\n> Replying to [comment:48 gh-timokau]:\n> > Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?\n> \n> Yes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.\n\nSo since that is done and sage and arch already ship 0.9.1, can you add the tag now?\n \n> > And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?\n> \n> You can look at the commit log on the fork, but that's mainly it, modulo a few other minor build changes.\n> \n> I intend to redo the build system for this package, but it's low priority as long a the existing one is \"working\".",
    "created_at": "2018-10-03T16:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363998",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:49 embray]:
> Replying to [comment:48 gh-timokau]:
> > Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?
> 
> Yes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.

So since that is done and sage and arch already ship 0.9.1, can you add the tag now?
 
> > And what are the differences between 0.9 and 0.9.1? Did you just apply all the sage patches?
> 
> You can look at the commit log on the fork, but that's mainly it, modulo a few other minor build changes.
> 
> I intend to redo the build system for this package, but it's low priority as long a the existing one is "working".



---

archive/issue_comments_363999.json:
```json
{
    "body": "Replying to [comment:50 gh-timokau]:\n> Replying to [comment:49 embray]:\n> > Replying to [comment:48 gh-timokau]:\n> > > Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?\n> > \n> > Yes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.\n> \n> So since that is done and sage and arch already ship 0.9.1, can you add the tag now?\n\nYup! I'll do it before the end of the week.",
    "created_at": "2018-10-03T16:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-363999",
    "user": "https://github.com/embray"
}
```

Replying to [comment:50 gh-timokau]:
> Replying to [comment:49 embray]:
> > Replying to [comment:48 gh-timokau]:
> > > Apparently sage ships zn_poly 0.9.1 now, but there is no tagged release on the fork. Is that intentional?
> > 
> > Yes. It says elsewhere here that I'll tag the new release after this ticket is approved (which it looks like it has been) since testing it against sage's buildbots was the best way to test it.
> 
> So since that is done and sage and arch already ship 0.9.1, can you add the tag now?

Yup! I'll do it before the end of the week.



---

archive/issue_comments_364000.json:
```json
{
    "body": "Ok done.  The new release can be obtained from its new canonical home at: https://gitlab.com/sagemath/zn_poly/tags/0.9.1",
    "created_at": "2018-10-04T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364000",
    "user": "https://github.com/embray"
}
```

Ok done.  The new release can be obtained from its new canonical home at: https://gitlab.com/sagemath/zn_poly/tags/0.9.1



---

archive/issue_comments_364001.json:
```json
{
    "body": "Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?",
    "created_at": "2018-10-04T20:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364001",
    "user": "https://github.com/timokau"
}
```

Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?



---

archive/issue_comments_364002.json:
```json
{
    "body": "Replying to [comment:53 gh-timokau]:\n> Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?\n\nTBH I'm not sure it much matters.  If you build without running the \"tune\" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.\n\nIf I had the time and inclination I would redesign it to be able to read the tunings from a file rather than hard-coded, so the tuning program can be re-run on individual machines without having to recompile.  IIUC how the tuning program works, there's no deep reason it couldn't be done this way.",
    "created_at": "2018-10-05T09:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364002",
    "user": "https://github.com/embray"
}
```

Replying to [comment:53 gh-timokau]:
> Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?

TBH I'm not sure it much matters.  If you build without running the "tune" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.

If I had the time and inclination I would redesign it to be able to read the tunings from a file rather than hard-coded, so the tuning program can be re-run on individual machines without having to recompile.  IIUC how the tuning program works, there's no deep reason it couldn't be done this way.



---

archive/issue_comments_364003.json:
```json
{
    "body": "Replying to [comment:54 embray]:\n> Replying to [comment:53 gh-timokau]:\n> > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?\n> \n> TBH I'm not sure it much matters.  If you build without running the \"tune\" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.\n\nThats good to know. I thought it may depend on some particular hardware aspects after tuning.\nOne other reason against always tuning is binary reproducibilty. I don't know if that is a goal\nof SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.\n\n> If I had the time and inclination I would redesign it to be able to read the tunings from a file rather than hard-coded, so the tuning program can be re-run on individual machines without having to recompile.  IIUC how the tuning program works, there's no deep reason it couldn't be done this way.",
    "created_at": "2018-10-05T16:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364003",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:54 embray]:
> Replying to [comment:53 gh-timokau]:
> > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?
> 
> TBH I'm not sure it much matters.  If you build without running the "tune" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.

Thats good to know. I thought it may depend on some particular hardware aspects after tuning.
One other reason against always tuning is binary reproducibilty. I don't know if that is a goal
of SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.

> If I had the time and inclination I would redesign it to be able to read the tunings from a file rather than hard-coded, so the tuning program can be re-run on individual machines without having to recompile.  IIUC how the tuning program works, there's no deep reason it couldn't be done this way.



---

archive/issue_comments_364004.json:
```json
{
    "body": "Replying to [comment:55 gh-timokau]:\n> Replying to [comment:54 embray]:\n> > Replying to [comment:53 gh-timokau]:\n> > > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?\n> > \n> > TBH I'm not sure it much matters.  If you build without running the \"tune\" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.\n\nIn this case it doesn't result in machine-specific code.  I don't fully understand how this code works to be honest, but my vague understanding is that it implements a number of different algorithms that may work at different speeds on different machines, and it adjusts how many times to run each algorithm to converge on the best solution the most efficiently.  Something to that effect... *waves hands*\n\n> Thats good to know. I thought it may depend on some particular hardware aspects after tuning.\n> One other reason against always tuning is binary reproducibilty. I don't know if that is a goal\n> of SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.\n\nI don't know if that's a goal for SAGE_FAT_BINARY either.  That might be something to bring up on the mailing list.  But yes, for binary reproducibility you'll want to disable tuning, so now (as document) the way to do that is to run `./configure --disable-tuning`.",
    "created_at": "2018-10-08T09:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364004",
    "user": "https://github.com/embray"
}
```

Replying to [comment:55 gh-timokau]:
> Replying to [comment:54 embray]:
> > Replying to [comment:53 gh-timokau]:
> > > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?
> > 
> > TBH I'm not sure it much matters.  If you build without running the "tune" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.

In this case it doesn't result in machine-specific code.  I don't fully understand how this code works to be honest, but my vague understanding is that it implements a number of different algorithms that may work at different speeds on different machines, and it adjusts how many times to run each algorithm to converge on the best solution the most efficiently.  Something to that effect... *waves hands*

> Thats good to know. I thought it may depend on some particular hardware aspects after tuning.
> One other reason against always tuning is binary reproducibilty. I don't know if that is a goal
> of SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.

I don't know if that's a goal for SAGE_FAT_BINARY either.  That might be something to bring up on the mailing list.  But yes, for binary reproducibility you'll want to disable tuning, so now (as document) the way to do that is to run `./configure --disable-tuning`.



---

archive/issue_comments_364005.json:
```json
{
    "body": "Replying to [comment:56 embray]:\n> Replying to [comment:55 gh-timokau]:\n> > Replying to [comment:54 embray]:\n> > > Replying to [comment:53 gh-timokau]:\n> > > > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?\n> > > \n> > > TBH I'm not sure it much matters.  If you build without running the \"tune\" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.\n> \n> In this case it doesn't result in machine-specific code.  I don't fully understand how this code works to be honest, but my vague understanding is that it implements a number of different algorithms that may work at different speeds on different machines, and it adjusts how many times to run each algorithm to converge on the best solution the most efficiently.  Something to that effect... *waves hands*\n> \n> > Thats good to know. I thought it may depend on some particular hardware aspects after tuning.\n> > One other reason against always tuning is binary reproducibilty. I don't know if that is a goal\n> > of SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.\n> \n> I don't know if that's a goal for SAGE_FAT_BINARY either.  That might be something to bring up on the mailing list.  But yes, for binary reproducibility you'll want to disable tuning, so now (as document) the way to do that is to run `./configure --disable-tuning`.\n\nBinary reproducibility is probably overkill for `SAGE_FAT_BINARY`, so it should be fine as-is. Thanks for the clarification.",
    "created_at": "2018-10-08T10:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25813#issuecomment-364005",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:56 embray]:
> Replying to [comment:55 gh-timokau]:
> > Replying to [comment:54 embray]:
> > > Replying to [comment:53 gh-timokau]:
> > > > Thank you! I noticed that tuning is enabled by default now. Shouldn't it be disabled in spkg-install when `SAGE_FAT_BINARY` is set? I see that it wasn't before either, but it should right?
> > > 
> > > TBH I'm not sure it much matters.  If you build without running the "tune" program it just uses some default tunings from David Harvey's own machine from god-knows-when, so it's arbitrary either way.
> 
> In this case it doesn't result in machine-specific code.  I don't fully understand how this code works to be honest, but my vague understanding is that it implements a number of different algorithms that may work at different speeds on different machines, and it adjusts how many times to run each algorithm to converge on the best solution the most efficiently.  Something to that effect... *waves hands*
> 
> > Thats good to know. I thought it may depend on some particular hardware aspects after tuning.
> > One other reason against always tuning is binary reproducibilty. I don't know if that is a goal
> > of SAGE_FAT_BINARY, but at least thats the reason why I still disable tuning on nix.
> 
> I don't know if that's a goal for SAGE_FAT_BINARY either.  That might be something to bring up on the mailing list.  But yes, for binary reproducibility you'll want to disable tuning, so now (as document) the way to do that is to run `./configure --disable-tuning`.

Binary reproducibility is probably overkill for `SAGE_FAT_BINARY`, so it should be fine as-is. Thanks for the clarification.
