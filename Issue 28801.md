# Issue 28801: Python package sage_conf: Provides optional configuration information for sagelib

Issue created by migration from https://trac.sagemath.org/ticket/29038

Original creator: mkoeppe

Original creation time: 2020-01-18 15:36:44

CC:  fbissey arojas isuruf embray infinity0 @timokau jdemeyer dimpase jhpalmieri vbraun

This ticket introduces a new Python package `sage_conf` that solves the problem of providing configuration information to sagelib at installation time (`src/setup.py`), including the docbuild, and to the runtime of sagelib.

- sage-the-distribution will generate this Python package at `./configure` time and install it before attempting to install sagelib using `src/setup.py`.
- Distributions will generate and install their own `sage_conf` by a method of their choice.


---

Comment by mkoeppe created at 2020-01-18 17:37:56

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-01-18 17:37:56

New commits:


---

Comment by git created at 2020-01-18 20:07:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-18 20:22:30

why are you checking in files which apparently are meant to be generated from .in templates?


---

Comment by mkoeppe created at 2020-01-18 20:28:32

A mistake, which I will fix in a moment. Thanks!


---

Comment by git created at 2020-01-18 20:32:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-19 18:23:31

the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?


---

Comment by mkoeppe created at 2020-01-19 19:27:06

Replying to [comment:12 dimpase]:
> the example with `sage --python -m venv` - is it going to work if Sage is using venv on its own?
Not without installing sage packages into the new venv. As far as I can see, one can only control whether system-packages are made available but not whether the originating venv's packages are made available. But I'd expect that this option will be invented at some point in Python.


---

Comment by dimpase created at 2020-01-19 21:10:03

is `sage_conf` also meant to be used while building Sage's dependencies?


---

Comment by mkoeppe created at 2020-01-19 21:20:15

Replying to [comment:15 dimpase]:
> is `sage_conf` also meant to be used while building Sage's dependencies?
No.


---

Comment by dimpase created at 2020-01-19 21:29:37

`author` ought to be either "The Sage Developers" (cf https://wiki.sagemath.org/Publications_using_SageMath?action=show&redirect=Publications_using_SAGE)
or yourself...


---

Comment by mkoeppe created at 2020-01-19 21:32:53

I copied the metadata from `src/setup.py`


---

Comment by dimpase created at 2020-01-19 22:29:11

Replying to [comment:18 mkoeppe]:
> I copied the metadata from `src/setup.py`
that line is 5.5 years old. With all respect, William has not contributed a line of code to sagemath since 2017.


---

Comment by git created at 2020-01-20 01:04:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-20 22:09:37

I don't seem to get `local/bin/sage-config` - it is not on the branch?


---

Comment by dimpase created at 2020-01-20 22:10:11

otherwise the branch builds and passes tests on a Debian system


---

Comment by mkoeppe created at 2020-01-20 22:17:08

Replying to [comment:22 dimpase]:
> I don't seem to get `local/bin/sage-config` - it is not on the branch?
Strange. Can you post the output of "sage -f sage_conf"?


---

Comment by git created at 2020-01-21 00:01:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-21 11:05:16

with the latest commit I get an error from sage -f sage_conf

```
make[1]: Entering directory '/home/dimpase/sage/build/make'
cd '/home/dimpase/sage' && source '/home/dimpase/sage/src/bin/sage-env' && sage-logger -p '/home/dimpase/sage/build/pkgs/sage_conf/spkg-install' '/home/dimpase/sage/logs/pkgs/sage_conf.log'
[sage_conf] /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: 4: /home/dimpase/sage/build/pkgs/sage_conf/spkg-install: source: not found
[sage_conf] Error: failed to source /home/dimpase/sage/build/bin/sage-dist-helpers
[sage_conf] Is /home/dimpase/sage the correct SAGE_ROOT?
make[1]: *** [Makefile:2240: sage_conf] Error 1
make[1]: Leaving directory '/home/dimpase/sage/build/make'

real	0m0.137s
user	0m0.076s
sys	0m0.066s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make sage_conf'):

* package: sage_conf
  log file: /home/dimpase/sage/logs/pkgs/sage_conf.log
  build directory: /home/dimpase/sage/local/var/tmp/sage/build/sage_conf
```



---

Comment by dimpase created at 2020-01-21 11:08:31

simply due to Debian's /bin/sh not knowing what `source` is:

```
$ /bin/sh
$ source 
/bin/sh: 1: source: not found
```



---

Comment by dimpase created at 2020-01-21 11:12:19

I suppose the 1st line got to be

```/usr/bin/env bash
```


Trying this now.


---

Comment by dimpase created at 2020-01-21 11:22:29

OK, with the latter fix, it completes, and also

```
$ ./local/bin/sage-config
VERSION=9.1.beta0
MAXIMA=/home/dimpase/sage/local/bin/maxima
SAGE_LOCAL=/home/dimpase/sage/local
SAGE_ROOT=/home/dimpase/sage
```

works.

\begin{lament}

An annoying thing is that `sage -f sage_conf` did cause `./configure` to be run like 4 or 5 times, I really lost count. 
This is a by-product of `sage -f/-i` changing the configuration.
See #27373.

I really think we should get rid of these snowflake `sage -f/-i` and do `./configure && make` :-)
 

\end{lament}


---

Comment by dimpase created at 2020-01-21 11:28:24

`$ sage -python -m venv --system-site-packages ~/personal-sage-venv/`
also works as advertised by this ticket.


---

Comment by dimpase created at 2020-01-21 11:29:03

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-01-21 14:10:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-21 14:11:32

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-01-21 14:33:34

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-01-21 14:33:34

OK.


---

Comment by mkoeppe created at 2020-01-21 14:35:52

Thank you!


---

Comment by embray created at 2020-01-22 11:04:35

Changing status from positive_review to needs_work.


---

Comment by embray created at 2020-01-22 11:04:35

For the argument parsing please just use argparse.


---

Comment by embray created at 2020-01-22 11:08:46

I don't understand this line:


```
MAXIMA = "@prefix@/bin/maxima"
```


Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.


---

Comment by dimpase created at 2020-01-22 11:13:32

Replying to [comment:37 embray]:
> I don't understand this line:
> 
> {{{
> MAXIMA = "`@`prefix`@`/bin/maxima"
> }}}
> 
> Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.

As long as we don't have spkg-configure.m4 for maxima, it's OK.


---

Comment by embray created at 2020-01-22 11:16:54

The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, it's installed like this:


```
# ============================= script packages ==============================
# Generate build rules for 'script' packages; this template is used to generate
# two rules in the form:
#
# <pkgname>: <dependencies>
#     $(AM_V_at)cd '$SAGE_ROOT' && \\
#         source '$SAGE_ROOT/src/bin/sage-env' && \\
#         sage-logger -p '$SAGE_ROOT/build/pkgs/<pkgname>/spkg-install' '$(SAGE_LOGS)/<pkgname>.log'
```


So it already sources `sage-env`, but not `sage-dist-helpers`.  

Looking at the handful of other `spkg-install` scripts for the type=script packages, they might not work properly anyways since they don't get the "wrapper" treatment that other spkg-install scripts now get from `sage-spkg` (that didn't used to be the case.  

I would make the splitting up of sage-env a prerequisite to this, and at a minimum ensure that sage-dist-helpers is already sourced in the build env.  Then you could do away with the extra boilerplate at the top of the `spkg-install` for this.


---

Comment by embray created at 2020-01-22 11:17:51

Replying to [comment:38 dimpase]:
> Replying to [comment:37 embray]:
> > I don't understand this line:
> > 
> > {{{
> > MAXIMA = "`@`prefix`@`/bin/maxima"
> > }}}
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.
> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.
> 

Yes, I suppose, though this would have to be changed later if it were added.


---

Comment by embray created at 2020-01-22 11:19:23

In the `setup.cfg` this should not be necessary:

```
+setup_requires =
+    setuptools
```


The standard now for specifying build-time dependencies is to add a pyproject.toml file.


---

Comment by embray created at 2020-01-22 11:27:41

Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file.  In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

All of the data provided by this module can go in a config file, similarly to Numpy's `site.cfg`.  It can even go directly in `setup.cfg` under a Sage-specific section, but probably better a separate file that doesn't need to be patched.

If you want to install the data along with the sage package it can be added to `package_data`.  If you look at Sage's setup.py it already has one other `package_data` file.  Adding one more is not really a problem, issues like #22655 nonwithstanding.  The file can be generated by the `setup.py`, which is not that unusual a thing to do.  If all this is to just avoid questions of how to update `setup.py`, I can help with that.


---

Comment by embray created at 2020-01-22 11:30:13

This fix (adding the MAXIMA variable) is definitely good anything else in this ticket aside, and I'd approve right away as a separate ticket:


```
@@ -186,6 +192,7 @@ var('MTXLIB',                        join(SAGE_SHARE, 'meataxe'))
 var('THREEJS_DIR',                   join(SAGE_SHARE, 'threejs'))
 var('SINGULARPATH',                  join(SAGE_SHARE, 'singular'))
 var('PPLPY_DOCS',                    join(SAGE_SHARE, 'doc', 'pplpy'))
+var('MAXIMA',                        'maxima')
 var('MAXIMA_FAS')
 var('SAGE_NAUTY_BINS_PREFIX', '')
 
diff --git a/src/sage/interfaces/maxima.py b/src/sage/interfaces/maxima.py
index eacbc4c..d6d37fe 100644
--- a/src/sage/interfaces/maxima.py
+++ b/src/sage/interfaces/maxima.py
@@ -472,7 +472,7 @@ import pexpect
 
 from random import randrange
 
-from sage.env import DOT_SAGE, SAGE_LOCAL
+from sage.env import DOT_SAGE, SAGE_LOCAL, MAXIMA
 from sage.misc.misc import ECL_TMP
 
 from .expect import (Expect, ExpectElement, gc_disabled)
@@ -546,7 +546,7 @@ class Maxima(MaximaAbstract, Expect):
         Expect.__init__(self,
                         name = 'maxima',
                         prompt = r'\(\%i[0-9]+\) ',
-                        command = 'maxima -p "{0}"'.format(STARTUP),
+                        command = '"{0}" -p "{1}"'.format(MAXIMA, STARTUP),
                         env = {'TMPDIR': str(ECL_TMP)},
                         script_subdirectory = script_subdirectory,
                         restart_on_ctrlc = False,
```



---

Comment by dimpase created at 2020-01-22 11:40:43

Replying to [comment:42 embray]:
> Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 

it is easier to make data available in Python if it is packaged as a Python module.
Otherwise you need to read a plain text file from somewhere etc etc.


---

Comment by dimpase created at 2020-01-22 11:58:45

Replying to [comment:44 dimpase]:
> Replying to [comment:42 embray]:
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 
> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.

perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.


---

Comment by embray created at 2020-01-22 12:16:27

Replying to [comment:45 dimpase]:
> Replying to [comment:44 dimpase]:
> > Replying to [comment:42 embray]:
> > > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 
> > 
> > it is easier to make data available in Python if it is packaged as a Python module.
> > Otherwise you need to read a plain text file from somewhere etc etc.
> 
> perhaps needless to say, but `sysconfig` is a Python package, and your objections -- why it's not a text file -- apply to it just as well.

Have you looked at the [sysconfig](https://github.com/python/cpython/blob/5bbac8cbdf140ebce446ea4e7db2b20a5d7b8402/Lib/sysconfig.py) module?  None of it is generated.  In fact, Python installs the Makefile it was built with, and sysconfig.py reads it.  I'm not advocating _that_ approach either, but something closer to it.

That said, having a generated Python file for this configuration is something I'd bend on.  I don't think it needs to be a .py module but _shrug_.  I added a comment on #29022 which I hope clarifies what I think this should be.

I _do_ like that addition of a `sage-config` script.  That could just be part of the `sage` package itself though; no need for an module external to `sage` that I can see.


---

Comment by embray created at 2020-01-22 12:26:24

Replying to [comment:44 dimpase]:
> Replying to [comment:42 embray]:
> > Not to sound like a broken record, but I don't understand the purpose of making this a whole Python module instead of a plain text file. 
> 
> it is easier to make data available in Python if it is packaged as a Python module.
> Otherwise you need to read a plain text file from somewhere etc etc.


```
# sage/env.py
...

SAGE_ENV_FILE = os.path.join(os.path.dirname(__file__), 'sage.env')
with open(SAGE_ENV_FILE) as sage_env:
    for line in sage_env:
        key, value = line.split('=', 1)
        os.environ[key] = value

...
```


This format has the advantage that it can also be sourced by a shell script as it's valid shell syntax.

This is just a suggestion though; the .py equivalent is almost the same except with spaces around the `=`.

Another version, if you require that the values are quoted (so that it's simultaneously valid shell syntax and Python syntax):


```
with open(SAGE_ENV_FILE) as sage_env:
    exec(sage_env.read(), os.environ)
```


Or, if we prefer not to override things in `os.environ` we can use `globals()` instead.

Point being, it's a few lines.

I like this because even if `$SAGE_LOCAL` is not "activated" (`sage-env` not sourced), you can run `$SAGE_LOCAL/bin/python -c 'import sage'` and have a working environment.  The necessary environment variables can then also be passed to Sage's external dependencies, without any requirement of modifying the outer shell environment.  To me, that's the primary motivation.  That motivation can still be achieved even if the generated file is a .py module, which is why I'm more open to that; I'm just trying to show that it doesn't  gain all that much in simplicity either.


---

Comment by dimpase created at 2020-01-22 12:29:27

IMHO the internal design of `sysconfig` is a technical detail - given Python's historical dislike of non-Python tooling, no wonder they do it their way.


---

Comment by dimpase created at 2020-01-22 12:37:05

`globals()`, `exec()`, etc are really measures of last resort. 

And a plain text file is much more vulnerable to all sorts of problems, too, e.g. it's not checked for syntax by Python...


---

Comment by mkoeppe created at 2020-01-22 14:15:53

Replying to [comment:39 embray]:
> I would make the splitting up of sage-env a prerequisite to this

I have laid out a plan for splitting of `sage-env` in #21707. It is more complex. The present ticket is an actionable step toward it.


---

Comment by mkoeppe created at 2020-01-22 14:20:57

Replying to [comment:38 dimpase]:
> Replying to [comment:37 embray]:
> > I don't understand this line:
> > 
> > {{{
> > MAXIMA = "`@`prefix`@`/bin/maxima"
> > }}}
> > 
> > Why assume that's the location of maxima? It might be if using SAGE_LOCAL, but this should instead come from a path to maxima determined by configure.
> 
> As long as we don't have spkg-configure.m4 for maxima, it's OK.

Yes, of course the intention is that a follow-up ticket will add `spkg-configure.m4`. 

I picked this invocation of `maxima` as an illustrating example for this ticket - one of many places where the Python code assumes that externally to the Python process, an environment has been set up. In the systematic of #21707 ("Split sage-env into 5"), this example belongs to category 5.


---

Comment by git created at 2020-01-22 14:25:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-22 14:28:22

Replying to [comment:41 embray]:
> In the `setup.cfg` this should not be necessary:
> {{{
> +setup_requires =
> +    setuptools
> }}}

Thanks, I've removed it.

> The standard now for specifying build-time dependencies is to add a pyproject.toml file.

Our present tooling does not need that file either. I'd suggest we do pyproject.toml business after #21508.


---

Comment by git created at 2020-01-22 14:33:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-22 14:34:00

Replying to [comment:39 embray]:
> The idea of making this `type=script` make sense to me, but that isn't used very often so it hasn't been well tested.  If you look at what happens with a type=script package, [...] it already sources `sage-env`, but not `sage-dist-helpers`.  

Thanks! I've simplified `spkg-install` accordingly.


---

Comment by mkoeppe created at 2020-01-22 14:55:11

Replying to [comment:42 embray]:
>   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.

No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 

The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.

Packagers will just be able to generate a `sage_conf` module in any way they like. 


I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
- committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
- for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
- it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.


---

Comment by git created at 2020-01-22 15:40:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-22 15:42:37

Replying to [comment:36 embray]:
> For the argument parsing please just use argparse.
Thanks for the suggestion. Done.


---

Comment by mkoeppe created at 2020-01-22 15:42:44

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-01-22 15:57:05


```
from __future__ import print_function
+del print_function
```

by the way, can you explain these 2 lines


---

Comment by git created at 2020-01-22 16:29:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-22 16:31:00

Replying to [comment:61 dimpase]:
> {{{
> from __future__ import print_function
> +del print_function
> }}}
> by the way, can you explain these 2 lines

Without the `del print_function`, `sage-config` would print a line `print_function=_Feature((2, 6, 0, 'alpha', 2), (3, 0, 0, 'alpha', 0), 65536)`.

But I have simplified the module by avoiding `print` altogether.


---

Comment by dimpase created at 2020-01-22 21:49:39

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-01-22 21:49:39

OK for me.


---

Comment by vbraun created at 2020-01-25 17:27:15

Resolution: fixed


---

Comment by embray created at 2020-01-31 11:32:10

Replying to [comment:56 mkoeppe]:
> Replying to [comment:42 embray]:
> >   In some ways this makes things even worse for packagers, because now to package `sage_config` they have to hand-patch this Python module.
> 
> No, to the contrary. This ticket defines a functional interface to configuration: to the shell, by `sage-config`, to Python, by importing the module `sage_conf` and reading its variables. 
> 
> The version of `sage_conf` provided in `build/pkgs` is just a reference implementation of the functional interface that sage-the-distribution uses.
> 
> Packagers will just be able to generate a `sage_conf` module in any way they like. 
> 
> 
> I have chosen this design (external to the `src` directory, a Python module rather than a configuration file) for the following reasons:
> - committing to a functional interface is more flexible than (1) committing to configuration by a static file written at installation time; (2) (less importantly) to a particular file format for that.
> - for example, a binary distribution may decide to ship a version of `sage_conf` that is more dynamic: It could discover some settings at its runtime.
> - it is not part of the `src` directory; in this way it is working towards the goals of (a) distributors being able to use the whole unmodified `src` tree; (b) pip installability of the unmodified `src` tree.
> 

But it's not even documented what this is supposed to provide or how it's supposed to work.  This is all very confusing.

I don't really know what you mean by "functional" here.  Do you mean executable?  Why?  Is there a specific reason for that?  In any case I know of all that's needed here is at most a list of environment variables.  In many cases this will just be static.  If a packager has a need to generate some values for those variables programmatically they can do so however they like, but now they have to write a whole Python script that implements some undocumented interface.


---

Comment by dimpase created at 2020-01-31 12:16:50

Once again, it's more Pythonic to wrap Python-needed things into Python modules, as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".


---

Comment by embray created at 2020-01-31 13:24:52

Replying to [comment:67 dimpase]:
> Once again, it's more Pythonic to wrap Python-needed things into Python modules

![citation needed]

> as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".

Perhaps you missed it, but as I already explained above this is _exactly_ what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".


---

Comment by mkoeppe created at 2020-01-31 13:27:20

The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.


---

Comment by embray created at 2020-01-31 13:29:29

For reference, again [sysconfig](https://github.com/python/cpython/blob/master/Lib/sysconfig.py), which is a hard-coded Python module which reads from a plain text-file.

Also recommended, the [venv](https://github.com/python/cpython/blob/master/Lib/venv/__init__.py) module which is actually a lot less mysterious than you guys seem to be making it out to be.  The only magic involved is some support bits coded directly into the Python interpreter used for setting `sys.prefix` correctly (this is one of the few ways `venv` differs from the original `virtualenv` which needed some hacks to achieve this).


---

Comment by embray created at 2020-01-31 13:31:55

Replying to [comment:69 mkoeppe]:
> The larger plan is laid out in #21707 - Split sage-env into 5. It explains how pieces fit together. A recommended read.

Thanks, that is useful.  Obviously I've participated in that ticket before, but I wasn't sure if it was _the_ ticket tying the rest of this together.  I still believe that steps 3/4/5 can be achieved by different means which merit more discussion.  But I'm on board with the overall plan :)


---

Comment by mkoeppe created at 2020-01-31 13:47:31

No problem. I know that it is not always possible to keep up with all developments when there are more important things to do.

As you see in that plan in #21707, the present ticket on `sage_conf` was a step to cleaning up the sage-env mess. 

It has little to do with my venv-python3 tickets (which I haven't had time to work on). (In fact, I now think that your version at #29032 may, after all, be the simpler way to go at it -- but I have to get back to the python3-spkg-configure business later.)

So there's no need to mix any "venv" discussion into the "sagelib configuration" discussion.

The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch.


---

Comment by dimpase created at 2020-01-31 14:33:45

Replying to [comment:68 embray]:
> Replying to [comment:67 dimpase]:
> > Once again, it's more Pythonic to wrap Python-needed things into Python modules
> 
> ![citation needed]
cf. [`sysconfig`].
> 
> > as `sysconfig` does, as opposed to keep stuff around in text files, which need to be read, parsed, etc etc. I guess that's what Matthias calls "functional".
> 
> Perhaps you missed it, but as I already explained above this is _exactly_ what `sysconfig` does.  You are saying that `sysconfig` is "unpythonic".

No, obviously Python needs to do some non-Pythonic things under the hood, but then the interface is Pythonic, and `sysconfig` is an example of such an approach.
You are somehow against this approach, you say that such wrapping is too complicated, so it should not be done - if you were Python BDFL, you'd not have allowed `sysconfig` in.


---

Comment by mkoeppe created at 2020-01-31 14:35:14

Replying to [comment:72 mkoeppe]:
> The "regression" caused by this ticket is one that is affecting developers who switch between new and old branches. It is fixed by just merging current develop into the old branch. 

For tickets where merging the current `develop` is not easy, I have prepared #29120 - One-line fix for "./configure is too sensitive to stray files/subdirectories".
