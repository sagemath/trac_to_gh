# Issue 24977: let curl have headers in the location given by curl-config

archive/issues_024977.json:
```json
{
    "body": "CC:  embray\n\ncurrently system-wide curl is not recognised as usable by Sage if its headers are in the location not searched by $CC by default.\n\ncurl-config script actually tells you what to add to CFLAGS\n\n```\n$ curl-config --cflags\n-I/usr/local/include\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25214\n\n",
    "created_at": "2018-04-19T09:27:01Z",
    "labels": [
        "build: configure",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "let curl have headers in the location given by curl-config",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24977",
    "user": "dimpase"
}
```
CC:  embray

currently system-wide curl is not recognised as usable by Sage if its headers are in the location not searched by $CC by default.

curl-config script actually tells you what to add to CFLAGS

```
$ curl-config --cflags
-I/usr/local/include
```


Issue created by migration from https://trac.sagemath.org/ticket/25214





---

archive/issue_comments_351533.json:
```json
{
    "body": "I believe the m4 macro from Curl project (https://github.com/curl/curl/blob/master/docs/libcurl/libcurl.m4)\nwould do all what's needed, including setting LIBCURL_CPPFLAGS",
    "created_at": "2018-04-19T09:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351533",
    "user": "dimpase"
}
```

I believe the m4 macro from Curl project (https://github.com/curl/curl/blob/master/docs/libcurl/libcurl.m4)
would do all what's needed, including setting LIBCURL_CPPFLAGS



---

archive/issue_comments_351534.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2018-04-19T09:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351534",
    "user": "embray"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_351535.json:
```json
{
    "body": "I still don't fully understand why the current check doesn't work, even if you don't pass additional CFLAGS arguments.  I'd be curious to investigate that.  But it would also be interesting to try their official macro.",
    "created_at": "2018-04-19T09:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351535",
    "user": "embray"
}
```

I still don't fully understand why the current check doesn't work, even if you don't pass additional CFLAGS arguments.  I'd be curious to investigate that.  But it would also be interesting to try their official macro.



---

archive/issue_comments_351536.json:
```json
{
    "body": "TL; DR: It works if I set CXXFLAGS instead.\n\non a FreeBSD 11.1 system one has (with `t.c` basically not doing anything):\n\n```\n$ cc -I/usr/local/include  -c t.c # this works\n$ cc   -c t.c                     # this doesn't \nt.c:1:9: fatal error: 'curl/curl.h' file not found\n#include<curl/curl.h>\n        ^~~~~~~~~~~~~\n1 error generated.\n```\n\n\nCFLAGS are ingnored by `./configure` in this case.\nI invoke `./configure CC=cc CXX=c++ FC=gfortran6 CFLAGS=\"-I/usr/local/include\"`\nand still see in config.log the following:\n\n```\nconfigure:8259: checking for curl 7.22\nconfigure:8292: result: /usr/local/bin/curl\nconfigure:8298: checking curl/curl.h usability\nconfigure:8298: c++ -c -g -O2 -std=gnu++11  conftest.cpp >&5\nconftest.cpp:56:10: fatal error: 'curl/curl.h' file not found\n#include <curl/curl.h>\n         ^~~~~~~~~~~~~\n1 error generated.\n```\n\n\nIt works if I set CXXFLAGS instead, as it tests with c++ rather than with cc!",
    "created_at": "2018-04-19T10:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351536",
    "user": "dimpase"
}
```

TL; DR: It works if I set CXXFLAGS instead.

on a FreeBSD 11.1 system one has (with `t.c` basically not doing anything):

```
$ cc -I/usr/local/include  -c t.c # this works
$ cc   -c t.c                     # this doesn't 
t.c:1:9: fatal error: 'curl/curl.h' file not found
#include<curl/curl.h>
        ^~~~~~~~~~~~~
1 error generated.
```


CFLAGS are ingnored by `./configure` in this case.
I invoke `./configure CC=cc CXX=c++ FC=gfortran6 CFLAGS="-I/usr/local/include"`
and still see in config.log the following:

```
configure:8259: checking for curl 7.22
configure:8292: result: /usr/local/bin/curl
configure:8298: checking curl/curl.h usability
configure:8298: c++ -c -g -O2 -std=gnu++11  conftest.cpp >&5
conftest.cpp:56:10: fatal error: 'curl/curl.h' file not found
#include <curl/curl.h>
         ^~~~~~~~~~~~~
1 error generated.
```


It works if I set CXXFLAGS instead, as it tests with c++ rather than with cc!



---

archive/issue_comments_351537.json:
```json
{
    "body": "Ah, I was actually going to suggest trying `CPPFLAGS`, but that does explain it:)",
    "created_at": "2018-04-19T10:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351537",
    "user": "embray"
}
```

Ah, I was actually going to suggest trying `CPPFLAGS`, but that does explain it:)



---

archive/issue_comments_351538.json:
```json
{
    "body": "Anyhow, the real issue is whether R will pick up `curl` headers. We'll see.",
    "created_at": "2018-04-19T11:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351538",
    "user": "dimpase"
}
```

Anyhow, the real issue is whether R will pick up `curl` headers. We'll see.



---

archive/issue_comments_351539.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351539",
    "user": "vdelecroix"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_351540.json:
```json
{
    "body": "I think this might still be a problem; working to confirm this...",
    "created_at": "2020-11-12T12:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351540",
    "user": "embray"
}
```

I think this might still be a problem; working to confirm this...



---

archive/issue_comments_351541.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> I think this might still be a problem; working to confirm this...\n\nWell, if it is a problem, it wasn't a cause of the problem I was trying to fix.",
    "created_at": "2020-11-12T14:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24977#issuecomment-351541",
    "user": "embray"
}
```

Replying to [comment:7 embray]:
> I think this might still be a problem; working to confirm this...

Well, if it is a problem, it wasn't a cause of the problem I was trying to fix.
