# Issue 24977: let curl have headers in the location given by curl-config

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2018-04-19 09:27:01

CC:  embray

currently system-wide curl is not recognised as usable by Sage if its headers are in the location not searched by $CC by default.

curl-config script actually tells you what to add to CFLAGS

```
$ curl-config --cflags
-I/usr/local/include
```



---

Comment by dimpase created at 2018-04-19 09:41:12

I believe the m4 macro from Curl project (https://github.com/curl/curl/blob/master/docs/libcurl/libcurl.m4)
would do all what's needed, including setting LIBCURL_CPPFLAGS


---

Comment by embray created at 2018-04-19 09:44:30

Changing type from PLEASE CHANGE to defect.


---

Comment by embray created at 2018-04-19 09:44:30

I still don't fully understand why the current check doesn't work, even if you don't pass additional CFLAGS arguments.  I'd be curious to investigate that.  But it would also be interesting to try their official macro.


---

Comment by dimpase created at 2018-04-19 10:13:37

TL; DR: It works if I set CXXFLAGS instead.

on a FreeBSD 11.1 system one has (with `t.c` basically not doing anything):

```
$ cc -I/usr/local/include  -c t.c # this works
$ cc   -c t.c                     # this doesn't 
t.c:1:9: fatal error: 'curl/curl.h' file not found
#include<curl/curl.h>
        ^~~~~~~~~~~~~
1 error generated.
```


CFLAGS are ingnored by `./configure` in this case.
I invoke `./configure CC=cc CXX=c++ FC=gfortran6 CFLAGS="-I/usr/local/include"`
and still see in config.log the following:

```
configure:8259: checking for curl 7.22
configure:8292: result: /usr/local/bin/curl
configure:8298: checking curl/curl.h usability
configure:8298: c++ -c -g -O2 -std=gnu++11  conftest.cpp >&5
conftest.cpp:56:10: fatal error: 'curl/curl.h' file not found
#include <curl/curl.h>
         ^~~~~~~~~~~~~
1 error generated.
```


It works if I set CXXFLAGS instead, as it tests with c++ rather than with cc!


---

Comment by embray created at 2018-04-19 10:22:36

Ah, I was actually going to suggest trying `CPPFLAGS`, but that does explain it:)


---

Comment by dimpase created at 2018-04-19 11:20:51

Anyhow, the real issue is whether R will pick up `curl` headers. We'll see.


---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4


---

Comment by embray created at 2020-11-12 12:57:15

I think this might still be a problem; working to confirm this...


---

Comment by embray created at 2020-11-12 14:40:12

Replying to [comment:7 embray]:
> I think this might still be a problem; working to confirm this...

Well, if it is a problem, it wasn't a cause of the problem I was trying to fix.
