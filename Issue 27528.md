# Issue 27528: UserWarning when factoring polys over NumberFields

Issue created by migration from https://trac.sagemath.org/ticket/27765

Original creator: dunfield

Original creation time: 2019-05-04 16:18:57

CC:  vdelecroix jdemeyer mgoerner culler

For a number field K whose defining polynomial has a non-integral rational coefficient, factoring a polynomial with coefficients in K sometimes results in the following `UserWarning`:

```
SageMath version 8.8.beta1, Release Date: 2019-04-07
sage: K.<a> = NumberField(x^2 - 1/2)
sage: R.<y> = PolynomialRing(K)
sage: p = 11*a*y + 7
sage: p.factor()
/sage/local/lib/python3.7/site-packages/sage/rings/number_field/number_field.py:1682: UserWarning: interpreting PARI polynomial 11 relative to the defining polynomial x^2 - 2 of the PARI number field
  % (x, self.pari_polynomial()))
(11*a) * (y + 14/11*a)
```

This is related to #22202 and see [https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M](https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M) for further discussion.


---

Comment by dunfield created at 2019-05-04 16:28:05

I think I have a reasonable solution to this: `_element_constructor_` shouldn't raise the warning if the polynomial it's given is constant since that case is unambiguous.  Writing patch now...


---

Comment by dunfield created at 2019-05-04 17:13:04

Set assignee to dunfield.


---

Comment by dunfield created at 2019-05-04 17:13:04

New commits:


---

Comment by dunfield created at 2019-05-04 17:13:53

Ok, I think that does it.


---

Comment by dunfield created at 2019-05-04 17:13:53

Changing status from new to needs_review.


---

Comment by mgoerner created at 2019-06-13 20:20:32

Changing status from needs_review to positive_review.


---

Comment by mgoerner created at 2019-06-13 20:20:32

Thanks!


---

Comment by mgoerner created at 2019-06-14 00:32:25

I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:

```
>>> (pari('y^4')+pari('x^2')-pari('x^2')).poldegree()
0
>>> (pari('y^4')+pari('x^2')-pari('x^2'))[0]
y^4
```

I am not sure how much of a corner case this is and that there is actually additional work necessary. But I definitively want to think this over before giving it a positive review.


---

Comment by mgoerner created at 2019-06-14 00:32:25

Changing status from positive_review to needs_work.


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by dunfield created at 2019-06-23 22:25:14

Replying to [comment:5 mgoerner]:
> I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:

Hmm, Pari's handling of multivariable polynomials is pretty idiosyncratic:

```
sage: p = pari('x^2 + y^4')
sage: q = pari('x^2')
sage: p.variables(), q.variables()
([x, y], [x])
sage: a = p - p + 1
sage: a, a.poldegree(), a.variables()
(1, 0, [x])
sage: b = q - q
sage: b, b.poldegree(), b.variables()
(0, -9223372036854775807, [x])
sage: c = p - q
sage: c, c.poldegree(), c.variables()
(y^4, 0, [x, y])
sage: pari('z - z').variables()
[z]
sage: pari('z + x - z - x').variables()
[x]
```

I think the following is a better test for being constant:

```
sage: def degrees(poly): return [poly.poldegree(v) for v in poly.variables()]
sage: degrees(a)
[0]
sage: degrees(b)
[-9223372036854775807]
sage: degrees(c)
[0, 4]
sage: def is_const(poly): 
          return all(poly.poldegree(v) <= 0 for v in poly.variables())
sage: [is_const(x) for x in [a, b, c, p, q]]
[True, True, False, False, False]
```

I will update my branch along these lines.


---

Comment by git created at 2019-06-24 03:17:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dunfield created at 2019-06-24 03:19:45

Changing status from needs_work to needs_review.


---

Comment by mgoerner created at 2019-06-25 21:55:19

Thanks!


---

Comment by mgoerner created at 2019-06-25 21:55:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-07-07 12:36:14

Resolution: fixed
