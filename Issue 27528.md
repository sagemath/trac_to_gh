# Issue 27528: UserWarning when factoring polys over NumberFields

archive/issues_027528.json:
```json
{
    "body": "CC:  vdelecroix jdemeyer mgoerner culler\n\nFor a number field K whose defining polynomial has a non-integral rational coefficient, factoring a polynomial with coefficients in K sometimes results in the following `UserWarning`:\n\n```\nSageMath version 8.8.beta1, Release Date: 2019-04-07\nsage: K.<a> = NumberField(x^2 - 1/2)\nsage: R.<y> = PolynomialRing(K)\nsage: p = 11*a*y + 7\nsage: p.factor()\n/sage/local/lib/python3.7/site-packages/sage/rings/number_field/number_field.py:1682: UserWarning: interpreting PARI polynomial 11 relative to the defining polynomial x^2 - 2 of the PARI number field\n  % (x, self.pari_polynomial()))\n(11*a) * (y + 14/11*a)\n```\n\nThis is related to #22202 and see [https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M](https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M) for further discussion.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27765\n\n",
    "created_at": "2019-05-04T16:18:57Z",
    "labels": [
        "number fields",
        "minor",
        "bug"
    ],
    "title": "UserWarning when factoring polys over NumberFields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27528",
    "user": "dunfield"
}
```
CC:  vdelecroix jdemeyer mgoerner culler

For a number field K whose defining polynomial has a non-integral rational coefficient, factoring a polynomial with coefficients in K sometimes results in the following `UserWarning`:

```
SageMath version 8.8.beta1, Release Date: 2019-04-07
sage: K.<a> = NumberField(x^2 - 1/2)
sage: R.<y> = PolynomialRing(K)
sage: p = 11*a*y + 7
sage: p.factor()
/sage/local/lib/python3.7/site-packages/sage/rings/number_field/number_field.py:1682: UserWarning: interpreting PARI polynomial 11 relative to the defining polynomial x^2 - 2 of the PARI number field
  % (x, self.pari_polynomial()))
(11*a) * (y + 14/11*a)
```

This is related to #22202 and see [https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M](https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M) for further discussion.

Issue created by migration from https://trac.sagemath.org/ticket/27765





---

archive/issue_comments_388458.json:
```json
{
    "body": "I think I have a reasonable solution to this: `_element_constructor_` shouldn't raise the warning if the polynomial it's given is constant since that case is unambiguous.  Writing patch now...",
    "created_at": "2019-05-04T16:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388458",
    "user": "dunfield"
}
```

I think I have a reasonable solution to this: `_element_constructor_` shouldn't raise the warning if the polynomial it's given is constant since that case is unambiguous.  Writing patch now...



---

archive/issue_comments_388459.json:
```json
{
    "body": "Set assignee to dunfield.",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388459",
    "user": "dunfield"
}
```

Set assignee to dunfield.



---

archive/issue_comments_388460.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388460",
    "user": "dunfield"
}
```

New commits:



---

archive/issue_comments_388461.json:
```json
{
    "body": "Ok, I think that does it.",
    "created_at": "2019-05-04T17:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388461",
    "user": "dunfield"
}
```

Ok, I think that does it.



---

archive/issue_comments_388462.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-04T17:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388462",
    "user": "dunfield"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388463.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-13T20:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388463",
    "user": "mgoerner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388464.json:
```json
{
    "body": "Thanks!",
    "created_at": "2019-06-13T20:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388464",
    "user": "mgoerner"
}
```

Thanks!



---

archive/issue_comments_388465.json:
```json
{
    "body": "I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:\n\n```\n>>> (pari('y^4')+pari('x^2')-pari('x^2')).poldegree()\n0\n>>> (pari('y^4')+pari('x^2')-pari('x^2'))[0]\ny^4\n```\n\nI am not sure how much of a corner case this is and that there is actually additional work necessary. But I definitively want to think this over before giving it a positive review.",
    "created_at": "2019-06-14T00:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388465",
    "user": "mgoerner"
}
```

I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:

```
>>> (pari('y^4')+pari('x^2')-pari('x^2')).poldegree()
0
>>> (pari('y^4')+pari('x^2')-pari('x^2'))[0]
y^4
```

I am not sure how much of a corner case this is and that there is actually additional work necessary. But I definitively want to think this over before giving it a positive review.



---

archive/issue_comments_388466.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-06-14T00:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388466",
    "user": "mgoerner"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_388467.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388467",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_388468.json:
```json
{
    "body": "Replying to [comment:5 mgoerner]:\n> I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:\n\nHmm, Pari's handling of multivariable polynomials is pretty idiosyncratic:\n\n```\nsage: p = pari('x^2 + y^4')\nsage: q = pari('x^2')\nsage: p.variables(), q.variables()\n([x, y], [x])\nsage: a = p - p + 1\nsage: a, a.poldegree(), a.variables()\n(1, 0, [x])\nsage: b = q - q\nsage: b, b.poldegree(), b.variables()\n(0, -9223372036854775807, [x])\nsage: c = p - q\nsage: c, c.poldegree(), c.variables()\n(y^4, 0, [x, y])\nsage: pari('z - z').variables()\n[z]\nsage: pari('z + x - z - x').variables()\n[x]\n```\n\nI think the following is a better test for being constant:\n\n```\nsage: def degrees(poly): return [poly.poldegree(v) for v in poly.variables()]\nsage: degrees(a)\n[0]\nsage: degrees(b)\n[-9223372036854775807]\nsage: degrees(c)\n[0, 4]\nsage: def is_const(poly): \n          return all(poly.poldegree(v) <= 0 for v in poly.variables())\nsage: [is_const(x) for x in [a, b, c, p, q]]\n[True, True, False, False, False]\n```\n\nI will update my branch along these lines.",
    "created_at": "2019-06-23T22:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388468",
    "user": "dunfield"
}
```

Replying to [comment:5 mgoerner]:
> I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:

Hmm, Pari's handling of multivariable polynomials is pretty idiosyncratic:

```
sage: p = pari('x^2 + y^4')
sage: q = pari('x^2')
sage: p.variables(), q.variables()
([x, y], [x])
sage: a = p - p + 1
sage: a, a.poldegree(), a.variables()
(1, 0, [x])
sage: b = q - q
sage: b, b.poldegree(), b.variables()
(0, -9223372036854775807, [x])
sage: c = p - q
sage: c, c.poldegree(), c.variables()
(y^4, 0, [x, y])
sage: pari('z - z').variables()
[z]
sage: pari('z + x - z - x').variables()
[x]
```

I think the following is a better test for being constant:

```
sage: def degrees(poly): return [poly.poldegree(v) for v in poly.variables()]
sage: degrees(a)
[0]
sage: degrees(b)
[-9223372036854775807]
sage: degrees(c)
[0, 4]
sage: def is_const(poly): 
          return all(poly.poldegree(v) <= 0 for v in poly.variables())
sage: [is_const(x) for x in [a, b, c, p, q]]
[True, True, False, False, False]
```

I will update my branch along these lines.



---

archive/issue_comments_388469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-24T03:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388469",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-24T03:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388470",
    "user": "dunfield"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_388471.json:
```json
{
    "body": "Thanks!",
    "created_at": "2019-06-25T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388471",
    "user": "mgoerner"
}
```

Thanks!



---

archive/issue_comments_388472.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-25T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388472",
    "user": "mgoerner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388473.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-07T12:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27528#issuecomment-388473",
    "user": "vbraun"
}
```

Resolution: fixed
