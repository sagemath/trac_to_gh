# Issue 17723: Jinja2 is too old

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2015-03-15 18:48:29

CC:  fbissey

If you try to save ipython notebooks as pdf, you'll get the following error

```
$ sage -ipython nbconvert Untitled.ipynb --to pdf
[...]
  File "/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/IPython/nbconvert/exporters/../templates/latex/skeleton/null.tplx", line 34, in block "any_cell"
    ((*- block codecell scoped -*))
  File "/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/IPython/nbconvert/exporters/../templates/latex/skeleton/null.tplx", line 35, in block "codecell"
    ((*- block input_group -*))
  File "/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/IPython/nbconvert/exporters/../templates/latex/skeleton/null.tplx", line 37, in block "input_group"
    ((*- block input -*))((*- endblock input -*))
  File "/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/IPython/nbconvert/exporters/../templates/latex/style_ipython.tplx", line 23, in block "input"
    ((( add_prompt(cell.source | highlight_code(strip_verbatim=True), cell, 'In ', 'incolor') )))
UndefinedError: 'add_prompt' is undefined
```

Workaround is `sage -pip install --upgrade jinja2`


---

Comment by vbraun created at 2015-03-15 18:55:47

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-03-15 18:55:47

New commits:


---

Comment by fbissey created at 2015-03-15 19:04:44

Well, that will put you on par with sage-on-gentoo. Using that version since last November. +ing.


---

Comment by fbissey created at 2015-03-15 19:04:44

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-03-15 20:13:16

Darn I reverted to my default state of not putting my name after breakfast.


---

Comment by git created at 2015-03-16 20:32:13

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-03-16 20:32:13

Changing status from positive_review to needs_review.


---

Comment by vbraun created at 2015-03-16 20:32:47

Markupsafe is a new dependency of jinja...


---

Comment by fbissey created at 2015-03-16 20:40:09

Indeed I hadn't checked that. From what I can see it is the only one (apart from setuptools and sphinx if you want to build the doc). It appears that docutils is not a dependency of jinja2 anymore, I guess that's were sphinx is coming in.


---

Comment by fbissey created at 2015-03-16 21:00:28

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-03-16 21:37:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-03-16 21:37:54

sphinx depends on docutils for the record...


---

Comment by vbraun created at 2015-03-16 21:37:54

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2015-03-16 22:02:32

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-03-16 22:02:32

Replying to [comment:11 vbraun]:
> sphinx depends on docutils for the record...

That's a good record.


---

Comment by kcrisman created at 2015-03-17 01:50:23

No implications for sagenb, I assume?


---

Comment by fbissey created at 2015-03-17 01:56:00

None that I can see. Do you have something particular you want tested since I have the stuff in sage-on-gentoo at the 6.6.beta5 level?


---

Comment by kcrisman created at 2015-03-17 02:05:19

As long as templating and the server actually work and you don't see any obvious errors of that type, I guess it's okay.  I think flask depends on jinja2, right?


---

Comment by fbissey created at 2015-03-17 02:19:17


```
fbissey`@`QCD-nzi3 ~ $ equery d jinja 
 * These packages depend on jinja:
dev-python/flask-0.10.1-r1 (>=dev-python/jinja-2.4[python_targets_python2_7(-)?,python_targets_python3_3(-)?,python_targets_python3_4(-)?,python_targets_pypy(-)?,-python_single_target_python2_7(-),-python_single_target_python3_3(-),-python_single_target_python3_4(-),-python_single_target_pypy(-)])
dev-python/flask-babel-0.8-r1 (>=dev-python/jinja-2.5[python_targets_python2_7(-)?,-python_single_target_python2_7(-)])
dev-python/ipython-3.0.0 (test ? dev-python/jinja[python_targets_python2_7(-)?,python_targets_python3_3(-)?,python_targets_python3_4(-)?,-python_single_target_python2_7(-),-python_single_target_python3_3(-),-python_single_target_python3_4(-)])
                         (notebook ? dev-python/jinja[python_targets_python2_7(-)?,python_targets_python3_3(-)?,python_targets_python3_4(-)?,-python_single_target_python2_7(-),-python_single_target_python3_3(-),-python_single_target_python3_4(-)])
                         (dev-python/jinja[python_targets_python2_7(-)?,python_targets_python3_3(-)?,python_targets_python3_4(-)?,-python_single_target_python2_7(-),-python_single_target_python3_3(-),-python_single_target_python3_4(-)])
dev-python/sphinx-1.2.2 (>=dev-python/jinja-2.3[python_targets_python2_7(-)?,python_targets_python3_3(-)?,python_targets_python3_4(-)?,python_targets_pypy(-)?,-python_single_target_python2_7(-),-python_single_target_python3_3(-),-python_single_target_python3_4(-),-python_single_target_pypy(-)])
sci-mathematics/sage-9999 (>=dev-python/jinja-2.5.5[python_targets_python2_7(-)?,-python_single_target_python2_7(-)])
sci-mathematics/sage-notebook-0.11.4-r2 (>=dev-python/jinja-2.5.5[python_targets_python2_7(-)?,-python_single_target_python2_7(-)])
www-client/chromium-41.0.2272.76 (dev-python/jinja[python_targets_python2_7(-),python_single_target_python2_7(+)])
```



---

Comment by vbraun created at 2015-03-19 03:17:31

Resolution: fixed
