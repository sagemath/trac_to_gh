# Issue 10602: Fix optional animate.py doctests

archive/issues_010602.json:
```json
{
    "body": "Assignee: mvngu\n\nKeywords: convert ImageMagick animate optional\n\nPretty much all the optional tests in animate.py are fine to do if you possess ImageMagick and the convert command.  Some of them should really then save to a temp file (in the doctest).  \n\nThis ticket is to make sure that all of them have the actual keyword convert so that optional doctesting works, and to fix those temp files.  See #7981 for background.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10655\n\n",
    "created_at": "2011-01-18T14:17:51Z",
    "labels": [
        "doctest coverage",
        "minor",
        "bug"
    ],
    "title": "Fix optional animate.py doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10602",
    "user": "kcrisman"
}
```
Assignee: mvngu

Keywords: convert ImageMagick animate optional

Pretty much all the optional tests in animate.py are fine to do if you possess ImageMagick and the convert command.  Some of them should really then save to a temp file (in the doctest).  

This ticket is to make sure that all of them have the actual keyword convert so that optional doctesting works, and to fix those temp files.  See #7981 for background.

Issue created by migration from https://trac.sagemath.org/ticket/10655





---

archive/issue_comments_111060.json:
```json
{
    "body": "The patch at #11170 fixes this (although it uses the keyword ImageMagick instead of convert).",
    "created_at": "2011-04-10T23:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111060",
    "user": "jhpalmieri"
}
```

The patch at #11170 fixes this (although it uses the keyword ImageMagick instead of convert).



---

archive/issue_comments_111061.json:
```json
{
    "body": "Changing keywords from \"convert ImageMagick animate optional\" to \"convert ImageMagick animate optional sd31\".",
    "created_at": "2011-06-13T16:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111061",
    "user": "jhpalmieri"
}
```

Changing keywords from "convert ImageMagick animate optional" to "convert ImageMagick animate optional sd31".



---

archive/issue_comments_111062.json:
```json
{
    "body": "I think this can be closed now, since #11170 has been merged.  Can anyone confirm this?",
    "created_at": "2011-06-13T16:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111062",
    "user": "jhpalmieri"
}
```

I think this can be closed now, since #11170 has been merged.  Can anyone confirm this?



---

archive/issue_comments_111063.json:
```json
{
    "body": "Overall it's nearly ready to close.  I think you missed *one* of the tests.  See [this spot in animate.py](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l196) - I think that line 198 needs the keyword too.\n\nYup.\n\n```\nFile \"/Users/.../sage-5.0/devel/sage-main/sage/plot/animate.py\", line 198:\n    sage: b.show() # optional\nException raised:\n    Error: Neither ImageMagick nor ffmpeg appears to be installed. Saving an\n    animation to a GIF file or displaying an animation requires one of these\n    packages, so please install one of them and try again.\n\n    See www.imagemagick.org and www.ffmpeg.org for more information.\n**********************************************************************\n```\n\nIf I remembered how to test everything optional except a certain keyword, it wouldn't have taken so much hunting to find that snippet. Didn't you implement that somewhere?  But I couldn't find it in the developer guide for 5.0, so it must not have gotten in yet.",
    "created_at": "2012-05-17T18:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111063",
    "user": "kcrisman"
}
```

Overall it's nearly ready to close.  I think you missed *one* of the tests.  See [this spot in animate.py](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l196) - I think that line 198 needs the keyword too.

Yup.

```
File "/Users/.../sage-5.0/devel/sage-main/sage/plot/animate.py", line 198:
    sage: b.show() # optional
Exception raised:
    Error: Neither ImageMagick nor ffmpeg appears to be installed. Saving an
    animation to a GIF file or displaying an animation requires one of these
    packages, so please install one of them and try again.

    See www.imagemagick.org and www.ffmpeg.org for more information.
**********************************************************************
```

If I remembered how to test everything optional except a certain keyword, it wouldn't have taken so much hunting to find that snippet. Didn't you implement that somewhere?  But I couldn't find it in the developer guide for 5.0, so it must not have gotten in yet.



---

archive/issue_comments_111064.json:
```json
{
    "body": "Here's a patch adding `optional -- ImageMagick` marks to three doctests. If you run something like `sage -t --only-optional=ImageMagick`, then it will run tests marked with `ImageMagick`, but I don't think we've implemented anything which says to skip tests marked a certain way.",
    "created_at": "2012-06-12T20:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111064",
    "user": "jhpalmieri"
}
```

Here's a patch adding `optional -- ImageMagick` marks to three doctests. If you run something like `sage -t --only-optional=ImageMagick`, then it will run tests marked with `ImageMagick`, but I don't think we've implemented anything which says to skip tests marked a certain way.



---

archive/issue_comments_111065.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-12T20:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111065",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_111066.json:
```json
{
    "body": "Umm, the second two doctests might be optional for some reason, but they don't require ImageMagick.  I just tested this by renaming `convert` so that\n\n```\nsage -t --only-optional=ImageMagick\n```\n\nfailed, and those tests did not shows up as ones that failed.  If you look at [the code](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l291), too, it doesn't use anything except the initialization (which doesn't need convert) and `graphics_array`, which clearly doesn't either.\n\nI don't know what you want to do with those, but at any rate this isn't the right solution.  Maybe instead put a little note that these don't require convert or something?\n\nAlso, please use a more descriptive commit message.",
    "created_at": "2012-06-12T21:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111066",
    "user": "kcrisman"
}
```

Umm, the second two doctests might be optional for some reason, but they don't require ImageMagick.  I just tested this by renaming `convert` so that

```
sage -t --only-optional=ImageMagick
```

failed, and those tests did not shows up as ones that failed.  If you look at [the code](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l291), too, it doesn't use anything except the initialization (which doesn't need convert) and `graphics_array`, which clearly doesn't either.

I don't know what you want to do with those, but at any rate this isn't the right solution.  Maybe instead put a little note that these don't require convert or something?

Also, please use a more descriptive commit message.



---

archive/issue_comments_111067.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-12T21:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111067",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_111068.json:
```json
{
    "body": "Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.",
    "created_at": "2012-06-12T21:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111068",
    "user": "jhpalmieri"
}
```

Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.



---

archive/issue_comments_111069.json:
```json
{
    "body": "Attachment\n\n> Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.\nMy thoughts exactly.\n\nAnyway, this looks good.  Testing with `--only-optional`... testing with `--optional`... good to go.",
    "created_at": "2012-06-12T21:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111069",
    "user": "kcrisman"
}
```

Attachment

> Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.
My thoughts exactly.

Anyway, this looks good.  Testing with `--only-optional`... testing with `--optional`... good to go.



---

archive/issue_comments_111070.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-06-12T21:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111070",
    "user": "kcrisman"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_111071.json:
```json
{
    "body": "Changing keywords from \"convert ImageMagick animate optional sd31\" to \"convert ImageMagick animate optional sd31 sd41\".",
    "created_at": "2012-06-15T23:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111071",
    "user": "jhpalmieri"
}
```

Changing keywords from "convert ImageMagick animate optional sd31" to "convert ImageMagick animate optional sd31 sd41".



---

archive/issue_comments_111072.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-23T07:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10602#issuecomment-111072",
    "user": "jdemeyer"
}
```

Resolution: fixed
