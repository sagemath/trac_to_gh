# Issue 10602: Fix optional animate.py doctests

Issue created by migration from https://trac.sagemath.org/ticket/10655

Original creator: kcrisman

Original creation time: 2011-01-18 14:17:51

Assignee: mvngu

Keywords: convert ImageMagick animate optional

Pretty much all the optional tests in animate.py are fine to do if you possess ImageMagick and the convert command.  Some of them should really then save to a temp file (in the doctest).  

This ticket is to make sure that all of them have the actual keyword convert so that optional doctesting works, and to fix those temp files.  See #7981 for background.


---

Comment by jhpalmieri created at 2011-04-10 23:19:39

The patch at #11170 fixes this (although it uses the keyword ImageMagick instead of convert).


---

Comment by jhpalmieri created at 2011-06-13 16:40:15

Changing keywords from "convert ImageMagick animate optional" to "convert ImageMagick animate optional sd31".


---

Comment by jhpalmieri created at 2011-06-13 16:40:15

I think this can be closed now, since #11170 has been merged.  Can anyone confirm this?


---

Comment by kcrisman created at 2012-05-17 18:23:27

Overall it's nearly ready to close.  I think you missed _one_ of the tests.  See [this spot in animate.py](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l196) - I think that line 198 needs the keyword too.

Yup.

```
File "/Users/.../sage-5.0/devel/sage-main/sage/plot/animate.py", line 198:
    sage: b.show() # optional
Exception raised:
    Error: Neither ImageMagick nor ffmpeg appears to be installed. Saving an
    animation to a GIF file or displaying an animation requires one of these
    packages, so please install one of them and try again.

    See www.imagemagick.org and www.ffmpeg.org for more information.
**********************************************************************
```

If I remembered how to test everything optional except a certain keyword, it wouldn't have taken so much hunting to find that snippet. Didn't you implement that somewhere?  But I couldn't find it in the developer guide for 5.0, so it must not have gotten in yet.


---

Comment by jhpalmieri created at 2012-06-12 20:13:55

Here's a patch adding `optional -- ImageMagick` marks to three doctests. If you run something like `sage -t --only-optional=ImageMagick`, then it will run tests marked with `ImageMagick`, but I don't think we've implemented anything which says to skip tests marked a certain way.


---

Comment by jhpalmieri created at 2012-06-12 20:13:55

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-06-12 21:06:47

Umm, the second two doctests might be optional for some reason, but they don't require ImageMagick.  I just tested this by renaming `convert` so that

```
sage -t --only-optional=ImageMagick
```

failed, and those tests did not shows up as ones that failed.  If you look at [the code](http://hg.sagemath.org/sage-main/file/9ab4ab6e12d0/sage/plot/animate.py#l291), too, it doesn't use anything except the initialization (which doesn't need convert) and `graphics_array`, which clearly doesn't either.

I don't know what you want to do with those, but at any rate this isn't the right solution.  Maybe instead put a little note that these don't require convert or something?

Also, please use a more descriptive commit message.


---

Comment by kcrisman created at 2012-06-12 21:06:47

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2012-06-12 21:17:00

Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.


---

Attachment

> Hmm. Why are they optional in the first place, then? I'll remove those tags, anyway.
My thoughts exactly.

Anyway, this looks good.  Testing with `--only-optional`... testing with `--optional`... good to go.


---

Comment by kcrisman created at 2012-06-12 21:45:02

Changing status from needs_work to positive_review.


---

Comment by jhpalmieri created at 2012-06-15 23:14:06

Changing keywords from "convert ImageMagick animate optional sd31" to "convert ImageMagick animate optional sd31 sd41".


---

Comment by jdemeyer created at 2012-06-23 07:44:28

Resolution: fixed
