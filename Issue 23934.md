# Issue 23934: Formal set membership function

Issue created by migration from https://trac.sagemath.org/ticket/24171

Original creator: rws

Original creation time: 2017-11-07 07:43:02

CC:  vdelecroix

To express solution sets from solvers an expression-is-element-of-set relation is needed. For ease of implementation this can be made a formal function, likely named "contains". It would depend on sets being made coercible into SR.


---

Comment by rws created at 2017-11-07 15:09:40

New commits:


---

Comment by rws created at 2017-11-07 15:09:40

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-11-07 23:20:43

I can reproduce this error

```
**********************************************************************
File "src/sage/misc/dev_tools.py", line 438, in sage.misc.dev_tools.import_statements
Failed example:
    load_submodules(sage.sets)
Expected:
    load sage.sets.real_set... succeeded
    load sage.sets.set_from_iterator... succeeded
Got:
    load sage.sets.set_from_iterator... succeeded
```

I think why this now fails is because `real_set` is now loaded on startup.


---

Comment by rws created at 2017-11-08 06:42:57

I think it would be good if `RealSet` answered positive to `is_Set`, I'm just not sure how to accomplish it correctly. If done it wouldn't need to be loaded at start.


---

Comment by rws created at 2017-11-08 06:42:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-11-08 08:24:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-11-08 08:25:16

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-11-08 14:06:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-11-08 22:55:30

LGTM. Thanks.


---

Comment by tscrim created at 2017-11-08 22:55:30

Changing status from needs_review to positive_review.


---

Comment by rws created at 2017-11-09 06:08:44

Thanks for the review.


---

Comment by vbraun created at 2017-12-08 00:06:54

Merge conflictw


---

Comment by vbraun created at 2017-12-08 00:06:54

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-12-14 06:53:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-12-14 06:54:19

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-12-14 23:34:31

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-12-14 23:34:31

See patchbot


---

Comment by rws created at 2017-12-18 08:09:38

Actually the fails are due to the blockers #24284 and #24378 but they are not reviewed yet.


---

Comment by rws created at 2017-12-18 08:32:48

OK, I added junk to the branch, so what Volker means are the patchbot plugin fails. Also, the rare random fails are now happening frequently so patchbot pass depend on the blockers.
----
New commits:


---

Comment by rws created at 2017-12-18 14:10:49

Actually the reason why #24171 fails the random expression tests is because the here introduced function is yet another function that fails that test.


---

Comment by git created at 2017-12-18 14:20:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-12-30 08:32:37

The following problem appeared: to be able to use a symbolic `element_of` function its arguments (1. expression, 2. set/domain) must be convertible to the symbolic ring. One doctest in `symbolic/ring.pyx` tests that `r` (the R interpreter) does not convert to symbolic. But `r` is `in Sets()` and so we cannot simply test for `x in Sets()` and allow conversion of `x` because `r` would then be allowed.

So we must test for all kinds of sets, e.g. `ZZ in InfiniteEnumeratedSets()`, `RR in Fields()`, `RealSet(0,1) in SetsWithPartialMaps()`, and `Set(range(0,5)) in FiniteSets()`, because we need to catch all of these but cannot use the catch-all `in Sets()`. Is the R interpreter really in the sets category? Is there a better catch-all?


---

Comment by rws created at 2017-12-30 08:32:37

Changing status from needs_work to needs_info.


---

Comment by rws created at 2017-12-30 08:38:42

BTW `RealSet(-oo,oo) in Fields()` is False which looks like a bug, right?


---

Comment by vdelecroix created at 2017-12-30 09:16:34

Replying to [comment:23 rws]:
> BTW `RealSet(-oo,oo) in Fields()` is False which looks like a bug, right?

Not to me. `RealSet(-oo,oo)` or `RealSet(0,1)` act as a facade (like in `Sets().Facade()`). That is to say, it does not have any proper elements. Making it a field would be rather artificial because the operation `+` and `*` that might (or might not) exist on the elements is obtained from other parts of Sage.


---

Comment by rws created at 2017-12-31 07:19:40

Replying to [comment:24 vdelecroix]:
> ... `RealSet(-oo,oo)` or `RealSet(0,1)` act as a facade ...

Is there an object that can act as the set of real numbers in Sage?


---

Comment by vdelecroix created at 2017-12-31 09:51:44

Replying to [comment:25 rws]:
> Replying to [comment:24 vdelecroix]:
> > ... `RealSet(-oo,oo)` or `RealSet(0,1)` act as a facade ...
> 
> Is there an object that can act as the set of real numbers in Sage?

Very sadly, no!

My dream is:

1. rename `RealField(prec)` -> `RealFloatingPointField_mpfr(prec)`
2. rename `RealLazyField` -> `RealComputableField` and `RLF -> RCF`
3. create a class `RealField()` to model (abstractly) the set of real numbers
4. rename `RR` -> `RFPF`

The reason for 2./3. is that we want to distinguish between the field of all real numbers (denoted `RR` in math literature) and the field of [computable numbers](https://en.wikipedia.org/wiki/Computable_number) (which is a countable subfield). An element of `RCF` would simply be a computer program that gives access to the digit expansion of a number. It should provide access to all mathematical constants like `pi`, `e`, etc and most transcendental functions. A serious problem about `RCF` is that the equality is not decidable... but we can not avoid it.

The set of real numbers (my number 3. in the list) would not implement anything serious. It would only act as an abstract set that can be obtained as the metric completion of `QQ`. It could be used as a building block for more advanced structures (like manfiolds).

I put 4. apart as it is a serious backward incompatibility.reasons.


---

Comment by rws created at 2018-01-02 07:12:20

Changing status from needs_info to needs_work.


---

Comment by rws created at 2018-01-02 09:24:00

This now depends on #24456 and has sufficiently changed to need a new review. Could you please?
----
New commits:


---

Comment by rws created at 2018-01-02 09:24:00

Changing status from needs_work to needs_review.


---

Comment by rws created at 2018-01-02 09:28:20

Note that we have no proper check for if something is a subset of the complexes. I ended up allowing conversion of all finite sets and `(NN, ZZ, QQ, RealField, RealSet, AA)` to symbolic.


---

Comment by rws created at 2018-01-27 07:59:20

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-06-09 02:22:55

rebased away from stalled dependency #24456
----
New commits:


---

Comment by mkoeppe created at 2021-06-09 03:14:19

The `is_finite` method added here will not be necessary any more with #31877


---

Comment by git created at 2021-06-09 03:22:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-09 03:39:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-09 03:55:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-09 04:16:49

This branch works now as advertised, but a careful review of this design is needed


---

Comment by mkoeppe created at 2021-06-09 04:16:49

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-06-09 04:46:10

We could add more support for other infinite sets later on (e.g., number fields), but this would be good for most (perhaps all?) use-cases. I think everything else is good except I don't understand why this line is added (see the diff):

```
oo = infinity
```



---

Comment by mkoeppe created at 2021-06-09 04:48:35

that's just a leftover, I'll get rid of it


---

Comment by git created at 2021-06-09 04:49:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-06-09 04:51:19

Thank you. Green bot => positive review. Please add yourself whether you think you are an author and/or reviewer.


---

Comment by git created at 2021-06-09 04:55:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-09 05:04:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-06-09 23:31:47

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-06-09 23:36:07

Thanks!


---

Comment by vbraun created at 2021-07-01 20:45:14

Resolution: fixed
