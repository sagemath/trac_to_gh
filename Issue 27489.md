# Issue 27489: some cleanup in quadratic forms

Issue created by migration from https://trac.sagemath.org/ticket/27726

Original creator: chapoton

Original creation time: 2019-04-25 12:41:36

CC:  tscrim sbrandhorst

some pyflakes, pep, and code cleanup in just a few files there


---

Comment by chapoton created at 2019-04-25 12:45:05

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-04-25 12:45:05

New commits:


---

Comment by chapoton created at 2019-04-25 16:49:37

green bot, please review


---

Comment by tscrim created at 2019-04-25 22:52:01

I am not quite in favor of these changes:

```diff
-#from sage.quadratic_forms.quadratic_form import QuadraticForm    ## This creates a circular import! =(
 
 
-####################################################################################
-## Routines used for understanding p-neighbors, and computing classes in a genus. ##
-####################################################################################
+# ######################################################################
+# Routines used for understanding p-neighbors and computing classes in a genus.
+# ######################################################################
```

The first one deserves to be there as a warning for future code. For the latter, the first looks better visually IMO. However, that one is clearly bikeshedding, so I won't push it.

```diff
-    ## Find a (dual) vector w with B(v,w) != 0 (mod p)
-    v_dual = B2 * vector(v)     ## We want the dot product with this to not be divisible by 2*p.
+    # Find a (dual) vector w with B(v,w) != 0 (mod p)
+    v_dual = B2 * vector(v)
+    # We want the dot product with this to not be divisible by 2*p.
```

For this change, I feel the comment is better served before the `v_dual` line if you do not want it on the same line.

```diff
     if hasattr(self, "__split_local_cover"):
         if is_QuadraticForm(self.__split_local_cover):  ## Here the computation has been done.
             return self.__split_local_cover
-        elif isinstance(self.__split_local_cover, Integer):    ## Here it indexes the values already tried!
+        elif self.__split_local_cover in ZZ:    ## Here it indexes the values already tried!
             current_length = self.__split_local_cover + 1
             Length_Max = current_length + 5
     else:
```

I am slightly worried about this change as `ZZ` and `QQ` elements are slightly different and this can matter. I don't think so, but I am cc-ing Simon to see if he agrees that this change is completely safe (and to look over the other changes in case he has some other comments).


---

Comment by sbrandhorst created at 2019-04-26 06:54:05

grepping `__split_local_cover`
shows that is is either a quadratic form 
or an Integer. The change mentioned should be safe.

Thanks for the cleanup.
Note that there is still a lot of broken/incomplete code around 
in the quadratic forms folder.


---

Comment by git created at 2019-04-26 07:00:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-04-26 07:00:30

some fixes as suggested


---

Comment by tscrim created at 2019-04-26 14:38:40

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-04-26 14:38:40

Thanks. LGTM.


---

Comment by vbraun created at 2019-04-29 11:50:46

Resolution: fixed
