# Issue 27489: some cleanup in quadratic forms

archive/issues_027489.json:
```json
{
    "body": "CC:  tscrim sbrandhorst\n\nsome pyflakes, pep, and code cleanup in just a few files there\n\nIssue created by migration from https://trac.sagemath.org/ticket/27726\n\n",
    "created_at": "2019-04-25T12:41:36Z",
    "labels": [
        "quadratic forms",
        "minor",
        "enhancement"
    ],
    "title": "some cleanup in quadratic forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27489",
    "user": "chapoton"
}
```
CC:  tscrim sbrandhorst

some pyflakes, pep, and code cleanup in just a few files there

Issue created by migration from https://trac.sagemath.org/ticket/27726





---

archive/issue_comments_387592.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-25T12:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387592",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_387593.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-04-25T12:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387593",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_387594.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2019-04-25T16:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387594",
    "user": "chapoton"
}
```

green bot, please review



---

archive/issue_comments_387595.json:
```json
{
    "body": "I am not quite in favor of these changes:\n\n```diff\n-#from sage.quadratic_forms.quadratic_form import QuadraticForm    ## This creates a circular import! =(\n \n \n-####################################################################################\n-## Routines used for understanding p-neighbors, and computing classes in a genus. ##\n-####################################################################################\n+# ######################################################################\n+# Routines used for understanding p-neighbors and computing classes in a genus.\n+# ######################################################################\n```\n\nThe first one deserves to be there as a warning for future code. For the latter, the first looks better visually IMO. However, that one is clearly bikeshedding, so I won't push it.\n\n```diff\n-    ## Find a (dual) vector w with B(v,w) != 0 (mod p)\n-    v_dual = B2 * vector(v)     ## We want the dot product with this to not be divisible by 2*p.\n+    # Find a (dual) vector w with B(v,w) != 0 (mod p)\n+    v_dual = B2 * vector(v)\n+    # We want the dot product with this to not be divisible by 2*p.\n```\n\nFor this change, I feel the comment is better served before the `v_dual` line if you do not want it on the same line.\n\n```diff\n     if hasattr(self, \"__split_local_cover\"):\n         if is_QuadraticForm(self.__split_local_cover):  ## Here the computation has been done.\n             return self.__split_local_cover\n-        elif isinstance(self.__split_local_cover, Integer):    ## Here it indexes the values already tried!\n+        elif self.__split_local_cover in ZZ:    ## Here it indexes the values already tried!\n             current_length = self.__split_local_cover + 1\n             Length_Max = current_length + 5\n     else:\n```\n\nI am slightly worried about this change as `ZZ` and `QQ` elements are slightly different and this can matter. I don't think so, but I am cc-ing Simon to see if he agrees that this change is completely safe (and to look over the other changes in case he has some other comments).",
    "created_at": "2019-04-25T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387595",
    "user": "tscrim"
}
```

I am not quite in favor of these changes:

```diff
-#from sage.quadratic_forms.quadratic_form import QuadraticForm    ## This creates a circular import! =(
 
 
-####################################################################################
-## Routines used for understanding p-neighbors, and computing classes in a genus. ##
-####################################################################################
+# ######################################################################
+# Routines used for understanding p-neighbors and computing classes in a genus.
+# ######################################################################
```

The first one deserves to be there as a warning for future code. For the latter, the first looks better visually IMO. However, that one is clearly bikeshedding, so I won't push it.

```diff
-    ## Find a (dual) vector w with B(v,w) != 0 (mod p)
-    v_dual = B2 * vector(v)     ## We want the dot product with this to not be divisible by 2*p.
+    # Find a (dual) vector w with B(v,w) != 0 (mod p)
+    v_dual = B2 * vector(v)
+    # We want the dot product with this to not be divisible by 2*p.
```

For this change, I feel the comment is better served before the `v_dual` line if you do not want it on the same line.

```diff
     if hasattr(self, "__split_local_cover"):
         if is_QuadraticForm(self.__split_local_cover):  ## Here the computation has been done.
             return self.__split_local_cover
-        elif isinstance(self.__split_local_cover, Integer):    ## Here it indexes the values already tried!
+        elif self.__split_local_cover in ZZ:    ## Here it indexes the values already tried!
             current_length = self.__split_local_cover + 1
             Length_Max = current_length + 5
     else:
```

I am slightly worried about this change as `ZZ` and `QQ` elements are slightly different and this can matter. I don't think so, but I am cc-ing Simon to see if he agrees that this change is completely safe (and to look over the other changes in case he has some other comments).



---

archive/issue_comments_387596.json:
```json
{
    "body": "grepping `__split_local_cover`\nshows that is is either a quadratic form \nor an Integer. The change mentioned should be safe.\n\nThanks for the cleanup.\nNote that there is still a lot of broken/incomplete code around \nin the quadratic forms folder.",
    "created_at": "2019-04-26T06:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387596",
    "user": "sbrandhorst"
}
```

grepping `__split_local_cover`
shows that is is either a quadratic form 
or an Integer. The change mentioned should be safe.

Thanks for the cleanup.
Note that there is still a lot of broken/incomplete code around 
in the quadratic forms folder.



---

archive/issue_comments_387597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-26T07:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387598.json:
```json
{
    "body": "some fixes as suggested",
    "created_at": "2019-04-26T07:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387598",
    "user": "chapoton"
}
```

some fixes as suggested



---

archive/issue_comments_387599.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-26T14:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387599",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387600.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2019-04-26T14:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387600",
    "user": "tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_387601.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-29T11:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27489#issuecomment-387601",
    "user": "vbraun"
}
```

Resolution: fixed
