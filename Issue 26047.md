# Issue 26047: Avoid comparison of vertex labels in MIP (Step 3)

archive/issues_026047.json:
```json
{
    "body": "CC:  @tscrim @fchapoton\n\nAvoid comparison of vertex labels in `connectivity.pyx`.\n\nThis ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26284\n\n",
    "created_at": "2018-09-14T14:19:04Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Avoid comparison of vertex labels in MIP (Step 3)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26047",
    "user": "https://github.com/dcoudert"
}
```
CC:  @tscrim @fchapoton

Avoid comparison of vertex labels in `connectivity.pyx`.

This ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.


Issue created by migration from https://trac.sagemath.org/ticket/26284





---

archive/issue_comments_366935.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-14T14:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366935",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_366936.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-14T14:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366936",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_366937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-15T17:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366937",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-16T09:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366939.json:
```json
{
    "body": "This change will be a slowdown:\n\n```diff\n-    if g.is_directed():\n-        reorder_edge = lambda x,y : (x,y)\n-    else:\n-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)\n+    def reorder_edge(x, y):\n+        if g.is_directed():\n+            return (x,y)\n+        else:\n+            return frozenset((x,y))\n```\n\nas everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:\n\n```diff\n-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)\n-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)\n+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)\n+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)\n```\n\n(We already know that `g` is not directed here.)\nMove this line into each of the two branches above:\n\n```\np.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))\n```\n\n\n```diff\n-        for u,v,l in g.edge_iterator():\n-            if in_cut[reorder_edge(u,v)] == 1:\n-                edges.append((u,v,l))\n+        if g.is_directed():\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[u,v] == 1:\n+                    edges.append((u,v,l))\n+        else:\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[frozenset(u,v)] == 1:\n+                    edges.append((u,v,l))\n```\n\n\nAlso PEP8 says remove the whitespace before the closing parenthesis:\n\n```diff\n-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )\n+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )\n```\n",
    "created_at": "2018-10-03T22:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366939",
    "user": "https://github.com/tscrim"
}
```

This change will be a slowdown:

```diff
-    if g.is_directed():
-        reorder_edge = lambda x,y : (x,y)
-    else:
-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)
+    def reorder_edge(x, y):
+        if g.is_directed():
+            return (x,y)
+        else:
+            return frozenset((x,y))
```

as everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:

```diff
-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)
-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)
+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)
+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)
```

(We already know that `g` is not directed here.)
Move this line into each of the two branches above:

```
p.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))
```


```diff
-        for u,v,l in g.edge_iterator():
-            if in_cut[reorder_edge(u,v)] == 1:
-                edges.append((u,v,l))
+        if g.is_directed():
+            for u,v,l in g.edge_iterator():
+                if in_cut[u,v] == 1:
+                    edges.append((u,v,l))
+        else:
+            for u,v,l in g.edge_iterator():
+                if in_cut[frozenset(u,v)] == 1:
+                    edges.append((u,v,l))
```


Also PEP8 says remove the whitespace before the closing parenthesis:

```diff
-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )
+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )
```




---

archive/issue_comments_366940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-04T07:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366941.json:
```json
{
    "body": "Right, `reorder_edge` was not needed here.",
    "created_at": "2018-10-04T07:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366941",
    "user": "https://github.com/dcoudert"
}
```

Right, `reorder_edge` was not needed here.



---

archive/issue_comments_366942.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2018-10-04T07:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366942",
    "user": "https://github.com/tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_366943.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-04T07:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366943",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366944.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-05T16:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26047",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26047#issuecomment-366944",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
