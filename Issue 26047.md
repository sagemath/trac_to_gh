# Issue 26047: Avoid comparison of vertex labels in MIP (Step 3)

Issue created by migration from https://trac.sagemath.org/ticket/26284

Original creator: dcoudert

Original creation time: 2018-09-14 14:19:04

CC:  tscrim chapoton

Avoid comparison of vertex labels in `connectivity.pyx`.

This ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.



---

Comment by dcoudert created at 2018-09-14 14:21:00

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-09-14 14:21:00

New commits:


---

Comment by git created at 2018-09-15 17:07:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-16 09:27:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-03 22:22:04

This change will be a slowdown:

```diff
-    if g.is_directed():
-        reorder_edge = lambda x,y : (x,y)
-    else:
-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)
+    def reorder_edge(x, y):
+        if g.is_directed():
+            return (x,y)
+        else:
+            return frozenset((x,y))
```

as everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:

```diff
-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)
-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)
+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)
+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)
```

(We already know that `g` is not directed here.)
Move this line into each of the two branches above:

```
p.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))
```


```diff
-        for u,v,l in g.edge_iterator():
-            if in_cut[reorder_edge(u,v)] == 1:
-                edges.append((u,v,l))
+        if g.is_directed():
+            for u,v,l in g.edge_iterator():
+                if in_cut[u,v] == 1:
+                    edges.append((u,v,l))
+        else:
+            for u,v,l in g.edge_iterator():
+                if in_cut[frozenset(u,v)] == 1:
+                    edges.append((u,v,l))
```


Also PEP8 says remove the whitespace before the closing parenthesis:

```diff
-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )
+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )
```



---

Comment by git created at 2018-10-04 07:22:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-04 07:27:46

Right, `reorder_edge` was not needed here.


---

Comment by tscrim created at 2018-10-04 07:47:06

Thanks. LGTM.


---

Comment by tscrim created at 2018-10-04 07:47:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-05 16:56:57

Resolution: fixed
