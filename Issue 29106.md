# Issue 29106: Improve pari_nftables spkg_configure.m4

Issue created by migration from https://trac.sagemath.org/ticket/29343

Original creator: mkoeppe

Original creation time: 2020-03-15 21:13:33

CC:  dimpase embray fbissey isuruf @timokau arojas slelievre vdelecroix

spkg_configure.m4 of pari_nftables does not check at all for a system package; but one is provided on Fedora and other distributions


---

Comment by slelievre created at 2022-01-02 02:53:26

Changing keywords from "" to "spkg-configure".


---

Comment by dimpase created at 2022-01-04 14:27:31

It's certainly not hard to write such a test, following what is in `pari/spkg-configure.m4` for other pari packages needed by pari.


---

Comment by dimpase created at 2022-01-17 09:54:45

How does one check from `gp` that nftables are installed?


---

Comment by slelievre created at 2022-07-27 11:02:25

Replying to [comment:4 dimpase]:
> How does one check from `gp` that nftables are installed? 

From the [pari packages page](http://pari.math.u-bordeaux.fr/packages.html):

> This package requires no installation:
> extract it where desired and look at the
> [README](http://pari.math.u-bordeaux1.fr/pub/pari/packages/nftables/README.txt).

Karim Belabas tells me that

> nftables is not used by 'gp' (it is just an external table,
> also available via LMFDB), there is no reasonable way to test
> whether it is installed from the binary.
>
> For the package 'nflistdata', we can do something like
>
> {{{
> iferr(!!nflist("A5"), E, 0, errname(E) == "e_PACKAGE");
> }}}
>
> (returns 1 iff the package is there); this adapts
> to all packages used by gp, cf
>
> http://pari.math.u-bordeaux.fr/packages.html
>
> D. To test whether a package is available.


---

Comment by dimpase created at 2022-07-29 08:30:34

Adding Fedora record for nftables


---

Comment by dimpase created at 2022-07-29 08:30:34

Changing status from new to needs_review.


---

Comment by git created at 2022-07-29 08:32:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-07-29 08:35:28

Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)


---

Comment by dimpase created at 2022-07-29 08:37:52

I've opened #34243 to add `nflistdata` package.


---

Comment by dimpase created at 2022-07-29 08:39:57

Replying to [comment:9 fbissey]:
> Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)
no real need - it's already in `build/pkgs/pari/distros/gentoo.txt`


---

Comment by mkoeppe created at 2022-07-29 17:41:10

The branch does not do what the summary promises


---

Comment by mkoeppe created at 2022-07-29 17:41:10

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2022-07-29 22:18:56

we actually don't know how to do this test for pari 2.13.


---

Comment by dimpase created at 2022-07-31 08:39:49

Various distros carry a package named `nftables` - but it's stuff to do with network management, not Pari-GP


---

Comment by git created at 2022-07-31 08:47:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2022-07-31 09:49:28

This works:

```
$ gp -q
? default(parisize, 100000000);                                                                         
? v=readvec("/usr/share/pari/nftables/T31.gp")
%3 = [[-23, [1, -1, 0, 1], 1, []], ...
```


This is of course far from ideal, as the absolute path should be replaced by something known to `gp`. Also, `T31` is too big for the default stack size of 7Mb, it's better to use smaller `T71`. E.g., assuming that `nftables` is installed in Pari-GP `datadir`, one can do instead

```
$ gp -q
? v=readvec(concat([default(datadir), "/nftables/T71.gp"]));
```


This call returns nothing if `T71` is there, and otherwise it produces an error and gives `break>` prompt.


---

Comment by git created at 2022-07-31 11:18:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-07-31 11:19:40

OK, this appears to work. Please review.


---

Comment by dimpase created at 2022-07-31 11:19:40

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-07-31 11:21:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2022-08-04 08:40:15

ping?


---

Comment by mkoeppe created at 2022-08-04 17:07:12

How does one test it?


---

Comment by dimpase created at 2022-08-04 18:55:56

one either tests on a system where pari/GP nftables is a system package, e.g. Fedora 36 or Gentoo.

or manually installs the pari/GP package into default(datadir)


---

Comment by mkoeppe created at 2022-08-04 19:06:31

But test what? Neither the SPKG.rst nor any other part of our documentation offers a hint what can be done with it


---

Comment by dimpase created at 2022-08-04 19:15:30

test that the package is recognised by ./configure - I thought it is evident...


---

Comment by dimpase created at 2022-08-31 15:11:40

ping?


---

Comment by mkoeppe created at 2022-08-31 15:38:25

Can you please add to `SPKG.rst` information how one uses this package after installation. A pointer more specific than the project URL http://pari.math.u-bordeaux.fr/ is needed


---

Comment by git created at 2022-08-31 19:48:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2022-08-31 19:50:47

I don't really know how to use it - I added a link to package's README (which doesn't really have this info either). (and rebased over 9.7.rc0).


---

Comment by dimpase created at 2022-09-25 14:39:39

ping?
