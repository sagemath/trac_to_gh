# Issue 29106: Improve pari_nftables spkg_configure.m4

archive/issues_029106.json:
```json
{
    "body": "CC:  @dimpase @embray @kiwifb @isuruf @timokau @antonio-rojas @slel @videlec\n\nspkg_configure.m4 of pari_nftables does not check at all for a system package; but one is provided on Fedora and other distributions\n\nIssue created by migration from https://trac.sagemath.org/ticket/29343\n\n",
    "created_at": "2020-03-15T21:13:33Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Improve pari_nftables spkg_configure.m4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29106",
    "user": "@mkoeppe"
}
```
CC:  @dimpase @embray @kiwifb @isuruf @timokau @antonio-rojas @slel @videlec

spkg_configure.m4 of pari_nftables does not check at all for a system package; but one is provided on Fedora and other distributions

Issue created by migration from https://trac.sagemath.org/ticket/29343





---

archive/issue_comments_411992.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure\".",
    "created_at": "2022-01-02T02:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411992",
    "user": "@slel"
}
```

Changing keywords from "" to "spkg-configure".



---

archive/issue_comments_411993.json:
```json
{
    "body": "It's certainly not hard to write such a test, following what is in `pari/spkg-configure.m4` for other pari packages needed by pari.",
    "created_at": "2022-01-04T14:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411993",
    "user": "@dimpase"
}
```

It's certainly not hard to write such a test, following what is in `pari/spkg-configure.m4` for other pari packages needed by pari.



---

archive/issue_comments_411994.json:
```json
{
    "body": "How does one check from `gp` that nftables are installed?",
    "created_at": "2022-01-17T09:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411994",
    "user": "@dimpase"
}
```

How does one check from `gp` that nftables are installed?



---

archive/issue_comments_411995.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> How does one check from `gp` that nftables are installed? \n\nFrom the [pari packages page](http://pari.math.u-bordeaux.fr/packages.html):\n\n> This package requires no installation:\n> extract it where desired and look at the\n> [README](http://pari.math.u-bordeaux1.fr/pub/pari/packages/nftables/README.txt).\n\nKarim Belabas tells me that\n\n> nftables is not used by 'gp' (it is just an external table,\n> also available via LMFDB), there is no reasonable way to test\n> whether it is installed from the binary.\n>\n> For the package 'nflistdata', we can do something like\n>\n> {{{\n> iferr(!!nflist(\"A5\"), E, 0, errname(E) == \"e_PACKAGE\");\n> }}}\n>\n> (returns 1 iff the package is there); this adapts\n> to all packages used by gp, cf\n>\n> http://pari.math.u-bordeaux.fr/packages.html\n>\n> D. To test whether a package is available.",
    "created_at": "2022-07-27T11:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411995",
    "user": "@slel"
}
```

Replying to [comment:4 dimpase]:
> How does one check from `gp` that nftables are installed? 

From the [pari packages page](http://pari.math.u-bordeaux.fr/packages.html):

> This package requires no installation:
> extract it where desired and look at the
> [README](http://pari.math.u-bordeaux1.fr/pub/pari/packages/nftables/README.txt).

Karim Belabas tells me that

> nftables is not used by 'gp' (it is just an external table,
> also available via LMFDB), there is no reasonable way to test
> whether it is installed from the binary.
>
> For the package 'nflistdata', we can do something like
>
> {{{
> iferr(!!nflist("A5"), E, 0, errname(E) == "e_PACKAGE");
> }}}
>
> (returns 1 iff the package is there); this adapts
> to all packages used by gp, cf
>
> http://pari.math.u-bordeaux.fr/packages.html
>
> D. To test whether a package is available.



---

archive/issue_comments_411996.json:
```json
{
    "body": "Adding Fedora record for nftables",
    "created_at": "2022-07-29T08:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411996",
    "user": "@dimpase"
}
```

Adding Fedora record for nftables



---

archive/issue_comments_411997.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-29T08:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411997",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_411998.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-29T08:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411998",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_411999.json:
```json
{
    "body": "Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)",
    "created_at": "2022-07-29T08:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-411999",
    "user": "@kiwifb"
}
```

Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)



---

archive/issue_comments_412000.json:
```json
{
    "body": "I've opened #34243 to add `nflistdata` package.",
    "created_at": "2022-07-29T08:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412000",
    "user": "@dimpase"
}
```

I've opened #34243 to add `nflistdata` package.



---

archive/issue_comments_412001.json:
```json
{
    "body": "Replying to [comment:9 fbissey]:\n> Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)\nno real need - it's already in `build/pkgs/pari/distros/gentoo.txt`",
    "created_at": "2022-07-29T08:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412001",
    "user": "@dimpase"
}
```

Replying to [comment:9 fbissey]:
> Would it be too much to ask adding `sci-mathematics/pari-data` for Gentoo :)
no real need - it's already in `build/pkgs/pari/distros/gentoo.txt`



---

archive/issue_comments_412002.json:
```json
{
    "body": "The branch does not do what the summary promises",
    "created_at": "2022-07-29T17:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412002",
    "user": "@mkoeppe"
}
```

The branch does not do what the summary promises



---

archive/issue_comments_412003.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-07-29T17:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412003",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_412004.json:
```json
{
    "body": "we actually don't know how to do this test for pari 2.13.",
    "created_at": "2022-07-29T22:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412004",
    "user": "@dimpase"
}
```

we actually don't know how to do this test for pari 2.13.



---

archive/issue_comments_412005.json:
```json
{
    "body": "Various distros carry a package named `nftables` - but it's stuff to do with network management, not Pari-GP",
    "created_at": "2022-07-31T08:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412005",
    "user": "@dimpase"
}
```

Various distros carry a package named `nftables` - but it's stuff to do with network management, not Pari-GP



---

archive/issue_comments_412006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-31T08:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412006",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412007.json:
```json
{
    "body": "This works:\n\n```\n$ gp -q\n? default(parisize, 100000000);                                                                         \n? v=readvec(\"/usr/share/pari/nftables/T31.gp\")\n%3 = [[-23, [1, -1, 0, 1], 1, []], ...\n```\n\n\nThis is of course far from ideal, as the absolute path should be replaced by something known to `gp`. Also, `T31` is too big for the default stack size of 7Mb, it's better to use smaller `T71`. E.g., assuming that `nftables` is installed in Pari-GP `datadir`, one can do instead\n\n```\n$ gp -q\n? v=readvec(concat([default(datadir), \"/nftables/T71.gp\"]));\n```\n\n\nThis call returns nothing if `T71` is there, and otherwise it produces an error and gives `break>` prompt.",
    "created_at": "2022-07-31T09:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412007",
    "user": "@dimpase"
}
```

This works:

```
$ gp -q
? default(parisize, 100000000);                                                                         
? v=readvec("/usr/share/pari/nftables/T31.gp")
%3 = [[-23, [1, -1, 0, 1], 1, []], ...
```


This is of course far from ideal, as the absolute path should be replaced by something known to `gp`. Also, `T31` is too big for the default stack size of 7Mb, it's better to use smaller `T71`. E.g., assuming that `nftables` is installed in Pari-GP `datadir`, one can do instead

```
$ gp -q
? v=readvec(concat([default(datadir), "/nftables/T71.gp"]));
```


This call returns nothing if `T71` is there, and otherwise it produces an error and gives `break>` prompt.



---

archive/issue_comments_412008.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-31T11:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412008",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412009.json:
```json
{
    "body": "OK, this appears to work. Please review.",
    "created_at": "2022-07-31T11:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412009",
    "user": "@dimpase"
}
```

OK, this appears to work. Please review.



---

archive/issue_comments_412010.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-07-31T11:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412010",
    "user": "@dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_412011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-07-31T11:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412011",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412012.json:
```json
{
    "body": "ping?",
    "created_at": "2022-08-04T08:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412012",
    "user": "@dimpase"
}
```

ping?



---

archive/issue_comments_412013.json:
```json
{
    "body": "How does one test it?",
    "created_at": "2022-08-04T17:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412013",
    "user": "@mkoeppe"
}
```

How does one test it?



---

archive/issue_comments_412014.json:
```json
{
    "body": "one either tests on a system where pari/GP nftables is a system package, e.g. Fedora 36 or Gentoo.\n\nor manually installs the pari/GP package into default(datadir)",
    "created_at": "2022-08-04T18:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412014",
    "user": "@dimpase"
}
```

one either tests on a system where pari/GP nftables is a system package, e.g. Fedora 36 or Gentoo.

or manually installs the pari/GP package into default(datadir)



---

archive/issue_comments_412015.json:
```json
{
    "body": "But test what? Neither the SPKG.rst nor any other part of our documentation offers a hint what can be done with it",
    "created_at": "2022-08-04T19:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412015",
    "user": "@mkoeppe"
}
```

But test what? Neither the SPKG.rst nor any other part of our documentation offers a hint what can be done with it



---

archive/issue_comments_412016.json:
```json
{
    "body": "test that the package is recognised by ./configure - I thought it is evident...",
    "created_at": "2022-08-04T19:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412016",
    "user": "@dimpase"
}
```

test that the package is recognised by ./configure - I thought it is evident...



---

archive/issue_comments_412017.json:
```json
{
    "body": "ping?",
    "created_at": "2022-08-31T15:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412017",
    "user": "@dimpase"
}
```

ping?



---

archive/issue_comments_412018.json:
```json
{
    "body": "Can you please add to `SPKG.rst` information how one uses this package after installation. A pointer more specific than the project URL http://pari.math.u-bordeaux.fr/ is needed",
    "created_at": "2022-08-31T15:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412018",
    "user": "@mkoeppe"
}
```

Can you please add to `SPKG.rst` information how one uses this package after installation. A pointer more specific than the project URL http://pari.math.u-bordeaux.fr/ is needed



---

archive/issue_comments_412019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-31T19:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412020.json:
```json
{
    "body": "I don't really know how to use it - I added a link to package's README (which doesn't really have this info either). (and rebased over 9.7.rc0).",
    "created_at": "2022-08-31T19:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412020",
    "user": "@dimpase"
}
```

I don't really know how to use it - I added a link to package's README (which doesn't really have this info either). (and rebased over 9.7.rc0).



---

archive/issue_comments_412021.json:
```json
{
    "body": "ping?",
    "created_at": "2022-09-25T14:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29106#issuecomment-412021",
    "user": "@dimpase"
}
```

ping?
