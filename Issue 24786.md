# Issue 24786: Adds function to compute quadratic defect

Issue created by migration from https://trac.sagemath.org/ticket/25023

Original creator: annahaensch

Original creation time: 2018-03-22 09:52:29

Computes the quadratic defect (see O'Meara Section 63A) of a number field element locally at a prime p.  This is an implementation of Algorithm 3.1.3 from Kirschmer's "Definite quadratic and hermitian forms with small class number."   

The function returns the valuation of the quadratic defect (rather than the fractional ideal itself) since this is the more relevant (and computationally useful) piece of information. 


---

Comment by annahaensch created at 2018-03-24 10:16:02

New commits:


---

Comment by annahaensch created at 2018-03-24 10:16:02

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2018-03-27 16:08:41

Some quick comments:

over `QQ`:
do not use quadratic_residues as that forms a list of size (p-1)/2  this is not necessary. You can use legendre_symbol or reduce mod p and then use is_square (like over numberfields)

Your method quadratic_defect sits in the wrong class. (NumberField_quadratic) so it is not accessible in general. For example we can move it to NumberField_generic. 


```
+                    if w < u and w % 2 ==1:
+                        d = v+w
+                    if w == u and (f+F((a-1)/4)).is_irreducible():
+                        d = v+w
```

You sure this is correct ?(I did not fully check).

- the reference to kirschmers work should be a proper citation  in src/doc/en/reference/references

Could you explain why you consider the valuation more useful than the quadratic_defect itself?


---

Comment by sbrandhorst created at 2018-03-27 16:08:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-27 19:35:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-03-27 19:43:34

Thanks for the helpful comments! I've done the following: 
* Updated the function in rational_field to use legendre_symbol() instead of quadratic_residue().  
* I added Kirschmer's item to the reference list, and added a reference line to the documentation.  I've never done this before, perhaps up can see if I did it correctly? 
* I moved the number field version of the function to be in the class number_field_generic...I think.  Is this accomplished by just moving the function to where that class is defined?  Maybe you can check to see if I did that correctly. 
* The item you point out should be correct, this should be 63:3 and 63:5 from O'meara's book on quadratic forms. 

I am choosing to return a valuation since this is an easier object to deal with.  Moreover, this is also what is returned by the analogous function "QuadraticDefect" in magma (which I believe was implimented by Kirschmer). 
----
New commits:


---

Comment by annahaensch created at 2018-03-27 19:43:55

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-04-03 12:40:01

I did some cosmetic changes. Positive review if you are happy with what I have done.


---

Comment by git created at 2018-04-03 12:51:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-04-03 12:52:27

I just added the official reference to the rational_field version of the function.  Now I am happy with it, and would be most pleased with a positive review. Thanks!


---

Comment by sbrandhorst created at 2018-04-03 12:53:56

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-05-01 18:42:33

a trivial addition REFERENCES:: --> REFERENCES:
----
New commits:


---

Comment by vbraun created at 2018-05-12 11:47:16

Resolution: fixed
