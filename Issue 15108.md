# Issue 15108: Laurent polynomial rings don't preserve coercion

archive/issues_015108.json:
```json
{
    "body": "CC:  sage-combinat @mwhansen @williamstein @roed314 @tscrim\n\nKeywords: laurent polynomials, polynomials, coercion, categories\n\n```\nsage: R = LaurentPolynomialRing(ZZ, 'x')\nsage: T = LaurentPolynomialRing(QQ, 'x')\nsage: R.gen() + T.gen()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-dac3b0b430b6> in <module>()\n----> 1 R.gen() + T.gen()\n\n/home/darij/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__add__ (sage/structure/element.c:13884)()\n\n/home/darij/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:8169)()\n\nTypeError: unsupported operand parent(s) for '+': 'Univariate Laurent Polynomial Ring in x over Integer Ring' and 'Univariate Laurent Polynomial Ring in x over Rational Field'\n```\nCompare with the more complicated:\n\n```\nsage: R = PolynomialRing(ZZ, 'x').fraction_field()\nsage: T = PolynomialRing(QQ, 'x').fraction_field()\nsage: R.gen() + T.gen()\n2*x\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/15345\n\n",
    "closed_at": "2014-02-21T20:07:53Z",
    "created_at": "2013-11-01T00:12:54Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Laurent polynomial rings don't preserve coercion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15108",
    "user": "https://github.com/darijgr"
}
```
CC:  sage-combinat @mwhansen @williamstein @roed314 @tscrim

Keywords: laurent polynomials, polynomials, coercion, categories

```
sage: R = LaurentPolynomialRing(ZZ, 'x')
sage: T = LaurentPolynomialRing(QQ, 'x')
sage: R.gen() + T.gen()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-dac3b0b430b6> in <module>()
----> 1 R.gen() + T.gen()

/home/darij/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.RingElement.__add__ (sage/structure/element.c:13884)()

/home/darij/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:8169)()

TypeError: unsupported operand parent(s) for '+': 'Univariate Laurent Polynomial Ring in x over Integer Ring' and 'Univariate Laurent Polynomial Ring in x over Rational Field'
```
Compare with the more complicated:

```
sage: R = PolynomialRing(ZZ, 'x').fraction_field()
sage: T = PolynomialRing(QQ, 'x').fraction_field()
sage: R.gen() + T.gen()
2*x
```

Issue created by migration from https://trac.sagemath.org/ticket/15345





---

archive/issue_comments_193385.json:
```json
{
    "body": "I have just been hit by a similar problem:\n\n```\nsage: R = LaurentPolynomialRing(ZZ, 'x')\nsage: T = PolynomialRing(ZZ, 'x')\nsage: R.gen() + T.gen()\n2*x\nsage: R.gen() + FractionField(T).gen()\nBOOM !\n```",
    "created_at": "2014-01-28T10:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193385",
    "user": "https://github.com/fchapoton"
}
```

I have just been hit by a similar problem:

```
sage: R = LaurentPolynomialRing(ZZ, 'x')
sage: T = PolynomialRing(ZZ, 'x')
sage: R.gen() + T.gen()
2*x
sage: R.gen() + FractionField(T).gen()
BOOM !
```



---

archive/issue_events_044542.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15108#event-44542"
}
```



---

archive/issue_comments_193386.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-10T20:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193386",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_193387.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T09:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193388.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T13:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193389.json:
```json
{
    "body": "Here is something that seems to work. There remains to add doctests for the new behaviour.",
    "created_at": "2014-02-11T13:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193389",
    "user": "https://github.com/fchapoton"
}
```

Here is something that seems to work. There remains to add doctests for the new behaviour.



---

archive/issue_comments_193390.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-02-11T13:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193390",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_193391.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-02-11T13:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193391",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_193392.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T15:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_193393.json:
```json
{
    "body": "ok, should be good. Comments, anybody ?",
    "created_at": "2014-02-11T15:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193393",
    "user": "https://github.com/fchapoton"
}
```

ok, should be good. Comments, anybody ?



---

archive/issue_comments_193394.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-11T15:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193394",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_193395.json:
```json
{
    "body": "This breaks division:\n\n```\nsage: T.<x> = LaurentPolynomialRing(QQ)\nsage: 1 / x\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: <lambda>() takes exactly 1 argument (2 given)\n```",
    "created_at": "2014-02-11T19:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193395",
    "user": "https://github.com/tscrim"
}
```

This breaks division:

```
sage: T.<x> = LaurentPolynomialRing(QQ)
sage: 1 / x
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: <lambda>() takes exactly 1 argument (2 given)
```



---

archive/issue_comments_193396.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-11T19:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193396",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_193397.json:
```json
{
    "body": "Too bad.. Maybe then one can content ourselves to solve the initial problem, and not try to solve the problem about the fraction field, which seems to be harder ?",
    "created_at": "2014-02-11T20:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193397",
    "user": "https://github.com/fchapoton"
}
```

Too bad.. Maybe then one can content ourselves to solve the initial problem, and not try to solve the problem about the fraction field, which seems to be harder ?



---

archive/issue_comments_193398.json:
```json
{
    "body": "Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?",
    "created_at": "2014-02-12T09:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193398",
    "user": "https://github.com/fchapoton"
}
```

Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?



---

archive/issue_comments_193399.json:
```json
{
    "body": "Replying to [comment:15 chapoton]:\n> Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?\n\n\nI like this idea as the usual polynomial rings are much better behaved as a fraction field compared to their Laurent counterparts (even with #11726). However I think we should ask on sage-devel if everyone else agrees with doing this as things like `numerator` won't return Laurent polynomials.",
    "created_at": "2014-02-12T15:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193399",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:15 chapoton]:
> Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?


I like this idea as the usual polynomial rings are much better behaved as a fraction field compared to their Laurent counterparts (even with #11726). However I think we should ask on sage-devel if everyone else agrees with doing this as things like `numerator` won't return Laurent polynomials.



---

archive/issue_comments_193400.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> Replying to [comment:15 chapoton]:\n> > Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?\n\n> \n> I like this idea as the usual polynomial rings are much better behaved as a fraction field compared to their Laurent counterparts (even with #11726). However I think we should ask on sage-devel if everyone else agrees with doing this as things like `numerator` won't return Laurent polynomials.\n\n\nI like it better too.  Asking on sage-devel might be a good plan though.  I've made a branch that does this, and fixes the bug with `1/x` observed above.\n\n---\nNew commits:",
    "created_at": "2014-02-12T21:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193400",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:16 tscrim]:
> Replying to [comment:15 chapoton]:
> > Maybe one could also ensure that the fraction field of a Laurent Polynomial ring is just the fraction field of its associated polynomial ring ?

> 
> I like this idea as the usual polynomial rings are much better behaved as a fraction field compared to their Laurent counterparts (even with #11726). However I think we should ask on sage-devel if everyone else agrees with doing this as things like `numerator` won't return Laurent polynomials.


I like it better too.  Asking on sage-devel might be a good plan though.  I've made a branch that does this, and fixes the bug with `1/x` observed above.

---
New commits:



---

archive/issue_comments_193401.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-12T21:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193401",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_193402.json:
```json
{
    "body": "Travis, what do you think of the two failing doctests in HallAlgebra (see patchbot report) ?\n\nThe first one looks innocent enough, but the second one seems rather strange to me.",
    "created_at": "2014-02-13T09:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193402",
    "user": "https://github.com/fchapoton"
}
```

Travis, what do you think of the two failing doctests in HallAlgebra (see patchbot report) ?

The first one looks innocent enough, but the second one seems rather strange to me.



---

archive/issue_comments_193403.json:
```json
{
    "body": "Both doctest failures in the Hall algebra file are exactly what should be happening. These doctests were illustrating a bug!",
    "created_at": "2014-02-13T12:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193403",
    "user": "https://github.com/darijgr"
}
```

Both doctest failures in the Hall algebra file are exactly what should be happening. These doctests were illustrating a bug!



---

archive/issue_comments_193404.json:
```json
{
    "body": "I have changed the doctests in hall_algebra.\n\nOne should add tests for the new bahvior of `FractionField`.\n\n---\nNew commits:",
    "created_at": "2014-02-13T15:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193404",
    "user": "https://github.com/fchapoton"
}
```

I have changed the doctests in hall_algebra.

One should add tests for the new bahvior of `FractionField`.

---
New commits:



---

archive/issue_comments_193405.json:
```json
{
    "body": "Replying to [comment:21 chapoton]:\n> I have changed the doctests in hall_algebra.\n> \n> One should add tests for the new bahvior of `FractionField`.\n\n\nI added some tests in the `fraction_field` method.  Were you thinking of others?",
    "created_at": "2014-02-13T15:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193405",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:21 chapoton]:
> I have changed the doctests in hall_algebra.
> 
> One should add tests for the new bahvior of `FractionField`.


I added some tests in the `fraction_field` method.  Were you thinking of others?



---

archive/issue_comments_193406.json:
```json
{
    "body": "Two comments, not a review (I fear I have no idea what spooky action at a distance these changes might cause):\n\n- In `hall_algebra.py`, please change not just the doctests but the whole WARNING they're in. They should be a regular example, not a WARNING.\n\n- Could you maybe document `converter`? I know it's an internal function, but I want to understand what it does and why.",
    "created_at": "2014-02-13T15:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193406",
    "user": "https://github.com/darijgr"
}
```

Two comments, not a review (I fear I have no idea what spooky action at a distance these changes might cause):

- In `hall_algebra.py`, please change not just the doctests but the whole WARNING they're in. They should be a regular example, not a WARNING.

- Could you maybe document `converter`? I know it's an internal function, but I want to understand what it does and why.



---

archive/issue_comments_193407.json:
```json
{
    "body": "`@`David:\nI was thinking to something like\n\n```\nsage: FractionField(LaurentPolynomialRing(QQ,'x'))\nFraction Field of Multivariate Polynomial Ring in x over Rational Field\n```\nbut, yes, this can be considered as superfluous.\n\n`@`Darij, yes, I agree that one should change the doc in hall_algebra in a better way. I was hoping that somebody more knowledgeable than me about this part of sage would do that.",
    "created_at": "2014-02-13T16:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193407",
    "user": "https://github.com/fchapoton"
}
```

`@`David:
I was thinking to something like

```
sage: FractionField(LaurentPolynomialRing(QQ,'x'))
Fraction Field of Multivariate Polynomial Ring in x over Rational Field
```
but, yes, this can be considered as superfluous.

`@`Darij, yes, I agree that one should change the doc in hall_algebra in a better way. I was hoping that somebody more knowledgeable than me about this part of sage would do that.



---

archive/issue_comments_193408.json:
```json
{
    "body": "Okay, I've fixed up the Hall algebra documentation. I've changed `to_fraction()` into `_fraction_pair()` since this is only suppose to be used for the coercion (so it's hidden) and IMO it more accurately reflects what is being returned. If you're happy with my changes, then up to someone not likely what we're doing on sage-devel, it's a positive review from me.\n\n---\nNew commits:",
    "created_at": "2014-02-14T16:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193408",
    "user": "https://github.com/tscrim"
}
```

Okay, I've fixed up the Hall algebra documentation. I've changed `to_fraction()` into `_fraction_pair()` since this is only suppose to be used for the coercion (so it's hidden) and IMO it more accurately reflects what is being returned. If you're happy with my changes, then up to someone not likely what we're doing on sage-devel, it's a positive review from me.

---
New commits:



---

archive/issue_comments_193409.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2014-02-14T17:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193409",
    "user": "https://github.com/roed314"
}
```

Looks good to me.



---

archive/issue_comments_193410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-14T17:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193410",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_193411.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-21T20:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15108#issuecomment-193411",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_044543.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-21T20:07:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15108",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15108#event-44543"
}
```
