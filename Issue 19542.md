# Issue 19542: Hadamard difference set

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2015-12-24 19:57:04

CC:  ncohen dimpase

We implement the product construction of Hadamard difference sets and the example of Turyn from his 1965 paper.


---

Comment by vdelecroix created at 2015-12-24 20:11:35

New commits:


---

Comment by vdelecroix created at 2015-12-24 20:11:35

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-12-29 11:22:16

Input blocks ?...


---

Comment by ncohen created at 2015-12-29 11:43:56

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-12-29 11:43:56

This branch is in conflict with #19778. If you do not want to checkout 7.0+, you can update the branch of #19778 and cherry-pick my commits where you please, below 7.0.

Nathann


---

Comment by git created at 2015-12-29 12:19:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-12-29 12:27:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-29 12:28:07

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-12-29 12:30:59

Okayyyyyy back to work `:-D`

Thanks,

Nathann


---

Comment by ncohen created at 2015-12-29 15:06:11

Helloooooo Vincent,

Here is the review for this second ticket:

- In the docstring of `hadamard_difference_set_product_parameters`, could you
  specify the inputs of the product construction (i.e. could you specify which
  difference sets you are looking for)?

- This look like something that should not be there:

  {{{
+    try:
+        fac1 = tuple(G1.cartesian_factors())
+        tup1 = tuple
+    except AttributeError:
+        fac1 = (G1,)
+        tup1 = lambda x: (x,)
  }}}

  Can you explain why you need this (twice)?

- docstring of `turyn_1965_3x3xK` -- can you wrap the `C3x...` with backticks so
  that it displays properly as mathematics notations?

- As this functions is only building two difference families, shouldn't it be in some kind
  of database instead?

- Typo:
  `"can not exists"`

- Is it correct to have a 'else' inside of `elif
  are_hadamard_difference_set_parameters(v,k,l)` which says that no construction
  is known? Couldn't another construction be able to build it?

- To simplify the flow of those if/else if you need to break it into several
  smaller ones, you can use a trick like that:
  {{{
  if are_hadamard_difference_set_parameters(v,k,l) and (k-2*lmbda).is_prime():
      <whatever>
  }}}

Nathann


---

Comment by vdelecroix created at 2015-12-29 15:19:43

Hello,

Replying to [comment:10 ncohen]:
> Helloooooo Vincent,
> 
> Here is the review for this second ticket:
> 
> - In the docstring of `hadamard_difference_set_product_parameters`, could you
>   specify the inputs of the product construction (i.e. could you specify which
>   difference sets you are looking for)?

done
 
> - This look like something that should not be there:
> 
>   {{{
> +    try:
> +        fac1 = tuple(G1.cartesian_factors())
> +        tup1 = tuple
> +    except AttributeError:
> +        fac1 = (G1,)
> +        tup1 = lambda x: (x,)
>   }}}
> 
>   Can you explain why you need this (twice)?

Because cartesian product does not flatten stuff.

```
sage: G1 = cartesian_product([Zmod(2),Zmod(2)])
sage: G2 = cartesian_product([Zmod(3),Zmod(5)])
sage: cartesian_product(G1,G2)
The cartesian product of (The cartesian product of (Ring of integers modulo 2, Ring of integers modulo 2), The cartesian product of (Ring of integers modulo 3, Ring of integers modulo 5))
```

versus

```
sage: cartesian_product(G1.cartesian_factors() + G2.cartesian_factors())
The cartesian product of (Ring of integers modulo 2, Ring of integers modulo 2, Ring of integers modulo 3, Ring of integers modulo 5)
```


> - docstring of `turyn_1965_3x3xK` -- can you wrap the `C3x...` with backticks so
>   that it displays properly as mathematics notations?

done

> - As this functions is only building two difference families, shouldn't it be in some kind
>   of database instead?

A database with one function? Hum...

> - Typo:
>   `"can not exists"`

done

> - Is it correct to have a 'else' inside of `elif
>   are_hadamard_difference_set_parameters(v,k,l)` which says that no construction
>   is known? Couldn't another construction be able to build it?

Not the one which are after. `4N^2` is a prime power if and only if `N=2^k`. In which case the construction is taken care before (McFarland 1973). The twin primes construction does not apply.

> - To simplify the flow of those if/else if you need to break it into several
>   smaller ones, you can use a trick like that:
>   {{{
>   if are_hadamard_difference_set_parameters(v,k,l) and (k-2*lmbda).is_prime():
>       <whatever>
>   }}}

It will cost 3 of them and I need the `N` to dispatch to the constructors.


---

Comment by git created at 2015-12-29 15:20:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-12-29 15:52:42

> Because cartesian product does not flatten stuff.

And you need it to be flattened?

> > - As this functions is only building two difference families, shouldn't it be in some kind
> >   of database instead?
> 
> A database with one function? Hum...

I was more thinking of moving its two difference families into the existing database of difference families, in database.py.

> Not the one which are after.

I see. But then the order is important, and it is not really straightforward to figure it out.

> It will cost 3 of them and I need the `N` to dispatch to the constructors.

Only two if the `turyn_1965_3x3xK` enters the database. We can also hardcode the parameters in the if/else, given that they are known.

Nathann


---

Comment by ncohen created at 2015-12-29 15:57:04

P.S.: About 'needing the N to dispatch the constructors' --> you can use `k-2lmda`.


---

Comment by git created at 2015-12-29 16:11:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-29 16:16:17

I do prefer use a function for `turyn_1965_3x3xK`. The reason is that the construction is made explicit. The database is nice for knowing existence but it does not help to understand things. Ideally, there should be very few items in the database.

Vincent


---

Comment by ncohen created at 2015-12-29 16:18:29

Okay. I'm still interested about the flattening issue and the 12 lines of try/except. What is this for btw?

```
+    v = ZZ(v)
+    k = ZZ(k)
+    l = ZZ(l)
```


Nathann


---

Comment by git created at 2015-12-29 16:22:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-29 16:22:35

Replying to [comment:17 ncohen]:
> Okay. I'm still interested about the flattening issue and the 12 lines of try/except. What is this for btw?
> {{{
> +    v = ZZ(v)
> +    k = ZZ(k)
> +    l = ZZ(l)
> }}}

`(k-2*l).is_prime()`


---

Comment by ncohen created at 2015-12-29 16:25:41

You mean `is_prime(k-2*l)` ? `:-P`

Anyway, despite being a useless abstraction, I expect that ZZ is in a better state than the combinat parents.

Nathann


---

Comment by vdelecroix created at 2015-12-29 16:27:15

Replying to [comment:20 ncohen]:
> You mean `is_prime(k-2*l)` ? `:-P`
> 
> Anyway, despite being a useless abstraction, I expect that ZZ is in a better state than the combinat parents.

at least

```
sage: a = 3
sage: ZZ(a) is a
True
sage: %timeit ZZ(a)
10000000 loops, best of 3: 109 ns per loop
```



---

Comment by vdelecroix created at 2015-12-29 16:29:14

Replying to [comment:19 vdelecroix]:
> Replying to [comment:17 ncohen]:
> I'm still interested about the flattening issue

One option is to add a `flatten` option to the cartesian product functor... but I will still have an issue to build an element of `G1 x G2` from an element of `G1` and `G2`.


---

Comment by ncohen created at 2015-12-29 16:36:16

> One option is to add a `flatten` option to the cartesian product functor... but I will still have an issue to build an element of `G1 x G2` from an element of `G1` and `G2`.

You still haven't said why you did it. If it is for performance reason the answer must be found inside of the `cartesian_product` function, or in the `******` that it returns.

Nathann


---

Comment by vdelecroix created at 2015-12-29 17:04:58

The reason is readability of the output. But anyway, I guess that soon enough I will have to normalize the group of difference families to introduce `v = [3,2]` notation (that corresponds to `C3 x C2`).


---

Comment by ncohen created at 2015-12-29 17:21:17

> The reason is readability of the output.

I don't believe that this justifies 10 lines of try/except. Your readability problem cannot be solved by such workarounds.

Nathann


---

Comment by git created at 2015-12-29 17:35:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-12-29 22:16:30

Thanks. Well, I was about to set this ticket to `positive_review` but it's likely to be in conflict with whatever Volker merged already `:-/`


---

Comment by dimpase created at 2015-12-31 08:58:34

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2015-12-31 08:58:34

there is an extra ':' in 'INPUT::' in function `turyn_1965_3x3xK`. Please remove...


---

Comment by dimpase created at 2015-12-31 09:24:42

rebased and removed that ':'...


---

Comment by dimpase created at 2015-12-31 09:24:42

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-12-31 10:12:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-12-31 10:14:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-12-31 10:15:13

this is 19777-clean now, too...
----
New commits:
----
New commits:


---

Comment by vdelecroix created at 2016-07-11 19:19:19

New commits:


---

Comment by vdelecroix created at 2016-07-11 19:19:32

rebased...


---

Comment by chapoton created at 2016-07-11 20:11:22

you need to replace (in the references)

```
[Tu1965] R. J. Turyn
```

by 

```
[Tu1965] \R. J. Turyn
```

and same for the other ref.

Also typo `J. Combit. Theory`


---

Comment by vdelecroix created at 2016-07-11 20:12:25

why `\R` instead of `R`?


---

Comment by chapoton created at 2016-07-11 20:15:39

This is because otherwise sphinx thinks this is the numbering (by letters) of something (see the other references below and above). There was a ticket about that, I do no known the number.


---

Comment by ncohen created at 2016-07-11 20:18:39

> This is because otherwise sphinx thinks this is the numbering (by letters) of something (see the other references below and above). There was a ticket about that, I do no known the number.

Ahahahahahah. That would have driven me mad some time ago, but nowadays I take it as a very good joke. Keep it up `:-P`

Nathann


---

Comment by git created at 2016-07-11 20:22:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-11 20:36:47

done


---

Comment by dimpase created at 2016-07-12 10:04:15

While at it, could you perhaps canonise journal names in references, e.g. following the usual AMS abbreviations: J. Number Theory (not Num. Th.), J. Combin. Theory (this one is written differently in different places), Pacific J. Math. (drop "of")?


---

Comment by ncohen created at 2016-07-12 10:08:23

Take it from a guy who is parsing citation data: don't try to canonise journal names, it's hopeless.


```
J. Combinatorial Theory B
J. Combinatorial Theory Ser. B
J. Combinatorial Theory, Ser. B
J. Combinatorial Theory, Series B
J. Combin. Theory B
J. Combin. Theory Ser. B
J. Combin. Theory, Ser. B
J. Combin. Theory Series B
J. Combin. Th. Ser. B
J. Comb. Th. B
J. Comb. Theory B
J. Comb. Theory Ser. B
J. Comb. Theory, Ser. B
Journal of Combinatorial Theory B
Journal of Combinatorial Theory Series B
Journal of Combinatorial Theory, Series B
Journal of Combinatorial Theory. Series B
```



---

Comment by dimpase created at 2016-07-12 10:15:50

well, consistency in one file can and should be achieved, in order not to distract the reader. (besides, `J. Num. Th.` is really fckng crpp abbrv)


---

Comment by chapoton created at 2016-07-12 13:31:23

Please use python-3 compatible syntax for print.


---

Comment by git created at 2016-07-12 18:36:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-12 18:37:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-12 18:40:17

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by vdelecroix created at 2016-07-12 18:40:51

done


---

Comment by dimpase created at 2016-07-12 21:24:47

diff of the suggested change


---

Attachment

How about the attached diff, for real consistency? :-)


---

Comment by vdelecroix created at 2016-07-12 21:39:38

It is not consistent. Some reference have a comma between the journal and the volume while some other not...


---

Comment by dimpase created at 2016-07-12 21:41:26

Replying to [comment:50 vdelecroix]:
> It is not consistent. Some reference have a comma between the journal and the volume while some other not...

there is comma if there is no dot! :-)

anyhow, at least is has page numbers everywhere...


---

Comment by vdelecroix created at 2016-07-12 21:43:19

Replying to [comment:51 dimpase]:
> Replying to [comment:50 vdelecroix]:
> > It is not consistent. Some reference have a comma between the journal and the volume while some other not...
> 
> there is comma is there is no dot! :-)

hum

```diff
-       J. of Combinatorial Theory (A) vol 15 (1973).
+       J. Combinatorial Theory (A) 15 (1973) 1--10.
```


> anyhow, at least is has page numbers everywhere...

that's indeed better.


---

Comment by dimpase created at 2016-07-12 21:47:14

Replying to [comment:52 vdelecroix]:
> Replying to [comment:51 dimpase]:
> > Replying to [comment:50 vdelecroix]:
> > > It is not consistent. Some reference have a comma between the journal and the volume while some other not...
> > 
> > there is comma is there is no dot! :-)

no dot or other delimiter.

(yes, I do sound like `bash` now :-))
 
> 
> hum
> {{{#!diff
> -       J. of Combinatorial Theory (A) vol 15 (1973).
> +       J. Combinatorial Theory (A) 15 (1973) 1--10.
> }}}
> 
> > anyhow, at least is has page numbers everywhere...
> 
> that's indeed better.


---

Comment by git created at 2016-07-13 13:55:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-13 13:55:58

patch applied


---

Comment by dimpase created at 2016-07-13 14:07:22

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2016-07-13 14:07:22

looks good to me.


---

Comment by vdelecroix created at 2016-07-13 14:08:06

Thanks!


---

Comment by vbraun created at 2016-07-13 23:36:57

Resolution: fixed
