# Issue 26790: graph relabel() with callable should not sort vertices

archive/issues_026790.json:
```json
{
    "body": "CC:  dcoudert\n\nThis branch in `relabel()` should not rely on sorted vertices:\n\n```\n        elif callable(perm):\n            perm = dict( [ i, perm(i) ] for i in self.vertices() )\n            complete_partial_function = False\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27027\n\n",
    "created_at": "2019-01-07T09:14:42Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "graph relabel() with callable should not sort vertices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26790",
    "user": "jdemeyer"
}
```
CC:  dcoudert

This branch in `relabel()` should not rely on sorted vertices:

```
        elif callable(perm):
            perm = dict( [ i, perm(i) ] for i in self.vertices() )
            complete_partial_function = False
```


Issue created by migration from https://trac.sagemath.org/ticket/27027





---

archive/issue_comments_376797.json:
```json
{
    "body": "You could use `G.relabel(list(range(G.order())))` instead of `G.relabel(list(range(len(G))))`.\n\nIn `generic_graph.py`, you changed the doctest `G.relabel(return_map=True) == expecting`. Isn't it risky to do that ? the ordering of the keys of a dictionary might differ in py2  and py3, no ?\n\n----\nNew commits:",
    "created_at": "2019-01-07T10:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376797",
    "user": "dcoudert"
}
```

You could use `G.relabel(list(range(G.order())))` instead of `G.relabel(list(range(len(G))))`.

In `generic_graph.py`, you changed the doctest `G.relabel(return_map=True) == expecting`. Isn't it risky to do that ? the ordering of the keys of a dictionary might differ in py2  and py3, no ?

----
New commits:



---

archive/issue_comments_376798.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-07T10:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376798",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376799.json:
```json
{
    "body": "Update, still work in progress.",
    "created_at": "2019-01-07T10:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376799",
    "user": "jdemeyer"
}
```

Update, still work in progress.



---

archive/issue_comments_376800.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-07T11:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376800",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376801.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-07T11:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376801",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_376802.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-07T13:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376802",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376803.json:
```json
{
    "body": "Green patchbot!",
    "created_at": "2019-01-08T11:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376803",
    "user": "jdemeyer"
}
```

Green patchbot!



---

archive/issue_comments_376804.json:
```json
{
    "body": "Unless I'm mistaken, `range` is an iterator in py3. Therefore, we cannot do `G.relabel(range(G.order()))` (several places). Or we must add a specific rule for iterators.",
    "created_at": "2019-01-08T13:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376804",
    "user": "dcoudert"
}
```

Unless I'm mistaken, `range` is an iterator in py3. Therefore, we cannot do `G.relabel(range(G.order()))` (several places). Or we must add a specific rule for iterators.



---

archive/issue_comments_376805.json:
```json
{
    "body": "Replying to [comment:14 dcoudert]:\n> Or we must add a specific rule for iterators.\n\nIndeed. This is what I did in this patch.",
    "created_at": "2019-01-08T14:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376805",
    "user": "jdemeyer"
}
```

Replying to [comment:14 dcoudert]:
> Or we must add a specific rule for iterators.

Indeed. This is what I did in this patch.



---

archive/issue_comments_376806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-08T16:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376806",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376807.json:
```json
{
    "body": "For me this patch is good to go. I did several tests without detecting any hidden issue.",
    "created_at": "2019-01-08T16:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376807",
    "user": "dcoudert"
}
```

For me this patch is good to go. I did several tests without detecting any hidden issue.



---

archive/issue_comments_376808.json:
```json
{
    "body": "Changing keywords from \"\" to \"py3, graph\".",
    "created_at": "2019-01-08T16:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376808",
    "user": "dcoudert"
}
```

Changing keywords from "" to "py3, graph".



---

archive/issue_comments_376809.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376809",
    "user": "embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_376810.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-17T17:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376810",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_376811.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2019-01-17T17:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376811",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_376812.json:
```json
{
    "body": "The issue in `src/sage/combinat/cluster_algebra_quiver/quiver.py` was already fixed by #26985.\n\nSo I'm just reverting any changes to that file.",
    "created_at": "2019-01-23T21:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376812",
    "user": "jdemeyer"
}
```

The issue in `src/sage/combinat/cluster_algebra_quiver/quiver.py` was already fixed by #26985.

So I'm just reverting any changes to that file.



---

archive/issue_comments_376813.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-23T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376813",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376814.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-23T21:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376814",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_376815.json:
```json
{
    "body": "At least one green patchbot, so I'm restoring positive review.",
    "created_at": "2019-01-24T08:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376815",
    "user": "jdemeyer"
}
```

At least one green patchbot, so I'm restoring positive review.



---

archive/issue_comments_376816.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-24T08:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376816",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376817.json:
```json
{
    "body": "OK",
    "created_at": "2019-01-24T09:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376817",
    "user": "dcoudert"
}
```

OK



---

archive/issue_comments_376818.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-25T15:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376818",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_376819.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/combinat/root_system/coxeter_matrix.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/coxeter_matrix.py\", line 1041, in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix\nFailed example:\n    CoxeterMatrix(CoxeterType(['A',10,1]).coxeter_graph()).coxeter_type()\nExpected:\n    Coxeter type of ['A', 10, 1]\nGot:\n    Coxeter type of ['A', 10, 1] relabelled by {0: 2, 1: 3, 2: 4, 3: 5, 4: 6, 5: 7, 6: 8, 7: 9, 8: 10, 9: 0, 10: 1}\n**********************************************************************\n1 item had failures:\n   1 of  39 in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix\n    [181 tests, 1 failure, 0.51 s\n```\n",
    "created_at": "2019-01-25T15:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376819",
    "user": "vbraun"
}
```


```
sage -t --long src/sage/combinat/root_system/coxeter_matrix.py
**********************************************************************
File "src/sage/combinat/root_system/coxeter_matrix.py", line 1041, in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix
Failed example:
    CoxeterMatrix(CoxeterType(['A',10,1]).coxeter_graph()).coxeter_type()
Expected:
    Coxeter type of ['A', 10, 1]
Got:
    Coxeter type of ['A', 10, 1] relabelled by {0: 2, 1: 3, 2: 4, 3: 5, 4: 6, 5: 7, 6: 8, 7: 9, 8: 10, 9: 0, 10: 1}
**********************************************************************
1 item had failures:
   1 of  39 in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix
    [181 tests, 1 failure, 0.51 s
```




---

archive/issue_comments_376820.json:
```json
{
    "body": "This failure is caused by interactions with #27029. It doesn't happen by itself.",
    "created_at": "2019-01-25T15:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376820",
    "user": "jdemeyer"
}
```

This failure is caused by interactions with #27029. It doesn't happen by itself.



---

archive/issue_comments_376821.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-01-25T16:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376821",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_376822.json:
```json
{
    "body": "I'm a bit lost here... at least, I don't have errors when testing this ticket alone.",
    "created_at": "2019-01-25T16:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376822",
    "user": "dcoudert"
}
```

I'm a bit lost here... at least, I don't have errors when testing this ticket alone.



---

archive/issue_comments_376823.json:
```json
{
    "body": "As I said, it's because of this ticket together with #27029.",
    "created_at": "2019-01-25T21:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376823",
    "user": "jdemeyer"
}
```

As I said, it's because of this ticket together with #27029.



---

archive/issue_comments_376824.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-27T10:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26790",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26790#issuecomment-376824",
    "user": "vbraun"
}
```

Resolution: fixed
