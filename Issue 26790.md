# Issue 26790: graph relabel() with callable should not sort vertices

Issue created by migration from https://trac.sagemath.org/ticket/27027

Original creator: jdemeyer

Original creation time: 2019-01-07 09:14:42

CC:  dcoudert

This branch in `relabel()` should not rely on sorted vertices:

```
        elif callable(perm):
            perm = dict( [ i, perm(i) ] for i in self.vertices() )
            complete_partial_function = False
```



---

Comment by dcoudert created at 2019-01-07 10:43:01

You could use `G.relabel(list(range(G.order())))` instead of `G.relabel(list(range(len(G))))`.

In `generic_graph.py`, you changed the doctest `G.relabel(return_map=True) == expecting`. Isn't it risky to do that ? the ordering of the keys of a dictionary might differ in py2  and py3, no ?

----
New commits:


---

Comment by git created at 2019-01-07 10:50:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-07 10:51:05

Update, still work in progress.


---

Comment by git created at 2019-01-07 11:37:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-07 11:40:19

Changing status from new to needs_review.


---

Comment by git created at 2019-01-07 13:45:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-08 11:40:50

Green patchbot!


---

Comment by dcoudert created at 2019-01-08 13:28:37

Unless I'm mistaken, `range` is an iterator in py3. Therefore, we cannot do `G.relabel(range(G.order()))` (several places). Or we must add a specific rule for iterators.


---

Comment by jdemeyer created at 2019-01-08 14:18:00

Replying to [comment:14 dcoudert]:
> Or we must add a specific rule for iterators.

Indeed. This is what I did in this patch.


---

Comment by dcoudert created at 2019-01-08 16:15:39

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2019-01-08 16:15:39

For me this patch is good to go. I did several tests without detecting any hidden issue.


---

Comment by dcoudert created at 2019-01-08 16:15:39

Changing keywords from "" to "py3, graph".


---

Comment by embray created at 2019-01-15 18:16:10

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by vbraun created at 2019-01-17 17:31:00

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-01-17 17:31:00

Merge conflict


---

Comment by jdemeyer created at 2019-01-23 21:23:13

The issue in `src/sage/combinat/cluster_algebra_quiver/quiver.py` was already fixed by #26985.

So I'm just reverting any changes to that file.


---

Comment by git created at 2019-01-23 21:23:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-23 21:24:57

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-01-24 08:26:55

At least one green patchbot, so I'm restoring positive review.


---

Comment by jdemeyer created at 2019-01-24 08:26:55

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2019-01-24 09:29:11

OK


---

Comment by vbraun created at 2019-01-25 15:11:37

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-01-25 15:11:37


```
sage -t --long src/sage/combinat/root_system/coxeter_matrix.py
**********************************************************************
File "src/sage/combinat/root_system/coxeter_matrix.py", line 1041, in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix
Failed example:
    CoxeterMatrix(CoxeterType(['A',10,1]).coxeter_graph()).coxeter_type()
Expected:
    Coxeter type of ['A', 10, 1]
Got:
    Coxeter type of ['A', 10, 1] relabelled by {0: 2, 1: 3, 2: 4, 3: 5, 4: 6, 5: 7, 6: 8, 7: 9, 8: 10, 9: 0, 10: 1}
**********************************************************************
1 item had failures:
   1 of  39 in sage.combinat.root_system.coxeter_matrix.recognize_coxeter_type_from_matrix
    [181 tests, 1 failure, 0.51 s
```



---

Comment by jdemeyer created at 2019-01-25 15:34:48

This failure is caused by interactions with #27029. It doesn't happen by itself.


---

Comment by jdemeyer created at 2019-01-25 16:42:36

Changing status from needs_work to positive_review.


---

Comment by dcoudert created at 2019-01-25 16:51:28

I'm a bit lost here... at least, I don't have errors when testing this ticket alone.


---

Comment by jdemeyer created at 2019-01-25 21:09:28

As I said, it's because of this ticket together with #27029.


---

Comment by vbraun created at 2019-01-27 10:54:36

Resolution: fixed
