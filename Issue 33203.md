# Issue 33203: sage.libs.singular: Do not fail if the Singular binary is not in PATH

archive/issues_033203.json:
```json
{
    "body": "CC:  mjo dimpase mderickx\n\nThis code from #29024\n\n```\n    os.environ[\"SINGULAR_BIN_DIR\"] = dirname(which(\"Singular\"))\n```\n\nassumes that `Singular` is in PATH\n\nThis causes errors when users attempt to use sagelib outside of the environment set up by `sage-env`.\n\nhttps://groups.google.com/g/sage-support/c/XBxpl-JjaNU/m/FtRvcoW0AgAJ\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33440\n\n",
    "created_at": "2022-03-01T19:12:07Z",
    "labels": [
        "refactoring",
        "major",
        "bug"
    ],
    "title": "sage.libs.singular: Do not fail if the Singular binary is not in PATH",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33203",
    "user": "mkoeppe"
}
```
CC:  mjo dimpase mderickx

This code from #29024

```
    os.environ["SINGULAR_BIN_DIR"] = dirname(which("Singular"))
```

assumes that `Singular` is in PATH

This causes errors when users attempt to use sagelib outside of the environment set up by `sage-env`.

https://groups.google.com/g/sage-support/c/XBxpl-JjaNU/m/FtRvcoW0AgAJ


Issue created by migration from https://trac.sagemath.org/ticket/33440





---

archive/issue_comments_472870.json:
```json
{
    "body": "Fix should be via `sage.features` / #31296",
    "created_at": "2022-03-01T19:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472870",
    "user": "mkoeppe"
}
```

Fix should be via `sage.features` / #31296



---

archive/issue_comments_472871.json:
```json
{
    "body": "We have this problem in a lot of packages and we usually use`sage_conf`to store one of two values: the system location, or the sage location -- depending on what's detected at `./configure` time. The `spkg-configure.m4` for singular already detects `SINGULAR_BIN`; we probably just need to record its `dirname()` if it's not in the system's `PATH`.",
    "created_at": "2022-03-01T21:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472871",
    "user": "mjo"
}
```

We have this problem in a lot of packages and we usually use`sage_conf`to store one of two values: the system location, or the sage location -- depending on what's detected at `./configure` time. The `spkg-configure.m4` for singular already detects `SINGULAR_BIN`; we probably just need to record its `dirname()` if it's not in the system's `PATH`.



---

archive/issue_comments_472872.json:
```json
{
    "body": "I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.",
    "created_at": "2022-03-01T23:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472872",
    "user": "mkoeppe"
}
```

I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.



---

archive/issue_comments_472873.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.\n\nThe `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.",
    "created_at": "2022-03-01T23:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472873",
    "user": "mjo"
}
```

Replying to [comment:4 mkoeppe]:
> I don't know if we need it as a configuration variable because the configure script just searches for it in PATH.

The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.



---

archive/issue_comments_472874.json:
```json
{
    "body": "Replying to [comment:5 mjo]:\n> \n> The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.\n> \n\nSorry, that's half nonsense. If we **don't** find `Singular` in the `PATH`, we know that it's in the `SAGE_LOCAL` location, and we put that value into `sage_conf` so that later we don't need to rely on `PATH`.",
    "created_at": "2022-03-01T23:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472874",
    "user": "mjo"
}
```

Replying to [comment:5 mjo]:
> 
> The `SAGE_LOCAL` location will be prepended to `PATH` during `./configure` though, so that's the time to write it down. Then later the location is known regardless of what `PATH` contains.
> 

Sorry, that's half nonsense. If we **don't** find `Singular` in the `PATH`, we know that it's in the `SAGE_LOCAL` location, and we put that value into `sage_conf` so that later we don't need to rely on `PATH`.



---

archive/issue_comments_472875.json:
```json
{
    "body": "I know you know this already, but I think adding geographically varied runtime checks for things that are known at build time is the wrong solution.\n----\nNew commits:",
    "created_at": "2022-03-01T23:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472875",
    "user": "mjo"
}
```

I know you know this already, but I think adding geographically varied runtime checks for things that are known at build time is the wrong solution.
----
New commits:



---

archive/issue_comments_472876.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-01T23:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472876",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_472877.json:
```json
{
    "body": "No objection if you want to provide `SINGULAR_BIN` via `sage_conf`",
    "created_at": "2022-03-01T23:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472877",
    "user": "mkoeppe"
}
```

No objection if you want to provide `SINGULAR_BIN` via `sage_conf`



---

archive/issue_comments_472878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-02T00:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472878",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_472879.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> No objection if you want to provide `SINGULAR_BIN` via `sage_conf`\n\nThis variable would be used in `src/sage/features/singular.py`",
    "created_at": "2022-03-02T00:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472879",
    "user": "mkoeppe"
}
```

Replying to [comment:10 mkoeppe]:
> No objection if you want to provide `SINGULAR_BIN` via `sage_conf`

This variable would be used in `src/sage/features/singular.py`



---

archive/issue_comments_472880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-02T05:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472880",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_472881.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-02T05:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472881",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_472882.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-02T05:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472882",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_472883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-03T02:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472883",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_472884.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2022-03-12T18:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472884",
    "user": "mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_472885.json:
```json
{
    "body": "How does one test this? I tried the way given in the link, but it ends up as follows:\n\n```\nima@hilbert /mnt/opt/Sage $ ./sage-dev/sage -python3 -m venv --system-site-packages venv\ndima@hilbert /mnt/opt/Sage $ source venv/bin/activate\n(venv) dima@hilbert /mnt/opt/Sage $ python3\nPython 3.9.10 (main, Mar  4 2022, 14:46:20) \n[GCC 11.2.1 20211127] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.all import *\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nModuleNotFoundError: No module named 'sage'\n>>> \n```\n\n\nAm I doing something wrong?",
    "created_at": "2022-03-12T20:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472885",
    "user": "dimpase"
}
```

How does one test this? I tried the way given in the link, but it ends up as follows:

```
ima@hilbert /mnt/opt/Sage $ ./sage-dev/sage -python3 -m venv --system-site-packages venv
dima@hilbert /mnt/opt/Sage $ source venv/bin/activate
(venv) dima@hilbert /mnt/opt/Sage $ python3
Python 3.9.10 (main, Mar  4 2022, 14:46:20) 
[GCC 11.2.1 20211127] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.all import *
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ModuleNotFoundError: No module named 'sage'
>>> 
```


Am I doing something wrong?



---

archive/issue_comments_472886.json:
```json
{
    "body": "The method of setting up the venv that was tried in that post only works when Sage has built its own Python. One cannot make a venv from a venv.",
    "created_at": "2022-03-12T20:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472886",
    "user": "mkoeppe"
}
```

The method of setting up the venv that was tried in that post only works when Sage has built its own Python. One cannot make a venv from a venv.



---

archive/issue_comments_472887.json:
```json
{
    "body": "You can test it by just using command lines like the ones I showed in #31296",
    "created_at": "2022-03-12T20:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472887",
    "user": "mkoeppe"
}
```

You can test it by just using command lines like the ones I showed in #31296



---

archive/issue_comments_472888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-12T21:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472888",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_472889.json:
```json
{
    "body": "OK, this works.",
    "created_at": "2022-03-12T21:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472889",
    "user": "dimpase"
}
```

OK, this works.



---

archive/issue_comments_472890.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-03-12T21:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472890",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_472891.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-21T23:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33203",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33203#issuecomment-472891",
    "user": "vbraun"
}
```

Resolution: fixed
