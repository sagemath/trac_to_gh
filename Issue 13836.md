# Issue 13836: Configurable "tall list" output styl

archive/issues_013836.json:
```json
{
    "body": "Assignee: jason\n\nThe displayhook pretty-prints lists/tuples of matrices in a readable way:\n\n```\nsage: m = random_matrix(GF(5),2)                                      \nsage: [ m, m^2, m^3 ]  \n[\n[1 4]  [4 2]  [3 0]\n[2 2], [1 2], [0 3]\n]\n```\n\nBut this is hardcoded to only apply to matrix types:\n\n```\nsage: MatrixGroup([m,m^2,m^3]).gens()\n[[1 4]\n[2 2], [4 2]\n[1 2], [3 0]\n[0 3]]\n```\n\nThis ticket aims to add a `_repr_option(key)` method to **parents** to be able to return meta-information on the `_repr_()` output. In particular, `_repr_option('element_ascii_art')` will return a boolean that switches between the list display hooks.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14040\n\n",
    "created_at": "2013-01-30T12:31:55Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Configurable \"tall list\" output styl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13836",
    "user": "vbraun"
}
```
Assignee: jason

The displayhook pretty-prints lists/tuples of matrices in a readable way:

```
sage: m = random_matrix(GF(5),2)                                      
sage: [ m, m^2, m^3 ]  
[
[1 4]  [4 2]  [3 0]
[2 2], [1 2], [0 3]
]
```

But this is hardcoded to only apply to matrix types:

```
sage: MatrixGroup([m,m^2,m^3]).gens()
[[1 4]
[2 2], [4 2]
[1 2], [3 0]
[0 3]]
```

This ticket aims to add a `_repr_option(key)` method to **parents** to be able to return meta-information on the `_repr_()` output. In particular, `_repr_option('element_ascii_art')` will return a boolean that switches between the list display hooks.

Issue created by migration from https://trac.sagemath.org/ticket/14040





---

archive/issue_comments_171973.json:
```json
{
    "body": "I've also folded the `is_atomic_repr()` methods that some parents carried into this framework. Here is the method docstring for reference:\n\n```\n    def _repr_option(self, key):\n        \"\"\"\n        Metadata about the :meth:`_repr_` output.\n\n        INPUT:\n        \n        - ``key`` -- string. A key for different metadata informations\n          that can be inquired about.\n\n        Valid ``key`` arguments are:\n        \n        - ``'ascii_art'``: The :meth:`_repr_` output is multi-line\n          ascii art and each line must be printed starting at the same\n          column, or the meaning is lost.\n\n        - ``'element_ascii_art'``: same but for the output of the\n          elements. Used in :mod:`sage.misc.displayhook`.\n\n        - ``'element_is_atomic'``: the elements print atomically, that\n          is, parenthesis are not required when *printing* out any of\n          `x - y`, `x + y`, `x^y` and `x/y`.\n\n        OUTPUT:\n        \n        Boolean.\n\n        EXAMPLES::\n\n            sage: ZZ._repr_option('ascii_art')\n            False\n            sage: MatrixSpace(ZZ, 2)._repr_option('element_ascii_art')\n            True\n        \"\"\"\n```\n",
    "created_at": "2013-01-30T18:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171973",
    "user": "vbraun"
}
```

I've also folded the `is_atomic_repr()` methods that some parents carried into this framework. Here is the method docstring for reference:

```
    def _repr_option(self, key):
        """
        Metadata about the :meth:`_repr_` output.

        INPUT:
        
        - ``key`` -- string. A key for different metadata informations
          that can be inquired about.

        Valid ``key`` arguments are:
        
        - ``'ascii_art'``: The :meth:`_repr_` output is multi-line
          ascii art and each line must be printed starting at the same
          column, or the meaning is lost.

        - ``'element_ascii_art'``: same but for the output of the
          elements. Used in :mod:`sage.misc.displayhook`.

        - ``'element_is_atomic'``: the elements print atomically, that
          is, parenthesis are not required when *printing* out any of
          `x - y`, `x + y`, `x^y` and `x/y`.

        OUTPUT:
        
        Boolean.

        EXAMPLES::

            sage: ZZ._repr_option('ascii_art')
            False
            sage: MatrixSpace(ZZ, 2)._repr_option('element_ascii_art')
            True
        """
```




---

archive/issue_comments_171974.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-30T22:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171974",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_171975.json:
```json
{
    "body": "Since you're doing some cleanup, please forgive me nitpicking but you missed `trac ticket #10467` on line 610 of `parent.pyx` and the [coding convention page](http://www.sagemath.org/doc/developer/conventions.html) prefers `.. TODO::` and `.. NOTE::` blocks.\n\nBest,\n\nTravis",
    "created_at": "2013-01-31T00:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171975",
    "user": "tscrim"
}
```

Since you're doing some cleanup, please forgive me nitpicking but you missed `trac ticket #10467` on line 610 of `parent.pyx` and the [coding convention page](http://www.sagemath.org/doc/developer/conventions.html) prefers `.. TODO::` and `.. NOTE::` blocks.

Best,

Travis



---

archive/issue_comments_171976.json:
```json
{
    "body": "How badly is this going to interfere with classes that use string representations for hashing and comparison, both for time and for unexpected results? If a `_repr_option` gets changed (can they?) will element hash values suddenly change?\n\nAlso, I think there can be quite some exception raising in coercion discovery. Since error messages sometimes include operands, slowing down string conversions can possibly affect performance there too.\n\n(That's a bit of a general problem: normally you'd think that by the time you're making string representations, you don't have to worry about basic speed any more. I'm not so sure that holds in Sage)",
    "created_at": "2013-01-31T01:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171976",
    "user": "nbruin"
}
```

How badly is this going to interfere with classes that use string representations for hashing and comparison, both for time and for unexpected results? If a `_repr_option` gets changed (can they?) will element hash values suddenly change?

Also, I think there can be quite some exception raising in coercion discovery. Since error messages sometimes include operands, slowing down string conversions can possibly affect performance there too.

(That's a bit of a general problem: normally you'd think that by the time you're making string representations, you don't have to worry about basic speed any more. I'm not so sure that holds in Sage)



---

archive/issue_comments_171977.json:
```json
{
    "body": "Nils, there is nothing user-configurable here. Its about metadata, not a configuration system. The only one who should change the `_repr_option()` output is the `Parent` author. This is also why its an underscore method.\n\n\nFor the patchbot who can't get the order right: \n\napply trac_14040_housekeeping.patch trac_14040_repr_option.patch trac_14040_doctest.patch",
    "created_at": "2013-01-31T10:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171977",
    "user": "vbraun"
}
```

Nils, there is nothing user-configurable here. Its about metadata, not a configuration system. The only one who should change the `_repr_option()` output is the `Parent` author. This is also why its an underscore method.


For the patchbot who can't get the order right: 

apply trac_14040_housekeeping.patch trac_14040_repr_option.patch trac_14040_doctest.patch



---

archive/issue_comments_171978.json:
```json
{
    "body": "I've also fixed the docstrings in the first patch.",
    "created_at": "2013-01-31T10:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171978",
    "user": "vbraun"
}
```

I've also fixed the docstrings in the first patch.



---

archive/issue_comments_171979.json:
```json
{
    "body": "Attachment [trac_14040_housekeeping.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_housekeeping.patch) by vbraun created at 2013-02-01 15:00:10\n\nUpdated patch",
    "created_at": "2013-02-01T15:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171979",
    "user": "vbraun"
}
```

Attachment [trac_14040_housekeeping.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_housekeeping.patch) by vbraun created at 2013-02-01 15:00:10

Updated patch



---

archive/issue_comments_171980.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-02-01T15:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171980",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_171981.json:
```json
{
    "body": "Attachment [trac_14040_doctest.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_doctest.patch) by vbraun created at 2013-02-01 15:01:33\n\nI've rebased the patches on top of sage-5.7.beta2. Older version will likely not work fyi.",
    "created_at": "2013-02-01T15:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171981",
    "user": "vbraun"
}
```

Attachment [trac_14040_doctest.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_doctest.patch) by vbraun created at 2013-02-01 15:01:33

I've rebased the patches on top of sage-5.7.beta2. Older version will likely not work fyi.



---

archive/issue_comments_171982.json:
```json
{
    "body": "Rebased to sage-5.7.beta4. Since this patch touches a couple of disparate places I would appreciate if somebody could review it so I don't have to spend my time rebasing it for every new beta.",
    "created_at": "2013-02-12T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171982",
    "user": "vbraun"
}
```

Rebased to sage-5.7.beta4. Since this patch touches a couple of disparate places I would appreciate if somebody could review it so I don't have to spend my time rebasing it for every new beta.



---

archive/issue_comments_171983.json:
```json
{
    "body": "Hey Volker,\n\nI have a few questions/comments:\n\n- Just to make sure, these are options that belong to individual `Parent` subclasses, not a global setting, correct?\n\n- There's some strange formatting of commas, for example on line 71 of `quadratic_form__local_field_invariants.py`:\n\n```\n( \nQuadratic form in 4 variables over Rational Field with coefficients:  \n[ 1 0 0 0 ]                                                          #\n[ * 3 0 0 ]                                                          #\n[ * * 5 0 ]                                                          #\n[ * * * 7 ]                                                          ,\n<BLANKLINE>\n[1 0 0 0]\n[0 0 0 1]\n) \n```\n\n  I've put the pounds `#` to signify where the whitespace ends.\n\n- Could you put the None in code formatting: ```None``` on line 129 in `displayhook.py`.\n\nIt currently looks good to me otherwise.\n\nThank you,\n\nTravis",
    "created_at": "2013-02-19T15:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171983",
    "user": "tscrim"
}
```

Hey Volker,

I have a few questions/comments:

- Just to make sure, these are options that belong to individual `Parent` subclasses, not a global setting, correct?

- There's some strange formatting of commas, for example on line 71 of `quadratic_form__local_field_invariants.py`:

```
( 
Quadratic form in 4 variables over Rational Field with coefficients:  
[ 1 0 0 0 ]                                                          #
[ * 3 0 0 ]                                                          #
[ * * 5 0 ]                                                          #
[ * * * 7 ]                                                          ,
<BLANKLINE>
[1 0 0 0]
[0 0 0 1]
) 
```

  I've put the pounds `#` to signify where the whitespace ends.

- Could you put the None in code formatting: ```None``` on line 129 in `displayhook.py`.

It currently looks good to me otherwise.

Thank you,

Travis



---

archive/issue_comments_171984.json:
```json
{
    "body": "The `_repr_option()` is meant for a particular parent, though its not a good idea to change it during the parent's lifetime (parents must be immutable). So in this sense its global, too.\n\nThe strange formatting for commas is because the displayhook treats ascii art as a square block. In this case, the width is set by \"Quadratic form in 4 variables over Rational Field with coefficients:\" and the comma is placed at the bottom right corner. It would probably be nicer if the displayhook would place the comma after the last non-whitespace character in the bottom row, but thats not the aim of this ticket.",
    "created_at": "2013-02-19T15:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171984",
    "user": "vbraun"
}
```

The `_repr_option()` is meant for a particular parent, though its not a good idea to change it during the parent's lifetime (parents must be immutable). So in this sense its global, too.

The strange formatting for commas is because the displayhook treats ascii art as a square block. In this case, the width is set by "Quadratic form in 4 variables over Rational Field with coefficients:" and the comma is placed at the bottom right corner. It would probably be nicer if the displayhook would place the comma after the last non-whitespace character in the bottom row, but thats not the aim of this ticket.



---

archive/issue_comments_171985.json:
```json
{
    "body": "Okay.\n\nOne last thing I noticed in the housekeeping on line 273:\n\n```\n.. TODO:: \n\nEventually, category should be Sets() by default\n```\n\nI would like to see this as\n\n```\n.. TODO:: \n\n    Eventually, category should be :class:`Sets` by default.\n```\n\nIn particular, this should be indented. Once this is done, then I'll set this to positive review.\n\nThank you,\n\nTravis",
    "created_at": "2013-02-19T16:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171985",
    "user": "tscrim"
}
```

Okay.

One last thing I noticed in the housekeeping on line 273:

```
.. TODO:: 

Eventually, category should be Sets() by default
```

I would like to see this as

```
.. TODO:: 

    Eventually, category should be :class:`Sets` by default.
```

In particular, this should be indented. Once this is done, then I'll set this to positive review.

Thank you,

Travis



---

archive/issue_comments_171986.json:
```json
{
    "body": "I'm marking this ticket dependent on the \"doctests for rings\" patch since the two conflict.",
    "created_at": "2013-02-24T03:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171986",
    "user": "vbraun"
}
```

I'm marking this ticket dependent on the "doctests for rings" patch since the two conflict.



---

archive/issue_comments_171987.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2013-02-24T03:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171987",
    "user": "vbraun"
}
```

Rebased patch



---

archive/issue_comments_171988.json:
```json
{
    "body": "Attachment [trac_14040_repr_option.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_repr_option.patch) by vbraun created at 2013-02-24 03:34:35\n\nThe last patch addresses your issues.",
    "created_at": "2013-02-24T03:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171988",
    "user": "vbraun"
}
```

Attachment [trac_14040_repr_option.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_repr_option.patch) by vbraun created at 2013-02-24 03:34:35

The last patch addresses your issues.



---

archive/issue_comments_171989.json:
```json
{
    "body": "For the patchbot:\n\napply trac_14040_housekeeping.patch, trac_14040_repr_option.patch, trac_14040_doctest.patch, trac_14040_review.patch",
    "created_at": "2013-02-24T03:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171989",
    "user": "vbraun"
}
```

For the patchbot:

apply trac_14040_housekeeping.patch, trac_14040_repr_option.patch, trac_14040_doctest.patch, trac_14040_review.patch



---

archive/issue_comments_171990.json:
```json
{
    "body": "The current patch does not apply for me (as well) on `5.7.beta3` with all the prerequisite patches.",
    "created_at": "2013-02-25T03:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171990",
    "user": "tscrim"
}
```

The current patch does not apply for me (as well) on `5.7.beta3` with all the prerequisite patches.



---

archive/issue_comments_171991.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-02-25T03:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171991",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_171992.json:
```json
{
    "body": "It applies cleanly on sage-5.8.beta1. I think its pretty hopeless to try to collect all tickets since 5.7.beta3 that this would depend on.",
    "created_at": "2013-02-25T03:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171992",
    "user": "vbraun"
}
```

It applies cleanly on sage-5.8.beta1. I think its pretty hopeless to try to collect all tickets since 5.7.beta3 that this would depend on.



---

archive/issue_comments_171993.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-02-25T03:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171993",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_171994.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-02-25T21:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171994",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_171995.json:
```json
{
    "body": "Attachment [trac_14040_review.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_review.patch) by vbraun created at 2013-02-25 21:24:13\n\nGot the wrong number for the \"doctests for rings\" ticket...",
    "created_at": "2013-02-25T21:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171995",
    "user": "vbraun"
}
```

Attachment [trac_14040_review.patch](tarball://root/attachments/some-uuid/ticket14040/trac_14040_review.patch) by vbraun created at 2013-02-25 21:24:13

Got the wrong number for the "doctests for rings" ticket...



---

archive/issue_comments_171996.json:
```json
{
    "body": "Then do you want me to rebase #13685 over this ticket?",
    "created_at": "2013-02-25T21:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171996",
    "user": "tscrim"
}
```

Then do you want me to rebase #13685 over this ticket?



---

archive/issue_comments_171997.json:
```json
{
    "body": "Apparently #13685 needs to be rebased anyways, this was the problem in with the patchbot. It would be nice if you can base it on this ticket, otherwise it'll depend on what Jeroen merges first.",
    "created_at": "2013-02-25T22:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171997",
    "user": "vbraun"
}
```

Apparently #13685 needs to be rebased anyways, this was the problem in with the patchbot. It would be nice if you can base it on this ticket, otherwise it'll depend on what Jeroen merges first.



---

archive/issue_comments_171998.json:
```json
{
    "body": "I'll be rebasing #13685 on this ticket (once `5.8.beta2` is released). Everything looks good to me now.\n\nThank you,\n\nTravis",
    "created_at": "2013-02-26T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171998",
    "user": "tscrim"
}
```

I'll be rebasing #13685 on this ticket (once `5.8.beta2` is released). Everything looks good to me now.

Thank you,

Travis



---

archive/issue_comments_171999.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-26T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-171999",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_172000.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-28T10:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13836",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13836#issuecomment-172000",
    "user": "jdemeyer"
}
```

Resolution: fixed
