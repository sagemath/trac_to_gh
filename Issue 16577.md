# Issue 16577: Add SAGE_PROFILE to enable profiler

archive/issues_016577.json:
```json
{
    "body": "CC:  mraum @jdemeyer @novoselt\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16814\n\n",
    "created_at": "2014-08-13T17:13:49Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Add SAGE_PROFILE to enable profiler",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16577",
    "user": "https://github.com/vbraun"
}
```
CC:  mraum @jdemeyer @novoselt



Issue created by migration from https://trac.sagemath.org/ticket/16814





---

archive/issue_comments_218083.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-13T17:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218083",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_218084.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-13T17:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218084",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_218085.json:
```json
{
    "body": "This, it seems, gives only the filename, e.g. integer.pyx.  Is it possible to modify the profiling so that we get the full path?",
    "created_at": "2014-08-14T09:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218085",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

This, it seems, gives only the filename, e.g. integer.pyx.  Is it possible to modify the profiling so that we get the full path?



---

archive/issue_comments_218086.json:
```json
{
    "body": "Its certainly possible, but I have no intention of modifying the way cProfile works.",
    "created_at": "2014-08-14T10:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218086",
    "user": "https://github.com/vbraun"
}
```

Its certainly possible, but I have no intention of modifying the way cProfile works.



---

archive/issue_comments_218087.json:
```json
{
    "body": "PS: https://docs.python.org/2/library/profile.html#pstats.Stats.strip_dirs",
    "created_at": "2014-08-14T11:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218087",
    "user": "https://github.com/vbraun"
}
```

PS: https://docs.python.org/2/library/profile.html#pstats.Stats.strip_dirs



---

archive/issue_comments_218088.json:
```json
{
    "body": "I investigated on this. It's not an issue of cProfile. Rather Cython must be changed. Line 688 of Cython/Compiler/ModuleNode.py one has to put os.path.abspath. Such a change would be really useful for citation management. How big, do you think, are chances that we have a downstream patch or upstream accepts such a change?",
    "created_at": "2014-08-14T14:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218088",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

I investigated on this. It's not an issue of cProfile. Rather Cython must be changed. Line 688 of Cython/Compiler/ModuleNode.py one has to put os.path.abspath. Such a change would be really useful for citation management. How big, do you think, are chances that we have a downstream patch or upstream accepts such a change?



---

archive/issue_comments_218089.json:
```json
{
    "body": "How about including a note on how to profile a single Cython module (perhaps a link to http://docs.cython.org/src/tutorial/profiling_tutorial.html)?",
    "created_at": "2014-08-14T14:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218089",
    "user": "https://github.com/mezzarobba"
}
```

How about including a note on how to profile a single Cython module (perhaps a link to http://docs.cython.org/src/tutorial/profiling_tutorial.html)?



---

archive/issue_comments_218090.json:
```json
{
    "body": "That's a nice suggestion, and we should indeed include such a note.\n\nAs for citation management (see #16777), the burden to the user to obtain correct citations for the code that he or she uses should not be excessively high. That's why I'm looking for a nice way to get the full module path.",
    "created_at": "2014-08-14T14:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218090",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

That's a nice suggestion, and we should indeed include such a note.

As for citation management (see #16777), the burden to the user to obtain correct citations for the code that he or she uses should not be excessively high. That's why I'm looking for a nice way to get the full module path.



---

archive/issue_comments_218091.json:
```json
{
    "body": "The link to the cython tutorial has no place in the installation instructions. But you are welcome to write more on Cython debugging and profiling  in the developer guide. On another ticket, ideally.",
    "created_at": "2014-08-14T14:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218091",
    "user": "https://github.com/vbraun"
}
```

The link to the cython tutorial has no place in the installation instructions. But you are welcome to write more on Cython debugging and profiling  in the developer guide. On another ticket, ideally.



---

archive/issue_comments_218092.json:
```json
{
    "body": "You're absoultely right. The purpose of this ticket is to add an environment variable. And this change looks good.",
    "created_at": "2014-08-14T14:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218092",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

You're absoultely right. The purpose of this ticket is to add an environment variable. And this change looks good.



---

archive/issue_comments_218093.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-14T14:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218093",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_218094.json:
```json
{
    "body": "For citation management (re)compiling Sage is probably too much of a burden. This will exclude everybody with a system-wide Sage installation, for starters. \n\nHave you thought about inspecting memory? Any third-party interface will create objects, so thats an easy place to look at what changed. You could temporarily disable gc if you worry about them being collected too early.",
    "created_at": "2014-08-14T15:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218094",
    "user": "https://github.com/vbraun"
}
```

For citation management (re)compiling Sage is probably too much of a burden. This will exclude everybody with a system-wide Sage installation, for starters. 

Have you thought about inspecting memory? Any third-party interface will create objects, so thats an easy place to look at what changed. You could temporarily disable gc if you worry about them being collected too early.



---

archive/issue_comments_218095.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-16T07:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16577#issuecomment-218095",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
