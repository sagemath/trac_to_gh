# Issue 21714: implement random planar bicubic graphs in a bijective way

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-11-23 14:55:20

CC:  kdilks dimpase pportilla dcoudert

using an algorithm of Schaeffer


---

Comment by chapoton created at 2016-11-23 14:55:45

New commits:


---

Comment by chapoton created at 2016-11-23 16:56:27

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-12-13 20:42:33

looking for a referee...


---

Comment by dimpase created at 2016-12-13 21:14:20

Do you have a script to test it? I mean, the total number of such graphs is known for small values of  n (cf. https://oeis.org/A007085) and so it's possible to run it many times and see whether you can get anywhere close to a uniform distribution.

By the way, there are few trailing spaces in the branch.


---

Comment by dcoudert created at 2016-12-13 21:59:40

When looking at the diff of your branch [here](https://git.sagemath.org/sage.git/diff?id=747f0a0b0f29497fb4b063ab223e19bc27b2c174), it seems that it deletes file `graph_generators.py`. Please check...


---

Comment by dimpase created at 2016-12-13 22:09:52

no, it's OK, it's a git viewer bug; I saw this few times. If you fetch the branch it's OK. It adds 2 lines to the file that is shown as deleted.


---

Comment by git created at 2016-12-14 09:12:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-12-14 10:25:41

Hmm, this algorithm does not generate only 3-connected graphs.

It seems that the sequence of numbers is not in the OEIS:

```
sage: resu = {i: set() for i in range(1,6)}
sage: liste = []                           
....: for n in range(1,6):
....:     for k in range(6600):
....:         g = graphs.RandomBicubicPlanar(n)
....:         h = g.copy(immutable=True)
....:         resu[n].add(hash(h))
....:     liste.append(len(resu[n]))
sage: liste
[1, 3, 17, 103, 642]
```


Probably a better way to check would be to return also the root edge, so that the number of different possible outputs is given by Tutte's formula in A257.


---

Comment by dimpase created at 2016-12-14 11:27:49

Replying to [comment:9 chapoton]:
> Hmm, this algorithm does not generate only 3-connected graphs.

Right - but you could drop ones that are not 3-connected,
and also drop the marked (root) edge and count the results up to an isomorphism, and this would give you the OEIS sequence.


> 
> It seems that the sequence of numbers is not in the OEIS:
> {{{
> sage: resu = {i: set() for i in range(1,6)}
> sage: liste = []                           
> ....: for n in range(1,6):
> ....:     for k in range(6600):
> ....:         g = graphs.RandomBicubicPlanar(n)
> ....:         h = g.copy(immutable=True)
> ....:         resu[n].add(hash(h))
> ....:     liste.append(len(resu[n]))
> sage: liste
> [1, 3, 17, 103, 642]
> }}}
> 
> Probably a better way to check would be to return also the root edge, so that the number of different possible outputs is given by Tutte's formula in A257.


---

Comment by chapoton created at 2016-12-31 21:12:34

ping ?


---

Comment by dimpase created at 2016-12-31 22:06:31

OK, can you say anything about the distribution of your random graphs?
Asking the user to check the original article for this is a bit too much...


---

Comment by chapoton created at 2017-01-01 09:03:00

Here is at least a way to check that it generates
A000257: Number of rooted bicubic maps: a(n) = (8n-4)*a(n-1)/(n+2)

A procedure to faithfully encode the rooted map in a digraph:

```
def bicubic_dual_grand(g):
    G = DiGraph()
    for a, b, c in g.edges():
        ac = a + (c,)
        bc = b + (c,)
        G.add_edge((ac, bc))
        G.add_edge((bc, ac))
    for vert in g:
        if vert[0] == 'i':
            clef = (0, 1, 2)
        else:
            clef = (1, 0, 2)

        A, B, C = [vert + (c,) for c in clef]
        G.add_edge(A, B)
        G.add_edge(B, C)
        G.add_edge(C, A)

    op_root = [u for u in G.outgoing_edge_iterator(('n', -1, 0))
               if u[1][0] == 'i']
    G.delete_edge(op_root[0])
    return G
```

then

```
sage: resu = {i: set() for i in range(1,6)}
sage: liste = []                           
....: for n in range(1,6):
....:     for k in range(400*n):
....:         g = bicubic_dual_grand(graphs.RandomBicubicPlanar(n)).canonical_label()
....:         h = g.copy(immutable=True)
....:         resu[n].add(h)
....:     liste.append(len(resu[n]))
sage: liste
```

Checking uniformity should be doable similarly.


---

Comment by dimpase created at 2017-01-01 11:21:30

I don't always get all the graphs; in some runs for n=6 I get one graph less, and for n=7 I got only 1230 (instead of 1584, according to [OEIS](https://oeis.org/A000257)).
Here is one more run of your script in the range [1..8]:

```
sage: liste
[1, 3, 12, 56, 288, 1242, 2418]
```


I did not check, perhaps the non-uniformity is not in your branch, but somewhere else...


---

Comment by chapoton created at 2017-01-01 12:25:35

Well, this is random generation, so probably you just need to run more times. The bound 400*n is quite arbitrary, and likely to be insufficient for n>=7. I do not know how many runs would be sufficient to get all of them with high probability.


---

Comment by dimpase created at 2017-01-01 13:21:32

Replying to [comment:15 chapoton]:
> Well, this is random generation, so probably you just need to run more times. The bound 400*n is quite arbitrary, and likely to be insufficient for n>=7. I do not know how many runs would be sufficient to get all of them with high probability.

Increasing bound to 4000*n gives

```
[1, 3, 12, 56, 288, 1584, 8710]
```


OK, this looks reasonable. If there is anything regarding the distribution in the text you refer to, please add it to the docs. Otherwise it's good to go.


---

Comment by chapoton created at 2017-01-01 13:23:43

Thanks for your help.

As I have already explained in the doc, the distribution is uniform.


---

Comment by dimpase created at 2017-01-01 13:28:28

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2017-01-01 13:28:28

Happy NY!


---

Comment by vbraun created at 2017-01-18 20:39:06

Resolution: fixed
