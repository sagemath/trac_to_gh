# Issue 19730: fix or remove cliquer

Issue created by migration from https://trac.sagemath.org/ticket/19967

Original creator: vbraun

Original creation time: 2016-01-26 20:39:33

CC:  dimpase ncohen was

The installation of cliquer can fail randomly with:

```
error: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/install_name_tool: changing install names or rpaths can't be redone for: /Users/vbraun/Code/binary-pkg/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeqip0oidmas391yaj24ng0bmdu/local/lib/libcliquer.dylib (for architecture x86_64) because larger updated load commands do not fit (the program must be relinked, and you may need to use -headerpad or -headerpad_max_install_names)
```

Really the current cliquer has no business being a standard package:
* No build system to speak of
* Errors are not caught
* A libcliquer.so is installed on Darwin (in addition to libcliquer.dylib)


---

Comment by dimpase created at 2016-01-26 20:49:11

I'll let it burn in autohell, to begin with. Wish me luck. Hopefully this at least makes it installable everywhere we need...


---

Comment by fbissey created at 2016-01-26 21:59:40

Replying to [comment:2 dimpase]:
> I'll let it burn in autohell, to begin with. Wish me luck. Hopefully this at least makes it installable everywhere we need...

luck.


---

Comment by dimpase created at 2016-01-27 00:34:47

https://github.com/dimpase/autocliquer has the dirty stuff done; one can build shared libs on Linux and OSX and cliquer's own tests pass. I don't know how to properly hook the tests into the autohell (so that `make check` does the right thing), please advice (or submit a pull request :-))

`make check` should run `test/testcases`, reading data from the same directory.

 what the the right Makefile.am magic for them?

Similarly, there are `include/cliquer/test*` files that should not really be installed, they only needed for `make check`

I can't also figure out how to set up the proper version number on the `.so` file. It's again something for `configure.ac` or one of `Makefile.am`.


---

Comment by fbissey created at 2016-01-27 00:40:37

For proper version number it is in `configure.ac` and that's libtool stuff. Look at eclib for a nice example https://github.com/JohnCremona/eclib/blob/master/configure.ac I would recommend 1.0.0 to start with.
for the rest I imagine you'll take PR if we send them.


---

Comment by vbraun created at 2016-01-27 03:32:03

PR sent...


---

Comment by jdemeyer created at 2016-01-27 09:40:45

Replying to [comment:6 vbraun]:
> PR sent...
Which PR to who?


---

Comment by dimpase created at 2016-01-27 10:00:43

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 vbraun]:
> > PR sent...
> Which PR to who?
a PR to me on the github repo https://github.com/dimpase/autocliquer
(thanks Volker!)

I have already used it and make a proper testsuite; tests pass. Now to the version thing, and it will be ready for making its way into Sage.


---

Comment by dimpase created at 2016-01-27 13:26:37

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-01-27 13:26:37

New commits:


---

Comment by dimpase created at 2016-01-27 13:27:23

oh, sorry, the same rotten develop branch of me --- will be fixed soon


---

Comment by dimpase created at 2016-01-27 13:28:59

you may meanwhile just review the last commit (â€‹05c5881)

sorry for mess


---

Comment by git created at 2016-01-27 13:42:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-01-27 14:13:30

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2016-01-27 14:13:30

Why fork cliquer? Did you even try to report this upstream?


---

Comment by dimpase created at 2016-01-27 14:20:34

Replying to [comment:13 jdemeyer]:
> Why fork cliquer? Did you even try to report this upstream?
I know Patric, the maintainer, for over 20 years. I sent him an email, but he is a busy guy, and I am not sure how quickly he will react. Meanwhile this is all we have.


---

Comment by dimpase created at 2016-01-27 14:33:12

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2016-01-27 14:59:24

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2016-01-27 14:59:24

Still: why fork cliquer instead of patching the sources?


---

Comment by dimpase created at 2016-01-27 15:05:23

Replying to [comment:17 jdemeyer]:
> Still: why fork cliquer instead of patching the sources? 

Cause this is the only way I know how to fix it once and for good. And cause this is waste of anyone's time to do manual building of shared libraries instead of using appropriate tools.


---

Comment by dimpase created at 2016-01-27 15:05:37

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2016-01-27 15:08:39

or do you mean to say "why don't I create a mega-patch instead of being honest about it?"


---

Comment by jdemeyer created at 2016-01-27 15:38:31

Replying to [comment:20 dimpase]:
> or do you mean to say "why don't I create a mega-patch instead of being honest about it?"
If it is a mega-patch, you're probably doing it wrong.


---

Comment by dimpase created at 2016-01-27 15:58:40

Replying to [comment:21 jdemeyer]:
> Replying to [comment:20 dimpase]:
> > or do you mean to say "why don't I create a mega-patch instead of being honest about it?"
> If it is a mega-patch, you're probably doing it wrong.

Maybe you stop saying how wrong I am and review my changes?
This is getting silly. I made a sane directory layout to begin with, and created bog-standard Makefile.am and configure.ac

I forwarded you the email I just got from the maintainer. Go figure. I don't think we have this option in the "Report Upstream" menu.


---

Comment by jdemeyer created at 2016-01-27 16:26:58

Replying to [comment:22 dimpase]:
> I made a sane directory layout to begin with, and created bog-standard Makefile.am and configure.ac

Which is very good, I'm not complaining about that. I am only saying that _this is not a reason to fork cliquer_.


---

Comment by vbraun created at 2016-01-27 19:49:12

Can you add a `--libdir="$SAGE_LOCAL/lib"` to the configure? I'm not 100% sure if its still needed now that we have a lib64->lib symlink; But some distros use a complicated multilib naming scheme and we'd still break if that gets used.


---

Comment by git created at 2016-01-27 20:10:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-01-27 20:18:41

OK, done


---

Comment by vbraun created at 2016-01-27 20:41:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-28 17:14:20

Resolution: fixed
