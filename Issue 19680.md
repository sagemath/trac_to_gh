# Issue 19680: Libgap tab completion

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2016-01-20 16:22:32

CC:  dimpase




---

Comment by vbraun created at 2016-01-20 18:54:20

Changing component from PLEASE CHANGE to group theory.


---

Comment by vbraun created at 2016-01-20 18:54:20

Changing type from PLEASE CHANGE to enhancement.


---

Comment by vbraun created at 2016-01-20 18:54:20

New commits:


---

Comment by git created at 2016-01-20 23:04:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-01-20 23:04:58

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-01-20 23:59:03

Still, the tab completion on objects obtained from libgap does not work; not sure if it was intended to be fixed by this ticket:


```
sage: g=libgap.GeneralLinearGroup(3,2)
sage: g.
g.N                     g.cartesian_product     g.is_bool               g.is_permutation        g.matrix                g.parent                g.save                  g.version
g.abs                   g.category              g.is_function           g.is_prime              g.multiplicative_order  g.powers                g.subs                  
g.additive_order        g.db                    g.is_list               g.is_record             g.n                     g.rename                g.substitute            
g.base_extend           g.dump                  g.is_nilpotent          g.is_string             g.numerical_approx      g.reset_name            g.trait_names           
g.base_ring             g.dumps                 g.is_one                g.is_zero               g.order                 g.sage                  g.vector                
sage: g.Order()  # this choice not offered, but works...
168
```



---

Comment by vbraun created at 2016-01-21 00:18:58

Did you rebuild the Sage library? I get:

```
sage: g =libgap.GeneralLinearGroup(3,2)
sage: g.
Display all 727 possibilities? (y or n)
g.ANonReesCongruenceOfSemigroup                   g.IsReesMatrixSemigroup
g.AbelianGroupCons                                g.IsReesZeroMatrixSemigroup
g.AbelianInvariants                               g.IsRegular
g.AbelianInvariantsMultiplier                     g.IsRegularSemigroup
...
```



---

Comment by dimpase created at 2016-01-21 09:37:03

Replying to [comment:6 vbraun]:
> Did you rebuild the Sage library? 
hmm, no I didn't. However, are all there 727 options relevant here?
We only want functions which accept Group as the 1st parameter, no?


---

Comment by vbraun created at 2016-01-21 09:54:31

Its perhaps not too surprising that most GAP functions accept a group...


---

Comment by vdelecroix created at 2016-01-21 11:30:59

Anyway

```
sage -t --long src/sage/libs/gap/element.pyx
**********************************************************************
File "src/sage/libs/gap/element.pyx", line 405, in sage.libs.gap.element.GapElement.__dir__
Failed example:
    'GeneratorsOfGroup' in dir(G)
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   5 in sage.libs.gap.element.GapElement.__dir__
    [356 tests, 1 failure, 1.97 s]
```



---

Comment by vdelecroix created at 2016-01-21 11:30:59

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2016-01-21 11:34:59


```
sage: from sage.libs.gap.all_documented_functions import *
sage: g=Group([ [ [ Z(3), 0*Z(3) ],[ Z(3), Z(3) ] ] ])
sage: g
Group([ [ [ Z(3), 0*Z(3) ], [ Z(3), Z(3) ] ] ])
sage: g.O
g.Omega                        g.OmegaOp                      g.OrbitLengthOp                g.OrbitOp                      g.Orbits                       
g.OmegaAndLowerPCentralSeries  g.OmegaSeries                  g.OrbitLengths                 g.OrbitStabilizerAlgorithm     g.OrbitsDomain                 
g.OmegaCons                    g.OneImmutable                 g.OrbitLengthsDomain           g.OrbitStabilizerOp            g.OrdinaryCharacterTable       
sage: g.Order()
6
```

       
although `g.Size()` does work.

```
sage: g.Si                    
g.Sigma                  g.SingleCollector        g.SingleValuedHashTable  g.Size
```



---

Comment by dimpase created at 2016-01-21 11:37:30

indeed, with `g` as above: 

```
sage: 'Order' in dir(g)
False
sage: 'Size' in dir(g)
True
```


I'll ask GAP people...


---

Comment by vbraun created at 2016-01-21 11:56:31

Thats because Order is not a function

```
gap> IsFunction("Order");
false
gap> Order;
<Attribute "Order">
```

I guess we should treat attribute as function...


---

Comment by vbraun created at 2016-01-21 11:57:41

And the name of GeneratorsOfGroup is also susprising

```
gap> NameFunction(GeneratorsOfGroup);
"GeneratorsOfMagmaWithInverses"
```



---

Comment by vbraun created at 2016-01-21 12:07:43

The gap (not: libgap) tab completion also doesn't have GeneratorsOfGroup:

```
sage: G = gap.SymmetricGroup(3)
sage: G.GeneratorsOf[TAB]
G.GeneratorsOfDomain             G.GeneratorsOfMagmaWithInverses  
G.GeneratorsOfMagma              G.GeneratorsOfMagmaWithOne       
sage: G.GeneratorsOfMagmaWithInverses()
[ (1,2,3), (1,2) ]
```



---

Comment by vbraun created at 2016-01-21 12:11:55

Improving tab completion beyond what the gap interface currently does should go into a separate ticket.


---

Comment by git created at 2016-01-21 12:16:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-01-21 12:19:17

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2016-01-21 12:20:57

Replying to [comment:12 vbraun]:
> Thats because Order is not a function
> {{{
> gap> IsFunction("Order");

it must be `IsFunction(Order);`
then you get `true`


---

Comment by vbraun created at 2016-02-13 14:00:15

Bump... tab completion is still borked


---

Comment by dimpase created at 2016-02-13 15:27:26

Aren't we GAP 4.8-based here, and waiting for it to be released?


---

Comment by vbraun created at 2016-02-13 17:01:03

This ticket is independent of the gap 4.8 update


---

Comment by dimpase created at 2016-02-13 18:12:43

Is the caching of keywords, etc done in sync with the updates of stored GAP workspaces?
(this is how it looks from reading the code, but perhaps I am missing something)

And what does happen if a GAP package is loaded? (e.g. `Graph` would only be available
after `LoadPackage("grape")`)


---

Comment by vbraun created at 2016-02-13 18:52:43

Caching is done on first use. Testing whether a function is documented is slow enough that we can't do it whenever tab completion is requested. Packages loaded by hand lateron will not be in the tab completion, just as when tab completion worked last time.


---

Comment by dimpase created at 2016-02-13 20:06:11

I think it is quite convoluted solution, also making it hard to hook up docs of GAP packages. 

Namely, the documentation does not magically change once a workspace is updated, but only when libGAP and GAP packages/databases are (re)installed. I'd rather see the corresponding cache built at libGAP (and eventually at GAP packages/GAP database) installation time, and not updated at runtime. This would not be a big rewrite, basically all the functionality for this is already implemented. 

I don't have a clear idea how to handle loadable packages, this can be postponed for another ticket.


---

Comment by dimpase created at 2016-02-13 20:06:11

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2016-02-13 20:23:40

I agree that there should be better handling of caches (including the workspace), but it should be a separate ticket.


---

Comment by vbraun created at 2016-02-13 20:23:40

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2016-02-13 22:31:52

could you add a description of what `sage/libs/gap/operations.py` is for in the top
part of this file? Is it meant to help with tab completion? How?
Something else?


---

Comment by git created at 2016-02-13 23:37:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-02-13 23:37:43

Done


---

Comment by dimpase created at 2016-02-14 08:33:17

great, thanks!


---

Comment by dimpase created at 2016-02-14 08:33:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-02-14 22:21:58

Resolution: fixed
