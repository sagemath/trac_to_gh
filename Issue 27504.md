# Issue 27504: bug in sympy conversion of hypergeometric with tuple arg of length 1

Issue created by migration from https://trac.sagemath.org/ticket/27741

Original creator: chapoton

Original creation time: 2019-04-28 09:09:59

CC:  rws tscrim

This fails, because the argument [1] is converted to (1) by the symbolic ring, and then to 1 by sympy itself. Sigh.

```
sage: from sage.symbolic.expression_conversions import sympy_converter
sage: F=hypergeometric([1/3,2/3],[1,1],x)
sage: F._sympy_()
hyper((1/3, 2/3), (1, 1), x)
sage: F=hypergeometric([1/3,2/3],[1],x)
sage: F._sympy_()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-61-3877d08c877a> in <module>()
----> 1 F._sympy_()

/home/chapoton/sage3/local/lib/python3.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._sympy_ (build/cythonized/sage/symbolic/expression.cpp:11351)()
   1456         """
   1457         from sage.symbolic.expression_conversions import sympy_converter
-> 1458         return sympy_converter(self)
   1459 
   1460     def _fricas_init_(self):

/home/chapoton/sage3/local/lib/python3.7/site-packages/sage/symbolic/expression_conversions.py in __call__(self, ex)
    223             return self.tuple(ex)
    224         else:
--> 225             return self.composition(ex, operator)
    226 
    227     def get_fake_div(self, ex):

/home/chapoton/sage3/local/lib/python3.7/site-packages/sage/symbolic/expression_conversions.py in composition(self, ex, operator)
    791         f_sympy = getattr(sympy, f, None)
    792         if f_sympy:
--> 793             return f_sympy(*sympy.sympify(g, evaluate=False))
    794         else:
    795             return sympy.Function(str(f))(*g, evaluate=False)

/home/chapoton/sage3/local/lib/python3.7/site-packages/sympy/functions/special/hyper.py in __new__(cls, ap, bq, z)
    181     def __new__(cls, ap, bq, z):
    182         # TODO should we check convergence conditions?
--> 183         return Function.__new__(cls, _prep_tuple(ap), _prep_tuple(bq), z)
    184 
    185     @classmethod

/home/chapoton/sage3/local/lib/python3.7/site-packages/sympy/functions/special/hyper.py in _prep_tuple(v)
     43     """
     44     from sympy import unpolarify
---> 45     return TupleArg(*[unpolarify(x) for x in v])
     46 
     47 

TypeError: 'One' object is not iterable
```



---

Comment by chapoton created at 2019-04-28 09:51:31

New commits:


---

Comment by chapoton created at 2019-04-28 11:46:38

green bot, please review


---

Comment by tscrim created at 2019-04-28 12:25:15

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-04-28 12:25:15

Makes sense and LGTM. By comment:2, I am assuming this is ready for review.


---

Comment by tscrim created at 2019-04-28 12:25:26

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-04-28 12:25:26

If not, please revert.


---

Comment by chapoton created at 2019-04-28 12:32:52

yes, thanks a lot for the super-fast review!


---

Comment by vbraun created at 2019-05-06 11:56:14

Resolution: fixed
