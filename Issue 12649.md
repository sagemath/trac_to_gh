# Issue 12649: testcc.sh: allow $CC to contain multiple words

archive/issues_012649.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nIf CC=\"gcc -m32\" (for example), then the following will fail:\n\n```\n$ testcc.sh $CC\nUsage: spkg/bin/testcc.sh name_or_path_to_the_C_compiler\n[...]\n```\n\n\nWe should allow `testcc.sh` to accept multiple arguments and use all of them to run the C compiler.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12821\n\n",
    "created_at": "2012-04-09T18:38:48Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "testcc.sh: allow $CC to contain multiple words",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12649",
    "user": "jdemeyer"
}
```
Assignee: GeorgSWeber

If CC="gcc -m32" (for example), then the following will fail:

```
$ testcc.sh $CC
Usage: spkg/bin/testcc.sh name_or_path_to_the_C_compiler
[...]
```


We should allow `testcc.sh` to accept multiple arguments and use all of them to run the C compiler.

Issue created by migration from https://trac.sagemath.org/ticket/12821





---

archive/issue_comments_150674.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-09T18:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150674",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_150675.json:
```json
{
    "body": "Stylewise, I'd use `[ $# -lt  1 ]`.\n\nThe usage should say \"`$0 name_or_path_to_the_C_compiler [optional arguments]`\".\n\nI'd also use `$`@`` instead of `\"$`@`\"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.\n\nIt's also a bit funny to use `grep ... | sed ...`; a single invocation of `sed` is sufficient.  (At least he didn't use `... | cat | ...` ;-) )",
    "created_at": "2012-04-09T21:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150675",
    "user": "leif"
}
```

Stylewise, I'd use `[ $# -lt  1 ]`.

The usage should say "`$0 name_or_path_to_the_C_compiler [optional arguments]`".

I'd also use `$`@`` instead of `"$`@`"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.

It's also a bit funny to use `grep ... | sed ...`; a single invocation of `sed` is sufficient.  (At least he didn't use `... | cat | ...` ;-) )



---

archive/issue_comments_150676.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> Stylewise, I'd use `[ $# -lt  1 ]`.\nIn case the user supplies -2 arguments :-)",
    "created_at": "2012-04-09T21:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150676",
    "user": "jdemeyer"
}
```

Replying to [comment:5 leif]:
> Stylewise, I'd use `[ $# -lt  1 ]`.
In case the user supplies -2 arguments :-)



---

archive/issue_comments_150677.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> I'd also use `$`@`` instead of `\"$`@`\"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.\nI think quoting `$CC` should hurt because it's wrong.\n\nOne must not run\n\n```\n\"$CC\" foo.c -o foo\n```\n\nso I think one should also not run\n\n```\ntestcc.sh \"$CC\"\n```\n",
    "created_at": "2012-04-09T22:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150677",
    "user": "jdemeyer"
}
```

Replying to [comment:5 leif]:
> I'd also use `$`@`` instead of `"$`@`"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.
I think quoting `$CC` should hurt because it's wrong.

One must not run

```
"$CC" foo.c -o foo
```

so I think one should also not run

```
testcc.sh "$CC"
```




---

archive/issue_comments_150678.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> I'd also use `$`@`` instead of `\"$`@`\"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.\n> \n> It's also a bit funny to use `grep ... | sed ...`; a single invocation of `sed` is sufficient.\n\nI.e.,\n\n```sh\n$@ -E $TESTFILE | sed -n '/^[A-Z]/s/ //gp'\n```\n",
    "created_at": "2012-04-09T22:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150678",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> I'd also use `$`@`` instead of `"$`@`"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.
> 
> It's also a bit funny to use `grep ... | sed ...`; a single invocation of `sed` is sufficient.

I.e.,

```sh
$@ -E $TESTFILE | sed -n '/^[A-Z]/s/ //gp'
```




---

archive/issue_comments_150679.json:
```json
{
    "body": "Changing assignee from GeorgSWeber to jdemeyer.",
    "created_at": "2012-04-09T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150679",
    "user": "jdemeyer"
}
```

Changing assignee from GeorgSWeber to jdemeyer.



---

archive/issue_comments_150680.json:
```json
{
    "body": "New version, needs review.",
    "created_at": "2012-04-09T22:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150680",
    "user": "jdemeyer"
}
```

New version, needs review.



---

archive/issue_comments_150681.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Replying to [comment:5 leif]:\n> > I'd also use `$`@`` instead of `\"$`@`\"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.\n> I think quoting `$CC` should hurt because it's wrong.\n\nYou can't say it's wrong.  But using `\"$`@`\"` would only make sense if one e.g. did\n\n```sh\ntestcc.sh \"$CC\" \"some argument with spaces\" otherargument\n# (if $CC is actually a single pathname with spaces in it)\n\n# or, likewise\ntestcc.sh $CC \"some argument with spaces\" otherargument\n```\n\nwhich I think nobody will do.",
    "created_at": "2012-04-09T22:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150681",
    "user": "leif"
}
```

Replying to [comment:7 jdemeyer]:
> Replying to [comment:5 leif]:
> > I'd also use `$`@`` instead of `"$`@`"`, then quoting `$CC` doesn't hurt (so you wouldn't have to change the M4RIE spkg either), and the latter won't work as probably expected.
> I think quoting `$CC` should hurt because it's wrong.

You can't say it's wrong.  But using `"$`@`"` would only make sense if one e.g. did

```sh
testcc.sh "$CC" "some argument with spaces" otherargument
# (if $CC is actually a single pathname with spaces in it)

# or, likewise
testcc.sh $CC "some argument with spaces" otherargument
```

which I think nobody will do.



---

archive/issue_comments_150682.json:
```json
{
    "body": "Positive review for the patch to `testcc.sh` **if you remove the extra `grep`**... ;-)\n\n\n\n\nThe (patch to the) M4RIE spkg needs work anyway:\n\n```sh\nif [ \"$COMPILER\"  = \"GNU\" ] ; then \n    ...\n```\n\n\n(`testcc.sh` never returns `GNU`, at most `GCC`.)",
    "created_at": "2012-04-09T22:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150682",
    "user": "leif"
}
```

Positive review for the patch to `testcc.sh` **if you remove the extra `grep`**... ;-)




The (patch to the) M4RIE spkg needs work anyway:

```sh
if [ "$COMPILER"  = "GNU" ] ; then 
    ...
```


(`testcc.sh` never returns `GNU`, at most `GCC`.)



---

archive/issue_comments_150683.json:
```json
{
    "body": "Replying to [comment:11 leif]:\n> The (patch to the) M4RIE spkg needs work anyway:\n> {{{\n> #!sh\n> if [ \"$COMPILER\"  = \"GNU\" ] ; then \n>     ...\n> }}}\n> \n> (`testcc.sh` never returns `GNU`, at most `GCC`.)\n\nAnd wouldn't using `testcflags.sh -fPIC -Wall -pedantic` there be more appropriate anyway?",
    "created_at": "2012-04-09T22:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150683",
    "user": "leif"
}
```

Replying to [comment:11 leif]:
> The (patch to the) M4RIE spkg needs work anyway:
> {{{
> #!sh
> if [ "$COMPILER"  = "GNU" ] ; then 
>     ...
> }}}
> 
> (`testcc.sh` never returns `GNU`, at most `GCC`.)

And wouldn't using `testcflags.sh -fPIC -Wall -pedantic` there be more appropriate anyway?



---

archive/issue_comments_150684.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-10T02:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150684",
    "user": "leif"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150685.json:
```json
{
    "body": "... if you change the spkg *here*.\n\n(And the changelog entry should say *\"... **when calling** `testcc.sh`.\"*, provided you don't change `spkg-install` to use `testcflags.sh` of course, the latter being much better.)",
    "created_at": "2012-04-10T02:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150685",
    "user": "leif"
}
```

... if you change the spkg *here*.

(And the changelog entry should say *"... **when calling** `testcc.sh`."*, provided you don't change `spkg-install` to use `testcflags.sh` of course, the latter being much better.)



---

archive/issue_comments_150686.json:
```json
{
    "body": "Btw., `testcflags.sh` also needs work, as I already reported on sage-devel a while ago:\n\n```sh\n...\noutfile=testcflags-$$\ncfile=$outfile.c\n...\nrm -f $TESTFILE $OUTFILE\n...\n```\n\n\n(And there are a few other issues with it.  Wonder who reviewed such, as the temporary files will **always** remain, while completely unrelated files might get deleted(!).)",
    "created_at": "2012-04-10T03:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150686",
    "user": "leif"
}
```

Btw., `testcflags.sh` also needs work, as I already reported on sage-devel a while ago:

```sh
...
outfile=testcflags-$$
cfile=$outfile.c
...
rm -f $TESTFILE $OUTFILE
...
```


(And there are a few other issues with it.  Wonder who reviewed such, as the temporary files will **always** remain, while completely unrelated files might get deleted(!).)



---

archive/issue_comments_150687.json:
```json
{
    "body": "Added a fix also for testcflags.sh.",
    "created_at": "2012-04-10T08:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150687",
    "user": "jdemeyer"
}
```

Added a fix also for testcflags.sh.



---

archive/issue_comments_150688.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-10T08:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150688",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_150689.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-04-10T08:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150689",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_150690.json:
```json
{
    "body": "The test for the compiler used in M4RIE's `spkg-install` to add specific flags is still a bit weird; you could just use `testcflags.sh` for all of this, although `+ z` is currently a bit problematic (in case the space is really required), because `testcflags.sh` tests the flags one by one, and passing `\"+ z\"` as a single parameter to it might not work either, since the compiler most probably doesn't expect it to be passed as a single argument.\n\nBut the quoting in `testcflags.sh` wouldn't work as expected anyway, so you could just omit the quotes there *when calling the compiler* with previous and the currently to be tested flags.\n\n\n\n\n\n\nIf `SAGE_DEBUG=yes`, `-O0` should be **ap**pended to `CFLAGS`, as it was.",
    "created_at": "2012-04-11T13:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150690",
    "user": "leif"
}
```

The test for the compiler used in M4RIE's `spkg-install` to add specific flags is still a bit weird; you could just use `testcflags.sh` for all of this, although `+ z` is currently a bit problematic (in case the space is really required), because `testcflags.sh` tests the flags one by one, and passing `"+ z"` as a single parameter to it might not work either, since the compiler most probably doesn't expect it to be passed as a single argument.

But the quoting in `testcflags.sh` wouldn't work as expected anyway, so you could just omit the quotes there *when calling the compiler* with previous and the currently to be tested flags.






If `SAGE_DEBUG=yes`, `-O0` should be **ap**pended to `CFLAGS`, as it was.



---

archive/issue_comments_150691.json:
```json
{
    "body": "Replying to [comment:17 leif]:\n> But the quoting in `testcflags.sh` wouldn't work as expected anyway, so you could just omit the quotes there *when calling the compiler* with previous and the currently to be tested flags.\n\nOh I see, you've meanwhile fixed that, such that we could now use (e.g.) `testcflags.sh -fPIC -Kpic \"+ z\"`.",
    "created_at": "2012-04-11T13:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150691",
    "user": "leif"
}
```

Replying to [comment:17 leif]:
> But the quoting in `testcflags.sh` wouldn't work as expected anyway, so you could just omit the quotes there *when calling the compiler* with previous and the currently to be tested flags.

Oh I see, you've meanwhile fixed that, such that we could now use (e.g.) `testcflags.sh -fPIC -Kpic "+ z"`.



---

archive/issue_comments_150692.json:
```json
{
    "body": "W.r.t. `testcflags.sh`:\n\nI'd move the usage instructions from the comment into the error message given if `CC` isn't set, and add `$# -eq 0` (or `$# -lt 1`) to the test, such that calling `testcflags.sh` without arguments outputs its usage.",
    "created_at": "2012-04-11T13:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150692",
    "user": "leif"
}
```

W.r.t. `testcflags.sh`:

I'd move the usage instructions from the comment into the error message given if `CC` isn't set, and add `$# -eq 0` (or `$# -lt 1`) to the test, such that calling `testcflags.sh` without arguments outputs its usage.



---

archive/issue_comments_150693.json:
```json
{
    "body": "A few more comments:\n\n* The scripts could respect `TMP` and `TMPDIR` if set.\n\n* On Cygwin `-o foo` will create `foo.exe`, so that should (also) be removed.\n\n* Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.\n\n* In `spkg/install`, there should be a way to bypass the installation of GCC (if the compiler isn't GCC), e.g. if `SAGE_PORT=yes` (?).  Or is there already such?",
    "created_at": "2012-04-11T13:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150693",
    "user": "leif"
}
```

A few more comments:

* The scripts could respect `TMP` and `TMPDIR` if set.

* On Cygwin `-o foo` will create `foo.exe`, so that should (also) be removed.

* Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.

* In `spkg/install`, there should be a way to bypass the installation of GCC (if the compiler isn't GCC), e.g. if `SAGE_PORT=yes` (?).  Or is there already such?



---

archive/issue_comments_150694.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n>  * In `spkg/install`, there should be a way to bypass the installation of GCC (if the compiler isn't GCC), e.g. if `SAGE_PORT=yes` (?).  Or is there already such?\n\nDoesn't look like.  (Although one can set `SAGE_INSTALL_GCC=no`.)\n\nQuite unrelated, but from `spkg/install` (i.e., while we're at it):\n\n```sh\nif [ -z \"$SAGE_FORTRAN\" ]; then\n    if command -v gfortran >/dev/null 2>/dev/null; then\n        SAGE_FORTRAN=gfortran\n    elif command -v g95 >/dev/null 2>/dev/null; then\n        SAGE_FORTRAN=g95\n    elif command -v g77 >/dev/null 2>/dev/null; then\n        SAGE_FORTRAN=g77\n    fi\nfi\n```\n\nignores settings of `FC` and `F77`, the standard variables containing the Fortran compiler.\n\nThe created `sage_fortran` script hardcodes `-m64` (and ignores `FFLAGS`, `FCFLAGS`, `F77FLAGS` etc.).\n\nDon't know whether that's really intentional, but also the *current setting* of `SAGE_FORTRAN` is hardcoded into the script, such that later changing `SAGE_FORTRAN` has no effect.",
    "created_at": "2012-04-11T14:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150694",
    "user": "leif"
}
```

Replying to [comment:20 leif]:
>  * In `spkg/install`, there should be a way to bypass the installation of GCC (if the compiler isn't GCC), e.g. if `SAGE_PORT=yes` (?).  Or is there already such?

Doesn't look like.  (Although one can set `SAGE_INSTALL_GCC=no`.)

Quite unrelated, but from `spkg/install` (i.e., while we're at it):

```sh
if [ -z "$SAGE_FORTRAN" ]; then
    if command -v gfortran >/dev/null 2>/dev/null; then
        SAGE_FORTRAN=gfortran
    elif command -v g95 >/dev/null 2>/dev/null; then
        SAGE_FORTRAN=g95
    elif command -v g77 >/dev/null 2>/dev/null; then
        SAGE_FORTRAN=g77
    fi
fi
```

ignores settings of `FC` and `F77`, the standard variables containing the Fortran compiler.

The created `sage_fortran` script hardcodes `-m64` (and ignores `FFLAGS`, `FCFLAGS`, `F77FLAGS` etc.).

Don't know whether that's really intentional, but also the *current setting* of `SAGE_FORTRAN` is hardcoded into the script, such that later changing `SAGE_FORTRAN` has no effect.



---

archive/issue_comments_150695.json:
```json
{
    "body": "More on `spkg/install`: :-)\n\n```sh\ngrep '^\\($\\|[0-3]\\.\\|4\\.[0-3]\\|4\\.6\\.[01]$\\)'\n```\n\nis GNUism and non-portable; either use\n\n```sh\negrep '^($|[0-3]\\.|4\\.[0-3]|4\\.6\\.[01]$)'\n```\n\nor, preferably, shell pattern matching, which is reliable, and in which case you could also more easily handle e.g. a 4.6.1 version on Ubuntu.",
    "created_at": "2012-04-11T14:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150695",
    "user": "leif"
}
```

More on `spkg/install`: :-)

```sh
grep '^\($\|[0-3]\.\|4\.[0-3]\|4\.6\.[01]$\)'
```

is GNUism and non-portable; either use

```sh
egrep '^($|[0-3]\.|4\.[0-3]|4\.6\.[01]$)'
```

or, preferably, shell pattern matching, which is reliable, and in which case you could also more easily handle e.g. a 4.6.1 version on Ubuntu.



---

archive/issue_comments_150696.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> More on `spkg/install`: :-)\n> {{{\n> #!sh\n> grep '^\\($\\|[0-3]\\.\\|4\\.[0-3]\\|4\\.6\\.[01]$\\)'\n> }}}\n> is GNUism and non-portable; either use\n> {{{\n> #!sh\n> egrep '^($|[0-3]\\.|4\\.[0-3]|4\\.6\\.[01]$)'\n> }}}\n> or, preferably, shell pattern matching, which is reliable, and in which case you could also more easily handle e.g. a 4.6.1 version on Ubuntu.\nSee #12825.",
    "created_at": "2012-04-11T16:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150696",
    "user": "jdemeyer"
}
```

Replying to [comment:22 leif]:
> More on `spkg/install`: :-)
> {{{
> #!sh
> grep '^\($\|[0-3]\.\|4\.[0-3]\|4\.6\.[01]$\)'
> }}}
> is GNUism and non-portable; either use
> {{{
> #!sh
> egrep '^($|[0-3]\.|4\.[0-3]|4\.6\.[01]$)'
> }}}
> or, preferably, shell pattern matching, which is reliable, and in which case you could also more easily handle e.g. a 4.6.1 version on Ubuntu.
See #12825.



---

archive/issue_comments_150697.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> Quite unrelated, but from `spkg/install` (i.e., while we're at it):\n> {{{\n> #!sh\n> if [ -z \"$SAGE_FORTRAN\" ]; then\n>     if command -v gfortran >/dev/null 2>/dev/null; then\n>         SAGE_FORTRAN=gfortran\n>     elif command -v g95 >/dev/null 2>/dev/null; then\n>         SAGE_FORTRAN=g95\n>     elif command -v g77 >/dev/null 2>/dev/null; then\n>         SAGE_FORTRAN=g77\n>     fi\n> fi\n> }}}\n> ignores settings of `FC` and `F77`, the standard variables containing the Fortran compiler.\n> \n> The created `sage_fortran` script hardcodes `-m64` (and ignores `FFLAGS`, `FCFLAGS`, `F77FLAGS` etc.).\n> \n> Don't know whether that's really intentional, but also the *current setting* of `SAGE_FORTRAN` is hardcoded into the script, such that later changing `SAGE_FORTRAN` has no effect.\nYou're certainly right that there are some issues here, but that's totally outside of the scope of this ticket.",
    "created_at": "2012-04-11T16:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150697",
    "user": "jdemeyer"
}
```

Replying to [comment:21 leif]:
> Quite unrelated, but from `spkg/install` (i.e., while we're at it):
> {{{
> #!sh
> if [ -z "$SAGE_FORTRAN" ]; then
>     if command -v gfortran >/dev/null 2>/dev/null; then
>         SAGE_FORTRAN=gfortran
>     elif command -v g95 >/dev/null 2>/dev/null; then
>         SAGE_FORTRAN=g95
>     elif command -v g77 >/dev/null 2>/dev/null; then
>         SAGE_FORTRAN=g77
>     fi
> fi
> }}}
> ignores settings of `FC` and `F77`, the standard variables containing the Fortran compiler.
> 
> The created `sage_fortran` script hardcodes `-m64` (and ignores `FFLAGS`, `FCFLAGS`, `F77FLAGS` etc.).
> 
> Don't know whether that's really intentional, but also the *current setting* of `SAGE_FORTRAN` is hardcoded into the script, such that later changing `SAGE_FORTRAN` has no effect.
You're certainly right that there are some issues here, but that's totally outside of the scope of this ticket.



---

archive/issue_comments_150698.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> The scripts could respect `TMP` and `TMPDIR` if set.\nWhat's `TMP`?  I agree on `TMPDIR`, which is the standard way of specifying a temporary directory.\n\n> On Cygwin `-o foo` will create `foo.exe`, so that should (also) be removed.\nFair enough.\n\n>  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.\nThose two commands aren't equivalent.\n\n> In `spkg/install`, there should be a way to bypass the installation of GCC.\nYou can set `SAGE_INSTALL_GCC=no`.",
    "created_at": "2012-04-11T16:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150698",
    "user": "jdemeyer"
}
```

Replying to [comment:20 leif]:
> The scripts could respect `TMP` and `TMPDIR` if set.
What's `TMP`?  I agree on `TMPDIR`, which is the standard way of specifying a temporary directory.

> On Cygwin `-o foo` will create `foo.exe`, so that should (also) be removed.
Fair enough.

>  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.
Those two commands aren't equivalent.

> In `spkg/install`, there should be a way to bypass the installation of GCC.
You can set `SAGE_INSTALL_GCC=no`.



---

archive/issue_comments_150699.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> Replying to [comment:20 leif]:\n> >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.\n> Thoase two commands aren't equivalent.\n\nThey of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.",
    "created_at": "2012-04-11T18:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150699",
    "user": "leif"
}
```

Replying to [comment:25 jdemeyer]:
> Replying to [comment:20 leif]:
> >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.
> Thoase two commands aren't equivalent.

They of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.



---

archive/issue_comments_150700.json:
```json
{
    "body": "Replying to [comment:26 leif]:\n> Replying to [comment:25 jdemeyer]:\n> > Replying to [comment:20 leif]:\n> > >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.\n> > Thoase two commands aren't equivalent.\n> \n> They of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.\nDid you even **try** those commands before saying such non-sense?",
    "created_at": "2012-04-13T09:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150700",
    "user": "jdemeyer"
}
```

Replying to [comment:26 leif]:
> Replying to [comment:25 jdemeyer]:
> > Replying to [comment:20 leif]:
> > >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.
> > Thoase two commands aren't equivalent.
> 
> They of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.
Did you even **try** those commands before saying such non-sense?



---

archive/issue_comments_150701.json:
```json
{
    "body": "Replying to [comment:27 jdemeyer]:\n> Replying to [comment:26 leif]:\n> > Replying to [comment:25 jdemeyer]:\n> > > Replying to [comment:20 leif]:\n> > > >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.\n> > > Those two commands aren't equivalent.\n> > \n> > They of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.\n> Did you even **try** those commands before saying such non-sense?\n\nI apparently had trailing spaces on the lines with compiler names...\n\n\n```sh\nsed -n '/^[A-Z]/s/[ ]*//gp'\n```\n\ndoes it, although we shouldn't have spaces on these lines anyway (in which case the substitution of course would be superfluous).",
    "created_at": "2012-04-13T13:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150701",
    "user": "leif"
}
```

Replying to [comment:27 jdemeyer]:
> Replying to [comment:26 leif]:
> > Replying to [comment:25 jdemeyer]:
> > > Replying to [comment:20 leif]:
> > > >  Using `sed -n '/^[A-Z]/s/ //gp'` is much faster than `sed -n 's/ //g;/^[A-Z]/p'`.
> > > Those two commands aren't equivalent.
> > 
> > They of course aren't, but in our case have the same (desired) effect; mine is equivalent to what Dave did, while yours isn't.
> Did you even **try** those commands before saying such non-sense?

I apparently had trailing spaces on the lines with compiler names...


```sh
sed -n '/^[A-Z]/s/[ ]*//gp'
```

does it, although we shouldn't have spaces on these lines anyway (in which case the substitution of course would be superfluous).



---

archive/issue_comments_150702.json:
```json
{
    "body": "Replying to [comment:17 leif]:\n> If `SAGE_DEBUG=yes`, `-O0` should be **ap**pended to `CFLAGS`, as it was.\n\nThis is still in the diff; haven't downloaded the new spkg (yet).",
    "created_at": "2012-04-13T14:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150702",
    "user": "leif"
}
```

Replying to [comment:17 leif]:
> If `SAGE_DEBUG=yes`, `-O0` should be **ap**pended to `CFLAGS`, as it was.

This is still in the diff; haven't downloaded the new spkg (yet).



---

archive/issue_comments_150703.json:
```json
{
    "body": "I have based the new SPKG at\u00a0#12841\u00a0on\u00a0http://boxen.math.washington.edu/home/jdemeyer/spkg/libm4rie-20111004.p3.spkg. Additionally, I changed spkg-install to append not prepend -O0.",
    "created_at": "2012-04-13T20:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150703",
    "user": "malb"
}
```

I have based the new SPKG at #12841 on http://boxen.math.washington.edu/home/jdemeyer/spkg/libm4rie-20111004.p3.spkg. Additionally, I changed spkg-install to append not prepend -O0.



---

archive/issue_comments_150704.json:
```json
{
    "body": "New version of [attachment:12821_testcc.patch] needs review.\n\nI disagree about appending `-O0`.  I think the user's `CFLAGS` should always override the SPKG's `CFLAGS` without exceptions.  What if the user for some reason wants `--enable-debug` but still `-O2`?\n\nIn any case, the following would be very inconsistent:\n\n```sh\nif [ \"x$SAGE_DEBUG\" = \"xyes\" ]; then\n   CFLAGS=\"$CFLAGS -O0\"\n   ENABLE_DEBUG=\"--enable-debug\"\nelse\n   CFLAGS=\"-O2 $CFLAGS\"\n   ENABLE_DEBUG=\"\"\nfi\n```\n",
    "created_at": "2012-04-14T11:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150704",
    "user": "jdemeyer"
}
```

New version of [attachment:12821_testcc.patch] needs review.

I disagree about appending `-O0`.  I think the user's `CFLAGS` should always override the SPKG's `CFLAGS` without exceptions.  What if the user for some reason wants `--enable-debug` but still `-O2`?

In any case, the following would be very inconsistent:

```sh
if [ "x$SAGE_DEBUG" = "xyes" ]; then
   CFLAGS="$CFLAGS -O0"
   ENABLE_DEBUG="--enable-debug"
else
   CFLAGS="-O2 $CFLAGS"
   ENABLE_DEBUG=""
fi
```




---

archive/issue_comments_150705.json:
```json
{
    "body": "Still needs review...",
    "created_at": "2012-05-02T18:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150705",
    "user": "jdemeyer"
}
```

Still needs review...



---

archive/issue_comments_150706.json:
```json
{
    "body": "The patched version of `testcflags.sh` always produces an empty list of cflags for me. My guess is that it is due to `d` being undefined in the following block of code:\n\n```C\nunsigned long double_to_ulong() \n{ \n    return (unsigned long)d; \n}\n```\n",
    "created_at": "2012-05-25T00:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150706",
    "user": "ohanar"
}
```

The patched version of `testcflags.sh` always produces an empty list of cflags for me. My guess is that it is due to `d` being undefined in the following block of code:

```C
unsigned long double_to_ulong() 
{ 
    return (unsigned long)d; 
}
```




---

archive/issue_comments_150707.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T00:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150707",
    "user": "ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150708.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-05-25T05:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150708",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_150709.json:
```json
{
    "body": "Of course, I don't know how I missed that...\n\nFixed.",
    "created_at": "2012-05-25T05:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150709",
    "user": "jdemeyer"
}
```

Of course, I don't know how I missed that...

Fixed.



---

archive/issue_comments_150710.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-25T05:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150710",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_150711.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T05:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150711",
    "user": "ohanar"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_150712.json:
```json
{
    "body": "Ok, looks good and works well.\n\nTo note, this is not a great test for cflags. For example, clang only throws warnings to bad compiler flags, it does not error.",
    "created_at": "2012-05-25T05:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150712",
    "user": "ohanar"
}
```

Ok, looks good and works well.

To note, this is not a great test for cflags. For example, clang only throws warnings to bad compiler flags, it does not error.



---

archive/issue_comments_150713.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-25T05:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150713",
    "user": "ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_150714.json:
```json
{
    "body": "Replying to [comment:35 ohanar]:\n> For example, clang only throws warnings to bad compiler flags, it does not error.\nThat's stupid:\n\n```\nbsd:~ jdemeyer$ clang -march=foobar foo.c -c -o foo.o\n'foobar' is not a recognized processor for this target (ignoring processor)\nbsd:~ jdemeyer$ echo $?\n0\n```\n\n\nThis could mean that MPIR for example might produce very suboptimal code because it *thinks* that `-march=foo` is supported when it's not.",
    "created_at": "2012-05-26T05:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150714",
    "user": "jdemeyer"
}
```

Replying to [comment:35 ohanar]:
> For example, clang only throws warnings to bad compiler flags, it does not error.
That's stupid:

```
bsd:~ jdemeyer$ clang -march=foobar foo.c -c -o foo.o
'foobar' is not a recognized processor for this target (ignoring processor)
bsd:~ jdemeyer$ echo $?
0
```


This could mean that MPIR for example might produce very suboptimal code because it *thinks* that `-march=foo` is supported when it's not.



---

archive/issue_comments_150715.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-02T12:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12649#issuecomment-150715",
    "user": "jdemeyer"
}
```

Resolution: fixed
