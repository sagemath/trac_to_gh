# Issue 22117: Install both python 2 & 3 by default

archive/issues_022117.json:
```json
{
    "body": "As long as we don't change the python symlink this has very little potential for errors. But it'll allow us to add 2/3 regression tests, e.g. check that all sources can be compiled by python3 (though not on this ticket).\n\nIssue created by migration from https://trac.sagemath.org/ticket/22354\n\n",
    "created_at": "2017-02-11T11:16:30Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Install both python 2 & 3 by default",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22117",
    "user": "vbraun"
}
```
As long as we don't change the python symlink this has very little potential for errors. But it'll allow us to add 2/3 regression tests, e.g. check that all sources can be compiled by python3 (though not on this ticket).

Issue created by migration from https://trac.sagemath.org/ticket/22354





---

archive/issue_comments_307261.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307261",
    "user": "vbraun"
}
```

New commits:



---

archive/issue_comments_307262.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307262",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_307263.json:
```json
{
    "body": "I guess Python 3 doesn't take that long to build, but most users won't ever use it, so why make it standard? Why not make it optional instead (including the other changes here so that installing Python 3 won't break Sage)?\n\nThe variable `SAGE_PYTHON3` needs to be documented. It should have been documented before, but it was only used in the top level `configure` file. In this ticket it is starting to be used more widely, so documentation is more important.",
    "created_at": "2017-02-14T19:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307263",
    "user": "jhpalmieri"
}
```

I guess Python 3 doesn't take that long to build, but most users won't ever use it, so why make it standard? Why not make it optional instead (including the other changes here so that installing Python 3 won't break Sage)?

The variable `SAGE_PYTHON3` needs to be documented. It should have been documented before, but it was only used in the top level `configure` file. In this ticket it is starting to be used more widely, so documentation is more important.



---

archive/issue_comments_307264.json:
```json
{
    "body": "Hopefully most users WILL use Python 3 in the future ;-)\n\nThe advantage of having it by default is that we can use it for regression testing so that the part that already works with Python 3 will keep working during the transition period: #22357",
    "created_at": "2017-02-14T20:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307264",
    "user": "vbraun"
}
```

Hopefully most users WILL use Python 3 in the future ;-)

The advantage of having it by default is that we can use it for regression testing so that the part that already works with Python 3 will keep working during the transition period: #22357



---

archive/issue_comments_307265.json:
```json
{
    "body": "Some time ago, at least one person did not want that SAGE_PYTHON3 get documented : #20912.",
    "created_at": "2017-02-14T20:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307265",
    "user": "chapoton"
}
```

Some time ago, at least one person did not want that SAGE_PYTHON3 get documented : #20912.



---

archive/issue_comments_307266.json:
```json
{
    "body": "For the documentation, how about something like this:\n\n```diff\ndiff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst\nindex 1539260..d265cab 100644\n--- a/src/doc/en/installation/source.rst\n+++ b/src/doc/en/installation/source.rst\n@@ -1121,6 +1121,19 @@ Here are some of the more commonly used variables affecting the build process:\n   supports :envvar:`SAGE_SUDO`, into a root-owned installation\n   hierarchy (:envvar:`SAGE_LOCAL`).\n \n+- :envvar:`SAGE_PYTHON3` - set this to ``yes`` to build Sage using\n+  Python 3 rather than Python 2.\n+\n+  .. WARNING::\n+\n+     This will probably break your Sage installation!\n+\n+  .. WARNING::\n+\n+     This environment variable may not be supported in future versions\n+     of Sage; it may be replaced by (for example) ``configure``\n+     options.\n+\n Variables to set if you're trying to build Sage with an unusual setup, e.g.,\n an unsupported machine or an unusual compiler:\n \n```\n",
    "created_at": "2017-02-14T20:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307266",
    "user": "jhpalmieri"
}
```

For the documentation, how about something like this:

```diff
diff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst
index 1539260..d265cab 100644
--- a/src/doc/en/installation/source.rst
+++ b/src/doc/en/installation/source.rst
@@ -1121,6 +1121,19 @@ Here are some of the more commonly used variables affecting the build process:
   supports :envvar:`SAGE_SUDO`, into a root-owned installation
   hierarchy (:envvar:`SAGE_LOCAL`).
 
+- :envvar:`SAGE_PYTHON3` - set this to ``yes`` to build Sage using
+  Python 3 rather than Python 2.
+
+  .. WARNING::
+
+     This will probably break your Sage installation!
+
+  .. WARNING::
+
+     This environment variable may not be supported in future versions
+     of Sage; it may be replaced by (for example) ``configure``
+     options.
+
 Variables to set if you're trying to build Sage with an unusual setup, e.g.,
 an unsupported machine or an unusual compiler:
 
```




---

archive/issue_comments_307267.json:
```json
{
    "body": "Fine with me; I'd be less hesitant in saying that it will definitely be removed in 2020 together with python 2 ;-)",
    "created_at": "2017-02-15T07:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307267",
    "user": "vbraun"
}
```

Fine with me; I'd be less hesitant in saying that it will definitely be removed in 2020 together with python 2 ;-)



---

archive/issue_comments_307268.json:
```json
{
    "body": "Okay, I've added the documentation to the branch. I'm okay with the rest of it.\n----\nNew commits:",
    "created_at": "2017-02-15T18:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307268",
    "user": "jhpalmieri"
}
```

Okay, I've added the documentation to the branch. I'm okay with the rest of it.
----
New commits:



---

archive/issue_comments_307269.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-17T20:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307269",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_307270.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-21T14:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307270",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_307271.json:
```json
{
    "body": "This broke building with `SAGE_PYTHON3=yes`: #22638.",
    "created_at": "2017-03-18T14:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307271",
    "user": "jdemeyer"
}
```

This broke building with `SAGE_PYTHON3=yes`: #22638.



---

archive/issue_comments_307272.json:
```json
{
    "body": "See #22756 for a followup: Python3 seems to be broken on OS X.",
    "created_at": "2017-04-04T21:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307272",
    "user": "jhpalmieri"
}
```

See #22756 for a followup: Python3 seems to be broken on OS X.



---

archive/issue_comments_307273.json:
```json
{
    "body": "See #22770 for an easy to review followup to this ticket: this ticket introduced an error in the functools32 spkg-install script, fixed at #22770.",
    "created_at": "2017-04-06T16:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22117",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22117#issuecomment-307273",
    "user": "jhpalmieri"
}
```

See #22770 for an easy to review followup to this ticket: this ticket introduced an error in the functools32 spkg-install script, fixed at #22770.
