# Issue 21441: Testsuite for src/setup.py

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-10-10 19:48:56

CC:  jdemeyer embray vbraun

We should have a testsuite that tests the correct operation and interaction of various commands that a distutils-based `setup.py` should support.

Does something like this exist in the Python world already?


---

Comment by vbraun created at 2016-10-10 21:07:35

Not that I know of; Usually you realize pretty quickly that you can't install your project.

Any non-trivial functionality of setup.py should be implemented in the sage_setup library which can be unit tested in the usual way.


---

Comment by mkoeppe created at 2016-10-10 21:38:04

Replying to [comment:1 vbraun]:
> Not that I know of; Usually you realize pretty quickly that you can't install your project.
> 
> Any non-trivial functionality of setup.py should be implemented in the sage_setup library which can be unit tested in the usual way.

Yes, but I am thinking of higher-level tests, for example to ensure that making an sdist and then unpacking-building-cleaning succeeds and gives a tree that is the same as in the sdist archive. This is currently not tested at all and broken (#21516).


---

Comment by embray created at 2016-10-11 12:24:10

That's not a bad idea.  astropy-helper has a number of functional tests to this effect: https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers/tests

They're specifically geared toward testing the code in astropy-helpers itself, but this tests a lot of the other expected outputs of `setup.py` in the process.


---

Comment by mkoeppe created at 2016-10-25 18:55:53

Ticket #21516 (Fix sagelib sdist) now has a test (sdistcheck) but it currently fails.


---

Comment by jdemeyer created at 2017-04-01 12:18:08

Just a pointer: I implemented a pretty extensive installation test suite for `cysignals`. It tests installation with `--prefix`, `--root` and `--user`. It tests `setup.py sdist` and tests `distclean`.

See https://github.com/sagemath/cysignals/blob/master/Makefile#L71 and following.


---

Comment by mkoeppe created at 2020-05-01 18:16:15

Moving some tickets to 9.2. This is not a promise that I will be working on them.


---

Comment by mkoeppe created at 2020-06-28 23:15:21

As of #29950, we test it with tox.
