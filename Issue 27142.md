# Issue 27142: Speed up coercions

Issue created by migration from https://trac.sagemath.org/ticket/27379

Original creator: mmezzarobba

Original creation time: 2019-02-27 18:02:32

- Don't call `_repr_()` on the parents every time a coercion or conversion fails. (One could consider making `Parent.__repr__()` keep the name in cache instead, but we probably don't want that for things like finite fields, and in any case `__repr__()` is handled by `SageObject` at the moment.)
- Add a fast path for trivial coercions.

Before:

```
sage: R.<x,y,z> = ZZ[]
sage: a = GF(3)(2)
sage: %timeit x(a,a,a)
The slowest run took 37.44 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 13.1 µs per loop
```

After:

```
sage: R.<x,y,z> = ZZ[]
sage: a = GF(3)(2)
sage: %timeit x(a,a,a)
The slowest run took 162.14 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.98 µs per loop
```



---

Comment by mmezzarobba created at 2019-02-27 18:03:22

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-02-27 23:15:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-02-27 23:15:38

LGTM.

I do not think we want to cache the result of `Parent.__repr__` because that is designed so you can dynamically change the repr of the object via `foo.rename('bar')`.


---

Comment by mmezzarobba created at 2019-02-28 08:42:06

Replying to [comment:2 tscrim]:
> LGTM.

Thank you!

> I do not think we want to cache the result of `Parent.__repr__` because that is designed so you can dynamically change the repr of the object via `foo.rename('bar')`.

Yes, that's an additional reason, though one could imagine making `rename()` update the cache.


---

Comment by vbraun created at 2019-03-02 09:38:23

Resolution: fixed
