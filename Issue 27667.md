# Issue 27667: py3: fix last doctest in interfaces

archive/issues_027667.json:
```json
{
    "body": "CC:  tscrim jhpalmieri fbissey\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27904\n\n",
    "created_at": "2019-05-31T13:56:05Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: fix last doctest in interfaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27667",
    "user": "chapoton"
}
```
CC:  tscrim jhpalmieri fbissey



Issue created by migration from https://trac.sagemath.org/ticket/27904





---

archive/issue_comments_390599.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-31T14:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390599",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390600.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-31T14:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390600",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_390601.json:
```json
{
    "body": "green bot, please review this simple change",
    "created_at": "2019-05-31T19:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390601",
    "user": "chapoton"
}
```

green bot, please review this simple change



---

archive/issue_comments_390602.json:
```json
{
    "body": "This fixes one doctest in interfaces, but not the last one, at least not for me. I still see\n\n```\nsage -t src/sage/interfaces/expect.py\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 769, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular._eval_line_using_file('def a=3;', restart_if_needed=False)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Singular terminated unexpectedly while reading in a large line...\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 921, in _eval_line\n        E.sendline(line)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 577, in sendline\n        return self.send(s + self.linesep)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 568, in send\n        return os.write(self.child_fd, b)\n    OSError: [Errno 5] Input/output error\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 791, in _eval_line_using_file\n        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 945, in _eval_line\n        raise_(RuntimeError, RuntimeError(\"%s\\nError evaluating %s in %s\" % (msg, line, self)), sys.exc_info()[2])\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py\", line 692, in reraise\n        raise value.with_traceback(tb)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 921, in _eval_line\n        E.sendline(line)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 577, in sendline\n        return self.send(s + self.linesep)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 568, in send\n        return os.write(self.child_fd, b)\n    RuntimeError: [Errno 5] Input/output error\n    Error evaluating < \"/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50259\"; in Singular\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[6]>\", line 1, in <module>\n        singular._eval_line_using_file('def a=3;', restart_if_needed=False)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 818, in _eval_line_using_file\n        if \"Input/output error\" in msg[0]:  # This occurs on non-linux machines\n    TypeError: 'RuntimeError' object is not subscriptable\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 899, in sage.interfaces.expect.Expect._eval_line\nFailed example:\n    singular._eval_line_using_file('def a=3;', restart_if_needed=False)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Singular terminated unexpectedly while reading in a large line...\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 921, in _eval_line\n        E.sendline(line)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 577, in sendline\n        return self.send(s + self.linesep)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 568, in send\n        return os.write(self.child_fd, b)\n    OSError: [Errno 5] Input/output error\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 791, in _eval_line_using_file\n        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 945, in _eval_line\n        raise_(RuntimeError, RuntimeError(\"%s\\nError evaluating %s in %s\" % (msg, line, self)), sys.exc_info()[2])\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py\", line 692, in reraise\n        raise value.with_traceback(tb)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 921, in _eval_line\n        E.sendline(line)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 577, in sendline\n        return self.send(s + self.linesep)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py\", line 568, in send\n        return os.write(self.child_fd, b)\n    RuntimeError: [Errno 5] Input/output error\n    Error evaluating < \"/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50265\"; in Singular\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line[13]>\", line 1, in <module>\n        singular._eval_line_using_file('def a=3;', restart_if_needed=False)\n      File \"/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py\", line 818, in _eval_line_using_file\n        if \"Input/output error\" in msg[0]:  # This occurs on non-linux machines\n    TypeError: 'RuntimeError' object is not subscriptable\n**********************************************************************\n2 items had failures:\n   1 of  16 in sage.interfaces.expect.Expect._eval_line\n   1 of   9 in sage.interfaces.expect.Expect._eval_line_using_file\n    [101 tests, 2 failures, 3.35 s]\n----------------------------------------------------------------------\nsage -t src/sage/interfaces/expect.py  # 2 doctests failed\n```\n",
    "created_at": "2019-05-31T19:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390602",
    "user": "jhpalmieri"
}
```

This fixes one doctest in interfaces, but not the last one, at least not for me. I still see

```
sage -t src/sage/interfaces/expect.py
**********************************************************************
File "src/sage/interfaces/expect.py", line 769, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular._eval_line_using_file('def a=3;', restart_if_needed=False)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Singular terminated unexpectedly while reading in a large line...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    OSError: [Errno 5] Input/output error
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 791, in _eval_line_using_file
        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 945, in _eval_line
        raise_(RuntimeError, RuntimeError("%s\nError evaluating %s in %s" % (msg, line, self)), sys.exc_info()[2])
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py", line 692, in reraise
        raise value.with_traceback(tb)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    RuntimeError: [Errno 5] Input/output error
    Error evaluating < "/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50259"; in Singular
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[6]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;', restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line_using_file
        if "Input/output error" in msg[0]:  # This occurs on non-linux machines
    TypeError: 'RuntimeError' object is not subscriptable
**********************************************************************
File "src/sage/interfaces/expect.py", line 899, in sage.interfaces.expect.Expect._eval_line
Failed example:
    singular._eval_line_using_file('def a=3;', restart_if_needed=False)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Singular terminated unexpectedly while reading in a large line...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    OSError: [Errno 5] Input/output error
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 791, in _eval_line_using_file
        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 945, in _eval_line
        raise_(RuntimeError, RuntimeError("%s\nError evaluating %s in %s" % (msg, line, self)), sys.exc_info()[2])
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py", line 692, in reraise
        raise value.with_traceback(tb)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    RuntimeError: [Errno 5] Input/output error
    Error evaluating < "/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50265"; in Singular
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line[13]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;', restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line_using_file
        if "Input/output error" in msg[0]:  # This occurs on non-linux machines
    TypeError: 'RuntimeError' object is not subscriptable
**********************************************************************
2 items had failures:
   1 of  16 in sage.interfaces.expect.Expect._eval_line
   1 of   9 in sage.interfaces.expect.Expect._eval_line_using_file
    [101 tests, 2 failures, 3.35 s]
----------------------------------------------------------------------
sage -t src/sage/interfaces/expect.py  # 2 doctests failed
```




---

archive/issue_comments_390603.json:
```json
{
    "body": "One needs to replace `msg[0]` by `msg.args[0]`. Let me do that.",
    "created_at": "2019-05-31T19:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390603",
    "user": "chapoton"
}
```

One needs to replace `msg[0]` by `msg.args[0]`. Let me do that.



---

archive/issue_comments_390604.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-31T19:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390604",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390605.json:
```json
{
    "body": "works for me. Please check if it works for you.",
    "created_at": "2019-05-31T19:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390605",
    "user": "chapoton"
}
```

works for me. Please check if it works for you.



---

archive/issue_comments_390606.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-31T20:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390606",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390607.json:
```json
{
    "body": "Thank you, works with Python 2 and 3.",
    "created_at": "2019-05-31T20:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390607",
    "user": "jhpalmieri"
}
```

Thank you, works with Python 2 and 3.



---

archive/issue_comments_390608.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-05T18:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27667#issuecomment-390608",
    "user": "vbraun"
}
```

Resolution: fixed
