# Issue 27667: py3: fix last doctest in interfaces

Issue created by migration from https://trac.sagemath.org/ticket/27904

Original creator: chapoton

Original creation time: 2019-05-31 13:56:05

CC:  tscrim jhpalmieri fbissey




---

Comment by chapoton created at 2019-05-31 14:52:53

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-05-31 14:52:53

New commits:


---

Comment by chapoton created at 2019-05-31 19:40:06

green bot, please review this simple change


---

Comment by jhpalmieri created at 2019-05-31 19:42:27

This fixes one doctest in interfaces, but not the last one, at least not for me. I still see

```
sage -t src/sage/interfaces/expect.py
**********************************************************************
File "src/sage/interfaces/expect.py", line 769, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular._eval_line_using_file('def a=3;', restart_if_needed=False)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Singular terminated unexpectedly while reading in a large line...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    OSError: [Errno 5] Input/output error
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 791, in _eval_line_using_file
        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 945, in _eval_line
        raise_(RuntimeError, RuntimeError("%s\nError evaluating %s in %s" % (msg, line, self)), sys.exc_info()[2])
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py", line 692, in reraise
        raise value.with_traceback(tb)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    RuntimeError: [Errno 5] Input/output error
    Error evaluating < "/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50259"; in Singular
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[6]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;', restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line_using_file
        if "Input/output error" in msg[0]:  # This occurs on non-linux machines
    TypeError: 'RuntimeError' object is not subscriptable
**********************************************************************
File "src/sage/interfaces/expect.py", line 899, in sage.interfaces.expect.Expect._eval_line
Failed example:
    singular._eval_line_using_file('def a=3;', restart_if_needed=False)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Singular terminated unexpectedly while reading in a large line...
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    OSError: [Errno 5] Input/output error
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 791, in _eval_line_using_file
        s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False, restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 945, in _eval_line
        raise_(RuntimeError, RuntimeError("%s\nError evaluating %s in %s" % (msg, line, self)), sys.exc_info()[2])
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/six.py", line 692, in reraise
        raise value.with_traceback(tb)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 921, in _eval_line
        E.sendline(line)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 577, in sendline
        return self.send(s + self.linesep)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/pexpect/pty_spawn.py", line 568, in send
        return os.write(self.child_fd, b)
    RuntimeError: [Errno 5] Input/output error
    Error evaluating < "/Users/jpalmier/.sage/temp/D-172-25-224-210.dhcp4.washington.edu/50145/interface/tmp50265"; in Singular
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line[13]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;', restart_if_needed=False)
      File "/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.8.beta7/local/lib/python3.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line_using_file
        if "Input/output error" in msg[0]:  # This occurs on non-linux machines
    TypeError: 'RuntimeError' object is not subscriptable
**********************************************************************
2 items had failures:
   1 of  16 in sage.interfaces.expect.Expect._eval_line
   1 of   9 in sage.interfaces.expect.Expect._eval_line_using_file
    [101 tests, 2 failures, 3.35 s]
----------------------------------------------------------------------
sage -t src/sage/interfaces/expect.py  # 2 doctests failed
```



---

Comment by chapoton created at 2019-05-31 19:46:06

One needs to replace `msg[0]` by `msg.args[0]`. Let me do that.


---

Comment by git created at 2019-05-31 19:50:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-05-31 19:52:05

works for me. Please check if it works for you.


---

Comment by jhpalmieri created at 2019-05-31 20:29:34

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2019-05-31 20:29:34

Thank you, works with Python 2 and 3.


---

Comment by vbraun created at 2019-06-05 18:30:53

Resolution: fixed
