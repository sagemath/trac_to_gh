# Issue 10536: sage -fixdoctests doesn't work correctly

archive/issues_010536.json:
```json
{
    "body": "Assignee: mvngu\n\nTo reproduce this remove all but the first test result from the patch at: #10568\n\n\n```\nmaarten-derickxs-macbook-pro:sage maarten$ sage -t matrix/matrix_sparse.pyx\nsage -t  \"devel/sage-main/sage/matrix/matrix_sparse.pyx\"    \n**********************************************************************\nFile \"/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx\", line 301:\n    sage: (2/3)*M\nExpected nothing\nGot:\n    [   0  2/3  4/3    2  8/3 10/3]\n    [   4 14/3 16/3    6 20/3 22/3]\n    [   8 26/3 28/3   10 32/3 34/3]\n**********************************************************************\nFile \"/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx\", line 302:\n    sage: 7*M\nExpected nothing\nGot:\n    [  0   7  14  21  28  35]\n    [ 42  49  56  63  70  77]\n    [ 84  91  98 105 112 119]\n**********************************************************************\nFile \"/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx\", line 303:\n    sage: (1/4)*M\nExpected nothing\nGot:\n    [   0  1/4  1/2  3/4    1  5/4]\n    [ 3/2  7/4    2  9/4  5/2 11/4]\n    [   3 13/4  7/2 15/4    4 17/4]\n**********************************************************************\nFile \"/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx\", line 306:\n    sage: m==(97/42)*(42/97*m)\nExpected nothing\nGot:\n    True\n**********************************************************************\n1 items had failures:\n   4 of   9 in __main__.example_6\n***Test Failed*** 4 failures.\nFor whitespace errors, see the file /Users/maarten/.sage//tmp/.doctest_matrix_sparse.py\n\t [12.5 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage-main/sage/matrix/matrix_sparse.pyx\"\nTotal time for all tests: 12.6 seconds\nmaarten-derickxs-macbook-pro:sage maarten$ sage -fixdoctests matrix/matrix_sparse.pyx\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10589\n\n",
    "created_at": "2011-01-11T12:00:50Z",
    "labels": [
        "doctest",
        "minor",
        "bug"
    ],
    "title": "sage -fixdoctests doesn't work correctly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10536",
    "user": "mderickx"
}
```
Assignee: mvngu

To reproduce this remove all but the first test result from the patch at: #10568


```
maarten-derickxs-macbook-pro:sage maarten$ sage -t matrix/matrix_sparse.pyx
sage -t  "devel/sage-main/sage/matrix/matrix_sparse.pyx"    
**********************************************************************
File "/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx", line 301:
    sage: (2/3)*M
Expected nothing
Got:
    [   0  2/3  4/3    2  8/3 10/3]
    [   4 14/3 16/3    6 20/3 22/3]
    [   8 26/3 28/3   10 32/3 34/3]
**********************************************************************
File "/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx", line 302:
    sage: 7*M
Expected nothing
Got:
    [  0   7  14  21  28  35]
    [ 42  49  56  63  70  77]
    [ 84  91  98 105 112 119]
**********************************************************************
File "/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx", line 303:
    sage: (1/4)*M
Expected nothing
Got:
    [   0  1/4  1/2  3/4    1  5/4]
    [ 3/2  7/4    2  9/4  5/2 11/4]
    [   3 13/4  7/2 15/4    4 17/4]
**********************************************************************
File "/Applications/sage-4.6.rc0/devel/sage-main/sage/matrix/matrix_sparse.pyx", line 306:
    sage: m==(97/42)*(42/97*m)
Expected nothing
Got:
    True
**********************************************************************
1 items had failures:
   4 of   9 in __main__.example_6
***Test Failed*** 4 failures.
For whitespace errors, see the file /Users/maarten/.sage//tmp/.doctest_matrix_sparse.py
	 [12.5 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage-main/sage/matrix/matrix_sparse.pyx"
Total time for all tests: 12.6 seconds
maarten-derickxs-macbook-pro:sage maarten$ sage -fixdoctests matrix/matrix_sparse.pyx
```


Issue created by migration from https://trac.sagemath.org/ticket/10589





---

archive/issue_comments_110014.json:
```json
{
    "body": "Changing keywords from \"\" to \"sage45\".",
    "created_at": "2013-02-14T23:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110014",
    "user": "andrew.mathas"
}
```

Changing keywords from "" to "sage45".



---

archive/issue_comments_110015.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-14T23:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110015",
    "user": "andrew.mathas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110016.json:
```json
{
    "body": "To doctest this, you could add some tests to `devel/sage/sage/tests/cmdline.py`",
    "created_at": "2013-02-18T02:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110016",
    "user": "jhpalmieri"
}
```

To doctest this, you could add some tests to `devel/sage/sage/tests/cmdline.py`



---

archive/issue_comments_110017.json:
```json
{
    "body": "Changing keywords from \"sage45\" to \"days45\".",
    "created_at": "2013-02-18T02:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110017",
    "user": "andrew.mathas"
}
```

Changing keywords from "sage45" to "days45".



---

archive/issue_comments_110018.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> To doctest this, you could add some tests to `devel/sage/sage/tests/cmdline.py`\n\nThanks John. I will have a look at this and **add some tests**.",
    "created_at": "2013-02-18T23:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110018",
    "user": "andrew.mathas"
}
```

Replying to [comment:6 jhpalmieri]:
> To doctest this, you could add some tests to `devel/sage/sage/tests/cmdline.py`

Thanks John. I will have a look at this and **add some tests**.



---

archive/issue_comments_110019.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-02-25T04:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110019",
    "user": "andrew.mathas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_110020.json:
```json
{
    "body": "Changing component from doctest to doctest framework.",
    "created_at": "2013-03-28T23:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110020",
    "user": "roed"
}
```

Changing component from doctest to doctest framework.



---

archive/issue_comments_110021.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-02T00:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110021",
    "user": "andrew.mathas"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110022.json:
```json
{
    "body": "Updated fixdoctests patch so that it works with the new doctest framework in #12415 and added some tests to sage/tests/cmdline.py for the script",
    "created_at": "2013-05-02T00:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110022",
    "user": "andrew.mathas"
}
```

Updated fixdoctests patch so that it works with the new doctest framework in #12415 and added some tests to sage/tests/cmdline.py for the script



---

archive/issue_comments_110023.json:
```json
{
    "body": "Shouldn't that be the scripts repo?",
    "created_at": "2013-05-07T01:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110023",
    "user": "roed"
}
```

Shouldn't that be the scripts repo?



---

archive/issue_comments_110024.json:
```json
{
    "body": "Replying to [comment:17 roed]:\n> Shouldn't that be the scripts repo?\n\nYes, thanks. Wasn't sure what the right name was, just knew where to find it...",
    "created_at": "2013-05-07T01:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110024",
    "user": "andrew.mathas"
}
```

Replying to [comment:17 roed]:
> Shouldn't that be the scripts repo?

Yes, thanks. Wasn't sure what the right name was, just knew where to find it...



---

archive/issue_comments_110025.json:
```json
{
    "body": "Changing component from doctest framework to scripts.",
    "created_at": "2013-05-17T13:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110025",
    "user": "jdemeyer"
}
```

Changing component from doctest framework to scripts.



---

archive/issue_comments_110026.json:
```json
{
    "body": "I used the patch here to solve problems I was getting with `sage -fixdoctests`. Thanks, hope this can get reviewed and merged soon!",
    "created_at": "2013-06-14T06:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110026",
    "user": "benjaminfjones"
}
```

I used the patch here to solve problems I was getting with `sage -fixdoctests`. Thanks, hope this can get reviewed and merged soon!



---

archive/issue_comments_110027.json:
```json
{
    "body": "Looks good to me minus two minors thing:\n\n- you're missing the `::` on line 405 in `tests/cmdline.py`,\n- could you de-indent the `AUTHORS:` block in `sage-fixdoctests` and align the extra text by 2 spaces.\n\nThanks Andrew.",
    "created_at": "2013-09-16T15:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110027",
    "user": "tscrim"
}
```

Looks good to me minus two minors thing:

- you're missing the `::` on line 405 in `tests/cmdline.py`,
- could you de-indent the `AUTHORS:` block in `sage-fixdoctests` and align the extra text by 2 spaces.

Thanks Andrew.



---

archive/issue_comments_110028.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> Looks good to me minus two minors thing:\n> \n> - you're missing the `::` on line 405 in `tests/cmdline.py`,\n> - could you de-indent the `AUTHORS:` block in `sage-fixdoctests` and align the extra text by 2 spaces.\n> \n\nThanks Travis, I have fixed both of these.\n\nAndrew",
    "created_at": "2013-09-17T21:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110028",
    "user": "andrew.mathas"
}
```

Replying to [comment:23 tscrim]:
> Looks good to me minus two minors thing:
> 
> - you're missing the `::` on line 405 in `tests/cmdline.py`,
> - could you de-indent the `AUTHORS:` block in `sage-fixdoctests` and align the extra text by 2 spaces.
> 

Thanks Travis, I have fixed both of these.

Andrew



---

archive/issue_comments_110029.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-17T21:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110029",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110030.json:
```json
{
    "body": "Then it's a positive review. Thanks Andrew.",
    "created_at": "2013-09-17T21:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110030",
    "user": "tscrim"
}
```

Then it's a positive review. Thanks Andrew.



---

archive/issue_comments_110031.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-09-27T10:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110031",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110032.json:
```json
{
    "body": "The file [attachment:trac_10589--fixdoctest_failures-am.patch] contains garbage at the start, please fix that.",
    "created_at": "2013-09-27T10:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110032",
    "user": "jdemeyer"
}
```

The file [attachment:trac_10589--fixdoctest_failures-am.patch] contains garbage at the start, please fix that.



---

archive/issue_comments_110033.json:
```json
{
    "body": "Replying to [comment:26 jdemeyer]:\n> The file [attachment:trac_10589--fixdoctest_failures-am.patch] contains garbage at the start, please fix that.\n\nSorry. Fixed.",
    "created_at": "2013-09-27T11:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110033",
    "user": "andrew.mathas"
}
```

Replying to [comment:26 jdemeyer]:
> The file [attachment:trac_10589--fixdoctest_failures-am.patch] contains garbage at the start, please fix that.

Sorry. Fixed.



---

archive/issue_comments_110034.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-09-27T11:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110034",
    "user": "andrew.mathas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110035.json:
```json
{
    "body": "I get\n\n```\nsage -t --long devel/sage/sage/tests/cmdline.py\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 414, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    1\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 418, in sage.tests.cmdline.test_executable\nFailed example:\n    print output[output.find('     SAGE: 1+1'):output.find(' \\\"\\\"\\\"')-1]\nExpected:\n         SAGE: 1+1              # incorrect output\n    -    3\n    +    2\n         SAGE: m=matrix(ZZ,3)   # output when none is expected\n    +    SAGE: (2/3)*m          # no output when it is expected\n    +    [0 0 0]\n         [0 0 0]\n         [0 0 0]\n    -    [1 0 0]\n    -    SAGE: (2/3)*m          # no output when it is expected\n         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected\n    -    [4, 4, 3, 3, 2, 1, 1]\n         SAGE: mu.pp()          # uneven indentation\n    -    ****\n    -    ****\n    +       ****   ***   *\n    +       ****   ***   *\n    +              **\n    +              *\n         SAGE: PartitionTuples.global_options(convention=\"French\")\n         SAGE: mu.pp()         # fix doctest with uneven indentation\n    +    *\n    +    **\n    +    ****   ***   *\n    +    ****   ***   *\n         SAGE: PartitionTuples.global_options.reset()\nGot:\n    <BLANKLINE>\n**********************************************************************\n```\n",
    "created_at": "2013-09-27T16:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110035",
    "user": "jdemeyer"
}
```

I get

```
sage -t --long devel/sage/sage/tests/cmdline.py
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 414, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    1
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 418, in sage.tests.cmdline.test_executable
Failed example:
    print output[output.find('     SAGE: 1+1'):output.find(' \"\"\"')-1]
Expected:
         SAGE: 1+1              # incorrect output
    -    3
    +    2
         SAGE: m=matrix(ZZ,3)   # output when none is expected
    +    SAGE: (2/3)*m          # no output when it is expected
    +    [0 0 0]
         [0 0 0]
         [0 0 0]
    -    [1 0 0]
    -    SAGE: (2/3)*m          # no output when it is expected
         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected
    -    [4, 4, 3, 3, 2, 1, 1]
         SAGE: mu.pp()          # uneven indentation
    -    ****
    -    ****
    +       ****   ***   *
    +       ****   ***   *
    +              **
    +              *
         SAGE: PartitionTuples.global_options(convention="French")
         SAGE: mu.pp()         # fix doctest with uneven indentation
    +    *
    +    **
    +    ****   ***   *
    +    ****   ***   *
         SAGE: PartitionTuples.global_options.reset()
Got:
    <BLANKLINE>
**********************************************************************
```




---

archive/issue_comments_110036.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-09-27T16:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110036",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110037.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> I get\n> {{{\n> sage -t --long devel/sage/sage/tests/cmdline.py\n> **********************************************************************\n> File \"devel/sage/sage/tests/cmdline.py\", line 414, in sage.tests.cmdline.test_executable\n> Failed example:\n>    \n>  ...\n\nHi Jeroen, \n\nI am fairly sure that this failure is because the patch in the scripts directory has not been applied - at least, I get this error if the patch trac_10589--fixdoctest_failures-am.patch has not been applied to the scripts repository and I do not get it when it is applied.\n\nCan you please confirm that both patches have been applied correctly. I'm putting the status back to positive review as I am not sure if you will read this otherwise.\n\nAndrew",
    "created_at": "2013-09-28T06:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110037",
    "user": "andrew.mathas"
}
```

Replying to [comment:29 jdemeyer]:
> I get
> {{{
> sage -t --long devel/sage/sage/tests/cmdline.py
> **********************************************************************
> File "devel/sage/sage/tests/cmdline.py", line 414, in sage.tests.cmdline.test_executable
> Failed example:
>    
>  ...

Hi Jeroen, 

I am fairly sure that this failure is because the patch in the scripts directory has not been applied - at least, I get this error if the patch trac_10589--fixdoctest_failures-am.patch has not been applied to the scripts repository and I do not get it when it is applied.

Can you please confirm that both patches have been applied correctly. I'm putting the status back to positive review as I am not sure if you will read this otherwise.

Andrew



---

archive/issue_comments_110038.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-09-28T06:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110038",
    "user": "andrew.mathas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110039.json:
```json
{
    "body": "I'm pretty sure I did apply both patches, but I'll try again...",
    "created_at": "2013-09-29T16:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110039",
    "user": "jdemeyer"
}
```

I'm pretty sure I did apply both patches, but I'll try again...



---

archive/issue_comments_110040.json:
```json
{
    "body": "After adding a doctest line\n\n```\nsage: print err\n```\n\n(which I guess all `cmdline.py` tests *should* have):\n\n```\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 416, in sage.tests.cmdline.test_executable\nFailed example:\n    print err\nExpected nothing\nGot:\n    sh: cannot create .tmp: Permission denied\n    Traceback (most recent call last):\n      File \"/scratch/release/merger/sage-5.13.beta0/local/bin/sage-fixdoctests\", line 35, in <module>\n        doc_out = open(doc_out).read()\n    IOError: [Errno 2] No such file or directory: '.tmp'\n    <BLANKLINE>\n**********************************************************************\n```\n\n\nSo the problem is that `sage -fixdoctests` writes to the current working directory, which isn't guaranteed to be writable.\n\nAlso: please use `--fixdoctests` everywhere.",
    "created_at": "2013-09-30T06:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110040",
    "user": "jdemeyer"
}
```

After adding a doctest line

```
sage: print err
```

(which I guess all `cmdline.py` tests *should* have):

```
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 416, in sage.tests.cmdline.test_executable
Failed example:
    print err
Expected nothing
Got:
    sh: cannot create .tmp: Permission denied
    Traceback (most recent call last):
      File "/scratch/release/merger/sage-5.13.beta0/local/bin/sage-fixdoctests", line 35, in <module>
        doc_out = open(doc_out).read()
    IOError: [Errno 2] No such file or directory: '.tmp'
    <BLANKLINE>
**********************************************************************
```


So the problem is that `sage -fixdoctests` writes to the current working directory, which isn't guaranteed to be writable.

Also: please use `--fixdoctests` everywhere.



---

archive/issue_comments_110041.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-09-30T06:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110041",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110042.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-09-30T07:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110042",
    "user": "andrew.mathas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110043.json:
```json
{
    "body": "Thanks for identifying the problem Jeroen as I couldn't see this the way I was testing it. I've fixed both of these points.\nAndrew",
    "created_at": "2013-09-30T07:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110043",
    "user": "andrew.mathas"
}
```

Thanks for identifying the problem Jeroen as I couldn't see this the way I was testing it. I've fixed both of these points.
Andrew



---

archive/issue_comments_110044.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-09-30T07:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110044",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110045.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-30T07:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110045",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110046.json:
```json
{
    "body": "I think these changes should be reviewed. Travis, can you do that?",
    "created_at": "2013-09-30T07:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110046",
    "user": "jdemeyer"
}
```

I think these changes should be reviewed. Travis, can you do that?



---

archive/issue_comments_110047.json:
```json
{
    "body": "Replying to [comment:37 jdemeyer]:\n> I think these changes should be reviewed. Travis, can you do that?\n\n\nHi Travis, \n\nFYI, the trivial changes made were:\n* in `trac_10589--doctests_for_fixdoctests-am.patch\u200b` two instances of ``-fixdoctests`` were changes to ``--fixdoctests`` and and ``print ret`` was changed to ``print err``\n* in `trac_10589--fixdoctest_failures-am.patch` the output is sent to ``doc_out=tmp_dir()+'.tmp'`` rather than just ``.tmp``, which required a new import statement (this was an error in the original `sage-fixdoctests` which wasn't picked up when it was first added to sage...).\n\nAndrew",
    "created_at": "2013-09-30T09:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110047",
    "user": "andrew.mathas"
}
```

Replying to [comment:37 jdemeyer]:
> I think these changes should be reviewed. Travis, can you do that?


Hi Travis, 

FYI, the trivial changes made were:
* in `trac_10589--doctests_for_fixdoctests-am.patch​` two instances of ``-fixdoctests`` were changes to ``--fixdoctests`` and and ``print ret`` was changed to ``print err``
* in `trac_10589--fixdoctest_failures-am.patch` the output is sent to ``doc_out=tmp_dir()+'.tmp'`` rather than just ``.tmp``, which required a new import statement (this was an error in the original `sage-fixdoctests` which wasn't picked up when it was first added to sage...).

Andrew



---

archive/issue_comments_110048.json:
```json
{
    "body": "Hey Andrew,\n\nIs there some way we could make this behave better when we don't have write permissions to a given directory, such as output query the user or just output to the console?\n\nHey Jeroen,\n\nThanks for noticing that, I never would have thought to check write permissions of the current directory.\n\nBest,\n\nTravis",
    "created_at": "2013-09-30T16:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110048",
    "user": "tscrim"
}
```

Hey Andrew,

Is there some way we could make this behave better when we don't have write permissions to a given directory, such as output query the user or just output to the console?

Hey Jeroen,

Thanks for noticing that, I never would have thought to check write permissions of the current directory.

Best,

Travis



---

archive/issue_comments_110049.json:
```json
{
    "body": "Replying to [comment:39 tscrim]:\n> Hey Andrew,\n> \n> Is there some way we could make this behave better when we don't have write permissions to a given directory, such as output query the user or just output to the console?\n\nHi Travis,\n\nThis already happens. The problem that Jeroen found concerns a tempory file which the sage-fixdoctests script uses to dump the current state of the doc-tests. This file is now written to sage's ``tmp_dir()`` which is always writable.\n\nThe only other file that sage-fixdoctests writes is the replacement source file. By default this is put in the same directory as the original source, however, the user can supply an optional argument to have the file written elsewhere:\n\n```\nUsage: sage -fixdoctests <source file> [doctest output]\nCreates a file <source file>.out that passes the doctests (modulo any raised exceptions)\n```\n\n\nHaving said this, I just chcked and this optional argument is not mentioned under ``sage -advanced``, so probably I should add it there. I could also make the script more user friendy and have it remind the user of this when it is unable to write its output file. Is this what you have in mind?\n\nAndrew",
    "created_at": "2013-09-30T16:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110049",
    "user": "andrew.mathas"
}
```

Replying to [comment:39 tscrim]:
> Hey Andrew,
> 
> Is there some way we could make this behave better when we don't have write permissions to a given directory, such as output query the user or just output to the console?

Hi Travis,

This already happens. The problem that Jeroen found concerns a tempory file which the sage-fixdoctests script uses to dump the current state of the doc-tests. This file is now written to sage's ``tmp_dir()`` which is always writable.

The only other file that sage-fixdoctests writes is the replacement source file. By default this is put in the same directory as the original source, however, the user can supply an optional argument to have the file written elsewhere:

```
Usage: sage -fixdoctests <source file> [doctest output]
Creates a file <source file>.out that passes the doctests (modulo any raised exceptions)
```


Having said this, I just chcked and this optional argument is not mentioned under ``sage -advanced``, so probably I should add it there. I could also make the script more user friendy and have it remind the user of this when it is unable to write its output file. Is this what you have in mind?

Andrew



---

archive/issue_comments_110050.json:
```json
{
    "body": "Replying to [comment:40 andrew.mathas]:\n> This already happens. The problem that Jeroen found concerns a tempory file which the sage-fixdoctests script uses to dump the current state of the doc-tests. This file is now written to sage's ``tmp_dir()`` which is always writable.\n> \n> The only other file that sage-fixdoctests writes is the replacement source file. By default this is put in the same directory as the original source, however, the user can supply an optional argument to have the file written elsewhere:\n> {{{\n> Usage: sage -fixdoctests <source file> [doctest output]\n> Creates a file <source file>.out that passes the doctests (modulo any raised exceptions)\n> }}}\n> \n> Having said this, I just chcked and this optional argument is not mentioned under ``sage -advanced``, so probably I should add it there. I could also make the script more user friendy and have it remind the user of this when it is unable to write its output file. Is this what you have in mind?\n\nHey Andrew,\n\nYes, that would be good.\n\nThanks,\n\nTravis",
    "created_at": "2013-09-30T21:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110050",
    "user": "tscrim"
}
```

Replying to [comment:40 andrew.mathas]:
> This already happens. The problem that Jeroen found concerns a tempory file which the sage-fixdoctests script uses to dump the current state of the doc-tests. This file is now written to sage's ``tmp_dir()`` which is always writable.
> 
> The only other file that sage-fixdoctests writes is the replacement source file. By default this is put in the same directory as the original source, however, the user can supply an optional argument to have the file written elsewhere:
> {{{
> Usage: sage -fixdoctests <source file> [doctest output]
> Creates a file <source file>.out that passes the doctests (modulo any raised exceptions)
> }}}
> 
> Having said this, I just chcked and this optional argument is not mentioned under ``sage -advanced``, so probably I should add it there. I could also make the script more user friendy and have it remind the user of this when it is unable to write its output file. Is this what you have in mind?

Hey Andrew,

Yes, that would be good.

Thanks,

Travis



---

archive/issue_comments_110051.json:
```json
{
    "body": "I confirm that the new patches seem to work (but I haven't looked at the code).",
    "created_at": "2013-10-02T16:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110051",
    "user": "jdemeyer"
}
```

I confirm that the new patches seem to work (but I haven't looked at the code).



---

archive/issue_comments_110052.json:
```json
{
    "body": "Replying to [comment:42 jdemeyer]:\n> I confirm that the new patches seem to work (but I haven't looked at the code).\n \nThanks! I haven't yet incororated Travis' suggestions above. Btw, can any one tell me where the sage usage message lives so that I can mention the optional argument to fixdoctests there?",
    "created_at": "2013-10-02T17:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110052",
    "user": "andrew.mathas"
}
```

Replying to [comment:42 jdemeyer]:
> I confirm that the new patches seem to work (but I haven't looked at the code).
 
Thanks! I haven't yet incororated Travis' suggestions above. Btw, can any one tell me where the sage usage message lives so that I can mention the optional argument to fixdoctests there?



---

archive/issue_comments_110053.json:
```json
{
    "body": "It's in `SAGE_ROOT/spkg/bin/sage`. You should also update the documentation at `devel/sage/doc/en/reference/cmd/options.rst`.",
    "created_at": "2013-10-02T17:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110053",
    "user": "jhpalmieri"
}
```

It's in `SAGE_ROOT/spkg/bin/sage`. You should also update the documentation at `devel/sage/doc/en/reference/cmd/options.rst`.



---

archive/issue_comments_110054.json:
```json
{
    "body": "OK, I have just uploaded a new version of the patch, which now consists of three files for three different repositories (main, scripts and spkg). The new features of the patch are:\n* sage-fixdoctests now checks to see if it can write to the specified output directory and if not it prompts the user for a better place to put the file\n* the script now takes an optional argument --long so that fixdoctests can also massage --long doctests\n* there is an updated usage message for fixdoctests printed by sage --advanced\n* there is an updated usage message for fixdoctests in the reference manual\n\nReady for review...",
    "created_at": "2013-10-03T13:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110054",
    "user": "andrew.mathas"
}
```

OK, I have just uploaded a new version of the patch, which now consists of three files for three different repositories (main, scripts and spkg). The new features of the patch are:
* sage-fixdoctests now checks to see if it can write to the specified output directory and if not it prompts the user for a better place to put the file
* the script now takes an optional argument --long so that fixdoctests can also massage --long doctests
* there is an updated usage message for fixdoctests printed by sage --advanced
* there is an updated usage message for fixdoctests in the reference manual

Ready for review...



---

archive/issue_comments_110055.json:
```json
{
    "body": "One very minor point, could you put a space after the colon on line 122 in the fixdoctest file? I prefer my prompts like:\n\n```\nprompt: foo\n```\n\nas opposed to:\n\n```\nprompt:foo\n```\n\n\nAfter that, you can set this to positive review. Thanks.",
    "created_at": "2013-10-03T21:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110055",
    "user": "tscrim"
}
```

One very minor point, could you put a space after the colon on line 122 in the fixdoctest file? I prefer my prompts like:

```
prompt: foo
```

as opposed to:

```
prompt:foo
```


After that, you can set this to positive review. Thanks.



---

archive/issue_comments_110056.json:
```json
{
    "body": "Replying to [comment:46 tscrim]:\n> One very minor point, could you put a space after the colon on line 122 in the fixdoctest file? I prefer my prompts like:\n> \n> After that, you can set this to positive review. Thanks.\n\nThanks very much Travis. Both done!\n\nAndrew",
    "created_at": "2013-10-04T07:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110056",
    "user": "andrew.mathas"
}
```

Replying to [comment:46 tscrim]:
> One very minor point, could you put a space after the colon on line 122 in the fixdoctest file? I prefer my prompts like:
> 
> After that, you can set this to positive review. Thanks.

Thanks very much Travis. Both done!

Andrew



---

archive/issue_comments_110057.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-04T07:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110057",
    "user": "andrew.mathas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110058.json:
```json
{
    "body": "There is an **obvious doctest failure**, which should have been caught both by the author and reviewer here:\n\n```\nsage -t devel/sage/sage/tests/cmdline.py\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 178, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    '/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 155: file.py: command not found\\n/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 155: outpu\nt_file: command not found\\n/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 156: file.py.out: command not found\\n/scratch/release/merger/sage-5.13.beta0/spkg\n/bin/sage: line 157: --long: command not found\\n'\n**********************************************************************\n```\n",
    "created_at": "2013-10-04T12:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110058",
    "user": "jdemeyer"
}
```

There is an **obvious doctest failure**, which should have been caught both by the author and reviewer here:

```
sage -t devel/sage/sage/tests/cmdline.py
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 178, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    '/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 155: file.py: command not found\n/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 155: outpu
t_file: command not found\n/scratch/release/merger/sage-5.13.beta0/spkg/bin/sage: line 156: file.py.out: command not found\n/scratch/release/merger/sage-5.13.beta0/spkg
/bin/sage: line 157: --long: command not found\n'
**********************************************************************
```




---

archive/issue_comments_110059.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-10-04T12:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110059",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110060.json:
```json
{
    "body": "Attachment [trac_10589--updating_fixdoctests_command_line_options-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--updating_fixdoctests_command_line_options-am.patch) by andrew.mathas created at 2013-10-04 13:32:56\n\nFixing help strings",
    "created_at": "2013-10-04T13:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110060",
    "user": "andrew.mathas"
}
```

Attachment [trac_10589--updating_fixdoctests_command_line_options-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--updating_fixdoctests_command_line_options-am.patch) by andrew.mathas created at 2013-10-04 13:32:56

Fixing help strings



---

archive/issue_comments_110061.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> There is an **obvious doctest failure**, which should have been caught both by the author and reviewer here:\n\nYep, agreed. Sorry. Fixed.\n\nJeroen, I always get the feeling you don't like me.\n\nA.",
    "created_at": "2013-10-04T13:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110061",
    "user": "andrew.mathas"
}
```

Replying to [comment:49 jdemeyer]:
> There is an **obvious doctest failure**, which should have been caught both by the author and reviewer here:

Yep, agreed. Sorry. Fixed.

Jeroen, I always get the feeling you don't like me.

A.



---

archive/issue_comments_110062.json:
```json
{
    "body": "Replying to [comment:50 andrew.mathas]:\n> Jeroen, I always get the feeling you don't like me.\nIt is true that failures like these are annoying to me, because they make me lose time while being completely avoidable. On the other hand, it is nothing personal (usually, I don't even look at ticket's authors). I certainly didn't mean to offend, and I apologize if I did.",
    "created_at": "2013-10-04T13:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110062",
    "user": "jdemeyer"
}
```

Replying to [comment:50 andrew.mathas]:
> Jeroen, I always get the feeling you don't like me.
It is true that failures like these are annoying to me, because they make me lose time while being completely avoidable. On the other hand, it is nothing personal (usually, I don't even look at ticket's authors). I certainly didn't mean to offend, and I apologize if I did.



---

archive/issue_comments_110063.json:
```json
{
    "body": "Replying to [comment:51 jdemeyer]:\n> Replying to [comment:50 andrew.mathas]:\n> > Jeroen, I always get the feeling you don't like me.\n> It is true that failures like these are annoying to me, because they make me lose time while being completely avoidable. On the other hand, it is nothing personal (usually, I don't even look at ticket's authors). I certainly didn't mean to offend, and I apologize if I did.\n\nNo, not offended as I completely understand: it annoys me when I do this as well.\n\nApologies for wasting your time annd Travis' (and mine), as I am sure we all have better thing to do.\n\nA.",
    "created_at": "2013-10-04T13:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110063",
    "user": "andrew.mathas"
}
```

Replying to [comment:51 jdemeyer]:
> Replying to [comment:50 andrew.mathas]:
> > Jeroen, I always get the feeling you don't like me.
> It is true that failures like these are annoying to me, because they make me lose time while being completely avoidable. On the other hand, it is nothing personal (usually, I don't even look at ticket's authors). I certainly didn't mean to offend, and I apologize if I did.

No, not offended as I completely understand: it annoys me when I do this as well.

Apologies for wasting your time annd Travis' (and mine), as I am sure we all have better thing to do.

A.



---

archive/issue_comments_110064.json:
```json
{
    "body": "Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest. With Andrew's new patch it is fixed:\n\n```\ntravis@Kristine-Desktop:~/sage-5.12.beta5/devel/sage-combinat/sage/tests$ sage -t --long ../tests/cmdline.py \nRunning doctests with ID 2013-10-04-07-25-10-694770dc.\nDoctesting 1 file.\nsage -t --long cmdline.py\n    [213 tests, 95.98 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 96.4 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 96.0 seconds\n```\n",
    "created_at": "2013-10-04T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110064",
    "user": "tscrim"
}
```

Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest. With Andrew's new patch it is fixed:

```
travis@Kristine-Desktop:~/sage-5.12.beta5/devel/sage-combinat/sage/tests$ sage -t --long ../tests/cmdline.py 
Running doctests with ID 2013-10-04-07-25-10-694770dc.
Doctesting 1 file.
sage -t --long cmdline.py
    [213 tests, 95.98 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 96.4 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 96.0 seconds
```




---

archive/issue_comments_110065.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-10-04T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110065",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_110066.json:
```json
{
    "body": "Replying to [comment:53 tscrim]:\n> Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest.\nThere reason is that ``` is a special character for the shell.",
    "created_at": "2013-10-04T15:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110066",
    "user": "jdemeyer"
}
```

Replying to [comment:53 tscrim]:
> Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest.
There reason is that ``` is a special character for the shell.



---

archive/issue_comments_110067.json:
```json
{
    "body": "Replying to [comment:54 jdemeyer]:\n> Replying to [comment:53 tscrim]:\n> > Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest.\n> There reason is that ``` is a special character for the shell.\n\nAh. Thanks.",
    "created_at": "2013-10-04T15:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110067",
    "user": "tscrim"
}
```

Replying to [comment:54 jdemeyer]:
> Replying to [comment:53 tscrim]:
> > Sorry about that Jeroen. I'm somewhat surprised that changes to the output of the `--advanced` broke that particular doctest.
> There reason is that ``` is a special character for the shell.

Ah. Thanks.



---

archive/issue_comments_110068.json:
```json
{
    "body": "The `diff` output isn't portable, on Solaris:\n\n```\nsage -t --long devel/sage/sage/tests/cmdline.py\n**********************************************************************\nFile \"devel/sage/sage/tests/cmdline.py\", line 417, in sage.tests.cmdline.test_executable\nFailed example:\n    print output[output.find('     SAGE: 1+1'):output.find(' \\\"\\\"\\\"')-1]\nExpected:\n         SAGE: 1+1              # incorrect output\n    -    3\n    +    2\n         SAGE: m=matrix(ZZ,3)   # output when none is expected\n    +    SAGE: (2/3)*m          # no output when it is expected\n    +    [0 0 0]\n         [0 0 0]\n         [0 0 0]\n    -    [1 0 0]\n    -    SAGE: (2/3)*m          # no output when it is expected\n         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected\n    -    [4, 4, 3, 3, 2, 1, 1]\n         SAGE: mu.pp()          # uneven indentation\n    -    ****\n    -    ****\n    +       ****   ***   *\n    +       ****   ***   *\n    +              **\n    +              *\n         SAGE: PartitionTuples.global_options(convention=\"French\")\n         SAGE: mu.pp()         # fix doctest with uneven indentation\n    +    *\n    +    **\n    +    ****   ***   *\n    +    ****   ***   *\n         SAGE: PartitionTuples.global_options.reset()\nGot:\n         SAGE: 1+1              # incorrect output\n    -    3\n    +    2\n         SAGE: m=matrix(ZZ,3)   # output when none is expected\n    +    SAGE: (2/3)*m          # no output when it is expected\n         [0 0 0]\n         [0 0 0]\n    -    [1 0 0]\n    -    SAGE: (2/3)*m          # no output when it is expected\n    +    [0 0 0]\n         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected\n    -    [4, 4, 3, 3, 2, 1, 1]\n         SAGE: mu.pp()          # uneven indentation\n    -    ****\n    -    ****\n    +       ****   ***   *\n    +       ****   ***   *\n    +              **\n    +              *\n         SAGE: PartitionTuples.global_options(convention=\"French\")\n         SAGE: mu.pp()         # fix doctest with uneven indentation\n    +    *\n    +    **\n    +    ****   ***   *\n    +    ****   ***   *\n         SAGE: PartitionTuples.global_options.reset()\n**********************************************************************\n```\n",
    "created_at": "2013-10-12T09:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110068",
    "user": "jdemeyer"
}
```

The `diff` output isn't portable, on Solaris:

```
sage -t --long devel/sage/sage/tests/cmdline.py
**********************************************************************
File "devel/sage/sage/tests/cmdline.py", line 417, in sage.tests.cmdline.test_executable
Failed example:
    print output[output.find('     SAGE: 1+1'):output.find(' \"\"\"')-1]
Expected:
         SAGE: 1+1              # incorrect output
    -    3
    +    2
         SAGE: m=matrix(ZZ,3)   # output when none is expected
    +    SAGE: (2/3)*m          # no output when it is expected
    +    [0 0 0]
         [0 0 0]
         [0 0 0]
    -    [1 0 0]
    -    SAGE: (2/3)*m          # no output when it is expected
         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected
    -    [4, 4, 3, 3, 2, 1, 1]
         SAGE: mu.pp()          # uneven indentation
    -    ****
    -    ****
    +       ****   ***   *
    +       ****   ***   *
    +              **
    +              *
         SAGE: PartitionTuples.global_options(convention="French")
         SAGE: mu.pp()         # fix doctest with uneven indentation
    +    *
    +    **
    +    ****   ***   *
    +    ****   ***   *
         SAGE: PartitionTuples.global_options.reset()
Got:
         SAGE: 1+1              # incorrect output
    -    3
    +    2
         SAGE: m=matrix(ZZ,3)   # output when none is expected
    +    SAGE: (2/3)*m          # no output when it is expected
         [0 0 0]
         [0 0 0]
    -    [1 0 0]
    -    SAGE: (2/3)*m          # no output when it is expected
    +    [0 0 0]
         SAGE: mu=PartitionTuple([[4,4],[3,3,2,1],[1,1]])   # output when none is expected
    -    [4, 4, 3, 3, 2, 1, 1]
         SAGE: mu.pp()          # uneven indentation
    -    ****
    -    ****
    +       ****   ***   *
    +       ****   ***   *
    +              **
    +              *
         SAGE: PartitionTuples.global_options(convention="French")
         SAGE: mu.pp()         # fix doctest with uneven indentation
    +    *
    +    **
    +    ****   ***   *
    +    ****   ***   *
         SAGE: PartitionTuples.global_options.reset()
**********************************************************************
```




---

archive/issue_comments_110069.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-10-12T09:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110069",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110070.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> The `diff` output isn't portable, on Solaris:\n\nThis is going to be tricky as I don't have access to a solaris machine so I can't test this. The only difference between the two diffs is where the `+    [0 0 0]` appears.\n\nIt seems that the problem may be that `-fixdoctests` uses a universal diff:\n\n```python\nos.system('diff -u %s %s | more'%(test_file, test_output))\n```\n\nAunty google suggests that a context diff may work better:\n\n```\nos.system('diff -c %s %s | more'%(test_file, test_output))\n```\n\nIs anyone able to confirm this?\n\nLooking at this there is also an issue because diff may not be installed on the system, or it may not be in the users PATH. The script should try and trap the resulting errors in these cases...although I'll need to find appropriate exceptions to look for. Of course, in all of these cases this test will fail but I don't see a way around this. Having `diff` installed presumably isn't, and shouldn't be, a requirement for sage.\n\nIs there a way to mark tests for the doc-test suite to ignore a test on certain systems?\n\nA.",
    "created_at": "2013-10-14T08:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110070",
    "user": "andrew.mathas"
}
```

Replying to [comment:56 jdemeyer]:
> The `diff` output isn't portable, on Solaris:

This is going to be tricky as I don't have access to a solaris machine so I can't test this. The only difference between the two diffs is where the `+    [0 0 0]` appears.

It seems that the problem may be that `-fixdoctests` uses a universal diff:

```python
os.system('diff -u %s %s | more'%(test_file, test_output))
```

Aunty google suggests that a context diff may work better:

```
os.system('diff -c %s %s | more'%(test_file, test_output))
```

Is anyone able to confirm this?

Looking at this there is also an issue because diff may not be installed on the system, or it may not be in the users PATH. The script should try and trap the resulting errors in these cases...although I'll need to find appropriate exceptions to look for. Of course, in all of these cases this test will fail but I don't see a way around this. Having `diff` installed presumably isn't, and shouldn't be, a requirement for sage.

Is there a way to mark tests for the doc-test suite to ignore a test on certain systems?

A.



---

archive/issue_comments_110071.json:
```json
{
    "body": "Please ignore my queries: I have just discovered difflib which should fix both issues.\nA.",
    "created_at": "2013-10-14T08:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110071",
    "user": "andrew.mathas"
}
```

Please ignore my queries: I have just discovered difflib which should fix both issues.
A.



---

archive/issue_comments_110072.json:
```json
{
    "body": "Makes fixdoctests use difflib to generate diffs",
    "created_at": "2013-10-14T09:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110072",
    "user": "andrew.mathas"
}
```

Makes fixdoctests use difflib to generate diffs



---

archive/issue_comments_110073.json:
```json
{
    "body": "Attachment [trac_10589--fixdoctest_failures-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--fixdoctest_failures-am.patch) by andrew.mathas created at 2013-10-14 09:12:49\n\nOK, the script now uses `difflib` to compare the input and output files so hopefully this will fix the solaris problem and potential issues with other operating systems.\n\nThe tests pass me for me on a mac.\n\n```\nsage -t ../tests/cmdline.py\n    [204 tests, 48.07 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 48.1 seconds\n    cpu time: 0.2 seconds\n    cumulative wall time: 48.1 seconds\n```\n\n\nA.",
    "created_at": "2013-10-14T09:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110073",
    "user": "andrew.mathas"
}
```

Attachment [trac_10589--fixdoctest_failures-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--fixdoctest_failures-am.patch) by andrew.mathas created at 2013-10-14 09:12:49

OK, the script now uses `difflib` to compare the input and output files so hopefully this will fix the solaris problem and potential issues with other operating systems.

The tests pass me for me on a mac.

```
sage -t ../tests/cmdline.py
    [204 tests, 48.07 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 48.1 seconds
    cpu time: 0.2 seconds
    cumulative wall time: 48.1 seconds
```


A.



---

archive/issue_comments_110074.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-14T09:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110074",
    "user": "andrew.mathas"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110075.json:
```json
{
    "body": "My output on Linux (Ubuntu) matches the output on Solaris. In other words, I also get the doctest failure [comment:56 noted above].",
    "created_at": "2013-10-14T18:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110075",
    "user": "tscrim"
}
```

My output on Linux (Ubuntu) matches the output on Solaris. In other words, I also get the doctest failure [comment:56 noted above].



---

archive/issue_comments_110076.json:
```json
{
    "body": "Actually, since it does diff properly, should we:\n\n* mark the doctest as `# random`,\n* look at the beginning and ending with a `...` inbetween since it matches there?",
    "created_at": "2013-10-14T19:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110076",
    "user": "tscrim"
}
```

Actually, since it does diff properly, should we:

* mark the doctest as `# random`,
* look at the beginning and ending with a `...` inbetween since it matches there?



---

archive/issue_comments_110077.json:
```json
{
    "body": "Replying to [comment:61 tscrim]:\n> My output on Linux (Ubuntu) matches the output on Solaris. In other words, I also get the doctest failure [comment:56 noted above].\n\nHi Travis,\n\nSorry, this is my mistake: previously when you tested the script it worked, so the problem you're seeing is not because ubuntu's diff returns the same output as solaris. Rather that when I tested the the new patch I thought that I had the full patch applied but I was in the wrong branch where the patch was not applied. Sorry.\n\nThe new output, I hope, should be independent of the system diff as it uses difflib, which is a python module for generating diffs. In any case the new diff is closer to that returned by solaris than the previous universal diff.\n\nWith the patch applied, this time, I get the following:\n\n```\nsage -t cmdline.py\n    [213 tests, 52.19 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 52.3 seconds\n    cpu time: 0.2 seconds\n    cumulative wall time: 52.2 seconds\n```\n\n\nThe new version of `trac_10589--doctests_for_fixdoctests-am.patch\u200b` is now on trac.\n\nAndrew",
    "created_at": "2013-10-14T20:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110077",
    "user": "andrew.mathas"
}
```

Replying to [comment:61 tscrim]:
> My output on Linux (Ubuntu) matches the output on Solaris. In other words, I also get the doctest failure [comment:56 noted above].

Hi Travis,

Sorry, this is my mistake: previously when you tested the script it worked, so the problem you're seeing is not because ubuntu's diff returns the same output as solaris. Rather that when I tested the the new patch I thought that I had the full patch applied but I was in the wrong branch where the patch was not applied. Sorry.

The new output, I hope, should be independent of the system diff as it uses difflib, which is a python module for generating diffs. In any case the new diff is closer to that returned by solaris than the previous universal diff.

With the patch applied, this time, I get the following:

```
sage -t cmdline.py
    [213 tests, 52.19 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 52.3 seconds
    cpu time: 0.2 seconds
    cumulative wall time: 52.2 seconds
```


The new version of `trac_10589--doctests_for_fixdoctests-am.patch​` is now on trac.

Andrew



---

archive/issue_comments_110078.json:
```json
{
    "body": "Attachment [trac_10589--doctests_for_fixdoctests-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--doctests_for_fixdoctests-am.patch) by andrew.mathas created at 2013-10-14 20:16:14\n\nMakes fixdoctests use difflib to generate diffs",
    "created_at": "2013-10-14T20:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110078",
    "user": "andrew.mathas"
}
```

Attachment [trac_10589--doctests_for_fixdoctests-am.patch](tarball://root/attachments/some-uuid/ticket10589/trac_10589--doctests_for_fixdoctests-am.patch) by andrew.mathas created at 2013-10-14 20:16:14

Makes fixdoctests use difflib to generate diffs



---

archive/issue_comments_110079.json:
```json
{
    "body": "Okay the new patch works for me on linux. Thanks Andrew.",
    "created_at": "2013-10-15T16:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110079",
    "user": "tscrim"
}
```

Okay the new patch works for me on linux. Thanks Andrew.



---

archive/issue_comments_110080.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-15T16:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110080",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110081.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-19T09:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10536#issuecomment-110081",
    "user": "jdemeyer"
}
```

Resolution: fixed
