# Issue 28138: import_statements(pi) fails

Issue created by migration from https://trac.sagemath.org/ticket/28375

Original creator: vdelecroix

Original creation time: 2019-08-21 07:42:51

CC:  @mwageringel


```
sage: import_statements(pi)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2391             # and str (=unicode) in python3
-> 2392             return inspect.getsourcelines(obj)
   2393 

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcelines(object)
    954     object = unwrap(object)
--> 955     lines, lnum = findsource(object)
    956 

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in findsource(object)
    767 
--> 768     file = getsourcefile(object)
    769     if file:

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcefile(object)
    683     """
--> 684     filename = getfile(object)
    685     all_bytecode_suffixes = importlib.machinery.DEBUG_BYTECODE_SUFFIXES[:]

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getfile(object)
    646             return object.__file__
--> 647         raise TypeError('{!r} is a built-in module'.format(object))
    648     if isclass(object):

TypeError: <module '__main__'> is a built-in module

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2391             # and str (=unicode) in python3
-> 2392             return inspect.getsourcelines(obj)
   2393 

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcelines(object)
    954     object = unwrap(object)
--> 955     lines, lnum = findsource(object)
    956 

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in findsource(object)
    767 
--> 768     file = getsourcefile(object)
    769     if file:

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcefile(object)
    683     """
--> 684     filename = getfile(object)
    685     all_bytecode_suffixes = importlib.machinery.DEBUG_BYTECODE_SUFFIXES[:]

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getfile(object)
    652                 return object.__file__
--> 653         raise TypeError('{!r} is a built-in class'.format(object))
    654     if ismethod(object):

TypeError: <module 'builtins' (built-in)> is a built-in class

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-15-e5496a92f412> in <module>()
----> 1 import_statements(pi)

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/dev_tools.py in import_statements(*objects, **kwds)
    590             continue
    591 
--> 592         modules = find_object_modules(obj)
    593         if '__main__' in modules:
    594             del modules['__main__']

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/dev_tools.py in find_object_modules(obj)
    318         for module_name, obj_names in iteritems(module_to_obj):
    319             module_to_obj2[module_name] = []
--> 320             src = sageinspect.sage_getsource(sys.modules[module_name])
    321             m = dec_pattern.search(src)
    322             while m:

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsource(obj)
   2087         pass
   2088 
-> 2089     t = sage_getsourcelines(obj)
   2090     if not t:
   2091         return None

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2409                             return sage_getsourcelines(B)
   2410                     if obj.__class__ != type:
-> 2411                         return sage_getsourcelines(obj.__class__)
   2412                     raise err
   2413 

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2407                             B = None
   2408                         if B is not None and B is not obj:
-> 2409                             return sage_getsourcelines(B)
   2410                     if obj.__class__ != type:
   2411                         return sage_getsourcelines(obj.__class__)

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2410                     if obj.__class__ != type:
   2411                         return sage_getsourcelines(obj.__class__)
-> 2412                     raise err
   2413 
   2414     (orig, filename, lineno) = pos

/opt/sage/sage-py3-gcc/local/lib/python3.7/site-packages/sage/misc/sageinspect.py in sage_getsourcelines(obj)
   2390             # inspect gives str (=bytes) in python2
   2391             # and str (=unicode) in python3
-> 2392             return inspect.getsourcelines(obj)
   2393 
   2394         except (IOError, TypeError) as err:

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcelines(object)
    953     raised if the source code cannot be retrieved."""
    954     object = unwrap(object)
--> 955     lines, lnum = findsource(object)
    956 
    957     if istraceback(object):

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in findsource(object)
    766     is raised if the source code cannot be retrieved."""
    767 
--> 768     file = getsourcefile(object)
    769     if file:
    770         # Invalidate cache if needed.

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getsourcefile(object)
    682     Return None if no way can be identified to get the source.
    683     """
--> 684     filename = getfile(object)
    685     all_bytecode_suffixes = importlib.machinery.DEBUG_BYTECODE_SUFFIXES[:]
    686     all_bytecode_suffixes += importlib.machinery.OPTIMIZED_BYTECODE_SUFFIXES[:]

/opt/sage/sage-py3-gcc/local/lib/python3.7/inspect.py in getfile(object)
    651             if getattr(object, '__file__', None):
    652                 return object.__file__
--> 653         raise TypeError('{!r} is a built-in class'.format(object))
    654     if ismethod(object):
    655         object = object.__func__

TypeError: <module 'builtins' (built-in)> is a built-in class
```



---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2020-08-29 16:07:34

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-29 16:07:34

Works in 9.2.beta10

```
sage: import_statements(pi)                                                                                                      
from sage.symbolic.constants import pi
```



---

Comment by @mwageringel created at 2020-08-29 16:11:58

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2020-08-29 16:11:58

Fixed by #28966.


---

Comment by embray created at 2020-08-31 14:47:51

Resolution: worksforme
