# Issue 33103: Make expansion() compatible with general p-adic extensions

Issue created by migration from https://trac.sagemath.org/ticket/33340

Original creator: saraedum

Original creation time: 2022-02-14 03:40:20

CC:  roed

Currently, `expansion()` returns a list of integers or a list of lists of integers:


```
sage: Zp(2)(1).expansion()
2-adic expansion of 1 + O(2^20)
sage: list(_)
[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
sage: K.<a> = Qq(4)
sage: list(a.expansion())
[[0, 1], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []]
```


This does not easily translate to general p-adic extensions.

Instead, we should deprecate these list modes and introduce 6 new modes. These still do the expansion coming from the "smallest", "simple", and "teichmuller" lifts but return either elements of the p-adic ring or elements of the residue field instead:

`smallest-residue`, `smallest-lift`, `simple-residue`, `simple-lift`, `teichmuller-residue`, `teichmuller-lift` (the last one is identical to the current behavior of `teichmuller`.

Probably this also allows us to speed up conversion to the residue field which relies on `expansion(0)` currently and is surprisingly slow:


```
sage: K = Qp(2)
sage: R.<x> = K[]
sage: L.<a> = K.extension(x^2 - 2)
sage: k = L.residue_field()
sage: %timeit k(L(1))
60Âµs
```



---

Comment by roed created at 2022-02-14 03:44:52

Changing keywords from "" to "padicBordeaux".


---

Comment by caruso created at 2022-02-14 07:22:25

I agree for changing the behaviour of `expansion` as you propose, expect that I think that it does not really make sense to return something in the residue field since the expansion really depends on the liftings we are selecting.


---

Comment by saraedum created at 2022-03-01 17:07:36

Replying to [comment:2 caruso]:
> I agree for changing the behaviour of `expansion` as you propose, expect that I think that it does not really make sense to return something in the residue field since the expansion really depends on the liftings we are selecting.

(As discussed) the expansion depends on the lifting but it still makes sense to return elements in the residue field; i.e., even if returning elements in the residue field, the output of this method is going to depend on the lifting that was chosen.
