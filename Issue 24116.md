# Issue 24116: Upgrade to MPFR 4.0.0

archive/issues_024116.json:
```json
{
    "body": "CC:  zimmerma fbissey\n\nCurrently, there is a release candidate:\n\n**Tarball**: http://www.mpfr.org/mpfr-4.0.0/mpfr-4.0.0-rc1.tar.bz2\n\nIssue created by migration from https://trac.sagemath.org/ticket/24353\n\n",
    "created_at": "2017-12-09T17:05:23Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Upgrade to MPFR 4.0.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24116",
    "user": "jdemeyer"
}
```
CC:  zimmerma fbissey

Currently, there is a release candidate:

**Tarball**: http://www.mpfr.org/mpfr-4.0.0/mpfr-4.0.0-rc1.tar.bz2

Issue created by migration from https://trac.sagemath.org/ticket/24353





---

archive/issue_comments_337848.json:
```json
{
    "body": "As reported on the MPFR mailing list by other people, this breaks MPC:\n\n```\n/bin/bash ../libtool  --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I..   -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include -m64 -O2 -march=corei7-\nmul.c:179:1: error: conflicting types for 'mpfr_fmma'\n mpfr_fmma (mpfr_ptr z, mpfr_srcptr a, mpfr_srcptr b, mpfr_srcptr c,\n ^\nIn file included from mpc.h:25:0,\n                 from mpc-impl.h:30,\n                 from mul.c:22:\n../../../../../../../include/mpfr.h:731:6: note: previous declaration of 'mpfr_fmma' was here\n __MPFR_DECLSPEC int mpfr_fmma (mpfr_ptr, mpfr_srcptr, mpfr_srcptr, mpfr_srcptr,\n      ^\nMakefile:532: recipe for target 'mul.lo' failed\nmake[6]: *** [mul.lo] Error 1\n```\n\n----\nNew commits:",
    "created_at": "2017-12-09T19:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337848",
    "user": "jdemeyer"
}
```

As reported on the MPFR mailing list by other people, this breaks MPC:

```
/bin/bash ../libtool  --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I..   -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include -m64 -O2 -march=corei7-
mul.c:179:1: error: conflicting types for 'mpfr_fmma'
 mpfr_fmma (mpfr_ptr z, mpfr_srcptr a, mpfr_srcptr b, mpfr_srcptr c,
 ^
In file included from mpc.h:25:0,
                 from mpc-impl.h:30,
                 from mul.c:22:
../../../../../../../include/mpfr.h:731:6: note: previous declaration of 'mpfr_fmma' was here
 __MPFR_DECLSPEC int mpfr_fmma (mpfr_ptr, mpfr_srcptr, mpfr_srcptr, mpfr_srcptr,
      ^
Makefile:532: recipe for target 'mul.lo' failed
make[6]: *** [mul.lo] Error 1
```

----
New commits:



---

archive/issue_comments_337849.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-14T14:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337849",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337850.json:
```json
{
    "body": "> Unfortunately, it seems that MPFI is a dead project\n\nFabrice Rouillier tells me he is preparing the release of MPFI 1.5.2. Stay tuned!",
    "created_at": "2018-01-08T12:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337850",
    "user": "zimmerma"
}
```

> Unfortunately, it seems that MPFI is a dead project

Fabrice Rouillier tells me he is preparing the release of MPFI 1.5.2. Stay tuned!



---

archive/issue_comments_337851.json:
```json
{
    "body": "Replying to [comment:9 zimmerma]:\n> Fabrice Rouillier tells me he is preparing the release of MPFI 1.5.2. Stay tuned!\n\nIs this personal communication or is this on some public channel? In the latter case, do you have a link?",
    "created_at": "2018-01-08T13:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337851",
    "user": "jdemeyer"
}
```

Replying to [comment:9 zimmerma]:
> Fabrice Rouillier tells me he is preparing the release of MPFI 1.5.2. Stay tuned!

Is this personal communication or is this on some public channel? In the latter case, do you have a link?



---

archive/issue_comments_337852.json:
```json
{
    "body": "> Is this personal communication or is this on some public channel?\n\nit is personal communication. If/when I have some information about a release candidate,\nI will post it here.",
    "created_at": "2018-01-08T13:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337852",
    "user": "zimmerma"
}
```

> Is this personal communication or is this on some public channel?

it is personal communication. If/when I have some information about a release candidate,
I will post it here.



---

archive/issue_comments_337853.json:
```json
{
    "body": "MPFI 1.5.2 is available from https://gforge.inria.fr/frs/?group_id=157",
    "created_at": "2018-01-08T15:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337853",
    "user": "zimmerma"
}
```

MPFI 1.5.2 is available from https://gforge.inria.fr/frs/?group_id=157



---

archive/issue_comments_337854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T16:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337855.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T16:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337855",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337856.json:
```json
{
    "body": "There are a few obvious doctest failures in `src/sage/rings/real_mpfr.pyx`. All should be easy to fix.",
    "created_at": "2018-01-08T18:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337856",
    "user": "jdemeyer"
}
```

There are a few obvious doctest failures in `src/sage/rings/real_mpfr.pyx`. All should be easy to fix.



---

archive/issue_comments_337857.json:
```json
{
    "body": "I am curious to know which failures you get.",
    "created_at": "2018-01-08T19:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337857",
    "user": "zimmerma"
}
```

I am curious to know which failures you get.



---

archive/issue_comments_337858.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-09T08:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337858",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337859.json:
```json
{
    "body": "I added a few fixes in the last commit. With this, all tests pass. So, this ticket is technically needs_review, modulo the fact that there is no MPC release yet...",
    "created_at": "2018-01-09T09:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337859",
    "user": "jdemeyer"
}
```

I added a few fixes in the last commit. With this, all tests pass. So, this ticket is technically needs_review, modulo the fact that there is no MPC release yet...



---

archive/issue_comments_337860.json:
```json
{
    "body": "in the last commit:\n\n> faithful rounding (currently experimental; not supported for every operation)\n\n\"not supported for every operation\" is not correct: it is supported, but not guaranteed correct for every operation.\n\nApart from that, I am ok with this commit.\n\nWe expect to release MPC 1.1 this week or next week.",
    "created_at": "2018-01-09T11:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337860",
    "user": "zimmerma"
}
```

in the last commit:

> faithful rounding (currently experimental; not supported for every operation)

"not supported for every operation" is not correct: it is supported, but not guaranteed correct for every operation.

Apart from that, I am ok with this commit.

We expect to release MPC 1.1 this week or next week.



---

archive/issue_comments_337861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-09T11:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337861",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337862.json:
```json
{
    "body": "Replying to [comment:20 zimmerma]:\n> \"not supported for every operation\" is not correct: it is supported, but not guaranteed correct for every operation.\n\nFixed.\n\n> Apart from that, I am ok with this commit.\n\nOK, I'm adding you as reviewer.",
    "created_at": "2018-01-09T11:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337862",
    "user": "jdemeyer"
}
```

Replying to [comment:20 zimmerma]:
> "not supported for every operation" is not correct: it is supported, but not guaranteed correct for every operation.

Fixed.

> Apart from that, I am ok with this commit.

OK, I'm adding you as reviewer.



---

archive/issue_comments_337863.json:
```json
{
    "body": "MPC 1.1.0 is now available from https://ftp.gnu.org/gnu/mpc",
    "created_at": "2018-01-12T14:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337863",
    "user": "zimmerma"
}
```

MPC 1.1.0 is now available from https://ftp.gnu.org/gnu/mpc



---

archive/issue_comments_337864.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-12T14:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337864",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337865.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-12T14:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337865",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337866.json:
```json
{
    "body": "all tests pass on quasar (ubuntu x86_64)",
    "created_at": "2018-01-12T15:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337866",
    "user": "vdelecroix"
}
```

all tests pass on quasar (ubuntu x86_64)



---

archive/issue_comments_337867.json:
```json
{
    "body": "I did:\n\n```\n$ git co u/jdemeyer/upgrade_to_mpfr_4_0_0\n$ git pull\n$ make build\n```\n\nand got an error:\n\n```\nERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/mp\nfr/mpfr-4.0.0.tar.bz2'\nTraceback (most recent call last):\n  File \"/tmp/sage/build/bin/sage-download-file\", line 28, in <module>\n    run_safe()\n  File \"/tmp/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 118, in\n run_safe\n    run()\n  File \"/tmp/sage/build/bin/../sage_bootstrap/download/cmdline.py\", line 100, in\n run\n    app.download_tarball(args.url_or_tarball, args.destination)\n  File \"/tmp/sage/build/bin/../sage_bootstrap/download/app.py\", line 43, in down\nload_tarball\n    tarball.download()\n  File \"/tmp/sage/build/bin/../sage_bootstrap/tarball.py\", line 161, in download\n    raise FileNotMirroredError('tarball does not exist on mirror network')\nsage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror ne\ntwork\n************************************************************************\nError downloading mpfr-4.0.0.tar.bz2\n```\n",
    "created_at": "2018-01-16T10:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337867",
    "user": "zimmerma"
}
```

I did:

```
$ git co u/jdemeyer/upgrade_to_mpfr_4_0_0
$ git pull
$ make build
```

and got an error:

```
ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/mp
fr/mpfr-4.0.0.tar.bz2'
Traceback (most recent call last):
  File "/tmp/sage/build/bin/sage-download-file", line 28, in <module>
    run_safe()
  File "/tmp/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 118, in
 run_safe
    run()
  File "/tmp/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 100, in
 run
    app.download_tarball(args.url_or_tarball, args.destination)
  File "/tmp/sage/build/bin/../sage_bootstrap/download/app.py", line 43, in down
load_tarball
    tarball.download()
  File "/tmp/sage/build/bin/../sage_bootstrap/tarball.py", line 161, in download
    raise FileNotMirroredError('tarball does not exist on mirror network')
sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror ne
twork
************************************************************************
Error downloading mpfr-4.0.0.tar.bz2
```




---

archive/issue_comments_337868.json:
```json
{
    "body": "You need to manually download the 3 tarballs mentioned on this ticket and put them in the `upstream` directory in your Sage installation.",
    "created_at": "2018-01-16T10:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337868",
    "user": "jdemeyer"
}
```

You need to manually download the 3 tarballs mentioned on this ticket and put them in the `upstream` directory in your Sage installation.



---

archive/issue_comments_337869.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-16T15:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337869",
    "user": "zimmerma"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337870.json:
```json
{
    "body": "modulo the fact that the patchbot is happy, I give a positive review.",
    "created_at": "2018-01-16T15:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337870",
    "user": "zimmerma"
}
```

modulo the fact that the patchbot is happy, I give a positive review.



---

archive/issue_comments_337871.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-18T18:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24116",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24116#issuecomment-337871",
    "user": "vbraun"
}
```

Resolution: fixed
