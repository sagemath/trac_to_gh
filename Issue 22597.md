# Issue 22597: infinite recursion in sage.rings.complex_interval.ComplexIntervalFieldElement.__invert__

Issue created by migration from Trac.

Original creator: wonder

Original creation time: 2017-04-19 18:44:52

CC:  mmarco

It is possible to crash sage with an infinite recursion by comparing a number to zero:


```
...
  File "sage/rings/complex_interval.pyx", line 1287, in sage.rings.complex_interval.ComplexIntervalFieldElement.__invert__ (/builddir/build/BUILD/sage-7.3/src/build/cythonized/sage/rings/complex_interval.c:13434)
  File "sage/rings/complex_interval.pyx", line 1287, in sage.rings.complex_interval.ComplexIntervalFieldElement.__invert__ (/builddir/build/BUILD/sage-7.3/src/build/cythonized/sage/rings/complex_interval.c:13434)
RuntimeError: maximum recursion depth exceeded while calling a Python object
```


It looks like this came up in my code when comparing an algebraic number to zero, but the bug appears to trace to this code at `sage/rings/complex_interval.pyx`, line 1287 (SageMath version 7.3, Release Date: 2016-08-04):


```
        elif mpfr_sgn(a) <= 0 and mpfr_sgn(d) <= 0: # thirthd quadrant or between thirthd and fourth
            return -(-self).__invert__()
```


which looks like it can fail in that way if the signs are zero.


---

Comment by wonder created at 2017-04-19 18:48:14

Calling N() before comparing to zero seems to be a usable workaround


---

Comment by jdemeyer created at 2017-04-20 08:46:40

Do you have a complete example?


---

Comment by jdemeyer created at 2017-04-20 08:51:02

Changing component from number fields to basic arithmetic.


---

Comment by chapoton created at 2020-05-13 15:37:27

Works now

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.1.rc4, Release Date: 2020-05-09                 │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: ~CIF(RIF(-1,1))
[.. NaN ..] + [.. NaN ..]*I
```

