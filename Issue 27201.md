# Issue 27201: Followup to #27256

Issue created by migration from https://trac.sagemath.org/ticket/27438

Original creator: embray

Original creation time: 2019-03-07 14:10:03

CC:  vbraun

#27256 did not fully fix the issue it was intended to fix.

I missed the fact that the `spkg-install` has two invocations of `make`, the first one being somewhat obscured within an `if` statement.

The second `make` attempt is only run if the first one failed (e.g. due to the target CPU not being well supported).


---

Comment by embray created at 2019-03-07 14:10:38

Changing keywords from "" to "openblas".


---

Comment by embray created at 2019-03-07 14:14:04

Changing status from new to needs_review.


---

Comment by embray created at 2019-03-07 14:14:04

New commits:


---

Comment by embray created at 2019-03-08 10:47:03

Changing status from needs_review to needs_work.


---

Comment by embray created at 2019-03-08 10:47:03

Before moving forward with this; I think I might know what's up with #27434, and if I'm right about it would like to incorporate its solution into this ticket.


---

Comment by embray created at 2019-03-08 14:18:42

Whatever the remaining problem is in #27434 it's definitely more subtle than I originally thought, and I think not related in any way to the issue this is fixing, so I'll deal with it independently.


---

Comment by embray created at 2019-03-08 14:18:42

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-03-08 14:56:23

How should I test this, how do I know that OpenBLAS is really built with TLS enabled?


---

Comment by jdemeyer created at 2019-03-08 16:01:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-03-08 16:01:43

OK, I see `-DUSE_TLS` in the compiler output, so it works.

I do think that we should bump the package version since this is a functional change in the package.
----
New commits:


---

Comment by embray created at 2019-03-11 08:24:13

Thank you, and yes I agree with bumping the package version (even though it means having to rebuild quite a bit, alas).

I'm not sure why we don't make `$(BLAS)` a prerequisite-only dependency for more things.  As long as they are dynamically linking to the libopenblas.so it should't be necessary to rebuild most things that depend on it, exception being if there is a non-trivial dependency on anything that might change in the headers due to re-configuration.


---

Comment by vbraun created at 2019-03-11 22:42:14

Resolution: fixed
