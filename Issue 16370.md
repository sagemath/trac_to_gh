# Issue 16370: Enforce keyword-only parameters

Issue created by migration from https://trac.sagemath.org/ticket/16607

Original creator: gagern

Original creation time: 2014-07-03 12:53:10

CC:  niles chapoton @mwageringel

There are functions all over the library which accept various optional named parameters. Often the intention is that these will only be used as keyword parameters, but that fact is not enforced. Maintaining a huge number of possibly positional parameters can become a maintainance pain. (I'm currently seeing a mild version of this in #16533, but things could be _much_ worse.)

While [PEP 3102](http://legacy.python.org/dev/peps/pep-3102/) introduced syntax for this for Python 3, the most reasonable way to add such an enforcement in Python 2 would be via a decorator. So I propose introducing a decorator which will limit the number of positional parameters passed to its wrapped function. To faciliate [graceful deprecation](http://www.sagemath.org/doc/developer/coding_in_python.html#deprecation), it might be associated with a trac ticket number and pass extra positional arguments after issuing a deprecation warning.

Once Sage moves to Python 3 (and I hope Sage will live long enough to make that step unavoidable), we could probably refactor those into proper keyword-only arguments, perhaps even automatically using some 2to3 plugin if there is a sufficient number to warrant that effort.


---

Comment by nbruin created at 2014-07-03 16:30:46

-1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a *lot* of calls already, so these costs quickly add up.

There would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.


---

Comment by gagern created at 2014-07-03 18:53:13

Replying to [comment:2 nbruin]:
> -1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a _lot_ of calls already, so these costs quickly add up.

I am thinking about things which are unlikely to be used in a tight loop. Front ends to costly operations, mostly. In those case, the extra cost would be negligible compared to the typical cost of the function execution. I certainly wouldn't want to add this decorator to _every_ function that might syntactically qualify, exactly due to these performance issues. I'd say the decorator should only be used if there is considerable gain associated with dropping a positional parameter.

> There would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.

This might help when policing uses within Sage itself. My main concern however was user interaction. If we leave them an officially sanctioned option to disable the checks, then we might be responsible to maintain compatibility with deprecated syntax indefinitely. Unless we have the checks in place by default and make a very clear statement that people must assume responsibility if they decide to disable them. Checks enabled by default would change little in terms of performance for most users.


---

Comment by gagern created at 2014-07-10 18:58:53

OK, here is my implementation. With a big fat warning about performance considerations, to reduce the chances of inappropriate use.

In comment:16:ticket:15515 I had to undo some changes by Jeroen Demeyer to avoid breaking compatibility for positional arguments. So it seems I'm not the only one who would like to get rid of some positional parameters to simplify implementations. With this tool here, we can have a proper deprecation period before we can finally dump them.

And with the `extra` keyword I introduced, things are even simpler for those cases. That keyword allows me to specify the names of any excess positional parameters, which will then be included in the `**kwds` dict so one doesn't have to mention them a second time when passing those arguments down the line.
----
New commits:


---

Comment by git created at 2014-07-10 19:19:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-07-10 19:19:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by gagern created at 2014-07-11 06:15:55

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-10-12 20:36:04

I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution. So I'm leaning towards "wontfix".

Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.


---

Comment by gagern created at 2015-03-11 23:35:48

Replying to [comment:10 jdemeyer]:
> I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution.

In comment:16:ticket:17234 you yourself had to remind people to not break positional parameter compatibility. So this looks like a recurring theme. And just because we have this tool here doesn't mean anyone will be forced to use it. But people may use it instead of inventing new workarounds at every turn.

> Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.

That is good to know, thanks!


---

Comment by jdemeyer created at 2015-03-13 08:42:13

Nils, do you have any more comments about this?

For PEP links in Sphinx, you can use `:pep:`3102`` analogous to `:trac:`16607``


---

Comment by jdemeyer created at 2015-03-13 08:47:52

Also: do you have a particular use-case in mind? If yes, please add this new decorator to an existing method, such that people can see how it is used in "real" situations.


---

Comment by jdemeyer created at 2015-03-13 08:48:33

Replying to [comment:11 gagern]:
> > Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.
> 
> That is good to know, thanks!

You should probably add this as a comment somewhere.


---

Comment by git created at 2015-03-13 12:19:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vbraun created at 2015-04-13 17:32:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-13 17:32:18

Looks good to me. Its just a temporary measure anyways, we'll rip it out when we move to Python 3


---

Comment by vbraun created at 2015-04-14 20:51:21


```
  File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/plot/graphics.py", line 3403, in GraphicsArray
    @keyword_only(positional=4, deprecation=16607, extra="axes")
NameError: name 'keyword_only' is not defined
Makefile:60: recipe for target 'doc-html' failed
make: *** [doc-html] Error 1
```



---

Comment by vbraun created at 2015-04-14 20:51:21

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-04-14 21:09:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gagern created at 2015-04-14 21:10:25

I forgot the import. Won't have time to test this today. but hope to do so tomorrow.


---

Comment by git created at 2015-04-15 06:28:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-15 06:35:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gagern created at 2015-04-15 06:36:16

Changing status from needs_work to needs_review.


---

Comment by gagern created at 2015-04-15 06:36:16

This looks better now. Sorry I hadn't tested this as well as I should have before.


---

Comment by mderickx created at 2017-08-30 18:27:37

Needs to be rebased on sage8.1beta3


---

Comment by mderickx created at 2017-08-30 18:27:45

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2020-07-22 17:43:56

Now, after the switch to Python 3, we could revisit this.


---

Comment by mkoeppe created at 2020-08-18 21:25:04

Pointers to recent tickets: #29243, #30194


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
