# Issue 16370: Enforce keyword-only parameters

archive/issues_016370.json:
```json
{
    "body": "CC:  niles chapoton @mwageringel\n\nThere are functions all over the library which accept various optional named parameters. Often the intention is that these will only be used as keyword parameters, but that fact is not enforced. Maintaining a huge number of possibly positional parameters can become a maintainance pain. (I'm currently seeing a mild version of this in #16533, but things could be *much* worse.)\n\nWhile [PEP 3102](http://legacy.python.org/dev/peps/pep-3102/) introduced syntax for this for Python 3, the most reasonable way to add such an enforcement in Python 2 would be via a decorator. So I propose introducing a decorator which will limit the number of positional parameters passed to its wrapped function. To faciliate [graceful deprecation](http://www.sagemath.org/doc/developer/coding_in_python.html#deprecation), it might be associated with a trac ticket number and pass extra positional arguments after issuing a deprecation warning.\n\nOnce Sage moves to Python 3 (and I hope Sage will live long enough to make that step unavoidable), we could probably refactor those into proper keyword-only arguments, perhaps even automatically using some 2to3 plugin if there is a sufficient number to warrant that effort.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16607\n\n",
    "created_at": "2014-07-03T12:53:10Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Enforce keyword-only parameters",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16370",
    "user": "gagern"
}
```
CC:  niles chapoton @mwageringel

There are functions all over the library which accept various optional named parameters. Often the intention is that these will only be used as keyword parameters, but that fact is not enforced. Maintaining a huge number of possibly positional parameters can become a maintainance pain. (I'm currently seeing a mild version of this in #16533, but things could be *much* worse.)

While [PEP 3102](http://legacy.python.org/dev/peps/pep-3102/) introduced syntax for this for Python 3, the most reasonable way to add such an enforcement in Python 2 would be via a decorator. So I propose introducing a decorator which will limit the number of positional parameters passed to its wrapped function. To faciliate [graceful deprecation](http://www.sagemath.org/doc/developer/coding_in_python.html#deprecation), it might be associated with a trac ticket number and pass extra positional arguments after issuing a deprecation warning.

Once Sage moves to Python 3 (and I hope Sage will live long enough to make that step unavoidable), we could probably refactor those into proper keyword-only arguments, perhaps even automatically using some 2to3 plugin if there is a sufficient number to warrant that effort.

Issue created by migration from https://trac.sagemath.org/ticket/16607





---

archive/issue_comments_214872.json:
```json
{
    "body": "-1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a *lot* of calls already, so these costs quickly add up.\n\nThere would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.",
    "created_at": "2014-07-03T16:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214872",
    "user": "nbruin"
}
```

-1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a *lot* of calls already, so these costs quickly add up.

There would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.



---

archive/issue_comments_214873.json:
```json
{
    "body": "Replying to [comment:2 nbruin]:\n> -1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a *lot* of calls already, so these costs quickly add up.\n\nI am thinking about things which are unlikely to be used in a tight loop. Front ends to costly operations, mostly. In those case, the extra cost would be negligible compared to the typical cost of the function execution. I certainly wouldn't want to add this decorator to *every* function that might syntactically qualify, exactly due to these performance issues. I'd say the decorator should only be used if there is considerable gain associated with dropping a positional parameter.\n\n> There would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.\n\nThis might help when policing uses within Sage itself. My main concern however was user interaction. If we leave them an officially sanctioned option to disable the checks, then we might be responsible to maintain compatibility with deprecated syntax indefinitely. Unless we have the checks in place by default and make a very clear statement that people must assume responsibility if they decide to disable them. Checks enabled by default would change little in terms of performance for most users.",
    "created_at": "2014-07-03T18:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214873",
    "user": "gagern"
}
```

Replying to [comment:2 nbruin]:
> -1 for performance reasons. Calls in python are expensive and wrappers installed by decorators add a call level. And sage tends to have a *lot* of calls already, so these costs quickly add up.

I am thinking about things which are unlikely to be used in a tight loop. Front ends to costly operations, mostly. In those case, the extra cost would be negligible compared to the typical cost of the function execution. I certainly wouldn't want to add this decorator to *every* function that might syntactically qualify, exactly due to these performance issues. I'd say the decorator should only be used if there is considerable gain associated with dropping a positional parameter.

> There would be a way to have both: have a flag set at startup that determines whether the decorator puts a check in place or just returns the original function. I'm afraid that's too complicated to be used in practice, though, but you could try.

This might help when policing uses within Sage itself. My main concern however was user interaction. If we leave them an officially sanctioned option to disable the checks, then we might be responsible to maintain compatibility with deprecated syntax indefinitely. Unless we have the checks in place by default and make a very clear statement that people must assume responsibility if they decide to disable them. Checks enabled by default would change little in terms of performance for most users.



---

archive/issue_comments_214874.json:
```json
{
    "body": "OK, here is my implementation. With a big fat warning about performance considerations, to reduce the chances of inappropriate use.\n\nIn comment:16:ticket:15515 I had to undo some changes by Jeroen Demeyer to avoid breaking compatibility for positional arguments. So it seems I'm not the only one who would like to get rid of some positional parameters to simplify implementations. With this tool here, we can have a proper deprecation period before we can finally dump them.\n\nAnd with the `extra` keyword I introduced, things are even simpler for those cases. That keyword allows me to specify the names of any excess positional parameters, which will then be included in the `**kwds` dict so one doesn't have to mention them a second time when passing those arguments down the line.\n----\nNew commits:",
    "created_at": "2014-07-10T18:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214874",
    "user": "gagern"
}
```

OK, here is my implementation. With a big fat warning about performance considerations, to reduce the chances of inappropriate use.

In comment:16:ticket:15515 I had to undo some changes by Jeroen Demeyer to avoid breaking compatibility for positional arguments. So it seems I'm not the only one who would like to get rid of some positional parameters to simplify implementations. With this tool here, we can have a proper deprecation period before we can finally dump them.

And with the `extra` keyword I introduced, things are even simpler for those cases. That keyword allows me to specify the names of any excess positional parameters, which will then be included in the `**kwds` dict so one doesn't have to mention them a second time when passing those arguments down the line.
----
New commits:



---

archive/issue_comments_214875.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-07-10T19:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214875",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_214876.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-07-10T19:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214876",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_214877.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-11T06:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214877",
    "user": "gagern"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_214878.json:
```json
{
    "body": "I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution. So I'm leaning towards \"wontfix\".\n\nNote that Cython files do actually support the \u200bPEP 3102 syntax even for Python 2.",
    "created_at": "2014-10-12T20:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214878",
    "user": "jdemeyer"
}
```

I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution. So I'm leaning towards "wontfix".

Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.



---

archive/issue_comments_214879.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution.\n\nIn comment:16:ticket:17234 you yourself had to remind people to not break positional parameter compatibility. So this looks like a recurring theme. And just because we have this tool here doesn't mean anyone will be forced to use it. But people may use it instead of inventing new workarounds at every turn.\n\n> Note that Cython files do actually support the \u200bPEP 3102 syntax even for Python 2.\n\nThat is good to know, thanks!",
    "created_at": "2015-03-11T23:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214879",
    "user": "gagern"
}
```

Replying to [comment:10 jdemeyer]:
> I feel like the issue in the ticket is not serious enough to require such a heavy-handed solution.

In comment:16:ticket:17234 you yourself had to remind people to not break positional parameter compatibility. So this looks like a recurring theme. And just because we have this tool here doesn't mean anyone will be forced to use it. But people may use it instead of inventing new workarounds at every turn.

> Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.

That is good to know, thanks!



---

archive/issue_comments_214880.json:
```json
{
    "body": "Nils, do you have any more comments about this?\n\nFor PEP links in Sphinx, you can use `:pep:`3102`` analogous to `:trac:`16607``",
    "created_at": "2015-03-13T08:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214880",
    "user": "jdemeyer"
}
```

Nils, do you have any more comments about this?

For PEP links in Sphinx, you can use `:pep:`3102`` analogous to `:trac:`16607``



---

archive/issue_comments_214881.json:
```json
{
    "body": "Also: do you have a particular use-case in mind? If yes, please add this new decorator to an existing method, such that people can see how it is used in \"real\" situations.",
    "created_at": "2015-03-13T08:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214881",
    "user": "jdemeyer"
}
```

Also: do you have a particular use-case in mind? If yes, please add this new decorator to an existing method, such that people can see how it is used in "real" situations.



---

archive/issue_comments_214882.json:
```json
{
    "body": "Replying to [comment:11 gagern]:\n> > Note that Cython files do actually support the \u200bPEP 3102 syntax even for Python 2.\n> \n> That is good to know, thanks!\n\nYou should probably add this as a comment somewhere.",
    "created_at": "2015-03-13T08:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214882",
    "user": "jdemeyer"
}
```

Replying to [comment:11 gagern]:
> > Note that Cython files do actually support the ​PEP 3102 syntax even for Python 2.
> 
> That is good to know, thanks!

You should probably add this as a comment somewhere.



---

archive/issue_comments_214883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-13T12:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214883",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_214884.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-13T17:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214884",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_214885.json:
```json
{
    "body": "Looks good to me. Its just a temporary measure anyways, we'll rip it out when we move to Python 3",
    "created_at": "2015-04-13T17:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214885",
    "user": "vbraun"
}
```

Looks good to me. Its just a temporary measure anyways, we'll rip it out when we move to Python 3



---

archive/issue_comments_214886.json:
```json
{
    "body": "\n```\n  File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/plot/graphics.py\", line 3403, in GraphicsArray\n    @keyword_only(positional=4, deprecation=16607, extra=\"axes\")\nNameError: name 'keyword_only' is not defined\nMakefile:60: recipe for target 'doc-html' failed\nmake: *** [doc-html] Error 1\n```\n",
    "created_at": "2015-04-14T20:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214886",
    "user": "vbraun"
}
```


```
  File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/plot/graphics.py", line 3403, in GraphicsArray
    @keyword_only(positional=4, deprecation=16607, extra="axes")
NameError: name 'keyword_only' is not defined
Makefile:60: recipe for target 'doc-html' failed
make: *** [doc-html] Error 1
```




---

archive/issue_comments_214887.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-14T20:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214887",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_214888.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-14T21:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214888",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214889.json:
```json
{
    "body": "I forgot the import. Won't have time to test this today. but hope to do so tomorrow.",
    "created_at": "2015-04-14T21:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214889",
    "user": "gagern"
}
```

I forgot the import. Won't have time to test this today. but hope to do so tomorrow.



---

archive/issue_comments_214890.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T06:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214890",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214891.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T06:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214891",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214892.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-15T06:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214892",
    "user": "gagern"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_214893.json:
```json
{
    "body": "This looks better now. Sorry I hadn't tested this as well as I should have before.",
    "created_at": "2015-04-15T06:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214893",
    "user": "gagern"
}
```

This looks better now. Sorry I hadn't tested this as well as I should have before.



---

archive/issue_comments_214894.json:
```json
{
    "body": "Needs to be rebased on sage8.1beta3",
    "created_at": "2017-08-30T18:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214894",
    "user": "mderickx"
}
```

Needs to be rebased on sage8.1beta3



---

archive/issue_comments_214895.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-30T18:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214895",
    "user": "mderickx"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_214896.json:
```json
{
    "body": "Now, after the switch to Python 3, we could revisit this.",
    "created_at": "2020-07-22T17:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214896",
    "user": "mkoeppe"
}
```

Now, after the switch to Python 3, we could revisit this.



---

archive/issue_comments_214897.json:
```json
{
    "body": "Pointers to recent tickets: #29243, #30194",
    "created_at": "2020-08-18T21:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214897",
    "user": "mkoeppe"
}
```

Pointers to recent tickets: #29243, #30194



---

archive/issue_comments_214898.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214898",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_214899.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16370#issuecomment-214899",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
