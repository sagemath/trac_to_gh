# Issue 29105: pari spkg-configure.m4 should check gphelp more carefully

Issue created by migration from https://trac.sagemath.org/ticket/29342

Original creator: mkoeppe

Original creation time: 2020-03-15 20:27:25

CC:  dimpase embray fbissey isuruf @timokau arojas vdelecroix

Follow-up from #29319 for `fedora-31-standard` (https://github.com/mkoeppe/sage/runs/509417970):

```
Installing cypari-2.1.1
    Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) CatalanCould not find translation file, docdir='/usr/bin' at /usr/bin/gphelp line 153.
    subprocess.CalledProcessError: Command '['gphelp', '-raw', 'Catalan']' returned non-zero exit status 2.
```



---

Comment by fbissey created at 2020-03-15 20:47:03

We have to be careful. My memory tells me cypari and `gphelp -raw` needs the documentation installed including the raw `tex` files - uncompressed. In the case of `Catalan` a run with `strace` tells me `gphelp` opens `usersch3.tex`.


---

Comment by mkoeppe created at 2020-03-15 21:11:13

Looks like this error was already discussed in #28242.


---

Comment by mkoeppe created at 2020-03-15 22:02:28

The problem on Fedora is that the docs are not installed by default:

```
# grep tsflags /etc/dnf/dnf.conf 
tsflags=nodocs
```



---

Comment by mkoeppe created at 2020-03-15 22:13:45

One needs to install using  `yum install pari-gp --setopt='tsflags='`


---

Comment by git created at 2020-03-15 22:25:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-03-15 22:48:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-03-15 22:50:17

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-03-18 02:45:10

`@`dimpase: This one also touches fedora - and is ready for review


---

Comment by dimpase created at 2020-03-18 16:13:06

it should be 

```
+'pari-gp --setopt=tsflags='
```

not just

```
+pari-gp --setopt=tsflags=
```

to prevent bootstrap for pulling these two things apart.


---

Comment by mkoeppe created at 2020-03-18 16:15:20

That flag applies to the whole command line.


---

Comment by dimpase created at 2020-03-19 02:57:12

OK, this works, positive review. 

The next obstacle on Fedora 31: there is no openblas.pc, and
so I cooked up one, put it somewhere, pointed PKG_CONFIG_PATH there,
then openblas is recognised along with R, gsl, etc, but `make` ends with


```
make[2]: Entering directory '/home/dima/sagetrac-mirror/build/make'
make[2]: *** No rule to make target '/home/dima/sagetrac-mirror/src/lib/pkgconfig/cblas.pc', needed by '/home/dima/sagetrac-mirror/local/lib/pkgconfig/cblas.pc'.  Stop.
make[2]: Leaving directory '/home/dima/sagetrac-mirror/build/make'
```



---

Comment by dimpase created at 2020-03-19 02:57:12

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-03-19 02:58:25

Thanks!


---

Comment by mkoeppe created at 2020-03-19 03:00:33

Replying to [comment:15 dimpase]:
> The next obstacle on Fedora 31: there is no openblas.pc, and
> so I cooked up one, put it somewhere, pointed PKG_CONFIG_PATH there,
> then openblas is recognised along with R, gsl, etc, but `make` ends with
> 
> {{{
> make[2]: Entering directory '/home/dima/sagetrac-mirror/build/make'
> make[2]: *** No rule to make target '/home/dima/sagetrac-mirror/src/lib/pkgconfig/cblas.pc', needed by '/home/dima/sagetrac-mirror/local/lib/pkgconfig/cblas.pc'.  Stop.
> make[2]: Leaving directory '/home/dima/sagetrac-mirror/build/make'
> }}}

Yes, the pkgconfig mess needs to be cleaned up. #29082


---

Comment by dimpase created at 2020-03-19 03:06:18

Yes, I'm on it.


---

Comment by vbraun created at 2020-03-25 22:48:42

Resolution: fixed
