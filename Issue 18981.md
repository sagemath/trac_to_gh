# Issue 18981: Restrict skew partition input to Schur basis and implement a skew Schur method

archive/issues_018981.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat @nthiery @zabrocki @darijgr @anneschilling\n\nKeywords: schur, symmetric functions\n\nIf you pass a skew partition to a basis of the symmetric functions, you get what should be the skew Schur function:\n\n```\nsage: sp = SkewPartition([[5,3,3,1], [3,2,1]])\nsage: e = SymmetricFunctions(QQ).e()\nsage: e(sp)\ne[2, 2, 1, 1] + e[2, 2, 2] + e[3, 1, 1, 1] + 3*e[3, 2, 1] + e[3, 3] + 2*e[4, 1, 1] + 2*e[4, 2] + e[5, 1]\n```\n\nThis would be corresponding skew Schur function if it was in the Schur basis, however we have\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: e(s(sp))\ne[2, 1, 1, 1, 1] - e[2, 2, 1, 1] - e[3, 1, 1, 1] + e[3, 2, 1]\n```\n\nThis ticket will make skew partition input only valid for Schur functions and implement a method `skew_schur` which handles creating skew Schur functions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19218\n\n",
    "created_at": "2015-09-15T14:53:07Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Restrict skew partition input to Schur basis and implement a skew Schur method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18981",
    "user": "https://github.com/tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat @nthiery @zabrocki @darijgr @anneschilling

Keywords: schur, symmetric functions

If you pass a skew partition to a basis of the symmetric functions, you get what should be the skew Schur function:

```
sage: sp = SkewPartition([[5,3,3,1], [3,2,1]])
sage: e = SymmetricFunctions(QQ).e()
sage: e(sp)
e[2, 2, 1, 1] + e[2, 2, 2] + e[3, 1, 1, 1] + 3*e[3, 2, 1] + e[3, 3] + 2*e[4, 1, 1] + 2*e[4, 2] + e[5, 1]
```

This would be corresponding skew Schur function if it was in the Schur basis, however we have

```
sage: s = SymmetricFunctions(QQ).s()
sage: e(s(sp))
e[2, 1, 1, 1, 1] - e[2, 2, 1, 1] - e[3, 1, 1, 1] + e[3, 2, 1]
```

This ticket will make skew partition input only valid for Schur functions and implement a method `skew_schur` which handles creating skew Schur functions.

Issue created by migration from https://trac.sagemath.org/ticket/19218





---

archive/issue_comments_260032.json:
```json
{
    "body": "While I was at it, there were a couple of other things I tweaked. Most of these were done because of my initial changes broke something else small. (I was able to clean up a little bit of Sage's import hell.)\n\nI simplified the `_element_constructor_` for the bases in order to get the error message I want and those two cases are both handled by `R(x)` and in cython:\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: %timeit s(5)\nThe slowest run took 86.46 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 2.95 \u00b5s per loop\nsage: %timeit s(5/2)\nThe slowest run took 21.65 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 3.15 \u00b5s per loop\n```\n\nversus previously\n\n```\nsage: %timeit s(5)\nThe slowest run took 248.01 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 3.04 \u00b5s per loop\nsage: %timeit s(5/2)\nThe slowest run took 20.99 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 3.19 \u00b5s per loop\n```\n\nSo a marginal speed gain, but still a gain of ~2% (and much more simple code structure).\n\nAdditionally I made a few changes of `Partition(x)` to `_Partitions(x)` because it is slightly faster, which matters in these tight loops:\n\n```\nsage: from sage.combinat.partition import _Partitions\nsage: %timeit Partition([7,5,5,3,2,1,1])\nThe slowest run took 203.43 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 13.9 \u00b5s per loop\nsage: %timeit _Partitions([7,5,5,3,2,1,1])\nThe slowest run took 11.24 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 13.3 \u00b5s per loop\n\nsage: %timeit _Partitions([7,5,5,3,2,1,1,0,0])\nThe slowest run took 5.16 times longer than the fastest. This could mean that an intermediate result is being cached \n100000 loops, best of 3: 15.9 \u00b5s per loop\nsage: %timeit Partition([7,5,5,3,2,1,1,0,0])\nThe slowest run took 4.42 times longer than the fastest. This could mean that an intermediate result is being cached \n10000 loops, best of 3: 16.7 \u00b5s per loop\n```\n\nWe should probably make this change in the rest of the code in other parts of combinat, especially the SF code as this is usually called frequently.\n----\nNew commits:",
    "created_at": "2015-09-15T15:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260032",
    "user": "https://github.com/tscrim"
}
```

While I was at it, there were a couple of other things I tweaked. Most of these were done because of my initial changes broke something else small. (I was able to clean up a little bit of Sage's import hell.)

I simplified the `_element_constructor_` for the bases in order to get the error message I want and those two cases are both handled by `R(x)` and in cython:

```
sage: s = SymmetricFunctions(QQ).s()
sage: %timeit s(5)
The slowest run took 86.46 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 2.95 µs per loop
sage: %timeit s(5/2)
The slowest run took 21.65 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 3.15 µs per loop
```

versus previously

```
sage: %timeit s(5)
The slowest run took 248.01 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 3.04 µs per loop
sage: %timeit s(5/2)
The slowest run took 20.99 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 3.19 µs per loop
```

So a marginal speed gain, but still a gain of ~2% (and much more simple code structure).

Additionally I made a few changes of `Partition(x)` to `_Partitions(x)` because it is slightly faster, which matters in these tight loops:

```
sage: from sage.combinat.partition import _Partitions
sage: %timeit Partition([7,5,5,3,2,1,1])
The slowest run took 203.43 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 13.9 µs per loop
sage: %timeit _Partitions([7,5,5,3,2,1,1])
The slowest run took 11.24 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 13.3 µs per loop

sage: %timeit _Partitions([7,5,5,3,2,1,1,0,0])
The slowest run took 5.16 times longer than the fastest. This could mean that an intermediate result is being cached 
100000 loops, best of 3: 15.9 µs per loop
sage: %timeit Partition([7,5,5,3,2,1,1,0,0])
The slowest run took 4.42 times longer than the fastest. This could mean that an intermediate result is being cached 
10000 loops, best of 3: 16.7 µs per loop
```

We should probably make this change in the rest of the code in other parts of combinat, especially the SF code as this is usually called frequently.
----
New commits:



---

archive/issue_comments_260033.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-15T15:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260033",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_260034.json:
```json
{
    "body": "\n```\n+            s = self.realization_of().schur()\n+            from sage.combinat.skew_partition import SkewPartitions\n+            import sage.libs.lrcalc.lrcalc as lrcalc\n+            if x not in SkewPartitions():\n+                raise ValueError(\"not a valid skew partition\")\n```\n\nShouldn't the if-check be before the other instructions? Maybe even in the element constructor, before calling the `skew_schur` function, seeing that Python is usually slow at handling exceptions?\n\nOther than this, the patch looks good if someone can check that (1) elements of the base ring and elements coercing into the base ring still coerce OK (please check on various bases), and (2) the doctests pass. (I don't have time to fire up Sage...) Glad you caught this bug, Travis!",
    "created_at": "2015-09-15T15:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260034",
    "user": "https://github.com/darijgr"
}
```


```
+            s = self.realization_of().schur()
+            from sage.combinat.skew_partition import SkewPartitions
+            import sage.libs.lrcalc.lrcalc as lrcalc
+            if x not in SkewPartitions():
+                raise ValueError("not a valid skew partition")
```

Shouldn't the if-check be before the other instructions? Maybe even in the element constructor, before calling the `skew_schur` function, seeing that Python is usually slow at handling exceptions?

Other than this, the patch looks good if someone can check that (1) elements of the base ring and elements coercing into the base ring still coerce OK (please check on various bases), and (2) the doctests pass. (I don't have time to fire up Sage...) Glad you caught this bug, Travis!



---

archive/issue_comments_260035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-15T15:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_260036.json:
```json
{
    "body": "Replying to [comment:2 darij]:\n> Shouldn't the if-check be before the other instructions?\n\nGood point, done.\n\n> Maybe even in the element constructor, before calling the `skew_schur` function, seeing that Python is usually slow at handling exceptions?\n\nThis is the first thing that is checked in the element constructor. This is the first thing that is checked by the Schur functions element constructor, and exception generation and handling is faster than checking if something is a skew partition a second time. Although if you really want speed, you probably shouldn't use the element constructor (as that also goes through the coercion framework first).\n\n> Other than this, the patch looks good if someone can check that (1) elements of the base ring and elements coercing into the base ring still coerce OK (please check on various bases), and (2) the doctests pass. (I don't have time to fire up Sage...) Glad you caught this bug, Travis!\n\nChances are I could probably remove the coercion of elements into the base ring because that should be handled by the coercion framework beforehand (as this is the conversion step). However that seemed too likely to be a can of worms for me to change it here...",
    "created_at": "2015-09-15T15:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260036",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:2 darij]:
> Shouldn't the if-check be before the other instructions?

Good point, done.

> Maybe even in the element constructor, before calling the `skew_schur` function, seeing that Python is usually slow at handling exceptions?

This is the first thing that is checked in the element constructor. This is the first thing that is checked by the Schur functions element constructor, and exception generation and handling is faster than checking if something is a skew partition a second time. Although if you really want speed, you probably shouldn't use the element constructor (as that also goes through the coercion framework first).

> Other than this, the patch looks good if someone can check that (1) elements of the base ring and elements coercing into the base ring still coerce OK (please check on various bases), and (2) the doctests pass. (I don't have time to fire up Sage...) Glad you caught this bug, Travis!

Chances are I could probably remove the coercion of elements into the base ring because that should be handled by the coercion framework beforehand (as this is the conversion step). However that seemed too likely to be a can of worms for me to change it here...



---

archive/issue_comments_260037.json:
```json
{
    "body": "The patch looks good to me. Thanks for fixing the bug, Travis!",
    "created_at": "2015-09-16T01:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260037",
    "user": "https://github.com/anneschilling"
}
```

The patch looks good to me. Thanks for fixing the bug, Travis!



---

archive/issue_comments_260038.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-16T01:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260038",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_260039.json:
```json
{
    "body": "Thanks to both.",
    "created_at": "2015-09-16T01:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260039",
    "user": "https://github.com/tscrim"
}
```

Thanks to both.



---

archive/issue_comments_260040.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-17T09:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18981#issuecomment-260040",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
