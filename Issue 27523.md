# Issue 27523: Generalized Permutohedra and type H4 4-uniform polytopes

Issue created by migration from https://trac.sagemath.org/ticket/27760

Original creator: jipilab

Original creation time: 2019-05-02 14:56:33

CC:  winfried jipilab mkoeppe vdelecroix tscrim

Keywords: polytopes, non-rational, normaliz

One sort of generalized permutahedra consists in putting the starting point, which is usually taken inside the fundamental chamber, on the boundary of the fundamental chamber.

See https://arxiv.org/abs/1904.11029 for a recent related paper.

This ticket implements the generalized permutahedra and on the way, adds the fifteen H4 4-uniform polytopes.

See https://en.wikipedia.org/wiki/H4_polytope for a list of them.

Many of them are quite large and can only be computed in reasonable time using the backend `normaliz`.


---

Comment by git created at 2019-05-02 15:02:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-02 15:10:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-03 10:12:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-03 11:34:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by git created at 2019-07-21 16:05:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-21 16:09:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-07-21 16:14:36

Changing status from new to needs_review.


---

Comment by jipilab created at 2019-07-21 16:14:36

Changing keywords from "polytopes, non-rational, normaliz" to "polytopes, non-rational, normaliz, days100".


---

Comment by chapoton created at 2019-07-21 20:07:53

apparemment, la doc ne compile pas, voir patchbot


---

Comment by jipilab created at 2019-07-21 20:13:56

Replying to [comment:10 chapoton]:
> apparemment, la doc ne compile pas, voir patchbot

Hm, all right. I'm on it!


---

Comment by git created at 2019-07-21 20:38:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-22 09:55:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-07-22 20:18:23

* missing the word 'polytope' here, I think:

```
The runcitruncated 600-cell is a 4-dimensional 4-uniform in the `H_4`
```

and the same in all the examples.

* Here, you could remove the `[]`

```
sum([adjusted_col[j]**2 for j in range(n) if j != i])
```


apart from that, ready to go..


---

Comment by git created at 2019-07-23 06:36:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-07-23 09:22:22

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-07-23 09:22:22

ok, good to go


---

Comment by jipilab created at 2019-07-23 14:43:47

Merci!


---

Comment by vbraun created at 2019-07-25 20:13:22

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-07-25 20:13:22

This dies on most 32-bit buildbots:

```
sage: perm_b3 = polytopes.generalized_permutahedron(['B',3]); perm_b3 ## line 2324 ##
A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
sage: perm_b3_reg = polytopes.generalized_permutahedron(['B',3],regular=True); perm_b3_reg # long time - 12sec. ## line 2326 ##
------------------------------------------------------------------------
/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5f22)[0xf5fbdf22]
/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5fc6)[0xf5fbdfc6]
/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x76e5)[0xf5fbf6e5]
linux-gate.so.1(__kernel_sigreturn+0x0)[0xf77b6ca0]
/home/buildbot/slave/sage_git/build/local/lib/libgmp.so.23(__gmpn_mul_basecase+0x83)[0xf6cabd4b]
------------------------------------------------------------------------
Attaching gdb to process id 20319.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/library.py  # Timed out
----------------------------------------------------------------------
```



---

Comment by git created at 2019-07-28 10:37:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-07-28 10:37:46

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-07-28 11:18:04

ok, let us try again


---

Comment by chapoton created at 2019-07-28 11:18:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-07-29 13:03:21

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-07-29 13:03:21


```
**********************************************************************
File "src/sage/geometry/polyhedron/library.py", line 2324, in sage.geometry.polyhedron.library.Polytopes.generalized_permutahedron
Failed example:
    perm_b3 = polytopes.generalized_permutahedron(['B',3]); perm_b3
Expected:
    A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
    A 3-dimensional polyhedron in AA^3 defined as the convex hull of 48 vertices
Got:
    A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
**********************************************************************
1 item had failures:
   1 of  21 in sage.geometry.polyhedron.library.Polytopes.generalized_permutahedron
    [240 tests, 1 failure, 156.68 s]
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/library.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by jipilab created at 2019-08-21 12:37:40

Replying to [comment:23 vbraun]:
> {{{
> **********************************************************************
> File "src/sage/geometry/polyhedron/library.py", line 2324, in sage.geometry.polyhedron.library.Polytopes.generalized_permutahedron
> Failed example:
>     perm_b3 = polytopes.generalized_permutahedron(['B',3]); perm_b3
> Expected:
>     A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
>     A 3-dimensional polyhedron in AA^3 defined as the convex hull of 48 vertices
> Got:
>     A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
> **********************************************************************
> 1 item had failures:
>    1 of  21 in sage.geometry.polyhedron.library.Polytopes.generalized_permutahedron
>     [240 tests, 1 failure, 156.68 s]
> ----------------------------------------------------------------------
> sage -t --long src/sage/geometry/polyhedron/library.py  # 1 doctest failed
> ----------------------------------------------------------------------
> }}}

I have trouble figuring out how this failure occurred. 

The expected block is not as the attached branch would predict. Namely, the second line is absent. I merged the last version of develop into this ticket and made a test on my machine and I got:


```
jplabbe@blackbomb:~/sage/src/sage/geometry/polyhedron$ sage -t library.py 
Using --optional=4ti2,bliss,build,dochtml,e_antic,gfortran,latte_int,lidia,lrslib,memlimit,ninja_build,normaliz,pynormaliz,python2,sage,topcom
Doctesting 1 file.
sage -t library.py
    [305 tests, 77.99 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 78.1 seconds
    cpu time: 78.0 seconds
    cumulative wall time: 78.0 seconds
```


I get 305 tests in total. Would it be possible to get more feedback on how this failing doctest occurred? (which optional packages were used?)


---

Comment by git created at 2019-08-21 12:41:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-08-21 12:42:00

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-08-21 12:45:15

Let's have another run of bots to see if the problem still occurs. This failure is strange.


---

Comment by chapoton created at 2019-08-22 10:08:45

patchbot reports another failure


---

Comment by git created at 2019-08-22 10:49:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-08-22 10:50:38

Found it.

It was a missing tag from fixing comment 19. Should be good to go now...


---

Comment by chapoton created at 2019-08-23 06:35:48

Adding tags on the results of doctests make no sense.

This does not fix the patchbot failure.


---

Comment by jipilab created at 2019-08-23 08:44:34

Replying to [comment:31 chapoton]:
> Adding tags on the results of doctests make no sense.
> 
> This does not fix the patchbot failure.

That's what I thought at first too!

But then, that's the only way I can make sense of seeing 


```
Expected:
    A 3-dimensional polyhedron in (Number Field in a with defining polynomial x^2 - 2 with a = 1.414213562373095?)^3 defined as the convex hull of 48 vertices
    A 3-dimensional polyhedron in AA^3 defined as the convex hull of 48 vertices
```


which are two distinct consecutive outputs of test, the second of which is not tested. I was thinking that it might preparse the string and remove the not tested things and thus the expected block would now consist of two lines.

Otherwise, I have no clue how come the expected block would consist of two lines, it is simply not as the source entails!?

Puzzled.


---

Comment by jipilab created at 2019-08-23 08:49:57

Replying to [comment:31 chapoton]:
> Adding tags on the results of doctests make no sense.
> 
> This does not fix the patchbot failure.

From the patch bot shortog, the following information is a bit obscure:


```
Expected:
    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 3 tests in sage/rings/invariants/invariant_theory.py that are not being run
Got:
    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 1 unexpected tests being run in sage/geometry/polyhedron/library.py
    There are 3 tests in sage/rings/invariants/invariant_theory.py that are not being run
**********************************************************************
```


I guess it is the same test that causes a problem, but I have no output to inspect. Also, I am curious, what is an "unexpected test"? It's the first time I see such a thing.


---

Comment by git created at 2019-08-23 09:05:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jipilab created at 2019-08-23 09:06:34

Replying to [comment:34 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:

I removed the unless tag on the doctest result...


---

Comment by chapoton created at 2019-08-23 19:58:09

Apparemment, ce qui pose problème est le fait que l'annotation contienne `"64-bits"`.


---

Comment by git created at 2019-08-23 19:58:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-08-24 08:10:50

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-08-24 08:10:50

ok, let us try again


---

Comment by jipilab created at 2019-08-26 10:13:05

Replying to [comment:36 chapoton]:
> Apparemment, ce qui pose problème est le fait que l'annotation contienne `"64-bits"`.
> 

Wow. I see. Good to know. It looks like it's passing the test now at least.


---

Comment by vbraun created at 2019-08-26 22:15:05

Resolution: fixed
