# Issue 11554: Failure to coerce 1/q into its own LaurentPolynomialRing

archive/issues_011554.json:
```json
{
    "body": "Assignee: malb\n\nCC:  andrew.mathas rws\n\nConsider:\n\n\n```\nsage: P.<q> = LaurentPolynomialRing(QQ)\nsage: q in P\nTrue\nsage: P(q)\nq\nsage: q^(-1) in P\nTrue\nsage: 1/q in P\nFalse\nsage: P(q^(-1))\n```\n\n\nThe last statement raises an exception.\n\n(this is not a duplicate of #7839)\n\nIssue created by migration from https://trac.sagemath.org/ticket/11726\n\n",
    "created_at": "2011-08-24T01:10:26Z",
    "labels": [
        "commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Failure to coerce 1/q into its own LaurentPolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11554",
    "user": "boothby"
}
```
Assignee: malb

CC:  andrew.mathas rws

Consider:


```
sage: P.<q> = LaurentPolynomialRing(QQ)
sage: q in P
True
sage: P(q)
q
sage: q^(-1) in P
True
sage: 1/q in P
False
sage: P(q^(-1))
```


The last statement raises an exception.

(this is not a duplicate of #7839)

Issue created by migration from https://trac.sagemath.org/ticket/11726





---

archive/issue_comments_129914.json:
```json
{
    "body": "Changing assignee from malb to boothby.",
    "created_at": "2011-08-25T04:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129914",
    "user": "boothby"
}
```

Changing assignee from malb to boothby.



---

archive/issue_comments_129915.json:
```json
{
    "body": "Changing keywords from \"\" to \"days32\".",
    "created_at": "2011-08-25T04:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129915",
    "user": "boothby"
}
```

Changing keywords from "" to "days32".



---

archive/issue_comments_129916.json:
```json
{
    "body": "Changing keywords from \"days32\" to \"sd32\".",
    "created_at": "2011-08-25T05:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129916",
    "user": "boothby"
}
```

Changing keywords from "days32" to "sd32".



---

archive/issue_comments_129917.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-25T05:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129917",
    "user": "boothby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129918.json:
```json
{
    "body": "Attachment [trac_11726.patch](tarball://root/attachments/some-uuid/ticket11726/trac_11726.patch) by boothby created at 2011-08-25 05:44:20",
    "created_at": "2011-08-25T05:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129918",
    "user": "boothby"
}
```

Attachment [trac_11726.patch](tarball://root/attachments/some-uuid/ticket11726/trac_11726.patch) by boothby created at 2011-08-25 05:44:20



---

archive/issue_comments_129919.json:
```json
{
    "body": "This doesn't pass doctests on any recent version of Sage (see patchbot logs)",
    "created_at": "2012-03-11T14:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129919",
    "user": "davidloeffler"
}
```

This doesn't pass doctests on any recent version of Sage (see patchbot logs)



---

archive/issue_comments_129920.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T14:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129920",
    "user": "davidloeffler"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129921.json:
```json
{
    "body": "Attachment [trac_11726-univariate_Laurent_polynomials-ts.patch](tarball://root/attachments/some-uuid/ticket11726/trac_11726-univariate_Laurent_polynomials-ts.patch) by tscrim created at 2013-09-19 14:54:15",
    "created_at": "2013-09-19T14:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129921",
    "user": "tscrim"
}
```

Attachment [trac_11726-univariate_Laurent_polynomials-ts.patch](tarball://root/attachments/some-uuid/ticket11726/trac_11726-univariate_Laurent_polynomials-ts.patch) by tscrim created at 2013-09-19 14:54:15



---

archive/issue_comments_129922.json:
```json
{
    "body": "Here's a new version of the patch which applies on sage-5.12.beta5 and depends on #14261 (which is currently being reviewed). This also fixes many things that annoy me with when working with Laurent polynomials, it particular division and simplification in the fraction field.\n\nFor patchbot:\n\nApply: trac_11726-univariate_Laurent_polynomials-ts.patch\u200b",
    "created_at": "2013-09-19T14:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129922",
    "user": "tscrim"
}
```

Here's a new version of the patch which applies on sage-5.12.beta5 and depends on #14261 (which is currently being reviewed). This also fixes many things that annoy me with when working with Laurent polynomials, it particular division and simplification in the fraction field.

For patchbot:

Apply: trac_11726-univariate_Laurent_polynomials-ts.patchâ€‹



---

archive/issue_comments_129923.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-19T14:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129923",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129924.json:
```json
{
    "body": "What is the state of this? How much of this has been done in #15345?",
    "created_at": "2014-02-15T17:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129924",
    "user": "darij"
}
```

What is the state of this? How much of this has been done in #15345?



---

archive/issue_comments_129925.json:
```json
{
    "body": "I've converted the patch to a git branch and made some more fixes to the coercions and doctests. Not much of this was done in #15345, but there are some changes there I merged in to avoid conflicts.\n----\nLast 10 new commits:",
    "created_at": "2014-02-16T20:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129925",
    "user": "tscrim"
}
```

I've converted the patch to a git branch and made some more fixes to the coercions and doctests. Not much of this was done in #15345, but there are some changes there I merged in to avoid conflicts.
----
Last 10 new commits:



---

archive/issue_comments_129926.json:
```json
{
    "body": "Changing keywords from \"sd32\" to \"sd32, Laurent polynomials\".",
    "created_at": "2014-03-04T09:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129926",
    "user": "chapoton"
}
```

Changing keywords from "sd32" to "sd32, Laurent polynomials".



---

archive/issue_comments_129927.json:
```json
{
    "body": "Some extra methods for Laurent polynomials in these tickets.",
    "created_at": "2014-03-04T17:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129927",
    "user": "tscrim"
}
```

Some extra methods for Laurent polynomials in these tickets.



---

archive/issue_comments_129928.json:
```json
{
    "body": "I have rebased on 6.2.beta4. I have changed the branch here. Maybe I should have merged ?\n----\nNew commits:",
    "created_at": "2014-03-12T20:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129928",
    "user": "chapoton"
}
```

I have rebased on 6.2.beta4. I have changed the branch here. Maybe I should have merged ?
----
New commits:



---

archive/issue_comments_129929.json:
```json
{
    "body": "The new branch is fine (although I prefer the merge because I don't see any harm in merge commits).",
    "created_at": "2014-03-14T03:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129929",
    "user": "tscrim"
}
```

The new branch is fine (although I prefer the merge because I don't see any harm in merge commits).



---

archive/issue_comments_129930.json:
```json
{
    "body": "Docs build. Long tests are fine in rings/. I would give positive but I'm not sure if you are finished yet.",
    "created_at": "2014-03-31T15:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129930",
    "user": "rws"
}
```

Docs build. Long tests are fine in rings/. I would give positive but I'm not sure if you are finished yet.



---

archive/issue_comments_129931.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-02T01:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129931",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129932.json:
```json
{
    "body": "Nope, I'm finished with this.",
    "created_at": "2014-04-02T01:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129932",
    "user": "tscrim"
}
```

Nope, I'm finished with this.



---

archive/issue_comments_129933.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-04-04T16:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129933",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_129934.json:
```json
{
    "body": "Fails doctests\n\n```\nsage -t src/doc/en/thematic_tutorials/lie/kazhdan_lusztig_polynomials.rst\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/lie/kazhdan_lusztig_polynomials.rst\", line 17, in doc.en.thematic_tutorials.lie.kazhdan_lusztig_polynomials\nFailed example:\n    KL.R(s2, s2*s1*s3*s2)\nExpected:\n    q^3 - 3*q^2 + 3*q - 1\nGot:\n    -1 + 3*q - 3*q^2 + q^3\n```\n",
    "created_at": "2014-04-04T16:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129934",
    "user": "vbraun"
}
```

Fails doctests

```
sage -t src/doc/en/thematic_tutorials/lie/kazhdan_lusztig_polynomials.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/lie/kazhdan_lusztig_polynomials.rst", line 17, in doc.en.thematic_tutorials.lie.kazhdan_lusztig_polynomials
Failed example:
    KL.R(s2, s2*s1*s3*s2)
Expected:
    q^3 - 3*q^2 + 3*q - 1
Got:
    -1 + 3*q - 3*q^2 + q^3
```




---

archive/issue_comments_129935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-04T19:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129936.json:
```json
{
    "body": "I have corrected the doctest.",
    "created_at": "2014-04-04T19:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129936",
    "user": "chapoton"
}
```

I have corrected the doctest.



---

archive/issue_comments_129937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-04T19:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129937",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129938.json:
```json
{
    "body": "I think there was more than one, please test.",
    "created_at": "2014-04-04T19:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129938",
    "user": "vbraun"
}
```

I think there was more than one, please test.



---

archive/issue_comments_129939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-04T19:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129940.json:
```json
{
    "body": "Confirm all tutorial tests pass. Oh well, good catch...",
    "created_at": "2014-04-05T07:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129940",
    "user": "rws"
}
```

Confirm all tutorial tests pass. Oh well, good catch...



---

archive/issue_comments_129941.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-05T07:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129941",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129942.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/algebras/hall_algebra.py  # 13 doctests failed\nsage -t --long src/sage/groups/braid.py  # 8 doctests failed\n```\n",
    "created_at": "2014-04-06T17:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129942",
    "user": "vbraun"
}
```


```
sage -t --long src/sage/algebras/hall_algebra.py  # 13 doctests failed
sage -t --long src/sage/groups/braid.py  # 8 doctests failed
```




---

archive/issue_comments_129943.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-04-06T17:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129943",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_129944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-08T12:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129944",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-08T12:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129946.json:
```json
{
    "body": "I have implemented a `__floordiv__` method for Laurent polynomials in one variable, and corrected the doctests. Needs review.",
    "created_at": "2014-04-08T12:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129946",
    "user": "chapoton"
}
```

I have implemented a `__floordiv__` method for Laurent polynomials in one variable, and corrected the doctests. Needs review.



---

archive/issue_comments_129947.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-08T12:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129947",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129948.json:
```json
{
    "body": "You seem to have this uncanny ability to do things the night (well for me at least) before I'm going to do them.",
    "created_at": "2014-04-08T16:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129948",
    "user": "tscrim"
}
```

You seem to have this uncanny ability to do things the night (well for me at least) before I'm going to do them.



---

archive/issue_comments_129949.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-08T16:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129949",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129950.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-09T09:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11554#issuecomment-129950",
    "user": "vbraun"
}
```

Resolution: fixed
