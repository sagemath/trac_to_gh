# Issue 12261: make zn_poly respect global CC flag

Issue created by migration from https://trac.sagemath.org/ticket/12433

Original creator: ohanar

Original creation time: 2012-02-04 18:07:15

Assignee: GeorgSWeber

CC:  roed

The zn_poly spkg currently does not respect the global CC flag, we should fix this (for instance for #12426).

I've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/zn_poly-0.9.p6.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/zn_poly-0.9.p6.spkg).


---

Attachment

for review purposes


---

Comment by ohanar created at 2012-02-04 18:07:33

Changing status from new to needs_review.


---

Comment by leif created at 2012-03-17 01:39:53

Same here: `$CC` has to be quoted.


---

Comment by leif created at 2012-03-17 01:39:53

Changing status from needs_review to needs_work.


---

Comment by leif created at 2012-04-08 05:08:13

Oh, the zn_poly spkg is a real mess... :-)

I'll make a p7 cleaning up `spkg-install` and `spkg-check`, removing the obsolete Debian stuff, using `patch` to apply the patches, and -- more importantly -- modifying `makemakefile.py` to produce a proper Makefile, respecting `CC` (and `CXX`, not `CPP`!, likewise `CXXFLAGS` instead of `CPPFLAGS`, and using `CPPFLAGS` for what they're meant to be used), using `LDFLAGS` consistently...

Then we won't have to use `$MAKE ... CC=...` etc.


---

Comment by leif created at 2012-04-08 12:34:14

Diff between Andrew's and my new spkg.  For reference / review only.


---

Attachment

Diff between the previous spkg in Sage and my new spkg.  For reference / review only.


---

Comment by leif created at 2012-04-08 12:58:19

Changing status from needs_work to needs_review.


---

Comment by leif created at 2012-04-08 12:58:19

Changing component from build to packages.


---

Comment by leif created at 2012-04-08 12:58:19

Ok, here's something to review... :P

Left a few TODOs, as well as a lot of (hopefully obsolete) code I just commented out right now.

I've attached diffs between the p5, p6 and p7 spkgs, and the new patch to `makemakefile.py`, too, for easier reviewing.  (You don't have to apply any of these.)


---

Comment by leif created at 2012-04-08 12:58:19

Changing keywords from "" to "spkg hardcoded hard-coded CC CXX compiler".


---

Comment by leif created at 2012-04-14 21:57:18

Personal note: Add a work-around for GCC 4.7.0 on ia64 (cf. #12765).


---

Comment by leif created at 2012-04-19 20:29:13

Replying to [comment:5 leif]:
> Personal note: Add a work-around for GCC 4.7.0 on ia64 (cf. #12765).

... and probably add a patch to `#define` rather than `typedef` `ulong`.


---

Comment by leif created at 2012-04-20 03:36:09

Replying to [comment:6 leif]:
> Replying to [comment:5 leif]:
> > Personal note: Add a work-around for GCC 4.7.0 on ia64 (cf. #12765).
> 
> ... and probably add a patch to `#define` rather than `typedef` `ulong`.

Did so.

David, does that fix your issue?


---

Attachment

Diff between my p7 and p8 spkgs.  For reference / review only.


---

Attachment

Diff between the p5 and p8 spkgs. For reference / review only.


---

Comment by jdemeyer created at 2012-05-28 17:37:32

Changing keywords from "spkg hardcoded hard-coded CC CXX compiler" to "spkg hardcoded hard-coded CC CXX compiler sd40.5".


---

Attachment

New / modified patch to `src/makemakefile.py`.  For easier review only; do not apply.


---

Comment by jdemeyer created at 2012-05-28 18:50:43

Looks good to me.  There will be a follow-up at #12751 to remove the GCC-4.7.x Itanium work-around.


---

Comment by jdemeyer created at 2012-05-28 18:59:00

Changing status from needs_review to positive_review.


---

Comment by Snark created at 2012-06-16 20:09:21

I have two questions :
1. have the modifications to upstream makemakefile.py been forwarded upstream?
2. wouldn't it have been simpler to write an autotools-based build system? [to forward upstream too]


---

Comment by jdemeyer created at 2012-06-16 20:52:05

Replying to [comment:12 Snark]:
> I have two questions :
> 1. have the modifications to upstream makemakefile.py been forwarded upstream?
I don't think so.

> 2. wouldn't it have been simpler to write an autotools-based build system? [to forward upstream too]
Certainly not simpler. Maybe better, yes. Also, would upstream accept it?


---

Comment by jdemeyer created at 2012-07-07 22:29:40

Resolution: fixed
