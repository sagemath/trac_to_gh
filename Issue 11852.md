# Issue 11852: 90% doctest coverage thrust metaticket

Issue created by migration from https://trac.sagemath.org/ticket/12024

Original creator: was

Original creation time: 2011-11-13 20:40:05

Assignee: mvngu

CC:  kcrisman

After deleting the server directory we need to add doctests to about
588 more functions to get coverage to 90%, which is a major goal for
sage-5.0, which we've been working on getting to for over a year now.
I did an audit and came up with about 350 functions in 18 files for
which adding coverage will not be too hard.  Some are disturbing,
e.g., where a *huge* patch was *recently* added to Sage with over 100
untested functions, due to sloppy refereeing and release management.

Just edit the ticket description and add your name after the * that
you will get coverage to 100% on that file.  You an also create a
ticket with your tests (put #number) in.  Then it will be easy to
referee all these doctest patches.  Try to make different tickets
if/when you find bugs, and restrict your ticket to just doctests so it
is easy to referee.    You can also add another file to the list. 

Probably Easy:

 * algebras/free_algebra_quotient_element.py: 0% (0 of 12)

 * databases/stein_watkins.py: 0% (0 of 15) -- easy, since there are tons of examples at the top already

 * gsl/interpolation.pyx: 0% (0 of 9) -- easy, examples at top and easy math

 * interfaces/psage.py: 0% (0 of 13) -- easy, since lots of examples at top

 * matrix/benchmark.py: 0% (0 of 29) -- easy; just run each function and paste into an EXAMPLES:: section.   This would also provide some useful additional testing.  Maybe use non-default arguments so not too slow.

 * misc/log.py: 0% (0 of 42) -- just make object and call methods; easy

 * monoids/monoid.py: 0% (0 of 3) -- easy

 * algebras/free_algebra_quotient.py: 6% (1 of 16) -- there is a big example in there -- just use it to construct similar examples everywhere else int he file. 


Probably Medium:

 * libs/mpmath/ext_main.pyx: 7% (8 of 111) -- How the *hell* did this get into Sage with a coverage score of 7%?!!??  This was added several years after we started a 100% doctest policy.  This appeared in http://trac.sagemath.org/sage_trac/ticket/8159 where the positive review is from Harald Schilly: "That was easy, all tests pass ... green light from me! I'm setting this to needs_review, and start with a positiv review from me."    Yes, it's easy for all tests to pass when there are only 7% tests.  Oops.   It will be a lot of work to properly doctest this file, but much of it is straightforward (e.g., examples for the mpnumber) class. 

 * rings/polynomial/polynomial_compiled.pyx: 0% (0 of 20) -- just a bunch of little classes for working with "optimized" polynomials, which is actually used somewhere, evidently.  Not a single example.  Either doctest it completely, by following how it is used by polynomial_element.pyx, or delete it because maybe fast_callable is better?  But watch out for large degree, since fast_callable segfaults if the degree is large, so this polynomial_compiled.pyx might have some real value.

 * media/wav.py: 0% (0 of 25) -- mostly just a bunch of functions to get basic info about a wave file; what makes this harder is you have to get a .wav file and put it somewhere in Sage to be used for testing.  You can probably generate an empty wave file by using the kwds constructor of the class, save it to a temp file, and use it, but that is boring. 

 * matrix/matrix_window.pyx: 0% (0 of 26) -- look at some code elsewhere that uses this, and just go through examples; probably not so hard
 * matrix/matrix_window_modn_dense.pyx: 0% (0 of 11) 


Probably Harder:

 * categories/action.pyx: 0% (0 of 31)


Delete from SAGE?!:

 * databases/bz2Pickle.py  -- looks stupid and not used anywhere!

 * databases/db.py: 0% (0 of 21) -- also maybe not used anywhere; I think we shoudl remove ZODB anyways.

 * databases/gamma0wt2.py: 0% (0 of 7) -- delete


---

Comment by fredrik.johansson created at 2011-11-14 20:04:37

The file from hell is #8791


---

Comment by was created at 2011-11-14 20:10:56

Replying to [comment:3 fredrik.johansson]:
> The file from hell is #8791

I've put a link above, added your patch to 8791 directly to avoid confusion, and set it to "needs review".  Thanks!    And we will consider reviewing this a very high priority.


---

Comment by kcrisman created at 2012-01-19 01:52:20

Changing priority from major to blocker.


---

Comment by kcrisman created at 2012-01-19 01:52:20

Just as an interim update, from a sage-devel thread.

```

> This is also a good occasion to paste "sage -coverageall" output from 
> 5.0.prealpha0: 
> Overall weighted coverage score:  86.3% 
> Total number of functions:  28917 
> We need 1056 more function to get to 90% coverage. 
> We need 2502 more function to get to 95% coverage. 
> We need 3658 more function to get to 99% coverage. 


Deleting sage/server (the old old notebook that can go away in 5.0, 
IIRC) gives us this: 
Overall weighted coverage score:  88.1% 
Total number of functions:  27936 
We need  516 more function to get to 90% coverage. 
We need 1913 more function to get to 95% coverage. 
We need 3031 more function to get to 99% coverage. 
```

I've also moved the milestone and made this a blocker for 5.0, since it has been one of the goals for several years.  TBDFL or release manager can change this if that's not appropriate.


---

Comment by was created at 2012-01-19 02:35:30

> TBDFL or release manager can change this if that's not appropriate.

+1 to making this a blocker.  We only have 1.9% to go!


---

Comment by kcrisman created at 2012-02-16 04:46:36

Changing the number left to doctest in each category in the description is annoying.  If someone else wants to do that, please do!


---

Comment by jlopez created at 2012-02-26 14:48:33

I tried to claim algebras/free_algebra_quotient.py just to find out that it already has 100% doctest coverage in sage 5.0 beta 2.
Ticket #12593 can be closed as invalid.


---

Comment by ppurka created at 2012-03-01 11:40:48

The two remaining functions which are not directly or indirectly doctested probably don't need doctesting.


---

Comment by jdemeyer created at 2012-04-02 09:18:33

Current status in the hopefully soon-to-be-released sage-5.0.beta12:

```
Overall weighted coverage score:  88.1%
Total number of functions:  29436
We need  551 more function to get to 90% coverage.
```



---

Comment by kcrisman created at 2012-04-02 15:17:41

What will that be once #11409 is deleted?


---

Comment by davidloeffler created at 2012-04-04 09:40:14

Taking a vanilla beta11 and installing #11409 plus a few patches which will be in beta12 (#7926, #12747 and #12749) we get:

```
Overall weighted coverage score:  89.9%
Total number of functions:  28475
We need   25 more function to get to 90% coverage.
```


So close! Sadly #11409 seems to be in "needs work" limbo at the moment (the Sage library patch there doesn't even install cleanly any more -- there is a reject in all.py).


---

Comment by jdemeyer created at 2012-04-09 20:10:44

Changing priority from blocker to major.


---

Comment by jdemeyer created at 2012-04-09 20:10:44

Going for 90% is a nice goal, but I don't think it should block the sage-5.0 release.

In sage-5.0.beta13:

```
Overall weighted coverage score:  88.3%
Total number of functions:  29374
We need  494 more function to get to 90% coverage.
We need 1963 more function to get to 95% coverage.
We need 3138 more function to get to 99% coverage.
```



---

Comment by was created at 2012-04-09 20:14:33

Replying to [comment:63 jdemeyer]:
> Going for 90% is a nice goal, but I don't think it should block the sage-5.0 release.

Agreed. We are close, and we will get there, but not for sage-5.0.

> 
> In sage-5.0.beta13:
> {{{{
> Overall weighted coverage score:  88.3%
> Total number of functions:  29374
> We need  494 more function to get to 90% coverage.
> We need 1963 more function to get to 95% coverage.
> We need 3138 more function to get to 99% coverage.
> }}}


---

Comment by davidloeffler created at 2012-04-10 14:26:19

We'd be there already if #11409 went in, wouldn't we?


---

Comment by itaibn created at 2012-05-04 22:12:27

Claiming a file.


---

Comment by tscrim created at 2012-10-19 00:46:15

Claiming files and moving closed tickets.


---

Comment by jhpalmieri created at 2012-10-19 05:22:45

This is perhaps cheating, but I wonder if we should revise the coverage script to ignore all files in any directory containing a file "nodoctest.py". This would eliminate all files in the server directory from the coverage count.


---

Comment by tscrim created at 2012-10-22 02:05:40

Moving #13618 to need review block. Re-tallied function count.


---

Comment by tscrim created at 2012-11-03 22:08:28

I also did `rings/real*` in #13618.


---

Comment by chapoton created at 2012-11-15 19:38:45

Ticket #12092 is ready for review and should be easy enough.


---

Comment by jdemeyer created at 2013-02-05 17:10:04

You might also be interested in #14061, which fixes the `sage-coverage` script and brings the results for sage-5.7.beta3 to

```
Overall weighted coverage score:  89.8%
Total number of functions:  31279
We need   48 more functions to get to 90% coverage.
We need 1612 more functions to get to 95% coverage.
We need 2863 more functions to get to 99% coverage.
```



---

Comment by jdemeyer created at 2013-02-22 19:11:56

Resolution: fixed
