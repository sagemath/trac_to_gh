# Issue 15662: Random failures in decorate @fork

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-03-06 15:04:33

CC:  @collares

This is possibly because fork failed:

```
sage -t --long src/sage/parallel/decorate.py
**********************************************************************
File "src/sage/parallel/decorate.py", line 526, in sage.parallel.decorate.fork
Failed example:
    g(10^7, m=5)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/mark-1/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/buildbot/build/sage/mark-1/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.parallel.decorate.fork[6]>", line 1, in <module>
        g(Integer(10)**Integer(7), m=Integer(5))
      File "/home/buildbot/build/sage/mark-1/sage_git/build/local/lib/python2.7/site-packages/sage/parallel/decorate.py", line 475, in h
        return list(g([(args, kwds)]))[0][1]
    IndexError: list index out of range
```

We can't force fork to succeed if there are not enough resources, but we should detect the error when it happens and show a suitable error message. What we get here is just plain weird.


---

Comment by vbraun created at 2014-07-25 05:00:27

Changing keywords from "" to "random_fail".


---

Comment by jdemeyer created at 2015-06-20 12:51:22

I wonder if this is related to #18741.


---

Comment by vbraun created at 2015-10-24 10:21:39

Another one

```
sage -t --long src/sage/parallel/decorate.py
**********************************************************************
File "src/sage/parallel/decorate.py", line 526, in sage.parallel.decorate.fork
Failed example:
    g(10^7, m=5)
Expected:
    Killing subprocess ... with input ((10000000,), {'m': 5}) which took too long
    'NO DATA (timed out)'
Got:
    Killing subprocess 2520 with input ((10000000,), {'m': 5}) which took too long
    65657065
**********************************************************************
1 item had failures:
   1 of  18 in sage.parallel.decorate.fork
```



---

Comment by @collares created at 2022-08-25 17:44:05

Just reproduced this bug on Sage 9.6:

```
sage -t --long --random-seed=23910650473348092425702839453603734670 /nix/store/d2n6qqhcrw7ga12x18qa2fv1bnxf002f-sage-src-9.6/src/sage/parallel/decorate.py
**********************************************************************
File "/nix/store/d2n6qqhcrw7ga12x18qa2fv1bnxf002f-sage-src-9.6/src/sage/parallel/decorate.py", line 528, in sage.parallel.decorate.fork
Failed example:
    g(10^7, m=5)
Expected:
    Killing subprocess ... with input ((10000000,), {'m': 5}) which took too long
    'NO DATA (timed out)'
Got:
    Killing subprocess 47384 with input ((10000000,), {'m': 5}) which took too long
    'INVALID DATA Ran out of input'
**********************************************************************
1 item had failures:
   1 of  18 in sage.parallel.decorate.fork
    [90 tests, 1 failure, 13.78 s]
```

