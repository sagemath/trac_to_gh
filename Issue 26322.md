# Issue 26322: Bug in DiGraph.spectral_radius()

archive/issues_026322.json:
```json
{
    "body": "CC:  dcoudert tscrim\n\nI propose a correction for a bug in DiGraph.spectral_radius().\n\nThe problem.\nThe following code does'nt stop:\n sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)\n sage: g.spectral_radius()\n\nThe solution.\nThe fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26559\n\n",
    "created_at": "2018-10-26T10:40:43Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "Bug in DiGraph.spectral_radius()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26322",
    "user": "mercatp"
}
```
CC:  dcoudert tscrim

I propose a correction for a bug in DiGraph.spectral_radius().

The problem.
The following code does'nt stop:
 sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)
 sage: g.spectral_radius()

The solution.
The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.

Issue created by migration from https://trac.sagemath.org/ticket/26559





---

archive/issue_comments_370749.json:
```json
{
    "body": "I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-26T15:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370749",
    "user": "dcoudert"
}
```

I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_370750.json:
```json
{
    "body": "One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().\n\nReplying to [comment:3 dcoudert]:\n> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-30T21:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370750",
    "user": "mercatp"
}
```

One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().

Replying to [comment:3 dcoudert]:
> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_370751.json:
```json
{
    "body": "\n```diff\n-    #test if the graph is aperiodic\n-    if not G.is_aperiodic():\n-        raise ValueError(\"The graph must be aperiodic.\")\n+    # test if the graph is aperiodic\n+    if not G.is_aperiodic():\n+        raise ValueError(\"the graph must be aperiodic\")\n```\n\nand possibly add a doctest\n----\nNew commits:",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370751",
    "user": "dcoudert"
}
```


```diff
-    #test if the graph is aperiodic
-    if not G.is_aperiodic():
-        raise ValueError("The graph must be aperiodic.")
+    # test if the graph is aperiodic
+    if not G.is_aperiodic():
+        raise ValueError("the graph must be aperiodic")
```

and possibly add a doctest
----
New commits:



---

archive/issue_comments_370752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-31T09:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370752",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370753.json:
```json
{
    "body": "You have trailing white space of the line before `#test`, and please add a space before `test`, so do:\n\n```diff\n-    \n-    #test if the graph is aperiodic\n+\n+    # test if the graph is aperiodic\n```\n",
    "created_at": "2018-10-31T11:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370753",
    "user": "dcoudert"
}
```

You have trailing white space of the line before `#test`, and please add a space before `test`, so do:

```diff
-    
-    #test if the graph is aperiodic
+
+    # test if the graph is aperiodic
```




---

archive/issue_comments_370754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-31T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370754",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370755.json:
```json
{
    "body": "If ready for review, set the ticket to `needs review`",
    "created_at": "2018-11-04T19:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370755",
    "user": "dcoudert"
}
```

If ready for review, set the ticket to `needs review`



---

archive/issue_comments_370756.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-04T21:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370756",
    "user": "mercatp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_370757.json:
```json
{
    "body": "Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).",
    "created_at": "2018-11-05T07:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370757",
    "user": "dcoudert"
}
```

Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).



---

archive/issue_comments_370758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-05T08:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370758",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370759.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370759",
    "user": "dcoudert"
}
```

Looks good to me.



---

archive/issue_comments_370760.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370760",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_370761.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-07T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26322#issuecomment-370761",
    "user": "vbraun"
}
```

Resolution: fixed
