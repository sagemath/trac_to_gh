# Issue 26322: Bug in DiGraph.spectral_radius()

Issue created by migration from Trac.

Original creator: mercatp

Original creation time: 2018-10-26 10:40:43

CC:  dcoudert tscrim

I propose a correction for a bug in DiGraph.spectral_radius().

The problem.
The following code does'nt stop:
 sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)
 sage: g.spectral_radius()

The solution.
The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.


---

Comment by dcoudert created at 2018-10-26 15:07:51

I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.


---

Comment by mercatp created at 2018-10-30 21:29:08

One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().

Replying to [comment:3 dcoudert]:
> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.


---

Comment by dcoudert created at 2018-10-31 00:15:35


```diff
-    #test if the graph is aperiodic
-    if not G.is_aperiodic():
-        raise ValueError("The graph must be aperiodic.")
+    # test if the graph is aperiodic
+    if not G.is_aperiodic():
+        raise ValueError("the graph must be aperiodic")
```

and possibly add a doctest
----
New commits:


---

Comment by git created at 2018-10-31 09:51:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-31 11:40:11

You have trailing white space of the line before `#test`, and please add a space before `test`, so do:

```diff
-    
-    #test if the graph is aperiodic
+
+    # test if the graph is aperiodic
```



---

Comment by git created at 2018-10-31 13:05:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-04 19:05:58

If ready for review, set the ticket to `needs review`


---

Comment by mercatp created at 2018-11-04 21:29:52

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-11-05 07:23:25

Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).


---

Comment by git created at 2018-11-05 08:19:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-05 08:33:45

Looks good to me.


---

Comment by dcoudert created at 2018-11-05 08:33:45

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-11-07 11:28:09

Resolution: fixed
