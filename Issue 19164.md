# Issue 19164: Improve powering of complex intervals

archive/issues_019164.json:
```json
{
    "body": "This 2 should yield the same result:\n\n```\nsage: a = RIF(-1, 1)\nsage: (a ** 2).endpoints()\n(0.000000000000000, 1.00000000000000)\n```\n\n\n```\nsage: a = RIF(-1, 1)\nsage: (CIF(a) ** 2).real().endpoints()\n(-1.00000000000000, 1.00000000000000)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19401\n\n",
    "created_at": "2015-10-13T09:49:47Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Improve powering of complex intervals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19164",
    "user": "jdemeyer"
}
```
This 2 should yield the same result:

```
sage: a = RIF(-1, 1)
sage: (a ** 2).endpoints()
(0.000000000000000, 1.00000000000000)
```


```
sage: a = RIF(-1, 1)
sage: (CIF(a) ** 2).real().endpoints()
(-1.00000000000000, 1.00000000000000)
```


Issue created by migration from https://trac.sagemath.org/ticket/19401





---

archive/issue_comments_263024.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-13T12:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263024",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263025.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-13T12:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263025",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_263026.json:
```json
{
    "body": "- Wouldn't it be better if `e` was converted to `mpz_t`? that way the shift can be performed directly on the `mpz_t` attribute. In the current code you are trying hard to convert it to a Python int or a Python long but it is not clear to me why (excepted compliance with `generic_power_c`).\n\n- Shouldn't the `pari_gen` be cimported?\n\n- In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.",
    "created_at": "2015-10-13T20:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263026",
    "user": "vdelecroix"
}
```

- Wouldn't it be better if `e` was converted to `mpz_t`? that way the shift can be performed directly on the `mpz_t` attribute. In the current code you are trying hard to convert it to a Python int or a Python long but it is not clear to me why (excepted compliance with `generic_power_c`).

- Shouldn't the `pari_gen` be cimported?

- In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.



---

archive/issue_comments_263027.json:
```json
{
    "body": "Replying to [comment:4 vdelecroix]:\n> excepted compliance with `generic_power_c`\nYes exactly, that's the reason. I just used what `generic_power_c` used. For this application, actually `fmpz_t` (from FLINT) might even be better, since that's optimized better for small values.\n\n> - Shouldn't the `pari_gen` be cimported?\nProbably.\n\n> - In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.\nRight, I'll think about it.",
    "created_at": "2015-10-14T06:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263027",
    "user": "jdemeyer"
}
```

Replying to [comment:4 vdelecroix]:
> excepted compliance with `generic_power_c`
Yes exactly, that's the reason. I just used what `generic_power_c` used. For this application, actually `fmpz_t` (from FLINT) might even be better, since that's optimized better for small values.

> - Shouldn't the `pari_gen` be cimported?
Probably.

> - In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.
Right, I'll think about it.



---

archive/issue_comments_263028.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-14T06:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263028",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263029.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-14T10:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263029",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263030.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-14T11:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263030",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263031.json:
```json
{
    "body": "The `res *= z` also does a useless creation of a Python object. I propose to introduce the following method for `ComplexIntervalFieldElement`\n\n```\ncpdef _imul_(self, Element right)\n```\n\nWe could then replace it with `res._imul_(z)`. It might not be worth it though.",
    "created_at": "2015-10-14T14:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263031",
    "user": "vdelecroix"
}
```

The `res *= z` also does a useless creation of a Python object. I propose to introduce the following method for `ComplexIntervalFieldElement`

```
cpdef _imul_(self, Element right)
```

We could then replace it with `res._imul_(z)`. It might not be worth it though.



---

archive/issue_comments_263032.json:
```json
{
    "body": "Well, there is a certain balance needed between simplicity and speed. I think the current code is already pretty optimized (but of course it can always be made faster). I propose to leave it for now. However, if there is ever a use case for very fast complex interval powering, I'll be happy to change the code.",
    "created_at": "2015-10-15T07:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263032",
    "user": "jdemeyer"
}
```

Well, there is a certain balance needed between simplicity and speed. I think the current code is already pretty optimized (but of course it can always be made faster). I propose to leave it for now. However, if there is ever a use case for very fast complex interval powering, I'll be happy to change the code.



---

archive/issue_comments_263033.json:
```json
{
    "body": "The branch does not apply anymore.",
    "created_at": "2015-10-17T19:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263033",
    "user": "vdelecroix"
}
```

The branch does not apply anymore.



---

archive/issue_comments_263034.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-17T19:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263034",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_263035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-17T20:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263035",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263036.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-17T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263036",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_263037.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-20T00:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263037",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263038.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-20T22:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19164#issuecomment-263038",
    "user": "vbraun"
}
```

Resolution: fixed
