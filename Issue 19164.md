# Issue 19164: Improve powering of complex intervals

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-10-13 09:49:47

This 2 should yield the same result:

```
sage: a = RIF(-1, 1)
sage: (a ** 2).endpoints()
(0.000000000000000, 1.00000000000000)
```


```
sage: a = RIF(-1, 1)
sage: (CIF(a) ** 2).real().endpoints()
(-1.00000000000000, 1.00000000000000)
```



---

Comment by jdemeyer created at 2015-10-13 12:13:08

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-10-13 12:13:08

New commits:


---

Comment by vdelecroix created at 2015-10-13 20:44:56

- Wouldn't it be better if `e` was converted to `mpz_t`? that way the shift can be performed directly on the `mpz_t` attribute. In the current code you are trying hard to convert it to a Python int or a Python long but it is not clear to me why (excepted compliance with `generic_power_c`).

- Shouldn't the `pari_gen` be cimported?

- In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.


---

Comment by jdemeyer created at 2015-10-14 06:08:11

Replying to [comment:4 vdelecroix]:
> excepted compliance with `generic_power_c`
Yes exactly, that's the reason. I just used what `generic_power_c` used. For this application, actually `fmpz_t` (from FLINT) might even be better, since that's optimized better for small values.

> - Shouldn't the `pari_gen` be cimported?
Probably.

> - In each loop you are creating a new `ComplexFieldElement` (with `z2 = z._new()`)... while the same `z2` can be reused! Of course, it will be slower for very small powers.
Right, I'll think about it.


---

Comment by jdemeyer created at 2015-10-14 06:15:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-10-14 10:35:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-10-14 11:17:12

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-10-14 14:37:57

The `res *= z` also does a useless creation of a Python object. I propose to introduce the following method for `ComplexIntervalFieldElement`

```
cpdef _imul_(self, Element right)
```

We could then replace it with `res._imul_(z)`. It might not be worth it though.


---

Comment by jdemeyer created at 2015-10-15 07:42:16

Well, there is a certain balance needed between simplicity and speed. I think the current code is already pretty optimized (but of course it can always be made faster). I propose to leave it for now. However, if there is ever a use case for very fast complex interval powering, I'll be happy to change the code.


---

Comment by vdelecroix created at 2015-10-17 19:36:00

The branch does not apply anymore.


---

Comment by vdelecroix created at 2015-10-17 19:36:00

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-10-17 20:25:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-10-17 20:25:30

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-10-20 00:46:03

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-10-20 22:32:46

Resolution: fixed
