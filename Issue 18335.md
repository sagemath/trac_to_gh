# Issue 18335: CVXOPT solver equations handling

Issue created by migration from https://trac.sagemath.org/ticket/18572

Original creator: ptigwe

Original creation time: 2015-06-01 15:53:41

CC:  dimpase ncohen ingolfured

Keywords: CVXOPT, linear programming

The `CVXOPT` solver doesn't seem to be able to handle equations with `==` properly. For instance, the following example:

```
p = MixedIntegerLinearProgram(solver='CVXOPT', maximization=False)
x = p.new_variable(nonnegative=True)
y = p.new_variable(nonnegative=False)
p.add_constraint( 2 * x[0] + x[1] - y[0] <= 0)
p.add_constraint(x[0] + 3 * x[1] - y[0] <= 0)
p.add_constraint(x[0] + x[1] == 1)
p.set_objective(y[0])
p.solve()
p.get_values(x)
{0: 0.26990679350380004, 1: 0.1691067035243196}
```

The final result shouldn't be a feasible solution considering that `x_0 + x_1 == 1` should hold. However substituting the final constraint for

```
p.add_constraint(1<=x[0] + x[1] <= 1)
```

works fine.


---

Comment by dimpase created at 2015-06-01 17:33:39

well, where do we start?


---

Comment by dimpase created at 2015-06-01 18:32:20

It looks pretty unclear to me how `add_constraint` interacts with a backend. Some (almost all?) backends don't even have `add_constraint` implemented...


---

Comment by dimpase created at 2015-06-01 22:26:27

OK, I suppose I see how to fix this. CVXOPT's LP solver needs equations to be put into a 
[separate data structure](http://cvxopt.org/userguide/coneprog.html#linear-programming),. but this was not done in this code.

What I need to understand is how `add_linear_constraint` in a backend is supposed to know that it deals with an equation. By comparing `lower_bound` and `upper_bound` ?


---

Comment by dimpase created at 2015-06-03 00:36:35

Replying to [comment:3 dimpase]:
> OK, I suppose I see how to fix this. CVXOPT's LP solver needs equations to be put into a 
> [separate data structure](http://cvxopt.org/userguide/coneprog.html#linear-programming),. but this was not done in this code.
> 
> What I need to understand is how `add_linear_constraint` in a backend is supposed to know that it deals with an equation. By comparing `lower_bound` and `upper_bound` ?

this is certainly not an optimal way; in fact `add_constraint` in `mip.pyx` simply throws away the information on whether we have an equation, or not. In general it is not straightforward to get it back, as some loss of precision can happen.


---

Comment by mkoeppe created at 2016-04-10 07:55:01

this now appears as a testcase on #20323.


---

Comment by mkoeppe created at 2016-04-27 08:31:07

#20424 now.
