# Issue 23505: Check for overflow in matrix_mod2_dense

archive/issues_023505.json:
```json
{
    "body": "CC:  simonking\n\n\n```\nsage: M = MatrixSpace(GF(2),2^32)\nsage: M(1)\n------------------------------------------------------------------------\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e75)[0x7fb34704ee75]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5ec5)[0x7fb34704eec5]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8e97)[0x7fb347051e97]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x11390)[0x7fb35378d390]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.so(+0xb102)[0x7fb1b8d71102]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix0.so(+0x407ee)[0x7fb1bc5a67ee]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48bd)[0x7fb353aa18ad]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x16433)[0x7fb34572a433]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x166c7)[0x7fb34572a6c7]\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x1698c)[0x7fb34572a98c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7fb353aa26ca]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0x8567c)[0x7fb353a1e67c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0x657ec)[0x7fb3539fe7ec]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0xc1985)[0x7fb353a5a985]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7fb353aa26ca]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb353aa69a9]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7428)[0x7fb353aa4418]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb353aa69a9]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb353acaa4a]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd7)[0x7fb353acbdf7]\n/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc3e)[0x7fb353ae24be]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7fb352cc2830]\npython(_start+0x29)[0x400719]\n------------------------------------------------------------------------\nAttaching gdb to process id 6413.\n\nFailed to run gdb.\nFailed to run gdb.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault (core dumped)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23742\n\n",
    "created_at": "2017-08-29T08:48:05Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Check for overflow in matrix_mod2_dense",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23505",
    "user": "@jdemeyer"
}
```
CC:  simonking


```
sage: M = MatrixSpace(GF(2),2^32)
sage: M(1)
------------------------------------------------------------------------
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e75)[0x7fb34704ee75]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5ec5)[0x7fb34704eec5]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8e97)[0x7fb347051e97]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x11390)[0x7fb35378d390]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.so(+0xb102)[0x7fb1b8d71102]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/matrix/matrix0.so(+0x407ee)[0x7fb1bc5a67ee]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x48bd)[0x7fb353aa18ad]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x16433)[0x7fb34572a433]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x166c7)[0x7fb34572a6c7]
/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/misc/cachefunc.so(+0x1698c)[0x7fb34572a98c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7fb353aa26ca]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0x8567c)[0x7fb353a1e67c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0x657ec)[0x7fb3539fe7ec]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(+0xc1985)[0x7fb353a5a985]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7fb3539ed483]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7fb353aa26ca]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb353aa69a9]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7428)[0x7fb353aa4418]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7fb353aa5010]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fb353aa688c]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb353aa69a9]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb353acaa4a]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd7)[0x7fb353acbdf7]
/home/king/Sage/git/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc3e)[0x7fb353ae24be]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7fb352cc2830]
python(_start+0x29)[0x400719]
------------------------------------------------------------------------
Attaching gdb to process id 6413.

Failed to run gdb.
Failed to run gdb.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault (core dumped)
```


Issue created by migration from https://trac.sagemath.org/ticket/23742





---

archive/issue_comments_329410.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-29T09:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329410",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_329411.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-29T09:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329411",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_329412.json:
```json
{
    "body": "What is the reason for changing init_m4ri() so that it could be called repeatedly?",
    "created_at": "2017-08-29T10:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329412",
    "user": "@simon-king-jena"
}
```

What is the reason for changing init_m4ri() so that it could be called repeatedly?



---

archive/issue_comments_329413.json:
```json
{
    "body": "Replying to [comment:3 SimonKing]:\n> What is the reason for changing init_m4ri() so that it could be called repeatedly?\n\nI'm just removing useless code. It can be called repeatedly but it shouldn't.",
    "created_at": "2017-08-29T10:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329413",
    "user": "@jdemeyer"
}
```

Replying to [comment:3 SimonKing]:
> What is the reason for changing init_m4ri() so that it could be called repeatedly?

I'm just removing useless code. It can be called repeatedly but it shouldn't.



---

archive/issue_comments_329414.json:
```json
{
    "body": "According to the patchbot,\n\n```\nsage -t --long src/sage/matrix/matrix_mod2_dense.pyx  # Killed due to kill signal\n```\n\nThat's probably relevant.\n\nMoreover,\n\n```\n+Decreased doctests in matrix/matrix_mod2_dense.pyx: from 34 / 35 = 97% to 34 / 36 = 94%\n+Coverage went from 43359 / 45063 = 96.219% to 43359 / 45064 = 96.216%\n+====================\n\n-matrix/matrix_mod2_dense.pyx: 97.1% (34 of 35)\n+matrix/matrix_mod2_dense.pyx: 94.4% (34 of 36)\n```\n\nbut that seem to be just because you changed a cdef function to a usual function. But the segfault in \nthe test needs to be fixed.",
    "created_at": "2017-08-29T17:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329414",
    "user": "@simon-king-jena"
}
```

According to the patchbot,

```
sage -t --long src/sage/matrix/matrix_mod2_dense.pyx  # Killed due to kill signal
```

That's probably relevant.

Moreover,

```
+Decreased doctests in matrix/matrix_mod2_dense.pyx: from 34 / 35 = 97% to 34 / 36 = 94%
+Coverage went from 43359 / 45063 = 96.219% to 43359 / 45064 = 96.216%
+====================

-matrix/matrix_mod2_dense.pyx: 97.1% (34 of 35)
+matrix/matrix_mod2_dense.pyx: 94.4% (34 of 36)
```

but that seem to be just because you changed a cdef function to a usual function. But the segfault in 
the test needs to be fixed.



---

archive/issue_comments_329415.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-29T17:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329415",
    "user": "@simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_329416.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-30T08:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329416",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_329417.json:
```json
{
    "body": "Dependency merged, needs review.",
    "created_at": "2017-09-19T09:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329417",
    "user": "@jdemeyer"
}
```

Dependency merged, needs review.



---

archive/issue_comments_329418.json:
```json
{
    "body": "Tests seem to pass now.",
    "created_at": "2017-10-04T13:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329418",
    "user": "@jdemeyer"
}
```

Tests seem to pass now.



---

archive/issue_comments_329419.json:
```json
{
    "body": "Do we even need to have `init_m4ri`? I don't see why we can't just call `m4ri_build_all_codes()`.",
    "created_at": "2017-10-04T15:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329419",
    "user": "@tscrim"
}
```

Do we even need to have `init_m4ri`? I don't see why we can't just call `m4ri_build_all_codes()`.



---

archive/issue_comments_329420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-25T13:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_329421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-25T22:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329421",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329422.json:
```json
{
    "body": "LGTM.",
    "created_at": "2017-10-25T22:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329422",
    "user": "@tscrim"
}
```

LGTM.



---

archive/issue_comments_329423.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-29T10:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329423",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_329424.json:
```json
{
    "body": "See #24190 for a followup (at least I think it is related).",
    "created_at": "2017-11-10T15:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329424",
    "user": "@jhpalmieri"
}
```

See #24190 for a followup (at least I think it is related).



---

archive/issue_comments_329425.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> See #24190 for a followup (at least I think it is related).\n\nObviously.",
    "created_at": "2017-11-10T16:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23505#issuecomment-329425",
    "user": "@jdemeyer"
}
```

Replying to [comment:14 jhpalmieri]:
> See #24190 for a followup (at least I think it is related).

Obviously.
