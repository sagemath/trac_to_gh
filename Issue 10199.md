# Issue 10199: Catch Sphinx WARNING or ERROR

archive/issues_010199.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  mvngu\n\nKeywords: sphinx build\n\nWhen Sphinx gives a warning or error but continues, the user will usually never notice.  I propose that `doc/common/builder.py` should look for these errors and warnings and abort if a problem is found.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10200\n\n",
    "created_at": "2010-11-01T21:47:16Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Catch Sphinx WARNING or ERROR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10199",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: GeorgSWeber

CC:  mvngu

Keywords: sphinx build

When Sphinx gives a warning or error but continues, the user will usually never notice.  I propose that `doc/common/builder.py` should look for these errors and warnings and abort if a problem is found.

Issue created by migration from https://trac.sagemath.org/ticket/10200





---

archive/issue_comments_103598.json:
```json
{
    "body": "Changing keywords from \"sphinx build\" to \"sphinx build documentation\".",
    "created_at": "2010-11-03T16:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103598",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "sphinx build" to "sphinx build documentation".



---

archive/issue_comments_103599.json:
```json
{
    "body": "Cf. #9426, #10191.",
    "created_at": "2010-11-03T16:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103599",
    "user": "https://github.com/nexttime"
}
```

Cf. #9426, #10191.



---

archive/issue_comments_103600.json:
```json
{
    "body": "It would also be better to have the different parts of the documentation split in the Makefile.\n\nBtw, the component should be \"documentation\" I think.",
    "created_at": "2010-11-03T16:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103600",
    "user": "https://github.com/nexttime"
}
```

It would also be better to have the different parts of the documentation split in the Makefile.

Btw, the component should be "documentation" I think.



---

archive/issue_comments_103601.json:
```json
{
    "body": "Replying to [comment:2 leif]:\n> Btw, the component should be \"documentation\" I think.\n\nWell, it's about **build**ing the documentation more than about the documentation itself",
    "created_at": "2010-11-04T08:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103601",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 leif]:
> Btw, the component should be "documentation" I think.

Well, it's about **build**ing the documentation more than about the documentation itself



---

archive/issue_comments_103602.json:
```json
{
    "body": "Btw, we could also grep the logfile(s) (e.g. `dochtml.log`) in the Makefile for Sphinx errors and warnings, at least to give a summary or short message.",
    "created_at": "2010-11-05T00:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103602",
    "user": "https://github.com/nexttime"
}
```

Btw, we could also grep the logfile(s) (e.g. `dochtml.log`) in the Makefile for Sphinx errors and warnings, at least to give a summary or short message.



---

archive/issue_comments_103603.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-05T17:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103603",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103604.json:
```json
{
    "body": "Attachment [10200_docbuilder.patch](tarball://root/attachments/some-uuid/ticket10200/10200_docbuilder.patch) by @jdemeyer created at 2010-11-05 17:08:33\n\nSAGELIB patch against sage-4.6.1.alpha0",
    "created_at": "2010-11-05T17:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103604",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10200_docbuilder.patch](tarball://root/attachments/some-uuid/ticket10200/10200_docbuilder.patch) by @jdemeyer created at 2010-11-05 17:08:33

SAGELIB patch against sage-4.6.1.alpha0



---

archive/issue_comments_103605.json:
```json
{
    "body": "same SAGELIB patch against sage-4.6",
    "created_at": "2010-11-05T17:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103605",
    "user": "https://github.com/jdemeyer"
}
```

same SAGELIB patch against sage-4.6



---

archive/issue_comments_103606.json:
```json
{
    "body": "Attachment [10200_docbuilder-sage-4.6.patch](tarball://root/attachments/some-uuid/ticket10200/10200_docbuilder-sage-4.6.patch) by @jdemeyer created at 2010-11-07 10:38:44",
    "created_at": "2010-11-07T10:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103606",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10200_docbuilder-sage-4.6.patch](tarball://root/attachments/some-uuid/ticket10200/10200_docbuilder-sage-4.6.patch) by @jdemeyer created at 2010-11-07 10:38:44



---

archive/issue_comments_103607.json:
```json
{
    "body": "Attachment [trac-10200_reviewer.patch](tarball://root/attachments/some-uuid/ticket10200/trac-10200_reviewer.patch) by mvngu created at 2010-11-09 09:29:16\n\nI'm mostly OK with jdemeyer's patch [attachment:10200_docbuilder.patch]. But I also made some changes as follows:\n\n* Don't use the backslash character \"\\\" for line continuation. Line continuation is already implied by the opening parenthesis.\n\n* Fix typos introduced by the patch [attachment:10200_docbuilder.patch].\n\n* Use\n {{{#!python\n<name> is not None\n }}}\n instead of\n {{{#!python\nnot <name> is None\n }}}\n\n* Use symbolic names of exit code as documented at http://docs.python.org/library/errno.html, rather than hard-code the actual numeric values.\n \nSee the ticket description for instructions on which patches to apply. If my patch gets a positive review, then the whole ticket gets a positive review.",
    "created_at": "2010-11-09T09:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103607",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Attachment [trac-10200_reviewer.patch](tarball://root/attachments/some-uuid/ticket10200/trac-10200_reviewer.patch) by mvngu created at 2010-11-09 09:29:16

I'm mostly OK with jdemeyer's patch [attachment:10200_docbuilder.patch]. But I also made some changes as follows:

* Don't use the backslash character "\" for line continuation. Line continuation is already implied by the opening parenthesis.

* Fix typos introduced by the patch [attachment:10200_docbuilder.patch].

* Use
 {{{#!python
<name> is not None
 }}}
 instead of
 {{{#!python
not <name> is None
 }}}

* Use symbolic names of exit code as documented at http://docs.python.org/library/errno.html, rather than hard-code the actual numeric values.
 
See the ticket description for instructions on which patches to apply. If my patch gets a positive review, then the whole ticket gets a positive review.



---

archive/issue_comments_103608.json:
```json
{
    "body": "Replying to [comment:7 mvngu]:\n>  * Use symbolic names of exit code as documented at http://docs.python.org/library/errno.html, rather than hard-code the actual numeric values.\n\nI disagree.  `errno` is meant for C functions like `fopen()`.  I have never seen these used as exit codes for a program.\n\nOther reviewer changes are fine for me.",
    "created_at": "2010-11-09T10:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103608",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 mvngu]:
>  * Use symbolic names of exit code as documented at http://docs.python.org/library/errno.html, rather than hard-code the actual numeric values.

I disagree.  `errno` is meant for C functions like `fopen()`.  I have never seen these used as exit codes for a program.

Other reviewer changes are fine for me.



---

archive/issue_comments_103609.json:
```json
{
    "body": "Replying to [comment:8 jdemeyer]:\n> I disagree.  `errno` is meant for C functions like `fopen()`.  I have never seen these used as exit codes for a program.\n\nCould you at least explain to me the meaning of the numeric values you used for exit code and document such values in your patch? Better still, for my benefit could you please point me to relevant documentation explaining exit code for the particular situations under consideration?",
    "created_at": "2010-11-09T10:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103609",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Replying to [comment:8 jdemeyer]:
> I disagree.  `errno` is meant for C functions like `fopen()`.  I have never seen these used as exit codes for a program.

Could you at least explain to me the meaning of the numeric values you used for exit code and document such values in your patch? Better still, for my benefit could you please point me to relevant documentation explaining exit code for the particular situations under consideration?



---

archive/issue_comments_103610.json:
```json
{
    "body": "Replying to [comment:9 mvngu]:\n> Better still, for my benefit could you please point me to relevant documentation explaining exit code for the particular situations under consideration?\n\nI'm afraid there are not much standards about exit codes.  The main thing is that 0 means success and anything else means failure.  Also, many operation systems (if not all) use 1 byte for the exit code, so the range is ![0,255].\n\nbash uses 128+`sig` as exit code when a process fails with signal `sig`.  For example, type `cat` (without arguments) and press CTRL-C.  Then the exit code will be 130 (= 128 + 2 with `SIGINT` == 2):\n\n```\n$ cat\n^C\n$ echo $?\n130\n```\n\nBecause of this, exit codes are usually in the range ![0,127].  Some programs use higher numbers to indicate more serious errors (say: 1 for normal errors, 2 for serious errors), but this is not a general rule.\n\nI will provide a patch with better documented exit codes.",
    "created_at": "2010-11-10T11:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103610",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 mvngu]:
> Better still, for my benefit could you please point me to relevant documentation explaining exit code for the particular situations under consideration?

I'm afraid there are not much standards about exit codes.  The main thing is that 0 means success and anything else means failure.  Also, many operation systems (if not all) use 1 byte for the exit code, so the range is ![0,255].

bash uses 128+`sig` as exit code when a process fails with signal `sig`.  For example, type `cat` (without arguments) and press CTRL-C.  Then the exit code will be 130 (= 128 + 2 with `SIGINT` == 2):

```
$ cat
^C
$ echo $?
130
```

Because of this, exit codes are usually in the range ![0,127].  Some programs use higher numbers to indicate more serious errors (say: 1 for normal errors, 2 for serious errors), but this is not a general rule.

I will provide a patch with better documented exit codes.



---

archive/issue_comments_103611.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-10T11:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103611",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_103612.json:
```json
{
    "body": "Apply on top of reviewer patch",
    "created_at": "2010-11-10T16:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103612",
    "user": "https://github.com/jdemeyer"
}
```

Apply on top of reviewer patch



---

archive/issue_comments_103613.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-10T16:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103613",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_103614.json:
```json
{
    "body": "Attachment [10200_exitcodes.patch](tarball://root/attachments/some-uuid/ticket10200/10200_exitcodes.patch) by @jdemeyer created at 2010-11-10 16:05:38\n\nPatch changing exit codes, apply on top of original patch and reviewer patch.",
    "created_at": "2010-11-10T16:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103614",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10200_exitcodes.patch](tarball://root/attachments/some-uuid/ticket10200/10200_exitcodes.patch) by @jdemeyer created at 2010-11-10 16:05:38

Patch changing exit codes, apply on top of original patch and reviewer patch.



---

archive/issue_comments_103615.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-11T11:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103615",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103616.json:
```json
{
    "body": "I like the documentation on exit codes. Positive review.",
    "created_at": "2010-11-11T11:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103616",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

I like the documentation on exit codes. Positive review.



---

archive/issue_comments_103617.json:
```json
{
    "body": "Thanks for the review.\n\nHowever, there is one important issue with this patch: if Sphinx gives warnings about latex being unavailable, this patch will also make that into an error (which is not desirable).\n\nSo this is what I will do: wait for #10118 to have positive_review, then fix the latex WARNING issue, then merge this patch.",
    "created_at": "2010-11-11T11:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103617",
    "user": "https://github.com/jdemeyer"
}
```

Thanks for the review.

However, there is one important issue with this patch: if Sphinx gives warnings about latex being unavailable, this patch will also make that into an error (which is not desirable).

So this is what I will do: wait for #10118 to have positive_review, then fix the latex WARNING issue, then merge this patch.



---

archive/issue_comments_103618.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2010-11-11T20:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103618",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_103619.json:
```json
{
    "body": "There is another issue with this patch:\n\n`sage/misc/sagedoc.py` (very stupidly) reads the first 1000 bytes of `doc/common/builder.py` and searches for this part:\n\n```\nSAGE_DOC = os.environ['SAGE_DOC']\nLANGUAGES = ['en', 'fr']\nSPHINXOPTS  = \"\"\nPAPER       = \"\"\nOMIT        = [\"introspect\"]  # docs/dirs to omit when listing and building 'all'\n```\n\nIn particular, it needs the \"LANGUAGES\" and \"OMIT\" variables.\n\nBy adding my patch, these options are no longer in the first 1000 bytes.  I believe we should use some Pythonic mechanism (`import` doesn't seem to work since this file is in `doc/`, not `sage/`) to read these options instead of essentially grepping stuff from `builder.py`.  Any ideas...?",
    "created_at": "2010-11-11T20:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103619",
    "user": "https://github.com/jdemeyer"
}
```

There is another issue with this patch:

`sage/misc/sagedoc.py` (very stupidly) reads the first 1000 bytes of `doc/common/builder.py` and searches for this part:

```
SAGE_DOC = os.environ['SAGE_DOC']
LANGUAGES = ['en', 'fr']
SPHINXOPTS  = ""
PAPER       = ""
OMIT        = ["introspect"]  # docs/dirs to omit when listing and building 'all'
```

In particular, it needs the "LANGUAGES" and "OMIT" variables.

By adding my patch, these options are no longer in the first 1000 bytes.  I believe we should use some Pythonic mechanism (`import` doesn't seem to work since this file is in `doc/`, not `sage/`) to read these options instead of essentially grepping stuff from `builder.py`.  Any ideas...?



---

archive/issue_comments_103620.json:
```json
{
    "body": "The last issue mentioned in the comment above is fixed at #10351.",
    "created_at": "2010-11-28T16:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103620",
    "user": "https://github.com/jdemeyer"
}
```

The last issue mentioned in the comment above is fixed at #10351.



---

archive/issue_events_026137.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-30T21:37:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10199#event-26137"
}
```



---

archive/issue_events_026138.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-30T21:37:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10199#event-26138"
}
```



---

archive/issue_comments_103621.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2011-10-30T21:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103621",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: wontfix



---

archive/issue_comments_103622.json:
```json
{
    "body": "Closing this ticket as \"wontfix\" since Sphinx warnings can sometimes simply indicate a missing `dvipng` for example.  We should not punish the user for that.\n\nI am still open for suggestions though.  If you feel this ticket needs to be reopened, just let me know.",
    "created_at": "2011-10-30T21:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10199#issuecomment-103622",
    "user": "https://github.com/jdemeyer"
}
```

Closing this ticket as "wontfix" since Sphinx warnings can sometimes simply indicate a missing `dvipng` for example.  We should not punish the user for that.

I am still open for suggestions though.  If you feel this ticket needs to be reopened, just let me know.
