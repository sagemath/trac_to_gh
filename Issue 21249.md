# Issue 21249: rubik spkg-install should not assume 'install' is available on Linux

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-09-14 02:30:46

CC:  embray jdemeyer jpflori

I'm getting (on a Centos Linux docker image):

```
[rubiks-20070912.p18] ./spkg-install: line 144: which: command not found
```



---

Comment by tmonteil created at 2016-09-14 13:03:24

According to the given line, it seems the missing binary is not `install`, but the `which` command itself. This command is also used (at least) in `gcc` and `autotools` pkgs. I am not sure if you should better require your container to contain the very standard tools. In case, note that `build/pkgs/atlas/configuration.py` has a Python implementation of `which` (`which` itself is a few lines of shell).


---

Comment by jhpalmieri created at 2016-09-14 14:25:28

Maybe it's safer (?) to use `command -v blah` instead of `which blah`? Is `command` built in to the shell?


---

Comment by jdemeyer created at 2016-09-14 15:06:34

It should be even safer to just use `INSTALL=install`. Why should it have the full pathname to `install`? The shell should find it. Especially given that the other `if` branch does `INSTALL=cp` and not `INSTALL=`which cp``.


---

Comment by mkoeppe created at 2016-09-14 15:24:34

Replying to [comment:3 jdemeyer]:
> It should be even safer to just use `INSTALL=install`. Why should it have the full pathname to `install`? The shell should find it. Especially given that the other `if` branch does `INSTALL=cp` and not `INSTALL=`which cp``.

I agree


---

Comment by tmonteil created at 2016-09-14 15:40:10

Looking at the spkg history (untar http://old.files.sagemath.org/spkg/archive/rubiks-20070912.p18.spkg and `hg view`), the reason of this apparent oddity is hg commit 283cfca20e94: `Work around Solaris problem with /usr/bin/install missing` by Michael Abshoff 2008-09-01.

Since Solaris is claimed to be [fully supported](https://wiki.sagemath.org/SupportedPlatforms#Fully_supported), we should try any fix there also (unfortunately i don ot see Solaris buildslaves anymore, but perhaps Jean-Pierre has one).


---

Comment by mkoeppe created at 2016-09-14 15:45:14

"Someone" should just step up and make a proper autotools package, which can serve as the upstream for the sage package. 
See also #21103 comment 8.


---

Comment by tmonteil created at 2016-09-14 16:03:59

Replying to [comment:7 mkoeppe]:
> "Someone" should just step up and make a proper autotools package, which can serve as the upstream for the sage package. 
> See also #21103 comment 8.

Well, rubiks is a bitrotting bundle of 3 packages, for which i am not sure upstream could be contacted (the links provided in SPKG.txt are dead). So, it will require the additional work of writing 3 fresh spkgs while i am not sure their code will evolve.


---

Comment by mkoeppe created at 2016-09-14 18:31:27

Replying to [comment:8 tmonteil]:
> Replying to [comment:7 mkoeppe]:
> > "Someone" should just step up and make a proper autotools package, which can serve as the upstream for the sage package. 
> > See also #21103 comment 8.
> 
> Well, rubiks is a bitrotting bundle of 3 packages, for which i am not sure upstream could be contacted (the links provided in SPKG.txt are dead). So, it will require the additional work of writing 3 fresh spkgs while i am not sure their code will evolve.

Why 3 spkgs? It would be enough to make 1 new "upstream" source package with an autotools build system and put it on [GitHub](GitHub). That's better than the current situation, with a fictional upstream source package that only exists on sage mirrors.


---

Comment by mkoeppe created at 2016-09-14 18:39:28

Replying to [comment:1 tmonteil]:
> According to the given line, it seems the missing binary is not `install`, but the `which` command itself.

Right, thanks, I've fixed the description.

>  This command is also used (at least) in `gcc` and `autotools` pkgs. I am not sure if you should better require your container to contain the very standard tools. In case, note that `build/pkgs/atlas/configuration.py` has a Python implementation of `which` (`which` itself is a few lines of shell).

I wouldn't consider `which` a standard build tool. Its use in scripts is usually a bug.

`gcc` built just fine on my box, it does not seem to use `which`.

I've opened a ticket for `autotools` to fix the same issue (#21492).


---

Comment by mkoeppe created at 2016-09-14 18:47:27

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2016-09-14 18:47:27

Anyway, here's the 1-line fix. This patch does not conflict with #21103.
----
New commits:


---

Comment by mkoeppe created at 2016-09-14 19:18:22

Replying to [comment:9 mkoeppe]:
> Why 3 spkgs? It would be enough to make 1 new "upstream" source package with an autotools build system and put it on [GitHub](GitHub). That's better than the current situation, with a fictional upstream source package that only exists on sage mirrors.

Let's move this discussion to #21493.


---

Comment by mkoeppe created at 2016-09-16 04:07:36

Needs review.


---

Comment by mkoeppe created at 2016-09-16 04:23:09

#21492 does the same for `autotools`.

`gcc` `spkg-install` also uses `which`, but only on Darwin, where `which` exists. So no need for a patch.


---

Comment by jdemeyer created at 2016-09-16 05:50:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-17 15:25:53

Resolution: fixed
