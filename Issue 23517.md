# Issue 23517: Randomized test for finite lattices

Issue created by migration from https://trac.sagemath.org/ticket/23754

Original creator: jmantysalo

Original creation time: 2017-08-30 15:21:57

CC:  tscrim

This patch is just a PoC. For the idea see https://groups.google.com/forum/#!topic/sage-devel/-rVyK8-FQ2s and for the real code to be included here see https://sage.sis.uta.fi/home/pub/153/


---

Comment by git created at 2017-08-31 05:50:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-08-31 07:16:51

What should be the "interface" for the function? I.e. if all is good, should this return `True` or nothing, and if a bug is found, should this raise an exception or return a string telling what went wrong?


---

Comment by tscrim created at 2017-08-31 13:47:33

I would say raise an error because that will contain a little more detailed information about what goes wrong and is self-contained (i.e., does not require a separate `print` call).


---

Comment by git created at 2017-09-01 05:06:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-01 05:12:29

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-09-06 22:05:30

You should put `implications`, `*_properties`, etc. at the module level in case another test file wants to have access them, IMO it is cleaner, and is (marginally) faster.

Use `.. TODO::`.

Also, why do you need to add those lines for the testing? I think those should not be there and instead the test function should be modified accordingly.


---

Comment by jmantysalo created at 2017-09-07 05:14:08

Sorry Travis, I think I did not understood.

What is "module level" in this case? At the root level of `src/sage/tests/finite_poset.py` so that importing the module would import them to the global namespace?

What lines you refer in the last paragraph? If you mean `T.is_doubling_any = lambda L: L.is_constructible_by_doublings('any')` etc, then I suggest that I make a helper function for those first. Otherwise the code would be unnecessary complex, as `attrcall('is_'+p)` is currently quite clean solution.


---

Comment by tscrim created at 2017-09-07 05:32:43

Replying to [comment:8 jmantysalo]:
> What is "module level" in this case? At the root level of `src/sage/tests/finite_poset.py` so that importing the module would import them to the global namespace?

In Python: `module == file`. So putting something at the module level means putting it at the base level of the test file. This would also not add anything to the global namespace (in case you're worried).

> What lines you refer in the last paragraph? If you mean `T.is_doubling_any = lambda L: L.is_constructible_by_doublings('any')` etc, then I suggest that I make a helper function for those first. Otherwise the code would be unnecessary complex, as `attrcall('is_'+p)` is currently quite clean solution.

Yes, those are the lines I'm talking about. The code that you need to actually run the test is very ugly (and essentially undocumented). I would instead have a helper function that replaces `attrcall` with this:

```python
def test_attrcall(name, L):
    if name == 'is_doubling_any':
        return L.is_constructible_by_doublings('any')
    if name == 'is_doubling_lower:
        return L.is_constructible_by_doublings('upper')
    if name == 'is_doubling_upper':
        return L.is_constructible_by_doublings('lower')
    if name == 'is_doubling_convex':
        return L.is_constructible_by_doublings('convex')
    if name == 'is_doubling_interval':
        return L.is_constructible_by_doublings('interval')
    if name == 'is_uniq_orthocomplemented':
        return L.is_orthocomplemented(unique=True)
    return attrcall(name)(L)
```

This way it is clean because you do not need to change your objects and the code is localized to this file.


---

Comment by git created at 2017-09-07 06:01:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-07 06:33:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-07 06:34:12

Like this?


---

Comment by tscrim created at 2017-09-07 12:22:22

Yes, but I want all of those declarations to be _outside_ the function (i.e., everything up to `### Relations between boolean-valued properties ###` except for the cardinality test).

You can remove this line:

```
This needs few lines before the test, see example below.
```

It might be good to also add to the doc a short overview list of the things that are tested, e.g.,

```
- implications of properties
- mutually exclusive properties
- (self)dual properties
- inclusions of subsets
```

Also, small typo:

```diff
-.. TODO:
+.. TODO::
```



---

Comment by git created at 2017-09-07 12:43:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-07 12:44:47

Thanks for comments, done those.


---

Comment by tscrim created at 2017-09-07 12:48:16

Thank you for the changes.

Two last things:

```diff
    The function contains tests of different kinds:
+
    - Implications of boolean properties. Examples: a distributive lattice is modular,
```

and if you could move the `test_getattr` outside the main test function (and add a short one-line description with a doctest testing the modified path and the `getattr` path).


---

Comment by git created at 2017-09-08 10:14:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-08 10:15:56

Like this? I also changed "boolean" to "Boolean", as I just remembered that is was right spelling in English.


---

Comment by tscrim created at 2017-09-08 12:26:13

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-09-08 12:26:13

Yep. Thank you. I'm not sure about the Boolean vs boolean in this case, so let's just leave it as is. Positive review.


---

Comment by vbraun created at 2017-09-11 13:47:13

Resolution: fixed
