# Issue 19603: Bug in elliptic curve isogeny

Issue created by migration from https://trac.sagemath.org/ticket/19840

Original creator: cremona

Original creation time: 2016-01-06 15:14:51

Keywords: isogenies

There is a bug in the code to compute 5-isogenies of elliptic curves of j-invariant 1728, when 5 is a square.

```
sage: K.<a> = NumberField(x^4 - 5*x^2 + 5)
sage: E = EllipticCurve([a^2 + a + 1, a^3 + a^2 + a + 1, a^2 + a,
17*a^3 + 34*a^2 - 16*a - 37, 54*a^3 + 105*a^2 - 66*a - 135])
sage: E.j_invariant()
1728
sage: K(5).is_square()
True
sage: E.isogenies_prime_degree(5)
ValueError: The polynomial does not define a finite subgroup of the elliptic curve.
```

or more directly

```
sage: from sage.schemes.elliptic_curves.isogeny_small_degree import isogenies_5_1728
sage: isogenies_5_1728(E)
ValueError: The polynomial does not define a finite subgroup of the elliptic curve.
```


I wrote this code about 5 years ago, and will fix it.


---

Comment by cremona created at 2016-01-07 12:36:35

I found the bug: on line 868, `a*(beta**2-2)/6` should be `(beta**2-2*a)/6`.

The bug was not caught by the doctests since the only example where this code was tested had a=1.


---

Comment by cremona created at 2016-01-07 12:56:21

To review, run the code in the description before and after; note that a doctest is added with this example.
----
New commits:


---

Comment by cremona created at 2016-01-07 12:56:21

Changing status from new to needs_review.


---

Comment by cremona created at 2016-01-07 13:03:04

There is a small merge conflict with #19689 so I will rebase this on that and make that ticket a dependency.


---

Comment by git created at 2016-01-07 13:05:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-01-08 20:16:01

two details:

* The following is not formatted correctly

```
See `trac``19840`:
```

but should be

```
See :trac:`19840`:
```

* A typo in the first line: "with repect"


---

Comment by cremona created at 2016-01-12 20:03:04

Replying to [comment:6 chapoton]:
> two details:
> 
> * The following is not formatted correctly
> {{{
> See `trac``19840`:
> }}}
> but should be
> {{{
> See :trac:`19840`:
> }}}
> * A typo in the first line: "with repect"

Thanks, I am fixing those now and hope we can this into 7.0.


---

Comment by git created at 2016-01-12 20:27:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2016-01-12 20:29:36

Don't forget to fill in the "reviewer" box :)


---

Comment by chapoton created at 2016-01-13 08:04:05

sorry, still not formatted correctly, should be in fact

```
See :trac:`19840`::
```

with a double colon at the end.

Once done, you can set a positive review.


---

Comment by cremona created at 2016-01-13 08:42:38

Sorry, will do.  It is so hard to actually test correct formatting of docstrings since it takes a very long time to build doc and the output is thousamds of lines somewhere in which is the relevant line or two.


---

Comment by git created at 2016-01-13 08:47:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2016-01-13 08:48:18

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2016-01-13 10:28:12

7.0 please!


---

Comment by vbraun created at 2016-01-20 10:19:55

Resolution: fixed
