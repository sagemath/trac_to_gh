# Issue 14425: Upgrade and clean up sqlite package

Issue created by migration from https://trac.sagemath.org/ticket/14629

Original creator: jdemeyer

Original creation time: 2013-05-22 19:09:19

Assignee: jdemeyer

Keywords: sqlite package




---

Comment by jdemeyer created at 2013-05-22 20:17:43

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-05-23 11:28:17

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-05-23 11:28:17


```
sage -t devel/sage/sage/databases/cremona.py
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 636, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a1'
Got:
    '1001a1'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 638, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a2'
Got:
    '1001b1'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 640, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a3'
Got:
    '1001b2'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 642, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '14a1'
Got:
    '1001b3'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 645, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '45a3'
Got:
    '1014g2'
**********************************************************************
```



---

Comment by jdemeyer created at 2013-05-23 13:56:48

Changing status from needs_work to needs_review.


---

Attachment


---

Attachment


---

Comment by fbissey created at 2013-05-25 09:35:35

Funny that. We did face the upgrade in sage-on-gentoo in sage 5.8 and we had the same issue. Christopher was supposed to open a ticket with his solution but he never did.


```
--- sage/databases/cremona.py.orig	2013-02-19 10:33:56.000000000 +0000
+++ sage/databases/cremona.py	2013-03-18 16:51:58.950097433 +0000
@@ -634,19 +634,19 @@
 
             sage: it = CremonaDatabase().__iter__()
             sage: it.next().label()
-            '11a1'
+            '1001a1'
             sage: it.next().label()
-            '11a2'
+            '1001b1'
             sage: it.next().label()
-            '11a3'
+            '1001b2'
             sage: it.next().label()
-            '14a1'
+            '1001b3'
             sage: skip = [it.next() for _ in range(100)]
             sage: it.next().label()
-            '45a3'
+            '1014g2'
         """
         for c in self.__connection__.cursor().execute('SELECT curve FROM ' \
-            + 't_curve'):
+            + 't_curve ORDER BY curve'):
             yield self.elliptic_curve(c[0])
 
     def __getitem__(self, N):
```

Anyway, your solution looks good too. One concern we had: is it fast?


---

Comment by jdemeyer created at 2013-05-25 10:11:34

Replying to [comment:5 fbissey]:
> One concern we had: is it fast?

I have no idea, but I assume that SQLite is sufficiently fast. There are other place too where `ORDER BY` is used. In any case, your patch is not good because it assumes that there is no curve of conductor 10001 for example. This assumption is false if the large Cremona database has been installed.


---

Comment by fbissey created at 2013-05-25 10:19:14

Roger that, of course we don't currently package the large Cremona database so it was easy to miss. Looks all good to me, positive review.


---

Comment by fbissey created at 2013-05-25 10:19:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-05-26 19:48:30

Resolution: fixed
