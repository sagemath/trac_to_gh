# Issue 14425: Upgrade and clean up sqlite package

archive/issues_014425.json:
```json
{
    "body": "Assignee: @jdemeyer\n\nKeywords: sqlite package\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14629\n\n",
    "created_at": "2013-05-22T19:09:19Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Upgrade and clean up sqlite package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14425",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: @jdemeyer

Keywords: sqlite package



Issue created by migration from https://trac.sagemath.org/ticket/14629





---

archive/issue_comments_182138.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-22T20:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182138",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182139.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-23T11:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182139",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_182140.json:
```json
{
    "body": "\n```\nsage -t devel/sage/sage/databases/cremona.py\n**********************************************************************\nFile \"devel/sage/sage/databases/cremona.py\", line 636, in sage.databases.cremona.MiniCremonaDatabase.__iter__\nFailed example:\n    it.next().label()\nExpected:\n    '11a1'\nGot:\n    '1001a1'\n**********************************************************************\nFile \"devel/sage/sage/databases/cremona.py\", line 638, in sage.databases.cremona.MiniCremonaDatabase.__iter__\nFailed example:\n    it.next().label()\nExpected:\n    '11a2'\nGot:\n    '1001b1'\n**********************************************************************\nFile \"devel/sage/sage/databases/cremona.py\", line 640, in sage.databases.cremona.MiniCremonaDatabase.__iter__\nFailed example:\n    it.next().label()\nExpected:\n    '11a3'\nGot:\n    '1001b2'\n**********************************************************************\nFile \"devel/sage/sage/databases/cremona.py\", line 642, in sage.databases.cremona.MiniCremonaDatabase.__iter__\nFailed example:\n    it.next().label()\nExpected:\n    '14a1'\nGot:\n    '1001b3'\n**********************************************************************\nFile \"devel/sage/sage/databases/cremona.py\", line 645, in sage.databases.cremona.MiniCremonaDatabase.__iter__\nFailed example:\n    it.next().label()\nExpected:\n    '45a3'\nGot:\n    '1014g2'\n**********************************************************************\n```\n",
    "created_at": "2013-05-23T11:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182140",
    "user": "https://github.com/jdemeyer"
}
```


```
sage -t devel/sage/sage/databases/cremona.py
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 636, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a1'
Got:
    '1001a1'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 638, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a2'
Got:
    '1001b1'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 640, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '11a3'
Got:
    '1001b2'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 642, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '14a1'
Got:
    '1001b3'
**********************************************************************
File "devel/sage/sage/databases/cremona.py", line 645, in sage.databases.cremona.MiniCremonaDatabase.__iter__
Failed example:
    it.next().label()
Expected:
    '45a3'
Got:
    '1014g2'
**********************************************************************
```




---

archive/issue_comments_182141.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-23T13:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182141",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182142.json:
```json
{
    "body": "Attachment [14629_sqlite.patch](tarball://root/attachments/some-uuid/ticket14629/14629_sqlite.patch) by @jdemeyer created at 2013-05-23 13:56:48",
    "created_at": "2013-05-23T13:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182142",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14629_sqlite.patch](tarball://root/attachments/some-uuid/ticket14629/14629_sqlite.patch) by @jdemeyer created at 2013-05-23 13:56:48



---

archive/issue_comments_182143.json:
```json
{
    "body": "Attachment [sqlite-3.7.17.diff](tarball://root/attachments/some-uuid/ticket14629/sqlite-3.7.17.diff) by @jdemeyer created at 2013-05-24 21:23:48",
    "created_at": "2013-05-24T21:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182143",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [sqlite-3.7.17.diff](tarball://root/attachments/some-uuid/ticket14629/sqlite-3.7.17.diff) by @jdemeyer created at 2013-05-24 21:23:48



---

archive/issue_comments_182144.json:
```json
{
    "body": "Funny that. We did face the upgrade in sage-on-gentoo in sage 5.8 and we had the same issue. Christopher was supposed to open a ticket with his solution but he never did.\n\n\n```\n--- sage/databases/cremona.py.orig\t2013-02-19 10:33:56.000000000 +0000\n+++ sage/databases/cremona.py\t2013-03-18 16:51:58.950097433 +0000\n@@ -634,19 +634,19 @@\n \n             sage: it = CremonaDatabase().__iter__()\n             sage: it.next().label()\n-            '11a1'\n+            '1001a1'\n             sage: it.next().label()\n-            '11a2'\n+            '1001b1'\n             sage: it.next().label()\n-            '11a3'\n+            '1001b2'\n             sage: it.next().label()\n-            '14a1'\n+            '1001b3'\n             sage: skip = [it.next() for _ in range(100)]\n             sage: it.next().label()\n-            '45a3'\n+            '1014g2'\n         \"\"\"\n         for c in self.__connection__.cursor().execute('SELECT curve FROM ' \\\n-            + 't_curve'):\n+            + 't_curve ORDER BY curve'):\n             yield self.elliptic_curve(c[0])\n \n     def __getitem__(self, N):\n```\n\nAnyway, your solution looks good too. One concern we had: is it fast?",
    "created_at": "2013-05-25T09:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182144",
    "user": "https://github.com/kiwifb"
}
```

Funny that. We did face the upgrade in sage-on-gentoo in sage 5.8 and we had the same issue. Christopher was supposed to open a ticket with his solution but he never did.


```
--- sage/databases/cremona.py.orig	2013-02-19 10:33:56.000000000 +0000
+++ sage/databases/cremona.py	2013-03-18 16:51:58.950097433 +0000
@@ -634,19 +634,19 @@
 
             sage: it = CremonaDatabase().__iter__()
             sage: it.next().label()
-            '11a1'
+            '1001a1'
             sage: it.next().label()
-            '11a2'
+            '1001b1'
             sage: it.next().label()
-            '11a3'
+            '1001b2'
             sage: it.next().label()
-            '14a1'
+            '1001b3'
             sage: skip = [it.next() for _ in range(100)]
             sage: it.next().label()
-            '45a3'
+            '1014g2'
         """
         for c in self.__connection__.cursor().execute('SELECT curve FROM ' \
-            + 't_curve'):
+            + 't_curve ORDER BY curve'):
             yield self.elliptic_curve(c[0])
 
     def __getitem__(self, N):
```

Anyway, your solution looks good too. One concern we had: is it fast?



---

archive/issue_comments_182145.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> One concern we had: is it fast?\n\nI have no idea, but I assume that SQLite is sufficiently fast. There are other place too where `ORDER BY` is used. In any case, your patch is not good because it assumes that there is no curve of conductor 10001 for example. This assumption is false if the large Cremona database has been installed.",
    "created_at": "2013-05-25T10:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182145",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 fbissey]:
> One concern we had: is it fast?

I have no idea, but I assume that SQLite is sufficiently fast. There are other place too where `ORDER BY` is used. In any case, your patch is not good because it assumes that there is no curve of conductor 10001 for example. This assumption is false if the large Cremona database has been installed.



---

archive/issue_comments_182146.json:
```json
{
    "body": "Roger that, of course we don't currently package the large Cremona database so it was easy to miss. Looks all good to me, positive review.",
    "created_at": "2013-05-25T10:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182146",
    "user": "https://github.com/kiwifb"
}
```

Roger that, of course we don't currently package the large Cremona database so it was easy to miss. Looks all good to me, positive review.



---

archive/issue_comments_182147.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-25T10:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182147",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182148.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-26T19:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14425#issuecomment-182148",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_014195.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-26T19:48:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14425",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14425#event-14195"
}
```
