# Issue 31443: Poset of manifold subsets

Issue created by migration from https://trac.sagemath.org/ticket/31680

Original creator: mkoeppe

Original creation time: 2021-04-17 19:14:07

CC:  @mjungmath egourgoulhon tscrim

The declared subsets or supersets of a `ManifoldSubset` form finite posets. We add methods to expose them as instances of `FinitePoset`.




---

Comment by @mjungmath created at 2021-04-17 19:31:59

Possibly related: #30263.


---

Comment by mkoeppe created at 2021-04-17 19:32:58

Yes, hopefully this new feature can be used as a debugging tool


---

Comment by mkoeppe created at 2021-04-17 20:48:06

Here's a first step: Building a digraph from the defined subsets.

(Plotting needs `dot2tex` and looks bad because of the long labels. I don't know if it is possible to replace the labels by the latex names)
----
New commits:


---

Comment by git created at 2021-04-18 02:07:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-18 05:57:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-18 16:45:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-18 20:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-18 20:50:44

Replying to [comment:4 mkoeppe]:
> Here's a first step: Building a digraph from the defined subsets.

I'm happy to see this happening! At the beginning of the SageManifolds project, it was pretty clear that graphs would be the proper way to deal with subsets, but I was not familiar with this part of Sage and wanted to move fast...

> 
> (Plotting needs `dot2tex` and looks bad because of the long labels. I don't know if it is possible to replace the labels by the latex names)

This would be nice, indeed. Playing with the doctest examples, 

```
sage: view(latex(D))                                                                                
sage: view(latex(P))                                                                                
```

yields nice figures, with the latex names.


---

Comment by @mjungmath created at 2021-04-18 21:11:28

This digraph approach might also be useful to improve restrictions of tensor fields and make them even faster, no?


---

Comment by mkoeppe created at 2021-04-18 21:22:42

Replying to [comment:12 gh-mjungmath]:
> This digraph approach might also be useful to improve restrictions of tensor fields and make them even faster, no?

Yes, I think there are many more digraph / poset structures in sage.manifolds that could be exposed by similar methods in follow-up tickets.

On this ticket I am not making an attempt to actually change any of the internal representations of these structures. Just providing some tools that give a high-level view on the existing structures.


---

Comment by @mjungmath created at 2021-04-18 21:34:40

Replying to [comment:13 mkoeppe]:
> Replying to [comment:12 gh-mjungmath]:
> > This digraph approach might also be useful to improve restrictions of tensor fields and make them even faster, no?
> 
> Yes, I think there are many more digraph / poset structures in sage.manifolds that could be exposed by similar methods in follow-up tickets.
> 
> On this ticket I am not making an attempt to actually change any of the internal representations of these structures. Just providing some tools that give a high-level view on the existing structures.
> 

+1

Besides, I really like the way you write code. It's clear and neat!


---

Comment by git created at 2021-04-18 22:34:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-18 22:55:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-18 22:56:45

Changing status from new to needs_review.


---

Comment by git created at 2021-04-19 23:16:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-21 15:48:02

LGTM. 

_Side note:_ it's a pity that the subsets latex names cannot be used for the plots. 
I've not found such an option in the `plot` method of graphs; for posets, one can use the option `element_labels` as follows:

```
sage: M = Manifold(3, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V'); W = M.open_subset('W')
sage: VW = V.union(W)
sage: P = M.subset_poset()
sage: P.plot(element_labels={s: s._name for s in M.subsets()})
```

Do you think it is worth to include this trick in the documentation?


---

Comment by egourgoulhon created at 2021-04-21 15:48:02

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-04-21 16:22:41

Good idea, I'll add it. This is very useful.


---

Comment by git created at 2021-04-21 17:02:43

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-04-21 17:02:43

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-04-21 17:03:11

Also added examples for relabeled plotting of the digraphs.


---

Comment by mkoeppe created at 2021-04-21 20:25:27

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-04-21 20:25:27

In light of #30263, I am going to revise the definition of the poset.


---

Comment by git created at 2021-04-22 04:33:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-22 04:39:45

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-04-22 04:39:45

Here's a new version in which the vertices of graph and poset representing manifold subsets are wrapped in an extra layer of a `frozenset`. This new format is intended to be future-proof for the changes necessary to fix #30263:  Basically, one will need to quotient out by the equality relation of subsets.

In fact, instead of using `frozenset` directly, I define a subclass called `ManifoldSubsetSet`, which is convenient for printing and sorting.


---

Comment by git created at 2021-04-22 17:54:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-22 17:58:55

This new class `ManifoldSubsetSet` could obviously be generalized to other finite sets of manifold objects. Would this be of interest?


---

Comment by git created at 2021-04-22 20:04:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-22 20:25:52

Ready for review.


---

Comment by git created at 2021-04-23 04:31:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-23 12:48:38

Thanks for the update. Looks good. I've got two remarks:

1. Is there any reason for the names `FiniteManifoldObjectFamily` and `FiniteManifoldSubsetFamily` instead of `ManifoldObjectFiniteFamily` and `ManifoldSubsetFiniteFamily`? The latter ones sound more natural to me, making clear that we are dealing with finite families.

2. To generate the documentation about these classes in the reference manual, the new entry `sage/manifolds/family` must be added to `src/doc/en/reference/manifolds/manifolds.rst`


---

Comment by git created at 2021-04-23 14:00:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-23 14:04:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-23 14:05:28

Replying to [comment:32 egourgoulhon]:
> 1. Is there any reason for the names `FiniteManifoldObjectFamily` and `FiniteManifoldSubsetFamily` instead of `ManifoldObjectFiniteFamily` and `ManifoldSubsetFiniteFamily`? The latter ones sound more natural to me, making clear that we are dealing with finite families.

Good idea, done.

> 2. To generate the documentation about these classes in the reference manual, the new entry `sage/manifolds/family` must be added to `src/doc/en/reference/manifolds/manifolds.rst`

Thanks, done - I always forget to do this.


---

Comment by git created at 2021-04-23 16:09:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-23 16:10:35

Did one final improvement for more informative printing


---

Comment by git created at 2021-04-23 16:56:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-24 10:05:41

Thanks for the changes. One minor remark: shouldn't

```
TypeError: all... subsets must have the same manifold
```

be replaced by 

```
TypeError: all open subsets must have the same manifold
```

in the output of the doctest

```
sage: ManifoldSubsetFiniteFamily([M, N])
```

in `ManifoldSubsetFiniteFamily` ? Both doctests passed, but the latter is identical to the actual message get by the user. 

Besides, do you think it is worth to add `PLOT` directives like

```
        .. PLOT::

            M = Manifold(3, 'M')
            U = M.open_subset('U'); V = M.open_subset('V'); W = M.open_subset('W')
            VW = V.union(W)
            P = M.subset_poset()
            g = P.plot(element_labels={element: element._name for element in P})
            sphinx_plot(g)
```

immediately after the doctest

```
            sage: P.plot(element_labels={element: element._name for element in P})
```

to generate plots of posets and digraphs in the reference manual?

In any case, I would suggest that the doctest markers `# not tested` are removed from the `plot` examples:

```diff
- sage: P.plot(element_labels={element: element._name for element in P})  # not tested
+ sage: P.plot(element_labels={element: element._name for element in P})                              
+ Graphics object consisting of 10 graphics primitives
```



---

Comment by git created at 2021-04-24 19:44:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-24 19:44:28

How's this look?


---

Comment by egourgoulhon created at 2021-04-25 08:13:22

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-04-25 08:13:22

Replying to [comment:41 mkoeppe]:
> How's this look?
That's perfect, thanks!


---

Comment by mkoeppe created at 2021-04-25 10:26:48

Thanks for the review!


---

Comment by vbraun created at 2021-06-21 21:17:40

Resolution: fixed
