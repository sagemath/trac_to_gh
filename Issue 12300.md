# Issue 12300: disable asm redc when building with clang

archive/issues_012300.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\ncurrently using an asm redc breaks building ecm when compiling with clang, we should disable this until it is fixed.\n\nI've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg).\n\nIssue created by migration from https://trac.sagemath.org/ticket/12472\n\n",
    "created_at": "2012-02-08T15:34:40Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "disable asm redc when building with clang",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12300",
    "user": "ohanar"
}
```
Assignee: GeorgSWeber

currently using an asm redc breaks building ecm when compiling with clang, we should disable this until it is fixed.

I've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg).

Issue created by migration from https://trac.sagemath.org/ticket/12472





---

archive/issue_comments_144707.json:
```json
{
    "body": "for review purposes",
    "created_at": "2012-02-08T15:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144707",
    "user": "ohanar"
}
```

for review purposes



---

archive/issue_comments_144708.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-08T15:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144708",
    "user": "ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144709.json:
```json
{
    "body": "Attachment [ecm-clang.patch](tarball://root/attachments/some-uuid/ticket12472/ecm-clang.patch) by ohanar created at 2012-02-08 15:35:41",
    "created_at": "2012-02-08T15:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144709",
    "user": "ohanar"
}
```

Attachment [ecm-clang.patch](tarball://root/attachments/some-uuid/ticket12472/ecm-clang.patch) by ohanar created at 2012-02-08 15:35:41



---

archive/issue_comments_144710.json:
```json
{
    "body": "Replying to [ticket:12472 ohanar]:\n> currently using an asm redc breaks building ecm when compiling with clang\nCould you please specify in which sense it \"breaks\"?",
    "created_at": "2012-02-13T13:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144710",
    "user": "jdemeyer"
}
```

Replying to [ticket:12472 ohanar]:
> currently using an asm redc breaks building ecm when compiling with clang
Could you please specify in which sense it "breaks"?



---

archive/issue_comments_144711.json:
```json
{
    "body": "I really dislike testing the value of \"$CC\".  Couldn't you check the output of \"$CC --version\" or something like this?",
    "created_at": "2012-02-13T13:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144711",
    "user": "jdemeyer"
}
```

I really dislike testing the value of "$CC".  Couldn't you check the output of "$CC --version" or something like this?



---

archive/issue_comments_144712.json:
```json
{
    "body": "Also, I'm updating the ecm spkg for a different reason at #12501.  Would you mind basing your spkg on the one from #12501?",
    "created_at": "2012-02-13T13:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144712",
    "user": "jdemeyer"
}
```

Also, I'm updating the ecm spkg for a different reason at #12501.  Would you mind basing your spkg on the one from #12501?



---

archive/issue_comments_144713.json:
```json
{
    "body": "We should IMHO disable this *conditionally*, depending on the compiler used.\n\nDon't know whether you've already rebased your spkg on that of #12501.\n\nBtw., upgrading to GMP-ECM 6.4.2 \"is recommended\" :-) (by Paul Zimmermann).",
    "created_at": "2012-03-22T18:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144713",
    "user": "leif"
}
```

We should IMHO disable this *conditionally*, depending on the compiler used.

Don't know whether you've already rebased your spkg on that of #12501.

Btw., upgrading to GMP-ECM 6.4.2 "is recommended" :-) (by Paul Zimmermann).



---

archive/issue_comments_144714.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> We should IMHO disable this *conditionally*, depending on the compiler used.\n\nOh, I see, your patch already does this.  The ticket's description was a bit misleading...",
    "created_at": "2012-03-22T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144714",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> We should IMHO disable this *conditionally*, depending on the compiler used.

Oh, I see, your patch already does this.  The ticket's description was a bit misleading...



---

archive/issue_comments_144715.json:
```json
{
    "body": "yeah, sorry. I was posting a bunch of clang fixes fixes at the time :)\n\nAlso, I have not yet rebased my spkg.",
    "created_at": "2012-03-22T19:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144715",
    "user": "ohanar"
}
```

yeah, sorry. I was posting a bunch of clang fixes fixes at the time :)

Also, I have not yet rebased my spkg.



---

archive/issue_comments_144716.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-23T19:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144716",
    "user": "mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144717.json:
```json
{
    "body": "Now needs to be rebased on the GMP-ECM 6.3.p7 spkg from #12830.\n\nI also have a -- still preliminary -- p8 related to #11705, i.e., fixing the asm redc code for dynamic linking on Linux PPC64 (which now probably also needs its own ticket...)",
    "created_at": "2012-05-24T15:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144717",
    "user": "leif"
}
```

Now needs to be rebased on the GMP-ECM 6.3.p7 spkg from #12830.

I also have a -- still preliminary -- p8 related to #11705, i.e., fixing the asm redc code for dynamic linking on Linux PPC64 (which now probably also needs its own ticket...)



---

archive/issue_comments_144718.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-25T04:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144718",
    "user": "ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144719.json:
```json
{
    "body": "ok, rebased",
    "created_at": "2012-05-25T04:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144719",
    "user": "ohanar"
}
```

ok, rebased



---

archive/issue_comments_144720.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-19T12:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144720",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144721.json:
```json
{
    "body": "Is this issue still valid? In any case, it needs to be rebased to ECM 6.4.4 (#14151).\n\nAlso: has upstream been contacted?",
    "created_at": "2013-05-19T12:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144721",
    "user": "jdemeyer"
}
```

Is this issue still valid? In any case, it needs to be rebased to ECM 6.4.4 (#14151).

Also: has upstream been contacted?



---

archive/issue_comments_144722.json:
```json
{
    "body": "It seems GMP-ECM 6.4.4('s `configure`) no longer supports `--disable-asm-redc`, but only `--enable-asm-redc=no` (for whatever reason, haven't investigated why).\n\nFWIW, I immediately get \"Illegal instruction\" in `make check` regardless of the setting; this is with an older svn version of `clang` though (clang version 3.1 (trunk 155201)).",
    "created_at": "2013-06-03T14:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144722",
    "user": "leif"
}
```

It seems GMP-ECM 6.4.4('s `configure`) no longer supports `--disable-asm-redc`, but only `--enable-asm-redc=no` (for whatever reason, haven't investigated why).

FWIW, I immediately get "Illegal instruction" in `make check` regardless of the setting; this is with an older svn version of `clang` though (clang version 3.1 (trunk 155201)).



---

archive/issue_comments_144723.json:
```json
{
    "body": "Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4",
    "created_at": "2013-06-03T14:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144723",
    "user": "jdemeyer"
}
```

Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4



---

archive/issue_comments_144724.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4\n\nYep, my svn version appears to be broken somehow.\n\nStill, `--disable-asm-redc` doesn't work.",
    "created_at": "2013-06-03T14:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144724",
    "user": "leif"
}
```

Replying to [comment:13 jdemeyer]:
> Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4

Yep, my svn version appears to be broken somehow.

Still, `--disable-asm-redc` doesn't work.



---

archive/issue_comments_144725.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2013-06-03T20:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144725",
    "user": "leif"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_144726.json:
```json
{
    "body": "Replying to [comment:14 leif]:\n> Replying to [comment:13 jdemeyer]:\n> > Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4\n> \n> Yep, my svn version appears to be broken somehow.\n\nWorks for me with clang 3.2, too, even with `--enable-asm-redc` (the default) on Linux x86_64; `make check` as well as all (long) doctests in `sage/libs/libecm.py` passed.",
    "created_at": "2013-06-03T20:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144726",
    "user": "leif"
}
```

Replying to [comment:14 leif]:
> Replying to [comment:13 jdemeyer]:
> > Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4
> 
> Yep, my svn version appears to be broken somehow.

Works for me with clang 3.2, too, even with `--enable-asm-redc` (the default) on Linux x86_64; `make check` as well as all (long) doctests in `sage/libs/libecm.py` passed.



---

archive/issue_comments_144727.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-06-04T09:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144727",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_144728.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-06-04T09:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144728",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144729.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2013-06-06T12:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12300#issuecomment-144729",
    "user": "jdemeyer"
}
```

Resolution: worksforme
