# Issue 12300: disable asm redc when building with clang

Issue created by migration from https://trac.sagemath.org/ticket/12472

Original creator: ohanar

Original creation time: 2012-02-08 15:34:40

Assignee: GeorgSWeber

currently using an asm redc breaks building ecm when compiling with clang, we should disable this until it is fixed.

I've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/ecm-6.3.p4.spkg).


---

Comment by ohanar created at 2012-02-08 15:35:33

for review purposes


---

Comment by ohanar created at 2012-02-08 15:35:41

Changing status from new to needs_review.


---

Attachment


---

Comment by jdemeyer created at 2012-02-13 13:14:02

Replying to [ticket:12472 ohanar]:
> currently using an asm redc breaks building ecm when compiling with clang
Could you please specify in which sense it "breaks"?


---

Comment by jdemeyer created at 2012-02-13 13:15:55

I really dislike testing the value of "$CC".  Couldn't you check the output of "$CC --version" or something like this?


---

Comment by jdemeyer created at 2012-02-13 13:18:13

Also, I'm updating the ecm spkg for a different reason at #12501.  Would you mind basing your spkg on the one from #12501?


---

Comment by leif created at 2012-03-22 18:33:11

We should IMHO disable this _conditionally_, depending on the compiler used.

Don't know whether you've already rebased your spkg on that of #12501.

Btw., upgrading to GMP-ECM 6.4.2 "is recommended" :-) (by Paul Zimmermann).


---

Comment by leif created at 2012-03-22 18:37:31

Replying to [comment:5 leif]:
> We should IMHO disable this _conditionally_, depending on the compiler used.

Oh, I see, your patch already does this.  The ticket's description was a bit misleading...


---

Comment by ohanar created at 2012-03-22 19:04:57

yeah, sorry. I was posting a bunch of clang fixes fixes at the time :)

Also, I have not yet rebased my spkg.


---

Comment by mariah created at 2012-05-23 19:40:29

Changing status from needs_review to needs_work.


---

Comment by leif created at 2012-05-24 15:31:09

Now needs to be rebased on the GMP-ECM 6.3.p7 spkg from #12830.

I also have a -- still preliminary -- p8 related to #11705, i.e., fixing the asm redc code for dynamic linking on Linux PPC64 (which now probably also needs its own ticket...)


---

Comment by ohanar created at 2012-05-25 04:16:32

Changing status from needs_work to needs_review.


---

Comment by ohanar created at 2012-05-25 04:16:32

ok, rebased


---

Comment by jdemeyer created at 2013-05-19 12:58:59

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-05-19 12:58:59

Is this issue still valid? In any case, it needs to be rebased to ECM 6.4.4 (#14151).

Also: has upstream been contacted?


---

Comment by leif created at 2013-06-03 14:37:23

It seems GMP-ECM 6.4.4('s `configure`) no longer supports `--disable-asm-redc`, but only `--enable-asm-redc=no` (for whatever reason, haven't investigated why).

FWIW, I immediately get "Illegal instruction" in `make check` regardless of the setting; this is with an older svn version of `clang` though (clang version 3.1 (trunk 155201)).


---

Comment by jdemeyer created at 2013-06-03 14:47:03

Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4


---

Comment by leif created at 2013-06-03 14:58:14

Replying to [comment:13 jdemeyer]:
> Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4

Yep, my svn version appears to be broken somehow.

Still, `--disable-asm-redc` doesn't work.


---

Comment by leif created at 2013-06-03 20:33:25

Changing status from needs_work to needs_info.


---

Comment by leif created at 2013-06-03 20:33:25

Replying to [comment:14 leif]:
> Replying to [comment:13 jdemeyer]:
> > Works for me (even with checking) on `sage.math` with Clang-3.2 and ECM-6.4.4
> 
> Yep, my svn version appears to be broken somehow.

Works for me with clang 3.2, too, even with `--enable-asm-redc` (the default) on Linux x86_64; `make check` as well as all (long) doctests in `sage/libs/libecm.py` passed.


---

Comment by jdemeyer created at 2013-06-04 09:55:03

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2013-06-04 09:55:09

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-06-06 12:42:53

Resolution: worksforme
