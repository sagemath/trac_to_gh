# Issue 13616: This patch implements the construction of the Johnson graph.

Issue created by migration from https://trac.sagemath.org/ticket/13820

Original creator: slani

Original creation time: 2012-12-11 14:57:14

Assignee: jason, ncohen, rlm

CC:  azi ncohen

Keywords: Johnson graph

Hello! This is my first contribution to sage. Its quite trivial since it is only meant to test how things work here. Hopefully I'll add something more substantial in the near future.

Let me know if the patch is appropriate.


---

Comment by slani created at 2012-12-11 15:01:23

Changing assignee from jason, ncohen, rlm to slani.


---

Attachment


---

Comment by azi created at 2012-12-11 18:06:53

Changing status from new to needs_review.


---

Comment by azi created at 2012-12-11 18:07:44

Hello slani! 

The patch looks good to me - i am quite surprised sage didn't have this graph!

Hopefully ncohen can jump in and verify the patch as well since I am also quite new to sage.


---

Comment by ncohen created at 2012-12-12 13:53:51

Helloooooooooooooooooo Uros !

Thank you for this addition ! Your patch looks nice indeed, but there are a few things missing :
* We try to always write a one-line description of what the function does on the first line of its documentation. Even if it is just, in your case "Returns the Johnson graph of parameters n,k" `:-)`
* You can put some latex inside of the documentation of a method if you want by using ` characters. You can look at other methods to see how it is done.
* There is a problem with your "::". There should be only one after "Examples", and the explanations like "The Johnson graph is a Hamiltonian graph" should have less indentation. This is not totally useless, for the explanation behind all lies there 
  {{{
  sage -b && sage -docbuild reference html
  }}}
  Build the HTML documentation of Sage, where you can see the result of all these indentations and "::" indications. That's the point, and usually if it is displayed correctly then everything is good. There should not be any warning either when you build the documentation, or the release manager will complain !
* It would be good to define an embedding for this graph if there is a meaningful one. Or a pretty one. You can look at other methods of the same file to see how it is to be done. Of course, if there is no way to have a good one, let's forget about it. It happens, after all.
* More technically : in order to build adjacencies, you take all pairs of vertices and check whether their intersection has size `k-1`, and this is really inefficient for most of the pairs of vertices do not intersect on `k-1` elements. If would be more efficient to fix a set of size `k-1`, to generate all sets of k elements containing these k-1 elements, and to add an edge between them.

Here it issssssssss ! `:-)`

And as usual, if you think any of these remarks is not good feel free to say it, we just try to make Sage as great as possible, and as I make mistake when I write patches I also make mistakes when I review them `:-P`

Have fuuuuuuuuuuuuuuuuun ! And thank you again !

Nathann


---

Comment by ncohen created at 2012-12-12 13:53:51

Changing status from needs_review to needs_work.


---

Attachment

Nathann,

thanks for your suggestions. I applied your suggestion with the exception of the last two which I do not understand completely.


---

Comment by ncohen created at 2012-12-14 09:59:34

Helloooooooo Uros !

About the last two points :
* Oh. By embedding, I was talking about the different between those two commands :

```
sage: graphs.PetersenGraph().show(layout="spring")
sage: graphs.PetersenGraph().show()  
```

  Most graph generators include the definition of an embedding (err. layout) in the graph they return, just in case that there would be a "nice" way to display the graph. Actually, it looks like there is no default layout for Kneser Graph (and I would have a hard time finding a general one). So except if you know a good way to display Johnson graphs, I guess you can skip it.

* If you write the algorithm this way "for any pair of vertices, test whether the intersection has size exactly k" the amount of operations you do is `(\binom n k)^2`. And that's usually a LOT `:-P`. If, instead, you write "for any sets S of size k-1, and for any two distincts elements i,j not included in S, add the edge (S+i,S+j)", then the amount of operations you do is exactly the number of edges you need to add. And I guess it may be faster, even for small cases `:-)`

  You can evaluate the time it takes to run a command this way :
  {{{
  sage: %timeit graphs.JohnsonGraph(6,4)
  25 loops, best of 3: 10.7 ms per loop
  sage: %timeit graphs.JohnsonGraph(7,4)
  5 loops, best of 3: 55.2 ms per loop
  sage: %timeit graphs.JohnsonGraph(8,4)
  5 loops, best of 3: 217 ms per loop
  }}}

Nathann


---

Attachment

tried to improve speed


---

Comment by slani created at 2013-01-11 06:23:20

Nathann, 

The old one:



```
sage:  %timeit graphs.JohnsonGraph(8,4)
5 loops, best of 3: 562 ms per loop
sage: %timeit graphs.JohnsonGraph(7,4)
5 loops, best of 3: 144 ms per loop
sage: %time graphs.JohnsonGraph(7,4)
CPU times: user 0.15 s, sys: 0.00 s, total: 0.15 s
Wall time: 0.15 s
Johnson graph with parameters 7,4: Graph on 35 vertices
sage:  %time graphs.JohnsonGraph(8,4)
CPU times: user 0.56 s, sys: 0.00 s, total: 0.56 s
Wall time: 0.55 s
Johnson graph with parameters 8,4: Graph on 70 vertices
```



The new one:

```
sage:  %timeit graphs.JohnsonGraph(8,4)
5 loops, best of 3: 602 ms per loop
sage: %timeit graphs.JohnsonGraph(7,4)
5 loops, best of 3: 258 ms per loop
sage: %time graphs.JohnsonGraph(7,4)
CPU times: user 0.26 s, sys: 0.00 s, total: 0.26 s
Wall time: 0.27 s
Johnson graph with parameters 7,4: Graph on 35 vertices
sage: %time graphs.JohnsonGraph(8,4)
CPU times: user 0.60 s, sys: 0.00 s, total: 0.60 s
Wall time: 0.61 s
Johnson graph with parameters 8,4: Graph on 70 vertices
```

Maybe my new code is not right???


slani


---

Comment by ncohen created at 2013-01-11 09:05:24

Hellooooooooo !!

Actually, I was thinking of this :

```
def J(n,k):
    from sage.combinat.subset import Subsets
    from sage.graphs.graph import Graph
    g = Graph(name="Johnson graph with parameters "+str(n)+","+str(k))
    X = Set(range(n))

    g.add_vertices(Subsets(X,k))

    # All sets A and B such that A inter B = X and |X| = k-1 are adjacent                                                                                                 

    # We first iterate over all sets X of cardinality k-1, then build the sets A and B                                                                                    
    for I in Subsets(X,k-1):

	elements_left = X-I
	# A = I u {x}                                                                                                                                                     
	# B = I u {y}                                                                                                                                                     
        for x in elements_left:
            for y in elements_left:
                # We assume that y>x                                                                                                                                      
            	if y <= x:
                    continue
		g.add_edge(I+Set([x]),I+Set([y]))

    return g
```


By the way, a BIG patch #13862 was recently added to Sage which totally changes the file you touch. `graph_generators.py` is now split into many files (smallgraphs.py, families.py, platonic_solids.py, ...), and your patch does not apply to the latest version of Sage, which is 5.6.beta3. Hence, two solutions :

* Can you install sage 5.6.beta3 and create a patch from this version of it, so that the release manager can easily add it to Sage ? (in this case your function should go inside of `families.py`
* Can you produce, on your current version of Sage, a patch containing all that you did in only one file ? I will then adapt it to 5.6.beta3 myself.

Have fuuuuuuuuuuuuuuuuuuuuuuuuuun ! `;-)`

Nathann


---

Comment by slani created at 2013-01-13 16:50:49

Nathann,

I tried your code and it's faster than mine :D


I will make a patch for verison 5.6.beta3 and use your code. It this ok with you?

slani


---

Comment by ncohen created at 2013-01-13 16:51:37

It would be peeeeeeeeeerfect ! `:-)`

Nathann


---

Attachment


---

Comment by slani created at 2013-01-26 17:13:16

New patch was added. I hope it is OK?

slani


---

Comment by ncohen created at 2013-01-26 17:14:45

> New patch was added. I hope it is OK?

Oh. I'll give it a look. The point is : if you write a comment on this page everybody gets a message, and if you just upload a patch without saying anything nobody knows about it. I had no idea you had uploaded a new patch.

Nathann


---

Comment by ncohen created at 2013-01-26 17:24:22

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-01-26 17:24:22

Helloooooooo again !

Well, your patch looks good indeed, short of a few unimportant things :
* Your paragraphs were a bit too short, the limit in Sage is something like 80 characters
* It was a good occasion to advertise a Wikipedia page
* There were some trailing whitespaces, and it may hurt some people's feeling to find these in Sage's code.

This is fixed in a small reviewer's patch that I attach. If you agree with those changes (and as I agree with yours), then you can set this ticket to `positive_review`. And thank you for this patch of course `:-)`

Nathann


---

Comment by ncohen created at 2013-01-26 17:24:53

Apply trac_JohnsonGraph_5_6.patch, trac_13820-rev.patch


---

Comment by ncohen created at 2013-01-26 17:47:21

Changing type from task to enhancement.


---

Attachment


---

Comment by slani created at 2013-01-28 22:04:51

Nathann,

It's OK with me and thank you for your help.

slani


---

Comment by ncohen created at 2013-01-29 10:42:39

Then you should set the ticket to `positive_review`, otherwise it will never be merged into Sage ! (look below the comment box. Click on "modify ticket").

Have fuuuuuuuuuun !

Nathann


---

Comment by slani created at 2013-01-29 21:48:21

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-02-05 08:19:12

Resolution: fixed
