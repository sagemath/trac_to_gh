# Issue 22586: Symbolic asin/acos do not return NaN where possible

Issue created by migration from https://trac.sagemath.org/ticket/22823

Original creator: rws

Original creation time: 2017-04-18 08:31:36


```
sage: acos(2)
arccos(2)

sage: acos(SR(2.))
NaN
sage: type(acos(SR(2.)))
<type 'sage.symbolic.expression.Expression'>
sage: type(acos(SR(2.)).pyobject())
<type 'sage.rings.real_mpfr.RealNumber'>
```

Expected would be:

```
sage: acos(2)
NaN
sage: type(acos(2))
<type 'sage.symbolic.expression.Expression'>
sage: type(acos(2).pyobject())
<class 'sage.symbolic.constants.NotANumber'>

sage: type(acos(SR(2.)))
<type 'sage.symbolic.expression.Expression'>
sage: type(acos(SR(2.)).pyobject())
<class 'sage.symbolic.constants.NotANumber'>
```

Same applies to `asin`. Compare with:

```
sage: asec(0)
NaN
sage: type(asec(0))
<type 'sage.symbolic.expression.Expression'>
sage: type(asec(0).pyobject())
<class 'sage.symbolic.constants.NotANumber'>
sage: acsc(0)
NaN
sage: type(acsc(0))
<type 'sage.symbolic.expression.Expression'>
sage: type(acsc(0).pyobject())
<class 'sage.symbolic.constants.NotANumber'>

sage: type(asec(0.).pyobject())
<class 'sage.symbolic.constants.NotANumber'>
sage: type(acsc(0.).pyobject())
<class 'sage.symbolic.constants.NotANumber'>
```



---

Comment by mforets created at 2017-04-18 13:28:43

with a custom function this happens:


```
sage: f = piecewise([((-1,0), 1), ([0,1], -1)], var=x)
sage: f(2)
...
ValueError: point 2 is not in the domain
```


to say that the result here is more informative than NaN, although i suppose that the notion of domain is a feature not implemented for symbolic functions?..


---

Comment by rws created at 2017-04-18 14:41:19

New commits:


---

Comment by rws created at 2017-04-18 14:49:41

Replying to [comment:1 mforets]:
> {{{
> ValueError: point 2 is not in the domain
> }}}
> 
> to say that the result here is more informative than NaN, although i suppose that the notion of domain is a feature not implemented for symbolic functions?..

We're far away from that unfortunately.


---

Comment by kcrisman created at 2017-04-18 20:08:59

Whoah.  Are you then saying we also shouldn't allow `log(-1)`?  After all:


```
sage: acos(CC(2))
1.31695789692482*I
```


I'm not cool with all of a sudden assuming symbolic things couldn't be complex, unless we are very consistent about this everywhere, and I suspect this would break a lot of stuff.    Your example with arc secant is a red herring, because



```
sage: asec(CC(0))
NaN
```


At the very least this sort of thing should be discussed on sage-devel, in my view.


---

Comment by rws created at 2017-04-19 03:27:10

Well then, scratch the acos(2) part, the acos(SR(2.1)) part certainly needs fixing. Thanks for the review.


---

Comment by kcrisman created at 2017-04-19 14:30:50

> Well then, scratch the acos(2) part, the acos(SR(2.1)) part certainly needs fixing. Thanks for the review.
I'm not saying we couldn't do that, but we would definitely need discussion on it and you are right that things should be consistent.  My guess is that making things consistent with your idea might lead to a lot of work being needed as well as other stuff breaking, but I am not an expert in numerics either.
----
New commits:


---

Comment by rws created at 2017-04-20 08:26:59

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-04-20 13:53:00

`@`kcrisman, are you okay with the current branch getting a positive review and then pushing the other issues to another ticket? The other thing we could do is move the doctests into another ticket.


---

Comment by kcrisman created at 2017-04-20 15:09:44

> `@`kcrisman, are you okay with the current branch getting a positive review and then pushing the other issues to another ticket? The other thing we could do is move the doctests into another ticket.

Sure, that is no problem at all, assuming all is working fine.


---

Comment by tscrim created at 2017-04-20 15:14:51

Thanks.


---

Comment by tscrim created at 2017-04-20 15:14:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-28 23:54:48

Resolution: fixed


---

Comment by rws created at 2018-02-25 06:53:00

Reverted in pynac-0.7.17. Reason would be consistency with #24428.
