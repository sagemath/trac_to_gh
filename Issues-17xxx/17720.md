# Issue 17720: failing primary decomposition with extension field coefficients

archive/issues_017483.json:
```json
{
    "body": "The following bugs are likely Singular interface bugs (have to investigate):\nsince the same examples run using shipped Singular behave differently\n\nIt may also relate to Singular's variable shadowing issue, see ticket #17721\n\n0. working example:\n\n```\nsage: R.<b>=QQ[]\nsage: K.<b>=QQ.extension(b^2-b-1)\nsage: r.<x,z>=K[]\nsage: I=r.ideal(z)\nsage: L = I.primary_decomposition(\"gtz\")\nsage: [ J.gens() for J in L]\n#[[z]]\n```\n1. example with wrong result:\n\n```\nsage: R.<p>=QQ[]\nsage: K.<p>=QQ.extension(p^2-p-1)\nsage: r.<x,z>=K[]\nsage: I=r.ideal(z)\nsage: L = I.primary_decomposition(\"gtz\") # wrong!\nsage: [ J.gens() for J in L] \n#[[0, 0]]\n```\n2. crashing example:\n\n```\nsage: R.<p>=QQ[]\nsage: K.<p>=QQ.extension(p^2-p-1)\nsage: r.<x,z>=K[]\nsage:  \nsage: I=r.ideal(z)\nsage: I.primary_decomposition()\n#RuntimeError: Error in Singular function call 'primdecSY':\n# identifier pr not found in RH\n# error occurred in or before primdec.lib::algeDeco line 2732: `      list pr=imap(RH,pr);`\n# leaving primdec.lib::algeDeco\n# leaving primdec.lib::primdecSY\n```\n\ncorresponding Singular code:\n\n```\nLIB(\"primdec.lib\");\nring rng = (0,p),(x,z), dp;\nminpoly = p^2-p-1;\nideal I  = z;\nprimdecGTZ(I);\nprimdecSY(I); \n```\n\noutput\n\n```\n> ring rng = (0,p),(x,z), dp;\n> option(redSB);option(redTail);option(intStrategy);option(redThrough);\n> minpoly = p^2-p-1;\n> ideal I  = z;\n> primdecGTZ(I); // 0 in sage, z in Singular...???\n[1]:\n   [1]:\n      _[1]=z\n   [2]:\n      _[1]=z\n[2]:\n   [1]:\n      _[1]=z\n   [2]:\n      _[1]=z\n\n> primdecSY(I);  //fails in sage, ok in Singular ...???\n[1]:\n   [1]:\n      _[1]=z\n   [2]:\n      _[1]=z\n[2]:\n   [1]:\n      _[1]=z\n   [2]:\n      _[1]=z\n\n```\n\nCC:  simonking @malb\n\nKeywords: Singular\n\nStopgaps: todo\n\nReviewer: Markus Wageringel\n\nAuthor: Dave Morris\n\nBranch: 0e13dc3fdb298839e4f9e69bffc2d7491e260c05\n\nCommit: 0e13dc3fdb298839e4f9e69bffc2d7491e260c05\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17720\n\n",
    "closed_at": "2021-03-09T00:00:56Z",
    "created_at": "2015-02-03T14:59:55Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "failing primary decomposition with extension field coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17720",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```
The following bugs are likely Singular interface bugs (have to investigate):
since the same examples run using shipped Singular behave differently

It may also relate to Singular's variable shadowing issue, see ticket #17721

0. working example:

```
sage: R.<b>=QQ[]
sage: K.<b>=QQ.extension(b^2-b-1)
sage: r.<x,z>=K[]
sage: I=r.ideal(z)
sage: L = I.primary_decomposition("gtz")
sage: [ J.gens() for J in L]
#[[z]]
```
1. example with wrong result:

```
sage: R.<p>=QQ[]
sage: K.<p>=QQ.extension(p^2-p-1)
sage: r.<x,z>=K[]
sage: I=r.ideal(z)
sage: L = I.primary_decomposition("gtz") # wrong!
sage: [ J.gens() for J in L] 
#[[0, 0]]
```
2. crashing example:

```
sage: R.<p>=QQ[]
sage: K.<p>=QQ.extension(p^2-p-1)
sage: r.<x,z>=K[]
sage:  
sage: I=r.ideal(z)
sage: I.primary_decomposition()
#RuntimeError: Error in Singular function call 'primdecSY':
# identifier pr not found in RH
# error occurred in or before primdec.lib::algeDeco line 2732: `      list pr=imap(RH,pr);`
# leaving primdec.lib::algeDeco
# leaving primdec.lib::primdecSY
```

corresponding Singular code:

```
LIB("primdec.lib");
ring rng = (0,p),(x,z), dp;
minpoly = p^2-p-1;
ideal I  = z;
primdecGTZ(I);
primdecSY(I); 
```

output

```
> ring rng = (0,p),(x,z), dp;
> option(redSB);option(redTail);option(intStrategy);option(redThrough);
> minpoly = p^2-p-1;
> ideal I  = z;
> primdecGTZ(I); // 0 in sage, z in Singular...???
[1]:
   [1]:
      _[1]=z
   [2]:
      _[1]=z
[2]:
   [1]:
      _[1]=z
   [2]:
      _[1]=z

> primdecSY(I);  //fails in sage, ok in Singular ...???
[1]:
   [1]:
      _[1]=z
   [2]:
      _[1]=z
[2]:
   [1]:
      _[1]=z
   [2]:
      _[1]=z

```

CC:  simonking @malb

Keywords: Singular

Stopgaps: todo

Reviewer: Markus Wageringel

Author: Dave Morris

Branch: 0e13dc3fdb298839e4f9e69bffc2d7491e260c05

Commit: 0e13dc3fdb298839e4f9e69bffc2d7491e260c05

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17720





---

archive/issue_comments_233315.json:
```json
{
    "body": "<a id='comment:3'></a>Tracked down to the shadowing bug ( see [Singular forum discussion](http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2482&sid=64e9f0044ed3cf5020d494a45172f3dc)):\nin cases we use `p` as parameter name minpoly gets lost in primdec.lib::algedeco() \nin `(execute(mp) := execute(\"poly p = p^2-p-1\"))` statement.\nThe strange thing about this is that while calling Singular from sage \nits losing `'p^2-p'` part , but when using standalone Singular, it is keeping `'p^2'` and losing `'-p'`.\nStrange.",
    "created_at": "2015-02-21T08:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233315",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:3'></a>Tracked down to the shadowing bug ( see [Singular forum discussion](http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2482&sid=64e9f0044ed3cf5020d494a45172f3dc)):
in cases we use `p` as parameter name minpoly gets lost in primdec.lib::algedeco() 
in `(execute(mp) := execute("poly p = p^2-p-1"))` statement.
The strange thing about this is that while calling Singular from sage 
its losing `'p^2-p'` part , but when using standalone Singular, it is keeping `'p^2'` and losing `'-p'`.
Strange.



---

archive/issue_comments_233316.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233316",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_events_050696.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-01-29T03:07:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17720#event-50696"
}
```



---

archive/issue_comments_233317.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233317",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing priority from major to minor.



---

archive/issue_comments_233318.json:
```json
{
    "body": "<a id='comment:5'></a>The two previously failing examples work now, so the PR adds them as doctests.\n\n---\nNew commits:",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233318",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:5'></a>The two previously failing examples work now, so the PR adds them as doctests.

---
New commits:



---

archive/issue_comments_233319.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-17T20:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233319",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233320.json:
```json
{
    "body": "<a id='comment:6'></a>This looks good to me.",
    "created_at": "2021-02-17T20:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233320",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:6'></a>This looks good to me.



---

archive/issue_comments_233321.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17720#issuecomment-233321",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050697.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17720",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17720#event-50697"
}
```
