# Issue 17730: Use Pari for is_cyclotomic()

archive/issues_017493.json:
```json
{
    "body": "The current implementation of `is_cyclotomic()` is either in Python or through the GP interface (when a certificate is required). Replacing all that by a call to Pari would be much faster.\n\nWe also implement a new method `is_cyclotomic_product` based on Pari `poliscycloprod`.\n\nCC:  @videlec\n\nKeywords: cyclotomic polynomial\n\nBranch/Commit: a70209cdf1fed0ece23327ef51a7e5456213ba1c\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Vincent Delecroix\n\nDependencies: #17631\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17730\n\n",
    "closed_at": "2015-04-14T19:43:58Z",
    "created_at": "2015-02-04T21:04:01Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Use Pari for is_cyclotomic()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17730",
    "user": "https://github.com/bgrenet"
}
```
The current implementation of `is_cyclotomic()` is either in Python or through the GP interface (when a certificate is required). Replacing all that by a call to Pari would be much faster.

We also implement a new method `is_cyclotomic_product` based on Pari `poliscycloprod`.

CC:  @videlec

Keywords: cyclotomic polynomial

Branch/Commit: a70209cdf1fed0ece23327ef51a7e5456213ba1c

Reviewer: Frédéric Chapoton

Author: Vincent Delecroix

Dependencies: #17631

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17730





---

archive/issue_comments_248583.json:
```json
{
    "body": "<a id='comment:1'></a>It could be done now since `poliscyclo` is in PARI-2.7.1",
    "created_at": "2015-02-05T07:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248583",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>It could be done now since `poliscyclo` is in PARI-2.7.1



---

archive/issue_comments_248584.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 jdemeyer]:\n> It could be done now since `poliscyclo` is in PARI-2.7.1\n\nThe idea (proposed by [ticket:17695#comment:10 vdelecroix]) was to wait for #17631 to be closed in order to avoid to have to manually edit `libs/pari/gen.pyx`. Do you think I shouldn't?",
    "created_at": "2015-02-06T13:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248584",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:2'></a>Replying to [comment:1 jdemeyer]:
> It could be done now since `poliscyclo` is in PARI-2.7.1

The idea (proposed by [ticket:17695#comment:10 vdelecroix]) was to wait for #17631 to be closed in order to avoid to have to manually edit `libs/pari/gen.pyx`. Do you think I shouldn't?



---

archive/issue_comments_248585.json:
```json
{
    "body": "<a id='comment:3'></a>I don't really have an opinion on whether you *should*. I'm just saying you *could* in case you were under the false impression that you really need #17631.",
    "created_at": "2015-02-06T13:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248585",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>I don't really have an opinion on whether you *should*. I'm just saying you *could* in case you were under the false impression that you really need #17631.



---

archive/issue_comments_248586.json:
```json
{
    "body": "<a id='comment:4'></a>The point is that I am not familiar with Pari's interface in Sage. So I am reluctant to learn it if I can avoid it by simply waiting for #17631 to be ready...",
    "created_at": "2015-02-06T13:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248586",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:4'></a>The point is that I am not familiar with Pari's interface in Sage. So I am reluctant to learn it if I can avoid it by simply waiting for #17631 to be ready...



---

archive/issue_comments_248587.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 bruno]:\n> by simply waiting for #17631 to be ready...\n\nI hope you're not in a hurry :-)\n\nI would say that #17631 is ready, but there is not much point in setting it to needs_review since it is based on #16997. And people don't seem to like #16997 that much since it is about upgrading to a non-released version of PARI. So probably you need to wait for a new PARI release to come out.",
    "created_at": "2015-02-06T13:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248587",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 bruno]:
> by simply waiting for #17631 to be ready...

I hope you're not in a hurry :-)

I would say that #17631 is ready, but there is not much point in setting it to needs_review since it is based on #16997. And people don't seem to like #16997 that much since it is about upgrading to a non-released version of PARI. So probably you need to wait for a new PARI release to come out.



---

archive/issue_comments_248588.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2015-03-20T16:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248588",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_events_050707.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-20T16:01:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17730#event-50707"
}
```



---

archive/issue_comments_248589.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-20T16:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248589",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248590.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The current implementation of `is_cyclotomic()` is either in Python or through the GP interface (when a certificate is required). Replacing all that by a call to Pari would be much faster.\n+\n+We also implement a new method `is_cyclotomic_product` based on Pari `poliscycloprod`.\n \n Dependencies: #17631\n \n``````\n",
    "created_at": "2015-03-20T16:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248590",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The current implementation of `is_cyclotomic()` is either in Python or through the GP interface (when a certificate is required). Replacing all that by a call to Pari would be much faster.
+
+We also implement a new method `is_cyclotomic_product` based on Pari `poliscycloprod`.
 
 Dependencies: #17631
 
``````




---

archive/issue_comments_248591.json:
```json
{
    "body": "<a id='comment:8'></a>With the branch applied\n\n```\nsage: p = cyclotomic_polynomial(14)\nsage: timeit(\"p.is_cyclotomic(algorithm='sage')\")\n625 loops, best of 3: 429 \u00b5s per loop\nsage: timeit(\"p.is_cyclotomic(algorithm='pari')\")\n625 loops, best of 3: 29.3 \u00b5s per loop\n```",
    "created_at": "2015-03-20T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248591",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>With the branch applied

```
sage: p = cyclotomic_polynomial(14)
sage: timeit("p.is_cyclotomic(algorithm='sage')")
625 loops, best of 3: 429 µs per loop
sage: timeit("p.is_cyclotomic(algorithm='pari')")
625 loops, best of 3: 29.3 µs per loop
```



---

archive/issue_comments_248592.json:
```json
{
    "body": "<a id='comment:9'></a>Looks good to me.\n\nI have made a review commit:\n\n- moving things around inside `is_cyclotomic` doc\n- changing the following behavior: if we ask for a certificate, then pari is used\n\nIf you agree with my changes, you can set a positive review\n\n---\nNew commits:",
    "created_at": "2015-03-22T09:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248592",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>Looks good to me.

I have made a review commit:

- moving things around inside `is_cyclotomic` doc
- changing the following behavior: if we ask for a certificate, then pari is used

If you agree with my changes, you can set a positive review

---
New commits:



---

archive/issue_comments_248593.json:
```json
{
    "body": "<a id='comment:10'></a>I do not like the fact that some argument forces the other silently. I do prefer the version in which the combination `p.is_cyclotomic(algorithm='sage', certificate=True)` raises an error. I took care of some of your modifications in my commit.\n\nOn the other hand, there was a mistake in the previous version: the arguments were not forwarded when the polynomial had coefficients in `QQ`.\n\n---\nNew commits:",
    "created_at": "2015-03-22T10:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248593",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>I do not like the fact that some argument forces the other silently. I do prefer the version in which the combination `p.is_cyclotomic(algorithm='sage', certificate=True)` raises an error. I took care of some of your modifications in my commit.

On the other hand, there was a mistake in the previous version: the arguments were not forwarded when the polynomial had coefficients in `QQ`.

---
New commits:



---

archive/issue_comments_248594.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-22T12:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248594",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248595.json:
```json
{
    "body": "<a id='comment:11'></a>Ok, looks good to me.\n\nI have just made three very minor doc formatting changes on top of your branch.\n\nPositive review.\n\n---\nNew commits:",
    "created_at": "2015-03-22T12:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248595",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>Ok, looks good to me.

I have just made three very minor doc formatting changes on top of your branch.

Positive review.

---
New commits:



---

archive/issue_comments_248596.json:
```json
{
    "body": "<a id='comment:12'></a>Great. Thanks!\n\nI still do not get why you need a merge commit (here 09a0022)...!?",
    "created_at": "2015-03-22T12:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248596",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>Great. Thanks!

I still do not get why you need a merge commit (here 09a0022)...!?



---

archive/issue_comments_248597.json:
```json
{
    "body": "<a id='comment:13'></a>Well, I am doing that (where develop is the latest beta):\n\n```\ngit ch develop -b 17XXX\ngit pull trac whatever_branch_for_17XXX\n```\nto get the branch.\n\nIf the branch is not based on the latest beta, the merge is forced upon me by git.\nThis has been working for me very well since long, but maybe I am plain wrong in my use of git.",
    "created_at": "2015-03-22T13:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248597",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Well, I am doing that (where develop is the latest beta):

```
git ch develop -b 17XXX
git pull trac whatever_branch_for_17XXX
```
to get the branch.

If the branch is not based on the latest beta, the merge is forced upon me by git.
This has been working for me very well since long, but maybe I am plain wrong in my use of git.



---

archive/issue_comments_248598.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 chapoton]:\n> Well, I am doing that (where develop is the latest beta):\n> \n> ```\n> git ch develop -b 17XXX\n> git pull trac whatever_branch_for_17XXX\n> ```\n> to get the branch.\n> \n> If the branch is not based on the latest beta, the merge is forced upon me by git.\n> This has been working for me very well since long, but maybe I am plain wrong in my use of git.\n\n\nMy branch was based on beta-6.6 and the last beta is the rc0. This is the reason. The thing that I dislike is that it introduces a useless commit in the history. There is nothing bad with branch based on previous beta and instead you can do\n\n```\ngit fetch trac whatever_branch_for_17XXX\ngit ch -b 17XXX FETCH_HEAD\n```\n\nThe alternative is to do the merge as you did. And then, you can rebase your commit on top of mine.\n\nNot that important.\n\nVincent",
    "created_at": "2015-03-22T20:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248598",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>Replying to [comment:13 chapoton]:
> Well, I am doing that (where develop is the latest beta):
> 
> ```
> git ch develop -b 17XXX
> git pull trac whatever_branch_for_17XXX
> ```
> to get the branch.
> 
> If the branch is not based on the latest beta, the merge is forced upon me by git.
> This has been working for me very well since long, but maybe I am plain wrong in my use of git.


My branch was based on beta-6.6 and the last beta is the rc0. This is the reason. The thing that I dislike is that it introduces a useless commit in the history. There is nothing bad with branch based on previous beta and instead you can do

```
git fetch trac whatever_branch_for_17XXX
git ch -b 17XXX FETCH_HEAD
```

The alternative is to do the merge as you did. And then, you can rebase your commit on top of mine.

Not that important.

Vincent



---

archive/issue_comments_248599.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-10T20:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248599",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_248600.json:
```json
{
    "body": "<a id='comment:15'></a>reviewer name",
    "created_at": "2015-04-10T20:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248600",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>reviewer name



---

archive/issue_comments_248601.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-11T08:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248601",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_050708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:43:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17730#event-50708"
}
```



---

archive/issue_comments_248602.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17730#issuecomment-248602",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
