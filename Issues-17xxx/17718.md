# Issue 17718: Further clean-up of expect.py

archive/issues_017481.json:
```json
{
    "assignees": [],
    "body": "\n\nDepends on #17704\n\nBranch/Commit: **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**\n\nReviewer: **Vincent Delecroix, Marc Mezzarobba, Ralf Stephan**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17718_\n\n",
    "closed_at": "2015-02-26T07:11:08Z",
    "created_at": "2015-02-03T09:33:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Further clean-up of expect.py",
    "type": "issue",
    "updated_at": "2015-02-26T07:11:08Z",
    "url": "https://github.com/sagemath/sage/issues/17718",
    "user": "https://github.com/jdemeyer"
}
```


Depends on #17704

Branch/Commit: **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**

Reviewer: **Vincent Delecroix, Marc Mezzarobba, Ralf Stephan**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/17718_





---

archive/issue_events_234780.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-03T09:33:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234780"
}
```



---

archive/issue_events_234781.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-03T09:33:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234781"
}
```



---

archive/issue_events_234782.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-03T09:33:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234782"
}
```



---

archive/issue_events_234783.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-03T09:33:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234783"
}
```



---

archive/issue_comments_241924.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)**",
    "created_at": "2015-02-03T10:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241924",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)**



---

archive/issue_comments_241925.json:
```json
{
    "body": "Commit: **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)**",
    "created_at": "2015-02-03T11:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241925",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)**



---

archive/issue_events_234784.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-03T11:26:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234784"
}
```



---

archive/issue_comments_241926.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8501bb16498e220d74685285c4adde3b3129a533\">8501bb1</a></td><td><code>Clean up in expect.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de\">d556229</a></td><td><code>Further clean-up of interfaces</code></td></tr></table>\n",
    "created_at": "2015-02-03T11:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241926",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8501bb16498e220d74685285c4adde3b3129a533">8501bb1</a></td><td><code>Clean up in expect.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de">d556229</a></td><td><code>Further clean-up of interfaces</code></td></tr></table>




---

archive/issue_comments_241927.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nWhy\n\n```\n if self.silent:\n-     return\n+     return self.interface\n```\nIf this is necessary, could you add a doctest?",
    "created_at": "2015-02-04T21:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241927",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">Comment 3</div>

Why

```
 if self.silent:
-     return
+     return self.interface
```
If this is necessary, could you add a doctest?



---

archive/issue_comments_241928.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@videlec](#comment%3A3):\n> Why\n> \n> ```\n>  if self.silent:\n> -     return\n> +     return self.interface\n> ```\n> If this is necessary, could you add a doctest?\n\nIt's to allow `with StdOutContext(...) as ...` as opposed to just `with StdOutContext(...)`.\n\nSo it's covered by this doctest change:\n\n```diff\n-sage: with StdOutContext(gp):\n-...       gp('1+1')\n-...\n+sage: with StdOutContext(Gp()) as g:\n+....:     g('1+1')\n```",
    "created_at": "2015-02-05T07:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241928",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@videlec](#comment%3A3):
> Why
> 
> ```
>  if self.silent:
> -     return
> +     return self.interface
> ```
> If this is necessary, could you add a doctest?

It's to allow `with StdOutContext(...) as ...` as opposed to just `with StdOutContext(...)`.

So it's covered by this doctest change:

```diff
-sage: with StdOutContext(gp):
-...       gp('1+1')
-...
+sage: with StdOutContext(Gp()) as g:
+....:     g('1+1')
```



---

archive/issue_comments_241929.json:
```json
{
    "body": "Changed commit from **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)** to **[568b6a8](https://github.com/sagemath/sagetrac-mirror/commit/568b6a8e4478fe93f70841efc664a9992e820386)**",
    "created_at": "2015-02-05T13:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241929",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)** to **[568b6a8](https://github.com/sagemath/sagetrac-mirror/commit/568b6a8e4478fe93f70841efc664a9992e820386)**



---

archive/issue_comments_241930.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)** to **[u/mmezzarobba/17718-expect](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/17718-expect)**",
    "created_at": "2015-02-05T13:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241930",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)** to **[u/mmezzarobba/17718-expect](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/17718-expect)**



---

archive/issue_comments_241931.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nWhy that extra commit?",
    "created_at": "2015-02-05T13:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241931",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">Comment 6</div>

Why that extra commit?



---

archive/issue_events_234785.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:23:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234785"
}
```



---

archive/issue_events_234786.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:23:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234786"
}
```



---

archive/issue_comments_241932.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> Why that extra commit?\n\nAs the commit message says: to make the optional test involving octave pass also when the tests are run with `--optional=octave`, not `--optional=sage,octave`.",
    "created_at": "2015-02-05T13:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241932",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@jdemeyer](#comment%3A6):
> Why that extra commit?

As the commit message says: to make the optional test involving octave pass also when the tests are run with `--optional=octave`, not `--optional=sage,octave`.



---

archive/issue_comments_241933.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@mezzarobba](#comment%3A7):\n> Replying to [@jdemeyer](#comment%3A6):\n> > Why that extra commit?\n\n> \n> As the commit message says: to make the optional test involving octave pass also when the tests are run with `--optional=octave`, not `--optional=sage,octave`.\n\nI'm not aware of any general rule that tests should pass when run with `./sage -t --optional=octave`. I prefer to have as few tests as possible optional.",
    "created_at": "2015-02-05T13:31:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241933",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@mezzarobba](#comment%3A7):
> Replying to [@jdemeyer](#comment%3A6):
> > Why that extra commit?

> 
> As the commit message says: to make the optional test involving octave pass also when the tests are run with `--optional=octave`, not `--optional=sage,octave`.

I'm not aware of any general rule that tests should pass when run with `./sage -t --optional=octave`. I prefer to have as few tests as possible optional.



---

archive/issue_events_234787.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:32:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234787"
}
```



---

archive/issue_events_234788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-05T13:32:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234788"
}
```



---

archive/issue_comments_241934.json:
```json
{
    "body": "Changed commit from **[568b6a8](https://github.com/sagemath/sagetrac-mirror/commit/568b6a8e4478fe93f70841efc664a9992e820386)** to **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)**",
    "created_at": "2015-02-05T13:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241934",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[568b6a8](https://github.com/sagemath/sagetrac-mirror/commit/568b6a8e4478fe93f70841efc664a9992e820386)** to **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)**



---

archive/issue_comments_241935.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIn any case, this could be discussed in a different ticket.",
    "created_at": "2015-02-05T13:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241935",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

In any case, this could be discussed in a different ticket.



---

archive/issue_comments_241936.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/17718-expect](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/17718-expect)** to **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)**",
    "created_at": "2015-02-05T13:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241936",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/mmezzarobba/17718-expect](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/17718-expect)** to **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)**



---

archive/issue_comments_241937.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@jdemeyer](#comment%3A8):\n> I'm not aware of any general rule that tests should pass when run with `./sage -t --optional=octave`.\n\nWhat is the point of having an option `--optional=octave` that does not imply `--optional=sage`, then?\n\n> I prefer to have as few tests as possible optional.\n\nI agree in principle, but here I don't think the example without its `optional` part is a meaningful test case.\n\nAnyway, I'm fine with leaving that change out if you prefer.",
    "created_at": "2015-02-05T13:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241937",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@jdemeyer](#comment%3A8):
> I'm not aware of any general rule that tests should pass when run with `./sage -t --optional=octave`.

What is the point of having an option `--optional=octave` that does not imply `--optional=sage`, then?

> I prefer to have as few tests as possible optional.

I agree in principle, but here I don't think the example without its `optional` part is a meaningful test case.

Anyway, I'm fine with leaving that change out if you prefer.



---

archive/issue_comments_241938.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix, Marc Mezzarobba**",
    "created_at": "2015-02-05T13:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241938",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Vincent Delecroix, Marc Mezzarobba**



---

archive/issue_events_234789.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T13:55:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234789"
}
```



---

archive/issue_events_234790.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-05T13:55:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234790"
}
```



---

archive/issue_events_234791.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-21T12:13:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234791"
}
```



---

archive/issue_events_234792.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-21T12:13:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234792"
}
```



---

archive/issue_comments_241939.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nThis leads to random failures in the R interface on my desktop (Haswell-E Linux x86_64, background computation running)\n\n```\nsage -t --long src/sage/interfaces/r.py\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 24, in sage.interfaces.r\nFailed example:\n    1/x\nExpected:\n    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295\nGot:\n    <BLANKLINE>\n\ncommand timed out: 1200 seconds without output running ['./sage', '-t', '-p', '8', '--all', '--long', '--logfile=logs/ptestlong.log'], attempting to kill\nprocess killed by signal 9\nprogram finished with exit code -1\nelapsedTime=2461.278640\n```",
    "created_at": "2015-02-21T12:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241939",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">Comment 11</div>

This leads to random failures in the R interface on my desktop (Haswell-E Linux x86_64, background computation running)

```
sage -t --long src/sage/interfaces/r.py
**********************************************************************
File "src/sage/interfaces/r.py", line 24, in sage.interfaces.r
Failed example:
    1/x
Expected:
    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295
Got:
    <BLANKLINE>

command timed out: 1200 seconds without output running ['./sage', '-t', '-p', '8', '--all', '--long', '--logfile=logs/ptestlong.log'], attempting to kill
process killed by signal 9
program finished with exit code -1
elapsedTime=2461.278640
```



---

archive/issue_comments_241940.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nanother failed example (seems to be falling over a prompt in the R docs if you are unlucky with the timing):\n\n```\n$ SAGE_PEXPECT_LOG=yes sage -bt --long --verbose src/sage/interfaces/r.py \n[...]\nTrying (line 1955):    print length._sage_doc_()\nExpecting:\n    length                 package:base                 R Documentation\n    ...\n    <BLANKLINE>\nok [0.04 s]\nTrying (line 1959):    sig_on_count()\nExpecting:\n    0\nok [0.00 s]\nTrying (line 1969):    length = r.length\nExpecting nothing\nok [0.00 s]\nTrying (line 1970):    print length._sage_src_()\nExpecting:\nTrying (line 1970):    print length._sage_src_()\nExpecting:\n    function (x)  .Primitive(\"length\")\nok [0.00 s]\nTrying (line 1973):    sig_on_count()\nExpecting:\n    0\nok [0.00 s]\nTrying (line 1981):    length = r.length\nExpecting nothing\nok [0.00 s]\nTrying (line 1982):    length([1,2,3])\nExpecting:\n    [1] 3\n... hangs ...\n```\npexpect log:\n\n```\n[...]\nExamples:\n\n     length(diag(4))  # = 16 (4 x 4)\n     length(options())  # 12 or more\n     length(y ~ x1 + x2 + x3)  # 3\n     length(expression(x, {y <- x^2; y+2}, x^y))  # 3\n     \n     ## from example(warpbreaks)\n     require(stats)\n     \n     fm1 <- lm(breaks ~ wool * tension, data = warpbreaks)\n     length(fm1$call)      # 3, lm() and two arguments.\n     length(formula(fm1))  # 3, ~ lhs rhs\n     \n\n__SAGE__R__PROMPT__> 1+310416896;\n[1] 310416897\n__SAGE__R__PROMPT__> length\nlength\nfunction (x)  .Primitive(\"length\")\n__SAGE__R__PROMPT__> 1+1371999567;\n[1] 1.372e+09\n__SAGE__R__PROMPT__> \ufffd\nquit(save=\"no\")\n\n__SAGE__R__PROMPT__> \n__SAGE__R__PROMPT__> ^C\nquit(save=\"no\")\n\nsage2 <- 1\nsage2 <- 1\n1+1305756531;\nquit(save=\"no\")\n```",
    "created_at": "2015-02-21T12:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241940",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">Comment 12</div>

another failed example (seems to be falling over a prompt in the R docs if you are unlucky with the timing):

```
$ SAGE_PEXPECT_LOG=yes sage -bt --long --verbose src/sage/interfaces/r.py 
[...]
Trying (line 1955):    print length._sage_doc_()
Expecting:
    length                 package:base                 R Documentation
    ...
    <BLANKLINE>
ok [0.04 s]
Trying (line 1959):    sig_on_count()
Expecting:
    0
ok [0.00 s]
Trying (line 1969):    length = r.length
Expecting nothing
ok [0.00 s]
Trying (line 1970):    print length._sage_src_()
Expecting:
Trying (line 1970):    print length._sage_src_()
Expecting:
    function (x)  .Primitive("length")
ok [0.00 s]
Trying (line 1973):    sig_on_count()
Expecting:
    0
ok [0.00 s]
Trying (line 1981):    length = r.length
Expecting nothing
ok [0.00 s]
Trying (line 1982):    length([1,2,3])
Expecting:
    [1] 3
... hangs ...
```
pexpect log:

```
[...]
Examples:

     length(diag(4))  # = 16 (4 x 4)
     length(options())  # 12 or more
     length(y ~ x1 + x2 + x3)  # 3
     length(expression(x, {y <- x^2; y+2}, x^y))  # 3
     
     ## from example(warpbreaks)
     require(stats)
     
     fm1 <- lm(breaks ~ wool * tension, data = warpbreaks)
     length(fm1$call)      # 3, lm() and two arguments.
     length(formula(fm1))  # 3, ~ lhs rhs
     

__SAGE__R__PROMPT__> 1+310416896;
[1] 310416897
__SAGE__R__PROMPT__> length
length
function (x)  .Primitive("length")
__SAGE__R__PROMPT__> 1+1371999567;
[1] 1.372e+09
__SAGE__R__PROMPT__> ï¿½
quit(save="no")

__SAGE__R__PROMPT__> 
__SAGE__R__PROMPT__> ^C
quit(save="no")

sage2 <- 1
sage2 <- 1
1+1305756531;
quit(save="no")
```



---

archive/issue_comments_241941.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@vbraun](#comment%3A11):\n> This leads to random failures in the R interface on my desktop\n\nAre you really sure that this is caused by this ticket? The point is that this ticket is really a clean-up ticket, with almost no functional changes.",
    "created_at": "2015-02-21T13:08:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241941",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@vbraun](#comment%3A11):
> This leads to random failures in the R interface on my desktop

Are you really sure that this is caused by this ticket? The point is that this ticket is really a clean-up ticket, with almost no functional changes.



---

archive/issue_comments_241942.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nWell maybe it triggers a pre-existing bug. All I know for sure is that doctests get stuck in R on my machine with it.",
    "created_at": "2015-02-21T13:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241942",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">Comment 14</div>

Well maybe it triggers a pre-existing bug. All I know for sure is that doctests get stuck in R on my machine with it.



---

archive/issue_comments_241943.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nHow common is this failure?",
    "created_at": "2015-02-21T15:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241943",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

How common is this failure?



---

archive/issue_comments_241944.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nMaybe 50% when the system is under load...",
    "created_at": "2015-02-21T16:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241944",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">Comment 16</div>

Maybe 50% when the system is under load...



---

archive/issue_comments_241945.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nWhen I have some time, I'll try to reproduce it. The only possible reason that I can think of is the change `self._interrupt()` -> `self.interrupt()`\n\nIf that's the cause, I suggest to just revert that.",
    "created_at": "2015-02-21T17:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241945",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">Comment 17</div>

When I have some time, I'll try to reproduce it. The only possible reason that I can think of is the change `self._interrupt()` -> `self.interrupt()`

If that's the cause, I suggest to just revert that.



---

archive/issue_comments_241946.json:
```json
{
    "body": "Changed commit from **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)** to **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**",
    "created_at": "2015-02-22T09:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241946",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d556229](https://github.com/sagemath/sagetrac-mirror/commit/d556229dd9fec47e492a3543b0815ce02b4870de)** to **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**



---

archive/issue_comments_241947.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0\">c8d1a28</a></td><td><code>Revert interrupt change</code></td></tr></table>\n",
    "created_at": "2015-02-22T09:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241947",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18" align="right">Comment 18</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0">c8d1a28</a></td><td><code>Revert interrupt change</code></td></tr></table>




---

archive/issue_events_234793.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-22T09:33:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234793"
}
```



---

archive/issue_events_234794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-22T09:33:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234794"
}
```



---

archive/issue_comments_241948.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI confirm the issue and this should fix it.",
    "created_at": "2015-02-22T09:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241948",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">Comment 19</div>

I confirm the issue and this should fix it.



---

archive/issue_comments_241949.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nPatchbot says fine. Tests in `interfaces` on my machine pass too. As the code was already reviewed by others I dare to set positive.",
    "created_at": "2015-02-25T15:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241949",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">Comment 20</div>

Patchbot says fine. Tests in `interfaces` on my machine pass too. As the code was already reviewed by others I dare to set positive.



---

archive/issue_comments_241950.json:
```json
{
    "body": "Changed reviewer from **Vincent Delecroix, Marc Mezzarobba** to **Vincent Delecroix, Marc Mezzarobba, Ralf Stephan**",
    "created_at": "2015-02-25T15:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241950",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Vincent Delecroix, Marc Mezzarobba** to **Vincent Delecroix, Marc Mezzarobba, Ralf Stephan**



---

archive/issue_events_234795.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T15:04:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234795"
}
```



---

archive/issue_events_234796.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T15:04:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234796"
}
```



---

archive/issue_events_234797.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T15:04:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234797"
}
```



---

archive/issue_events_234798.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-25T15:04:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234798"
}
```



---

archive/issue_comments_241951.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)** to **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**",
    "created_at": "2015-02-26T07:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17718#issuecomment-241951",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/17718](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/17718)** to **[c8d1a28](https://github.com/sagemath/sagetrac-mirror/commit/c8d1a289e95184f3f6f5528e8fb8ee4638ab47c0)**



---

archive/issue_events_234799.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-26T07:11:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234799"
}
```



---

archive/issue_events_234800.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4685f7976ddebd767b35ee3e5dd9f22a4fddc924",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-02-26T07:11:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17718",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17718#event-234800"
}
```
