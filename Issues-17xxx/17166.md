# Issue 17166: Add coercion complex -> CC

archive/issues_016929.json:
```json
{
    "body": "CC:  @robertwb\n\nThis works fine:\n\n```\nsage: CC(complex('13.8+6.2j'))\n13.8000000000000 + 6.20000000000000*I\nsage: CDF(complex('13.8+6.2j'))\n13.8 + 6.2*I\n```\n\nHowever, it is a *conversion* while it should be a *coercion*.\n\n```\nsage: CC.has_coerce_map_from(complex)\nFalse\n```\nThis is inconsistent with\n\n```\nsage: CC.has_coerce_map_from(float)\nTrue\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/17166\n\n",
    "closed_at": "2014-11-15T16:22:27Z",
    "created_at": "2014-10-16T17:42:12Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Add coercion complex -> CC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17166",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @robertwb

This works fine:

```
sage: CC(complex('13.8+6.2j'))
13.8000000000000 + 6.20000000000000*I
sage: CDF(complex('13.8+6.2j'))
13.8 + 6.2*I
```

However, it is a *conversion* while it should be a *coercion*.

```
sage: CC.has_coerce_map_from(complex)
False
```
This is inconsistent with

```
sage: CC.has_coerce_map_from(float)
True
```

Issue created by migration from https://trac.sagemath.org/ticket/17166





---

archive/issue_comments_223964.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-16T18:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223964",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_223965.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-16T18:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223965",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_223966.json:
```json
{
    "body": "What did the old doctest\n\n```\na=matrix([[1, 1e-4r, 1+1e-100jr], [1e-8+3j, 0, 1e-58r]])\n```\ndo with the changes in question if you didn't change the ring?  (I'm just wondering about breaking existing third-party code.)",
    "created_at": "2014-10-16T19:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223966",
    "user": "https://github.com/kcrisman"
}
```

What did the old doctest

```
a=matrix([[1, 1e-4r, 1+1e-100jr], [1e-8+3j, 0, 1e-58r]])
```
do with the changes in question if you didn't change the ring?  (I'm just wondering about breaking existing third-party code.)



---

archive/issue_comments_223967.json:
```json
{
    "body": "Replying to [comment:3 kcrisman]:\n> What did the old doctest\n> \n> ```\n> a=matrix([[1, 1e-4r, 1+1e-100jr], [1e-8+3j, 0, 1e-58r]])\n> ```\n> do with the changes in question if you didn't change the ring?\n\nReturn a matrix over `CC` instead of `CDF`.",
    "created_at": "2014-10-16T19:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223967",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 kcrisman]:
> What did the old doctest
> 
> ```
> a=matrix([[1, 1e-4r, 1+1e-100jr], [1e-8+3j, 0, 1e-58r]])
> ```
> do with the changes in question if you didn't change the ring?

Return a matrix over `CC` instead of `CDF`.



---

archive/issue_comments_223968.json:
```json
{
    "body": "But your question makes sense: why should it have changed?",
    "created_at": "2014-10-16T19:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223968",
    "user": "https://github.com/jdemeyer"
}
```

But your question makes sense: why should it have changed?



---

archive/issue_comments_223969.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> But your question makes sense: why should it have changed?\n\nThe change makes sense because the parent of the entry `1e-8+3j` is `CC`. Therefore, it is logical that the matrix is defined over `CC`.",
    "created_at": "2014-10-16T19:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223969",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 jdemeyer]:
> But your question makes sense: why should it have changed?

The change makes sense because the parent of the entry `1e-8+3j` is `CC`. Therefore, it is logical that the matrix is defined over `CC`.



---

archive/issue_comments_223970.json:
```json
{
    "body": "IMHO the coercion should be complex -> CDF -> CC and not complex -> CC -> CDF. Pretty much the only difference is that the matrix would default to CDF, but since matrices over CDF are much more useful than matrices over CC this is probably what the user prefers.",
    "created_at": "2014-10-18T16:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223970",
    "user": "https://github.com/vbraun"
}
```

IMHO the coercion should be complex -> CDF -> CC and not complex -> CC -> CDF. Pretty much the only difference is that the matrix would default to CDF, but since matrices over CDF are much more useful than matrices over CC this is probably what the user prefers.



---

archive/issue_comments_223971.json:
```json
{
    "body": "Replying to [comment:7 vbraun]:\n> IMHO the coercion should be complex -> CDF -> CC and not complex -> CC -> CDF.\n\nCoercion goes both ways in this case (CDF -> CC and CC -> CDF), so the result is the same really. Interestingly, this has the following consequence:\n\n```\nsage: Sequence([CDF(1), CC(1)]).parent()\nCategory of sequences in Complex Double Field\nsage: Sequence([CC(1), CDF(1)]).parent()\nCategory of sequences in Complex Field with 53 bits of precision\n```\n\nLet me know what you think, if you think the coercion should be added to `ComplexDoubleField._coerce_map_from()`, I could do that.",
    "created_at": "2014-10-19T17:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223971",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 vbraun]:
> IMHO the coercion should be complex -> CDF -> CC and not complex -> CC -> CDF.

Coercion goes both ways in this case (CDF -> CC and CC -> CDF), so the result is the same really. Interestingly, this has the following consequence:

```
sage: Sequence([CDF(1), CC(1)]).parent()
Category of sequences in Complex Double Field
sage: Sequence([CC(1), CDF(1)]).parent()
Category of sequences in Complex Field with 53 bits of precision
```

Let me know what you think, if you think the coercion should be added to `ComplexDoubleField._coerce_map_from()`, I could do that.



---

archive/issue_comments_223972.json:
```json
{
    "body": "I also noticed that we have coercions both way CDF <-> CC. This sounds a bit wonky, IMHO it shoud be `ComplexField(>=53)` -> `CDF` -> `ComplexField(<53)`. Though this has been around for a long time, perhaps there is a deeper reason for that? Maybe Robert knows? Possibly stuff for another ticket, though.\n\nWhat I originally meant was just that Python `complex` should coerce to CDF and not CC.",
    "created_at": "2014-10-19T17:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223972",
    "user": "https://github.com/vbraun"
}
```

I also noticed that we have coercions both way CDF <-> CC. This sounds a bit wonky, IMHO it shoud be `ComplexField(>=53)` -> `CDF` -> `ComplexField(<53)`. Though this has been around for a long time, perhaps there is a deeper reason for that? Maybe Robert knows? Possibly stuff for another ticket, though.

What I originally meant was just that Python `complex` should coerce to CDF and not CC.



---

archive/issue_comments_223973.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> What I originally meant was just that Python `complex` should coerce to CDF and not CC. \n\nHaving a coercion `complex -> CDF` and `CDF -> CC` but not `complex -> CC` sounds strange to me (isn't coercion supposed to be transitive?). Moreover, that would be inconsistent with\n\n```\nsage: RR.has_coerce_map_from(float)\nTrue\nsage: RDF.has_coerce_map_from(float)\nTrue\n```\n\nWhatever the outcome of this ticket is, the behaviour of `complex / CDF / CC` should be the same as `float / RDF / RR`.",
    "created_at": "2014-10-19T17:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223973",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 vbraun]:
> What I originally meant was just that Python `complex` should coerce to CDF and not CC. 

Having a coercion `complex -> CDF` and `CDF -> CC` but not `complex -> CC` sounds strange to me (isn't coercion supposed to be transitive?). Moreover, that would be inconsistent with

```
sage: RR.has_coerce_map_from(float)
True
sage: RDF.has_coerce_map_from(float)
True
```

Whatever the outcome of this ticket is, the behaviour of `complex / CDF / CC` should be the same as `float / RDF / RR`.



---

archive/issue_comments_223974.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> IMHO it shoud be `ComplexField(>=53)` -> `CDF` -> `ComplexField(<53)`.\n\nI would prefer `CDF -> ComplexField(53)` simply because there are numbers in `CC` which cannot be represented in `CDF`:\n\n```\nsage: CC(1e1000)\n1.00000000000000e1000\nsage: CDF(1e1000)\n+infinity\n```",
    "created_at": "2014-10-19T17:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223974",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 vbraun]:
> IMHO it shoud be `ComplexField(>=53)` -> `CDF` -> `ComplexField(<53)`.

I would prefer `CDF -> ComplexField(53)` simply because there are numbers in `CC` which cannot be represented in `CDF`:

```
sage: CC(1e1000)
1.00000000000000e1000
sage: CDF(1e1000)
+infinity
```



---

archive/issue_comments_223975.json:
```json
{
    "body": "Yes, it should be `ComplexField(>53)` -> `CDF` -> `ComplexField(<=53)`. We should also have `complex` -> `CDF`. This does induce a coercion `complex` -> `ComplexField(<=53)`.",
    "created_at": "2014-10-21T17:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223975",
    "user": "https://github.com/robertwb"
}
```

Yes, it should be `ComplexField(>53)` -> `CDF` -> `ComplexField(<=53)`. We should also have `complex` -> `CDF`. This does induce a coercion `complex` -> `ComplexField(<=53)`.



---

archive/issue_comments_223976.json:
```json
{
    "body": "Can this ticket please be reviewed as just making `complex`/`CC` consistent with `float`/`RR`? Further discussions about changing coercion between `CC` and `CDF` can still go to another ticket.",
    "created_at": "2014-10-29T11:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223976",
    "user": "https://github.com/jdemeyer"
}
```

Can this ticket please be reviewed as just making `complex`/`CC` consistent with `float`/`RR`? Further discussions about changing coercion between `CC` and `CDF` can still go to another ticket.



---

archive/issue_comments_223977.json:
```json
{
    "body": "I'm okay with pushing the issues with the other coercions to another ticket, and the current branch LGTM. So I'm setting a positive review.",
    "created_at": "2014-11-04T00:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223977",
    "user": "https://github.com/tscrim"
}
```

I'm okay with pushing the issues with the other coercions to another ticket, and the current branch LGTM. So I'm setting a positive review.



---

archive/issue_comments_223978.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-04T00:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223978",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_223979.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-15T16:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17166#issuecomment-223979",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-15T16:22:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17166#event-49778"
}
```
