# Issue 17518: Plots are not shown in the notebook using server_pool option

archive/issues_017518.json:
```json
{
    "body": "Start a notebook server with\n\n```\nsage: notebook(server_pool=[\"guest@localhost\"])\n```\nand then enter in a notebook cell\n\n```\nplot(sin(x))\n```\n\nIn **Sage 6.4.beta5**, this works as it should.\n\nIn **Sage 6.4.beta6**, this returns `None` and does not show the plot.\n\nIn **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:\n\n```\n2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/17755\n\n",
    "closed_at": "2015-02-13T01:08:20Z",
    "created_at": "2015-02-09T21:09:37Z",
    "labels": [
        "component: graphics",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Plots are not shown in the notebook using server_pool option",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17518",
    "user": "https://github.com/jdemeyer"
}
```
Start a notebook server with

```
sage: notebook(server_pool=["guest@localhost"])
```
and then enter in a notebook cell

```
plot(sin(x))
```

In **Sage 6.4.beta5**, this works as it should.

In **Sage 6.4.beta6**, this returns `None` and does not show the plot.

In **Sage 6.4.rc0** and later, no plot is shown and the following error appears in the Sage session:

```
2015-02-09 10:23:17+0100 [HTTPChannel,0,127.0.0.1] Error copying file from worksheet process: [Errno 13] Permission denied: '/tmp/tmpJKDXnp/sage0.png'
```

Issue created by migration from https://trac.sagemath.org/ticket/17755





---

archive/issue_comments_233649.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-09T21:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233649",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_233650.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-09T21:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233650",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233651.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-09T22:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233651",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233652.json:
```json
{
    "body": "Thats a race between the worker and the server. But oh well probably good enough since the server surely doesn't do the right thing to watch for file changes (i.e. no inotify)",
    "created_at": "2015-02-10T01:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233652",
    "user": "https://github.com/vbraun"
}
```

Thats a race between the worker and the server. But oh well probably good enough since the server surely doesn't do the right thing to watch for file changes (i.e. no inotify)



---

archive/issue_comments_233653.json:
```json
{
    "body": "PS: I deleted graphics_file.py already in #17234",
    "created_at": "2015-02-10T01:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233653",
    "user": "https://github.com/vbraun"
}
```

PS: I deleted graphics_file.py already in #17234



---

archive/issue_comments_233654.json:
```json
{
    "body": "Just out of curiosity, do you two have restrictive umasks?",
    "created_at": "2015-02-10T02:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233654",
    "user": "https://github.com/vbraun"
}
```

Just out of curiosity, do you two have restrictive umasks?



---

archive/issue_comments_233655.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> Just out of curiosity, do you two have restrictive umasks?\n\n\nI have it running in an LXC container: root on host, root inside, server user, worker user, all give 0022 umask. The system is Debian Wheezy with some backports (like new kernel).",
    "created_at": "2015-02-10T05:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233655",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:6 vbraun]:
> Just out of curiosity, do you two have restrictive umasks?


I have it running in an LXC container: root on host, root inside, server user, worker user, all give 0022 umask. The system is Debian Wheezy with some backports (like new kernel).



---

archive/issue_comments_233656.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> Thats a race between the worker and the server.\n\nNot really, since all this happens serially. The client computes something (which might include saving graphics), then sends a message to the server that it is finished.\n\n> Just out of curiosity, do you two have restrictive umasks?\n\nNo, the reason the graphics file ends up with `0600` permission is the fact that it is created as temporary file. And temporary files have `0600` permissions by default.",
    "created_at": "2015-02-10T07:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233656",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 vbraun]:
> Thats a race between the worker and the server.

Not really, since all this happens serially. The client computes something (which might include saving graphics), then sends a message to the server that it is finished.

> Just out of curiosity, do you two have restrictive umasks?

No, the reason the graphics file ends up with `0600` permission is the fact that it is created as temporary file. And temporary files have `0600` permissions by default.



---

archive/issue_comments_233657.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2015-02-12T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233657",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_233658.json:
```json
{
    "body": "Please merge this in Sage 6.5",
    "created_at": "2015-02-12T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233658",
    "user": "https://github.com/jdemeyer"
}
```

Please merge this in Sage 6.5



---

archive/issue_comments_233659.json:
```json
{
    "body": "Already did (will be in the next rc)",
    "created_at": "2015-02-12T21:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233659",
    "user": "https://github.com/vbraun"
}
```

Already did (will be in the next rc)



---

archive/issue_events_050757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-13T01:08:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17518#event-50757"
}
```



---

archive/issue_comments_233660.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-13T01:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17518#issuecomment-233660",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
