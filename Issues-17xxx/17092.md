# Issue 17092: Quivers incorrectly assume labels are checked for equality of graphs

archive/issues_016855.json:
```json
{
    "body": "Over at ticket #17086 the hash of `GenericGraph` was fixed to agree with equality of `GenericGraph`. This caused doctest failure in `src/sage/quivers/path_semigroup.py`.\n\nEquality of un-'weighted' `GenericGraph` ignores edge labels, which seems nonsensical to me for `/path_semigroup`. So each digraph used for path semigroups should be 'weighted'. Running `git grep path_semigroup` shows that this is certainly not done.\n\nI see these options:\n* change lots of code to make the appropriate digraphs weighted;\n* change equality of graphs to take edge labels into account, possibly breaking other code;\n* change `PathSemigroup` to check for weightedness, and perhaps set 'weighted' in `.path_semigroup`.\n\nCC:  simonking\n\nBranch/Commit: 5607441aea8b70215a0f984eb7b60779f44e67e0\n\nReviewer: Nathann Cohen\n\nAuthor: Erik Massop\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17092\n\n",
    "closed_at": "2014-10-05T22:39:06Z",
    "created_at": "2014-10-02T18:31:50Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Quivers incorrectly assume labels are checked for equality of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17092",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```
Over at ticket #17086 the hash of `GenericGraph` was fixed to agree with equality of `GenericGraph`. This caused doctest failure in `src/sage/quivers/path_semigroup.py`.

Equality of un-'weighted' `GenericGraph` ignores edge labels, which seems nonsensical to me for `/path_semigroup`. So each digraph used for path semigroups should be 'weighted'. Running `git grep path_semigroup` shows that this is certainly not done.

I see these options:
* change lots of code to make the appropriate digraphs weighted;
* change equality of graphs to take edge labels into account, possibly breaking other code;
* change `PathSemigroup` to check for weightedness, and perhaps set 'weighted' in `.path_semigroup`.

CC:  simonking

Branch/Commit: 5607441aea8b70215a0f984eb7b60779f44e67e0

Reviewer: Nathann Cohen

Author: Erik Massop

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17092





---

archive/issue_comments_287759.json:
```json
{
    "body": "<a id='comment:1'></a>Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?\n\nIndeed, edge labels are essential for `path_semigroup`. However, as much as I know, edge labels are not essential in many other parts of Sage. Hence, I agree that it is `PathSemigroup`'s duty to assert weightedness of its input.",
    "created_at": "2014-10-02T18:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287759",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?

Indeed, edge labels are essential for `path_semigroup`. However, as much as I know, edge labels are not essential in many other parts of Sage. Hence, I agree that it is `PathSemigroup`'s duty to assert weightedness of its input.



---

archive/issue_comments_287760.json:
```json
{
    "body": "<a id='comment:2'></a>Let us assume that a non-weighted looped multi-digraph `G` is given, and we want to construct the associated `PathSemigroup`. It is a unique representation, but if I recall correctly there is a `__classcall__` method, replacing the input by an immutable copy, if needed. The immutable copy is used for caching.\n\nThe obvious change is: `__classcall__` should replace the input by an immutable *weighted* copy, and use it for caching. I think this would break no existing code related with path semigroups.",
    "created_at": "2014-10-02T18:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287760",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Let us assume that a non-weighted looped multi-digraph `G` is given, and we want to construct the associated `PathSemigroup`. It is a unique representation, but if I recall correctly there is a `__classcall__` method, replacing the input by an immutable copy, if needed. The immutable copy is used for caching.

The obvious change is: `__classcall__` should replace the input by an immutable *weighted* copy, and use it for caching. I think this would break no existing code related with path semigroups.



---

archive/issue_comments_287761.json:
```json
{
    "body": "Changing branch from \"\" to \"u/emassop/weighted_for_path_semigroup\"",
    "created_at": "2014-10-02T21:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287761",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```

Changing branch from "" to "u/emassop/weighted_for_path_semigroup"



---

archive/issue_comments_287762.json:
```json
{
    "body": "<a id='comment:4'></a>Like this?\n\nNote that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.",
    "created_at": "2014-10-02T21:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287762",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```

<a id='comment:4'></a>Like this?

Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.



---

archive/issue_comments_287763.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Massop\"",
    "created_at": "2014-10-02T21:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287763",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```

Changing author from "" to "Erik Massop"



---

archive/issue_comments_287764.json:
```json
{
    "body": "Changing commit from \"\" to \"cddc9698673d03ec6e07dd742db4c02a1b36558e\"",
    "created_at": "2014-10-02T21:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287764",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```

Changing commit from "" to "cddc9698673d03ec6e07dd742db4c02a1b36558e"



---

archive/issue_comments_287765.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [emassop](#comment%3A4):\n> Like this?\n\n\nYes! That's what I thought should be done.\n\n> Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.\n\n\nI wouldn't mind. What I find important: If `S` is a path semigroup, then `S` is identic with `PathSemigroup(S.quiver())`. And this does hold with your code.",
    "created_at": "2014-10-02T22:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287765",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>Replying to [emassop](#comment%3A4):
> Like this?


Yes! That's what I thought should be done.

> Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.


I wouldn't mind. What I find important: If `S` is a path semigroup, then `S` is identic with `PathSemigroup(S.quiver())`. And this does hold with your code.



---

archive/issue_comments_287766.json:
```json
{
    "body": "<a id='comment:6'></a>> Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?\n\n\nI set it back to `needs_work`.",
    "created_at": "2014-10-03T09:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287766",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>> Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?


I set it back to `needs_work`.



---

archive/issue_comments_287767.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T12:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287768.json:
```json
{
    "body": "Changing commit from \"cddc9698673d03ec6e07dd742db4c02a1b36558e\" to \"ddf2cb798407d732e287c7fda3e360e1d0bd6cca\"",
    "created_at": "2014-10-03T12:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cddc9698673d03ec6e07dd742db4c02a1b36558e" to "ddf2cb798407d732e287c7fda3e360e1d0bd6cca"



---

archive/issue_comments_287769.json:
```json
{
    "body": "Changing commit from \"ddf2cb798407d732e287c7fda3e360e1d0bd6cca\" to \"5607441aea8b70215a0f984eb7b60779f44e67e0\"",
    "created_at": "2014-10-03T12:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ddf2cb798407d732e287c7fda3e360e1d0bd6cca" to "5607441aea8b70215a0f984eb7b60779f44e67e0"



---

archive/issue_comments_287770.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T12:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287771.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-03T13:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287771",
    "user": "https://trac.sagemath.org/admin/accounts/users/emassop"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287772.json:
```json
{
    "body": "<a id='comment:10'></a>Welllllll, I see nothing wrong with any of that `:-)`\n\nNathann",
    "created_at": "2014-10-04T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287772",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>Welllllll, I see nothing wrong with any of that `:-)`

Nathann



---

archive/issue_comments_287773.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2014-10-04T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287773",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_287774.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-04T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287774",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_287775.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-05T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287775",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049654.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-05T22:39:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17092#event-49654"
}
```



---

archive/issue_comments_287776.json:
```json
{
    "body": "Changing branch from \"u/emassop/weighted_for_path_semigroup\" to \"5607441aea8b70215a0f984eb7b60779f44e67e0\"",
    "created_at": "2014-10-05T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17092",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17092#issuecomment-287776",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/emassop/weighted_for_path_semigroup" to "5607441aea8b70215a0f984eb7b60779f44e67e0"
