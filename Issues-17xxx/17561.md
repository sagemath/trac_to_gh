# Issue 17561: Speed up vectors

archive/issues_017324.json:
```json
{
    "body": "We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:\n\nBefore:\n\n```\nsage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n1000 loops, best of 10: 1.85 ms per loop\nsage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n1000 loops, best of 10: 3.49 ms per loop\n```\n\nAfter:\n\n```\nsage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n1000 loops, best of 10: 1.82 ms per loop\nsage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n1000 loops, best of 10: 2.85 ms per loop\n```\n\nBranch/Commit: 106f5d41398794b13a6a683236cf219d49602312\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17561\n\n",
    "closed_at": "2015-01-13T01:11:26Z",
    "created_at": "2014-12-29T08:17:20Z",
    "labels": [
        "component: performance",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Speed up vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17561",
    "user": "https://github.com/jdemeyer"
}
```
We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:

Before:

```
sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
1000 loops, best of 10: 1.85 ms per loop
sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
1000 loops, best of 10: 3.49 ms per loop
```

After:

```
sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
1000 loops, best of 10: 1.82 ms per loop
sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
1000 loops, best of 10: 2.85 ms per loop
```

Branch/Commit: 106f5d41398794b13a6a683236cf219d49602312

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17561





---

archive/issue_comments_245454.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,22 @@\n+We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:\n \n+Before:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.85 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 3.49 ms per loop\n+```\n+\n+After:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.82 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 2.85 ms per loop\n+```\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2014-12-29T08:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245454",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,22 @@
+We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:
 
+Before:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.85 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 3.49 ms per loop
+```
+
+After:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.82 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 2.85 ms per loop
+```
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_245455.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,42 @@\n+1. Currently, every call to `vector()` computes a basis, only to ask for the ring over which the basis is defined (see #11751). We avoid this by introducing a new method `basis_ring()` for free modules.\n \n+Before:\n+\n+```\n+sage: L = [RR(x) for x in range(10000)]\n+sage: timeit('vector(RR, L)')\n+5 loops, best of 3: 77.4 ms per loop\n+```\n+\n+After:\n+\n+```\n+sage: L = [RR(x) for x in range(10000)]\n+sage: timeit('vector(RR, L)')\n+125 loops, best of 3: 1.82 ms per loop\n+```\n+\n+---\n+\n+2. We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:\n+\n+Before:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.85 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 3.49 ms per loop\n+```\n+\n+After:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.82 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 2.85 ms per loop\n+```\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2014-12-29T09:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245455",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,42 @@
+1. Currently, every call to `vector()` computes a basis, only to ask for the ring over which the basis is defined (see #11751). We avoid this by introducing a new method `basis_ring()` for free modules.
 
+Before:
+
+```
+sage: L = [RR(x) for x in range(10000)]
+sage: timeit('vector(RR, L)')
+5 loops, best of 3: 77.4 ms per loop
+```
+
+After:
+
+```
+sage: L = [RR(x) for x in range(10000)]
+sage: timeit('vector(RR, L)')
+125 loops, best of 3: 1.82 ms per loop
+```
+
+---
+
+2. We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:
+
+Before:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.85 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 3.49 ms per loop
+```
+
+After:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.82 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 2.85 ms per loop
+```
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_245456.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-29T12:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245457.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-29T12:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245457",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245458.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-31T10:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245458",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245459.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,22 @@\n+We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:\n \n+Before:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.85 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 3.49 ms per loop\n+```\n+\n+After:\n+\n+```\n+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 1.82 ms per loop\n+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)\n+1000 loops, best of 10: 2.85 ms per loop\n+```\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2015-01-02T23:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245459",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,22 @@
+We should declare the types `_entries` in `free_module_element.pxd`. This leads to a significant speed-up in the sparse case, and a minor speedup in the dense case:
 
+Before:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.85 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 3.49 ms per loop
+```
+
+After:
+
+```
+sage: v = vector(RR, range(10000)); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 1.82 ms per loop
+sage: v = vector(RR, range(10000), sparse=True); timeit('v._add_(v)', repeat=10, number=1000)
+1000 loops, best of 10: 2.85 ms per loop
+```
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_245460.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-03T00:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245461.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-03T00:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245461",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245462.json:
```json
{
    "body": "<a id='comment:10'></a>Is there a reason why you do\n\n```\nif type(entries) is not dict:\n```\ninstead of\n\n```\nif isinstance(entries, dict):\n```\n?",
    "created_at": "2015-01-03T03:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245462",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Is there a reason why you do

```
if type(entries) is not dict:
```
instead of

```
if isinstance(entries, dict):
```
?



---

archive/issue_comments_245463.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 tscrim]:\n> Is there a reason why you do\n> \n> ```\n> if type(entries) is not dict:\n> ```\n> instead of\n> \n> ```\n> if isinstance(entries, dict):\n> ```\n> ?\n\nYes, I need to assign it `_entries` which is declared as `dict`. So the type really has to be `dict`, not some derived type.\n\nBut we should support derived types, which is not currently the case.",
    "created_at": "2015-01-03T09:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245463",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 tscrim]:
> Is there a reason why you do
> 
> ```
> if type(entries) is not dict:
> ```
> instead of
> 
> ```
> if isinstance(entries, dict):
> ```
> ?

Yes, I need to assign it `_entries` which is declared as `dict`. So the type really has to be `dict`, not some derived type.

But we should support derived types, which is not currently the case.



---

archive/issue_comments_245464.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-03T09:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245464",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245465.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-03T10:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245466.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-03T10:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245466",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245467.json:
```json
{
    "body": "<a id='comment:14'></a>I see. I was thinking too much like in Java or pointers in C++. LGTM.",
    "created_at": "2015-01-10T03:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245467",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>I see. I was thinking too much like in Java or pointers in C++. LGTM.



---

archive/issue_comments_245468.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-10T03:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245468",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245469.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-13T01:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17561#issuecomment-245469",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050414.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-13T01:11:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17561",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17561#event-50414"
}
```
