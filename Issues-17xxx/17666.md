# Issue 17666: False positive for memory leak check on OSX

archive/issues_017429.json:
```json
{
    "body": "False positive on OSX:\n\n```\nsage -t --long src/sage/libs/singular/polynomial.pyx\n**********************************************************************\nFile \"src/sage/libs/singular/polynomial.pyx\", line 166, in sage.libs.singular.polynomial.singular_polynomial_call\nFailed example:\n    leak(10000)\nExpected:\n    0\nGot:\n    83886080\n```\n\nBranch/Commit: f16fdec593bf9c8b5d987dcc1c043a054595fc87\n\nReviewer: Volker Braun\n\nAuthor: Volker Braun, Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17666\n\n",
    "closed_at": "2015-02-08T15:26:28Z",
    "created_at": "2015-01-24T19:05:35Z",
    "labels": [
        "component: algebra",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "False positive for memory leak check on OSX",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17666",
    "user": "https://github.com/vbraun"
}
```
False positive on OSX:

```
sage -t --long src/sage/libs/singular/polynomial.pyx
**********************************************************************
File "src/sage/libs/singular/polynomial.pyx", line 166, in sage.libs.singular.polynomial.singular_polynomial_call
Failed example:
    leak(10000)
Expected:
    0
Got:
    83886080
```

Branch/Commit: f16fdec593bf9c8b5d987dcc1c043a054595fc87

Reviewer: Volker Braun

Author: Volker Braun, Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17666





---

archive/issue_comments_302190.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n+False positive on OSX:\n \n+```\n+sage -t --long src/sage/libs/singular/polynomial.pyx\n+**********************************************************************\n+File \"src/sage/libs/singular/polynomial.pyx\", line 166, in sage.libs.singular.polynomial.singular_polynomial_call\n+Failed example:\n+    leak(10000)\n+Expected:\n+    0\n+Got:\n+    83886080\n+```\n``````\n",
    "created_at": "2015-01-24T19:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302190",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,13 @@
+False positive on OSX:
 
+```
+sage -t --long src/sage/libs/singular/polynomial.pyx
+**********************************************************************
+File "src/sage/libs/singular/polynomial.pyx", line 166, in sage.libs.singular.polynomial.singular_polynomial_call
+Failed example:
+    leak(10000)
+Expected:
+    0
+Got:
+    83886080
+```
``````




---

archive/issue_comments_302191.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-01-24T19:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302191",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_302192.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2015-01-24T19:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302192",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_302193.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/false_positive_for_memory_leak_check_on_osx\"",
    "created_at": "2015-01-24T19:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302193",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/false_positive_for_memory_leak_check_on_osx"



---

archive/issue_comments_302194.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-24T19:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302194",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_302195.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2015-01-24T19:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302195",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_302196.json:
```json
{
    "body": "Changing commit from \"\" to \"91c2c58feab2a19aafb62621a9f571a2408e86b1\"",
    "created_at": "2015-01-24T19:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302196",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "91c2c58feab2a19aafb62621a9f571a2408e86b1"



---

archive/issue_comments_302197.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[91c2c58](http://git.sagemath.org/sage.git/commit/?id=91c2c58feab2a19aafb62621a9f571a2408e86b1)|`Improve the memory leak test`|",
    "created_at": "2015-01-24T19:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302197",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[91c2c58](http://git.sagemath.org/sage.git/commit/?id=91c2c58feab2a19aafb62621a9f571a2408e86b1)|`Improve the memory leak test`|



---

archive/issue_comments_302198.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-24T22:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302198",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_302199.json:
```json
{
    "body": "<a id='comment:4'></a>\nHow do we know it's a *false* positive?",
    "created_at": "2015-01-24T22:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302199",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
How do we know it's a *false* positive?



---

archive/issue_comments_302200.json:
```json
{
    "body": "<a id='comment:5'></a>\nFor what it's worth, I've run tests about 100 times on an OS X machine and haven't gotten any failures.",
    "created_at": "2015-01-24T23:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302200",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
For what it's worth, I've run tests about 100 times on an OS X machine and haven't gotten any failures.



---

archive/issue_comments_302201.json:
```json
{
    "body": "<a id='comment:6'></a>\nAn actual memory leak leaks memory every time...",
    "created_at": "2015-01-24T23:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302201",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
An actual memory leak leaks memory every time...



---

archive/issue_comments_302202.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vbraun](#comment%3A6):\n> An actual memory leak leaks memory every time...\n\nDepending on the implementation, that doesn't need to be the case. `malloc` usually pre-allocates more memory than strictly needed. Your test would pass even if there was an actual memory leak.\n\nI think a better test would be that the amount of memory needed to execute `leak(10000)` n times is bounded by a constant which does not depend on n.\nSomething like (pseudocode):\n\n```\nL = []\nfor i in range(10):\n    leak(10000)\n    L.append(memory_usage())\nm = max(L)  # taking the max because the memory usage might increase and decrease\nfor i in range(10):\n    leak(10000)\n    assert memory_usage() <= m\n```",
    "created_at": "2015-01-25T09:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302202",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [vbraun](#comment%3A6):
> An actual memory leak leaks memory every time...

Depending on the implementation, that doesn't need to be the case. `malloc` usually pre-allocates more memory than strictly needed. Your test would pass even if there was an actual memory leak.

I think a better test would be that the amount of memory needed to execute `leak(10000)` n times is bounded by a constant which does not depend on n.
Something like (pseudocode):

```
L = []
for i in range(10):
    leak(10000)
    L.append(memory_usage())
m = max(L)  # taking the max because the memory usage might increase and decrease
for i in range(10):
    leak(10000)
    assert memory_usage() <= m
```



---

archive/issue_comments_302203.json:
```json
{
    "body": "<a id='comment:8'></a>\nAnd you need to run at least as many iterations such that a leak would have to fill up the current process space. Which is IMHO way too slow for a doctest. A good enough heuristic is to hope that at least one of the tested OSes has a malloc pool granularity that is small enough (less than 16 * 10000)",
    "created_at": "2015-01-25T13:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302203",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
And you need to run at least as many iterations such that a leak would have to fill up the current process space. Which is IMHO way too slow for a doctest. A good enough heuristic is to hope that at least one of the tested OSes has a malloc pool granularity that is small enough (less than 16 * 10000)



---

archive/issue_comments_302204.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-01-29T08:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302204",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_302205.json:
```json
{
    "body": "<a id='comment:10'></a>\n`@`vbraun: what is the result of\n\n```\nfor i in range(100):\n    print leak(10000)\n```",
    "created_at": "2015-01-29T13:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302205",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
`@`vbraun: what is the result of

```
for i in range(100):
    print leak(10000)
```



---

archive/issue_comments_302206.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-29T13:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302206",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_302207.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe result is that it takes way longer than what a long doctest ought to use:\n\n```\nsage: %time [leak(10000) for i in range(100)]\nCPU times: user 1min 16s, sys: 327 ms, total: 1min 17s\nWall time: 1min 15s\n```\nOutput on OSX is:\n\n```\n[155189248, 0, 0, 0, 83886080, 0, 0, 0, 79691776, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n```",
    "created_at": "2015-01-29T13:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
The result is that it takes way longer than what a long doctest ought to use:

```
sage: %time [leak(10000) for i in range(100)]
CPU times: user 1min 16s, sys: 327 ms, total: 1min 17s
Wall time: 1min 15s
```
Output on OSX is:

```
[155189248, 0, 0, 0, 83886080, 0, 0, 0, 79691776, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
```



---

archive/issue_comments_302208.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-01-29T13:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302208",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_302209.json:
```json
{
    "body": "<a id='comment:12'></a>\nThat output suggests that the test could better be written as\n\n```\nsage: for i in range(10):\n....:    leak(10000)\nsage: leak(10000)\n0\n```",
    "created_at": "2015-01-29T15:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302209",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
That output suggests that the test could better be written as

```
sage: for i in range(10):
....:    leak(10000)
sage: leak(10000)
0
```



---

archive/issue_comments_302210.json:
```json
{
    "body": "<a id='comment:13'></a>\nTried that, didn't work reliably.",
    "created_at": "2015-01-29T15:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302210",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Tried that, didn't work reliably.



---

archive/issue_comments_302211.json:
```json
{
    "body": "<a id='comment:14'></a>\nHow about checking for 5 *consequtive* zero values? What I want to avoid is that the doctest would accept `[1000000, 0, 1000000, 0, 1000000, 0, 1000000,...]` which would probably still be a memory leak.",
    "created_at": "2015-01-29T15:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302211",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
How about checking for 5 *consequtive* zero values? What I want to avoid is that the doctest would accept `[1000000, 0, 1000000, 0, 1000000, 0, 1000000,...]` which would probably still be a memory leak.



---

archive/issue_comments_302212.json:
```json
{
    "body": "<a id='comment:15'></a>\nIsn't that just a variant of increasing the count by an order of magnitude? Too slow.",
    "created_at": "2015-01-29T15:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302212",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Isn't that just a variant of increasing the count by an order of magnitude? Too slow.



---

archive/issue_comments_302213.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [vbraun](#comment%3A15):\n> Isn't that just a variant of increasing the count by an order of magnitude? Too slow.\n\nDoing 10 tests (your commit) is fine, but doing *14 tests* (5 consequtive zeros in your example `[155189248, 0, 0, 0, 83886080, 0, 0, 0, 79691776, 0, 0, 0, 0, 0]` is an order of magnitude slower?",
    "created_at": "2015-01-29T15:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [vbraun](#comment%3A15):
> Isn't that just a variant of increasing the count by an order of magnitude? Too slow.

Doing 10 tests (your commit) is fine, but doing *14 tests* (5 consequtive zeros in your example `[155189248, 0, 0, 0, 83886080, 0, 0, 0, 79691776, 0, 0, 0, 0, 0]` is an order of magnitude slower?



---

archive/issue_comments_302214.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-02-04T10:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302214",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_302215.json:
```json
{
    "body": "<a id='comment:18'></a>\nPlease explain why 14 is an order of magnitude more than 10...",
    "created_at": "2015-02-04T10:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302215",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Please explain why 14 is an order of magnitude more than 10...



---

archive/issue_comments_302216.json:
```json
{
    "body": "<a id='comment:19'></a>\nIf you want to change the patch then be my guest, but I had enough of it.",
    "created_at": "2015-02-04T14:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302216",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
If you want to change the patch then be my guest, but I had enough of it.



---

archive/issue_comments_302217.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-02-04T14:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302217",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_302218.json:
```json
{
    "body": "Changing branch from \"u/vbraun/false_positive_for_memory_leak_check_on_osx\" to \"u/jdemeyer/ticket/17666\"",
    "created_at": "2015-02-05T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302218",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/vbraun/false_positive_for_memory_leak_check_on_osx" to "u/jdemeyer/ticket/17666"



---

archive/issue_comments_302219.json:
```json
{
    "body": "Changing author from \"Volker Braun\" to \"Volker Braun, Jeroen Demeyer\"",
    "created_at": "2015-02-05T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302219",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Volker Braun" to "Volker Braun, Jeroen Demeyer"



---

archive/issue_comments_302220.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-02-05T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302220",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_302221.json:
```json
{
    "body": "Changing commit from \"91c2c58feab2a19aafb62621a9f571a2408e86b1\" to \"fd1971893351b35ca2f2f15248508daf25c1e4f8\"",
    "created_at": "2015-02-05T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302221",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "91c2c58feab2a19aafb62621a9f571a2408e86b1" to "fd1971893351b35ca2f2f15248508daf25c1e4f8"



---

archive/issue_comments_302222.json:
```json
{
    "body": "<a id='comment:22'></a>\nNew commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[fd19718](http://git.sagemath.org/sage.git/commit/?id=fd1971893351b35ca2f2f15248508daf25c1e4f8)|`Improve memory leak check`|",
    "created_at": "2015-02-05T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302222",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[fd19718](http://git.sagemath.org/sage.git/commit/?id=fd1971893351b35ca2f2f15248508daf25c1e4f8)|`Improve memory leak check`|



---

archive/issue_comments_302223.json:
```json
{
    "body": "<a id='comment:23'></a>\nDoes this work for you?",
    "created_at": "2015-02-05T10:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302223",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Does this work for you?



---

archive/issue_comments_302224.json:
```json
{
    "body": "<a id='comment:24'></a>\nI'm travelling right now so I can't test it on OSX, but it should fail as it ought to at least once print \"Leaked N bytes\" with N>0.\n\nAlso, the first couple of iterations will always succeed (even if there is a leak) as singular has pre-allocated buckets, and as long as you don't exhaust these no new memory will be allocated. At least in the original leak I did need the `leak(50000)` to fill these up.",
    "created_at": "2015-02-05T14:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302224",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>
I'm travelling right now so I can't test it on OSX, but it should fail as it ought to at least once print "Leaked N bytes" with N>0.

Also, the first couple of iterations will always succeed (even if there is a leak) as singular has pre-allocated buckets, and as long as you don't exhaust these no new memory will be allocated. At least in the original leak I did need the `leak(50000)` to fill these up.



---

archive/issue_comments_302225.json:
```json
{
    "body": "Changing commit from \"fd1971893351b35ca2f2f15248508daf25c1e4f8\" to \"f16fdec593bf9c8b5d987dcc1c043a054595fc87\"",
    "created_at": "2015-02-05T14:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fd1971893351b35ca2f2f15248508daf25c1e4f8" to "f16fdec593bf9c8b5d987dcc1c043a054595fc87"



---

archive/issue_comments_302226.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[f16fdec](http://git.sagemath.org/sage.git/commit/?id=f16fdec593bf9c8b5d987dcc1c043a054595fc87)|`Slightly improve test and its documentation`|",
    "created_at": "2015-02-05T14:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[f16fdec](http://git.sagemath.org/sage.git/commit/?id=f16fdec593bf9c8b5d987dcc1c043a054595fc87)|`Slightly improve test and its documentation`|



---

archive/issue_comments_302227.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-05T15:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302227",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_302228.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2015-02-05T15:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302228",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_events_050594.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-08T15:26:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17666#event-50594"
}
```



---

archive/issue_comments_302229.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/17666\" to \"f16fdec593bf9c8b5d987dcc1c043a054595fc87\"",
    "created_at": "2015-02-08T15:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302229",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/17666" to "f16fdec593bf9c8b5d987dcc1c043a054595fc87"



---

archive/issue_comments_302230.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-08T15:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17666#issuecomment-302230",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
