# Issue 17869: prove_BSD for elliptic curve uses an incorrect lemma

archive/issues_017632.json:
```json
{
    "body": "Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H 1 vanishes is computed wrong in their Lemma 5.4. \n\nAs a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.\n\nThe patch here replaces the condition with a new condition, based on a paper I have written with Taylor Lawson: http://arxiv.org/abs/1505.02940 .\n\n\n\nCC:  wstein @rlmill @pjbruin\n\nKeywords: BSD\n\nBranch/Commit: 36f2616d104af80c6c70edc789752c427b7ce4ef\n\nReviewer: Peter Bruin\n\nAuthor: Chris Wuthrich\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17869\n\n",
    "closed_at": "2015-06-02T22:09:15Z",
    "created_at": "2015-02-27T15:49:20Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "prove_BSD for elliptic curve uses an incorrect lemma",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17869",
    "user": "https://github.com/categorie"
}
```
Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H 1 vanishes is computed wrong in their Lemma 5.4. 

As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.

The patch here replaces the condition with a new condition, based on a paper I have written with Taylor Lawson: http://arxiv.org/abs/1505.02940 .



CC:  wstein @rlmill @pjbruin

Keywords: BSD

Branch/Commit: 36f2616d104af80c6c70edc789752c427b7ce4ef

Reviewer: Peter Bruin

Author: Chris Wuthrich

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17869





---

archive/issue_comments_306641.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H^1 vanish is computed wrong in their Lemma 5.4. \n+Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H ^ 1 vanish is computed wrong in their Lemma 5.4. \n \n As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.\n \n``````\n",
    "created_at": "2015-02-27T15:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306641",
    "user": "https://github.com/categorie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H^1 vanish is computed wrong in their Lemma 5.4. 
+Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H ^ 1 vanish is computed wrong in their Lemma 5.4. 
 
 As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.
 
``````




---

archive/issue_comments_306642.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H ^ 1 vanish is computed wrong in their Lemma 5.4. \n+Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H 1 vanishes is computed wrong in their Lemma 5.4. \n \n As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.\n \n``````\n",
    "created_at": "2015-02-27T15:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306642",
    "user": "https://github.com/categorie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H ^ 1 vanish is computed wrong in their Lemma 5.4. 
+Let E be an elliptic curve over Q. For certain primes p, the function prove_BSD will make reference to the paper of Stein et al on the numerical verification of BSD. Unfortunately, the Theorem 5.3 in there is incorrect. The condition that the H 1 vanishes is computed wrong in their Lemma 5.4. 
 
 As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.
 
``````




---

archive/issue_comments_306643.json:
```json
{
    "body": "Changing commit from \"\" to \"2f028b8e06723c2ede88114a92768c5da1dccd03\"",
    "created_at": "2015-02-27T15:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306643",
    "user": "https://github.com/categorie"
}
```

Changing commit from "" to "2f028b8e06723c2ede88114a92768c5da1dccd03"



---

archive/issue_comments_306644.json:
```json
{
    "body": "Changing branch from \"\" to \"u/wuthrich/ticket/17869\"",
    "created_at": "2015-02-27T15:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306644",
    "user": "https://github.com/categorie"
}
```

Changing branch from "" to "u/wuthrich/ticket/17869"



---

archive/issue_comments_306645.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[5c9b572](http://git.sagemath.org/sage.git/commit/?id=5c9b572f0ba06f4e06f9a67ce13f771064520b92)|`fixing a bug in prove_bsd: a criterion for applying kolyvagin is corrected`|\n|[2f028b8](http://git.sagemath.org/sage.git/commit/?id=2f028b8e06723c2ede88114a92768c5da1dccd03)|`adjust docs for prove_BSD`|",
    "created_at": "2015-02-27T15:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306645",
    "user": "https://github.com/categorie"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[5c9b572](http://git.sagemath.org/sage.git/commit/?id=5c9b572f0ba06f4e06f9a67ce13f771064520b92)|`fixing a bug in prove_bsd: a criterion for applying kolyvagin is corrected`|
|[2f028b8](http://git.sagemath.org/sage.git/commit/?id=2f028b8e06723c2ede88114a92768c5da1dccd03)|`adjust docs for prove_BSD`|



---

archive/issue_comments_306646.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[8b6a73a](http://git.sagemath.org/sage.git/commit/?id=8b6a73af07a1c0829a09133a0af9fcef1b724eee)|`pass the right argument for heegner points from bsd`|",
    "created_at": "2015-02-27T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[8b6a73a](http://git.sagemath.org/sage.git/commit/?id=8b6a73af07a1c0829a09133a0af9fcef1b724eee)|`pass the right argument for heegner points from bsd`|



---

archive/issue_comments_306647.json:
```json
{
    "body": "Changing commit from \"2f028b8e06723c2ede88114a92768c5da1dccd03\" to \"8b6a73af07a1c0829a09133a0af9fcef1b724eee\"",
    "created_at": "2015-02-27T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306647",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2f028b8e06723c2ede88114a92768c5da1dccd03" to "8b6a73af07a1c0829a09133a0af9fcef1b724eee"



---

archive/issue_comments_306648.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,6 @@\n \n As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.\n \n-The patch here replaces the condition with a new condition, based on a paper I am writing with Taylor Lawson. We explicitly find when the cohomology groups in questions do not vanish. I will point to the paper when it is ready.\n-\n-I wait with asking for review until then.\n+The patch here replaces the condition with a new condition, based on a paper I have written with Taylor Lawson: http://arxiv.org/abs/1505.02940 .\n \n \n``````\n",
    "created_at": "2015-05-13T10:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306648",
    "user": "https://github.com/categorie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,6 @@
 
 As a consequence, sage sometimes claims that we know how to prove BSD when the verification is in fact much harder and rules out some cases when we would know it.
 
-The patch here replaces the condition with a new condition, based on a paper I am writing with Taylor Lawson. We explicitly find when the cohomology groups in questions do not vanish. I will point to the paper when it is ready.
-
-I wait with asking for review until then.
+The patch here replaces the condition with a new condition, based on a paper I have written with Taylor Lawson: http://arxiv.org/abs/1505.02940 .
 
 
``````




---

archive/issue_comments_306649.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-13T10:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306649",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_306650.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2015-06-01T05:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306650",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_306651.json:
```json
{
    "body": "<a id='comment:7'></a>\nA few questions/comments:\n- Could you add a reference to your preprint to the documentation?\n- It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.\n- It seems to me that the code\n  {{{\n  phis = [phi for phi in flatten(BSD.curve.isogeny_class().isogenies())\n             if phi != 0 and\n             phi.degree() == p and\n             phi.domain().is_isomorphic(BSD.curve) ]\n  }}}\n  can be simplified to\n  {{{\n  phis = BSD.curve.isogenies_prime_degree(p) \n  }}}\n  Would this be OK?\n- A typographical question: are the spaces around the dash in \"Lawson - Wuthrich\" intentional?  It is fine with me either way, but there is already \"Stein-Wuthrich\" without the spaces.",
    "created_at": "2015-06-01T05:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306651",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>
A few questions/comments:
- Could you add a reference to your preprint to the documentation?
- It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.
- It seems to me that the code
  {{{
  phis = [phi for phi in flatten(BSD.curve.isogeny_class().isogenies())
             if phi != 0 and
             phi.degree() == p and
             phi.domain().is_isomorphic(BSD.curve) ]
  }}}
  can be simplified to
  {{{
  phis = BSD.curve.isogenies_prime_degree(p) 
  }}}
  Would this be OK?
- A typographical question: are the spaces around the dash in "Lawson - Wuthrich" intentional?  It is fine with me either way, but there is already "Stein-Wuthrich" without the spaces.



---

archive/issue_comments_306652.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [pbruin](#comment%3A7):\n> - It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.\n \nActually, I am now wondering whether the check for irreducible representations is necessary at all; the other tests seem to suffice to set `crit_lw = True` whenever the representation is irreducible.",
    "created_at": "2015-06-01T06:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306652",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>
Replying to [pbruin](#comment%3A7):
> - It would probably be faster to do the check for irreducible representations after the checks for the cases `p > 11 or p == 7` and `p == 1`.
 
Actually, I am now wondering whether the check for irreducible representations is necessary at all; the other tests seem to suffice to set `crit_lw = True` whenever the representation is irreducible.



---

archive/issue_comments_306653.json:
```json
{
    "body": "<a id='comment:9'></a>\nLooking at Theorem 1 in the preprint, it seems that the checks in the cases *p* = 3 and *p* = 5 are stricter than necessary.  For example, let *E* be the (\u0393<sub>0</sub>(*N*)-optimal) elliptic curve with Cremona label 198b1 (LMFDB label 198.e3).  Then *E* admits a 3-isogeny with kernel *\u03bc*<sub>3</sub> and no other 3-isogenies.  Theorem 1 implies that the H<sup>1</sup> is trivial, but the code as implemented in this ticket does not detect this since it keeps `crit_lw = False` unless the 3-isogenous curve does not have any points of order 3 either.  Does this mean that the criterion in the code can be relaxed?",
    "created_at": "2015-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306653",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
Looking at Theorem 1 in the preprint, it seems that the checks in the cases *p* = 3 and *p* = 5 are stricter than necessary.  For example, let *E* be the (Γ<sub>0</sub>(*N*)-optimal) elliptic curve with Cremona label 198b1 (LMFDB label 198.e3).  Then *E* admits a 3-isogeny with kernel *μ*<sub>3</sub> and no other 3-isogenies.  Theorem 1 implies that the H<sup>1</sup> is trivial, but the code as implemented in this ticket does not detect this since it keeps `crit_lw = False` unless the 3-isogenous curve does not have any points of order 3 either.  Does this mean that the criterion in the code can be relaxed?



---

archive/issue_comments_306654.json:
```json
{
    "body": "Changing commit from \"8b6a73af07a1c0829a09133a0af9fcef1b724eee\" to \"b8ce66ddaf48c7d913e89677f1491331cd0151ad\"",
    "created_at": "2015-06-02T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8b6a73af07a1c0829a09133a0af9fcef1b724eee" to "b8ce66ddaf48c7d913e89677f1491331cd0151ad"



---

archive/issue_comments_306655.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[b8ce66d](http://git.sagemath.org/sage.git/commit/?id=b8ce66ddaf48c7d913e89677f1491331cd0151ad)|`ticket 17869: add reference and improve code`|",
    "created_at": "2015-06-02T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[b8ce66d](http://git.sagemath.org/sage.git/commit/?id=b8ce66ddaf48c7d913e89677f1491331cd0151ad)|`ticket 17869: add reference and improve code`|



---

archive/issue_comments_306656.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks.\n\nYour suggestion about adding the reference and reordering the conditions are very good and I did so. Also the one-line replacement of my 4 line constuction is very welcome :)\n\nAs to the precise condition. Theorem 1 in the paper is used, but one needs more. The best reference would be to theorem 14 in the linked preprint. The thing is that for curves like 198b1 the second cohomology does not vanish and that is needed in the argument as well.",
    "created_at": "2015-06-02T14:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306656",
    "user": "https://github.com/categorie"
}
```

<a id='comment:11'></a>
Thanks.

Your suggestion about adding the reference and reordering the conditions are very good and I did so. Also the one-line replacement of my 4 line constuction is very welcome :)

As to the precise condition. Theorem 1 in the paper is used, but one needs more. The best reference would be to theorem 14 in the linked preprint. The thing is that for curves like 198b1 the second cohomology does not vanish and that is needed in the argument as well.



---

archive/issue_comments_306657.json:
```json
{
    "body": "<a id='comment:12'></a>\nOK, thanks for the explanation!  I created a small reviewer patch, mostly to polish the formatting a bit.",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306657",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:12'></a>
OK, thanks for the explanation!  I created a small reviewer patch, mostly to polish the formatting a bit.



---

archive/issue_comments_306658.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306658",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_306659.json:
```json
{
    "body": "Changing branch from \"u/wuthrich/ticket/17869\" to \"u/pbruin/17869-prove_BSD\"",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306659",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "u/wuthrich/ticket/17869" to "u/pbruin/17869-prove_BSD"



---

archive/issue_comments_306660.json:
```json
{
    "body": "Changing commit from \"b8ce66ddaf48c7d913e89677f1491331cd0151ad\" to \"36f2616d104af80c6c70edc789752c427b7ce4ef\"",
    "created_at": "2015-06-02T15:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306660",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "b8ce66ddaf48c7d913e89677f1491331cd0151ad" to "36f2616d104af80c6c70edc789752c427b7ce4ef"



---

archive/issue_comments_306661.json:
```json
{
    "body": "Changing branch from \"u/pbruin/17869-prove_BSD\" to \"36f2616d104af80c6c70edc789752c427b7ce4ef\"",
    "created_at": "2015-06-02T22:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306661",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/17869-prove_BSD" to "36f2616d104af80c6c70edc789752c427b7ce4ef"



---

archive/issue_comments_306662.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-02T22:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17869#issuecomment-306662",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050935.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-02T22:09:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17869",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17869#event-50935"
}
```
