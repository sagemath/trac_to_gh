# Issue 17693: mutable poset: a data structure for asymptotic expressions

archive/issues_017456.json:
```json
{
    "assignees": [],
    "body": "The aim of this ticket is to implement a data structure which is to be used within an asymptotic expression (see Meta-Ticket #17601). This mutable poset stores elements together with its successors and predecessors. Those data is updated when a new element is inserted or an element is removed. It offers a couple of efficient routines for manipulations (all of which will be needed for the asymptotic expression).\n\nCC:  @behackl @cheuberg @jm58660\n\nBranch/Commit: **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**\n\nReviewer: **Benjamin Hackl, Clemens Heuberger**\n\nAuthor: **Daniel Krenn**\n\nComponent: **asymptotic expansions**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/17693_\n\n",
    "closed_at": "2015-10-12T07:16:42Z",
    "created_at": "2015-01-30T08:37:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "mutable poset: a data structure for asymptotic expressions",
    "type": "issue",
    "updated_at": "2015-10-12T07:16:42Z",
    "url": "https://github.com/sagemath/sage/issues/17693",
    "user": "https://github.com/dkrenn"
}
```
The aim of this ticket is to implement a data structure which is to be used within an asymptotic expression (see Meta-Ticket #17601). This mutable poset stores elements together with its successors and predecessors. Those data is updated when a new element is inserted or an element is removed. It offers a couple of efficient routines for manipulations (all of which will be needed for the asymptotic expression).

CC:  @behackl @cheuberg @jm58660

Branch/Commit: **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**

Reviewer: **Benjamin Hackl, Clemens Heuberger**

Author: **Daniel Krenn**

Component: **asymptotic expansions**

_Issue created by migration from https://trac.sagemath.org/ticket/17693_





---

archive/issue_events_249807.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-01-30T08:37:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249807"
}
```



---

archive/issue_events_249808.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-01-30T08:37:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249808"
}
```



---

archive/issue_events_249809.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-01-30T08:37:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249809"
}
```



---

archive/issue_events_249810.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-01-30T08:37:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
    "label_color": "0000ff",
    "label_name": "c: asymptotic expansions",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249810"
}
```



---

archive/issue_comments_238860.json:
```json
{
    "body": "Branch: **[u/dkrenn/asy/mutable_poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable_poset)**",
    "created_at": "2015-01-30T08:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238860",
    "user": "https://github.com/dkrenn"
}
```

Branch: **[u/dkrenn/asy/mutable_poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable_poset)**



---

archive/issue_comments_238861.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67522abed36cf885096f6de724f4641b8c4e8d26\"><code>67522ab</code></a></td><td><code>add-method: allow cancellation of elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91c071b13dccb90b94ae3eee741e569fa81c1c8f\"><code>91c071b</code></a></td><td><code>moved hook from add to __init__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdc3f160a11810d0ef5de4ca66224cf3557b585f\"><code>bdc3f16</code></a></td><td><code>rename: value --> element --> shell</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/434f4e1539dc2b84e9315324021264dd4ba321cd\"><code>434f4e1</code></a></td><td><code>write method element</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98e20b01cc155e9609cdf1963b6acce3ea40e623\"><code>98e20b0</code></a></td><td><code>improve/extend docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5488f10334f9895ad6b434dce2240015de97e277\"><code>5488f10</code></a></td><td><code>conditional iterations for shells</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f00d323792c8a6b844f3c2252eb18f55a606dc9e\"><code>f00d323</code></a></td><td><code>rename element_exists_hook to merge_hook</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1dc03d78480ab583dea45ed8934fda672e252f32\"><code>1dc03d7</code></a></td><td><code>introduce can_merge and rename merge_hook to merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/960b18b7cbf22ec164ec1eb21414a8398f129e27\"><code>960b18b</code></a></td><td><code>a couple of minor rewritings to make the code and doctests nicer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73\"><code>e2f884f</code></a></td><td><code>write merge-methods</code></td></tr></table>\n",
    "created_at": "2015-01-30T08:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238861",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:2" align="right">comment:2</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67522abed36cf885096f6de724f4641b8c4e8d26"><code>67522ab</code></a></td><td><code>add-method: allow cancellation of elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91c071b13dccb90b94ae3eee741e569fa81c1c8f"><code>91c071b</code></a></td><td><code>moved hook from add to __init__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdc3f160a11810d0ef5de4ca66224cf3557b585f"><code>bdc3f16</code></a></td><td><code>rename: value --> element --> shell</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/434f4e1539dc2b84e9315324021264dd4ba321cd"><code>434f4e1</code></a></td><td><code>write method element</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98e20b01cc155e9609cdf1963b6acce3ea40e623"><code>98e20b0</code></a></td><td><code>improve/extend docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5488f10334f9895ad6b434dce2240015de97e277"><code>5488f10</code></a></td><td><code>conditional iterations for shells</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f00d323792c8a6b844f3c2252eb18f55a606dc9e"><code>f00d323</code></a></td><td><code>rename element_exists_hook to merge_hook</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1dc03d78480ab583dea45ed8934fda672e252f32"><code>1dc03d7</code></a></td><td><code>introduce can_merge and rename merge_hook to merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/960b18b7cbf22ec164ec1eb21414a8398f129e27"><code>960b18b</code></a></td><td><code>a couple of minor rewritings to make the code and doctests nicer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73"><code>e2f884f</code></a></td><td><code>write merge-methods</code></td></tr></table>




---

archive/issue_comments_238862.json:
```json
{
    "body": "Commit: **[`e2f884f`](https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73)**",
    "created_at": "2015-01-30T08:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238862",
    "user": "https://github.com/dkrenn"
}
```

Commit: **[`e2f884f`](https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73)**



---

archive/issue_comments_238863.json:
```json
{
    "body": "Author: **Daniel Krenn**",
    "created_at": "2015-01-30T08:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238863",
    "user": "https://github.com/dkrenn"
}
```

Author: **Daniel Krenn**



---

archive/issue_comments_238864.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nA mutable poset class should be stored in `sage.combinat.posets`.\n\nNathann",
    "created_at": "2015-01-30T10:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238864",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:3" align="right">comment:3</div>

A mutable poset class should be stored in `sage.combinat.posets`.

Nathann



---

archive/issue_comments_238865.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis series of comments are the result of an email discussion. Its aim is to give a better understanding of the needs of the data structure used in an asymptotic expression.\n\nAn example of an asymptotic expression in say 2 variables (n->oo, t->oo) is\n\n```\nA = n^3*t^2 + 42*n^2*t^2 + 3*n*t^4 + O(t)\n```\nThis is stored in the mutable poset in the following way: the elements of the poset are exactly the summands of the expression above. This means\n\n```\nsage: A.data  # or however this may be called\nposet(n^3*t^2, 42*n^2*t^2, 3*n*t^4, O(t))\n```\n\nThe growth of these summands is partially ordered:\na) `n<sup>3*t</sup>2 >= n<sup>2*t</sup>2`\nb) `n<sup>3*t</sup>2 >= t`\nc) `n<sup>2*t</sup>2 >= t`\nd) `n*t^4 >= t`\nThe mutable poset stores/caches the direct successors/predecessors, i.e., only the relations a), c), d), but not b), since this follows by transitivity out of a) and c). Thus, for the example above, we have the following information stored\n\n```\nposet\n- term O(t)\n  successors: n^3*t^2, 42*n^2*t^2, 3*n*t^4\n  no predecessors\n- term 3*n*t^4\n  no successors\n  predecessors: O(t)\n- term 42*n^2*t^2\n  successors: n^3*t^2\n  predecessors: O(t)\n- term n^3*t^2\n  no successors\n  predecessors: 42*n^2*t^2\n```",
    "created_at": "2015-02-02T17:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238865",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:4" align="right">comment:4</div>

This series of comments are the result of an email discussion. Its aim is to give a better understanding of the needs of the data structure used in an asymptotic expression.

An example of an asymptotic expression in say 2 variables (n->oo, t->oo) is

```
A = n^3*t^2 + 42*n^2*t^2 + 3*n*t^4 + O(t)
```
This is stored in the mutable poset in the following way: the elements of the poset are exactly the summands of the expression above. This means

```
sage: A.data  # or however this may be called
poset(n^3*t^2, 42*n^2*t^2, 3*n*t^4, O(t))
```

The growth of these summands is partially ordered:
a) `n<sup>3*t</sup>2 >= n<sup>2*t</sup>2`
b) `n<sup>3*t</sup>2 >= t`
c) `n<sup>2*t</sup>2 >= t`
d) `n*t^4 >= t`
The mutable poset stores/caches the direct successors/predecessors, i.e., only the relations a), c), d), but not b), since this follows by transitivity out of a) and c). Thus, for the example above, we have the following information stored

```
poset
- term O(t)
  successors: n^3*t^2, 42*n^2*t^2, 3*n*t^4
  no predecessors
- term 3*n*t^4
  no successors
  predecessors: O(t)
- term 42*n^2*t^2
  successors: n^3*t^2
  predecessors: O(t)
- term n^3*t^2
  no successors
  predecessors: 42*n^2*t^2
```



---

archive/issue_comments_238866.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWe want to perform arithmetic with asymptotic expressions, in particular we need to do efficiently:\n1) addition (and multiplication)\n2) merging/absorbing terms, e.g.\n\n```\nn^4 + 2*n^2 + 3*n + O(1) + O(n^2) = n^4 + O(n^2)\n```\nor\n\n```\nO(n*t) + n + t = O(n*t)\n```\n3) removing elements of the poset, because of 2)\n\nTo make them efficent, we store successors and predecessors of each element in the poset. These are updated when inserting/removing elements.\n\nNote that an asymptotic expression can contain several O-terms, e.g.\n\n```\nO(n^3 t^2) + O(n^4 t^1) + O(n^2 t^3)\n```\nis a valid expression. In the poset each O-term is a minimal\nelement and they are all pairwise incomparable (thus, the O terms\nwill be an antichain in the poset). Anyhow, non-O-terms be be\ncompareable to other elements, e.g. in\n\n```\n3*n*t + O(n) + O(t)\n```\nwe have `n*t >= n` and `n*t >= t`.\n\nWe also need to deal with situations where we want to insert an\nelement of the same growth: E.g. `4n+3n = 7n`, `4n+O(n) = O(n)`,\nthus, the elements themselves can change during addition. When\nmerging/absorbing and working with O-Terms with explicit\nO-constants, this also occurrs frequently (even with terms of\ndifferent growth).",
    "created_at": "2015-02-02T17:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238866",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:5" align="right">comment:5</div>

We want to perform arithmetic with asymptotic expressions, in particular we need to do efficiently:
1) addition (and multiplication)
2) merging/absorbing terms, e.g.

```
n^4 + 2*n^2 + 3*n + O(1) + O(n^2) = n^4 + O(n^2)
```
or

```
O(n*t) + n + t = O(n*t)
```
3) removing elements of the poset, because of 2)

To make them efficent, we store successors and predecessors of each element in the poset. These are updated when inserting/removing elements.

Note that an asymptotic expression can contain several O-terms, e.g.

```
O(n^3 t^2) + O(n^4 t^1) + O(n^2 t^3)
```
is a valid expression. In the poset each O-term is a minimal
element and they are all pairwise incomparable (thus, the O terms
will be an antichain in the poset). Anyhow, non-O-terms be be
compareable to other elements, e.g. in

```
3*n*t + O(n) + O(t)
```
we have `n*t >= n` and `n*t >= t`.

We also need to deal with situations where we want to insert an
element of the same growth: E.g. `4n+3n = 7n`, `4n+O(n) = O(n)`,
thus, the elements themselves can change during addition. When
merging/absorbing and working with O-Terms with explicit
O-constants, this also occurrs frequently (even with terms of
different growth).



---

archive/issue_comments_238867.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNote that all the terms (individual summands) support one\noperation, namely these can be multiplied, maybe coercion is\nused, e.g.\n\n```\n4*n^2*t * O(n) --> O(n^2*t) * O(n) --> O(n^3*t)\n```\nThus we have monoids here. \"Addition\" of terms is more complicated\nsince not always possible. E.g.\n\n```\nn + O(t) = n + O(t)\n```\nBut since this is an operation we want to have, the data\nstructure has to take this into consideration.\n\nHere an example of the addition of two asymptotic expressions, to\nsee what the poset should do:\n\n```\nB = n^2*t + n + O(1)\nC = n*t^2 + O(n)\n```\nSteps in computing B + C:\n\n1) calculate: B.poset union C.poset\nThis gives\n\n```\nposet(n^2*t, n, O(1), n*t^2, O(n)).\n```\n\n2) simplify: returns \n\n```\nposet(n^2*t, n*t^2, O(n))\n```\nTo achieve this, we have to search for what can be \"absorbed\" by the\nO-term `O(n)`. These are exactly all the predecessors of `O(n)` (not only\nthe direct, but also the predecessors of the predecessors...)\nThus some kind of caching of predecessors is necessary, but \"cache\"\nhas to be updated when modifying the poset.\n\nNote that this data structure does a preprocessing of its relations, which is definitely good for nonsmall instances. At the moment this class should provide an interface for the needed routines. A fine tuning (w.r.t. speed optimization for various sizes) can be done later (if the performance is too bad).\n\nTo conclude, the data structure needed in an asymptotic expression needs to deal with dynamic changes (mutability) and do some caching to provide efficient methods. And it needs to do more than a poset which is made mutable. In particular, it has to provide the methods for the above mentioned merging and absorbing.",
    "created_at": "2015-02-02T17:41:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238867",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:6" align="right">comment:6</div>

Note that all the terms (individual summands) support one
operation, namely these can be multiplied, maybe coercion is
used, e.g.

```
4*n^2*t * O(n) --> O(n^2*t) * O(n) --> O(n^3*t)
```
Thus we have monoids here. "Addition" of terms is more complicated
since not always possible. E.g.

```
n + O(t) = n + O(t)
```
But since this is an operation we want to have, the data
structure has to take this into consideration.

Here an example of the addition of two asymptotic expressions, to
see what the poset should do:

```
B = n^2*t + n + O(1)
C = n*t^2 + O(n)
```
Steps in computing B + C:

1) calculate: B.poset union C.poset
This gives

```
poset(n^2*t, n, O(1), n*t^2, O(n)).
```

2) simplify: returns 

```
poset(n^2*t, n*t^2, O(n))
```
To achieve this, we have to search for what can be "absorbed" by the
O-term `O(n)`. These are exactly all the predecessors of `O(n)` (not only
the direct, but also the predecessors of the predecessors...)
Thus some kind of caching of predecessors is necessary, but "cache"
has to be updated when modifying the poset.

Note that this data structure does a preprocessing of its relations, which is definitely good for nonsmall instances. At the moment this class should provide an interface for the needed routines. A fine tuning (w.r.t. speed optimization for various sizes) can be done later (if the performance is too bad).

To conclude, the data structure needed in an asymptotic expression needs to deal with dynamic changes (mutability) and do some caching to provide efficient methods. And it needs to do more than a poset which is made mutable. In particular, it has to provide the methods for the above mentioned merging and absorbing.



---

archive/issue_comments_238868.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nathanncohen](#comment:3):\n> A mutable poset class should be stored in `sage.combinat.posets`.\n\nThis class has nothing to do with combinatorics, therefore I am against `sage.combinat`. And it implements a data structure and we have `sage.data_structures`, so it seems the right place.",
    "created_at": "2015-02-02T17:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238868",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nathanncohen](#comment:3):
> A mutable poset class should be stored in `sage.combinat.posets`.

This class has nothing to do with combinatorics, therefore I am against `sage.combinat`. And it implements a data structure and we have `sage.data_structures`, so it seems the right place.



---

archive/issue_comments_238869.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n> This class has nothing to do with combinatorics, therefore I am against `sage.combinat`. And it implements a data structure and we have `sage.data_structures`, so it seems the right place.\n\nGraphs are a data structure, they are in graphs/. Incidence Structures are data structure, and they are in combinat/designs. Matrices are a data structure, and they are in matrix/. Posets and Hasse Diagrams are a data structure, and they are in combinat/posets/.\n\nAlso, you wrote in your branch a 'todo note' to implement in your `MutablePoset` data structure that 20+ methods from the current Posets should be implemented for your new class: the proper way to do that would be to inherit them from posets.\n\nCould you also explain what \"shells\" are, and how they differ from the 'facade' boolean argument of Posets ?\n\nThanks,\n\nNathann",
    "created_at": "2015-02-02T19:02:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238869",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">comment:8</div>

> This class has nothing to do with combinatorics, therefore I am against `sage.combinat`. And it implements a data structure and we have `sage.data_structures`, so it seems the right place.

Graphs are a data structure, they are in graphs/. Incidence Structures are data structure, and they are in combinat/designs. Matrices are a data structure, and they are in matrix/. Posets and Hasse Diagrams are a data structure, and they are in combinat/posets/.

Also, you wrote in your branch a 'todo note' to implement in your `MutablePoset` data structure that 20+ methods from the current Posets should be implemented for your new class: the proper way to do that would be to inherit them from posets.

Could you also explain what "shells" are, and how they differ from the 'facade' boolean argument of Posets ?

Thanks,

Nathann



---

archive/issue_comments_238870.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@nathanncohen](#comment:8):\n> Also, you wrote in your branch a 'todo note' to implement in your `MutablePoset` data structure that 20+ methods from the current Posets should be implemented for your new class: the proper way to do that would be to inherit them from posets.\n\nA `FinitePoset` inherits from `Parent` and my understanding is that parents must be immutable.\nThus, IMHO, this mutable poset here should not inherit from `FinitePoset`.",
    "created_at": "2015-02-03T07:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238870",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@nathanncohen](#comment:8):
> Also, you wrote in your branch a 'todo note' to implement in your `MutablePoset` data structure that 20+ methods from the current Posets should be implemented for your new class: the proper way to do that would be to inherit them from posets.

A `FinitePoset` inherits from `Parent` and my understanding is that parents must be immutable.
Thus, IMHO, this mutable poset here should not inherit from `FinitePoset`.



---

archive/issue_comments_238871.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> A `FinitePoset` inherits from `Parent` and my understanding is that parents must be immutable.\n\nIndeed, but it may actually be time to change that. We are also having problem with this, because apparently the construction of `Parent/UniqueRepresentation` instances is known to be very slow, and you \"should not build too many of them at once\" or it will slow code down a lot.\n\nThat is what is already preventing us from implementing a proper iterator over all non-isomorphic posets of a given size: this operation creates too many parents and is the bottleneck in the computations.\n\nIf it seems that you are bothered by the same thing, it gives all the more reasons to make that change.\n\nNathann",
    "created_at": "2015-02-03T07:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238871",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

> A `FinitePoset` inherits from `Parent` and my understanding is that parents must be immutable.

Indeed, but it may actually be time to change that. We are also having problem with this, because apparently the construction of `Parent/UniqueRepresentation` instances is known to be very slow, and you "should not build too many of them at once" or it will slow code down a lot.

That is what is already preventing us from implementing a proper iterator over all non-isomorphic posets of a given size: this operation creates too many parents and is the bottleneck in the computations.

If it seems that you are bothered by the same thing, it gives all the more reasons to make that change.

Nathann



---

archive/issue_comments_238872.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@nathanncohen](#comment:8):\n> Could you also explain what \"shells\" are, and how they differ from the 'facade' boolean argument of Posets ?\n\nThere are similarities between shells and facades, but a facade is something in Sage that represent other things and again uses parents/elements (thus immutable). It has well-defined properties and there is even a category for facade sets.\nThe shells in the mutable poset are more like a container for the elements. Ideally a user of the poset does not need them at all (and only a few MutablePoset-methods use them). They are only used inside the poset-algorithms.\nAt one point I thought about making shells and the related methods private, but never did this...",
    "created_at": "2015-02-05T08:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238872",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@nathanncohen](#comment:8):
> Could you also explain what "shells" are, and how they differ from the 'facade' boolean argument of Posets ?

There are similarities between shells and facades, but a facade is something in Sage that represent other things and again uses parents/elements (thus immutable). It has well-defined properties and there is even a category for facade sets.
The shells in the mutable poset are more like a container for the elements. Ideally a user of the poset does not need them at all (and only a few MutablePoset-methods use them). They are only used inside the poset-algorithms.
At one point I thought about making shells and the related methods private, but never did this...



---

archive/issue_comments_238873.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nathanncohen](#comment:8):\n> Graphs are a data structure\n\nNo, graphs are mathematical objects. \"a binary symmetric matrix implemented using bitsets\" (which could be used for dense graphs) is a data structure.",
    "created_at": "2015-02-05T10:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238873",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nathanncohen](#comment:8):
> Graphs are a data structure

No, graphs are mathematical objects. "a binary symmetric matrix implemented using bitsets" (which could be used for dense graphs) is a data structure.



---

archive/issue_comments_238874.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> > Graphs are a data structure\n\n> No, graphs are mathematical objects.\n\nI was not thinking of a graph as it is defined in a book, but of Sage's graphs. I should have said \"the Graph class\" probably.\n\nNathann",
    "created_at": "2015-02-05T10:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238874",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

> > Graphs are a data structure

> No, graphs are mathematical objects.

I was not thinking of a graph as it is defined in a book, but of Sage's graphs. I should have said "the Graph class" probably.

Nathann



---

archive/issue_comments_238875.json:
```json
{
    "body": "Changed commit from **[`e2f884f`](https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73)** to **[`1c6b196`](https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d)**",
    "created_at": "2015-07-28T18:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238875",
    "user": "https://github.com/dkrenn"
}
```

Changed commit from **[`e2f884f`](https://github.com/sagemath/sagetrac-mirror/commit/e2f884f56743c7d8780586c4b04b3d2e8242ce73)** to **[`1c6b196`](https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d)**



---

archive/issue_comments_238876.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable_poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable_poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**",
    "created_at": "2015-07-28T18:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238876",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/dkrenn/asy/mutable_poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable_poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**



---

archive/issue_comments_238877.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/143dfeab1089f54057194d4318b4197cd061c9a1\"><code>143dfea</code></a></td><td><code>write method element</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b348d14284f5dc30170ff05887ca53033b2a541e\"><code>b348d14</code></a></td><td><code>improve/extend docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/520bb00642983f93ad4e6741b421bfb5cf7eef60\"><code>520bb00</code></a></td><td><code>conditional iterations for shells</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e443f7e324a2b29f773572bba3588ce1c4b69f4d\"><code>e443f7e</code></a></td><td><code>rename element_exists_hook to merge_hook</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b79f1bc2e2fb872e1a064e94ce6f7c61d75b4364\"><code>b79f1bc</code></a></td><td><code>introduce can_merge and rename merge_hook to merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ed0f3ef882ffbb590ef4e3e307ee43a10ab67f\"><code>82ed0f3</code></a></td><td><code>a couple of minor rewritings to make the code and doctests nicer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13d4a36de647ed209e0bcd9e90a549befb4ea790\"><code>13d4a36</code></a></td><td><code>write merge-methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8584f57429b7d3c85ce178eaefad79d787833c17\"><code>8584f57</code></a></td><td><code>write __len__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1678ed001fde620ab6b3cd63c4bda0113d791d9\"><code>a1678ed</code></a></td><td><code>remove TODO-list of methods (list is now in separat branch)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d\"><code>1c6b196</code></a></td><td><code>write methods for maximal/minimal elements</code></td></tr></table>\n",
    "created_at": "2015-07-28T18:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238877",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:14" align="right">comment:14</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/143dfeab1089f54057194d4318b4197cd061c9a1"><code>143dfea</code></a></td><td><code>write method element</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b348d14284f5dc30170ff05887ca53033b2a541e"><code>b348d14</code></a></td><td><code>improve/extend docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/520bb00642983f93ad4e6741b421bfb5cf7eef60"><code>520bb00</code></a></td><td><code>conditional iterations for shells</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e443f7e324a2b29f773572bba3588ce1c4b69f4d"><code>e443f7e</code></a></td><td><code>rename element_exists_hook to merge_hook</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b79f1bc2e2fb872e1a064e94ce6f7c61d75b4364"><code>b79f1bc</code></a></td><td><code>introduce can_merge and rename merge_hook to merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ed0f3ef882ffbb590ef4e3e307ee43a10ab67f"><code>82ed0f3</code></a></td><td><code>a couple of minor rewritings to make the code and doctests nicer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13d4a36de647ed209e0bcd9e90a549befb4ea790"><code>13d4a36</code></a></td><td><code>write merge-methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8584f57429b7d3c85ce178eaefad79d787833c17"><code>8584f57</code></a></td><td><code>write __len__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1678ed001fde620ab6b3cd63c4bda0113d791d9"><code>a1678ed</code></a></td><td><code>remove TODO-list of methods (list is now in separat branch)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d"><code>1c6b196</code></a></td><td><code>write methods for maximal/minimal elements</code></td></tr></table>




---

archive/issue_comments_238878.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nIf `union()` does same thing as `disjoint_union()` in posets and in graphs, please change name accordingly. It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.\n\nJust my two cents. I would give three, if I would have more time.",
    "created_at": "2015-07-28T20:30:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238878",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:15" align="right">comment:15</div>

If `union()` does same thing as `disjoint_union()` in posets and in graphs, please change name accordingly. It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.

Just my two cents. I would give three, if I would have more time.



---

archive/issue_comments_238879.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jm58660](#comment:15):\n> If `union()` does same thing as `disjoint_union()` in posets and in graphs, please change name accordingly.\n\nNo, it does not do the same. Union takes only one instance of equal elements, whereas disjoint_union makes each one of the equal elements distinct.\n\n> It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.\n\nThe developer guide\n\n    http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings\n\nsays\n\n    An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.\n\nTherefore skipping one of these blocks seems to be against the rules (and hopefully helps avoiding the confusion of a missing input block).\n\n> Just my two cents. I would give three, if I would have more time.\n\nMany thanks for all your cents.\n\nBest, Daniel",
    "created_at": "2015-07-29T05:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238879",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jm58660](#comment:15):
> If `union()` does same thing as `disjoint_union()` in posets and in graphs, please change name accordingly.

No, it does not do the same. Union takes only one instance of equal elements, whereas disjoint_union makes each one of the equal elements distinct.

> It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.

The developer guide

    http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings

says

    An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.

Therefore skipping one of these blocks seems to be against the rules (and hopefully helps avoiding the confusion of a missing input block).

> Just my two cents. I would give three, if I would have more time.

Many thanks for all your cents.

Best, Daniel



---

archive/issue_comments_238880.json:
```json
{
    "body": "Changed commit from **[`1c6b196`](https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d)** to **[`19fd155`](https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae)**",
    "created_at": "2015-07-29T08:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238880",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1c6b196`](https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d)** to **[`19fd155`](https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae)**



---

archive/issue_comments_238881.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae\"><code>19fd155</code></a></td><td><code>allow merge to go over all elements</code></td></tr></table>\n",
    "created_at": "2015-07-29T08:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238881",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae"><code>19fd155</code></a></td><td><code>allow merge to go over all elements</code></td></tr></table>




---

archive/issue_comments_238882.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dkrenn](#comment:16):\n> Replying to [@jm58660](#comment:15):\n> > If `union()` does same thing as `disjoint_union()` in posets and in graphs - -\n\n> No, it does not do the same.\n\nOK.\n \n> > It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.\n\n> \n> The developer guide says\n> \n>     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.\n\nTrue. But I don't think if it has been thinked that \"no input\" must be documented. Is it in other places? Or should this part of developer guide be changed?\n\nAnd should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?",
    "created_at": "2015-07-29T20:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238882",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dkrenn](#comment:16):
> Replying to [@jm58660](#comment:15):
> > If `union()` does same thing as `disjoint_union()` in posets and in graphs - -

> No, it does not do the same.

OK.
 
> > It seems unnecessary to have `INPUT`-part at all, if the function has no arguments at all.

> 
> The developer guide says
> 
>     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.

True. But I don't think if it has been thinked that "no input" must be documented. Is it in other places? Or should this part of developer guide be changed?

And should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?



---

archive/issue_events_249811.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-08-18T12:04:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249811"
}
```



---

archive/issue_comments_238883.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jm58660](#comment:18):\n> > The developer guide says\n> > \n> >     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.\n\n> \n> True. But I don't think if it has been thinked that \"no input\" must be documented. Is it in other places? Or should this part of developer guide be changed?\n\nI would keep it. (At the moment) the developer guide says to include it and I find it very nice to have constistent docstrings starting with one-liner, INPUT, OUTPUT, more details, EXAMPLES, ...\n\n(And: there are other places.)\n\n> And should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?\n\nWhat do you suggest?",
    "created_at": "2015-08-18T12:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238883",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jm58660](#comment:18):
> > The developer guide says
> > 
> >     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.

> 
> True. But I don't think if it has been thinked that "no input" must be documented. Is it in other places? Or should this part of developer guide be changed?

I would keep it. (At the moment) the developer guide says to include it and I find it very nice to have constistent docstrings starting with one-liner, INPUT, OUTPUT, more details, EXAMPLES, ...

(And: there are other places.)

> And should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?

What do you suggest?



---

archive/issue_comments_238884.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dkrenn](#comment:20):\n> Replying to [@jm58660](#comment:18):\n> > > The developer guide says\n> > > \n> > >     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.\n\n> > \n> > True. But I don't think if it has been thinked that \"no input\" must be documented. Is it in other places? Or should this part of developer guide be changed?\n\n> \n> I would keep it. (At the moment) the developer guide says to include it and I find it very nice to have constistent docstrings starting with one-liner, INPUT, OUTPUT, more details, EXAMPLES, ...\n\nThis is discussed at #19041. But don't let this stop coding -- Sage will propably never get finished so that questions like this would have The Final Answer.\n\n> > And should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?\n\n> \n> What do you suggest?\n\nEvery `cardinality()` should return `Integer`. For other integer-valued functions there were discussion about `int` vs. `Integer` without consensus.\n\nI don't know. For input it is explicitly said that the docstring can say \"x in integer\", not \"x must be `Integer` or `int`\". These are hard questions, as what is \"clear\" varies from one person to other.",
    "created_at": "2015-08-18T12:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238884",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dkrenn](#comment:20):
> Replying to [@jm58660](#comment:18):
> > > The developer guide says
> > > 
> > >     An INPUT and an OUTPUT block describing the input/output of the function. This is not optional.

> > 
> > True. But I don't think if it has been thinked that "no input" must be documented. Is it in other places? Or should this part of developer guide be changed?

> 
> I would keep it. (At the moment) the developer guide says to include it and I find it very nice to have constistent docstrings starting with one-liner, INPUT, OUTPUT, more details, EXAMPLES, ...

This is discussed at #19041. But don't let this stop coding -- Sage will propably never get finished so that questions like this would have The Final Answer.

> > And should for example docstring of `.cardinality()` really contain `OUTPUT`-block saying that output type is sage's `Integer`?

> 
> What do you suggest?

Every `cardinality()` should return `Integer`. For other integer-valued functions there were discussion about `int` vs. `Integer` without consensus.

I don't know. For input it is explicitly said that the docstring can say "x in integer", not "x must be `Integer` or `int`". These are hard questions, as what is "clear" varies from one person to other.



---

archive/issue_comments_238885.json:
```json
{
    "body": "Changed commit from **[`19fd155`](https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae)** to **[`ceb0b37`](https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1)**",
    "created_at": "2015-08-28T14:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238885",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`19fd155`](https://github.com/sagemath/sagetrac-mirror/commit/19fd1556a56a6d250ca464c385e7960ac715b2ae)** to **[`ceb0b37`](https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1)**



---

archive/issue_comments_238886.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28633219f5d6a868e2d2522d573683af7fa19321\"><code>2863321</code></a></td><td><code>allow merge to go over all elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9391c7820ec4801fcb54bf4be4db7501b4d1cd69\"><code>9391c78</code></a></td><td><code>derive MutablePoset from object (instead of SageObject)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70859d74ebdba2797a4a25e23d192349b1874bec\"><code>70859d7</code></a></td><td><code>cleanup: delete toset since not yet implemented</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d647d951c9c02c3daf4c1bcb86e54fada03582b3\"><code>d647d95</code></a></td><td><code>write map and mapped</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d\"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317\"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1\"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr></table>\n",
    "created_at": "2015-08-28T14:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238886",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28633219f5d6a868e2d2522d573683af7fa19321"><code>2863321</code></a></td><td><code>allow merge to go over all elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9391c7820ec4801fcb54bf4be4db7501b4d1cd69"><code>9391c78</code></a></td><td><code>derive MutablePoset from object (instead of SageObject)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70859d74ebdba2797a4a25e23d192349b1874bec"><code>70859d7</code></a></td><td><code>cleanup: delete toset since not yet implemented</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d647d951c9c02c3daf4c1bcb86e54fada03582b3"><code>d647d95</code></a></td><td><code>write map and mapped</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr></table>




---

archive/issue_comments_238887.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8584f57429b7d3c85ce178eaefad79d787833c17\"><code>8584f57</code></a></td><td><code>write __len__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1678ed001fde620ab6b3cd63c4bda0113d791d9\"><code>a1678ed</code></a></td><td><code>remove TODO-list of methods (list is now in separat branch)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d\"><code>1c6b196</code></a></td><td><code>write methods for maximal/minimal elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28633219f5d6a868e2d2522d573683af7fa19321\"><code>2863321</code></a></td><td><code>allow merge to go over all elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9391c7820ec4801fcb54bf4be4db7501b4d1cd69\"><code>9391c78</code></a></td><td><code>derive MutablePoset from object (instead of SageObject)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70859d74ebdba2797a4a25e23d192349b1874bec\"><code>70859d7</code></a></td><td><code>cleanup: delete toset since not yet implemented</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d647d951c9c02c3daf4c1bcb86e54fada03582b3\"><code>d647d95</code></a></td><td><code>write map and mapped</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d\"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317\"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1\"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr></table>\n",
    "created_at": "2015-08-28T14:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238887",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:23" align="right">comment:23</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8584f57429b7d3c85ce178eaefad79d787833c17"><code>8584f57</code></a></td><td><code>write __len__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1678ed001fde620ab6b3cd63c4bda0113d791d9"><code>a1678ed</code></a></td><td><code>remove TODO-list of methods (list is now in separat branch)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c6b196bac8386f97bb6234a8442040dd52e8b2d"><code>1c6b196</code></a></td><td><code>write methods for maximal/minimal elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28633219f5d6a868e2d2522d573683af7fa19321"><code>2863321</code></a></td><td><code>allow merge to go over all elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9391c7820ec4801fcb54bf4be4db7501b4d1cd69"><code>9391c78</code></a></td><td><code>derive MutablePoset from object (instead of SageObject)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70859d74ebdba2797a4a25e23d192349b1874bec"><code>70859d7</code></a></td><td><code>cleanup: delete toset since not yet implemented</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d647d951c9c02c3daf4c1bcb86e54fada03582b3"><code>d647d95</code></a></td><td><code>write map and mapped</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr></table>




---

archive/issue_comments_238888.json:
```json
{
    "body": "Changed commit from **[`ceb0b37`](https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1)** to **[`c1f8877`](https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8)**",
    "created_at": "2015-09-19T17:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238888",
    "user": "https://github.com/behackl"
}
```

Changed commit from **[`ceb0b37`](https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1)** to **[`c1f8877`](https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8)**



---

archive/issue_comments_238889.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nHello!\n\nI reviewed this ticket, and here are my comments:\n\n- `MutablePoset`, `MutablePosetShell`: derived from `object` vs. `SageObject`?\n- `is_null`, `is_oo`: is there some usecase for the `reverse` keyword? For `predecessor` and `successor`: this is clear, as it makes the code easier. However, I think that a `reverse`-keyword for `is_null` and `is_oo` is rather irritating.\n- doctests for `MutablePosetShell.le`: shouldn't doctests like `elem1 <= elem2` be marked as indirect?\n- `MutablePosetShell._copy_all_linked_`: 1st sentence should be a short description. Likewise for `MutablePosetShell._iter_depth_first_visit_` and `MutablePosetShell._iter_topological_visit_`.\n- sorted_set_by_tuple, is_MutablePoset: are these functions really necessary? Both are only used once within the whole file. The occurrence of `sorted_set_by_tuple` can be easily replaced by\n\n```\n[...].join(repr(e) for e in sortedshells if e in shell.successors(rev))\n```\nand the occurrence of `is_MutablePoset` can be replaced by a simple `isinstance`-call.\n- `MutablePoset.shells`: I do not understand the usecase of the `reverse` keyword. Can it be removed?\n- `MutablePoset.add`: I think that a comment (in the code) that roughly explains what the passage beginning with  `for reverse in (False, True):` does would be nice. It took me quite some time to understand and verify the functionality of this block.\n- `MutablePoset.discard`: why isn't this simply an alias of `MutablePoset.remove`? As `remove` has no return value, `discard` cannot have one either, if that was the intention.\n- Is there a particular reason for naming the parameters for all the set operations like `MutablePoset.union`, `MutablePoset.difference` etc. `left` and `right`, instead of `self` and `other`? IMHO, this disguises that the function can be called as `P.union(Q)`.\n- Regarding all set operations: currently, it is **not** clear from the documentation that all set operations are performed on the set of keys. This causes something like\n\n```\nsage: PR.<x> = ZZ[]\nsage: P = MutablePoset(key=lambda k: len(k.list()))\nsage: P.add(42*x)\nsage: P.add(21*x^2)\nsage: Q = MutablePoset(key=lambda k: len(k.list()))\nsage: Q.add(1111*x)\nsage: P, Q\n(poset(42*x, 21*x^2), poset(1111*x))\nsage: Q.is_subset(P)\nTrue\nsage: Q.union(P)\nposet(1111*x, 21*x^2)\n```\nand so on. In principle, I don't see this as a problem---however, I'd state this explicitly in each of these set operation functions. \n- `MutablePoset.mapped`: why is this function needed? Purely for semantical reasons? I'd move the doctests to `MutablePoset.copy`.\n- `MutablePosetShell._copy_all_linked_`: is the memoization using the `id` of the object a standard procedure? I thought about it, but I'm not entirely sure that this isn't a potential error source.\n\nSide note: the `MutablePoset` is the central data structure in our AsymptoticExpansions framework (cf. #17601). In this context, the functionality has been tested extensively--and some peculiarities (like the `map`-function etc.) are motivated by this application.\n\nAlso, I've made a few reviewer commits concerning the documentation; the branch is attached.\n\nAs soon as the points I've raised in the comments above are discussed, this would be a `positive_review` from my side.\n\nBenjamin\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d\"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317\"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1\"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/525bf3c334cf2f62a63999cbd5dc687c709a5dea\"><code>525bf3c</code></a></td><td><code>Merge branch 'u/dkrenn/asy/mutable-poset' of git://trac.sagemath.org/sage into 6.9.beta5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf1928f7a9ef5eac28a8ed419ef13cb97cfbe806\"><code>bf1928f</code></a></td><td><code>remove unused import</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98a7939651645c24263e36c8fca81dc1ba6d9a96\"><code>98a7939</code></a></td><td><code>print something --> print(something)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a7ab889e212062323f79c318596d5413ae7e1ea\"><code>2a7ab88</code></a></td><td><code>several improvements to documentation (language, structure)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4c43b71c81cc75b152a99d80754c1cb47104613\"><code>a4c43b7</code></a></td><td><code>fixed two examples-blocks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a867d3a36f5a068b6e7e3d00f95a5c4331960a6b\"><code>a867d3a</code></a></td><td><code>indentation (PEP 8)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8\"><code>c1f8877</code></a></td><td><code>improved errors and added two doctests</code></td></tr></table>\n",
    "created_at": "2015-09-19T17:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238889",
    "user": "https://github.com/behackl"
}
```

<div id="comment:25" align="right">comment:25</div>

Hello!

I reviewed this ticket, and here are my comments:

- `MutablePoset`, `MutablePosetShell`: derived from `object` vs. `SageObject`?
- `is_null`, `is_oo`: is there some usecase for the `reverse` keyword? For `predecessor` and `successor`: this is clear, as it makes the code easier. However, I think that a `reverse`-keyword for `is_null` and `is_oo` is rather irritating.
- doctests for `MutablePosetShell.le`: shouldn't doctests like `elem1 <= elem2` be marked as indirect?
- `MutablePosetShell._copy_all_linked_`: 1st sentence should be a short description. Likewise for `MutablePosetShell._iter_depth_first_visit_` and `MutablePosetShell._iter_topological_visit_`.
- sorted_set_by_tuple, is_MutablePoset: are these functions really necessary? Both are only used once within the whole file. The occurrence of `sorted_set_by_tuple` can be easily replaced by

```
[...].join(repr(e) for e in sortedshells if e in shell.successors(rev))
```
and the occurrence of `is_MutablePoset` can be replaced by a simple `isinstance`-call.
- `MutablePoset.shells`: I do not understand the usecase of the `reverse` keyword. Can it be removed?
- `MutablePoset.add`: I think that a comment (in the code) that roughly explains what the passage beginning with  `for reverse in (False, True):` does would be nice. It took me quite some time to understand and verify the functionality of this block.
- `MutablePoset.discard`: why isn't this simply an alias of `MutablePoset.remove`? As `remove` has no return value, `discard` cannot have one either, if that was the intention.
- Is there a particular reason for naming the parameters for all the set operations like `MutablePoset.union`, `MutablePoset.difference` etc. `left` and `right`, instead of `self` and `other`? IMHO, this disguises that the function can be called as `P.union(Q)`.
- Regarding all set operations: currently, it is **not** clear from the documentation that all set operations are performed on the set of keys. This causes something like

```
sage: PR.<x> = ZZ[]
sage: P = MutablePoset(key=lambda k: len(k.list()))
sage: P.add(42*x)
sage: P.add(21*x^2)
sage: Q = MutablePoset(key=lambda k: len(k.list()))
sage: Q.add(1111*x)
sage: P, Q
(poset(42*x, 21*x^2), poset(1111*x))
sage: Q.is_subset(P)
True
sage: Q.union(P)
poset(1111*x, 21*x^2)
```
and so on. In principle, I don't see this as a problem---however, I'd state this explicitly in each of these set operation functions. 
- `MutablePoset.mapped`: why is this function needed? Purely for semantical reasons? I'd move the doctests to `MutablePoset.copy`.
- `MutablePosetShell._copy_all_linked_`: is the memoization using the `id` of the object a standard procedure? I thought about it, but I'm not entirely sure that this isn't a potential error source.

Side note: the `MutablePoset` is the central data structure in our AsymptoticExpansions framework (cf. #17601). In this context, the functionality has been tested extensively--and some peculiarities (like the `map`-function etc.) are motivated by this application.

Also, I've made a few reviewer commits concerning the documentation; the branch is attached.

As soon as the points I've raised in the comments above are discussed, this would be a `positive_review` from my side.

Benjamin

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e64cbd80ca50a19544af525b6da681ec7dfe607d"><code>e64cbd8</code></a></td><td><code>mapping argument for .copy()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28749c93a74337e1de987419d5d6e8760c55317"><code>c28749c</code></a></td><td><code>bring map and mapped back to work and use new copy-construction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ceb0b37bc7640f4300962a89eabefe5abc7263d1"><code>ceb0b37</code></a></td><td><code>fix bug in merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/525bf3c334cf2f62a63999cbd5dc687c709a5dea"><code>525bf3c</code></a></td><td><code>Merge branch 'u/dkrenn/asy/mutable-poset' of git://trac.sagemath.org/sage into 6.9.beta5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf1928f7a9ef5eac28a8ed419ef13cb97cfbe806"><code>bf1928f</code></a></td><td><code>remove unused import</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98a7939651645c24263e36c8fca81dc1ba6d9a96"><code>98a7939</code></a></td><td><code>print something --> print(something)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a7ab889e212062323f79c318596d5413ae7e1ea"><code>2a7ab88</code></a></td><td><code>several improvements to documentation (language, structure)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4c43b71c81cc75b152a99d80754c1cb47104613"><code>a4c43b7</code></a></td><td><code>fixed two examples-blocks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a867d3a36f5a068b6e7e3d00f95a5c4331960a6b"><code>a867d3a</code></a></td><td><code>indentation (PEP 8)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8"><code>c1f8877</code></a></td><td><code>improved errors and added two doctests</code></td></tr></table>




---

archive/issue_events_249812.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2015-09-19T17:10:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249812"
}
```



---

archive/issue_events_249813.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2015-09-19T17:10:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249813"
}
```



---

archive/issue_comments_238890.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**",
    "created_at": "2015-09-19T17:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238890",
    "user": "https://github.com/behackl"
}
```

Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**



---

archive/issue_comments_238891.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nBenjamin, please put your name to reviewers-field. Otherwise Volker will reject this.",
    "created_at": "2015-09-19T19:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238891",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:26" align="right">comment:26</div>

Benjamin, please put your name to reviewers-field. Otherwise Volker will reject this.



---

archive/issue_comments_238892.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThanks for the reminder, Jori!\n\nBenjamin",
    "created_at": "2015-09-19T19:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238892",
    "user": "https://github.com/behackl"
}
```

<div id="comment:27" align="right">comment:27</div>

Thanks for the reminder, Jori!

Benjamin



---

archive/issue_comments_238893.json:
```json
{
    "body": "Reviewer: **Benjamin Hackl**",
    "created_at": "2015-09-19T19:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238893",
    "user": "https://github.com/behackl"
}
```

Reviewer: **Benjamin Hackl**



---

archive/issue_comments_238894.json:
```json
{
    "body": "Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**",
    "created_at": "2015-09-21T16:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238894",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**



---

archive/issue_comments_238895.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**",
    "created_at": "2015-09-21T16:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238895",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**



---

archive/issue_comments_238896.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@behackl](#comment:25):\n> - `MutablePoset`, `MutablePosetShell`: derived from `object` vs. `SageObject`?\n\n`object`.\n\n> - `is_null`, `is_oo`: is there some usecase for the `reverse` keyword? For `predecessor` and `successor`: this is clear, as it makes the code easier. However, I think that a `reverse`-keyword for `is_null` and `is_oo` is rather irritating.\n\nKeyword deleted.\n\n> - doctests for `MutablePosetShell.le`: shouldn't doctests like `elem1 <= elem2` be marked as indirect?\n\nYes, I've marked them.\n\n> - `MutablePosetShell._copy_all_linked_`: 1st sentence should be a short description. Likewise for `MutablePosetShell._iter_depth_first_visit_` and `MutablePosetShell._iter_topological_visit_`.\n\nRewritten.\n\n> - sorted_set_by_tuple, is_MutablePoset: are these functions really necessary? Both are only used once within the whole file. The occurrence of `sorted_set_by_tuple` can be easily replaced by\n> \n> ```\n> [...].join(repr(e) for e in sortedshells if e in shell.successors(rev))\n> ```\n> and the occurrence of `is_MutablePoset` can be replaced by a simple `isinstance`-call.\n\n`sorted_set_by_tuple`: Deleted and replaced.\n`is_MutablePoset`: seems to be a standard convention to use it in Sage; see a lot of other modules.\n\n> - `MutablePoset.shells`: I do not understand the usecase of the `reverse` keyword. Can it be removed?\n\nI agree; deleted.\n\n> - `MutablePoset.add`: I think that a comment (in the code) that roughly explains what the passage beginning with  `for reverse in (False, True):` does would be nice. It took me quite some time to understand and verify the functionality of this block.\n\nI've added a comment.\n\n> - `MutablePoset.discard`: why isn't this simply an alias of `MutablePoset.remove`? As `remove` has no return value, `discard` cannot have one either, if that was the intention.\n\nSee Python's set (the same behavior there).\n\n> - Is there a particular reason for naming the parameters for all the set operations like `MutablePoset.union`, `MutablePoset.difference` etc. `left` and `right`, instead of `self` and `other`? IMHO, this disguises that the function can be called as `P.union(Q)`.\n\nChanged all to self/other.\n\n> - Regarding all set operations: currently, it is **not** clear from the documentation that all set operations are performed on the set of keys. This causes something like\n> \n> ```\n> sage: PR.<x> = ZZ[]\n> sage: P = MutablePoset(key=lambda k: len(k.list()))\n> sage: P.add(42*x)\n> sage: P.add(21*x^2)\n> sage: Q = MutablePoset(key=lambda k: len(k.list()))\n> sage: Q.add(1111*x)\n> sage: P, Q\n> (poset(42*x, 21*x^2), poset(1111*x))\n> sage: Q.is_subset(P)\n> True\n> sage: Q.union(P)\n> poset(1111*x, 21*x^2)\n> ```\n> and so on. In principle, I don't see this as a problem---however, I'd state this explicitly in each of these set operation functions.\n\nI've added a note in all these functions.\n\n> - `MutablePoset.mapped`: why is this function needed? Purely for semantical reasons? I'd move the doctests to `MutablePoset.copy`.\n\nIt is a shortcut for using copy with the mapping argument (since this is a non-standard argument for a copy method, including a separate method with an approriate name seems to be a good choice)\n\n> - `MutablePosetShell._copy_all_linked_`: is the memoization using the `id` of the object a standard procedure? I thought about it, but I'm not entirely sure that this isn't a potential error source.\n\nYes it is standard; see (all) deepcopy routines.\n\n> Also, I've made a few reviewer commits concerning the documentation; the branch is attached.\n\nCross-reviewed. Thanks.",
    "created_at": "2015-09-21T16:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238896",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@behackl](#comment:25):
> - `MutablePoset`, `MutablePosetShell`: derived from `object` vs. `SageObject`?

`object`.

> - `is_null`, `is_oo`: is there some usecase for the `reverse` keyword? For `predecessor` and `successor`: this is clear, as it makes the code easier. However, I think that a `reverse`-keyword for `is_null` and `is_oo` is rather irritating.

Keyword deleted.

> - doctests for `MutablePosetShell.le`: shouldn't doctests like `elem1 <= elem2` be marked as indirect?

Yes, I've marked them.

> - `MutablePosetShell._copy_all_linked_`: 1st sentence should be a short description. Likewise for `MutablePosetShell._iter_depth_first_visit_` and `MutablePosetShell._iter_topological_visit_`.

Rewritten.

> - sorted_set_by_tuple, is_MutablePoset: are these functions really necessary? Both are only used once within the whole file. The occurrence of `sorted_set_by_tuple` can be easily replaced by
> 
> ```
> [...].join(repr(e) for e in sortedshells if e in shell.successors(rev))
> ```
> and the occurrence of `is_MutablePoset` can be replaced by a simple `isinstance`-call.

`sorted_set_by_tuple`: Deleted and replaced.
`is_MutablePoset`: seems to be a standard convention to use it in Sage; see a lot of other modules.

> - `MutablePoset.shells`: I do not understand the usecase of the `reverse` keyword. Can it be removed?

I agree; deleted.

> - `MutablePoset.add`: I think that a comment (in the code) that roughly explains what the passage beginning with  `for reverse in (False, True):` does would be nice. It took me quite some time to understand and verify the functionality of this block.

I've added a comment.

> - `MutablePoset.discard`: why isn't this simply an alias of `MutablePoset.remove`? As `remove` has no return value, `discard` cannot have one either, if that was the intention.

See Python's set (the same behavior there).

> - Is there a particular reason for naming the parameters for all the set operations like `MutablePoset.union`, `MutablePoset.difference` etc. `left` and `right`, instead of `self` and `other`? IMHO, this disguises that the function can be called as `P.union(Q)`.

Changed all to self/other.

> - Regarding all set operations: currently, it is **not** clear from the documentation that all set operations are performed on the set of keys. This causes something like
> 
> ```
> sage: PR.<x> = ZZ[]
> sage: P = MutablePoset(key=lambda k: len(k.list()))
> sage: P.add(42*x)
> sage: P.add(21*x^2)
> sage: Q = MutablePoset(key=lambda k: len(k.list()))
> sage: Q.add(1111*x)
> sage: P, Q
> (poset(42*x, 21*x^2), poset(1111*x))
> sage: Q.is_subset(P)
> True
> sage: Q.union(P)
> poset(1111*x, 21*x^2)
> ```
> and so on. In principle, I don't see this as a problem---however, I'd state this explicitly in each of these set operation functions.

I've added a note in all these functions.

> - `MutablePoset.mapped`: why is this function needed? Purely for semantical reasons? I'd move the doctests to `MutablePoset.copy`.

It is a shortcut for using copy with the mapping argument (since this is a non-standard argument for a copy method, including a separate method with an approriate name seems to be a good choice)

> - `MutablePosetShell._copy_all_linked_`: is the memoization using the `id` of the object a standard procedure? I thought about it, but I'm not entirely sure that this isn't a potential error source.

Yes it is standard; see (all) deepcopy routines.

> Also, I've made a few reviewer commits concerning the documentation; the branch is attached.

Cross-reviewed. Thanks.



---

archive/issue_events_249814.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-21T16:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249814"
}
```



---

archive/issue_events_249815.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-21T16:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249815"
}
```



---

archive/issue_comments_238897.json:
```json
{
    "body": "Changed commit from **[`c1f8877`](https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8)** to **[`1d52f6c`](https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110)**",
    "created_at": "2015-09-21T16:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238897",
    "user": "https://github.com/dkrenn"
}
```

Changed commit from **[`c1f8877`](https://github.com/sagemath/sagetrac-mirror/commit/c1f8877b7dcea0e1c677d350d7f5d41be02169c8)** to **[`1d52f6c`](https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110)**



---

archive/issue_comments_238898.json:
```json
{
    "body": "Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**",
    "created_at": "2015-09-21T16:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238898",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**



---

archive/issue_comments_238899.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39ae466eea0e2daae13d78b23aa74ddaee687b81\"><code>39ae466</code></a></td><td><code>correct oo, null</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd7c881001b0dc480e596e61578aa87afa80e638\"><code>fd7c881</code></a></td><td><code>Applies --> Apply in one-line of docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dabad1f4c953f9a4e0f973f2ee7c46cbb0d15752\"><code>dabad1f</code></a></td><td><code>remove reverse in is_{null|oo} since not needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33c410238a9352d08b5634a60b6ed30b8f0d3aad\"><code>33c4102</code></a></td><td><code>mark doctests in .le as indirect</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b31fac80d649c8351e20d90dfdff39d28c91d21f\"><code>b31fac8</code></a></td><td><code>rewrite a couple of one-line descriptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17e921ffeb31ed529f9686ed5c54d48e36b248cf\"><code>17e921f</code></a></td><td><code>remove sorted_set_by_tuple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7af4b6bf109a4eeb1f09a386ecbf5cdeb51a0cbe\"><code>7af4b6b</code></a></td><td><code>remove reverse keyword from shells</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a49a20db5ec0d19d50621de6286ddc11e737735f\"><code>a49a20d</code></a></td><td><code>add comment in code to make it clear what happens</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b82093fecc685245c824ab9284a67c198be50f\"><code>89b8209</code></a></td><td><code>change left/right to self/other</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110\"><code>1d52f6c</code></a></td><td><code>add a note to the set operations methods</code></td></tr></table>\n",
    "created_at": "2015-09-21T16:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238899",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:31" align="right">comment:31</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39ae466eea0e2daae13d78b23aa74ddaee687b81"><code>39ae466</code></a></td><td><code>correct oo, null</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd7c881001b0dc480e596e61578aa87afa80e638"><code>fd7c881</code></a></td><td><code>Applies --> Apply in one-line of docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dabad1f4c953f9a4e0f973f2ee7c46cbb0d15752"><code>dabad1f</code></a></td><td><code>remove reverse in is_{null|oo} since not needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33c410238a9352d08b5634a60b6ed30b8f0d3aad"><code>33c4102</code></a></td><td><code>mark doctests in .le as indirect</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b31fac80d649c8351e20d90dfdff39d28c91d21f"><code>b31fac8</code></a></td><td><code>rewrite a couple of one-line descriptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17e921ffeb31ed529f9686ed5c54d48e36b248cf"><code>17e921f</code></a></td><td><code>remove sorted_set_by_tuple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7af4b6bf109a4eeb1f09a386ecbf5cdeb51a0cbe"><code>7af4b6b</code></a></td><td><code>remove reverse keyword from shells</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a49a20db5ec0d19d50621de6286ddc11e737735f"><code>a49a20d</code></a></td><td><code>add comment in code to make it clear what happens</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b82093fecc685245c824ab9284a67c198be50f"><code>89b8209</code></a></td><td><code>change left/right to self/other</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110"><code>1d52f6c</code></a></td><td><code>add a note to the set operations methods</code></td></tr></table>




---

archive/issue_comments_238900.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHello Daniel,\n\nI cross-reviewed your changes and have one last open question:\n- Is there a particular reason for deriving this from `object` instead of `SageObject`? Because [the documentation of SageObject](http://doc.sagemath.org/html/en/reference/structure/sage/structure/sage_object.html) states that \"Every object that can end up being returned to the user should inherit from SageObject.\"\n\nOther than that, this is `positive_review` from my side; AFAIK [cheuberg](#comment:9) also wanted to cross-review this ticket, so I'll not set this to `positive_review` yet.\n\nBenjamin",
    "created_at": "2015-09-21T17:53:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238900",
    "user": "https://github.com/behackl"
}
```

<div id="comment:32" align="right">comment:32</div>

Hello Daniel,

I cross-reviewed your changes and have one last open question:
- Is there a particular reason for deriving this from `object` instead of `SageObject`? Because [the documentation of SageObject](http://doc.sagemath.org/html/en/reference/structure/sage/structure/sage_object.html) states that "Every object that can end up being returned to the user should inherit from SageObject."

Other than that, this is `positive_review` from my side; AFAIK [cheuberg](#comment:9) also wanted to cross-review this ticket, so I'll not set this to `positive_review` yet.

Benjamin



---

archive/issue_comments_238901.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@behackl](#comment:32):\n> - Is there a particular reason for deriving this from `object` instead of `SageObject`? Because [the documentation of SageObject](http://doc.sagemath.org/html/en/reference/structure/sage/structure/sage_object.html) states that \"Every object that can end up being returned to the user should inherit from SageObject.\"\n\nOk, then `SageObject` it is :)",
    "created_at": "2015-09-22T10:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238901",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@behackl](#comment:32):
> - Is there a particular reason for deriving this from `object` instead of `SageObject`? Because [the documentation of SageObject](http://doc.sagemath.org/html/en/reference/structure/sage/structure/sage_object.html) states that "Every object that can end up being returned to the user should inherit from SageObject."

Ok, then `SageObject` it is :)



---

archive/issue_comments_238902.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nA short remark on this change of mind:\n\nWhen deriving these classes from `SageObject` instead of `object`, and merging this ticket into #19083 (the cleanup-ticket of our `AsymptoticRing`), doctests were failing because we call `A(poset)` with an `AsymptoticRing` `A` there, which causes some peculiarities in `_coerce_map_from_`.\n\nIn any case, we fixed these problems there, so this can be properly derived from `SageObject`.\n\nThis concludes my review; [cheuberg](#comment:8) is in the process of reading the code. I'll leave setting this to `positive_review` to him.\n\nBenjamin\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd7c881001b0dc480e596e61578aa87afa80e638\"><code>fd7c881</code></a></td><td><code>Applies --> Apply in one-line of docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dabad1f4c953f9a4e0f973f2ee7c46cbb0d15752\"><code>dabad1f</code></a></td><td><code>remove reverse in is_{null|oo} since not needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33c410238a9352d08b5634a60b6ed30b8f0d3aad\"><code>33c4102</code></a></td><td><code>mark doctests in .le as indirect</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b31fac80d649c8351e20d90dfdff39d28c91d21f\"><code>b31fac8</code></a></td><td><code>rewrite a couple of one-line descriptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17e921ffeb31ed529f9686ed5c54d48e36b248cf\"><code>17e921f</code></a></td><td><code>remove sorted_set_by_tuple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7af4b6bf109a4eeb1f09a386ecbf5cdeb51a0cbe\"><code>7af4b6b</code></a></td><td><code>remove reverse keyword from shells</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a49a20db5ec0d19d50621de6286ddc11e737735f\"><code>a49a20d</code></a></td><td><code>add comment in code to make it clear what happens</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b82093fecc685245c824ab9284a67c198be50f\"><code>89b8209</code></a></td><td><code>change left/right to self/other</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110\"><code>1d52f6c</code></a></td><td><code>add a note to the set operations methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca\"><code>3b3b2fb</code></a></td><td><code>object --> SageObject</code></td></tr></table>\n",
    "created_at": "2015-09-22T11:34:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238902",
    "user": "https://github.com/behackl"
}
```

<div id="comment:34" align="right">comment:34</div>

A short remark on this change of mind:

When deriving these classes from `SageObject` instead of `object`, and merging this ticket into #19083 (the cleanup-ticket of our `AsymptoticRing`), doctests were failing because we call `A(poset)` with an `AsymptoticRing` `A` there, which causes some peculiarities in `_coerce_map_from_`.

In any case, we fixed these problems there, so this can be properly derived from `SageObject`.

This concludes my review; [cheuberg](#comment:8) is in the process of reading the code. I'll leave setting this to `positive_review` to him.

Benjamin

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd7c881001b0dc480e596e61578aa87afa80e638"><code>fd7c881</code></a></td><td><code>Applies --> Apply in one-line of docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dabad1f4c953f9a4e0f973f2ee7c46cbb0d15752"><code>dabad1f</code></a></td><td><code>remove reverse in is_{null|oo} since not needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33c410238a9352d08b5634a60b6ed30b8f0d3aad"><code>33c4102</code></a></td><td><code>mark doctests in .le as indirect</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b31fac80d649c8351e20d90dfdff39d28c91d21f"><code>b31fac8</code></a></td><td><code>rewrite a couple of one-line descriptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17e921ffeb31ed529f9686ed5c54d48e36b248cf"><code>17e921f</code></a></td><td><code>remove sorted_set_by_tuple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7af4b6bf109a4eeb1f09a386ecbf5cdeb51a0cbe"><code>7af4b6b</code></a></td><td><code>remove reverse keyword from shells</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a49a20db5ec0d19d50621de6286ddc11e737735f"><code>a49a20d</code></a></td><td><code>add comment in code to make it clear what happens</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b82093fecc685245c824ab9284a67c198be50f"><code>89b8209</code></a></td><td><code>change left/right to self/other</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110"><code>1d52f6c</code></a></td><td><code>add a note to the set operations methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca"><code>3b3b2fb</code></a></td><td><code>object --> SageObject</code></td></tr></table>




---

archive/issue_comments_238903.json:
```json
{
    "body": "Changed commit from **[`1d52f6c`](https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110)** to **[`3b3b2fb`](https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca)**",
    "created_at": "2015-09-22T11:34:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238903",
    "user": "https://github.com/behackl"
}
```

Changed commit from **[`1d52f6c`](https://github.com/sagemath/sagetrac-mirror/commit/1d52f6c6351e6eb9e92c6033b12e09c4754b8110)** to **[`3b3b2fb`](https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca)**



---

archive/issue_comments_238904.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**",
    "created_at": "2015-09-22T11:34:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238904",
    "user": "https://github.com/behackl"
}
```

Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)**



---

archive/issue_comments_238905.json:
```json
{
    "body": "Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**",
    "created_at": "2015-09-23T08:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238905",
    "user": "https://github.com/cheuberg"
}
```

Changed branch from **[u/behackl/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/behackl/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**



---

archive/issue_events_249816.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-23T08:48:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249816"
}
```



---

archive/issue_events_249817.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-23T08:48:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249817"
}
```



---

archive/issue_comments_238906.json:
```json
{
    "body": "Changed reviewer from **Benjamin Hackl** to **Benjamin Hackl, Clemens Heuberger**",
    "created_at": "2015-09-23T08:48:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238906",
    "user": "https://github.com/cheuberg"
}
```

Changed reviewer from **Benjamin Hackl** to **Benjamin Hackl, Clemens Heuberger**



---

archive/issue_events_249818.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-23T08:48:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249818"
}
```



---

archive/issue_events_249819.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-23T08:48:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249819"
}
```



---

archive/issue_comments_238907.json:
```json
{
    "body": "Changed commit from **[`3b3b2fb`](https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca)** to **[`f7bce7e`](https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5)**",
    "created_at": "2015-09-23T08:48:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238907",
    "user": "https://github.com/cheuberg"
}
```

Changed commit from **[`3b3b2fb`](https://github.com/sagemath/sagetrac-mirror/commit/3b3b2fb607a6fe8b20419170bf935d494af1efca)** to **[`f7bce7e`](https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5)**



---

archive/issue_comments_238908.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@behackl](#comment:34):\n> This concludes my review; [cheuberg](#comment:8) is in the process of reading the code. I'll leave setting this to `positive_review` to him.\n\nI read the documentation and the code. I pushed a few reviewer commits. I have a number of rather minor issues with the documentation which I ask you to fix in order facilitate future maintainance of the code. In three instances, I propose alternative implementations, which might be more readable or slightly more efficient.\n\n1. Please add `.. seealso::` blocks between corresponding methods of shell and poset as well as between the accessor methods (keys, elements, shells)\n2. there is an empty \"Introduction\" section at the beginning of the module documentation, the next heading \"Example\" is on the same level.\n3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the \"experimental\" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.\n4. `MutablePoset.__init__` accepts a list of elements. This could be used in several doctests (in particular, in the set operations) as an abbreviation.\n5. `MutablePosetShell.__init__`: shall we check that `element is not None`? Otherwise, handling of special elements would probably be affected.\n6. `MutablePosetShell.key`: I do not understand the sentence \"The element is converted by the poset to the key\".\n7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.\n8. `MutablePosetShell.__repr__`: The note box in the docstring is surprising at this point: reading the source file from the top, this is the first point where the representation of the data is explained, after guessing it from `is_special`, `is_oo`, `is_null` above. I think that it would be better to document these conventions closer to the top, perhaps in the `__init__` method or perhaps only as a comment in the source code.\n9. `MutablePosetShell.__repr__`: The code replicates the behaviour of `is_null` and `is_oo`. As the `__repr__` method is hardly time critical, I'd prefer using `is_null` and `is_oo`, here and thus hiding the internal convention.\n10. `MutablePosetShell.le`: the note box could be simplified by suppressing implementation details and speaking about the special elements.\n21. `MutablePosetShell.le`: `right <= left`: neither `right` nor `left` are defined here.\n32. `MutablePosetShell.le`: the part `if other.element is None` could be simplified to `return not other.successors()` as `self` is already known not to be special here.\n43. `MutablePosetShell.le`: If this is time critical, `self._predecessors_` could be used instead of `self.predecessors()`.\n54. `MutablePosetShell.eq`: note box, see above.\n65. `MutablePosetShell.eq`: emphasize that elements with equal keys are considered equal? Currently, this information is somewhat hidden in the note box which at first glance only seems to explain handling of special elements.\n76. `MutablePosetShell._copy_all_linked_`: Short description: \"Return a copy of all shells\" does not correspond to the actual return value, which is only the copy of this shell.\n87. `MutablePosetShell._copy_all_linked_`: the interplay between this method and `MutablePoset._copy_shells_` is not well documented: in particular, `poset` in `_copy_all_linked_` is *only* used for setting the containing poset, but not for actual inserting into this poset.\n98. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`. So `oo is Q.oo` would be more interesting? The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?\n109. `MutablePosetShell._search_covers_`: what is the role of `self` in this method? It trivially influences the return value, but what else?\n20. `MutablePosetShell._search_covers_`: The explanation of the return value is unclear to me. Is the sentence \"Note that...\" meant to be a complete description? Does it change if `reverse` is set?\n21. `MutablePosetShell._search_covers_`: I think that the notions of \"upper cover\" and \"lower cover\" need a brief definition; I did not find them in Wikipedia and `sage.combinat.posets.posets.FinitePoset.upper_covers` defines the notion.\n22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.\n23. `MutablePosetShell._search_covers_`: what is the difference between this method and `.predecessors`? Is the shell necessarily an element of the poset? If not, then there should be a doctest covering this case.\n24. `MutablePosetShell.covers`: \"originate\" is somewhat foreign to the description of the poset.\n25. `MutablePosetShell.covers`: \"which are at most the given shell\": should that be \"which are less than the given shell\"?\n26. `MutablePosetShell.covers` see comments on `MutablePosetShell._search_covers_`.\n27. `MutablePosetShell.covers`: I think that the following would be an equivalent implementation of this method, which does not need a helper function with side effects.\n\n```\n        if self == shell:\n            return set()\n        covers = set().union(*(e.covers(shell, reverse)\n                               for e in self.successors(reverse)\n                               if e.le(shell, reverse)))\n        if covers:\n            return covers\n        else:\n            return set([self])\n```\n  (pushed as branch `u/cheuberg/asy/mutable-poset-cover`)\n28. `MutablePosetShell._iter_depth_first_visit_`: document the role of self in this method (only shells `>=` this shell are visited).\n29. `MutablePosetShell.iter_depth_first`: document the role of self in this method (only shells `>=` this shell are visited).\n30. `MutablePosetShell._iter_topological_visit_`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).\n31. `MutablePosetShell.iter_topological_first`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).\n32. `MutablePosetShell.iter_topological_sort`, last example: function `C` is defined, but not used.\n33. `MutablePosetShell.merge`: explain what merge is, in particular, that this is defined when constructing the poset.\n34. `MutablePosetShell.merge`: I am surprised that `check=True` leads to a silent failure instead of an exception and that `poset._merge_ is None` does not raise an exception. Document and test this behaviour?\n35. `MutablePosetShell.merge`: what is the difference between `poset.remove` and `poset.discard`?\n36. `MutablePosetShell.merge`: document that the merge function resulting in `None` leads to deletion of the element.\n37. `MutablePosetShell.merge`: document that the merge function must not change the position of the element in the poset.\n38. `MutablePoset.__init__`: Clarify the role of `key`: in particular, `key` does not only influence sorting, but that no two elements are allowed to have the same key.\n39. `MutablePoset.__len__`: Clarify that `null` and `oo` are not counted.\n40. `MutablePoset.shells_topological`: The sentence \"If this is None, no sorting according to the representation string occurs.\" is unclear to me, in particular the role of the representation string.\n41. `MutablePoset.keys_topological`: Due to the chosen key, some of the elements added to the poset are ignored. I do not know why this is demonstrated here.\n42. `MutablePoset.repr`: INPUT section is incomplete.\n43. `MutablePoset.repr_full`: INPUT section is incomplete.\n44. `MutablePoset.add`: the loop `for reverse in (False, True)` simplifies in the second iteration: as all pairs of elements `(s, l)` with `new` covering `s` and `l` covering `new` have already been broken up while `reverse=False`. Thus it might be more straightforward to do it only once, not using `reverse` at all and saving a few intersections:\n\n```\n        new._predecessors_ = self.null.covers(new, reverse=False)\n        new._successors_ = self.oo.covers(new, reverse=True)\n\n        for s in new.predecessors():\n            for l in s.successors().intersection(new.successors()):\n                l.predecessors().remove(s)\n                s.successors().remove(l)\n            s.successors().add(new)\n        for l in new.successors():\n            l.predecessors().add(new)\n```\n  (pushed as branch `u/cheuberg/asy/mutable-poset-add`)\n45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:\n\n```\n        for upper in shell.successors():\n            upper.predecessors().remove(shell)\n\n        for lower in shell.predecessors():\n            lower.successors().remove(shell)\n            for upper in shell.successors():\n                if not any(s <= upper \n                           for s in lower.successors()):\n                    lower.successors().add(upper)\n                    upper.predecessors().add(lower)\n```\n  (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)\n46. `MutablePoset.remove`, `MutablePoset.discard`: add \"see also blocks\", but also an explanation of the difference between `discard` and `remove`. I guess that both methods are available due to some compatibility concern (in that case, please add a remark in the code or the docstring). Otherwise, I'd suggest removing `discard`, removing the parameter `raise_key_error` and let the user catch the exception.\n47. `MutablePoset.pop`: remove `key=lambda c: -c` from this example as it is not pertinent to `pop`.\n48. `MutablePoset.pop`: mention that special elements cannot be popped.\n49. `MutablePoset.pop`: IMHO you can remove the first four line (the `try:` block deleting `kwargs['include_special']`) because setting `kwargs['include_special'] = False` should result in the same result.\n50. `MutablePoset.union`: The doctest `P.union(P, Q, Q, P)` neither fits the description \"a poset\" or \"an iterable of future elements\".\n51. `MutablePoset.union`: the word \"union\" sounds symmetric, however, due to keys and merge functions, it might not be commutative. The note box is not helpful for me.\n52. `MutablePoset.union`: the TODO box from `union_update` also applies here.\n53. `MutablePoset.union_update`: why is the semantics of `other` different w.r.t `union`, but has the same description? It would seem more logical to me if `union` would simply call copy and then pass its argument to `update_union` and let the latter function sort out the iterators?\n54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`\n55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`\n56. `MutablePoset.intersection_update`: how can the `AttributeError` occur? After all, `self` is a `MutablePoset`, so the method `keys` will be available unless something very strange happens ...\n57. `MutablePoset.merge`: documentation of `reverse`: what is the default direction?\n58. `MutablePoset.merge`: add doctest for `RuntimeError`.\n59. `MutablePoset.merge`: document that `can_merge` is applied in the sense of the condition of depth first iteration, i.e., once `can_merge` fails, the successors are no longer tested. This is some kind of monotonicity condition on `can_merge`.\n60. `MutablePoset.merge`: it should be mentioned somewhere that this (at first sight strange) merge magic is motivated by asymptotic expansions.\n61. `MutablePoset.map`: IMHO the example does alter the keys, because the key was the identity map here.\n62. `MutablePoset.mapping`: does the map have to be key preserving as in the method `map`? Is this method actually needed, see also the recent discussion on inplace vs. non-inplace operations on sage-devel?\n  \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8de4188efff6b534e881dbe8e7071f026f47a317\"><code>8de4188</code></a></td><td><code>Trac #17693: minor language adjustments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/740852e2897cfb1e4903150f110c8c242ba153f3\"><code>740852e</code></a></td><td><code>Trac #17693: command instead of description for short descriptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/347656c7dec2fef3ed8f43c5f24e5ade977b35f3\"><code>347656c</code></a></td><td><code>Trac #17693: language adjustment: whether instead of if</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4774baac95a8490280253fc3de41a12c896fc6b4\"><code>4774baa</code></a></td><td><code>Trac #17693: corrections in documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe5d2f1dec3f35eeaf2a4e525e4fe3e9807d17a7\"><code>fe5d2f1</code></a></td><td><code>Trac #17693: additional doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4f1fea624a794d32d2e3380a8eb42ee6888af4f\"><code>e4f1fea</code></a></td><td><code>Trac #17693: fix indentations and whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/254951dad86ad94fa55c91f3f811497614490493\"><code>254951d</code></a></td><td><code>Trac #17693: add keyword in doctest for clarity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5\"><code>f7bce7e</code></a></td><td><code>Trac #17693: remove superfluous doctest</code></td></tr></table>\n",
    "created_at": "2015-09-23T08:48:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238908",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@behackl](#comment:34):
> This concludes my review; [cheuberg](#comment:8) is in the process of reading the code. I'll leave setting this to `positive_review` to him.

I read the documentation and the code. I pushed a few reviewer commits. I have a number of rather minor issues with the documentation which I ask you to fix in order facilitate future maintainance of the code. In three instances, I propose alternative implementations, which might be more readable or slightly more efficient.

1. Please add `.. seealso::` blocks between corresponding methods of shell and poset as well as between the accessor methods (keys, elements, shells)
2. there is an empty "Introduction" section at the beginning of the module documentation, the next heading "Example" is on the same level.
3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the "experimental" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.
4. `MutablePoset.__init__` accepts a list of elements. This could be used in several doctests (in particular, in the set operations) as an abbreviation.
5. `MutablePosetShell.__init__`: shall we check that `element is not None`? Otherwise, handling of special elements would probably be affected.
6. `MutablePosetShell.key`: I do not understand the sentence "The element is converted by the poset to the key".
7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.
8. `MutablePosetShell.__repr__`: The note box in the docstring is surprising at this point: reading the source file from the top, this is the first point where the representation of the data is explained, after guessing it from `is_special`, `is_oo`, `is_null` above. I think that it would be better to document these conventions closer to the top, perhaps in the `__init__` method or perhaps only as a comment in the source code.
9. `MutablePosetShell.__repr__`: The code replicates the behaviour of `is_null` and `is_oo`. As the `__repr__` method is hardly time critical, I'd prefer using `is_null` and `is_oo`, here and thus hiding the internal convention.
10. `MutablePosetShell.le`: the note box could be simplified by suppressing implementation details and speaking about the special elements.
21. `MutablePosetShell.le`: `right <= left`: neither `right` nor `left` are defined here.
32. `MutablePosetShell.le`: the part `if other.element is None` could be simplified to `return not other.successors()` as `self` is already known not to be special here.
43. `MutablePosetShell.le`: If this is time critical, `self._predecessors_` could be used instead of `self.predecessors()`.
54. `MutablePosetShell.eq`: note box, see above.
65. `MutablePosetShell.eq`: emphasize that elements with equal keys are considered equal? Currently, this information is somewhat hidden in the note box which at first glance only seems to explain handling of special elements.
76. `MutablePosetShell._copy_all_linked_`: Short description: "Return a copy of all shells" does not correspond to the actual return value, which is only the copy of this shell.
87. `MutablePosetShell._copy_all_linked_`: the interplay between this method and `MutablePoset._copy_shells_` is not well documented: in particular, `poset` in `_copy_all_linked_` is *only* used for setting the containing poset, but not for actual inserting into this poset.
98. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`. So `oo is Q.oo` would be more interesting? The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?
109. `MutablePosetShell._search_covers_`: what is the role of `self` in this method? It trivially influences the return value, but what else?
20. `MutablePosetShell._search_covers_`: The explanation of the return value is unclear to me. Is the sentence "Note that..." meant to be a complete description? Does it change if `reverse` is set?
21. `MutablePosetShell._search_covers_`: I think that the notions of "upper cover" and "lower cover" need a brief definition; I did not find them in Wikipedia and `sage.combinat.posets.posets.FinitePoset.upper_covers` defines the notion.
22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.
23. `MutablePosetShell._search_covers_`: what is the difference between this method and `.predecessors`? Is the shell necessarily an element of the poset? If not, then there should be a doctest covering this case.
24. `MutablePosetShell.covers`: "originate" is somewhat foreign to the description of the poset.
25. `MutablePosetShell.covers`: "which are at most the given shell": should that be "which are less than the given shell"?
26. `MutablePosetShell.covers` see comments on `MutablePosetShell._search_covers_`.
27. `MutablePosetShell.covers`: I think that the following would be an equivalent implementation of this method, which does not need a helper function with side effects.

```
        if self == shell:
            return set()
        covers = set().union(*(e.covers(shell, reverse)
                               for e in self.successors(reverse)
                               if e.le(shell, reverse)))
        if covers:
            return covers
        else:
            return set([self])
```
  (pushed as branch `u/cheuberg/asy/mutable-poset-cover`)
28. `MutablePosetShell._iter_depth_first_visit_`: document the role of self in this method (only shells `>=` this shell are visited).
29. `MutablePosetShell.iter_depth_first`: document the role of self in this method (only shells `>=` this shell are visited).
30. `MutablePosetShell._iter_topological_visit_`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).
31. `MutablePosetShell.iter_topological_first`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).
32. `MutablePosetShell.iter_topological_sort`, last example: function `C` is defined, but not used.
33. `MutablePosetShell.merge`: explain what merge is, in particular, that this is defined when constructing the poset.
34. `MutablePosetShell.merge`: I am surprised that `check=True` leads to a silent failure instead of an exception and that `poset._merge_ is None` does not raise an exception. Document and test this behaviour?
35. `MutablePosetShell.merge`: what is the difference between `poset.remove` and `poset.discard`?
36. `MutablePosetShell.merge`: document that the merge function resulting in `None` leads to deletion of the element.
37. `MutablePosetShell.merge`: document that the merge function must not change the position of the element in the poset.
38. `MutablePoset.__init__`: Clarify the role of `key`: in particular, `key` does not only influence sorting, but that no two elements are allowed to have the same key.
39. `MutablePoset.__len__`: Clarify that `null` and `oo` are not counted.
40. `MutablePoset.shells_topological`: The sentence "If this is None, no sorting according to the representation string occurs." is unclear to me, in particular the role of the representation string.
41. `MutablePoset.keys_topological`: Due to the chosen key, some of the elements added to the poset are ignored. I do not know why this is demonstrated here.
42. `MutablePoset.repr`: INPUT section is incomplete.
43. `MutablePoset.repr_full`: INPUT section is incomplete.
44. `MutablePoset.add`: the loop `for reverse in (False, True)` simplifies in the second iteration: as all pairs of elements `(s, l)` with `new` covering `s` and `l` covering `new` have already been broken up while `reverse=False`. Thus it might be more straightforward to do it only once, not using `reverse` at all and saving a few intersections:

```
        new._predecessors_ = self.null.covers(new, reverse=False)
        new._successors_ = self.oo.covers(new, reverse=True)

        for s in new.predecessors():
            for l in s.successors().intersection(new.successors()):
                l.predecessors().remove(s)
                s.successors().remove(l)
            s.successors().add(new)
        for l in new.successors():
            l.predecessors().add(new)
```
  (pushed as branch `u/cheuberg/asy/mutable-poset-add`)
45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:

```
        for upper in shell.successors():
            upper.predecessors().remove(shell)

        for lower in shell.predecessors():
            lower.successors().remove(shell)
            for upper in shell.successors():
                if not any(s <= upper 
                           for s in lower.successors()):
                    lower.successors().add(upper)
                    upper.predecessors().add(lower)
```
  (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)
46. `MutablePoset.remove`, `MutablePoset.discard`: add "see also blocks", but also an explanation of the difference between `discard` and `remove`. I guess that both methods are available due to some compatibility concern (in that case, please add a remark in the code or the docstring). Otherwise, I'd suggest removing `discard`, removing the parameter `raise_key_error` and let the user catch the exception.
47. `MutablePoset.pop`: remove `key=lambda c: -c` from this example as it is not pertinent to `pop`.
48. `MutablePoset.pop`: mention that special elements cannot be popped.
49. `MutablePoset.pop`: IMHO you can remove the first four line (the `try:` block deleting `kwargs['include_special']`) because setting `kwargs['include_special'] = False` should result in the same result.
50. `MutablePoset.union`: The doctest `P.union(P, Q, Q, P)` neither fits the description "a poset" or "an iterable of future elements".
51. `MutablePoset.union`: the word "union" sounds symmetric, however, due to keys and merge functions, it might not be commutative. The note box is not helpful for me.
52. `MutablePoset.union`: the TODO box from `union_update` also applies here.
53. `MutablePoset.union_update`: why is the semantics of `other` different w.r.t `union`, but has the same description? It would seem more logical to me if `union` would simply call copy and then pass its argument to `update_union` and let the latter function sort out the iterators?
54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`
55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`
56. `MutablePoset.intersection_update`: how can the `AttributeError` occur? After all, `self` is a `MutablePoset`, so the method `keys` will be available unless something very strange happens ...
57. `MutablePoset.merge`: documentation of `reverse`: what is the default direction?
58. `MutablePoset.merge`: add doctest for `RuntimeError`.
59. `MutablePoset.merge`: document that `can_merge` is applied in the sense of the condition of depth first iteration, i.e., once `can_merge` fails, the successors are no longer tested. This is some kind of monotonicity condition on `can_merge`.
60. `MutablePoset.merge`: it should be mentioned somewhere that this (at first sight strange) merge magic is motivated by asymptotic expansions.
61. `MutablePoset.map`: IMHO the example does alter the keys, because the key was the identity map here.
62. `MutablePoset.mapping`: does the map have to be key preserving as in the method `map`? Is this method actually needed, see also the recent discussion on inplace vs. non-inplace operations on sage-devel?
  
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8de4188efff6b534e881dbe8e7071f026f47a317"><code>8de4188</code></a></td><td><code>Trac #17693: minor language adjustments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/740852e2897cfb1e4903150f110c8c242ba153f3"><code>740852e</code></a></td><td><code>Trac #17693: command instead of description for short descriptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/347656c7dec2fef3ed8f43c5f24e5ade977b35f3"><code>347656c</code></a></td><td><code>Trac #17693: language adjustment: whether instead of if</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4774baac95a8490280253fc3de41a12c896fc6b4"><code>4774baa</code></a></td><td><code>Trac #17693: corrections in documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe5d2f1dec3f35eeaf2a4e525e4fe3e9807d17a7"><code>fe5d2f1</code></a></td><td><code>Trac #17693: additional doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4f1fea624a794d32d2e3380a8eb42ee6888af4f"><code>e4f1fea</code></a></td><td><code>Trac #17693: fix indentations and whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/254951dad86ad94fa55c91f3f811497614490493"><code>254951d</code></a></td><td><code>Trac #17693: add keyword in doctest for clarity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5"><code>f7bce7e</code></a></td><td><code>Trac #17693: remove superfluous doctest</code></td></tr></table>




---

archive/issue_comments_238909.json:
```json
{
    "body": "Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**",
    "created_at": "2015-09-28T09:10:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238909",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**



---

archive/issue_comments_238910.json:
```json
{
    "body": "Changed commit from **[`f7bce7e`](https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5)** to **[`3c69f6b`](https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e)**",
    "created_at": "2015-09-28T12:25:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238910",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f7bce7e`](https://github.com/sagemath/sagetrac-mirror/commit/f7bce7e8aff4e25a23b57d1052ff13df302120e5)** to **[`3c69f6b`](https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e)**



---

archive/issue_comments_238911.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34e34dca5609d9b5ff4bb90247fa412d014dbd49\"><code>34e34dc</code></a></td><td><code>Trac #17693, comment 36, 19--23: improve docstring of covers (former `_search_covers_`)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/490c2236b3ba38a125986c0cd5c4669f92911917\"><code>490c223</code></a></td><td><code>Trac #17693, comment 36, 28--31: document role of self</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3de0a1d250a07c902295ff6199b9995e3fd19849\"><code>3de0a1d</code></a></td><td><code>Trac #17693, comment 36, 33: explicitly mention merge and can_merge at top of docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/485b46f4f2203885ee22469c3b237e67a605bc21\"><code>485b46f</code></a></td><td><code>Trac #17693, comment 36, 34: raise exceptions when merge is not possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6bec7548d7c2ab961a31d70e96211cb572d2e\"><code>d5d6bec</code></a></td><td><code>check=False in MutablePoset.merge since checked already before</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6da3db12035b5b4904dd7ba25082140c17023fa6\"><code>6da3db1</code></a></td><td><code>Trac #17693, comment 36, 37: extend doc to mention more explicitly that merge is not allowed to change keys</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1e9f9e8224c4e78944c57f3ca9c4b73a2f96d83\"><code>f1e9f9e</code></a></td><td><code>Trac #17693, comment 36, 38: clarify parameter key</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae0cad989dd4e5dddc9bf2218280fab131db2c85\"><code>ae0cad9</code></a></td><td><code>Trac #17693, comment 36, 60: mention motivation asymptoic expansions in merge method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec15597efaf476e4d1cc822877e77a3ec740d78d\"><code>ec15597</code></a></td><td><code>Trac #17693: alternative implementation add</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e\"><code>3c69f6b</code></a></td><td><code>Merge remote-tracking branch 'origin/u/cheuberg/asy/mutable-poset-add' into t/17693/asy/mutable-poset</code></td></tr></table>\n",
    "created_at": "2015-09-28T12:25:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238911",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34e34dca5609d9b5ff4bb90247fa412d014dbd49"><code>34e34dc</code></a></td><td><code>Trac #17693, comment 36, 19--23: improve docstring of covers (former `_search_covers_`)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/490c2236b3ba38a125986c0cd5c4669f92911917"><code>490c223</code></a></td><td><code>Trac #17693, comment 36, 28--31: document role of self</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3de0a1d250a07c902295ff6199b9995e3fd19849"><code>3de0a1d</code></a></td><td><code>Trac #17693, comment 36, 33: explicitly mention merge and can_merge at top of docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/485b46f4f2203885ee22469c3b237e67a605bc21"><code>485b46f</code></a></td><td><code>Trac #17693, comment 36, 34: raise exceptions when merge is not possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6bec7548d7c2ab961a31d70e96211cb572d2e"><code>d5d6bec</code></a></td><td><code>check=False in MutablePoset.merge since checked already before</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6da3db12035b5b4904dd7ba25082140c17023fa6"><code>6da3db1</code></a></td><td><code>Trac #17693, comment 36, 37: extend doc to mention more explicitly that merge is not allowed to change keys</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1e9f9e8224c4e78944c57f3ca9c4b73a2f96d83"><code>f1e9f9e</code></a></td><td><code>Trac #17693, comment 36, 38: clarify parameter key</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae0cad989dd4e5dddc9bf2218280fab131db2c85"><code>ae0cad9</code></a></td><td><code>Trac #17693, comment 36, 60: mention motivation asymptoic expansions in merge method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec15597efaf476e4d1cc822877e77a3ec740d78d"><code>ec15597</code></a></td><td><code>Trac #17693: alternative implementation add</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e"><code>3c69f6b</code></a></td><td><code>Merge remote-tracking branch 'origin/u/cheuberg/asy/mutable-poset-add' into t/17693/asy/mutable-poset</code></td></tr></table>




---

archive/issue_comments_238912.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@cheuberg](#comment:36):\n> I read the documentation and the code. I pushed a few reviewer commits.\n\nCross-reviewed. One commit added.\n\n> I have a number of rather minor issues with the documentation which I ask you to fix in order facilitate future maintainance of the code. In three instances, I propose alternative implementations, which might be more readable or slightly more efficient.\n\nThanks; see my comments below.\n\n> 1. Please add `.. seealso::` blocks between corresponding methods of shell and poset as well as between the accessor methods (keys, elements, shells)\n\nDone.\n\n> 2. there is an empty \"Introduction\" section at the beginning of the module documentation, the next heading \"Example\" is on the same level.\n\nDeleted.\n\n> 3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the \"experimental\" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.\n\nActivated it; it seems (for some (to me) unknown reason) the warning appears now in every doctest and not only once in the file. Thus, deactivated it again; and I am for keeping it this way.\n\n> 4. `MutablePoset.__init__` accepts a list of elements. This could be used in several doctests (in particular, in the set operations) as an abbreviation.\n\nGood idea. Done.\n\n> 5. `MutablePosetShell.__init__`: shall we check that `element is not None`? Otherwise, handling of special elements would probably be affected.\n\nMutablePosetShell is typically used by the MutablePoset; and there, adding a `None`-element is forbidden (see :meth:`add`).\n\n> 6. `MutablePosetShell.key`: I do not understand the sentence \"The element is converted by the poset to the key\".\n\nRewritten.\n\n> 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.\n\nNow it is cached (see also follow up ticket #19281).\n\n> 8. `MutablePosetShell.__repr__`: The note box in the docstring is surprising at this point: reading the source file from the top, this is the first point where the representation of the data is explained, after guessing it from `is_special`, `is_oo`, `is_null` above. I think that it would be better to document these conventions closer to the top, perhaps in the `__init__` method or perhaps only as a comment in the source code.\n\nAdded a note in the class description.\n\n> 9. `MutablePosetShell.__repr__`: The code replicates the behaviour of `is_null` and `is_oo`. As the `__repr__` method is hardly time critical, I'd prefer using `is_null` and `is_oo`, here and thus hiding the internal convention.\n\nRewritten.\n\n> 10. `MutablePosetShell.le`: the note box could be simplified by suppressing implementation details and speaking about the special elements.\n\nDone.\n\n> 11. `MutablePosetShell.le`: `right <= left`: neither `right` nor `left` are defined here.\n\nRewritten.\n\n> 12. `MutablePosetShell.le`: the part `if other.element is None` could be simplified to `return not other.successors()` as `self` is already known not to be special here.\n\nTrue; rewritten.\n\n> 13. `MutablePosetShell.le`: If this is time critical, `self._predecessors_` could be used instead of `self.predecessors()`.\n\nChanged.\n\n> 14. `MutablePosetShell.eq`: note box, see above.\n\nSimplified.\n\n> 15. `MutablePosetShell.eq`: emphasize that elements with equal keys are considered equal? Currently, this information is somewhat hidden in the note box which at first glance only seems to explain handling of special elements.\n\nRewritten note box.\n\n> 16. `MutablePosetShell._copy_all_linked_`: Short description: \"Return a copy of all shells\" does not correspond to the actual return value, which is only the copy of this shell.\n\nRewritten.\n\n> 17. `MutablePosetShell._copy_all_linked_`: the interplay between this method and `MutablePoset._copy_shells_` is not well documented: in particular, `poset` in `_copy_all_linked_` is *only* used for setting the containing poset, but not for actual inserting into this poset.\n\nExtended description of parameter `poset`.\n\n> 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.\n\n`oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.\n\n> So `oo is Q.oo` would be more interesting?\n\n`oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`. Inserting this into `Q` is done in `_copy_shells_`.\n\n> The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?\n\nI do not understand what you mean (but it is already late...).\n\n> 19. `MutablePosetShell._search_covers_`: what is the role of `self` in this method? It trivially influences the return value, but what else?\n\n`_search_covers_` does not exist anymore (see 27).\n\n> 20. `MutablePosetShell._search_covers_`: The explanation of the return value is unclear to me. Is the sentence \"Note that...\" meant to be a complete description? Does it change if `reverse` is set?\n\n`_search_covers_` does not exist anymore (see 27).\n\n> 21. `MutablePosetShell._search_covers_`: I think that the notions of \"upper cover\" and \"lower cover\" need a brief definition; I did not find them in Wikipedia and `sage.combinat.posets.posets.FinitePoset.upper_covers` defines the notion.\n\n`_search_covers_` does not exist anymore (see 27). Incooperated in `covers`.\n\n> 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.\n\n`_search_covers_` does not exist anymore (see 27).\n\n> 23. `MutablePosetShell._search_covers_`: what is the difference between this method and `.predecessors`? Is the shell necessarily an element of the poset? If not, then there should be a doctest covering this case.\n\n`_search_covers_` does not exist anymore (see 27). Incooperated in `covers`.\n\n> 24. `MutablePosetShell.covers`: \"originate\" is somewhat foreign to the description of the poset.\n\nRewritten.\n\n> 25. `MutablePosetShell.covers`: \"which are at most the given shell\": should that be \"which are less than the given shell\"?\n\nRewritten.\n\n> 26. `MutablePosetShell.covers` see comments on `MutablePosetShell._search_covers_`.\n\nRewritten.\n\n> 27. `MutablePosetShell.covers`: I think that the following would be an equivalent implementation of this method, which does not need a helper function with side effects.\n> \n> ```\n>         if self == shell:\n>             return set()\n>         covers = set().union(*(e.covers(shell, reverse)\n>                                for e in self.successors(reverse)\n>                                if e.le(shell, reverse)))\n>         if covers:\n>             return covers\n>         else:\n>             return set([self])\n> ```\n>   (pushed as branch `u/cheuberg/asy/mutable-poset-cover`)\n\nMerged and minor simplification.\n\n> 28. `MutablePosetShell._iter_depth_first_visit_`: document the role of self in this method (only shells `>=` this shell are visited).\n\nDocumented.\n\n> 29. `MutablePosetShell.iter_depth_first`: document the role of self in this method (only shells `>=` this shell are visited).\n\nDocumented.\n\n> 30. `MutablePosetShell._iter_topological_visit_`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).\n\nDocumented.\n\n> 31. `MutablePosetShell.iter_topological_first`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).\n\nDocumented.\n\n> 32. `MutablePosetShell.iter_topological_sort`, last example: function `C` is defined, but not used.\n\nDeleted.\n\n> 33. `MutablePosetShell.merge`: explain what merge is, in particular, that this is defined when constructing the poset.\n\nDocumented.\n\n> 34. `MutablePosetShell.merge`: I am surprised that `check=True` leads to a silent failure instead of an exception and that `poset._merge_ is None` does not raise an exception. Document and test this behaviour?\n\nBehavior changed.\n\n> 35. `MutablePosetShell.merge`: what is the difference between `poset.remove` and `poset.discard`?\n\nSee Python's set.\n\n> 36. `MutablePosetShell.merge`: document that the merge function resulting in `None` leads to deletion of the element.\n\nDone.\n\n> 37. `MutablePosetShell.merge`: document that the merge function must not change the position of the element in the poset.\n\nMentioned this more explicitly in docs\n\n> 38. `MutablePoset.__init__`: Clarify the role of `key`: in particular, `key` does not only influence sorting, but that no two elements are allowed to have the same key.\n\nDone.\n\n> 39. `MutablePoset.__len__`: Clarify that `null` and `oo` are not counted.\n\nDone.\n\n> 40. `MutablePoset.shells_topological`: The sentence \"If this is None, no sorting according to the representation string occurs.\" is unclear to me, in particular the role of the representation string.\n\nRewritten.\n\n> 41. `MutablePoset.keys_topological`: Due to the chosen key, some of the elements added to the poset are ignored. I do not know why this is demonstrated here.\n\nRemoved.\n\n> 42. `MutablePoset.repr`: INPUT section is incomplete.\n\nCompleted.\n\n> 43. `MutablePoset.repr_full`: INPUT section is incomplete.\n\nCompleted.\n\n> 44. `MutablePoset.add`: the loop `for reverse in (False, True)` simplifies in the second iteration: as all pairs of elements `(s, l)` with `new` covering `s` and `l` covering `new` have already been broken up while `reverse=False`. Thus it might be more straightforward to do it only once, not using `reverse` at all and saving a few intersections:\n> \n> ```\n>         new._predecessors_ = self.null.covers(new, reverse=False)\n>         new._successors_ = self.oo.covers(new, reverse=True)\n> \n>         for s in new.predecessors():\n>             for l in s.successors().intersection(new.successors()):\n>                 l.predecessors().remove(s)\n>                 s.successors().remove(l)\n>             s.successors().add(new)\n>         for l in new.successors():\n>             l.predecessors().add(new)\n> ```\n>   (pushed as branch `u/cheuberg/asy/mutable-poset-add`)\n\nMerged and cross-reviewed....ok.\n\n> 45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:\n> \n> ```\n>         for upper in shell.successors():\n>             upper.predecessors().remove(shell)\n> \n>         for lower in shell.predecessors():\n>             lower.successors().remove(shell)\n>             for upper in shell.successors():\n>                 if not any(s <= upper \n>                            for s in lower.successors()):\n>                     lower.successors().add(upper)\n>                     upper.predecessors().add(lower)\n> ```\n>   (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)\n\nThis needs comparisons of the elements, but one of the main ideas of this data structure is that comparisions are only needed for inserting an element into the poset and none needed once it is inside. Thus I am for keeping the current solution. However, I am fine with introducing (now or at any point later) an algorithm option which makes it possible to select different removing algorithms depending on the situation.\n\n> 46. `MutablePoset.remove`, `MutablePoset.discard`: add \"see also blocks\", but also an explanation of the difference between `discard` and `remove`. I guess that both methods are available due to some compatibility concern (in that case, please add a remark in the code or the docstring). Otherwise, I'd suggest removing `discard`, removing the parameter `raise_key_error` and let the user catch the exception.\n\nPython's set has both, `remove` and `discard`. Thus this mutable poset should have it as well.\nNote-block added. Seealso added.\n\n> 47. `MutablePoset.pop`: remove `key=lambda c: -c` from this example as it is not pertinent to `pop`.\n\nDone.\n\n> 48. `MutablePoset.pop`: mention that special elements cannot be popped.\n\nDone.\n\n> 49. `MutablePoset.pop`: IMHO you can remove the first four line (the `try:` block deleting `kwargs['include_special']`) because setting `kwargs['include_special'] = False` should result in the same result.\n\nDeleted.\n\n> 50. `MutablePoset.union`: The doctest `P.union(P, Q, Q, P)` neither fits the description \"a poset\" or \"an iterable of future elements\".\n\nRewritten INPUT-block\n\n> 51. `MutablePoset.union`: the word \"union\" sounds symmetric, however, due to keys and merge functions, it might not be commutative. The note box is not helpful for me.\n\nNote added/changed.\n\n> 52. `MutablePoset.union`: the TODO box from `union_update` also applies here.\n\nCopied.\n\n> 53. `MutablePoset.union_update`: why is the semantics of `other` different w.r.t `union`, but has the same description? It would seem more logical to me if `union` would simply call copy and then pass its argument to `update_union` and let the latter function sort out the iterators?\n\nIndeed. Code rewritten.\n\n> 54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`\n\nDone.\n\n> 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`\n\nDone.\n\n> 56. `MutablePoset.intersection_update`: how can the `AttributeError` occur? After all, `self` is a `MutablePoset`, so the method `keys` will be available unless something very strange happens ...\n\nTrue. Code simplified.\n\n> 57. `MutablePoset.merge`: documentation of `reverse`: what is the default direction?\n\nDocumented.\n\n> 58. `MutablePoset.merge`: add doctest for `RuntimeError`.\n\nAdded.\n\n> 59. `MutablePoset.merge`: document that `can_merge` is applied in the sense of the condition of depth first iteration, i.e., once `can_merge` fails, the successors are no longer tested. This is some kind of monotonicity condition on `can_merge`.\n\nAdded note.\n\n> 60. `MutablePoset.merge`: it should be mentioned somewhere that this (at first sight strange) merge magic is motivated by asymptotic expansions.\n\nMentioned.\n\n> 61. `MutablePoset.map`: IMHO the example does alter the keys, because the key was the identity map here.\n\nExample changed.\n\n> 62. `MutablePoset.mapping`: does the map have to be key preserving as in the method `map`? Is this method actually needed, see also the recent discussion on inplace vs. non-inplace operations on sage-devel?\n\nAdded a note on key-order preservation.\n\nI think having `MutablePoset.mapping` is useful (from a ui point of view) since one would not naturally thinks that the `copy` method has a parameter for applying a mapping function.",
    "created_at": "2015-09-28T12:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238912",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@cheuberg](#comment:36):
> I read the documentation and the code. I pushed a few reviewer commits.

Cross-reviewed. One commit added.

> I have a number of rather minor issues with the documentation which I ask you to fix in order facilitate future maintainance of the code. In three instances, I propose alternative implementations, which might be more readable or slightly more efficient.

Thanks; see my comments below.

> 1. Please add `.. seealso::` blocks between corresponding methods of shell and poset as well as between the accessor methods (keys, elements, shells)

Done.

> 2. there is an empty "Introduction" section at the beginning of the module documentation, the next heading "Example" is on the same level.

Deleted.

> 3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the "experimental" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.

Activated it; it seems (for some (to me) unknown reason) the warning appears now in every doctest and not only once in the file. Thus, deactivated it again; and I am for keeping it this way.

> 4. `MutablePoset.__init__` accepts a list of elements. This could be used in several doctests (in particular, in the set operations) as an abbreviation.

Good idea. Done.

> 5. `MutablePosetShell.__init__`: shall we check that `element is not None`? Otherwise, handling of special elements would probably be affected.

MutablePosetShell is typically used by the MutablePoset; and there, adding a `None`-element is forbidden (see :meth:`add`).

> 6. `MutablePosetShell.key`: I do not understand the sentence "The element is converted by the poset to the key".

Rewritten.

> 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.

Now it is cached (see also follow up ticket #19281).

> 8. `MutablePosetShell.__repr__`: The note box in the docstring is surprising at this point: reading the source file from the top, this is the first point where the representation of the data is explained, after guessing it from `is_special`, `is_oo`, `is_null` above. I think that it would be better to document these conventions closer to the top, perhaps in the `__init__` method or perhaps only as a comment in the source code.

Added a note in the class description.

> 9. `MutablePosetShell.__repr__`: The code replicates the behaviour of `is_null` and `is_oo`. As the `__repr__` method is hardly time critical, I'd prefer using `is_null` and `is_oo`, here and thus hiding the internal convention.

Rewritten.

> 10. `MutablePosetShell.le`: the note box could be simplified by suppressing implementation details and speaking about the special elements.

Done.

> 11. `MutablePosetShell.le`: `right <= left`: neither `right` nor `left` are defined here.

Rewritten.

> 12. `MutablePosetShell.le`: the part `if other.element is None` could be simplified to `return not other.successors()` as `self` is already known not to be special here.

True; rewritten.

> 13. `MutablePosetShell.le`: If this is time critical, `self._predecessors_` could be used instead of `self.predecessors()`.

Changed.

> 14. `MutablePosetShell.eq`: note box, see above.

Simplified.

> 15. `MutablePosetShell.eq`: emphasize that elements with equal keys are considered equal? Currently, this information is somewhat hidden in the note box which at first glance only seems to explain handling of special elements.

Rewritten note box.

> 16. `MutablePosetShell._copy_all_linked_`: Short description: "Return a copy of all shells" does not correspond to the actual return value, which is only the copy of this shell.

Rewritten.

> 17. `MutablePosetShell._copy_all_linked_`: the interplay between this method and `MutablePoset._copy_shells_` is not well documented: in particular, `poset` in `_copy_all_linked_` is *only* used for setting the containing poset, but not for actual inserting into this poset.

Extended description of parameter `poset`.

> 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.

`oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.

> So `oo is Q.oo` would be more interesting?

`oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`. Inserting this into `Q` is done in `_copy_shells_`.

> The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?

I do not understand what you mean (but it is already late...).

> 19. `MutablePosetShell._search_covers_`: what is the role of `self` in this method? It trivially influences the return value, but what else?

`_search_covers_` does not exist anymore (see 27).

> 20. `MutablePosetShell._search_covers_`: The explanation of the return value is unclear to me. Is the sentence "Note that..." meant to be a complete description? Does it change if `reverse` is set?

`_search_covers_` does not exist anymore (see 27).

> 21. `MutablePosetShell._search_covers_`: I think that the notions of "upper cover" and "lower cover" need a brief definition; I did not find them in Wikipedia and `sage.combinat.posets.posets.FinitePoset.upper_covers` defines the notion.

`_search_covers_` does not exist anymore (see 27). Incooperated in `covers`.

> 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.

`_search_covers_` does not exist anymore (see 27).

> 23. `MutablePosetShell._search_covers_`: what is the difference between this method and `.predecessors`? Is the shell necessarily an element of the poset? If not, then there should be a doctest covering this case.

`_search_covers_` does not exist anymore (see 27). Incooperated in `covers`.

> 24. `MutablePosetShell.covers`: "originate" is somewhat foreign to the description of the poset.

Rewritten.

> 25. `MutablePosetShell.covers`: "which are at most the given shell": should that be "which are less than the given shell"?

Rewritten.

> 26. `MutablePosetShell.covers` see comments on `MutablePosetShell._search_covers_`.

Rewritten.

> 27. `MutablePosetShell.covers`: I think that the following would be an equivalent implementation of this method, which does not need a helper function with side effects.
> 
> ```
>         if self == shell:
>             return set()
>         covers = set().union(*(e.covers(shell, reverse)
>                                for e in self.successors(reverse)
>                                if e.le(shell, reverse)))
>         if covers:
>             return covers
>         else:
>             return set([self])
> ```
>   (pushed as branch `u/cheuberg/asy/mutable-poset-cover`)

Merged and minor simplification.

> 28. `MutablePosetShell._iter_depth_first_visit_`: document the role of self in this method (only shells `>=` this shell are visited).

Documented.

> 29. `MutablePosetShell.iter_depth_first`: document the role of self in this method (only shells `>=` this shell are visited).

Documented.

> 30. `MutablePosetShell._iter_topological_visit_`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).

Documented.

> 31. `MutablePosetShell.iter_topological_first`: document the role of self in this method (only shells `<=` this shell are visited, emphasize the contrast to depth first.).

Documented.

> 32. `MutablePosetShell.iter_topological_sort`, last example: function `C` is defined, but not used.

Deleted.

> 33. `MutablePosetShell.merge`: explain what merge is, in particular, that this is defined when constructing the poset.

Documented.

> 34. `MutablePosetShell.merge`: I am surprised that `check=True` leads to a silent failure instead of an exception and that `poset._merge_ is None` does not raise an exception. Document and test this behaviour?

Behavior changed.

> 35. `MutablePosetShell.merge`: what is the difference between `poset.remove` and `poset.discard`?

See Python's set.

> 36. `MutablePosetShell.merge`: document that the merge function resulting in `None` leads to deletion of the element.

Done.

> 37. `MutablePosetShell.merge`: document that the merge function must not change the position of the element in the poset.

Mentioned this more explicitly in docs

> 38. `MutablePoset.__init__`: Clarify the role of `key`: in particular, `key` does not only influence sorting, but that no two elements are allowed to have the same key.

Done.

> 39. `MutablePoset.__len__`: Clarify that `null` and `oo` are not counted.

Done.

> 40. `MutablePoset.shells_topological`: The sentence "If this is None, no sorting according to the representation string occurs." is unclear to me, in particular the role of the representation string.

Rewritten.

> 41. `MutablePoset.keys_topological`: Due to the chosen key, some of the elements added to the poset are ignored. I do not know why this is demonstrated here.

Removed.

> 42. `MutablePoset.repr`: INPUT section is incomplete.

Completed.

> 43. `MutablePoset.repr_full`: INPUT section is incomplete.

Completed.

> 44. `MutablePoset.add`: the loop `for reverse in (False, True)` simplifies in the second iteration: as all pairs of elements `(s, l)` with `new` covering `s` and `l` covering `new` have already been broken up while `reverse=False`. Thus it might be more straightforward to do it only once, not using `reverse` at all and saving a few intersections:
> 
> ```
>         new._predecessors_ = self.null.covers(new, reverse=False)
>         new._successors_ = self.oo.covers(new, reverse=True)
> 
>         for s in new.predecessors():
>             for l in s.successors().intersection(new.successors()):
>                 l.predecessors().remove(s)
>                 s.successors().remove(l)
>             s.successors().add(new)
>         for l in new.successors():
>             l.predecessors().add(new)
> ```
>   (pushed as branch `u/cheuberg/asy/mutable-poset-add`)

Merged and cross-reviewed....ok.

> 45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:
> 
> ```
>         for upper in shell.successors():
>             upper.predecessors().remove(shell)
> 
>         for lower in shell.predecessors():
>             lower.successors().remove(shell)
>             for upper in shell.successors():
>                 if not any(s <= upper 
>                            for s in lower.successors()):
>                     lower.successors().add(upper)
>                     upper.predecessors().add(lower)
> ```
>   (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)

This needs comparisons of the elements, but one of the main ideas of this data structure is that comparisions are only needed for inserting an element into the poset and none needed once it is inside. Thus I am for keeping the current solution. However, I am fine with introducing (now or at any point later) an algorithm option which makes it possible to select different removing algorithms depending on the situation.

> 46. `MutablePoset.remove`, `MutablePoset.discard`: add "see also blocks", but also an explanation of the difference between `discard` and `remove`. I guess that both methods are available due to some compatibility concern (in that case, please add a remark in the code or the docstring). Otherwise, I'd suggest removing `discard`, removing the parameter `raise_key_error` and let the user catch the exception.

Python's set has both, `remove` and `discard`. Thus this mutable poset should have it as well.
Note-block added. Seealso added.

> 47. `MutablePoset.pop`: remove `key=lambda c: -c` from this example as it is not pertinent to `pop`.

Done.

> 48. `MutablePoset.pop`: mention that special elements cannot be popped.

Done.

> 49. `MutablePoset.pop`: IMHO you can remove the first four line (the `try:` block deleting `kwargs['include_special']`) because setting `kwargs['include_special'] = False` should result in the same result.

Deleted.

> 50. `MutablePoset.union`: The doctest `P.union(P, Q, Q, P)` neither fits the description "a poset" or "an iterable of future elements".

Rewritten INPUT-block

> 51. `MutablePoset.union`: the word "union" sounds symmetric, however, due to keys and merge functions, it might not be commutative. The note box is not helpful for me.

Note added/changed.

> 52. `MutablePoset.union`: the TODO box from `union_update` also applies here.

Copied.

> 53. `MutablePoset.union_update`: why is the semantics of `other` different w.r.t `union`, but has the same description? It would seem more logical to me if `union` would simply call copy and then pass its argument to `update_union` and let the latter function sort out the iterators?

Indeed. Code rewritten.

> 54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`

Done.

> 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`

Done.

> 56. `MutablePoset.intersection_update`: how can the `AttributeError` occur? After all, `self` is a `MutablePoset`, so the method `keys` will be available unless something very strange happens ...

True. Code simplified.

> 57. `MutablePoset.merge`: documentation of `reverse`: what is the default direction?

Documented.

> 58. `MutablePoset.merge`: add doctest for `RuntimeError`.

Added.

> 59. `MutablePoset.merge`: document that `can_merge` is applied in the sense of the condition of depth first iteration, i.e., once `can_merge` fails, the successors are no longer tested. This is some kind of monotonicity condition on `can_merge`.

Added note.

> 60. `MutablePoset.merge`: it should be mentioned somewhere that this (at first sight strange) merge magic is motivated by asymptotic expansions.

Mentioned.

> 61. `MutablePoset.map`: IMHO the example does alter the keys, because the key was the identity map here.

Example changed.

> 62. `MutablePoset.mapping`: does the map have to be key preserving as in the method `map`? Is this method actually needed, see also the recent discussion on inplace vs. non-inplace operations on sage-devel?

Added a note on key-order preservation.

I think having `MutablePoset.mapping` is useful (from a ui point of view) since one would not naturally thinks that the `copy` method has a parameter for applying a mapping function.



---

archive/issue_events_249820.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-28T12:26:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249820"
}
```



---

archive/issue_events_249821.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-28T12:26:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249821"
}
```



---

archive/issue_comments_238913.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**",
    "created_at": "2015-09-28T15:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238913",
    "user": "https://github.com/cheuberg"
}
```

Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**



---

archive/issue_comments_238914.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db042e0ecc3b30a1e41f39bca38e4ac59bb9e4fc\"><code>db042e0</code></a></td><td><code>Trac #17693: fix ReSt and hyperlink issues</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbe02ef463cdd3536bd907892c68e73792790525\"><code>bbe02ef</code></a></td><td><code>Trac #17693: minor language issues and typos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c\"><code>4deddbd</code></a></td><td><code>Trac #17693: remove comment on non-commutativity for difference and update_difference</code></td></tr></table>\n",
    "created_at": "2015-09-28T16:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238914",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db042e0ecc3b30a1e41f39bca38e4ac59bb9e4fc"><code>db042e0</code></a></td><td><code>Trac #17693: fix ReSt and hyperlink issues</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbe02ef463cdd3536bd907892c68e73792790525"><code>bbe02ef</code></a></td><td><code>Trac #17693: minor language issues and typos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c"><code>4deddbd</code></a></td><td><code>Trac #17693: remove comment on non-commutativity for difference and update_difference</code></td></tr></table>




---

archive/issue_comments_238915.json:
```json
{
    "body": "Changed commit from **[`3c69f6b`](https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e)** to **[`4deddbd`](https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c)**",
    "created_at": "2015-09-28T16:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238915",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3c69f6b`](https://github.com/sagemath/sagetrac-mirror/commit/3c69f6be24c5776593d3e067d8c723cd5c192e8e)** to **[`4deddbd`](https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c)**



---

archive/issue_events_249822.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-28T16:51:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249822"
}
```



---

archive/issue_events_249823.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-28T16:51:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249823"
}
```



---

archive/issue_comments_238916.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThank you for your changes. I added three commits. See my remaining comments below.\n\nReplying to [@dkrenn](#comment:39):\n> Replying to [@cheuberg](#comment:36):\n> > 3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the \"experimental\" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.\n\n> \n> Activated it; it seems (for some (to me) unknown reason) the warning appears now in every doctest and not only once in the file. Thus, deactivated it again; and I am for keeping it this way.\n\nok.\n\n> > 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.\n\n> \n> Now it is cached (see also follow up ticket #19281).\n\nI rather thought about calling `key` in `__init__` as I guess that the key will be needed at least once in the lifetime of every `MutablePosetShell`.\n\n\n> > 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.\n\n> \n> `oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.\n\nwouldn't `oo.is_oo` do it without comparing shells of different posets, which might be confusing?\n\n> \n> > So `oo is Q.oo` would be more interesting?\n\n> \n> `oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`.\n\nthat would be good to test (and comment on).\n\n> Inserting this into `Q` is done in `_copy_shells_`.\n> \n> > The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?\n\n> \n> I do not understand what you mean (but it is already late...).\n\nI mean that shells `e` and `f` might be equal even if they do belong to different posets; this might be an interesting doctest or example for equality.\n\n\n> > 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.\n\n> \n> `_search_covers_` does not exist anymore (see 27).\n\nThis does not solve the problem.\n\nWhat about renaming the method `covers` to `lower_covers` (and adapting the docstring slightly, removing \"upper \" from the one-sentence-description as well as from the definition?) For symmetry, a method `upper_covers` would be nice.\n\n\n> > 45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:\n> > \n> > ```\n> >         for upper in shell.successors():\n> >             upper.predecessors().remove(shell)\n> > \n> >         for lower in shell.predecessors():\n> >             lower.successors().remove(shell)\n> >             for upper in shell.successors():\n> >                 if not any(s <= upper \n> >                            for s in lower.successors()):\n> >                     lower.successors().add(upper)\n> >                     upper.predecessors().add(lower)\n> > ```\n> >   (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)\n\n> \n> This needs comparisons of the elements, but one of the main ideas of this data structure is that comparisions are only needed for inserting an element into the poset and none needed once it is inside. Thus I am for keeping the current solution. However, I am fine with introducing (now or at any point later) an algorithm option which makes it possible to select different removing algorithms depending on the situation.\n\nThis should be discussed when more benchmarking results are available. I opened #19300 for that.\n\n> > 54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`\n\n> \n> Done.\n\nremoved comment on non-commutativity because `difference` is non-commutative by definition.\n\n> \n> > 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`\n\n> \n> Done.\n\nRemove comment on non-commutativity? merge does not play a role here, and keys might be covered in the previous sentence?\n\n\n63. `MutablePoset.update_union`: \"Due to keys and a merge function... this operation might not be commutative\": This method is non-commutative by definition, as `self` is changed and `other` is not. So perhaps: \"`left.update_union(right)`\" and \"`right.update_union(left)` might result in different posets\"? The same for other `update_...` methods where non-commutativity might be surprising.",
    "created_at": "2015-09-28T16:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238916",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:43" align="right">comment:43</div>

Thank you for your changes. I added three commits. See my remaining comments below.

Replying to [@dkrenn](#comment:39):
> Replying to [@cheuberg](#comment:36):
> > 3. this module was written as part of the asymptotic expansion effort. In contrast to the asymptotic expansion, it does not have the "experimental" decorator. I'd feel more comfortable having it, at least until a larger portion of the asymptotic expansions have been merged.

> 
> Activated it; it seems (for some (to me) unknown reason) the warning appears now in every doctest and not only once in the file. Thus, deactivated it again; and I am for keeping it this way.

ok.

> > 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.

> 
> Now it is cached (see also follow up ticket #19281).

I rather thought about calling `key` in `__init__` as I guess that the key will be needed at least once in the lifetime of every `MutablePosetShell`.


> > 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.

> 
> `oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.

wouldn't `oo.is_oo` do it without comparing shells of different posets, which might be confusing?

> 
> > So `oo is Q.oo` would be more interesting?

> 
> `oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`.

that would be good to test (and comment on).

> Inserting this into `Q` is done in `_copy_shells_`.
> 
> > The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?

> 
> I do not understand what you mean (but it is already late...).

I mean that shells `e` and `f` might be equal even if they do belong to different posets; this might be an interesting doctest or example for equality.


> > 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.

> 
> `_search_covers_` does not exist anymore (see 27).

This does not solve the problem.

What about renaming the method `covers` to `lower_covers` (and adapting the docstring slightly, removing "upper " from the one-sentence-description as well as from the definition?) For symmetry, a method `upper_covers` would be nice.


> > 45. `MutablePoset.remove`: the loop over all (not necessarily direct) successors via the depth first search iterator seems to be rather inefficient, especially if the poset is large. I propose an alternative based on the order relation and not based on the data structure:
> > 
> > ```
> >         for upper in shell.successors():
> >             upper.predecessors().remove(shell)
> > 
> >         for lower in shell.predecessors():
> >             lower.successors().remove(shell)
> >             for upper in shell.successors():
> >                 if not any(s <= upper 
> >                            for s in lower.successors()):
> >                     lower.successors().add(upper)
> >                     upper.predecessors().add(lower)
> > ```
> >   (pushed as branch `u/cheuberg/asy/mutable-poset-remove`)

> 
> This needs comparisons of the elements, but one of the main ideas of this data structure is that comparisions are only needed for inserting an element into the poset and none needed once it is inside. Thus I am for keeping the current solution. However, I am fine with introducing (now or at any point later) an algorithm option which makes it possible to select different removing algorithms depending on the situation.

This should be discussed when more benchmarking results are available. I opened #19300 for that.

> > 54. `MutablePoset.difference` and `MutablePoset.difference_update`: see comments on `union` and `union_update`

> 
> Done.

removed comment on non-commutativity because `difference` is non-commutative by definition.

> 
> > 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`

> 
> Done.

Remove comment on non-commutativity? merge does not play a role here, and keys might be covered in the previous sentence?


63. `MutablePoset.update_union`: "Due to keys and a merge function... this operation might not be commutative": This method is non-commutative by definition, as `self` is changed and `other` is not. So perhaps: "`left.update_union(right)`" and "`right.update_union(left)` might result in different posets"? The same for other `update_...` methods where non-commutativity might be surprising.



---

archive/issue_comments_238917.json:
```json
{
    "body": "Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**",
    "created_at": "2015-09-29T07:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238917",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)**



---

archive/issue_comments_238918.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@cheuberg](#comment:43):\n> Thank you for your changes. I added three commits. See my remaining comments below.\n\nCross-review...ok.\n\n> > > 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.\n\n> > \n> > Now it is cached (see also follow up ticket #19281).\n\n> \n> I rather thought about calling `key` in `__init__` as I guess that the key will be needed at least once in the lifetime of every `MutablePosetShell`.\n\nOh...yes, I agree; changed.\n\n> > > 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.\n\n> > \n> > `oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.\n\n> \n> wouldn't `oo.is_oo` do it without comparing shells of different posets, which might be confusing?\n\nTrue. Changed.\n\n> > > So `oo is Q.oo` would be more interesting?\n\n> > \n> > `oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`.\n\n> \n> that would be good to test (and comment on).\n\nInserted.\n\n> > Inserting this into `Q` is done in `_copy_shells_`.\n> > \n> > > The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?\n\n> > \n> > I do not understand what you mean (but it is already late...).\n\n> \n> I mean that shells `e` and `f` might be equal even if they do belong to different posets; this might be an interesting doctest or example for equality.\n\nNow I understand what you mean. Inserted a doctest there.\n\n> > > 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.\n\n> > \n> > `_search_covers_` does not exist anymore (see 27).\n\n> \n> This does not solve the problem.\n> \n> What about renaming the method `covers` to `lower_covers` (and adapting the docstring slightly, removing \"upper \" from the one-sentence-description as well as from the definition?) For symmetry, a method `upper_covers` would be nice.\n\nGood idea; changed and inserted `upper_covers`.\n\n> > > 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`\n\n> > \n> > Done.\n\n> \n> Remove comment on non-commutativity? merge does not play a role here, and keys might be covered in the previous sentence?\n\nRemoved.\n\n> 63. `MutablePoset.update_union`: \"Due to keys and a merge function... this operation might not be commutative\": This method is non-commutative by definition, as `self` is changed and `other` is not. So perhaps: \"`left.update_union(right)`\" and \"`right.update_union(left)` might result in different posets\"? The same for other `update_...` methods where non-commutativity might be surprising.\n\nChanged.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7bd83a0f256e186fe5f8ecc9c4501d0643f7811\"><code>f7bd83a</code></a></td><td><code>Trac #17693, comment 43, 7: do caching of key in __init__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a554d697526397fca280239fa11b210cbec94c80\"><code>a554d69</code></a></td><td><code>rac #17693, comment 43, 18: use .is_oo to test for oo in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ac7ed1b8f318620cbeee52f570d6e8ef7bb23f9\"><code>3ac7ed1</code></a></td><td><code>rac #17693, comment 43, 18: add a doctest \"oo is Q.oo\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f675b3a6fff5e50770e85aedc23f38afbe275f0\"><code>2f675b3</code></a></td><td><code>Trac #17693, comment 43, 18: add a doctest in eq (comparing elements in different posets)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f064a3b6434551b97a0bbb36d918b8b2d1ffe3d6\"><code>f064a3b</code></a></td><td><code>Trac #17693, comment 43, 22: covers --> lower_covers, upper_covers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bea925cec11160275c4b3357c25b0f3d157d482e\"><code>bea925c</code></a></td><td><code>Trac #17693, comment 43, 55: remove comment on non-commutativity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66\"><code>4e73b45</code></a></td><td><code>Trac #17693, comment 43, 63: extend/rewrite non-commutativity note</code></td></tr></table>\n",
    "created_at": "2015-09-29T07:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238918",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@cheuberg](#comment:43):
> Thank you for your changes. I added three commits. See my remaining comments below.

Cross-review...ok.

> > > 7. `MutablePosetShell.key`: I am surprised that the key is not cached. I imagine that many comparisons will be needed in the lifetime of a `MutablePoset`, and in every case, the property key has to be resolved, which calls the property poset, which calls `get_key` of the poset.

> > 
> > Now it is cached (see also follow up ticket #19281).

> 
> I rather thought about calling `key` in `__init__` as I guess that the key will be needed at least once in the lifetime of every `MutablePosetShell`.

Oh...yes, I agree; changed.

> > > 18. `MutablePosetShell._copy_all_linked_`: I do not understand why you test `oo == P.oo`: I think that `oo` is an element of the new poset `Q`.

> > 
> > `oo == P.oo` tests that `Q.oo` is mapped to ``P.oo``.

> 
> wouldn't `oo.is_oo` do it without comparing shells of different posets, which might be confusing?

True. Changed.

> > > So `oo is Q.oo` would be more interesting?

> > 
> > `oo is Q.oo` is `False` since `oo` is not in `Q`, but just a copy of the `oo` in `P` with parent-poset `Q`.

> 
> that would be good to test (and comment on).

Inserted.

> > Inserting this into `Q` is done in `_copy_shells_`.
> > 
> > > The current test demonstrates that the poset is not used in comparison, so that would rather belong to `.eq`?

> > 
> > I do not understand what you mean (but it is already late...).

> 
> I mean that shells `e` and `f` might be equal even if they do belong to different posets; this might be an interesting doctest or example for equality.

Now I understand what you mean. Inserted a doctest there.

> > > 22. `MutablePosetShell._search_covers_`: According to Wikipedia, a cover is what is called an upper cover here. This is in contrast to the default behaviour here.

> > 
> > `_search_covers_` does not exist anymore (see 27).

> 
> This does not solve the problem.
> 
> What about renaming the method `covers` to `lower_covers` (and adapting the docstring slightly, removing "upper " from the one-sentence-description as well as from the definition?) For symmetry, a method `upper_covers` would be nice.

Good idea; changed and inserted `upper_covers`.

> > > 55. `MutablePoset.intersection` and `MutablePoset.intersection_update`: see comments on `union` and `union_update`

> > 
> > Done.

> 
> Remove comment on non-commutativity? merge does not play a role here, and keys might be covered in the previous sentence?

Removed.

> 63. `MutablePoset.update_union`: "Due to keys and a merge function... this operation might not be commutative": This method is non-commutative by definition, as `self` is changed and `other` is not. So perhaps: "`left.update_union(right)`" and "`right.update_union(left)` might result in different posets"? The same for other `update_...` methods where non-commutativity might be surprising.

Changed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7bd83a0f256e186fe5f8ecc9c4501d0643f7811"><code>f7bd83a</code></a></td><td><code>Trac #17693, comment 43, 7: do caching of key in __init__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a554d697526397fca280239fa11b210cbec94c80"><code>a554d69</code></a></td><td><code>rac #17693, comment 43, 18: use .is_oo to test for oo in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ac7ed1b8f318620cbeee52f570d6e8ef7bb23f9"><code>3ac7ed1</code></a></td><td><code>rac #17693, comment 43, 18: add a doctest "oo is Q.oo"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f675b3a6fff5e50770e85aedc23f38afbe275f0"><code>2f675b3</code></a></td><td><code>Trac #17693, comment 43, 18: add a doctest in eq (comparing elements in different posets)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f064a3b6434551b97a0bbb36d918b8b2d1ffe3d6"><code>f064a3b</code></a></td><td><code>Trac #17693, comment 43, 22: covers --> lower_covers, upper_covers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bea925cec11160275c4b3357c25b0f3d157d482e"><code>bea925c</code></a></td><td><code>Trac #17693, comment 43, 55: remove comment on non-commutativity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66"><code>4e73b45</code></a></td><td><code>Trac #17693, comment 43, 63: extend/rewrite non-commutativity note</code></td></tr></table>




---

archive/issue_comments_238919.json:
```json
{
    "body": "Changed commit from **[`4deddbd`](https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c)** to **[`4e73b45`](https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66)**",
    "created_at": "2015-09-29T07:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238919",
    "user": "https://github.com/dkrenn"
}
```

Changed commit from **[`4deddbd`](https://github.com/sagemath/sagetrac-mirror/commit/4deddbd1a09e0e60273797cb89becdc651325b9c)** to **[`4e73b45`](https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66)**



---

archive/issue_events_249824.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-29T07:24:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249824"
}
```



---

archive/issue_events_249825.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-09-29T07:24:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249825"
}
```



---

archive/issue_comments_238920.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**",
    "created_at": "2015-09-29T08:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238920",
    "user": "https://github.com/cheuberg"
}
```

Changed branch from **[u/dkrenn/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy/mutable-poset)** to **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)**



---

archive/issue_comments_238921.json:
```json
{
    "body": "Changed commit from **[`4e73b45`](https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66)** to **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**",
    "created_at": "2015-09-29T08:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238921",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e73b45`](https://github.com/sagemath/sagetrac-mirror/commit/4e73b4576e1e949b7257d858fbeb958152df9f66)** to **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**



---

archive/issue_comments_238922.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8d8d2c4b4975054c2470d2ee88e937ae1044167\"><code>e8d8d2c</code></a></td><td><code>Trac #17693: typos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b7f929e34a497e1180cb51efc74af4fdf7f79df\"><code>4b7f929</code></a></td><td><code>Trac #17693: fix two copy&paste errors</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22\"><code>a0b3d7b</code></a></td><td><code>Trac #17693: ReSt improvement</code></td></tr></table>\n",
    "created_at": "2015-09-29T08:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238922",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8d8d2c4b4975054c2470d2ee88e937ae1044167"><code>e8d8d2c</code></a></td><td><code>Trac #17693: typos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b7f929e34a497e1180cb51efc74af4fdf7f79df"><code>4b7f929</code></a></td><td><code>Trac #17693: fix two copy&paste errors</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22"><code>a0b3d7b</code></a></td><td><code>Trac #17693: ReSt improvement</code></td></tr></table>




---

archive/issue_events_249826.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-29T08:10:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249826"
}
```



---

archive/issue_events_249827.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-29T08:10:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249827"
}
```



---

archive/issue_comments_238923.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nAdded three final reviewer commits.\n\nDoctests pass, documentation builds, documentation seems to be fine, code seems to be fine.",
    "created_at": "2015-09-29T08:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238923",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:49" align="right">comment:49</div>

Added three final reviewer commits.

Doctests pass, documentation builds, documentation seems to be fine, code seems to be fine.



---

archive/issue_comments_238924.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@cheuberg](#comment:49):\n> Added three final reviewer commits.\n\nThanks; checked.\n\n> Doctests pass, documentation builds, documentation seems to be fine, code seems to be fine.\n\n:)",
    "created_at": "2015-09-29T08:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238924",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@cheuberg](#comment:49):
> Added three final reviewer commits.

Thanks; checked.

> Doctests pass, documentation builds, documentation seems to be fine, code seems to be fine.

:)



---

archive/issue_comments_238925.json:
```json
{
    "body": "Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**",
    "created_at": "2015-10-12T07:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/17693#issuecomment-238925",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cheuberg/asy/mutable-poset](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/asy/mutable-poset)** to **[`a0b3d7b`](https://github.com/sagemath/sagetrac-mirror/commit/a0b3d7bce3325e271e53b0a83047a6f80ac28a22)**



---

archive/issue_events_249828.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-12T07:16:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249828"
}
```



---

archive/issue_events_249829.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "dbd82f3a63f9407d3eb2a684ce889cc484cd6009",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-10-12T07:16:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/17693",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/17693#event-249829"
}
```
