# Issue 17711: Pre-processing for vertex separation

archive/issues_017474.json:
```json
{
    "body": "This patch cleans the module `sage.graphs.graph_decompositions.vertex_separation` to expose the new branch and bound algorithm #17647 and other methods into the `vertex_separation` method, as for the `path_decomposition` method. It makes the branch and bound the default method since it is the fastest one. It also adds a generic pre-processing method based on the decomposition of the input digraph into strongly connected components.\n\nCC:  @nathanncohen\n\nBranch/Commit: 6baf83e733555c22f287692f107eec954e494d59\n\nReviewer: Nathann Cohen\n\nAuthor: David Coudert\n\nDependencies: #17647\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/17711\n\n",
    "closed_at": "2015-02-18T23:22:44Z",
    "created_at": "2015-02-01T14:53:53Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Pre-processing for vertex separation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17711",
    "user": "https://github.com/dcoudert"
}
```
This patch cleans the module `sage.graphs.graph_decompositions.vertex_separation` to expose the new branch and bound algorithm #17647 and other methods into the `vertex_separation` method, as for the `path_decomposition` method. It makes the branch and bound the default method since it is the fastest one. It also adds a generic pre-processing method based on the decomposition of the input digraph into strongly connected components.

CC:  @nathanncohen

Branch/Commit: 6baf83e733555c22f287692f107eec954e494d59

Reviewer: Nathann Cohen

Author: David Coudert

Dependencies: #17647

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/17711





---

archive/issue_comments_248323.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-02-01T17:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_248324.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-01T17:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248324",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248325.json:
```json
{
    "body": "<a id='comment:4'></a>Unless I mixed up something with my commits, this patch is ready to be reviewed.",
    "created_at": "2015-02-01T17:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248325",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>Unless I mixed up something with my commits, this patch is ready to be reviewed.



---

archive/issue_comments_248326.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-02-03T09:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248326",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_248327.json:
```json
{
    "body": "<a id='comment:5'></a>Yooooooooooooo !\n\nDoes the job, very few comments (and a small commit at `public/17711b`):\n\n\n- Calling `is_strongly_connected` is very cheap while\n  `g.strongly_connected_components_digraph` actually copies the whole graph\n\n```\nsage: g=digraphs.DeBruijn(5,3)\nsage: %timeit g.is_strongly_connected()\n10000 loops, best of 3: 129 \u00b5s per loop\nsage: %timeit g.strongly_connected_components_digraph()\n1000 loops, best of 3: 1.31 ms per loop\n```\n\n  Better to only copy it if necessary.\n\n- Is there any reason why you only deal with digraphs ? `Digraph(G)` (when `G`\n  is a graph) is not always strongly connected: `G` may not be connected. The\n  same code could handle everything at once, couldn't it ?\n\n- (unrelated) what on earth is this `random_DAG` function doing in the global\n  namespace instead of being in `digraphs.<tab>` ? `O_O`\n\nNathann",
    "created_at": "2015-02-03T09:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248327",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Yooooooooooooo !

Does the job, very few comments (and a small commit at `public/17711b`):


- Calling `is_strongly_connected` is very cheap while
  `g.strongly_connected_components_digraph` actually copies the whole graph

```
sage: g=digraphs.DeBruijn(5,3)
sage: %timeit g.is_strongly_connected()
10000 loops, best of 3: 129 µs per loop
sage: %timeit g.strongly_connected_components_digraph()
1000 loops, best of 3: 1.31 ms per loop
```

  Better to only copy it if necessary.

- Is there any reason why you only deal with digraphs ? `Digraph(G)` (when `G`
  is a graph) is not always strongly connected: `G` may not be connected. The
  same code could handle everything at once, couldn't it ?

- (unrelated) what on earth is this `random_DAG` function doing in the global
  namespace instead of being in `digraphs.<tab>` ? `O_O`

Nathann



---

archive/issue_comments_248328.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 ncohen]:\n> Yooooooooooooo !\n> \n> Does the job, very few comments (and a small commit at `public/17711b`):\n> \n> \n> - Calling `is_strongly_connected` is very cheap while\n>   `g.strongly_connected_components_digraph` actually copies the whole graph\n> \n> \n> ```\n> sage: g=digraphs.DeBruijn(5,3)\n> sage: %timeit g.is_strongly_connected()\n> 10000 loops, best of 3: 129 \u00b5s per loop\n> sage: %timeit g.strongly_connected_components_digraph()\n> 1000 loops, best of 3: 1.31 ms per loop\n> ```\n> \n>   Better to only copy it if necessary.\n> \n> - Is there any reason why you only deal with digraphs ? `Digraph(G)` (when `G`\n>   is a graph) is not always strongly connected: `G` may not be connected. The\n>   same code could handle everything at once, couldn't it ?\n \nSo you propose that I\n1. test if the graph is connected. If not, then apply the algorithm on each connected component. \n2. If G is directed, test if is strongly connected. If not, then apply the algorithm on each scc\n\nIs that correct?\n\n \n> - (unrelated) what on earth is this `random_DAG` function doing in the global\n>   namespace instead of being in `digraphs.<tab>` ? `O_O`\n\n\nI had the same remark while reviewing patch #12181 (and certainly other tickets). Nothing has been done since. I don't even know where is the code.\nIn fact, we have many random<TAB> stuff in global namespace...\n\nDavid.",
    "created_at": "2015-02-03T12:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248328",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>Replying to [comment:5 ncohen]:
> Yooooooooooooo !
> 
> Does the job, very few comments (and a small commit at `public/17711b`):
> 
> 
> - Calling `is_strongly_connected` is very cheap while
>   `g.strongly_connected_components_digraph` actually copies the whole graph
> 
> 
> ```
> sage: g=digraphs.DeBruijn(5,3)
> sage: %timeit g.is_strongly_connected()
> 10000 loops, best of 3: 129 µs per loop
> sage: %timeit g.strongly_connected_components_digraph()
> 1000 loops, best of 3: 1.31 ms per loop
> ```
> 
>   Better to only copy it if necessary.
> 
> - Is there any reason why you only deal with digraphs ? `Digraph(G)` (when `G`
>   is a graph) is not always strongly connected: `G` may not be connected. The
>   same code could handle everything at once, couldn't it ?
 
So you propose that I
1. test if the graph is connected. If not, then apply the algorithm on each connected component. 
2. If G is directed, test if is strongly connected. If not, then apply the algorithm on each scc

Is that correct?

 
> - (unrelated) what on earth is this `random_DAG` function doing in the global
>   namespace instead of being in `digraphs.<tab>` ? `O_O`


I had the same remark while reviewing patch #12181 (and certainly other tickets). Nothing has been done since. I don't even know where is the code.
In fact, we have many random<TAB> stuff in global namespace...

David.



---

archive/issue_comments_248329.json:
```json
{
    "body": "<a id='comment:7'></a>> So you propose that I\n> 1. test if the graph is connected. If not, then apply the algorithm on each connected component. \n> 2. If G is directed, test if is strongly connected. If not, then apply the algorithm on each scc\n\n\nI had something simpler (and a it more ressource-consuming) in mind:\n1) If you have a graph, test if it is connected. If it is not, turn it into a digraph\n2) Now the scc code for digraphs will handle each connected component independently\n\nSo you get it for free, more or less.\n\n> I had the same remark while reviewing patch #12181 (and certainly other tickets). Nothing has been done since. I don't even know where is the code.\n> In fact, we have many random<TAB> stuff in global namespace...\n\n\nPffff.. It comes from the \"sandpile\" module and I am not even sure that any of that code is useful to anything.\n\nPlus I am not very eager to move 'random_DAG' to `digraphs.<tab>` because I do not agree with the way it generates the random dag. Also, some random 'weights' are involved.\n\nI will probably end up removing the imports into the global namespace, and that will be all.\n\nI'll cc you if I do.\n\nNathann",
    "created_at": "2015-02-03T12:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248329",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>> So you propose that I
> 1. test if the graph is connected. If not, then apply the algorithm on each connected component. 
> 2. If G is directed, test if is strongly connected. If not, then apply the algorithm on each scc


I had something simpler (and a it more ressource-consuming) in mind:
1) If you have a graph, test if it is connected. If it is not, turn it into a digraph
2) Now the scc code for digraphs will handle each connected component independently

So you get it for free, more or less.

> I had the same remark while reviewing patch #12181 (and certainly other tickets). Nothing has been done since. I don't even know where is the code.
> In fact, we have many random<TAB> stuff in global namespace...


Pffff.. It comes from the "sandpile" module and I am not even sure that any of that code is useful to anything.

Plus I am not very eager to move 'random_DAG' to `digraphs.<tab>` because I do not agree with the way it generates the random dag. Also, some random 'weights' are involved.

I will probably end up removing the imports into the global namespace, and that will be all.

I'll cc you if I do.

Nathann



---

archive/issue_comments_248330.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2015-02-03T13:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248330",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_248331.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-03T13:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248332.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-02-03T13:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248332",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_248333.json:
```json
{
    "body": "<a id='comment:10'></a>I have implemented an alternative approach preventing conversion Graph to DiGraph.\nI hope you will like it.\n\nDavid.",
    "created_at": "2015-02-03T13:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248333",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>I have implemented an alternative approach preventing conversion Graph to DiGraph.
I hope you will like it.

David.



---

archive/issue_comments_248334.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-03T14:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248335.json:
```json
{
    "body": "<a id='comment:12'></a>Sorry, I erased some of your modifications in my last commit. This is corrected.",
    "created_at": "2015-02-03T14:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248335",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>Sorry, I erased some of your modifications in my last commit. This is corrected.



---

archive/issue_comments_248336.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-03T19:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248336",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248337.json:
```json
{
    "body": "<a id='comment:13'></a>> I have implemented an alternative approach preventing conversion Graph to DiGraph.\n> I hope you will like it.\n\n\nPerfect!\n\nThanks,\n\nNathann",
    "created_at": "2015-02-03T19:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248337",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>> I have implemented an alternative approach preventing conversion Graph to DiGraph.
> I hope you will like it.


Perfect!

Thanks,

Nathann



---

archive/issue_comments_248338.json:
```json
{
    "body": "<a id='comment:14'></a>Thanks.",
    "created_at": "2015-02-04T00:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248338",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>Thanks.



---

archive/issue_events_050682.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T23:22:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17711#event-50682"
}
```



---

archive/issue_comments_248339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T23:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17711#issuecomment-248339",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
